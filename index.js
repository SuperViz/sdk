var _0=Object.create;var br=Object.defineProperty,P0=Object.defineProperties,_l=Object.getOwnPropertyDescriptor,w0=Object.getOwnPropertyDescriptors,M0=Object.getOwnPropertyNames,Tl=Object.getOwnPropertySymbols,x0=Object.getPrototypeOf,Pl=Object.prototype.hasOwnProperty,L0=Object.prototype.propertyIsEnumerable;var Il=(h,r,n)=>r in h?br(h,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[r]=n,gt=(h,r)=>{for(var n in r||(r={}))Pl.call(r,n)&&Il(h,n,r[n]);if(Tl)for(var n of Tl(r))L0.call(r,n)&&Il(h,n,r[n]);return h},Cn=(h,r)=>P0(h,w0(r));var ds=(h,r)=>()=>(h&&(r=h(h=0)),r);var Je=(h,r)=>()=>(r||h((r={exports:{}}).exports,r),r.exports),wl=(h,r)=>{for(var n in r)br(h,n,{get:r[n],enumerable:!0})},N0=(h,r,n,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of M0(r))!Pl.call(h,i)&&i!==n&&br(h,i,{get:()=>r[i],enumerable:!(s=_l(r,i))||s.enumerable});return h};var qt=(h,r,n)=>(n=h!=null?_0(x0(h)):{},N0(r||!h||!h.__esModule?br(n,"default",{value:h,enumerable:!0}):n,h));var Ei=(h,r,n,s)=>{for(var i=s>1?void 0:s?_l(r,n):r,m=h.length-1,y;m>=0;m--)(y=h[m])&&(i=(s?y(r,n,i):y(i))||i);return s&&i&&br(r,n,i),i};var Ye=(h,r,n)=>new Promise((s,i)=>{var m=f=>{try{l(n.next(f))}catch(A){i(A)}},y=f=>{try{l(n.throw(f))}catch(A){i(A)}},l=f=>f.done?s(f.value):Promise.resolve(f.value).then(m,y);l((n=n.apply(h,r)).next())});var ce,X=ds(()=>{ce={}});var Ii=Je((Vn,Cr)=>{X();(function(){var h,r="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",m="Invalid `variable` option passed into `_.template`",y="__lodash_hash_undefined__",l=500,f="__lodash_placeholder__",A=1,S=2,R=4,a=1,E=2,M=1,P=2,O=4,b=8,T=16,c=32,g=64,d=128,p=256,u=512,C=30,_="...",L=800,W=16,H=1,U=2,I=3,x=1/0,z=9007199254740991,k=17976931348623157e292,J=0/0,ee=4294967295,Q=ee-1,G=ee>>>1,D=[["ary",d],["bind",M],["bindKey",P],["curry",b],["curryRight",T],["flip",u],["partial",c],["partialRight",g],["rearg",p]],B="[object Arguments]",V="[object Array]",j="[object AsyncFunction]",te="[object Boolean]",le="[object Date]",me="[object DOMException]",ve="[object Error]",Se="[object Function]",Le="[object GeneratorFunction]",de="[object Map]",xe="[object Number]",et="[object Null]",Be="[object Object]",ke="[object Promise]",ct="[object Proxy]",Z="[object RegExp]",ie="[object Set]",ue="[object String]",pe="[object Symbol]",Re="[object Undefined]",Qe="[object WeakMap]",fn="[object WeakSet]",rr="[object ArrayBuffer]",Mn="[object DataView]",$i="[object Float32Array]",ji="[object Float64Array]",Vi="[object Int8Array]",Ki="[object Int16Array]",Ji="[object Int32Array]",qi="[object Uint8Array]",Qi="[object Uint8ClampedArray]",Yi="[object Uint16Array]",Zi="[object Uint32Array]",Jc=/\b__p \+= '';/g,qc=/\b(__p \+=) '' \+/g,Qc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ys=/&(?:amp|lt|gt|quot|#39);/g,Zs=/[&<>"']/g,Yc=RegExp(Ys.source),Zc=RegExp(Zs.source),Xc=/<%-([\s\S]+?)%>/g,ef=/<%([\s\S]+?)%>/g,Xs=/<%=([\s\S]+?)%>/g,tf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nf=/^\w*$/,rf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xi=/[\\^$.*+?()[\]{}|]/g,of=RegExp(Xi.source),eo=/^\s+/,sf=/\s/,af=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,uf=/\{\n\/\* \[wrapped with (.+)\] \*/,lf=/,? & /,cf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ff=/[()=,{}\[\]\/\s]/,df=/\\(\\)?/g,hf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ea=/\w*$/,pf=/^[-+]0x[0-9a-f]+$/i,gf=/^0b[01]+$/i,vf=/^\[object .+?Constructor\]$/,mf=/^0o[0-7]+$/i,yf=/^(?:0|[1-9]\d*)$/,bf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ur=/($^)/,Af=/['\n\r\u2028\u2029\\]/g,Br="\\ud800-\\udfff",Cf="\\u0300-\\u036f",Of="\\ufe20-\\ufe2f",Sf="\\u20d0-\\u20ff",ta=Cf+Of+Sf,na="\\u2700-\\u27bf",ra="a-z\\xdf-\\xf6\\xf8-\\xff",Ef="\\xac\\xb1\\xd7\\xf7",Rf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Tf="\\u2000-\\u206f",If=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ia="A-Z\\xc0-\\xd6\\xd8-\\xde",oa="\\ufe0e\\ufe0f",sa=Ef+Rf+Tf+If,to="['\u2019]",_f="["+Br+"]",aa="["+sa+"]",Fr="["+ta+"]",ua="\\d+",Pf="["+na+"]",la="["+ra+"]",ca="[^"+Br+sa+ua+na+ra+ia+"]",no="\\ud83c[\\udffb-\\udfff]",wf="(?:"+Fr+"|"+no+")",fa="[^"+Br+"]",ro="(?:\\ud83c[\\udde6-\\uddff]){2}",io="[\\ud800-\\udbff][\\udc00-\\udfff]",xn="["+ia+"]",da="\\u200d",ha="(?:"+la+"|"+ca+")",Mf="(?:"+xn+"|"+ca+")",pa="(?:"+to+"(?:d|ll|m|re|s|t|ve))?",ga="(?:"+to+"(?:D|LL|M|RE|S|T|VE))?",va=wf+"?",ma="["+oa+"]?",xf="(?:"+da+"(?:"+[fa,ro,io].join("|")+")"+ma+va+")*",Lf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Nf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ya=ma+va+xf,Df="(?:"+[Pf,ro,io].join("|")+")"+ya,Uf="(?:"+[fa+Fr+"?",Fr,ro,io,_f].join("|")+")",Bf=RegExp(to,"g"),Ff=RegExp(Fr,"g"),oo=RegExp(no+"(?="+no+")|"+Uf+ya,"g"),Gf=RegExp([xn+"?"+la+"+"+pa+"(?="+[aa,xn,"$"].join("|")+")",Mf+"+"+ga+"(?="+[aa,xn+ha,"$"].join("|")+")",xn+"?"+ha+"+"+pa,xn+"+"+ga,Nf,Lf,ua,Df].join("|"),"g"),Hf=RegExp("["+da+Br+ta+oa+"]"),kf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Wf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],zf=-1,He={};He[$i]=He[ji]=He[Vi]=He[Ki]=He[Ji]=He[qi]=He[Qi]=He[Yi]=He[Zi]=!0,He[B]=He[V]=He[rr]=He[te]=He[Mn]=He[le]=He[ve]=He[Se]=He[de]=He[xe]=He[Be]=He[Z]=He[ie]=He[ue]=He[Qe]=!1;var Ge={};Ge[B]=Ge[V]=Ge[rr]=Ge[Mn]=Ge[te]=Ge[le]=Ge[$i]=Ge[ji]=Ge[Vi]=Ge[Ki]=Ge[Ji]=Ge[de]=Ge[xe]=Ge[Be]=Ge[Z]=Ge[ie]=Ge[ue]=Ge[pe]=Ge[qi]=Ge[Qi]=Ge[Yi]=Ge[Zi]=!0,Ge[ve]=Ge[Se]=Ge[Qe]=!1;var $f={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},jf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Vf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Kf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Jf=parseFloat,qf=parseInt,ba=typeof global=="object"&&global&&global.Object===Object&&global,Qf=typeof self=="object"&&self&&self.Object===Object&&self,tt=ba||Qf||Function("return this")(),so=typeof Vn=="object"&&Vn&&!Vn.nodeType&&Vn,dn=so&&typeof Cr=="object"&&Cr&&!Cr.nodeType&&Cr,Aa=dn&&dn.exports===so,ao=Aa&&ba.process,St=function(){try{var q=dn&&dn.require&&dn.require("util").types;return q||ao&&ao.binding&&ao.binding("util")}catch(re){}}(),Ca=St&&St.isArrayBuffer,Oa=St&&St.isDate,Sa=St&&St.isMap,Ea=St&&St.isRegExp,Ra=St&&St.isSet,Ta=St&&St.isTypedArray;function vt(q,re,ne){switch(ne.length){case 0:return q.call(re);case 1:return q.call(re,ne[0]);case 2:return q.call(re,ne[0],ne[1]);case 3:return q.call(re,ne[0],ne[1],ne[2])}return q.apply(re,ne)}function Yf(q,re,ne,he){for(var Ce=-1,Ne=q==null?0:q.length;++Ce<Ne;){var Ze=q[Ce];re(he,Ze,ne(Ze),q)}return he}function Et(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he&&re(q[ne],ne,q)!==!1;);return q}function Zf(q,re){for(var ne=q==null?0:q.length;ne--&&re(q[ne],ne,q)!==!1;);return q}function Ia(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he;)if(!re(q[ne],ne,q))return!1;return!0}function Zt(q,re){for(var ne=-1,he=q==null?0:q.length,Ce=0,Ne=[];++ne<he;){var Ze=q[ne];re(Ze,ne,q)&&(Ne[Ce++]=Ze)}return Ne}function Gr(q,re){var ne=q==null?0:q.length;return!!ne&&Ln(q,re,0)>-1}function uo(q,re,ne){for(var he=-1,Ce=q==null?0:q.length;++he<Ce;)if(ne(re,q[he]))return!0;return!1}function We(q,re){for(var ne=-1,he=q==null?0:q.length,Ce=Array(he);++ne<he;)Ce[ne]=re(q[ne],ne,q);return Ce}function Xt(q,re){for(var ne=-1,he=re.length,Ce=q.length;++ne<he;)q[Ce+ne]=re[ne];return q}function lo(q,re,ne,he){var Ce=-1,Ne=q==null?0:q.length;for(he&&Ne&&(ne=q[++Ce]);++Ce<Ne;)ne=re(ne,q[Ce],Ce,q);return ne}function Xf(q,re,ne,he){var Ce=q==null?0:q.length;for(he&&Ce&&(ne=q[--Ce]);Ce--;)ne=re(ne,q[Ce],Ce,q);return ne}function co(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he;)if(re(q[ne],ne,q))return!0;return!1}var ed=fo("length");function td(q){return q.split("")}function nd(q){return q.match(cf)||[]}function _a(q,re,ne){var he;return ne(q,function(Ce,Ne,Ze){if(re(Ce,Ne,Ze))return he=Ne,!1}),he}function Hr(q,re,ne,he){for(var Ce=q.length,Ne=ne+(he?1:-1);he?Ne--:++Ne<Ce;)if(re(q[Ne],Ne,q))return Ne;return-1}function Ln(q,re,ne){return re===re?pd(q,re,ne):Hr(q,Pa,ne)}function rd(q,re,ne,he){for(var Ce=ne-1,Ne=q.length;++Ce<Ne;)if(he(q[Ce],re))return Ce;return-1}function Pa(q){return q!==q}function wa(q,re){var ne=q==null?0:q.length;return ne?po(q,re)/ne:J}function fo(q){return function(re){return re==null?h:re[q]}}function ho(q){return function(re){return q==null?h:q[re]}}function Ma(q,re,ne,he,Ce){return Ce(q,function(Ne,Ze,Fe){ne=he?(he=!1,Ne):re(ne,Ne,Ze,Fe)}),ne}function id(q,re){var ne=q.length;for(q.sort(re);ne--;)q[ne]=q[ne].value;return q}function po(q,re){for(var ne,he=-1,Ce=q.length;++he<Ce;){var Ne=re(q[he]);Ne!==h&&(ne=ne===h?Ne:ne+Ne)}return ne}function go(q,re){for(var ne=-1,he=Array(q);++ne<q;)he[ne]=re(ne);return he}function od(q,re){return We(re,function(ne){return[ne,q[ne]]})}function xa(q){return q&&q.slice(0,Ua(q)+1).replace(eo,"")}function mt(q){return function(re){return q(re)}}function vo(q,re){return We(re,function(ne){return q[ne]})}function ir(q,re){return q.has(re)}function La(q,re){for(var ne=-1,he=q.length;++ne<he&&Ln(re,q[ne],0)>-1;);return ne}function Na(q,re){for(var ne=q.length;ne--&&Ln(re,q[ne],0)>-1;);return ne}function sd(q,re){for(var ne=q.length,he=0;ne--;)q[ne]===re&&++he;return he}var ad=ho($f),ud=ho(jf);function ld(q){return"\\"+Kf[q]}function cd(q,re){return q==null?h:q[re]}function Nn(q){return Hf.test(q)}function fd(q){return kf.test(q)}function dd(q){for(var re,ne=[];!(re=q.next()).done;)ne.push(re.value);return ne}function mo(q){var re=-1,ne=Array(q.size);return q.forEach(function(he,Ce){ne[++re]=[Ce,he]}),ne}function Da(q,re){return function(ne){return q(re(ne))}}function en(q,re){for(var ne=-1,he=q.length,Ce=0,Ne=[];++ne<he;){var Ze=q[ne];(Ze===re||Ze===f)&&(q[ne]=f,Ne[Ce++]=ne)}return Ne}function kr(q){var re=-1,ne=Array(q.size);return q.forEach(function(he){ne[++re]=he}),ne}function hd(q){var re=-1,ne=Array(q.size);return q.forEach(function(he){ne[++re]=[he,he]}),ne}function pd(q,re,ne){for(var he=ne-1,Ce=q.length;++he<Ce;)if(q[he]===re)return he;return-1}function gd(q,re,ne){for(var he=ne+1;he--;)if(q[he]===re)return he;return he}function Dn(q){return Nn(q)?md(q):ed(q)}function Mt(q){return Nn(q)?yd(q):td(q)}function Ua(q){for(var re=q.length;re--&&sf.test(q.charAt(re)););return re}var vd=ho(Vf);function md(q){for(var re=oo.lastIndex=0;oo.test(q);)++re;return re}function yd(q){return q.match(oo)||[]}function bd(q){return q.match(Gf)||[]}var Ad=function q(re){re=re==null?tt:tn.defaults(tt.Object(),re,tn.pick(tt,Wf));var ne=re.Array,he=re.Date,Ce=re.Error,Ne=re.Function,Ze=re.Math,Fe=re.Object,yo=re.RegExp,Cd=re.String,Rt=re.TypeError,Wr=ne.prototype,Od=Ne.prototype,Un=Fe.prototype,zr=re["__core-js_shared__"],$r=Od.toString,Ue=Un.hasOwnProperty,Sd=0,Ba=function(){var e=/[^.]+$/.exec(zr&&zr.keys&&zr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),jr=Un.toString,Ed=$r.call(Fe),Rd=tt._,Td=yo("^"+$r.call(Ue).replace(Xi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vr=Aa?re.Buffer:h,nn=re.Symbol,Kr=re.Uint8Array,Fa=Vr?Vr.allocUnsafe:h,Jr=Da(Fe.getPrototypeOf,Fe),Ga=Fe.create,Ha=Un.propertyIsEnumerable,qr=Wr.splice,ka=nn?nn.isConcatSpreadable:h,or=nn?nn.iterator:h,hn=nn?nn.toStringTag:h,Qr=function(){try{var e=yn(Fe,"defineProperty");return e({},"",{}),e}catch(t){}}(),Id=re.clearTimeout!==tt.clearTimeout&&re.clearTimeout,_d=he&&he.now!==tt.Date.now&&he.now,Pd=re.setTimeout!==tt.setTimeout&&re.setTimeout,Yr=Ze.ceil,Zr=Ze.floor,bo=Fe.getOwnPropertySymbols,wd=Vr?Vr.isBuffer:h,Wa=re.isFinite,Md=Wr.join,xd=Da(Fe.keys,Fe),Xe=Ze.max,ot=Ze.min,Ld=he.now,Nd=re.parseInt,za=Ze.random,Dd=Wr.reverse,Ao=yn(re,"DataView"),sr=yn(re,"Map"),Co=yn(re,"Promise"),Bn=yn(re,"Set"),ar=yn(re,"WeakMap"),ur=yn(Fe,"create"),Xr=ar&&new ar,Fn={},Ud=bn(Ao),Bd=bn(sr),Fd=bn(Co),Gd=bn(Bn),Hd=bn(ar),ei=nn?nn.prototype:h,lr=ei?ei.valueOf:h,$a=ei?ei.toString:h;function N(e){if(je(e)&&!Oe(e)&&!(e instanceof we)){if(e instanceof Tt)return e;if(Ue.call(e,"__wrapped__"))return ju(e)}return new Tt(e)}var Gn=function(){function e(){}return function(t){if(!ze(t))return{};if(Ga)return Ga(t);e.prototype=t;var o=new e;return e.prototype=h,o}}();function ti(){}function Tt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=h}N.templateSettings={escape:Xc,evaluate:ef,interpolate:Xs,variable:"",imports:{_:N}},N.prototype=ti.prototype,N.prototype.constructor=N,Tt.prototype=Gn(ti.prototype),Tt.prototype.constructor=Tt;function we(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ee,this.__views__=[]}function kd(){var e=new we(this.__wrapped__);return e.__actions__=ft(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ft(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ft(this.__views__),e}function Wd(){if(this.__filtered__){var e=new we(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function zd(){var e=this.__wrapped__.value(),t=this.__dir__,o=Oe(e),v=t<0,w=o?e.length:0,F=tp(0,w,this.__views__),$=F.start,K=F.end,Y=K-$,oe=v?K:$-1,se=this.__iteratees__,ae=se.length,fe=0,ge=ot(Y,this.__takeCount__);if(!o||!v&&w==Y&&ge==Y)return pu(e,this.__actions__);var be=[];e:for(;Y--&&fe<ge;){oe+=t;for(var Te=-1,Ae=e[oe];++Te<ae;){var Pe=se[Te],Me=Pe.iteratee,At=Pe.type,lt=Me(Ae);if(At==U)Ae=lt;else if(!lt){if(At==H)continue e;break e}}be[fe++]=Ae}return be}we.prototype=Gn(ti.prototype),we.prototype.constructor=we;function pn(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var v=e[t];this.set(v[0],v[1])}}function $d(){this.__data__=ur?ur(null):{},this.size=0}function jd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Vd(e){var t=this.__data__;if(ur){var o=t[e];return o===y?h:o}return Ue.call(t,e)?t[e]:h}function Kd(e){var t=this.__data__;return ur?t[e]!==h:Ue.call(t,e)}function Jd(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=ur&&t===h?y:t,this}pn.prototype.clear=$d,pn.prototype.delete=jd,pn.prototype.get=Vd,pn.prototype.has=Kd,pn.prototype.set=Jd;function Ht(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var v=e[t];this.set(v[0],v[1])}}function qd(){this.__data__=[],this.size=0}function Qd(e){var t=this.__data__,o=ni(t,e);if(o<0)return!1;var v=t.length-1;return o==v?t.pop():qr.call(t,o,1),--this.size,!0}function Yd(e){var t=this.__data__,o=ni(t,e);return o<0?h:t[o][1]}function Zd(e){return ni(this.__data__,e)>-1}function Xd(e,t){var o=this.__data__,v=ni(o,e);return v<0?(++this.size,o.push([e,t])):o[v][1]=t,this}Ht.prototype.clear=qd,Ht.prototype.delete=Qd,Ht.prototype.get=Yd,Ht.prototype.has=Zd,Ht.prototype.set=Xd;function kt(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var v=e[t];this.set(v[0],v[1])}}function eh(){this.size=0,this.__data__={hash:new pn,map:new(sr||Ht),string:new pn}}function th(e){var t=pi(this,e).delete(e);return this.size-=t?1:0,t}function nh(e){return pi(this,e).get(e)}function rh(e){return pi(this,e).has(e)}function ih(e,t){var o=pi(this,e),v=o.size;return o.set(e,t),this.size+=o.size==v?0:1,this}kt.prototype.clear=eh,kt.prototype.delete=th,kt.prototype.get=nh,kt.prototype.has=rh,kt.prototype.set=ih;function gn(e){var t=-1,o=e==null?0:e.length;for(this.__data__=new kt;++t<o;)this.add(e[t])}function oh(e){return this.__data__.set(e,y),this}function sh(e){return this.__data__.has(e)}gn.prototype.add=gn.prototype.push=oh,gn.prototype.has=sh;function xt(e){var t=this.__data__=new Ht(e);this.size=t.size}function ah(){this.__data__=new Ht,this.size=0}function uh(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o}function lh(e){return this.__data__.get(e)}function ch(e){return this.__data__.has(e)}function fh(e,t){var o=this.__data__;if(o instanceof Ht){var v=o.__data__;if(!sr||v.length<n-1)return v.push([e,t]),this.size=++o.size,this;o=this.__data__=new kt(v)}return o.set(e,t),this.size=o.size,this}xt.prototype.clear=ah,xt.prototype.delete=uh,xt.prototype.get=lh,xt.prototype.has=ch,xt.prototype.set=fh;function ja(e,t){var o=Oe(e),v=!o&&An(e),w=!o&&!v&&un(e),F=!o&&!v&&!w&&zn(e),$=o||v||w||F,K=$?go(e.length,Cd):[],Y=K.length;for(var oe in e)(t||Ue.call(e,oe))&&!($&&(oe=="length"||w&&(oe=="offset"||oe=="parent")||F&&(oe=="buffer"||oe=="byteLength"||oe=="byteOffset")||jt(oe,Y)))&&K.push(oe);return K}function Va(e){var t=e.length;return t?e[xo(0,t-1)]:h}function dh(e,t){return gi(ft(e),vn(t,0,e.length))}function hh(e){return gi(ft(e))}function Oo(e,t,o){(o!==h&&!Lt(e[t],o)||o===h&&!(t in e))&&Wt(e,t,o)}function cr(e,t,o){var v=e[t];(!(Ue.call(e,t)&&Lt(v,o))||o===h&&!(t in e))&&Wt(e,t,o)}function ni(e,t){for(var o=e.length;o--;)if(Lt(e[o][0],t))return o;return-1}function ph(e,t,o,v){return rn(e,function(w,F,$){t(v,w,o(w),$)}),v}function Ka(e,t){return e&&Ut(t,nt(t),e)}function gh(e,t){return e&&Ut(t,ht(t),e)}function Wt(e,t,o){t=="__proto__"&&Qr?Qr(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o}function So(e,t){for(var o=-1,v=t.length,w=ne(v),F=e==null;++o<v;)w[o]=F?h:rs(e,t[o]);return w}function vn(e,t,o){return e===e&&(o!==h&&(e=e<=o?e:o),t!==h&&(e=e>=t?e:t)),e}function It(e,t,o,v,w,F){var $,K=t&A,Y=t&S,oe=t&R;if(o&&($=w?o(e,v,w,F):o(e)),$!==h)return $;if(!ze(e))return e;var se=Oe(e);if(se){if($=rp(e),!K)return ft(e,$)}else{var ae=st(e),fe=ae==Se||ae==Le;if(un(e))return mu(e,K);if(ae==Be||ae==B||fe&&!w){if($=Y||fe?{}:Uu(e),!K)return Y?Vh(e,gh($,e)):jh(e,Ka($,e))}else{if(!Ge[ae])return w?e:{};$=ip(e,ae,K)}}F||(F=new xt);var ge=F.get(e);if(ge)return ge;F.set(e,$),fl(e)?e.forEach(function(Ae){$.add(It(Ae,t,o,Ae,e,F))}):ll(e)&&e.forEach(function(Ae,Pe){$.set(Pe,It(Ae,t,o,Pe,e,F))});var be=oe?Y?zo:Wo:Y?ht:nt,Te=se?h:be(e);return Et(Te||e,function(Ae,Pe){Te&&(Pe=Ae,Ae=e[Pe]),cr($,Pe,It(Ae,t,o,Pe,e,F))}),$}function vh(e){var t=nt(e);return function(o){return Ja(o,e,t)}}function Ja(e,t,o){var v=o.length;if(e==null)return!v;for(e=Fe(e);v--;){var w=o[v],F=t[w],$=e[w];if($===h&&!(w in e)||!F($))return!1}return!0}function qa(e,t,o){if(typeof e!="function")throw new Rt(i);return mr(function(){e.apply(h,o)},t)}function fr(e,t,o,v){var w=-1,F=Gr,$=!0,K=e.length,Y=[],oe=t.length;if(!K)return Y;o&&(t=We(t,mt(o))),v?(F=uo,$=!1):t.length>=n&&(F=ir,$=!1,t=new gn(t));e:for(;++w<K;){var se=e[w],ae=o==null?se:o(se);if(se=v||se!==0?se:0,$&&ae===ae){for(var fe=oe;fe--;)if(t[fe]===ae)continue e;Y.push(se)}else F(t,ae,v)||Y.push(se)}return Y}var rn=Ou(Dt),Qa=Ou(Ro,!0);function mh(e,t){var o=!0;return rn(e,function(v,w,F){return o=!!t(v,w,F),o}),o}function ri(e,t,o){for(var v=-1,w=e.length;++v<w;){var F=e[v],$=t(F);if($!=null&&(K===h?$===$&&!bt($):o($,K)))var K=$,Y=F}return Y}function yh(e,t,o,v){var w=e.length;for(o=Ee(o),o<0&&(o=-o>w?0:w+o),v=v===h||v>w?w:Ee(v),v<0&&(v+=w),v=o>v?0:hl(v);o<v;)e[o++]=t;return e}function Ya(e,t){var o=[];return rn(e,function(v,w,F){t(v,w,F)&&o.push(v)}),o}function it(e,t,o,v,w){var F=-1,$=e.length;for(o||(o=sp),w||(w=[]);++F<$;){var K=e[F];t>0&&o(K)?t>1?it(K,t-1,o,v,w):Xt(w,K):v||(w[w.length]=K)}return w}var Eo=Su(),Za=Su(!0);function Dt(e,t){return e&&Eo(e,t,nt)}function Ro(e,t){return e&&Za(e,t,nt)}function ii(e,t){return Zt(t,function(o){return Vt(e[o])})}function mn(e,t){t=sn(t,e);for(var o=0,v=t.length;e!=null&&o<v;)e=e[Bt(t[o++])];return o&&o==v?e:h}function Xa(e,t,o){var v=t(e);return Oe(e)?v:Xt(v,o(e))}function at(e){return e==null?e===h?Re:et:hn&&hn in Fe(e)?ep(e):hp(e)}function To(e,t){return e>t}function bh(e,t){return e!=null&&Ue.call(e,t)}function Ah(e,t){return e!=null&&t in Fe(e)}function Ch(e,t,o){return e>=ot(t,o)&&e<Xe(t,o)}function Io(e,t,o){for(var v=o?uo:Gr,w=e[0].length,F=e.length,$=F,K=ne(F),Y=1/0,oe=[];$--;){var se=e[$];$&&t&&(se=We(se,mt(t))),Y=ot(se.length,Y),K[$]=!o&&(t||w>=120&&se.length>=120)?new gn($&&se):h}se=e[0];var ae=-1,fe=K[0];e:for(;++ae<w&&oe.length<Y;){var ge=se[ae],be=t?t(ge):ge;if(ge=o||ge!==0?ge:0,!(fe?ir(fe,be):v(oe,be,o))){for($=F;--$;){var Te=K[$];if(!(Te?ir(Te,be):v(e[$],be,o)))continue e}fe&&fe.push(be),oe.push(ge)}}return oe}function Oh(e,t,o,v){return Dt(e,function(w,F,$){t(v,o(w),F,$)}),v}function dr(e,t,o){t=sn(t,e),e=Hu(e,t);var v=e==null?e:e[Bt(Pt(t))];return v==null?h:vt(v,e,o)}function eu(e){return je(e)&&at(e)==B}function Sh(e){return je(e)&&at(e)==rr}function Eh(e){return je(e)&&at(e)==le}function hr(e,t,o,v,w){return e===t?!0:e==null||t==null||!je(e)&&!je(t)?e!==e&&t!==t:Rh(e,t,o,v,hr,w)}function Rh(e,t,o,v,w,F){var $=Oe(e),K=Oe(t),Y=$?V:st(e),oe=K?V:st(t);Y=Y==B?Be:Y,oe=oe==B?Be:oe;var se=Y==Be,ae=oe==Be,fe=Y==oe;if(fe&&un(e)){if(!un(t))return!1;$=!0,se=!1}if(fe&&!se)return F||(F=new xt),$||zn(e)?Lu(e,t,o,v,w,F):Zh(e,t,Y,o,v,w,F);if(!(o&a)){var ge=se&&Ue.call(e,"__wrapped__"),be=ae&&Ue.call(t,"__wrapped__");if(ge||be){var Te=ge?e.value():e,Ae=be?t.value():t;return F||(F=new xt),w(Te,Ae,o,v,F)}}return fe?(F||(F=new xt),Xh(e,t,o,v,w,F)):!1}function Th(e){return je(e)&&st(e)==de}function _o(e,t,o,v){var w=o.length,F=w,$=!v;if(e==null)return!F;for(e=Fe(e);w--;){var K=o[w];if($&&K[2]?K[1]!==e[K[0]]:!(K[0]in e))return!1}for(;++w<F;){K=o[w];var Y=K[0],oe=e[Y],se=K[1];if($&&K[2]){if(oe===h&&!(Y in e))return!1}else{var ae=new xt;if(v)var fe=v(oe,se,Y,e,t,ae);if(!(fe===h?hr(se,oe,a|E,v,ae):fe))return!1}}return!0}function tu(e){if(!ze(e)||up(e))return!1;var t=Vt(e)?Td:vf;return t.test(bn(e))}function Ih(e){return je(e)&&at(e)==Z}function _h(e){return je(e)&&st(e)==ie}function Ph(e){return je(e)&&Ci(e.length)&&!!He[at(e)]}function nu(e){return typeof e=="function"?e:e==null?pt:typeof e=="object"?Oe(e)?ou(e[0],e[1]):iu(e):El(e)}function Po(e){if(!vr(e))return xd(e);var t=[];for(var o in Fe(e))Ue.call(e,o)&&o!="constructor"&&t.push(o);return t}function wh(e){if(!ze(e))return dp(e);var t=vr(e),o=[];for(var v in e)v=="constructor"&&(t||!Ue.call(e,v))||o.push(v);return o}function wo(e,t){return e<t}function ru(e,t){var o=-1,v=dt(e)?ne(e.length):[];return rn(e,function(w,F,$){v[++o]=t(w,F,$)}),v}function iu(e){var t=jo(e);return t.length==1&&t[0][2]?Fu(t[0][0],t[0][1]):function(o){return o===e||_o(o,e,t)}}function ou(e,t){return Ko(e)&&Bu(t)?Fu(Bt(e),t):function(o){var v=rs(o,e);return v===h&&v===t?is(o,e):hr(t,v,a|E)}}function oi(e,t,o,v,w){e!==t&&Eo(t,function(F,$){if(w||(w=new xt),ze(F))Mh(e,t,$,o,oi,v,w);else{var K=v?v(qo(e,$),F,$+"",e,t,w):h;K===h&&(K=F),Oo(e,$,K)}},ht)}function Mh(e,t,o,v,w,F,$){var K=qo(e,o),Y=qo(t,o),oe=$.get(Y);if(oe){Oo(e,o,oe);return}var se=F?F(K,Y,o+"",e,t,$):h,ae=se===h;if(ae){var fe=Oe(Y),ge=!fe&&un(Y),be=!fe&&!ge&&zn(Y);se=Y,fe||ge||be?Oe(K)?se=K:Ve(K)?se=ft(K):ge?(ae=!1,se=mu(Y,!0)):be?(ae=!1,se=yu(Y,!0)):se=[]:yr(Y)||An(Y)?(se=K,An(K)?se=pl(K):(!ze(K)||Vt(K))&&(se=Uu(Y))):ae=!1}ae&&($.set(Y,se),w(se,Y,v,F,$),$.delete(Y)),Oo(e,o,se)}function su(e,t){var o=e.length;if(!!o)return t+=t<0?o:0,jt(t,o)?e[t]:h}function au(e,t,o){t.length?t=We(t,function(F){return Oe(F)?function($){return mn($,F.length===1?F[0]:F)}:F}):t=[pt];var v=-1;t=We(t,mt(ye()));var w=ru(e,function(F,$,K){var Y=We(t,function(oe){return oe(F)});return{criteria:Y,index:++v,value:F}});return id(w,function(F,$){return $h(F,$,o)})}function xh(e,t){return uu(e,t,function(o,v){return is(e,v)})}function uu(e,t,o){for(var v=-1,w=t.length,F={};++v<w;){var $=t[v],K=mn(e,$);o(K,$)&&pr(F,sn($,e),K)}return F}function Lh(e){return function(t){return mn(t,e)}}function Mo(e,t,o,v){var w=v?rd:Ln,F=-1,$=t.length,K=e;for(e===t&&(t=ft(t)),o&&(K=We(e,mt(o)));++F<$;)for(var Y=0,oe=t[F],se=o?o(oe):oe;(Y=w(K,se,Y,v))>-1;)K!==e&&qr.call(K,Y,1),qr.call(e,Y,1);return e}function lu(e,t){for(var o=e?t.length:0,v=o-1;o--;){var w=t[o];if(o==v||w!==F){var F=w;jt(w)?qr.call(e,w,1):Do(e,w)}}return e}function xo(e,t){return e+Zr(za()*(t-e+1))}function Nh(e,t,o,v){for(var w=-1,F=Xe(Yr((t-e)/(o||1)),0),$=ne(F);F--;)$[v?F:++w]=e,e+=o;return $}function Lo(e,t){var o="";if(!e||t<1||t>z)return o;do t%2&&(o+=e),t=Zr(t/2),t&&(e+=e);while(t);return o}function Ie(e,t){return Qo(Gu(e,t,pt),e+"")}function Dh(e){return Va($n(e))}function Uh(e,t){var o=$n(e);return gi(o,vn(t,0,o.length))}function pr(e,t,o,v){if(!ze(e))return e;t=sn(t,e);for(var w=-1,F=t.length,$=F-1,K=e;K!=null&&++w<F;){var Y=Bt(t[w]),oe=o;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return e;if(w!=$){var se=K[Y];oe=v?v(se,Y,K):h,oe===h&&(oe=ze(se)?se:jt(t[w+1])?[]:{})}cr(K,Y,oe),K=K[Y]}return e}var cu=Xr?function(e,t){return Xr.set(e,t),e}:pt,Bh=Qr?function(e,t){return Qr(e,"toString",{configurable:!0,enumerable:!1,value:ss(t),writable:!0})}:pt;function Fh(e){return gi($n(e))}function _t(e,t,o){var v=-1,w=e.length;t<0&&(t=-t>w?0:w+t),o=o>w?w:o,o<0&&(o+=w),w=t>o?0:o-t>>>0,t>>>=0;for(var F=ne(w);++v<w;)F[v]=e[v+t];return F}function Gh(e,t){var o;return rn(e,function(v,w,F){return o=t(v,w,F),!o}),!!o}function si(e,t,o){var v=0,w=e==null?v:e.length;if(typeof t=="number"&&t===t&&w<=G){for(;v<w;){var F=v+w>>>1,$=e[F];$!==null&&!bt($)&&(o?$<=t:$<t)?v=F+1:w=F}return w}return No(e,t,pt,o)}function No(e,t,o,v){var w=0,F=e==null?0:e.length;if(F===0)return 0;t=o(t);for(var $=t!==t,K=t===null,Y=bt(t),oe=t===h;w<F;){var se=Zr((w+F)/2),ae=o(e[se]),fe=ae!==h,ge=ae===null,be=ae===ae,Te=bt(ae);if($)var Ae=v||be;else oe?Ae=be&&(v||fe):K?Ae=be&&fe&&(v||!ge):Y?Ae=be&&fe&&!ge&&(v||!Te):ge||Te?Ae=!1:Ae=v?ae<=t:ae<t;Ae?w=se+1:F=se}return ot(F,Q)}function fu(e,t){for(var o=-1,v=e.length,w=0,F=[];++o<v;){var $=e[o],K=t?t($):$;if(!o||!Lt(K,Y)){var Y=K;F[w++]=$===0?0:$}}return F}function du(e){return typeof e=="number"?e:bt(e)?J:+e}function yt(e){if(typeof e=="string")return e;if(Oe(e))return We(e,yt)+"";if(bt(e))return $a?$a.call(e):"";var t=e+"";return t=="0"&&1/e==-x?"-0":t}function on(e,t,o){var v=-1,w=Gr,F=e.length,$=!0,K=[],Y=K;if(o)$=!1,w=uo;else if(F>=n){var oe=t?null:Qh(e);if(oe)return kr(oe);$=!1,w=ir,Y=new gn}else Y=t?[]:K;e:for(;++v<F;){var se=e[v],ae=t?t(se):se;if(se=o||se!==0?se:0,$&&ae===ae){for(var fe=Y.length;fe--;)if(Y[fe]===ae)continue e;t&&Y.push(ae),K.push(se)}else w(Y,ae,o)||(Y!==K&&Y.push(ae),K.push(se))}return K}function Do(e,t){return t=sn(t,e),e=Hu(e,t),e==null||delete e[Bt(Pt(t))]}function hu(e,t,o,v){return pr(e,t,o(mn(e,t)),v)}function ai(e,t,o,v){for(var w=e.length,F=v?w:-1;(v?F--:++F<w)&&t(e[F],F,e););return o?_t(e,v?0:F,v?F+1:w):_t(e,v?F+1:0,v?w:F)}function pu(e,t){var o=e;return o instanceof we&&(o=o.value()),lo(t,function(v,w){return w.func.apply(w.thisArg,Xt([v],w.args))},o)}function Uo(e,t,o){var v=e.length;if(v<2)return v?on(e[0]):[];for(var w=-1,F=ne(v);++w<v;)for(var $=e[w],K=-1;++K<v;)K!=w&&(F[w]=fr(F[w]||$,e[K],t,o));return on(it(F,1),t,o)}function gu(e,t,o){for(var v=-1,w=e.length,F=t.length,$={};++v<w;){var K=v<F?t[v]:h;o($,e[v],K)}return $}function Bo(e){return Ve(e)?e:[]}function Fo(e){return typeof e=="function"?e:pt}function sn(e,t){return Oe(e)?e:Ko(e,t)?[e]:$u(De(e))}var Hh=Ie;function an(e,t,o){var v=e.length;return o=o===h?v:o,!t&&o>=v?e:_t(e,t,o)}var vu=Id||function(e){return tt.clearTimeout(e)};function mu(e,t){if(t)return e.slice();var o=e.length,v=Fa?Fa(o):new e.constructor(o);return e.copy(v),v}function Go(e){var t=new e.constructor(e.byteLength);return new Kr(t).set(new Kr(e)),t}function kh(e,t){var o=t?Go(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Wh(e){var t=new e.constructor(e.source,ea.exec(e));return t.lastIndex=e.lastIndex,t}function zh(e){return lr?Fe(lr.call(e)):{}}function yu(e,t){var o=t?Go(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function bu(e,t){if(e!==t){var o=e!==h,v=e===null,w=e===e,F=bt(e),$=t!==h,K=t===null,Y=t===t,oe=bt(t);if(!K&&!oe&&!F&&e>t||F&&$&&Y&&!K&&!oe||v&&$&&Y||!o&&Y||!w)return 1;if(!v&&!F&&!oe&&e<t||oe&&o&&w&&!v&&!F||K&&o&&w||!$&&w||!Y)return-1}return 0}function $h(e,t,o){for(var v=-1,w=e.criteria,F=t.criteria,$=w.length,K=o.length;++v<$;){var Y=bu(w[v],F[v]);if(Y){if(v>=K)return Y;var oe=o[v];return Y*(oe=="desc"?-1:1)}}return e.index-t.index}function Au(e,t,o,v){for(var w=-1,F=e.length,$=o.length,K=-1,Y=t.length,oe=Xe(F-$,0),se=ne(Y+oe),ae=!v;++K<Y;)se[K]=t[K];for(;++w<$;)(ae||w<F)&&(se[o[w]]=e[w]);for(;oe--;)se[K++]=e[w++];return se}function Cu(e,t,o,v){for(var w=-1,F=e.length,$=-1,K=o.length,Y=-1,oe=t.length,se=Xe(F-K,0),ae=ne(se+oe),fe=!v;++w<se;)ae[w]=e[w];for(var ge=w;++Y<oe;)ae[ge+Y]=t[Y];for(;++$<K;)(fe||w<F)&&(ae[ge+o[$]]=e[w++]);return ae}function ft(e,t){var o=-1,v=e.length;for(t||(t=ne(v));++o<v;)t[o]=e[o];return t}function Ut(e,t,o,v){var w=!o;o||(o={});for(var F=-1,$=t.length;++F<$;){var K=t[F],Y=v?v(o[K],e[K],K,o,e):h;Y===h&&(Y=e[K]),w?Wt(o,K,Y):cr(o,K,Y)}return o}function jh(e,t){return Ut(e,Vo(e),t)}function Vh(e,t){return Ut(e,Nu(e),t)}function ui(e,t){return function(o,v){var w=Oe(o)?Yf:ph,F=t?t():{};return w(o,e,ye(v,2),F)}}function Hn(e){return Ie(function(t,o){var v=-1,w=o.length,F=w>1?o[w-1]:h,$=w>2?o[2]:h;for(F=e.length>3&&typeof F=="function"?(w--,F):h,$&&ut(o[0],o[1],$)&&(F=w<3?h:F,w=1),t=Fe(t);++v<w;){var K=o[v];K&&e(t,K,v,F)}return t})}function Ou(e,t){return function(o,v){if(o==null)return o;if(!dt(o))return e(o,v);for(var w=o.length,F=t?w:-1,$=Fe(o);(t?F--:++F<w)&&v($[F],F,$)!==!1;);return o}}function Su(e){return function(t,o,v){for(var w=-1,F=Fe(t),$=v(t),K=$.length;K--;){var Y=$[e?K:++w];if(o(F[Y],Y,F)===!1)break}return t}}function Kh(e,t,o){var v=t&M,w=gr(e);function F(){var $=this&&this!==tt&&this instanceof F?w:e;return $.apply(v?o:this,arguments)}return F}function Eu(e){return function(t){t=De(t);var o=Nn(t)?Mt(t):h,v=o?o[0]:t.charAt(0),w=o?an(o,1).join(""):t.slice(1);return v[e]()+w}}function kn(e){return function(t){return lo(Ol(Cl(t).replace(Bf,"")),e,"")}}function gr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var o=Gn(e.prototype),v=e.apply(o,t);return ze(v)?v:o}}function Jh(e,t,o){var v=gr(e);function w(){for(var F=arguments.length,$=ne(F),K=F,Y=Wn(w);K--;)$[K]=arguments[K];var oe=F<3&&$[0]!==Y&&$[F-1]!==Y?[]:en($,Y);if(F-=oe.length,F<o)return Pu(e,t,li,w.placeholder,h,$,oe,h,h,o-F);var se=this&&this!==tt&&this instanceof w?v:e;return vt(se,this,$)}return w}function Ru(e){return function(t,o,v){var w=Fe(t);if(!dt(t)){var F=ye(o,3);t=nt(t),o=function(K){return F(w[K],K,w)}}var $=e(t,o,v);return $>-1?w[F?t[$]:$]:h}}function Tu(e){return $t(function(t){var o=t.length,v=o,w=Tt.prototype.thru;for(e&&t.reverse();v--;){var F=t[v];if(typeof F!="function")throw new Rt(i);if(w&&!$&&hi(F)=="wrapper")var $=new Tt([],!0)}for(v=$?v:o;++v<o;){F=t[v];var K=hi(F),Y=K=="wrapper"?$o(F):h;Y&&Jo(Y[0])&&Y[1]==(d|b|c|p)&&!Y[4].length&&Y[9]==1?$=$[hi(Y[0])].apply($,Y[3]):$=F.length==1&&Jo(F)?$[K]():$.thru(F)}return function(){var oe=arguments,se=oe[0];if($&&oe.length==1&&Oe(se))return $.plant(se).value();for(var ae=0,fe=o?t[ae].apply(this,oe):se;++ae<o;)fe=t[ae].call(this,fe);return fe}})}function li(e,t,o,v,w,F,$,K,Y,oe){var se=t&d,ae=t&M,fe=t&P,ge=t&(b|T),be=t&u,Te=fe?h:gr(e);function Ae(){for(var Pe=arguments.length,Me=ne(Pe),At=Pe;At--;)Me[At]=arguments[At];if(ge)var lt=Wn(Ae),Ct=sd(Me,lt);if(v&&(Me=Au(Me,v,w,ge)),F&&(Me=Cu(Me,F,$,ge)),Pe-=Ct,ge&&Pe<oe){var Ke=en(Me,lt);return Pu(e,t,li,Ae.placeholder,o,Me,Ke,K,Y,oe-Pe)}var Nt=ae?o:this,Jt=fe?Nt[e]:e;return Pe=Me.length,K?Me=pp(Me,K):be&&Pe>1&&Me.reverse(),se&&Y<Pe&&(Me.length=Y),this&&this!==tt&&this instanceof Ae&&(Jt=Te||gr(Jt)),Jt.apply(Nt,Me)}return Ae}function Iu(e,t){return function(o,v){return Oh(o,e,t(v),{})}}function ci(e,t){return function(o,v){var w;if(o===h&&v===h)return t;if(o!==h&&(w=o),v!==h){if(w===h)return v;typeof o=="string"||typeof v=="string"?(o=yt(o),v=yt(v)):(o=du(o),v=du(v)),w=e(o,v)}return w}}function Ho(e){return $t(function(t){return t=We(t,mt(ye())),Ie(function(o){var v=this;return e(t,function(w){return vt(w,v,o)})})})}function fi(e,t){t=t===h?" ":yt(t);var o=t.length;if(o<2)return o?Lo(t,e):t;var v=Lo(t,Yr(e/Dn(t)));return Nn(t)?an(Mt(v),0,e).join(""):v.slice(0,e)}function qh(e,t,o,v){var w=t&M,F=gr(e);function $(){for(var K=-1,Y=arguments.length,oe=-1,se=v.length,ae=ne(se+Y),fe=this&&this!==tt&&this instanceof $?F:e;++oe<se;)ae[oe]=v[oe];for(;Y--;)ae[oe++]=arguments[++K];return vt(fe,w?o:this,ae)}return $}function _u(e){return function(t,o,v){return v&&typeof v!="number"&&ut(t,o,v)&&(o=v=h),t=Kt(t),o===h?(o=t,t=0):o=Kt(o),v=v===h?t<o?1:-1:Kt(v),Nh(t,o,v,e)}}function di(e){return function(t,o){return typeof t=="string"&&typeof o=="string"||(t=wt(t),o=wt(o)),e(t,o)}}function Pu(e,t,o,v,w,F,$,K,Y,oe){var se=t&b,ae=se?$:h,fe=se?h:$,ge=se?F:h,be=se?h:F;t|=se?c:g,t&=~(se?g:c),t&O||(t&=~(M|P));var Te=[e,t,w,ge,ae,be,fe,K,Y,oe],Ae=o.apply(h,Te);return Jo(e)&&ku(Ae,Te),Ae.placeholder=v,Wu(Ae,e,t)}function ko(e){var t=Ze[e];return function(o,v){if(o=wt(o),v=v==null?0:ot(Ee(v),292),v&&Wa(o)){var w=(De(o)+"e").split("e"),F=t(w[0]+"e"+(+w[1]+v));return w=(De(F)+"e").split("e"),+(w[0]+"e"+(+w[1]-v))}return t(o)}}var Qh=Bn&&1/kr(new Bn([,-0]))[1]==x?function(e){return new Bn(e)}:ls;function wu(e){return function(t){var o=st(t);return o==de?mo(t):o==ie?hd(t):od(t,e(t))}}function zt(e,t,o,v,w,F,$,K){var Y=t&P;if(!Y&&typeof e!="function")throw new Rt(i);var oe=v?v.length:0;if(oe||(t&=~(c|g),v=w=h),$=$===h?$:Xe(Ee($),0),K=K===h?K:Ee(K),oe-=w?w.length:0,t&g){var se=v,ae=w;v=w=h}var fe=Y?h:$o(e),ge=[e,t,o,v,w,se,ae,F,$,K];if(fe&&fp(ge,fe),e=ge[0],t=ge[1],o=ge[2],v=ge[3],w=ge[4],K=ge[9]=ge[9]===h?Y?0:e.length:Xe(ge[9]-oe,0),!K&&t&(b|T)&&(t&=~(b|T)),!t||t==M)var be=Kh(e,t,o);else t==b||t==T?be=Jh(e,t,K):(t==c||t==(M|c))&&!w.length?be=qh(e,t,o,v):be=li.apply(h,ge);var Te=fe?cu:ku;return Wu(Te(be,ge),e,t)}function Mu(e,t,o,v){return e===h||Lt(e,Un[o])&&!Ue.call(v,o)?t:e}function xu(e,t,o,v,w,F){return ze(e)&&ze(t)&&(F.set(t,e),oi(e,t,h,xu,F),F.delete(t)),e}function Yh(e){return yr(e)?h:e}function Lu(e,t,o,v,w,F){var $=o&a,K=e.length,Y=t.length;if(K!=Y&&!($&&Y>K))return!1;var oe=F.get(e),se=F.get(t);if(oe&&se)return oe==t&&se==e;var ae=-1,fe=!0,ge=o&E?new gn:h;for(F.set(e,t),F.set(t,e);++ae<K;){var be=e[ae],Te=t[ae];if(v)var Ae=$?v(Te,be,ae,t,e,F):v(be,Te,ae,e,t,F);if(Ae!==h){if(Ae)continue;fe=!1;break}if(ge){if(!co(t,function(Pe,Me){if(!ir(ge,Me)&&(be===Pe||w(be,Pe,o,v,F)))return ge.push(Me)})){fe=!1;break}}else if(!(be===Te||w(be,Te,o,v,F))){fe=!1;break}}return F.delete(e),F.delete(t),fe}function Zh(e,t,o,v,w,F,$){switch(o){case Mn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rr:return!(e.byteLength!=t.byteLength||!F(new Kr(e),new Kr(t)));case te:case le:case xe:return Lt(+e,+t);case ve:return e.name==t.name&&e.message==t.message;case Z:case ue:return e==t+"";case de:var K=mo;case ie:var Y=v&a;if(K||(K=kr),e.size!=t.size&&!Y)return!1;var oe=$.get(e);if(oe)return oe==t;v|=E,$.set(e,t);var se=Lu(K(e),K(t),v,w,F,$);return $.delete(e),se;case pe:if(lr)return lr.call(e)==lr.call(t)}return!1}function Xh(e,t,o,v,w,F){var $=o&a,K=Wo(e),Y=K.length,oe=Wo(t),se=oe.length;if(Y!=se&&!$)return!1;for(var ae=Y;ae--;){var fe=K[ae];if(!($?fe in t:Ue.call(t,fe)))return!1}var ge=F.get(e),be=F.get(t);if(ge&&be)return ge==t&&be==e;var Te=!0;F.set(e,t),F.set(t,e);for(var Ae=$;++ae<Y;){fe=K[ae];var Pe=e[fe],Me=t[fe];if(v)var At=$?v(Me,Pe,fe,t,e,F):v(Pe,Me,fe,e,t,F);if(!(At===h?Pe===Me||w(Pe,Me,o,v,F):At)){Te=!1;break}Ae||(Ae=fe=="constructor")}if(Te&&!Ae){var lt=e.constructor,Ct=t.constructor;lt!=Ct&&"constructor"in e&&"constructor"in t&&!(typeof lt=="function"&&lt instanceof lt&&typeof Ct=="function"&&Ct instanceof Ct)&&(Te=!1)}return F.delete(e),F.delete(t),Te}function $t(e){return Qo(Gu(e,h,Ju),e+"")}function Wo(e){return Xa(e,nt,Vo)}function zo(e){return Xa(e,ht,Nu)}var $o=Xr?function(e){return Xr.get(e)}:ls;function hi(e){for(var t=e.name+"",o=Fn[t],v=Ue.call(Fn,t)?o.length:0;v--;){var w=o[v],F=w.func;if(F==null||F==e)return w.name}return t}function Wn(e){var t=Ue.call(N,"placeholder")?N:e;return t.placeholder}function ye(){var e=N.iteratee||as;return e=e===as?nu:e,arguments.length?e(arguments[0],arguments[1]):e}function pi(e,t){var o=e.__data__;return ap(t)?o[typeof t=="string"?"string":"hash"]:o.map}function jo(e){for(var t=nt(e),o=t.length;o--;){var v=t[o],w=e[v];t[o]=[v,w,Bu(w)]}return t}function yn(e,t){var o=cd(e,t);return tu(o)?o:h}function ep(e){var t=Ue.call(e,hn),o=e[hn];try{e[hn]=h;var v=!0}catch(F){}var w=jr.call(e);return v&&(t?e[hn]=o:delete e[hn]),w}var Vo=bo?function(e){return e==null?[]:(e=Fe(e),Zt(bo(e),function(t){return Ha.call(e,t)}))}:cs,Nu=bo?function(e){for(var t=[];e;)Xt(t,Vo(e)),e=Jr(e);return t}:cs,st=at;(Ao&&st(new Ao(new ArrayBuffer(1)))!=Mn||sr&&st(new sr)!=de||Co&&st(Co.resolve())!=ke||Bn&&st(new Bn)!=ie||ar&&st(new ar)!=Qe)&&(st=function(e){var t=at(e),o=t==Be?e.constructor:h,v=o?bn(o):"";if(v)switch(v){case Ud:return Mn;case Bd:return de;case Fd:return ke;case Gd:return ie;case Hd:return Qe}return t});function tp(e,t,o){for(var v=-1,w=o.length;++v<w;){var F=o[v],$=F.size;switch(F.type){case"drop":e+=$;break;case"dropRight":t-=$;break;case"take":t=ot(t,e+$);break;case"takeRight":e=Xe(e,t-$);break}}return{start:e,end:t}}function np(e){var t=e.match(uf);return t?t[1].split(lf):[]}function Du(e,t,o){t=sn(t,e);for(var v=-1,w=t.length,F=!1;++v<w;){var $=Bt(t[v]);if(!(F=e!=null&&o(e,$)))break;e=e[$]}return F||++v!=w?F:(w=e==null?0:e.length,!!w&&Ci(w)&&jt($,w)&&(Oe(e)||An(e)))}function rp(e){var t=e.length,o=new e.constructor(t);return t&&typeof e[0]=="string"&&Ue.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Uu(e){return typeof e.constructor=="function"&&!vr(e)?Gn(Jr(e)):{}}function ip(e,t,o){var v=e.constructor;switch(t){case rr:return Go(e);case te:case le:return new v(+e);case Mn:return kh(e,o);case $i:case ji:case Vi:case Ki:case Ji:case qi:case Qi:case Yi:case Zi:return yu(e,o);case de:return new v;case xe:case ue:return new v(e);case Z:return Wh(e);case ie:return new v;case pe:return zh(e)}}function op(e,t){var o=t.length;if(!o)return e;var v=o-1;return t[v]=(o>1?"& ":"")+t[v],t=t.join(o>2?", ":" "),e.replace(af,`{
/* [wrapped with `+t+`] */
`)}function sp(e){return Oe(e)||An(e)||!!(ka&&e&&e[ka])}function jt(e,t){var o=typeof e;return t=t==null?z:t,!!t&&(o=="number"||o!="symbol"&&yf.test(e))&&e>-1&&e%1==0&&e<t}function ut(e,t,o){if(!ze(o))return!1;var v=typeof t;return(v=="number"?dt(o)&&jt(t,o.length):v=="string"&&t in o)?Lt(o[t],e):!1}function Ko(e,t){if(Oe(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||bt(e)?!0:nf.test(e)||!tf.test(e)||t!=null&&e in Fe(t)}function ap(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Jo(e){var t=hi(e),o=N[t];if(typeof o!="function"||!(t in we.prototype))return!1;if(e===o)return!0;var v=$o(o);return!!v&&e===v[0]}function up(e){return!!Ba&&Ba in e}var lp=zr?Vt:fs;function vr(e){var t=e&&e.constructor,o=typeof t=="function"&&t.prototype||Un;return e===o}function Bu(e){return e===e&&!ze(e)}function Fu(e,t){return function(o){return o==null?!1:o[e]===t&&(t!==h||e in Fe(o))}}function cp(e){var t=bi(e,function(v){return o.size===l&&o.clear(),v}),o=t.cache;return t}function fp(e,t){var o=e[1],v=t[1],w=o|v,F=w<(M|P|d),$=v==d&&o==b||v==d&&o==p&&e[7].length<=t[8]||v==(d|p)&&t[7].length<=t[8]&&o==b;if(!(F||$))return e;v&M&&(e[2]=t[2],w|=o&M?0:O);var K=t[3];if(K){var Y=e[3];e[3]=Y?Au(Y,K,t[4]):K,e[4]=Y?en(e[3],f):t[4]}return K=t[5],K&&(Y=e[5],e[5]=Y?Cu(Y,K,t[6]):K,e[6]=Y?en(e[5],f):t[6]),K=t[7],K&&(e[7]=K),v&d&&(e[8]=e[8]==null?t[8]:ot(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=w,e}function dp(e){var t=[];if(e!=null)for(var o in Fe(e))t.push(o);return t}function hp(e){return jr.call(e)}function Gu(e,t,o){return t=Xe(t===h?e.length-1:t,0),function(){for(var v=arguments,w=-1,F=Xe(v.length-t,0),$=ne(F);++w<F;)$[w]=v[t+w];w=-1;for(var K=ne(t+1);++w<t;)K[w]=v[w];return K[t]=o($),vt(e,this,K)}}function Hu(e,t){return t.length<2?e:mn(e,_t(t,0,-1))}function pp(e,t){for(var o=e.length,v=ot(t.length,o),w=ft(e);v--;){var F=t[v];e[v]=jt(F,o)?w[F]:h}return e}function qo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var ku=zu(cu),mr=Pd||function(e,t){return tt.setTimeout(e,t)},Qo=zu(Bh);function Wu(e,t,o){var v=t+"";return Qo(e,op(v,gp(np(v),o)))}function zu(e){var t=0,o=0;return function(){var v=Ld(),w=W-(v-o);if(o=v,w>0){if(++t>=L)return arguments[0]}else t=0;return e.apply(h,arguments)}}function gi(e,t){var o=-1,v=e.length,w=v-1;for(t=t===h?v:t;++o<t;){var F=xo(o,w),$=e[F];e[F]=e[o],e[o]=$}return e.length=t,e}var $u=cp(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rf,function(o,v,w,F){t.push(w?F.replace(df,"$1"):v||o)}),t});function Bt(e){if(typeof e=="string"||bt(e))return e;var t=e+"";return t=="0"&&1/e==-x?"-0":t}function bn(e){if(e!=null){try{return $r.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function gp(e,t){return Et(D,function(o){var v="_."+o[0];t&o[1]&&!Gr(e,v)&&e.push(v)}),e.sort()}function ju(e){if(e instanceof we)return e.clone();var t=new Tt(e.__wrapped__,e.__chain__);return t.__actions__=ft(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function vp(e,t,o){(o?ut(e,t,o):t===h)?t=1:t=Xe(Ee(t),0);var v=e==null?0:e.length;if(!v||t<1)return[];for(var w=0,F=0,$=ne(Yr(v/t));w<v;)$[F++]=_t(e,w,w+=t);return $}function mp(e){for(var t=-1,o=e==null?0:e.length,v=0,w=[];++t<o;){var F=e[t];F&&(w[v++]=F)}return w}function yp(){var e=arguments.length;if(!e)return[];for(var t=ne(e-1),o=arguments[0],v=e;v--;)t[v-1]=arguments[v];return Xt(Oe(o)?ft(o):[o],it(t,1))}var bp=Ie(function(e,t){return Ve(e)?fr(e,it(t,1,Ve,!0)):[]}),Ap=Ie(function(e,t){var o=Pt(t);return Ve(o)&&(o=h),Ve(e)?fr(e,it(t,1,Ve,!0),ye(o,2)):[]}),Cp=Ie(function(e,t){var o=Pt(t);return Ve(o)&&(o=h),Ve(e)?fr(e,it(t,1,Ve,!0),h,o):[]});function Op(e,t,o){var v=e==null?0:e.length;return v?(t=o||t===h?1:Ee(t),_t(e,t<0?0:t,v)):[]}function Sp(e,t,o){var v=e==null?0:e.length;return v?(t=o||t===h?1:Ee(t),t=v-t,_t(e,0,t<0?0:t)):[]}function Ep(e,t){return e&&e.length?ai(e,ye(t,3),!0,!0):[]}function Rp(e,t){return e&&e.length?ai(e,ye(t,3),!0):[]}function Tp(e,t,o,v){var w=e==null?0:e.length;return w?(o&&typeof o!="number"&&ut(e,t,o)&&(o=0,v=w),yh(e,t,o,v)):[]}function Vu(e,t,o){var v=e==null?0:e.length;if(!v)return-1;var w=o==null?0:Ee(o);return w<0&&(w=Xe(v+w,0)),Hr(e,ye(t,3),w)}function Ku(e,t,o){var v=e==null?0:e.length;if(!v)return-1;var w=v-1;return o!==h&&(w=Ee(o),w=o<0?Xe(v+w,0):ot(w,v-1)),Hr(e,ye(t,3),w,!0)}function Ju(e){var t=e==null?0:e.length;return t?it(e,1):[]}function Ip(e){var t=e==null?0:e.length;return t?it(e,x):[]}function _p(e,t){var o=e==null?0:e.length;return o?(t=t===h?1:Ee(t),it(e,t)):[]}function Pp(e){for(var t=-1,o=e==null?0:e.length,v={};++t<o;){var w=e[t];v[w[0]]=w[1]}return v}function qu(e){return e&&e.length?e[0]:h}function wp(e,t,o){var v=e==null?0:e.length;if(!v)return-1;var w=o==null?0:Ee(o);return w<0&&(w=Xe(v+w,0)),Ln(e,t,w)}function Mp(e){var t=e==null?0:e.length;return t?_t(e,0,-1):[]}var xp=Ie(function(e){var t=We(e,Bo);return t.length&&t[0]===e[0]?Io(t):[]}),Lp=Ie(function(e){var t=Pt(e),o=We(e,Bo);return t===Pt(o)?t=h:o.pop(),o.length&&o[0]===e[0]?Io(o,ye(t,2)):[]}),Np=Ie(function(e){var t=Pt(e),o=We(e,Bo);return t=typeof t=="function"?t:h,t&&o.pop(),o.length&&o[0]===e[0]?Io(o,h,t):[]});function Dp(e,t){return e==null?"":Md.call(e,t)}function Pt(e){var t=e==null?0:e.length;return t?e[t-1]:h}function Up(e,t,o){var v=e==null?0:e.length;if(!v)return-1;var w=v;return o!==h&&(w=Ee(o),w=w<0?Xe(v+w,0):ot(w,v-1)),t===t?gd(e,t,w):Hr(e,Pa,w,!0)}function Bp(e,t){return e&&e.length?su(e,Ee(t)):h}var Fp=Ie(Qu);function Qu(e,t){return e&&e.length&&t&&t.length?Mo(e,t):e}function Gp(e,t,o){return e&&e.length&&t&&t.length?Mo(e,t,ye(o,2)):e}function Hp(e,t,o){return e&&e.length&&t&&t.length?Mo(e,t,h,o):e}var kp=$t(function(e,t){var o=e==null?0:e.length,v=So(e,t);return lu(e,We(t,function(w){return jt(w,o)?+w:w}).sort(bu)),v});function Wp(e,t){var o=[];if(!(e&&e.length))return o;var v=-1,w=[],F=e.length;for(t=ye(t,3);++v<F;){var $=e[v];t($,v,e)&&(o.push($),w.push(v))}return lu(e,w),o}function Yo(e){return e==null?e:Dd.call(e)}function zp(e,t,o){var v=e==null?0:e.length;return v?(o&&typeof o!="number"&&ut(e,t,o)?(t=0,o=v):(t=t==null?0:Ee(t),o=o===h?v:Ee(o)),_t(e,t,o)):[]}function $p(e,t){return si(e,t)}function jp(e,t,o){return No(e,t,ye(o,2))}function Vp(e,t){var o=e==null?0:e.length;if(o){var v=si(e,t);if(v<o&&Lt(e[v],t))return v}return-1}function Kp(e,t){return si(e,t,!0)}function Jp(e,t,o){return No(e,t,ye(o,2),!0)}function qp(e,t){var o=e==null?0:e.length;if(o){var v=si(e,t,!0)-1;if(Lt(e[v],t))return v}return-1}function Qp(e){return e&&e.length?fu(e):[]}function Yp(e,t){return e&&e.length?fu(e,ye(t,2)):[]}function Zp(e){var t=e==null?0:e.length;return t?_t(e,1,t):[]}function Xp(e,t,o){return e&&e.length?(t=o||t===h?1:Ee(t),_t(e,0,t<0?0:t)):[]}function eg(e,t,o){var v=e==null?0:e.length;return v?(t=o||t===h?1:Ee(t),t=v-t,_t(e,t<0?0:t,v)):[]}function tg(e,t){return e&&e.length?ai(e,ye(t,3),!1,!0):[]}function ng(e,t){return e&&e.length?ai(e,ye(t,3)):[]}var rg=Ie(function(e){return on(it(e,1,Ve,!0))}),ig=Ie(function(e){var t=Pt(e);return Ve(t)&&(t=h),on(it(e,1,Ve,!0),ye(t,2))}),og=Ie(function(e){var t=Pt(e);return t=typeof t=="function"?t:h,on(it(e,1,Ve,!0),h,t)});function sg(e){return e&&e.length?on(e):[]}function ag(e,t){return e&&e.length?on(e,ye(t,2)):[]}function ug(e,t){return t=typeof t=="function"?t:h,e&&e.length?on(e,h,t):[]}function Zo(e){if(!(e&&e.length))return[];var t=0;return e=Zt(e,function(o){if(Ve(o))return t=Xe(o.length,t),!0}),go(t,function(o){return We(e,fo(o))})}function Yu(e,t){if(!(e&&e.length))return[];var o=Zo(e);return t==null?o:We(o,function(v){return vt(t,h,v)})}var lg=Ie(function(e,t){return Ve(e)?fr(e,t):[]}),cg=Ie(function(e){return Uo(Zt(e,Ve))}),fg=Ie(function(e){var t=Pt(e);return Ve(t)&&(t=h),Uo(Zt(e,Ve),ye(t,2))}),dg=Ie(function(e){var t=Pt(e);return t=typeof t=="function"?t:h,Uo(Zt(e,Ve),h,t)}),hg=Ie(Zo);function pg(e,t){return gu(e||[],t||[],cr)}function gg(e,t){return gu(e||[],t||[],pr)}var vg=Ie(function(e){var t=e.length,o=t>1?e[t-1]:h;return o=typeof o=="function"?(e.pop(),o):h,Yu(e,o)});function Zu(e){var t=N(e);return t.__chain__=!0,t}function mg(e,t){return t(e),e}function vi(e,t){return t(e)}var yg=$t(function(e){var t=e.length,o=t?e[0]:0,v=this.__wrapped__,w=function(F){return So(F,e)};return t>1||this.__actions__.length||!(v instanceof we)||!jt(o)?this.thru(w):(v=v.slice(o,+o+(t?1:0)),v.__actions__.push({func:vi,args:[w],thisArg:h}),new Tt(v,this.__chain__).thru(function(F){return t&&!F.length&&F.push(h),F}))});function bg(){return Zu(this)}function Ag(){return new Tt(this.value(),this.__chain__)}function Cg(){this.__values__===h&&(this.__values__=dl(this.value()));var e=this.__index__>=this.__values__.length,t=e?h:this.__values__[this.__index__++];return{done:e,value:t}}function Og(){return this}function Sg(e){for(var t,o=this;o instanceof ti;){var v=ju(o);v.__index__=0,v.__values__=h,t?w.__wrapped__=v:t=v;var w=v;o=o.__wrapped__}return w.__wrapped__=e,t}function Eg(){var e=this.__wrapped__;if(e instanceof we){var t=e;return this.__actions__.length&&(t=new we(this)),t=t.reverse(),t.__actions__.push({func:vi,args:[Yo],thisArg:h}),new Tt(t,this.__chain__)}return this.thru(Yo)}function Rg(){return pu(this.__wrapped__,this.__actions__)}var Tg=ui(function(e,t,o){Ue.call(e,o)?++e[o]:Wt(e,o,1)});function Ig(e,t,o){var v=Oe(e)?Ia:mh;return o&&ut(e,t,o)&&(t=h),v(e,ye(t,3))}function _g(e,t){var o=Oe(e)?Zt:Ya;return o(e,ye(t,3))}var Pg=Ru(Vu),wg=Ru(Ku);function Mg(e,t){return it(mi(e,t),1)}function xg(e,t){return it(mi(e,t),x)}function Lg(e,t,o){return o=o===h?1:Ee(o),it(mi(e,t),o)}function Xu(e,t){var o=Oe(e)?Et:rn;return o(e,ye(t,3))}function el(e,t){var o=Oe(e)?Zf:Qa;return o(e,ye(t,3))}var Ng=ui(function(e,t,o){Ue.call(e,o)?e[o].push(t):Wt(e,o,[t])});function Dg(e,t,o,v){e=dt(e)?e:$n(e),o=o&&!v?Ee(o):0;var w=e.length;return o<0&&(o=Xe(w+o,0)),Oi(e)?o<=w&&e.indexOf(t,o)>-1:!!w&&Ln(e,t,o)>-1}var Ug=Ie(function(e,t,o){var v=-1,w=typeof t=="function",F=dt(e)?ne(e.length):[];return rn(e,function($){F[++v]=w?vt(t,$,o):dr($,t,o)}),F}),Bg=ui(function(e,t,o){Wt(e,o,t)});function mi(e,t){var o=Oe(e)?We:ru;return o(e,ye(t,3))}function Fg(e,t,o,v){return e==null?[]:(Oe(t)||(t=t==null?[]:[t]),o=v?h:o,Oe(o)||(o=o==null?[]:[o]),au(e,t,o))}var Gg=ui(function(e,t,o){e[o?0:1].push(t)},function(){return[[],[]]});function Hg(e,t,o){var v=Oe(e)?lo:Ma,w=arguments.length<3;return v(e,ye(t,4),o,w,rn)}function kg(e,t,o){var v=Oe(e)?Xf:Ma,w=arguments.length<3;return v(e,ye(t,4),o,w,Qa)}function Wg(e,t){var o=Oe(e)?Zt:Ya;return o(e,Ai(ye(t,3)))}function zg(e){var t=Oe(e)?Va:Dh;return t(e)}function $g(e,t,o){(o?ut(e,t,o):t===h)?t=1:t=Ee(t);var v=Oe(e)?dh:Uh;return v(e,t)}function jg(e){var t=Oe(e)?hh:Fh;return t(e)}function Vg(e){if(e==null)return 0;if(dt(e))return Oi(e)?Dn(e):e.length;var t=st(e);return t==de||t==ie?e.size:Po(e).length}function Kg(e,t,o){var v=Oe(e)?co:Gh;return o&&ut(e,t,o)&&(t=h),v(e,ye(t,3))}var Jg=Ie(function(e,t){if(e==null)return[];var o=t.length;return o>1&&ut(e,t[0],t[1])?t=[]:o>2&&ut(t[0],t[1],t[2])&&(t=[t[0]]),au(e,it(t,1),[])}),yi=_d||function(){return tt.Date.now()};function qg(e,t){if(typeof t!="function")throw new Rt(i);return e=Ee(e),function(){if(--e<1)return t.apply(this,arguments)}}function tl(e,t,o){return t=o?h:t,t=e&&t==null?e.length:t,zt(e,d,h,h,h,h,t)}function nl(e,t){var o;if(typeof t!="function")throw new Rt(i);return e=Ee(e),function(){return--e>0&&(o=t.apply(this,arguments)),e<=1&&(t=h),o}}var Xo=Ie(function(e,t,o){var v=M;if(o.length){var w=en(o,Wn(Xo));v|=c}return zt(e,v,t,o,w)}),rl=Ie(function(e,t,o){var v=M|P;if(o.length){var w=en(o,Wn(rl));v|=c}return zt(t,v,e,o,w)});function il(e,t,o){t=o?h:t;var v=zt(e,b,h,h,h,h,h,t);return v.placeholder=il.placeholder,v}function ol(e,t,o){t=o?h:t;var v=zt(e,T,h,h,h,h,h,t);return v.placeholder=ol.placeholder,v}function sl(e,t,o){var v,w,F,$,K,Y,oe=0,se=!1,ae=!1,fe=!0;if(typeof e!="function")throw new Rt(i);t=wt(t)||0,ze(o)&&(se=!!o.leading,ae="maxWait"in o,F=ae?Xe(wt(o.maxWait)||0,t):F,fe="trailing"in o?!!o.trailing:fe);function ge(Ke){var Nt=v,Jt=w;return v=w=h,oe=Ke,$=e.apply(Jt,Nt),$}function be(Ke){return oe=Ke,K=mr(Pe,t),se?ge(Ke):$}function Te(Ke){var Nt=Ke-Y,Jt=Ke-oe,Rl=t-Nt;return ae?ot(Rl,F-Jt):Rl}function Ae(Ke){var Nt=Ke-Y,Jt=Ke-oe;return Y===h||Nt>=t||Nt<0||ae&&Jt>=F}function Pe(){var Ke=yi();if(Ae(Ke))return Me(Ke);K=mr(Pe,Te(Ke))}function Me(Ke){return K=h,fe&&v?ge(Ke):(v=w=h,$)}function At(){K!==h&&vu(K),oe=0,v=Y=w=K=h}function lt(){return K===h?$:Me(yi())}function Ct(){var Ke=yi(),Nt=Ae(Ke);if(v=arguments,w=this,Y=Ke,Nt){if(K===h)return be(Y);if(ae)return vu(K),K=mr(Pe,t),ge(Y)}return K===h&&(K=mr(Pe,t)),$}return Ct.cancel=At,Ct.flush=lt,Ct}var Qg=Ie(function(e,t){return qa(e,1,t)}),Yg=Ie(function(e,t,o){return qa(e,wt(t)||0,o)});function Zg(e){return zt(e,u)}function bi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Rt(i);var o=function(){var v=arguments,w=t?t.apply(this,v):v[0],F=o.cache;if(F.has(w))return F.get(w);var $=e.apply(this,v);return o.cache=F.set(w,$)||F,$};return o.cache=new(bi.Cache||kt),o}bi.Cache=kt;function Ai(e){if(typeof e!="function")throw new Rt(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Xg(e){return nl(2,e)}var ev=Hh(function(e,t){t=t.length==1&&Oe(t[0])?We(t[0],mt(ye())):We(it(t,1),mt(ye()));var o=t.length;return Ie(function(v){for(var w=-1,F=ot(v.length,o);++w<F;)v[w]=t[w].call(this,v[w]);return vt(e,this,v)})}),es=Ie(function(e,t){var o=en(t,Wn(es));return zt(e,c,h,t,o)}),al=Ie(function(e,t){var o=en(t,Wn(al));return zt(e,g,h,t,o)}),tv=$t(function(e,t){return zt(e,p,h,h,h,t)});function nv(e,t){if(typeof e!="function")throw new Rt(i);return t=t===h?t:Ee(t),Ie(e,t)}function rv(e,t){if(typeof e!="function")throw new Rt(i);return t=t==null?0:Xe(Ee(t),0),Ie(function(o){var v=o[t],w=an(o,0,t);return v&&Xt(w,v),vt(e,this,w)})}function iv(e,t,o){var v=!0,w=!0;if(typeof e!="function")throw new Rt(i);return ze(o)&&(v="leading"in o?!!o.leading:v,w="trailing"in o?!!o.trailing:w),sl(e,t,{leading:v,maxWait:t,trailing:w})}function ov(e){return tl(e,1)}function sv(e,t){return es(Fo(t),e)}function av(){if(!arguments.length)return[];var e=arguments[0];return Oe(e)?e:[e]}function uv(e){return It(e,R)}function lv(e,t){return t=typeof t=="function"?t:h,It(e,R,t)}function cv(e){return It(e,A|R)}function fv(e,t){return t=typeof t=="function"?t:h,It(e,A|R,t)}function dv(e,t){return t==null||Ja(e,t,nt(t))}function Lt(e,t){return e===t||e!==e&&t!==t}var hv=di(To),pv=di(function(e,t){return e>=t}),An=eu(function(){return arguments}())?eu:function(e){return je(e)&&Ue.call(e,"callee")&&!Ha.call(e,"callee")},Oe=ne.isArray,gv=Ca?mt(Ca):Sh;function dt(e){return e!=null&&Ci(e.length)&&!Vt(e)}function Ve(e){return je(e)&&dt(e)}function vv(e){return e===!0||e===!1||je(e)&&at(e)==te}var un=wd||fs,mv=Oa?mt(Oa):Eh;function yv(e){return je(e)&&e.nodeType===1&&!yr(e)}function bv(e){if(e==null)return!0;if(dt(e)&&(Oe(e)||typeof e=="string"||typeof e.splice=="function"||un(e)||zn(e)||An(e)))return!e.length;var t=st(e);if(t==de||t==ie)return!e.size;if(vr(e))return!Po(e).length;for(var o in e)if(Ue.call(e,o))return!1;return!0}function Av(e,t){return hr(e,t)}function Cv(e,t,o){o=typeof o=="function"?o:h;var v=o?o(e,t):h;return v===h?hr(e,t,h,o):!!v}function ts(e){if(!je(e))return!1;var t=at(e);return t==ve||t==me||typeof e.message=="string"&&typeof e.name=="string"&&!yr(e)}function Ov(e){return typeof e=="number"&&Wa(e)}function Vt(e){if(!ze(e))return!1;var t=at(e);return t==Se||t==Le||t==j||t==ct}function ul(e){return typeof e=="number"&&e==Ee(e)}function Ci(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=z}function ze(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function je(e){return e!=null&&typeof e=="object"}var ll=Sa?mt(Sa):Th;function Sv(e,t){return e===t||_o(e,t,jo(t))}function Ev(e,t,o){return o=typeof o=="function"?o:h,_o(e,t,jo(t),o)}function Rv(e){return cl(e)&&e!=+e}function Tv(e){if(lp(e))throw new Ce(s);return tu(e)}function Iv(e){return e===null}function _v(e){return e==null}function cl(e){return typeof e=="number"||je(e)&&at(e)==xe}function yr(e){if(!je(e)||at(e)!=Be)return!1;var t=Jr(e);if(t===null)return!0;var o=Ue.call(t,"constructor")&&t.constructor;return typeof o=="function"&&o instanceof o&&$r.call(o)==Ed}var ns=Ea?mt(Ea):Ih;function Pv(e){return ul(e)&&e>=-z&&e<=z}var fl=Ra?mt(Ra):_h;function Oi(e){return typeof e=="string"||!Oe(e)&&je(e)&&at(e)==ue}function bt(e){return typeof e=="symbol"||je(e)&&at(e)==pe}var zn=Ta?mt(Ta):Ph;function wv(e){return e===h}function Mv(e){return je(e)&&st(e)==Qe}function xv(e){return je(e)&&at(e)==fn}var Lv=di(wo),Nv=di(function(e,t){return e<=t});function dl(e){if(!e)return[];if(dt(e))return Oi(e)?Mt(e):ft(e);if(or&&e[or])return dd(e[or]());var t=st(e),o=t==de?mo:t==ie?kr:$n;return o(e)}function Kt(e){if(!e)return e===0?e:0;if(e=wt(e),e===x||e===-x){var t=e<0?-1:1;return t*k}return e===e?e:0}function Ee(e){var t=Kt(e),o=t%1;return t===t?o?t-o:t:0}function hl(e){return e?vn(Ee(e),0,ee):0}function wt(e){if(typeof e=="number")return e;if(bt(e))return J;if(ze(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ze(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=xa(e);var o=gf.test(e);return o||mf.test(e)?qf(e.slice(2),o?2:8):pf.test(e)?J:+e}function pl(e){return Ut(e,ht(e))}function Dv(e){return e?vn(Ee(e),-z,z):e===0?e:0}function De(e){return e==null?"":yt(e)}var Uv=Hn(function(e,t){if(vr(t)||dt(t)){Ut(t,nt(t),e);return}for(var o in t)Ue.call(t,o)&&cr(e,o,t[o])}),gl=Hn(function(e,t){Ut(t,ht(t),e)}),Si=Hn(function(e,t,o,v){Ut(t,ht(t),e,v)}),Bv=Hn(function(e,t,o,v){Ut(t,nt(t),e,v)}),Fv=$t(So);function Gv(e,t){var o=Gn(e);return t==null?o:Ka(o,t)}var Hv=Ie(function(e,t){e=Fe(e);var o=-1,v=t.length,w=v>2?t[2]:h;for(w&&ut(t[0],t[1],w)&&(v=1);++o<v;)for(var F=t[o],$=ht(F),K=-1,Y=$.length;++K<Y;){var oe=$[K],se=e[oe];(se===h||Lt(se,Un[oe])&&!Ue.call(e,oe))&&(e[oe]=F[oe])}return e}),kv=Ie(function(e){return e.push(h,xu),vt(vl,h,e)});function Wv(e,t){return _a(e,ye(t,3),Dt)}function zv(e,t){return _a(e,ye(t,3),Ro)}function $v(e,t){return e==null?e:Eo(e,ye(t,3),ht)}function jv(e,t){return e==null?e:Za(e,ye(t,3),ht)}function Vv(e,t){return e&&Dt(e,ye(t,3))}function Kv(e,t){return e&&Ro(e,ye(t,3))}function Jv(e){return e==null?[]:ii(e,nt(e))}function qv(e){return e==null?[]:ii(e,ht(e))}function rs(e,t,o){var v=e==null?h:mn(e,t);return v===h?o:v}function Qv(e,t){return e!=null&&Du(e,t,bh)}function is(e,t){return e!=null&&Du(e,t,Ah)}var Yv=Iu(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=jr.call(t)),e[t]=o},ss(pt)),Zv=Iu(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=jr.call(t)),Ue.call(e,t)?e[t].push(o):e[t]=[o]},ye),Xv=Ie(dr);function nt(e){return dt(e)?ja(e):Po(e)}function ht(e){return dt(e)?ja(e,!0):wh(e)}function em(e,t){var o={};return t=ye(t,3),Dt(e,function(v,w,F){Wt(o,t(v,w,F),v)}),o}function tm(e,t){var o={};return t=ye(t,3),Dt(e,function(v,w,F){Wt(o,w,t(v,w,F))}),o}var nm=Hn(function(e,t,o){oi(e,t,o)}),vl=Hn(function(e,t,o,v){oi(e,t,o,v)}),rm=$t(function(e,t){var o={};if(e==null)return o;var v=!1;t=We(t,function(F){return F=sn(F,e),v||(v=F.length>1),F}),Ut(e,zo(e),o),v&&(o=It(o,A|S|R,Yh));for(var w=t.length;w--;)Do(o,t[w]);return o});function im(e,t){return ml(e,Ai(ye(t)))}var om=$t(function(e,t){return e==null?{}:xh(e,t)});function ml(e,t){if(e==null)return{};var o=We(zo(e),function(v){return[v]});return t=ye(t),uu(e,o,function(v,w){return t(v,w[0])})}function sm(e,t,o){t=sn(t,e);var v=-1,w=t.length;for(w||(w=1,e=h);++v<w;){var F=e==null?h:e[Bt(t[v])];F===h&&(v=w,F=o),e=Vt(F)?F.call(e):F}return e}function am(e,t,o){return e==null?e:pr(e,t,o)}function um(e,t,o,v){return v=typeof v=="function"?v:h,e==null?e:pr(e,t,o,v)}var yl=wu(nt),bl=wu(ht);function lm(e,t,o){var v=Oe(e),w=v||un(e)||zn(e);if(t=ye(t,4),o==null){var F=e&&e.constructor;w?o=v?new F:[]:ze(e)?o=Vt(F)?Gn(Jr(e)):{}:o={}}return(w?Et:Dt)(e,function($,K,Y){return t(o,$,K,Y)}),o}function cm(e,t){return e==null?!0:Do(e,t)}function fm(e,t,o){return e==null?e:hu(e,t,Fo(o))}function dm(e,t,o,v){return v=typeof v=="function"?v:h,e==null?e:hu(e,t,Fo(o),v)}function $n(e){return e==null?[]:vo(e,nt(e))}function hm(e){return e==null?[]:vo(e,ht(e))}function pm(e,t,o){return o===h&&(o=t,t=h),o!==h&&(o=wt(o),o=o===o?o:0),t!==h&&(t=wt(t),t=t===t?t:0),vn(wt(e),t,o)}function gm(e,t,o){return t=Kt(t),o===h?(o=t,t=0):o=Kt(o),e=wt(e),Ch(e,t,o)}function vm(e,t,o){if(o&&typeof o!="boolean"&&ut(e,t,o)&&(t=o=h),o===h&&(typeof t=="boolean"?(o=t,t=h):typeof e=="boolean"&&(o=e,e=h)),e===h&&t===h?(e=0,t=1):(e=Kt(e),t===h?(t=e,e=0):t=Kt(t)),e>t){var v=e;e=t,t=v}if(o||e%1||t%1){var w=za();return ot(e+w*(t-e+Jf("1e-"+((w+"").length-1))),t)}return xo(e,t)}var mm=kn(function(e,t,o){return t=t.toLowerCase(),e+(o?Al(t):t)});function Al(e){return os(De(e).toLowerCase())}function Cl(e){return e=De(e),e&&e.replace(bf,ad).replace(Ff,"")}function ym(e,t,o){e=De(e),t=yt(t);var v=e.length;o=o===h?v:vn(Ee(o),0,v);var w=o;return o-=t.length,o>=0&&e.slice(o,w)==t}function bm(e){return e=De(e),e&&Zc.test(e)?e.replace(Zs,ud):e}function Am(e){return e=De(e),e&&of.test(e)?e.replace(Xi,"\\$&"):e}var Cm=kn(function(e,t,o){return e+(o?"-":"")+t.toLowerCase()}),Om=kn(function(e,t,o){return e+(o?" ":"")+t.toLowerCase()}),Sm=Eu("toLowerCase");function Em(e,t,o){e=De(e),t=Ee(t);var v=t?Dn(e):0;if(!t||v>=t)return e;var w=(t-v)/2;return fi(Zr(w),o)+e+fi(Yr(w),o)}function Rm(e,t,o){e=De(e),t=Ee(t);var v=t?Dn(e):0;return t&&v<t?e+fi(t-v,o):e}function Tm(e,t,o){e=De(e),t=Ee(t);var v=t?Dn(e):0;return t&&v<t?fi(t-v,o)+e:e}function Im(e,t,o){return o||t==null?t=0:t&&(t=+t),Nd(De(e).replace(eo,""),t||0)}function _m(e,t,o){return(o?ut(e,t,o):t===h)?t=1:t=Ee(t),Lo(De(e),t)}function Pm(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var wm=kn(function(e,t,o){return e+(o?"_":"")+t.toLowerCase()});function Mm(e,t,o){return o&&typeof o!="number"&&ut(e,t,o)&&(t=o=h),o=o===h?ee:o>>>0,o?(e=De(e),e&&(typeof t=="string"||t!=null&&!ns(t))&&(t=yt(t),!t&&Nn(e))?an(Mt(e),0,o):e.split(t,o)):[]}var xm=kn(function(e,t,o){return e+(o?" ":"")+os(t)});function Lm(e,t,o){return e=De(e),o=o==null?0:vn(Ee(o),0,e.length),t=yt(t),e.slice(o,o+t.length)==t}function Nm(e,t,o){var v=N.templateSettings;o&&ut(e,t,o)&&(t=h),e=De(e),t=Si({},t,v,Mu);var w=Si({},t.imports,v.imports,Mu),F=nt(w),$=vo(w,F),K,Y,oe=0,se=t.interpolate||Ur,ae="__p += '",fe=yo((t.escape||Ur).source+"|"+se.source+"|"+(se===Xs?hf:Ur).source+"|"+(t.evaluate||Ur).source+"|$","g"),ge="//# sourceURL="+(Ue.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++zf+"]")+`
`;e.replace(fe,function(Ae,Pe,Me,At,lt,Ct){return Me||(Me=At),ae+=e.slice(oe,Ct).replace(Af,ld),Pe&&(K=!0,ae+=`' +
__e(`+Pe+`) +
'`),lt&&(Y=!0,ae+=`';
`+lt+`;
__p += '`),Me&&(ae+=`' +
((__t = (`+Me+`)) == null ? '' : __t) +
'`),oe=Ct+Ae.length,Ae}),ae+=`';
`;var be=Ue.call(t,"variable")&&t.variable;if(!be)ae=`with (obj) {
`+ae+`
}
`;else if(ff.test(be))throw new Ce(m);ae=(Y?ae.replace(Jc,""):ae).replace(qc,"$1").replace(Qc,"$1;"),ae="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ae+`return __p
}`;var Te=Sl(function(){return Ne(F,ge+"return "+ae).apply(h,$)});if(Te.source=ae,ts(Te))throw Te;return Te}function Dm(e){return De(e).toLowerCase()}function Um(e){return De(e).toUpperCase()}function Bm(e,t,o){if(e=De(e),e&&(o||t===h))return xa(e);if(!e||!(t=yt(t)))return e;var v=Mt(e),w=Mt(t),F=La(v,w),$=Na(v,w)+1;return an(v,F,$).join("")}function Fm(e,t,o){if(e=De(e),e&&(o||t===h))return e.slice(0,Ua(e)+1);if(!e||!(t=yt(t)))return e;var v=Mt(e),w=Na(v,Mt(t))+1;return an(v,0,w).join("")}function Gm(e,t,o){if(e=De(e),e&&(o||t===h))return e.replace(eo,"");if(!e||!(t=yt(t)))return e;var v=Mt(e),w=La(v,Mt(t));return an(v,w).join("")}function Hm(e,t){var o=C,v=_;if(ze(t)){var w="separator"in t?t.separator:w;o="length"in t?Ee(t.length):o,v="omission"in t?yt(t.omission):v}e=De(e);var F=e.length;if(Nn(e)){var $=Mt(e);F=$.length}if(o>=F)return e;var K=o-Dn(v);if(K<1)return v;var Y=$?an($,0,K).join(""):e.slice(0,K);if(w===h)return Y+v;if($&&(K+=Y.length-K),ns(w)){if(e.slice(K).search(w)){var oe,se=Y;for(w.global||(w=yo(w.source,De(ea.exec(w))+"g")),w.lastIndex=0;oe=w.exec(se);)var ae=oe.index;Y=Y.slice(0,ae===h?K:ae)}}else if(e.indexOf(yt(w),K)!=K){var fe=Y.lastIndexOf(w);fe>-1&&(Y=Y.slice(0,fe))}return Y+v}function km(e){return e=De(e),e&&Yc.test(e)?e.replace(Ys,vd):e}var Wm=kn(function(e,t,o){return e+(o?" ":"")+t.toUpperCase()}),os=Eu("toUpperCase");function Ol(e,t,o){return e=De(e),t=o?h:t,t===h?fd(e)?bd(e):nd(e):e.match(t)||[]}var Sl=Ie(function(e,t){try{return vt(e,h,t)}catch(o){return ts(o)?o:new Ce(o)}}),zm=$t(function(e,t){return Et(t,function(o){o=Bt(o),Wt(e,o,Xo(e[o],e))}),e});function $m(e){var t=e==null?0:e.length,o=ye();return e=t?We(e,function(v){if(typeof v[1]!="function")throw new Rt(i);return[o(v[0]),v[1]]}):[],Ie(function(v){for(var w=-1;++w<t;){var F=e[w];if(vt(F[0],this,v))return vt(F[1],this,v)}})}function jm(e){return vh(It(e,A))}function ss(e){return function(){return e}}function Vm(e,t){return e==null||e!==e?t:e}var Km=Tu(),Jm=Tu(!0);function pt(e){return e}function as(e){return nu(typeof e=="function"?e:It(e,A))}function qm(e){return iu(It(e,A))}function Qm(e,t){return ou(e,It(t,A))}var Ym=Ie(function(e,t){return function(o){return dr(o,e,t)}}),Zm=Ie(function(e,t){return function(o){return dr(e,o,t)}});function us(e,t,o){var v=nt(t),w=ii(t,v);o==null&&!(ze(t)&&(w.length||!v.length))&&(o=t,t=e,e=this,w=ii(t,nt(t)));var F=!(ze(o)&&"chain"in o)||!!o.chain,$=Vt(e);return Et(w,function(K){var Y=t[K];e[K]=Y,$&&(e.prototype[K]=function(){var oe=this.__chain__;if(F||oe){var se=e(this.__wrapped__),ae=se.__actions__=ft(this.__actions__);return ae.push({func:Y,args:arguments,thisArg:e}),se.__chain__=oe,se}return Y.apply(e,Xt([this.value()],arguments))})}),e}function Xm(){return tt._===this&&(tt._=Rd),this}function ls(){}function e0(e){return e=Ee(e),Ie(function(t){return su(t,e)})}var t0=Ho(We),n0=Ho(Ia),r0=Ho(co);function El(e){return Ko(e)?fo(Bt(e)):Lh(e)}function i0(e){return function(t){return e==null?h:mn(e,t)}}var o0=_u(),s0=_u(!0);function cs(){return[]}function fs(){return!1}function a0(){return{}}function u0(){return""}function l0(){return!0}function c0(e,t){if(e=Ee(e),e<1||e>z)return[];var o=ee,v=ot(e,ee);t=ye(t),e-=ee;for(var w=go(v,t);++o<e;)t(o);return w}function f0(e){return Oe(e)?We(e,Bt):bt(e)?[e]:ft($u(De(e)))}function d0(e){var t=++Sd;return De(e)+t}var h0=ci(function(e,t){return e+t},0),p0=ko("ceil"),g0=ci(function(e,t){return e/t},1),v0=ko("floor");function m0(e){return e&&e.length?ri(e,pt,To):h}function y0(e,t){return e&&e.length?ri(e,ye(t,2),To):h}function b0(e){return wa(e,pt)}function A0(e,t){return wa(e,ye(t,2))}function C0(e){return e&&e.length?ri(e,pt,wo):h}function O0(e,t){return e&&e.length?ri(e,ye(t,2),wo):h}var S0=ci(function(e,t){return e*t},1),E0=ko("round"),R0=ci(function(e,t){return e-t},0);function T0(e){return e&&e.length?po(e,pt):0}function I0(e,t){return e&&e.length?po(e,ye(t,2)):0}return N.after=qg,N.ary=tl,N.assign=Uv,N.assignIn=gl,N.assignInWith=Si,N.assignWith=Bv,N.at=Fv,N.before=nl,N.bind=Xo,N.bindAll=zm,N.bindKey=rl,N.castArray=av,N.chain=Zu,N.chunk=vp,N.compact=mp,N.concat=yp,N.cond=$m,N.conforms=jm,N.constant=ss,N.countBy=Tg,N.create=Gv,N.curry=il,N.curryRight=ol,N.debounce=sl,N.defaults=Hv,N.defaultsDeep=kv,N.defer=Qg,N.delay=Yg,N.difference=bp,N.differenceBy=Ap,N.differenceWith=Cp,N.drop=Op,N.dropRight=Sp,N.dropRightWhile=Ep,N.dropWhile=Rp,N.fill=Tp,N.filter=_g,N.flatMap=Mg,N.flatMapDeep=xg,N.flatMapDepth=Lg,N.flatten=Ju,N.flattenDeep=Ip,N.flattenDepth=_p,N.flip=Zg,N.flow=Km,N.flowRight=Jm,N.fromPairs=Pp,N.functions=Jv,N.functionsIn=qv,N.groupBy=Ng,N.initial=Mp,N.intersection=xp,N.intersectionBy=Lp,N.intersectionWith=Np,N.invert=Yv,N.invertBy=Zv,N.invokeMap=Ug,N.iteratee=as,N.keyBy=Bg,N.keys=nt,N.keysIn=ht,N.map=mi,N.mapKeys=em,N.mapValues=tm,N.matches=qm,N.matchesProperty=Qm,N.memoize=bi,N.merge=nm,N.mergeWith=vl,N.method=Ym,N.methodOf=Zm,N.mixin=us,N.negate=Ai,N.nthArg=e0,N.omit=rm,N.omitBy=im,N.once=Xg,N.orderBy=Fg,N.over=t0,N.overArgs=ev,N.overEvery=n0,N.overSome=r0,N.partial=es,N.partialRight=al,N.partition=Gg,N.pick=om,N.pickBy=ml,N.property=El,N.propertyOf=i0,N.pull=Fp,N.pullAll=Qu,N.pullAllBy=Gp,N.pullAllWith=Hp,N.pullAt=kp,N.range=o0,N.rangeRight=s0,N.rearg=tv,N.reject=Wg,N.remove=Wp,N.rest=nv,N.reverse=Yo,N.sampleSize=$g,N.set=am,N.setWith=um,N.shuffle=jg,N.slice=zp,N.sortBy=Jg,N.sortedUniq=Qp,N.sortedUniqBy=Yp,N.split=Mm,N.spread=rv,N.tail=Zp,N.take=Xp,N.takeRight=eg,N.takeRightWhile=tg,N.takeWhile=ng,N.tap=mg,N.throttle=iv,N.thru=vi,N.toArray=dl,N.toPairs=yl,N.toPairsIn=bl,N.toPath=f0,N.toPlainObject=pl,N.transform=lm,N.unary=ov,N.union=rg,N.unionBy=ig,N.unionWith=og,N.uniq=sg,N.uniqBy=ag,N.uniqWith=ug,N.unset=cm,N.unzip=Zo,N.unzipWith=Yu,N.update=fm,N.updateWith=dm,N.values=$n,N.valuesIn=hm,N.without=lg,N.words=Ol,N.wrap=sv,N.xor=cg,N.xorBy=fg,N.xorWith=dg,N.zip=hg,N.zipObject=pg,N.zipObjectDeep=gg,N.zipWith=vg,N.entries=yl,N.entriesIn=bl,N.extend=gl,N.extendWith=Si,us(N,N),N.add=h0,N.attempt=Sl,N.camelCase=mm,N.capitalize=Al,N.ceil=p0,N.clamp=pm,N.clone=uv,N.cloneDeep=cv,N.cloneDeepWith=fv,N.cloneWith=lv,N.conformsTo=dv,N.deburr=Cl,N.defaultTo=Vm,N.divide=g0,N.endsWith=ym,N.eq=Lt,N.escape=bm,N.escapeRegExp=Am,N.every=Ig,N.find=Pg,N.findIndex=Vu,N.findKey=Wv,N.findLast=wg,N.findLastIndex=Ku,N.findLastKey=zv,N.floor=v0,N.forEach=Xu,N.forEachRight=el,N.forIn=$v,N.forInRight=jv,N.forOwn=Vv,N.forOwnRight=Kv,N.get=rs,N.gt=hv,N.gte=pv,N.has=Qv,N.hasIn=is,N.head=qu,N.identity=pt,N.includes=Dg,N.indexOf=wp,N.inRange=gm,N.invoke=Xv,N.isArguments=An,N.isArray=Oe,N.isArrayBuffer=gv,N.isArrayLike=dt,N.isArrayLikeObject=Ve,N.isBoolean=vv,N.isBuffer=un,N.isDate=mv,N.isElement=yv,N.isEmpty=bv,N.isEqual=Av,N.isEqualWith=Cv,N.isError=ts,N.isFinite=Ov,N.isFunction=Vt,N.isInteger=ul,N.isLength=Ci,N.isMap=ll,N.isMatch=Sv,N.isMatchWith=Ev,N.isNaN=Rv,N.isNative=Tv,N.isNil=_v,N.isNull=Iv,N.isNumber=cl,N.isObject=ze,N.isObjectLike=je,N.isPlainObject=yr,N.isRegExp=ns,N.isSafeInteger=Pv,N.isSet=fl,N.isString=Oi,N.isSymbol=bt,N.isTypedArray=zn,N.isUndefined=wv,N.isWeakMap=Mv,N.isWeakSet=xv,N.join=Dp,N.kebabCase=Cm,N.last=Pt,N.lastIndexOf=Up,N.lowerCase=Om,N.lowerFirst=Sm,N.lt=Lv,N.lte=Nv,N.max=m0,N.maxBy=y0,N.mean=b0,N.meanBy=A0,N.min=C0,N.minBy=O0,N.stubArray=cs,N.stubFalse=fs,N.stubObject=a0,N.stubString=u0,N.stubTrue=l0,N.multiply=S0,N.nth=Bp,N.noConflict=Xm,N.noop=ls,N.now=yi,N.pad=Em,N.padEnd=Rm,N.padStart=Tm,N.parseInt=Im,N.random=vm,N.reduce=Hg,N.reduceRight=kg,N.repeat=_m,N.replace=Pm,N.result=sm,N.round=E0,N.runInContext=q,N.sample=zg,N.size=Vg,N.snakeCase=wm,N.some=Kg,N.sortedIndex=$p,N.sortedIndexBy=jp,N.sortedIndexOf=Vp,N.sortedLastIndex=Kp,N.sortedLastIndexBy=Jp,N.sortedLastIndexOf=qp,N.startCase=xm,N.startsWith=Lm,N.subtract=R0,N.sum=T0,N.sumBy=I0,N.template=Nm,N.times=c0,N.toFinite=Kt,N.toInteger=Ee,N.toLength=hl,N.toLower=Dm,N.toNumber=wt,N.toSafeInteger=Dv,N.toString=De,N.toUpper=Um,N.trim=Bm,N.trimEnd=Fm,N.trimStart=Gm,N.truncate=Hm,N.unescape=km,N.uniqueId=d0,N.upperCase=Wm,N.upperFirst=os,N.each=Xu,N.eachRight=el,N.first=qu,us(N,function(){var e={};return Dt(N,function(t,o){Ue.call(N.prototype,o)||(e[o]=t)}),e}(),{chain:!1}),N.VERSION=r,Et(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){N[e].placeholder=N}),Et(["drop","take"],function(e,t){we.prototype[e]=function(o){o=o===h?1:Xe(Ee(o),0);var v=this.__filtered__&&!t?new we(this):this.clone();return v.__filtered__?v.__takeCount__=ot(o,v.__takeCount__):v.__views__.push({size:ot(o,ee),type:e+(v.__dir__<0?"Right":"")}),v},we.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Et(["filter","map","takeWhile"],function(e,t){var o=t+1,v=o==H||o==I;we.prototype[e]=function(w){var F=this.clone();return F.__iteratees__.push({iteratee:ye(w,3),type:o}),F.__filtered__=F.__filtered__||v,F}}),Et(["head","last"],function(e,t){var o="take"+(t?"Right":"");we.prototype[e]=function(){return this[o](1).value()[0]}}),Et(["initial","tail"],function(e,t){var o="drop"+(t?"":"Right");we.prototype[e]=function(){return this.__filtered__?new we(this):this[o](1)}}),we.prototype.compact=function(){return this.filter(pt)},we.prototype.find=function(e){return this.filter(e).head()},we.prototype.findLast=function(e){return this.reverse().find(e)},we.prototype.invokeMap=Ie(function(e,t){return typeof e=="function"?new we(this):this.map(function(o){return dr(o,e,t)})}),we.prototype.reject=function(e){return this.filter(Ai(ye(e)))},we.prototype.slice=function(e,t){e=Ee(e);var o=this;return o.__filtered__&&(e>0||t<0)?new we(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),t!==h&&(t=Ee(t),o=t<0?o.dropRight(-t):o.take(t-e)),o)},we.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},we.prototype.toArray=function(){return this.take(ee)},Dt(we.prototype,function(e,t){var o=/^(?:filter|find|map|reject)|While$/.test(t),v=/^(?:head|last)$/.test(t),w=N[v?"take"+(t=="last"?"Right":""):t],F=v||/^find/.test(t);!w||(N.prototype[t]=function(){var $=this.__wrapped__,K=v?[1]:arguments,Y=$ instanceof we,oe=K[0],se=Y||Oe($),ae=function(Pe){var Me=w.apply(N,Xt([Pe],K));return v&&fe?Me[0]:Me};se&&o&&typeof oe=="function"&&oe.length!=1&&(Y=se=!1);var fe=this.__chain__,ge=!!this.__actions__.length,be=F&&!fe,Te=Y&&!ge;if(!F&&se){$=Te?$:new we(this);var Ae=e.apply($,K);return Ae.__actions__.push({func:vi,args:[ae],thisArg:h}),new Tt(Ae,fe)}return be&&Te?e.apply(this,K):(Ae=this.thru(ae),be?v?Ae.value()[0]:Ae.value():Ae)})}),Et(["pop","push","shift","sort","splice","unshift"],function(e){var t=Wr[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",v=/^(?:pop|shift)$/.test(e);N.prototype[e]=function(){var w=arguments;if(v&&!this.__chain__){var F=this.value();return t.apply(Oe(F)?F:[],w)}return this[o](function($){return t.apply(Oe($)?$:[],w)})}}),Dt(we.prototype,function(e,t){var o=N[t];if(o){var v=o.name+"";Ue.call(Fn,v)||(Fn[v]=[]),Fn[v].push({name:t,func:o})}}),Fn[li(h,P).name]=[{name:"wrapper",func:h}],we.prototype.clone=kd,we.prototype.reverse=Wd,we.prototype.value=zd,N.prototype.at=yg,N.prototype.chain=bg,N.prototype.commit=Ag,N.prototype.next=Cg,N.prototype.plant=Sg,N.prototype.reverse=Eg,N.prototype.toJSON=N.prototype.valueOf=N.prototype.value=Rg,N.prototype.first=N.prototype.head,or&&(N.prototype[or]=Og),N},tn=Ad();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(tt._=tn,define(function(){return tn})):dn?((dn.exports=tn)._=tn,so._=tn):tt._=tn}).call(Vn)});var xl=Je((ab,Ml)=>{X();var Kn=1e3,Jn=Kn*60,qn=Jn*60,Sn=qn*24,U0=Sn*7,B0=Sn*365.25;Ml.exports=function(h,r){r=r||{};var n=typeof h;if(n==="string"&&h.length>0)return F0(h);if(n==="number"&&isFinite(h))return r.long?H0(h):G0(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function F0(h){if(h=String(h),!(h.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(!!r){var n=parseFloat(r[1]),s=(r[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*B0;case"weeks":case"week":case"w":return n*U0;case"days":case"day":case"d":return n*Sn;case"hours":case"hour":case"hrs":case"hr":case"h":return n*qn;case"minutes":case"minute":case"mins":case"min":case"m":return n*Jn;case"seconds":case"second":case"secs":case"sec":case"s":return n*Kn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function G0(h){var r=Math.abs(h);return r>=Sn?Math.round(h/Sn)+"d":r>=qn?Math.round(h/qn)+"h":r>=Jn?Math.round(h/Jn)+"m":r>=Kn?Math.round(h/Kn)+"s":h+"ms"}function H0(h){var r=Math.abs(h);return r>=Sn?_i(h,r,Sn,"day"):r>=qn?_i(h,r,qn,"hour"):r>=Jn?_i(h,r,Jn,"minute"):r>=Kn?_i(h,r,Kn,"second"):h+" ms"}function _i(h,r,n,s){var i=r>=n*1.5;return Math.round(h/n)+" "+s+(i?"s":"")}});var Nl=Je((ub,Ll)=>{X();function k0(h){n.debug=n,n.default=n,n.coerce=f,n.disable=m,n.enable=i,n.enabled=y,n.humanize=xl(),n.destroy=A,Object.keys(h).forEach(S=>{n[S]=h[S]}),n.names=[],n.skips=[],n.formatters={};function r(S){let R=0;for(let a=0;a<S.length;a++)R=(R<<5)-R+S.charCodeAt(a),R|=0;return n.colors[Math.abs(R)%n.colors.length]}n.selectColor=r;function n(S){let R,a=null,E,M;function P(...O){if(!P.enabled)return;let b=P,T=Number(new Date),c=T-(R||T);b.diff=c,b.prev=R,b.curr=T,R=T,O[0]=n.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let g=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(p,u)=>{if(p==="%%")return"%";g++;let C=n.formatters[u];if(typeof C=="function"){let _=O[g];p=C.call(b,_),O.splice(g,1),g--}return p}),n.formatArgs.call(b,O),(b.log||n.log).apply(b,O)}return P.namespace=S,P.useColors=n.useColors(),P.color=n.selectColor(S),P.extend=s,P.destroy=n.destroy,Object.defineProperty(P,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(E!==n.namespaces&&(E=n.namespaces,M=n.enabled(S)),M),set:O=>{a=O}}),typeof n.init=="function"&&n.init(P),P}function s(S,R){let a=n(this.namespace+(typeof R=="undefined"?":":R)+S);return a.log=this.log,a}function i(S){n.save(S),n.namespaces=S,n.names=[],n.skips=[];let R,a=(typeof S=="string"?S:"").split(/[\s,]+/),E=a.length;for(R=0;R<E;R++)!a[R]||(S=a[R].replace(/\*/g,".*?"),S[0]==="-"?n.skips.push(new RegExp("^"+S.slice(1)+"$")):n.names.push(new RegExp("^"+S+"$")))}function m(){let S=[...n.names.map(l),...n.skips.map(l).map(R=>"-"+R)].join(",");return n.enable(""),S}function y(S){if(S[S.length-1]==="*")return!0;let R,a;for(R=0,a=n.skips.length;R<a;R++)if(n.skips[R].test(S))return!1;for(R=0,a=n.names.length;R<a;R++)if(n.names[R].test(S))return!0;return!1}function l(S){return S.toString().substring(2,S.toString().length-2).replace(/\.\*\?$/,"*")}function f(S){return S instanceof Error?S.stack||S.message:S}function A(){}return n.enable(n.load()),n}Ll.exports=k0});var gs=Je((Ot,Pi)=>{X();Ot.formatArgs=z0;Ot.save=$0;Ot.load=j0;Ot.useColors=W0;Ot.storage=V0();Ot.destroy=(()=>{let h=!1;return()=>{h||(h=!0)}})();Ot.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function W0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function z0(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+Pi.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;h.splice(1,0,r,"color: inherit");let n=0,s=0;h[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(n++,i==="%c"&&(s=n))}),h.splice(s,0,r)}Ot.log=console.debug||console.log||(()=>{});function $0(h){try{h?Ot.storage.setItem("debug",h):Ot.storage.removeItem("debug")}catch(r){}}function j0(){let h;try{h=Ot.storage.getItem("debug")}catch(r){}return!h&&typeof process!="undefined"&&"env"in process&&(h=ce.DEBUG),h}function V0(){try{return localStorage}catch(h){}}Pi.exports=Nl()(Ot);var{formatters:K0}=Pi.exports;K0.j=function(h){try{return JSON.stringify(h)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}});var wi=Je((cb,Ul)=>{X();function J0(h){var r=typeof h;return h!=null&&(r=="object"||r=="function")}Ul.exports=J0});var Fl=Je((fb,Bl)=>{X();var q0=typeof global=="object"&&global&&global.Object===Object&&global;Bl.exports=q0});var vs=Je((db,Gl)=>{X();var Q0=Fl(),Y0=typeof self=="object"&&self&&self.Object===Object&&self,Z0=Q0||Y0||Function("return this")();Gl.exports=Z0});var kl=Je((hb,Hl)=>{X();var X0=vs(),ey=function(){return X0.Date.now()};Hl.exports=ey});var zl=Je((pb,Wl)=>{X();var ty=/\s/;function ny(h){for(var r=h.length;r--&&ty.test(h.charAt(r)););return r}Wl.exports=ny});var jl=Je((gb,$l)=>{X();var ry=zl(),iy=/^\s+/;function oy(h){return h&&h.slice(0,ry(h)+1).replace(iy,"")}$l.exports=oy});var ms=Je((vb,Vl)=>{X();var sy=vs(),ay=sy.Symbol;Vl.exports=ay});var Ql=Je((mb,ql)=>{X();var Kl=ms(),Jl=Object.prototype,uy=Jl.hasOwnProperty,ly=Jl.toString,Or=Kl?Kl.toStringTag:void 0;function cy(h){var r=uy.call(h,Or),n=h[Or];try{h[Or]=void 0;var s=!0}catch(m){}var i=ly.call(h);return s&&(r?h[Or]=n:delete h[Or]),i}ql.exports=cy});var Zl=Je((yb,Yl)=>{X();var fy=Object.prototype,dy=fy.toString;function hy(h){return dy.call(h)}Yl.exports=hy});var nc=Je((bb,tc)=>{X();var Xl=ms(),py=Ql(),gy=Zl(),vy="[object Null]",my="[object Undefined]",ec=Xl?Xl.toStringTag:void 0;function yy(h){return h==null?h===void 0?my:vy:ec&&ec in Object(h)?py(h):gy(h)}tc.exports=yy});var ic=Je((Ab,rc)=>{X();function by(h){return h!=null&&typeof h=="object"}rc.exports=by});var sc=Je((Cb,oc)=>{X();var Ay=nc(),Cy=ic(),Oy="[object Symbol]";function Sy(h){return typeof h=="symbol"||Cy(h)&&Ay(h)==Oy}oc.exports=Sy});var cc=Je((Ob,lc)=>{X();var Ey=jl(),ac=wi(),Ry=sc(),uc=0/0,Ty=/^[-+]0x[0-9a-f]+$/i,Iy=/^0b[01]+$/i,_y=/^0o[0-7]+$/i,Py=parseInt;function wy(h){if(typeof h=="number")return h;if(Ry(h))return uc;if(ac(h)){var r=typeof h.valueOf=="function"?h.valueOf():h;h=ac(r)?r+"":r}if(typeof h!="string")return h===0?h:+h;h=Ey(h);var n=Iy.test(h);return n||_y.test(h)?Py(h.slice(2),n?2:8):Ty.test(h)?uc:+h}lc.exports=wy});var hc=Je((Sb,dc)=>{X();var My=wi(),ys=kl(),fc=cc(),xy="Expected a function",Ly=Math.max,Ny=Math.min;function Dy(h,r,n){var s,i,m,y,l,f,A=0,S=!1,R=!1,a=!0;if(typeof h!="function")throw new TypeError(xy);r=fc(r)||0,My(n)&&(S=!!n.leading,R="maxWait"in n,m=R?Ly(fc(n.maxWait)||0,r):m,a="trailing"in n?!!n.trailing:a);function E(p){var u=s,C=i;return s=i=void 0,A=p,y=h.apply(C,u),y}function M(p){return A=p,l=setTimeout(b,r),S?E(p):y}function P(p){var u=p-f,C=p-A,_=r-u;return R?Ny(_,m-C):_}function O(p){var u=p-f,C=p-A;return f===void 0||u>=r||u<0||R&&C>=m}function b(){var p=ys();if(O(p))return T(p);l=setTimeout(b,P(p))}function T(p){return l=void 0,a&&s?E(p):(s=i=void 0,y)}function c(){l!==void 0&&clearTimeout(l),A=0,s=f=i=l=void 0}function g(){return l===void 0?y:T(ys())}function d(){var p=ys(),u=O(p);if(s=arguments,i=this,f=p,u){if(l===void 0)return M(f);if(R)return clearTimeout(l),l=setTimeout(b,r),E(f)}return l===void 0&&(l=setTimeout(b,r)),y}return d.cancel=c,d.flush=g,d}dc.exports=Dy});var bs=Je((Eb,pc)=>{X();var Uy=hc(),By=wi(),Fy="Expected a function";function Gy(h,r,n){var s=!0,i=!0;if(typeof h!="function")throw new TypeError(Fy);return By(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),Uy(h,r,{leading:s,maxWait:r,trailing:i})}pc.exports=Gy});var vc=Je((Sr,As)=>{X();(function(h,r){typeof Sr=="object"&&typeof As=="object"?As.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Sr=="object"?Sr.bowser=r():h.bowser=r()})(Sr,function(){return function(h){var r={};function n(s){if(r[s])return r[s].exports;var i=r[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=r,n.d=function(s,i,m){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:m})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(1&i&&(s=n(s)),8&i||4&i&&typeof s=="object"&&s&&s.__esModule)return s;var m=Object.create(null);if(n.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:s}),2&i&&typeof s!="string")for(var y in s)n.d(m,y,function(l){return s[l]}.bind(null,y));return m},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=90)}({17:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=n(18),i=function(){function m(){}return m.getFirstMatch=function(y,l){var f=l.match(y);return f&&f.length>0&&f[1]||""},m.getSecondMatch=function(y,l){var f=l.match(y);return f&&f.length>1&&f[2]||""},m.matchAndReturnConst=function(y,l,f){if(y.test(l))return f},m.getWindowsVersionName=function(y){switch(y){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},m.getMacOSVersionName=function(y){var l=y.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(l.push(0),l[0]===10)switch(l[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},m.getAndroidVersionName=function(y){var l=y.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(l.push(0),!(l[0]===1&&l[1]<5))return l[0]===1&&l[1]<6?"Cupcake":l[0]===1&&l[1]>=6?"Donut":l[0]===2&&l[1]<2?"Eclair":l[0]===2&&l[1]===2?"Froyo":l[0]===2&&l[1]>2?"Gingerbread":l[0]===3?"Honeycomb":l[0]===4&&l[1]<1?"Ice Cream Sandwich":l[0]===4&&l[1]<4?"Jelly Bean":l[0]===4&&l[1]>=4?"KitKat":l[0]===5?"Lollipop":l[0]===6?"Marshmallow":l[0]===7?"Nougat":l[0]===8?"Oreo":l[0]===9?"Pie":void 0},m.getVersionPrecision=function(y){return y.split(".").length},m.compareVersions=function(y,l,f){f===void 0&&(f=!1);var A=m.getVersionPrecision(y),S=m.getVersionPrecision(l),R=Math.max(A,S),a=0,E=m.map([y,l],function(M){var P=R-m.getVersionPrecision(M),O=M+new Array(P+1).join(".0");return m.map(O.split("."),function(b){return new Array(20-b.length).join("0")+b}).reverse()});for(f&&(a=R-Math.min(A,S)),R-=1;R>=a;){if(E[0][R]>E[1][R])return 1;if(E[0][R]===E[1][R]){if(R===a)return 0;R-=1}else if(E[0][R]<E[1][R])return-1}},m.map=function(y,l){var f,A=[];if(Array.prototype.map)return Array.prototype.map.call(y,l);for(f=0;f<y.length;f+=1)A.push(l(y[f]));return A},m.find=function(y,l){var f,A;if(Array.prototype.find)return Array.prototype.find.call(y,l);for(f=0,A=y.length;f<A;f+=1){var S=y[f];if(l(S,f))return S}},m.assign=function(y){for(var l,f,A=y,S=arguments.length,R=new Array(S>1?S-1:0),a=1;a<S;a++)R[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[y].concat(R));var E=function(){var M=R[l];typeof M=="object"&&M!==null&&Object.keys(M).forEach(function(P){A[P]=M[P]})};for(l=0,f=R.length;l<f;l+=1)E();return y},m.getBrowserAlias=function(y){return s.BROWSER_ALIASES_MAP[y]},m.getBrowserTypeByAlias=function(y){return s.BROWSER_MAP[y]||""},m}();r.default=i,h.exports=r.default},18:function(h,r,n){"use strict";r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(91))&&s.__esModule?s:{default:s},m=n(18);function y(f,A){for(var S=0;S<A.length;S++){var R=A[S];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(f,R.key,R)}}var l=function(){function f(){}var A,S,R;return f.getParser=function(a,E){if(E===void 0&&(E=!1),typeof a!="string")throw new Error("UserAgent should be a string");return new i.default(a,E)},f.parse=function(a){return new i.default(a).getResult()},A=f,R=[{key:"BROWSER_MAP",get:function(){return m.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return m.ENGINE_MAP}},{key:"OS_MAP",get:function(){return m.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return m.PLATFORMS_MAP}}],(S=null)&&y(A.prototype,S),R&&y(A,R),f}();r.default=l,h.exports=r.default},91:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=f(n(92)),i=f(n(93)),m=f(n(94)),y=f(n(95)),l=f(n(17));function f(S){return S&&S.__esModule?S:{default:S}}var A=function(){function S(a,E){if(E===void 0&&(E=!1),a==null||a==="")throw new Error("UserAgent parameter can't be empty");this._ua=a,this.parsedResult={},E!==!0&&this.parse()}var R=S.prototype;return R.getUA=function(){return this._ua},R.test=function(a){return a.test(this._ua)},R.parseBrowser=function(){var a=this;this.parsedResult.browser={};var E=l.default.find(s.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.browser=E.describe(this.getUA())),this.parsedResult.browser},R.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},R.getBrowserName=function(a){return a?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},R.getBrowserVersion=function(){return this.getBrowser().version},R.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},R.parseOS=function(){var a=this;this.parsedResult.os={};var E=l.default.find(i.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.os=E.describe(this.getUA())),this.parsedResult.os},R.getOSName=function(a){var E=this.getOS().name;return a?String(E).toLowerCase()||"":E||""},R.getOSVersion=function(){return this.getOS().version},R.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},R.getPlatformType=function(a){a===void 0&&(a=!1);var E=this.getPlatform().type;return a?String(E).toLowerCase()||"":E||""},R.parsePlatform=function(){var a=this;this.parsedResult.platform={};var E=l.default.find(m.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.platform=E.describe(this.getUA())),this.parsedResult.platform},R.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},R.getEngineName=function(a){return a?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},R.parseEngine=function(){var a=this;this.parsedResult.engine={};var E=l.default.find(y.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.engine=E.describe(this.getUA())),this.parsedResult.engine},R.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},R.getResult=function(){return l.default.assign({},this.parsedResult)},R.satisfies=function(a){var E=this,M={},P=0,O={},b=0;if(Object.keys(a).forEach(function(_){var L=a[_];typeof L=="string"?(O[_]=L,b+=1):typeof L=="object"&&(M[_]=L,P+=1)}),P>0){var T=Object.keys(M),c=l.default.find(T,function(_){return E.isOS(_)});if(c){var g=this.satisfies(M[c]);if(g!==void 0)return g}var d=l.default.find(T,function(_){return E.isPlatform(_)});if(d){var p=this.satisfies(M[d]);if(p!==void 0)return p}}if(b>0){var u=Object.keys(O),C=l.default.find(u,function(_){return E.isBrowser(_,!0)});if(C!==void 0)return this.compareVersion(O[C])}},R.isBrowser=function(a,E){E===void 0&&(E=!1);var M=this.getBrowserName().toLowerCase(),P=a.toLowerCase(),O=l.default.getBrowserTypeByAlias(P);return E&&O&&(P=O.toLowerCase()),P===M},R.compareVersion=function(a){var E=[0],M=a,P=!1,O=this.getBrowserVersion();if(typeof O=="string")return a[0]===">"||a[0]==="<"?(M=a.substr(1),a[1]==="="?(P=!0,M=a.substr(2)):E=[],a[0]===">"?E.push(1):E.push(-1)):a[0]==="="?M=a.substr(1):a[0]==="~"&&(P=!0,M=a.substr(1)),E.indexOf(l.default.compareVersions(O,M,P))>-1},R.isOS=function(a){return this.getOSName(!0)===String(a).toLowerCase()},R.isPlatform=function(a){return this.getPlatformType(!0)===String(a).toLowerCase()},R.isEngine=function(a){return this.getEngineName(!0)===String(a).toLowerCase()},R.is=function(a,E){return E===void 0&&(E=!1),this.isBrowser(a,E)||this.isOS(a)||this.isPlatform(a)},R.some=function(a){var E=this;return a===void 0&&(a=[]),a.some(function(M){return E.is(M)})},S}();r.default=A,h.exports=r.default},92:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=/version\/(\d+(\.?_?\d+)+)/i,y=[{test:[/googlebot/i],describe:function(l){var f={name:"Googlebot"},A=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/opera/i],describe:function(l){var f={name:"Opera"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/opr\/|opios/i],describe:function(l){var f={name:"Opera"},A=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/SamsungBrowser/i],describe:function(l){var f={name:"Samsung Internet for Android"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/Whale/i],describe:function(l){var f={name:"NAVER Whale Browser"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/MZBrowser/i],describe:function(l){var f={name:"MZ Browser"},A=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/focus/i],describe:function(l){var f={name:"Focus"},A=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/swing/i],describe:function(l){var f={name:"Swing"},A=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/coast/i],describe:function(l){var f={name:"Opera Coast"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(l){var f={name:"Opera Touch"},A=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/yabrowser/i],describe:function(l){var f={name:"Yandex Browser"},A=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/ucbrowser/i],describe:function(l){var f={name:"UC Browser"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/Maxthon|mxios/i],describe:function(l){var f={name:"Maxthon"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/epiphany/i],describe:function(l){var f={name:"Epiphany"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/puffin/i],describe:function(l){var f={name:"Puffin"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/sleipnir/i],describe:function(l){var f={name:"Sleipnir"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/k-meleon/i],describe:function(l){var f={name:"K-Meleon"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/micromessenger/i],describe:function(l){var f={name:"WeChat"},A=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/qqbrowser/i],describe:function(l){var f={name:/qqbrowserlite/i.test(l)?"QQ Browser Lite":"QQ Browser"},A=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/msie|trident/i],describe:function(l){var f={name:"Internet Explorer"},A=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/\sedg\//i],describe:function(l){var f={name:"Microsoft Edge"},A=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/edg([ea]|ios)/i],describe:function(l){var f={name:"Microsoft Edge"},A=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/vivaldi/i],describe:function(l){var f={name:"Vivaldi"},A=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/seamonkey/i],describe:function(l){var f={name:"SeaMonkey"},A=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/sailfish/i],describe:function(l){var f={name:"Sailfish"},A=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,l);return A&&(f.version=A),f}},{test:[/silk/i],describe:function(l){var f={name:"Amazon Silk"},A=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/phantom/i],describe:function(l){var f={name:"PhantomJS"},A=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/slimerjs/i],describe:function(l){var f={name:"SlimerJS"},A=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var f={name:"BlackBerry"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var f={name:"WebOS Browser"},A=i.default.getFirstMatch(m,l)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/bada/i],describe:function(l){var f={name:"Bada"},A=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/tizen/i],describe:function(l){var f={name:"Tizen"},A=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/qupzilla/i],describe:function(l){var f={name:"QupZilla"},A=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(l){var f={name:"Firefox"},A=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/electron/i],describe:function(l){var f={name:"Electron"},A=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/MiuiBrowser/i],describe:function(l){var f={name:"Miui"},A=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/chromium/i],describe:function(l){var f={name:"Chromium"},A=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/chrome|crios|crmo/i],describe:function(l){var f={name:"Chrome"},A=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/GSA/i],describe:function(l){var f={name:"Google Search"},A=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:function(l){var f=!l.test(/like android/i),A=l.test(/android/i);return f&&A},describe:function(l){var f={name:"Android Browser"},A=i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/playstation 4/i],describe:function(l){var f={name:"PlayStation 4"},A=i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/safari|applewebkit/i],describe:function(l){var f={name:"Safari"},A=i.default.getFirstMatch(m,l);return A&&(f.version=A),f}},{test:[/.*/i],describe:function(l){var f=l.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(f,l),version:i.default.getSecondMatch(f,l)}}}];r.default=y,h.exports=r.default},93:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:[/Roku\/DVP/],describe:function(l){var f=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,l);return{name:m.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(l){var f=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,l);return{name:m.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(l){var f=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,l),A=i.default.getWindowsVersionName(f);return{name:m.OS_MAP.Windows,version:f,versionName:A}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(l){var f={name:m.OS_MAP.iOS},A=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,l);return A&&(f.version=A),f}},{test:[/macintosh/i],describe:function(l){var f=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,l).replace(/[_\s]/g,"."),A=i.default.getMacOSVersionName(f),S={name:m.OS_MAP.MacOS,version:f};return A&&(S.versionName=A),S}},{test:[/(ipod|iphone|ipad)/i],describe:function(l){var f=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,l).replace(/[_\s]/g,".");return{name:m.OS_MAP.iOS,version:f}}},{test:function(l){var f=!l.test(/like android/i),A=l.test(/android/i);return f&&A},describe:function(l){var f=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,l),A=i.default.getAndroidVersionName(f),S={name:m.OS_MAP.Android,version:f};return A&&(S.versionName=A),S}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var f=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,l),A={name:m.OS_MAP.WebOS};return f&&f.length&&(A.version=f),A}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var f=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,l)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,l)||i.default.getFirstMatch(/\bbb(\d+)/i,l);return{name:m.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(l){var f=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,l);return{name:m.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(l){var f=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,l);return{name:m.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:m.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:m.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(l){var f=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,l);return{name:m.OS_MAP.PlayStation4,version:f}}}];r.default=y,h.exports=r.default},94:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(l){var f=i.default.getFirstMatch(/(can-l01)/i,l)&&"Nova",A={type:m.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(A.model=f),A}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(l){var f=l.test(/ipod|iphone/i),A=l.test(/like (ipod|iphone)/i);return f&&!A},describe:function(l){var f=i.default.getFirstMatch(/(ipod|iphone)/i,l);return{type:m.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName(!0)==="blackberry"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(l){return l.getBrowserName(!0)==="bada"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName()==="windows phone"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(l){var f=Number(String(l.getOSVersion()).split(".")[0]);return l.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(l){return l.getOSName(!0)==="android"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getOSName(!0)==="macos"},describe:function(){return{type:m.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(l){return l.getOSName(!0)==="windows"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="linux"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="playstation 4"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}},{test:function(l){return l.getOSName(!0)==="roku"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}}];r.default=y,h.exports=r.default},95:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:function(l){return l.getBrowserName(!0)==="microsoft edge"},describe:function(l){if(/\sedg\//i.test(l))return{name:m.ENGINE_MAP.Blink};var f=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,l);return{name:m.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(l){var f={name:m.ENGINE_MAP.Trident},A=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:function(l){return l.test(/presto/i)},describe:function(l){var f={name:m.ENGINE_MAP.Presto},A=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:function(l){var f=l.test(/gecko/i),A=l.test(/like gecko/i);return f&&!A},describe:function(l){var f={name:m.ENGINE_MAP.Gecko},A=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:m.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(l){var f={name:m.ENGINE_MAP.WebKit},A=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,l);return A&&(f.version=A),f}}];r.default=y,h.exports=r.default}})})});var Ac={};wl(Ac,{version:()=>zy});var zy,Cc=ds(()=>{X();zy="lab"});var Oc={};wl(Oc,{remoteConfig:()=>$y});var $y,Sc=ds(()=>{X();$y={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});var Ec=Je((Di,Ss)=>{X();(function(r,n){typeof Di=="object"&&typeof Ss=="object"?Ss.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Di=="object"?Di.Ably=n():r.Ably=n()})(window,function(){return function(h){var r={};function n(s){if(r[s])return r[s].exports;var i=r[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=r,n.d=function(s,i,m){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:m})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(i&1&&(s=n(s)),i&8||i&4&&typeof s=="object"&&s&&s.__esModule)return s;var m=Object.create(null);if(n.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:s}),i&2&&typeof s!="string")for(var y in s)n.d(m,y,function(l){return s[l]}.bind(null,y));return m},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=41)}([function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(){}return i}();r.default=s},function(h,r,n){"use strict";n.r(r),n.d(r,"__extends",function(){return i}),n.d(r,"__assign",function(){return m}),n.d(r,"__rest",function(){return y}),n.d(r,"__decorate",function(){return l}),n.d(r,"__param",function(){return f}),n.d(r,"__metadata",function(){return A}),n.d(r,"__awaiter",function(){return S}),n.d(r,"__generator",function(){return R}),n.d(r,"__createBinding",function(){return a}),n.d(r,"__exportStar",function(){return E}),n.d(r,"__values",function(){return M}),n.d(r,"__read",function(){return P}),n.d(r,"__spread",function(){return O}),n.d(r,"__spreadArrays",function(){return b}),n.d(r,"__spreadArray",function(){return T}),n.d(r,"__await",function(){return c}),n.d(r,"__asyncGenerator",function(){return g}),n.d(r,"__asyncDelegator",function(){return d}),n.d(r,"__asyncValues",function(){return p}),n.d(r,"__makeTemplateObject",function(){return u}),n.d(r,"__importStar",function(){return _}),n.d(r,"__importDefault",function(){return L}),n.d(r,"__classPrivateFieldGet",function(){return W}),n.d(r,"__classPrivateFieldSet",function(){return H});var s=function(U,I){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,z){x.__proto__=z}||function(x,z){for(var k in z)Object.prototype.hasOwnProperty.call(z,k)&&(x[k]=z[k])},s(U,I)};function i(U,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");s(U,I);function x(){this.constructor=U}U.prototype=I===null?Object.create(I):(x.prototype=I.prototype,new x)}var m=function(){return m=Object.assign||function(I){for(var x,z=1,k=arguments.length;z<k;z++){x=arguments[z];for(var J in x)Object.prototype.hasOwnProperty.call(x,J)&&(I[J]=x[J])}return I},m.apply(this,arguments)};function y(U,I){var x={};for(var z in U)Object.prototype.hasOwnProperty.call(U,z)&&I.indexOf(z)<0&&(x[z]=U[z]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,z=Object.getOwnPropertySymbols(U);k<z.length;k++)I.indexOf(z[k])<0&&Object.prototype.propertyIsEnumerable.call(U,z[k])&&(x[z[k]]=U[z[k]]);return x}function l(U,I,x,z){var k=arguments.length,J=k<3?I:z===null?z=Object.getOwnPropertyDescriptor(I,x):z,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(U,I,x,z);else for(var Q=U.length-1;Q>=0;Q--)(ee=U[Q])&&(J=(k<3?ee(J):k>3?ee(I,x,J):ee(I,x))||J);return k>3&&J&&Object.defineProperty(I,x,J),J}function f(U,I){return function(x,z){I(x,z,U)}}function A(U,I){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(U,I)}function S(U,I,x,z){function k(J){return J instanceof x?J:new x(function(ee){ee(J)})}return new(x||(x=Promise))(function(J,ee){function Q(B){try{D(z.next(B))}catch(V){ee(V)}}function G(B){try{D(z.throw(B))}catch(V){ee(V)}}function D(B){B.done?J(B.value):k(B.value).then(Q,G)}D((z=z.apply(U,I||[])).next())})}function R(U,I){var x={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},z,k,J,ee;return ee={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function Q(D){return function(B){return G([D,B])}}function G(D){if(z)throw new TypeError("Generator is already executing.");for(;x;)try{if(z=1,k&&(J=D[0]&2?k.return:D[0]?k.throw||((J=k.return)&&J.call(k),0):k.next)&&!(J=J.call(k,D[1])).done)return J;switch(k=0,J&&(D=[D[0]&2,J.value]),D[0]){case 0:case 1:J=D;break;case 4:return x.label++,{value:D[1],done:!1};case 5:x.label++,k=D[1],D=[0];continue;case 7:D=x.ops.pop(),x.trys.pop();continue;default:if(J=x.trys,!(J=J.length>0&&J[J.length-1])&&(D[0]===6||D[0]===2)){x=0;continue}if(D[0]===3&&(!J||D[1]>J[0]&&D[1]<J[3])){x.label=D[1];break}if(D[0]===6&&x.label<J[1]){x.label=J[1],J=D;break}if(J&&x.label<J[2]){x.label=J[2],x.ops.push(D);break}J[2]&&x.ops.pop(),x.trys.pop();continue}D=I.call(U,x)}catch(B){D=[6,B],k=0}finally{z=J=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var a=Object.create?function(U,I,x,z){z===void 0&&(z=x),Object.defineProperty(U,z,{enumerable:!0,get:function(){return I[x]}})}:function(U,I,x,z){z===void 0&&(z=x),U[z]=I[x]};function E(U,I){for(var x in U)x!=="default"&&!Object.prototype.hasOwnProperty.call(I,x)&&a(I,U,x)}function M(U){var I=typeof Symbol=="function"&&Symbol.iterator,x=I&&U[I],z=0;if(x)return x.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&z>=U.length&&(U=void 0),{value:U&&U[z++],done:!U}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(U,I){var x=typeof Symbol=="function"&&U[Symbol.iterator];if(!x)return U;var z=x.call(U),k,J=[],ee;try{for(;(I===void 0||I-- >0)&&!(k=z.next()).done;)J.push(k.value)}catch(Q){ee={error:Q}}finally{try{k&&!k.done&&(x=z.return)&&x.call(z)}finally{if(ee)throw ee.error}}return J}function O(){for(var U=[],I=0;I<arguments.length;I++)U=U.concat(P(arguments[I]));return U}function b(){for(var U=0,I=0,x=arguments.length;I<x;I++)U+=arguments[I].length;for(var z=Array(U),k=0,I=0;I<x;I++)for(var J=arguments[I],ee=0,Q=J.length;ee<Q;ee++,k++)z[k]=J[ee];return z}function T(U,I,x){if(x||arguments.length===2)for(var z=0,k=I.length,J;z<k;z++)(J||!(z in I))&&(J||(J=Array.prototype.slice.call(I,0,z)),J[z]=I[z]);return U.concat(J||Array.prototype.slice.call(I))}function c(U){return this instanceof c?(this.v=U,this):new c(U)}function g(U,I,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=x.apply(U,I||[]),k,J=[];return k={},ee("next"),ee("throw"),ee("return"),k[Symbol.asyncIterator]=function(){return this},k;function ee(j){z[j]&&(k[j]=function(te){return new Promise(function(le,me){J.push([j,te,le,me])>1||Q(j,te)})})}function Q(j,te){try{G(z[j](te))}catch(le){V(J[0][3],le)}}function G(j){j.value instanceof c?Promise.resolve(j.value.v).then(D,B):V(J[0][2],j)}function D(j){Q("next",j)}function B(j){Q("throw",j)}function V(j,te){j(te),J.shift(),J.length&&Q(J[0][0],J[0][1])}}function d(U){var I,x;return I={},z("next"),z("throw",function(k){throw k}),z("return"),I[Symbol.iterator]=function(){return this},I;function z(k,J){I[k]=U[k]?function(ee){return(x=!x)?{value:c(U[k](ee)),done:k==="return"}:J?J(ee):ee}:J}}function p(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I=U[Symbol.asyncIterator],x;return I?I.call(U):(U=typeof M=="function"?M(U):U[Symbol.iterator](),x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x);function z(J){x[J]=U[J]&&function(ee){return new Promise(function(Q,G){ee=U[J](ee),k(Q,G,ee.done,ee.value)})}}function k(J,ee,Q,G){Promise.resolve(G).then(function(D){J({value:D,done:Q})},ee)}}function u(U,I){return Object.defineProperty?Object.defineProperty(U,"raw",{value:I}):U.raw=I,U}var C=Object.create?function(U,I){Object.defineProperty(U,"default",{enumerable:!0,value:I})}:function(U,I){U.default=I};function _(U){if(U&&U.__esModule)return U;var I={};if(U!=null)for(var x in U)x!=="default"&&Object.prototype.hasOwnProperty.call(U,x)&&a(I,U,x);return C(I,U),I}function L(U){return U&&U.__esModule?U:{default:U}}function W(U,I,x,z){if(x==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof I=="function"?U!==I||!z:!I.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?z:x==="a"?z.call(U):z?z.value:I.get(U)}function H(U,I,x,z,k){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!k)throw new TypeError("Private accessor was defined without a setter");if(typeof I=="function"?U!==I||!k:!I.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?k.call(U,x):k?k.value=x:I.set(U,x),x}},function(h,r,n){"use strict";(function(s){r.__esModule=!0,r.allToUpperCase=r.allToLowerCase=r.encodeBody=r.decodeBody=r.Format=r.promisify=r.trim=r.arrChooseN=r.randomHexString=r.randomString=r.cheapRandStr=r.dataSizeBytes=r.inspectBody=r.inspectError=r.isErrorInfo=r.now=r.parseQueryString=r.toQueryString=r.arrPopRandomElement=r.defaultPostHeaders=r.defaultGetHeaders=r.allSame=r.arrEvery=r.arrFilter=r.arrMap=r.safeArrForEach=r.arrForEach=r.forInOwnNonNullProperties=r.valuesArray=r.keysArray=r.arrWithoutValue=r.arrDeleteValue=r.arrIn=r.arrIndexOf=r.arrSubtract=r.arrIntersectOb=r.arrIntersect=r.intersect=r.containsValue=r.inherits=r.prototypicalClone=r.shallowClone=r.isEmptyArg=r.isOnlyPropIn=r.isEmpty=r.isObject=r.ensureArray=r.isArray=r.copy=r.mixin=void 0,r.getGlobalObject=r.getJitterCoefficient=r.getBackoffCoefficient=void 0;var i=n(1),m=i.__importDefault(n(0)),y=i.__importDefault(n(8));function l(Z){return Math.floor(Math.random()*Z.length)}function f(Z){for(var ie=[],ue=1;ue<arguments.length;ue++)ie[ue-1]=arguments[ue];for(var pe=0;pe<ie.length;pe++){var Re=ie[pe];if(!Re)break;var Qe=Object.prototype.hasOwnProperty;for(var fn in Re)(!Qe||Qe.call(Re,fn))&&(Z[fn]=Re[fn])}return Z}r.mixin=f;function A(Z){return f({},Z)}r.copy=A,r.isArray=Array.isArray||function(Z){return Object.prototype.toString.call(Z)=="[object Array]"};function S(Z){return M(Z)?[]:r.isArray(Z)?Z:[Z]}r.ensureArray=S;function R(Z){return Object.prototype.toString.call(Z)=="[object Object]"}r.isObject=R;function a(Z){for(var ie in Z)return!1;return!0}r.isEmpty=a;function E(Z,ie){for(var ue in Z)if(ue!==ie)return!1;return!0}r.isOnlyPropIn=E;function M(Z){return Z==null}r.isEmptyArg=M;function P(Z){var ie=new Object;for(var ue in Z)ie[ue]=Z[ue];return ie}r.shallowClone=P;function O(Z,ie){var ue=function(){function Re(){}return Re}();ue.prototype=Z;var pe=new ue;return ie&&f(pe,ie),pe}r.prototypicalClone=O;var b=function(Z,ie){if(m.default.Config.inherits){m.default.Config.inherits(Z,ie);return}Z.super_=ie,Z.prototype=O(ie.prototype,{constructor:Z})};r.inherits=b;function T(Z,ie){for(var ue in Z)if(Z[ue]==ie)return!0;return!1}r.containsValue=T;function c(Z,ie){return r.isArray(ie)?g(Z,ie):d(Z,ie)}r.intersect=c;function g(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];r.arrIndexOf(ie,Re)!=-1&&ue.push(Re)}return ue}r.arrIntersect=g;function d(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];Re in ie&&ue.push(Re)}return ue}r.arrIntersectOb=d;function p(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];r.arrIndexOf(ie,Re)==-1&&ue.push(Re)}return ue}r.arrSubtract=p,r.arrIndexOf=Array.prototype.indexOf?function(Z,ie,ue){return Z.indexOf(ie,ue)}:function(Z,ie,ue){ue=ue||0;for(var pe=Z.length;ue<pe;ue++)if(Z[ue]===ie)return ue;return-1};function u(Z,ie){return r.arrIndexOf(Z,ie)!==-1}r.arrIn=u;function C(Z,ie){var ue=r.arrIndexOf(Z,ie),pe=ue!=-1;return pe&&Z.splice(ue,1),pe}r.arrDeleteValue=C;function _(Z,ie){var ue=Z.slice();return C(ue,ie),ue}r.arrWithoutValue=_;function L(Z,ie){var ue=[];for(var pe in Z)ie&&!Object.prototype.hasOwnProperty.call(Z,pe)||ue.push(pe);return ue}r.keysArray=L;function W(Z,ie){var ue=[];for(var pe in Z)ie&&!Object.prototype.hasOwnProperty.call(Z,pe)||ue.push(Z[pe]);return ue}r.valuesArray=W;function H(Z,ie){for(var ue in Z)Object.prototype.hasOwnProperty.call(Z,ue)&&Z[ue]&&ie(ue)}r.forInOwnNonNullProperties=H,r.arrForEach=Array.prototype.forEach?function(Z,ie){Z.forEach(ie)}:function(Z,ie){for(var ue=Z.length,pe=0;pe<ue;pe++)ie(Z[pe],pe,Z)};function U(Z,ie){return r.arrForEach(Z.slice(),ie)}r.safeArrForEach=U,r.arrMap=Array.prototype.map?function(Z,ie){return Z.map(ie)}:function(Z,ie){for(var ue=[],pe=Z.length,Re=0;Re<pe;Re++)ue.push(ie(Z[Re],Re,Z));return ue},r.arrFilter=Array.prototype.filter?function(Z,ie){return Z.filter(ie)}:function(Z,ie){for(var ue=[],pe=Z.length,Re=0;Re<pe;Re++)ie(Z[Re])&&ue.push(Z[Re]);return ue},r.arrEvery=Array.prototype.every?function(Z,ie){return Z.every(ie)}:function(Z,ie){for(var ue=Z.length,pe=0;pe<ue;pe++)if(!ie(Z[pe],pe,Z))return!1;return!0};function I(Z,ie){if(Z.length===0)return!0;var ue=Z[0][ie];return r.arrEvery(Z,function(pe){return pe[ie]===ue})}r.allSame=I;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(Z){var ie=x[Z||Se.json];return{accept:ie,"X-Ably-Version":y.default.apiVersion,"Ably-Agent":y.default.agent}}r.defaultGetHeaders=z;function k(Z){var ie,ue=ie=x[Z||Se.json];return{accept:ue,"content-type":ie,"X-Ably-Version":y.default.apiVersion,"Ably-Agent":y.default.agent}}r.defaultPostHeaders=k;function J(Z){return Z.splice(l(Z),1)[0]}r.arrPopRandomElement=J;function ee(Z){var ie=[];if(Z)for(var ue in Z)ie.push(encodeURIComponent(ue)+"="+encodeURIComponent(Z[ue]));return ie.length?"?"+ie.join("&"):""}r.toQueryString=ee;function Q(Z){for(var ie,ue=/([^?&=]+)=?([^&]*)/g,pe={};ie=ue.exec(Z);)pe[decodeURIComponent(ie[1])]=decodeURIComponent(ie[2]);return pe}r.parseQueryString=Q,r.now=Date.now||function(){return new Date().getTime()};function G(Z){return Z.constructor.name=="ErrorInfo"}r.isErrorInfo=G;function D(Z){var ie,ue;return Z instanceof Error||((ue=(ie=Z)===null||ie===void 0?void 0:ie.constructor)===null||ue===void 0?void 0:ue.name)==="ErrorInfo"?m.default.Config.inspect(Z):Z.toString()}r.inspectError=D;function B(Z){return m.default.BufferUtils.isBuffer(Z)?Z.toString():typeof Z=="string"?Z:m.default.Config.inspect(Z)}r.inspectBody=B;function V(Z){if(m.default.BufferUtils.isBuffer(Z))return m.default.BufferUtils.byteLength(Z);if(typeof Z=="string")return m.default.Config.stringByteSize(Z);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof Z)}r.dataSizeBytes=V;function j(){return String(Math.random()).substr(2)}r.cheapRandStr=j;var te=function(Z){if(m.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ie=new Uint8Array(Z);return m.default.Config.getRandomValues(ie),m.default.BufferUtils.base64Encode(ie)}for(var ue=m.default.BufferUtils.base64CharSet,pe=Math.round(Z*4/3),Re="",Qe=0;Qe<pe;Qe++)Re+=ue[l(ue)];return Re};r.randomString=te;var le=function(Z){if(m.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ie=new Uint8Array(Z);return m.default.Config.getRandomValues(ie),m.default.BufferUtils.hexEncode(ie)}for(var ue=m.default.BufferUtils.hexCharSet,pe=Z*2,Re="",Qe=0;Qe<pe;Qe++)Re+=ue[l(ue)];return Re};r.randomHexString=le;function me(Z,ie){for(var ue=Math.min(ie,Z.length),pe=Z.slice(),Re=[],Qe=0;Qe<ue;Qe++)Re.push(J(pe));return Re}r.arrChooseN=me,r.trim=String.prototype.trim?function(Z){return Z.trim()}:function(Z){return Z.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ve(Z,ie,ue){return new Promise(function(pe,Re){Z[ie].apply(Z,i.__spreadArray(i.__spreadArray([],ue),[function(Qe,fn){Qe?Re(Qe):pe(fn)}]))})}r.promisify=ve;var Se;(function(Z){Z.msgpack="msgpack",Z.json="json"})(Se=r.Format||(r.Format={}));function Le(Z,ie){return ie=="msgpack"?m.default.Config.msgpack.decode(Z):JSON.parse(String(Z))}r.decodeBody=Le;function de(Z,ie){return ie=="msgpack"?m.default.Config.msgpack.encode(Z,!0):JSON.stringify(Z)}r.encodeBody=de;function xe(Z){return Z.map(function(ie){return ie&&ie.toLowerCase()})}r.allToLowerCase=xe;function et(Z){return Z.map(function(ie){return ie&&ie.toUpperCase()})}r.allToUpperCase=et;function Be(Z){return Math.min((Z+2)/3,2)}r.getBackoffCoefficient=Be;function ke(){return 1-Math.random()*.2}r.getJitterCoefficient=ke;function ct(){return s||(typeof window!="undefined"?window:self)}r.getGlobalObject=ct}).call(this,n(12))},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importDefault(n(0)),y=s||(typeof window!="undefined"?window:self),l;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(l||(l={}));function f(a,E){return(""+a).padStart(E?3:2,"0")}function A(a){return m.default.Config.logTimestamps?function(E){var M=new Date;a(f(M.getHours())+":"+f(M.getMinutes())+":"+f(M.getSeconds())+"."+f(M.getMilliseconds(),1)+" "+E)}:a}var S=function(){var a,E,M,P;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((E=(a=y==null?void 0:y.console)===null||a===void 0?void 0:a.log)===null||E===void 0?void 0:E.apply)=="function"?(M=function(){for(var O=[],b=0;b<arguments.length;b++)O[b]=arguments[b]},P=console.warn?function(){for(var O=[],b=0;b<arguments.length;b++)O[b]=arguments[b]}:M):y!=null&&y.console.log?M=P=function(){Function.prototype.apply.call(console.log,console,arguments)}:M=P=function(){},[M,P].map(A)},R=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var E=S(),M=E[0],P=E[1];this.logHandler=M,this.logErrorHandler=P},a.logLevel=l.Error,a.LOG_NONE=l.None,a.LOG_ERROR=l.Error,a.LOG_MAJOR=l.Major,a.LOG_MINOR=l.Minor,a.LOG_MICRO=l.Micro,a.LOG_DEFAULT=l.Error,a.LOG_DEBUG=l.Micro,a.logAction=function(E,M,P){a.shouldLog(E)&&(E===l.Error?a.logErrorHandler:a.logHandler)("Ably: "+M+": "+P)},a.deprecated=function(E,M){a.deprecatedWithMsg(E,"Please use '"+M+"' instead.")},a.deprecatedWithMsg=function(E,M){a.shouldLog(l.Error)&&a.logErrorHandler("Ably: Deprecation warning - '"+E+"' is deprecated and will be removed from a future version. "+M)},a.shouldLog=function(E){return E<=a.logLevel},a.setLog=function(E,M){E!==void 0&&(a.logLevel=E),M!==void 0&&(a.logHandler=a.logErrorHandler=M)},a}();r.default=R}).call(this,n(12))},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var i=s,m=i.lib,y=m.WordArray,l=y.init,f=y.init=function(A){if(A instanceof ArrayBuffer&&(A=new Uint8Array(A)),(A instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&A instanceof Uint8ClampedArray||A instanceof Int16Array||A instanceof Uint16Array||A instanceof Int32Array||A instanceof Uint32Array||A instanceof Float32Array||A instanceof Float64Array)&&(A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength)),A instanceof Uint8Array){for(var S=A.byteLength,R=[],a=0;a<S;a++)R[a>>>2]|=A[a]<<24-a%4*8;l.call(this,R,S)}else l.apply(this,arguments)};f.prototype=y}}(),s.lib.WordArray})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=function(){function l(f,A,S,R){this.message=f,this.code=A,this.statusCode=S,this.cause=R}return l.prototype.toString=function(){var f="["+this.constructor.name;return this.message&&(f+=": "+this.message),this.statusCode&&(f+="; statusCode="+this.statusCode),this.code&&(f+="; code="+this.code),this.cause&&(f+="; cause="+m.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(f+="; see "+this.href+" "),f+="]",f},l.fromValues=function(f){var A=f,S=A.message,R=A.code,a=A.statusCode;if(typeof S!="string"||typeof R!="number"||typeof a!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(f));var E=Object.assign(new l(S,R,a),f);return E.code&&!E.href&&(E.href="https://help.ably.io/error/"+E.code),E},l}();r.default=y},function(h,r,n){(function(s){(function(i,m){h.exports=r=m()})(this,function(){var i=i||function(m,y){var l;if(typeof window!="undefined"&&window.crypto&&(l=window.crypto),!l&&typeof window!="undefined"&&window.msCrypto&&(l=window.msCrypto),!l&&typeof s!="undefined"&&s.crypto&&(l=s.crypto),!l)try{l=n(44)}catch(d){}var f=function(){if(l){if(typeof l.getRandomValues=="function")try{return l.getRandomValues(new Uint32Array(1))[0]}catch(d){}if(typeof l.randomBytes=="function")try{return l.randomBytes(4).readInt32LE()}catch(d){}}throw new Error("Native crypto module could not be used to get secure random number.")},A=Object.create||function(){function d(){}return function(p){var u;return d.prototype=p,u=new d,d.prototype=null,u}}(),S={},R=S.lib={},a=R.Base=function(){return{extend:function(d){var p=A(this);return d&&p.mixIn(d),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var p in d)d.hasOwnProperty(p)&&(this[p]=d[p]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=R.WordArray=a.extend({init:function(d,p){d=this.words=d||[],p!=y?this.sigBytes=p:this.sigBytes=d.length*4},toString:function(d){return(d||P).stringify(this)},concat:function(d){var p=this.words,u=d.words,C=this.sigBytes,_=d.sigBytes;if(this.clamp(),C%4)for(var L=0;L<_;L++){var W=u[L>>>2]>>>24-L%4*8&255;p[C+L>>>2]|=W<<24-(C+L)%4*8}else for(var L=0;L<_;L+=4)p[C+L>>>2]=u[L>>>2];return this.sigBytes+=_,this},clamp:function(){var d=this.words,p=this.sigBytes;d[p>>>2]&=4294967295<<32-p%4*8,d.length=m.ceil(p/4)},clone:function(){var d=a.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var p=[],u=0;u<d;u+=4)p.push(f());return new E.init(p,d)}}),M=S.enc={},P=M.Hex={stringify:function(d){for(var p=d.words,u=d.sigBytes,C=[],_=0;_<u;_++){var L=p[_>>>2]>>>24-_%4*8&255;C.push((L>>>4).toString(16)),C.push((L&15).toString(16))}return C.join("")},parse:function(d){for(var p=d.length,u=[],C=0;C<p;C+=2)u[C>>>3]|=parseInt(d.substr(C,2),16)<<24-C%8*4;return new E.init(u,p/2)}},O=M.Latin1={stringify:function(d){for(var p=d.words,u=d.sigBytes,C=[],_=0;_<u;_++){var L=p[_>>>2]>>>24-_%4*8&255;C.push(String.fromCharCode(L))}return C.join("")},parse:function(d){for(var p=d.length,u=[],C=0;C<p;C++)u[C>>>2]|=(d.charCodeAt(C)&255)<<24-C%4*8;return new E.init(u,p)}},b=M.Utf8={stringify:function(d){try{return decodeURIComponent(escape(O.stringify(d)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(d){return O.parse(unescape(encodeURIComponent(d)))}},T=R.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=b.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var p,u=this._data,C=u.words,_=u.sigBytes,L=this.blockSize,W=L*4,H=_/W;d?H=m.ceil(H):H=m.max((H|0)-this._minBufferSize,0);var U=H*L,I=m.min(U*4,_);if(U){for(var x=0;x<U;x+=L)this._doProcessBlock(C,x);p=C.splice(0,U),u.sigBytes-=I}return new E.init(p,I)},clone:function(){var d=a.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0}),c=R.Hasher=T.extend({cfg:a.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(d){return function(p,u){return new d.init(u).finalize(p)}},_createHmacHelper:function(d){return function(p,u){return new g.HMAC.init(d,u).finalize(p)}}}),g=S.algo={};return S}(Math);return i})}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(0));function l(S,R,a){try{R.apply(S,a)}catch(E){m.default.logAction(m.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function f(S,R,a){for(var E,M,P,O=0;O<S.length;O++)if(E=S[O],a&&(E=E[a]),i.isArray(E)){for(;(M=i.arrIndexOf(E,R))!==-1;)E.splice(M,1);a&&E.length===0&&delete S[O][a]}else if(i.isObject(E))for(P in E)Object.prototype.hasOwnProperty.call(E,P)&&i.isArray(E[P])&&f([E],R,P)}var A=function(){function S(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return S.prototype.on=function(){for(var R=this,a=[],E=0;E<arguments.length;E++)a[E]=arguments[E];if(a.length===1){var M=a[0];if(typeof M=="function")this.any.push(M);else throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a))}if(a.length===2){var P=a[0],O=a[1];if(typeof O!="function")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a));if(i.isEmptyArg(P))this.any.push(O);else if(i.isArray(P))P.forEach(function(T){R.on(T,O)});else{if(typeof P!="string")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a));var b=this.events[P]||(this.events[P]=[]);b.push(O)}}},S.prototype.off=function(){for(var R,a=this,E=[],M=0;M<arguments.length;M++)E[M]=arguments[M];if(E.length==0||i.isEmptyArg(E[0])&&i.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var P=E[0],O=E[1],b=null,T=null;if(E.length===1||!O)typeof P=="function"?b=P:T=P;else{if(typeof O!="function")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(E));R=[P,O],T=R[0],b=R[1]}if(b&&i.isEmptyArg(T)){f([this.any,this.events,this.anyOnce,this.eventsOnce],b);return}if(i.isArray(T)){T.forEach(function(c){a.off(c,b)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(E));b?f([this.events,this.eventsOnce],b,T):(delete this.events[T],delete this.eventsOnce[T])},S.prototype.listeners=function(R){if(R){var a=this.events[R]||[];return this.eventsOnce[R]&&Array.prototype.push.apply(a,this.eventsOnce[R]),a.length?a:null}return this.any.length?this.any:null},S.prototype.emit=function(R){for(var a=[],E=1;E<arguments.length;E++)a[E-1]=arguments[E];var M={event:R},P=[];this.anyOnce.length&&(Array.prototype.push.apply(P,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(P,this.any);var O=this.eventsOnce[R];O&&(Array.prototype.push.apply(P,O),delete this.eventsOnce[R]);var b=this.events[R];b&&Array.prototype.push.apply(P,b),i.arrForEach(P,function(T){l(M,T,a)})},S.prototype.once=function(){for(var R=this,a=[],E=0;E<arguments.length;E++)a[E]=arguments[E];var M=a.length;if((M===0||M===1&&typeof a[0]!="function")&&y.default.Config.Promise){var P=a[0];if(typeof P!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));return new y.default.Config.Promise(function(d){R.once(P,d)})}var O=a[0],b=a[1];if(a.length===1&&typeof O=="function")this.anyOnce.push(O);else if(i.isEmptyArg(O)){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));this.anyOnce.push(b)}else if(i.isArray(O)){var T=this,c=function(){var d=Array.prototype.slice.call(arguments);if(i.arrForEach(O,function(p){T.off(p,c)}),typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));b.apply(this,d)};i.arrForEach(O,function(d){T.on(d,c)})}else{if(typeof O!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));var g=this.eventsOnce[O]||(this.eventsOnce[O]=[]);if(b){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));g.push(b)}}},S.prototype.whenState=function(R,a,E){for(var M=this,P=[],O=3;O<arguments.length;O++)P[O-3]=arguments[O];var b={event:R};if(typeof R!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&y.default.Config.Promise)return new y.default.Config.Promise(function(T){S.prototype.whenState.apply(M,[R,a,T].concat(P))});R===a?l(b,E,P):this.once(R,E)},S}();r.default=A},function(h,r,n){"use strict";r.__esModule=!0,r.getDefaults=r.normaliseOptions=r.objectifyOptions=r.getHosts=r.getFallbackHosts=r.environmentFallbackHosts=r.getHttpScheme=r.getPort=r.getHost=void 0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(3)),l=s.__importDefault(n(5)),f=n(42),A="ably-js/"+f.version,S={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:f.version,apiVersion:"1.2",agent:A,getHost:R,getPort:a,getHttpScheme:E,environmentFallbackHosts:M,getFallbackHosts:P,getHosts:O,checkHost:b,objectifyOptions:g,normaliseOptions:d};function R(u,C,_){return _?C=C==u.restHost&&u.realtimeHost||C||u.realtimeHost:C=C||u.restHost,C}r.getHost=R;function a(u,C){return C||u.tls?u.tlsPort:u.port}r.getPort=a;function E(u){return u.tls?"https://":"http://"}r.getHttpScheme=E;function M(u){return[u+"-a-fallback.ably-realtime.com",u+"-b-fallback.ably-realtime.com",u+"-c-fallback.ably-realtime.com",u+"-d-fallback.ably-realtime.com",u+"-e-fallback.ably-realtime.com"]}r.environmentFallbackHosts=M;function P(u){var C=u.fallbackHosts,_=typeof u.httpMaxRetryCount!="undefined"?u.httpMaxRetryCount:S.httpMaxRetryCount;return C?m.arrChooseN(C,_):[]}r.getFallbackHosts=P;function O(u){return[u.restHost].concat(P(u))}r.getHosts=O;function b(u){if(typeof u!="string")throw new l.default("host must be a string; was a "+typeof u,4e4,400);if(!u.length)throw new l.default("host must not be zero-length",4e4,400)}function T(u,C,_){return u.realtimeHost?u.realtimeHost:u.restHost?(y.default.logAction(y.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+u.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+u.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),u.restHost):C?S.REALTIME_HOST:_+"-"+S.REALTIME_HOST}function c(u){var C={};for(var _ in S.TIMEOUTS)C[_]=u[_]||S.TIMEOUTS[_];return C}function g(u){return typeof u=="string"?u.indexOf(":")==-1?{token:u}:{key:u}:u}r.objectifyOptions=g;function d(u){if(u.host&&(y.default.deprecated("host","restHost"),u.restHost=u.host),u.wsHost&&(y.default.deprecated("wsHost","realtimeHost"),u.realtimeHost=u.wsHost),u.queueEvents&&(y.default.deprecated("queueEvents","queueMessages"),u.queueMessages=u.queueEvents),u.fallbackHostsUseDefault){if(u.fallbackHosts){var C="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",C),new l.default(C,4e4,400)}if(u.port||u.tlsPort){var C="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",C),new l.default(C,4e4,400)}u.environment?y.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):y.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),u.fallbackHosts=S.FALLBACK_HOSTS}u.recover===!0&&(y.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),u.recover=function(z,k){k(!0)}),typeof u.recover=="function"&&u.closeOnUnload===!0&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),u.recover=void 0),"closeOnUnload"in u||(u.closeOnUnload=!u.recover),u.transports&&m.arrIn(u.transports,"xhr")&&(y.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),m.arrDeleteValue(u.transports,"xhr"),u.transports.push("xhr_streaming")),"queueMessages"in u||(u.queueMessages=!0);var _=u.environment&&String(u.environment).toLowerCase()||S.ENVIRONMENT,L=!_||_==="production";!u.fallbackHosts&&!u.restHost&&!u.realtimeHost&&!u.port&&!u.tlsPort&&(u.fallbackHosts=L?S.FALLBACK_HOSTS:M(_));var W=u.restHost||(L?S.REST_HOST:_+"-"+S.REST_HOST),H=T(u,L,_);m.arrForEach((u.fallbackHosts||[]).concat(W,H),b),u.port=u.port||S.PORT,u.tlsPort=u.tlsPort||S.TLS_PORT,"tls"in u||(u.tls=!0);var U=c(u);if("useBinaryProtocol"in u?u.useBinaryProtocol=i.default.Config.supportsBinary&&u.useBinaryProtocol:u.useBinaryProtocol=i.default.Config.preferBinary,u.clientId){var I=u.headers=u.headers||{};I["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(u.clientId))}if("idempotentRestPublishing"in u||(u.idempotentRestPublishing=!0),u.promises&&!i.default.Config.Promise&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),u.promises=!1),u.agents)for(var x in u.agents)S.agent+=" "+x+"/"+u.agents[x];return s.__assign(s.__assign({},u),{useBinaryProtocol:"useBinaryProtocol"in u?i.default.Config.supportsBinary&&u.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:H,restHost:W,maxMessageSize:u.maxMessageSize||S.maxMessageSize,timeouts:U})}r.normaliseOptions=d,r.default=S;function p(u){return Object.assign(S,u)}r.getDefaults=p},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importDefault(n(3)),y=s.__importDefault(n(5)),l=s.__importStar(n(2));function f(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function A(a){if(a&&a.cipher&&!a.cipher.channelCipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=i.default.Crypto.getCipher(a.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return a}function S(a){var E=0;return a.name&&(E+=a.name.length),a.clientId&&(E+=a.clientId.length),a.extras&&(E+=JSON.stringify(a.extras).length),a.data&&(E+=l.dataSizeBytes(a.data)),E}var R=function(){function a(){}return a.prototype.toJSON=function(){var E=this.encoding,M=this.data;return M&&i.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(E=E?E+"/base64":"base64",M=i.default.BufferUtils.base64Encode(M)):M=i.default.BufferUtils.toBuffer(M)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:M}},a.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},a.encrypt=function(E,M,P){var O=E.data,b=E.encoding,T=M.channelCipher;b=b?b+"/":"",i.default.BufferUtils.isBuffer(O)||(O=i.default.BufferUtils.utf8Encode(String(O)),b=b+"utf-8/"),T.encrypt(O,function(c,g){if(c){P(c);return}E.data=g,E.encoding=b+"cipher+"+T.algorithm,P(null,E)})},a.encode=function(E,M,P){var O=E.data,b=typeof O=="string"||i.default.BufferUtils.isBuffer(O)||O===null||O===void 0;if(!b)if(l.isObject(O)||l.isArray(O))E.data=JSON.stringify(O),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new y.default("Data type is unsupported",40013,400);M!=null&&M.cipher?a.encrypt(E,M,P):P(null,E)},a.encodeArray=function(E,M,P){for(var O=0,b=0;b<E.length;b++)a.encode(E[b],M,function(T){if(T){P(T);return}O++,O==E.length&&P(null,E)})},a.decode=function(E,M){var P=f(M),O=E.data,b=E.encoding;if(b){var T=b.split("/"),c=void 0,g=T.length,d=E.data,p="";try{for(;(c=g)>0;){var u=T[--g].match(/([-\w]+)(\+([\w-]+))?/);if(!u)break;switch(p=u[1],p){case"base64":d=i.default.BufferUtils.base64Decode(String(d)),c==T.length&&(O=d);continue;case"utf-8":d=i.default.BufferUtils.utf8Decode(d);continue;case"json":d=JSON.parse(d);continue;case"cipher":if(P.channelOptions!=null&&P.channelOptions.cipher&&P.channelOptions.channelCipher){var C=u[3],_=P.channelOptions.channelCipher;if(C!=_.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");d=_.decrypt(d);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!P.plugins||!P.plugins.vcdiff)throw new y.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new y.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=P.baseEncodedPreviousPayload;typeof L=="string"&&(L=i.default.BufferUtils.utf8Encode(L)),L=i.default.BufferUtils.toBuffer(L),d=i.default.BufferUtils.toBuffer(d),d=i.default.BufferUtils.typedArrayToBuffer(P.plugins.vcdiff.decode(d,L)),O=d}catch(H){throw new y.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var W=H;throw new y.default("Error processing the "+p+" encoding, decoder returned \u2018"+W.message+"\u2019",W.code||40013,400)}finally{E.encoding=c<=0?null:T.slice(0,c).join("/"),E.data=d}}P.baseEncodedPreviousPayload=O},a.fromResponseBody=function(E,M,P){P&&(E=l.decodeBody(E,P));for(var O=0;O<E.length;O++){var b=E[O]=a.fromValues(E[O]);try{a.decode(b,M)}catch(T){m.default.logAction(m.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return E},a.fromValues=function(E){return Object.assign(new a,E)},a.fromValuesArray=function(E){for(var M=E.length,P=new Array(M),O=0;O<M;O++)P[O]=a.fromValues(E[O]);return P},a.fromEncoded=function(E,M){var P=a.fromValues(E),O=A(M);try{a.decode(P,O)}catch(b){m.default.logAction(m.default.LOG_ERROR,"Message.fromEncoded()",b.toString())}return P},a.fromEncodedArray=function(E,M){return A(M),E.map(function(P){return a.fromEncoded(P,M)})},a.getMessagesSize=function(E){for(var M,P=0,O=0;O<E.length;O++)M=E[O],P+=M.size||(M.size=S(M));return P},a.serialize=l.encodeBody,a}();r.default=R},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(5)),y=s.__importDefault(n(9)),l=s.__importDefault(n(14)),f={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},A=[];Object.keys(f).forEach(function(P){A[f[P]]=P});var S={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},R=Object.keys(S);S.MODE_ALL=S.PRESENCE|S.PUBLISH|S.SUBSCRIBE|S.PRESENCE_SUBSCRIBE;function a(P){var O=[];if(P)for(var b=0;b<P.length;b++)O.push(P[b].toString());return"[ "+O.join(", ")+" ]"}var E="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),M=function(){function P(){var O=this;this.hasFlag=function(b){return(O.flags&S[b])>0}}return P.prototype.setFlag=function(O){return this.flags=this.flags|S[O]},P.prototype.getMode=function(){return this.flags&&this.flags&S.MODE_ALL},P.prototype.encodeModesToFlags=function(O){var b=this;O.forEach(function(T){return b.setFlag(T)})},P.prototype.decodeModesFromFlags=function(){var O=this,b=[];return P.channelModes.forEach(function(T){O.hasFlag(T)&&b.push(T)}),b.length>0?b:void 0},P.fromValues=function(O){return Object.assign(new P,O)},P.Action=f,P.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],P.ActionName=A,P.serialize=i.encodeBody,P.deserialize=function(O,b){var T=i.decodeBody(O,b);return P.fromDeserialized(T)},P.fromDeserialized=function(O){var b=O.error;b&&(O.error=m.default.fromValues(b));var T=O.messages;if(T)for(var c=0;c<T.length;c++)T[c]=y.default.fromValues(T[c]);var g=O.presence;if(g)for(var c=0;c<g.length;c++)g[c]=l.default.fromValues(g[c],!0);return Object.assign(new P,O)},P.stringify=function(O){var b="[ProtocolMessage";O.action!==void 0&&(b+="; action="+P.ActionName[O.action]||!1);for(var T,c=0;c<E.length;c++)T=E[c],O[T]!==void 0&&(b+="; "+T+"="+O[T]);if(O.messages&&(b+="; messages="+a(y.default.fromValuesArray(O.messages))),O.presence&&(b+="; presence="+a(l.default.fromValuesArray(O.presence))),O.error&&(b+="; error="+m.default.fromValues(O.error).toString()),O.auth&&O.auth.accessToken&&(b+="; token="+O.auth.accessToken),O.flags&&(b+="; flags="+R.filter(O.hasFlag).join(",")),O.params){var g="";i.forInOwnNonNullProperties(O.params,function(d){g.length>0&&(g+="; "),g+=d+"="+O.params[d]}),g.length>0&&(b+="; params=["+g+"]")}return b+="]",b},P.isDuplicate=function(O,b){if(O&&b&&(O.action===f.MESSAGE||O.action===f.PRESENCE)&&O.action===b.action&&O.channel===b.channel&&O.id===b.id){if(O.action===f.PRESENCE)return!0;if(O.messages.length===b.messages.length){for(var T=0;T<O.messages.length;T++){var c=O.messages[T],g=b.messages[T];if((c.extras&&c.extras.delta&&c.extras.delta.format)!==(g.extras&&g.extras.delta&&g.extras.delta.format))return!1}return!0}}return!1},P}();r.default=M},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(10)),y=s.__importDefault(n(26)),l=s.__importDefault(n(3)),f=s.__importDefault(n(8)),A=s.__importDefault(n(19)),S=s.__importDefault(n(16)),R=s.__importDefault(n(5)),a=s.__importDefault(n(20)),E=s.__importDefault(n(0));function M(b){var T=[80015,80017,80030];return b.code?S.default.isTokenErr(b)?!1:i.arrIn(T,b.code)?!0:b.code>=4e4&&b.code<5e4:!1}function P(b){return M(b)?[m.default.fromValues({action:m.default.Action.ERROR,error:b})]:[m.default.fromValues({action:m.default.Action.DISCONNECTED,error:b})]}var O=function(b){s.__extends(T,b);function T(c,g,d){var p=b.call(this,c,g,d,!0)||this;return p.onAuthUpdated=function(u){p.authParams={access_token:u.token}},p.stream="stream"in d?d.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return T.prototype.connect=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","starting"),y.default.prototype.connect.call(this);var g=this.params,d=g.options,p=f.default.getHost(d,g.host),u=f.default.getPort(d),C=d.tls?"https://":"http://";this.baseUri=C+p+":"+u+"/comet/";var _=this.baseUri+"connect";l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","uri: "+_),this.auth.getAuthParams(function(L,W){if(L){c.disconnect(L);return}if(!c.isDisposed){c.authParams=W;var H=c.params.getConnectParams(W);"stream"in H&&(c.stream=H.stream),l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(H));var U=!1,I=c.recvRequest=c.createRequest(_,null,H,null,c.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);I.on("data",function(x){!c.recvRequest||(U||(U=!0,c.emit("preconnect")),c.onData(x))}),I.on("complete",function(x){if(c.recvRequest||(x=x||new R.default("Request cancelled",80003,400)),c.recvRequest=null,!U&&!x&&(U=!0,c.emit("preconnect")),c.onActivity(),x){x.code?c.onData(P(x)):c.disconnect(x);return}E.default.Config.nextTick(function(){c.recv()})}),I.exec()}})},T.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(c){var g=this,d=c?this.closeUri:this.disconnectUri;if(d){var p=this.createRequest(d,null,this.authParams,null,a.default.REQ_SEND);p.on("complete",function(u){u&&(l.default.logAction(l.default.LOG_ERROR,"CometTransport.request"+(c?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(u)),g.finish("disconnected",u))}),p.exec()}},T.prototype.dispose=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",A.default.disconnected),E.default.Config.nextTick(function(){c.emit("disposed")}))},T.prototype.onConnect=function(c){if(!this.isDisposed){var g=c.connectionKey;y.default.prototype.onConnect.call(this,c);var d=this.baseUri+g;l.default.logAction(l.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+d+"; connectionKey = "+c.connectionKey),this.sendUri=d+"/send",this.recvUri=d+"/recv",this.closeUri=d+"/close",this.disconnectUri=d+"/disconnect"}},T.prototype.send=function(c){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(c);return}var g=this.pendingItems||[];g.push(c),this.pendingItems=null,this.sendItems(g)},T.prototype.sendAnyPending=function(){var c=this.pendingItems;!c||(this.pendingItems=null,this.sendItems(c))},T.prototype.sendItems=function(c){var g=this,d=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(c),a.default.REQ_SEND);d.on("complete",function(p,u){if(p&&l.default.logAction(l.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),g.sendRequest=null,p){p.code?g.onData(P(p)):g.disconnect(p);return}u&&g.onData(u),g.pendingItems&&E.default.Config.nextTick(function(){g.sendRequest||g.sendAnyPending()})}),d.exec()},T.prototype.recv=function(){var c=this;if(!this.recvRequest&&!!this.isConnected){var g=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);g.on("data",function(d){c.onData(d)}),g.on("complete",function(d){if(c.recvRequest=null,c.onActivity(),d){d.code?c.onData(P(d)):c.disconnect(d);return}E.default.Config.nextTick(function(){c.recv()})}),g.exec()}},T.prototype.onData=function(c){try{var g=this.decodeResponse(c);if(g&&g.length)for(var d=0;d<g.length;d++)this.onProtocolMessage(m.default.fromDeserialized(g[d]))}catch(p){l.default.logAction(l.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},T.prototype.encodeRequest=function(c){return JSON.stringify(c)},T.prototype.decodeResponse=function(c){return typeof c=="string"?JSON.parse(c):c},T}(y.default);r.default=O},function(h,r){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(s){typeof window=="object"&&(n=window)}h.exports=n},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,l=i.enc,f=l.Base64={stringify:function(S){var R=S.words,a=S.sigBytes,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.clamp();for(var M=[],P=0;P<a;P+=3)for(var O=R[P>>>2]>>>24-P%4*8&255,b=R[P+1>>>2]>>>24-(P+1)%4*8&255,T=R[P+2>>>2]>>>24-(P+2)%4*8&255,c=O<<16|b<<8|T,g=0;g<4&&P+g*.75<a;g++)M.push(E.charAt(c>>>6*(3-g)&63));var d=E.charAt(64);if(d)for(;M.length%4;)M.push(d);return M.join("")},parse:function(S){var R=S.length,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var M=0;M<a.length;M++)E[a.charCodeAt(M)]=M}var P=a.charAt(64);if(P){var O=S.indexOf(P);O!==-1&&(R=O)}return A(S,R,E)}};function A(S,R,a){for(var E=[],M=0,P=0;P<R;P++)if(P%4){var O=a[S.charCodeAt(P-1)]<<P%4*2,b=a[S.charCodeAt(P)]>>>6-P%4*2,T=O|b;E[M>>>2]|=T<<24-M%4*8,M++}return y.create(E,M)}}(),s.enc.Base64})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=s.__importDefault(n(0)),y=s.__importDefault(n(9)),l=s.__importStar(n(2));function f(S){return A.Actions.indexOf(S)}var A=function(){function S(){}return S.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},S.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var R=this.id.split(":");return{connectionId:R[0],msgSerial:parseInt(R[1],10),index:parseInt(R[2],10)}},S.prototype.toJSON=function(){var R=this.data,a=this.encoding;return R&&m.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(a=a?a+"/base64":"base64",R=m.default.BufferUtils.base64Encode(R)):R=m.default.BufferUtils.toBuffer(R)),{clientId:this.clientId,action:f(this.action),data:R,encoding:a}},S.prototype.toString=function(){var R="[PresenceMessage";return R+="; action="+this.action,this.id&&(R+="; id="+this.id),this.timestamp&&(R+="; timestamp="+this.timestamp),this.clientId&&(R+="; clientId="+this.clientId),this.connectionId&&(R+="; connectionId="+this.connectionId),this.encoding&&(R+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?R+="; data="+this.data:m.default.BufferUtils.isBuffer(this.data)?R+="; data (buffer)="+m.default.BufferUtils.base64Encode(this.data):R+="; data (json)="+JSON.stringify(this.data)),R+="]",R},S.fromResponseBody=function(R,a,E){var M=[];E&&(R=l.decodeBody(R,E));for(var P=0;P<R.length;P++){var O=M[P]=S.fromValues(R[P],!0);try{S.decode(O,a)}catch(b){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",b.toString())}}return M},S.fromValues=function(R,a){return a&&(R.action=S.Actions[R.action]),Object.assign(new S,R)},S.fromValuesArray=function(R){for(var a=R.length,E=new Array(a),M=0;M<a;M++)E[M]=S.fromValues(R[M]);return E},S.fromEncoded=function(R,a){var E=S.fromValues(R,!0);try{S.decode(E,a)}catch(M){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",M.toString())}return E},S.fromEncodedArray=function(R,a){return R.map(function(E){return S.fromEncoded(E,a)})},S.Actions=["absent","present","enter","leave","update"],S.encode=y.default.encode,S.decode=y.default.decode,S.getMessagesSize=y.default.getMessagesSize,S}();r.default=A},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importStar(n(2)),y=i.__importDefault(n(7)),l=i.__importDefault(n(5)),f=i.__importDefault(n(3)),A=i.__importDefault(n(8)),S=i.__importDefault(n(20)),R=i.__importDefault(n(0));function a(C,_){return m.arrIn(m.allToLowerCase(m.keysArray(_)),"x-ably-errorcode")}function E(C,_){if(a(C,_))return C.error&&l.default.fromValues(C.error)}var M=function(){},P=0,O={},b=typeof s!="undefined"&&s.XDomainRequest;function T(){var C=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return C&&Number(C[1])}function c(){var C;return b&&(C=T())&&C===10}function g(C,_){return C.getResponseHeader&&C.getResponseHeader(_)}function d(C){return C.getResponseHeader&&(C.getResponseHeader("transfer-encoding")||!C.getResponseHeader("content-length"))}function p(C){for(var _=m.trim(C.getAllResponseHeaders()).split(`\r
`),L={},W=0;W<_.length;W++){var H=_[W].split(":").map(m.trim);L[H[0].toLowerCase()]=H[1]}return L}var u=function(C){i.__extends(_,C);function _(L,W,H,U,I,x,z){var k=C.call(this)||this;return H=H||{},H.rnd=m.cheapRandStr(),c()&&!H.envelope&&(H.envelope="json"),k.uri=L+m.toQueryString(H),k.headers=W||{},k.body=U,k.method=z?z.toUpperCase():m.isEmptyArg(U)?"GET":"POST",k.requestMode=I,k.timeouts=x,k.timedOut=!1,k.requestComplete=!1,k.id=String(++P),O[k.id]=k,k}return _.createRequest=function(L,W,H,U,I,x,z){var k=x||A.default.TIMEOUTS;return new _(L,W,m.copy(H),U,I,k,z)},_.prototype.complete=function(L,W,H,U,I){this.requestComplete||(this.requestComplete=!0,!L&&W&&this.emit("data",W),this.emit("complete",L,W,H,U,I),this.dispose())},_.prototype.abort=function(){this.dispose()},_.prototype.exec=function(){var L=this,W=this.headers,H=this.requestMode==S.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,U=this.timer=setTimeout(function(){L.timedOut=!0,x.abort()},H),I=this.method,x=this.xhr=new XMLHttpRequest,z=W.accept,k=this.body,J="text";if(z?z.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):W.accept="application/json",k){var ee=W["content-type"]||(W["content-type"]="application/json");ee.indexOf("application/json")>-1&&typeof k!="string"&&(k=JSON.stringify(k))}x.open(I,this.uri,!0),x.responseType=J,"authorization"in W&&(x.withCredentials=!0);for(var Q in W)x.setRequestHeader(Q,W[Q]);var G=function(de,xe,et,Be){var ke,ct=xe+" (event type: "+de.type+")";!((ke=L==null?void 0:L.xhr)===null||ke===void 0)&&ke.statusText&&(ct+=", current statusText is "+L.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+de.type+"()",ct),L.complete(new l.default(ct,et,Be))};x.onerror=function(de){G(de,"XHR error occurred",null,400)},x.onabort=function(de){L.timedOut?G(de,"Request aborted due to request timeout expiring",null,408):G(de,"Request cancelled",null,400)},x.ontimeout=function(de){G(de,"Request timed out",null,408)};var D,B,V,j=0,te=!1,le=function(){if(clearTimeout(U),V=B<400,B==204){L.complete(null,null,null,null,B);return}D=L.requestMode==S.default.REQ_RECV_STREAM&&V&&d(x)},me=function(){var de;try{var xe=g(x,"content-type"),et=xe?xe.indexOf("application/json")>=0:x.responseType=="text";if(et){var Be=x.responseType==="arraybuffer"?R.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Be.length?de=JSON.parse(Be):de=Be,te=!0}else de=x.response;de.response!==void 0?(B=de.statusCode,V=B<400,W=de.headers,de=de.response):W=p(x)}catch(ct){L.complete(new l.default("Malformed response body from server: "+ct.message,null,400));return}if(V||m.isArray(de)){L.complete(null,de,W,te,B);return}var ke=E(de,W);ke||(ke=new l.default("Error response received from server: "+B+" body was: "+R.default.Config.inspect(de),null,B)),L.complete(ke,de,W,te,B)};function ve(){for(var de=x.responseText,xe=de.length-1,et,Be;j<xe&&(et=de.indexOf(`
`,j))>-1;)Be=de.slice(j,et),j=et+1,Se(Be)}var Se=function(de){try{de=JSON.parse(de)}catch(xe){L.complete(new l.default("Malformed response body from server: "+xe.message,null,400));return}L.emit("data",de)},Le=function(){ve(),L.streamComplete=!0,R.default.Config.nextTick(function(){L.complete()})};x.onreadystatechange=function(){var de=x.readyState;de<3||x.status!==0&&(B===void 0&&(B=x.status,B===1223&&(B=204),le()),de==3&&D?ve():de==4&&(D?Le():me()))},x.send(k)},_.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=M,this.xhr=null;var W=this.timer;W&&(clearTimeout(W),this.timer=null),this.requestComplete||L.abort()}delete O[this.id]},_}(y.default);r.default=u}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=s.__importStar(n(2)),y=s.__importDefault(n(22)),l=s.__importDefault(n(5)),f=s.__importDefault(n(43)),A=n(13),S=n(32),R=s.__importDefault(n(17)),a=s.__importDefault(n(0)),E=Math.pow(2,17);function M(){}function P(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(H){return!!H.connection}function b(H){return m.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new l.default(m.inspectError(H),H.code||40170,H.statusCode||401)}var T=function(H){return a.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):A.stringify(S.parse(H))},c=function(H,U){if(a.default.Config.createHmac){var I=a.default.Config.createHmac("SHA256",U);return I.update(H),I.digest("base64")}return A.stringify(f.default(H,U))};function g(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var U={},I=m.keysArray(H,!0);if(!I)return"";I.sort();for(var x=0;x<I.length;x++)U[I[x]]=H[I[x]].sort();return JSON.stringify(U)}function d(H){if(H.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var U="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",U),new Error(U)}}function p(H){return"useTokenAuth"in H&&!H.useTokenAuth}function u(H){return H.useTokenAuth||!p(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function C(H){return!H.key&&!H.authCallback&&!H.authUrl}var _=0;function L(){return _++}var W=function(){function H(U,I){if(this.authOptions={},this.client=U,this.tokenParams=I.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,u(I)){if(I.key&&!c){var x="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new Error(x)}C(I)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(I.defaultTokenParams,I),d(this.authOptions)}else{if(!I.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new l.default(x,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(I)}}return H.prototype.authorize=function(U,I,x){var z=this,k;if(typeof U=="function"&&!x?(x=U,k=U=null):typeof I=="function"&&!x?(x=I,k=null):k=I,!x&&this.client.options.promises)return m.promisify(this,"authorize",arguments);if(k&&k.key&&this.authOptions.key!==k.key)throw new l.default("Unable to update auth options with incompatible key",40102,401);k&&"force"in k&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),m.isOnlyPropIn(k,"force")&&(k=null)),this._forceNewToken(U,k,function(J,ee){if(J){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize(J),x==null||x(J);return}O(z.client)?z.client.connection.connectionManager.onAuthUpdated(ee,x||M):x==null||x(null,ee)})},H.prototype.authorise=function(U,I,x){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(U,I,x)},H.prototype._forceNewToken=function(U,I,x){var z=this;this.tokenDetails=null,this._saveTokenOptions(U,I),d(this.authOptions),this._ensureValidAuthCredentials(!0,function(k,J){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,x(k,J)})},H.prototype.requestToken=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return m.promisify(this,"requestToken",arguments);I=I||this.authOptions,U=U||m.copy(this.tokenParams);var k=x||M,J,ee=this.client;if(I.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=I.authCallback;else if(I.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,te){var le=m.mixin({accept:"application/json, text/plain"},I.authHeaders),me=I.authMethod&&I.authMethod.toLowerCase()==="post",ve,Se=I.authUrl.indexOf("?");Se>-1&&(ve=m.parseQueryString(I.authUrl.slice(Se)),I.authUrl=I.authUrl.slice(0,Se),me||(I.authParams=m.mixin(ve,I.authParams)));var Le=m.mixin({},I.authParams||{},j),de=function(Be,ke,ct,Z){var ie;if(Be?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+m.inspectError(Be)):(ie=ct["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+ie+"; body: "+m.inspectBody(ke))),Be||Z)return te(Be,ke);if(a.default.BufferUtils.isBuffer(ke)&&(ke=ke.toString()),!ie){te(new l.default("authUrl response is missing a content-type header",40170,401));return}var ue=ie.indexOf("application/json")>-1,pe=ie.indexOf("text/plain")>-1||ie.indexOf("application/jwt")>-1;if(!ue&&!pe){te(new l.default("authUrl responded with unacceptable content-type "+ie+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ue){if(ke.length>E){te(new l.default("authUrl response exceeded max permitted length",40170,401));return}try{ke=JSON.parse(ke)}catch(Re){te(new l.default("Unexpected error processing authURL response; err = "+Re.message,40170,401));return}}te(null,ke,ie)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+I.authUrl+"; Params: "+JSON.stringify(Le)+"; method: "+(me?"POST":"GET")),me){var xe=le||{};xe["content-type"]="application/x-www-form-urlencoded";var et=m.toQueryString(Le).slice(1);z.client.http.doUri(R.default.Post,ee,I.authUrl,xe,et,ve,de)}else z.client.http.doUri(R.default.Get,ee,I.authUrl,le||{},null,Le,de)};else if(I.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,te){z.createTokenRequest(j,I,te)};else{var Q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),k(new l.default(Q,40171,403));return}"capability"in U&&(U.capability=g(U.capability));var G=function(j,te){var le=j.keyName,me="/keys/"+le+"/requestToken",ve=function(Le){return ee.baseUri(Le)+me},Se=m.defaultPostHeaders();I.requestHeaders&&m.mixin(Se,I.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+me+"; Token params: "+JSON.stringify(j)),z.client.http.do(R.default.Post,ee,ve,Se,JSON.stringify(j),null,te)},D=!1,B=this.client.options.timeouts.realtimeRequestTimeout,V=setTimeout(function(){D=!0;var j="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",j),k(new l.default(j,40170,401))},B);J(U,function(j,te,le){if(!D){if(clearTimeout(V),j){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+m.inspectError(j)),k(b(j));return}if(typeof te=="string"){te.length===0?k(new l.default("Token string is empty",40170,401)):te.length>E?k(new l.default("Token string exceeded max permitted length (was "+te.length+" bytes)",40170,401)):te==="undefined"||te==="null"?k(new l.default("Token string was literal null/undefined",40170,401)):te[0]==="{"&&!(le&&le.indexOf("application/jwt")>-1)?k(new l.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):k(null,{token:te});return}if(typeof te!="object"){var me="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof te;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),k(new l.default(me,40170,401));return}var ve=JSON.stringify(te).length;if(ve>E&&!I.suppressMaxLengthCheck){k(new l.default("Token request/details object exceeded max permitted stringified size (was "+ve+" bytes)",40170,401));return}if("issued"in te){k(null,te);return}if(!("keyName"in te)){var me="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),k(new l.default(me,40170,401));return}G(te,function(Se,Le,de,xe){if(Se){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+m.inspectError(Se)),k(b(Se));return}xe||(Le=JSON.parse(Le)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),k(null,Le)})}})},H.prototype.createTokenRequest=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return m.promisify(this,"createTokenRequest",arguments);I=I||this.authOptions,U=U||m.copy(this.tokenParams);var k=I.key;if(!k){x(new l.default("No key specified",40101,403));return}var J=k.split(":"),ee=J[0],Q=J[1];if(!Q){x(new l.default("Invalid key specified",40101,403));return}if(U.clientId===""){x(new l.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in U&&(U.capability=g(U.capability));var G=m.mixin({keyName:ee},U),D=U.clientId||"",B=U.ttl||"",V=U.capability||"";(function(j){if(G.timestamp){j();return}z.getTimestamp(I&&I.queryTime,function(te,le){if(te){x(te);return}G.timestamp=le,j()})})(function(){var j=G.nonce||(G.nonce=P()),te=G.timestamp,le=G.keyName+`
`+B+`
`+V+`
`+D+`
`+te+`
`+j+`
`;G.mac=G.mac||c(le,Q),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(U){this.method=="basic"?U(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(U){this.method=="basic"?U(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{authorization:"Bearer "+T(x.token)})})},H.prototype.getTimestamp=function(U,I){!this.isTimeOffsetSet()&&(U||this.authOptions.queryTime)?this.client.time(I):I(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return m.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(U){this.method="basic",this.key=U.key,this.basicKey=T(U.key),this.authOptions=U||{},"clientId"in U&&this._userSetClientId(U.clientId)},H.prototype._saveTokenOptions=function(U,I){this.method="token",U&&(this.tokenParams=U),I&&(I.token&&(I.tokenDetails=typeof I.token=="string"?{token:I.token}:I.token),I.tokenDetails&&(this.tokenDetails=I.tokenDetails),"clientId"in I&&this._userSetClientId(I.clientId),this.authOptions=I)},H.prototype._ensureValidAuthCredentials=function(U,I){var x=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){I(new l.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),I(null,z);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=y.default.create())).push(I),!(this.currentTokenRequestId!==null&&!U)){var k=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(J,ee){if(x.currentTokenRequestId>k){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var Q=x.waitingForTokenRequest||M;if(x.waitingForTokenRequest=null,J){Q(J);return}Q(null,x.tokenDetails=ee)})}},H.prototype._userSetClientId=function(U){if(typeof U=="string"||U===null){if(U==="*")throw new l.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var I=this._uncheckedSetClientId(U);if(I)throw I}else throw new l.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(U){if(this._tokenClientIdMismatch(U)){var I="Unexpected clientId mismatch: client has "+this.clientId+", requested "+U,x=new l.default(I,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",I),x}else return this.clientId=this.tokenParams.clientId=U,null},H.prototype._tokenClientIdMismatch=function(U){return!!(this.clientId&&this.clientId!=="*"&&U&&U!=="*"&&this.clientId!==U)},H.isTokenErr=function(U){return U.code&&U.code>=40140&&U.code<40150},H}();r.default=W},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(s||(s={})),r.default=s},function(h,r,n){"use strict";r.__esModule=!0,r.HttpPaginatedResponse=r.PaginatedResult=void 0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(24));function l(E){var M=E.match(/^\.\/(\w+)\?(.*)$/);return M&&M[2]&&i.parseQueryString(M[2])}function f(E){typeof E=="string"&&(E=E.split(","));for(var M={},P=0;P<E.length;P++){var O=E[P].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(O){var b=l(O[1]);b&&(M[O[2]]=b)}}return M}function A(E,M,P){return!(P&&(M||typeof E.code=="number"))}var S=function(){function E(M,P,O,b,T,c){this.rest=M,this.path=P,this.headers=O,this.envelope=b!=null?b:null,this.bodyHandler=T,this.useHttpPaginatedResponse=c||!1}return E.prototype.get=function(M,P){var O=this;y.default.get(this.rest,this.path,this.headers,M,this.envelope,function(b,T,c,g,d){O.handlePage(b,T,c,g,d,P)})},E.prototype.delete=function(M,P){var O=this;y.default.delete(this.rest,this.path,this.headers,M,this.envelope,function(b,T,c,g,d){O.handlePage(b,T,c,g,d,P)})},E.prototype.post=function(M,P,O){var b=this;y.default.post(this.rest,this.path,P,this.headers,M,this.envelope,function(T,c,g,d,p){O&&b.handlePage(T,c,g,d,p,O)})},E.prototype.put=function(M,P,O){var b=this;y.default.put(this.rest,this.path,P,this.headers,M,this.envelope,function(T,c,g,d,p){O&&b.handlePage(T,c,g,d,p,O)})},E.prototype.patch=function(M,P,O){var b=this;y.default.patch(this.rest,this.path,P,this.headers,M,this.envelope,function(T,c,g,d,p){O&&b.handlePage(T,c,g,d,p,O)})},E.prototype.handlePage=function(M,P,O,b,T,c){if(M&&A(M,P,this.useHttpPaginatedResponse)){m.default.logAction(m.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(M)),c==null||c(M);return}var g,d,p;try{g=this.bodyHandler(P,O||{},b)}catch(u){c==null||c(M||u);return}O&&(d=O.Link||O.link)&&(p=f(d)),this.useHttpPaginatedResponse?c(null,new a(this,g,O||{},T,p,M)):c(null,new R(this,g,p))},E}(),R=function(){function E(M,P,O){var b=this;this.resource=M,this.items=P;var T=this;O&&("first"in O&&(this.first=function(c){if(!c&&T.resource.rest.options.promises)return i.promisify(T,"first",[]);T.get(O.first,c)}),"current"in O&&(this.current=function(c){if(!c&&T.resource.rest.options.promises)return i.promisify(T,"current",[]);T.get(O.current,c)}),this.next=function(c){if(!c&&T.resource.rest.options.promises)return i.promisify(T,"next",[]);"next"in O?T.get(O.next,c):c(null)},this.hasNext=function(){return"next"in O},this.isLast=function(){var c;return!(!((c=b.hasNext)===null||c===void 0)&&c.call(b))})}return E.prototype.get=function(M,P){var O=this.resource;y.default.get(O.rest,O.path,O.headers,M,O.envelope,function(b,T,c,g,d){O.handlePage(b,T,c,g,d,P)})},E}();r.PaginatedResult=R;var a=function(E){s.__extends(M,E);function M(P,O,b,T,c,g){var d=E.call(this,P,O,c)||this;return d.statusCode=T,d.success=T<300&&T>=200,d.headers=b,d.errorCode=g&&g.code,d.errorMessage=g&&g.message,d}return M.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},M}(R);r.HttpPaginatedResponse=a,r.default=S},function(h,r,n){"use strict";r.__esModule=!0,r.isRetriable=void 0;var s=n(1),i=s.__importDefault(n(5)),m={disconnected:i.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:i.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:i.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:i.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:i.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:i.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:i.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function y(l){if(!l.statusCode||!l.code||l.statusCode>=500)return!0;var f=!1;return Object.values(m).forEach(function(A){A.code&&A.code==l.code&&(f=!0)}),f}r.isRetriable=y,r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),r.default=s},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(s){return s})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=function(){function y(l){this.members=l||[]}return y.prototype.call=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];for(var A=0,S=this.members;A<S.length;A++){var R=S[A];if(R)try{R.apply(void 0,l)}catch(a){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},y.prototype.push=function(){for(var l,f=[],A=0;A<arguments.length;A++)f[A]=arguments[A];(l=this.members).push.apply(l,f)},y.create=function(l){var f=new y(l);return Object.assign(function(){for(var A=[],S=0;S<arguments.length;S++)A[S]=arguments[S];return f.call.apply(f,A)},{push:function(A){return f.push(A)}})},y}();r.default=m},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){(function(){var i=s,m=i.lib,y=m.Base,l=i.enc,f=l.Utf8,A=i.algo,S=A.HMAC=y.extend({init:function(R,a){R=this._hasher=new R.init,typeof a=="string"&&(a=f.parse(a));var E=R.blockSize,M=E*4;a.sigBytes>M&&(a=R.finalize(a)),a.clamp();for(var P=this._oKey=a.clone(),O=this._iKey=a.clone(),b=P.words,T=O.words,c=0;c<E;c++)b[c]^=1549556828,T[c]^=909522486;P.sigBytes=O.sigBytes=M,this.reset()},reset:function(){var R=this._hasher;R.reset(),R.update(this._iKey)},update:function(R){return this._hasher.update(R),this},finalize:function(R){var a=this._hasher,E=a.finalize(R);a.reset();var M=a.finalize(this._oKey.clone().concat(E));return M}})})()})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(3)),l=s.__importDefault(n(16)),f=s.__importDefault(n(17)),A=s.__importDefault(n(5));function S(O,b,T,c,g){O.http.supportsAuthHeaders?O.auth.getAuthHeaders(function(d,p){d?c(d):g(m.mixin(p,b),T)}):O.auth.getAuthParams(function(d,p){d?c(d):g(b,m.mixin(p,T))})}function R(O,b){return function(T,c,g,d,p){if(T&&!c){O(T);return}if(!d)try{c=m.decodeBody(c,b)}catch(H){O(H);return}if(!c){O(new A.default("unenvelope(): Response body is missing",null));return}var u=c,C=u.statusCode,_=u.response,L=u.headers;if(C===void 0){O(T,c,g,!0,p);return}if(C<200||C>=300){var W=_&&_.error||T;W||(W=new Error("Error in unenveloping "+c),W.statusCode=C),O(W,_,L,!0,C);return}O(T,_,L,!0,C)}}function a(O){var b=[];if(O)for(var T in O)b.push(T+"="+O[T]);return b.join("&")}function E(O,b){return O+(b?"?":"")+a(b)}function M(O,b,T,c){return function(g,d,p,u,C){g?y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Received Error; "+E(T,c)+"; Error: "+m.inspectError(g)):y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Received; "+E(T,c)+"; Headers: "+a(p)+"; StatusCode: "+C+"; Body: "+(i.default.BufferUtils.isBuffer(d)?d.toString():d)),O&&O(g,d,p,u,C)}}var P=function(){function O(){}return O.get=function(b,T,c,g,d,p){O.do(f.default.Get,b,T,null,c,g,d,p)},O.delete=function(b,T,c,g,d,p){O.do(f.default.Delete,b,T,null,c,g,d,p)},O.post=function(b,T,c,g,d,p,u){O.do(f.default.Post,b,T,c,g,d,p,u)},O.patch=function(b,T,c,g,d,p,u){O.do(f.default.Patch,b,T,c,g,d,p,u)},O.put=function(b,T,c,g,d,p,u){O.do(f.default.Put,b,T,c,g,d,p,u)},O.do=function(b,T,c,g,d,p,u,C){y.default.shouldLog(y.default.LOG_MICRO)&&(C=M(C,b,c,p)),u&&(C=C&&R(C,u),(p=p||{}).envelope=u);function _(L,W){var H;if(y.default.shouldLog(y.default.LOG_MICRO)&&y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending; "+E(c,W)),y.default.shouldLog(y.default.LOG_MICRO)){var U=g;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{U=i.default.Config.msgpack.decode(g)}catch(I){y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending MsgPack Decoding Error: "+m.inspectError(I))}y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending; "+E(c,W)+"; Body: "+U)}T.http.do(b,T,c,L,g,W,function(I,x,z,k,J){if(I&&l.default.isTokenErr(I)){T.auth.authorize(null,null,function(ee){if(ee){C(ee);return}S(T,z,W,C,_)});return}C(I,x,z,k,J)})}S(T,d,p,C,_)},O}();r.default=P},function(h,r,n){"use strict";(function(s){r.__esModule=!0,r.TransportParams=void 0;var i=n(1),m=i.__importDefault(n(10)),y=i.__importStar(n(2)),l=i.__importStar(n(51)),f=i.__importDefault(n(8)),A=i.__importDefault(n(0)),S=i.__importDefault(n(7)),R=i.__importDefault(n(35)),a=i.__importDefault(n(3)),E=i.__importDefault(n(36)),M=i.__importStar(n(19)),P=i.__importDefault(n(5)),O=i.__importDefault(n(16)),b=i.__importDefault(n(9)),T=i.__importDefault(n(22)),c=i.__importDefault(n(52)),g=i.__importDefault(n(26)),d=i.__importDefault(n(53)),p=function(){var ee;return typeof A.default.WebStorage!="undefined"&&((ee=A.default.WebStorage)===null||ee===void 0?void 0:ee.localSupported)},u=function(){var ee;return typeof A.default.WebStorage!="undefined"&&((ee=A.default.WebStorage)===null||ee===void 0?void 0:ee.sessionSupported)},C=m.default.Action,_=function(){},L="ably-transport-preference",W="ably-connection-recovery";function H(){var ee,Q;return u()&&((Q=(ee=A.default.WebStorage)===null||ee===void 0?void 0:ee.getSession)===null||Q===void 0?void 0:Q.call(ee,W))}function U(ee){var Q,G;return u()&&((G=(Q=A.default.WebStorage)===null||Q===void 0?void 0:Q.setSession)===null||G===void 0?void 0:G.call(Q,W,ee))}function I(){var ee,Q;return u()&&((Q=(ee=A.default.WebStorage)===null||ee===void 0?void 0:ee.removeSession)===null||Q===void 0?void 0:Q.call(ee,W))}function x(ee,Q){return y.arrIndexOf(A.default.Defaults.transportPreferenceOrder,ee.shortName)>y.arrIndexOf(A.default.Defaults.transportPreferenceOrder,Q.shortName)}function z(ee,Q,G){var D;if(ee.channel!==Q.channel||(D=ee.action)!==C.PRESENCE&&D!==C.MESSAGE||D!==Q.action)return!1;var B=D===C.PRESENCE?"presence":"messages",V=ee[B].concat(Q[B]),j=b.default.getMessagesSize(V);return j>G||!y.allSame(V,"clientId")||!y.arrEvery(V,function(te){return!te.id})?!1:(ee[B]=V,!0)}var k=function(){function ee(Q,G,D,B){this.options=Q,this.host=G,this.mode=D,this.connectionKey=B,this.format=Q.useBinaryProtocol?y.Format.msgpack:y.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return ee.prototype.getConnectParams=function(Q){var G=Q?y.copy(Q):{},D=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var B=D.recover.split(":");if(B){G.recover=B[0];var V=B[1];isNaN(Number(V))?G.timeSerial=V:G.connectionSerial=V}break}default:}return D.clientId!==void 0&&(G.clientId=D.clientId),D.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=f.default.apiVersion,G.agent=encodeURIComponent(f.default.agent),D.transportParams!==void 0&&y.mixin(G,D.transportParams),G},ee.prototype.toString=function(){var Q="[mode="+this.mode;return this.host&&(Q+=",host="+this.host),this.connectionKey&&(Q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Q+=",timeSerial="+this.timeSerial),this.format&&(Q+=",format="+this.format),Q+="]",Q},ee}();r.TransportParams=k;var J=function(ee){i.__extends(Q,ee);function Q(G,D){var B=ee.call(this)||this;B.disconnectedRetryCount=0,Q.initTransports(),B.realtime=G,B.options=D;var V=D.timeouts,j=V.preferenceConnectTimeout+V.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new R.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.timeSerial=void 0,B.connectionSerial=void 0,B.connectionStateTtl=V.connectionStateTtl,B.maxIdleInterval=null,B.transports=y.intersect(D.transports||f.default.defaultTransports,Q.supportedTransports),B.baseTransport=y.intersect(f.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=y.intersect(B.transports,f.default.upgradeTransports),B.transportPreference=null,B.httpHosts=f.default.getHosts(D),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.mostRecentMsg=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(D.transports||f.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var te="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",te),new Error(te)}var le=A.default.Config.addEventListener;return le&&(u()&&typeof D.recover=="function"&&le("beforeunload",B.persistConnection.bind(B)),D.closeOnUnload===!0&&le("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),le("online",function(){(B.state==B.states.disconnected||B.state==B.states.suspended)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),B.requestState({state:"connecting"}))}),le("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),B.disconnectAllTransports())})),B}return Q.initTransports=function(){c.default(Q),y.arrForEach(A.default.Transports,function(G){G(Q)})},Q.prototype.createTransportParams=function(G,D){var B=new k(this.options,G,D,this.connectionKey);return this.timeSerial?B.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(B.connectionSerial=this.connectionSerial),B},Q.prototype.getTransportParams=function(G){var D=this,B=function(V){if(D.connectionKey){V("resume");return}if(typeof D.options.recover=="string"){V("recover");return}var j=D.options.recover,te=H();if(te&&typeof j=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),j(te,function(le){le?(D.options.recover=te.recoveryKey,V("recover")):V("clean")});return}V("clean")};B(function(V){var j=D.createTransportParams(null,V);if(V==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+D.options.recover);var te=D.options.recover.split(":");te&&te[2]&&(D.msgSerial=Number(te[2]))}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+j.toString());G(j)})},Q.prototype.tryATransport=function(G,D,B){var V=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+D),g.default.tryConnect(Q.supportedTransports[D],this,this.realtime.auth,G,function(j,te){var le=V.state;if(le==V.states.closing||le==V.states.closed||le==V.states.failed){te&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+le.state+" while we were attempting the transport; closing "+te),te.close()),B(!0);return}if(j){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+D+" "+j.event+", err: "+j.error.toString()),O.default.isTokenErr(j.error)&&!(V.errorReason&&O.default.isTokenErr(V.errorReason))?(V.errorReason=j.error,V.realtime.auth._forceNewToken(null,null,function(me){if(me){V.actOnErrorFromAuthorize(me);return}V.tryATransport(G,D,B)})):j.event==="failed"?(V.notifyState({state:"failed",error:j.error}),B(!0)):j.event==="disconnected"&&(M.isRetriable(j.error)?B(!1):(V.notifyState({state:V.states.connecting.failState,error:j.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+D+"; setting pending"),V.setTransportPending(te,G),B(null,te)})},Q.prototype.setTransportPending=function(G,D){var B=this,V=D.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+V),y.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var j=A.default.Defaults.transportPreferenceOrder[A.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(le,me,ve,Se){V=="upgrade"?G.shortName!==j&&y.arrIn(B.getUpgradePossibilities(),j)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(le,G,me,ve,Se)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(le,G,me,ve,Se):(B.activateTransport(le,G,me,ve,Se),A.default.Config.nextTick(function(){B.connectImpl(D)})),V==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var te=this;G.on(["disconnected","closed","failed"],function(le){te.deactivateTransport(G,this.event,le)}),this.emit("transport.pending",G)},Q.prototype.scheduleTransportActivation=function(G,D,B,V,j){var te=this,le=this.activeProtocol&&this.activeProtocol.getTransport(),me=function(){D.disconnect(),y.arrDeleteValue(te.pendingTransports,D)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}if(le&&!x(D,le)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+" is no better than current active transport "+le.shortName+" - abandoning upgrade"),me();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+D);var ve=function(Se){var Le;if(Se){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+D+"; err = "+Se);return}if(!D.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+"is no longer connected; abandoning upgrade"),me();return}if(te.state===te.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),te.state=te.states.synchronizing,Le=te.activeProtocol;else if(te.state!==te.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+te.state.state+(te.state===te.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}var de=B!==te.connectionId,xe=de?j:te;de&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(te.timeSerial||te.connectionSerial)+" to "+(xe.timeSerial||xe.connectionSerial)+"; upgrade error was "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+D),te.sync(D,xe,function(et,Be,ke){if(et){te.state===te.states.synchronizing&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+D+"; err = "+et),te.disconnectAllTransports());return}var ct=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+D),te.activateTransport(G,D,Be,V,ke),te.state===te.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+D),te.state=te.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+te.state.state+", so leaving unchanged"),te.state.sendEvents&&te.sendQueuedMessages()};Le?Le.onceIdle(ct):ct()})};le?this.realtime.channels.onceNopending(ve):ve()},Q.prototype.activateTransport=function(G,D,B,V,j){var te=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+D),G&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),V&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(V)),j&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(j.timeSerial||j.connectionSerial)),this.persistTransportPreference(D);var le=this.state,me=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+le.state),le.state==this.states.closing.state||le.state==this.states.closed.state||le.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),D.disconnect(),!1;if(y.arrDeleteValue(this.pendingTransports,D),!D.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+D+" since it appears to no longer be connected"),!1;var ve=this.activeProtocol;this.activeProtocol=new l.default(D),this.host=D.params.host;var Se=V.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(B,V,j,!!G),this.onConnectionDetailsUpdate(V,D),A.default.Config.nextTick(function(){D.on("connected",function(de,xe,et){te.onConnectionDetailsUpdate(et,D),te.emit("update",new E.default(me,me,null,de))})}),le.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new E.default(me,me,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",D),ve)if(ve.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+ve.transport.shortName+", new one is "+D.shortName+") finishing with "+ve.messageQueue.count()+" messages still pending"),ve.transport===D){var Le="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+D.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",Le)}else ve.finish();return y.safeArrForEach(this.pendingTransports,function(de){if(de===D){var xe="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+D.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",xe),y.arrDeleteValue(te.pendingTransports,D)}else de.disconnect()}),y.safeArrForEach(this.proposedTransports,function(de){de===D?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+D.shortName+"; stack = "+new Error().stack),y.arrDeleteValue(te.proposedTransports,D)):de.dispose()}),!0},Q.prototype.deactivateTransport=function(G,D,B){var V=this.activeProtocol,j=V&&V.getTransport()===G,te=y.arrDeleteValue(this.pendingTransports,G),le=y.arrDeleteValue(this.proposedTransports,G),me=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+D+(j?"; was active":te?"; was pending":le?"; was proposed":"")+(me?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),j&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(V.getPendingMessages()),A.default.Config.nextTick(function(){V.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),j&&me||j&&D==="failed"||D==="closed"||V===null&&te&&this.pendingTransports.length===0){if(D==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:D,error:B,retryImmediately:!0});return}var ve=D==="failed"&&O.default.isTokenErr(B)?"disconnected":D;this.notifyState({state:ve,error:B});return}j&&D==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},Q.prototype.noTransportsScheduledForActivation=function(){return y.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Q.prototype.sync=function(G,D,B){var V=setTimeout(function(){G.off("sync"),B(new P.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),j=m.default.fromValues({action:C.SYNC,connectionKey:this.connectionKey});D.timeSerial?j.timeSerial=D.timeSerial:D.connectionSerial!==void 0&&(j.connectionSerial=D.connectionSerial),G.send(j),G.once("sync",function(te,le){clearTimeout(V),B(null,te,le)})},Q.prototype.setConnection=function(G,D,B,V){var j=this,te=this.connectionId,le=te&&te!==G,me=!te&&V;(le||me)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),A.default.Config.nextTick(function(){j.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){j.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=D.connectionKey;var ve=le||!te;this.setConnectionSerial(B,ve,!1)},Q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Q.prototype.setConnectionSerial=function(G,D,B){var V=G.timeSerial,j=G.connectionSerial;if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+j+"; timeSerial = "+V+"; force = "+D+"; previous = "+this.connectionSerial),V!==void 0){if(V<=this.timeSerial&&!D)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+V+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=V,this.setRecoveryKey();return}if(j!==void 0){if(j<=this.connectionSerial&&!D)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+j+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=j,this.setRecoveryKey()}},Q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=y.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Q.prototype.persistConnection=function(){if(u()){var G=this.realtime.connection.recoveryKey;G&&U({recoveryKey:G,disconnectedAt:y.now(),location:s.location,clientId:this.realtime.auth.clientId})}},Q.prototype.unpersistConnection=function(){I()},Q.prototype.getError=function(){return this.errorReason||this.getStateError()},Q.prototype.getStateError=function(){return M.default[this.state.state]},Q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Q.prototype.enactStateChange=function(G){var D=G.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(D,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var B=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Q.prototype.startTransitionTimer=function(G){var D=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){D.transitionTimer&&(D.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),D.notifyState({state:G.failState}))},G.retryDelay)},Q.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Q.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Q.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Q.prototype.startRetryTimer=function(G){var D=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),D.retryTimer=null,D.requestState({state:"connecting"})},G)},Q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Q.prototype.notifyState=function(G){var D=this,B=G.state,V=B==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&O.default.isTokenErr(G.error)&&!(this.errorReason&&O.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+B+(V?"; will retry connection immediately":"")),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(B==="suspended"||B==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var j=this.states[G.state],te=j.retryDelay;j.state==="disconnected"&&(this.disconnectedRetryCount++,te=j.retryDelay*y.getBackoffCoefficient(this.disconnectedRetryCount)*y.getJitterCoefficient());var le=new E.default(this.state.state,j.state,te,G.error||M.default[j.state]);if(V){var me=function(){D.state===D.states.disconnected&&(D.lastAutoReconnectAttempt=y.now(),D.requestState({state:"connecting"}))},ve=this.lastAutoReconnectAttempt&&y.now()-this.lastAutoReconnectAttempt+1;ve&&ve<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ve+"ms ago, waiting another "+(1e3-ve)+"ms before trying again"),setTimeout(me,1e3-ve)):A.default.Config.nextTick(me)}else(B==="disconnected"||B==="suspended")&&this.startRetryTimer(te);(B==="disconnected"&&!V||B==="suspended"||j.terminal)&&A.default.Config.nextTick(function(){D.disconnectAllTransports()}),B=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(le),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(B,le.reason),this.failQueuedMessages(le.reason))}},Q.prototype.requestState=function(G){var D=this,B=G.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+B+"; current state: "+this.state.state),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(B),!(B=="connecting"&&this.state.state=="connected")&&!(B=="closing"&&this.state.state=="closed"))){var V=this.states[B],j=new E.default(this.state.state,V.state,null,G.error||M.default[V.state]);this.enactStateChange(j),B=="connecting"&&A.default.Config.nextTick(function(){D.startConnect()}),B=="closing"&&this.closeImpl()}},Q.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var D=this.realtime.auth,B=++this.connectCounter,V=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(te){B===G.connectCounter&&G.connectImpl(te,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),D.method==="basic")V();else{var j=function(te){B===G.connectCounter&&(te?G.actOnErrorFromAuthorize(te):V())};this.errorReason&&O.default.isTokenErr(this.errorReason)?D._forceNewToken(null,null,j):D._ensureValidAuthCredentials(!1,j)}},Q.prototype.connectImpl=function(G,D){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,D)},Q.prototype.connectPreference=function(G){var D=this,B=this.getTransportPreference(),V=!1;y.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(G)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var j=setTimeout(function(){V=!0,D.state.state!==D.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),D.disconnectAllTransports(),D.unpersistTransportPreference()),D.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,B,function(te,le){clearTimeout(j),V&&le?(le.off(),le.disconnect(),y.arrDeleteValue(D.pendingTransports,le)):!le&&!te&&(D.unpersistTransportPreference(),D.connectImpl(G))})},Q.prototype.connectBase=function(G,D){var B=this,V=function(ve){B.notifyState({state:B.states.connecting.failState,error:ve})},j=this.httpHosts.slice(),te=function(ve,Se){D===B.connectCounter&&!Se&&!ve&&me()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var le=j.shift();if(!le){V(new P.default("Unable to connect (no available host)",80003,404));return}G.host=le;var me=function(){if(!j.length){V(new P.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){V(new P.default("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(ve,Se){if(D===B.connectCounter){if(ve){V(ve);return}if(!Se){V(new P.default("Unable to connect (network unreachable)",80003,404));return}G.host=y.arrPopRandomElement(j),B.tryATransport(G,B.baseTransport,te)}})};if(this.forceFallbackHost&&j.length){this.forceFallbackHost=!1,me();return}this.tryATransport(G,this.baseTransport,te)},Q.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,D=y.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(D+1)},Q.prototype.upgradeIfNeeded=function(G){var D=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+A.default.Config.inspect(B)),B.length&&y.arrForEach(B,function(V){var j=D.createTransportParams(G.host,"upgrade");D.tryATransport(j,V,_)})},Q.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),y.safeArrForEach(this.pendingTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),y.safeArrForEach(this.proposedTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Q.prototype.onAuthUpdated=function(G,D){var B=this,V;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var j=this.activeProtocol.getTransport().params;A.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(j)})}var te=(V=this.activeProtocol)===null||V===void 0?void 0:V.getTransport();te&&te.onAuthUpdated&&te.onAuthUpdated(G);var le=m.default.fromValues({action:C.AUTH,auth:{accessToken:G.token}});this.send(le);var me=function(){B.off(ve),D(null,G)},ve=function(Le){Le.current==="failed"&&(B.off(me),B.off(ve),D(Le.reason||B.getStateError()))};this.once("connectiondetails",me),this.on("connectionstate",ve);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Se=function(Le){switch(Le.current){case"connected":B.off(Se),D(null,G);break;case"failed":case"closed":case"suspended":B.off(Se),D(Le.reason||B.getStateError());break;default:break}};this.on("connectionstate",Se),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Q.prototype.disconnectAllTransports=function(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,y.safeArrForEach(this.pendingTransports,function(D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+D),D&&D.disconnect()}),this.pendingTransports=[],y.safeArrForEach(this.proposedTransports,function(D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+D),D&&D.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Q.prototype.send=function(G,D,B){B=B||_;var V=this.state;if(V.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new l.PendingMessage(G,B));return}var j=D&&V.queueEvents||V.forceQueueEvents;if(!j){var te="rejecting event, queueEvent was "+D+", state was "+V.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",te),B(this.errorReason||new P.default(te,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+m.default.stringify(G)),this.queue(G,B)},Q.prototype.sendImpl=function(G){var D=G.message;G.ackRequired&&!G.sendAttempted&&(D.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},Q.prototype.queue=function(G,D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),V=this.options.maxMessageSize;B&&!B.sendAttempted&&z(B.message,G,V)?(B.merged||(B.callback=T.default.create([B.callback]),B.merged=!0),B.callback.push(D)):this.queuedMessages.push(new l.PendingMessage(G,D))},Q.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Q.prototype.queuePendingMessages=function(G){G&&G.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Q.prototype.failQueuedMessages=function(G){var D=this.queuedMessages.count();D>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+D+" queued messages, err = "+y.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Q.prototype.onChannelMessage=function(G,D){var B=this.activeProtocol&&D===this.activeProtocol.getTransport(),V=y.arrIn(this.pendingTransports,D)&&this.state==this.states.synchronizing,j=G.action===C.MESSAGE||G.action===C.PRESENCE;if(B||V){if(j){var te=this.setConnectionSerial(G,!1,!0);if(te)return;if(m.default.isDuplicate(G,this.mostRecentMsg)){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else y.arrIndexOf([C.ACK,C.NACK,C.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Q.prototype.ping=function(G,D){var B=this;if(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var V=function(){G.off("heartbeat",le),D(new P.default("Timeout waiting for heartbeat response",5e4,500))},j=y.now(),te=y.cheapRandStr(),le=function(de){if(de===te){G.off("heartbeat",le),clearTimeout(me);var xe=y.now()-j;D(null,xe)}},me=setTimeout(V,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",le),G.ping(te);return}if(this.state.state!=="connected"){D(new P.default("Unable to ping service; not connected",4e4,400));return}var ve=!1,Se=function(de,xe){B.off("transport.active",Le),ve||(ve=!0,D(de,xe))},Le=function(){ve||(ve=!0,A.default.Config.nextTick(function(){B.ping(null,D)}))};this.on("transport.active",Le),this.ping(this.activeProtocol.getTransport(),Se)},Q.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Q.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Q.prototype.getTransportPreference=function(){var G,D;return this.transportPreference||p()&&((D=(G=A.default.WebStorage)===null||G===void 0?void 0:G.get)===null||D===void 0?void 0:D.call(G,L))},Q.prototype.persistTransportPreference=function(G){var D,B;y.arrIn(f.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,p()&&((B=(D=A.default.WebStorage)===null||D===void 0?void 0:D.set)===null||B===void 0||B.call(D,L,G.shortName)))},Q.prototype.unpersistTransportPreference=function(){var G,D;this.transportPreference=null,p()&&((D=(G=A.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||D===void 0||D.call(G,L))},Q.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===d.default.Forbidden){var D="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",D),this.notifyState({state:"failed",error:new P.default(D,80019,403,G)})}else{var D="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",D),this.notifyState({state:this.state.failState,error:new P.default(D,80019,401,G)})}},Q.prototype.onConnectionDetailsUpdate=function(G,D){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var B=G.clientId;if(B){var V=this.realtime.auth._uncheckedSetClientId(B);if(V){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",V.message),D.fail(V);return}}var j=G.connectionStateTtl;j&&(this.connectionStateTtl=j),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Q.supportedTransports={},Q}(S.default);r.default=J}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importStar(n(2)),y=s.__importDefault(n(7)),l=s.__importDefault(n(3)),f=s.__importDefault(n(19)),A=s.__importDefault(n(5)),S=s.__importDefault(n(0)),R=i.default.Action,a=i.default.fromValues({action:R.CLOSE}),E=i.default.fromValues({action:R.DISCONNECT}),M=function(P){s.__extends(O,P);function O(b,T,c,g){var d=P.call(this)||this;return g&&(c.format=void 0,c.heartbeats=!0),d.connectionManager=b,b.registerProposedTransport(d),d.auth=T,d.params=c,d.timeouts=c.options.timeouts,d.format=c.format,d.isConnected=!1,d.isFinished=!1,d.isDisposed=!1,d.maxIdleInterval=null,d.idleTimer=null,d.lastActivity=null,d}return O.prototype.connect=function(){},O.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",f.default.closed)},O.prototype.disconnect=function(b){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",b||f.default.disconnected)},O.prototype.fail=function(b){this.isConnected&&this.requestDisconnect(),this.finish("failed",b||f.default.failed)},O.prototype.finish=function(b,T){var c;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((c=this.idleTimer)!==null&&c!==void 0?c:void 0),this.idleTimer=null,this.emit(b,T),this.dispose())},O.prototype.onProtocolMessage=function(b){switch(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(b)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),b.action){case R.HEARTBEAT:l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",b.id);break;case R.CONNECTED:this.onConnect(b),this.emit("connected",b.error,b.connectionId,b.connectionDetails,b);break;case R.CLOSED:this.onClose(b);break;case R.DISCONNECTED:this.onDisconnect(b);break;case R.ACK:this.emit("ack",b.msgSerial,b.count);break;case R.NACK:this.emit("nack",b.msgSerial,b.count,b.error);break;case R.SYNC:if(b.connectionId!==void 0){this.emit("sync",b.connectionId,b);break}this.connectionManager.onChannelMessage(b,this);break;case R.AUTH:this.auth.authorize(function(T){T&&l.default.logAction(l.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+m.inspectError(T))});break;case R.ERROR:if(l.default.logAction(l.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+S.default.Config.inspect(b.error)+(b.channel?", channel: "+b.channel:"")),b.channel===void 0){this.onFatalError(b);break}this.connectionManager.onChannelMessage(b,this);break;default:this.connectionManager.onChannelMessage(b,this)}},O.prototype.onConnect=function(b){if(this.isConnected=!0,!b.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=b.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},O.prototype.onDisconnect=function(b){var T=b&&b.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onDisconnect()","err = "+m.inspectError(T)),this.finish("disconnected",T)},O.prototype.onFatalError=function(b){var T=b&&b.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onFatalError()","err = "+m.inspectError(T)),this.finish("failed",T)},O.prototype.onClose=function(b){var T=b&&b.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onClose()","err = "+m.inspectError(T)),this.finish("closed",T)},O.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},O.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},O.prototype.ping=function(b){var T={action:i.default.Action.HEARTBEAT};b&&(T.id=b),this.send(i.default.fromValues(T))},O.prototype.dispose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},O.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=m.now(),this.setIdleTimer(this.maxIdleInterval+100))},O.prototype.setIdleTimer=function(b){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},b))},O.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var b=m.now()-this.lastActivity,T=this.maxIdleInterval-b;if(T<=0){var c="No activity seen from realtime in "+b+"ms; assuming connection has dropped";l.default.logAction(l.default.LOG_ERROR,"Transport.onIdleTimerExpire()",c),this.disconnect(new A.default(c,80003,408))}else this.setIdleTimer(T+100)},O.tryConnect=function(b,T,c,g,d){var p=new b(T,c,g),u,C=function(L){clearTimeout(u),d({event:this.event,error:L})},_=T.options.timeouts.realtimeRequestTimeout;u=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),C.call({event:"disconnected"},new A.default("Timeout waiting for transport to indicate itself viable",5e4,500))},_),p.on(["failed","disconnected"],C),p.on("preconnect",function(){l.default.logAction(l.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(u),p.off(["failed","disconnected"],C),d(null,p)}),p.connect()},O}(y.default);r.default=M},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(39),n(23))})(this,function(s){return function(){var i=s,m=i.lib,y=m.Base,l=m.WordArray,f=i.algo,A=f.MD5,S=f.EvpKDF=y.extend({cfg:y.extend({keySize:128/32,hasher:A,iterations:1}),init:function(R){this.cfg=this.cfg.extend(R)},compute:function(R,a){for(var E,M=this.cfg,P=M.hasher.create(),O=l.create(),b=O.words,T=M.keySize,c=M.iterations;b.length<T;){E&&P.update(E),E=P.update(R).finalize(a),P.reset();for(var g=1;g<c;g++)E=P.finalize(E),P.reset();O.concat(E)}return O.sigBytes=T*4,O}});i.EvpKDF=function(R,a,E){return S.create(E).compute(R,a)}}(),s.EvpKDF})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(27))})(this,function(s){s.lib.Cipher||function(i){var m=s,y=m.lib,l=y.Base,f=y.WordArray,A=y.BufferedBlockAlgorithm,S=m.enc,R=S.Utf8,a=S.Base64,E=m.algo,M=E.EvpKDF,P=y.Cipher=A.extend({cfg:l.extend(),createEncryptor:function(I,x){return this.create(this._ENC_XFORM_MODE,I,x)},createDecryptor:function(I,x){return this.create(this._DEC_XFORM_MODE,I,x)},init:function(I,x,z){this.cfg=this.cfg.extend(z),this._xformMode=I,this._key=x,this.reset()},reset:function(){A.reset.call(this),this._doReset()},process:function(I){return this._append(I),this._process()},finalize:function(I){I&&this._append(I);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function I(x){return typeof x=="string"?U:L}return function(x){return{encrypt:function(z,k,J){return I(k).encrypt(x,z,k,J)},decrypt:function(z,k,J){return I(k).decrypt(x,z,k,J)}}}}()}),O=y.StreamCipher=P.extend({_doFinalize:function(){var I=this._process(!0);return I},blockSize:1}),b=m.mode={},T=y.BlockCipherMode=l.extend({createEncryptor:function(I,x){return this.Encryptor.create(I,x)},createDecryptor:function(I,x){return this.Decryptor.create(I,x)},init:function(I,x){this._cipher=I,this._iv=x}}),c=b.CBC=function(){var I=T.extend();I.Encryptor=I.extend({processBlock:function(z,k){var J=this._cipher,ee=J.blockSize;x.call(this,z,k,ee),J.encryptBlock(z,k),this._prevBlock=z.slice(k,k+ee)}}),I.Decryptor=I.extend({processBlock:function(z,k){var J=this._cipher,ee=J.blockSize,Q=z.slice(k,k+ee);J.decryptBlock(z,k),x.call(this,z,k,ee),this._prevBlock=Q}});function x(z,k,J){var ee,Q=this._iv;Q?(ee=Q,this._iv=i):ee=this._prevBlock;for(var G=0;G<J;G++)z[k+G]^=ee[G]}return I}(),g=m.pad={},d=g.Pkcs7={pad:function(I,x){for(var z=x*4,k=z-I.sigBytes%z,J=k<<24|k<<16|k<<8|k,ee=[],Q=0;Q<k;Q+=4)ee.push(J);var G=f.create(ee,k);I.concat(G)},unpad:function(I){var x=I.words[I.sigBytes-1>>>2]&255;I.sigBytes-=x}},p=y.BlockCipher=P.extend({cfg:P.cfg.extend({mode:c,padding:d}),reset:function(){var I;P.reset.call(this);var x=this.cfg,z=x.iv,k=x.mode;this._xformMode==this._ENC_XFORM_MODE?I=k.createEncryptor:(I=k.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==I?this._mode.init(this,z&&z.words):(this._mode=I.call(k,this,z&&z.words),this._mode.__creator=I)},_doProcessBlock:function(I,x){this._mode.processBlock(I,x)},_doFinalize:function(){var I,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),I=this._process(!0)):(I=this._process(!0),x.unpad(I)),I},blockSize:128/32}),u=y.CipherParams=l.extend({init:function(I){this.mixIn(I)},toString:function(I){return(I||this.formatter).stringify(this)}}),C=m.format={},_=C.OpenSSL={stringify:function(I){var x,z=I.ciphertext,k=I.salt;return k?x=f.create([1398893684,1701076831]).concat(k).concat(z):x=z,x.toString(a)},parse:function(I){var x,z=a.parse(I),k=z.words;return k[0]==1398893684&&k[1]==1701076831&&(x=f.create(k.slice(2,4)),k.splice(0,4),z.sigBytes-=16),u.create({ciphertext:z,salt:x})}},L=y.SerializableCipher=l.extend({cfg:l.extend({format:_}),encrypt:function(I,x,z,k){k=this.cfg.extend(k);var J=I.createEncryptor(z,k),ee=J.finalize(x),Q=J.cfg;return u.create({ciphertext:ee,key:z,iv:Q.iv,algorithm:I,mode:Q.mode,padding:Q.padding,blockSize:I.blockSize,formatter:k.format})},decrypt:function(I,x,z,k){k=this.cfg.extend(k),x=this._parse(x,k.format);var J=I.createDecryptor(z,k).finalize(x.ciphertext);return J},_parse:function(I,x){return typeof I=="string"?x.parse(I,this):I}}),W=m.kdf={},H=W.OpenSSL={execute:function(I,x,z,k){k||(k=f.random(64/8));var J=M.create({keySize:x+z}).compute(I,k),ee=f.create(J.words.slice(x),z*4);return J.sigBytes=x*4,u.create({key:J,iv:ee,salt:k})}},U=y.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(I,x,z,k){k=this.cfg.extend(k);var J=k.kdf.execute(z,I.keySize,I.ivSize);k.iv=J.iv;var ee=L.encrypt.call(this,I,x,J.key,k);return ee.mixIn(J),ee},decrypt:function(I,x,z,k){k=this.cfg.extend(k),x=this._parse(x,k.format);var J=k.kdf.execute(z,I.keySize,I.ivSize,x.salt);k.iv=J.iv;var ee=L.decrypt.call(this,I,x,J.key,k);return ee}})}()})},function(h,r,n){"use strict";r.__esModule=!0,r.Request=r.createRequest=void 0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(11)),y=s.__importDefault(n(0)),l=s.__importDefault(n(7)),f=s.__importDefault(n(5)),A=s.__importDefault(n(8)),S=s.__importDefault(n(3)),R=s.__importDefault(n(20)),a=i.getGlobalObject(),E=function(){},M=a._ablyjs_jsonp={};M._=function(d){return M["_"+d]||E};var P=1,O="jsonp";function b(d,p,u,C,_,L,W){return L=L||A.default.TIMEOUTS,new c(void 0,d,p,i.copy(u),C,_,L,W)}r.createRequest=b;var T=function(d){s.__extends(p,d);function p(u,C,_){var L=d.call(this,u,C,_)||this;return L.shortName=O,_.stream=!1,L}return p.isAvailable=function(){return y.default.Config.jsonpSupported&&y.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(u,C,_,L,W,H,U){return H=(this===null||this===void 0?void 0:this.timeouts)||H||A.default.TIMEOUTS,b(u,C,_,L,W,H,U)},p}(m.default),c=function(d){s.__extends(p,d);function p(u,C,_,L,W,H,U,I){var x=d.call(this)||this;return u===void 0&&(u=P++),x.id=u,x.uri=C,x.params=L||{},x.params.rnd=i.cheapRandStr(),_&&(_["X-Ably-Version"]&&(x.params.v=_["X-Ably-Version"]),_["X-Ably-Lib"]&&(x.params.lib=_["X-Ably-Lib"])),x.body=W,x.method=I,x.requestMode=H,x.timeouts=U,x.requestComplete=!1,x}return p.prototype.exec=function(){var u=this,C=this.id,_=this.body,L=this.method,W=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+C+")",H.envelope="jsonp",_&&(H.body=_),L&&L!=="get"&&(H.method=L);var U=this.script=document.createElement("script"),I=W+i.toQueryString(H);U.src=I,U.src.split("/").slice(-1)[0]!==I.split("/").slice(-1)[0]&&S.default.logAction(S.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),U.async=!0,U.type="text/javascript",U.charset="UTF-8",U.onerror=function(k){u.complete(new f.default("JSONP script error (event: "+y.default.Config.inspect(k)+")",null,400))},M["_"+C]=function(k){if(k.statusCode){var J=k.response;if(k.statusCode==204)u.complete(null,null,null,k.statusCode);else if(!J)u.complete(new f.default("Invalid server response: no envelope detected",null,500));else if(k.statusCode<400||i.isArray(J))u.complete(null,J,k.headers,k.statusCode);else{var ee=J.error||new f.default("Error response received from server",null,k.statusCode);u.complete(ee)}}else u.complete(null,k)};var x=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var z=document.getElementsByTagName("head")[0];z.insertBefore(U,z.firstChild)},p.prototype.complete=function(u,C,_,L){if(_=_||{},!this.requestComplete){this.requestComplete=!0;var W=void 0;C&&(W=typeof C=="string"?"text/plain":"application/json",_["content-type"]=W,this.emit("data",C)),this.emit("complete",u,C,_,!0,L),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var u=this.timer;u&&(clearTimeout(u),this.timer=null);var C=this.script;C.parentNode&&C.parentNode.removeChild(C),delete M[this.id],this.emit("disposed")},p}(l.default);r.Request=c;function g(d){return a.JSONPTransport=T,T.isAvailable()&&(d.supportedTransports[O]=T),T}r.default=g},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(8)),l=s.__importDefault(n(16)),f=s.__importDefault(n(45)),A=s.__importDefault(n(18)),S=s.__importDefault(n(33)),R=s.__importDefault(n(5)),a=s.__importDefault(n(48)),E=s.__importDefault(n(17)),M=s.__importDefault(n(0)),P=function(){},O=function(){function T(c){if(!c){var g="no options provided";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",g),new Error(g)}var d=y.default.objectifyOptions(c);d.log&&m.default.setLog(d.log.level,d.log.handler),m.default.logAction(m.default.LOG_MICRO,"Rest()","initialized with clientOptions "+M.default.Config.inspect(c));var p=this.options=y.default.normaliseOptions(d);if(p.key){var u=p.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!u){var g="invalid key parameter";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",g),new R.default(g,40400,404)}p.keyName=u[1],p.keySecret=u[2]}if("clientId"in p)if(typeof p.clientId=="string"||p.clientId===null){if(p.clientId==="*")throw new R.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new R.default("clientId must be either a string or null",40012,400);m.default.logAction(m.default.LOG_MINOR,"Rest()","started; version = "+y.default.version),this.baseUri=this.authority=function(C){return y.default.getHttpScheme(p)+C+":"+y.default.getPort(p,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new M.default.Http,this.auth=new l.default(this,p),this.channels=new b(this),this.push=new f.default(this)}return T.prototype.stats=function(c,g){if(g===void 0)if(typeof c=="function")g=c,c=null;else{if(this.options.promises)return i.promisify(this,"stats",arguments);g=P}var d=i.defaultGetHeaders(),p=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,u=this.http.supportsLinkHeaders?void 0:p;this.options.headers&&i.mixin(d,this.options.headers),new A.default(this,"/stats",d,u,function(C,_,L){for(var W=L?C:JSON.parse(C),H=0;H<W.length;H++)W[H]=a.default.fromValues(W[H]);return W}).get(c,g)},T.prototype.time=function(c,g){var d=this;if(g===void 0){if(typeof c=="function")g=c,c=null;else if(this.options.promises)return i.promisify(this,"time",arguments)}var p=g||P,u=i.defaultGetHeaders();this.options.headers&&i.mixin(u,this.options.headers);var C=function(_){return d.authority(_)+"/time"};this.http.do(E.default.Get,this,C,u,null,c,function(_,L,W,H){if(_){p(_);return}H||(L=JSON.parse(L));var U=L[0];if(!U){p(new R.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=U-i.now(),p(null,U)})},T.prototype.request=function(c,g,d,p,u,C){var _=this.options.useBinaryProtocol,L=_?M.default.Config.msgpack.encode:JSON.stringify,W=_?M.default.Config.msgpack.decode:JSON.parse,H=_?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:H;d=d||{};var I=c.toLowerCase(),x=I=="get"?i.defaultGetHeaders(H):i.defaultPostHeaders(H);if(C===void 0){if(this.options.promises)return i.promisify(this,"request",arguments);C=P}typeof p!="string"&&(p=L(p)),this.options.headers&&i.mixin(x,this.options.headers),u&&i.mixin(x,u);var z=new A.default(this,g,x,U,function(k,J,ee){return i.ensureArray(ee?k:W(k))},!0);if(!i.arrIn(M.default.Http.methods,I))throw new R.default("Unsupported method "+I,40500,405);i.arrIn(M.default.Http.methodsWithBody,I)?z[I](d,p,C):z[I](d,C)},T.prototype.setLog=function(c){m.default.setLog(c.level,c.handler)},T.Promise=function(c){return c=y.default.objectifyOptions(c),c.promises=!0,new T(c)},T.Callbacks=T,T.Platform=M.default,T}(),b=function(){function T(c){this.rest=c,this.all={}}return T.prototype.get=function(c,g){c=String(c);var d=this.all[c];return d?g&&d.setOptions(g):this.all[c]=d=new S.default(this.rest,c,g),d},T.prototype.release=function(c){delete this.all[String(c)]},T}();r.default=O},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(i){var m=s,y=m.lib,l=y.WordArray,f=y.Hasher,A=m.algo,S=[],R=[];(function(){function M(T){for(var c=i.sqrt(T),g=2;g<=c;g++)if(!(T%g))return!1;return!0}function P(T){return(T-(T|0))*4294967296|0}for(var O=2,b=0;b<64;)M(O)&&(b<8&&(S[b]=P(i.pow(O,1/2))),R[b]=P(i.pow(O,1/3)),b++),O++})();var a=[],E=A.SHA256=f.extend({_doReset:function(){this._hash=new l.init(S.slice(0))},_doProcessBlock:function(M,P){for(var O=this._hash.words,b=O[0],T=O[1],c=O[2],g=O[3],d=O[4],p=O[5],u=O[6],C=O[7],_=0;_<64;_++){if(_<16)a[_]=M[P+_]|0;else{var L=a[_-15],W=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=a[_-2],U=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;a[_]=W+a[_-7]+U+a[_-16]}var I=d&p^~d&u,x=b&T^b&c^T&c,z=(b<<30|b>>>2)^(b<<19|b>>>13)^(b<<10|b>>>22),k=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),J=C+k+I+R[_]+a[_],ee=z+x;C=u,u=p,p=d,d=g+J|0,g=c,c=T,T=b,b=J+ee|0}O[0]=O[0]+b|0,O[1]=O[1]+T|0,O[2]=O[2]+c|0,O[3]=O[3]+g|0,O[4]=O[4]+d|0,O[5]=O[5]+p|0,O[6]=O[6]+u|0,O[7]=O[7]+C|0},_doFinalize:function(){var M=this._data,P=M.words,O=this._nDataBytes*8,b=M.sigBytes*8;return P[b>>>5]|=128<<24-b%32,P[(b+64>>>9<<4)+14]=i.floor(O/4294967296),P[(b+64>>>9<<4)+15]=O,M.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var M=f.clone.call(this);return M._hash=this._hash.clone(),M}});m.SHA256=f._createHelper(E),m.HmacSHA256=f._createHmacHelper(E)}(Math),s.SHA256})},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return s.enc.Utf8})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(3)),l=s.__importDefault(n(34)),f=s.__importDefault(n(9)),A=s.__importDefault(n(5)),S=s.__importDefault(n(18)),R=s.__importDefault(n(24)),a=s.__importDefault(n(0));function E(){}var M=9;function P(T){return i.arrEvery(T,function(c){return!c.id})}function O(T){var c=T||{};if(c.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var g=a.default.Crypto.getCipher(c.cipher);c.cipher=g.cipherParams,c.channelCipher=g.cipher}else"cipher"in c&&(c.cipher=void 0,c.channelCipher=null);return c}var b=function(T){s.__extends(c,T);function c(g,d,p){var u=T.call(this)||this;return y.default.logAction(y.default.LOG_MINOR,"Channel()","started; name = "+d),u.rest=g,u.name=d,u.basePath="/channels/"+encodeURIComponent(d),u.presence=new l.default(u),u.channelOptions=O(p),u}return c.prototype.setOptions=function(g){this.channelOptions=O(g)},c.prototype.history=function(g,d){if(y.default.logAction(y.default.LOG_MICRO,"Channel.history()","channel = "+this.name),d===void 0)if(typeof g=="function")d=g,g=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);d=E}this._history(g,d)},c.prototype._history=function(g,d){var p=this.rest,u=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,C=this.rest.http.supportsLinkHeaders?void 0:u,_=i.defaultGetHeaders(u);p.options.headers&&i.mixin(_,p.options.headers);var L=this.channelOptions;new S.default(p,this.basePath+"/messages",_,C,function(W,H,U){return f.default.fromResponseBody(W,L,U?void 0:u)}).get(g,d)},c.prototype.publish=function(){var g=this,d=arguments.length,p=arguments[0],u=arguments[1],C=arguments[d-1],_,L;if(typeof C!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);C=E}if(typeof p=="string"||p===null)_=[f.default.fromValues({name:p,data:u})],L=arguments[2];else if(i.isObject(p))_=[f.default.fromValues(p)],L=arguments[1];else if(i.isArray(p))_=f.default.fromValuesArray(p),L=arguments[1];else throw new A.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var W=this.rest,H=W.options,U=H.useBinaryProtocol?i.Format.msgpack:i.Format.json,I=W.options.idempotentRestPublishing,x=i.defaultPostHeaders(U);if(H.headers&&i.mixin(x,H.headers),I&&P(_)){var z=i.randomString(M);i.arrForEach(_,function(k,J){k.id=z+":"+J.toString()})}f.default.encodeArray(_,this.channelOptions,function(k){if(k){C(k);return}var J=f.default.getMessagesSize(_),ee=H.maxMessageSize;if(J>ee){C(new A.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+ee+" bytes)",40009,400));return}g._publish(f.default.serialize(_,U),x,L,C)})},c.prototype._publish=function(g,d,p,u){R.default.post(this.rest,this.basePath+"/messages",g,d,p,null,u)},c.prototype.status=function(g){if(typeof g!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var d=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(d);R.default.get(this.rest,this.basePath,p,{},d,g||E)},c}(m.default);r.default=b},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(3)),l=s.__importDefault(n(18)),f=s.__importDefault(n(14));function A(){}var S=function(R){s.__extends(a,R);function a(E){var M=R.call(this)||this;return M.channel=E,M.basePath=E.basePath+"/presence",M}return a.prototype.get=function(E,M){if(y.default.logAction(y.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),M===void 0)if(typeof E=="function")M=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);M=A}var P=this.channel.rest,O=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:O,T=i.defaultGetHeaders(O);P.options.headers&&i.mixin(T,P.options.headers);var c=this.channel.channelOptions;new l.default(P,this.basePath,T,b,function(g,d,p){return f.default.fromResponseBody(g,c,p?void 0:O)}).get(E,M)},a.prototype.history=function(E,M){y.default.logAction(y.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,M)},a.prototype._history=function(E,M){if(M===void 0)if(typeof E=="function")M=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",arguments);M=A}var P=this.channel.rest,O=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:O,T=i.defaultGetHeaders(O);P.options.headers&&i.mixin(T,P.options.headers);var c=this.channel.channelOptions;new l.default(P,this.basePath+"/history",T,b,function(g,d,p){return f.default.fromResponseBody(g,c,p?void 0:O)}).get(E,M)},a}(m.default);r.default=S},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(7)),m=s.__importDefault(n(3)),y=function(l){s.__extends(f,l);function f(){var A=l.call(this)||this;return A.messages=[],A}return f.prototype.count=function(){return this.messages.length},f.prototype.push=function(A){this.messages.push(A)},f.prototype.shift=function(){return this.messages.shift()},f.prototype.last=function(){return this.messages[this.messages.length-1]},f.prototype.copyAll=function(){return this.messages.slice()},f.prototype.append=function(A){this.messages.push.apply(this.messages,A)},f.prototype.prepend=function(A){this.messages.unshift.apply(this.messages,A)},f.prototype.completeMessages=function(A,S,R){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+A+"; count = "+S),R=R||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=a[0];if(E){var M=E.message.msgSerial,P=A+S;if(P>M)for(var O=a.splice(0,P-M),b=0,T=O;b<T.length;b++){var c=T[b];c.callback(R)}a.length==0&&this.emit("idle")}},f.prototype.completeAllMessages=function(A){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,A)},f.prototype.clear=function(){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},f}(i.default);r.default=y},function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(m,y,l,f){this.previous=m,this.current=y,l&&(this.retryIn=l),f&&(this.reason=f)}return i}();r.default=s},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importDefault(n(7)),y=s.__importStar(n(2)),l=s.__importDefault(n(33)),f=s.__importDefault(n(3)),A=s.__importDefault(n(54)),S=s.__importDefault(n(9)),R=s.__importDefault(n(38)),a=s.__importDefault(n(5)),E=s.__importDefault(n(14)),M=s.__importDefault(n(19)),P=i.default.Action,O=function(){},b="statechange",T="sync";function c(d){if(d&&"params"in d&&!y.isObject(d.params))return new a.default("options.params must be an object",4e4,400);if(d&&"modes"in d){if(!y.isArray(d.modes))return new a.default("options.modes must be an array",4e4,400);for(var p=0;p<d.modes.length;p++){var u=d.modes[p];if(!u||typeof u!="string"||!y.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(u)))return new a.default("Invalid channel mode: "+u,4e4,400)}}}var g=function(d){s.__extends(p,d);function p(u,C,_){var L=d.call(this,u,C,_)||this;return L.retryCount=0,L.history=function(W,H){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof W=="function")H=W,W=null;else{if(this.rest.options.promises)return y.promisify(this,"history",arguments);H=O}if(W&&W.untilAttach){if(this.state!=="attached"){H(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete W.untilAttach,W.from_serial=this.properties.attachSerial}l.default.prototype._history.call(this,W,H)},L.whenState=function(W,H){return m.default.prototype.whenState.call(L,W,L.state,H)},f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel()","started; name = "+C),L.realtime=u,L.presence=new A.default(L),L.connectionManager=u.connection.connectionManager,L.state="initialized",L.subscriptions=new m.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(_),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:u.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new m.default,L}return p.invalidStateError=function(u){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+u}},p.processListenerArgs=function(u){return u=Array.prototype.slice.call(u),typeof u[0]=="function"&&u.unshift(null),u[u.length-1]==null&&u.pop(),u},p.prototype.setOptions=function(u,C){if(!C&&this.rest.options.promises)return y.promisify(this,"setOptions",arguments);var _=C||function(W){W&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+W.toString())},L=c(u);if(L){_(L);return}l.default.prototype.setOptions.call(this,u),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(u)?(this.attachImpl(),this._allChannelChanges.once(function(W){switch(this.event){case"update":case"attached":_==null||_(null);return;default:_==null||_(W.reason);return}})):_()},p.prototype._shouldReattachToSetOptions=function(u){return(this.state==="attached"||this.state==="attaching")&&(u.params||u.modes)},p.prototype.publish=function(){for(var u=this,C=[],_=0;_<arguments.length;_++)C[_]=arguments[_];var L=C[0],W=C.length,H=C[W-1];if(typeof H!="function"){if(this.realtime.options.promises)return y.promisify(this,"publish",arguments);H=O,++W}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(W==2)if(y.isObject(L))L=[S.default.fromValues(L)];else if(y.isArray(L))L=S.default.fromValuesArray(L);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[S.default.fromValues({name:C[0],data:C[1]})];var U=this.realtime.options.maxMessageSize;S.default.encodeArray(L,this.channelOptions,function(I){if(I){H(I);return}var x=S.default.getMessagesSize(L);if(x>U){H(new a.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+U+" bytes)",40009,400));return}u.__publish(L,H)})},p.prototype.__publish=function(u,C){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+u.length);var _=this.state;switch(_){case"failed":case"suspended":C(a.default.fromValues(p.invalidStateError(_)));break;default:{f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+_);var L=new i.default;L.action=P.MESSAGE,L.channel=this.name,L.messages=u,this.sendMessage(L,C);break}}},p.prototype.onEvent=function(u){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var C=this.subscriptions,_=0;_<u.length;_++){var L=u[_];C.emit(L.name,L)}},p.prototype.attach=function(u,C){var _;if(typeof u=="function"?(C=u,_=null):_=u,!C){if(this.realtime.options.promises)return y.promisify(this,"attach",arguments);C=function(L){L&&f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(_)f.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=_;else if(this.state==="attached"){C();return}this._attach(!1,null,C)},p.prototype._attach=function(u,C,_){_||(_=function(W){W&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+W.toString())});var L=this.connectionManager;if(!L.activeState()){_(L.getError());return}(this.state!=="attaching"||u)&&this.requestState("attaching",C),this.once(function(W){switch(this.event){case"attached":_==null||_();break;case"detached":case"suspended":case"failed":_==null||_(W.reason||L.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":_==null||_(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},p.prototype.attachImpl=function(){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(b,!0);var u=i.default.fromValues({action:P.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?u.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&u.encodeModesToFlags(y.allToUpperCase(this.channelOptions.modes)),this._attachResume&&u.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(u.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(u,O)},p.prototype.detach=function(u){if(!u){if(this.realtime.options.promises)return y.promisify(this,"detach",arguments);u=O}var C=this.connectionManager;if(!C.activeState()){u(C.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),u();break;case"detached":u();break;case"failed":u(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(_){switch(this.event){case"detached":u();break;case"attached":case"suspended":case"failed":u(_.reason||C.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":u(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},p.prototype.detachImpl=function(u){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(b,!0);var C=i.default.fromValues({action:P.DETACH,channel:this.name});this.sendMessage(C,u||O)},p.prototype.subscribe=function(){for(var u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];var _=p.processListenerArgs(u),L=_[0],W=_[1],H=_[2];if(!H&&this.realtime.options.promises)return y.promisify(this,"subscribe",[L,W]);if(this.state==="failed"){H==null||H(a.default.fromValues(p.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,W):this.subscriptions.on(L,W),this.attach(H||O)},p.prototype._subscribeFilter=function(u,C){var _=function(L){var W,H,U,I,x,z,k={name:L.name,refTimeserial:(H=(W=L.extras)===null||W===void 0?void 0:W.ref)===null||H===void 0?void 0:H.timeserial,refType:(I=(U=L.extras)===null||U===void 0?void 0:U.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((z=(x=L.extras)===null||x===void 0?void 0:x.ref)===null||z===void 0)&&z.timeserial),clientId:L.clientId};Object.entries(u).find(function(J){var ee=J[0],Q=J[1];return Q!==void 0?k[ee]!==Q:!1})||C(L)};this._addFilteredSubscription(u,C,_),this.subscriptions.on(_)},p.prototype._addFilteredSubscription=function(u,C,_){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(C)){var W=this.filteredSubscriptions.get(C);W.set(u,((L=W==null?void 0:W.get(u))===null||L===void 0?void 0:L.concat(_))||[_])}else this.filteredSubscriptions.set(C,new Map([[u,[_]]]))},p.prototype._getAndDeleteFilteredSubscriptions=function(u,C){var _=this;if(!this.filteredSubscriptions)return[];if(!C&&u)return Array.from(this.filteredSubscriptions.entries()).map(function(U){var I,x=U[0],z=U[1],k=z.get(u);return z.delete(u),z.size===0&&((I=_.filteredSubscriptions)===null||I===void 0||I.delete(x)),k}).reduce(function(U,I){var x;return I?(x=U).concat.apply(x,I):U},[]);if(!C||!this.filteredSubscriptions.has(C))return[];var L=this.filteredSubscriptions.get(C);if(!u){var W=Array.from(L.values()).reduce(function(U,I){return U.concat.apply(U,I)},[]);return this.filteredSubscriptions.delete(C),W}var H=L.get(u);return L.delete(u),H||[]},p.prototype.unsubscribe=function(){for(var u=this,C,_=[],L=0;L<arguments.length;L++)_[L]=arguments[L];var W=p.processListenerArgs(_),H=W[0],U=W[1];if(typeof H=="object"&&!U||((C=this.filteredSubscriptions)===null||C===void 0?void 0:C.has(U))){this._getAndDeleteFilteredSubscriptions(H,U).forEach(function(I){return u.subscriptions.off(I)});return}this.subscriptions.off(H,U)},p.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.default("Unable to sync to channel; not attached",4e4);default:}var u=this.connectionManager;if(!u.activeState())throw u.getError();var C=i.default.fromValues({action:P.SYNC,channel:this.name});this.syncChannelSerial&&(C.channelSerial=this.syncChannelSerial),u.send(C)},p.prototype.sendMessage=function(u,C){this.connectionManager.send(u,this.realtime.options.queueMessages,C)},p.prototype.sendPresence=function(u,C){var _=i.default.fromValues({action:P.PRESENCE,channel:this.name,presence:y.isArray(u)?E.default.fromValuesArray(u):[E.default.fromValues(u)]});this.sendMessage(_,C)},p.prototype.onMessage=function(u){var C,_=!1;switch(u.action){case P.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=u.channelSerial,this._mode=u.getMode(),this.params=u.params||{};var L=u.decodeModesFromFlags();this.modes=L&&y.allToLowerCase(L)||void 0;var W=u.hasFlag("RESUMED"),H=u.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(b,!1),W||this.presence.onAttached(H);var U=new R.default(this.state,this.state,W,u.error);this._allChannelChanges.emit("update",U),(!W||this.channelOptions.updateOnAttached)&&this.emit("update",U)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",u.error,W,H);break}case P.DETACHED:{var I=u.error?a.default.fromValues(u.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",I):this.state==="attaching"?this.notifyState("suspended",I):this.requestState("attaching",I);break}case P.SYNC:if(_=!0,C=this.syncChannelSerial=u.channelSerial,!u.presence)break;case P.PRESENCE:{for(var x=u.presence,z=u.id,k=u.connectionId,J=u.timestamp,ee=this.channelOptions,Q=void 0,G=0;G<x.length;G++)try{Q=x[G],E.default.decode(Q,ee),Q.connectionId||(Q.connectionId=k),Q.timestamp||(Q.timestamp=J),Q.id||(Q.id=z+":"+G)}catch(le){f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",le.toString())}this.presence.setPresence(x,_,C);break}case P.MESSAGE:{if(this.state!=="attached"){f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+u.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var D=u.messages,B=D[0],V=D[D.length-1],z=u.id,k=u.connectionId,J=u.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var j='Delta message decode failure - previous message not available for message "'+u.id+'" on this channel "'+this.name+'".';f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",j),this._startDecodeFailureRecovery(new a.default(j,40018,400));break}for(var G=0;G<D.length;G++){var j=D[G];try{S.default.decode(j,this._decodingContext)}catch(de){switch(f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",de.toString()),de.code){case 40018:this._startDecodeFailureRecovery(de);return;case 40019:case 40021:this.notifyState("failed",de);return}}j.connectionId||(j.connectionId=k),j.timestamp||(j.timestamp=J),j.id||(j.id=z+":"+G)}this._lastPayload.messageId=V.id,this._lastPayload.protocolMessageChannelSerial=u.channelSerial,this.onEvent(D);break}case P.ERROR:{var te=u.error;te&&te.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(te));break}default:f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+u.action+")"),this.connectionManager.abort(M.default.unknownChannelErr)}},p.prototype._startDecodeFailureRecovery=function(u){var C=this;this._lastPayload.decodeFailureRecoveryInProgress||(f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,u,function(){C._lastPayload.decodeFailureRecoveryInProgress=!1}))},p.prototype.onAttached=function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},p.prototype.notifyState=function(u,C,_,L){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+u),this.clearStateTimer(),u!==this.state){this.presence.actOnChannelState(u,L,C),u==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),C&&(this.errorReason=C);var W=new R.default(this.state,u,_,C),H=u==="failed"?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(H,'Channel state for channel "'+this.name+'"',u+(C?"; reason: "+C:"")),u!=="attaching"&&u!=="suspended"&&(this.retryCount=0),u==="attached"?(this.onAttached(),this.setInProgress(T,L),this.setInProgress(b,!1)):(u==="detached"||u==="failed"||u==="suspended")&&(this.setInProgress(b,!1),this.setInProgress(T,!1)),u==="attached"?this._attachResume=!0:(u==="detaching"||u==="failed")&&(this._attachResume=!1),this.state=u,this._allChannelChanges.emit(u,W),this.emit(u,W)}},p.prototype.requestState=function(u,C){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+u),this.notifyState(u,C),this.checkPendingState()},p.prototype.checkPendingState=function(){var u=this.connectionManager.state;if(!(u.sendEvents||u.forceQueueEvents)){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},p.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var u=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",u);break}case"detaching":{var u=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",u);break}default:this.checkPendingState();break}},p.prototype.startStateTimerIfNotRunning=function(){var u=this;this.stateTimer||(this.stateTimer=setTimeout(function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),u.stateTimer=null,u.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},p.prototype.clearStateTimer=function(){var u=this.stateTimer;u&&(clearTimeout(u),this.stateTimer=null)},p.prototype.startRetryTimer=function(){var u=this;if(!this.retryTimer){this.retryCount++;var C=this.realtime.options.timeouts.channelRetryTimeout*y.getJitterCoefficient()*y.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){u.state==="suspended"&&u.connectionManager.state.sendEvents&&(u.retryTimer=null,f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),u.requestState("attaching"))},C)}},p.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},p.prototype.setInProgress=function(u,C){this.rest.channels.setInProgress(this,u,C)},p.prototype.getReleaseErr=function(){var u=this.state;return u==="initialized"||u==="detached"||u==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+u,90001,400)},p.progressOps={statechange:b,sync:T},p}(l.default);r.default=g},function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(m,y,l,f){this.previous=m,this.current=y,y==="attached"&&(this.resumed=l),f&&(this.reason=f)}return i}();r.default=s},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,l=m.Hasher,f=i.algo,A=[],S=f.SHA1=l.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,a){for(var E=this._hash.words,M=E[0],P=E[1],O=E[2],b=E[3],T=E[4],c=0;c<80;c++){if(c<16)A[c]=R[a+c]|0;else{var g=A[c-3]^A[c-8]^A[c-14]^A[c-16];A[c]=g<<1|g>>>31}var d=(M<<5|M>>>27)+T+A[c];c<20?d+=(P&O|~P&b)+1518500249:c<40?d+=(P^O^b)+1859775393:c<60?d+=(P&O|P&b|O&b)-1894007588:d+=(P^O^b)-899497514,T=b,b=O,O=P<<30|P>>>2,P=M,M=d}E[0]=E[0]+M|0,E[1]=E[1]+P|0,E[2]=E[2]+O|0,E[3]=E[3]+b|0,E[4]=E[4]+T|0},_doFinalize:function(){var R=this._data,a=R.words,E=this._nDataBytes*8,M=R.sigBytes*8;return a[M>>>5]|=128<<24-M%32,a[(M+64>>>9<<4)+14]=Math.floor(E/4294967296),a[(M+64>>>9<<4)+15]=E,R.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var R=l.clone.call(this);return R._hash=this._hash.clone(),R}});i.SHA1=l._createHelper(S),i.HmacSHA1=l._createHmacHelper(S)}(),s.SHA1})},function(h,r,n){"use strict";r.__esModule=!0;function s(c){if(c===void 0)return"undefined";var g,d;if(c instanceof ArrayBuffer?(d="ArrayBuffer",g=new DataView(c)):c instanceof DataView&&(d="DataView",g=c),!g)return JSON.stringify(c);for(var p=[],u=0;u<c.byteLength;u++){if(u>20){p.push("...");break}var C=g.getUint8(u).toString(16);C.length===1&&(C="0"+C),p.push(C)}return"<"+d+" "+p.join(" ")+">"}function i(c,g,d){for(var p=0,u=d.length;p<u;p++){var C=d.charCodeAt(p);if(C<128){c.setUint8(g++,C>>>0&127|0);continue}if(C<2048){c.setUint8(g++,C>>>6&31|192),c.setUint8(g++,C>>>0&63|128);continue}if(C<65536){c.setUint8(g++,C>>>12&15|224),c.setUint8(g++,C>>>6&63|128),c.setUint8(g++,C>>>0&63|128);continue}if(C<1114112){c.setUint8(g++,C>>>18&7|240),c.setUint8(g++,C>>>12&63|128),c.setUint8(g++,C>>>6&63|128),c.setUint8(g++,C>>>0&63|128);continue}throw new Error("bad codepoint "+C)}}function m(c,g,d){for(var p="",u=g,C=g+d;u<C;u++){var _=c.getUint8(u);if((_&128)===0){p+=String.fromCharCode(_);continue}if((_&224)===192){p+=String.fromCharCode((_&15)<<6|c.getUint8(++u)&63);continue}if((_&240)===224){p+=String.fromCharCode((_&15)<<12|(c.getUint8(++u)&63)<<6|(c.getUint8(++u)&63)<<0);continue}if((_&248)===240){p+=String.fromCharCode((_&7)<<18|(c.getUint8(++u)&63)<<12|(c.getUint8(++u)&63)<<6|(c.getUint8(++u)&63)<<0);continue}throw new Error("Invalid byte "+_.toString(16))}return p}function y(c){for(var g=0,d=0,p=c.length;d<p;d++){var u=c.charCodeAt(d);if(u<128){g+=1;continue}if(u<2048){g+=2;continue}if(u<65536){g+=3;continue}if(u<1114112){g+=4;continue}throw new Error("bad codepoint "+u)}return g}function l(c,g){var d=T(c,g);if(d!==0){var p=new ArrayBuffer(d),u=new DataView(p);return b(c,u,0,g),p}}var f=(1<<16)*(1<<16),A=1/f;function S(c,g){return g=g||0,c.getInt32(g)*f+c.getUint32(g+4)}function R(c,g){return g=g||0,c.getUint32(g)*f+c.getUint32(g+4)}function a(c,g,d){d<9223372036854776e3?(c.setInt32(g,Math.floor(d*A)),c.setInt32(g+4,d&-1)):(c.setUint32(g,2147483647),c.setUint32(g+4,2147483647))}function E(c,g,d){d<18446744073709552e3?(c.setUint32(g,Math.floor(d*A)),c.setInt32(g+4,d&-1)):(c.setUint32(g,4294967295),c.setUint32(g+4,4294967295))}var M=function(){function c(g,d){var p=this;this.map=function(u){for(var C={},_=0;_<u;_++){var L=p.parse();C[L]=p.parse()}return C},this.bin=function(u){var C=new ArrayBuffer(u);return new Uint8Array(C).set(new Uint8Array(p.view.buffer,p.offset,u),0),p.offset+=u,C},this.buf=this.bin,this.str=function(u){var C=m(p.view,p.offset,u);return p.offset+=u,C},this.array=function(u){for(var C=new Array(u),_=0;_<u;_++)C[_]=p.parse();return C},this.ext=function(u){return p.offset+=u,{type:p.view.getInt8(p.offset),data:p.buf(u)}},this.parse=function(){var u=p.view.getUint8(p.offset),C,_;if((u&128)===0)return p.offset++,u;if((u&240)===128)return _=u&15,p.offset++,p.map(_);if((u&240)===144)return _=u&15,p.offset++,p.array(_);if((u&224)===160)return _=u&31,p.offset++,p.str(_);if((u&224)===224)return C=p.view.getInt8(p.offset),p.offset++,C;switch(u){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(_);case 197:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(_);case 198:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(_);case 199:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(_);case 200:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(_);case 201:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(_);case 202:return C=p.view.getFloat32(p.offset+1),p.offset+=5,C;case 203:return C=p.view.getFloat64(p.offset+1),p.offset+=9,C;case 204:return C=p.view.getUint8(p.offset+1),p.offset+=2,C;case 205:return C=p.view.getUint16(p.offset+1),p.offset+=3,C;case 206:return C=p.view.getUint32(p.offset+1),p.offset+=5,C;case 207:return C=R(p.view,p.offset+1),p.offset+=9,C;case 208:return C=p.view.getInt8(p.offset+1),p.offset+=2,C;case 209:return C=p.view.getInt16(p.offset+1),p.offset+=3,C;case 210:return C=p.view.getInt32(p.offset+1),p.offset+=5,C;case 211:return C=S(p.view,p.offset+1),p.offset+=9,C;case 212:return _=1,p.offset++,p.ext(_);case 213:return _=2,p.offset++,p.ext(_);case 214:return _=4,p.offset++,p.ext(_);case 215:return _=8,p.offset++,p.ext(_);case 216:return _=16,p.offset++,p.ext(_);case 217:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.str(_);case 218:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.str(_);case 219:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.str(_);case 220:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.array(_);case 221:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.array(_);case 222:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.map(_);case 223:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.map(_)}throw new Error("Unknown type 0x"+u.toString(16))},this.offset=d||0,this.view=g}return c}();function P(c){var g=new DataView(c),d=new M(g),p=d.parse();if(d.offset!==c.byteLength)throw new Error(c.byteLength-d.offset+" trailing bytes");return p}function O(c,g){return Object.keys(c).filter(function(d){var p=c[d],u=typeof p;return(!g||p!=null)&&(u!=="function"||!!p.toJSON)})}function b(c,g,d,p){var u=typeof c;if(typeof c=="string"){var C=y(c);if(C<32)return g.setUint8(d,C|160),i(g,d+1,c),1+C;if(C<256)return g.setUint8(d,217),g.setUint8(d+1,C),i(g,d+2,c),2+C;if(C<65536)return g.setUint8(d,218),g.setUint16(d+1,C),i(g,d+3,c),3+C;if(C<4294967296)return g.setUint8(d,219),g.setUint32(d+1,C),i(g,d+5,c),5+C}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var _=c.byteLength;if(_<256)return g.setUint8(d,196),g.setUint8(d+1,_),new Uint8Array(g.buffer).set(new Uint8Array(c),d+2),2+_;if(_<65536)return g.setUint8(d,197),g.setUint16(d+1,_),new Uint8Array(g.buffer).set(new Uint8Array(c),d+3),3+_;if(_<4294967296)return g.setUint8(d,198),g.setUint32(d+1,_),new Uint8Array(g.buffer).set(new Uint8Array(c),d+5),5+_}if(typeof c=="number"){if(Math.floor(c)!==c)return g.setUint8(d,203),g.setFloat64(d+1,c),9;if(c>=0){if(c<128)return g.setUint8(d,c),1;if(c<256)return g.setUint8(d,204),g.setUint8(d+1,c),2;if(c<65536)return g.setUint8(d,205),g.setUint16(d+1,c),3;if(c<4294967296)return g.setUint8(d,206),g.setUint32(d+1,c),5;if(c<18446744073709552e3)return g.setUint8(d,207),E(g,d+1,c),9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return g.setInt8(d,c),1;if(c>=-128)return g.setUint8(d,208),g.setInt8(d+1,c),2;if(c>=-32768)return g.setUint8(d,209),g.setInt16(d+1,c),3;if(c>=-2147483648)return g.setUint8(d,210),g.setInt32(d+1,c),5;if(c>=-9223372036854776e3)return g.setUint8(d,211),a(g,d+1,c),9;throw new Error("Number too small -0x"+(-c).toString(16).substr(1))}if(u==="undefined")return p?0:(g.setUint8(d,212),g.setUint8(d+1,0),g.setUint8(d+2,0),3);if(c===null)return p?0:(g.setUint8(d,192),1);if(u==="boolean")return g.setUint8(d,c?195:194),1;if(typeof c.toJSON=="function")return b(c.toJSON(),g,d,p);if(u==="object"){var L,W=0,H=void 0,U=Array.isArray(c);if(U?L=c.length:(H=O(c,p),L=H.length),L<16?(g.setUint8(d,L|(U?144:128)),W=1):L<65536?(g.setUint8(d,U?220:222),g.setUint16(d+1,L),W=3):L<4294967296&&(g.setUint8(d,U?221:223),g.setUint32(d+1,L),W=5),U)for(var I=0;I<L;I++)W+=b(c[I],g,d+W,p);else if(H)for(var I=0;I<L;I++){var x=H[I];W+=b(x,g,d+W),W+=b(c[x],g,d+W,p)}return W}if(u==="function")return 0;throw new Error("Unknown type "+u)}function T(c,g){var d=typeof c;if(d==="string"){var p=y(c);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var u=c.byteLength;if(u<256)return 2+u;if(u<65536)return 3+u;if(u<4294967296)return 5+u}if(typeof c=="number"){if(Math.floor(c)!==c)return 9;if(c>=0){if(c<128)return 1;if(c<256)return 2;if(c<65536)return 3;if(c<4294967296)return 5;if(c<18446744073709552e3)return 9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return 1;if(c>=-128)return 2;if(c>=-32768)return 3;if(c>=-2147483648)return 5;if(c>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+c.toString(16).substr(1))}if(d==="boolean")return 1;if(c===null)return g?0:1;if(c===void 0)return g?0:3;if(typeof c.toJSON=="function")return T(c.toJSON(),g);if(d==="object"){var C,_=0;if(Array.isArray(c)){C=c.length;for(var L=0;L<C;L++)_+=T(c[L],g)}else{var W=O(c,g);C=W.length;for(var L=0;L<C;L++){var H=W[L];_+=T(H)+T(c[H],g)}}if(C<16)return 1+_;if(C<65536)return 3+_;if(C<4294967296)return 5+_;throw new Error("Array or object too long 0x"+C.toString(16))}if(d==="function")return 0;throw new Error("Unknown type "+d)}r.default={encode:l,decode:P,inspect:s,utf8Write:i,utf8Read:m,utf8ByteCount:y}},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(30)),m=s.__importDefault(n(49)),y=s.__importDefault(n(0)),l=s.__importDefault(n(55)),f=s.__importDefault(n(57)),A=s.__importDefault(n(62)),S=s.__importDefault(n(63)),R=s.__importDefault(n(67)),a=s.__importDefault(n(3)),E=n(8),M=s.__importDefault(n(25)),P=s.__importDefault(n(64)),O=s.__importDefault(n(65)),b=s.__importDefault(n(40)),T=s.__importDefault(n(9)),c=s.__importDefault(n(14));y.default.Crypto=f.default,y.default.BufferUtils=l.default,y.default.Http=A.default,y.default.Config=S.default,y.default.Transports=R.default,y.default.WebStorage=P.default,i.default.Crypto=f.default,m.default.Crypto=f.default,i.default.Message=T.default,m.default.Message=T.default,i.default.PresenceMessage=c.default,m.default.PresenceMessage=c.default,m.default.ConnectionManager=M.default,a.default.initLogHandlers(),y.default.Defaults=E.getDefaults(O.default),y.default.Config.agent&&(y.default.Defaults.agent+=" "+y.default.Config.agent),y.default.Config.noUpgrade&&(y.default.Defaults.upgradeTransports=[]),r.default={Rest:i.default,Realtime:m.default,msgpack:b.default}},function(h){h.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(31),n(23))})(this,function(s){return s.HmacSHA256})},function(h,r){},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(46)),y=s.__importDefault(n(24)),l=s.__importDefault(n(18)),f=s.__importDefault(n(5)),A=s.__importDefault(n(47)),S=function(){},R=function(){function P(O){this.rest=O,this.admin=new a(O)}return P}(),a=function(){function P(O){this.rest=O,this.deviceRegistrations=new E(O),this.channelSubscriptions=new M(O)}return P.prototype.publish=function(O,b,T){var c=this.rest,g=c.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(g),p={},u=i.mixin({recipient:O},b);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);T=S}c.options.headers&&i.mixin(d,c.options.headers),c.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var C=i.encodeBody(u,g);y.default.post(c,"/push/publish",C,d,p,null,function(_){return T(_)})},P}(),E=function(){function P(O){this.rest=O}return P.prototype.save=function(O,b){var T=this.rest,c=m.default.fromValues(O),g=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(g),p={};if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);b=S}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var u=i.encodeBody(c,g);y.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(O.id),u,d,p,null,function(C,_,L,W){b(C,C?void 0:m.default.fromResponseBody(_,W?void 0:g))})},P.prototype.get=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(c),d=O.id||O;if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);b=S}if(typeof d!="string"||!d.length){b(new f.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(g,T.options.headers),y.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(d),g,{},null,function(p,u,C,_){b(p,p?void 0:m.default.fromResponseBody(u,_?void 0:c))})},P.prototype.list=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:c,d=i.defaultGetHeaders(c);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);b=S}T.options.headers&&i.mixin(d,T.options.headers),new l.default(T,"/push/deviceRegistrations",d,g,function(p,u,C){return m.default.fromResponseBody(p,C?void 0:c)}).get(O,b)},P.prototype.remove=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(c),d={},p=O.id||O;if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);b=S}if(typeof p!="string"||!p.length){b(new f.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(g,T.options.headers),T.options.pushFullWait&&i.mixin(d,{fullWait:"true"}),y.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(p),g,d,null,function(u){return b(u)})},P.prototype.removeWhere=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(c);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);b=S}T.options.headers&&i.mixin(g,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),y.default.delete(T,"/push/deviceRegistrations",g,O,null,function(d){return b(d)})},P}(),M=function(){function P(O){this.remove=P.prototype.removeWhere,this.rest=O}return P.prototype.save=function(O,b){var T=this.rest,c=A.default.fromValues(O),g=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(g),p={};if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);b=S}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var u=i.encodeBody(c,g);y.default.post(T,"/push/channelSubscriptions",u,d,p,null,function(C,_,L,W){b(C,!C&&A.default.fromResponseBody(_,W?void 0:g))})},P.prototype.list=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:c,d=i.defaultGetHeaders(c);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);b=S}T.options.headers&&i.mixin(d,T.options.headers),new l.default(T,"/push/channelSubscriptions",d,g,function(p,u,C){return A.default.fromResponseBody(p,C?void 0:c)}).get(O,b)},P.prototype.removeWhere=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(c);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);b=S}T.options.headers&&i.mixin(g,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),y.default.delete(T,"/push/channelSubscriptions",g,O,null,function(d){return b(d)})},P.prototype.listChannels=function(O,b){var T=this.rest,c=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:c,d=i.defaultGetHeaders(c);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);b=S}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),new l.default(T,"/push/channels",d,g,function(p,u,C){for(var _=!C&&c?i.decodeBody(p,c):p,L=0;L<_.length;L++)_[L]=String(_[L]);return _}).get(O,b)},P}();r.default=R},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(5)),y;(function(A){A.Phone="phone",A.Tablet="tablet",A.Desktop="desktop",A.TV="tv",A.Watch="watch",A.Car="car",A.Embedded="embedded",A.Other="other"})(y||(y={}));var l;(function(A){A.Android="android",A.IOS="ios",A.Browser="browser"})(l||(l={}));var f=function(){function A(){}return A.prototype.toJSON=function(){var S,R,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(S=this.push)===null||S===void 0?void 0:S.recipient,state:(R=this.push)===null||R===void 0?void 0:R.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},A.prototype.toString=function(){var S,R,a,E,M="[DeviceDetails";return this.id&&(M+="; id="+this.id),this.platform&&(M+="; platform="+this.platform),this.formFactor&&(M+="; formFactor="+this.formFactor),this.clientId&&(M+="; clientId="+this.clientId),this.metadata&&(M+="; metadata="+this.metadata),this.deviceIdentityToken&&(M+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((S=this.push)===null||S===void 0)&&S.recipient&&(M+="; push.recipient="+JSON.stringify(this.push.recipient)),!((R=this.push)===null||R===void 0)&&R.state&&(M+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(M+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(M+="; push.metadata="+this.push.metadata),M+="]",M},A.fromResponseBody=function(S,R){return R&&(S=i.decodeBody(S,R)),i.isArray(S)?A.fromValuesArray(S):A.fromValues(S)},A.fromValues=function(S){return S.error=S.error&&m.default.fromValues(S.error),Object.assign(new A,S)},A.fromValuesArray=function(S){for(var R=S.length,a=new Array(R),E=0;E<R;E++)a[E]=A.fromValues(S[E]);return a},A.toRequestBody=i.encodeBody,A}();r.default=f},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=function(){function y(){}return y.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},y.prototype.toString=function(){var l="[PushChannelSubscription";return this.channel&&(l+="; channel="+this.channel),this.deviceId&&(l+="; deviceId="+this.deviceId),this.clientId&&(l+="; clientId="+this.clientId),l+="]",l},y.fromResponseBody=function(l,f){return f&&(l=i.decodeBody(l,f)),i.isArray(l)?y.fromValuesArray(l):y.fromValues(l)},y.fromValues=function(l){return Object.assign(new y,l)},y.fromValuesArray=function(l){for(var f=l.length,A=new Array(f),S=0;S<f;S++)A[S]=y.fromValues(l[S]);return A},y.toRequestBody=i.encodeBody,y}();r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=function(){function T(c){this.count=c&&c.count||0,this.data=c&&c.data||0,this.uncompressedData=c&&c.uncompressedData||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return T}(),y=function(T){s.__extends(c,T);function c(g){var d=T.call(this,g)||this;return g&&g.category&&(d.category={},i.forInOwnNonNullProperties(g.category,function(p){d.category[p]=new m(g.category[p])})),d}return c}(m),l=function(){function T(c){this.peak=c&&c.peak||0,this.min=c&&c.min||0,this.mean=c&&c.mean||0,this.opened=c&&c.opened||0,this.refused=c&&c.refused||0}return T}(),f=function(){function T(c){this.succeeded=c&&c.succeeded||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return T}(),A=function(){function T(c){this.plain=new l(c&&c.plain),this.tls=new l(c&&c.tls),this.all=new l(c&&c.all)}return T}(),S=function(){function T(c){this.messages=new y(c&&c.messages),this.presence=new y(c&&c.presence),this.all=new y(c&&c.all)}return T}(),R=function(){function T(c){this.realtime=new S(c&&c.realtime),this.rest=new S(c&&c.rest),this.webhook=new S(c&&c.webhook),this.sharedQueue=new S(c&&c.sharedQueue),this.externalQueue=new S(c&&c.externalQueue),this.httpEvent=new S(c&&c.httpEvent),this.push=new S(c&&c.push),this.all=new S(c&&c.all)}return T}(),a=function(){function T(c){this.all=new S(c&&c.all),this.inbound=new R(c&&c.inbound),this.outbound=new R(c&&c.outbound)}return T}(),E=function(){function T(c){this.all=new S(c&&c.all),this.producerPaid=new a(c&&c.producerPaid),this.consumerPaid=new a(c&&c.consumerPaid)}return T}(),M=function(){function T(c){this.messages=c&&c.messages||0;var g=c&&c.notifications;this.notifications={invalid:g&&g.invalid||0,attempted:g&&g.attempted||0,successful:g&&g.successful||0,failed:g&&g.failed||0},this.directPublishes=c&&c.directPublishes||0}return T}(),P=function(){function T(c){this.succeeded=c&&c.succeeded||0,this.skipped=c&&c.skipped||0,this.failed=c&&c.failed||0}return T}(),O=function(){function T(c){var g=this;this.delta=void 0,c&&c.delta&&(this.delta={},i.forInOwnNonNullProperties(c.delta,function(d){g.delta[d]=new P(c.delta[d])}))}return T}(),b=function(T){s.__extends(c,T);function c(g){var d=T.call(this,g)||this;return d.persisted=new S(g&&g.persisted),d.connections=new A(g&&g.connections),d.channels=new l(g&&g.channels),d.apiRequests=new f(g&&g.apiRequests),d.tokenRequests=new f(g&&g.tokenRequests),d.xchgProducer=new E(g&&g.xchgProducer),d.xchgConsumer=new E(g&&g.xchgConsumer),d.push=new M(g&&g.pushStats),d.processed=new O(g&&g.processed),d.inProgress=g&&g.inProgress||void 0,d.unit=g&&g.unit||void 0,d.intervalId=g&&g.intervalId||void 0,d}return c.fromValues=function(g){return new c(g)},c}(a);r.default=b},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(30)),y=s.__importDefault(n(7)),l=s.__importDefault(n(3)),f=s.__importDefault(n(50)),A=s.__importDefault(n(37)),S=s.__importDefault(n(8)),R=s.__importDefault(n(5)),a=s.__importDefault(n(10)),E=s.__importDefault(n(25)),M=s.__importDefault(n(0)),P=s.__importDefault(n(9)),O=function(T){s.__extends(c,T);function c(g){var d=T.call(this,g)||this;return l.default.logAction(l.default.LOG_MINOR,"Realtime()",""),d.connection=new f.default(d,d.options),d.channels=new b(d),g.autoConnect!==!1&&d.connect(),d}return c.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},c.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},c.Promise=function(g){return g=S.default.objectifyOptions(g),g.promises=!0,new c(g)},c.Callbacks=c,c.Utils=i,c.ConnectionManager=E.default,c.Platform=M.default,c.ProtocolMessage=a.default,c.Message=P.default,c}(m.default),b=function(T){s.__extends(c,T);function c(g){var d=T.call(this)||this;return d.realtime=g,d.all={},d.inProgress={},g.connection.connectionManager.on("transport.active",function(){d.onTransportActive()}),d}return c.prototype.onChannelMessage=function(g){var d=g.channel;if(d===void 0){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+g.action);return}var p=this.all[d];if(!p){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+d);return}p.onMessage(g)},c.prototype.onTransportActive=function(){for(var g in this.all){var d=this.all[g];d.state==="attaching"||d.state==="detaching"?d.checkPendingState():d.state==="suspended"&&d.attach()}},c.prototype.reattach=function(g){for(var d in this.all){var p=this.all[d];p.state==="attached"&&p.requestState("attaching",g)}},c.prototype.resetAttachedMsgIndicators=function(){for(var g in this.all){var d=this.all[g];d.state==="attached"&&(d._attachedMsgIndicator=!1)}},c.prototype.checkAttachedMsgIndicators=function(g){for(var d in this.all){var p=this.all[d];if(p.state==="attached"&&p._attachedMsgIndicator===!1){var u="30s after a resume, found channel which has not received an attached; channelId = "+d+"; connectionId = "+g;l.default.logAction(l.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",u),p.requestState("attaching")}}},c.prototype.propogateConnectionInterruption=function(g,d){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},u=["attaching","attached","detaching","suspended"],C=p[g];for(var _ in this.all){var L=this.all[_];i.arrIn(u,L.state)&&L.notifyState(C,d)}},c.prototype.get=function(g,d){g=String(g);var p=this.all[g];if(!p)p=this.all[g]=new A.default(this.realtime,g,d);else if(d){if(p._shouldReattachToSetOptions(d))throw new R.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(d)}return p},c.prototype.release=function(g){g=String(g);var d=this.all[g];if(!!d){var p=d.getReleaseErr();if(p)throw p;delete this.all[g],delete this.inProgress[g]}},c.prototype.setInProgress=function(g,d,p){this.inProgress[g.name]=this.inProgress[g.name]||{},this.inProgress[g.name][d]=p,!p&&this.hasNopending()&&this.emit("nopending")},c.prototype.onceNopending=function(g){if(this.hasNopending()){g();return}this.once("nopending",g)},c.prototype.hasNopending=function(){return i.arrEvery(i.valuesArray(this.inProgress,!0),function(g){return!i.containsValue(g,!0)})},c}(y.default);r.default=O},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(25)),l=s.__importDefault(n(3)),f=s.__importDefault(n(36)),A=s.__importDefault(n(0));function S(){}var R=function(a){s.__extends(E,a);function E(M,P){var O=a.call(this)||this;return O.whenState=function(b,T){return m.default.prototype.whenState.call(O,b,O.state,T,new f.default(void 0,b))},O.ably=M,O.connectionManager=new y.default(M,P),O.state=O.connectionManager.state.state,O.key=void 0,O.id=void 0,O.serial=void 0,O.timeSerial=void 0,O.recoveryKey=void 0,O.errorReason=null,O.connectionManager.on("connectionstate",function(b){var T=O.state=b.current;A.default.Config.nextTick(function(){O.emit(T,b)})}),O.connectionManager.on("update",function(b){A.default.Config.nextTick(function(){O.emit("update",b)})}),O}return E.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(M){if(l.default.logAction(l.default.LOG_MINOR,"Connection.ping()",""),!M){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);M=S}this.connectionManager.ping(null,M)},E.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},E}(m.default);r.default=R},function(h,r,n){"use strict";r.__esModule=!0,r.PendingMessage=void 0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importStar(n(2)),y=s.__importDefault(n(7)),l=s.__importDefault(n(3)),f=s.__importDefault(n(35)),A=s.__importDefault(n(5)),S=i.default.Action,R=function(){function E(M,P){this.message=M,this.callback=P,this.merged=!1;var O=M.action;this.sendAttempted=!1,this.ackRequired=O==S.MESSAGE||O==S.PRESENCE}return E}();r.PendingMessage=R;var a=function(E){s.__extends(M,E);function M(P){var O=E.call(this)||this;return O.transport=P,O.messageQueue=new f.default,P.on("ack",function(b,T){O.onAck(b,T)}),P.on("nack",function(b,T,c){O.onNack(b,T,c)}),O}return M.prototype.onAck=function(P,O){l.default.logAction(l.default.LOG_MICRO,"Protocol.onAck()","serial = "+P+"; count = "+O),this.messageQueue.completeMessages(P,O)},M.prototype.onNack=function(P,O,b){l.default.logAction(l.default.LOG_ERROR,"Protocol.onNack()","serial = "+P+"; count = "+O+"; err = "+m.inspectError(b)),b||(b=new A.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(P,O,b)},M.prototype.onceIdle=function(P){var O=this.messageQueue;if(O.count()===0){P();return}O.once("idle",P)},M.prototype.send=function(P){P.ackRequired&&this.messageQueue.push(P),l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(P.message)),P.sendAttempted=!0,this.transport.send(P.message)},M.prototype.getTransport=function(){return this.transport},M.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},M.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},M.prototype.finish=function(){var P=this.transport;this.onceIdle(function(){P.disconnect()})},M}(y.default);r.default=a},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(26)),l=s.__importDefault(n(8)),f=s.__importDefault(n(3)),A=s.__importDefault(n(10)),S=s.__importDefault(n(5)),R="web_socket";function a(P){return!!P.on}var E=function(P){s.__extends(O,P);function O(b,T,c){var g=P.call(this,b,T,c)||this;return g.shortName=R,c.heartbeats=i.default.Config.useProtocolHeartbeats,g.wsHost=l.default.getHost(c.options,c.host,!0),g}return O.isAvailable=function(){return!!i.default.Config.WebSocket},O.prototype.createWebSocket=function(b,T){var c=0;if(T)for(var g in T)b+=(c++?"&":"?")+g+"="+T[g];return this.uri=b,new i.default.Config.WebSocket(b)},O.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},O.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),y.default.prototype.connect.call(this);var b=this,T=this.params,c=T.options,g=c.tls?"wss://":"ws://",d=g+this.wsHost+":"+l.default.getPort(c)+"/";f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+d),this.auth.getAuthParams(function(p,u){if(!b.isDisposed){var C="";for(var _ in u)C+=" "+_+": "+u[_]+";";if(f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+C+" err: "+p),p){b.disconnect(p);return}var L=T.getConnectParams(u);try{var W=b.wsConnection=b.createWebSocket(d,L);W.binaryType=i.default.Config.binaryType,W.onopen=function(){b.onWsOpen()},W.onclose=function(H){b.onWsClose(H)},W.onmessage=function(H){b.onWsData(H.data)},W.onerror=function(H){b.onWsError(H)},a(W)&&W.on("ping",function(){b.onActivity()})}catch(H){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),b.disconnect(H)}}})},O.prototype.send=function(b){var T=this.wsConnection;if(!T){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(A.default.serialize(b,this.params.format))}catch(g){var c="Exception from ws connection when trying to send: "+m.inspectError(g);f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()",c),this.finish("disconnected",new S.default(c,5e4,500))}},O.prototype.onWsData=function(b){f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+b.length+"; type = "+typeof b);try{this.onProtocolMessage(A.default.deserialize(b,this.format))}catch(T){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},O.prototype.onWsOpen=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},O.prototype.onWsClose=function(b){var T,c;if(typeof b=="object"?(c=b.code,T=b.wasClean||c===1e3):(c=b,T=c==1e3),delete this.wsConnection,T){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var g=new S.default("Websocket closed",80003,400);this.finish("disconnected",g)}else{var d="Unclean disconnection of WebSocket ; code = "+c,g=new S.default(d,80003,400);f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()",d),this.finish("disconnected",g)}this.emit("disposed")},O.prototype.onWsError=function(b){var T=this;f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+b.message),i.default.Config.nextTick(function(){T.disconnect(Error(b.message))})},O.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var b=this.wsConnection;b&&(b.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!b)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");b.close()}))},O}(y.default);function M(P){return E.isAvailable()&&(P.supportedTransports[R]=E),E}r.default=M},function(h,r,n){"use strict";r.__esModule=!0,r.isSuccessCode=void 0;var s;(function(m){m[m.Success=200]="Success",m[m.NoContent=204]="NoContent",m[m.BadRequest=400]="BadRequest",m[m.Unauthorized=401]="Unauthorized",m[m.Forbidden=403]="Forbidden",m[m.RequestTimeout=408]="RequestTimeout",m[m.InternalServerError=500]="InternalServerError"})(s||(s={}));function i(m){return m>=s.Success&&m<s.BadRequest}r.isSuccessCode=i,r.default=s},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(34)),y=s.__importDefault(n(7)),l=s.__importDefault(n(3)),f=s.__importDefault(n(14)),A=s.__importDefault(n(5)),S=s.__importDefault(n(37)),R=s.__importDefault(n(22)),a=s.__importDefault(n(38)),E=function(){};function M(d){return d.clientId+":"+d.connectionId}function P(d){return d.channel.realtime.auth.clientId}function O(d){var p=d.channel.realtime,u=p.auth.clientId;return(!u||u==="*")&&p.connection.state==="connected"}function b(d,p,u){switch(d.state){case"attached":case"suspended":u();break;case"initialized":case"detached":case"detaching":case"attaching":d.attach(function(C){C?p(C):u()});break;default:p(A.default.fromValues(S.default.invalidStateError(d.state)))}}function T(d,p){if(d.isSynthesized()||p.isSynthesized())return d.timestamp>p.timestamp;var u=d.parseId(),C=p.parseId();return u.msgSerial===C.msgSerial?u.index>C.index:u.msgSerial>C.msgSerial}var c=function(d){s.__extends(p,d);function p(u){var C=d.call(this,u)||this;return C.channel=u,C.syncComplete=!1,C.members=new g(C),C._myMembers=new g(C),C.subscriptions=new y.default,C.pendingPresence=[],C}return p.prototype.enter=function(u,C){if(O(this))throw new A.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,u,"enter",C)},p.prototype.update=function(u,C){if(O(this))throw new A.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,u,"update",C)},p.prototype.enterClient=function(u,C,_){return this._enterOrUpdateClient(u,C,"enter",_)},p.prototype.updateClient=function(u,C,_){return this._enterOrUpdateClient(u,C,"update",_)},p.prototype._enterOrUpdateClient=function(u,C,_,L){var W=this;if(!L)if(typeof C=="function")L=C,C=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[u,C,_]);L=E}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence."+_+"Client()","channel = "+H.name+", client = "+(u||"(implicit) "+P(this)));var U=f.default.fromValues({action:_,data:C});u&&(U.clientId=u),f.default.encode(U,H.channelOptions,function(I){if(I){L(I);return}switch(H.state){case"attached":H.sendPresence(U,L);break;case"initialized":case"detached":H.attach();case"attaching":W.pendingPresence.push({presence:U,callback:L});break;default:I=new A.default("Unable to "+_+" presence channel while in "+H.state+" state",90001),I.code=90001,L(I)}})},p.prototype.leave=function(u,C){if(O(this))throw new A.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,u,C)},p.prototype.leaveClient=function(u,C,_){if(!_)if(typeof C=="function")_=C,C=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[u,C]);_=E}var L=this.channel;if(!L.connectionManager.activeState()){_==null||_(L.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+u);var W=f.default.fromValues({action:"leave",data:C});switch(u&&(W.clientId=u),L.state){case"attached":L.sendPresence(W,_);break;case"attaching":this.pendingPresence.push({presence:W,callback:_});break;case"initialized":case"failed":{var H=new A.default("Unable to leave presence channel (incompatible state)",90001);_==null||_(H);break}default:_==null||_(S.default.invalidStateError(L.state))}},p.prototype.get=function(u,C){var _=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),u=L[0],C=L[1];var W=!u||("waitForSync"in u?u.waitForSync:!0);if(!C){if(this.channel.realtime.options.promises)return i.promisify(this,"get",L);C=E}function H(U){C(null,u?U.list(u):U.values())}if(this.channel.state==="suspended"){W?C(A.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}b(this.channel,C,function(){var U=_.members;W?U.waitSync(function(){H(U)}):H(U)})},p.prototype.history=function(u,C){if(l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),C===void 0)if(typeof u=="function")C=u,u=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);C=E}u&&u.untilAttach&&(this.channel.state==="attached"?(delete u.untilAttach,u.from_serial=this.channel.properties.attachSerial):C(new A.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),m.default.prototype._history.call(this,u,C)},p.prototype.setPresence=function(u,C,_){l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+u.length+" participants; syncChannelSerial = "+_);var L,W,H=this.members,U=this._myMembers,I=[],x=this.channel.connectionManager.connectionId;C&&(this.members.startSync(),_&&(W=_.match(/^[\w-]+:(.*)$/))&&(L=W[1]));for(var z=0;z<u.length;z++){var k=f.default.fromValues(u[z]);switch(k.action){case"leave":H.remove(k)&&I.push(k),k.connectionId===x&&!k.isSynthesized()&&U.remove(k);break;case"enter":case"present":case"update":H.put(k)&&I.push(k),k.connectionId===x&&U.put(k);break}}C&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(S.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<I.length;z++){var k=I[z];this.subscriptions.emit(k.action,k)}},p.prototype.onAttached=function(u){l.default.logAction(l.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+u),u?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var C=this.pendingPresence,_=C.length;if(_){this.pendingPresence=[];var L=[],W=R.default.create();l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+_+" queued presence messages");for(var H=0;H<_;H++){var U=C[H];L.push(U.presence),W.push(U.callback)}this.channel.sendPresence(L,W)}},p.prototype.actOnChannelState=function(u,C,_){switch(u){case"attached":this.onAttached(C);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(_);break}},p.prototype.failPendingPresence=function(u){if(this.pendingPresence.length){l.default.logAction(l.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(u));for(var C=0;C<this.pendingPresence.length;C++)try{this.pendingPresence[C].callback(u)}catch(_){}this.pendingPresence=[]}},p.prototype._clearMyMembers=function(){this._myMembers.clear()},p.prototype._ensureMyMembersPresent=function(){var u=this,C=this.members,_=this._myMembers,L=function(U){if(U){var I="Presence auto-re-enter failed: "+U.toString(),x=new A.default(I,91004,400);l.default.logAction(l.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",I);var z=new a.default(u.channel.state,u.channel.state,!0,x);u.channel.emit("update",z)}};for(var W in _.map)if(!(W in C.map)){var H=_.map[W];l.default.logAction(l.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete _.map[W]}},p.prototype._synthesizeLeaves=function(u){var C=this.subscriptions;i.arrForEach(u,function(_){var L=f.default.fromValues({action:"leave",connectionId:_.connectionId,clientId:_.clientId,data:_.data,encoding:_.encoding,timestamp:i.now()});C.emit("leave",L)})},p.prototype.on=function(){for(var u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];l.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,u)},p.prototype.off=function(){for(var u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];l.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,u)},p.prototype.subscribe=function(){for(var u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];var _=S.default.processListenerArgs(u),L=_[0],W=_[1],H=_[2],U=this.channel;if(!H){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[L,W]);H=E}if(U.state==="failed"){H(A.default.fromValues(S.default.invalidStateError("failed")));return}this.subscriptions.on(L,W),U.attach(H)},p.prototype.unsubscribe=function(){for(var u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];var _=S.default.processListenerArgs(u),L=_[0],W=_[1];this.subscriptions.off(L,W)},p}(m.default),g=function(d){s.__extends(p,d);function p(u){var C=d.call(this)||this;return C.presence=u,C.map={},C.syncInProgress=!1,C.residualMembers=null,C}return p.prototype.get=function(u){return this.map[u]},p.prototype.getClient=function(u){var C=this.map,_=[];for(var L in C){var W=C[L];W.clientId==u&&W.action!="absent"&&_.push(W)}return _},p.prototype.list=function(u){var C=this.map,_=u&&u.clientId,L=u&&u.connectionId,W=[];for(var H in C){var U=C[H];U.action!=="absent"&&(_&&_!=U.clientId||L&&L!=U.connectionId||W.push(U))}return W},p.prototype.put=function(u){(u.action==="enter"||u.action==="update")&&(u=f.default.fromValues(u),u.action="present");var C=this.map,_=M(u);this.residualMembers&&delete this.residualMembers[_];var L=C[_];return L&&!T(u,L)?!1:(C[_]=u,!0)},p.prototype.values=function(){var u=this.map,C=[];for(var _ in u){var L=u[_];L.action!="absent"&&C.push(L)}return C},p.prototype.remove=function(u){var C=this.map,_=M(u),L=C[_];return L&&!T(u,L)?!1:(this.syncInProgress?(u=f.default.fromValues(u),u.action="absent",C[_]=u):delete C[_],!0)},p.prototype.startSync=function(){var u=this.map,C=this.syncInProgress;l.default.logAction(l.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),this.syncInProgress||(this.residualMembers=i.copy(u),this.setInProgress(!0))},p.prototype.endSync=function(){var u=this.map,C=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),C){for(var _ in u){var L=u[_];L.action==="absent"&&delete u[_]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var W in this.residualMembers)delete u[W];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},p.prototype.waitSync=function(u){var C=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),!C){u();return}this.once("sync",u)},p.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},p.prototype.setInProgress=function(u){l.default.logAction(l.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+u),this.syncInProgress=u,this.presence.syncComplete=!u},p}(y.default);r.default=c},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=n(56),m=n(32),y=n(13),l=s.__importDefault(n(4)),f=s.__importDefault(n(0)),A=function(){function S(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return S.prototype.isWordArray=function(R){return R!=null&&R.sigBytes!==void 0},S.prototype.isArrayBuffer=function(R){return R!=null&&R.constructor===ArrayBuffer},S.prototype.isTypedArray=function(R){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(R)},S.prototype.uint8ViewToBase64=function(R){for(var a="",E=this.base64CharSet,M=R.byteLength,P=M%3,O=M-P,b,T,c,g,d,p=0;p<O;p=p+3)d=R[p]<<16|R[p+1]<<8|R[p+2],b=(d&16515072)>>18,T=(d&258048)>>12,c=(d&4032)>>6,g=d&63,a+=E[b]+E[T]+E[c]+E[g];return P==1?(d=R[O],b=(d&252)>>2,T=(d&3)<<4,a+=E[b]+E[T]+"=="):P==2&&(d=R[O]<<8|R[O+1],b=(d&64512)>>10,T=(d&1008)>>4,c=(d&15)<<2,a+=E[b]+E[T]+E[c]+"="),a},S.prototype.base64ToArrayBuffer=function(R){for(var a=atob==null?void 0:atob(R),E=a.length,M=new Uint8Array(E),P=0;P<E;P++){var O=a.charCodeAt(P);M[P]=O}return M.buffer},S.prototype.isBuffer=function(R){return this.isArrayBuffer(R)||this.isWordArray(R)||this.isTypedArray(R)},S.prototype.toBuffer=function(R){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(R))return new Uint8Array(R);if(this.isTypedArray(R))return new Uint8Array(R.buffer);if(this.isWordArray(R)){for(var a=new ArrayBuffer(R.sigBytes),E=new Uint8Array(a),M=0;M<R.sigBytes;M++)E[M]=R.words[M>>>2]>>>24-M%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},S.prototype.toArrayBuffer=function(R){return this.isArrayBuffer(R)?R:this.toBuffer(R).buffer},S.prototype.toWordArray=function(R){return this.isTypedArray(R)&&(R=R.buffer),this.isWordArray(R)?R:l.default.create(R)},S.prototype.base64Encode=function(R){return this.isWordArray(R)?y.stringify(R):this.uint8ViewToBase64(this.toBuffer(R))},S.prototype.base64Decode=function(R){return ArrayBuffer&&f.default.Config.atob?this.base64ToArrayBuffer(R):y.parse(R)},S.prototype.hexEncode=function(R){return i.stringify(this.toWordArray(R))},S.prototype.hexDecode=function(R){var a=i.parse(R);return ArrayBuffer?this.toArrayBuffer(a):a},S.prototype.utf8Encode=function(R){return TextEncoder?new TextEncoder().encode(R).buffer:m.parse(R)},S.prototype.utf8Decode=function(R){if(!this.isBuffer(R))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(R)?new TextDecoder().decode(R):(R=this.toWordArray(R),m.stringify(R))},S.prototype.bufferCompare=function(R,a){if(!R)return-1;if(!a)return 1;var E=this.toWordArray(R),M=this.toWordArray(a);E.clamp(),M.clamp();var P=E.sigBytes-M.sigBytes;if(P!=0)return P;for(var O=E.words,b=M.words,T=0;T<O.length;T++)if(P=O[T]-b[T],P!=0)return P;return 0},S.prototype.byteLength=function(R){return this.isArrayBuffer(R)||this.isTypedArray(R)?R.byteLength:this.isWordArray(R)?R.sigBytes:-1},S.prototype.typedArrayToBuffer=function(R){return R.buffer},S}();r.default=new A},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return s.enc.Hex})},function(h,r,n){"use strict";n.r(r);var s=n(4),i=n.n(s),m=n(13),y=n.n(m),l=n(21),f=n.n(l),A=n(0),S=n.n(A),R=n(3),a=n.n(R),E=function(){var M="aes",P=256,O="cbc",b=16,T=4,c=4294967296,g=2147483648,d;if(S.a.getRandomWordArray)d=S.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&S.a.getRandomValues){var p=new Uint32Array(T);d=function(I,x){var z=I/4,k=z==T?p:new Uint32Array(z);S.a.getRandomValues(k,function(J){x(J,S.a.BufferUtils.toWordArray(k))})}}else d=function(I,x){a.a.logAction(a.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=I/4,k=new Array(z),J=0;J<z;J++)k[J]=Math.floor(Math.random()*c)-g;x(null,i.a.create(k))};function u(I){return I+b&-b}function C(I){if(I.algorithm==="aes"&&I.mode==="cbc"){if(I.keyLength===128||I.keyLength===256)return;throw new Error("Unsupported key length "+I.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function _(I){return I.replace("_","/").replace("-","+")}var L=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function W(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}W.CipherParams=H,W.getDefaultParams=function(I){var x;if(typeof I=="function"||typeof I=="string"){if(a.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof I=="function")W.generateRandomKey(function(k){I(null,W.getDefaultParams({key:k}))});else if(typeof arguments[1]=="function")arguments[1](null,W.getDefaultParams({key:I}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!I.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof I.key=="string"?x=Object(m.parse)(_(I.key)):x=S.a.BufferUtils.toWordArray(I.key);var z=new H;if(z.key=x,z.algorithm=I.algorithm||M,z.keyLength=x.words.length*(4*8),z.mode=I.mode||O,I.keyLength&&I.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+I.keyLength+" was specified, but the key actually has length "+z.keyLength);return C(z),z},W.generateRandomKey=function(I,x){arguments.length==1&&typeof I=="function"&&(x=I,I=void 0),d((I||P)/8,x)},W.getCipher=function(I){var x=I instanceof H?I:W.getDefaultParams(I);return{cipherParams:x,cipher:new U(x,T,I.iv)}};function U(I,x,z){this.algorithm=I.algorithm+"-"+String(I.keyLength)+"-"+I.mode,this.cjsAlgorithm=I.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=S.a.BufferUtils.toWordArray(I.key),z&&(this.iv=S.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=x}return U.prototype.encrypt=function(I,x){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.encrypt()",""),I=S.a.BufferUtils.toWordArray(I);var z=I.sigBytes,k=u(z),J=this,ee=function(){J.getIv(function(Q,G){if(Q){x(Q);return}var D=J.encryptCipher.process(I.concat(L[k-z])),B=G.concat(D);x(null,B)})};this.encryptCipher?ee():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),ee()):d(b,function(Q,G){if(Q){x(Q);return}J.encryptCipher=f.a.algo[J.cjsAlgorithm].createEncryptor(J.key,{iv:G}),J.iv=G,ee()})},U.prototype.decrypt=function(I){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.decrypt()",""),I=S.a.BufferUtils.toWordArray(I);var x=this.blockLengthWords,z=I.words,k=i.a.create(z.slice(0,x)),J=i.a.create(z.slice(x)),ee=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:k}),Q=ee.process(J),G=ee.finalize();return ee.reset(),G&&G.sigBytes&&Q.concat(G),Q},U.prototype.getIv=function(I){if(this.iv){var x=this.iv;this.iv=null,I(null,x);return}var z=this;d(b,function(k,J){if(k){I(k);return}I(null,z.encryptCipher.process(J))})},W}();r.default=E},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,l=i.enc,f=l.Utf16=l.Utf16BE={stringify:function(S){for(var R=S.words,a=S.sigBytes,E=[],M=0;M<a;M+=2){var P=R[M>>>2]>>>16-M%4*8&65535;E.push(String.fromCharCode(P))}return E.join("")},parse:function(S){for(var R=S.length,a=[],E=0;E<R;E++)a[E>>>1]|=S.charCodeAt(E)<<16-E%2*16;return y.create(a,R*2)}};l.Utf16LE={stringify:function(S){for(var R=S.words,a=S.sigBytes,E=[],M=0;M<a;M+=2){var P=A(R[M>>>2]>>>16-M%4*8&65535);E.push(String.fromCharCode(P))}return E.join("")},parse:function(S){for(var R=S.length,a=[],E=0;E<R;E++)a[E>>>1]|=A(S.charCodeAt(E)<<16-E%2*16);return y.create(a,R*2)}};function A(S){return S<<8&4278255360|S>>>8&16711935}}(),s.enc.Utf16})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(28))})(this,function(s){return function(i){var m=s,y=m.lib,l=y.CipherParams,f=m.enc,A=f.Hex,S=m.format,R=S.Hex={stringify:function(a){return a.ciphertext.toString(A)},parse:function(a){var E=A.parse(a);return l.create({ciphertext:E})}}}(),s.format.Hex})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(13),n(61),n(27),n(28))})(this,function(s){return function(){var i=s,m=i.lib,y=m.BlockCipher,l=i.algo,f=[],A=[],S=[],R=[],a=[],E=[],M=[],P=[],O=[],b=[];(function(){for(var g=[],d=0;d<256;d++)d<128?g[d]=d<<1:g[d]=d<<1^283;for(var p=0,u=0,d=0;d<256;d++){var C=u^u<<1^u<<2^u<<3^u<<4;C=C>>>8^C&255^99,f[p]=C,A[C]=p;var _=g[p],L=g[_],W=g[L],H=g[C]*257^C*16843008;S[p]=H<<24|H>>>8,R[p]=H<<16|H>>>16,a[p]=H<<8|H>>>24,E[p]=H;var H=W*16843009^L*65537^_*257^p*16843008;M[C]=H<<24|H>>>8,P[C]=H<<16|H>>>16,O[C]=H<<8|H>>>24,b[C]=H,p?(p=_^g[g[g[W^_]]],u^=g[g[u]]):p=u=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],c=l.AES=y.extend({_doReset:function(){var g;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var d=this._keyPriorReset=this._key,p=d.words,u=d.sigBytes/4,C=this._nRounds=u+6,_=(C+1)*4,L=this._keySchedule=[],W=0;W<_;W++)W<u?L[W]=p[W]:(g=L[W-1],W%u?u>6&&W%u==4&&(g=f[g>>>24]<<24|f[g>>>16&255]<<16|f[g>>>8&255]<<8|f[g&255]):(g=g<<8|g>>>24,g=f[g>>>24]<<24|f[g>>>16&255]<<16|f[g>>>8&255]<<8|f[g&255],g^=T[W/u|0]<<24),L[W]=L[W-u]^g);for(var H=this._invKeySchedule=[],U=0;U<_;U++){var W=_-U;if(U%4)var g=L[W];else var g=L[W-4];U<4||W<=4?H[U]=g:H[U]=M[f[g>>>24]]^P[f[g>>>16&255]]^O[f[g>>>8&255]]^b[f[g&255]]}}},encryptBlock:function(g,d){this._doCryptBlock(g,d,this._keySchedule,S,R,a,E,f)},decryptBlock:function(g,d){var p=g[d+1];g[d+1]=g[d+3],g[d+3]=p,this._doCryptBlock(g,d,this._invKeySchedule,M,P,O,b,A);var p=g[d+1];g[d+1]=g[d+3],g[d+3]=p},_doCryptBlock:function(g,d,p,u,C,_,L,W){for(var H=this._nRounds,U=g[d]^p[0],I=g[d+1]^p[1],x=g[d+2]^p[2],z=g[d+3]^p[3],k=4,J=1;J<H;J++){var ee=u[U>>>24]^C[I>>>16&255]^_[x>>>8&255]^L[z&255]^p[k++],Q=u[I>>>24]^C[x>>>16&255]^_[z>>>8&255]^L[U&255]^p[k++],G=u[x>>>24]^C[z>>>16&255]^_[U>>>8&255]^L[I&255]^p[k++],D=u[z>>>24]^C[U>>>16&255]^_[I>>>8&255]^L[x&255]^p[k++];U=ee,I=Q,x=G,z=D}var ee=(W[U>>>24]<<24|W[I>>>16&255]<<16|W[x>>>8&255]<<8|W[z&255])^p[k++],Q=(W[I>>>24]<<24|W[x>>>16&255]<<16|W[z>>>8&255]<<8|W[U&255])^p[k++],G=(W[x>>>24]<<24|W[z>>>16&255]<<16|W[U>>>8&255]<<8|W[I&255])^p[k++],D=(W[z>>>24]<<24|W[U>>>16&255]<<16|W[I>>>8&255]<<8|W[x&255])^p[k++];g[d]=ee,g[d+1]=Q,g[d+2]=G,g[d+3]=D},keySize:256/32});i.AES=y._createHelper(c)}(),s.AES})},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(i){var m=s,y=m.lib,l=y.WordArray,f=y.Hasher,A=m.algo,S=[];(function(){for(var O=0;O<64;O++)S[O]=i.abs(i.sin(O+1))*4294967296|0})();var R=A.MD5=f.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(O,b){for(var T=0;T<16;T++){var c=b+T,g=O[c];O[c]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}var d=this._hash.words,p=O[b+0],u=O[b+1],C=O[b+2],_=O[b+3],L=O[b+4],W=O[b+5],H=O[b+6],U=O[b+7],I=O[b+8],x=O[b+9],z=O[b+10],k=O[b+11],J=O[b+12],ee=O[b+13],Q=O[b+14],G=O[b+15],D=d[0],B=d[1],V=d[2],j=d[3];D=a(D,B,V,j,p,7,S[0]),j=a(j,D,B,V,u,12,S[1]),V=a(V,j,D,B,C,17,S[2]),B=a(B,V,j,D,_,22,S[3]),D=a(D,B,V,j,L,7,S[4]),j=a(j,D,B,V,W,12,S[5]),V=a(V,j,D,B,H,17,S[6]),B=a(B,V,j,D,U,22,S[7]),D=a(D,B,V,j,I,7,S[8]),j=a(j,D,B,V,x,12,S[9]),V=a(V,j,D,B,z,17,S[10]),B=a(B,V,j,D,k,22,S[11]),D=a(D,B,V,j,J,7,S[12]),j=a(j,D,B,V,ee,12,S[13]),V=a(V,j,D,B,Q,17,S[14]),B=a(B,V,j,D,G,22,S[15]),D=E(D,B,V,j,u,5,S[16]),j=E(j,D,B,V,H,9,S[17]),V=E(V,j,D,B,k,14,S[18]),B=E(B,V,j,D,p,20,S[19]),D=E(D,B,V,j,W,5,S[20]),j=E(j,D,B,V,z,9,S[21]),V=E(V,j,D,B,G,14,S[22]),B=E(B,V,j,D,L,20,S[23]),D=E(D,B,V,j,x,5,S[24]),j=E(j,D,B,V,Q,9,S[25]),V=E(V,j,D,B,_,14,S[26]),B=E(B,V,j,D,I,20,S[27]),D=E(D,B,V,j,ee,5,S[28]),j=E(j,D,B,V,C,9,S[29]),V=E(V,j,D,B,U,14,S[30]),B=E(B,V,j,D,J,20,S[31]),D=M(D,B,V,j,W,4,S[32]),j=M(j,D,B,V,I,11,S[33]),V=M(V,j,D,B,k,16,S[34]),B=M(B,V,j,D,Q,23,S[35]),D=M(D,B,V,j,u,4,S[36]),j=M(j,D,B,V,L,11,S[37]),V=M(V,j,D,B,U,16,S[38]),B=M(B,V,j,D,z,23,S[39]),D=M(D,B,V,j,ee,4,S[40]),j=M(j,D,B,V,p,11,S[41]),V=M(V,j,D,B,_,16,S[42]),B=M(B,V,j,D,H,23,S[43]),D=M(D,B,V,j,x,4,S[44]),j=M(j,D,B,V,J,11,S[45]),V=M(V,j,D,B,G,16,S[46]),B=M(B,V,j,D,C,23,S[47]),D=P(D,B,V,j,p,6,S[48]),j=P(j,D,B,V,U,10,S[49]),V=P(V,j,D,B,Q,15,S[50]),B=P(B,V,j,D,W,21,S[51]),D=P(D,B,V,j,J,6,S[52]),j=P(j,D,B,V,_,10,S[53]),V=P(V,j,D,B,z,15,S[54]),B=P(B,V,j,D,u,21,S[55]),D=P(D,B,V,j,I,6,S[56]),j=P(j,D,B,V,G,10,S[57]),V=P(V,j,D,B,H,15,S[58]),B=P(B,V,j,D,ee,21,S[59]),D=P(D,B,V,j,L,6,S[60]),j=P(j,D,B,V,k,10,S[61]),V=P(V,j,D,B,C,15,S[62]),B=P(B,V,j,D,x,21,S[63]),d[0]=d[0]+D|0,d[1]=d[1]+B|0,d[2]=d[2]+V|0,d[3]=d[3]+j|0},_doFinalize:function(){var O=this._data,b=O.words,T=this._nDataBytes*8,c=O.sigBytes*8;b[c>>>5]|=128<<24-c%32;var g=i.floor(T/4294967296),d=T;b[(c+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,b[(c+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,O.sigBytes=(b.length+1)*4,this._process();for(var p=this._hash,u=p.words,C=0;C<4;C++){var _=u[C];u[C]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return p},clone:function(){var O=f.clone.call(this);return O._hash=this._hash.clone(),O}});function a(O,b,T,c,g,d,p){var u=O+(b&T|~b&c)+g+p;return(u<<d|u>>>32-d)+b}function E(O,b,T,c,g,d,p){var u=O+(b&c|T&~c)+g+p;return(u<<d|u>>>32-d)+b}function M(O,b,T,c,g,d,p){var u=O+(b^T^c)+g+p;return(u<<d|u>>>32-d)+b}function P(O,b,T,c,g,d,p){var u=O+(T^(b|~c))+g+p;return(u<<d|u>>>32-d)+b}m.MD5=f._createHelper(R),m.HmacMD5=f._createHmacHelper(R)}(Math),s.MD5})},function(h,r,n){"use strict";var s;r.__esModule=!0;var i=n(1),m=i.__importDefault(n(0)),y=i.__importStar(n(2)),l=i.__importDefault(n(8)),f=i.__importDefault(n(5)),A=i.__importDefault(n(17)),S=i.__importDefault(n(15)),R=i.__importDefault(n(20)),a=i.__importDefault(n(3)),E=n(29);function M(b){var T=b.statusCode;return T===408&&!b.code||T===400&&!b.code||T>=500&&T<=504}function P(b){var T=b.connection,c=T&&T.connectionManager.host;return c?[c].concat(l.default.getFallbackHosts(b.options)):l.default.getHosts(b.options)}var O=(s=function(){function b(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=P,m.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(T,c,g,d,p,u,C){var _=S.default.createRequest(g,d,p,u,R.default.REQ_SEND,c&&c.options.timeouts,T);return _.once("complete",C),_.exec(),_},this.checkConnectivity=function(T){var c=l.default.internetUpUrl;a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+c),this.doUri(A.default.Get,null,c,null,null,null,function(g,d){var p,u=!g&&((p=d)===null||p===void 0?void 0:p.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+u),T(null,u)})}):m.default.Config.jsonpSupported&&(this.Request=function(T,c,g,d,p,u,C){var _=E.createRequest(g,d,p,u,R.default.REQ_SEND,c&&c.options.timeouts,T);return _.once("complete",C),m.default.Config.nextTick(function(){_.exec()}),_},this.checkConnectivity=function(T){var c=this,g=l.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(T);return}this.checksInProgress=[T],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+g);var d=new E.Request("isTheInternetUp",g,null,null,null,R.default.REQ_SEND,l.default.TIMEOUTS);d.once("complete",function(p,u){var C=!p&&u;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+C);for(var _=0;_<c.checksInProgress.length;_++)c.checksInProgress[_](null,C);c.checksInProgress=null}),m.default.Config.nextTick(function(){d.exec()})})}return b.prototype.do=function(T,c,g,d,p,u,C){var _=this,L=typeof g=="function"?g:function(I){return c.baseUri(I)+g},W=c._currentFallback;if(W)if(W.validUntil>y.now()){if(!this.Request){C==null||C(new f.default("Request invoked before assigned to",null,500));return}this.Request(T,c,L(W.host),d,u,p,function(I){for(var x=[],z=1;z<arguments.length;z++)x[z-1]=arguments[z];if(I&&M(I)){c._currentFallback=null,_.do(T,c,g,d,p,u,C);return}C==null||C.apply(void 0,i.__spreadArray([I],x))});return}else c._currentFallback=null;var H=P(c);if(H.length===1){this.doUri(T,c,L(H[0]),d,p,u,C);return}var U=function(I,x){var z=I.shift();_.doUri(T,c,L(z),d,p,u,function(k){for(var J=[],ee=1;ee<arguments.length;ee++)J[ee-1]=arguments[ee];if(k&&M(k)&&I.length){U(I,!0);return}x&&(c._currentFallback={host:z,validUntil:y.now()+c.options.timeouts.fallbackRetryTimeout}),C==null||C.apply(void 0,i.__spreadArray([k],J))})};U(H)},b.prototype.doUri=function(T,c,g,d,p,u,C){if(!this.Request){C(new f.default("Request invoked before assigned to",null,500));return}this.Request(T,c,g,d,u,p,C)},b}(),s.methods=[A.default.Get,A.default.Delete,A.default.Post,A.default.Put,A.default.Patch],s.methodsWithoutBody=[A.default.Get,A.default.Delete],s.methodsWithBody=[A.default.Post,A.default.Put,A.default.Patch],s);r.default=O},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(40)),m=s.__importStar(n(2)),y=m.getGlobalObject();function l(){var R=y.location;return!y.WebSocket||!R||!R.origin||R.origin.indexOf("http")>-1}var f=y.navigator&&y.navigator.userAgent.toString(),A=y.location&&y.location.href,S={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:A,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:y.WebSocket,xhrSupported:y.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:l(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!y.TextDecoder,preferBinary:!1,ArrayBuffer:y.ArrayBuffer,atob:y.atob,nextTick:typeof y.setImmediate!="undefined"?y.setImmediate.bind(y):function(R){setTimeout(R,0)},addEventListener:y.addEventListener,inspect:JSON.stringify,stringByteSize:function(R){return y.TextDecoder&&new y.TextEncoder().encode(R).length||R.length},TextEncoder:y.TextEncoder,TextDecoder:y.TextDecoder,Promise:y.Promise,getRandomValues:function(R){if(R!==void 0)return function(a,E){R.getRandomValues(a),E&&E(null)}}(y.crypto||msCrypto)};r.default=S},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importStar(n(2)),y="ablyjs-storage-test",l=function(){function f(){try{s.sessionStorage.setItem(y,y),s.sessionStorage.removeItem(y),this.sessionSupported=!0}catch(A){this.sessionSupported=!1}try{s.localStorage.setItem(y,y),s.localStorage.removeItem(y),this.localSupported=!0}catch(A){this.localSupported=!1}}return f.prototype.get=function(A){return this._get(A,!1)},f.prototype.getSession=function(A){return this._get(A,!0)},f.prototype.remove=function(A){return this._remove(A,!1)},f.prototype.removeSession=function(A){return this._remove(A,!0)},f.prototype.set=function(A,S,R){return this._set(A,S,R,!1)},f.prototype.setSession=function(A,S,R){return this._set(A,S,R,!0)},f.prototype._set=function(A,S,R,a){var E={value:S};return R&&(E.expires=m.now()+R),this.storageInterface(a).setItem(A,JSON.stringify(E))},f.prototype._get=function(A,S){if(S&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!S&&!this.localSupported)throw new Error("Local Storage not supported");var R=this.storageInterface(S).getItem(A);if(!R)return null;var a=JSON.parse(R);return a.expires&&a.expires<m.now()?(this.storageInterface(S).removeItem(A),null):a.value},f.prototype._remove=function(A,S){return this.storageInterface(S).removeItem(A)},f.prototype.storageInterface=function(A){return A?s.sessionStorage:s.localStorage},f}();r.default=new l}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(66)),m={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(s||(s={})),r.default=s},function(h,r,n){"use strict";n.r(r);var s=n(29),i=n.n(s),m=n(2),y=n(0),l=n.n(y),f=n(11),A=n.n(f),S=n(15),R=n.n(S),a=function(b){var T="xhr_polling";function c(g,d,p){p.stream=!1,A.a.call(this,g,d,p),this.shortName=T}return m.inherits(c,A.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(g,d,p,u,C){return R.a.createRequest(g,d,p,u,C,this.timeouts)},typeof b!="undefined"&&c.isAvailable()&&(b.supportedTransports[T]=c),c},E=a,M=function(b){var T="xhr_streaming";function c(g,d,p){A.a.call(this,g,d,p),this.shortName=T}return m.inherits(c,A.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.streamingSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(g,d,p,u,C){return R.a.createRequest(g,d,p,u,C,this.timeouts)},typeof b!="undefined"&&c.isAvailable()&&(b.supportedTransports[T]=c),c},P=M,O=r.default=[i.a,E,P]}]).default})});X();X();var jn=(g=>(g.MEETING_START="meeting.start",g.MEETING_LEAVE="meeting.leave",g.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",g.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",g.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",g.MEETING_PARTICIPANT_LEFT="meeting.participant-left",g.MEETING_JOIN="meeting.join",g.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",g.MEETING_HOST_CHANGE="meeting.host-change",g.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",g.MEETING_DEVICES_CHANGE="meeting.devices-change",g.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",g.MEETING_STATE_UPDATE="meeting.state-update",g.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",g.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",g.MY_PARTICIPANT_UPDATED="my-participant.update",g.MY_PARTICIPANT_LEFT="my-participant.left",g.MY_PARTICIPANT_JOINED="my-participant.joined",g.MEETING_KICK_PARTICIPANT="meeting.kick-participant",g.DESTROY="destroy",g))(jn||{});var hs=(y=>(y.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",y.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",y.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",y.TOGGLE_CAM="meeting-controls.toggle-cam",y.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",y.HANG_UP="hang-up",y))(hs||{}),On=(R=>(R.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",R.REALTIME_HOST_CHANGE="realtime.host-change",R.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",R.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",R.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",R.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",R.REALTIME_GATHER="realtime.gather",R.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",R.REALTIME_SET_AVATAR="realtime.set-avatar",R.REALTIME_DRAWING_CHANGE="realtime.drawing-change",R.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",R))(On||{});var Ri=(S=>(S[S.MEETING_FAILED=-1]="MEETING_FAILED",S[S.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",S[S.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",S[S.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",S[S.MEETING_CONNECTING=3]="MEETING_CONNECTING",S[S.MEETING_CONNECTED=4]="MEETING_CONNECTED",S[S.MEETING_RECONNECT=5]="MEETING_RECONNECT",S[S.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",S[S.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",S[S.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",S))(Ri||{}),Ti=(y=>(y.JOINED="participant.joined",y.LOCAL_JOINED="participant.local-joined",y.LEFT="participant.left",y.LOCAL_LEFT="participant.local-left",y.LOCAL_UPDATED="participant.updated",y.LIST_UPDATED="participant.list-updated",y))(Ti||{}),Ar=(l=>(l[l.NOT_AVAILABLE=0]="NOT_AVAILABLE",l[l.GOOD=1]="GOOD",l[l.BAD=2]="BAD",l[l.POOR=3]="POOR",l[l.DISCONNECTED=4]="DISCONNECTED",l[l.RECONNECTING=5]="RECONNECTING",l[l.LOST_CONNECTION=6]="LOST_CONNECTION",l))(Ar||{}),ps=(y=>(y.NO_CAM="devices.no-cam",y.NO_DEVICES="devices.no-devices",y.DEVICES_BLOCKED="devices.blocked",y.DEVICES_CAM_BLOCKED="devices.cam-blocked",y.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",y.DEVICES_UNKNOWN_ERROR="devices.unknown-error",y))(ps||{});X();X();var Os=qt(Ii());X();X();var ln=(i,m,y,...l)=>Ye(void 0,[i,m,y,...l],function*(h,r,n,s={}){let f=yield fetch(h,{method:r,headers:gt({"Content-Type":"application/json"},s),body:n?JSON.stringify(n):null});if(!f.ok)throw f;return f.json()});X();var Dl=qt(gs()),qe=class{constructor(r){this.debug=(0,Dl.default)(r)}log(r,...n){this.debug(r,...n)}};X();var gc=qt(bs());var _e=class{constructor(r={}){this.subscribe=r=>{this.callbacks.push(r)};this.unsubscribe=r=>{this.callbacks=this.callbacks.filter(n=>n!==r)};this.publish=(...r)=>{!this.callbacks||this.callbacks.forEach(n=>{this.callListener(n,r).catch(s=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${n}
            Event: ${JSON.stringify(r)}
            Error: ${s}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(r,n)=>new Promise((s,i)=>{try{let m=r(...n);s(m)}catch(m){i(m)}});let{logger:n,throttleTime:s}=r;this.logger=n!=null?n:new qe("@superviz/sdk/observer-helper"),this.throttle=s,this.callbacks=[],this.throttle&&(this.publish=(0,gc.default)(this.publish,this.throttle))}};X();var Ft=qt(vc()),Er=class{constructor(){this.browser=Ft.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Ft.default.PLATFORMS_MAP.mobile)||this.browser.is(Ft.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Ft.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};X();var mc=qt(Ii()),Cs=class{setConfig(r){this.configuration=r}get(r,n){if(!this.configuration)throw new Error("configs is not available");return(0,mc.get)(this.configuration,r,n)}},$e=new Cs;X();var Mi=class{constructor(){this.updateMeetingConnectionStatus=r=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=r,this.connectionStatusObserver.publish(r),this.logger.log("CONNECTION STATUS CHANGE",r)};this.onUpdateBrowserOnlineStatus=r=>{let{type:n}=r;if(n==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new qe("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new _e({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};X();X();var xi=class{build(r,n,s,i={},m={}){let y=document.querySelector(`#${r}`),l=new URL(n);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(i).forEach(([f,A])=>{l.searchParams.set(f,A)}),Object.entries(m).forEach(([f,A])=>{this.element.setAttribute(f,A)}),this.element.src=l.toString(),this.element.id=s,y.appendChild(this.element),this.wrapperId=r}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let r=document.querySelector(`#${this.wrapperId}`);!!r&&!!r.querySelector(`#${this.element.id}`)&&r.removeChild(this.element),this.wrapperId=null,this.element=null}};X();var Li=class{constructor(r){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(r,n={})=>{this.logger.log("MessageBridge","Posting message to frame",r,n),this.contentWindow.postMessage({type:r,data:n},this.allowedOrigins)};this.listen=(r,n)=>{this.observers[r]||(this.observers[r]=new _e({logger:this.logger})),this.observers[r].subscribe(n)};this.onReceiveMessage=r=>{let{type:n,data:s,source:i}=r.data;if(this.sourceBlockList.includes(i)||this.originBlockList.includes(r.origin))return;let m=!!n,y=!this.domains.length||this.domains.includes(r.origin),l=this.observers.hasOwnProperty(n);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${r.type}
        ORIGIN: ${r.origin}
        DATA: ${JSON.stringify(r.data)} `),!m||!y||!l){this.logger.log("MessageBridge","Message discarded");return}this.observers[n].publish(s)};let{contentWindow:n,domains:s=[],allowedOrigins:i="*",sourceBlockList:m=[],logger:y}=r;if(this.logger=y,this.domains=s,this.allowedOrigins=i,this.sourceBlockList.push(...m),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=n,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([r,n])=>{n.reset(),delete this.observers[r]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};X();var yc="sv-video-frame",Rr=class{constructor(r){this.logger=new qe("@superviz/sdk/video-conference-manager");this.frameStateObserver=new _e({logger:this.logger});this.frameSizeObserver=new _e({logger:this.logger});this.waitingForHostObserver=new _e({logger:this.logger});this.realtimeEventsObserver=new _e({logger:this.logger});this.sameAccountErrorObserver=new _e({logger:this.logger});this.devicesObserver=new _e({logger:this.logger});this.meetingStateObserver=new _e({logger:this.logger});this.meetingConnectionObserver=new _e({logger:this.logger});this.participantJoinedObserver=new _e({logger:this.logger});this.participantLeftObserver=new _e({logger:this.logger});this.participantListObserver=new _e({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(r,n)=>{let s=r,i=n,m=["left","right","bottom","top"].includes(i),y=["left","right","center"].includes(s);return m||(i="right"),y||(s="right"),this.browserService.isMobileDevice?(i="bottom",{layoutPosition:s,camerasPosition:i}):(s==="left"&&i==="right"&&(s="right"),s==="right"&&i==="left"&&(s="left"),{layoutPosition:s,camerasPosition:i})};this.onFrameLoad=()=>{this.messageBridge=new Li({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=r=>{let n=r!=null?r:{};["top","bottom","left","right"].forEach(s=>{Object.keys(n).includes(s)||(n[s]=0)}),this.frameOffset=n};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=r=>{let n=document.createElement("style"),{bottom:s,left:i,right:m,top:y}=this.frameOffset;if(n.innerHTML=`
      :root {
        --superviz-offset-top: ${y}px;
        --superviz-offset-right: ${m}px;
        --superviz-offset-left: ${i}px;
        --superviz-offset-bottom: ${s}px;
      }     
    `,document.head.appendChild(n),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${r}`)};this.onFrameDimensionsUpdate=({width:r,height:n})=>{let s=document.getElementById(yc),{bottom:i,right:m,left:y,top:l}=this.frameOffset,f=this.isWaterMarkEnabled?40:0,A=`${r}px`,S=`${n+f}px`;(r>=window.innerWidth||this.isHorizontalCameraEnabled)&&(A=`calc(100% - ${m}px - ${y}px)`),n>=window.innerHeight&&(S=`calc(100% - ${l}px - ${i}px)`),s.style.width=A,s.style.height=S,this.frameSizeObserver.publish({width:A,height:S})};this.onWindowResize=()=>{let{top:r,bottom:n,right:s,left:i}=this.frameOffset,{innerHeight:m,innerWidth:y}=window,l=m-r-n,f=y-s-i;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:l,width:f})};this.updateFrameLocale=()=>{var m,y;if(!this.frameLocale||!((m=this.frameLocale)!=null&&m.language)&&((y=this.frameLocale)==null?void 0:y.locales))return;let{language:r,locales:n}=this.frameLocale,s=n.map(l=>l==null?void 0:l.language),i=["en",...s];if(r&&!i.includes(r))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=r=>{this.participantJoinedObserver.publish(r)};this.onParticipantLeft=r=>{this.participantLeftObserver.publish(r)};this.onMeetingHostChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:r})};this.onMeetingKickParticipant=r=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:r})};this.onFollowParticipantDidChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:r})};this.onGoToDidChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:r})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:r})};this.onDrawingChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:r})};this.onTranscriptChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:r})};this.onSameAccountError=r=>{this.sameAccountErrorObserver.publish(r)};this.onDevicesChange=r=>{this.devicesObserver.publish(r)};this.meetingStateUpdate=r=>{this.meetingStateObserver.publish(r)};this.onConnectionStatusChange=r=>{this.meetingConnectionObserver.publish(r)};this.onWaitingForHostDidChange=r=>{this.waitingForHostObserver.publish(r)};this.onParticipantListUpdate=r=>{this.participantListObserver.publish(r)};var u,C,_,L;let{language:n,canUseCams:s,canUseChat:i,canUseScreenshare:m,canUseDefaultAvatars:y,canUseFollow:l,canUseGoTo:f,canUseGather:A,browserService:S,offset:R,canUseDefaultToolbar:a,locales:E,avatars:M,customColors:P,waterMark:O,layoutPosition:b,camerasPosition:T,skipMeetingSettings:c,devices:g}=r;this.browserService=S;let d=this.layoutModalsAndCamerasConfig(b,T),p=document.createElement("div");this.frameConfig={apiKey:$e.get("apiKey"),apiUrl:$e.get("apiUrl"),ablyKey:$e.get("ablyKey"),debug:$e.get("debug"),canUseFollow:l,canUseGoTo:f,canUseCams:s,canUseChat:i,canUseGather:A,canUseScreenshare:m,canUseDefaultAvatars:y,camerasPosition:(u=d.camerasPosition)!=null?u:"right",canUseDefaultToolbar:a,roomId:$e.get("roomId"),devices:{audioInput:(C=g==null?void 0:g.audioInput)!=null?C:!0,audioOutput:(_=g==null?void 0:g.audioOutput)!=null?_:!0,videoInput:(L=g==null?void 0:g.videoInput)!=null?L:!0},waterMark:O,skipMeetingSettings:c,layoutPosition:d.layoutPosition},this.customColors=P,p.classList.add("sv_video_wrapper"),p.id="sv-video-wrapper",document.body.appendChild(p),this.updateFrameState(1),this.bricklayer=new xi,this.bricklayer.build(p.id,$e.get("conferenceLayerUrl"),yc,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(R),this.setFrameStyle(d.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:n,locales:E},this.meetingAvatars=M,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:["all","powered-by"].includes(this.frameConfig.waterMark)}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(r){r!==this.frameState&&(this.frameState=r,this.frameStateObserver.publish(this.frameState));let n={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(n[r])}start(r){this.messageBridge.publish("meeting.start",Cn(gt({},r),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var r,n;(r=this.messageBridge)==null||r.destroy(),(n=this.bricklayer)==null||n.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(r,n){this.messageBridge.publish(r,n)}};X();var Qn=class{constructor(){this.observers={};this.isAttached=!1;this.attach=r=>{if(Object.values(r).includes(null)||Object.values(r).includes(void 0)){let l=`${this.name} @ attach - params are required`;throw this.logger.log(l),new Error(l)}let{realtime:n,localParticipant:s,group:i,config:m,eventBus:y}=r;$e.setConfig(m),this.realtime=n,this.localParticipant=s,this.group=i,this.eventBus=y,this.isAttached=!0,this.logger.log("attached"),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1,Object.keys(this.observers).forEach(r=>this.unsubscribe(r))};this.subscribe=(r,n)=>{this.logger.log(`subscribed to ${r} event`),this.observers[r]||(this.observers[r]=new _e({logger:this.logger})),this.observers[r].subscribe(n)};this.unsubscribe=r=>{this.logger.log(`unsubscribed from ${r} event`),this.observers[r]&&(this.observers[r].reset(),delete this.observers[r])};this.publish=(r,n)=>{r in this.observers&&this.observers[r].publish(n)}}};var Tr=class extends Qn{constructor(n){super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var n,s,i,m,y,l,f,A,S,R,a,E,M,P,O,b,T,c,g,d,p,u;this.videoConfig={language:(n=this.params)==null?void 0:n.language,canUseChat:!((s=this.params)!=null&&s.chatOff),canUseCams:!((i=this.params)!=null&&i.camsOff),canUseScreenshare:!((m=this.params)!=null&&m.screenshareOff),canUseDefaultAvatars:!!((y=this.params)!=null&&y.defaultAvatars)&&!((f=(l=this.localParticipant)==null?void 0:l.avatar)!=null&&f.model),canUseGather:!!((A=this.params)!=null&&A.enableGather),canUseFollow:!!((S=this.params)!=null&&S.enableFollow),canUseGoTo:!!((R=this.params)!=null&&R.enableGoTo),canUseDefaultToolbar:(E=(a=this.params)==null?void 0:a.defaultToolbar)!=null?E:!0,camerasPosition:(M=this.params)==null?void 0:M.camerasPosition,devices:(P=this.params)==null?void 0:P.devices,skipMeetingSettings:(O=this.params)==null?void 0:O.skipMeetingSettings,browserService:this.browserService,offset:(b=this.params)==null?void 0:b.offset,locales:(c=(T=this.params)==null?void 0:T.locales)!=null?c:[],avatars:(d=(g=this.params)==null?void 0:g.avatars)!=null?d:[],customColors:(p=this.params)==null?void 0:p.customColors,layoutPosition:(u=this.params)==null?void 0:u.layoutPosition},this.logger.log("video component @ start video",this.videoConfig),this.videoManager=new Rr(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video component @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video component @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video component @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video component @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=n=>{var s;return{id:n.clientId,color:this.realtime.getSlotColor((s=n.data)==null?void 0:s.slotIndex).color,avatar:n.data.avatar,type:n.data.type,name:n.data.name,isHost:this.realtime.hostClientId===n.clientId}};this.onFrameSizeDidChange=n=>{this.publish("frame.dimensions-update",n)};this.onWaitingForHost=n=>{this.publish("meeting.waiting-for-host",n)};this.onConnectionStatusChange=n=>{this.logger.log("video component @ on connection status change",n);let s=[2,4,3,6];s.includes(n)&&this.realtime.freezeSync(!0),s.includes(this.connectionService.oldConnectionStatus)&&!s.includes(n)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",n)};this.onMeetingStateChange=n=>{this.logger.log("video component @ on meeting state change",n),this.publish("meeting.state-update",n)};this.onSameAccountError=n=>{this.publish("meeting.same-participant-error",n),this.detach()};this.onDevicesChange=n=>{this.publish("meeting.devices-change",n)};this.onFrameStateChange=n=>{this.logger.log("video component @ on frame state change",n),n===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:$e.get("roomId")})};this.onRealtimeEventFromFrame=({event:n,data:s})=>{this.logger.log("video component @ on realtime event from frame",n,s);let i={["realtime.host-change"]:m=>this.realtime.setHost(m),["realtime.gather"]:m=>this.realtime.setGather(m),["realtime.grid-mode-change"]:m=>this.realtime.setGridMode(m),["realtime.drawing-change"]:m=>{this.realtime.setDrawing(m)},["realtime.follow-participant"]:m=>{this.realtime.setFollowParticipant(m)},["meeting.kick-participant"]:m=>{this.realtime.setKickParticipant(m)},["realtime.transcript-change"]:m=>{this.realtime.setTranscript(m)},["realtime.go-to-participant"]:m=>{this.eventBus.publish("realtime.go-to-participant",m)}}[n](s);this.publish(n,s)};this.onParticipantJoined=n=>{if(this.logger.log("video component @ on participant joined",n),this.localParticipant=n,this.publish("meeting.participant-joined",n),this.publish("my-participant.joined",n),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:n.avatar,name:n.name});return}this.realtime.updateMyProperties({name:n.name})};this.onParticipantLeft=n=>{this.logger.log("video component @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.detach()};this.onParticipantListUpdate=n=>{this.logger.log("video component @ on participant list update",n),!(0,Os.isEqual)(this.participantsOnMeeting,n)&&(this.publish("meeting.participant-list-update",n),this.participantsOnMeeting.length!==n.length&&this.publish("meeting.amount-of-participants-update",n.length),this.participantsOnMeeting=n)};this.onKickAllParticipantsDidChange=n=>{this.logger.log("video component @ on kick all participants did change",n),this.publish("meeting.kick-all-participants",n),this.detach()};this.onKickLocalParticipant=()=>{this.logger.log("video component @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.onRoomInfoUpdated=n=>{this.logger.log("video component @ on room info updated",n);let{isGridModeEnable:s,followParticipantId:i,gather:m,drawing:y,transcript:l}=n;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",s),this.videoManager.publishMessageToFrame("realtime.drawing-change",y),this.videoManager.publishMessageToFrame("realtime.follow-participant",i),this.videoManager.publishMessageToFrame("realtime.transcript-change",l),this.realtime.hostClientId===this.localParticipant.id&&m&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=n=>{this.logger.log("video component @ on participants did change",n);let s=Object.values(n).map(i=>({timestamp:i.timestamp,connectionId:i.connectionId,participantId:i.clientId,color:this.realtime.getSlotColor(i.data.slotIndex).name,name:i.data.name,isHost:this.realtime.hostClientId===i.clientId,avatar:i.data.avatar,type:i.data.type}));(0,Os.isEqual)(this.participantToFrameList,s)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",s),this.participantToFrameList=s};this.onHostParticipantDidChange=n=>{this.logger.log("video component @ on host participant did change",n),this.videoManager.publishMessageToFrame("realtime.host-change",n==null?void 0:n.newHostParticipantId)};this.onParticipantJoinedOnRealtime=n=>{this.logger.log("video component @ on participant joined on realtime",n),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(n))};this.onParticipantLeftOnRealtime=n=>{this.logger.log("video component @ on participant left on realtime",n),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(n))};this.params=n,this.name="video-component",this.logger=new qe("@superviz/sdk/video-component"),this.browserService=new Er,this.connectionService=new Mi,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}start(){this.logger.log("video component @ start"),this.publish("meeting.start"),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){this.logger.log("video component @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}};X();var Ir=class extends Qn{constructor(n){super();this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.participantsObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.participantsObserver.unsubscribe(this.onParticipantsDidChange)};this.onMyParticipantMouseMove=n=>{let i=(this.containerId?document.getElementById(this.containerId):document==null?void 0:document.body).getBoundingClientRect();this.realtime.updateMyProperties({mousePositionX:this.containerId?n.x-i.x:n.x,mousePositionY:this.containerId?n.y-i.y:n.y,originalWidth:this.containerId?i.width:1,originalHeight:this.containerId?i.height:1,containerId:this.containerId})};this.onParticipantsDidChange=n=>{this.logger.log("presence-mouse component @ on participants did change",n),Object.values(n).forEach(s=>{var l;let i=s.data,m=(i==null?void 0:i.mousePositionX)&&this.presenceMouseElement,y=(i==null?void 0:i.id)===((l=this.localParticipant)==null?void 0:l.id);i.color=this.realtime.getSlotColor(s.data.slotIndex).color,i.slotIndex=s.data.slotIndex,!y&&m&&this.presenceMouseElement.updatePresenceMouseParticipant(i)})};this.onParticipantJoinedOnRealtime=n=>{var s,i;if(this.logger.log("presence-mouse component @ on participant joined on realtime",n),((s=n==null?void 0:n.data)==null?void 0:s.id)===((i=this.localParticipant)==null?void 0:i.id)){let m=this.containerId?document.getElementById(this.containerId):document==null?void 0:document.body;this.presenceMouseElement=document.createElement("superviz-presence-mouse"),m.appendChild(this.presenceMouseElement),m.addEventListener("mousemove",this.onMyParticipantMouseMove)}};this.onParticipantLeftOnRealtime=n=>{this.logger.log("presence-mouse component @ on participant left on realtime",n),this.presenceMouseElement.removePresenceMouseParticipant(n.clientId)};this.name="presence-mouse-component",this.logger=new qe("@superviz/sdk/presence-mouse-component"),this.containerId=n!=null?n:null}start(){this.logger.log("presence-mouse component @ start"),this.subscribeToRealtimeEvents()}destroy(){this.logger.log("presence-mouse component @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents();let n=this.containerId?document.getElementById(this.containerId):null;n&&(n.removeEventListener("mousemove",this.onMyParticipantMouseMove),n.removeChild(this.presenceMouseElement))}};X();var xs=qt(gs());X();var Qt=class{static createUrl(r,n){return`${r}${n}`}static validateApiKey(r,n){let s="/user/checkapikey",i=this.createUrl(r,s);return ln(i,"POST",{apiKey:n})}static fetchConfig(r,n){let s="/immersive-config",i=this.createUrl(r,s);return ln(i,"POST",{apiKey:n})}static fetchWaterMark(r,n){return Ye(this,null,function*(){let s="/user/watermark",i=this.createUrl(r,s),{message:m}=yield ln(i,"POST",{apiKey:n});return m})}static sendActivity(r,n,s,i){return Ye(this,null,function*(){let m="/activity",y=$e.get("apiUrl"),l=$e.get("roomId"),f=$e.get("apiKey"),A=this.createUrl(y,m);return ln(A,"POST",{groupId:n,groupName:s,meetingId:l,product:i,userId:r},{apikey:f})})}};X();function Wy(h,r){return Ye(this,null,function*(){try{return(yield Qt.validateApiKey(h,r))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}})}var bc=Wy;X();X();var Yn=class{static getRemoteConfig(){return Ye(this,arguments,function*(r="prod"){let{version:n}=yield Promise.resolve().then(()=>(Cc(),Ac));if(r==="local"){let{remoteConfig:m}=yield Promise.resolve().then(()=>(Sc(),Oc));return m}let s={version:n,environment:r},i=this.createUrl(s);return ln(i,"GET",null)})}static createUrl({version:r,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${r}?env=${n}`}};Yn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";X();var ws=qt(Ii());X();var _r=class{constructor(){this.observers=new Map;this.subscribe=(r,n)=>{this.logger.log("event bus service @ subscribe",{event:r,callback:n}),this.observers.has(r)||this.observers.set(r,new _e),this.observers.get(r).subscribe(n)};this.unsubscribe=(r,n)=>{this.logger.log("event bus service @ unsubscribe",{event:r,callback:n}),this.observers.has(r)&&(this.observers.get(r).reset(),this.observers.delete(r))};this.publish=(r,n)=>{this.logger.log("event bus service @ publish",{event:r,data:n}),this.observers.has(r)&&this.observers.get(r).publish(n)};this.logger=new qe("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};X();var Ni=class{constructor(r){this.observers=new Map;this.subscribe=(r,n)=>{this.logger.log("pubsub service @ subscribe",{event:r,callback:n}),this.observers.has(r)||this.observers.set(r,new _e),this.observers.get(r).subscribe(n)};this.unsubscribe=(r,n)=>{this.logger.log("pubsub service @ unsubscribe",{event:r,callback:n}),this.observers.has(r)&&(this.observers.get(r).reset(),this.observers.delete(r))};this.publish=(r,n)=>{this.logger.log("pubsub service @ publish",{event:r,data:n}),this.realtime.setSyncProperty(r,n)};this.publishEventToClient=(r,n)=>{this.logger.log("pubsub service @ publishEventToClient",{event:r,data:n}),this.observers.has(r)&&this.observers.get(r).publish(n)};this.onSyncPropertiesChange=r=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:r}),Object.entries(r).forEach(([n,s])=>{this.publishEventToClient(n,s)})};this.logger=new qe("@superviz/sdk/pubsub"),this.realtime=r,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(r){return this.realtime.fetchSyncClientProperty(r)}};X();X();var Ps=qt(Ec()),Pr=qt(bs());X();var Es=(s=>(s.HOST="host",s.GUEST="guest",s.AUDIENCE="audience",s))(Es||{});X();var Rs=(f=>(f[f.DISCONNECTED=0]="DISCONNECTED",f[f.INITIALIZING=1]="INITIALIZING",f[f.READY_TO_JOIN=2]="READY_TO_JOIN",f[f.CONNECTING=3]="CONNECTING",f[f.CONNECTED=4]="CONNECTED",f[f.JOINED=5]="JOINED",f[f.FAILED=-1]="FAILED",f[f.RETRYING=-2]="RETRYING",f))(Rs||{});X();X();var Ts=(b=>(b[b.yellow=0]="yellow",b[b.turquoise=1]="turquoise",b[b.orange=2]="orange",b[b.blue=3]="blue",b[b.pink=4]="pink",b[b.purple=5]="purple",b[b.green=6]="green",b[b.red=7]="red",b[b.bluedark=8]="bluedark",b[b.pinklight=9]="pinklight",b[b.purplelight=10]="purplelight",b[b.greenlight=11]="greenlight",b[b.orangelight=12]="orangelight",b[b.bluelight=13]="bluelight",b[b.redlight=14]="redlight",b[b.brown=15]="brown",b[b.gray=16]="gray",b))(Ts||{}),Is=(h=>(h[h["#FFEF33"]=0]="#FFEF33",h[h["#31E0B0"]=1]="#31E0B0",h[h["#FF5E10"]=2]="#FF5E10",h[h["#00ABF7"]=3]="#00ABF7",h[h["#FF00BB"]=4]="#FF00BB",h[h["#9C29FF"]=5]="#9C29FF",h[h["#6FDD00"]=6]="#6FDD00",h[h["#E30000"]=7]="#E30000",h[h["#304AFF"]=8]="#304AFF",h[h["#FF89C4"]=9]="#FF89C4",h[h["#D597FF"]=10]="#D597FF",h[h["#C6EC5C"]=11]="#C6EC5C",h[h["#FFA115"]=12]="#FFA115",h[h["#75DEFE"]=13]="#75DEFE",h[h["#FAA291"]=14]="#FAA291",h[h["#BB813F"]=15]="#BB813F",h[h["#878291"]=16]="#878291",h))(Is||{});var Ui=class{constructor(){this.participantObservers=[],this.logger=new qe("@superviz/sdk/realtime-service"),this.participantsObserver=new _e({logger:this.logger}),this.participantJoinedObserver=new _e({logger:this.logger}),this.participantLeaveObserver=new _e({logger:this.logger}),this.syncPropertiesObserver=new _e({logger:this.logger}),this.reconnectObserver=new _e({logger:this.logger}),this.roomInfoUpdatedObserver=new _e({logger:this.logger}),this.roomListUpdatedObserver=new _e({logger:this.logger}),this.hostObserver=new _e({logger:this.logger}),this.realtimeStateObserver=new _e({logger:this.logger}),this.kickAllParticipantsObserver=new _e({logger:this.logger}),this.kickParticipantObserver=new _e({logger:this.logger}),this.authenticationObserver=new _e({logger:this.logger})}subscribeToParticipantUpdate(r,n){this.participantObservers[r]||(this.participantObservers[r]=new _e({logger:this.logger})),this.participantObservers[r].subscribe(n)}unsubscribeFromParticipantUpdate(r,n){this.participantObservers[r]&&this.participantObservers[r].unsubscribe(n)}getSlotColor(r){let n=r!=null?r:16;return{color:Is[n],name:Ts[n]}}};var jy=1e3*60,Vy=6e4,Ky=1e4,Jy=1e3,_s=null,Zn=class extends Ui{constructor(n,s){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({hostClientId:s.clientId})};this.setKickParticipant=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({kickParticipant:s})};this.freezeSync=n=>{var s,i;if(this.isSyncFrozen=n,n){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(s=this.broadcastChannel)==null||s.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(n=>{let s=this.clientSyncPropertiesQueue[n];this.clientSyncPropertiesQueue[n]=[],s.length&&this.clientSyncChannel.publish(n,s)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(n,s)=>{this.clientRoomState[n]=s[s.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=n=>Ye(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?(n==null?void 0:n.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(n.hostClientId):this.hostPassingHandle(),this.updateParticipants(),n.kickParticipant&&n.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Pr.default)((n={})=>{let s=n;if(!(this.isMessageTooBig(s)||this.left||!this.enableSync||this.isSyncFrozen)&&(s.avatar===void 0&&delete s.avatar,this.myParticipant.data=gt(gt({},this.myParticipant.data),s),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},Jy);this.updateRoomProperties=n=>{if(this.isMessageTooBig(n)||this.isSyncFrozen||this.left)return;let s=gt(gt({},this.localRoomProperties),n);this.supervizChannel.publish("update",s)};this.updateParticipants=()=>{let n={};this.supervizChannel.presence.get((s,i)=>{i.forEach(m=>{n[m.clientId]=gt({},m)}),this.participants=n,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=n=>{let s=[];if(this.supervizChannel.presence.get((m,y)=>{y.forEach(l=>{m||s.push(l.clientId)})}),!n||!s.includes(n)){this.hostPassingHandle();return}_s&&clearTimeout(_s);let i=this.hostParticipantId;this.hostParticipantId=n,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var s;let n={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((s=this.myParticipant)==null?void 0:s.data.type)==="host"&&(n.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(n)};this.hostPassingHandle=(0,Pr.default)(()=>Ye(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((n,s)=>{let i=s.filter(y=>y.data.type==="host").map(y=>y.clientId);if(this.shouldKickParticipantsOnHostLeave&&i.length===0){_s=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},jy);return}let m=i[0];m===this.localParticipantId&&this.setHost(m)})}),1e3);this.findSlotIndex=n=>{let s=n,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((l,f)=>{if(l){i=[];return}f.forEach(A=>{A.connectionId===s.connectionId&&(s=A),A.connectionId!==s.connectionId&&A.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(A.data.slotIndex),1)})}),i.length===0)return;let m=i[0];this.myParticipant.data.slotIndex=m,this.updateMyProperties({slotIndex:m});let y=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(s)},y)};this.confirmSlot=(0,Pr.default)(n=>Ye(this,null,function*(){let s=[],i=n;if(this.supervizChannel.presence.get((m,y)=>{y.forEach(l=>{l.connectionId===i.connectionId&&(i=l),l.connectionId!==i.connectionId&&l.data.slotIndex!==void 0&&s.push(l.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||s.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let m=yield this.fetchRoomProperties();this.updateRoomProperties(m)}}),1e3);this.onParticipantJoin=n=>{this.updateParticipants(),this.participantJoinedObserver.publish(n),this.updateMyProperties()};this.syncBroadcast=(0,Pr.default)(()=>{let n=btoa(this.ablyKey),s=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(s,{headers:{Authorization:`Basic ${n}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(n,s=Vy)=>{let i=JSON.stringify(n);return new TextEncoder().encode(i).length>s?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=s,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var n,s;return(s=(n=this.myParticipant.data)==null?void 0:n.participantId)!=null?s:null}get isBroadcast(){return Object.values(this.participants).some(n=>n.data.type==="audience")}start({participant:n,roomId:s,apiKey:i,shouldKickParticipantsOnHostLeave:m}){this.myParticipant={data:Cn(gt({},n),{participantId:n.id}),timestamp:null,action:null,clientId:n.id,connectionId:null,encoding:null,id:null},this.enableSync=n.type!=="audience",this.roomId=`superviz:${s.toLowerCase()}-${i}`,this.shouldKickParticipantsOnHostLeave=m,this.apiKey=i,this.client||this.buildClient()}auth(n,s){let i=new Ps.default.Rest({key:this.ablyKey}),{origin:m}=window.location;i.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:m,apiKey:this.apiKey}},(y,l)=>{y&&this.authenticationObserver.publish("realtime.authentication-failed"),s(y,l)})}join(n){let s=n?Object.assign({},n,{participantId:n.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(s),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{isGridModeEnable:n}))}setDrawing(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{drawing:n}))}setTranscript(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{transcript:n}))}setSyncProperty(n,s){var y;let i=(y=this.clientSyncPropertiesQueue[n])!=null?y:[],m=(l,f)=>({name:l,data:f,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(m(n,s),Ky)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(i)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",n,s),this.clientSyncPropertiesQueue[n]||(this.clientSyncPropertiesQueue[n]=[]),this.clientSyncPropertiesQueue[n].push(m(n,s)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var s,i;if(n){let m=n.toString();if(this.participants&&this.participants[m])return(i=(s=this.participants[n])==null?void 0:s.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:s}=n,i=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(i),this.participants&&this.participants[s]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onClientSyncChannelUpdate(n){let{name:s,data:i}=n,m={};m[s]=i,this.syncPropertiesObserver.publish(m),this.isLocalParticipantHost&&this.saveClientRoomState(s,i)}onReceiveBroadcastSync(n){n.data.forEach(i=>{var y;let m=i.clientId;this.participants[m]=i,(y=i.data)!=null&&y.isAudience||(this.participants[m].data=JSON.parse(this.participants[m].data),this.publishParticipantUpdate(this.participants[m]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Ps.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw this.logger.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,this.logger.log("REALTIME",`Realtime state did change. New state: ${Rs[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,s)=>{this.supervizChannel.history((i,m)=>{var l;i&&s(i);let y=(l=m.items[0])==null?void 0:l.data;n(y||null)})})}fetchSyncClientProperty(n){return Ye(this,null,function*(){try{let s=yield new Promise((i,m)=>{this.clientRoomStateChannel.history((y,l)=>{var A;y&&m(y);let f=(A=l==null?void 0:l.items[0])==null?void 0:A.data;i(f||null)})});if(n&&!s[n])throw new Error(`Event ${n} not found in the history`);return n?s[n]:s}catch(s){this.logger.log("REALTIME","Error in fetch client realtime data",s.message),this.throw(s.message)}})}onStateChange(){var S,R,a;let n=(S=this.supervizChannelState)==null?void 0:S.current,s=(R=this.connectionState)==null?void 0:R.current,i=s==="connected",m=["initialized","connecting"].includes(s),y=["closed","closing"].includes(s)||["detaching","detached"].includes(n),l={[0]:y,[1]:m,[2]:!n&&i,[3]:n==="attaching",[4]:n==="attached"&&i,[-1]:n==="failed"||s==="failed",[-2]:s==="suspended"||n==="suspended"},f=Object.entries(l).find(([E,M])=>M&&E)[0],A=Number(f);if(A===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(A===-2||A===-1)&&this.forceReconnect(),(a=this.connectionState)!=null&&a.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(A)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.supervizChannelState=n,this.onStateChange()}onJoinRoom(n){return Ye(this,null,function*(){var s;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(n),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((s=this.localRoomProperties)==null?void 0:s.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(n),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let s=n.data.participantId===this.hostParticipantId;n.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(n),s&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};X();var Ms=class{constructor({participant:r,group:n,shouldKickParticipantsOnHostLeave:s}){this.eventBus=new _r;this.participants=[];this.addComponent=r=>{r.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:$e.configuration,eventBus:this.eventBus}),Qt.sendActivity(this.participant.id,this.group.id,this.group.name,r.name)};this.removeComponent=r=>{r.detach()};this.subscribeToPubSubEvent=(r,n)=>{this.logger.log("launcher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(r,n)};this.unsubscribeFromPubSubEvent=(r,n)=>{this.logger.log("launcher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(r,n)};this.publishToPubSubEvent=(r,n)=>{this.logger.log("launcher service @ publishToPubSubEvent"),this.pubsub.publish(r,n)};this.fetchPubSubHistory=r=>this.pubsub.fetchHistory(r);this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:$e.get("apiKey"),roomId:$e.get("roomId"),shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.onParticipantListUpdate=r=>{this.logger.log("launcher service @ onParticipantListUpdate");let n=Object.values(r).map(i=>{var m,y,l,f,A;return{id:i.data.id,name:(m=i.data)==null?void 0:m.name,type:(y=i.data)==null?void 0:y.type,avatar:(l=i.data)==null?void 0:l.avatar,avatarConfig:(f=i.data)==null?void 0:f.avatarConfig,isHost:this.realtime.hostClientId===i.clientId,color:this.realtime.getSlotColor((A=i.data)==null?void 0:A.slotIndex).color}}),s=n.find(i=>{var m;return(i==null?void 0:i.id)===((m=this.participant)==null?void 0:m.id)});(0,ws.isEqual)(this.participants,n)||(this.participants=n,this.pubsub.publishEventToClient("participant.list-updated",n),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n)),s&&!(0,ws.isEqual)(this.participant,s)&&(this.participant=s,this.pubsub.publishEventToClient("participant.updated",s),this.logger.log("Publishing ParticipantEvent.UPDATED",s))};this.onParticipantJoined=r=>{this.logger.log("launcher service @ onParticipantJoined");let n=this.participants.find(s=>s.id===r.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.pubsub.publishEventToClient("participant.local-joined",n)),this.logger.log("launcher service @ onParticipantJoined - participant joined",n),this.pubsub.publishEventToClient("participant.joined",n))};this.onParticipantLeave=r=>{this.logger.log("launcher service @ onParticipantLeave");let n=this.participants.find(s=>s.id===r.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.pubsub.publishEventToClient("participant.local-left",n)),this.logger.log("launcher service @ onParticipantLeave - participant left",n),this.pubsub.publishEventToClient("participant.left",n))};this.onHostParticipantDidChange=r=>{let n=this.participants.find(s=>s.id===(r==null?void 0:r.newHostParticipantId));this.realtime.isLocalParticipantHost&&this.publishToPubSubEvent("realtime.host-change",n)};this.shouldKickParticipantsOnHostLeave=s!=null?s:!0,this.participant=r,this.group=n,this.logger=new qe("@superviz/sdk/launcher"),this.realtime=new Zn($e.get("apiUrl"),$e.get("ablyKey")),this.pubsub=new Ni(this.realtime),this.eventBus=new _r,this.logger.log("launcher created"),this.startRealtime()}},Rc=h=>{let r=new Ms(h);return{subscribe:r.subscribeToPubSubEvent,unsubscribe:r.unsubscribeFromPubSubEvent,publish:r.publishToPubSubEvent,fetchHistory:r.fetchPubSubHistory,addComponent:r.addComponent,removeComponent:r.removeComponent}};var qy=({group:h,participant:r,roomId:n})=>{if(!h||!h.name||!h.id)throw new Error("Group fields is required");if(!r||!r.id)throw new Error("Participants fields is required");if(!n)throw new Error("Room id is required")},Qy=(h,r)=>Ye(void 0,null,function*(){if(!(h&&h.trim()))throw new Error("API key is required");if(!r)throw new Error("Options is required");qy(r),r.debug?xs.debug.enable("*"):xs.debug.disable();let{apiUrl:s,conferenceLayerUrl:i}=yield Yn.getRemoteConfig(r.environment);if(!(yield bc(s,h)))throw new Error("Failed to validate API key");let y=yield Qt.fetchConfig(s,h);if(!y||!y.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:l}=y;return $e.setConfig({apiUrl:s,ablyKey:l,apiKey:h,conferenceLayerUrl:i,environment:y,roomId:r.roomId,debug:r.debug}),Rc(Object.assign({},r,{apiKey:h,ablyKey:l,conferenceLayerUrl:i,apiUrl:s}))}),Ls=Qy;X();X();X();X();X();var Bi=window,Fi=Bi.ShadowRoot&&(Bi.ShadyCSS===void 0||Bi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ns=Symbol(),Tc=new WeakMap,wr=class{constructor(r,n,s){if(this._$cssResult$=!0,s!==Ns)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=r,this.t=n}get styleSheet(){let r=this.o,n=this.t;if(Fi&&r===void 0){let s=n!==void 0&&n.length===1;s&&(r=Tc.get(n)),r===void 0&&((this.o=r=new CSSStyleSheet).replaceSync(this.cssText),s&&Tc.set(n,r))}return r}toString(){return this.cssText}},Ic=h=>new wr(typeof h=="string"?h:h+"",void 0,Ns),Mr=(h,...r)=>{let n=h.length===1?h[0]:r.reduce((s,i,m)=>s+(y=>{if(y._$cssResult$===!0)return y.cssText;if(typeof y=="number")return y;throw Error("Value passed to 'css' function must be a 'css' function result: "+y+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+h[m+1],h[0]);return new wr(n,h,Ns)},Ds=(h,r)=>{Fi?h.adoptedStyleSheets=r.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet):r.forEach(n=>{let s=document.createElement("style"),i=Bi.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=n.cssText,h.appendChild(s)})},Gi=Fi?h=>h:h=>h instanceof CSSStyleSheet?(r=>{let n="";for(let s of r.cssRules)n+=s.cssText;return Ic(n)})(h):h;var Us,Hi=window,_c=Hi.trustedTypes,Yy=_c?_c.emptyScript:"",Pc=Hi.reactiveElementPolyfillSupport,Fs={toAttribute(h,r){switch(r){case Boolean:h=h?Yy:null;break;case Object:case Array:h=h==null?h:JSON.stringify(h)}return h},fromAttribute(h,r){let n=h;switch(r){case Boolean:n=h!==null;break;case Number:n=h===null?null:Number(h);break;case Object:case Array:try{n=JSON.parse(h)}catch(s){n=null}}return n}},wc=(h,r)=>r!==h&&(r==r||h==h),Bs={attribute:!0,type:String,converter:Fs,reflect:!1,hasChanged:wc},Gs="finalized",Yt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(r){var n;this.finalize(),((n=this.h)!==null&&n!==void 0?n:this.h=[]).push(r)}static get observedAttributes(){this.finalize();let r=[];return this.elementProperties.forEach((n,s)=>{let i=this._$Ep(s,n);i!==void 0&&(this._$Ev.set(i,s),r.push(i))}),r}static createProperty(r,n=Bs){if(n.state&&(n.attribute=!1),this.finalize(),this.elementProperties.set(r,n),!n.noAccessor&&!this.prototype.hasOwnProperty(r)){let s=typeof r=="symbol"?Symbol():"__"+r,i=this.getPropertyDescriptor(r,s,n);i!==void 0&&Object.defineProperty(this.prototype,r,i)}}static getPropertyDescriptor(r,n,s){return{get(){return this[n]},set(i){let m=this[r];this[n]=i,this.requestUpdate(r,m,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(r){return this.elementProperties.get(r)||Bs}static finalize(){if(this.hasOwnProperty(Gs))return!1;this[Gs]=!0;let r=Object.getPrototypeOf(this);if(r.finalize(),r.h!==void 0&&(this.h=[...r.h]),this.elementProperties=new Map(r.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){let n=this.properties,s=[...Object.getOwnPropertyNames(n),...Object.getOwnPropertySymbols(n)];for(let i of s)this.createProperty(i,n[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(r){let n=[];if(Array.isArray(r)){let s=new Set(r.flat(1/0).reverse());for(let i of s)n.unshift(Gi(i))}else r!==void 0&&n.push(Gi(r));return n}static _$Ep(r,n){let s=n.attribute;return s===!1?void 0:typeof s=="string"?s:typeof r=="string"?r.toLowerCase():void 0}u(){var r;this._$E_=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(r=this.constructor.h)===null||r===void 0||r.forEach(n=>n(this))}addController(r){var n,s;((n=this._$ES)!==null&&n!==void 0?n:this._$ES=[]).push(r),this.renderRoot!==void 0&&this.isConnected&&((s=r.hostConnected)===null||s===void 0||s.call(r))}removeController(r){var n;(n=this._$ES)===null||n===void 0||n.splice(this._$ES.indexOf(r)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((r,n)=>{this.hasOwnProperty(n)&&(this._$Ei.set(n,this[n]),delete this[n])})}createRenderRoot(){var r;let n=(r=this.shadowRoot)!==null&&r!==void 0?r:this.attachShadow(this.constructor.shadowRootOptions);return Ds(n,this.constructor.elementStyles),n}connectedCallback(){var r;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(r=this._$ES)===null||r===void 0||r.forEach(n=>{var s;return(s=n.hostConnected)===null||s===void 0?void 0:s.call(n)})}enableUpdating(r){}disconnectedCallback(){var r;(r=this._$ES)===null||r===void 0||r.forEach(n=>{var s;return(s=n.hostDisconnected)===null||s===void 0?void 0:s.call(n)})}attributeChangedCallback(r,n,s){this._$AK(r,s)}_$EO(r,n,s=Bs){var i;let m=this.constructor._$Ep(r,s);if(m!==void 0&&s.reflect===!0){let y=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:Fs).toAttribute(n,s.type);this._$El=r,y==null?this.removeAttribute(m):this.setAttribute(m,y),this._$El=null}}_$AK(r,n){var s;let i=this.constructor,m=i._$Ev.get(r);if(m!==void 0&&this._$El!==m){let y=i.getPropertyOptions(m),l=typeof y.converter=="function"?{fromAttribute:y.converter}:((s=y.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?y.converter:Fs;this._$El=m,this[m]=l.fromAttribute(n,y.type),this._$El=null}}requestUpdate(r,n,s){let i=!0;r!==void 0&&(((s=s||this.constructor.getPropertyOptions(r)).hasChanged||wc)(this[r],n)?(this._$AL.has(r)||this._$AL.set(r,n),s.reflect===!0&&this._$El!==r&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(r,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}_$Ej(){return Ye(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(n){Promise.reject(n)}let r=this.scheduleUpdate();return r!=null&&(yield r),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,m)=>this[m]=i),this._$Ei=void 0);let n=!1,s=this._$AL;try{n=this.shouldUpdate(s),n?(this.willUpdate(s),(r=this._$ES)===null||r===void 0||r.forEach(i=>{var m;return(m=i.hostUpdate)===null||m===void 0?void 0:m.call(i)}),this.update(s)):this._$Ek()}catch(i){throw n=!1,this._$Ek(),i}n&&this._$AE(s)}willUpdate(r){}_$AE(r){var n;(n=this._$ES)===null||n===void 0||n.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(r)),this.updated(r)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(r){return!0}update(r){this._$EC!==void 0&&(this._$EC.forEach((n,s)=>this._$EO(s,this[s],n)),this._$EC=void 0),this._$Ek()}updated(r){}firstUpdated(r){}};Yt[Gs]=!0,Yt.elementProperties=new Map,Yt.elementStyles=[],Yt.shadowRootOptions={mode:"open"},Pc==null||Pc({ReactiveElement:Yt}),((Us=Hi.reactiveElementVersions)!==null&&Us!==void 0?Us:Hi.reactiveElementVersions=[]).push("1.6.2");X();var Hs,ki=window,Xn=ki.trustedTypes,Mc=Xn?Xn.createPolicy("lit-html",{createHTML:h=>h}):void 0,Ws="$lit$",cn=`lit$${(Math.random()+"").slice(9)}$`,Fc="?"+cn,Zy=`<${Fc}>`,Tn=document,Lr=()=>Tn.createComment(""),Nr=h=>h===null||typeof h!="object"&&typeof h!="function",Gc=Array.isArray,Xy=h=>Gc(h)||typeof(h==null?void 0:h[Symbol.iterator])=="function",ks=`[ 	
\f\r]`,xr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,xc=/-->/g,Lc=/>/g,En=RegExp(`>|${ks}(?:([^\\s"'>=/]+)(${ks}*=${ks}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Nc=/'/g,Dc=/"/g,Hc=/^(?:script|style|textarea|title)$/i,kc=h=>(r,...n)=>({_$litType$:h,strings:r,values:n}),Wi=kc(1),MC=kc(2),In=Symbol.for("lit-noChange"),rt=Symbol.for("lit-nothing"),Uc=new WeakMap,Rn=Tn.createTreeWalker(Tn,129,null,!1);function Wc(h,r){if(!Array.isArray(h)||!h.hasOwnProperty("raw"))throw Error("invalid template strings array");return Mc!==void 0?Mc.createHTML(r):r}var eb=(h,r)=>{let n=h.length-1,s=[],i,m=r===2?"<svg>":"",y=xr;for(let l=0;l<n;l++){let f=h[l],A,S,R=-1,a=0;for(;a<f.length&&(y.lastIndex=a,S=y.exec(f),S!==null);)a=y.lastIndex,y===xr?S[1]==="!--"?y=xc:S[1]!==void 0?y=Lc:S[2]!==void 0?(Hc.test(S[2])&&(i=RegExp("</"+S[2],"g")),y=En):S[3]!==void 0&&(y=En):y===En?S[0]===">"?(y=i!=null?i:xr,R=-1):S[1]===void 0?R=-2:(R=y.lastIndex-S[2].length,A=S[1],y=S[3]===void 0?En:S[3]==='"'?Dc:Nc):y===Dc||y===Nc?y=En:y===xc||y===Lc?y=xr:(y=En,i=void 0);let E=y===En&&h[l+1].startsWith("/>")?" ":"";m+=y===xr?f+Zy:R>=0?(s.push(A),f.slice(0,R)+Ws+f.slice(R)+cn+E):f+cn+(R===-2?(s.push(void 0),l):E)}return[Wc(h,m+(h[n]||"<?>")+(r===2?"</svg>":"")),s]},_n=class{constructor({strings:r,_$litType$:n},s){let i;this.parts=[];let m=0,y=0,l=r.length-1,f=this.parts,[A,S]=eb(r,n);if(this.el=_n.createElement(A,s),Rn.currentNode=this.el.content,n===2){let R=this.el.content,a=R.firstChild;a.remove(),R.append(...a.childNodes)}for(;(i=Rn.nextNode())!==null&&f.length<l;){if(i.nodeType===1){if(i.hasAttributes()){let R=[];for(let a of i.getAttributeNames())if(a.endsWith(Ws)||a.startsWith(cn)){let E=S[y++];if(R.push(a),E!==void 0){let M=i.getAttribute(E.toLowerCase()+Ws).split(cn),P=/([.?@])?(.*)/.exec(E);f.push({type:1,index:m,name:P[2],strings:M,ctor:P[1]==="."?$s:P[1]==="?"?js:P[1]==="@"?Vs:tr})}else f.push({type:6,index:m})}for(let a of R)i.removeAttribute(a)}if(Hc.test(i.tagName)){let R=i.textContent.split(cn),a=R.length-1;if(a>0){i.textContent=Xn?Xn.emptyScript:"";for(let E=0;E<a;E++)i.append(R[E],Lr()),Rn.nextNode(),f.push({type:2,index:++m});i.append(R[a],Lr())}}}else if(i.nodeType===8)if(i.data===Fc)f.push({type:2,index:m});else{let R=-1;for(;(R=i.data.indexOf(cn,R+1))!==-1;)f.push({type:7,index:m}),R+=cn.length-1}m++}}static createElement(r,n){let s=Tn.createElement("template");return s.innerHTML=r,s}};function er(h,r,n=h,s){var i,m,y,l;if(r===In)return r;let f=s!==void 0?(i=n._$Co)===null||i===void 0?void 0:i[s]:n._$Cl,A=Nr(r)?void 0:r._$litDirective$;return(f==null?void 0:f.constructor)!==A&&((m=f==null?void 0:f._$AO)===null||m===void 0||m.call(f,!1),A===void 0?f=void 0:(f=new A(h),f._$AT(h,n,s)),s!==void 0?((y=(l=n)._$Co)!==null&&y!==void 0?y:l._$Co=[])[s]=f:n._$Cl=f),f!==void 0&&(r=er(h,f._$AS(h,r.values),f,s)),r}var zs=class{constructor(r,n){this._$AV=[],this._$AN=void 0,this._$AD=r,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(r){var n;let{el:{content:s},parts:i}=this._$AD,m=((n=r==null?void 0:r.creationScope)!==null&&n!==void 0?n:Tn).importNode(s,!0);Rn.currentNode=m;let y=Rn.nextNode(),l=0,f=0,A=i[0];for(;A!==void 0;){if(l===A.index){let S;A.type===2?S=new Pn(y,y.nextSibling,this,r):A.type===1?S=new A.ctor(y,A.name,A.strings,this,r):A.type===6&&(S=new Ks(y,this,r)),this._$AV.push(S),A=i[++f]}l!==(A==null?void 0:A.index)&&(y=Rn.nextNode(),l++)}return Rn.currentNode=Tn,m}v(r){let n=0;for(let s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(r,s,n),n+=s.strings.length-2):s._$AI(r[n])),n++}},Pn=class{constructor(r,n,s,i){var m;this.type=2,this._$AH=rt,this._$AN=void 0,this._$AA=r,this._$AB=n,this._$AM=s,this.options=i,this._$Cp=(m=i==null?void 0:i.isConnected)===null||m===void 0||m}get _$AU(){var r,n;return(n=(r=this._$AM)===null||r===void 0?void 0:r._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let r=this._$AA.parentNode,n=this._$AM;return n!==void 0&&(r==null?void 0:r.nodeType)===11&&(r=n.parentNode),r}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(r,n=this){r=er(this,r,n),Nr(r)?r===rt||r==null||r===""?(this._$AH!==rt&&this._$AR(),this._$AH=rt):r!==this._$AH&&r!==In&&this._(r):r._$litType$!==void 0?this.g(r):r.nodeType!==void 0?this.$(r):Xy(r)?this.T(r):this._(r)}k(r){return this._$AA.parentNode.insertBefore(r,this._$AB)}$(r){this._$AH!==r&&(this._$AR(),this._$AH=this.k(r))}_(r){this._$AH!==rt&&Nr(this._$AH)?this._$AA.nextSibling.data=r:this.$(Tn.createTextNode(r)),this._$AH=r}g(r){var n;let{values:s,_$litType$:i}=r,m=typeof i=="number"?this._$AC(r):(i.el===void 0&&(i.el=_n.createElement(Wc(i.h,i.h[0]),this.options)),i);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===m)this._$AH.v(s);else{let y=new zs(m,this),l=y.u(this.options);y.v(s),this.$(l),this._$AH=y}}_$AC(r){let n=Uc.get(r.strings);return n===void 0&&Uc.set(r.strings,n=new _n(r)),n}T(r){Gc(this._$AH)||(this._$AH=[],this._$AR());let n=this._$AH,s,i=0;for(let m of r)i===n.length?n.push(s=new Pn(this.k(Lr()),this.k(Lr()),this,this.options)):s=n[i],s._$AI(m),i++;i<n.length&&(this._$AR(s&&s._$AB.nextSibling,i),n.length=i)}_$AR(r=this._$AA.nextSibling,n){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,n);r&&r!==this._$AB;){let i=r.nextSibling;r.remove(),r=i}}setConnected(r){var n;this._$AM===void 0&&(this._$Cp=r,(n=this._$AP)===null||n===void 0||n.call(this,r))}},tr=class{constructor(r,n,s,i,m){this.type=1,this._$AH=rt,this._$AN=void 0,this.element=r,this.name=n,this._$AM=i,this.options=m,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=rt}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(r,n=this,s,i){let m=this.strings,y=!1;if(m===void 0)r=er(this,r,n,0),y=!Nr(r)||r!==this._$AH&&r!==In,y&&(this._$AH=r);else{let l=r,f,A;for(r=m[0],f=0;f<m.length-1;f++)A=er(this,l[s+f],n,f),A===In&&(A=this._$AH[f]),y||(y=!Nr(A)||A!==this._$AH[f]),A===rt?r=rt:r!==rt&&(r+=(A!=null?A:"")+m[f+1]),this._$AH[f]=A}y&&!i&&this.j(r)}j(r){r===rt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,r!=null?r:"")}},$s=class extends tr{constructor(){super(...arguments),this.type=3}j(r){this.element[this.name]=r===rt?void 0:r}},tb=Xn?Xn.emptyScript:"",js=class extends tr{constructor(){super(...arguments),this.type=4}j(r){r&&r!==rt?this.element.setAttribute(this.name,tb):this.element.removeAttribute(this.name)}},Vs=class extends tr{constructor(r,n,s,i,m){super(r,n,s,i,m),this.type=5}_$AI(r,n=this){var s;if((r=(s=er(this,r,n,0))!==null&&s!==void 0?s:rt)===In)return;let i=this._$AH,m=r===rt&&i!==rt||r.capture!==i.capture||r.once!==i.once||r.passive!==i.passive,y=r!==rt&&(i===rt||m);m&&this.element.removeEventListener(this.name,this,i),y&&this.element.addEventListener(this.name,this,r),this._$AH=r}handleEvent(r){var n,s;typeof this._$AH=="function"?this._$AH.call((s=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&s!==void 0?s:this.element,r):this._$AH.handleEvent(r)}},Ks=class{constructor(r,n,s){this.element=r,this.type=6,this._$AN=void 0,this._$AM=n,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(r){er(this,r)}};var Bc=ki.litHtmlPolyfillSupport;Bc==null||Bc(_n,Pn),((Hs=ki.litHtmlVersions)!==null&&Hs!==void 0?Hs:ki.litHtmlVersions=[]).push("2.7.5");var zc=(h,r,n)=>{var s,i;let m=(s=n==null?void 0:n.renderBefore)!==null&&s!==void 0?s:r,y=m._$litPart$;if(y===void 0){let l=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:null;m._$litPart$=y=new Pn(r.insertBefore(Lr(),l),l,void 0,n!=null?n:{})}return y._$AI(h),y};X();var Js,qs;var Gt=class extends Yt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var r,n;let s=super.createRenderRoot();return(r=(n=this.renderOptions).renderBefore)!==null&&r!==void 0||(n.renderBefore=s.firstChild),s}update(r){let n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(r),this._$Do=zc(n,this.renderRoot,this.renderOptions)}connectedCallback(){var r;super.connectedCallback(),(r=this._$Do)===null||r===void 0||r.setConnected(!0)}disconnectedCallback(){var r;super.disconnectedCallback(),(r=this._$Do)===null||r===void 0||r.setConnected(!1)}render(){return In}};Gt.finalized=!0,Gt._$litElement$=!0,(Js=globalThis.litElementHydrateSupport)===null||Js===void 0||Js.call(globalThis,{LitElement:Gt});var $c=globalThis.litElementPolyfillSupport;$c==null||$c({LitElement:Gt});((qs=globalThis.litElementVersions)!==null&&qs!==void 0?qs:globalThis.litElementVersions=[]).push("3.3.2");X();X();X();var zi=h=>r=>typeof r=="function"?((n,s)=>(customElements.define(n,s),s))(h,r):((n,s)=>{let{kind:i,elements:m}=s;return{kind:i,elements:m,finisher(y){customElements.define(n,y)}}})(h,r);X();X();X();X();X();X();X();X();var Qs,oO=((Qs=window.HTMLSlotElement)===null||Qs===void 0?void 0:Qs.prototype.assignedElements)!=null?(h,r)=>h.assignedElements(r):(h,r)=>h.assignedNodes(r).filter(n=>n.nodeType===Node.ELEMENT_NODE);X();var wn=class extends Gt{render(){return Wi` <div>Hello from SuperViz, ${this.name}</div> `}};wn.properties={name:{type:String}},wn.styles=Mr`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,wn=Ei([zi("superviz-hello-world")],wn);X();X();var jc=Mr`
#mouse-container {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

#mouse-sync {
  position: absolute;
}

.mouse-board {
  background: transparent;
  position: absolute;
  top: 0;
  cursor: none !important;
}

.mouse-follower {
  position: absolute;
  display: block;
  transition: all 0.4s;
}

.pointer-mouse {
  display: flex;
  height: 17px;
  width: 17px;
  background-image: url(https://production.cdn.superviz.com/static/pointers/0.svg);
}

.mouse-user-name {
  display: block;
  position: absolute;  
  border-radius: 30px;
  padding: 2px 8px;
  font-weight: 700;
  font-size: 14px;
  font-family: 'Open Sans, sans-serif';
  line-height: 22px;
  margin-left: 10px;
  margin-top: -6px;
  background: yellow;
  white-space: nowrap;
}
`;var nr=class extends Gt{constructor(){super();this.updatePresenceMouseParticipant=n=>{if(!this.shadowRoot.getElementById(`mouse-${n.id}`)){let l=this.shadowRoot.getElementById("mouse-sync"),f=document.createElement("div");f.setAttribute("id",`mouse-${n.id}`),f.setAttribute("class","mouse-follower");let A=document.createElement("div");A.setAttribute("class","pointer-mouse");let S=document.createElement("div");S.setAttribute("class","mouse-user-name"),S.innerHTML=n.name,f.appendChild(A),f.appendChild(S),l&&l.appendChild(f)}let i=this.shadowRoot.getElementById(`mouse-${n.id}`);if(!i)return;let m=this.shadowRoot.getElementById(`mouse-${n.id}`),y=this.shadowRoot.getElementById(`mouse-${n.id}`);if(m&&y){let l=m.getElementsByClassName("mouse-user-name")[0],f=y.getElementsByClassName("pointer-mouse")[0];f&&(f.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${n.slotIndex}.svg)`),l&&(l.style.color=this.textColorValues.includes(n.slotIndex)?"#FFFFFF":"#000000",l.style.backgroundColor=n.color,l.innerHTML=n.name);let{containerId:A}=n,S=A?document.getElementById(A):document==null?void 0:document.body,R=n.mousePositionX,a=n.mousePositionY;if(A){let E=(S==null?void 0:S.clientWidth)||1,M=(S==null?void 0:S.clientHeight)||1;R=n.mousePositionX/n.originalWidth*E,a=n.mousePositionY/n.originalHeight*M}i.style.left=`${R}px`,i.style.top=`${a}px`}};this.textColorValues=[2,4,5,7,8,16]}removePresenceMouseParticipant(n){let s=this.shadowRoot.getElementById(`mouse-${n}`);s&&s.remove()}render(){return Wi`
      <div id="mouse-container" class="mouse-board">
        <div id="mouse-sync"></div>
      </div>
    `}};nr.styles=[jc],nr=Ei([zi("superviz-presence-mouse")],nr);X();X();function Vc(h){if(typeof document!="undefined"){let r=document.createElement("style");r.id="superviz-style";let n=document.createTextNode(h);r.appendChild(n),document.head.appendChild(r)}}var Kc=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}
`;Vc(Kc);X();X();X();window&&(window.SuperVizSdk={init:Ls,MeetingEvent:jn,DeviceEvent:ps,RealtimeEvent:On,MeetingState:Ri,MeetingConnectionStatus:Ar,MeetingControlsEvent:hs,ParticipantEvent:Ti,VideoComponent:Tr,PresenceMouseComponent:Ir});var WO=Ls;export{Er as BrowserService,ps as DeviceEvent,Ar as MeetingConnectionStatus,hs as MeetingControlsEvent,jn as MeetingEvent,Ri as MeetingState,Ti as ParticipantEvent,Es as ParticipantType,On as RealtimeEvent,WO as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
