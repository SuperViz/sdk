var T0=Object.create;var vr=Object.defineProperty,I0=Object.defineProperties,Sl=Object.getOwnPropertyDescriptor,_0=Object.getOwnPropertyDescriptors,P0=Object.getOwnPropertyNames,Cl=Object.getOwnPropertySymbols,w0=Object.getPrototypeOf,El=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable;var Ol=(h,r,n)=>r in h?vr(h,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[r]=n,gt=(h,r)=>{for(var n in r||(r={}))El.call(r,n)&&Ol(h,n,r[n]);if(Cl)for(var n of Cl(r))M0.call(r,n)&&Ol(h,n,r[n]);return h},Cn=(h,r)=>I0(h,_0(r));var ss=(h,r)=>()=>(h&&(r=h(h=0)),r);var Je=(h,r)=>()=>(r||h((r={exports:{}}).exports,r),r.exports),Rl=(h,r)=>{for(var n in r)vr(h,n,{get:r[n],enumerable:!0})},x0=(h,r,n,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of P0(r))!El.call(h,i)&&i!==n&&vr(h,i,{get:()=>r[i],enumerable:!(s=Sl(r,i))||s.enumerable});return h};var Jt=(h,r,n)=>(n=h!=null?T0(w0(h)):{},x0(r||!h||!h.__esModule?vr(n,"default",{value:h,enumerable:!0}):n,h));var Tl=(h,r,n,s)=>{for(var i=s>1?void 0:s?Sl(r,n):r,m=h.length-1,y;m>=0;m--)(y=h[m])&&(i=(s?y(r,n,i):y(i))||i);return s&&i&&vr(r,n,i),i};var Qe=(h,r,n)=>new Promise((s,i)=>{var m=f=>{try{c(n.next(f))}catch(C){i(C)}},y=f=>{try{c(n.throw(f))}catch(C){i(C)}},c=f=>f.done?s(f.value):Promise.resolve(f.value).then(m,y);c((n=n.apply(h,r)).next())});var ce,X=ss(()=>{ce={}});var Oi=Je((Vn,br)=>{X();(function(){var h,r="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",m="Invalid `variable` option passed into `_.template`",y="__lodash_hash_undefined__",c=500,f="__lodash_placeholder__",C=1,E=2,R=4,a=1,S=2,M=1,P=2,O=4,b=8,T=16,l=32,v=64,d=128,p=256,u=512,A=30,_="...",L=800,W=16,H=1,U=2,I=3,x=1/0,z=9007199254740991,k=17976931348623157e292,J=0/0,ee=4294967295,Q=ee-1,G=ee>>>1,D=[["ary",d],["bind",M],["bindKey",P],["curry",b],["curryRight",T],["flip",u],["partial",l],["partialRight",v],["rearg",p]],B="[object Arguments]",j="[object Array]",V="[object AsyncFunction]",te="[object Boolean]",le="[object Date]",me="[object DOMException]",ve="[object Error]",Se="[object Function]",Le="[object GeneratorFunction]",de="[object Map]",xe="[object Number]",et="[object Null]",Be="[object Object]",ke="[object Promise]",ct="[object Proxy]",Z="[object RegExp]",ie="[object Set]",ue="[object String]",pe="[object Symbol]",Re="[object Undefined]",qe="[object WeakMap]",fn="[object WeakSet]",er="[object ArrayBuffer]",Mn="[object DataView]",Fi="[object Float32Array]",Gi="[object Float64Array]",Hi="[object Int8Array]",ki="[object Int16Array]",Wi="[object Int32Array]",zi="[object Uint8Array]",$i="[object Uint8ClampedArray]",Vi="[object Uint16Array]",ji="[object Uint32Array]",jc=/\b__p \+= '';/g,Kc=/\b(__p \+=) '' \+/g,Jc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,js=/&(?:amp|lt|gt|quot|#39);/g,Ks=/[&<>"']/g,qc=RegExp(js.source),Qc=RegExp(Ks.source),Yc=/<%-([\s\S]+?)%>/g,Zc=/<%([\s\S]+?)%>/g,Js=/<%=([\s\S]+?)%>/g,Xc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ef=/^\w*$/,tf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ki=/[\\^$.*+?()[\]{}|]/g,nf=RegExp(Ki.source),Ji=/^\s+/,rf=/\s/,of=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,sf=/\{\n\/\* \[wrapped with (.+)\] \*/,af=/,? & /,uf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lf=/[()=,{}\[\]\/\s]/,cf=/\\(\\)?/g,ff=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qs=/\w*$/,df=/^[-+]0x[0-9a-f]+$/i,hf=/^0b[01]+$/i,pf=/^\[object .+?Constructor\]$/,gf=/^0o[0-7]+$/i,vf=/^(?:0|[1-9]\d*)$/,mf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xr=/($^)/,yf=/['\n\r\u2028\u2029\\]/g,Lr="\\ud800-\\udfff",bf="\\u0300-\\u036f",Af="\\ufe20-\\ufe2f",Cf="\\u20d0-\\u20ff",Qs=bf+Af+Cf,Ys="\\u2700-\\u27bf",Zs="a-z\\xdf-\\xf6\\xf8-\\xff",Of="\\xac\\xb1\\xd7\\xf7",Sf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ef="\\u2000-\\u206f",Rf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xs="A-Z\\xc0-\\xd6\\xd8-\\xde",ea="\\ufe0e\\ufe0f",ta=Of+Sf+Ef+Rf,qi="['\u2019]",Tf="["+Lr+"]",na="["+ta+"]",Nr="["+Qs+"]",ra="\\d+",If="["+Ys+"]",ia="["+Zs+"]",oa="[^"+Lr+ta+ra+Ys+Zs+Xs+"]",Qi="\\ud83c[\\udffb-\\udfff]",_f="(?:"+Nr+"|"+Qi+")",sa="[^"+Lr+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",Zi="[\\ud800-\\udbff][\\udc00-\\udfff]",xn="["+Xs+"]",aa="\\u200d",ua="(?:"+ia+"|"+oa+")",Pf="(?:"+xn+"|"+oa+")",la="(?:"+qi+"(?:d|ll|m|re|s|t|ve))?",ca="(?:"+qi+"(?:D|LL|M|RE|S|T|VE))?",fa=_f+"?",da="["+ea+"]?",wf="(?:"+aa+"(?:"+[sa,Yi,Zi].join("|")+")"+da+fa+")*",Mf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ha=da+fa+wf,Lf="(?:"+[If,Yi,Zi].join("|")+")"+ha,Nf="(?:"+[sa+Nr+"?",Nr,Yi,Zi,Tf].join("|")+")",Df=RegExp(qi,"g"),Uf=RegExp(Nr,"g"),Xi=RegExp(Qi+"(?="+Qi+")|"+Nf+ha,"g"),Bf=RegExp([xn+"?"+ia+"+"+la+"(?="+[na,xn,"$"].join("|")+")",Pf+"+"+ca+"(?="+[na,xn+ua,"$"].join("|")+")",xn+"?"+ua+"+"+la,xn+"+"+ca,xf,Mf,ra,Lf].join("|"),"g"),Ff=RegExp("["+aa+Lr+Qs+ea+"]"),Gf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Hf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],kf=-1,He={};He[Fi]=He[Gi]=He[Hi]=He[ki]=He[Wi]=He[zi]=He[$i]=He[Vi]=He[ji]=!0,He[B]=He[j]=He[er]=He[te]=He[Mn]=He[le]=He[ve]=He[Se]=He[de]=He[xe]=He[Be]=He[Z]=He[ie]=He[ue]=He[qe]=!1;var Ge={};Ge[B]=Ge[j]=Ge[er]=Ge[Mn]=Ge[te]=Ge[le]=Ge[Fi]=Ge[Gi]=Ge[Hi]=Ge[ki]=Ge[Wi]=Ge[de]=Ge[xe]=Ge[Be]=Ge[Z]=Ge[ie]=Ge[ue]=Ge[pe]=Ge[zi]=Ge[$i]=Ge[Vi]=Ge[ji]=!0,Ge[ve]=Ge[Se]=Ge[qe]=!1;var Wf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},zf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$f={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Vf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},jf=parseFloat,Kf=parseInt,pa=typeof global=="object"&&global&&global.Object===Object&&global,Jf=typeof self=="object"&&self&&self.Object===Object&&self,tt=pa||Jf||Function("return this")(),eo=typeof Vn=="object"&&Vn&&!Vn.nodeType&&Vn,dn=eo&&typeof br=="object"&&br&&!br.nodeType&&br,ga=dn&&dn.exports===eo,to=ga&&pa.process,St=function(){try{var q=dn&&dn.require&&dn.require("util").types;return q||to&&to.binding&&to.binding("util")}catch(re){}}(),va=St&&St.isArrayBuffer,ma=St&&St.isDate,ya=St&&St.isMap,ba=St&&St.isRegExp,Aa=St&&St.isSet,Ca=St&&St.isTypedArray;function vt(q,re,ne){switch(ne.length){case 0:return q.call(re);case 1:return q.call(re,ne[0]);case 2:return q.call(re,ne[0],ne[1]);case 3:return q.call(re,ne[0],ne[1],ne[2])}return q.apply(re,ne)}function qf(q,re,ne,he){for(var Ce=-1,Ne=q==null?0:q.length;++Ce<Ne;){var Ye=q[Ce];re(he,Ye,ne(Ye),q)}return he}function Et(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he&&re(q[ne],ne,q)!==!1;);return q}function Qf(q,re){for(var ne=q==null?0:q.length;ne--&&re(q[ne],ne,q)!==!1;);return q}function Oa(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he;)if(!re(q[ne],ne,q))return!1;return!0}function Yt(q,re){for(var ne=-1,he=q==null?0:q.length,Ce=0,Ne=[];++ne<he;){var Ye=q[ne];re(Ye,ne,q)&&(Ne[Ce++]=Ye)}return Ne}function Dr(q,re){var ne=q==null?0:q.length;return!!ne&&Ln(q,re,0)>-1}function no(q,re,ne){for(var he=-1,Ce=q==null?0:q.length;++he<Ce;)if(ne(re,q[he]))return!0;return!1}function We(q,re){for(var ne=-1,he=q==null?0:q.length,Ce=Array(he);++ne<he;)Ce[ne]=re(q[ne],ne,q);return Ce}function Zt(q,re){for(var ne=-1,he=re.length,Ce=q.length;++ne<he;)q[Ce+ne]=re[ne];return q}function ro(q,re,ne,he){var Ce=-1,Ne=q==null?0:q.length;for(he&&Ne&&(ne=q[++Ce]);++Ce<Ne;)ne=re(ne,q[Ce],Ce,q);return ne}function Yf(q,re,ne,he){var Ce=q==null?0:q.length;for(he&&Ce&&(ne=q[--Ce]);Ce--;)ne=re(ne,q[Ce],Ce,q);return ne}function io(q,re){for(var ne=-1,he=q==null?0:q.length;++ne<he;)if(re(q[ne],ne,q))return!0;return!1}var Zf=oo("length");function Xf(q){return q.split("")}function ed(q){return q.match(uf)||[]}function Sa(q,re,ne){var he;return ne(q,function(Ce,Ne,Ye){if(re(Ce,Ne,Ye))return he=Ne,!1}),he}function Ur(q,re,ne,he){for(var Ce=q.length,Ne=ne+(he?1:-1);he?Ne--:++Ne<Ce;)if(re(q[Ne],Ne,q))return Ne;return-1}function Ln(q,re,ne){return re===re?dd(q,re,ne):Ur(q,Ea,ne)}function td(q,re,ne,he){for(var Ce=ne-1,Ne=q.length;++Ce<Ne;)if(he(q[Ce],re))return Ce;return-1}function Ea(q){return q!==q}function Ra(q,re){var ne=q==null?0:q.length;return ne?ao(q,re)/ne:J}function oo(q){return function(re){return re==null?h:re[q]}}function so(q){return function(re){return q==null?h:q[re]}}function Ta(q,re,ne,he,Ce){return Ce(q,function(Ne,Ye,Fe){ne=he?(he=!1,Ne):re(ne,Ne,Ye,Fe)}),ne}function nd(q,re){var ne=q.length;for(q.sort(re);ne--;)q[ne]=q[ne].value;return q}function ao(q,re){for(var ne,he=-1,Ce=q.length;++he<Ce;){var Ne=re(q[he]);Ne!==h&&(ne=ne===h?Ne:ne+Ne)}return ne}function uo(q,re){for(var ne=-1,he=Array(q);++ne<q;)he[ne]=re(ne);return he}function rd(q,re){return We(re,function(ne){return[ne,q[ne]]})}function Ia(q){return q&&q.slice(0,Ma(q)+1).replace(Ji,"")}function mt(q){return function(re){return q(re)}}function lo(q,re){return We(re,function(ne){return q[ne]})}function tr(q,re){return q.has(re)}function _a(q,re){for(var ne=-1,he=q.length;++ne<he&&Ln(re,q[ne],0)>-1;);return ne}function Pa(q,re){for(var ne=q.length;ne--&&Ln(re,q[ne],0)>-1;);return ne}function id(q,re){for(var ne=q.length,he=0;ne--;)q[ne]===re&&++he;return he}var od=so(Wf),sd=so(zf);function ad(q){return"\\"+Vf[q]}function ud(q,re){return q==null?h:q[re]}function Nn(q){return Ff.test(q)}function ld(q){return Gf.test(q)}function cd(q){for(var re,ne=[];!(re=q.next()).done;)ne.push(re.value);return ne}function co(q){var re=-1,ne=Array(q.size);return q.forEach(function(he,Ce){ne[++re]=[Ce,he]}),ne}function wa(q,re){return function(ne){return q(re(ne))}}function Xt(q,re){for(var ne=-1,he=q.length,Ce=0,Ne=[];++ne<he;){var Ye=q[ne];(Ye===re||Ye===f)&&(q[ne]=f,Ne[Ce++]=ne)}return Ne}function Br(q){var re=-1,ne=Array(q.size);return q.forEach(function(he){ne[++re]=he}),ne}function fd(q){var re=-1,ne=Array(q.size);return q.forEach(function(he){ne[++re]=[he,he]}),ne}function dd(q,re,ne){for(var he=ne-1,Ce=q.length;++he<Ce;)if(q[he]===re)return he;return-1}function hd(q,re,ne){for(var he=ne+1;he--;)if(q[he]===re)return he;return he}function Dn(q){return Nn(q)?gd(q):Zf(q)}function Mt(q){return Nn(q)?vd(q):Xf(q)}function Ma(q){for(var re=q.length;re--&&rf.test(q.charAt(re)););return re}var pd=so($f);function gd(q){for(var re=Xi.lastIndex=0;Xi.test(q);)++re;return re}function vd(q){return q.match(Xi)||[]}function md(q){return q.match(Bf)||[]}var yd=function q(re){re=re==null?tt:en.defaults(tt.Object(),re,en.pick(tt,Hf));var ne=re.Array,he=re.Date,Ce=re.Error,Ne=re.Function,Ye=re.Math,Fe=re.Object,fo=re.RegExp,bd=re.String,Rt=re.TypeError,Fr=ne.prototype,Ad=Ne.prototype,Un=Fe.prototype,Gr=re["__core-js_shared__"],Hr=Ad.toString,Ue=Un.hasOwnProperty,Cd=0,xa=function(){var e=/[^.]+$/.exec(Gr&&Gr.keys&&Gr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),kr=Un.toString,Od=Hr.call(Fe),Sd=tt._,Ed=fo("^"+Hr.call(Ue).replace(Ki,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wr=ga?re.Buffer:h,tn=re.Symbol,zr=re.Uint8Array,La=Wr?Wr.allocUnsafe:h,$r=wa(Fe.getPrototypeOf,Fe),Na=Fe.create,Da=Un.propertyIsEnumerable,Vr=Fr.splice,Ua=tn?tn.isConcatSpreadable:h,nr=tn?tn.iterator:h,hn=tn?tn.toStringTag:h,jr=function(){try{var e=yn(Fe,"defineProperty");return e({},"",{}),e}catch(t){}}(),Rd=re.clearTimeout!==tt.clearTimeout&&re.clearTimeout,Td=he&&he.now!==tt.Date.now&&he.now,Id=re.setTimeout!==tt.setTimeout&&re.setTimeout,Kr=Ye.ceil,Jr=Ye.floor,ho=Fe.getOwnPropertySymbols,_d=Wr?Wr.isBuffer:h,Ba=re.isFinite,Pd=Fr.join,wd=wa(Fe.keys,Fe),Ze=Ye.max,ot=Ye.min,Md=he.now,xd=re.parseInt,Fa=Ye.random,Ld=Fr.reverse,po=yn(re,"DataView"),rr=yn(re,"Map"),go=yn(re,"Promise"),Bn=yn(re,"Set"),ir=yn(re,"WeakMap"),or=yn(Fe,"create"),qr=ir&&new ir,Fn={},Nd=bn(po),Dd=bn(rr),Ud=bn(go),Bd=bn(Bn),Fd=bn(ir),Qr=tn?tn.prototype:h,sr=Qr?Qr.valueOf:h,Ga=Qr?Qr.toString:h;function N(e){if(Ve(e)&&!Oe(e)&&!(e instanceof we)){if(e instanceof Tt)return e;if(Ue.call(e,"__wrapped__"))return Hu(e)}return new Tt(e)}var Gn=function(){function e(){}return function(t){if(!ze(t))return{};if(Na)return Na(t);e.prototype=t;var o=new e;return e.prototype=h,o}}();function Yr(){}function Tt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=h}N.templateSettings={escape:Yc,evaluate:Zc,interpolate:Js,variable:"",imports:{_:N}},N.prototype=Yr.prototype,N.prototype.constructor=N,Tt.prototype=Gn(Yr.prototype),Tt.prototype.constructor=Tt;function we(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ee,this.__views__=[]}function Gd(){var e=new we(this.__wrapped__);return e.__actions__=ft(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ft(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ft(this.__views__),e}function Hd(){if(this.__filtered__){var e=new we(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function kd(){var e=this.__wrapped__.value(),t=this.__dir__,o=Oe(e),g=t<0,w=o?e.length:0,F=Xh(0,w,this.__views__),$=F.start,K=F.end,Y=K-$,oe=g?K:$-1,se=this.__iteratees__,ae=se.length,fe=0,ge=ot(Y,this.__takeCount__);if(!o||!g&&w==Y&&ge==Y)return lu(e,this.__actions__);var be=[];e:for(;Y--&&fe<ge;){oe+=t;for(var Te=-1,Ae=e[oe];++Te<ae;){var Pe=se[Te],Me=Pe.iteratee,At=Pe.type,lt=Me(Ae);if(At==U)Ae=lt;else if(!lt){if(At==H)continue e;break e}}be[fe++]=Ae}return be}we.prototype=Gn(Yr.prototype),we.prototype.constructor=we;function pn(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var g=e[t];this.set(g[0],g[1])}}function Wd(){this.__data__=or?or(null):{},this.size=0}function zd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function $d(e){var t=this.__data__;if(or){var o=t[e];return o===y?h:o}return Ue.call(t,e)?t[e]:h}function Vd(e){var t=this.__data__;return or?t[e]!==h:Ue.call(t,e)}function jd(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=or&&t===h?y:t,this}pn.prototype.clear=Wd,pn.prototype.delete=zd,pn.prototype.get=$d,pn.prototype.has=Vd,pn.prototype.set=jd;function Gt(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var g=e[t];this.set(g[0],g[1])}}function Kd(){this.__data__=[],this.size=0}function Jd(e){var t=this.__data__,o=Zr(t,e);if(o<0)return!1;var g=t.length-1;return o==g?t.pop():Vr.call(t,o,1),--this.size,!0}function qd(e){var t=this.__data__,o=Zr(t,e);return o<0?h:t[o][1]}function Qd(e){return Zr(this.__data__,e)>-1}function Yd(e,t){var o=this.__data__,g=Zr(o,e);return g<0?(++this.size,o.push([e,t])):o[g][1]=t,this}Gt.prototype.clear=Kd,Gt.prototype.delete=Jd,Gt.prototype.get=qd,Gt.prototype.has=Qd,Gt.prototype.set=Yd;function Ht(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var g=e[t];this.set(g[0],g[1])}}function Zd(){this.size=0,this.__data__={hash:new pn,map:new(rr||Gt),string:new pn}}function Xd(e){var t=ci(this,e).delete(e);return this.size-=t?1:0,t}function eh(e){return ci(this,e).get(e)}function th(e){return ci(this,e).has(e)}function nh(e,t){var o=ci(this,e),g=o.size;return o.set(e,t),this.size+=o.size==g?0:1,this}Ht.prototype.clear=Zd,Ht.prototype.delete=Xd,Ht.prototype.get=eh,Ht.prototype.has=th,Ht.prototype.set=nh;function gn(e){var t=-1,o=e==null?0:e.length;for(this.__data__=new Ht;++t<o;)this.add(e[t])}function rh(e){return this.__data__.set(e,y),this}function ih(e){return this.__data__.has(e)}gn.prototype.add=gn.prototype.push=rh,gn.prototype.has=ih;function xt(e){var t=this.__data__=new Gt(e);this.size=t.size}function oh(){this.__data__=new Gt,this.size=0}function sh(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o}function ah(e){return this.__data__.get(e)}function uh(e){return this.__data__.has(e)}function lh(e,t){var o=this.__data__;if(o instanceof Gt){var g=o.__data__;if(!rr||g.length<n-1)return g.push([e,t]),this.size=++o.size,this;o=this.__data__=new Ht(g)}return o.set(e,t),this.size=o.size,this}xt.prototype.clear=oh,xt.prototype.delete=sh,xt.prototype.get=ah,xt.prototype.has=uh,xt.prototype.set=lh;function Ha(e,t){var o=Oe(e),g=!o&&An(e),w=!o&&!g&&an(e),F=!o&&!g&&!w&&zn(e),$=o||g||w||F,K=$?uo(e.length,bd):[],Y=K.length;for(var oe in e)(t||Ue.call(e,oe))&&!($&&(oe=="length"||w&&(oe=="offset"||oe=="parent")||F&&(oe=="buffer"||oe=="byteLength"||oe=="byteOffset")||$t(oe,Y)))&&K.push(oe);return K}function ka(e){var t=e.length;return t?e[To(0,t-1)]:h}function ch(e,t){return fi(ft(e),vn(t,0,e.length))}function fh(e){return fi(ft(e))}function vo(e,t,o){(o!==h&&!Lt(e[t],o)||o===h&&!(t in e))&&kt(e,t,o)}function ar(e,t,o){var g=e[t];(!(Ue.call(e,t)&&Lt(g,o))||o===h&&!(t in e))&&kt(e,t,o)}function Zr(e,t){for(var o=e.length;o--;)if(Lt(e[o][0],t))return o;return-1}function dh(e,t,o,g){return nn(e,function(w,F,$){t(g,w,o(w),$)}),g}function Wa(e,t){return e&&Ut(t,nt(t),e)}function hh(e,t){return e&&Ut(t,ht(t),e)}function kt(e,t,o){t=="__proto__"&&jr?jr(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o}function mo(e,t){for(var o=-1,g=t.length,w=ne(g),F=e==null;++o<g;)w[o]=F?h:Yo(e,t[o]);return w}function vn(e,t,o){return e===e&&(o!==h&&(e=e<=o?e:o),t!==h&&(e=e>=t?e:t)),e}function It(e,t,o,g,w,F){var $,K=t&C,Y=t&E,oe=t&R;if(o&&($=w?o(e,g,w,F):o(e)),$!==h)return $;if(!ze(e))return e;var se=Oe(e);if(se){if($=tp(e),!K)return ft(e,$)}else{var ae=st(e),fe=ae==Se||ae==Le;if(an(e))return du(e,K);if(ae==Be||ae==B||fe&&!w){if($=Y||fe?{}:Mu(e),!K)return Y?$h(e,hh($,e)):zh(e,Wa($,e))}else{if(!Ge[ae])return w?e:{};$=np(e,ae,K)}}F||(F=new xt);var ge=F.get(e);if(ge)return ge;F.set(e,$),sl(e)?e.forEach(function(Ae){$.add(It(Ae,t,o,Ae,e,F))}):il(e)&&e.forEach(function(Ae,Pe){$.set(Pe,It(Ae,t,o,Pe,e,F))});var be=oe?Y?Bo:Uo:Y?ht:nt,Te=se?h:be(e);return Et(Te||e,function(Ae,Pe){Te&&(Pe=Ae,Ae=e[Pe]),ar($,Pe,It(Ae,t,o,Pe,e,F))}),$}function ph(e){var t=nt(e);return function(o){return za(o,e,t)}}function za(e,t,o){var g=o.length;if(e==null)return!g;for(e=Fe(e);g--;){var w=o[g],F=t[w],$=e[w];if($===h&&!(w in e)||!F($))return!1}return!0}function $a(e,t,o){if(typeof e!="function")throw new Rt(i);return pr(function(){e.apply(h,o)},t)}function ur(e,t,o,g){var w=-1,F=Dr,$=!0,K=e.length,Y=[],oe=t.length;if(!K)return Y;o&&(t=We(t,mt(o))),g?(F=no,$=!1):t.length>=n&&(F=tr,$=!1,t=new gn(t));e:for(;++w<K;){var se=e[w],ae=o==null?se:o(se);if(se=g||se!==0?se:0,$&&ae===ae){for(var fe=oe;fe--;)if(t[fe]===ae)continue e;Y.push(se)}else F(t,ae,g)||Y.push(se)}return Y}var nn=mu(Dt),Va=mu(bo,!0);function gh(e,t){var o=!0;return nn(e,function(g,w,F){return o=!!t(g,w,F),o}),o}function Xr(e,t,o){for(var g=-1,w=e.length;++g<w;){var F=e[g],$=t(F);if($!=null&&(K===h?$===$&&!bt($):o($,K)))var K=$,Y=F}return Y}function vh(e,t,o,g){var w=e.length;for(o=Ee(o),o<0&&(o=-o>w?0:w+o),g=g===h||g>w?w:Ee(g),g<0&&(g+=w),g=o>g?0:ul(g);o<g;)e[o++]=t;return e}function ja(e,t){var o=[];return nn(e,function(g,w,F){t(g,w,F)&&o.push(g)}),o}function it(e,t,o,g,w){var F=-1,$=e.length;for(o||(o=ip),w||(w=[]);++F<$;){var K=e[F];t>0&&o(K)?t>1?it(K,t-1,o,g,w):Zt(w,K):g||(w[w.length]=K)}return w}var yo=yu(),Ka=yu(!0);function Dt(e,t){return e&&yo(e,t,nt)}function bo(e,t){return e&&Ka(e,t,nt)}function ei(e,t){return Yt(t,function(o){return Vt(e[o])})}function mn(e,t){t=on(t,e);for(var o=0,g=t.length;e!=null&&o<g;)e=e[Bt(t[o++])];return o&&o==g?e:h}function Ja(e,t,o){var g=t(e);return Oe(e)?g:Zt(g,o(e))}function at(e){return e==null?e===h?Re:et:hn&&hn in Fe(e)?Zh(e):fp(e)}function Ao(e,t){return e>t}function mh(e,t){return e!=null&&Ue.call(e,t)}function yh(e,t){return e!=null&&t in Fe(e)}function bh(e,t,o){return e>=ot(t,o)&&e<Ze(t,o)}function Co(e,t,o){for(var g=o?no:Dr,w=e[0].length,F=e.length,$=F,K=ne(F),Y=1/0,oe=[];$--;){var se=e[$];$&&t&&(se=We(se,mt(t))),Y=ot(se.length,Y),K[$]=!o&&(t||w>=120&&se.length>=120)?new gn($&&se):h}se=e[0];var ae=-1,fe=K[0];e:for(;++ae<w&&oe.length<Y;){var ge=se[ae],be=t?t(ge):ge;if(ge=o||ge!==0?ge:0,!(fe?tr(fe,be):g(oe,be,o))){for($=F;--$;){var Te=K[$];if(!(Te?tr(Te,be):g(e[$],be,o)))continue e}fe&&fe.push(be),oe.push(ge)}}return oe}function Ah(e,t,o,g){return Dt(e,function(w,F,$){t(g,o(w),F,$)}),g}function lr(e,t,o){t=on(t,e),e=Du(e,t);var g=e==null?e:e[Bt(Pt(t))];return g==null?h:vt(g,e,o)}function qa(e){return Ve(e)&&at(e)==B}function Ch(e){return Ve(e)&&at(e)==er}function Oh(e){return Ve(e)&&at(e)==le}function cr(e,t,o,g,w){return e===t?!0:e==null||t==null||!Ve(e)&&!Ve(t)?e!==e&&t!==t:Sh(e,t,o,g,cr,w)}function Sh(e,t,o,g,w,F){var $=Oe(e),K=Oe(t),Y=$?j:st(e),oe=K?j:st(t);Y=Y==B?Be:Y,oe=oe==B?Be:oe;var se=Y==Be,ae=oe==Be,fe=Y==oe;if(fe&&an(e)){if(!an(t))return!1;$=!0,se=!1}if(fe&&!se)return F||(F=new xt),$||zn(e)?_u(e,t,o,g,w,F):Qh(e,t,Y,o,g,w,F);if(!(o&a)){var ge=se&&Ue.call(e,"__wrapped__"),be=ae&&Ue.call(t,"__wrapped__");if(ge||be){var Te=ge?e.value():e,Ae=be?t.value():t;return F||(F=new xt),w(Te,Ae,o,g,F)}}return fe?(F||(F=new xt),Yh(e,t,o,g,w,F)):!1}function Eh(e){return Ve(e)&&st(e)==de}function Oo(e,t,o,g){var w=o.length,F=w,$=!g;if(e==null)return!F;for(e=Fe(e);w--;){var K=o[w];if($&&K[2]?K[1]!==e[K[0]]:!(K[0]in e))return!1}for(;++w<F;){K=o[w];var Y=K[0],oe=e[Y],se=K[1];if($&&K[2]){if(oe===h&&!(Y in e))return!1}else{var ae=new xt;if(g)var fe=g(oe,se,Y,e,t,ae);if(!(fe===h?cr(se,oe,a|S,g,ae):fe))return!1}}return!0}function Qa(e){if(!ze(e)||sp(e))return!1;var t=Vt(e)?Ed:pf;return t.test(bn(e))}function Rh(e){return Ve(e)&&at(e)==Z}function Th(e){return Ve(e)&&st(e)==ie}function Ih(e){return Ve(e)&&mi(e.length)&&!!He[at(e)]}function Ya(e){return typeof e=="function"?e:e==null?pt:typeof e=="object"?Oe(e)?eu(e[0],e[1]):Xa(e):bl(e)}function So(e){if(!hr(e))return wd(e);var t=[];for(var o in Fe(e))Ue.call(e,o)&&o!="constructor"&&t.push(o);return t}function _h(e){if(!ze(e))return cp(e);var t=hr(e),o=[];for(var g in e)g=="constructor"&&(t||!Ue.call(e,g))||o.push(g);return o}function Eo(e,t){return e<t}function Za(e,t){var o=-1,g=dt(e)?ne(e.length):[];return nn(e,function(w,F,$){g[++o]=t(w,F,$)}),g}function Xa(e){var t=Go(e);return t.length==1&&t[0][2]?Lu(t[0][0],t[0][1]):function(o){return o===e||Oo(o,e,t)}}function eu(e,t){return ko(e)&&xu(t)?Lu(Bt(e),t):function(o){var g=Yo(o,e);return g===h&&g===t?Zo(o,e):cr(t,g,a|S)}}function ti(e,t,o,g,w){e!==t&&yo(t,function(F,$){if(w||(w=new xt),ze(F))Ph(e,t,$,o,ti,g,w);else{var K=g?g(zo(e,$),F,$+"",e,t,w):h;K===h&&(K=F),vo(e,$,K)}},ht)}function Ph(e,t,o,g,w,F,$){var K=zo(e,o),Y=zo(t,o),oe=$.get(Y);if(oe){vo(e,o,oe);return}var se=F?F(K,Y,o+"",e,t,$):h,ae=se===h;if(ae){var fe=Oe(Y),ge=!fe&&an(Y),be=!fe&&!ge&&zn(Y);se=Y,fe||ge||be?Oe(K)?se=K:je(K)?se=ft(K):ge?(ae=!1,se=du(Y,!0)):be?(ae=!1,se=hu(Y,!0)):se=[]:gr(Y)||An(Y)?(se=K,An(K)?se=ll(K):(!ze(K)||Vt(K))&&(se=Mu(Y))):ae=!1}ae&&($.set(Y,se),w(se,Y,g,F,$),$.delete(Y)),vo(e,o,se)}function tu(e,t){var o=e.length;if(!!o)return t+=t<0?o:0,$t(t,o)?e[t]:h}function nu(e,t,o){t.length?t=We(t,function(F){return Oe(F)?function($){return mn($,F.length===1?F[0]:F)}:F}):t=[pt];var g=-1;t=We(t,mt(ye()));var w=Za(e,function(F,$,K){var Y=We(t,function(oe){return oe(F)});return{criteria:Y,index:++g,value:F}});return nd(w,function(F,$){return Wh(F,$,o)})}function wh(e,t){return ru(e,t,function(o,g){return Zo(e,g)})}function ru(e,t,o){for(var g=-1,w=t.length,F={};++g<w;){var $=t[g],K=mn(e,$);o(K,$)&&fr(F,on($,e),K)}return F}function Mh(e){return function(t){return mn(t,e)}}function Ro(e,t,o,g){var w=g?td:Ln,F=-1,$=t.length,K=e;for(e===t&&(t=ft(t)),o&&(K=We(e,mt(o)));++F<$;)for(var Y=0,oe=t[F],se=o?o(oe):oe;(Y=w(K,se,Y,g))>-1;)K!==e&&Vr.call(K,Y,1),Vr.call(e,Y,1);return e}function iu(e,t){for(var o=e?t.length:0,g=o-1;o--;){var w=t[o];if(o==g||w!==F){var F=w;$t(w)?Vr.call(e,w,1):Po(e,w)}}return e}function To(e,t){return e+Jr(Fa()*(t-e+1))}function xh(e,t,o,g){for(var w=-1,F=Ze(Kr((t-e)/(o||1)),0),$=ne(F);F--;)$[g?F:++w]=e,e+=o;return $}function Io(e,t){var o="";if(!e||t<1||t>z)return o;do t%2&&(o+=e),t=Jr(t/2),t&&(e+=e);while(t);return o}function Ie(e,t){return $o(Nu(e,t,pt),e+"")}function Lh(e){return ka($n(e))}function Nh(e,t){var o=$n(e);return fi(o,vn(t,0,o.length))}function fr(e,t,o,g){if(!ze(e))return e;t=on(t,e);for(var w=-1,F=t.length,$=F-1,K=e;K!=null&&++w<F;){var Y=Bt(t[w]),oe=o;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return e;if(w!=$){var se=K[Y];oe=g?g(se,Y,K):h,oe===h&&(oe=ze(se)?se:$t(t[w+1])?[]:{})}ar(K,Y,oe),K=K[Y]}return e}var ou=qr?function(e,t){return qr.set(e,t),e}:pt,Dh=jr?function(e,t){return jr(e,"toString",{configurable:!0,enumerable:!1,value:es(t),writable:!0})}:pt;function Uh(e){return fi($n(e))}function _t(e,t,o){var g=-1,w=e.length;t<0&&(t=-t>w?0:w+t),o=o>w?w:o,o<0&&(o+=w),w=t>o?0:o-t>>>0,t>>>=0;for(var F=ne(w);++g<w;)F[g]=e[g+t];return F}function Bh(e,t){var o;return nn(e,function(g,w,F){return o=t(g,w,F),!o}),!!o}function ni(e,t,o){var g=0,w=e==null?g:e.length;if(typeof t=="number"&&t===t&&w<=G){for(;g<w;){var F=g+w>>>1,$=e[F];$!==null&&!bt($)&&(o?$<=t:$<t)?g=F+1:w=F}return w}return _o(e,t,pt,o)}function _o(e,t,o,g){var w=0,F=e==null?0:e.length;if(F===0)return 0;t=o(t);for(var $=t!==t,K=t===null,Y=bt(t),oe=t===h;w<F;){var se=Jr((w+F)/2),ae=o(e[se]),fe=ae!==h,ge=ae===null,be=ae===ae,Te=bt(ae);if($)var Ae=g||be;else oe?Ae=be&&(g||fe):K?Ae=be&&fe&&(g||!ge):Y?Ae=be&&fe&&!ge&&(g||!Te):ge||Te?Ae=!1:Ae=g?ae<=t:ae<t;Ae?w=se+1:F=se}return ot(F,Q)}function su(e,t){for(var o=-1,g=e.length,w=0,F=[];++o<g;){var $=e[o],K=t?t($):$;if(!o||!Lt(K,Y)){var Y=K;F[w++]=$===0?0:$}}return F}function au(e){return typeof e=="number"?e:bt(e)?J:+e}function yt(e){if(typeof e=="string")return e;if(Oe(e))return We(e,yt)+"";if(bt(e))return Ga?Ga.call(e):"";var t=e+"";return t=="0"&&1/e==-x?"-0":t}function rn(e,t,o){var g=-1,w=Dr,F=e.length,$=!0,K=[],Y=K;if(o)$=!1,w=no;else if(F>=n){var oe=t?null:Jh(e);if(oe)return Br(oe);$=!1,w=tr,Y=new gn}else Y=t?[]:K;e:for(;++g<F;){var se=e[g],ae=t?t(se):se;if(se=o||se!==0?se:0,$&&ae===ae){for(var fe=Y.length;fe--;)if(Y[fe]===ae)continue e;t&&Y.push(ae),K.push(se)}else w(Y,ae,o)||(Y!==K&&Y.push(ae),K.push(se))}return K}function Po(e,t){return t=on(t,e),e=Du(e,t),e==null||delete e[Bt(Pt(t))]}function uu(e,t,o,g){return fr(e,t,o(mn(e,t)),g)}function ri(e,t,o,g){for(var w=e.length,F=g?w:-1;(g?F--:++F<w)&&t(e[F],F,e););return o?_t(e,g?0:F,g?F+1:w):_t(e,g?F+1:0,g?w:F)}function lu(e,t){var o=e;return o instanceof we&&(o=o.value()),ro(t,function(g,w){return w.func.apply(w.thisArg,Zt([g],w.args))},o)}function wo(e,t,o){var g=e.length;if(g<2)return g?rn(e[0]):[];for(var w=-1,F=ne(g);++w<g;)for(var $=e[w],K=-1;++K<g;)K!=w&&(F[w]=ur(F[w]||$,e[K],t,o));return rn(it(F,1),t,o)}function cu(e,t,o){for(var g=-1,w=e.length,F=t.length,$={};++g<w;){var K=g<F?t[g]:h;o($,e[g],K)}return $}function Mo(e){return je(e)?e:[]}function xo(e){return typeof e=="function"?e:pt}function on(e,t){return Oe(e)?e:ko(e,t)?[e]:Gu(De(e))}var Fh=Ie;function sn(e,t,o){var g=e.length;return o=o===h?g:o,!t&&o>=g?e:_t(e,t,o)}var fu=Rd||function(e){return tt.clearTimeout(e)};function du(e,t){if(t)return e.slice();var o=e.length,g=La?La(o):new e.constructor(o);return e.copy(g),g}function Lo(e){var t=new e.constructor(e.byteLength);return new zr(t).set(new zr(e)),t}function Gh(e,t){var o=t?Lo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Hh(e){var t=new e.constructor(e.source,qs.exec(e));return t.lastIndex=e.lastIndex,t}function kh(e){return sr?Fe(sr.call(e)):{}}function hu(e,t){var o=t?Lo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function pu(e,t){if(e!==t){var o=e!==h,g=e===null,w=e===e,F=bt(e),$=t!==h,K=t===null,Y=t===t,oe=bt(t);if(!K&&!oe&&!F&&e>t||F&&$&&Y&&!K&&!oe||g&&$&&Y||!o&&Y||!w)return 1;if(!g&&!F&&!oe&&e<t||oe&&o&&w&&!g&&!F||K&&o&&w||!$&&w||!Y)return-1}return 0}function Wh(e,t,o){for(var g=-1,w=e.criteria,F=t.criteria,$=w.length,K=o.length;++g<$;){var Y=pu(w[g],F[g]);if(Y){if(g>=K)return Y;var oe=o[g];return Y*(oe=="desc"?-1:1)}}return e.index-t.index}function gu(e,t,o,g){for(var w=-1,F=e.length,$=o.length,K=-1,Y=t.length,oe=Ze(F-$,0),se=ne(Y+oe),ae=!g;++K<Y;)se[K]=t[K];for(;++w<$;)(ae||w<F)&&(se[o[w]]=e[w]);for(;oe--;)se[K++]=e[w++];return se}function vu(e,t,o,g){for(var w=-1,F=e.length,$=-1,K=o.length,Y=-1,oe=t.length,se=Ze(F-K,0),ae=ne(se+oe),fe=!g;++w<se;)ae[w]=e[w];for(var ge=w;++Y<oe;)ae[ge+Y]=t[Y];for(;++$<K;)(fe||w<F)&&(ae[ge+o[$]]=e[w++]);return ae}function ft(e,t){var o=-1,g=e.length;for(t||(t=ne(g));++o<g;)t[o]=e[o];return t}function Ut(e,t,o,g){var w=!o;o||(o={});for(var F=-1,$=t.length;++F<$;){var K=t[F],Y=g?g(o[K],e[K],K,o,e):h;Y===h&&(Y=e[K]),w?kt(o,K,Y):ar(o,K,Y)}return o}function zh(e,t){return Ut(e,Ho(e),t)}function $h(e,t){return Ut(e,Pu(e),t)}function ii(e,t){return function(o,g){var w=Oe(o)?qf:dh,F=t?t():{};return w(o,e,ye(g,2),F)}}function Hn(e){return Ie(function(t,o){var g=-1,w=o.length,F=w>1?o[w-1]:h,$=w>2?o[2]:h;for(F=e.length>3&&typeof F=="function"?(w--,F):h,$&&ut(o[0],o[1],$)&&(F=w<3?h:F,w=1),t=Fe(t);++g<w;){var K=o[g];K&&e(t,K,g,F)}return t})}function mu(e,t){return function(o,g){if(o==null)return o;if(!dt(o))return e(o,g);for(var w=o.length,F=t?w:-1,$=Fe(o);(t?F--:++F<w)&&g($[F],F,$)!==!1;);return o}}function yu(e){return function(t,o,g){for(var w=-1,F=Fe(t),$=g(t),K=$.length;K--;){var Y=$[e?K:++w];if(o(F[Y],Y,F)===!1)break}return t}}function Vh(e,t,o){var g=t&M,w=dr(e);function F(){var $=this&&this!==tt&&this instanceof F?w:e;return $.apply(g?o:this,arguments)}return F}function bu(e){return function(t){t=De(t);var o=Nn(t)?Mt(t):h,g=o?o[0]:t.charAt(0),w=o?sn(o,1).join(""):t.slice(1);return g[e]()+w}}function kn(e){return function(t){return ro(ml(vl(t).replace(Df,"")),e,"")}}function dr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var o=Gn(e.prototype),g=e.apply(o,t);return ze(g)?g:o}}function jh(e,t,o){var g=dr(e);function w(){for(var F=arguments.length,$=ne(F),K=F,Y=Wn(w);K--;)$[K]=arguments[K];var oe=F<3&&$[0]!==Y&&$[F-1]!==Y?[]:Xt($,Y);if(F-=oe.length,F<o)return Eu(e,t,oi,w.placeholder,h,$,oe,h,h,o-F);var se=this&&this!==tt&&this instanceof w?g:e;return vt(se,this,$)}return w}function Au(e){return function(t,o,g){var w=Fe(t);if(!dt(t)){var F=ye(o,3);t=nt(t),o=function(K){return F(w[K],K,w)}}var $=e(t,o,g);return $>-1?w[F?t[$]:$]:h}}function Cu(e){return zt(function(t){var o=t.length,g=o,w=Tt.prototype.thru;for(e&&t.reverse();g--;){var F=t[g];if(typeof F!="function")throw new Rt(i);if(w&&!$&&li(F)=="wrapper")var $=new Tt([],!0)}for(g=$?g:o;++g<o;){F=t[g];var K=li(F),Y=K=="wrapper"?Fo(F):h;Y&&Wo(Y[0])&&Y[1]==(d|b|l|p)&&!Y[4].length&&Y[9]==1?$=$[li(Y[0])].apply($,Y[3]):$=F.length==1&&Wo(F)?$[K]():$.thru(F)}return function(){var oe=arguments,se=oe[0];if($&&oe.length==1&&Oe(se))return $.plant(se).value();for(var ae=0,fe=o?t[ae].apply(this,oe):se;++ae<o;)fe=t[ae].call(this,fe);return fe}})}function oi(e,t,o,g,w,F,$,K,Y,oe){var se=t&d,ae=t&M,fe=t&P,ge=t&(b|T),be=t&u,Te=fe?h:dr(e);function Ae(){for(var Pe=arguments.length,Me=ne(Pe),At=Pe;At--;)Me[At]=arguments[At];if(ge)var lt=Wn(Ae),Ct=id(Me,lt);if(g&&(Me=gu(Me,g,w,ge)),F&&(Me=vu(Me,F,$,ge)),Pe-=Ct,ge&&Pe<oe){var Ke=Xt(Me,lt);return Eu(e,t,oi,Ae.placeholder,o,Me,Ke,K,Y,oe-Pe)}var Nt=ae?o:this,Kt=fe?Nt[e]:e;return Pe=Me.length,K?Me=dp(Me,K):be&&Pe>1&&Me.reverse(),se&&Y<Pe&&(Me.length=Y),this&&this!==tt&&this instanceof Ae&&(Kt=Te||dr(Kt)),Kt.apply(Nt,Me)}return Ae}function Ou(e,t){return function(o,g){return Ah(o,e,t(g),{})}}function si(e,t){return function(o,g){var w;if(o===h&&g===h)return t;if(o!==h&&(w=o),g!==h){if(w===h)return g;typeof o=="string"||typeof g=="string"?(o=yt(o),g=yt(g)):(o=au(o),g=au(g)),w=e(o,g)}return w}}function No(e){return zt(function(t){return t=We(t,mt(ye())),Ie(function(o){var g=this;return e(t,function(w){return vt(w,g,o)})})})}function ai(e,t){t=t===h?" ":yt(t);var o=t.length;if(o<2)return o?Io(t,e):t;var g=Io(t,Kr(e/Dn(t)));return Nn(t)?sn(Mt(g),0,e).join(""):g.slice(0,e)}function Kh(e,t,o,g){var w=t&M,F=dr(e);function $(){for(var K=-1,Y=arguments.length,oe=-1,se=g.length,ae=ne(se+Y),fe=this&&this!==tt&&this instanceof $?F:e;++oe<se;)ae[oe]=g[oe];for(;Y--;)ae[oe++]=arguments[++K];return vt(fe,w?o:this,ae)}return $}function Su(e){return function(t,o,g){return g&&typeof g!="number"&&ut(t,o,g)&&(o=g=h),t=jt(t),o===h?(o=t,t=0):o=jt(o),g=g===h?t<o?1:-1:jt(g),xh(t,o,g,e)}}function ui(e){return function(t,o){return typeof t=="string"&&typeof o=="string"||(t=wt(t),o=wt(o)),e(t,o)}}function Eu(e,t,o,g,w,F,$,K,Y,oe){var se=t&b,ae=se?$:h,fe=se?h:$,ge=se?F:h,be=se?h:F;t|=se?l:v,t&=~(se?v:l),t&O||(t&=~(M|P));var Te=[e,t,w,ge,ae,be,fe,K,Y,oe],Ae=o.apply(h,Te);return Wo(e)&&Uu(Ae,Te),Ae.placeholder=g,Bu(Ae,e,t)}function Do(e){var t=Ye[e];return function(o,g){if(o=wt(o),g=g==null?0:ot(Ee(g),292),g&&Ba(o)){var w=(De(o)+"e").split("e"),F=t(w[0]+"e"+(+w[1]+g));return w=(De(F)+"e").split("e"),+(w[0]+"e"+(+w[1]-g))}return t(o)}}var Jh=Bn&&1/Br(new Bn([,-0]))[1]==x?function(e){return new Bn(e)}:rs;function Ru(e){return function(t){var o=st(t);return o==de?co(t):o==ie?fd(t):rd(t,e(t))}}function Wt(e,t,o,g,w,F,$,K){var Y=t&P;if(!Y&&typeof e!="function")throw new Rt(i);var oe=g?g.length:0;if(oe||(t&=~(l|v),g=w=h),$=$===h?$:Ze(Ee($),0),K=K===h?K:Ee(K),oe-=w?w.length:0,t&v){var se=g,ae=w;g=w=h}var fe=Y?h:Fo(e),ge=[e,t,o,g,w,se,ae,F,$,K];if(fe&&lp(ge,fe),e=ge[0],t=ge[1],o=ge[2],g=ge[3],w=ge[4],K=ge[9]=ge[9]===h?Y?0:e.length:Ze(ge[9]-oe,0),!K&&t&(b|T)&&(t&=~(b|T)),!t||t==M)var be=Vh(e,t,o);else t==b||t==T?be=jh(e,t,K):(t==l||t==(M|l))&&!w.length?be=Kh(e,t,o,g):be=oi.apply(h,ge);var Te=fe?ou:Uu;return Bu(Te(be,ge),e,t)}function Tu(e,t,o,g){return e===h||Lt(e,Un[o])&&!Ue.call(g,o)?t:e}function Iu(e,t,o,g,w,F){return ze(e)&&ze(t)&&(F.set(t,e),ti(e,t,h,Iu,F),F.delete(t)),e}function qh(e){return gr(e)?h:e}function _u(e,t,o,g,w,F){var $=o&a,K=e.length,Y=t.length;if(K!=Y&&!($&&Y>K))return!1;var oe=F.get(e),se=F.get(t);if(oe&&se)return oe==t&&se==e;var ae=-1,fe=!0,ge=o&S?new gn:h;for(F.set(e,t),F.set(t,e);++ae<K;){var be=e[ae],Te=t[ae];if(g)var Ae=$?g(Te,be,ae,t,e,F):g(be,Te,ae,e,t,F);if(Ae!==h){if(Ae)continue;fe=!1;break}if(ge){if(!io(t,function(Pe,Me){if(!tr(ge,Me)&&(be===Pe||w(be,Pe,o,g,F)))return ge.push(Me)})){fe=!1;break}}else if(!(be===Te||w(be,Te,o,g,F))){fe=!1;break}}return F.delete(e),F.delete(t),fe}function Qh(e,t,o,g,w,F,$){switch(o){case Mn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case er:return!(e.byteLength!=t.byteLength||!F(new zr(e),new zr(t)));case te:case le:case xe:return Lt(+e,+t);case ve:return e.name==t.name&&e.message==t.message;case Z:case ue:return e==t+"";case de:var K=co;case ie:var Y=g&a;if(K||(K=Br),e.size!=t.size&&!Y)return!1;var oe=$.get(e);if(oe)return oe==t;g|=S,$.set(e,t);var se=_u(K(e),K(t),g,w,F,$);return $.delete(e),se;case pe:if(sr)return sr.call(e)==sr.call(t)}return!1}function Yh(e,t,o,g,w,F){var $=o&a,K=Uo(e),Y=K.length,oe=Uo(t),se=oe.length;if(Y!=se&&!$)return!1;for(var ae=Y;ae--;){var fe=K[ae];if(!($?fe in t:Ue.call(t,fe)))return!1}var ge=F.get(e),be=F.get(t);if(ge&&be)return ge==t&&be==e;var Te=!0;F.set(e,t),F.set(t,e);for(var Ae=$;++ae<Y;){fe=K[ae];var Pe=e[fe],Me=t[fe];if(g)var At=$?g(Me,Pe,fe,t,e,F):g(Pe,Me,fe,e,t,F);if(!(At===h?Pe===Me||w(Pe,Me,o,g,F):At)){Te=!1;break}Ae||(Ae=fe=="constructor")}if(Te&&!Ae){var lt=e.constructor,Ct=t.constructor;lt!=Ct&&"constructor"in e&&"constructor"in t&&!(typeof lt=="function"&&lt instanceof lt&&typeof Ct=="function"&&Ct instanceof Ct)&&(Te=!1)}return F.delete(e),F.delete(t),Te}function zt(e){return $o(Nu(e,h,zu),e+"")}function Uo(e){return Ja(e,nt,Ho)}function Bo(e){return Ja(e,ht,Pu)}var Fo=qr?function(e){return qr.get(e)}:rs;function li(e){for(var t=e.name+"",o=Fn[t],g=Ue.call(Fn,t)?o.length:0;g--;){var w=o[g],F=w.func;if(F==null||F==e)return w.name}return t}function Wn(e){var t=Ue.call(N,"placeholder")?N:e;return t.placeholder}function ye(){var e=N.iteratee||ts;return e=e===ts?Ya:e,arguments.length?e(arguments[0],arguments[1]):e}function ci(e,t){var o=e.__data__;return op(t)?o[typeof t=="string"?"string":"hash"]:o.map}function Go(e){for(var t=nt(e),o=t.length;o--;){var g=t[o],w=e[g];t[o]=[g,w,xu(w)]}return t}function yn(e,t){var o=ud(e,t);return Qa(o)?o:h}function Zh(e){var t=Ue.call(e,hn),o=e[hn];try{e[hn]=h;var g=!0}catch(F){}var w=kr.call(e);return g&&(t?e[hn]=o:delete e[hn]),w}var Ho=ho?function(e){return e==null?[]:(e=Fe(e),Yt(ho(e),function(t){return Da.call(e,t)}))}:is,Pu=ho?function(e){for(var t=[];e;)Zt(t,Ho(e)),e=$r(e);return t}:is,st=at;(po&&st(new po(new ArrayBuffer(1)))!=Mn||rr&&st(new rr)!=de||go&&st(go.resolve())!=ke||Bn&&st(new Bn)!=ie||ir&&st(new ir)!=qe)&&(st=function(e){var t=at(e),o=t==Be?e.constructor:h,g=o?bn(o):"";if(g)switch(g){case Nd:return Mn;case Dd:return de;case Ud:return ke;case Bd:return ie;case Fd:return qe}return t});function Xh(e,t,o){for(var g=-1,w=o.length;++g<w;){var F=o[g],$=F.size;switch(F.type){case"drop":e+=$;break;case"dropRight":t-=$;break;case"take":t=ot(t,e+$);break;case"takeRight":e=Ze(e,t-$);break}}return{start:e,end:t}}function ep(e){var t=e.match(sf);return t?t[1].split(af):[]}function wu(e,t,o){t=on(t,e);for(var g=-1,w=t.length,F=!1;++g<w;){var $=Bt(t[g]);if(!(F=e!=null&&o(e,$)))break;e=e[$]}return F||++g!=w?F:(w=e==null?0:e.length,!!w&&mi(w)&&$t($,w)&&(Oe(e)||An(e)))}function tp(e){var t=e.length,o=new e.constructor(t);return t&&typeof e[0]=="string"&&Ue.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Mu(e){return typeof e.constructor=="function"&&!hr(e)?Gn($r(e)):{}}function np(e,t,o){var g=e.constructor;switch(t){case er:return Lo(e);case te:case le:return new g(+e);case Mn:return Gh(e,o);case Fi:case Gi:case Hi:case ki:case Wi:case zi:case $i:case Vi:case ji:return hu(e,o);case de:return new g;case xe:case ue:return new g(e);case Z:return Hh(e);case ie:return new g;case pe:return kh(e)}}function rp(e,t){var o=t.length;if(!o)return e;var g=o-1;return t[g]=(o>1?"& ":"")+t[g],t=t.join(o>2?", ":" "),e.replace(of,`{
/* [wrapped with `+t+`] */
`)}function ip(e){return Oe(e)||An(e)||!!(Ua&&e&&e[Ua])}function $t(e,t){var o=typeof e;return t=t==null?z:t,!!t&&(o=="number"||o!="symbol"&&vf.test(e))&&e>-1&&e%1==0&&e<t}function ut(e,t,o){if(!ze(o))return!1;var g=typeof t;return(g=="number"?dt(o)&&$t(t,o.length):g=="string"&&t in o)?Lt(o[t],e):!1}function ko(e,t){if(Oe(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||bt(e)?!0:ef.test(e)||!Xc.test(e)||t!=null&&e in Fe(t)}function op(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Wo(e){var t=li(e),o=N[t];if(typeof o!="function"||!(t in we.prototype))return!1;if(e===o)return!0;var g=Fo(o);return!!g&&e===g[0]}function sp(e){return!!xa&&xa in e}var ap=Gr?Vt:os;function hr(e){var t=e&&e.constructor,o=typeof t=="function"&&t.prototype||Un;return e===o}function xu(e){return e===e&&!ze(e)}function Lu(e,t){return function(o){return o==null?!1:o[e]===t&&(t!==h||e in Fe(o))}}function up(e){var t=gi(e,function(g){return o.size===c&&o.clear(),g}),o=t.cache;return t}function lp(e,t){var o=e[1],g=t[1],w=o|g,F=w<(M|P|d),$=g==d&&o==b||g==d&&o==p&&e[7].length<=t[8]||g==(d|p)&&t[7].length<=t[8]&&o==b;if(!(F||$))return e;g&M&&(e[2]=t[2],w|=o&M?0:O);var K=t[3];if(K){var Y=e[3];e[3]=Y?gu(Y,K,t[4]):K,e[4]=Y?Xt(e[3],f):t[4]}return K=t[5],K&&(Y=e[5],e[5]=Y?vu(Y,K,t[6]):K,e[6]=Y?Xt(e[5],f):t[6]),K=t[7],K&&(e[7]=K),g&d&&(e[8]=e[8]==null?t[8]:ot(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=w,e}function cp(e){var t=[];if(e!=null)for(var o in Fe(e))t.push(o);return t}function fp(e){return kr.call(e)}function Nu(e,t,o){return t=Ze(t===h?e.length-1:t,0),function(){for(var g=arguments,w=-1,F=Ze(g.length-t,0),$=ne(F);++w<F;)$[w]=g[t+w];w=-1;for(var K=ne(t+1);++w<t;)K[w]=g[w];return K[t]=o($),vt(e,this,K)}}function Du(e,t){return t.length<2?e:mn(e,_t(t,0,-1))}function dp(e,t){for(var o=e.length,g=ot(t.length,o),w=ft(e);g--;){var F=t[g];e[g]=$t(F,o)?w[F]:h}return e}function zo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Uu=Fu(ou),pr=Id||function(e,t){return tt.setTimeout(e,t)},$o=Fu(Dh);function Bu(e,t,o){var g=t+"";return $o(e,rp(g,hp(ep(g),o)))}function Fu(e){var t=0,o=0;return function(){var g=Md(),w=W-(g-o);if(o=g,w>0){if(++t>=L)return arguments[0]}else t=0;return e.apply(h,arguments)}}function fi(e,t){var o=-1,g=e.length,w=g-1;for(t=t===h?g:t;++o<t;){var F=To(o,w),$=e[F];e[F]=e[o],e[o]=$}return e.length=t,e}var Gu=up(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(tf,function(o,g,w,F){t.push(w?F.replace(cf,"$1"):g||o)}),t});function Bt(e){if(typeof e=="string"||bt(e))return e;var t=e+"";return t=="0"&&1/e==-x?"-0":t}function bn(e){if(e!=null){try{return Hr.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function hp(e,t){return Et(D,function(o){var g="_."+o[0];t&o[1]&&!Dr(e,g)&&e.push(g)}),e.sort()}function Hu(e){if(e instanceof we)return e.clone();var t=new Tt(e.__wrapped__,e.__chain__);return t.__actions__=ft(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function pp(e,t,o){(o?ut(e,t,o):t===h)?t=1:t=Ze(Ee(t),0);var g=e==null?0:e.length;if(!g||t<1)return[];for(var w=0,F=0,$=ne(Kr(g/t));w<g;)$[F++]=_t(e,w,w+=t);return $}function gp(e){for(var t=-1,o=e==null?0:e.length,g=0,w=[];++t<o;){var F=e[t];F&&(w[g++]=F)}return w}function vp(){var e=arguments.length;if(!e)return[];for(var t=ne(e-1),o=arguments[0],g=e;g--;)t[g-1]=arguments[g];return Zt(Oe(o)?ft(o):[o],it(t,1))}var mp=Ie(function(e,t){return je(e)?ur(e,it(t,1,je,!0)):[]}),yp=Ie(function(e,t){var o=Pt(t);return je(o)&&(o=h),je(e)?ur(e,it(t,1,je,!0),ye(o,2)):[]}),bp=Ie(function(e,t){var o=Pt(t);return je(o)&&(o=h),je(e)?ur(e,it(t,1,je,!0),h,o):[]});function Ap(e,t,o){var g=e==null?0:e.length;return g?(t=o||t===h?1:Ee(t),_t(e,t<0?0:t,g)):[]}function Cp(e,t,o){var g=e==null?0:e.length;return g?(t=o||t===h?1:Ee(t),t=g-t,_t(e,0,t<0?0:t)):[]}function Op(e,t){return e&&e.length?ri(e,ye(t,3),!0,!0):[]}function Sp(e,t){return e&&e.length?ri(e,ye(t,3),!0):[]}function Ep(e,t,o,g){var w=e==null?0:e.length;return w?(o&&typeof o!="number"&&ut(e,t,o)&&(o=0,g=w),vh(e,t,o,g)):[]}function ku(e,t,o){var g=e==null?0:e.length;if(!g)return-1;var w=o==null?0:Ee(o);return w<0&&(w=Ze(g+w,0)),Ur(e,ye(t,3),w)}function Wu(e,t,o){var g=e==null?0:e.length;if(!g)return-1;var w=g-1;return o!==h&&(w=Ee(o),w=o<0?Ze(g+w,0):ot(w,g-1)),Ur(e,ye(t,3),w,!0)}function zu(e){var t=e==null?0:e.length;return t?it(e,1):[]}function Rp(e){var t=e==null?0:e.length;return t?it(e,x):[]}function Tp(e,t){var o=e==null?0:e.length;return o?(t=t===h?1:Ee(t),it(e,t)):[]}function Ip(e){for(var t=-1,o=e==null?0:e.length,g={};++t<o;){var w=e[t];g[w[0]]=w[1]}return g}function $u(e){return e&&e.length?e[0]:h}function _p(e,t,o){var g=e==null?0:e.length;if(!g)return-1;var w=o==null?0:Ee(o);return w<0&&(w=Ze(g+w,0)),Ln(e,t,w)}function Pp(e){var t=e==null?0:e.length;return t?_t(e,0,-1):[]}var wp=Ie(function(e){var t=We(e,Mo);return t.length&&t[0]===e[0]?Co(t):[]}),Mp=Ie(function(e){var t=Pt(e),o=We(e,Mo);return t===Pt(o)?t=h:o.pop(),o.length&&o[0]===e[0]?Co(o,ye(t,2)):[]}),xp=Ie(function(e){var t=Pt(e),o=We(e,Mo);return t=typeof t=="function"?t:h,t&&o.pop(),o.length&&o[0]===e[0]?Co(o,h,t):[]});function Lp(e,t){return e==null?"":Pd.call(e,t)}function Pt(e){var t=e==null?0:e.length;return t?e[t-1]:h}function Np(e,t,o){var g=e==null?0:e.length;if(!g)return-1;var w=g;return o!==h&&(w=Ee(o),w=w<0?Ze(g+w,0):ot(w,g-1)),t===t?hd(e,t,w):Ur(e,Ea,w,!0)}function Dp(e,t){return e&&e.length?tu(e,Ee(t)):h}var Up=Ie(Vu);function Vu(e,t){return e&&e.length&&t&&t.length?Ro(e,t):e}function Bp(e,t,o){return e&&e.length&&t&&t.length?Ro(e,t,ye(o,2)):e}function Fp(e,t,o){return e&&e.length&&t&&t.length?Ro(e,t,h,o):e}var Gp=zt(function(e,t){var o=e==null?0:e.length,g=mo(e,t);return iu(e,We(t,function(w){return $t(w,o)?+w:w}).sort(pu)),g});function Hp(e,t){var o=[];if(!(e&&e.length))return o;var g=-1,w=[],F=e.length;for(t=ye(t,3);++g<F;){var $=e[g];t($,g,e)&&(o.push($),w.push(g))}return iu(e,w),o}function Vo(e){return e==null?e:Ld.call(e)}function kp(e,t,o){var g=e==null?0:e.length;return g?(o&&typeof o!="number"&&ut(e,t,o)?(t=0,o=g):(t=t==null?0:Ee(t),o=o===h?g:Ee(o)),_t(e,t,o)):[]}function Wp(e,t){return ni(e,t)}function zp(e,t,o){return _o(e,t,ye(o,2))}function $p(e,t){var o=e==null?0:e.length;if(o){var g=ni(e,t);if(g<o&&Lt(e[g],t))return g}return-1}function Vp(e,t){return ni(e,t,!0)}function jp(e,t,o){return _o(e,t,ye(o,2),!0)}function Kp(e,t){var o=e==null?0:e.length;if(o){var g=ni(e,t,!0)-1;if(Lt(e[g],t))return g}return-1}function Jp(e){return e&&e.length?su(e):[]}function qp(e,t){return e&&e.length?su(e,ye(t,2)):[]}function Qp(e){var t=e==null?0:e.length;return t?_t(e,1,t):[]}function Yp(e,t,o){return e&&e.length?(t=o||t===h?1:Ee(t),_t(e,0,t<0?0:t)):[]}function Zp(e,t,o){var g=e==null?0:e.length;return g?(t=o||t===h?1:Ee(t),t=g-t,_t(e,t<0?0:t,g)):[]}function Xp(e,t){return e&&e.length?ri(e,ye(t,3),!1,!0):[]}function eg(e,t){return e&&e.length?ri(e,ye(t,3)):[]}var tg=Ie(function(e){return rn(it(e,1,je,!0))}),ng=Ie(function(e){var t=Pt(e);return je(t)&&(t=h),rn(it(e,1,je,!0),ye(t,2))}),rg=Ie(function(e){var t=Pt(e);return t=typeof t=="function"?t:h,rn(it(e,1,je,!0),h,t)});function ig(e){return e&&e.length?rn(e):[]}function og(e,t){return e&&e.length?rn(e,ye(t,2)):[]}function sg(e,t){return t=typeof t=="function"?t:h,e&&e.length?rn(e,h,t):[]}function jo(e){if(!(e&&e.length))return[];var t=0;return e=Yt(e,function(o){if(je(o))return t=Ze(o.length,t),!0}),uo(t,function(o){return We(e,oo(o))})}function ju(e,t){if(!(e&&e.length))return[];var o=jo(e);return t==null?o:We(o,function(g){return vt(t,h,g)})}var ag=Ie(function(e,t){return je(e)?ur(e,t):[]}),ug=Ie(function(e){return wo(Yt(e,je))}),lg=Ie(function(e){var t=Pt(e);return je(t)&&(t=h),wo(Yt(e,je),ye(t,2))}),cg=Ie(function(e){var t=Pt(e);return t=typeof t=="function"?t:h,wo(Yt(e,je),h,t)}),fg=Ie(jo);function dg(e,t){return cu(e||[],t||[],ar)}function hg(e,t){return cu(e||[],t||[],fr)}var pg=Ie(function(e){var t=e.length,o=t>1?e[t-1]:h;return o=typeof o=="function"?(e.pop(),o):h,ju(e,o)});function Ku(e){var t=N(e);return t.__chain__=!0,t}function gg(e,t){return t(e),e}function di(e,t){return t(e)}var vg=zt(function(e){var t=e.length,o=t?e[0]:0,g=this.__wrapped__,w=function(F){return mo(F,e)};return t>1||this.__actions__.length||!(g instanceof we)||!$t(o)?this.thru(w):(g=g.slice(o,+o+(t?1:0)),g.__actions__.push({func:di,args:[w],thisArg:h}),new Tt(g,this.__chain__).thru(function(F){return t&&!F.length&&F.push(h),F}))});function mg(){return Ku(this)}function yg(){return new Tt(this.value(),this.__chain__)}function bg(){this.__values__===h&&(this.__values__=al(this.value()));var e=this.__index__>=this.__values__.length,t=e?h:this.__values__[this.__index__++];return{done:e,value:t}}function Ag(){return this}function Cg(e){for(var t,o=this;o instanceof Yr;){var g=Hu(o);g.__index__=0,g.__values__=h,t?w.__wrapped__=g:t=g;var w=g;o=o.__wrapped__}return w.__wrapped__=e,t}function Og(){var e=this.__wrapped__;if(e instanceof we){var t=e;return this.__actions__.length&&(t=new we(this)),t=t.reverse(),t.__actions__.push({func:di,args:[Vo],thisArg:h}),new Tt(t,this.__chain__)}return this.thru(Vo)}function Sg(){return lu(this.__wrapped__,this.__actions__)}var Eg=ii(function(e,t,o){Ue.call(e,o)?++e[o]:kt(e,o,1)});function Rg(e,t,o){var g=Oe(e)?Oa:gh;return o&&ut(e,t,o)&&(t=h),g(e,ye(t,3))}function Tg(e,t){var o=Oe(e)?Yt:ja;return o(e,ye(t,3))}var Ig=Au(ku),_g=Au(Wu);function Pg(e,t){return it(hi(e,t),1)}function wg(e,t){return it(hi(e,t),x)}function Mg(e,t,o){return o=o===h?1:Ee(o),it(hi(e,t),o)}function Ju(e,t){var o=Oe(e)?Et:nn;return o(e,ye(t,3))}function qu(e,t){var o=Oe(e)?Qf:Va;return o(e,ye(t,3))}var xg=ii(function(e,t,o){Ue.call(e,o)?e[o].push(t):kt(e,o,[t])});function Lg(e,t,o,g){e=dt(e)?e:$n(e),o=o&&!g?Ee(o):0;var w=e.length;return o<0&&(o=Ze(w+o,0)),yi(e)?o<=w&&e.indexOf(t,o)>-1:!!w&&Ln(e,t,o)>-1}var Ng=Ie(function(e,t,o){var g=-1,w=typeof t=="function",F=dt(e)?ne(e.length):[];return nn(e,function($){F[++g]=w?vt(t,$,o):lr($,t,o)}),F}),Dg=ii(function(e,t,o){kt(e,o,t)});function hi(e,t){var o=Oe(e)?We:Za;return o(e,ye(t,3))}function Ug(e,t,o,g){return e==null?[]:(Oe(t)||(t=t==null?[]:[t]),o=g?h:o,Oe(o)||(o=o==null?[]:[o]),nu(e,t,o))}var Bg=ii(function(e,t,o){e[o?0:1].push(t)},function(){return[[],[]]});function Fg(e,t,o){var g=Oe(e)?ro:Ta,w=arguments.length<3;return g(e,ye(t,4),o,w,nn)}function Gg(e,t,o){var g=Oe(e)?Yf:Ta,w=arguments.length<3;return g(e,ye(t,4),o,w,Va)}function Hg(e,t){var o=Oe(e)?Yt:ja;return o(e,vi(ye(t,3)))}function kg(e){var t=Oe(e)?ka:Lh;return t(e)}function Wg(e,t,o){(o?ut(e,t,o):t===h)?t=1:t=Ee(t);var g=Oe(e)?ch:Nh;return g(e,t)}function zg(e){var t=Oe(e)?fh:Uh;return t(e)}function $g(e){if(e==null)return 0;if(dt(e))return yi(e)?Dn(e):e.length;var t=st(e);return t==de||t==ie?e.size:So(e).length}function Vg(e,t,o){var g=Oe(e)?io:Bh;return o&&ut(e,t,o)&&(t=h),g(e,ye(t,3))}var jg=Ie(function(e,t){if(e==null)return[];var o=t.length;return o>1&&ut(e,t[0],t[1])?t=[]:o>2&&ut(t[0],t[1],t[2])&&(t=[t[0]]),nu(e,it(t,1),[])}),pi=Td||function(){return tt.Date.now()};function Kg(e,t){if(typeof t!="function")throw new Rt(i);return e=Ee(e),function(){if(--e<1)return t.apply(this,arguments)}}function Qu(e,t,o){return t=o?h:t,t=e&&t==null?e.length:t,Wt(e,d,h,h,h,h,t)}function Yu(e,t){var o;if(typeof t!="function")throw new Rt(i);return e=Ee(e),function(){return--e>0&&(o=t.apply(this,arguments)),e<=1&&(t=h),o}}var Ko=Ie(function(e,t,o){var g=M;if(o.length){var w=Xt(o,Wn(Ko));g|=l}return Wt(e,g,t,o,w)}),Zu=Ie(function(e,t,o){var g=M|P;if(o.length){var w=Xt(o,Wn(Zu));g|=l}return Wt(t,g,e,o,w)});function Xu(e,t,o){t=o?h:t;var g=Wt(e,b,h,h,h,h,h,t);return g.placeholder=Xu.placeholder,g}function el(e,t,o){t=o?h:t;var g=Wt(e,T,h,h,h,h,h,t);return g.placeholder=el.placeholder,g}function tl(e,t,o){var g,w,F,$,K,Y,oe=0,se=!1,ae=!1,fe=!0;if(typeof e!="function")throw new Rt(i);t=wt(t)||0,ze(o)&&(se=!!o.leading,ae="maxWait"in o,F=ae?Ze(wt(o.maxWait)||0,t):F,fe="trailing"in o?!!o.trailing:fe);function ge(Ke){var Nt=g,Kt=w;return g=w=h,oe=Ke,$=e.apply(Kt,Nt),$}function be(Ke){return oe=Ke,K=pr(Pe,t),se?ge(Ke):$}function Te(Ke){var Nt=Ke-Y,Kt=Ke-oe,Al=t-Nt;return ae?ot(Al,F-Kt):Al}function Ae(Ke){var Nt=Ke-Y,Kt=Ke-oe;return Y===h||Nt>=t||Nt<0||ae&&Kt>=F}function Pe(){var Ke=pi();if(Ae(Ke))return Me(Ke);K=pr(Pe,Te(Ke))}function Me(Ke){return K=h,fe&&g?ge(Ke):(g=w=h,$)}function At(){K!==h&&fu(K),oe=0,g=Y=w=K=h}function lt(){return K===h?$:Me(pi())}function Ct(){var Ke=pi(),Nt=Ae(Ke);if(g=arguments,w=this,Y=Ke,Nt){if(K===h)return be(Y);if(ae)return fu(K),K=pr(Pe,t),ge(Y)}return K===h&&(K=pr(Pe,t)),$}return Ct.cancel=At,Ct.flush=lt,Ct}var Jg=Ie(function(e,t){return $a(e,1,t)}),qg=Ie(function(e,t,o){return $a(e,wt(t)||0,o)});function Qg(e){return Wt(e,u)}function gi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Rt(i);var o=function(){var g=arguments,w=t?t.apply(this,g):g[0],F=o.cache;if(F.has(w))return F.get(w);var $=e.apply(this,g);return o.cache=F.set(w,$)||F,$};return o.cache=new(gi.Cache||Ht),o}gi.Cache=Ht;function vi(e){if(typeof e!="function")throw new Rt(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Yg(e){return Yu(2,e)}var Zg=Fh(function(e,t){t=t.length==1&&Oe(t[0])?We(t[0],mt(ye())):We(it(t,1),mt(ye()));var o=t.length;return Ie(function(g){for(var w=-1,F=ot(g.length,o);++w<F;)g[w]=t[w].call(this,g[w]);return vt(e,this,g)})}),Jo=Ie(function(e,t){var o=Xt(t,Wn(Jo));return Wt(e,l,h,t,o)}),nl=Ie(function(e,t){var o=Xt(t,Wn(nl));return Wt(e,v,h,t,o)}),Xg=zt(function(e,t){return Wt(e,p,h,h,h,t)});function ev(e,t){if(typeof e!="function")throw new Rt(i);return t=t===h?t:Ee(t),Ie(e,t)}function tv(e,t){if(typeof e!="function")throw new Rt(i);return t=t==null?0:Ze(Ee(t),0),Ie(function(o){var g=o[t],w=sn(o,0,t);return g&&Zt(w,g),vt(e,this,w)})}function nv(e,t,o){var g=!0,w=!0;if(typeof e!="function")throw new Rt(i);return ze(o)&&(g="leading"in o?!!o.leading:g,w="trailing"in o?!!o.trailing:w),tl(e,t,{leading:g,maxWait:t,trailing:w})}function rv(e){return Qu(e,1)}function iv(e,t){return Jo(xo(t),e)}function ov(){if(!arguments.length)return[];var e=arguments[0];return Oe(e)?e:[e]}function sv(e){return It(e,R)}function av(e,t){return t=typeof t=="function"?t:h,It(e,R,t)}function uv(e){return It(e,C|R)}function lv(e,t){return t=typeof t=="function"?t:h,It(e,C|R,t)}function cv(e,t){return t==null||za(e,t,nt(t))}function Lt(e,t){return e===t||e!==e&&t!==t}var fv=ui(Ao),dv=ui(function(e,t){return e>=t}),An=qa(function(){return arguments}())?qa:function(e){return Ve(e)&&Ue.call(e,"callee")&&!Da.call(e,"callee")},Oe=ne.isArray,hv=va?mt(va):Ch;function dt(e){return e!=null&&mi(e.length)&&!Vt(e)}function je(e){return Ve(e)&&dt(e)}function pv(e){return e===!0||e===!1||Ve(e)&&at(e)==te}var an=_d||os,gv=ma?mt(ma):Oh;function vv(e){return Ve(e)&&e.nodeType===1&&!gr(e)}function mv(e){if(e==null)return!0;if(dt(e)&&(Oe(e)||typeof e=="string"||typeof e.splice=="function"||an(e)||zn(e)||An(e)))return!e.length;var t=st(e);if(t==de||t==ie)return!e.size;if(hr(e))return!So(e).length;for(var o in e)if(Ue.call(e,o))return!1;return!0}function yv(e,t){return cr(e,t)}function bv(e,t,o){o=typeof o=="function"?o:h;var g=o?o(e,t):h;return g===h?cr(e,t,h,o):!!g}function qo(e){if(!Ve(e))return!1;var t=at(e);return t==ve||t==me||typeof e.message=="string"&&typeof e.name=="string"&&!gr(e)}function Av(e){return typeof e=="number"&&Ba(e)}function Vt(e){if(!ze(e))return!1;var t=at(e);return t==Se||t==Le||t==V||t==ct}function rl(e){return typeof e=="number"&&e==Ee(e)}function mi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=z}function ze(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ve(e){return e!=null&&typeof e=="object"}var il=ya?mt(ya):Eh;function Cv(e,t){return e===t||Oo(e,t,Go(t))}function Ov(e,t,o){return o=typeof o=="function"?o:h,Oo(e,t,Go(t),o)}function Sv(e){return ol(e)&&e!=+e}function Ev(e){if(ap(e))throw new Ce(s);return Qa(e)}function Rv(e){return e===null}function Tv(e){return e==null}function ol(e){return typeof e=="number"||Ve(e)&&at(e)==xe}function gr(e){if(!Ve(e)||at(e)!=Be)return!1;var t=$r(e);if(t===null)return!0;var o=Ue.call(t,"constructor")&&t.constructor;return typeof o=="function"&&o instanceof o&&Hr.call(o)==Od}var Qo=ba?mt(ba):Rh;function Iv(e){return rl(e)&&e>=-z&&e<=z}var sl=Aa?mt(Aa):Th;function yi(e){return typeof e=="string"||!Oe(e)&&Ve(e)&&at(e)==ue}function bt(e){return typeof e=="symbol"||Ve(e)&&at(e)==pe}var zn=Ca?mt(Ca):Ih;function _v(e){return e===h}function Pv(e){return Ve(e)&&st(e)==qe}function wv(e){return Ve(e)&&at(e)==fn}var Mv=ui(Eo),xv=ui(function(e,t){return e<=t});function al(e){if(!e)return[];if(dt(e))return yi(e)?Mt(e):ft(e);if(nr&&e[nr])return cd(e[nr]());var t=st(e),o=t==de?co:t==ie?Br:$n;return o(e)}function jt(e){if(!e)return e===0?e:0;if(e=wt(e),e===x||e===-x){var t=e<0?-1:1;return t*k}return e===e?e:0}function Ee(e){var t=jt(e),o=t%1;return t===t?o?t-o:t:0}function ul(e){return e?vn(Ee(e),0,ee):0}function wt(e){if(typeof e=="number")return e;if(bt(e))return J;if(ze(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ze(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ia(e);var o=hf.test(e);return o||gf.test(e)?Kf(e.slice(2),o?2:8):df.test(e)?J:+e}function ll(e){return Ut(e,ht(e))}function Lv(e){return e?vn(Ee(e),-z,z):e===0?e:0}function De(e){return e==null?"":yt(e)}var Nv=Hn(function(e,t){if(hr(t)||dt(t)){Ut(t,nt(t),e);return}for(var o in t)Ue.call(t,o)&&ar(e,o,t[o])}),cl=Hn(function(e,t){Ut(t,ht(t),e)}),bi=Hn(function(e,t,o,g){Ut(t,ht(t),e,g)}),Dv=Hn(function(e,t,o,g){Ut(t,nt(t),e,g)}),Uv=zt(mo);function Bv(e,t){var o=Gn(e);return t==null?o:Wa(o,t)}var Fv=Ie(function(e,t){e=Fe(e);var o=-1,g=t.length,w=g>2?t[2]:h;for(w&&ut(t[0],t[1],w)&&(g=1);++o<g;)for(var F=t[o],$=ht(F),K=-1,Y=$.length;++K<Y;){var oe=$[K],se=e[oe];(se===h||Lt(se,Un[oe])&&!Ue.call(e,oe))&&(e[oe]=F[oe])}return e}),Gv=Ie(function(e){return e.push(h,Iu),vt(fl,h,e)});function Hv(e,t){return Sa(e,ye(t,3),Dt)}function kv(e,t){return Sa(e,ye(t,3),bo)}function Wv(e,t){return e==null?e:yo(e,ye(t,3),ht)}function zv(e,t){return e==null?e:Ka(e,ye(t,3),ht)}function $v(e,t){return e&&Dt(e,ye(t,3))}function Vv(e,t){return e&&bo(e,ye(t,3))}function jv(e){return e==null?[]:ei(e,nt(e))}function Kv(e){return e==null?[]:ei(e,ht(e))}function Yo(e,t,o){var g=e==null?h:mn(e,t);return g===h?o:g}function Jv(e,t){return e!=null&&wu(e,t,mh)}function Zo(e,t){return e!=null&&wu(e,t,yh)}var qv=Ou(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=kr.call(t)),e[t]=o},es(pt)),Qv=Ou(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=kr.call(t)),Ue.call(e,t)?e[t].push(o):e[t]=[o]},ye),Yv=Ie(lr);function nt(e){return dt(e)?Ha(e):So(e)}function ht(e){return dt(e)?Ha(e,!0):_h(e)}function Zv(e,t){var o={};return t=ye(t,3),Dt(e,function(g,w,F){kt(o,t(g,w,F),g)}),o}function Xv(e,t){var o={};return t=ye(t,3),Dt(e,function(g,w,F){kt(o,w,t(g,w,F))}),o}var em=Hn(function(e,t,o){ti(e,t,o)}),fl=Hn(function(e,t,o,g){ti(e,t,o,g)}),tm=zt(function(e,t){var o={};if(e==null)return o;var g=!1;t=We(t,function(F){return F=on(F,e),g||(g=F.length>1),F}),Ut(e,Bo(e),o),g&&(o=It(o,C|E|R,qh));for(var w=t.length;w--;)Po(o,t[w]);return o});function nm(e,t){return dl(e,vi(ye(t)))}var rm=zt(function(e,t){return e==null?{}:wh(e,t)});function dl(e,t){if(e==null)return{};var o=We(Bo(e),function(g){return[g]});return t=ye(t),ru(e,o,function(g,w){return t(g,w[0])})}function im(e,t,o){t=on(t,e);var g=-1,w=t.length;for(w||(w=1,e=h);++g<w;){var F=e==null?h:e[Bt(t[g])];F===h&&(g=w,F=o),e=Vt(F)?F.call(e):F}return e}function om(e,t,o){return e==null?e:fr(e,t,o)}function sm(e,t,o,g){return g=typeof g=="function"?g:h,e==null?e:fr(e,t,o,g)}var hl=Ru(nt),pl=Ru(ht);function am(e,t,o){var g=Oe(e),w=g||an(e)||zn(e);if(t=ye(t,4),o==null){var F=e&&e.constructor;w?o=g?new F:[]:ze(e)?o=Vt(F)?Gn($r(e)):{}:o={}}return(w?Et:Dt)(e,function($,K,Y){return t(o,$,K,Y)}),o}function um(e,t){return e==null?!0:Po(e,t)}function lm(e,t,o){return e==null?e:uu(e,t,xo(o))}function cm(e,t,o,g){return g=typeof g=="function"?g:h,e==null?e:uu(e,t,xo(o),g)}function $n(e){return e==null?[]:lo(e,nt(e))}function fm(e){return e==null?[]:lo(e,ht(e))}function dm(e,t,o){return o===h&&(o=t,t=h),o!==h&&(o=wt(o),o=o===o?o:0),t!==h&&(t=wt(t),t=t===t?t:0),vn(wt(e),t,o)}function hm(e,t,o){return t=jt(t),o===h?(o=t,t=0):o=jt(o),e=wt(e),bh(e,t,o)}function pm(e,t,o){if(o&&typeof o!="boolean"&&ut(e,t,o)&&(t=o=h),o===h&&(typeof t=="boolean"?(o=t,t=h):typeof e=="boolean"&&(o=e,e=h)),e===h&&t===h?(e=0,t=1):(e=jt(e),t===h?(t=e,e=0):t=jt(t)),e>t){var g=e;e=t,t=g}if(o||e%1||t%1){var w=Fa();return ot(e+w*(t-e+jf("1e-"+((w+"").length-1))),t)}return To(e,t)}var gm=kn(function(e,t,o){return t=t.toLowerCase(),e+(o?gl(t):t)});function gl(e){return Xo(De(e).toLowerCase())}function vl(e){return e=De(e),e&&e.replace(mf,od).replace(Uf,"")}function vm(e,t,o){e=De(e),t=yt(t);var g=e.length;o=o===h?g:vn(Ee(o),0,g);var w=o;return o-=t.length,o>=0&&e.slice(o,w)==t}function mm(e){return e=De(e),e&&Qc.test(e)?e.replace(Ks,sd):e}function ym(e){return e=De(e),e&&nf.test(e)?e.replace(Ki,"\\$&"):e}var bm=kn(function(e,t,o){return e+(o?"-":"")+t.toLowerCase()}),Am=kn(function(e,t,o){return e+(o?" ":"")+t.toLowerCase()}),Cm=bu("toLowerCase");function Om(e,t,o){e=De(e),t=Ee(t);var g=t?Dn(e):0;if(!t||g>=t)return e;var w=(t-g)/2;return ai(Jr(w),o)+e+ai(Kr(w),o)}function Sm(e,t,o){e=De(e),t=Ee(t);var g=t?Dn(e):0;return t&&g<t?e+ai(t-g,o):e}function Em(e,t,o){e=De(e),t=Ee(t);var g=t?Dn(e):0;return t&&g<t?ai(t-g,o)+e:e}function Rm(e,t,o){return o||t==null?t=0:t&&(t=+t),xd(De(e).replace(Ji,""),t||0)}function Tm(e,t,o){return(o?ut(e,t,o):t===h)?t=1:t=Ee(t),Io(De(e),t)}function Im(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var _m=kn(function(e,t,o){return e+(o?"_":"")+t.toLowerCase()});function Pm(e,t,o){return o&&typeof o!="number"&&ut(e,t,o)&&(t=o=h),o=o===h?ee:o>>>0,o?(e=De(e),e&&(typeof t=="string"||t!=null&&!Qo(t))&&(t=yt(t),!t&&Nn(e))?sn(Mt(e),0,o):e.split(t,o)):[]}var wm=kn(function(e,t,o){return e+(o?" ":"")+Xo(t)});function Mm(e,t,o){return e=De(e),o=o==null?0:vn(Ee(o),0,e.length),t=yt(t),e.slice(o,o+t.length)==t}function xm(e,t,o){var g=N.templateSettings;o&&ut(e,t,o)&&(t=h),e=De(e),t=bi({},t,g,Tu);var w=bi({},t.imports,g.imports,Tu),F=nt(w),$=lo(w,F),K,Y,oe=0,se=t.interpolate||xr,ae="__p += '",fe=fo((t.escape||xr).source+"|"+se.source+"|"+(se===Js?ff:xr).source+"|"+(t.evaluate||xr).source+"|$","g"),ge="//# sourceURL="+(Ue.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++kf+"]")+`
`;e.replace(fe,function(Ae,Pe,Me,At,lt,Ct){return Me||(Me=At),ae+=e.slice(oe,Ct).replace(yf,ad),Pe&&(K=!0,ae+=`' +
__e(`+Pe+`) +
'`),lt&&(Y=!0,ae+=`';
`+lt+`;
__p += '`),Me&&(ae+=`' +
((__t = (`+Me+`)) == null ? '' : __t) +
'`),oe=Ct+Ae.length,Ae}),ae+=`';
`;var be=Ue.call(t,"variable")&&t.variable;if(!be)ae=`with (obj) {
`+ae+`
}
`;else if(lf.test(be))throw new Ce(m);ae=(Y?ae.replace(jc,""):ae).replace(Kc,"$1").replace(Jc,"$1;"),ae="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ae+`return __p
}`;var Te=yl(function(){return Ne(F,ge+"return "+ae).apply(h,$)});if(Te.source=ae,qo(Te))throw Te;return Te}function Lm(e){return De(e).toLowerCase()}function Nm(e){return De(e).toUpperCase()}function Dm(e,t,o){if(e=De(e),e&&(o||t===h))return Ia(e);if(!e||!(t=yt(t)))return e;var g=Mt(e),w=Mt(t),F=_a(g,w),$=Pa(g,w)+1;return sn(g,F,$).join("")}function Um(e,t,o){if(e=De(e),e&&(o||t===h))return e.slice(0,Ma(e)+1);if(!e||!(t=yt(t)))return e;var g=Mt(e),w=Pa(g,Mt(t))+1;return sn(g,0,w).join("")}function Bm(e,t,o){if(e=De(e),e&&(o||t===h))return e.replace(Ji,"");if(!e||!(t=yt(t)))return e;var g=Mt(e),w=_a(g,Mt(t));return sn(g,w).join("")}function Fm(e,t){var o=A,g=_;if(ze(t)){var w="separator"in t?t.separator:w;o="length"in t?Ee(t.length):o,g="omission"in t?yt(t.omission):g}e=De(e);var F=e.length;if(Nn(e)){var $=Mt(e);F=$.length}if(o>=F)return e;var K=o-Dn(g);if(K<1)return g;var Y=$?sn($,0,K).join(""):e.slice(0,K);if(w===h)return Y+g;if($&&(K+=Y.length-K),Qo(w)){if(e.slice(K).search(w)){var oe,se=Y;for(w.global||(w=fo(w.source,De(qs.exec(w))+"g")),w.lastIndex=0;oe=w.exec(se);)var ae=oe.index;Y=Y.slice(0,ae===h?K:ae)}}else if(e.indexOf(yt(w),K)!=K){var fe=Y.lastIndexOf(w);fe>-1&&(Y=Y.slice(0,fe))}return Y+g}function Gm(e){return e=De(e),e&&qc.test(e)?e.replace(js,pd):e}var Hm=kn(function(e,t,o){return e+(o?" ":"")+t.toUpperCase()}),Xo=bu("toUpperCase");function ml(e,t,o){return e=De(e),t=o?h:t,t===h?ld(e)?md(e):ed(e):e.match(t)||[]}var yl=Ie(function(e,t){try{return vt(e,h,t)}catch(o){return qo(o)?o:new Ce(o)}}),km=zt(function(e,t){return Et(t,function(o){o=Bt(o),kt(e,o,Ko(e[o],e))}),e});function Wm(e){var t=e==null?0:e.length,o=ye();return e=t?We(e,function(g){if(typeof g[1]!="function")throw new Rt(i);return[o(g[0]),g[1]]}):[],Ie(function(g){for(var w=-1;++w<t;){var F=e[w];if(vt(F[0],this,g))return vt(F[1],this,g)}})}function zm(e){return ph(It(e,C))}function es(e){return function(){return e}}function $m(e,t){return e==null||e!==e?t:e}var Vm=Cu(),jm=Cu(!0);function pt(e){return e}function ts(e){return Ya(typeof e=="function"?e:It(e,C))}function Km(e){return Xa(It(e,C))}function Jm(e,t){return eu(e,It(t,C))}var qm=Ie(function(e,t){return function(o){return lr(o,e,t)}}),Qm=Ie(function(e,t){return function(o){return lr(e,o,t)}});function ns(e,t,o){var g=nt(t),w=ei(t,g);o==null&&!(ze(t)&&(w.length||!g.length))&&(o=t,t=e,e=this,w=ei(t,nt(t)));var F=!(ze(o)&&"chain"in o)||!!o.chain,$=Vt(e);return Et(w,function(K){var Y=t[K];e[K]=Y,$&&(e.prototype[K]=function(){var oe=this.__chain__;if(F||oe){var se=e(this.__wrapped__),ae=se.__actions__=ft(this.__actions__);return ae.push({func:Y,args:arguments,thisArg:e}),se.__chain__=oe,se}return Y.apply(e,Zt([this.value()],arguments))})}),e}function Ym(){return tt._===this&&(tt._=Sd),this}function rs(){}function Zm(e){return e=Ee(e),Ie(function(t){return tu(t,e)})}var Xm=No(We),e0=No(Oa),t0=No(io);function bl(e){return ko(e)?oo(Bt(e)):Mh(e)}function n0(e){return function(t){return e==null?h:mn(e,t)}}var r0=Su(),i0=Su(!0);function is(){return[]}function os(){return!1}function o0(){return{}}function s0(){return""}function a0(){return!0}function u0(e,t){if(e=Ee(e),e<1||e>z)return[];var o=ee,g=ot(e,ee);t=ye(t),e-=ee;for(var w=uo(g,t);++o<e;)t(o);return w}function l0(e){return Oe(e)?We(e,Bt):bt(e)?[e]:ft(Gu(De(e)))}function c0(e){var t=++Cd;return De(e)+t}var f0=si(function(e,t){return e+t},0),d0=Do("ceil"),h0=si(function(e,t){return e/t},1),p0=Do("floor");function g0(e){return e&&e.length?Xr(e,pt,Ao):h}function v0(e,t){return e&&e.length?Xr(e,ye(t,2),Ao):h}function m0(e){return Ra(e,pt)}function y0(e,t){return Ra(e,ye(t,2))}function b0(e){return e&&e.length?Xr(e,pt,Eo):h}function A0(e,t){return e&&e.length?Xr(e,ye(t,2),Eo):h}var C0=si(function(e,t){return e*t},1),O0=Do("round"),S0=si(function(e,t){return e-t},0);function E0(e){return e&&e.length?ao(e,pt):0}function R0(e,t){return e&&e.length?ao(e,ye(t,2)):0}return N.after=Kg,N.ary=Qu,N.assign=Nv,N.assignIn=cl,N.assignInWith=bi,N.assignWith=Dv,N.at=Uv,N.before=Yu,N.bind=Ko,N.bindAll=km,N.bindKey=Zu,N.castArray=ov,N.chain=Ku,N.chunk=pp,N.compact=gp,N.concat=vp,N.cond=Wm,N.conforms=zm,N.constant=es,N.countBy=Eg,N.create=Bv,N.curry=Xu,N.curryRight=el,N.debounce=tl,N.defaults=Fv,N.defaultsDeep=Gv,N.defer=Jg,N.delay=qg,N.difference=mp,N.differenceBy=yp,N.differenceWith=bp,N.drop=Ap,N.dropRight=Cp,N.dropRightWhile=Op,N.dropWhile=Sp,N.fill=Ep,N.filter=Tg,N.flatMap=Pg,N.flatMapDeep=wg,N.flatMapDepth=Mg,N.flatten=zu,N.flattenDeep=Rp,N.flattenDepth=Tp,N.flip=Qg,N.flow=Vm,N.flowRight=jm,N.fromPairs=Ip,N.functions=jv,N.functionsIn=Kv,N.groupBy=xg,N.initial=Pp,N.intersection=wp,N.intersectionBy=Mp,N.intersectionWith=xp,N.invert=qv,N.invertBy=Qv,N.invokeMap=Ng,N.iteratee=ts,N.keyBy=Dg,N.keys=nt,N.keysIn=ht,N.map=hi,N.mapKeys=Zv,N.mapValues=Xv,N.matches=Km,N.matchesProperty=Jm,N.memoize=gi,N.merge=em,N.mergeWith=fl,N.method=qm,N.methodOf=Qm,N.mixin=ns,N.negate=vi,N.nthArg=Zm,N.omit=tm,N.omitBy=nm,N.once=Yg,N.orderBy=Ug,N.over=Xm,N.overArgs=Zg,N.overEvery=e0,N.overSome=t0,N.partial=Jo,N.partialRight=nl,N.partition=Bg,N.pick=rm,N.pickBy=dl,N.property=bl,N.propertyOf=n0,N.pull=Up,N.pullAll=Vu,N.pullAllBy=Bp,N.pullAllWith=Fp,N.pullAt=Gp,N.range=r0,N.rangeRight=i0,N.rearg=Xg,N.reject=Hg,N.remove=Hp,N.rest=ev,N.reverse=Vo,N.sampleSize=Wg,N.set=om,N.setWith=sm,N.shuffle=zg,N.slice=kp,N.sortBy=jg,N.sortedUniq=Jp,N.sortedUniqBy=qp,N.split=Pm,N.spread=tv,N.tail=Qp,N.take=Yp,N.takeRight=Zp,N.takeRightWhile=Xp,N.takeWhile=eg,N.tap=gg,N.throttle=nv,N.thru=di,N.toArray=al,N.toPairs=hl,N.toPairsIn=pl,N.toPath=l0,N.toPlainObject=ll,N.transform=am,N.unary=rv,N.union=tg,N.unionBy=ng,N.unionWith=rg,N.uniq=ig,N.uniqBy=og,N.uniqWith=sg,N.unset=um,N.unzip=jo,N.unzipWith=ju,N.update=lm,N.updateWith=cm,N.values=$n,N.valuesIn=fm,N.without=ag,N.words=ml,N.wrap=iv,N.xor=ug,N.xorBy=lg,N.xorWith=cg,N.zip=fg,N.zipObject=dg,N.zipObjectDeep=hg,N.zipWith=pg,N.entries=hl,N.entriesIn=pl,N.extend=cl,N.extendWith=bi,ns(N,N),N.add=f0,N.attempt=yl,N.camelCase=gm,N.capitalize=gl,N.ceil=d0,N.clamp=dm,N.clone=sv,N.cloneDeep=uv,N.cloneDeepWith=lv,N.cloneWith=av,N.conformsTo=cv,N.deburr=vl,N.defaultTo=$m,N.divide=h0,N.endsWith=vm,N.eq=Lt,N.escape=mm,N.escapeRegExp=ym,N.every=Rg,N.find=Ig,N.findIndex=ku,N.findKey=Hv,N.findLast=_g,N.findLastIndex=Wu,N.findLastKey=kv,N.floor=p0,N.forEach=Ju,N.forEachRight=qu,N.forIn=Wv,N.forInRight=zv,N.forOwn=$v,N.forOwnRight=Vv,N.get=Yo,N.gt=fv,N.gte=dv,N.has=Jv,N.hasIn=Zo,N.head=$u,N.identity=pt,N.includes=Lg,N.indexOf=_p,N.inRange=hm,N.invoke=Yv,N.isArguments=An,N.isArray=Oe,N.isArrayBuffer=hv,N.isArrayLike=dt,N.isArrayLikeObject=je,N.isBoolean=pv,N.isBuffer=an,N.isDate=gv,N.isElement=vv,N.isEmpty=mv,N.isEqual=yv,N.isEqualWith=bv,N.isError=qo,N.isFinite=Av,N.isFunction=Vt,N.isInteger=rl,N.isLength=mi,N.isMap=il,N.isMatch=Cv,N.isMatchWith=Ov,N.isNaN=Sv,N.isNative=Ev,N.isNil=Tv,N.isNull=Rv,N.isNumber=ol,N.isObject=ze,N.isObjectLike=Ve,N.isPlainObject=gr,N.isRegExp=Qo,N.isSafeInteger=Iv,N.isSet=sl,N.isString=yi,N.isSymbol=bt,N.isTypedArray=zn,N.isUndefined=_v,N.isWeakMap=Pv,N.isWeakSet=wv,N.join=Lp,N.kebabCase=bm,N.last=Pt,N.lastIndexOf=Np,N.lowerCase=Am,N.lowerFirst=Cm,N.lt=Mv,N.lte=xv,N.max=g0,N.maxBy=v0,N.mean=m0,N.meanBy=y0,N.min=b0,N.minBy=A0,N.stubArray=is,N.stubFalse=os,N.stubObject=o0,N.stubString=s0,N.stubTrue=a0,N.multiply=C0,N.nth=Dp,N.noConflict=Ym,N.noop=rs,N.now=pi,N.pad=Om,N.padEnd=Sm,N.padStart=Em,N.parseInt=Rm,N.random=pm,N.reduce=Fg,N.reduceRight=Gg,N.repeat=Tm,N.replace=Im,N.result=im,N.round=O0,N.runInContext=q,N.sample=kg,N.size=$g,N.snakeCase=_m,N.some=Vg,N.sortedIndex=Wp,N.sortedIndexBy=zp,N.sortedIndexOf=$p,N.sortedLastIndex=Vp,N.sortedLastIndexBy=jp,N.sortedLastIndexOf=Kp,N.startCase=wm,N.startsWith=Mm,N.subtract=S0,N.sum=E0,N.sumBy=R0,N.template=xm,N.times=u0,N.toFinite=jt,N.toInteger=Ee,N.toLength=ul,N.toLower=Lm,N.toNumber=wt,N.toSafeInteger=Lv,N.toString=De,N.toUpper=Nm,N.trim=Dm,N.trimEnd=Um,N.trimStart=Bm,N.truncate=Fm,N.unescape=Gm,N.uniqueId=c0,N.upperCase=Hm,N.upperFirst=Xo,N.each=Ju,N.eachRight=qu,N.first=$u,ns(N,function(){var e={};return Dt(N,function(t,o){Ue.call(N.prototype,o)||(e[o]=t)}),e}(),{chain:!1}),N.VERSION=r,Et(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){N[e].placeholder=N}),Et(["drop","take"],function(e,t){we.prototype[e]=function(o){o=o===h?1:Ze(Ee(o),0);var g=this.__filtered__&&!t?new we(this):this.clone();return g.__filtered__?g.__takeCount__=ot(o,g.__takeCount__):g.__views__.push({size:ot(o,ee),type:e+(g.__dir__<0?"Right":"")}),g},we.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Et(["filter","map","takeWhile"],function(e,t){var o=t+1,g=o==H||o==I;we.prototype[e]=function(w){var F=this.clone();return F.__iteratees__.push({iteratee:ye(w,3),type:o}),F.__filtered__=F.__filtered__||g,F}}),Et(["head","last"],function(e,t){var o="take"+(t?"Right":"");we.prototype[e]=function(){return this[o](1).value()[0]}}),Et(["initial","tail"],function(e,t){var o="drop"+(t?"":"Right");we.prototype[e]=function(){return this.__filtered__?new we(this):this[o](1)}}),we.prototype.compact=function(){return this.filter(pt)},we.prototype.find=function(e){return this.filter(e).head()},we.prototype.findLast=function(e){return this.reverse().find(e)},we.prototype.invokeMap=Ie(function(e,t){return typeof e=="function"?new we(this):this.map(function(o){return lr(o,e,t)})}),we.prototype.reject=function(e){return this.filter(vi(ye(e)))},we.prototype.slice=function(e,t){e=Ee(e);var o=this;return o.__filtered__&&(e>0||t<0)?new we(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),t!==h&&(t=Ee(t),o=t<0?o.dropRight(-t):o.take(t-e)),o)},we.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},we.prototype.toArray=function(){return this.take(ee)},Dt(we.prototype,function(e,t){var o=/^(?:filter|find|map|reject)|While$/.test(t),g=/^(?:head|last)$/.test(t),w=N[g?"take"+(t=="last"?"Right":""):t],F=g||/^find/.test(t);!w||(N.prototype[t]=function(){var $=this.__wrapped__,K=g?[1]:arguments,Y=$ instanceof we,oe=K[0],se=Y||Oe($),ae=function(Pe){var Me=w.apply(N,Zt([Pe],K));return g&&fe?Me[0]:Me};se&&o&&typeof oe=="function"&&oe.length!=1&&(Y=se=!1);var fe=this.__chain__,ge=!!this.__actions__.length,be=F&&!fe,Te=Y&&!ge;if(!F&&se){$=Te?$:new we(this);var Ae=e.apply($,K);return Ae.__actions__.push({func:di,args:[ae],thisArg:h}),new Tt(Ae,fe)}return be&&Te?e.apply(this,K):(Ae=this.thru(ae),be?g?Ae.value()[0]:Ae.value():Ae)})}),Et(["pop","push","shift","sort","splice","unshift"],function(e){var t=Fr[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",g=/^(?:pop|shift)$/.test(e);N.prototype[e]=function(){var w=arguments;if(g&&!this.__chain__){var F=this.value();return t.apply(Oe(F)?F:[],w)}return this[o](function($){return t.apply(Oe($)?$:[],w)})}}),Dt(we.prototype,function(e,t){var o=N[t];if(o){var g=o.name+"";Ue.call(Fn,g)||(Fn[g]=[]),Fn[g].push({name:t,func:o})}}),Fn[oi(h,P).name]=[{name:"wrapper",func:h}],we.prototype.clone=Gd,we.prototype.reverse=Hd,we.prototype.value=kd,N.prototype.at=vg,N.prototype.chain=mg,N.prototype.commit=yg,N.prototype.next=bg,N.prototype.plant=Cg,N.prototype.reverse=Og,N.prototype.toJSON=N.prototype.valueOf=N.prototype.value=Sg,N.prototype.first=N.prototype.head,nr&&(N.prototype[nr]=Ag),N},en=yd();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(tt._=en,define(function(){return en})):dn?((dn.exports=en)._=en,eo._=en):tt._=en}).call(Vn)});var _l=Je((sb,Il)=>{X();var jn=1e3,Kn=jn*60,Jn=Kn*60,Sn=Jn*24,N0=Sn*7,D0=Sn*365.25;Il.exports=function(h,r){r=r||{};var n=typeof h;if(n==="string"&&h.length>0)return U0(h);if(n==="number"&&isFinite(h))return r.long?F0(h):B0(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function U0(h){if(h=String(h),!(h.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(!!r){var n=parseFloat(r[1]),s=(r[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*D0;case"weeks":case"week":case"w":return n*N0;case"days":case"day":case"d":return n*Sn;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Jn;case"minutes":case"minute":case"mins":case"min":case"m":return n*Kn;case"seconds":case"second":case"secs":case"sec":case"s":return n*jn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function B0(h){var r=Math.abs(h);return r>=Sn?Math.round(h/Sn)+"d":r>=Jn?Math.round(h/Jn)+"h":r>=Kn?Math.round(h/Kn)+"m":r>=jn?Math.round(h/jn)+"s":h+"ms"}function F0(h){var r=Math.abs(h);return r>=Sn?Si(h,r,Sn,"day"):r>=Jn?Si(h,r,Jn,"hour"):r>=Kn?Si(h,r,Kn,"minute"):r>=jn?Si(h,r,jn,"second"):h+" ms"}function Si(h,r,n,s){var i=r>=n*1.5;return Math.round(h/n)+" "+s+(i?"s":"")}});var wl=Je((ab,Pl)=>{X();function G0(h){n.debug=n,n.default=n,n.coerce=f,n.disable=m,n.enable=i,n.enabled=y,n.humanize=_l(),n.destroy=C,Object.keys(h).forEach(E=>{n[E]=h[E]}),n.names=[],n.skips=[],n.formatters={};function r(E){let R=0;for(let a=0;a<E.length;a++)R=(R<<5)-R+E.charCodeAt(a),R|=0;return n.colors[Math.abs(R)%n.colors.length]}n.selectColor=r;function n(E){let R,a=null,S,M;function P(...O){if(!P.enabled)return;let b=P,T=Number(new Date),l=T-(R||T);b.diff=l,b.prev=R,b.curr=T,R=T,O[0]=n.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let v=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(p,u)=>{if(p==="%%")return"%";v++;let A=n.formatters[u];if(typeof A=="function"){let _=O[v];p=A.call(b,_),O.splice(v,1),v--}return p}),n.formatArgs.call(b,O),(b.log||n.log).apply(b,O)}return P.namespace=E,P.useColors=n.useColors(),P.color=n.selectColor(E),P.extend=s,P.destroy=n.destroy,Object.defineProperty(P,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(S!==n.namespaces&&(S=n.namespaces,M=n.enabled(E)),M),set:O=>{a=O}}),typeof n.init=="function"&&n.init(P),P}function s(E,R){let a=n(this.namespace+(typeof R=="undefined"?":":R)+E);return a.log=this.log,a}function i(E){n.save(E),n.namespaces=E,n.names=[],n.skips=[];let R,a=(typeof E=="string"?E:"").split(/[\s,]+/),S=a.length;for(R=0;R<S;R++)!a[R]||(E=a[R].replace(/\*/g,".*?"),E[0]==="-"?n.skips.push(new RegExp("^"+E.slice(1)+"$")):n.names.push(new RegExp("^"+E+"$")))}function m(){let E=[...n.names.map(c),...n.skips.map(c).map(R=>"-"+R)].join(",");return n.enable(""),E}function y(E){if(E[E.length-1]==="*")return!0;let R,a;for(R=0,a=n.skips.length;R<a;R++)if(n.skips[R].test(E))return!1;for(R=0,a=n.names.length;R<a;R++)if(n.names[R].test(E))return!0;return!1}function c(E){return E.toString().substring(2,E.toString().length-2).replace(/\.\*\?$/,"*")}function f(E){return E instanceof Error?E.stack||E.message:E}function C(){}return n.enable(n.load()),n}Pl.exports=G0});var ls=Je((Ot,Ei)=>{X();Ot.formatArgs=k0;Ot.save=W0;Ot.load=z0;Ot.useColors=H0;Ot.storage=$0();Ot.destroy=(()=>{let h=!1;return()=>{h||(h=!0)}})();Ot.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function H0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function k0(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+Ei.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;h.splice(1,0,r,"color: inherit");let n=0,s=0;h[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(n++,i==="%c"&&(s=n))}),h.splice(s,0,r)}Ot.log=console.debug||console.log||(()=>{});function W0(h){try{h?Ot.storage.setItem("debug",h):Ot.storage.removeItem("debug")}catch(r){}}function z0(){let h;try{h=Ot.storage.getItem("debug")}catch(r){}return!h&&typeof process!="undefined"&&"env"in process&&(h=ce.DEBUG),h}function $0(){try{return localStorage}catch(h){}}Ei.exports=wl()(Ot);var{formatters:V0}=Ei.exports;V0.j=function(h){try{return JSON.stringify(h)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}});var Ri=Je((lb,xl)=>{X();function j0(h){var r=typeof h;return h!=null&&(r=="object"||r=="function")}xl.exports=j0});var Nl=Je((cb,Ll)=>{X();var K0=typeof global=="object"&&global&&global.Object===Object&&global;Ll.exports=K0});var cs=Je((fb,Dl)=>{X();var J0=Nl(),q0=typeof self=="object"&&self&&self.Object===Object&&self,Q0=J0||q0||Function("return this")();Dl.exports=Q0});var Bl=Je((db,Ul)=>{X();var Y0=cs(),Z0=function(){return Y0.Date.now()};Ul.exports=Z0});var Gl=Je((hb,Fl)=>{X();var X0=/\s/;function ey(h){for(var r=h.length;r--&&X0.test(h.charAt(r)););return r}Fl.exports=ey});var kl=Je((pb,Hl)=>{X();var ty=Gl(),ny=/^\s+/;function ry(h){return h&&h.slice(0,ty(h)+1).replace(ny,"")}Hl.exports=ry});var fs=Je((gb,Wl)=>{X();var iy=cs(),oy=iy.Symbol;Wl.exports=oy});var jl=Je((vb,Vl)=>{X();var zl=fs(),$l=Object.prototype,sy=$l.hasOwnProperty,ay=$l.toString,Ar=zl?zl.toStringTag:void 0;function uy(h){var r=sy.call(h,Ar),n=h[Ar];try{h[Ar]=void 0;var s=!0}catch(m){}var i=ay.call(h);return s&&(r?h[Ar]=n:delete h[Ar]),i}Vl.exports=uy});var Jl=Je((mb,Kl)=>{X();var ly=Object.prototype,cy=ly.toString;function fy(h){return cy.call(h)}Kl.exports=fy});var Zl=Je((yb,Yl)=>{X();var ql=fs(),dy=jl(),hy=Jl(),py="[object Null]",gy="[object Undefined]",Ql=ql?ql.toStringTag:void 0;function vy(h){return h==null?h===void 0?gy:py:Ql&&Ql in Object(h)?dy(h):hy(h)}Yl.exports=vy});var ec=Je((bb,Xl)=>{X();function my(h){return h!=null&&typeof h=="object"}Xl.exports=my});var nc=Je((Ab,tc)=>{X();var yy=Zl(),by=ec(),Ay="[object Symbol]";function Cy(h){return typeof h=="symbol"||by(h)&&yy(h)==Ay}tc.exports=Cy});var sc=Je((Cb,oc)=>{X();var Oy=kl(),rc=Ri(),Sy=nc(),ic=0/0,Ey=/^[-+]0x[0-9a-f]+$/i,Ry=/^0b[01]+$/i,Ty=/^0o[0-7]+$/i,Iy=parseInt;function _y(h){if(typeof h=="number")return h;if(Sy(h))return ic;if(rc(h)){var r=typeof h.valueOf=="function"?h.valueOf():h;h=rc(r)?r+"":r}if(typeof h!="string")return h===0?h:+h;h=Oy(h);var n=Ry.test(h);return n||Ty.test(h)?Iy(h.slice(2),n?2:8):Ey.test(h)?ic:+h}oc.exports=_y});var lc=Je((Ob,uc)=>{X();var Py=Ri(),ds=Bl(),ac=sc(),wy="Expected a function",My=Math.max,xy=Math.min;function Ly(h,r,n){var s,i,m,y,c,f,C=0,E=!1,R=!1,a=!0;if(typeof h!="function")throw new TypeError(wy);r=ac(r)||0,Py(n)&&(E=!!n.leading,R="maxWait"in n,m=R?My(ac(n.maxWait)||0,r):m,a="trailing"in n?!!n.trailing:a);function S(p){var u=s,A=i;return s=i=void 0,C=p,y=h.apply(A,u),y}function M(p){return C=p,c=setTimeout(b,r),E?S(p):y}function P(p){var u=p-f,A=p-C,_=r-u;return R?xy(_,m-A):_}function O(p){var u=p-f,A=p-C;return f===void 0||u>=r||u<0||R&&A>=m}function b(){var p=ds();if(O(p))return T(p);c=setTimeout(b,P(p))}function T(p){return c=void 0,a&&s?S(p):(s=i=void 0,y)}function l(){c!==void 0&&clearTimeout(c),C=0,s=f=i=c=void 0}function v(){return c===void 0?y:T(ds())}function d(){var p=ds(),u=O(p);if(s=arguments,i=this,f=p,u){if(c===void 0)return M(f);if(R)return clearTimeout(c),c=setTimeout(b,r),S(f)}return c===void 0&&(c=setTimeout(b,r)),y}return d.cancel=l,d.flush=v,d}uc.exports=Ly});var hs=Je((Sb,cc)=>{X();var Ny=lc(),Dy=Ri(),Uy="Expected a function";function By(h,r,n){var s=!0,i=!0;if(typeof h!="function")throw new TypeError(Uy);return Dy(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),Ny(h,r,{leading:s,maxWait:r,trailing:i})}cc.exports=By});var dc=Je((Cr,ps)=>{X();(function(h,r){typeof Cr=="object"&&typeof ps=="object"?ps.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Cr=="object"?Cr.bowser=r():h.bowser=r()})(Cr,function(){return function(h){var r={};function n(s){if(r[s])return r[s].exports;var i=r[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=r,n.d=function(s,i,m){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:m})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(1&i&&(s=n(s)),8&i||4&i&&typeof s=="object"&&s&&s.__esModule)return s;var m=Object.create(null);if(n.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:s}),2&i&&typeof s!="string")for(var y in s)n.d(m,y,function(c){return s[c]}.bind(null,y));return m},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=90)}({17:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=n(18),i=function(){function m(){}return m.getFirstMatch=function(y,c){var f=c.match(y);return f&&f.length>0&&f[1]||""},m.getSecondMatch=function(y,c){var f=c.match(y);return f&&f.length>1&&f[2]||""},m.matchAndReturnConst=function(y,c,f){if(y.test(c))return f},m.getWindowsVersionName=function(y){switch(y){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},m.getMacOSVersionName=function(y){var c=y.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(c.push(0),c[0]===10)switch(c[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},m.getAndroidVersionName=function(y){var c=y.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(c.push(0),!(c[0]===1&&c[1]<5))return c[0]===1&&c[1]<6?"Cupcake":c[0]===1&&c[1]>=6?"Donut":c[0]===2&&c[1]<2?"Eclair":c[0]===2&&c[1]===2?"Froyo":c[0]===2&&c[1]>2?"Gingerbread":c[0]===3?"Honeycomb":c[0]===4&&c[1]<1?"Ice Cream Sandwich":c[0]===4&&c[1]<4?"Jelly Bean":c[0]===4&&c[1]>=4?"KitKat":c[0]===5?"Lollipop":c[0]===6?"Marshmallow":c[0]===7?"Nougat":c[0]===8?"Oreo":c[0]===9?"Pie":void 0},m.getVersionPrecision=function(y){return y.split(".").length},m.compareVersions=function(y,c,f){f===void 0&&(f=!1);var C=m.getVersionPrecision(y),E=m.getVersionPrecision(c),R=Math.max(C,E),a=0,S=m.map([y,c],function(M){var P=R-m.getVersionPrecision(M),O=M+new Array(P+1).join(".0");return m.map(O.split("."),function(b){return new Array(20-b.length).join("0")+b}).reverse()});for(f&&(a=R-Math.min(C,E)),R-=1;R>=a;){if(S[0][R]>S[1][R])return 1;if(S[0][R]===S[1][R]){if(R===a)return 0;R-=1}else if(S[0][R]<S[1][R])return-1}},m.map=function(y,c){var f,C=[];if(Array.prototype.map)return Array.prototype.map.call(y,c);for(f=0;f<y.length;f+=1)C.push(c(y[f]));return C},m.find=function(y,c){var f,C;if(Array.prototype.find)return Array.prototype.find.call(y,c);for(f=0,C=y.length;f<C;f+=1){var E=y[f];if(c(E,f))return E}},m.assign=function(y){for(var c,f,C=y,E=arguments.length,R=new Array(E>1?E-1:0),a=1;a<E;a++)R[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[y].concat(R));var S=function(){var M=R[c];typeof M=="object"&&M!==null&&Object.keys(M).forEach(function(P){C[P]=M[P]})};for(c=0,f=R.length;c<f;c+=1)S();return y},m.getBrowserAlias=function(y){return s.BROWSER_ALIASES_MAP[y]},m.getBrowserTypeByAlias=function(y){return s.BROWSER_MAP[y]||""},m}();r.default=i,h.exports=r.default},18:function(h,r,n){"use strict";r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(91))&&s.__esModule?s:{default:s},m=n(18);function y(f,C){for(var E=0;E<C.length;E++){var R=C[E];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(f,R.key,R)}}var c=function(){function f(){}var C,E,R;return f.getParser=function(a,S){if(S===void 0&&(S=!1),typeof a!="string")throw new Error("UserAgent should be a string");return new i.default(a,S)},f.parse=function(a){return new i.default(a).getResult()},C=f,R=[{key:"BROWSER_MAP",get:function(){return m.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return m.ENGINE_MAP}},{key:"OS_MAP",get:function(){return m.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return m.PLATFORMS_MAP}}],(E=null)&&y(C.prototype,E),R&&y(C,R),f}();r.default=c,h.exports=r.default},91:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=f(n(92)),i=f(n(93)),m=f(n(94)),y=f(n(95)),c=f(n(17));function f(E){return E&&E.__esModule?E:{default:E}}var C=function(){function E(a,S){if(S===void 0&&(S=!1),a==null||a==="")throw new Error("UserAgent parameter can't be empty");this._ua=a,this.parsedResult={},S!==!0&&this.parse()}var R=E.prototype;return R.getUA=function(){return this._ua},R.test=function(a){return a.test(this._ua)},R.parseBrowser=function(){var a=this;this.parsedResult.browser={};var S=c.default.find(s.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.browser=S.describe(this.getUA())),this.parsedResult.browser},R.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},R.getBrowserName=function(a){return a?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},R.getBrowserVersion=function(){return this.getBrowser().version},R.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},R.parseOS=function(){var a=this;this.parsedResult.os={};var S=c.default.find(i.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.os=S.describe(this.getUA())),this.parsedResult.os},R.getOSName=function(a){var S=this.getOS().name;return a?String(S).toLowerCase()||"":S||""},R.getOSVersion=function(){return this.getOS().version},R.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},R.getPlatformType=function(a){a===void 0&&(a=!1);var S=this.getPlatform().type;return a?String(S).toLowerCase()||"":S||""},R.parsePlatform=function(){var a=this;this.parsedResult.platform={};var S=c.default.find(m.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.platform=S.describe(this.getUA())),this.parsedResult.platform},R.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},R.getEngineName=function(a){return a?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},R.parseEngine=function(){var a=this;this.parsedResult.engine={};var S=c.default.find(y.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(P){return a.test(P)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.engine=S.describe(this.getUA())),this.parsedResult.engine},R.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},R.getResult=function(){return c.default.assign({},this.parsedResult)},R.satisfies=function(a){var S=this,M={},P=0,O={},b=0;if(Object.keys(a).forEach(function(_){var L=a[_];typeof L=="string"?(O[_]=L,b+=1):typeof L=="object"&&(M[_]=L,P+=1)}),P>0){var T=Object.keys(M),l=c.default.find(T,function(_){return S.isOS(_)});if(l){var v=this.satisfies(M[l]);if(v!==void 0)return v}var d=c.default.find(T,function(_){return S.isPlatform(_)});if(d){var p=this.satisfies(M[d]);if(p!==void 0)return p}}if(b>0){var u=Object.keys(O),A=c.default.find(u,function(_){return S.isBrowser(_,!0)});if(A!==void 0)return this.compareVersion(O[A])}},R.isBrowser=function(a,S){S===void 0&&(S=!1);var M=this.getBrowserName().toLowerCase(),P=a.toLowerCase(),O=c.default.getBrowserTypeByAlias(P);return S&&O&&(P=O.toLowerCase()),P===M},R.compareVersion=function(a){var S=[0],M=a,P=!1,O=this.getBrowserVersion();if(typeof O=="string")return a[0]===">"||a[0]==="<"?(M=a.substr(1),a[1]==="="?(P=!0,M=a.substr(2)):S=[],a[0]===">"?S.push(1):S.push(-1)):a[0]==="="?M=a.substr(1):a[0]==="~"&&(P=!0,M=a.substr(1)),S.indexOf(c.default.compareVersions(O,M,P))>-1},R.isOS=function(a){return this.getOSName(!0)===String(a).toLowerCase()},R.isPlatform=function(a){return this.getPlatformType(!0)===String(a).toLowerCase()},R.isEngine=function(a){return this.getEngineName(!0)===String(a).toLowerCase()},R.is=function(a,S){return S===void 0&&(S=!1),this.isBrowser(a,S)||this.isOS(a)||this.isPlatform(a)},R.some=function(a){var S=this;return a===void 0&&(a=[]),a.some(function(M){return S.is(M)})},E}();r.default=C,h.exports=r.default},92:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=/version\/(\d+(\.?_?\d+)+)/i,y=[{test:[/googlebot/i],describe:function(c){var f={name:"Googlebot"},C=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/opera/i],describe:function(c){var f={name:"Opera"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/opr\/|opios/i],describe:function(c){var f={name:"Opera"},C=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/SamsungBrowser/i],describe:function(c){var f={name:"Samsung Internet for Android"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/Whale/i],describe:function(c){var f={name:"NAVER Whale Browser"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/MZBrowser/i],describe:function(c){var f={name:"MZ Browser"},C=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/focus/i],describe:function(c){var f={name:"Focus"},C=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/swing/i],describe:function(c){var f={name:"Swing"},C=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/coast/i],describe:function(c){var f={name:"Opera Coast"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(c){var f={name:"Opera Touch"},C=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/yabrowser/i],describe:function(c){var f={name:"Yandex Browser"},C=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/ucbrowser/i],describe:function(c){var f={name:"UC Browser"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/Maxthon|mxios/i],describe:function(c){var f={name:"Maxthon"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/epiphany/i],describe:function(c){var f={name:"Epiphany"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/puffin/i],describe:function(c){var f={name:"Puffin"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/sleipnir/i],describe:function(c){var f={name:"Sleipnir"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/k-meleon/i],describe:function(c){var f={name:"K-Meleon"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/micromessenger/i],describe:function(c){var f={name:"WeChat"},C=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/qqbrowser/i],describe:function(c){var f={name:/qqbrowserlite/i.test(c)?"QQ Browser Lite":"QQ Browser"},C=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/msie|trident/i],describe:function(c){var f={name:"Internet Explorer"},C=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/\sedg\//i],describe:function(c){var f={name:"Microsoft Edge"},C=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/edg([ea]|ios)/i],describe:function(c){var f={name:"Microsoft Edge"},C=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/vivaldi/i],describe:function(c){var f={name:"Vivaldi"},C=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/seamonkey/i],describe:function(c){var f={name:"SeaMonkey"},C=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/sailfish/i],describe:function(c){var f={name:"Sailfish"},C=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,c);return C&&(f.version=C),f}},{test:[/silk/i],describe:function(c){var f={name:"Amazon Silk"},C=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/phantom/i],describe:function(c){var f={name:"PhantomJS"},C=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/slimerjs/i],describe:function(c){var f={name:"SlimerJS"},C=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var f={name:"BlackBerry"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var f={name:"WebOS Browser"},C=i.default.getFirstMatch(m,c)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/bada/i],describe:function(c){var f={name:"Bada"},C=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/tizen/i],describe:function(c){var f={name:"Tizen"},C=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/qupzilla/i],describe:function(c){var f={name:"QupZilla"},C=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(c){var f={name:"Firefox"},C=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/electron/i],describe:function(c){var f={name:"Electron"},C=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/MiuiBrowser/i],describe:function(c){var f={name:"Miui"},C=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/chromium/i],describe:function(c){var f={name:"Chromium"},C=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/chrome|crios|crmo/i],describe:function(c){var f={name:"Chrome"},C=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/GSA/i],describe:function(c){var f={name:"Google Search"},C=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:function(c){var f=!c.test(/like android/i),C=c.test(/android/i);return f&&C},describe:function(c){var f={name:"Android Browser"},C=i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/playstation 4/i],describe:function(c){var f={name:"PlayStation 4"},C=i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/safari|applewebkit/i],describe:function(c){var f={name:"Safari"},C=i.default.getFirstMatch(m,c);return C&&(f.version=C),f}},{test:[/.*/i],describe:function(c){var f=c.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(f,c),version:i.default.getSecondMatch(f,c)}}}];r.default=y,h.exports=r.default},93:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:[/Roku\/DVP/],describe:function(c){var f=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,c);return{name:m.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(c){var f=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,c);return{name:m.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(c){var f=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,c),C=i.default.getWindowsVersionName(f);return{name:m.OS_MAP.Windows,version:f,versionName:C}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(c){var f={name:m.OS_MAP.iOS},C=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,c);return C&&(f.version=C),f}},{test:[/macintosh/i],describe:function(c){var f=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,c).replace(/[_\s]/g,"."),C=i.default.getMacOSVersionName(f),E={name:m.OS_MAP.MacOS,version:f};return C&&(E.versionName=C),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(c){var f=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,c).replace(/[_\s]/g,".");return{name:m.OS_MAP.iOS,version:f}}},{test:function(c){var f=!c.test(/like android/i),C=c.test(/android/i);return f&&C},describe:function(c){var f=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,c),C=i.default.getAndroidVersionName(f),E={name:m.OS_MAP.Android,version:f};return C&&(E.versionName=C),E}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var f=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,c),C={name:m.OS_MAP.WebOS};return f&&f.length&&(C.version=f),C}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var f=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,c)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,c)||i.default.getFirstMatch(/\bbb(\d+)/i,c);return{name:m.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(c){var f=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,c);return{name:m.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(c){var f=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,c);return{name:m.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:m.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:m.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(c){var f=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,c);return{name:m.OS_MAP.PlayStation4,version:f}}}];r.default=y,h.exports=r.default},94:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(c){var f=i.default.getFirstMatch(/(can-l01)/i,c)&&"Nova",C={type:m.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(C.model=f),C}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(c){var f=c.test(/ipod|iphone/i),C=c.test(/like (ipod|iphone)/i);return f&&!C},describe:function(c){var f=i.default.getFirstMatch(/(ipod|iphone)/i,c);return{type:m.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName(!0)==="blackberry"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(c){return c.getBrowserName(!0)==="bada"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName()==="windows phone"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(c){var f=Number(String(c.getOSVersion()).split(".")[0]);return c.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(c){return c.getOSName(!0)==="android"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getOSName(!0)==="macos"},describe:function(){return{type:m.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(c){return c.getOSName(!0)==="windows"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="linux"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="playstation 4"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}},{test:function(c){return c.getOSName(!0)==="roku"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}}];r.default=y,h.exports=r.default},95:function(h,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},m=n(18),y=[{test:function(c){return c.getBrowserName(!0)==="microsoft edge"},describe:function(c){if(/\sedg\//i.test(c))return{name:m.ENGINE_MAP.Blink};var f=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,c);return{name:m.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(c){var f={name:m.ENGINE_MAP.Trident},C=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:function(c){return c.test(/presto/i)},describe:function(c){var f={name:m.ENGINE_MAP.Presto},C=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:function(c){var f=c.test(/gecko/i),C=c.test(/like gecko/i);return f&&!C},describe:function(c){var f={name:m.ENGINE_MAP.Gecko},C=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:m.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(c){var f={name:m.ENGINE_MAP.WebKit},C=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,c);return C&&(f.version=C),f}}];r.default=y,h.exports=r.default}})})});var mc={};Rl(mc,{version:()=>Wy});var Wy,yc=ss(()=>{X();Wy="lab"});var bc={};Rl(bc,{remoteConfig:()=>zy});var zy,Ac=ss(()=>{X();zy={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});var Cc=Je((Mi,ms)=>{X();(function(r,n){typeof Mi=="object"&&typeof ms=="object"?ms.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Mi=="object"?Mi.Ably=n():r.Ably=n()})(window,function(){return function(h){var r={};function n(s){if(r[s])return r[s].exports;var i=r[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=r,n.d=function(s,i,m){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:m})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(i&1&&(s=n(s)),i&8||i&4&&typeof s=="object"&&s&&s.__esModule)return s;var m=Object.create(null);if(n.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:s}),i&2&&typeof s!="string")for(var y in s)n.d(m,y,function(c){return s[c]}.bind(null,y));return m},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=41)}([function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(){}return i}();r.default=s},function(h,r,n){"use strict";n.r(r),n.d(r,"__extends",function(){return i}),n.d(r,"__assign",function(){return m}),n.d(r,"__rest",function(){return y}),n.d(r,"__decorate",function(){return c}),n.d(r,"__param",function(){return f}),n.d(r,"__metadata",function(){return C}),n.d(r,"__awaiter",function(){return E}),n.d(r,"__generator",function(){return R}),n.d(r,"__createBinding",function(){return a}),n.d(r,"__exportStar",function(){return S}),n.d(r,"__values",function(){return M}),n.d(r,"__read",function(){return P}),n.d(r,"__spread",function(){return O}),n.d(r,"__spreadArrays",function(){return b}),n.d(r,"__spreadArray",function(){return T}),n.d(r,"__await",function(){return l}),n.d(r,"__asyncGenerator",function(){return v}),n.d(r,"__asyncDelegator",function(){return d}),n.d(r,"__asyncValues",function(){return p}),n.d(r,"__makeTemplateObject",function(){return u}),n.d(r,"__importStar",function(){return _}),n.d(r,"__importDefault",function(){return L}),n.d(r,"__classPrivateFieldGet",function(){return W}),n.d(r,"__classPrivateFieldSet",function(){return H});var s=function(U,I){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,z){x.__proto__=z}||function(x,z){for(var k in z)Object.prototype.hasOwnProperty.call(z,k)&&(x[k]=z[k])},s(U,I)};function i(U,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");s(U,I);function x(){this.constructor=U}U.prototype=I===null?Object.create(I):(x.prototype=I.prototype,new x)}var m=function(){return m=Object.assign||function(I){for(var x,z=1,k=arguments.length;z<k;z++){x=arguments[z];for(var J in x)Object.prototype.hasOwnProperty.call(x,J)&&(I[J]=x[J])}return I},m.apply(this,arguments)};function y(U,I){var x={};for(var z in U)Object.prototype.hasOwnProperty.call(U,z)&&I.indexOf(z)<0&&(x[z]=U[z]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,z=Object.getOwnPropertySymbols(U);k<z.length;k++)I.indexOf(z[k])<0&&Object.prototype.propertyIsEnumerable.call(U,z[k])&&(x[z[k]]=U[z[k]]);return x}function c(U,I,x,z){var k=arguments.length,J=k<3?I:z===null?z=Object.getOwnPropertyDescriptor(I,x):z,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(U,I,x,z);else for(var Q=U.length-1;Q>=0;Q--)(ee=U[Q])&&(J=(k<3?ee(J):k>3?ee(I,x,J):ee(I,x))||J);return k>3&&J&&Object.defineProperty(I,x,J),J}function f(U,I){return function(x,z){I(x,z,U)}}function C(U,I){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(U,I)}function E(U,I,x,z){function k(J){return J instanceof x?J:new x(function(ee){ee(J)})}return new(x||(x=Promise))(function(J,ee){function Q(B){try{D(z.next(B))}catch(j){ee(j)}}function G(B){try{D(z.throw(B))}catch(j){ee(j)}}function D(B){B.done?J(B.value):k(B.value).then(Q,G)}D((z=z.apply(U,I||[])).next())})}function R(U,I){var x={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},z,k,J,ee;return ee={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function Q(D){return function(B){return G([D,B])}}function G(D){if(z)throw new TypeError("Generator is already executing.");for(;x;)try{if(z=1,k&&(J=D[0]&2?k.return:D[0]?k.throw||((J=k.return)&&J.call(k),0):k.next)&&!(J=J.call(k,D[1])).done)return J;switch(k=0,J&&(D=[D[0]&2,J.value]),D[0]){case 0:case 1:J=D;break;case 4:return x.label++,{value:D[1],done:!1};case 5:x.label++,k=D[1],D=[0];continue;case 7:D=x.ops.pop(),x.trys.pop();continue;default:if(J=x.trys,!(J=J.length>0&&J[J.length-1])&&(D[0]===6||D[0]===2)){x=0;continue}if(D[0]===3&&(!J||D[1]>J[0]&&D[1]<J[3])){x.label=D[1];break}if(D[0]===6&&x.label<J[1]){x.label=J[1],J=D;break}if(J&&x.label<J[2]){x.label=J[2],x.ops.push(D);break}J[2]&&x.ops.pop(),x.trys.pop();continue}D=I.call(U,x)}catch(B){D=[6,B],k=0}finally{z=J=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var a=Object.create?function(U,I,x,z){z===void 0&&(z=x),Object.defineProperty(U,z,{enumerable:!0,get:function(){return I[x]}})}:function(U,I,x,z){z===void 0&&(z=x),U[z]=I[x]};function S(U,I){for(var x in U)x!=="default"&&!Object.prototype.hasOwnProperty.call(I,x)&&a(I,U,x)}function M(U){var I=typeof Symbol=="function"&&Symbol.iterator,x=I&&U[I],z=0;if(x)return x.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&z>=U.length&&(U=void 0),{value:U&&U[z++],done:!U}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(U,I){var x=typeof Symbol=="function"&&U[Symbol.iterator];if(!x)return U;var z=x.call(U),k,J=[],ee;try{for(;(I===void 0||I-- >0)&&!(k=z.next()).done;)J.push(k.value)}catch(Q){ee={error:Q}}finally{try{k&&!k.done&&(x=z.return)&&x.call(z)}finally{if(ee)throw ee.error}}return J}function O(){for(var U=[],I=0;I<arguments.length;I++)U=U.concat(P(arguments[I]));return U}function b(){for(var U=0,I=0,x=arguments.length;I<x;I++)U+=arguments[I].length;for(var z=Array(U),k=0,I=0;I<x;I++)for(var J=arguments[I],ee=0,Q=J.length;ee<Q;ee++,k++)z[k]=J[ee];return z}function T(U,I,x){if(x||arguments.length===2)for(var z=0,k=I.length,J;z<k;z++)(J||!(z in I))&&(J||(J=Array.prototype.slice.call(I,0,z)),J[z]=I[z]);return U.concat(J||Array.prototype.slice.call(I))}function l(U){return this instanceof l?(this.v=U,this):new l(U)}function v(U,I,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=x.apply(U,I||[]),k,J=[];return k={},ee("next"),ee("throw"),ee("return"),k[Symbol.asyncIterator]=function(){return this},k;function ee(V){z[V]&&(k[V]=function(te){return new Promise(function(le,me){J.push([V,te,le,me])>1||Q(V,te)})})}function Q(V,te){try{G(z[V](te))}catch(le){j(J[0][3],le)}}function G(V){V.value instanceof l?Promise.resolve(V.value.v).then(D,B):j(J[0][2],V)}function D(V){Q("next",V)}function B(V){Q("throw",V)}function j(V,te){V(te),J.shift(),J.length&&Q(J[0][0],J[0][1])}}function d(U){var I,x;return I={},z("next"),z("throw",function(k){throw k}),z("return"),I[Symbol.iterator]=function(){return this},I;function z(k,J){I[k]=U[k]?function(ee){return(x=!x)?{value:l(U[k](ee)),done:k==="return"}:J?J(ee):ee}:J}}function p(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I=U[Symbol.asyncIterator],x;return I?I.call(U):(U=typeof M=="function"?M(U):U[Symbol.iterator](),x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x);function z(J){x[J]=U[J]&&function(ee){return new Promise(function(Q,G){ee=U[J](ee),k(Q,G,ee.done,ee.value)})}}function k(J,ee,Q,G){Promise.resolve(G).then(function(D){J({value:D,done:Q})},ee)}}function u(U,I){return Object.defineProperty?Object.defineProperty(U,"raw",{value:I}):U.raw=I,U}var A=Object.create?function(U,I){Object.defineProperty(U,"default",{enumerable:!0,value:I})}:function(U,I){U.default=I};function _(U){if(U&&U.__esModule)return U;var I={};if(U!=null)for(var x in U)x!=="default"&&Object.prototype.hasOwnProperty.call(U,x)&&a(I,U,x);return A(I,U),I}function L(U){return U&&U.__esModule?U:{default:U}}function W(U,I,x,z){if(x==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof I=="function"?U!==I||!z:!I.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?z:x==="a"?z.call(U):z?z.value:I.get(U)}function H(U,I,x,z,k){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!k)throw new TypeError("Private accessor was defined without a setter");if(typeof I=="function"?U!==I||!k:!I.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?k.call(U,x):k?k.value=x:I.set(U,x),x}},function(h,r,n){"use strict";(function(s){r.__esModule=!0,r.allToUpperCase=r.allToLowerCase=r.encodeBody=r.decodeBody=r.Format=r.promisify=r.trim=r.arrChooseN=r.randomHexString=r.randomString=r.cheapRandStr=r.dataSizeBytes=r.inspectBody=r.inspectError=r.isErrorInfo=r.now=r.parseQueryString=r.toQueryString=r.arrPopRandomElement=r.defaultPostHeaders=r.defaultGetHeaders=r.allSame=r.arrEvery=r.arrFilter=r.arrMap=r.safeArrForEach=r.arrForEach=r.forInOwnNonNullProperties=r.valuesArray=r.keysArray=r.arrWithoutValue=r.arrDeleteValue=r.arrIn=r.arrIndexOf=r.arrSubtract=r.arrIntersectOb=r.arrIntersect=r.intersect=r.containsValue=r.inherits=r.prototypicalClone=r.shallowClone=r.isEmptyArg=r.isOnlyPropIn=r.isEmpty=r.isObject=r.ensureArray=r.isArray=r.copy=r.mixin=void 0,r.getGlobalObject=r.getJitterCoefficient=r.getBackoffCoefficient=void 0;var i=n(1),m=i.__importDefault(n(0)),y=i.__importDefault(n(8));function c(Z){return Math.floor(Math.random()*Z.length)}function f(Z){for(var ie=[],ue=1;ue<arguments.length;ue++)ie[ue-1]=arguments[ue];for(var pe=0;pe<ie.length;pe++){var Re=ie[pe];if(!Re)break;var qe=Object.prototype.hasOwnProperty;for(var fn in Re)(!qe||qe.call(Re,fn))&&(Z[fn]=Re[fn])}return Z}r.mixin=f;function C(Z){return f({},Z)}r.copy=C,r.isArray=Array.isArray||function(Z){return Object.prototype.toString.call(Z)=="[object Array]"};function E(Z){return M(Z)?[]:r.isArray(Z)?Z:[Z]}r.ensureArray=E;function R(Z){return Object.prototype.toString.call(Z)=="[object Object]"}r.isObject=R;function a(Z){for(var ie in Z)return!1;return!0}r.isEmpty=a;function S(Z,ie){for(var ue in Z)if(ue!==ie)return!1;return!0}r.isOnlyPropIn=S;function M(Z){return Z==null}r.isEmptyArg=M;function P(Z){var ie=new Object;for(var ue in Z)ie[ue]=Z[ue];return ie}r.shallowClone=P;function O(Z,ie){var ue=function(){function Re(){}return Re}();ue.prototype=Z;var pe=new ue;return ie&&f(pe,ie),pe}r.prototypicalClone=O;var b=function(Z,ie){if(m.default.Config.inherits){m.default.Config.inherits(Z,ie);return}Z.super_=ie,Z.prototype=O(ie.prototype,{constructor:Z})};r.inherits=b;function T(Z,ie){for(var ue in Z)if(Z[ue]==ie)return!0;return!1}r.containsValue=T;function l(Z,ie){return r.isArray(ie)?v(Z,ie):d(Z,ie)}r.intersect=l;function v(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];r.arrIndexOf(ie,Re)!=-1&&ue.push(Re)}return ue}r.arrIntersect=v;function d(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];Re in ie&&ue.push(Re)}return ue}r.arrIntersectOb=d;function p(Z,ie){for(var ue=[],pe=0;pe<Z.length;pe++){var Re=Z[pe];r.arrIndexOf(ie,Re)==-1&&ue.push(Re)}return ue}r.arrSubtract=p,r.arrIndexOf=Array.prototype.indexOf?function(Z,ie,ue){return Z.indexOf(ie,ue)}:function(Z,ie,ue){ue=ue||0;for(var pe=Z.length;ue<pe;ue++)if(Z[ue]===ie)return ue;return-1};function u(Z,ie){return r.arrIndexOf(Z,ie)!==-1}r.arrIn=u;function A(Z,ie){var ue=r.arrIndexOf(Z,ie),pe=ue!=-1;return pe&&Z.splice(ue,1),pe}r.arrDeleteValue=A;function _(Z,ie){var ue=Z.slice();return A(ue,ie),ue}r.arrWithoutValue=_;function L(Z,ie){var ue=[];for(var pe in Z)ie&&!Object.prototype.hasOwnProperty.call(Z,pe)||ue.push(pe);return ue}r.keysArray=L;function W(Z,ie){var ue=[];for(var pe in Z)ie&&!Object.prototype.hasOwnProperty.call(Z,pe)||ue.push(Z[pe]);return ue}r.valuesArray=W;function H(Z,ie){for(var ue in Z)Object.prototype.hasOwnProperty.call(Z,ue)&&Z[ue]&&ie(ue)}r.forInOwnNonNullProperties=H,r.arrForEach=Array.prototype.forEach?function(Z,ie){Z.forEach(ie)}:function(Z,ie){for(var ue=Z.length,pe=0;pe<ue;pe++)ie(Z[pe],pe,Z)};function U(Z,ie){return r.arrForEach(Z.slice(),ie)}r.safeArrForEach=U,r.arrMap=Array.prototype.map?function(Z,ie){return Z.map(ie)}:function(Z,ie){for(var ue=[],pe=Z.length,Re=0;Re<pe;Re++)ue.push(ie(Z[Re],Re,Z));return ue},r.arrFilter=Array.prototype.filter?function(Z,ie){return Z.filter(ie)}:function(Z,ie){for(var ue=[],pe=Z.length,Re=0;Re<pe;Re++)ie(Z[Re])&&ue.push(Z[Re]);return ue},r.arrEvery=Array.prototype.every?function(Z,ie){return Z.every(ie)}:function(Z,ie){for(var ue=Z.length,pe=0;pe<ue;pe++)if(!ie(Z[pe],pe,Z))return!1;return!0};function I(Z,ie){if(Z.length===0)return!0;var ue=Z[0][ie];return r.arrEvery(Z,function(pe){return pe[ie]===ue})}r.allSame=I;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(Z){var ie=x[Z||Se.json];return{accept:ie,"X-Ably-Version":y.default.apiVersion,"Ably-Agent":y.default.agent}}r.defaultGetHeaders=z;function k(Z){var ie,ue=ie=x[Z||Se.json];return{accept:ue,"content-type":ie,"X-Ably-Version":y.default.apiVersion,"Ably-Agent":y.default.agent}}r.defaultPostHeaders=k;function J(Z){return Z.splice(c(Z),1)[0]}r.arrPopRandomElement=J;function ee(Z){var ie=[];if(Z)for(var ue in Z)ie.push(encodeURIComponent(ue)+"="+encodeURIComponent(Z[ue]));return ie.length?"?"+ie.join("&"):""}r.toQueryString=ee;function Q(Z){for(var ie,ue=/([^?&=]+)=?([^&]*)/g,pe={};ie=ue.exec(Z);)pe[decodeURIComponent(ie[1])]=decodeURIComponent(ie[2]);return pe}r.parseQueryString=Q,r.now=Date.now||function(){return new Date().getTime()};function G(Z){return Z.constructor.name=="ErrorInfo"}r.isErrorInfo=G;function D(Z){var ie,ue;return Z instanceof Error||((ue=(ie=Z)===null||ie===void 0?void 0:ie.constructor)===null||ue===void 0?void 0:ue.name)==="ErrorInfo"?m.default.Config.inspect(Z):Z.toString()}r.inspectError=D;function B(Z){return m.default.BufferUtils.isBuffer(Z)?Z.toString():typeof Z=="string"?Z:m.default.Config.inspect(Z)}r.inspectBody=B;function j(Z){if(m.default.BufferUtils.isBuffer(Z))return m.default.BufferUtils.byteLength(Z);if(typeof Z=="string")return m.default.Config.stringByteSize(Z);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof Z)}r.dataSizeBytes=j;function V(){return String(Math.random()).substr(2)}r.cheapRandStr=V;var te=function(Z){if(m.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ie=new Uint8Array(Z);return m.default.Config.getRandomValues(ie),m.default.BufferUtils.base64Encode(ie)}for(var ue=m.default.BufferUtils.base64CharSet,pe=Math.round(Z*4/3),Re="",qe=0;qe<pe;qe++)Re+=ue[c(ue)];return Re};r.randomString=te;var le=function(Z){if(m.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ie=new Uint8Array(Z);return m.default.Config.getRandomValues(ie),m.default.BufferUtils.hexEncode(ie)}for(var ue=m.default.BufferUtils.hexCharSet,pe=Z*2,Re="",qe=0;qe<pe;qe++)Re+=ue[c(ue)];return Re};r.randomHexString=le;function me(Z,ie){for(var ue=Math.min(ie,Z.length),pe=Z.slice(),Re=[],qe=0;qe<ue;qe++)Re.push(J(pe));return Re}r.arrChooseN=me,r.trim=String.prototype.trim?function(Z){return Z.trim()}:function(Z){return Z.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ve(Z,ie,ue){return new Promise(function(pe,Re){Z[ie].apply(Z,i.__spreadArray(i.__spreadArray([],ue),[function(qe,fn){qe?Re(qe):pe(fn)}]))})}r.promisify=ve;var Se;(function(Z){Z.msgpack="msgpack",Z.json="json"})(Se=r.Format||(r.Format={}));function Le(Z,ie){return ie=="msgpack"?m.default.Config.msgpack.decode(Z):JSON.parse(String(Z))}r.decodeBody=Le;function de(Z,ie){return ie=="msgpack"?m.default.Config.msgpack.encode(Z,!0):JSON.stringify(Z)}r.encodeBody=de;function xe(Z){return Z.map(function(ie){return ie&&ie.toLowerCase()})}r.allToLowerCase=xe;function et(Z){return Z.map(function(ie){return ie&&ie.toUpperCase()})}r.allToUpperCase=et;function Be(Z){return Math.min((Z+2)/3,2)}r.getBackoffCoefficient=Be;function ke(){return 1-Math.random()*.2}r.getJitterCoefficient=ke;function ct(){return s||(typeof window!="undefined"?window:self)}r.getGlobalObject=ct}).call(this,n(12))},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importDefault(n(0)),y=s||(typeof window!="undefined"?window:self),c;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(c||(c={}));function f(a,S){return(""+a).padStart(S?3:2,"0")}function C(a){return m.default.Config.logTimestamps?function(S){var M=new Date;a(f(M.getHours())+":"+f(M.getMinutes())+":"+f(M.getSeconds())+"."+f(M.getMilliseconds(),1)+" "+S)}:a}var E=function(){var a,S,M,P;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((S=(a=y==null?void 0:y.console)===null||a===void 0?void 0:a.log)===null||S===void 0?void 0:S.apply)=="function"?(M=function(){for(var O=[],b=0;b<arguments.length;b++)O[b]=arguments[b]},P=console.warn?function(){for(var O=[],b=0;b<arguments.length;b++)O[b]=arguments[b]}:M):y!=null&&y.console.log?M=P=function(){Function.prototype.apply.call(console.log,console,arguments)}:M=P=function(){},[M,P].map(C)},R=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var S=E(),M=S[0],P=S[1];this.logHandler=M,this.logErrorHandler=P},a.logLevel=c.Error,a.LOG_NONE=c.None,a.LOG_ERROR=c.Error,a.LOG_MAJOR=c.Major,a.LOG_MINOR=c.Minor,a.LOG_MICRO=c.Micro,a.LOG_DEFAULT=c.Error,a.LOG_DEBUG=c.Micro,a.logAction=function(S,M,P){a.shouldLog(S)&&(S===c.Error?a.logErrorHandler:a.logHandler)("Ably: "+M+": "+P)},a.deprecated=function(S,M){a.deprecatedWithMsg(S,"Please use '"+M+"' instead.")},a.deprecatedWithMsg=function(S,M){a.shouldLog(c.Error)&&a.logErrorHandler("Ably: Deprecation warning - '"+S+"' is deprecated and will be removed from a future version. "+M)},a.shouldLog=function(S){return S<=a.logLevel},a.setLog=function(S,M){S!==void 0&&(a.logLevel=S),M!==void 0&&(a.logHandler=a.logErrorHandler=M)},a}();r.default=R}).call(this,n(12))},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var i=s,m=i.lib,y=m.WordArray,c=y.init,f=y.init=function(C){if(C instanceof ArrayBuffer&&(C=new Uint8Array(C)),(C instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&C instanceof Uint8ClampedArray||C instanceof Int16Array||C instanceof Uint16Array||C instanceof Int32Array||C instanceof Uint32Array||C instanceof Float32Array||C instanceof Float64Array)&&(C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),C instanceof Uint8Array){for(var E=C.byteLength,R=[],a=0;a<E;a++)R[a>>>2]|=C[a]<<24-a%4*8;c.call(this,R,E)}else c.apply(this,arguments)};f.prototype=y}}(),s.lib.WordArray})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=function(){function c(f,C,E,R){this.message=f,this.code=C,this.statusCode=E,this.cause=R}return c.prototype.toString=function(){var f="["+this.constructor.name;return this.message&&(f+=": "+this.message),this.statusCode&&(f+="; statusCode="+this.statusCode),this.code&&(f+="; code="+this.code),this.cause&&(f+="; cause="+m.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(f+="; see "+this.href+" "),f+="]",f},c.fromValues=function(f){var C=f,E=C.message,R=C.code,a=C.statusCode;if(typeof E!="string"||typeof R!="number"||typeof a!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(f));var S=Object.assign(new c(E,R,a),f);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S},c}();r.default=y},function(h,r,n){(function(s){(function(i,m){h.exports=r=m()})(this,function(){var i=i||function(m,y){var c;if(typeof window!="undefined"&&window.crypto&&(c=window.crypto),!c&&typeof window!="undefined"&&window.msCrypto&&(c=window.msCrypto),!c&&typeof s!="undefined"&&s.crypto&&(c=s.crypto),!c)try{c=n(44)}catch(d){}var f=function(){if(c){if(typeof c.getRandomValues=="function")try{return c.getRandomValues(new Uint32Array(1))[0]}catch(d){}if(typeof c.randomBytes=="function")try{return c.randomBytes(4).readInt32LE()}catch(d){}}throw new Error("Native crypto module could not be used to get secure random number.")},C=Object.create||function(){function d(){}return function(p){var u;return d.prototype=p,u=new d,d.prototype=null,u}}(),E={},R=E.lib={},a=R.Base=function(){return{extend:function(d){var p=C(this);return d&&p.mixIn(d),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var p in d)d.hasOwnProperty(p)&&(this[p]=d[p]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),S=R.WordArray=a.extend({init:function(d,p){d=this.words=d||[],p!=y?this.sigBytes=p:this.sigBytes=d.length*4},toString:function(d){return(d||P).stringify(this)},concat:function(d){var p=this.words,u=d.words,A=this.sigBytes,_=d.sigBytes;if(this.clamp(),A%4)for(var L=0;L<_;L++){var W=u[L>>>2]>>>24-L%4*8&255;p[A+L>>>2]|=W<<24-(A+L)%4*8}else for(var L=0;L<_;L+=4)p[A+L>>>2]=u[L>>>2];return this.sigBytes+=_,this},clamp:function(){var d=this.words,p=this.sigBytes;d[p>>>2]&=4294967295<<32-p%4*8,d.length=m.ceil(p/4)},clone:function(){var d=a.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var p=[],u=0;u<d;u+=4)p.push(f());return new S.init(p,d)}}),M=E.enc={},P=M.Hex={stringify:function(d){for(var p=d.words,u=d.sigBytes,A=[],_=0;_<u;_++){var L=p[_>>>2]>>>24-_%4*8&255;A.push((L>>>4).toString(16)),A.push((L&15).toString(16))}return A.join("")},parse:function(d){for(var p=d.length,u=[],A=0;A<p;A+=2)u[A>>>3]|=parseInt(d.substr(A,2),16)<<24-A%8*4;return new S.init(u,p/2)}},O=M.Latin1={stringify:function(d){for(var p=d.words,u=d.sigBytes,A=[],_=0;_<u;_++){var L=p[_>>>2]>>>24-_%4*8&255;A.push(String.fromCharCode(L))}return A.join("")},parse:function(d){for(var p=d.length,u=[],A=0;A<p;A++)u[A>>>2]|=(d.charCodeAt(A)&255)<<24-A%4*8;return new S.init(u,p)}},b=M.Utf8={stringify:function(d){try{return decodeURIComponent(escape(O.stringify(d)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(d){return O.parse(unescape(encodeURIComponent(d)))}},T=R.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=b.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var p,u=this._data,A=u.words,_=u.sigBytes,L=this.blockSize,W=L*4,H=_/W;d?H=m.ceil(H):H=m.max((H|0)-this._minBufferSize,0);var U=H*L,I=m.min(U*4,_);if(U){for(var x=0;x<U;x+=L)this._doProcessBlock(A,x);p=A.splice(0,U),u.sigBytes-=I}return new S.init(p,I)},clone:function(){var d=a.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0}),l=R.Hasher=T.extend({cfg:a.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(d){return function(p,u){return new d.init(u).finalize(p)}},_createHmacHelper:function(d){return function(p,u){return new v.HMAC.init(d,u).finalize(p)}}}),v=E.algo={};return E}(Math);return i})}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(0));function c(E,R,a){try{R.apply(E,a)}catch(S){m.default.logAction(m.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+S+"; stack = "+(S&&S.stack))}}function f(E,R,a){for(var S,M,P,O=0;O<E.length;O++)if(S=E[O],a&&(S=S[a]),i.isArray(S)){for(;(M=i.arrIndexOf(S,R))!==-1;)S.splice(M,1);a&&S.length===0&&delete E[O][a]}else if(i.isObject(S))for(P in S)Object.prototype.hasOwnProperty.call(S,P)&&i.isArray(S[P])&&f([S],R,P)}var C=function(){function E(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return E.prototype.on=function(){for(var R=this,a=[],S=0;S<arguments.length;S++)a[S]=arguments[S];if(a.length===1){var M=a[0];if(typeof M=="function")this.any.push(M);else throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a))}if(a.length===2){var P=a[0],O=a[1];if(typeof O!="function")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a));if(i.isEmptyArg(P))this.any.push(O);else if(i.isArray(P))P.forEach(function(T){R.on(T,O)});else{if(typeof P!="string")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(a));var b=this.events[P]||(this.events[P]=[]);b.push(O)}}},E.prototype.off=function(){for(var R,a=this,S=[],M=0;M<arguments.length;M++)S[M]=arguments[M];if(S.length==0||i.isEmptyArg(S[0])&&i.isEmptyArg(S[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var P=S[0],O=S[1],b=null,T=null;if(S.length===1||!O)typeof P=="function"?b=P:T=P;else{if(typeof O!="function")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(S));R=[P,O],T=R[0],b=R[1]}if(b&&i.isEmptyArg(T)){f([this.any,this.events,this.anyOnce,this.eventsOnce],b);return}if(i.isArray(T)){T.forEach(function(l){a.off(l,b)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(S));b?f([this.events,this.eventsOnce],b,T):(delete this.events[T],delete this.eventsOnce[T])},E.prototype.listeners=function(R){if(R){var a=this.events[R]||[];return this.eventsOnce[R]&&Array.prototype.push.apply(a,this.eventsOnce[R]),a.length?a:null}return this.any.length?this.any:null},E.prototype.emit=function(R){for(var a=[],S=1;S<arguments.length;S++)a[S-1]=arguments[S];var M={event:R},P=[];this.anyOnce.length&&(Array.prototype.push.apply(P,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(P,this.any);var O=this.eventsOnce[R];O&&(Array.prototype.push.apply(P,O),delete this.eventsOnce[R]);var b=this.events[R];b&&Array.prototype.push.apply(P,b),i.arrForEach(P,function(T){c(M,T,a)})},E.prototype.once=function(){for(var R=this,a=[],S=0;S<arguments.length;S++)a[S]=arguments[S];var M=a.length;if((M===0||M===1&&typeof a[0]!="function")&&y.default.Config.Promise){var P=a[0];if(typeof P!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));return new y.default.Config.Promise(function(d){R.once(P,d)})}var O=a[0],b=a[1];if(a.length===1&&typeof O=="function")this.anyOnce.push(O);else if(i.isEmptyArg(O)){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));this.anyOnce.push(b)}else if(i.isArray(O)){var T=this,l=function(){var d=Array.prototype.slice.call(arguments);if(i.arrForEach(O,function(p){T.off(p,l)}),typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));b.apply(this,d)};i.arrForEach(O,function(d){T.on(d,l)})}else{if(typeof O!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));var v=this.eventsOnce[O]||(this.eventsOnce[O]=[]);if(b){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(a));v.push(b)}}},E.prototype.whenState=function(R,a,S){for(var M=this,P=[],O=3;O<arguments.length;O++)P[O-3]=arguments[O];var b={event:R};if(typeof R!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof S!="function"&&y.default.Config.Promise)return new y.default.Config.Promise(function(T){E.prototype.whenState.apply(M,[R,a,T].concat(P))});R===a?c(b,S,P):this.once(R,S)},E}();r.default=C},function(h,r,n){"use strict";r.__esModule=!0,r.getDefaults=r.normaliseOptions=r.objectifyOptions=r.getHosts=r.getFallbackHosts=r.environmentFallbackHosts=r.getHttpScheme=r.getPort=r.getHost=void 0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(3)),c=s.__importDefault(n(5)),f=n(42),C="ably-js/"+f.version,E={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:f.version,apiVersion:"1.2",agent:C,getHost:R,getPort:a,getHttpScheme:S,environmentFallbackHosts:M,getFallbackHosts:P,getHosts:O,checkHost:b,objectifyOptions:v,normaliseOptions:d};function R(u,A,_){return _?A=A==u.restHost&&u.realtimeHost||A||u.realtimeHost:A=A||u.restHost,A}r.getHost=R;function a(u,A){return A||u.tls?u.tlsPort:u.port}r.getPort=a;function S(u){return u.tls?"https://":"http://"}r.getHttpScheme=S;function M(u){return[u+"-a-fallback.ably-realtime.com",u+"-b-fallback.ably-realtime.com",u+"-c-fallback.ably-realtime.com",u+"-d-fallback.ably-realtime.com",u+"-e-fallback.ably-realtime.com"]}r.environmentFallbackHosts=M;function P(u){var A=u.fallbackHosts,_=typeof u.httpMaxRetryCount!="undefined"?u.httpMaxRetryCount:E.httpMaxRetryCount;return A?m.arrChooseN(A,_):[]}r.getFallbackHosts=P;function O(u){return[u.restHost].concat(P(u))}r.getHosts=O;function b(u){if(typeof u!="string")throw new c.default("host must be a string; was a "+typeof u,4e4,400);if(!u.length)throw new c.default("host must not be zero-length",4e4,400)}function T(u,A,_){return u.realtimeHost?u.realtimeHost:u.restHost?(y.default.logAction(y.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+u.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+u.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),u.restHost):A?E.REALTIME_HOST:_+"-"+E.REALTIME_HOST}function l(u){var A={};for(var _ in E.TIMEOUTS)A[_]=u[_]||E.TIMEOUTS[_];return A}function v(u){return typeof u=="string"?u.indexOf(":")==-1?{token:u}:{key:u}:u}r.objectifyOptions=v;function d(u){if(u.host&&(y.default.deprecated("host","restHost"),u.restHost=u.host),u.wsHost&&(y.default.deprecated("wsHost","realtimeHost"),u.realtimeHost=u.wsHost),u.queueEvents&&(y.default.deprecated("queueEvents","queueMessages"),u.queueMessages=u.queueEvents),u.fallbackHostsUseDefault){if(u.fallbackHosts){var A="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",A),new c.default(A,4e4,400)}if(u.port||u.tlsPort){var A="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",A),new c.default(A,4e4,400)}u.environment?y.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):y.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),u.fallbackHosts=E.FALLBACK_HOSTS}u.recover===!0&&(y.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),u.recover=function(z,k){k(!0)}),typeof u.recover=="function"&&u.closeOnUnload===!0&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),u.recover=void 0),"closeOnUnload"in u||(u.closeOnUnload=!u.recover),u.transports&&m.arrIn(u.transports,"xhr")&&(y.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),m.arrDeleteValue(u.transports,"xhr"),u.transports.push("xhr_streaming")),"queueMessages"in u||(u.queueMessages=!0);var _=u.environment&&String(u.environment).toLowerCase()||E.ENVIRONMENT,L=!_||_==="production";!u.fallbackHosts&&!u.restHost&&!u.realtimeHost&&!u.port&&!u.tlsPort&&(u.fallbackHosts=L?E.FALLBACK_HOSTS:M(_));var W=u.restHost||(L?E.REST_HOST:_+"-"+E.REST_HOST),H=T(u,L,_);m.arrForEach((u.fallbackHosts||[]).concat(W,H),b),u.port=u.port||E.PORT,u.tlsPort=u.tlsPort||E.TLS_PORT,"tls"in u||(u.tls=!0);var U=l(u);if("useBinaryProtocol"in u?u.useBinaryProtocol=i.default.Config.supportsBinary&&u.useBinaryProtocol:u.useBinaryProtocol=i.default.Config.preferBinary,u.clientId){var I=u.headers=u.headers||{};I["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(u.clientId))}if("idempotentRestPublishing"in u||(u.idempotentRestPublishing=!0),u.promises&&!i.default.Config.Promise&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),u.promises=!1),u.agents)for(var x in u.agents)E.agent+=" "+x+"/"+u.agents[x];return s.__assign(s.__assign({},u),{useBinaryProtocol:"useBinaryProtocol"in u?i.default.Config.supportsBinary&&u.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:H,restHost:W,maxMessageSize:u.maxMessageSize||E.maxMessageSize,timeouts:U})}r.normaliseOptions=d,r.default=E;function p(u){return Object.assign(E,u)}r.getDefaults=p},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importDefault(n(3)),y=s.__importDefault(n(5)),c=s.__importStar(n(2));function f(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function C(a){if(a&&a.cipher&&!a.cipher.channelCipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var S=i.default.Crypto.getCipher(a.cipher);return{cipher:S.cipherParams,channelCipher:S.cipher}}return a}function E(a){var S=0;return a.name&&(S+=a.name.length),a.clientId&&(S+=a.clientId.length),a.extras&&(S+=JSON.stringify(a.extras).length),a.data&&(S+=c.dataSizeBytes(a.data)),S}var R=function(){function a(){}return a.prototype.toJSON=function(){var S=this.encoding,M=this.data;return M&&i.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(S=S?S+"/base64":"base64",M=i.default.BufferUtils.base64Encode(M)):M=i.default.BufferUtils.toBuffer(M)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:S,data:M}},a.prototype.toString=function(){var S="[Message";return this.name&&(S+="; name="+this.name),this.id&&(S+="; id="+this.id),this.timestamp&&(S+="; timestamp="+this.timestamp),this.clientId&&(S+="; clientId="+this.clientId),this.connectionId&&(S+="; connectionId="+this.connectionId),this.encoding&&(S+="; encoding="+this.encoding),this.extras&&(S+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?S+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?S+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):S+="; data (json)="+JSON.stringify(this.data)),this.extras&&(S+="; extras="+JSON.stringify(this.extras)),S+="]",S},a.encrypt=function(S,M,P){var O=S.data,b=S.encoding,T=M.channelCipher;b=b?b+"/":"",i.default.BufferUtils.isBuffer(O)||(O=i.default.BufferUtils.utf8Encode(String(O)),b=b+"utf-8/"),T.encrypt(O,function(l,v){if(l){P(l);return}S.data=v,S.encoding=b+"cipher+"+T.algorithm,P(null,S)})},a.encode=function(S,M,P){var O=S.data,b=typeof O=="string"||i.default.BufferUtils.isBuffer(O)||O===null||O===void 0;if(!b)if(c.isObject(O)||c.isArray(O))S.data=JSON.stringify(O),S.encoding=S.encoding?S.encoding+"/json":"json";else throw new y.default("Data type is unsupported",40013,400);M!=null&&M.cipher?a.encrypt(S,M,P):P(null,S)},a.encodeArray=function(S,M,P){for(var O=0,b=0;b<S.length;b++)a.encode(S[b],M,function(T){if(T){P(T);return}O++,O==S.length&&P(null,S)})},a.decode=function(S,M){var P=f(M),O=S.data,b=S.encoding;if(b){var T=b.split("/"),l=void 0,v=T.length,d=S.data,p="";try{for(;(l=v)>0;){var u=T[--v].match(/([-\w]+)(\+([\w-]+))?/);if(!u)break;switch(p=u[1],p){case"base64":d=i.default.BufferUtils.base64Decode(String(d)),l==T.length&&(O=d);continue;case"utf-8":d=i.default.BufferUtils.utf8Decode(d);continue;case"json":d=JSON.parse(d);continue;case"cipher":if(P.channelOptions!=null&&P.channelOptions.cipher&&P.channelOptions.channelCipher){var A=u[3],_=P.channelOptions.channelCipher;if(A!=_.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");d=_.decrypt(d);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!P.plugins||!P.plugins.vcdiff)throw new y.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new y.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=P.baseEncodedPreviousPayload;typeof L=="string"&&(L=i.default.BufferUtils.utf8Encode(L)),L=i.default.BufferUtils.toBuffer(L),d=i.default.BufferUtils.toBuffer(d),d=i.default.BufferUtils.typedArrayToBuffer(P.plugins.vcdiff.decode(d,L)),O=d}catch(H){throw new y.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var W=H;throw new y.default("Error processing the "+p+" encoding, decoder returned \u2018"+W.message+"\u2019",W.code||40013,400)}finally{S.encoding=l<=0?null:T.slice(0,l).join("/"),S.data=d}}P.baseEncodedPreviousPayload=O},a.fromResponseBody=function(S,M,P){P&&(S=c.decodeBody(S,P));for(var O=0;O<S.length;O++){var b=S[O]=a.fromValues(S[O]);try{a.decode(b,M)}catch(T){m.default.logAction(m.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return S},a.fromValues=function(S){return Object.assign(new a,S)},a.fromValuesArray=function(S){for(var M=S.length,P=new Array(M),O=0;O<M;O++)P[O]=a.fromValues(S[O]);return P},a.fromEncoded=function(S,M){var P=a.fromValues(S),O=C(M);try{a.decode(P,O)}catch(b){m.default.logAction(m.default.LOG_ERROR,"Message.fromEncoded()",b.toString())}return P},a.fromEncodedArray=function(S,M){return C(M),S.map(function(P){return a.fromEncoded(P,M)})},a.getMessagesSize=function(S){for(var M,P=0,O=0;O<S.length;O++)M=S[O],P+=M.size||(M.size=E(M));return P},a.serialize=c.encodeBody,a}();r.default=R},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(5)),y=s.__importDefault(n(9)),c=s.__importDefault(n(14)),f={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},C=[];Object.keys(f).forEach(function(P){C[f[P]]=P});var E={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},R=Object.keys(E);E.MODE_ALL=E.PRESENCE|E.PUBLISH|E.SUBSCRIBE|E.PRESENCE_SUBSCRIBE;function a(P){var O=[];if(P)for(var b=0;b<P.length;b++)O.push(P[b].toString());return"[ "+O.join(", ")+" ]"}var S="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),M=function(){function P(){var O=this;this.hasFlag=function(b){return(O.flags&E[b])>0}}return P.prototype.setFlag=function(O){return this.flags=this.flags|E[O]},P.prototype.getMode=function(){return this.flags&&this.flags&E.MODE_ALL},P.prototype.encodeModesToFlags=function(O){var b=this;O.forEach(function(T){return b.setFlag(T)})},P.prototype.decodeModesFromFlags=function(){var O=this,b=[];return P.channelModes.forEach(function(T){O.hasFlag(T)&&b.push(T)}),b.length>0?b:void 0},P.fromValues=function(O){return Object.assign(new P,O)},P.Action=f,P.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],P.ActionName=C,P.serialize=i.encodeBody,P.deserialize=function(O,b){var T=i.decodeBody(O,b);return P.fromDeserialized(T)},P.fromDeserialized=function(O){var b=O.error;b&&(O.error=m.default.fromValues(b));var T=O.messages;if(T)for(var l=0;l<T.length;l++)T[l]=y.default.fromValues(T[l]);var v=O.presence;if(v)for(var l=0;l<v.length;l++)v[l]=c.default.fromValues(v[l],!0);return Object.assign(new P,O)},P.stringify=function(O){var b="[ProtocolMessage";O.action!==void 0&&(b+="; action="+P.ActionName[O.action]||!1);for(var T,l=0;l<S.length;l++)T=S[l],O[T]!==void 0&&(b+="; "+T+"="+O[T]);if(O.messages&&(b+="; messages="+a(y.default.fromValuesArray(O.messages))),O.presence&&(b+="; presence="+a(c.default.fromValuesArray(O.presence))),O.error&&(b+="; error="+m.default.fromValues(O.error).toString()),O.auth&&O.auth.accessToken&&(b+="; token="+O.auth.accessToken),O.flags&&(b+="; flags="+R.filter(O.hasFlag).join(",")),O.params){var v="";i.forInOwnNonNullProperties(O.params,function(d){v.length>0&&(v+="; "),v+=d+"="+O.params[d]}),v.length>0&&(b+="; params=["+v+"]")}return b+="]",b},P.isDuplicate=function(O,b){if(O&&b&&(O.action===f.MESSAGE||O.action===f.PRESENCE)&&O.action===b.action&&O.channel===b.channel&&O.id===b.id){if(O.action===f.PRESENCE)return!0;if(O.messages.length===b.messages.length){for(var T=0;T<O.messages.length;T++){var l=O.messages[T],v=b.messages[T];if((l.extras&&l.extras.delta&&l.extras.delta.format)!==(v.extras&&v.extras.delta&&v.extras.delta.format))return!1}return!0}}return!1},P}();r.default=M},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(10)),y=s.__importDefault(n(26)),c=s.__importDefault(n(3)),f=s.__importDefault(n(8)),C=s.__importDefault(n(19)),E=s.__importDefault(n(16)),R=s.__importDefault(n(5)),a=s.__importDefault(n(20)),S=s.__importDefault(n(0));function M(b){var T=[80015,80017,80030];return b.code?E.default.isTokenErr(b)?!1:i.arrIn(T,b.code)?!0:b.code>=4e4&&b.code<5e4:!1}function P(b){return M(b)?[m.default.fromValues({action:m.default.Action.ERROR,error:b})]:[m.default.fromValues({action:m.default.Action.DISCONNECTED,error:b})]}var O=function(b){s.__extends(T,b);function T(l,v,d){var p=b.call(this,l,v,d,!0)||this;return p.onAuthUpdated=function(u){p.authParams={access_token:u.token}},p.stream="stream"in d?d.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return T.prototype.connect=function(){var l=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","starting"),y.default.prototype.connect.call(this);var v=this.params,d=v.options,p=f.default.getHost(d,v.host),u=f.default.getPort(d),A=d.tls?"https://":"http://";this.baseUri=A+p+":"+u+"/comet/";var _=this.baseUri+"connect";c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","uri: "+_),this.auth.getAuthParams(function(L,W){if(L){l.disconnect(L);return}if(!l.isDisposed){l.authParams=W;var H=l.params.getConnectParams(W);"stream"in H&&(l.stream=H.stream),c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(H));var U=!1,I=l.recvRequest=l.createRequest(_,null,H,null,l.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);I.on("data",function(x){!l.recvRequest||(U||(U=!0,l.emit("preconnect")),l.onData(x))}),I.on("complete",function(x){if(l.recvRequest||(x=x||new R.default("Request cancelled",80003,400)),l.recvRequest=null,!U&&!x&&(U=!0,l.emit("preconnect")),l.onActivity(),x){x.code?l.onData(P(x)):l.disconnect(x);return}S.default.Config.nextTick(function(){l.recv()})}),I.exec()}})},T.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(l){var v=this,d=l?this.closeUri:this.disconnectUri;if(d){var p=this.createRequest(d,null,this.authParams,null,a.default.REQ_SEND);p.on("complete",function(u){u&&(c.default.logAction(c.default.LOG_ERROR,"CometTransport.request"+(l?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(u)),v.finish("disconnected",u))}),p.exec()}},T.prototype.dispose=function(){var l=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",C.default.disconnected),S.default.Config.nextTick(function(){l.emit("disposed")}))},T.prototype.onConnect=function(l){if(!this.isDisposed){var v=l.connectionKey;y.default.prototype.onConnect.call(this,l);var d=this.baseUri+v;c.default.logAction(c.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+d+"; connectionKey = "+l.connectionKey),this.sendUri=d+"/send",this.recvUri=d+"/recv",this.closeUri=d+"/close",this.disconnectUri=d+"/disconnect"}},T.prototype.send=function(l){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(l);return}var v=this.pendingItems||[];v.push(l),this.pendingItems=null,this.sendItems(v)},T.prototype.sendAnyPending=function(){var l=this.pendingItems;!l||(this.pendingItems=null,this.sendItems(l))},T.prototype.sendItems=function(l){var v=this,d=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(l),a.default.REQ_SEND);d.on("complete",function(p,u){if(p&&c.default.logAction(c.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),v.sendRequest=null,p){p.code?v.onData(P(p)):v.disconnect(p);return}u&&v.onData(u),v.pendingItems&&S.default.Config.nextTick(function(){v.sendRequest||v.sendAnyPending()})}),d.exec()},T.prototype.recv=function(){var l=this;if(!this.recvRequest&&!!this.isConnected){var v=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);v.on("data",function(d){l.onData(d)}),v.on("complete",function(d){if(l.recvRequest=null,l.onActivity(),d){d.code?l.onData(P(d)):l.disconnect(d);return}S.default.Config.nextTick(function(){l.recv()})}),v.exec()}},T.prototype.onData=function(l){try{var v=this.decodeResponse(l);if(v&&v.length)for(var d=0;d<v.length;d++)this.onProtocolMessage(m.default.fromDeserialized(v[d]))}catch(p){c.default.logAction(c.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},T.prototype.encodeRequest=function(l){return JSON.stringify(l)},T.prototype.decodeResponse=function(l){return typeof l=="string"?JSON.parse(l):l},T}(y.default);r.default=O},function(h,r){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(s){typeof window=="object"&&(n=window)}h.exports=n},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,c=i.enc,f=c.Base64={stringify:function(E){var R=E.words,a=E.sigBytes,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.clamp();for(var M=[],P=0;P<a;P+=3)for(var O=R[P>>>2]>>>24-P%4*8&255,b=R[P+1>>>2]>>>24-(P+1)%4*8&255,T=R[P+2>>>2]>>>24-(P+2)%4*8&255,l=O<<16|b<<8|T,v=0;v<4&&P+v*.75<a;v++)M.push(S.charAt(l>>>6*(3-v)&63));var d=S.charAt(64);if(d)for(;M.length%4;)M.push(d);return M.join("")},parse:function(E){var R=E.length,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",S=this._reverseMap;if(!S){S=this._reverseMap=[];for(var M=0;M<a.length;M++)S[a.charCodeAt(M)]=M}var P=a.charAt(64);if(P){var O=E.indexOf(P);O!==-1&&(R=O)}return C(E,R,S)}};function C(E,R,a){for(var S=[],M=0,P=0;P<R;P++)if(P%4){var O=a[E.charCodeAt(P-1)]<<P%4*2,b=a[E.charCodeAt(P)]>>>6-P%4*2,T=O|b;S[M>>>2]|=T<<24-M%4*8,M++}return y.create(S,M)}}(),s.enc.Base64})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=s.__importDefault(n(0)),y=s.__importDefault(n(9)),c=s.__importStar(n(2));function f(E){return C.Actions.indexOf(E)}var C=function(){function E(){}return E.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},E.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var R=this.id.split(":");return{connectionId:R[0],msgSerial:parseInt(R[1],10),index:parseInt(R[2],10)}},E.prototype.toJSON=function(){var R=this.data,a=this.encoding;return R&&m.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(a=a?a+"/base64":"base64",R=m.default.BufferUtils.base64Encode(R)):R=m.default.BufferUtils.toBuffer(R)),{clientId:this.clientId,action:f(this.action),data:R,encoding:a}},E.prototype.toString=function(){var R="[PresenceMessage";return R+="; action="+this.action,this.id&&(R+="; id="+this.id),this.timestamp&&(R+="; timestamp="+this.timestamp),this.clientId&&(R+="; clientId="+this.clientId),this.connectionId&&(R+="; connectionId="+this.connectionId),this.encoding&&(R+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?R+="; data="+this.data:m.default.BufferUtils.isBuffer(this.data)?R+="; data (buffer)="+m.default.BufferUtils.base64Encode(this.data):R+="; data (json)="+JSON.stringify(this.data)),R+="]",R},E.fromResponseBody=function(R,a,S){var M=[];S&&(R=c.decodeBody(R,S));for(var P=0;P<R.length;P++){var O=M[P]=E.fromValues(R[P],!0);try{E.decode(O,a)}catch(b){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",b.toString())}}return M},E.fromValues=function(R,a){return a&&(R.action=E.Actions[R.action]),Object.assign(new E,R)},E.fromValuesArray=function(R){for(var a=R.length,S=new Array(a),M=0;M<a;M++)S[M]=E.fromValues(R[M]);return S},E.fromEncoded=function(R,a){var S=E.fromValues(R,!0);try{E.decode(S,a)}catch(M){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",M.toString())}return S},E.fromEncodedArray=function(R,a){return R.map(function(S){return E.fromEncoded(S,a)})},E.Actions=["absent","present","enter","leave","update"],E.encode=y.default.encode,E.decode=y.default.decode,E.getMessagesSize=y.default.getMessagesSize,E}();r.default=C},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importStar(n(2)),y=i.__importDefault(n(7)),c=i.__importDefault(n(5)),f=i.__importDefault(n(3)),C=i.__importDefault(n(8)),E=i.__importDefault(n(20)),R=i.__importDefault(n(0));function a(A,_){return m.arrIn(m.allToLowerCase(m.keysArray(_)),"x-ably-errorcode")}function S(A,_){if(a(A,_))return A.error&&c.default.fromValues(A.error)}var M=function(){},P=0,O={},b=typeof s!="undefined"&&s.XDomainRequest;function T(){var A=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return A&&Number(A[1])}function l(){var A;return b&&(A=T())&&A===10}function v(A,_){return A.getResponseHeader&&A.getResponseHeader(_)}function d(A){return A.getResponseHeader&&(A.getResponseHeader("transfer-encoding")||!A.getResponseHeader("content-length"))}function p(A){for(var _=m.trim(A.getAllResponseHeaders()).split(`\r
`),L={},W=0;W<_.length;W++){var H=_[W].split(":").map(m.trim);L[H[0].toLowerCase()]=H[1]}return L}var u=function(A){i.__extends(_,A);function _(L,W,H,U,I,x,z){var k=A.call(this)||this;return H=H||{},H.rnd=m.cheapRandStr(),l()&&!H.envelope&&(H.envelope="json"),k.uri=L+m.toQueryString(H),k.headers=W||{},k.body=U,k.method=z?z.toUpperCase():m.isEmptyArg(U)?"GET":"POST",k.requestMode=I,k.timeouts=x,k.timedOut=!1,k.requestComplete=!1,k.id=String(++P),O[k.id]=k,k}return _.createRequest=function(L,W,H,U,I,x,z){var k=x||C.default.TIMEOUTS;return new _(L,W,m.copy(H),U,I,k,z)},_.prototype.complete=function(L,W,H,U,I){this.requestComplete||(this.requestComplete=!0,!L&&W&&this.emit("data",W),this.emit("complete",L,W,H,U,I),this.dispose())},_.prototype.abort=function(){this.dispose()},_.prototype.exec=function(){var L=this,W=this.headers,H=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,U=this.timer=setTimeout(function(){L.timedOut=!0,x.abort()},H),I=this.method,x=this.xhr=new XMLHttpRequest,z=W.accept,k=this.body,J="text";if(z?z.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):W.accept="application/json",k){var ee=W["content-type"]||(W["content-type"]="application/json");ee.indexOf("application/json")>-1&&typeof k!="string"&&(k=JSON.stringify(k))}x.open(I,this.uri,!0),x.responseType=J,"authorization"in W&&(x.withCredentials=!0);for(var Q in W)x.setRequestHeader(Q,W[Q]);var G=function(de,xe,et,Be){var ke,ct=xe+" (event type: "+de.type+")";!((ke=L==null?void 0:L.xhr)===null||ke===void 0)&&ke.statusText&&(ct+=", current statusText is "+L.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+de.type+"()",ct),L.complete(new c.default(ct,et,Be))};x.onerror=function(de){G(de,"XHR error occurred",null,400)},x.onabort=function(de){L.timedOut?G(de,"Request aborted due to request timeout expiring",null,408):G(de,"Request cancelled",null,400)},x.ontimeout=function(de){G(de,"Request timed out",null,408)};var D,B,j,V=0,te=!1,le=function(){if(clearTimeout(U),j=B<400,B==204){L.complete(null,null,null,null,B);return}D=L.requestMode==E.default.REQ_RECV_STREAM&&j&&d(x)},me=function(){var de;try{var xe=v(x,"content-type"),et=xe?xe.indexOf("application/json")>=0:x.responseType=="text";if(et){var Be=x.responseType==="arraybuffer"?R.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Be.length?de=JSON.parse(Be):de=Be,te=!0}else de=x.response;de.response!==void 0?(B=de.statusCode,j=B<400,W=de.headers,de=de.response):W=p(x)}catch(ct){L.complete(new c.default("Malformed response body from server: "+ct.message,null,400));return}if(j||m.isArray(de)){L.complete(null,de,W,te,B);return}var ke=S(de,W);ke||(ke=new c.default("Error response received from server: "+B+" body was: "+R.default.Config.inspect(de),null,B)),L.complete(ke,de,W,te,B)};function ve(){for(var de=x.responseText,xe=de.length-1,et,Be;V<xe&&(et=de.indexOf(`
`,V))>-1;)Be=de.slice(V,et),V=et+1,Se(Be)}var Se=function(de){try{de=JSON.parse(de)}catch(xe){L.complete(new c.default("Malformed response body from server: "+xe.message,null,400));return}L.emit("data",de)},Le=function(){ve(),L.streamComplete=!0,R.default.Config.nextTick(function(){L.complete()})};x.onreadystatechange=function(){var de=x.readyState;de<3||x.status!==0&&(B===void 0&&(B=x.status,B===1223&&(B=204),le()),de==3&&D?ve():de==4&&(D?Le():me()))},x.send(k)},_.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=M,this.xhr=null;var W=this.timer;W&&(clearTimeout(W),this.timer=null),this.requestComplete||L.abort()}delete O[this.id]},_}(y.default);r.default=u}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=s.__importStar(n(2)),y=s.__importDefault(n(22)),c=s.__importDefault(n(5)),f=s.__importDefault(n(43)),C=n(13),E=n(32),R=s.__importDefault(n(17)),a=s.__importDefault(n(0)),S=Math.pow(2,17);function M(){}function P(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(H){return!!H.connection}function b(H){return m.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new c.default(m.inspectError(H),H.code||40170,H.statusCode||401)}var T=function(H){return a.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):C.stringify(E.parse(H))},l=function(H,U){if(a.default.Config.createHmac){var I=a.default.Config.createHmac("SHA256",U);return I.update(H),I.digest("base64")}return C.stringify(f.default(H,U))};function v(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var U={},I=m.keysArray(H,!0);if(!I)return"";I.sort();for(var x=0;x<I.length;x++)U[I[x]]=H[I[x]].sort();return JSON.stringify(U)}function d(H){if(H.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var U="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",U),new Error(U)}}function p(H){return"useTokenAuth"in H&&!H.useTokenAuth}function u(H){return H.useTokenAuth||!p(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function A(H){return!H.key&&!H.authCallback&&!H.authUrl}var _=0;function L(){return _++}var W=function(){function H(U,I){if(this.authOptions={},this.client=U,this.tokenParams=I.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,u(I)){if(I.key&&!l){var x="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new Error(x)}A(I)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(I.defaultTokenParams,I),d(this.authOptions)}else{if(!I.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new c.default(x,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(I)}}return H.prototype.authorize=function(U,I,x){var z=this,k;if(typeof U=="function"&&!x?(x=U,k=U=null):typeof I=="function"&&!x?(x=I,k=null):k=I,!x&&this.client.options.promises)return m.promisify(this,"authorize",arguments);if(k&&k.key&&this.authOptions.key!==k.key)throw new c.default("Unable to update auth options with incompatible key",40102,401);k&&"force"in k&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),m.isOnlyPropIn(k,"force")&&(k=null)),this._forceNewToken(U,k,function(J,ee){if(J){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize(J),x==null||x(J);return}O(z.client)?z.client.connection.connectionManager.onAuthUpdated(ee,x||M):x==null||x(null,ee)})},H.prototype.authorise=function(U,I,x){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(U,I,x)},H.prototype._forceNewToken=function(U,I,x){var z=this;this.tokenDetails=null,this._saveTokenOptions(U,I),d(this.authOptions),this._ensureValidAuthCredentials(!0,function(k,J){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,x(k,J)})},H.prototype.requestToken=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return m.promisify(this,"requestToken",arguments);I=I||this.authOptions,U=U||m.copy(this.tokenParams);var k=x||M,J,ee=this.client;if(I.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=I.authCallback;else if(I.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(V,te){var le=m.mixin({accept:"application/json, text/plain"},I.authHeaders),me=I.authMethod&&I.authMethod.toLowerCase()==="post",ve,Se=I.authUrl.indexOf("?");Se>-1&&(ve=m.parseQueryString(I.authUrl.slice(Se)),I.authUrl=I.authUrl.slice(0,Se),me||(I.authParams=m.mixin(ve,I.authParams)));var Le=m.mixin({},I.authParams||{},V),de=function(Be,ke,ct,Z){var ie;if(Be?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+m.inspectError(Be)):(ie=ct["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+ie+"; body: "+m.inspectBody(ke))),Be||Z)return te(Be,ke);if(a.default.BufferUtils.isBuffer(ke)&&(ke=ke.toString()),!ie){te(new c.default("authUrl response is missing a content-type header",40170,401));return}var ue=ie.indexOf("application/json")>-1,pe=ie.indexOf("text/plain")>-1||ie.indexOf("application/jwt")>-1;if(!ue&&!pe){te(new c.default("authUrl responded with unacceptable content-type "+ie+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ue){if(ke.length>S){te(new c.default("authUrl response exceeded max permitted length",40170,401));return}try{ke=JSON.parse(ke)}catch(Re){te(new c.default("Unexpected error processing authURL response; err = "+Re.message,40170,401));return}}te(null,ke,ie)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+I.authUrl+"; Params: "+JSON.stringify(Le)+"; method: "+(me?"POST":"GET")),me){var xe=le||{};xe["content-type"]="application/x-www-form-urlencoded";var et=m.toQueryString(Le).slice(1);z.client.http.doUri(R.default.Post,ee,I.authUrl,xe,et,ve,de)}else z.client.http.doUri(R.default.Get,ee,I.authUrl,le||{},null,Le,de)};else if(I.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(V,te){z.createTokenRequest(V,I,te)};else{var Q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),k(new c.default(Q,40171,403));return}"capability"in U&&(U.capability=v(U.capability));var G=function(V,te){var le=V.keyName,me="/keys/"+le+"/requestToken",ve=function(Le){return ee.baseUri(Le)+me},Se=m.defaultPostHeaders();I.requestHeaders&&m.mixin(Se,I.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+me+"; Token params: "+JSON.stringify(V)),z.client.http.do(R.default.Post,ee,ve,Se,JSON.stringify(V),null,te)},D=!1,B=this.client.options.timeouts.realtimeRequestTimeout,j=setTimeout(function(){D=!0;var V="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",V),k(new c.default(V,40170,401))},B);J(U,function(V,te,le){if(!D){if(clearTimeout(j),V){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+m.inspectError(V)),k(b(V));return}if(typeof te=="string"){te.length===0?k(new c.default("Token string is empty",40170,401)):te.length>S?k(new c.default("Token string exceeded max permitted length (was "+te.length+" bytes)",40170,401)):te==="undefined"||te==="null"?k(new c.default("Token string was literal null/undefined",40170,401)):te[0]==="{"&&!(le&&le.indexOf("application/jwt")>-1)?k(new c.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):k(null,{token:te});return}if(typeof te!="object"){var me="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof te;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),k(new c.default(me,40170,401));return}var ve=JSON.stringify(te).length;if(ve>S&&!I.suppressMaxLengthCheck){k(new c.default("Token request/details object exceeded max permitted stringified size (was "+ve+" bytes)",40170,401));return}if("issued"in te){k(null,te);return}if(!("keyName"in te)){var me="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),k(new c.default(me,40170,401));return}G(te,function(Se,Le,de,xe){if(Se){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+m.inspectError(Se)),k(b(Se));return}xe||(Le=JSON.parse(Le)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),k(null,Le)})}})},H.prototype.createTokenRequest=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return m.promisify(this,"createTokenRequest",arguments);I=I||this.authOptions,U=U||m.copy(this.tokenParams);var k=I.key;if(!k){x(new c.default("No key specified",40101,403));return}var J=k.split(":"),ee=J[0],Q=J[1];if(!Q){x(new c.default("Invalid key specified",40101,403));return}if(U.clientId===""){x(new c.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in U&&(U.capability=v(U.capability));var G=m.mixin({keyName:ee},U),D=U.clientId||"",B=U.ttl||"",j=U.capability||"";(function(V){if(G.timestamp){V();return}z.getTimestamp(I&&I.queryTime,function(te,le){if(te){x(te);return}G.timestamp=le,V()})})(function(){var V=G.nonce||(G.nonce=P()),te=G.timestamp,le=G.keyName+`
`+B+`
`+j+`
`+D+`
`+te+`
`+V+`
`;G.mac=G.mac||l(le,Q),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(U){this.method=="basic"?U(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(U){this.method=="basic"?U(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{authorization:"Bearer "+T(x.token)})})},H.prototype.getTimestamp=function(U,I){!this.isTimeOffsetSet()&&(U||this.authOptions.queryTime)?this.client.time(I):I(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return m.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(U){this.method="basic",this.key=U.key,this.basicKey=T(U.key),this.authOptions=U||{},"clientId"in U&&this._userSetClientId(U.clientId)},H.prototype._saveTokenOptions=function(U,I){this.method="token",U&&(this.tokenParams=U),I&&(I.token&&(I.tokenDetails=typeof I.token=="string"?{token:I.token}:I.token),I.tokenDetails&&(this.tokenDetails=I.tokenDetails),"clientId"in I&&this._userSetClientId(I.clientId),this.authOptions=I)},H.prototype._ensureValidAuthCredentials=function(U,I){var x=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){I(new c.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),I(null,z);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=y.default.create())).push(I),!(this.currentTokenRequestId!==null&&!U)){var k=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(J,ee){if(x.currentTokenRequestId>k){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var Q=x.waitingForTokenRequest||M;if(x.waitingForTokenRequest=null,J){Q(J);return}Q(null,x.tokenDetails=ee)})}},H.prototype._userSetClientId=function(U){if(typeof U=="string"||U===null){if(U==="*")throw new c.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var I=this._uncheckedSetClientId(U);if(I)throw I}else throw new c.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(U){if(this._tokenClientIdMismatch(U)){var I="Unexpected clientId mismatch: client has "+this.clientId+", requested "+U,x=new c.default(I,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",I),x}else return this.clientId=this.tokenParams.clientId=U,null},H.prototype._tokenClientIdMismatch=function(U){return!!(this.clientId&&this.clientId!=="*"&&U&&U!=="*"&&this.clientId!==U)},H.isTokenErr=function(U){return U.code&&U.code>=40140&&U.code<40150},H}();r.default=W},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(s||(s={})),r.default=s},function(h,r,n){"use strict";r.__esModule=!0,r.HttpPaginatedResponse=r.PaginatedResult=void 0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(24));function c(S){var M=S.match(/^\.\/(\w+)\?(.*)$/);return M&&M[2]&&i.parseQueryString(M[2])}function f(S){typeof S=="string"&&(S=S.split(","));for(var M={},P=0;P<S.length;P++){var O=S[P].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(O){var b=c(O[1]);b&&(M[O[2]]=b)}}return M}function C(S,M,P){return!(P&&(M||typeof S.code=="number"))}var E=function(){function S(M,P,O,b,T,l){this.rest=M,this.path=P,this.headers=O,this.envelope=b!=null?b:null,this.bodyHandler=T,this.useHttpPaginatedResponse=l||!1}return S.prototype.get=function(M,P){var O=this;y.default.get(this.rest,this.path,this.headers,M,this.envelope,function(b,T,l,v,d){O.handlePage(b,T,l,v,d,P)})},S.prototype.delete=function(M,P){var O=this;y.default.delete(this.rest,this.path,this.headers,M,this.envelope,function(b,T,l,v,d){O.handlePage(b,T,l,v,d,P)})},S.prototype.post=function(M,P,O){var b=this;y.default.post(this.rest,this.path,P,this.headers,M,this.envelope,function(T,l,v,d,p){O&&b.handlePage(T,l,v,d,p,O)})},S.prototype.put=function(M,P,O){var b=this;y.default.put(this.rest,this.path,P,this.headers,M,this.envelope,function(T,l,v,d,p){O&&b.handlePage(T,l,v,d,p,O)})},S.prototype.patch=function(M,P,O){var b=this;y.default.patch(this.rest,this.path,P,this.headers,M,this.envelope,function(T,l,v,d,p){O&&b.handlePage(T,l,v,d,p,O)})},S.prototype.handlePage=function(M,P,O,b,T,l){if(M&&C(M,P,this.useHttpPaginatedResponse)){m.default.logAction(m.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(M)),l==null||l(M);return}var v,d,p;try{v=this.bodyHandler(P,O||{},b)}catch(u){l==null||l(M||u);return}O&&(d=O.Link||O.link)&&(p=f(d)),this.useHttpPaginatedResponse?l(null,new a(this,v,O||{},T,p,M)):l(null,new R(this,v,p))},S}(),R=function(){function S(M,P,O){var b=this;this.resource=M,this.items=P;var T=this;O&&("first"in O&&(this.first=function(l){if(!l&&T.resource.rest.options.promises)return i.promisify(T,"first",[]);T.get(O.first,l)}),"current"in O&&(this.current=function(l){if(!l&&T.resource.rest.options.promises)return i.promisify(T,"current",[]);T.get(O.current,l)}),this.next=function(l){if(!l&&T.resource.rest.options.promises)return i.promisify(T,"next",[]);"next"in O?T.get(O.next,l):l(null)},this.hasNext=function(){return"next"in O},this.isLast=function(){var l;return!(!((l=b.hasNext)===null||l===void 0)&&l.call(b))})}return S.prototype.get=function(M,P){var O=this.resource;y.default.get(O.rest,O.path,O.headers,M,O.envelope,function(b,T,l,v,d){O.handlePage(b,T,l,v,d,P)})},S}();r.PaginatedResult=R;var a=function(S){s.__extends(M,S);function M(P,O,b,T,l,v){var d=S.call(this,P,O,l)||this;return d.statusCode=T,d.success=T<300&&T>=200,d.headers=b,d.errorCode=v&&v.code,d.errorMessage=v&&v.message,d}return M.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},M}(R);r.HttpPaginatedResponse=a,r.default=E},function(h,r,n){"use strict";r.__esModule=!0,r.isRetriable=void 0;var s=n(1),i=s.__importDefault(n(5)),m={disconnected:i.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:i.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:i.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:i.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:i.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:i.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:i.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function y(c){if(!c.statusCode||!c.code||c.statusCode>=500)return!0;var f=!1;return Object.values(m).forEach(function(C){C.code&&C.code==c.code&&(f=!0)}),f}r.isRetriable=y,r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),r.default=s},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(s){return s})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),m=function(){function y(c){this.members=c||[]}return y.prototype.call=function(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];for(var C=0,E=this.members;C<E.length;C++){var R=E[C];if(R)try{R.apply(void 0,c)}catch(a){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},y.prototype.push=function(){for(var c,f=[],C=0;C<arguments.length;C++)f[C]=arguments[C];(c=this.members).push.apply(c,f)},y.create=function(c){var f=new y(c);return Object.assign(function(){for(var C=[],E=0;E<arguments.length;E++)C[E]=arguments[E];return f.call.apply(f,C)},{push:function(C){return f.push(C)}})},y}();r.default=m},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){(function(){var i=s,m=i.lib,y=m.Base,c=i.enc,f=c.Utf8,C=i.algo,E=C.HMAC=y.extend({init:function(R,a){R=this._hasher=new R.init,typeof a=="string"&&(a=f.parse(a));var S=R.blockSize,M=S*4;a.sigBytes>M&&(a=R.finalize(a)),a.clamp();for(var P=this._oKey=a.clone(),O=this._iKey=a.clone(),b=P.words,T=O.words,l=0;l<S;l++)b[l]^=1549556828,T[l]^=909522486;P.sigBytes=O.sigBytes=M,this.reset()},reset:function(){var R=this._hasher;R.reset(),R.update(this._iKey)},update:function(R){return this._hasher.update(R),this},finalize:function(R){var a=this._hasher,S=a.finalize(R);a.reset();var M=a.finalize(this._oKey.clone().concat(S));return M}})})()})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(3)),c=s.__importDefault(n(16)),f=s.__importDefault(n(17)),C=s.__importDefault(n(5));function E(O,b,T,l,v){O.http.supportsAuthHeaders?O.auth.getAuthHeaders(function(d,p){d?l(d):v(m.mixin(p,b),T)}):O.auth.getAuthParams(function(d,p){d?l(d):v(b,m.mixin(p,T))})}function R(O,b){return function(T,l,v,d,p){if(T&&!l){O(T);return}if(!d)try{l=m.decodeBody(l,b)}catch(H){O(H);return}if(!l){O(new C.default("unenvelope(): Response body is missing",null));return}var u=l,A=u.statusCode,_=u.response,L=u.headers;if(A===void 0){O(T,l,v,!0,p);return}if(A<200||A>=300){var W=_&&_.error||T;W||(W=new Error("Error in unenveloping "+l),W.statusCode=A),O(W,_,L,!0,A);return}O(T,_,L,!0,A)}}function a(O){var b=[];if(O)for(var T in O)b.push(T+"="+O[T]);return b.join("&")}function S(O,b){return O+(b?"?":"")+a(b)}function M(O,b,T,l){return function(v,d,p,u,A){v?y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Received Error; "+S(T,l)+"; Error: "+m.inspectError(v)):y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Received; "+S(T,l)+"; Headers: "+a(p)+"; StatusCode: "+A+"; Body: "+(i.default.BufferUtils.isBuffer(d)?d.toString():d)),O&&O(v,d,p,u,A)}}var P=function(){function O(){}return O.get=function(b,T,l,v,d,p){O.do(f.default.Get,b,T,null,l,v,d,p)},O.delete=function(b,T,l,v,d,p){O.do(f.default.Delete,b,T,null,l,v,d,p)},O.post=function(b,T,l,v,d,p,u){O.do(f.default.Post,b,T,l,v,d,p,u)},O.patch=function(b,T,l,v,d,p,u){O.do(f.default.Patch,b,T,l,v,d,p,u)},O.put=function(b,T,l,v,d,p,u){O.do(f.default.Put,b,T,l,v,d,p,u)},O.do=function(b,T,l,v,d,p,u,A){y.default.shouldLog(y.default.LOG_MICRO)&&(A=M(A,b,l,p)),u&&(A=A&&R(A,u),(p=p||{}).envelope=u);function _(L,W){var H;if(y.default.shouldLog(y.default.LOG_MICRO)&&y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending; "+S(l,W)),y.default.shouldLog(y.default.LOG_MICRO)){var U=v;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{U=i.default.Config.msgpack.decode(v)}catch(I){y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending MsgPack Decoding Error: "+m.inspectError(I))}y.default.logAction(y.default.LOG_MICRO,"Resource."+b+"()","Sending; "+S(l,W)+"; Body: "+U)}T.http.do(b,T,l,L,v,W,function(I,x,z,k,J){if(I&&c.default.isTokenErr(I)){T.auth.authorize(null,null,function(ee){if(ee){A(ee);return}E(T,z,W,A,_)});return}A(I,x,z,k,J)})}E(T,d,p,A,_)},O}();r.default=P},function(h,r,n){"use strict";(function(s){r.__esModule=!0,r.TransportParams=void 0;var i=n(1),m=i.__importDefault(n(10)),y=i.__importStar(n(2)),c=i.__importStar(n(51)),f=i.__importDefault(n(8)),C=i.__importDefault(n(0)),E=i.__importDefault(n(7)),R=i.__importDefault(n(35)),a=i.__importDefault(n(3)),S=i.__importDefault(n(36)),M=i.__importStar(n(19)),P=i.__importDefault(n(5)),O=i.__importDefault(n(16)),b=i.__importDefault(n(9)),T=i.__importDefault(n(22)),l=i.__importDefault(n(52)),v=i.__importDefault(n(26)),d=i.__importDefault(n(53)),p=function(){var ee;return typeof C.default.WebStorage!="undefined"&&((ee=C.default.WebStorage)===null||ee===void 0?void 0:ee.localSupported)},u=function(){var ee;return typeof C.default.WebStorage!="undefined"&&((ee=C.default.WebStorage)===null||ee===void 0?void 0:ee.sessionSupported)},A=m.default.Action,_=function(){},L="ably-transport-preference",W="ably-connection-recovery";function H(){var ee,Q;return u()&&((Q=(ee=C.default.WebStorage)===null||ee===void 0?void 0:ee.getSession)===null||Q===void 0?void 0:Q.call(ee,W))}function U(ee){var Q,G;return u()&&((G=(Q=C.default.WebStorage)===null||Q===void 0?void 0:Q.setSession)===null||G===void 0?void 0:G.call(Q,W,ee))}function I(){var ee,Q;return u()&&((Q=(ee=C.default.WebStorage)===null||ee===void 0?void 0:ee.removeSession)===null||Q===void 0?void 0:Q.call(ee,W))}function x(ee,Q){return y.arrIndexOf(C.default.Defaults.transportPreferenceOrder,ee.shortName)>y.arrIndexOf(C.default.Defaults.transportPreferenceOrder,Q.shortName)}function z(ee,Q,G){var D;if(ee.channel!==Q.channel||(D=ee.action)!==A.PRESENCE&&D!==A.MESSAGE||D!==Q.action)return!1;var B=D===A.PRESENCE?"presence":"messages",j=ee[B].concat(Q[B]),V=b.default.getMessagesSize(j);return V>G||!y.allSame(j,"clientId")||!y.arrEvery(j,function(te){return!te.id})?!1:(ee[B]=j,!0)}var k=function(){function ee(Q,G,D,B){this.options=Q,this.host=G,this.mode=D,this.connectionKey=B,this.format=Q.useBinaryProtocol?y.Format.msgpack:y.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return ee.prototype.getConnectParams=function(Q){var G=Q?y.copy(Q):{},D=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var B=D.recover.split(":");if(B){G.recover=B[0];var j=B[1];isNaN(Number(j))?G.timeSerial=j:G.connectionSerial=j}break}default:}return D.clientId!==void 0&&(G.clientId=D.clientId),D.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=f.default.apiVersion,G.agent=encodeURIComponent(f.default.agent),D.transportParams!==void 0&&y.mixin(G,D.transportParams),G},ee.prototype.toString=function(){var Q="[mode="+this.mode;return this.host&&(Q+=",host="+this.host),this.connectionKey&&(Q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Q+=",timeSerial="+this.timeSerial),this.format&&(Q+=",format="+this.format),Q+="]",Q},ee}();r.TransportParams=k;var J=function(ee){i.__extends(Q,ee);function Q(G,D){var B=ee.call(this)||this;B.disconnectedRetryCount=0,Q.initTransports(),B.realtime=G,B.options=D;var j=D.timeouts,V=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new R.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.timeSerial=void 0,B.connectionSerial=void 0,B.connectionStateTtl=j.connectionStateTtl,B.maxIdleInterval=null,B.transports=y.intersect(D.transports||f.default.defaultTransports,Q.supportedTransports),B.baseTransport=y.intersect(f.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=y.intersect(B.transports,f.default.upgradeTransports),B.transportPreference=null,B.httpHosts=f.default.getHosts(D),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.mostRecentMsg=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(D.transports||f.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var te="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",te),new Error(te)}var le=C.default.Config.addEventListener;return le&&(u()&&typeof D.recover=="function"&&le("beforeunload",B.persistConnection.bind(B)),D.closeOnUnload===!0&&le("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),le("online",function(){(B.state==B.states.disconnected||B.state==B.states.suspended)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),B.requestState({state:"connecting"}))}),le("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),B.disconnectAllTransports())})),B}return Q.initTransports=function(){l.default(Q),y.arrForEach(C.default.Transports,function(G){G(Q)})},Q.prototype.createTransportParams=function(G,D){var B=new k(this.options,G,D,this.connectionKey);return this.timeSerial?B.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(B.connectionSerial=this.connectionSerial),B},Q.prototype.getTransportParams=function(G){var D=this,B=function(j){if(D.connectionKey){j("resume");return}if(typeof D.options.recover=="string"){j("recover");return}var V=D.options.recover,te=H();if(te&&typeof V=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(te,function(le){le?(D.options.recover=te.recoveryKey,j("recover")):j("clean")});return}j("clean")};B(function(j){var V=D.createTransportParams(null,j);if(j==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+D.options.recover);var te=D.options.recover.split(":");te&&te[2]&&(D.msgSerial=Number(te[2]))}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());G(V)})},Q.prototype.tryATransport=function(G,D,B){var j=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+D),v.default.tryConnect(Q.supportedTransports[D],this,this.realtime.auth,G,function(V,te){var le=j.state;if(le==j.states.closing||le==j.states.closed||le==j.states.failed){te&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+le.state+" while we were attempting the transport; closing "+te),te.close()),B(!0);return}if(V){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+D+" "+V.event+", err: "+V.error.toString()),O.default.isTokenErr(V.error)&&!(j.errorReason&&O.default.isTokenErr(j.errorReason))?(j.errorReason=V.error,j.realtime.auth._forceNewToken(null,null,function(me){if(me){j.actOnErrorFromAuthorize(me);return}j.tryATransport(G,D,B)})):V.event==="failed"?(j.notifyState({state:"failed",error:V.error}),B(!0)):V.event==="disconnected"&&(M.isRetriable(V.error)?B(!1):(j.notifyState({state:j.states.connecting.failState,error:V.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+D+"; setting pending"),j.setTransportPending(te,G),B(null,te)})},Q.prototype.setTransportPending=function(G,D){var B=this,j=D.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+j),y.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var V=C.default.Defaults.transportPreferenceOrder[C.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(le,me,ve,Se){j=="upgrade"?G.shortName!==V&&y.arrIn(B.getUpgradePossibilities(),V)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(le,G,me,ve,Se)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(le,G,me,ve,Se):(B.activateTransport(le,G,me,ve,Se),C.default.Config.nextTick(function(){B.connectImpl(D)})),j==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var te=this;G.on(["disconnected","closed","failed"],function(le){te.deactivateTransport(G,this.event,le)}),this.emit("transport.pending",G)},Q.prototype.scheduleTransportActivation=function(G,D,B,j,V){var te=this,le=this.activeProtocol&&this.activeProtocol.getTransport(),me=function(){D.disconnect(),y.arrDeleteValue(te.pendingTransports,D)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}if(le&&!x(D,le)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+" is no better than current active transport "+le.shortName+" - abandoning upgrade"),me();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+D);var ve=function(Se){var Le;if(Se){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+D+"; err = "+Se);return}if(!D.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+"is no longer connected; abandoning upgrade"),me();return}if(te.state===te.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),te.state=te.states.synchronizing,Le=te.activeProtocol;else if(te.state!==te.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+te.state.state+(te.state===te.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}var de=B!==te.connectionId,xe=de?V:te;de&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(te.timeSerial||te.connectionSerial)+" to "+(xe.timeSerial||xe.connectionSerial)+"; upgrade error was "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+D),te.sync(D,xe,function(et,Be,ke){if(et){te.state===te.states.synchronizing&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+D+"; err = "+et),te.disconnectAllTransports());return}var ct=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+D),te.activateTransport(G,D,Be,j,ke),te.state===te.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+D),te.state=te.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+te.state.state+", so leaving unchanged"),te.state.sendEvents&&te.sendQueuedMessages()};Le?Le.onceIdle(ct):ct()})};le?this.realtime.channels.onceNopending(ve):ve()},Q.prototype.activateTransport=function(G,D,B,j,V){var te=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+D),G&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),j&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),V&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(V.timeSerial||V.connectionSerial)),this.persistTransportPreference(D);var le=this.state,me=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+le.state),le.state==this.states.closing.state||le.state==this.states.closed.state||le.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),D.disconnect(),!1;if(y.arrDeleteValue(this.pendingTransports,D),!D.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+D+" since it appears to no longer be connected"),!1;var ve=this.activeProtocol;this.activeProtocol=new c.default(D),this.host=D.params.host;var Se=j.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(B,j,V,!!G),this.onConnectionDetailsUpdate(j,D),C.default.Config.nextTick(function(){D.on("connected",function(de,xe,et){te.onConnectionDetailsUpdate(et,D),te.emit("update",new S.default(me,me,null,de))})}),le.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new S.default(me,me,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",D),ve)if(ve.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+ve.transport.shortName+", new one is "+D.shortName+") finishing with "+ve.messageQueue.count()+" messages still pending"),ve.transport===D){var Le="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+D.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",Le)}else ve.finish();return y.safeArrForEach(this.pendingTransports,function(de){if(de===D){var xe="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+D.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",xe),y.arrDeleteValue(te.pendingTransports,D)}else de.disconnect()}),y.safeArrForEach(this.proposedTransports,function(de){de===D?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+D.shortName+"; stack = "+new Error().stack),y.arrDeleteValue(te.proposedTransports,D)):de.dispose()}),!0},Q.prototype.deactivateTransport=function(G,D,B){var j=this.activeProtocol,V=j&&j.getTransport()===G,te=y.arrDeleteValue(this.pendingTransports,G),le=y.arrDeleteValue(this.proposedTransports,G),me=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+D+(V?"; was active":te?"; was pending":le?"; was proposed":"")+(me?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),V&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),C.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),V&&me||V&&D==="failed"||D==="closed"||j===null&&te&&this.pendingTransports.length===0){if(D==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:D,error:B,retryImmediately:!0});return}var ve=D==="failed"&&O.default.isTokenErr(B)?"disconnected":D;this.notifyState({state:ve,error:B});return}V&&D==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},Q.prototype.noTransportsScheduledForActivation=function(){return y.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Q.prototype.sync=function(G,D,B){var j=setTimeout(function(){G.off("sync"),B(new P.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),V=m.default.fromValues({action:A.SYNC,connectionKey:this.connectionKey});D.timeSerial?V.timeSerial=D.timeSerial:D.connectionSerial!==void 0&&(V.connectionSerial=D.connectionSerial),G.send(V),G.once("sync",function(te,le){clearTimeout(j),B(null,te,le)})},Q.prototype.setConnection=function(G,D,B,j){var V=this,te=this.connectionId,le=te&&te!==G,me=!te&&j;(le||me)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),C.default.Config.nextTick(function(){V.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){V.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=D.connectionKey;var ve=le||!te;this.setConnectionSerial(B,ve,!1)},Q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Q.prototype.setConnectionSerial=function(G,D,B){var j=G.timeSerial,V=G.connectionSerial;if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+V+"; timeSerial = "+j+"; force = "+D+"; previous = "+this.connectionSerial),j!==void 0){if(j<=this.timeSerial&&!D)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+j+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=j,this.setRecoveryKey();return}if(V!==void 0){if(V<=this.connectionSerial&&!D)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+V+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=V,this.setRecoveryKey()}},Q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=y.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Q.prototype.persistConnection=function(){if(u()){var G=this.realtime.connection.recoveryKey;G&&U({recoveryKey:G,disconnectedAt:y.now(),location:s.location,clientId:this.realtime.auth.clientId})}},Q.prototype.unpersistConnection=function(){I()},Q.prototype.getError=function(){return this.errorReason||this.getStateError()},Q.prototype.getStateError=function(){return M.default[this.state.state]},Q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Q.prototype.enactStateChange=function(G){var D=G.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(D,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var B=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Q.prototype.startTransitionTimer=function(G){var D=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){D.transitionTimer&&(D.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),D.notifyState({state:G.failState}))},G.retryDelay)},Q.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Q.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Q.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Q.prototype.startRetryTimer=function(G){var D=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),D.retryTimer=null,D.requestState({state:"connecting"})},G)},Q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Q.prototype.notifyState=function(G){var D=this,B=G.state,j=B==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&O.default.isTokenErr(G.error)&&!(this.errorReason&&O.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+B+(j?"; will retry connection immediately":"")),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(B==="suspended"||B==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var V=this.states[G.state],te=V.retryDelay;V.state==="disconnected"&&(this.disconnectedRetryCount++,te=V.retryDelay*y.getBackoffCoefficient(this.disconnectedRetryCount)*y.getJitterCoefficient());var le=new S.default(this.state.state,V.state,te,G.error||M.default[V.state]);if(j){var me=function(){D.state===D.states.disconnected&&(D.lastAutoReconnectAttempt=y.now(),D.requestState({state:"connecting"}))},ve=this.lastAutoReconnectAttempt&&y.now()-this.lastAutoReconnectAttempt+1;ve&&ve<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ve+"ms ago, waiting another "+(1e3-ve)+"ms before trying again"),setTimeout(me,1e3-ve)):C.default.Config.nextTick(me)}else(B==="disconnected"||B==="suspended")&&this.startRetryTimer(te);(B==="disconnected"&&!j||B==="suspended"||V.terminal)&&C.default.Config.nextTick(function(){D.disconnectAllTransports()}),B=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(le),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(B,le.reason),this.failQueuedMessages(le.reason))}},Q.prototype.requestState=function(G){var D=this,B=G.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+B+"; current state: "+this.state.state),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(B),!(B=="connecting"&&this.state.state=="connected")&&!(B=="closing"&&this.state.state=="closed"))){var j=this.states[B],V=new S.default(this.state.state,j.state,null,G.error||M.default[j.state]);this.enactStateChange(V),B=="connecting"&&C.default.Config.nextTick(function(){D.startConnect()}),B=="closing"&&this.closeImpl()}},Q.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var D=this.realtime.auth,B=++this.connectCounter,j=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(te){B===G.connectCounter&&G.connectImpl(te,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),D.method==="basic")j();else{var V=function(te){B===G.connectCounter&&(te?G.actOnErrorFromAuthorize(te):j())};this.errorReason&&O.default.isTokenErr(this.errorReason)?D._forceNewToken(null,null,V):D._ensureValidAuthCredentials(!1,V)}},Q.prototype.connectImpl=function(G,D){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,D)},Q.prototype.connectPreference=function(G){var D=this,B=this.getTransportPreference(),j=!1;y.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(G)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var V=setTimeout(function(){j=!0,D.state.state!==D.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),D.disconnectAllTransports(),D.unpersistTransportPreference()),D.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,B,function(te,le){clearTimeout(V),j&&le?(le.off(),le.disconnect(),y.arrDeleteValue(D.pendingTransports,le)):!le&&!te&&(D.unpersistTransportPreference(),D.connectImpl(G))})},Q.prototype.connectBase=function(G,D){var B=this,j=function(ve){B.notifyState({state:B.states.connecting.failState,error:ve})},V=this.httpHosts.slice(),te=function(ve,Se){D===B.connectCounter&&!Se&&!ve&&me()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var le=V.shift();if(!le){j(new P.default("Unable to connect (no available host)",80003,404));return}G.host=le;var me=function(){if(!V.length){j(new P.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){j(new P.default("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(ve,Se){if(D===B.connectCounter){if(ve){j(ve);return}if(!Se){j(new P.default("Unable to connect (network unreachable)",80003,404));return}G.host=y.arrPopRandomElement(V),B.tryATransport(G,B.baseTransport,te)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,me();return}this.tryATransport(G,this.baseTransport,te)},Q.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,D=y.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(D+1)},Q.prototype.upgradeIfNeeded=function(G){var D=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+C.default.Config.inspect(B)),B.length&&y.arrForEach(B,function(j){var V=D.createTransportParams(G.host,"upgrade");D.tryATransport(V,j,_)})},Q.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),y.safeArrForEach(this.pendingTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),y.safeArrForEach(this.proposedTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Q.prototype.onAuthUpdated=function(G,D){var B=this,j;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;C.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(V)})}var te=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();te&&te.onAuthUpdated&&te.onAuthUpdated(G);var le=m.default.fromValues({action:A.AUTH,auth:{accessToken:G.token}});this.send(le);var me=function(){B.off(ve),D(null,G)},ve=function(Le){Le.current==="failed"&&(B.off(me),B.off(ve),D(Le.reason||B.getStateError()))};this.once("connectiondetails",me),this.on("connectionstate",ve);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Se=function(Le){switch(Le.current){case"connected":B.off(Se),D(null,G);break;case"failed":case"closed":case"suspended":B.off(Se),D(Le.reason||B.getStateError());break;default:break}};this.on("connectionstate",Se),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Q.prototype.disconnectAllTransports=function(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,y.safeArrForEach(this.pendingTransports,function(D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+D),D&&D.disconnect()}),this.pendingTransports=[],y.safeArrForEach(this.proposedTransports,function(D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+D),D&&D.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Q.prototype.send=function(G,D,B){B=B||_;var j=this.state;if(j.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new c.PendingMessage(G,B));return}var V=D&&j.queueEvents||j.forceQueueEvents;if(!V){var te="rejecting event, queueEvent was "+D+", state was "+j.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",te),B(this.errorReason||new P.default(te,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+m.default.stringify(G)),this.queue(G,B)},Q.prototype.sendImpl=function(G){var D=G.message;G.ackRequired&&!G.sendAttempted&&(D.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},Q.prototype.queue=function(G,D){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),j=this.options.maxMessageSize;B&&!B.sendAttempted&&z(B.message,G,j)?(B.merged||(B.callback=T.default.create([B.callback]),B.merged=!0),B.callback.push(D)):this.queuedMessages.push(new c.PendingMessage(G,D))},Q.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Q.prototype.queuePendingMessages=function(G){G&&G.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Q.prototype.failQueuedMessages=function(G){var D=this.queuedMessages.count();D>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+D+" queued messages, err = "+y.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Q.prototype.onChannelMessage=function(G,D){var B=this.activeProtocol&&D===this.activeProtocol.getTransport(),j=y.arrIn(this.pendingTransports,D)&&this.state==this.states.synchronizing,V=G.action===A.MESSAGE||G.action===A.PRESENCE;if(B||j){if(V){var te=this.setConnectionSerial(G,!1,!0);if(te)return;if(m.default.isDuplicate(G,this.mostRecentMsg)){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else y.arrIndexOf([A.ACK,A.NACK,A.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Q.prototype.ping=function(G,D){var B=this;if(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var j=function(){G.off("heartbeat",le),D(new P.default("Timeout waiting for heartbeat response",5e4,500))},V=y.now(),te=y.cheapRandStr(),le=function(de){if(de===te){G.off("heartbeat",le),clearTimeout(me);var xe=y.now()-V;D(null,xe)}},me=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",le),G.ping(te);return}if(this.state.state!=="connected"){D(new P.default("Unable to ping service; not connected",4e4,400));return}var ve=!1,Se=function(de,xe){B.off("transport.active",Le),ve||(ve=!0,D(de,xe))},Le=function(){ve||(ve=!0,C.default.Config.nextTick(function(){B.ping(null,D)}))};this.on("transport.active",Le),this.ping(this.activeProtocol.getTransport(),Se)},Q.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Q.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Q.prototype.getTransportPreference=function(){var G,D;return this.transportPreference||p()&&((D=(G=C.default.WebStorage)===null||G===void 0?void 0:G.get)===null||D===void 0?void 0:D.call(G,L))},Q.prototype.persistTransportPreference=function(G){var D,B;y.arrIn(f.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,p()&&((B=(D=C.default.WebStorage)===null||D===void 0?void 0:D.set)===null||B===void 0||B.call(D,L,G.shortName)))},Q.prototype.unpersistTransportPreference=function(){var G,D;this.transportPreference=null,p()&&((D=(G=C.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||D===void 0||D.call(G,L))},Q.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===d.default.Forbidden){var D="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",D),this.notifyState({state:"failed",error:new P.default(D,80019,403,G)})}else{var D="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",D),this.notifyState({state:this.state.failState,error:new P.default(D,80019,401,G)})}},Q.prototype.onConnectionDetailsUpdate=function(G,D){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var B=G.clientId;if(B){var j=this.realtime.auth._uncheckedSetClientId(B);if(j){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),D.fail(j);return}}var V=G.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Q.supportedTransports={},Q}(E.default);r.default=J}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importStar(n(2)),y=s.__importDefault(n(7)),c=s.__importDefault(n(3)),f=s.__importDefault(n(19)),C=s.__importDefault(n(5)),E=s.__importDefault(n(0)),R=i.default.Action,a=i.default.fromValues({action:R.CLOSE}),S=i.default.fromValues({action:R.DISCONNECT}),M=function(P){s.__extends(O,P);function O(b,T,l,v){var d=P.call(this)||this;return v&&(l.format=void 0,l.heartbeats=!0),d.connectionManager=b,b.registerProposedTransport(d),d.auth=T,d.params=l,d.timeouts=l.options.timeouts,d.format=l.format,d.isConnected=!1,d.isFinished=!1,d.isDisposed=!1,d.maxIdleInterval=null,d.idleTimer=null,d.lastActivity=null,d}return O.prototype.connect=function(){},O.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",f.default.closed)},O.prototype.disconnect=function(b){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",b||f.default.disconnected)},O.prototype.fail=function(b){this.isConnected&&this.requestDisconnect(),this.finish("failed",b||f.default.failed)},O.prototype.finish=function(b,T){var l;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((l=this.idleTimer)!==null&&l!==void 0?l:void 0),this.idleTimer=null,this.emit(b,T),this.dispose())},O.prototype.onProtocolMessage=function(b){switch(c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(b)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),b.action){case R.HEARTBEAT:c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",b.id);break;case R.CONNECTED:this.onConnect(b),this.emit("connected",b.error,b.connectionId,b.connectionDetails,b);break;case R.CLOSED:this.onClose(b);break;case R.DISCONNECTED:this.onDisconnect(b);break;case R.ACK:this.emit("ack",b.msgSerial,b.count);break;case R.NACK:this.emit("nack",b.msgSerial,b.count,b.error);break;case R.SYNC:if(b.connectionId!==void 0){this.emit("sync",b.connectionId,b);break}this.connectionManager.onChannelMessage(b,this);break;case R.AUTH:this.auth.authorize(function(T){T&&c.default.logAction(c.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+m.inspectError(T))});break;case R.ERROR:if(c.default.logAction(c.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+E.default.Config.inspect(b.error)+(b.channel?", channel: "+b.channel:"")),b.channel===void 0){this.onFatalError(b);break}this.connectionManager.onChannelMessage(b,this);break;default:this.connectionManager.onChannelMessage(b,this)}},O.prototype.onConnect=function(b){if(this.isConnected=!0,!b.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=b.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},O.prototype.onDisconnect=function(b){var T=b&&b.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onDisconnect()","err = "+m.inspectError(T)),this.finish("disconnected",T)},O.prototype.onFatalError=function(b){var T=b&&b.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onFatalError()","err = "+m.inspectError(T)),this.finish("failed",T)},O.prototype.onClose=function(b){var T=b&&b.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onClose()","err = "+m.inspectError(T)),this.finish("closed",T)},O.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},O.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(S)},O.prototype.ping=function(b){var T={action:i.default.Action.HEARTBEAT};b&&(T.id=b),this.send(i.default.fromValues(T))},O.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},O.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=m.now(),this.setIdleTimer(this.maxIdleInterval+100))},O.prototype.setIdleTimer=function(b){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},b))},O.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var b=m.now()-this.lastActivity,T=this.maxIdleInterval-b;if(T<=0){var l="No activity seen from realtime in "+b+"ms; assuming connection has dropped";c.default.logAction(c.default.LOG_ERROR,"Transport.onIdleTimerExpire()",l),this.disconnect(new C.default(l,80003,408))}else this.setIdleTimer(T+100)},O.tryConnect=function(b,T,l,v,d){var p=new b(T,l,v),u,A=function(L){clearTimeout(u),d({event:this.event,error:L})},_=T.options.timeouts.realtimeRequestTimeout;u=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),A.call({event:"disconnected"},new C.default("Timeout waiting for transport to indicate itself viable",5e4,500))},_),p.on(["failed","disconnected"],A),p.on("preconnect",function(){c.default.logAction(c.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(u),p.off(["failed","disconnected"],A),d(null,p)}),p.connect()},O}(y.default);r.default=M},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(39),n(23))})(this,function(s){return function(){var i=s,m=i.lib,y=m.Base,c=m.WordArray,f=i.algo,C=f.MD5,E=f.EvpKDF=y.extend({cfg:y.extend({keySize:128/32,hasher:C,iterations:1}),init:function(R){this.cfg=this.cfg.extend(R)},compute:function(R,a){for(var S,M=this.cfg,P=M.hasher.create(),O=c.create(),b=O.words,T=M.keySize,l=M.iterations;b.length<T;){S&&P.update(S),S=P.update(R).finalize(a),P.reset();for(var v=1;v<l;v++)S=P.finalize(S),P.reset();O.concat(S)}return O.sigBytes=T*4,O}});i.EvpKDF=function(R,a,S){return E.create(S).compute(R,a)}}(),s.EvpKDF})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(27))})(this,function(s){s.lib.Cipher||function(i){var m=s,y=m.lib,c=y.Base,f=y.WordArray,C=y.BufferedBlockAlgorithm,E=m.enc,R=E.Utf8,a=E.Base64,S=m.algo,M=S.EvpKDF,P=y.Cipher=C.extend({cfg:c.extend(),createEncryptor:function(I,x){return this.create(this._ENC_XFORM_MODE,I,x)},createDecryptor:function(I,x){return this.create(this._DEC_XFORM_MODE,I,x)},init:function(I,x,z){this.cfg=this.cfg.extend(z),this._xformMode=I,this._key=x,this.reset()},reset:function(){C.reset.call(this),this._doReset()},process:function(I){return this._append(I),this._process()},finalize:function(I){I&&this._append(I);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function I(x){return typeof x=="string"?U:L}return function(x){return{encrypt:function(z,k,J){return I(k).encrypt(x,z,k,J)},decrypt:function(z,k,J){return I(k).decrypt(x,z,k,J)}}}}()}),O=y.StreamCipher=P.extend({_doFinalize:function(){var I=this._process(!0);return I},blockSize:1}),b=m.mode={},T=y.BlockCipherMode=c.extend({createEncryptor:function(I,x){return this.Encryptor.create(I,x)},createDecryptor:function(I,x){return this.Decryptor.create(I,x)},init:function(I,x){this._cipher=I,this._iv=x}}),l=b.CBC=function(){var I=T.extend();I.Encryptor=I.extend({processBlock:function(z,k){var J=this._cipher,ee=J.blockSize;x.call(this,z,k,ee),J.encryptBlock(z,k),this._prevBlock=z.slice(k,k+ee)}}),I.Decryptor=I.extend({processBlock:function(z,k){var J=this._cipher,ee=J.blockSize,Q=z.slice(k,k+ee);J.decryptBlock(z,k),x.call(this,z,k,ee),this._prevBlock=Q}});function x(z,k,J){var ee,Q=this._iv;Q?(ee=Q,this._iv=i):ee=this._prevBlock;for(var G=0;G<J;G++)z[k+G]^=ee[G]}return I}(),v=m.pad={},d=v.Pkcs7={pad:function(I,x){for(var z=x*4,k=z-I.sigBytes%z,J=k<<24|k<<16|k<<8|k,ee=[],Q=0;Q<k;Q+=4)ee.push(J);var G=f.create(ee,k);I.concat(G)},unpad:function(I){var x=I.words[I.sigBytes-1>>>2]&255;I.sigBytes-=x}},p=y.BlockCipher=P.extend({cfg:P.cfg.extend({mode:l,padding:d}),reset:function(){var I;P.reset.call(this);var x=this.cfg,z=x.iv,k=x.mode;this._xformMode==this._ENC_XFORM_MODE?I=k.createEncryptor:(I=k.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==I?this._mode.init(this,z&&z.words):(this._mode=I.call(k,this,z&&z.words),this._mode.__creator=I)},_doProcessBlock:function(I,x){this._mode.processBlock(I,x)},_doFinalize:function(){var I,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),I=this._process(!0)):(I=this._process(!0),x.unpad(I)),I},blockSize:128/32}),u=y.CipherParams=c.extend({init:function(I){this.mixIn(I)},toString:function(I){return(I||this.formatter).stringify(this)}}),A=m.format={},_=A.OpenSSL={stringify:function(I){var x,z=I.ciphertext,k=I.salt;return k?x=f.create([1398893684,1701076831]).concat(k).concat(z):x=z,x.toString(a)},parse:function(I){var x,z=a.parse(I),k=z.words;return k[0]==1398893684&&k[1]==1701076831&&(x=f.create(k.slice(2,4)),k.splice(0,4),z.sigBytes-=16),u.create({ciphertext:z,salt:x})}},L=y.SerializableCipher=c.extend({cfg:c.extend({format:_}),encrypt:function(I,x,z,k){k=this.cfg.extend(k);var J=I.createEncryptor(z,k),ee=J.finalize(x),Q=J.cfg;return u.create({ciphertext:ee,key:z,iv:Q.iv,algorithm:I,mode:Q.mode,padding:Q.padding,blockSize:I.blockSize,formatter:k.format})},decrypt:function(I,x,z,k){k=this.cfg.extend(k),x=this._parse(x,k.format);var J=I.createDecryptor(z,k).finalize(x.ciphertext);return J},_parse:function(I,x){return typeof I=="string"?x.parse(I,this):I}}),W=m.kdf={},H=W.OpenSSL={execute:function(I,x,z,k){k||(k=f.random(64/8));var J=M.create({keySize:x+z}).compute(I,k),ee=f.create(J.words.slice(x),z*4);return J.sigBytes=x*4,u.create({key:J,iv:ee,salt:k})}},U=y.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(I,x,z,k){k=this.cfg.extend(k);var J=k.kdf.execute(z,I.keySize,I.ivSize);k.iv=J.iv;var ee=L.encrypt.call(this,I,x,J.key,k);return ee.mixIn(J),ee},decrypt:function(I,x,z,k){k=this.cfg.extend(k),x=this._parse(x,k.format);var J=k.kdf.execute(z,I.keySize,I.ivSize,x.salt);k.iv=J.iv;var ee=L.decrypt.call(this,I,x,J.key,k);return ee}})}()})},function(h,r,n){"use strict";r.__esModule=!0,r.Request=r.createRequest=void 0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(11)),y=s.__importDefault(n(0)),c=s.__importDefault(n(7)),f=s.__importDefault(n(5)),C=s.__importDefault(n(8)),E=s.__importDefault(n(3)),R=s.__importDefault(n(20)),a=i.getGlobalObject(),S=function(){},M=a._ablyjs_jsonp={};M._=function(d){return M["_"+d]||S};var P=1,O="jsonp";function b(d,p,u,A,_,L,W){return L=L||C.default.TIMEOUTS,new l(void 0,d,p,i.copy(u),A,_,L,W)}r.createRequest=b;var T=function(d){s.__extends(p,d);function p(u,A,_){var L=d.call(this,u,A,_)||this;return L.shortName=O,_.stream=!1,L}return p.isAvailable=function(){return y.default.Config.jsonpSupported&&y.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(u,A,_,L,W,H,U){return H=(this===null||this===void 0?void 0:this.timeouts)||H||C.default.TIMEOUTS,b(u,A,_,L,W,H,U)},p}(m.default),l=function(d){s.__extends(p,d);function p(u,A,_,L,W,H,U,I){var x=d.call(this)||this;return u===void 0&&(u=P++),x.id=u,x.uri=A,x.params=L||{},x.params.rnd=i.cheapRandStr(),_&&(_["X-Ably-Version"]&&(x.params.v=_["X-Ably-Version"]),_["X-Ably-Lib"]&&(x.params.lib=_["X-Ably-Lib"])),x.body=W,x.method=I,x.requestMode=H,x.timeouts=U,x.requestComplete=!1,x}return p.prototype.exec=function(){var u=this,A=this.id,_=this.body,L=this.method,W=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+A+")",H.envelope="jsonp",_&&(H.body=_),L&&L!=="get"&&(H.method=L);var U=this.script=document.createElement("script"),I=W+i.toQueryString(H);U.src=I,U.src.split("/").slice(-1)[0]!==I.split("/").slice(-1)[0]&&E.default.logAction(E.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),U.async=!0,U.type="text/javascript",U.charset="UTF-8",U.onerror=function(k){u.complete(new f.default("JSONP script error (event: "+y.default.Config.inspect(k)+")",null,400))},M["_"+A]=function(k){if(k.statusCode){var J=k.response;if(k.statusCode==204)u.complete(null,null,null,k.statusCode);else if(!J)u.complete(new f.default("Invalid server response: no envelope detected",null,500));else if(k.statusCode<400||i.isArray(J))u.complete(null,J,k.headers,k.statusCode);else{var ee=J.error||new f.default("Error response received from server",null,k.statusCode);u.complete(ee)}}else u.complete(null,k)};var x=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var z=document.getElementsByTagName("head")[0];z.insertBefore(U,z.firstChild)},p.prototype.complete=function(u,A,_,L){if(_=_||{},!this.requestComplete){this.requestComplete=!0;var W=void 0;A&&(W=typeof A=="string"?"text/plain":"application/json",_["content-type"]=W,this.emit("data",A)),this.emit("complete",u,A,_,!0,L),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var u=this.timer;u&&(clearTimeout(u),this.timer=null);var A=this.script;A.parentNode&&A.parentNode.removeChild(A),delete M[this.id],this.emit("disposed")},p}(c.default);r.Request=l;function v(d){return a.JSONPTransport=T,T.isAvailable()&&(d.supportedTransports[O]=T),T}r.default=v},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(3)),y=s.__importDefault(n(8)),c=s.__importDefault(n(16)),f=s.__importDefault(n(45)),C=s.__importDefault(n(18)),E=s.__importDefault(n(33)),R=s.__importDefault(n(5)),a=s.__importDefault(n(48)),S=s.__importDefault(n(17)),M=s.__importDefault(n(0)),P=function(){},O=function(){function T(l){if(!l){var v="no options provided";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",v),new Error(v)}var d=y.default.objectifyOptions(l);d.log&&m.default.setLog(d.log.level,d.log.handler),m.default.logAction(m.default.LOG_MICRO,"Rest()","initialized with clientOptions "+M.default.Config.inspect(l));var p=this.options=y.default.normaliseOptions(d);if(p.key){var u=p.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!u){var v="invalid key parameter";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",v),new R.default(v,40400,404)}p.keyName=u[1],p.keySecret=u[2]}if("clientId"in p)if(typeof p.clientId=="string"||p.clientId===null){if(p.clientId==="*")throw new R.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new R.default("clientId must be either a string or null",40012,400);m.default.logAction(m.default.LOG_MINOR,"Rest()","started; version = "+y.default.version),this.baseUri=this.authority=function(A){return y.default.getHttpScheme(p)+A+":"+y.default.getPort(p,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new M.default.Http,this.auth=new c.default(this,p),this.channels=new b(this),this.push=new f.default(this)}return T.prototype.stats=function(l,v){if(v===void 0)if(typeof l=="function")v=l,l=null;else{if(this.options.promises)return i.promisify(this,"stats",arguments);v=P}var d=i.defaultGetHeaders(),p=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,u=this.http.supportsLinkHeaders?void 0:p;this.options.headers&&i.mixin(d,this.options.headers),new C.default(this,"/stats",d,u,function(A,_,L){for(var W=L?A:JSON.parse(A),H=0;H<W.length;H++)W[H]=a.default.fromValues(W[H]);return W}).get(l,v)},T.prototype.time=function(l,v){var d=this;if(v===void 0){if(typeof l=="function")v=l,l=null;else if(this.options.promises)return i.promisify(this,"time",arguments)}var p=v||P,u=i.defaultGetHeaders();this.options.headers&&i.mixin(u,this.options.headers);var A=function(_){return d.authority(_)+"/time"};this.http.do(S.default.Get,this,A,u,null,l,function(_,L,W,H){if(_){p(_);return}H||(L=JSON.parse(L));var U=L[0];if(!U){p(new R.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=U-i.now(),p(null,U)})},T.prototype.request=function(l,v,d,p,u,A){var _=this.options.useBinaryProtocol,L=_?M.default.Config.msgpack.encode:JSON.stringify,W=_?M.default.Config.msgpack.decode:JSON.parse,H=_?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:H;d=d||{};var I=l.toLowerCase(),x=I=="get"?i.defaultGetHeaders(H):i.defaultPostHeaders(H);if(A===void 0){if(this.options.promises)return i.promisify(this,"request",arguments);A=P}typeof p!="string"&&(p=L(p)),this.options.headers&&i.mixin(x,this.options.headers),u&&i.mixin(x,u);var z=new C.default(this,v,x,U,function(k,J,ee){return i.ensureArray(ee?k:W(k))},!0);if(!i.arrIn(M.default.Http.methods,I))throw new R.default("Unsupported method "+I,40500,405);i.arrIn(M.default.Http.methodsWithBody,I)?z[I](d,p,A):z[I](d,A)},T.prototype.setLog=function(l){m.default.setLog(l.level,l.handler)},T.Promise=function(l){return l=y.default.objectifyOptions(l),l.promises=!0,new T(l)},T.Callbacks=T,T.Platform=M.default,T}(),b=function(){function T(l){this.rest=l,this.all={}}return T.prototype.get=function(l,v){l=String(l);var d=this.all[l];return d?v&&d.setOptions(v):this.all[l]=d=new E.default(this.rest,l,v),d},T.prototype.release=function(l){delete this.all[String(l)]},T}();r.default=O},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(i){var m=s,y=m.lib,c=y.WordArray,f=y.Hasher,C=m.algo,E=[],R=[];(function(){function M(T){for(var l=i.sqrt(T),v=2;v<=l;v++)if(!(T%v))return!1;return!0}function P(T){return(T-(T|0))*4294967296|0}for(var O=2,b=0;b<64;)M(O)&&(b<8&&(E[b]=P(i.pow(O,1/2))),R[b]=P(i.pow(O,1/3)),b++),O++})();var a=[],S=C.SHA256=f.extend({_doReset:function(){this._hash=new c.init(E.slice(0))},_doProcessBlock:function(M,P){for(var O=this._hash.words,b=O[0],T=O[1],l=O[2],v=O[3],d=O[4],p=O[5],u=O[6],A=O[7],_=0;_<64;_++){if(_<16)a[_]=M[P+_]|0;else{var L=a[_-15],W=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=a[_-2],U=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;a[_]=W+a[_-7]+U+a[_-16]}var I=d&p^~d&u,x=b&T^b&l^T&l,z=(b<<30|b>>>2)^(b<<19|b>>>13)^(b<<10|b>>>22),k=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),J=A+k+I+R[_]+a[_],ee=z+x;A=u,u=p,p=d,d=v+J|0,v=l,l=T,T=b,b=J+ee|0}O[0]=O[0]+b|0,O[1]=O[1]+T|0,O[2]=O[2]+l|0,O[3]=O[3]+v|0,O[4]=O[4]+d|0,O[5]=O[5]+p|0,O[6]=O[6]+u|0,O[7]=O[7]+A|0},_doFinalize:function(){var M=this._data,P=M.words,O=this._nDataBytes*8,b=M.sigBytes*8;return P[b>>>5]|=128<<24-b%32,P[(b+64>>>9<<4)+14]=i.floor(O/4294967296),P[(b+64>>>9<<4)+15]=O,M.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var M=f.clone.call(this);return M._hash=this._hash.clone(),M}});m.SHA256=f._createHelper(S),m.HmacSHA256=f._createHmacHelper(S)}(Math),s.SHA256})},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return s.enc.Utf8})},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(3)),c=s.__importDefault(n(34)),f=s.__importDefault(n(9)),C=s.__importDefault(n(5)),E=s.__importDefault(n(18)),R=s.__importDefault(n(24)),a=s.__importDefault(n(0));function S(){}var M=9;function P(T){return i.arrEvery(T,function(l){return!l.id})}function O(T){var l=T||{};if(l.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var v=a.default.Crypto.getCipher(l.cipher);l.cipher=v.cipherParams,l.channelCipher=v.cipher}else"cipher"in l&&(l.cipher=void 0,l.channelCipher=null);return l}var b=function(T){s.__extends(l,T);function l(v,d,p){var u=T.call(this)||this;return y.default.logAction(y.default.LOG_MINOR,"Channel()","started; name = "+d),u.rest=v,u.name=d,u.basePath="/channels/"+encodeURIComponent(d),u.presence=new c.default(u),u.channelOptions=O(p),u}return l.prototype.setOptions=function(v){this.channelOptions=O(v)},l.prototype.history=function(v,d){if(y.default.logAction(y.default.LOG_MICRO,"Channel.history()","channel = "+this.name),d===void 0)if(typeof v=="function")d=v,v=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);d=S}this._history(v,d)},l.prototype._history=function(v,d){var p=this.rest,u=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:u,_=i.defaultGetHeaders(u);p.options.headers&&i.mixin(_,p.options.headers);var L=this.channelOptions;new E.default(p,this.basePath+"/messages",_,A,function(W,H,U){return f.default.fromResponseBody(W,L,U?void 0:u)}).get(v,d)},l.prototype.publish=function(){var v=this,d=arguments.length,p=arguments[0],u=arguments[1],A=arguments[d-1],_,L;if(typeof A!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);A=S}if(typeof p=="string"||p===null)_=[f.default.fromValues({name:p,data:u})],L=arguments[2];else if(i.isObject(p))_=[f.default.fromValues(p)],L=arguments[1];else if(i.isArray(p))_=f.default.fromValuesArray(p),L=arguments[1];else throw new C.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var W=this.rest,H=W.options,U=H.useBinaryProtocol?i.Format.msgpack:i.Format.json,I=W.options.idempotentRestPublishing,x=i.defaultPostHeaders(U);if(H.headers&&i.mixin(x,H.headers),I&&P(_)){var z=i.randomString(M);i.arrForEach(_,function(k,J){k.id=z+":"+J.toString()})}f.default.encodeArray(_,this.channelOptions,function(k){if(k){A(k);return}var J=f.default.getMessagesSize(_),ee=H.maxMessageSize;if(J>ee){A(new C.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+ee+" bytes)",40009,400));return}v._publish(f.default.serialize(_,U),x,L,A)})},l.prototype._publish=function(v,d,p,u){R.default.post(this.rest,this.basePath+"/messages",v,d,p,null,u)},l.prototype.status=function(v){if(typeof v!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var d=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(d);R.default.get(this.rest,this.basePath,p,{},d,v||S)},l}(m.default);r.default=b},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(3)),c=s.__importDefault(n(18)),f=s.__importDefault(n(14));function C(){}var E=function(R){s.__extends(a,R);function a(S){var M=R.call(this)||this;return M.channel=S,M.basePath=S.basePath+"/presence",M}return a.prototype.get=function(S,M){if(y.default.logAction(y.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),M===void 0)if(typeof S=="function")M=S,S=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);M=C}var P=this.channel.rest,O=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:O,T=i.defaultGetHeaders(O);P.options.headers&&i.mixin(T,P.options.headers);var l=this.channel.channelOptions;new c.default(P,this.basePath,T,b,function(v,d,p){return f.default.fromResponseBody(v,l,p?void 0:O)}).get(S,M)},a.prototype.history=function(S,M){y.default.logAction(y.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(S,M)},a.prototype._history=function(S,M){if(M===void 0)if(typeof S=="function")M=S,S=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",arguments);M=C}var P=this.channel.rest,O=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:O,T=i.defaultGetHeaders(O);P.options.headers&&i.mixin(T,P.options.headers);var l=this.channel.channelOptions;new c.default(P,this.basePath+"/history",T,b,function(v,d,p){return f.default.fromResponseBody(v,l,p?void 0:O)}).get(S,M)},a}(m.default);r.default=E},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(7)),m=s.__importDefault(n(3)),y=function(c){s.__extends(f,c);function f(){var C=c.call(this)||this;return C.messages=[],C}return f.prototype.count=function(){return this.messages.length},f.prototype.push=function(C){this.messages.push(C)},f.prototype.shift=function(){return this.messages.shift()},f.prototype.last=function(){return this.messages[this.messages.length-1]},f.prototype.copyAll=function(){return this.messages.slice()},f.prototype.append=function(C){this.messages.push.apply(this.messages,C)},f.prototype.prepend=function(C){this.messages.unshift.apply(this.messages,C)},f.prototype.completeMessages=function(C,E,R){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+C+"; count = "+E),R=R||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var S=a[0];if(S){var M=S.message.msgSerial,P=C+E;if(P>M)for(var O=a.splice(0,P-M),b=0,T=O;b<T.length;b++){var l=T[b];l.callback(R)}a.length==0&&this.emit("idle")}},f.prototype.completeAllMessages=function(C){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,C)},f.prototype.clear=function(){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},f}(i.default);r.default=y},function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(m,y,c,f){this.previous=m,this.current=y,c&&(this.retryIn=c),f&&(this.reason=f)}return i}();r.default=s},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importDefault(n(7)),y=s.__importStar(n(2)),c=s.__importDefault(n(33)),f=s.__importDefault(n(3)),C=s.__importDefault(n(54)),E=s.__importDefault(n(9)),R=s.__importDefault(n(38)),a=s.__importDefault(n(5)),S=s.__importDefault(n(14)),M=s.__importDefault(n(19)),P=i.default.Action,O=function(){},b="statechange",T="sync";function l(d){if(d&&"params"in d&&!y.isObject(d.params))return new a.default("options.params must be an object",4e4,400);if(d&&"modes"in d){if(!y.isArray(d.modes))return new a.default("options.modes must be an array",4e4,400);for(var p=0;p<d.modes.length;p++){var u=d.modes[p];if(!u||typeof u!="string"||!y.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(u)))return new a.default("Invalid channel mode: "+u,4e4,400)}}}var v=function(d){s.__extends(p,d);function p(u,A,_){var L=d.call(this,u,A,_)||this;return L.retryCount=0,L.history=function(W,H){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof W=="function")H=W,W=null;else{if(this.rest.options.promises)return y.promisify(this,"history",arguments);H=O}if(W&&W.untilAttach){if(this.state!=="attached"){H(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete W.untilAttach,W.from_serial=this.properties.attachSerial}c.default.prototype._history.call(this,W,H)},L.whenState=function(W,H){return m.default.prototype.whenState.call(L,W,L.state,H)},f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel()","started; name = "+A),L.realtime=u,L.presence=new C.default(L),L.connectionManager=u.connection.connectionManager,L.state="initialized",L.subscriptions=new m.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(_),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:u.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new m.default,L}return p.invalidStateError=function(u){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+u}},p.processListenerArgs=function(u){return u=Array.prototype.slice.call(u),typeof u[0]=="function"&&u.unshift(null),u[u.length-1]==null&&u.pop(),u},p.prototype.setOptions=function(u,A){if(!A&&this.rest.options.promises)return y.promisify(this,"setOptions",arguments);var _=A||function(W){W&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+W.toString())},L=l(u);if(L){_(L);return}c.default.prototype.setOptions.call(this,u),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(u)?(this.attachImpl(),this._allChannelChanges.once(function(W){switch(this.event){case"update":case"attached":_==null||_(null);return;default:_==null||_(W.reason);return}})):_()},p.prototype._shouldReattachToSetOptions=function(u){return(this.state==="attached"||this.state==="attaching")&&(u.params||u.modes)},p.prototype.publish=function(){for(var u=this,A=[],_=0;_<arguments.length;_++)A[_]=arguments[_];var L=A[0],W=A.length,H=A[W-1];if(typeof H!="function"){if(this.realtime.options.promises)return y.promisify(this,"publish",arguments);H=O,++W}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(W==2)if(y.isObject(L))L=[E.default.fromValues(L)];else if(y.isArray(L))L=E.default.fromValuesArray(L);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[E.default.fromValues({name:A[0],data:A[1]})];var U=this.realtime.options.maxMessageSize;E.default.encodeArray(L,this.channelOptions,function(I){if(I){H(I);return}var x=E.default.getMessagesSize(L);if(x>U){H(new a.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+U+" bytes)",40009,400));return}u.__publish(L,H)})},p.prototype.__publish=function(u,A){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+u.length);var _=this.state;switch(_){case"failed":case"suspended":A(a.default.fromValues(p.invalidStateError(_)));break;default:{f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+_);var L=new i.default;L.action=P.MESSAGE,L.channel=this.name,L.messages=u,this.sendMessage(L,A);break}}},p.prototype.onEvent=function(u){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var A=this.subscriptions,_=0;_<u.length;_++){var L=u[_];A.emit(L.name,L)}},p.prototype.attach=function(u,A){var _;if(typeof u=="function"?(A=u,_=null):_=u,!A){if(this.realtime.options.promises)return y.promisify(this,"attach",arguments);A=function(L){L&&f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(_)f.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=_;else if(this.state==="attached"){A();return}this._attach(!1,null,A)},p.prototype._attach=function(u,A,_){_||(_=function(W){W&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+W.toString())});var L=this.connectionManager;if(!L.activeState()){_(L.getError());return}(this.state!=="attaching"||u)&&this.requestState("attaching",A),this.once(function(W){switch(this.event){case"attached":_==null||_();break;case"detached":case"suspended":case"failed":_==null||_(W.reason||L.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":_==null||_(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},p.prototype.attachImpl=function(){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(b,!0);var u=i.default.fromValues({action:P.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?u.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&u.encodeModesToFlags(y.allToUpperCase(this.channelOptions.modes)),this._attachResume&&u.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(u.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(u,O)},p.prototype.detach=function(u){if(!u){if(this.realtime.options.promises)return y.promisify(this,"detach",arguments);u=O}var A=this.connectionManager;if(!A.activeState()){u(A.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),u();break;case"detached":u();break;case"failed":u(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(_){switch(this.event){case"detached":u();break;case"attached":case"suspended":case"failed":u(_.reason||A.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":u(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},p.prototype.detachImpl=function(u){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(b,!0);var A=i.default.fromValues({action:P.DETACH,channel:this.name});this.sendMessage(A,u||O)},p.prototype.subscribe=function(){for(var u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];var _=p.processListenerArgs(u),L=_[0],W=_[1],H=_[2];if(!H&&this.realtime.options.promises)return y.promisify(this,"subscribe",[L,W]);if(this.state==="failed"){H==null||H(a.default.fromValues(p.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,W):this.subscriptions.on(L,W),this.attach(H||O)},p.prototype._subscribeFilter=function(u,A){var _=function(L){var W,H,U,I,x,z,k={name:L.name,refTimeserial:(H=(W=L.extras)===null||W===void 0?void 0:W.ref)===null||H===void 0?void 0:H.timeserial,refType:(I=(U=L.extras)===null||U===void 0?void 0:U.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((z=(x=L.extras)===null||x===void 0?void 0:x.ref)===null||z===void 0)&&z.timeserial),clientId:L.clientId};Object.entries(u).find(function(J){var ee=J[0],Q=J[1];return Q!==void 0?k[ee]!==Q:!1})||A(L)};this._addFilteredSubscription(u,A,_),this.subscriptions.on(_)},p.prototype._addFilteredSubscription=function(u,A,_){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(A)){var W=this.filteredSubscriptions.get(A);W.set(u,((L=W==null?void 0:W.get(u))===null||L===void 0?void 0:L.concat(_))||[_])}else this.filteredSubscriptions.set(A,new Map([[u,[_]]]))},p.prototype._getAndDeleteFilteredSubscriptions=function(u,A){var _=this;if(!this.filteredSubscriptions)return[];if(!A&&u)return Array.from(this.filteredSubscriptions.entries()).map(function(U){var I,x=U[0],z=U[1],k=z.get(u);return z.delete(u),z.size===0&&((I=_.filteredSubscriptions)===null||I===void 0||I.delete(x)),k}).reduce(function(U,I){var x;return I?(x=U).concat.apply(x,I):U},[]);if(!A||!this.filteredSubscriptions.has(A))return[];var L=this.filteredSubscriptions.get(A);if(!u){var W=Array.from(L.values()).reduce(function(U,I){return U.concat.apply(U,I)},[]);return this.filteredSubscriptions.delete(A),W}var H=L.get(u);return L.delete(u),H||[]},p.prototype.unsubscribe=function(){for(var u=this,A,_=[],L=0;L<arguments.length;L++)_[L]=arguments[L];var W=p.processListenerArgs(_),H=W[0],U=W[1];if(typeof H=="object"&&!U||((A=this.filteredSubscriptions)===null||A===void 0?void 0:A.has(U))){this._getAndDeleteFilteredSubscriptions(H,U).forEach(function(I){return u.subscriptions.off(I)});return}this.subscriptions.off(H,U)},p.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.default("Unable to sync to channel; not attached",4e4);default:}var u=this.connectionManager;if(!u.activeState())throw u.getError();var A=i.default.fromValues({action:P.SYNC,channel:this.name});this.syncChannelSerial&&(A.channelSerial=this.syncChannelSerial),u.send(A)},p.prototype.sendMessage=function(u,A){this.connectionManager.send(u,this.realtime.options.queueMessages,A)},p.prototype.sendPresence=function(u,A){var _=i.default.fromValues({action:P.PRESENCE,channel:this.name,presence:y.isArray(u)?S.default.fromValuesArray(u):[S.default.fromValues(u)]});this.sendMessage(_,A)},p.prototype.onMessage=function(u){var A,_=!1;switch(u.action){case P.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=u.channelSerial,this._mode=u.getMode(),this.params=u.params||{};var L=u.decodeModesFromFlags();this.modes=L&&y.allToLowerCase(L)||void 0;var W=u.hasFlag("RESUMED"),H=u.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(b,!1),W||this.presence.onAttached(H);var U=new R.default(this.state,this.state,W,u.error);this._allChannelChanges.emit("update",U),(!W||this.channelOptions.updateOnAttached)&&this.emit("update",U)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",u.error,W,H);break}case P.DETACHED:{var I=u.error?a.default.fromValues(u.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",I):this.state==="attaching"?this.notifyState("suspended",I):this.requestState("attaching",I);break}case P.SYNC:if(_=!0,A=this.syncChannelSerial=u.channelSerial,!u.presence)break;case P.PRESENCE:{for(var x=u.presence,z=u.id,k=u.connectionId,J=u.timestamp,ee=this.channelOptions,Q=void 0,G=0;G<x.length;G++)try{Q=x[G],S.default.decode(Q,ee),Q.connectionId||(Q.connectionId=k),Q.timestamp||(Q.timestamp=J),Q.id||(Q.id=z+":"+G)}catch(le){f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",le.toString())}this.presence.setPresence(x,_,A);break}case P.MESSAGE:{if(this.state!=="attached"){f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+u.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var D=u.messages,B=D[0],j=D[D.length-1],z=u.id,k=u.connectionId,J=u.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var V='Delta message decode failure - previous message not available for message "'+u.id+'" on this channel "'+this.name+'".';f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",V),this._startDecodeFailureRecovery(new a.default(V,40018,400));break}for(var G=0;G<D.length;G++){var V=D[G];try{E.default.decode(V,this._decodingContext)}catch(de){switch(f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",de.toString()),de.code){case 40018:this._startDecodeFailureRecovery(de);return;case 40019:case 40021:this.notifyState("failed",de);return}}V.connectionId||(V.connectionId=k),V.timestamp||(V.timestamp=J),V.id||(V.id=z+":"+G)}this._lastPayload.messageId=j.id,this._lastPayload.protocolMessageChannelSerial=u.channelSerial,this.onEvent(D);break}case P.ERROR:{var te=u.error;te&&te.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(te));break}default:f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+u.action+")"),this.connectionManager.abort(M.default.unknownChannelErr)}},p.prototype._startDecodeFailureRecovery=function(u){var A=this;this._lastPayload.decodeFailureRecoveryInProgress||(f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,u,function(){A._lastPayload.decodeFailureRecoveryInProgress=!1}))},p.prototype.onAttached=function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},p.prototype.notifyState=function(u,A,_,L){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+u),this.clearStateTimer(),u!==this.state){this.presence.actOnChannelState(u,L,A),u==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),A&&(this.errorReason=A);var W=new R.default(this.state,u,_,A),H=u==="failed"?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(H,'Channel state for channel "'+this.name+'"',u+(A?"; reason: "+A:"")),u!=="attaching"&&u!=="suspended"&&(this.retryCount=0),u==="attached"?(this.onAttached(),this.setInProgress(T,L),this.setInProgress(b,!1)):(u==="detached"||u==="failed"||u==="suspended")&&(this.setInProgress(b,!1),this.setInProgress(T,!1)),u==="attached"?this._attachResume=!0:(u==="detaching"||u==="failed")&&(this._attachResume=!1),this.state=u,this._allChannelChanges.emit(u,W),this.emit(u,W)}},p.prototype.requestState=function(u,A){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+u),this.notifyState(u,A),this.checkPendingState()},p.prototype.checkPendingState=function(){var u=this.connectionManager.state;if(!(u.sendEvents||u.forceQueueEvents)){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},p.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var u=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",u);break}case"detaching":{var u=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",u);break}default:this.checkPendingState();break}},p.prototype.startStateTimerIfNotRunning=function(){var u=this;this.stateTimer||(this.stateTimer=setTimeout(function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),u.stateTimer=null,u.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},p.prototype.clearStateTimer=function(){var u=this.stateTimer;u&&(clearTimeout(u),this.stateTimer=null)},p.prototype.startRetryTimer=function(){var u=this;if(!this.retryTimer){this.retryCount++;var A=this.realtime.options.timeouts.channelRetryTimeout*y.getJitterCoefficient()*y.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){u.state==="suspended"&&u.connectionManager.state.sendEvents&&(u.retryTimer=null,f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),u.requestState("attaching"))},A)}},p.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},p.prototype.setInProgress=function(u,A){this.rest.channels.setInProgress(this,u,A)},p.prototype.getReleaseErr=function(){var u=this.state;return u==="initialized"||u==="detached"||u==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+u,90001,400)},p.progressOps={statechange:b,sync:T},p}(c.default);r.default=v},function(h,r,n){"use strict";r.__esModule=!0;var s=function(){function i(m,y,c,f){this.previous=m,this.current=y,y==="attached"&&(this.resumed=c),f&&(this.reason=f)}return i}();r.default=s},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,c=m.Hasher,f=i.algo,C=[],E=f.SHA1=c.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,a){for(var S=this._hash.words,M=S[0],P=S[1],O=S[2],b=S[3],T=S[4],l=0;l<80;l++){if(l<16)C[l]=R[a+l]|0;else{var v=C[l-3]^C[l-8]^C[l-14]^C[l-16];C[l]=v<<1|v>>>31}var d=(M<<5|M>>>27)+T+C[l];l<20?d+=(P&O|~P&b)+1518500249:l<40?d+=(P^O^b)+1859775393:l<60?d+=(P&O|P&b|O&b)-1894007588:d+=(P^O^b)-899497514,T=b,b=O,O=P<<30|P>>>2,P=M,M=d}S[0]=S[0]+M|0,S[1]=S[1]+P|0,S[2]=S[2]+O|0,S[3]=S[3]+b|0,S[4]=S[4]+T|0},_doFinalize:function(){var R=this._data,a=R.words,S=this._nDataBytes*8,M=R.sigBytes*8;return a[M>>>5]|=128<<24-M%32,a[(M+64>>>9<<4)+14]=Math.floor(S/4294967296),a[(M+64>>>9<<4)+15]=S,R.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var R=c.clone.call(this);return R._hash=this._hash.clone(),R}});i.SHA1=c._createHelper(E),i.HmacSHA1=c._createHmacHelper(E)}(),s.SHA1})},function(h,r,n){"use strict";r.__esModule=!0;function s(l){if(l===void 0)return"undefined";var v,d;if(l instanceof ArrayBuffer?(d="ArrayBuffer",v=new DataView(l)):l instanceof DataView&&(d="DataView",v=l),!v)return JSON.stringify(l);for(var p=[],u=0;u<l.byteLength;u++){if(u>20){p.push("...");break}var A=v.getUint8(u).toString(16);A.length===1&&(A="0"+A),p.push(A)}return"<"+d+" "+p.join(" ")+">"}function i(l,v,d){for(var p=0,u=d.length;p<u;p++){var A=d.charCodeAt(p);if(A<128){l.setUint8(v++,A>>>0&127|0);continue}if(A<2048){l.setUint8(v++,A>>>6&31|192),l.setUint8(v++,A>>>0&63|128);continue}if(A<65536){l.setUint8(v++,A>>>12&15|224),l.setUint8(v++,A>>>6&63|128),l.setUint8(v++,A>>>0&63|128);continue}if(A<1114112){l.setUint8(v++,A>>>18&7|240),l.setUint8(v++,A>>>12&63|128),l.setUint8(v++,A>>>6&63|128),l.setUint8(v++,A>>>0&63|128);continue}throw new Error("bad codepoint "+A)}}function m(l,v,d){for(var p="",u=v,A=v+d;u<A;u++){var _=l.getUint8(u);if((_&128)===0){p+=String.fromCharCode(_);continue}if((_&224)===192){p+=String.fromCharCode((_&15)<<6|l.getUint8(++u)&63);continue}if((_&240)===224){p+=String.fromCharCode((_&15)<<12|(l.getUint8(++u)&63)<<6|(l.getUint8(++u)&63)<<0);continue}if((_&248)===240){p+=String.fromCharCode((_&7)<<18|(l.getUint8(++u)&63)<<12|(l.getUint8(++u)&63)<<6|(l.getUint8(++u)&63)<<0);continue}throw new Error("Invalid byte "+_.toString(16))}return p}function y(l){for(var v=0,d=0,p=l.length;d<p;d++){var u=l.charCodeAt(d);if(u<128){v+=1;continue}if(u<2048){v+=2;continue}if(u<65536){v+=3;continue}if(u<1114112){v+=4;continue}throw new Error("bad codepoint "+u)}return v}function c(l,v){var d=T(l,v);if(d!==0){var p=new ArrayBuffer(d),u=new DataView(p);return b(l,u,0,v),p}}var f=(1<<16)*(1<<16),C=1/f;function E(l,v){return v=v||0,l.getInt32(v)*f+l.getUint32(v+4)}function R(l,v){return v=v||0,l.getUint32(v)*f+l.getUint32(v+4)}function a(l,v,d){d<9223372036854776e3?(l.setInt32(v,Math.floor(d*C)),l.setInt32(v+4,d&-1)):(l.setUint32(v,2147483647),l.setUint32(v+4,2147483647))}function S(l,v,d){d<18446744073709552e3?(l.setUint32(v,Math.floor(d*C)),l.setInt32(v+4,d&-1)):(l.setUint32(v,4294967295),l.setUint32(v+4,4294967295))}var M=function(){function l(v,d){var p=this;this.map=function(u){for(var A={},_=0;_<u;_++){var L=p.parse();A[L]=p.parse()}return A},this.bin=function(u){var A=new ArrayBuffer(u);return new Uint8Array(A).set(new Uint8Array(p.view.buffer,p.offset,u),0),p.offset+=u,A},this.buf=this.bin,this.str=function(u){var A=m(p.view,p.offset,u);return p.offset+=u,A},this.array=function(u){for(var A=new Array(u),_=0;_<u;_++)A[_]=p.parse();return A},this.ext=function(u){return p.offset+=u,{type:p.view.getInt8(p.offset),data:p.buf(u)}},this.parse=function(){var u=p.view.getUint8(p.offset),A,_;if((u&128)===0)return p.offset++,u;if((u&240)===128)return _=u&15,p.offset++,p.map(_);if((u&240)===144)return _=u&15,p.offset++,p.array(_);if((u&224)===160)return _=u&31,p.offset++,p.str(_);if((u&224)===224)return A=p.view.getInt8(p.offset),p.offset++,A;switch(u){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(_);case 197:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(_);case 198:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(_);case 199:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(_);case 200:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(_);case 201:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(_);case 202:return A=p.view.getFloat32(p.offset+1),p.offset+=5,A;case 203:return A=p.view.getFloat64(p.offset+1),p.offset+=9,A;case 204:return A=p.view.getUint8(p.offset+1),p.offset+=2,A;case 205:return A=p.view.getUint16(p.offset+1),p.offset+=3,A;case 206:return A=p.view.getUint32(p.offset+1),p.offset+=5,A;case 207:return A=R(p.view,p.offset+1),p.offset+=9,A;case 208:return A=p.view.getInt8(p.offset+1),p.offset+=2,A;case 209:return A=p.view.getInt16(p.offset+1),p.offset+=3,A;case 210:return A=p.view.getInt32(p.offset+1),p.offset+=5,A;case 211:return A=E(p.view,p.offset+1),p.offset+=9,A;case 212:return _=1,p.offset++,p.ext(_);case 213:return _=2,p.offset++,p.ext(_);case 214:return _=4,p.offset++,p.ext(_);case 215:return _=8,p.offset++,p.ext(_);case 216:return _=16,p.offset++,p.ext(_);case 217:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.str(_);case 218:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.str(_);case 219:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.str(_);case 220:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.array(_);case 221:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.array(_);case 222:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.map(_);case 223:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.map(_)}throw new Error("Unknown type 0x"+u.toString(16))},this.offset=d||0,this.view=v}return l}();function P(l){var v=new DataView(l),d=new M(v),p=d.parse();if(d.offset!==l.byteLength)throw new Error(l.byteLength-d.offset+" trailing bytes");return p}function O(l,v){return Object.keys(l).filter(function(d){var p=l[d],u=typeof p;return(!v||p!=null)&&(u!=="function"||!!p.toJSON)})}function b(l,v,d,p){var u=typeof l;if(typeof l=="string"){var A=y(l);if(A<32)return v.setUint8(d,A|160),i(v,d+1,l),1+A;if(A<256)return v.setUint8(d,217),v.setUint8(d+1,A),i(v,d+2,l),2+A;if(A<65536)return v.setUint8(d,218),v.setUint16(d+1,A),i(v,d+3,l),3+A;if(A<4294967296)return v.setUint8(d,219),v.setUint32(d+1,A),i(v,d+5,l),5+A}if(ArrayBuffer.isView&&ArrayBuffer.isView(l)&&(l=l.buffer),l instanceof ArrayBuffer){var _=l.byteLength;if(_<256)return v.setUint8(d,196),v.setUint8(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(l),d+2),2+_;if(_<65536)return v.setUint8(d,197),v.setUint16(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(l),d+3),3+_;if(_<4294967296)return v.setUint8(d,198),v.setUint32(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(l),d+5),5+_}if(typeof l=="number"){if(Math.floor(l)!==l)return v.setUint8(d,203),v.setFloat64(d+1,l),9;if(l>=0){if(l<128)return v.setUint8(d,l),1;if(l<256)return v.setUint8(d,204),v.setUint8(d+1,l),2;if(l<65536)return v.setUint8(d,205),v.setUint16(d+1,l),3;if(l<4294967296)return v.setUint8(d,206),v.setUint32(d+1,l),5;if(l<18446744073709552e3)return v.setUint8(d,207),S(v,d+1,l),9;throw new Error("Number too big 0x"+l.toString(16))}if(l>=-32)return v.setInt8(d,l),1;if(l>=-128)return v.setUint8(d,208),v.setInt8(d+1,l),2;if(l>=-32768)return v.setUint8(d,209),v.setInt16(d+1,l),3;if(l>=-2147483648)return v.setUint8(d,210),v.setInt32(d+1,l),5;if(l>=-9223372036854776e3)return v.setUint8(d,211),a(v,d+1,l),9;throw new Error("Number too small -0x"+(-l).toString(16).substr(1))}if(u==="undefined")return p?0:(v.setUint8(d,212),v.setUint8(d+1,0),v.setUint8(d+2,0),3);if(l===null)return p?0:(v.setUint8(d,192),1);if(u==="boolean")return v.setUint8(d,l?195:194),1;if(typeof l.toJSON=="function")return b(l.toJSON(),v,d,p);if(u==="object"){var L,W=0,H=void 0,U=Array.isArray(l);if(U?L=l.length:(H=O(l,p),L=H.length),L<16?(v.setUint8(d,L|(U?144:128)),W=1):L<65536?(v.setUint8(d,U?220:222),v.setUint16(d+1,L),W=3):L<4294967296&&(v.setUint8(d,U?221:223),v.setUint32(d+1,L),W=5),U)for(var I=0;I<L;I++)W+=b(l[I],v,d+W,p);else if(H)for(var I=0;I<L;I++){var x=H[I];W+=b(x,v,d+W),W+=b(l[x],v,d+W,p)}return W}if(u==="function")return 0;throw new Error("Unknown type "+u)}function T(l,v){var d=typeof l;if(d==="string"){var p=y(l);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(l)&&(l=l.buffer),l instanceof ArrayBuffer){var u=l.byteLength;if(u<256)return 2+u;if(u<65536)return 3+u;if(u<4294967296)return 5+u}if(typeof l=="number"){if(Math.floor(l)!==l)return 9;if(l>=0){if(l<128)return 1;if(l<256)return 2;if(l<65536)return 3;if(l<4294967296)return 5;if(l<18446744073709552e3)return 9;throw new Error("Number too big 0x"+l.toString(16))}if(l>=-32)return 1;if(l>=-128)return 2;if(l>=-32768)return 3;if(l>=-2147483648)return 5;if(l>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+l.toString(16).substr(1))}if(d==="boolean")return 1;if(l===null)return v?0:1;if(l===void 0)return v?0:3;if(typeof l.toJSON=="function")return T(l.toJSON(),v);if(d==="object"){var A,_=0;if(Array.isArray(l)){A=l.length;for(var L=0;L<A;L++)_+=T(l[L],v)}else{var W=O(l,v);A=W.length;for(var L=0;L<A;L++){var H=W[L];_+=T(H)+T(l[H],v)}}if(A<16)return 1+_;if(A<65536)return 3+_;if(A<4294967296)return 5+_;throw new Error("Array or object too long 0x"+A.toString(16))}if(d==="function")return 0;throw new Error("Unknown type "+d)}r.default={encode:c,decode:P,inspect:s,utf8Write:i,utf8Read:m,utf8ByteCount:y}},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(30)),m=s.__importDefault(n(49)),y=s.__importDefault(n(0)),c=s.__importDefault(n(55)),f=s.__importDefault(n(57)),C=s.__importDefault(n(62)),E=s.__importDefault(n(63)),R=s.__importDefault(n(67)),a=s.__importDefault(n(3)),S=n(8),M=s.__importDefault(n(25)),P=s.__importDefault(n(64)),O=s.__importDefault(n(65)),b=s.__importDefault(n(40)),T=s.__importDefault(n(9)),l=s.__importDefault(n(14));y.default.Crypto=f.default,y.default.BufferUtils=c.default,y.default.Http=C.default,y.default.Config=E.default,y.default.Transports=R.default,y.default.WebStorage=P.default,i.default.Crypto=f.default,m.default.Crypto=f.default,i.default.Message=T.default,m.default.Message=T.default,i.default.PresenceMessage=l.default,m.default.PresenceMessage=l.default,m.default.ConnectionManager=M.default,a.default.initLogHandlers(),y.default.Defaults=S.getDefaults(O.default),y.default.Config.agent&&(y.default.Defaults.agent+=" "+y.default.Config.agent),y.default.Config.noUpgrade&&(y.default.Defaults.upgradeTransports=[]),r.default={Rest:i.default,Realtime:m.default,msgpack:b.default}},function(h){h.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(31),n(23))})(this,function(s){return s.HmacSHA256})},function(h,r){},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(46)),y=s.__importDefault(n(24)),c=s.__importDefault(n(18)),f=s.__importDefault(n(5)),C=s.__importDefault(n(47)),E=function(){},R=function(){function P(O){this.rest=O,this.admin=new a(O)}return P}(),a=function(){function P(O){this.rest=O,this.deviceRegistrations=new S(O),this.channelSubscriptions=new M(O)}return P.prototype.publish=function(O,b,T){var l=this.rest,v=l.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(v),p={},u=i.mixin({recipient:O},b);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);T=E}l.options.headers&&i.mixin(d,l.options.headers),l.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var A=i.encodeBody(u,v);y.default.post(l,"/push/publish",A,d,p,null,function(_){return T(_)})},P}(),S=function(){function P(O){this.rest=O}return P.prototype.save=function(O,b){var T=this.rest,l=m.default.fromValues(O),v=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(v),p={};if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);b=E}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var u=i.encodeBody(l,v);y.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(O.id),u,d,p,null,function(A,_,L,W){b(A,A?void 0:m.default.fromResponseBody(_,W?void 0:v))})},P.prototype.get=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(l),d=O.id||O;if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);b=E}if(typeof d!="string"||!d.length){b(new f.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(v,T.options.headers),y.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(d),v,{},null,function(p,u,A,_){b(p,p?void 0:m.default.fromResponseBody(u,_?void 0:l))})},P.prototype.list=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:l,d=i.defaultGetHeaders(l);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);b=E}T.options.headers&&i.mixin(d,T.options.headers),new c.default(T,"/push/deviceRegistrations",d,v,function(p,u,A){return m.default.fromResponseBody(p,A?void 0:l)}).get(O,b)},P.prototype.remove=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(l),d={},p=O.id||O;if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);b=E}if(typeof p!="string"||!p.length){b(new f.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(d,{fullWait:"true"}),y.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(p),v,d,null,function(u){return b(u)})},P.prototype.removeWhere=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(l);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);b=E}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),y.default.delete(T,"/push/deviceRegistrations",v,O,null,function(d){return b(d)})},P}(),M=function(){function P(O){this.remove=P.prototype.removeWhere,this.rest=O}return P.prototype.save=function(O,b){var T=this.rest,l=C.default.fromValues(O),v=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(v),p={};if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);b=E}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var u=i.encodeBody(l,v);y.default.post(T,"/push/channelSubscriptions",u,d,p,null,function(A,_,L,W){b(A,!A&&C.default.fromResponseBody(_,W?void 0:v))})},P.prototype.list=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:l,d=i.defaultGetHeaders(l);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);b=E}T.options.headers&&i.mixin(d,T.options.headers),new c.default(T,"/push/channelSubscriptions",d,v,function(p,u,A){return C.default.fromResponseBody(p,A?void 0:l)}).get(O,b)},P.prototype.removeWhere=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(l);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);b=E}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),y.default.delete(T,"/push/channelSubscriptions",v,O,null,function(d){return b(d)})},P.prototype.listChannels=function(O,b){var T=this.rest,l=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:l,d=i.defaultGetHeaders(l);if(typeof b!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);b=E}T.options.headers&&i.mixin(d,T.options.headers),T.options.pushFullWait&&i.mixin(O,{fullWait:"true"}),new c.default(T,"/push/channels",d,v,function(p,u,A){for(var _=!A&&l?i.decodeBody(p,l):p,L=0;L<_.length;L++)_[L]=String(_[L]);return _}).get(O,b)},P}();r.default=R},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(5)),y;(function(C){C.Phone="phone",C.Tablet="tablet",C.Desktop="desktop",C.TV="tv",C.Watch="watch",C.Car="car",C.Embedded="embedded",C.Other="other"})(y||(y={}));var c;(function(C){C.Android="android",C.IOS="ios",C.Browser="browser"})(c||(c={}));var f=function(){function C(){}return C.prototype.toJSON=function(){var E,R,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(E=this.push)===null||E===void 0?void 0:E.recipient,state:(R=this.push)===null||R===void 0?void 0:R.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},C.prototype.toString=function(){var E,R,a,S,M="[DeviceDetails";return this.id&&(M+="; id="+this.id),this.platform&&(M+="; platform="+this.platform),this.formFactor&&(M+="; formFactor="+this.formFactor),this.clientId&&(M+="; clientId="+this.clientId),this.metadata&&(M+="; metadata="+this.metadata),this.deviceIdentityToken&&(M+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((E=this.push)===null||E===void 0)&&E.recipient&&(M+="; push.recipient="+JSON.stringify(this.push.recipient)),!((R=this.push)===null||R===void 0)&&R.state&&(M+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(M+="; push.error="+JSON.stringify(this.push.error)),!((S=this.push)===null||S===void 0)&&S.metadata&&(M+="; push.metadata="+this.push.metadata),M+="]",M},C.fromResponseBody=function(E,R){return R&&(E=i.decodeBody(E,R)),i.isArray(E)?C.fromValuesArray(E):C.fromValues(E)},C.fromValues=function(E){return E.error=E.error&&m.default.fromValues(E.error),Object.assign(new C,E)},C.fromValuesArray=function(E){for(var R=E.length,a=new Array(R),S=0;S<R;S++)a[S]=C.fromValues(E[S]);return a},C.toRequestBody=i.encodeBody,C}();r.default=f},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=function(){function y(){}return y.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},y.prototype.toString=function(){var c="[PushChannelSubscription";return this.channel&&(c+="; channel="+this.channel),this.deviceId&&(c+="; deviceId="+this.deviceId),this.clientId&&(c+="; clientId="+this.clientId),c+="]",c},y.fromResponseBody=function(c,f){return f&&(c=i.decodeBody(c,f)),i.isArray(c)?y.fromValuesArray(c):y.fromValues(c)},y.fromValues=function(c){return Object.assign(new y,c)},y.fromValuesArray=function(c){for(var f=c.length,C=new Array(f),E=0;E<f;E++)C[E]=y.fromValues(c[E]);return C},y.toRequestBody=i.encodeBody,y}();r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=function(){function T(l){this.count=l&&l.count||0,this.data=l&&l.data||0,this.uncompressedData=l&&l.uncompressedData||0,this.failed=l&&l.failed||0,this.refused=l&&l.refused||0}return T}(),y=function(T){s.__extends(l,T);function l(v){var d=T.call(this,v)||this;return v&&v.category&&(d.category={},i.forInOwnNonNullProperties(v.category,function(p){d.category[p]=new m(v.category[p])})),d}return l}(m),c=function(){function T(l){this.peak=l&&l.peak||0,this.min=l&&l.min||0,this.mean=l&&l.mean||0,this.opened=l&&l.opened||0,this.refused=l&&l.refused||0}return T}(),f=function(){function T(l){this.succeeded=l&&l.succeeded||0,this.failed=l&&l.failed||0,this.refused=l&&l.refused||0}return T}(),C=function(){function T(l){this.plain=new c(l&&l.plain),this.tls=new c(l&&l.tls),this.all=new c(l&&l.all)}return T}(),E=function(){function T(l){this.messages=new y(l&&l.messages),this.presence=new y(l&&l.presence),this.all=new y(l&&l.all)}return T}(),R=function(){function T(l){this.realtime=new E(l&&l.realtime),this.rest=new E(l&&l.rest),this.webhook=new E(l&&l.webhook),this.sharedQueue=new E(l&&l.sharedQueue),this.externalQueue=new E(l&&l.externalQueue),this.httpEvent=new E(l&&l.httpEvent),this.push=new E(l&&l.push),this.all=new E(l&&l.all)}return T}(),a=function(){function T(l){this.all=new E(l&&l.all),this.inbound=new R(l&&l.inbound),this.outbound=new R(l&&l.outbound)}return T}(),S=function(){function T(l){this.all=new E(l&&l.all),this.producerPaid=new a(l&&l.producerPaid),this.consumerPaid=new a(l&&l.consumerPaid)}return T}(),M=function(){function T(l){this.messages=l&&l.messages||0;var v=l&&l.notifications;this.notifications={invalid:v&&v.invalid||0,attempted:v&&v.attempted||0,successful:v&&v.successful||0,failed:v&&v.failed||0},this.directPublishes=l&&l.directPublishes||0}return T}(),P=function(){function T(l){this.succeeded=l&&l.succeeded||0,this.skipped=l&&l.skipped||0,this.failed=l&&l.failed||0}return T}(),O=function(){function T(l){var v=this;this.delta=void 0,l&&l.delta&&(this.delta={},i.forInOwnNonNullProperties(l.delta,function(d){v.delta[d]=new P(l.delta[d])}))}return T}(),b=function(T){s.__extends(l,T);function l(v){var d=T.call(this,v)||this;return d.persisted=new E(v&&v.persisted),d.connections=new C(v&&v.connections),d.channels=new c(v&&v.channels),d.apiRequests=new f(v&&v.apiRequests),d.tokenRequests=new f(v&&v.tokenRequests),d.xchgProducer=new S(v&&v.xchgProducer),d.xchgConsumer=new S(v&&v.xchgConsumer),d.push=new M(v&&v.pushStats),d.processed=new O(v&&v.processed),d.inProgress=v&&v.inProgress||void 0,d.unit=v&&v.unit||void 0,d.intervalId=v&&v.intervalId||void 0,d}return l.fromValues=function(v){return new l(v)},l}(a);r.default=b},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(30)),y=s.__importDefault(n(7)),c=s.__importDefault(n(3)),f=s.__importDefault(n(50)),C=s.__importDefault(n(37)),E=s.__importDefault(n(8)),R=s.__importDefault(n(5)),a=s.__importDefault(n(10)),S=s.__importDefault(n(25)),M=s.__importDefault(n(0)),P=s.__importDefault(n(9)),O=function(T){s.__extends(l,T);function l(v){var d=T.call(this,v)||this;return c.default.logAction(c.default.LOG_MINOR,"Realtime()",""),d.connection=new f.default(d,d.options),d.channels=new b(d),v.autoConnect!==!1&&d.connect(),d}return l.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},l.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},l.Promise=function(v){return v=E.default.objectifyOptions(v),v.promises=!0,new l(v)},l.Callbacks=l,l.Utils=i,l.ConnectionManager=S.default,l.Platform=M.default,l.ProtocolMessage=a.default,l.Message=P.default,l}(m.default),b=function(T){s.__extends(l,T);function l(v){var d=T.call(this)||this;return d.realtime=v,d.all={},d.inProgress={},v.connection.connectionManager.on("transport.active",function(){d.onTransportActive()}),d}return l.prototype.onChannelMessage=function(v){var d=v.channel;if(d===void 0){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+v.action);return}var p=this.all[d];if(!p){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+d);return}p.onMessage(v)},l.prototype.onTransportActive=function(){for(var v in this.all){var d=this.all[v];d.state==="attaching"||d.state==="detaching"?d.checkPendingState():d.state==="suspended"&&d.attach()}},l.prototype.reattach=function(v){for(var d in this.all){var p=this.all[d];p.state==="attached"&&p.requestState("attaching",v)}},l.prototype.resetAttachedMsgIndicators=function(){for(var v in this.all){var d=this.all[v];d.state==="attached"&&(d._attachedMsgIndicator=!1)}},l.prototype.checkAttachedMsgIndicators=function(v){for(var d in this.all){var p=this.all[d];if(p.state==="attached"&&p._attachedMsgIndicator===!1){var u="30s after a resume, found channel which has not received an attached; channelId = "+d+"; connectionId = "+v;c.default.logAction(c.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",u),p.requestState("attaching")}}},l.prototype.propogateConnectionInterruption=function(v,d){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},u=["attaching","attached","detaching","suspended"],A=p[v];for(var _ in this.all){var L=this.all[_];i.arrIn(u,L.state)&&L.notifyState(A,d)}},l.prototype.get=function(v,d){v=String(v);var p=this.all[v];if(!p)p=this.all[v]=new C.default(this.realtime,v,d);else if(d){if(p._shouldReattachToSetOptions(d))throw new R.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(d)}return p},l.prototype.release=function(v){v=String(v);var d=this.all[v];if(!!d){var p=d.getReleaseErr();if(p)throw p;delete this.all[v],delete this.inProgress[v]}},l.prototype.setInProgress=function(v,d,p){this.inProgress[v.name]=this.inProgress[v.name]||{},this.inProgress[v.name][d]=p,!p&&this.hasNopending()&&this.emit("nopending")},l.prototype.onceNopending=function(v){if(this.hasNopending()){v();return}this.once("nopending",v)},l.prototype.hasNopending=function(){return i.arrEvery(i.valuesArray(this.inProgress,!0),function(v){return!i.containsValue(v,!0)})},l}(y.default);r.default=O},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(7)),y=s.__importDefault(n(25)),c=s.__importDefault(n(3)),f=s.__importDefault(n(36)),C=s.__importDefault(n(0));function E(){}var R=function(a){s.__extends(S,a);function S(M,P){var O=a.call(this)||this;return O.whenState=function(b,T){return m.default.prototype.whenState.call(O,b,O.state,T,new f.default(void 0,b))},O.ably=M,O.connectionManager=new y.default(M,P),O.state=O.connectionManager.state.state,O.key=void 0,O.id=void 0,O.serial=void 0,O.timeSerial=void 0,O.recoveryKey=void 0,O.errorReason=null,O.connectionManager.on("connectionstate",function(b){var T=O.state=b.current;C.default.Config.nextTick(function(){O.emit(T,b)})}),O.connectionManager.on("update",function(b){C.default.Config.nextTick(function(){O.emit("update",b)})}),O}return S.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},S.prototype.ping=function(M){if(c.default.logAction(c.default.LOG_MINOR,"Connection.ping()",""),!M){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);M=E}this.connectionManager.ping(null,M)},S.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},S}(m.default);r.default=R},function(h,r,n){"use strict";r.__esModule=!0,r.PendingMessage=void 0;var s=n(1),i=s.__importDefault(n(10)),m=s.__importStar(n(2)),y=s.__importDefault(n(7)),c=s.__importDefault(n(3)),f=s.__importDefault(n(35)),C=s.__importDefault(n(5)),E=i.default.Action,R=function(){function S(M,P){this.message=M,this.callback=P,this.merged=!1;var O=M.action;this.sendAttempted=!1,this.ackRequired=O==E.MESSAGE||O==E.PRESENCE}return S}();r.PendingMessage=R;var a=function(S){s.__extends(M,S);function M(P){var O=S.call(this)||this;return O.transport=P,O.messageQueue=new f.default,P.on("ack",function(b,T){O.onAck(b,T)}),P.on("nack",function(b,T,l){O.onNack(b,T,l)}),O}return M.prototype.onAck=function(P,O){c.default.logAction(c.default.LOG_MICRO,"Protocol.onAck()","serial = "+P+"; count = "+O),this.messageQueue.completeMessages(P,O)},M.prototype.onNack=function(P,O,b){c.default.logAction(c.default.LOG_ERROR,"Protocol.onNack()","serial = "+P+"; count = "+O+"; err = "+m.inspectError(b)),b||(b=new C.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(P,O,b)},M.prototype.onceIdle=function(P){var O=this.messageQueue;if(O.count()===0){P();return}O.once("idle",P)},M.prototype.send=function(P){P.ackRequired&&this.messageQueue.push(P),c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(P.message)),P.sendAttempted=!0,this.transport.send(P.message)},M.prototype.getTransport=function(){return this.transport},M.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},M.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},M.prototype.finish=function(){var P=this.transport;this.onceIdle(function(){P.disconnect()})},M}(y.default);r.default=a},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),m=s.__importStar(n(2)),y=s.__importDefault(n(26)),c=s.__importDefault(n(8)),f=s.__importDefault(n(3)),C=s.__importDefault(n(10)),E=s.__importDefault(n(5)),R="web_socket";function a(P){return!!P.on}var S=function(P){s.__extends(O,P);function O(b,T,l){var v=P.call(this,b,T,l)||this;return v.shortName=R,l.heartbeats=i.default.Config.useProtocolHeartbeats,v.wsHost=c.default.getHost(l.options,l.host,!0),v}return O.isAvailable=function(){return!!i.default.Config.WebSocket},O.prototype.createWebSocket=function(b,T){var l=0;if(T)for(var v in T)b+=(l++?"&":"?")+v+"="+T[v];return this.uri=b,new i.default.Config.WebSocket(b)},O.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},O.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),y.default.prototype.connect.call(this);var b=this,T=this.params,l=T.options,v=l.tls?"wss://":"ws://",d=v+this.wsHost+":"+c.default.getPort(l)+"/";f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+d),this.auth.getAuthParams(function(p,u){if(!b.isDisposed){var A="";for(var _ in u)A+=" "+_+": "+u[_]+";";if(f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+A+" err: "+p),p){b.disconnect(p);return}var L=T.getConnectParams(u);try{var W=b.wsConnection=b.createWebSocket(d,L);W.binaryType=i.default.Config.binaryType,W.onopen=function(){b.onWsOpen()},W.onclose=function(H){b.onWsClose(H)},W.onmessage=function(H){b.onWsData(H.data)},W.onerror=function(H){b.onWsError(H)},a(W)&&W.on("ping",function(){b.onActivity()})}catch(H){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),b.disconnect(H)}}})},O.prototype.send=function(b){var T=this.wsConnection;if(!T){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(C.default.serialize(b,this.params.format))}catch(v){var l="Exception from ws connection when trying to send: "+m.inspectError(v);f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()",l),this.finish("disconnected",new E.default(l,5e4,500))}},O.prototype.onWsData=function(b){f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+b.length+"; type = "+typeof b);try{this.onProtocolMessage(C.default.deserialize(b,this.format))}catch(T){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},O.prototype.onWsOpen=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},O.prototype.onWsClose=function(b){var T,l;if(typeof b=="object"?(l=b.code,T=b.wasClean||l===1e3):(l=b,T=l==1e3),delete this.wsConnection,T){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var v=new E.default("Websocket closed",80003,400);this.finish("disconnected",v)}else{var d="Unclean disconnection of WebSocket ; code = "+l,v=new E.default(d,80003,400);f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()",d),this.finish("disconnected",v)}this.emit("disposed")},O.prototype.onWsError=function(b){var T=this;f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+b.message),i.default.Config.nextTick(function(){T.disconnect(Error(b.message))})},O.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var b=this.wsConnection;b&&(b.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!b)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");b.close()}))},O}(y.default);function M(P){return S.isAvailable()&&(P.supportedTransports[R]=S),S}r.default=M},function(h,r,n){"use strict";r.__esModule=!0,r.isSuccessCode=void 0;var s;(function(m){m[m.Success=200]="Success",m[m.NoContent=204]="NoContent",m[m.BadRequest=400]="BadRequest",m[m.Unauthorized=401]="Unauthorized",m[m.Forbidden=403]="Forbidden",m[m.RequestTimeout=408]="RequestTimeout",m[m.InternalServerError=500]="InternalServerError"})(s||(s={}));function i(m){return m>=s.Success&&m<s.BadRequest}r.isSuccessCode=i,r.default=s},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),m=s.__importDefault(n(34)),y=s.__importDefault(n(7)),c=s.__importDefault(n(3)),f=s.__importDefault(n(14)),C=s.__importDefault(n(5)),E=s.__importDefault(n(37)),R=s.__importDefault(n(22)),a=s.__importDefault(n(38)),S=function(){};function M(d){return d.clientId+":"+d.connectionId}function P(d){return d.channel.realtime.auth.clientId}function O(d){var p=d.channel.realtime,u=p.auth.clientId;return(!u||u==="*")&&p.connection.state==="connected"}function b(d,p,u){switch(d.state){case"attached":case"suspended":u();break;case"initialized":case"detached":case"detaching":case"attaching":d.attach(function(A){A?p(A):u()});break;default:p(C.default.fromValues(E.default.invalidStateError(d.state)))}}function T(d,p){if(d.isSynthesized()||p.isSynthesized())return d.timestamp>p.timestamp;var u=d.parseId(),A=p.parseId();return u.msgSerial===A.msgSerial?u.index>A.index:u.msgSerial>A.msgSerial}var l=function(d){s.__extends(p,d);function p(u){var A=d.call(this,u)||this;return A.channel=u,A.syncComplete=!1,A.members=new v(A),A._myMembers=new v(A),A.subscriptions=new y.default,A.pendingPresence=[],A}return p.prototype.enter=function(u,A){if(O(this))throw new C.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,u,"enter",A)},p.prototype.update=function(u,A){if(O(this))throw new C.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,u,"update",A)},p.prototype.enterClient=function(u,A,_){return this._enterOrUpdateClient(u,A,"enter",_)},p.prototype.updateClient=function(u,A,_){return this._enterOrUpdateClient(u,A,"update",_)},p.prototype._enterOrUpdateClient=function(u,A,_,L){var W=this;if(!L)if(typeof A=="function")L=A,A=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[u,A,_]);L=S}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence."+_+"Client()","channel = "+H.name+", client = "+(u||"(implicit) "+P(this)));var U=f.default.fromValues({action:_,data:A});u&&(U.clientId=u),f.default.encode(U,H.channelOptions,function(I){if(I){L(I);return}switch(H.state){case"attached":H.sendPresence(U,L);break;case"initialized":case"detached":H.attach();case"attaching":W.pendingPresence.push({presence:U,callback:L});break;default:I=new C.default("Unable to "+_+" presence channel while in "+H.state+" state",90001),I.code=90001,L(I)}})},p.prototype.leave=function(u,A){if(O(this))throw new C.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,u,A)},p.prototype.leaveClient=function(u,A,_){if(!_)if(typeof A=="function")_=A,A=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[u,A]);_=S}var L=this.channel;if(!L.connectionManager.activeState()){_==null||_(L.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+u);var W=f.default.fromValues({action:"leave",data:A});switch(u&&(W.clientId=u),L.state){case"attached":L.sendPresence(W,_);break;case"attaching":this.pendingPresence.push({presence:W,callback:_});break;case"initialized":case"failed":{var H=new C.default("Unable to leave presence channel (incompatible state)",90001);_==null||_(H);break}default:_==null||_(E.default.invalidStateError(L.state))}},p.prototype.get=function(u,A){var _=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),u=L[0],A=L[1];var W=!u||("waitForSync"in u?u.waitForSync:!0);if(!A){if(this.channel.realtime.options.promises)return i.promisify(this,"get",L);A=S}function H(U){A(null,u?U.list(u):U.values())}if(this.channel.state==="suspended"){W?A(C.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}b(this.channel,A,function(){var U=_.members;W?U.waitSync(function(){H(U)}):H(U)})},p.prototype.history=function(u,A){if(c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),A===void 0)if(typeof u=="function")A=u,u=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);A=S}u&&u.untilAttach&&(this.channel.state==="attached"?(delete u.untilAttach,u.from_serial=this.channel.properties.attachSerial):A(new C.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),m.default.prototype._history.call(this,u,A)},p.prototype.setPresence=function(u,A,_){c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+u.length+" participants; syncChannelSerial = "+_);var L,W,H=this.members,U=this._myMembers,I=[],x=this.channel.connectionManager.connectionId;A&&(this.members.startSync(),_&&(W=_.match(/^[\w-]+:(.*)$/))&&(L=W[1]));for(var z=0;z<u.length;z++){var k=f.default.fromValues(u[z]);switch(k.action){case"leave":H.remove(k)&&I.push(k),k.connectionId===x&&!k.isSynthesized()&&U.remove(k);break;case"enter":case"present":case"update":H.put(k)&&I.push(k),k.connectionId===x&&U.put(k);break}}A&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(E.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<I.length;z++){var k=I[z];this.subscriptions.emit(k.action,k)}},p.prototype.onAttached=function(u){c.default.logAction(c.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+u),u?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var A=this.pendingPresence,_=A.length;if(_){this.pendingPresence=[];var L=[],W=R.default.create();c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+_+" queued presence messages");for(var H=0;H<_;H++){var U=A[H];L.push(U.presence),W.push(U.callback)}this.channel.sendPresence(L,W)}},p.prototype.actOnChannelState=function(u,A,_){switch(u){case"attached":this.onAttached(A);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(_);break}},p.prototype.failPendingPresence=function(u){if(this.pendingPresence.length){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(u));for(var A=0;A<this.pendingPresence.length;A++)try{this.pendingPresence[A].callback(u)}catch(_){}this.pendingPresence=[]}},p.prototype._clearMyMembers=function(){this._myMembers.clear()},p.prototype._ensureMyMembersPresent=function(){var u=this,A=this.members,_=this._myMembers,L=function(U){if(U){var I="Presence auto-re-enter failed: "+U.toString(),x=new C.default(I,91004,400);c.default.logAction(c.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",I);var z=new a.default(u.channel.state,u.channel.state,!0,x);u.channel.emit("update",z)}};for(var W in _.map)if(!(W in A.map)){var H=_.map[W];c.default.logAction(c.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete _.map[W]}},p.prototype._synthesizeLeaves=function(u){var A=this.subscriptions;i.arrForEach(u,function(_){var L=f.default.fromValues({action:"leave",connectionId:_.connectionId,clientId:_.clientId,data:_.data,encoding:_.encoding,timestamp:i.now()});A.emit("leave",L)})},p.prototype.on=function(){for(var u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];c.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,u)},p.prototype.off=function(){for(var u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];c.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,u)},p.prototype.subscribe=function(){for(var u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];var _=E.default.processListenerArgs(u),L=_[0],W=_[1],H=_[2],U=this.channel;if(!H){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[L,W]);H=S}if(U.state==="failed"){H(C.default.fromValues(E.default.invalidStateError("failed")));return}this.subscriptions.on(L,W),U.attach(H)},p.prototype.unsubscribe=function(){for(var u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];var _=E.default.processListenerArgs(u),L=_[0],W=_[1];this.subscriptions.off(L,W)},p}(m.default),v=function(d){s.__extends(p,d);function p(u){var A=d.call(this)||this;return A.presence=u,A.map={},A.syncInProgress=!1,A.residualMembers=null,A}return p.prototype.get=function(u){return this.map[u]},p.prototype.getClient=function(u){var A=this.map,_=[];for(var L in A){var W=A[L];W.clientId==u&&W.action!="absent"&&_.push(W)}return _},p.prototype.list=function(u){var A=this.map,_=u&&u.clientId,L=u&&u.connectionId,W=[];for(var H in A){var U=A[H];U.action!=="absent"&&(_&&_!=U.clientId||L&&L!=U.connectionId||W.push(U))}return W},p.prototype.put=function(u){(u.action==="enter"||u.action==="update")&&(u=f.default.fromValues(u),u.action="present");var A=this.map,_=M(u);this.residualMembers&&delete this.residualMembers[_];var L=A[_];return L&&!T(u,L)?!1:(A[_]=u,!0)},p.prototype.values=function(){var u=this.map,A=[];for(var _ in u){var L=u[_];L.action!="absent"&&A.push(L)}return A},p.prototype.remove=function(u){var A=this.map,_=M(u),L=A[_];return L&&!T(u,L)?!1:(this.syncInProgress?(u=f.default.fromValues(u),u.action="absent",A[_]=u):delete A[_],!0)},p.prototype.startSync=function(){var u=this.map,A=this.syncInProgress;c.default.logAction(c.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+A),this.syncInProgress||(this.residualMembers=i.copy(u),this.setInProgress(!0))},p.prototype.endSync=function(){var u=this.map,A=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+A),A){for(var _ in u){var L=u[_];L.action==="absent"&&delete u[_]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var W in this.residualMembers)delete u[W];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},p.prototype.waitSync=function(u){var A=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+A),!A){u();return}this.once("sync",u)},p.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},p.prototype.setInProgress=function(u){c.default.logAction(c.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+u),this.syncInProgress=u,this.presence.syncComplete=!u},p}(y.default);r.default=l},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=n(56),m=n(32),y=n(13),c=s.__importDefault(n(4)),f=s.__importDefault(n(0)),C=function(){function E(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return E.prototype.isWordArray=function(R){return R!=null&&R.sigBytes!==void 0},E.prototype.isArrayBuffer=function(R){return R!=null&&R.constructor===ArrayBuffer},E.prototype.isTypedArray=function(R){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(R)},E.prototype.uint8ViewToBase64=function(R){for(var a="",S=this.base64CharSet,M=R.byteLength,P=M%3,O=M-P,b,T,l,v,d,p=0;p<O;p=p+3)d=R[p]<<16|R[p+1]<<8|R[p+2],b=(d&16515072)>>18,T=(d&258048)>>12,l=(d&4032)>>6,v=d&63,a+=S[b]+S[T]+S[l]+S[v];return P==1?(d=R[O],b=(d&252)>>2,T=(d&3)<<4,a+=S[b]+S[T]+"=="):P==2&&(d=R[O]<<8|R[O+1],b=(d&64512)>>10,T=(d&1008)>>4,l=(d&15)<<2,a+=S[b]+S[T]+S[l]+"="),a},E.prototype.base64ToArrayBuffer=function(R){for(var a=atob==null?void 0:atob(R),S=a.length,M=new Uint8Array(S),P=0;P<S;P++){var O=a.charCodeAt(P);M[P]=O}return M.buffer},E.prototype.isBuffer=function(R){return this.isArrayBuffer(R)||this.isWordArray(R)||this.isTypedArray(R)},E.prototype.toBuffer=function(R){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(R))return new Uint8Array(R);if(this.isTypedArray(R))return new Uint8Array(R.buffer);if(this.isWordArray(R)){for(var a=new ArrayBuffer(R.sigBytes),S=new Uint8Array(a),M=0;M<R.sigBytes;M++)S[M]=R.words[M>>>2]>>>24-M%4*8&255;return S}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},E.prototype.toArrayBuffer=function(R){return this.isArrayBuffer(R)?R:this.toBuffer(R).buffer},E.prototype.toWordArray=function(R){return this.isTypedArray(R)&&(R=R.buffer),this.isWordArray(R)?R:c.default.create(R)},E.prototype.base64Encode=function(R){return this.isWordArray(R)?y.stringify(R):this.uint8ViewToBase64(this.toBuffer(R))},E.prototype.base64Decode=function(R){return ArrayBuffer&&f.default.Config.atob?this.base64ToArrayBuffer(R):y.parse(R)},E.prototype.hexEncode=function(R){return i.stringify(this.toWordArray(R))},E.prototype.hexDecode=function(R){var a=i.parse(R);return ArrayBuffer?this.toArrayBuffer(a):a},E.prototype.utf8Encode=function(R){return TextEncoder?new TextEncoder().encode(R).buffer:m.parse(R)},E.prototype.utf8Decode=function(R){if(!this.isBuffer(R))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(R)?new TextDecoder().decode(R):(R=this.toWordArray(R),m.stringify(R))},E.prototype.bufferCompare=function(R,a){if(!R)return-1;if(!a)return 1;var S=this.toWordArray(R),M=this.toWordArray(a);S.clamp(),M.clamp();var P=S.sigBytes-M.sigBytes;if(P!=0)return P;for(var O=S.words,b=M.words,T=0;T<O.length;T++)if(P=O[T]-b[T],P!=0)return P;return 0},E.prototype.byteLength=function(R){return this.isArrayBuffer(R)||this.isTypedArray(R)?R.byteLength:this.isWordArray(R)?R.sigBytes:-1},E.prototype.typedArrayToBuffer=function(R){return R.buffer},E}();r.default=new C},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return s.enc.Hex})},function(h,r,n){"use strict";n.r(r);var s=n(4),i=n.n(s),m=n(13),y=n.n(m),c=n(21),f=n.n(c),C=n(0),E=n.n(C),R=n(3),a=n.n(R),S=function(){var M="aes",P=256,O="cbc",b=16,T=4,l=4294967296,v=2147483648,d;if(E.a.getRandomWordArray)d=E.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&E.a.getRandomValues){var p=new Uint32Array(T);d=function(I,x){var z=I/4,k=z==T?p:new Uint32Array(z);E.a.getRandomValues(k,function(J){x(J,E.a.BufferUtils.toWordArray(k))})}}else d=function(I,x){a.a.logAction(a.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=I/4,k=new Array(z),J=0;J<z;J++)k[J]=Math.floor(Math.random()*l)-v;x(null,i.a.create(k))};function u(I){return I+b&-b}function A(I){if(I.algorithm==="aes"&&I.mode==="cbc"){if(I.keyLength===128||I.keyLength===256)return;throw new Error("Unsupported key length "+I.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function _(I){return I.replace("_","/").replace("-","+")}var L=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function W(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}W.CipherParams=H,W.getDefaultParams=function(I){var x;if(typeof I=="function"||typeof I=="string"){if(a.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof I=="function")W.generateRandomKey(function(k){I(null,W.getDefaultParams({key:k}))});else if(typeof arguments[1]=="function")arguments[1](null,W.getDefaultParams({key:I}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!I.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof I.key=="string"?x=Object(m.parse)(_(I.key)):x=E.a.BufferUtils.toWordArray(I.key);var z=new H;if(z.key=x,z.algorithm=I.algorithm||M,z.keyLength=x.words.length*(4*8),z.mode=I.mode||O,I.keyLength&&I.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+I.keyLength+" was specified, but the key actually has length "+z.keyLength);return A(z),z},W.generateRandomKey=function(I,x){arguments.length==1&&typeof I=="function"&&(x=I,I=void 0),d((I||P)/8,x)},W.getCipher=function(I){var x=I instanceof H?I:W.getDefaultParams(I);return{cipherParams:x,cipher:new U(x,T,I.iv)}};function U(I,x,z){this.algorithm=I.algorithm+"-"+String(I.keyLength)+"-"+I.mode,this.cjsAlgorithm=I.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=E.a.BufferUtils.toWordArray(I.key),z&&(this.iv=E.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=x}return U.prototype.encrypt=function(I,x){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.encrypt()",""),I=E.a.BufferUtils.toWordArray(I);var z=I.sigBytes,k=u(z),J=this,ee=function(){J.getIv(function(Q,G){if(Q){x(Q);return}var D=J.encryptCipher.process(I.concat(L[k-z])),B=G.concat(D);x(null,B)})};this.encryptCipher?ee():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),ee()):d(b,function(Q,G){if(Q){x(Q);return}J.encryptCipher=f.a.algo[J.cjsAlgorithm].createEncryptor(J.key,{iv:G}),J.iv=G,ee()})},U.prototype.decrypt=function(I){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.decrypt()",""),I=E.a.BufferUtils.toWordArray(I);var x=this.blockLengthWords,z=I.words,k=i.a.create(z.slice(0,x)),J=i.a.create(z.slice(x)),ee=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:k}),Q=ee.process(J),G=ee.finalize();return ee.reset(),G&&G.sigBytes&&Q.concat(G),Q},U.prototype.getIv=function(I){if(this.iv){var x=this.iv;this.iv=null,I(null,x);return}var z=this;d(b,function(k,J){if(k){I(k);return}I(null,z.encryptCipher.process(J))})},W}();r.default=S},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(){var i=s,m=i.lib,y=m.WordArray,c=i.enc,f=c.Utf16=c.Utf16BE={stringify:function(E){for(var R=E.words,a=E.sigBytes,S=[],M=0;M<a;M+=2){var P=R[M>>>2]>>>16-M%4*8&65535;S.push(String.fromCharCode(P))}return S.join("")},parse:function(E){for(var R=E.length,a=[],S=0;S<R;S++)a[S>>>1]|=E.charCodeAt(S)<<16-S%2*16;return y.create(a,R*2)}};c.Utf16LE={stringify:function(E){for(var R=E.words,a=E.sigBytes,S=[],M=0;M<a;M+=2){var P=C(R[M>>>2]>>>16-M%4*8&65535);S.push(String.fromCharCode(P))}return S.join("")},parse:function(E){for(var R=E.length,a=[],S=0;S<R;S++)a[S>>>1]|=C(E.charCodeAt(S)<<16-S%2*16);return y.create(a,R*2)}};function C(E){return E<<8&4278255360|E>>>8&16711935}}(),s.enc.Utf16})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(28))})(this,function(s){return function(i){var m=s,y=m.lib,c=y.CipherParams,f=m.enc,C=f.Hex,E=m.format,R=E.Hex={stringify:function(a){return a.ciphertext.toString(C)},parse:function(a){var S=C.parse(a);return c.create({ciphertext:S})}}}(),s.format.Hex})},function(h,r,n){(function(s,i){h.exports=r=i(n(6),n(13),n(61),n(27),n(28))})(this,function(s){return function(){var i=s,m=i.lib,y=m.BlockCipher,c=i.algo,f=[],C=[],E=[],R=[],a=[],S=[],M=[],P=[],O=[],b=[];(function(){for(var v=[],d=0;d<256;d++)d<128?v[d]=d<<1:v[d]=d<<1^283;for(var p=0,u=0,d=0;d<256;d++){var A=u^u<<1^u<<2^u<<3^u<<4;A=A>>>8^A&255^99,f[p]=A,C[A]=p;var _=v[p],L=v[_],W=v[L],H=v[A]*257^A*16843008;E[p]=H<<24|H>>>8,R[p]=H<<16|H>>>16,a[p]=H<<8|H>>>24,S[p]=H;var H=W*16843009^L*65537^_*257^p*16843008;M[A]=H<<24|H>>>8,P[A]=H<<16|H>>>16,O[A]=H<<8|H>>>24,b[A]=H,p?(p=_^v[v[v[W^_]]],u^=v[v[u]]):p=u=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],l=c.AES=y.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var d=this._keyPriorReset=this._key,p=d.words,u=d.sigBytes/4,A=this._nRounds=u+6,_=(A+1)*4,L=this._keySchedule=[],W=0;W<_;W++)W<u?L[W]=p[W]:(v=L[W-1],W%u?u>6&&W%u==4&&(v=f[v>>>24]<<24|f[v>>>16&255]<<16|f[v>>>8&255]<<8|f[v&255]):(v=v<<8|v>>>24,v=f[v>>>24]<<24|f[v>>>16&255]<<16|f[v>>>8&255]<<8|f[v&255],v^=T[W/u|0]<<24),L[W]=L[W-u]^v);for(var H=this._invKeySchedule=[],U=0;U<_;U++){var W=_-U;if(U%4)var v=L[W];else var v=L[W-4];U<4||W<=4?H[U]=v:H[U]=M[f[v>>>24]]^P[f[v>>>16&255]]^O[f[v>>>8&255]]^b[f[v&255]]}}},encryptBlock:function(v,d){this._doCryptBlock(v,d,this._keySchedule,E,R,a,S,f)},decryptBlock:function(v,d){var p=v[d+1];v[d+1]=v[d+3],v[d+3]=p,this._doCryptBlock(v,d,this._invKeySchedule,M,P,O,b,C);var p=v[d+1];v[d+1]=v[d+3],v[d+3]=p},_doCryptBlock:function(v,d,p,u,A,_,L,W){for(var H=this._nRounds,U=v[d]^p[0],I=v[d+1]^p[1],x=v[d+2]^p[2],z=v[d+3]^p[3],k=4,J=1;J<H;J++){var ee=u[U>>>24]^A[I>>>16&255]^_[x>>>8&255]^L[z&255]^p[k++],Q=u[I>>>24]^A[x>>>16&255]^_[z>>>8&255]^L[U&255]^p[k++],G=u[x>>>24]^A[z>>>16&255]^_[U>>>8&255]^L[I&255]^p[k++],D=u[z>>>24]^A[U>>>16&255]^_[I>>>8&255]^L[x&255]^p[k++];U=ee,I=Q,x=G,z=D}var ee=(W[U>>>24]<<24|W[I>>>16&255]<<16|W[x>>>8&255]<<8|W[z&255])^p[k++],Q=(W[I>>>24]<<24|W[x>>>16&255]<<16|W[z>>>8&255]<<8|W[U&255])^p[k++],G=(W[x>>>24]<<24|W[z>>>16&255]<<16|W[U>>>8&255]<<8|W[I&255])^p[k++],D=(W[z>>>24]<<24|W[U>>>16&255]<<16|W[I>>>8&255]<<8|W[x&255])^p[k++];v[d]=ee,v[d+1]=Q,v[d+2]=G,v[d+3]=D},keySize:256/32});i.AES=y._createHelper(l)}(),s.AES})},function(h,r,n){(function(s,i){h.exports=r=i(n(6))})(this,function(s){return function(i){var m=s,y=m.lib,c=y.WordArray,f=y.Hasher,C=m.algo,E=[];(function(){for(var O=0;O<64;O++)E[O]=i.abs(i.sin(O+1))*4294967296|0})();var R=C.MD5=f.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(O,b){for(var T=0;T<16;T++){var l=b+T,v=O[l];O[l]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var d=this._hash.words,p=O[b+0],u=O[b+1],A=O[b+2],_=O[b+3],L=O[b+4],W=O[b+5],H=O[b+6],U=O[b+7],I=O[b+8],x=O[b+9],z=O[b+10],k=O[b+11],J=O[b+12],ee=O[b+13],Q=O[b+14],G=O[b+15],D=d[0],B=d[1],j=d[2],V=d[3];D=a(D,B,j,V,p,7,E[0]),V=a(V,D,B,j,u,12,E[1]),j=a(j,V,D,B,A,17,E[2]),B=a(B,j,V,D,_,22,E[3]),D=a(D,B,j,V,L,7,E[4]),V=a(V,D,B,j,W,12,E[5]),j=a(j,V,D,B,H,17,E[6]),B=a(B,j,V,D,U,22,E[7]),D=a(D,B,j,V,I,7,E[8]),V=a(V,D,B,j,x,12,E[9]),j=a(j,V,D,B,z,17,E[10]),B=a(B,j,V,D,k,22,E[11]),D=a(D,B,j,V,J,7,E[12]),V=a(V,D,B,j,ee,12,E[13]),j=a(j,V,D,B,Q,17,E[14]),B=a(B,j,V,D,G,22,E[15]),D=S(D,B,j,V,u,5,E[16]),V=S(V,D,B,j,H,9,E[17]),j=S(j,V,D,B,k,14,E[18]),B=S(B,j,V,D,p,20,E[19]),D=S(D,B,j,V,W,5,E[20]),V=S(V,D,B,j,z,9,E[21]),j=S(j,V,D,B,G,14,E[22]),B=S(B,j,V,D,L,20,E[23]),D=S(D,B,j,V,x,5,E[24]),V=S(V,D,B,j,Q,9,E[25]),j=S(j,V,D,B,_,14,E[26]),B=S(B,j,V,D,I,20,E[27]),D=S(D,B,j,V,ee,5,E[28]),V=S(V,D,B,j,A,9,E[29]),j=S(j,V,D,B,U,14,E[30]),B=S(B,j,V,D,J,20,E[31]),D=M(D,B,j,V,W,4,E[32]),V=M(V,D,B,j,I,11,E[33]),j=M(j,V,D,B,k,16,E[34]),B=M(B,j,V,D,Q,23,E[35]),D=M(D,B,j,V,u,4,E[36]),V=M(V,D,B,j,L,11,E[37]),j=M(j,V,D,B,U,16,E[38]),B=M(B,j,V,D,z,23,E[39]),D=M(D,B,j,V,ee,4,E[40]),V=M(V,D,B,j,p,11,E[41]),j=M(j,V,D,B,_,16,E[42]),B=M(B,j,V,D,H,23,E[43]),D=M(D,B,j,V,x,4,E[44]),V=M(V,D,B,j,J,11,E[45]),j=M(j,V,D,B,G,16,E[46]),B=M(B,j,V,D,A,23,E[47]),D=P(D,B,j,V,p,6,E[48]),V=P(V,D,B,j,U,10,E[49]),j=P(j,V,D,B,Q,15,E[50]),B=P(B,j,V,D,W,21,E[51]),D=P(D,B,j,V,J,6,E[52]),V=P(V,D,B,j,_,10,E[53]),j=P(j,V,D,B,z,15,E[54]),B=P(B,j,V,D,u,21,E[55]),D=P(D,B,j,V,I,6,E[56]),V=P(V,D,B,j,G,10,E[57]),j=P(j,V,D,B,H,15,E[58]),B=P(B,j,V,D,ee,21,E[59]),D=P(D,B,j,V,L,6,E[60]),V=P(V,D,B,j,k,10,E[61]),j=P(j,V,D,B,A,15,E[62]),B=P(B,j,V,D,x,21,E[63]),d[0]=d[0]+D|0,d[1]=d[1]+B|0,d[2]=d[2]+j|0,d[3]=d[3]+V|0},_doFinalize:function(){var O=this._data,b=O.words,T=this._nDataBytes*8,l=O.sigBytes*8;b[l>>>5]|=128<<24-l%32;var v=i.floor(T/4294967296),d=T;b[(l+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,b[(l+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,O.sigBytes=(b.length+1)*4,this._process();for(var p=this._hash,u=p.words,A=0;A<4;A++){var _=u[A];u[A]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return p},clone:function(){var O=f.clone.call(this);return O._hash=this._hash.clone(),O}});function a(O,b,T,l,v,d,p){var u=O+(b&T|~b&l)+v+p;return(u<<d|u>>>32-d)+b}function S(O,b,T,l,v,d,p){var u=O+(b&l|T&~l)+v+p;return(u<<d|u>>>32-d)+b}function M(O,b,T,l,v,d,p){var u=O+(b^T^l)+v+p;return(u<<d|u>>>32-d)+b}function P(O,b,T,l,v,d,p){var u=O+(T^(b|~l))+v+p;return(u<<d|u>>>32-d)+b}m.MD5=f._createHelper(R),m.HmacMD5=f._createHmacHelper(R)}(Math),s.MD5})},function(h,r,n){"use strict";var s;r.__esModule=!0;var i=n(1),m=i.__importDefault(n(0)),y=i.__importStar(n(2)),c=i.__importDefault(n(8)),f=i.__importDefault(n(5)),C=i.__importDefault(n(17)),E=i.__importDefault(n(15)),R=i.__importDefault(n(20)),a=i.__importDefault(n(3)),S=n(29);function M(b){var T=b.statusCode;return T===408&&!b.code||T===400&&!b.code||T>=500&&T<=504}function P(b){var T=b.connection,l=T&&T.connectionManager.host;return l?[l].concat(c.default.getFallbackHosts(b.options)):c.default.getHosts(b.options)}var O=(s=function(){function b(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=P,m.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(T,l,v,d,p,u,A){var _=E.default.createRequest(v,d,p,u,R.default.REQ_SEND,l&&l.options.timeouts,T);return _.once("complete",A),_.exec(),_},this.checkConnectivity=function(T){var l=c.default.internetUpUrl;a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+l),this.doUri(C.default.Get,null,l,null,null,null,function(v,d){var p,u=!v&&((p=d)===null||p===void 0?void 0:p.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+u),T(null,u)})}):m.default.Config.jsonpSupported&&(this.Request=function(T,l,v,d,p,u,A){var _=S.createRequest(v,d,p,u,R.default.REQ_SEND,l&&l.options.timeouts,T);return _.once("complete",A),m.default.Config.nextTick(function(){_.exec()}),_},this.checkConnectivity=function(T){var l=this,v=c.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(T);return}this.checksInProgress=[T],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+v);var d=new S.Request("isTheInternetUp",v,null,null,null,R.default.REQ_SEND,c.default.TIMEOUTS);d.once("complete",function(p,u){var A=!p&&u;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+A);for(var _=0;_<l.checksInProgress.length;_++)l.checksInProgress[_](null,A);l.checksInProgress=null}),m.default.Config.nextTick(function(){d.exec()})})}return b.prototype.do=function(T,l,v,d,p,u,A){var _=this,L=typeof v=="function"?v:function(I){return l.baseUri(I)+v},W=l._currentFallback;if(W)if(W.validUntil>y.now()){if(!this.Request){A==null||A(new f.default("Request invoked before assigned to",null,500));return}this.Request(T,l,L(W.host),d,u,p,function(I){for(var x=[],z=1;z<arguments.length;z++)x[z-1]=arguments[z];if(I&&M(I)){l._currentFallback=null,_.do(T,l,v,d,p,u,A);return}A==null||A.apply(void 0,i.__spreadArray([I],x))});return}else l._currentFallback=null;var H=P(l);if(H.length===1){this.doUri(T,l,L(H[0]),d,p,u,A);return}var U=function(I,x){var z=I.shift();_.doUri(T,l,L(z),d,p,u,function(k){for(var J=[],ee=1;ee<arguments.length;ee++)J[ee-1]=arguments[ee];if(k&&M(k)&&I.length){U(I,!0);return}x&&(l._currentFallback={host:z,validUntil:y.now()+l.options.timeouts.fallbackRetryTimeout}),A==null||A.apply(void 0,i.__spreadArray([k],J))})};U(H)},b.prototype.doUri=function(T,l,v,d,p,u,A){if(!this.Request){A(new f.default("Request invoked before assigned to",null,500));return}this.Request(T,l,v,d,u,p,A)},b}(),s.methods=[C.default.Get,C.default.Delete,C.default.Post,C.default.Put,C.default.Patch],s.methodsWithoutBody=[C.default.Get,C.default.Delete],s.methodsWithBody=[C.default.Post,C.default.Put,C.default.Patch],s);r.default=O},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(40)),m=s.__importStar(n(2)),y=m.getGlobalObject();function c(){var R=y.location;return!y.WebSocket||!R||!R.origin||R.origin.indexOf("http")>-1}var f=y.navigator&&y.navigator.userAgent.toString(),C=y.location&&y.location.href,E={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:C,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:y.WebSocket,xhrSupported:y.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:c(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!y.TextDecoder,preferBinary:!1,ArrayBuffer:y.ArrayBuffer,atob:y.atob,nextTick:typeof y.setImmediate!="undefined"?y.setImmediate.bind(y):function(R){setTimeout(R,0)},addEventListener:y.addEventListener,inspect:JSON.stringify,stringByteSize:function(R){return y.TextDecoder&&new y.TextEncoder().encode(R).length||R.length},TextEncoder:y.TextEncoder,TextDecoder:y.TextDecoder,Promise:y.Promise,getRandomValues:function(R){if(R!==void 0)return function(a,S){R.getRandomValues(a),S&&S(null)}}(y.crypto||msCrypto)};r.default=E},function(h,r,n){"use strict";(function(s){r.__esModule=!0;var i=n(1),m=i.__importStar(n(2)),y="ablyjs-storage-test",c=function(){function f(){try{s.sessionStorage.setItem(y,y),s.sessionStorage.removeItem(y),this.sessionSupported=!0}catch(C){this.sessionSupported=!1}try{s.localStorage.setItem(y,y),s.localStorage.removeItem(y),this.localSupported=!0}catch(C){this.localSupported=!1}}return f.prototype.get=function(C){return this._get(C,!1)},f.prototype.getSession=function(C){return this._get(C,!0)},f.prototype.remove=function(C){return this._remove(C,!1)},f.prototype.removeSession=function(C){return this._remove(C,!0)},f.prototype.set=function(C,E,R){return this._set(C,E,R,!1)},f.prototype.setSession=function(C,E,R){return this._set(C,E,R,!0)},f.prototype._set=function(C,E,R,a){var S={value:E};return R&&(S.expires=m.now()+R),this.storageInterface(a).setItem(C,JSON.stringify(S))},f.prototype._get=function(C,E){if(E&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!E&&!this.localSupported)throw new Error("Local Storage not supported");var R=this.storageInterface(E).getItem(C);if(!R)return null;var a=JSON.parse(R);return a.expires&&a.expires<m.now()?(this.storageInterface(E).removeItem(C),null):a.value},f.prototype._remove=function(C,E){return this.storageInterface(E).removeItem(C)},f.prototype.storageInterface=function(C){return C?s.sessionStorage:s.localStorage},f}();r.default=new c}).call(this,n(12))},function(h,r,n){"use strict";r.__esModule=!0;var s=n(1),i=s.__importDefault(n(66)),m={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};r.default=m},function(h,r,n){"use strict";r.__esModule=!0;var s;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(s||(s={})),r.default=s},function(h,r,n){"use strict";n.r(r);var s=n(29),i=n.n(s),m=n(2),y=n(0),c=n.n(y),f=n(11),C=n.n(f),E=n(15),R=n.n(E),a=function(b){var T="xhr_polling";function l(v,d,p){p.stream=!1,C.a.call(this,v,d,p),this.shortName=T}return m.inherits(l,C.a),l.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.allowComet},l.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(v,d,p,u,A){return R.a.createRequest(v,d,p,u,A,this.timeouts)},typeof b!="undefined"&&l.isAvailable()&&(b.supportedTransports[T]=l),l},S=a,M=function(b){var T="xhr_streaming";function l(v,d,p){C.a.call(this,v,d,p),this.shortName=T}return m.inherits(l,C.a),l.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.streamingSupported&&c.a.Config.allowComet},l.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(v,d,p,u,A){return R.a.createRequest(v,d,p,u,A,this.timeouts)},typeof b!="undefined"&&l.isAvailable()&&(b.supportedTransports[T]=l),l},P=M,O=r.default=[i.a,S,P]}]).default})});X();X();var mr=(v=>(v.MEETING_START="meeting.start",v.MEETING_LEAVE="meeting.leave",v.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",v.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",v.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",v.MEETING_PARTICIPANT_LEFT="meeting.participant-left",v.MEETING_JOIN="meeting.join",v.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",v.MEETING_HOST_CHANGE="meeting.host-change",v.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",v.MEETING_DEVICES_CHANGE="meeting.devices-change",v.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",v.MEETING_STATE_UPDATE="meeting.state-update",v.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",v.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",v.MY_PARTICIPANT_UPDATED="my-participant.update",v.MY_PARTICIPANT_LEFT="my-participant.left",v.MY_PARTICIPANT_JOINED="my-participant.joined",v.MEETING_KICK_PARTICIPANT="meeting.kick-participant",v.DESTROY="destroy",v))(mr||{});var as=(y=>(y.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",y.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",y.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",y.TOGGLE_CAM="meeting-controls.toggle-cam",y.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",y.HANG_UP="hang-up",y))(as||{}),On=(R=>(R.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",R.REALTIME_HOST_CHANGE="realtime.host-change",R.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",R.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",R.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",R.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",R.REALTIME_GATHER="realtime.gather",R.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",R.REALTIME_SET_AVATAR="realtime.set-avatar",R.REALTIME_DRAWING_CHANGE="realtime.drawing-change",R.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",R))(On||{});var Ai=(E=>(E[E.MEETING_FAILED=-1]="MEETING_FAILED",E[E.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",E[E.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",E[E.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",E[E.MEETING_CONNECTING=3]="MEETING_CONNECTING",E[E.MEETING_CONNECTED=4]="MEETING_CONNECTED",E[E.MEETING_RECONNECT=5]="MEETING_RECONNECT",E[E.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",E[E.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",E[E.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",E))(Ai||{}),Ci=(y=>(y.JOINED="participant.joined",y.LOCAL_JOINED="participant.local-joined",y.LEFT="participant.left",y.LOCAL_LEFT="participant.local-left",y.LOCAL_UPDATED="participant.updated",y.LIST_UPDATED="participant.list-updated",y))(Ci||{}),yr=(c=>(c[c.NOT_AVAILABLE=0]="NOT_AVAILABLE",c[c.GOOD=1]="GOOD",c[c.BAD=2]="BAD",c[c.POOR=3]="POOR",c[c.DISCONNECTED=4]="DISCONNECTED",c[c.RECONNECTING=5]="RECONNECTING",c[c.LOST_CONNECTION=6]="LOST_CONNECTION",c))(yr||{}),us=(y=>(y.NO_CAM="devices.no-cam",y.NO_DEVICES="devices.no-devices",y.DEVICES_BLOCKED="devices.blocked",y.DEVICES_CAM_BLOCKED="devices.cam-blocked",y.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",y.DEVICES_UNKNOWN_ERROR="devices.unknown-error",y))(us||{});X();X();var vs=Jt(Oi());X();X();var un=(i,m,y,...c)=>Qe(void 0,[i,m,y,...c],function*(h,r,n,s={}){let f=yield fetch(h,{method:r,headers:gt({"Content-Type":"application/json"},s),body:n?JSON.stringify(n):null});if(!f.ok)throw f;return f.json()});X();var Ml=Jt(ls()),Xe=class{constructor(r){this.debug=(0,Ml.default)(r)}log(r,...n){this.debug(r,...n)}};X();var fc=Jt(hs());var _e=class{constructor(r={}){this.subscribe=r=>{this.callbacks.push(r)};this.unsubscribe=r=>{this.callbacks=this.callbacks.filter(n=>n!==r)};this.publish=(...r)=>{!this.callbacks||this.callbacks.forEach(n=>{this.callListener(n,r).catch(s=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${n}
            Event: ${JSON.stringify(r)}
            Error: ${s}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(r,n)=>new Promise((s,i)=>{try{let m=r(...n);s(m)}catch(m){i(m)}});let{logger:n,throttleTime:s}=r;this.logger=n!=null?n:new Xe("@superviz/sdk/observer-helper"),this.throttle=s,this.callbacks=[],this.throttle&&(this.publish=(0,fc.default)(this.publish,this.throttle))}};X();var Ft=Jt(dc()),Or=class{constructor(){this.browser=Ft.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Ft.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Ft.default.PLATFORMS_MAP.mobile)||this.browser.is(Ft.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Ft.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};X();var hc=Jt(Oi()),gs=class{setConfig(r){this.configuration=r}get(r,n){if(!this.configuration)throw new Error("configs is not available");return(0,hc.get)(this.configuration,r,n)}},$e=new gs;X();var Ti=class{constructor(){this.updateMeetingConnectionStatus=r=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=r,this.connectionStatusObserver.publish(r),this.logger.log("CONNECTION STATUS CHANGE",r)};this.onUpdateBrowserOnlineStatus=r=>{let{type:n}=r;if(n==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new Xe("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new _e({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};X();X();var Fy=`
  html, body { 
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #sv-video-wrapper iframe {
    position: fixed;
    
    border: none;

    margin: 0; 
    padding: 0; 
    overflow: hidden;
    z-index: 5;
  }

  #sv-video-wrapper iframe.sv-video-frame--right { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
  }

  #sv-video-wrapper iframe.sv-video-frame--left { 
    top: var(--superviz-offset-top);
    left: var(--superviz-offset-left);
  }

  #sv-video-wrapper iframe.sv-video-frame--bottom { 
    bottom: var(--superviz-offset-bottom);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--top { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--no-overlay { 
    display: none;
  }
`,pc=Fy;X();var Ii=class{build(r,n,s,i={},m={}){let y=document.querySelector(`#${r}`),c=new URL(n);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(i).forEach(([f,C])=>{c.searchParams.set(f,C)}),Object.entries(m).forEach(([f,C])=>{this.element.setAttribute(f,C)}),this.element.src=c.toString(),this.element.id=s,y.appendChild(this.element),this.wrapperId=r}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let r=document.querySelector(`#${this.wrapperId}`);!!r&&!!r.querySelector(`#${this.element.id}`)&&r.removeChild(this.element),this.wrapperId=null,this.element=null}};X();var _i=class{constructor(r){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(r,n={})=>{this.logger.log("MessageBridge","Posting message to frame",r,n),this.contentWindow.postMessage({type:r,data:n},this.allowedOrigins)};this.listen=(r,n)=>{this.observers[r]||(this.observers[r]=new _e({logger:this.logger})),this.observers[r].subscribe(n)};this.onReceiveMessage=r=>{let{type:n,data:s,source:i}=r.data;if(this.sourceBlockList.includes(i)||this.originBlockList.includes(r.origin))return;let m=!!n,y=!this.domains.length||this.domains.includes(r.origin),c=this.observers.hasOwnProperty(n);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${r.type}
        ORIGIN: ${r.origin}
        DATA: ${JSON.stringify(r.data)} `),!m||!y||!c){this.logger.log("MessageBridge","Message discarded");return}this.observers[n].publish(s)};let{contentWindow:n,domains:s=[],allowedOrigins:i="*",sourceBlockList:m=[],logger:y}=r;if(this.logger=y,this.domains=s,this.allowedOrigins=i,this.sourceBlockList.push(...m),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=n,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([r,n])=>{n.reset(),delete this.observers[r]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};X();var gc="sv-video-frame",Sr=class{constructor(r){this.logger=new Xe("@superviz/sdk/video-conference-manager");this.frameStateObserver=new _e({logger:this.logger});this.frameSizeObserver=new _e({logger:this.logger});this.waitingForHostObserver=new _e({logger:this.logger});this.realtimeEventsObserver=new _e({logger:this.logger});this.sameAccountErrorObserver=new _e({logger:this.logger});this.devicesObserver=new _e({logger:this.logger});this.meetingStateObserver=new _e({logger:this.logger});this.meetingConnectionObserver=new _e({logger:this.logger});this.participantJoinedObserver=new _e({logger:this.logger});this.participantLeftObserver=new _e({logger:this.logger});this.participantListObserver=new _e({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(r,n)=>{let s=r,i=n,m=["left","right","bottom","top"].includes(i),y=["left","right","center"].includes(s);return m||(i="right"),y||(s="right"),this.browserService.isMobileDevice?(i="bottom",{layoutPosition:s,camerasPosition:i}):(s==="left"&&i==="right"&&(s="right"),s==="right"&&i==="left"&&(s="left"),{layoutPosition:s,camerasPosition:i})};this.onFrameLoad=()=>{this.messageBridge=new _i({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=r=>{let n=r!=null?r:{};["top","bottom","left","right"].forEach(s=>{Object.keys(n).includes(s)||(n[s]=0)}),this.frameOffset=n};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=r=>{let n=document.createElement("style"),{bottom:s,left:i,right:m,top:y}=this.frameOffset;if(n.innerHTML=`
    :root {
      --superviz-offset-top: ${y}px;
      --superviz-offset-right: ${m}px;
      --superviz-offset-left: ${i}px;
      --superviz-offset-bottom: ${s}px;
    } 
    ${pc}    
    `,document.head.appendChild(n),this.frameConfig.disableCameraOverlay){this.bricklayer.element.classList.add("sv-video-frame--no-overlay");return}if(this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${r}`)};this.onFrameDimensionsUpdate=({width:r,height:n})=>{let s=document.getElementById(gc),{bottom:i,right:m,left:y,top:c}=this.frameOffset,f=this.isWaterMarkEnabled?40:0,C=`${r}px`,E=`${n+f}px`;(r>=window.innerWidth||this.isHorizontalCameraEnabled)&&(C=`calc(100% - ${m}px - ${y}px)`),n>=window.innerHeight&&(E=`calc(100% - ${c}px - ${i}px)`),s.style.width=C,s.style.height=E,this.frameSizeObserver.publish({width:C,height:E})};this.onWindowResize=()=>{let{top:r,bottom:n,right:s,left:i}=this.frameOffset,{innerHeight:m,innerWidth:y}=window,c=m-r-n,f=y-s-i;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:c,width:f})};this.updateFrameLocale=()=>{var m,y;if(!this.frameLocale||!((m=this.frameLocale)!=null&&m.language)&&((y=this.frameLocale)==null?void 0:y.locales))return;let{language:r,locales:n}=this.frameLocale,s=n.map(c=>c==null?void 0:c.language),i=["en",...s];if(r&&!i.includes(r))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=r=>{this.participantJoinedObserver.publish(r)};this.onParticipantLeft=r=>{this.participantLeftObserver.publish(r)};this.onMeetingHostChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:r})};this.onMeetingKickParticipant=r=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:r})};this.onFollowParticipantDidChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:r})};this.onGoToDidChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:r})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:r})};this.onDrawingChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:r})};this.onTranscriptChange=r=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:r})};this.onSameAccountError=r=>{this.sameAccountErrorObserver.publish(r)};this.onDevicesChange=r=>{this.devicesObserver.publish(r)};this.meetingStateUpdate=r=>{this.meetingStateObserver.publish(r)};this.onConnectionStatusChange=r=>{this.meetingConnectionObserver.publish(r)};this.onWaitingForHostDidChange=r=>{this.waitingForHostObserver.publish(r)};this.onParticipantListUpdate=r=>{this.participantListObserver.publish(r)};var A,_,L,W;let{language:n,canUseCams:s,canUseChat:i,canUseScreenshare:m,canUseDefaultAvatars:y,canUseFollow:c,canUseGoTo:f,canUseGather:C,browserService:E,offset:R,canUseDefaultToolbar:a,locales:S,avatars:M,customColors:P,waterMark:O,disableCameraOverlay:b,layoutPosition:T,camerasPosition:l}=r,{skipMeetingSettings:v,devices:d}=r;this.browserService=E;let p=this.layoutModalsAndCamerasConfig(T,l);b&&(v=!0,d={audioInput:!1,audioOutput:!1,videoInput:!1});let u=document.createElement("div");this.frameConfig={apiKey:$e.get("apiKey"),apiUrl:$e.get("apiUrl"),ablyKey:$e.get("ablyKey"),debug:$e.get("debug"),canUseFollow:c,canUseGoTo:f,canUseCams:s,canUseChat:i,canUseGather:C,canUseScreenshare:m,canUseDefaultAvatars:y,camerasPosition:(A=p.camerasPosition)!=null?A:"right",canUseDefaultToolbar:a,roomId:$e.get("roomId"),devices:{audioInput:(_=d==null?void 0:d.audioInput)!=null?_:!0,audioOutput:(L=d==null?void 0:d.audioOutput)!=null?L:!0,videoInput:(W=d==null?void 0:d.videoInput)!=null?W:!0},waterMark:O,skipMeetingSettings:v,disableCameraOverlay:b,layoutPosition:p.layoutPosition},this.customColors=P,u.classList.add("sv_video_wrapper"),u.id="sv-video-wrapper",document.body.appendChild(u),this.updateFrameState(1),this.bricklayer=new Ii,this.bricklayer.build(u.id,$e.get("conferenceLayerUrl"),gc,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(R),this.setFrameStyle(p.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:n,locales:S},this.meetingAvatars=M,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:["all","powered-by"].includes(this.frameConfig.waterMark)}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(r){r!==this.frameState&&(this.frameState=r,this.frameStateObserver.publish(this.frameState));let n={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(n[r])}start(r){this.messageBridge.publish("meeting.start",Cn(gt({},r),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var r,n;(r=this.messageBridge)==null||r.destroy(),(n=this.bricklayer)==null||n.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(r,n){this.messageBridge.publish(r,n)}};X();var Pi=class{constructor(){this.observers={};this.isAttached=!1;this.attach=r=>{if(Object.values(r).includes(null)||Object.values(r).includes(void 0)){let c=`${this.name} @ attach - params are required`;throw this.logger.log(c),new Error(c)}let{realtime:n,localParticipant:s,group:i,config:m,eventBus:y}=r;$e.setConfig(m),this.realtime=n,this.localParticipant=s,this.group=i,this.eventBus=y,this.isAttached=!0,this.logger.log("attached"),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1,Object.keys(this.observers).forEach(r=>this.unsubscribe(r))};this.subscribe=(r,n)=>{this.logger.log(`subscribed to ${r} event`),this.observers[r]||(this.observers[r]=new _e({logger:this.logger})),this.observers[r].subscribe(n)};this.unsubscribe=r=>{this.logger.log(`unsubscribed from ${r} event`),this.observers[r]&&(this.observers[r].reset(),delete this.observers[r])};this.publish=(r,n)=>{r in this.observers&&this.observers[r].publish(n)}}};var Er=class extends Pi{constructor(n){super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.start=()=>{if(this.logger.log("video component @ start"),!this.realtime.isJoinedRoom){this.logger.log("video component @ start - not joined yet"),setTimeout(()=>{this.logger.log("video component @ start - retrying"),this.start()},1e3);return}this.publish("meeting.start"),this.suscribeToRealtimeEvents(),this.startVideo()};this.startVideo=()=>{var n,s,i,m,y,c,f,C,E,R,a,S,M,P,O,b,T,l,v,d,p,u,A;this.videoConfig={language:(n=this.params)==null?void 0:n.language,canUseChat:!((s=this.params)!=null&&s.chatOff),canUseCams:!((i=this.params)!=null&&i.camsOff),canUseScreenshare:!((m=this.params)!=null&&m.screenshareOff),canUseDefaultAvatars:!!((y=this.params)!=null&&y.defaultAvatars)&&!((f=(c=this.localParticipant)==null?void 0:c.avatar)!=null&&f.model),canUseGather:!!((C=this.params)!=null&&C.enableGather),canUseFollow:!!((E=this.params)!=null&&E.enableFollow),canUseGoTo:!!((R=this.params)!=null&&R.enableGoTo),canUseDefaultToolbar:(S=(a=this.params)==null?void 0:a.defaultToolbar)!=null?S:!0,camerasPosition:(M=this.params)==null?void 0:M.camerasPosition,devices:(P=this.params)==null?void 0:P.devices,skipMeetingSettings:(O=this.params)==null?void 0:O.skipMeetingSettings,disableCameraOverlay:(b=this.params)==null?void 0:b.disableCameraOverlay,browserService:this.browserService,offset:(T=this.params)==null?void 0:T.offset,locales:(v=(l=this.params)==null?void 0:l.locales)!=null?v:[],avatars:(p=(d=this.params)==null?void 0:d.avatars)!=null?p:[],customColors:(u=this.params)==null?void 0:u.customColors,layoutPosition:(A=this.params)==null?void 0:A.layoutPosition},this.logger.log("video component @ start video",this.videoConfig),this.videoManager=new Sr(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video component @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{var n,s,i,m,y,c,f,C,E,R,a;this.logger.log("video component @ unsubscribe from video events"),(n=this.videoManager)==null||n.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),(s=this.videoManager)==null||s.participantListObserver.unsubscribe(this.onParticipantListUpdate),(i=this.videoManager)==null||i.waitingForHostObserver.unsubscribe(this.onWaitingForHost),(m=this.videoManager)==null||m.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),(y=this.videoManager)==null||y.meetingStateObserver.unsubscribe(this.onMeetingStateChange),(c=this.videoManager)==null||c.frameStateObserver.unsubscribe(this.onFrameStateChange),(f=this.videoManager)==null||f.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),(C=this.videoManager)==null||C.participantJoinedObserver.unsubscribe(this.onParticipantJoined),(E=this.videoManager)==null||E.participantLeftObserver.unsubscribe(this.onParticipantLeft),(R=this.videoManager)==null||R.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),(a=this.videoManager)==null||a.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video component @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video component @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=n=>{var s;return{id:n.clientId,color:this.realtime.getSlotColor((s=n.data)==null?void 0:s.slotIndex).color,avatar:n.data.avatar,type:n.data.type,name:n.data.name,isHost:this.realtime.hostClientId===n.clientId}};this.onFrameSizeDidChange=n=>{this.publish("frame.dimensions-update",n)};this.onWaitingForHost=n=>{this.publish("meeting.waiting-for-host",n)};this.onConnectionStatusChange=n=>{this.logger.log("video component @ on connection status change",n);let s=[2,4,3,6];s.includes(n)&&this.realtime.freezeSync(!0),s.includes(this.connectionService.oldConnectionStatus)&&!s.includes(n)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",n)};this.onMeetingStateChange=n=>{this.logger.log("video component @ on meeting state change",n),this.publish("meeting.state-update",n)};this.onSameAccountError=n=>{this.publish("meeting.same-participant-error",n),this.detach()};this.onDevicesChange=n=>{this.publish("meeting.devices-change",n)};this.onFrameStateChange=n=>{this.logger.log("video component @ on frame state change",n),n===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:$e.get("roomId")})};this.onRealtimeEventFromFrame=({event:n,data:s})=>{this.logger.log("video component @ on realtime event from frame",n,s);let i={["realtime.host-change"]:m=>this.realtime.setHost(m),["realtime.gather"]:m=>this.realtime.setGather(m),["realtime.grid-mode-change"]:m=>this.realtime.setGridMode(m),["realtime.drawing-change"]:m=>{this.realtime.setDrawing(m)},["realtime.follow-participant"]:m=>{this.realtime.setFollowParticipant(m)},["meeting.kick-participant"]:m=>{this.realtime.setKickParticipant(m)},["realtime.transcript-change"]:m=>{this.realtime.setTranscript(m)},["realtime.go-to-participant"]:m=>{this.eventBus.publish("realtime.go-to-participant",m)}}[n](s);this.publish(n,s)};this.onParticipantJoined=n=>{if(this.logger.log("video component @ on participant joined",n),this.localParticipant=n,this.publish("meeting.participant-joined",n),this.publish("my-participant.joined",n),this.onRealtimeParticipantsDidChange(this.realtime.getParticipants),this.onRoomInfoUpdated(this.realtime.roomProperties),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:n.avatar,name:n.name});return}this.realtime.updateMyProperties({name:n.name})};this.onParticipantLeft=n=>{this.logger.log("video component @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.detach()};this.onParticipantListUpdate=n=>{this.logger.log("video component @ on participant list update",n),!(0,vs.isEqual)(this.participantsOnMeeting,n)&&(this.publish("meeting.participant-list-update",n),this.participantsOnMeeting.length!==n.length&&this.publish("meeting.amount-of-participants-update",n.length),this.participantsOnMeeting=n)};this.onKickAllParticipantsDidChange=n=>{this.logger.log("video component @ on kick all participants did change",n),this.publish("meeting.kick-all-participants",n),this.detach()};this.onKickLocalParticipant=()=>{this.logger.log("video component @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.onRoomInfoUpdated=n=>{if(!n)return;this.logger.log("video component @ on room info updated",n);let{isGridModeEnable:s,followParticipantId:i,gather:m,drawing:y,transcript:c,hostClientId:f}=n;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",s),this.videoManager.publishMessageToFrame("realtime.drawing-change",y),this.videoManager.publishMessageToFrame("realtime.follow-participant",i),this.videoManager.publishMessageToFrame("realtime.transcript-change",c),this.videoManager.publishMessageToFrame("realtime.host-change",f),this.realtime.hostClientId===this.localParticipant.id&&m&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=n=>{if(!this.videoManager||!n)return;this.logger.log("video component @ on participants did change",n);let s=Object.values(n).map(i=>({timestamp:i.timestamp,connectionId:i.connectionId,participantId:i.clientId,color:this.realtime.getSlotColor(i.data.slotIndex).name,name:i.data.name,isHost:this.realtime.hostClientId===i.clientId,avatar:i.data.avatar,type:i.data.type}));(0,vs.isEqual)(this.participantToFrameList,s)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",s),this.participantToFrameList=s};this.onHostParticipantDidChange=n=>{this.logger.log("video component @ on host participant did change",n),this.videoManager.publishMessageToFrame("realtime.host-change",n==null?void 0:n.newHostParticipantId)};this.onParticipantJoinedOnRealtime=n=>{this.logger.log("video component @ on participant joined on realtime",n),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(n))};this.onParticipantLeftOnRealtime=n=>{this.logger.log("video component @ on participant left on realtime",n),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(n))};this.params=n,this.name="video-component",this.logger=new Xe("@superviz/sdk/video-component"),this.browserService=new Or,this.connectionService=new Ti,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}destroy(){var n;this.logger.log("video component @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),(n=this.videoManager)==null||n.leave(),this.connectionService.removeListeners()}};X();var Ts=Jt(ls());X();var qt=class{static createUrl(r,n){return`${r}${n}`}static validateApiKey(r,n){let s="/user/checkapikey",i=this.createUrl(r,s);return un(i,"POST",{apiKey:n})}static fetchConfig(r,n){let s="/immersive-config",i=this.createUrl(r,s);return un(i,"POST",{apiKey:n})}static fetchWaterMark(r,n){return Qe(this,null,function*(){let s="/user/watermark",i=this.createUrl(r,s),{message:m}=yield un(i,"POST",{apiKey:n});return m})}static sendActivity(r,n,s){return Qe(this,null,function*(){let i="/activity",m=$e.get("apiUrl"),y=$e.get("roomId"),c=$e.get("apiKey"),f=this.createUrl(m,i);return un(f,"POST",{groupId:n,meetingId:y,product:s,userId:r},{apikey:c})})}};X();function ky(h,r){return Qe(this,null,function*(){try{return(yield qt.validateApiKey(h,r))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}})}var vc=ky;X();X();var qn=class{static getRemoteConfig(){return Qe(this,arguments,function*(r="prod"){let{version:n}=yield Promise.resolve().then(()=>(yc(),mc));if(r==="local"){let{remoteConfig:m}=yield Promise.resolve().then(()=>(Ac(),bc));return m}let s={version:n,environment:r},i=this.createUrl(s);return un(i,"GET",null)})}static createUrl({version:r,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${r}?env=${n}`}};qn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";X();var Es=Jt(Oi());X();var Rr=class{constructor(){this.observers=new Map;this.subscribe=(r,n)=>{this.logger.log("event bus service @ subscribe",{event:r,callback:n}),this.observers.has(r)||this.observers.set(r,new _e),this.observers.get(r).subscribe(n)};this.unsubscribe=(r,n)=>{this.logger.log("event bus service @ unsubscribe",{event:r,callback:n}),this.observers.has(r)&&(this.observers.get(r).reset(),this.observers.delete(r))};this.publish=(r,n)=>{this.logger.log("event bus service @ publish",{event:r,data:n}),this.observers.has(r)&&this.observers.get(r).publish(n)};this.logger=new Xe("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};X();var wi=class{constructor(r){this.observers=new Map;this.subscribe=(r,n)=>{this.logger.log("pubsub service @ subscribe",{event:r,callback:n}),this.observers.has(r)||this.observers.set(r,new _e),this.observers.get(r).subscribe(n)};this.unsubscribe=(r,n)=>{this.logger.log("pubsub service @ unsubscribe",{event:r,callback:n}),this.observers.has(r)&&(this.observers.get(r).reset(),this.observers.delete(r))};this.publish=(r,n)=>{this.logger.log("pubsub service @ publish",{event:r,data:n}),this.realtime.setSyncProperty(r,n)};this.publishEventToClient=(r,n)=>{this.logger.log("pubsub service @ publishEventToClient",{event:r,data:n}),this.observers.has(r)&&this.observers.get(r).publish(n)};this.onSyncPropertiesChange=r=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:r}),Object.entries(r).forEach(([n,s])=>{this.publishEventToClient(n,s)})};this.logger=new Xe("@superviz/sdk/pubsub"),this.realtime=r,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(r){return this.realtime.fetchSyncClientProperty(r)}};X();X();var Ss=Jt(Cc()),Tr=Jt(hs());X();var ys=(s=>(s.HOST="host",s.GUEST="guest",s.AUDIENCE="audience",s))(ys||{});X();var bs=(f=>(f[f.DISCONNECTED=0]="DISCONNECTED",f[f.INITIALIZING=1]="INITIALIZING",f[f.READY_TO_JOIN=2]="READY_TO_JOIN",f[f.CONNECTING=3]="CONNECTING",f[f.CONNECTED=4]="CONNECTED",f[f.JOINED=5]="JOINED",f[f.FAILED=-1]="FAILED",f[f.RETRYING=-2]="RETRYING",f))(bs||{});X();X();var As=(b=>(b[b.yellow=0]="yellow",b[b.turquoise=1]="turquoise",b[b.orange=2]="orange",b[b.blue=3]="blue",b[b.pink=4]="pink",b[b.purple=5]="purple",b[b.green=6]="green",b[b.red=7]="red",b[b.bluedark=8]="bluedark",b[b.pinklight=9]="pinklight",b[b.purplelight=10]="purplelight",b[b.greenlight=11]="greenlight",b[b.orangelight=12]="orangelight",b[b.bluelight=13]="bluelight",b[b.redlight=14]="redlight",b[b.brown=15]="brown",b[b.gray=16]="gray",b))(As||{}),Cs=(h=>(h[h["#FFEF33"]=0]="#FFEF33",h[h["#31E0B0"]=1]="#31E0B0",h[h["#FF5E10"]=2]="#FF5E10",h[h["#00ABF7"]=3]="#00ABF7",h[h["#FF00BB"]=4]="#FF00BB",h[h["#9C29FF"]=5]="#9C29FF",h[h["#6FDD00"]=6]="#6FDD00",h[h["#E30000"]=7]="#E30000",h[h["#304AFF"]=8]="#304AFF",h[h["#FF89C4"]=9]="#FF89C4",h[h["#D597FF"]=10]="#D597FF",h[h["#C6EC5C"]=11]="#C6EC5C",h[h["#FFA115"]=12]="#FFA115",h[h["#75DEFE"]=13]="#75DEFE",h[h["#FAA291"]=14]="#FAA291",h[h["#BB813F"]=15]="#BB813F",h[h["#878291"]=16]="#878291",h))(Cs||{});var xi=class{constructor(){this.participantObservers=[],this.logger=new Xe("@superviz/sdk/realtime-service"),this.participantsObserver=new _e({logger:this.logger}),this.participantJoinedObserver=new _e({logger:this.logger}),this.participantLeaveObserver=new _e({logger:this.logger}),this.syncPropertiesObserver=new _e({logger:this.logger}),this.reconnectObserver=new _e({logger:this.logger}),this.roomInfoUpdatedObserver=new _e({logger:this.logger}),this.roomListUpdatedObserver=new _e({logger:this.logger}),this.hostObserver=new _e({logger:this.logger}),this.realtimeStateObserver=new _e({logger:this.logger}),this.kickAllParticipantsObserver=new _e({logger:this.logger}),this.kickParticipantObserver=new _e({logger:this.logger}),this.authenticationObserver=new _e({logger:this.logger})}subscribeToParticipantUpdate(r,n){this.participantObservers[r]||(this.participantObservers[r]=new _e({logger:this.logger})),this.participantObservers[r].subscribe(n)}unsubscribeFromParticipantUpdate(r,n){this.participantObservers[r]&&this.participantObservers[r].unsubscribe(n)}getSlotColor(r){let n=r!=null?r:16;return{color:Cs[n],name:As[n]}}};var $y=1e3*60,Vy=6e4,jy=1e4,Ky=1e3,Os=null,Qn=class extends xi{constructor(n,s){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({hostClientId:s.clientId})};this.setKickParticipant=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({kickParticipant:s})};this.freezeSync=n=>{var s,i;if(this.isSyncFrozen=n,n){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(s=this.broadcastChannel)==null||s.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(n=>{let s=this.clientSyncPropertiesQueue[n];this.clientSyncPropertiesQueue[n]=[],s.length&&this.clientSyncChannel.publish(n,s)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(n,s)=>{this.clientRoomState[n]=s[s.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=n=>Qe(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?(n==null?void 0:n.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(n.hostClientId):this.hostPassingHandle(),this.updateParticipants(),n.kickParticipant&&n.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Tr.default)((n={})=>{let s=n;if(!(this.isMessageTooBig(s)||this.left||!this.enableSync||this.isSyncFrozen)&&(s.avatar===void 0&&delete s.avatar,this.myParticipant.data=gt(gt({},this.myParticipant.data),s),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},Ky);this.updateRoomProperties=n=>{if(this.isMessageTooBig(n)||this.isSyncFrozen||this.left)return;let s=gt(gt({},this.localRoomProperties),n);this.supervizChannel.publish("update",s)};this.updateParticipants=()=>{let n={};this.supervizChannel.presence.get((s,i)=>{i.forEach(m=>{n[m.clientId]=gt({},m)}),this.participants=n,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=n=>{let s=[];if(this.supervizChannel.presence.get((m,y)=>{y.forEach(c=>{m||s.push(c.clientId)})}),!n||!s.includes(n)){this.hostPassingHandle();return}Os&&clearTimeout(Os);let i=this.hostParticipantId;this.hostParticipantId=n,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var s;let n={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((s=this.myParticipant)==null?void 0:s.data.type)==="host"&&(n.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(n)};this.hostPassingHandle=(0,Tr.default)(()=>Qe(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((n,s)=>{let i=s.filter(y=>y.data.type==="host").map(y=>y.clientId);if(this.shouldKickParticipantsOnHostLeave&&i.length===0){Os=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},$y);return}let m=i[0];m===this.localParticipantId&&this.setHost(m)})}),1e3);this.findSlotIndex=n=>{let s=n,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((c,f)=>{if(c){i=[];return}f.forEach(C=>{C.connectionId===s.connectionId&&(s=C),C.connectionId!==s.connectionId&&C.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(C.data.slotIndex),1)})}),i.length===0)return;let m=i[0];this.myParticipant.data.slotIndex=m,this.updateMyProperties({slotIndex:m});let y=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(s)},y)};this.confirmSlot=(0,Tr.default)(n=>Qe(this,null,function*(){let s=[],i=n;if(this.supervizChannel.presence.get((m,y)=>{y.forEach(c=>{c.connectionId===i.connectionId&&(i=c),c.connectionId!==i.connectionId&&c.data.slotIndex!==void 0&&s.push(c.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||s.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let m=yield this.fetchRoomProperties();this.updateRoomProperties(m)}}),1e3);this.onParticipantJoin=n=>{this.updateParticipants(),this.participantJoinedObserver.publish(n),this.updateMyProperties()};this.syncBroadcast=(0,Tr.default)(()=>{let n=btoa(this.ablyKey),s=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(s,{headers:{Authorization:`Basic ${n}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(n,s=Vy)=>{let i=JSON.stringify(n);return new TextEncoder().encode(i).length>s?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=s,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var n,s;return(s=(n=this.myParticipant.data)==null?void 0:n.participantId)!=null?s:null}get isBroadcast(){return Object.values(this.participants).some(n=>n.data.type==="audience")}start({participant:n,roomId:s,apiKey:i,shouldKickParticipantsOnHostLeave:m}){this.myParticipant={data:Cn(gt({},n),{participantId:n.id}),timestamp:null,action:null,clientId:n.id,connectionId:null,encoding:null,id:null},this.enableSync=n.type!=="audience",this.roomId=`superviz:${s.toLowerCase()}-${i}`,this.shouldKickParticipantsOnHostLeave=m,this.apiKey=i,this.client||this.buildClient()}auth(n,s){let i=new Ss.default.Rest({key:this.ablyKey}),{origin:m}=window.location;i.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:m,apiKey:this.apiKey}},(y,c)=>{y&&this.authenticationObserver.publish("realtime.authentication-failed"),s(y,c)})}join(n){let s=n?Object.assign({},n,{participantId:n.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(s),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{isGridModeEnable:n}))}setDrawing(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{drawing:n}))}setTranscript(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{transcript:n}))}setSyncProperty(n,s){var y;let i=(y=this.clientSyncPropertiesQueue[n])!=null?y:[],m=(c,f)=>({name:c,data:f,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(m(n,s),jy)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(i)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",n,s),this.clientSyncPropertiesQueue[n]||(this.clientSyncPropertiesQueue[n]=[]),this.clientSyncPropertiesQueue[n].push(m(n,s)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var s,i;if(n){let m=n.toString();if(this.participants&&this.participants[m])return(i=(s=this.participants[n])==null?void 0:s.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:s}=n,i=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(i),this.participants&&this.participants[s]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onClientSyncChannelUpdate(n){let{name:s,data:i}=n,m={};m[s]=i,this.syncPropertiesObserver.publish(m),this.isLocalParticipantHost&&this.saveClientRoomState(s,i)}onReceiveBroadcastSync(n){n.data.forEach(i=>{var y;let m=i.clientId;this.participants[m]=i,(y=i.data)!=null&&y.isAudience||(this.participants[m].data=JSON.parse(this.participants[m].data),this.publishParticipantUpdate(this.participants[m]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Ss.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw this.logger.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,this.logger.log("REALTIME",`Realtime state did change. New state: ${bs[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,s)=>{this.supervizChannel.history((i,m)=>{var c;i&&s(i);let y=(c=m.items[0])==null?void 0:c.data;n(y||null)})})}fetchSyncClientProperty(n){return Qe(this,null,function*(){try{let s=yield new Promise((i,m)=>{this.clientRoomStateChannel.history((y,c)=>{var C;y&&m(y);let f=(C=c==null?void 0:c.items[0])==null?void 0:C.data;i(f||null)})});if(n&&!s[n])throw new Error(`Event ${n} not found in the history`);return n?s[n]:s}catch(s){this.logger.log("REALTIME","Error in fetch client realtime data",s.message),this.throw(s.message)}})}onStateChange(){var E,R,a;let n=(E=this.supervizChannelState)==null?void 0:E.current,s=(R=this.connectionState)==null?void 0:R.current,i=s==="connected",m=["initialized","connecting"].includes(s),y=["closed","closing"].includes(s)||["detaching","detached"].includes(n),c={[0]:y,[1]:m,[2]:!n&&i,[3]:n==="attaching",[4]:n==="attached"&&i,[-1]:n==="failed"||s==="failed",[-2]:s==="suspended"||n==="suspended"},f=Object.entries(c).find(([S,M])=>M&&S)[0],C=Number(f);if(C===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(C===-2||C===-1)&&this.forceReconnect(),(a=this.connectionState)!=null&&a.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(C)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.supervizChannelState=n,this.onStateChange()}onJoinRoom(n){return Qe(this,null,function*(){var s;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(n),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((s=this.localRoomProperties)==null?void 0:s.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(n),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let s=n.data.participantId===this.hostParticipantId;n.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(n),s&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};X();var Rs=class{constructor({participant:r,group:n,shouldKickParticipantsOnHostLeave:s}){this.eventBus=new Rr;this.participants=[];this.addComponent=r=>{r.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:$e.configuration,eventBus:this.eventBus}),qt.sendActivity(this.participant.id,this.group.id,r.name)};this.removeComponent=r=>{r.detach()};this.subscribeToPubSubEvent=(r,n)=>{this.logger.log("launcher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(r,n)};this.unsubscribeFromPubSubEvent=(r,n)=>{this.logger.log("launcher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(r,n)};this.publishToPubSubEvent=(r,n)=>{this.logger.log("launcher service @ publishToPubSubEvent"),this.pubsub.publish(r,n)};this.fetchPubSubHistory=r=>this.pubsub.fetchHistory(r);this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:$e.get("apiKey"),roomId:$e.get("roomId"),shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.onParticipantListUpdate=r=>{this.logger.log("launcher service @ onParticipantListUpdate");let n=Object.values(r).map(i=>{var m,y,c,f,C;return{id:i.data.id,name:(m=i.data)==null?void 0:m.name,type:(y=i.data)==null?void 0:y.type,avatar:(c=i.data)==null?void 0:c.avatar,avatarConfig:(f=i.data)==null?void 0:f.avatarConfig,isHost:this.realtime.hostClientId===i.clientId,color:this.realtime.getSlotColor((C=i.data)==null?void 0:C.slotIndex).color}}),s=n.find(i=>{var m;return(i==null?void 0:i.id)===((m=this.participant)==null?void 0:m.id)});(0,Es.isEqual)(this.participants,n)||(this.participants=n,this.pubsub.publishEventToClient("participant.list-updated",n),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n)),s&&!(0,Es.isEqual)(this.participant,s)&&(this.participant=s,this.pubsub.publishEventToClient("participant.updated",s),this.logger.log("Publishing ParticipantEvent.UPDATED",s))};this.onParticipantJoined=r=>{this.logger.log("launcher service @ onParticipantJoined");let n=this.participants.find(s=>s.id===r.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.pubsub.publishEventToClient("participant.local-joined",n)),this.logger.log("launcher service @ onParticipantJoined - participant joined",n),this.pubsub.publishEventToClient("participant.joined",n))};this.onParticipantLeave=r=>{this.logger.log("launcher service @ onParticipantLeave");let n=this.participants.find(s=>s.id===r.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.pubsub.publishEventToClient("participant.local-left",n)),this.logger.log("launcher service @ onParticipantLeave - participant left",n),this.pubsub.publishEventToClient("participant.left",n))};this.onHostParticipantDidChange=r=>{let n=this.participants.find(s=>s.id===(r==null?void 0:r.newHostParticipantId));this.realtime.isLocalParticipantHost&&this.publishToPubSubEvent("realtime.host-change",n)};this.shouldKickParticipantsOnHostLeave=s!=null?s:!0,this.participant=r,this.group=n,this.logger=new Xe("@superviz/sdk/launcher"),this.realtime=new Qn($e.get("apiUrl"),$e.get("ablyKey")),this.pubsub=new wi(this.realtime),this.eventBus=new Rr,this.logger.log("launcher created"),this.startRealtime()}},Oc=h=>{let r=new Rs(h);return{subscribe:r.subscribeToPubSubEvent,unsubscribe:r.unsubscribeFromPubSubEvent,publish:r.publishToPubSubEvent,fetchHistory:r.fetchPubSubHistory,addComponent:r.addComponent,removeComponent:r.removeComponent}};var Jy=({group:h,participant:r,roomId:n})=>{if(!h||!h.name||!h.id)throw new Error("Group fields is required");if(!r||!r.id)throw new Error("Participants fields is required");if(!n)throw new Error("Room id is required")},qy=(h,r)=>Qe(void 0,null,function*(){if(!(h&&h.trim()))throw new Error("API key is required");if(!r)throw new Error("Options is required");Jy(r),r.debug?Ts.debug.enable("*"):Ts.debug.disable();let{apiUrl:s,conferenceLayerUrl:i}=yield qn.getRemoteConfig(r.environment);if(!(yield vc(s,h)))throw new Error("Failed to validate API key");let y=yield qt.fetchConfig(s,h);if(!y||!y.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:c}=y;return $e.setConfig({apiUrl:s,ablyKey:c,apiKey:h,conferenceLayerUrl:i,environment:y,roomId:r.roomId,debug:r.debug}),Oc(Object.assign({},r,{apiKey:h,ablyKey:c,conferenceLayerUrl:i,apiUrl:s}))}),Is=qy;X();X();X();X();X();var Li=window,Ni=Li.ShadowRoot&&(Li.ShadyCSS===void 0||Li.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,_s=Symbol(),Sc=new WeakMap,Ir=class{constructor(r,n,s){if(this._$cssResult$=!0,s!==_s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=r,this.t=n}get styleSheet(){let r=this.o,n=this.t;if(Ni&&r===void 0){let s=n!==void 0&&n.length===1;s&&(r=Sc.get(n)),r===void 0&&((this.o=r=new CSSStyleSheet).replaceSync(this.cssText),s&&Sc.set(n,r))}return r}toString(){return this.cssText}},Ec=h=>new Ir(typeof h=="string"?h:h+"",void 0,_s),Ps=(h,...r)=>{let n=h.length===1?h[0]:r.reduce((s,i,m)=>s+(y=>{if(y._$cssResult$===!0)return y.cssText;if(typeof y=="number")return y;throw Error("Value passed to 'css' function must be a 'css' function result: "+y+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+h[m+1],h[0]);return new Ir(n,h,_s)},ws=(h,r)=>{Ni?h.adoptedStyleSheets=r.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet):r.forEach(n=>{let s=document.createElement("style"),i=Li.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=n.cssText,h.appendChild(s)})},Di=Ni?h=>h:h=>h instanceof CSSStyleSheet?(r=>{let n="";for(let s of r.cssRules)n+=s.cssText;return Ec(n)})(h):h;var Ms,Ui=window,Rc=Ui.trustedTypes,Qy=Rc?Rc.emptyScript:"",Tc=Ui.reactiveElementPolyfillSupport,Ls={toAttribute(h,r){switch(r){case Boolean:h=h?Qy:null;break;case Object:case Array:h=h==null?h:JSON.stringify(h)}return h},fromAttribute(h,r){let n=h;switch(r){case Boolean:n=h!==null;break;case Number:n=h===null?null:Number(h);break;case Object:case Array:try{n=JSON.parse(h)}catch(s){n=null}}return n}},Ic=(h,r)=>r!==h&&(r==r||h==h),xs={attribute:!0,type:String,converter:Ls,reflect:!1,hasChanged:Ic},Ns="finalized",Qt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(r){var n;this.finalize(),((n=this.h)!==null&&n!==void 0?n:this.h=[]).push(r)}static get observedAttributes(){this.finalize();let r=[];return this.elementProperties.forEach((n,s)=>{let i=this._$Ep(s,n);i!==void 0&&(this._$Ev.set(i,s),r.push(i))}),r}static createProperty(r,n=xs){if(n.state&&(n.attribute=!1),this.finalize(),this.elementProperties.set(r,n),!n.noAccessor&&!this.prototype.hasOwnProperty(r)){let s=typeof r=="symbol"?Symbol():"__"+r,i=this.getPropertyDescriptor(r,s,n);i!==void 0&&Object.defineProperty(this.prototype,r,i)}}static getPropertyDescriptor(r,n,s){return{get(){return this[n]},set(i){let m=this[r];this[n]=i,this.requestUpdate(r,m,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(r){return this.elementProperties.get(r)||xs}static finalize(){if(this.hasOwnProperty(Ns))return!1;this[Ns]=!0;let r=Object.getPrototypeOf(this);if(r.finalize(),r.h!==void 0&&(this.h=[...r.h]),this.elementProperties=new Map(r.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){let n=this.properties,s=[...Object.getOwnPropertyNames(n),...Object.getOwnPropertySymbols(n)];for(let i of s)this.createProperty(i,n[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(r){let n=[];if(Array.isArray(r)){let s=new Set(r.flat(1/0).reverse());for(let i of s)n.unshift(Di(i))}else r!==void 0&&n.push(Di(r));return n}static _$Ep(r,n){let s=n.attribute;return s===!1?void 0:typeof s=="string"?s:typeof r=="string"?r.toLowerCase():void 0}u(){var r;this._$E_=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(r=this.constructor.h)===null||r===void 0||r.forEach(n=>n(this))}addController(r){var n,s;((n=this._$ES)!==null&&n!==void 0?n:this._$ES=[]).push(r),this.renderRoot!==void 0&&this.isConnected&&((s=r.hostConnected)===null||s===void 0||s.call(r))}removeController(r){var n;(n=this._$ES)===null||n===void 0||n.splice(this._$ES.indexOf(r)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((r,n)=>{this.hasOwnProperty(n)&&(this._$Ei.set(n,this[n]),delete this[n])})}createRenderRoot(){var r;let n=(r=this.shadowRoot)!==null&&r!==void 0?r:this.attachShadow(this.constructor.shadowRootOptions);return ws(n,this.constructor.elementStyles),n}connectedCallback(){var r;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(r=this._$ES)===null||r===void 0||r.forEach(n=>{var s;return(s=n.hostConnected)===null||s===void 0?void 0:s.call(n)})}enableUpdating(r){}disconnectedCallback(){var r;(r=this._$ES)===null||r===void 0||r.forEach(n=>{var s;return(s=n.hostDisconnected)===null||s===void 0?void 0:s.call(n)})}attributeChangedCallback(r,n,s){this._$AK(r,s)}_$EO(r,n,s=xs){var i;let m=this.constructor._$Ep(r,s);if(m!==void 0&&s.reflect===!0){let y=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:Ls).toAttribute(n,s.type);this._$El=r,y==null?this.removeAttribute(m):this.setAttribute(m,y),this._$El=null}}_$AK(r,n){var s;let i=this.constructor,m=i._$Ev.get(r);if(m!==void 0&&this._$El!==m){let y=i.getPropertyOptions(m),c=typeof y.converter=="function"?{fromAttribute:y.converter}:((s=y.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?y.converter:Ls;this._$El=m,this[m]=c.fromAttribute(n,y.type),this._$El=null}}requestUpdate(r,n,s){let i=!0;r!==void 0&&(((s=s||this.constructor.getPropertyOptions(r)).hasChanged||Ic)(this[r],n)?(this._$AL.has(r)||this._$AL.set(r,n),s.reflect===!0&&this._$El!==r&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(r,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}_$Ej(){return Qe(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(n){Promise.reject(n)}let r=this.scheduleUpdate();return r!=null&&(yield r),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,m)=>this[m]=i),this._$Ei=void 0);let n=!1,s=this._$AL;try{n=this.shouldUpdate(s),n?(this.willUpdate(s),(r=this._$ES)===null||r===void 0||r.forEach(i=>{var m;return(m=i.hostUpdate)===null||m===void 0?void 0:m.call(i)}),this.update(s)):this._$Ek()}catch(i){throw n=!1,this._$Ek(),i}n&&this._$AE(s)}willUpdate(r){}_$AE(r){var n;(n=this._$ES)===null||n===void 0||n.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(r)),this.updated(r)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(r){return!0}update(r){this._$EC!==void 0&&(this._$EC.forEach((n,s)=>this._$EO(s,this[s],n)),this._$EC=void 0),this._$Ek()}updated(r){}firstUpdated(r){}};Qt[Ns]=!0,Qt.elementProperties=new Map,Qt.elementStyles=[],Qt.shadowRootOptions={mode:"open"},Tc==null||Tc({ReactiveElement:Qt}),((Ms=Ui.reactiveElementVersions)!==null&&Ms!==void 0?Ms:Ui.reactiveElementVersions=[]).push("1.6.2");X();var Ds,Bi=window,Yn=Bi.trustedTypes,_c=Yn?Yn.createPolicy("lit-html",{createHTML:h=>h}):void 0,Bs="$lit$",ln=`lit$${(Math.random()+"").slice(9)}$`,Dc="?"+ln,Yy=`<${Dc}>`,Tn=document,Pr=()=>Tn.createComment(""),wr=h=>h===null||typeof h!="object"&&typeof h!="function",Uc=Array.isArray,Zy=h=>Uc(h)||typeof(h==null?void 0:h[Symbol.iterator])=="function",Us=`[ 	
\f\r]`,_r=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Pc=/-->/g,wc=/>/g,En=RegExp(`>|${Us}(?:([^\\s"'>=/]+)(${Us}*=${Us}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Mc=/'/g,xc=/"/g,Bc=/^(?:script|style|textarea|title)$/i,Fc=h=>(r,...n)=>({_$litType$:h,strings:r,values:n}),Gc=Fc(1),IC=Fc(2),In=Symbol.for("lit-noChange"),rt=Symbol.for("lit-nothing"),Lc=new WeakMap,Rn=Tn.createTreeWalker(Tn,129,null,!1);function Hc(h,r){if(!Array.isArray(h)||!h.hasOwnProperty("raw"))throw Error("invalid template strings array");return _c!==void 0?_c.createHTML(r):r}var Xy=(h,r)=>{let n=h.length-1,s=[],i,m=r===2?"<svg>":"",y=_r;for(let c=0;c<n;c++){let f=h[c],C,E,R=-1,a=0;for(;a<f.length&&(y.lastIndex=a,E=y.exec(f),E!==null);)a=y.lastIndex,y===_r?E[1]==="!--"?y=Pc:E[1]!==void 0?y=wc:E[2]!==void 0?(Bc.test(E[2])&&(i=RegExp("</"+E[2],"g")),y=En):E[3]!==void 0&&(y=En):y===En?E[0]===">"?(y=i!=null?i:_r,R=-1):E[1]===void 0?R=-2:(R=y.lastIndex-E[2].length,C=E[1],y=E[3]===void 0?En:E[3]==='"'?xc:Mc):y===xc||y===Mc?y=En:y===Pc||y===wc?y=_r:(y=En,i=void 0);let S=y===En&&h[c+1].startsWith("/>")?" ":"";m+=y===_r?f+Yy:R>=0?(s.push(C),f.slice(0,R)+Bs+f.slice(R)+ln+S):f+ln+(R===-2?(s.push(void 0),c):S)}return[Hc(h,m+(h[n]||"<?>")+(r===2?"</svg>":"")),s]},_n=class{constructor({strings:r,_$litType$:n},s){let i;this.parts=[];let m=0,y=0,c=r.length-1,f=this.parts,[C,E]=Xy(r,n);if(this.el=_n.createElement(C,s),Rn.currentNode=this.el.content,n===2){let R=this.el.content,a=R.firstChild;a.remove(),R.append(...a.childNodes)}for(;(i=Rn.nextNode())!==null&&f.length<c;){if(i.nodeType===1){if(i.hasAttributes()){let R=[];for(let a of i.getAttributeNames())if(a.endsWith(Bs)||a.startsWith(ln)){let S=E[y++];if(R.push(a),S!==void 0){let M=i.getAttribute(S.toLowerCase()+Bs).split(ln),P=/([.?@])?(.*)/.exec(S);f.push({type:1,index:m,name:P[2],strings:M,ctor:P[1]==="."?Gs:P[1]==="?"?Hs:P[1]==="@"?ks:Xn})}else f.push({type:6,index:m})}for(let a of R)i.removeAttribute(a)}if(Bc.test(i.tagName)){let R=i.textContent.split(ln),a=R.length-1;if(a>0){i.textContent=Yn?Yn.emptyScript:"";for(let S=0;S<a;S++)i.append(R[S],Pr()),Rn.nextNode(),f.push({type:2,index:++m});i.append(R[a],Pr())}}}else if(i.nodeType===8)if(i.data===Dc)f.push({type:2,index:m});else{let R=-1;for(;(R=i.data.indexOf(ln,R+1))!==-1;)f.push({type:7,index:m}),R+=ln.length-1}m++}}static createElement(r,n){let s=Tn.createElement("template");return s.innerHTML=r,s}};function Zn(h,r,n=h,s){var i,m,y,c;if(r===In)return r;let f=s!==void 0?(i=n._$Co)===null||i===void 0?void 0:i[s]:n._$Cl,C=wr(r)?void 0:r._$litDirective$;return(f==null?void 0:f.constructor)!==C&&((m=f==null?void 0:f._$AO)===null||m===void 0||m.call(f,!1),C===void 0?f=void 0:(f=new C(h),f._$AT(h,n,s)),s!==void 0?((y=(c=n)._$Co)!==null&&y!==void 0?y:c._$Co=[])[s]=f:n._$Cl=f),f!==void 0&&(r=Zn(h,f._$AS(h,r.values),f,s)),r}var Fs=class{constructor(r,n){this._$AV=[],this._$AN=void 0,this._$AD=r,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(r){var n;let{el:{content:s},parts:i}=this._$AD,m=((n=r==null?void 0:r.creationScope)!==null&&n!==void 0?n:Tn).importNode(s,!0);Rn.currentNode=m;let y=Rn.nextNode(),c=0,f=0,C=i[0];for(;C!==void 0;){if(c===C.index){let E;C.type===2?E=new Pn(y,y.nextSibling,this,r):C.type===1?E=new C.ctor(y,C.name,C.strings,this,r):C.type===6&&(E=new Ws(y,this,r)),this._$AV.push(E),C=i[++f]}c!==(C==null?void 0:C.index)&&(y=Rn.nextNode(),c++)}return Rn.currentNode=Tn,m}v(r){let n=0;for(let s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(r,s,n),n+=s.strings.length-2):s._$AI(r[n])),n++}},Pn=class{constructor(r,n,s,i){var m;this.type=2,this._$AH=rt,this._$AN=void 0,this._$AA=r,this._$AB=n,this._$AM=s,this.options=i,this._$Cp=(m=i==null?void 0:i.isConnected)===null||m===void 0||m}get _$AU(){var r,n;return(n=(r=this._$AM)===null||r===void 0?void 0:r._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let r=this._$AA.parentNode,n=this._$AM;return n!==void 0&&(r==null?void 0:r.nodeType)===11&&(r=n.parentNode),r}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(r,n=this){r=Zn(this,r,n),wr(r)?r===rt||r==null||r===""?(this._$AH!==rt&&this._$AR(),this._$AH=rt):r!==this._$AH&&r!==In&&this._(r):r._$litType$!==void 0?this.g(r):r.nodeType!==void 0?this.$(r):Zy(r)?this.T(r):this._(r)}k(r){return this._$AA.parentNode.insertBefore(r,this._$AB)}$(r){this._$AH!==r&&(this._$AR(),this._$AH=this.k(r))}_(r){this._$AH!==rt&&wr(this._$AH)?this._$AA.nextSibling.data=r:this.$(Tn.createTextNode(r)),this._$AH=r}g(r){var n;let{values:s,_$litType$:i}=r,m=typeof i=="number"?this._$AC(r):(i.el===void 0&&(i.el=_n.createElement(Hc(i.h,i.h[0]),this.options)),i);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===m)this._$AH.v(s);else{let y=new Fs(m,this),c=y.u(this.options);y.v(s),this.$(c),this._$AH=y}}_$AC(r){let n=Lc.get(r.strings);return n===void 0&&Lc.set(r.strings,n=new _n(r)),n}T(r){Uc(this._$AH)||(this._$AH=[],this._$AR());let n=this._$AH,s,i=0;for(let m of r)i===n.length?n.push(s=new Pn(this.k(Pr()),this.k(Pr()),this,this.options)):s=n[i],s._$AI(m),i++;i<n.length&&(this._$AR(s&&s._$AB.nextSibling,i),n.length=i)}_$AR(r=this._$AA.nextSibling,n){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,n);r&&r!==this._$AB;){let i=r.nextSibling;r.remove(),r=i}}setConnected(r){var n;this._$AM===void 0&&(this._$Cp=r,(n=this._$AP)===null||n===void 0||n.call(this,r))}},Xn=class{constructor(r,n,s,i,m){this.type=1,this._$AH=rt,this._$AN=void 0,this.element=r,this.name=n,this._$AM=i,this.options=m,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=rt}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(r,n=this,s,i){let m=this.strings,y=!1;if(m===void 0)r=Zn(this,r,n,0),y=!wr(r)||r!==this._$AH&&r!==In,y&&(this._$AH=r);else{let c=r,f,C;for(r=m[0],f=0;f<m.length-1;f++)C=Zn(this,c[s+f],n,f),C===In&&(C=this._$AH[f]),y||(y=!wr(C)||C!==this._$AH[f]),C===rt?r=rt:r!==rt&&(r+=(C!=null?C:"")+m[f+1]),this._$AH[f]=C}y&&!i&&this.j(r)}j(r){r===rt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,r!=null?r:"")}},Gs=class extends Xn{constructor(){super(...arguments),this.type=3}j(r){this.element[this.name]=r===rt?void 0:r}},eb=Yn?Yn.emptyScript:"",Hs=class extends Xn{constructor(){super(...arguments),this.type=4}j(r){r&&r!==rt?this.element.setAttribute(this.name,eb):this.element.removeAttribute(this.name)}},ks=class extends Xn{constructor(r,n,s,i,m){super(r,n,s,i,m),this.type=5}_$AI(r,n=this){var s;if((r=(s=Zn(this,r,n,0))!==null&&s!==void 0?s:rt)===In)return;let i=this._$AH,m=r===rt&&i!==rt||r.capture!==i.capture||r.once!==i.once||r.passive!==i.passive,y=r!==rt&&(i===rt||m);m&&this.element.removeEventListener(this.name,this,i),y&&this.element.addEventListener(this.name,this,r),this._$AH=r}handleEvent(r){var n,s;typeof this._$AH=="function"?this._$AH.call((s=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&s!==void 0?s:this.element,r):this._$AH.handleEvent(r)}},Ws=class{constructor(r,n,s){this.element=r,this.type=6,this._$AN=void 0,this._$AM=n,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(r){Zn(this,r)}};var Nc=Bi.litHtmlPolyfillSupport;Nc==null||Nc(_n,Pn),((Ds=Bi.litHtmlVersions)!==null&&Ds!==void 0?Ds:Bi.litHtmlVersions=[]).push("2.7.5");var kc=(h,r,n)=>{var s,i;let m=(s=n==null?void 0:n.renderBefore)!==null&&s!==void 0?s:r,y=m._$litPart$;if(y===void 0){let c=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:null;m._$litPart$=y=new Pn(r.insertBefore(Pr(),c),c,void 0,n!=null?n:{})}return y._$AI(h),y};X();var zs,$s;var cn=class extends Qt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var r,n;let s=super.createRenderRoot();return(r=(n=this.renderOptions).renderBefore)!==null&&r!==void 0||(n.renderBefore=s.firstChild),s}update(r){let n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(r),this._$Do=kc(n,this.renderRoot,this.renderOptions)}connectedCallback(){var r;super.connectedCallback(),(r=this._$Do)===null||r===void 0||r.setConnected(!0)}disconnectedCallback(){var r;super.disconnectedCallback(),(r=this._$Do)===null||r===void 0||r.setConnected(!1)}render(){return In}};cn.finalized=!0,cn._$litElement$=!0,(zs=globalThis.litElementHydrateSupport)===null||zs===void 0||zs.call(globalThis,{LitElement:cn});var Wc=globalThis.litElementPolyfillSupport;Wc==null||Wc({LitElement:cn});(($s=globalThis.litElementVersions)!==null&&$s!==void 0?$s:globalThis.litElementVersions=[]).push("3.3.2");X();X();X();var zc=h=>r=>typeof r=="function"?((n,s)=>(customElements.define(n,s),s))(h,r):((n,s)=>{let{kind:i,elements:m}=s;return{kind:i,elements:m,finisher(y){customElements.define(n,y)}}})(h,r);X();X();X();X();X();X();X();X();var Vs,tO=((Vs=window.HTMLSlotElement)===null||Vs===void 0?void 0:Vs.prototype.assignedElements)!=null?(h,r)=>h.assignedElements(r):(h,r)=>h.assignedNodes(r).filter(n=>n.nodeType===Node.ELEMENT_NODE);X();var wn=class extends cn{render(){return Gc` <div>Hello from SuperViz, ${this.name}</div> `}};wn.properties={name:{type:String}},wn.styles=Ps`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,wn=Tl([zc("superviz-hello-world")],wn);X();X();function $c(h){if(typeof document!="undefined"){let r=document.createElement("style");r.id="superviz-style";let n=document.createTextNode(h);r.appendChild(n),document.head.appendChild(r)}}var Vc=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";
`;$c(Vc);X();X();X();window&&(window.SuperVizSdk={init:Is,MeetingEvent:mr,DeviceEvent:us,RealtimeEvent:On,MeetingState:Ai,MeetingConnectionStatus:yr,MeetingControlsEvent:as,ParticipantEvent:Ci,VideoComponent:Er});var MO=Is;export{Or as BrowserService,us as DeviceEvent,yr as MeetingConnectionStatus,as as MeetingControlsEvent,mr as MeetingEvent,Ai as MeetingState,Ci as ParticipantEvent,ys as ParticipantType,On as RealtimeEvent,MO as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
