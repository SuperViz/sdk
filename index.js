var nC=Object.create;var po=Object.defineProperty,iC=Object.defineProperties,Zh=Object.getOwnPropertyDescriptor,rC=Object.getOwnPropertyDescriptors,oC=Object.getOwnPropertyNames,la=Object.getOwnPropertySymbols,sC=Object.getPrototypeOf,Pu=Object.prototype.hasOwnProperty,Yh=Object.prototype.propertyIsEnumerable;var Qh=Math.pow,qh=(s,e,t)=>e in s?po(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,lt=(s,e)=>{for(var t in e||(e={}))Pu.call(e,t)&&qh(s,t,e[t]);if(la)for(var t of la(e))Yh.call(e,t)&&qh(s,t,e[t]);return s},_t=(s,e)=>iC(s,rC(e));var xu=(s,e)=>{var t={};for(var i in s)Pu.call(s,i)&&e.indexOf(i)<0&&(t[i]=s[i]);if(s!=null&&la)for(var i of la(s))e.indexOf(i)<0&&Yh.call(s,i)&&(t[i]=s[i]);return t};var Iu=(s,e)=>()=>(s&&(e=s(s=0)),e);var ye=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Xh=(s,e)=>{for(var t in e)po(s,t,{get:e[t],enumerable:!0})},aC=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of oC(e))!Pu.call(s,r)&&r!==t&&po(s,r,{get:()=>e[r],enumerable:!(i=Zh(e,r))||i.enumerable});return s};var pn=(s,e,t)=>(t=s!=null?nC(sC(s)):{},aC(e||!s||!s.__esModule?po(t,"default",{value:s,enumerable:!0}):t,s));var $t=(s,e,t,i)=>{for(var r=i>1?void 0:i?Zh(e,t):e,a=s.length-1,l;a>=0;a--)(l=s[a])&&(r=(i?l(e,t,r):l(r))||r);return i&&r&&po(e,t,r),r};var Lt=(s,e,t)=>new Promise((i,r)=>{var a=c=>{try{u(t.next(c))}catch(m){r(m)}},l=c=>{try{u(t.throw(c))}catch(m){r(m)}},u=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,l);u((t=t.apply(s,e)).next())});var Y,D=Iu(()=>{Y={}});var ep=ye((UP,tp)=>{D();var Tr=1e3,Or=Tr*60,Cr=Or*60,Ti=Cr*24,uC=Ti*7,cC=Ti*365.25;tp.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return dC(s);if(t==="number"&&isFinite(s))return e.long?hC(s):fC(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function dC(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!e){var t=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return t*cC;case"weeks":case"week":case"w":return t*uC;case"days":case"day":case"d":return t*Ti;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Cr;case"minutes":case"minute":case"mins":case"min":case"m":return t*Or;case"seconds":case"second":case"secs":case"sec":case"s":return t*Tr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function fC(s){var e=Math.abs(s);return e>=Ti?Math.round(s/Ti)+"d":e>=Cr?Math.round(s/Cr)+"h":e>=Or?Math.round(s/Or)+"m":e>=Tr?Math.round(s/Tr)+"s":s+"ms"}function hC(s){var e=Math.abs(s);return e>=Ti?fa(s,e,Ti,"day"):e>=Cr?fa(s,e,Cr,"hour"):e>=Or?fa(s,e,Or,"minute"):e>=Tr?fa(s,e,Tr,"second"):s+" ms"}function fa(s,e,t,i){var r=e>=t*1.5;return Math.round(s/t)+" "+i+(r?"s":"")}});var ip=ye((BP,np)=>{D();function pC(s){t.debug=t,t.default=t,t.coerce=c,t.disable=a,t.enable=r,t.enabled=l,t.humanize=ep(),t.destroy=m,Object.keys(s).forEach(v=>{t[v]=s[v]}),t.names=[],t.skips=[],t.formatters={};function e(v){let E=0;for(let h=0;h<v.length;h++)E=(E<<5)-E+v.charCodeAt(h),E|=0;return t.colors[Math.abs(E)%t.colors.length]}t.selectColor=e;function t(v){let E,h=null,b,w;function P(...C){if(!P.enabled)return;let O=P,x=Number(new Date),g=x-(E||x);O.diff=g,O.prev=E,O.curr=x,E=x,C[0]=t.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let A=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(p,S)=>{if(p==="%%")return"%";A++;let y=t.formatters[S];if(typeof y=="function"){let I=C[A];p=y.call(O,I),C.splice(A,1),A--}return p}),t.formatArgs.call(O,C),(O.log||t.log).apply(O,C)}return P.namespace=v,P.useColors=t.useColors(),P.color=t.selectColor(v),P.extend=i,P.destroy=t.destroy,Object.defineProperty(P,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(b!==t.namespaces&&(b=t.namespaces,w=t.enabled(v)),w),set:C=>{h=C}}),typeof t.init=="function"&&t.init(P),P}function i(v,E){let h=t(this.namespace+(typeof E=="undefined"?":":E)+v);return h.log=this.log,h}function r(v){t.save(v),t.namespaces=v,t.names=[],t.skips=[];let E,h=(typeof v=="string"?v:"").split(/[\s,]+/),b=h.length;for(E=0;E<b;E++)!h[E]||(v=h[E].replace(/\*/g,".*?"),v[0]==="-"?t.skips.push(new RegExp("^"+v.slice(1)+"$")):t.names.push(new RegExp("^"+v+"$")))}function a(){let v=[...t.names.map(u),...t.skips.map(u).map(E=>"-"+E)].join(",");return t.enable(""),v}function l(v){if(v[v.length-1]==="*")return!0;let E,h;for(E=0,h=t.skips.length;E<h;E++)if(t.skips[E].test(v))return!1;for(E=0,h=t.names.length;E<h;E++)if(t.names[E].test(v))return!0;return!1}function u(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}function c(v){return v instanceof Error?v.stack||v.message:v}function m(){}return t.enable(t.load()),t}np.exports=pC});var Ru=ye((Ke,ha)=>{D();Ke.formatArgs=gC;Ke.save=vC;Ke.load=yC;Ke.useColors=mC;Ke.storage=bC();Ke.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Ke.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function mC(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function gC(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+ha.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,i=0;s[0].replace(/%[a-zA-Z%]/g,r=>{r!=="%%"&&(t++,r==="%c"&&(i=t))}),s.splice(i,0,e)}Ke.log=console.debug||console.log||(()=>{});function vC(s){try{s?Ke.storage.setItem("debug",s):Ke.storage.removeItem("debug")}catch(e){}}function yC(){let s;try{s=Ke.storage.getItem("debug")}catch(e){}return!s&&typeof process!="undefined"&&"env"in process&&(s=Y.DEBUG),s}function bC(){try{return localStorage}catch(s){}}ha.exports=ip()(Ke);var{formatters:EC}=ha.exports;EC.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var pa=ye(($P,op)=>{D();function AC(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}op.exports=AC});var ap=ye((HP,sp)=>{D();var TC=typeof global=="object"&&global&&global.Object===Object&&global;sp.exports=TC});var _u=ye((GP,lp)=>{D();var OC=ap(),CC=typeof self=="object"&&self&&self.Object===Object&&self,SC=OC||CC||Function("return this")();lp.exports=SC});var cp=ye((WP,up)=>{D();var wC=_u(),PC=function(){return wC.Date.now()};up.exports=PC});var fp=ye((zP,dp)=>{D();var xC=/\s/;function IC(s){for(var e=s.length;e--&&xC.test(s.charAt(e)););return e}dp.exports=IC});var pp=ye((VP,hp)=>{D();var MC=fp(),RC=/^\s+/;function _C(s){return s&&s.slice(0,MC(s)+1).replace(RC,"")}hp.exports=_C});var Lu=ye((jP,mp)=>{D();var LC=_u(),DC=LC.Symbol;mp.exports=DC});var bp=ye((JP,yp)=>{D();var gp=Lu(),vp=Object.prototype,NC=vp.hasOwnProperty,FC=vp.toString,yo=gp?gp.toStringTag:void 0;function UC(s){var e=NC.call(s,yo),t=s[yo];try{s[yo]=void 0;var i=!0}catch(a){}var r=FC.call(s);return i&&(e?s[yo]=t:delete s[yo]),r}yp.exports=UC});var Ap=ye((KP,Ep)=>{D();var BC=Object.prototype,kC=BC.toString;function $C(s){return kC.call(s)}Ep.exports=$C});var Sp=ye((qP,Cp)=>{D();var Tp=Lu(),HC=bp(),GC=Ap(),WC="[object Null]",zC="[object Undefined]",Op=Tp?Tp.toStringTag:void 0;function VC(s){return s==null?s===void 0?zC:WC:Op&&Op in Object(s)?HC(s):GC(s)}Cp.exports=VC});var Pp=ye((ZP,wp)=>{D();function jC(s){return s!=null&&typeof s=="object"}wp.exports=jC});var Ip=ye((YP,xp)=>{D();var JC=Sp(),KC=Pp(),qC="[object Symbol]";function ZC(s){return typeof s=="symbol"||KC(s)&&JC(s)==qC}xp.exports=ZC});var Lp=ye((QP,_p)=>{D();var YC=pp(),Mp=pa(),QC=Ip(),Rp=0/0,XC=/^[-+]0x[0-9a-f]+$/i,tS=/^0b[01]+$/i,eS=/^0o[0-7]+$/i,nS=parseInt;function iS(s){if(typeof s=="number")return s;if(QC(s))return Rp;if(Mp(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=Mp(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=YC(s);var t=tS.test(s);return t||eS.test(s)?nS(s.slice(2),t?2:8):XC.test(s)?Rp:+s}_p.exports=iS});var Fp=ye((XP,Np)=>{D();var rS=pa(),Du=cp(),Dp=Lp(),oS="Expected a function",sS=Math.max,aS=Math.min;function lS(s,e,t){var i,r,a,l,u,c,m=0,v=!1,E=!1,h=!0;if(typeof s!="function")throw new TypeError(oS);e=Dp(e)||0,rS(t)&&(v=!!t.leading,E="maxWait"in t,a=E?sS(Dp(t.maxWait)||0,e):a,h="trailing"in t?!!t.trailing:h);function b(p){var S=i,y=r;return i=r=void 0,m=p,l=s.apply(y,S),l}function w(p){return m=p,u=setTimeout(O,e),v?b(p):l}function P(p){var S=p-c,y=p-m,I=e-S;return E?aS(I,a-y):I}function C(p){var S=p-c,y=p-m;return c===void 0||S>=e||S<0||E&&y>=a}function O(){var p=Du();if(C(p))return x(p);u=setTimeout(O,P(p))}function x(p){return u=void 0,h&&i?b(p):(i=r=void 0,l)}function g(){u!==void 0&&clearTimeout(u),m=0,i=c=r=u=void 0}function A(){return u===void 0?l:x(Du())}function f(){var p=Du(),S=C(p);if(i=arguments,r=this,c=p,S){if(u===void 0)return w(c);if(E)return clearTimeout(u),u=setTimeout(O,e),b(c)}return u===void 0&&(u=setTimeout(O,e)),l}return f.cancel=g,f.flush=A,f}Np.exports=lS});var Nu=ye((tx,Up)=>{D();var uS=Fp(),cS=pa(),dS="Expected a function";function fS(s,e,t){var i=!0,r=!0;if(typeof s!="function")throw new TypeError(dS);return cS(t)&&(i="leading"in t?!!t.leading:i,r="trailing"in t?!!t.trailing:r),uS(s,e,{leading:i,maxWait:e,trailing:r})}Up.exports=fS});var wr=ye((Sr,bo)=>{D();(function(){var s,e="4.17.21",t=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",r="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",u=500,c="__lodash_placeholder__",m=1,v=2,E=4,h=1,b=2,w=1,P=2,C=4,O=8,x=16,g=32,A=64,f=128,p=256,S=512,y=30,I="...",F=800,z=16,W=1,N=2,R=3,L=1/0,$=9007199254740991,G=17976931348623157e292,J=0/0,tt=4294967295,it=tt-1,X=tt>>>1,_=[["ary",f],["bind",w],["bindKey",P],["curry",O],["curryRight",x],["flip",S],["partial",g],["partialRight",A],["rearg",p]],B="[object Arguments]",H="[object Array]",j="[object AsyncFunction]",et="[object Boolean]",dt="[object Date]",gt="[object DOMException]",Et="[object Error]",Ct="[object Function]",zt="[object GeneratorFunction]",ht="[object Map]",Yt="[object Number]",be="[object Null]",oe="[object Object]",he="[object Promise]",un="[object Proxy]",bn="[object RegExp]",le="[object Set]",En="[object String]",jn="[object Symbol]",Yr="[object Undefined]",fi="[object WeakMap]",cl="[object WeakSet]",q="[object ArrayBuffer]",ot="[object DataView]",ct="[object Float32Array]",yt="[object Float64Array]",Ft="[object Int8Array]",Oe="[object Int16Array]",In="[object Int32Array]",dl="[object Uint8Array]",fl="[object Uint8ClampedArray]",hl="[object Uint16Array]",pl="[object Uint32Array]",Ov=/\b__p \+= '';/g,Cv=/\b(__p \+=) '' \+/g,Sv=/(__e\(.*?\)|\b__t\)) \+\n'';/g,bd=/&(?:amp|lt|gt|quot|#39);/g,Ed=/[&<>"']/g,wv=RegExp(bd.source),Pv=RegExp(Ed.source),xv=/<%-([\s\S]+?)%>/g,Iv=/<%([\s\S]+?)%>/g,Ad=/<%=([\s\S]+?)%>/g,Mv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Rv=/^\w*$/,_v=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ml=/[\\^$.*+?()[\]{}|]/g,Lv=RegExp(ml.source),gl=/^\s+/,Dv=/\s/,Nv=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Fv=/\{\n\/\* \[wrapped with (.+)\] \*/,Uv=/,? & /,Bv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,kv=/[()=,{}\[\]\/\s]/,$v=/\\(\\)?/g,Hv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Td=/\w*$/,Gv=/^[-+]0x[0-9a-f]+$/i,Wv=/^0b[01]+$/i,zv=/^\[object .+?Constructor\]$/,Vv=/^0o[0-7]+$/i,jv=/^(?:0|[1-9]\d*)$/,Jv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Es=/($^)/,Kv=/['\n\r\u2028\u2029\\]/g,As="\\ud800-\\udfff",qv="\\u0300-\\u036f",Zv="\\ufe20-\\ufe2f",Yv="\\u20d0-\\u20ff",Od=qv+Zv+Yv,Cd="\\u2700-\\u27bf",Sd="a-z\\xdf-\\xf6\\xf8-\\xff",Qv="\\xac\\xb1\\xd7\\xf7",Xv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ty="\\u2000-\\u206f",ey=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wd="A-Z\\xc0-\\xd6\\xd8-\\xde",Pd="\\ufe0e\\ufe0f",xd=Qv+Xv+ty+ey,vl="['\u2019]",ny="["+As+"]",Id="["+xd+"]",Ts="["+Od+"]",Md="\\d+",iy="["+Cd+"]",Rd="["+Sd+"]",_d="[^"+As+xd+Md+Cd+Sd+wd+"]",yl="\\ud83c[\\udffb-\\udfff]",ry="(?:"+Ts+"|"+yl+")",Ld="[^"+As+"]",bl="(?:\\ud83c[\\udde6-\\uddff]){2}",El="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+wd+"]",Dd="\\u200d",Nd="(?:"+Rd+"|"+_d+")",oy="(?:"+lr+"|"+_d+")",Fd="(?:"+vl+"(?:d|ll|m|re|s|t|ve))?",Ud="(?:"+vl+"(?:D|LL|M|RE|S|T|VE))?",Bd=ry+"?",kd="["+Pd+"]?",sy="(?:"+Dd+"(?:"+[Ld,bl,El].join("|")+")"+kd+Bd+")*",ay="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ly="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$d=kd+Bd+sy,uy="(?:"+[iy,bl,El].join("|")+")"+$d,cy="(?:"+[Ld+Ts+"?",Ts,bl,El,ny].join("|")+")",dy=RegExp(vl,"g"),fy=RegExp(Ts,"g"),Al=RegExp(yl+"(?="+yl+")|"+cy+$d,"g"),hy=RegExp([lr+"?"+Rd+"+"+Fd+"(?="+[Id,lr,"$"].join("|")+")",oy+"+"+Ud+"(?="+[Id,lr+Nd,"$"].join("|")+")",lr+"?"+Nd+"+"+Fd,lr+"+"+Ud,ly,ay,Md,uy].join("|"),"g"),py=RegExp("["+Dd+As+Od+Pd+"]"),my=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,gy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],vy=-1,se={};se[ct]=se[yt]=se[Ft]=se[Oe]=se[In]=se[dl]=se[fl]=se[hl]=se[pl]=!0,se[B]=se[H]=se[q]=se[et]=se[ot]=se[dt]=se[Et]=se[Ct]=se[ht]=se[Yt]=se[oe]=se[bn]=se[le]=se[En]=se[fi]=!1;var re={};re[B]=re[H]=re[q]=re[ot]=re[et]=re[dt]=re[ct]=re[yt]=re[Ft]=re[Oe]=re[In]=re[ht]=re[Yt]=re[oe]=re[bn]=re[le]=re[En]=re[jn]=re[dl]=re[fl]=re[hl]=re[pl]=!0,re[Et]=re[Ct]=re[fi]=!1;var yy={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},by={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ey={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ay={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ty=parseFloat,Oy=parseInt,Hd=typeof global=="object"&&global&&global.Object===Object&&global,Cy=typeof self=="object"&&self&&self.Object===Object&&self,Ce=Hd||Cy||Function("return this")(),Tl=typeof Sr=="object"&&Sr&&!Sr.nodeType&&Sr,hi=Tl&&typeof bo=="object"&&bo&&!bo.nodeType&&bo,Gd=hi&&hi.exports===Tl,Ol=Gd&&Hd.process,Ze=function(){try{var Z=hi&&hi.require&&hi.require("util").types;return Z||Ol&&Ol.binding&&Ol.binding("util")}catch(rt){}}(),Wd=Ze&&Ze.isArrayBuffer,zd=Ze&&Ze.isDate,Vd=Ze&&Ze.isMap,jd=Ze&&Ze.isRegExp,Jd=Ze&&Ze.isSet,Kd=Ze&&Ze.isTypedArray;function Ge(Z,rt,nt){switch(nt.length){case 0:return Z.call(rt);case 1:return Z.call(rt,nt[0]);case 2:return Z.call(rt,nt[0],nt[1]);case 3:return Z.call(rt,nt[0],nt[1],nt[2])}return Z.apply(rt,nt)}function Sy(Z,rt,nt,vt){for(var Mt=-1,Kt=Z==null?0:Z.length;++Mt<Kt;){var Ee=Z[Mt];rt(vt,Ee,nt(Ee),Z)}return vt}function Ye(Z,rt){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt&&rt(Z[nt],nt,Z)!==!1;);return Z}function wy(Z,rt){for(var nt=Z==null?0:Z.length;nt--&&rt(Z[nt],nt,Z)!==!1;);return Z}function qd(Z,rt){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt;)if(!rt(Z[nt],nt,Z))return!1;return!0}function Jn(Z,rt){for(var nt=-1,vt=Z==null?0:Z.length,Mt=0,Kt=[];++nt<vt;){var Ee=Z[nt];rt(Ee,nt,Z)&&(Kt[Mt++]=Ee)}return Kt}function Os(Z,rt){var nt=Z==null?0:Z.length;return!!nt&&ur(Z,rt,0)>-1}function Cl(Z,rt,nt){for(var vt=-1,Mt=Z==null?0:Z.length;++vt<Mt;)if(nt(rt,Z[vt]))return!0;return!1}function ae(Z,rt){for(var nt=-1,vt=Z==null?0:Z.length,Mt=Array(vt);++nt<vt;)Mt[nt]=rt(Z[nt],nt,Z);return Mt}function Kn(Z,rt){for(var nt=-1,vt=rt.length,Mt=Z.length;++nt<vt;)Z[Mt+nt]=rt[nt];return Z}function Sl(Z,rt,nt,vt){var Mt=-1,Kt=Z==null?0:Z.length;for(vt&&Kt&&(nt=Z[++Mt]);++Mt<Kt;)nt=rt(nt,Z[Mt],Mt,Z);return nt}function Py(Z,rt,nt,vt){var Mt=Z==null?0:Z.length;for(vt&&Mt&&(nt=Z[--Mt]);Mt--;)nt=rt(nt,Z[Mt],Mt,Z);return nt}function wl(Z,rt){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt;)if(rt(Z[nt],nt,Z))return!0;return!1}var xy=Pl("length");function Iy(Z){return Z.split("")}function My(Z){return Z.match(Bv)||[]}function Zd(Z,rt,nt){var vt;return nt(Z,function(Mt,Kt,Ee){if(rt(Mt,Kt,Ee))return vt=Kt,!1}),vt}function Cs(Z,rt,nt,vt){for(var Mt=Z.length,Kt=nt+(vt?1:-1);vt?Kt--:++Kt<Mt;)if(rt(Z[Kt],Kt,Z))return Kt;return-1}function ur(Z,rt,nt){return rt===rt?Gy(Z,rt,nt):Cs(Z,Yd,nt)}function Ry(Z,rt,nt,vt){for(var Mt=nt-1,Kt=Z.length;++Mt<Kt;)if(vt(Z[Mt],rt))return Mt;return-1}function Yd(Z){return Z!==Z}function Qd(Z,rt){var nt=Z==null?0:Z.length;return nt?Il(Z,rt)/nt:J}function Pl(Z){return function(rt){return rt==null?s:rt[Z]}}function xl(Z){return function(rt){return Z==null?s:Z[rt]}}function Xd(Z,rt,nt,vt,Mt){return Mt(Z,function(Kt,Ee,ne){nt=vt?(vt=!1,Kt):rt(nt,Kt,Ee,ne)}),nt}function _y(Z,rt){var nt=Z.length;for(Z.sort(rt);nt--;)Z[nt]=Z[nt].value;return Z}function Il(Z,rt){for(var nt,vt=-1,Mt=Z.length;++vt<Mt;){var Kt=rt(Z[vt]);Kt!==s&&(nt=nt===s?Kt:nt+Kt)}return nt}function Ml(Z,rt){for(var nt=-1,vt=Array(Z);++nt<Z;)vt[nt]=rt(nt);return vt}function Ly(Z,rt){return ae(rt,function(nt){return[nt,Z[nt]]})}function tf(Z){return Z&&Z.slice(0,of(Z)+1).replace(gl,"")}function We(Z){return function(rt){return Z(rt)}}function Rl(Z,rt){return ae(rt,function(nt){return Z[nt]})}function Qr(Z,rt){return Z.has(rt)}function ef(Z,rt){for(var nt=-1,vt=Z.length;++nt<vt&&ur(rt,Z[nt],0)>-1;);return nt}function nf(Z,rt){for(var nt=Z.length;nt--&&ur(rt,Z[nt],0)>-1;);return nt}function Dy(Z,rt){for(var nt=Z.length,vt=0;nt--;)Z[nt]===rt&&++vt;return vt}var Ny=xl(yy),Fy=xl(by);function Uy(Z){return"\\"+Ay[Z]}function By(Z,rt){return Z==null?s:Z[rt]}function cr(Z){return py.test(Z)}function ky(Z){return my.test(Z)}function $y(Z){for(var rt,nt=[];!(rt=Z.next()).done;)nt.push(rt.value);return nt}function _l(Z){var rt=-1,nt=Array(Z.size);return Z.forEach(function(vt,Mt){nt[++rt]=[Mt,vt]}),nt}function rf(Z,rt){return function(nt){return Z(rt(nt))}}function qn(Z,rt){for(var nt=-1,vt=Z.length,Mt=0,Kt=[];++nt<vt;){var Ee=Z[nt];(Ee===rt||Ee===c)&&(Z[nt]=c,Kt[Mt++]=nt)}return Kt}function Ss(Z){var rt=-1,nt=Array(Z.size);return Z.forEach(function(vt){nt[++rt]=vt}),nt}function Hy(Z){var rt=-1,nt=Array(Z.size);return Z.forEach(function(vt){nt[++rt]=[vt,vt]}),nt}function Gy(Z,rt,nt){for(var vt=nt-1,Mt=Z.length;++vt<Mt;)if(Z[vt]===rt)return vt;return-1}function Wy(Z,rt,nt){for(var vt=nt+1;vt--;)if(Z[vt]===rt)return vt;return vt}function dr(Z){return cr(Z)?Vy(Z):xy(Z)}function cn(Z){return cr(Z)?jy(Z):Iy(Z)}function of(Z){for(var rt=Z.length;rt--&&Dv.test(Z.charAt(rt)););return rt}var zy=xl(Ey);function Vy(Z){for(var rt=Al.lastIndex=0;Al.test(Z);)++rt;return rt}function jy(Z){return Z.match(Al)||[]}function Jy(Z){return Z.match(hy)||[]}var Ky=function Z(rt){rt=rt==null?Ce:Zn.defaults(Ce.Object(),rt,Zn.pick(Ce,gy));var nt=rt.Array,vt=rt.Date,Mt=rt.Error,Kt=rt.Function,Ee=rt.Math,ne=rt.Object,Ll=rt.RegExp,qy=rt.String,Qe=rt.TypeError,ws=nt.prototype,Zy=Kt.prototype,fr=ne.prototype,Ps=rt["__core-js_shared__"],xs=Zy.toString,te=fr.hasOwnProperty,Yy=0,sf=function(){var n=/[^.]+$/.exec(Ps&&Ps.keys&&Ps.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),Is=fr.toString,Qy=xs.call(ne),Xy=Ce._,t0=Ll("^"+xs.call(te).replace(ml,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ms=Gd?rt.Buffer:s,Yn=rt.Symbol,Rs=rt.Uint8Array,af=Ms?Ms.allocUnsafe:s,_s=rf(ne.getPrototypeOf,ne),lf=ne.create,uf=fr.propertyIsEnumerable,Ls=ws.splice,cf=Yn?Yn.isConcatSpreadable:s,Xr=Yn?Yn.iterator:s,pi=Yn?Yn.toStringTag:s,Ds=function(){try{var n=bi(ne,"defineProperty");return n({},"",{}),n}catch(o){}}(),e0=rt.clearTimeout!==Ce.clearTimeout&&rt.clearTimeout,n0=vt&&vt.now!==Ce.Date.now&&vt.now,i0=rt.setTimeout!==Ce.setTimeout&&rt.setTimeout,Ns=Ee.ceil,Fs=Ee.floor,Dl=ne.getOwnPropertySymbols,r0=Ms?Ms.isBuffer:s,df=rt.isFinite,o0=ws.join,s0=rf(ne.keys,ne),Ae=Ee.max,_e=Ee.min,a0=vt.now,l0=rt.parseInt,ff=Ee.random,u0=ws.reverse,Nl=bi(rt,"DataView"),to=bi(rt,"Map"),Fl=bi(rt,"Promise"),hr=bi(rt,"Set"),eo=bi(rt,"WeakMap"),no=bi(ne,"create"),Us=eo&&new eo,pr={},c0=Ei(Nl),d0=Ei(to),f0=Ei(Fl),h0=Ei(hr),p0=Ei(eo),Bs=Yn?Yn.prototype:s,io=Bs?Bs.valueOf:s,hf=Bs?Bs.toString:s;function U(n){if(pe(n)&&!Rt(n)&&!(n instanceof Vt)){if(n instanceof Xe)return n;if(te.call(n,"__wrapped__"))return ph(n)}return new Xe(n)}var mr=function(){function n(){}return function(o){if(!ue(o))return{};if(lf)return lf(o);n.prototype=o;var d=new n;return n.prototype=s,d}}();function ks(){}function Xe(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=s}U.templateSettings={escape:xv,evaluate:Iv,interpolate:Ad,variable:"",imports:{_:U}},U.prototype=ks.prototype,U.prototype.constructor=U,Xe.prototype=mr(ks.prototype),Xe.prototype.constructor=Xe;function Vt(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function m0(){var n=new Vt(this.__wrapped__);return n.__actions__=Ue(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ue(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ue(this.__views__),n}function g0(){if(this.__filtered__){var n=new Vt(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function v0(){var n=this.__wrapped__.value(),o=this.__dir__,d=Rt(n),T=o<0,M=d?n.length:0,k=Ib(0,M,this.__views__),V=k.start,K=k.end,Q=K-V,st=T?K:V-1,at=this.__iteratees__,ut=at.length,pt=0,bt=_e(Q,this.__takeCount__);if(!d||!T&&M==Q&&bt==Q)return Uf(n,this.__actions__);var wt=[];t:for(;Q--&&pt<bt;){st+=o;for(var Ut=-1,Pt=n[st];++Ut<ut;){var Gt=at[Ut],jt=Gt.iteratee,je=Gt.type,Fe=jt(Pt);if(je==N)Pt=Fe;else if(!Fe){if(je==W)continue t;break t}}wt[pt++]=Pt}return wt}Vt.prototype=mr(ks.prototype),Vt.prototype.constructor=Vt;function mi(n){var o=-1,d=n==null?0:n.length;for(this.clear();++o<d;){var T=n[o];this.set(T[0],T[1])}}function y0(){this.__data__=no?no(null):{},this.size=0}function b0(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function E0(n){var o=this.__data__;if(no){var d=o[n];return d===l?s:d}return te.call(o,n)?o[n]:s}function A0(n){var o=this.__data__;return no?o[n]!==s:te.call(o,n)}function T0(n,o){var d=this.__data__;return this.size+=this.has(n)?0:1,d[n]=no&&o===s?l:o,this}mi.prototype.clear=y0,mi.prototype.delete=b0,mi.prototype.get=E0,mi.prototype.has=A0,mi.prototype.set=T0;function Mn(n){var o=-1,d=n==null?0:n.length;for(this.clear();++o<d;){var T=n[o];this.set(T[0],T[1])}}function O0(){this.__data__=[],this.size=0}function C0(n){var o=this.__data__,d=$s(o,n);if(d<0)return!1;var T=o.length-1;return d==T?o.pop():Ls.call(o,d,1),--this.size,!0}function S0(n){var o=this.__data__,d=$s(o,n);return d<0?s:o[d][1]}function w0(n){return $s(this.__data__,n)>-1}function P0(n,o){var d=this.__data__,T=$s(d,n);return T<0?(++this.size,d.push([n,o])):d[T][1]=o,this}Mn.prototype.clear=O0,Mn.prototype.delete=C0,Mn.prototype.get=S0,Mn.prototype.has=w0,Mn.prototype.set=P0;function Rn(n){var o=-1,d=n==null?0:n.length;for(this.clear();++o<d;){var T=n[o];this.set(T[0],T[1])}}function x0(){this.size=0,this.__data__={hash:new mi,map:new(to||Mn),string:new mi}}function I0(n){var o=Qs(this,n).delete(n);return this.size-=o?1:0,o}function M0(n){return Qs(this,n).get(n)}function R0(n){return Qs(this,n).has(n)}function _0(n,o){var d=Qs(this,n),T=d.size;return d.set(n,o),this.size+=d.size==T?0:1,this}Rn.prototype.clear=x0,Rn.prototype.delete=I0,Rn.prototype.get=M0,Rn.prototype.has=R0,Rn.prototype.set=_0;function gi(n){var o=-1,d=n==null?0:n.length;for(this.__data__=new Rn;++o<d;)this.add(n[o])}function L0(n){return this.__data__.set(n,l),this}function D0(n){return this.__data__.has(n)}gi.prototype.add=gi.prototype.push=L0,gi.prototype.has=D0;function dn(n){var o=this.__data__=new Mn(n);this.size=o.size}function N0(){this.__data__=new Mn,this.size=0}function F0(n){var o=this.__data__,d=o.delete(n);return this.size=o.size,d}function U0(n){return this.__data__.get(n)}function B0(n){return this.__data__.has(n)}function k0(n,o){var d=this.__data__;if(d instanceof Mn){var T=d.__data__;if(!to||T.length<t-1)return T.push([n,o]),this.size=++d.size,this;d=this.__data__=new Rn(T)}return d.set(n,o),this.size=d.size,this}dn.prototype.clear=N0,dn.prototype.delete=F0,dn.prototype.get=U0,dn.prototype.has=B0,dn.prototype.set=k0;function pf(n,o){var d=Rt(n),T=!d&&Ai(n),M=!d&&!T&&ni(n),k=!d&&!T&&!M&&br(n),V=d||T||M||k,K=V?Ml(n.length,qy):[],Q=K.length;for(var st in n)(o||te.call(n,st))&&!(V&&(st=="length"||M&&(st=="offset"||st=="parent")||k&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||Nn(st,Q)))&&K.push(st);return K}function mf(n){var o=n.length;return o?n[Jl(0,o-1)]:s}function $0(n,o){return Xs(Ue(n),vi(o,0,n.length))}function H0(n){return Xs(Ue(n))}function Ul(n,o,d){(d!==s&&!fn(n[o],d)||d===s&&!(o in n))&&_n(n,o,d)}function ro(n,o,d){var T=n[o];(!(te.call(n,o)&&fn(T,d))||d===s&&!(o in n))&&_n(n,o,d)}function $s(n,o){for(var d=n.length;d--;)if(fn(n[d][0],o))return d;return-1}function G0(n,o,d,T){return Qn(n,function(M,k,V){o(T,M,d(M),V)}),T}function gf(n,o){return n&&Tn(o,Se(o),n)}function W0(n,o){return n&&Tn(o,ke(o),n)}function _n(n,o,d){o=="__proto__"&&Ds?Ds(n,o,{configurable:!0,enumerable:!0,value:d,writable:!0}):n[o]=d}function Bl(n,o){for(var d=-1,T=o.length,M=nt(T),k=n==null;++d<T;)M[d]=k?s:yu(n,o[d]);return M}function vi(n,o,d){return n===n&&(d!==s&&(n=n<=d?n:d),o!==s&&(n=n>=o?n:o)),n}function tn(n,o,d,T,M,k){var V,K=o&m,Q=o&v,st=o&E;if(d&&(V=M?d(n,T,M,k):d(n)),V!==s)return V;if(!ue(n))return n;var at=Rt(n);if(at){if(V=Rb(n),!K)return Ue(n,V)}else{var ut=Le(n),pt=ut==Ct||ut==zt;if(ni(n))return $f(n,K);if(ut==oe||ut==B||pt&&!M){if(V=Q||pt?{}:oh(n),!K)return Q?Eb(n,W0(V,n)):bb(n,gf(V,n))}else{if(!re[ut])return M?n:{};V=_b(n,ut,K)}}k||(k=new dn);var bt=k.get(n);if(bt)return bt;k.set(n,V),Dh(n)?n.forEach(function(Pt){V.add(tn(Pt,o,d,Pt,n,k))}):_h(n)&&n.forEach(function(Pt,Gt){V.set(Gt,tn(Pt,o,d,Gt,n,k))});var wt=st?Q?ru:iu:Q?ke:Se,Ut=at?s:wt(n);return Ye(Ut||n,function(Pt,Gt){Ut&&(Gt=Pt,Pt=n[Gt]),ro(V,Gt,tn(Pt,o,d,Gt,n,k))}),V}function z0(n){var o=Se(n);return function(d){return vf(d,n,o)}}function vf(n,o,d){var T=d.length;if(n==null)return!T;for(n=ne(n);T--;){var M=d[T],k=o[M],V=n[M];if(V===s&&!(M in n)||!k(V))return!1}return!0}function yf(n,o,d){if(typeof n!="function")throw new Qe(r);return fo(function(){n.apply(s,d)},o)}function oo(n,o,d,T){var M=-1,k=Os,V=!0,K=n.length,Q=[],st=o.length;if(!K)return Q;d&&(o=ae(o,We(d))),T?(k=Cl,V=!1):o.length>=t&&(k=Qr,V=!1,o=new gi(o));t:for(;++M<K;){var at=n[M],ut=d==null?at:d(at);if(at=T||at!==0?at:0,V&&ut===ut){for(var pt=st;pt--;)if(o[pt]===ut)continue t;Q.push(at)}else k(o,ut,T)||Q.push(at)}return Q}var Qn=Vf(An),bf=Vf($l,!0);function V0(n,o){var d=!0;return Qn(n,function(T,M,k){return d=!!o(T,M,k),d}),d}function Hs(n,o,d){for(var T=-1,M=n.length;++T<M;){var k=n[T],V=o(k);if(V!=null&&(K===s?V===V&&!Ve(V):d(V,K)))var K=V,Q=k}return Q}function j0(n,o,d,T){var M=n.length;for(d=Dt(d),d<0&&(d=-d>M?0:M+d),T=T===s||T>M?M:Dt(T),T<0&&(T+=M),T=d>T?0:Fh(T);d<T;)n[d++]=o;return n}function Ef(n,o){var d=[];return Qn(n,function(T,M,k){o(T,M,k)&&d.push(T)}),d}function Me(n,o,d,T,M){var k=-1,V=n.length;for(d||(d=Db),M||(M=[]);++k<V;){var K=n[k];o>0&&d(K)?o>1?Me(K,o-1,d,T,M):Kn(M,K):T||(M[M.length]=K)}return M}var kl=jf(),Af=jf(!0);function An(n,o){return n&&kl(n,o,Se)}function $l(n,o){return n&&Af(n,o,Se)}function Gs(n,o){return Jn(o,function(d){return Fn(n[d])})}function yi(n,o){o=ti(o,n);for(var d=0,T=o.length;n!=null&&d<T;)n=n[On(o[d++])];return d&&d==T?n:s}function Tf(n,o,d){var T=o(n);return Rt(n)?T:Kn(T,d(n))}function De(n){return n==null?n===s?Yr:be:pi&&pi in ne(n)?xb(n):Hb(n)}function Hl(n,o){return n>o}function J0(n,o){return n!=null&&te.call(n,o)}function K0(n,o){return n!=null&&o in ne(n)}function q0(n,o,d){return n>=_e(o,d)&&n<Ae(o,d)}function Gl(n,o,d){for(var T=d?Cl:Os,M=n[0].length,k=n.length,V=k,K=nt(k),Q=1/0,st=[];V--;){var at=n[V];V&&o&&(at=ae(at,We(o))),Q=_e(at.length,Q),K[V]=!d&&(o||M>=120&&at.length>=120)?new gi(V&&at):s}at=n[0];var ut=-1,pt=K[0];t:for(;++ut<M&&st.length<Q;){var bt=at[ut],wt=o?o(bt):bt;if(bt=d||bt!==0?bt:0,!(pt?Qr(pt,wt):T(st,wt,d))){for(V=k;--V;){var Ut=K[V];if(!(Ut?Qr(Ut,wt):T(n[V],wt,d)))continue t}pt&&pt.push(wt),st.push(bt)}}return st}function Z0(n,o,d,T){return An(n,function(M,k,V){o(T,d(M),k,V)}),T}function so(n,o,d){o=ti(o,n),n=uh(n,o);var T=n==null?n:n[On(nn(o))];return T==null?s:Ge(T,n,d)}function Of(n){return pe(n)&&De(n)==B}function Y0(n){return pe(n)&&De(n)==q}function Q0(n){return pe(n)&&De(n)==dt}function ao(n,o,d,T,M){return n===o?!0:n==null||o==null||!pe(n)&&!pe(o)?n!==n&&o!==o:X0(n,o,d,T,ao,M)}function X0(n,o,d,T,M,k){var V=Rt(n),K=Rt(o),Q=V?H:Le(n),st=K?H:Le(o);Q=Q==B?oe:Q,st=st==B?oe:st;var at=Q==oe,ut=st==oe,pt=Q==st;if(pt&&ni(n)){if(!ni(o))return!1;V=!0,at=!1}if(pt&&!at)return k||(k=new dn),V||br(n)?nh(n,o,d,T,M,k):wb(n,o,Q,d,T,M,k);if(!(d&h)){var bt=at&&te.call(n,"__wrapped__"),wt=ut&&te.call(o,"__wrapped__");if(bt||wt){var Ut=bt?n.value():n,Pt=wt?o.value():o;return k||(k=new dn),M(Ut,Pt,d,T,k)}}return pt?(k||(k=new dn),Pb(n,o,d,T,M,k)):!1}function tb(n){return pe(n)&&Le(n)==ht}function Wl(n,o,d,T){var M=d.length,k=M,V=!T;if(n==null)return!k;for(n=ne(n);M--;){var K=d[M];if(V&&K[2]?K[1]!==n[K[0]]:!(K[0]in n))return!1}for(;++M<k;){K=d[M];var Q=K[0],st=n[Q],at=K[1];if(V&&K[2]){if(st===s&&!(Q in n))return!1}else{var ut=new dn;if(T)var pt=T(st,at,Q,n,o,ut);if(!(pt===s?ao(at,st,h|b,T,ut):pt))return!1}}return!0}function Cf(n){if(!ue(n)||Fb(n))return!1;var o=Fn(n)?t0:zv;return o.test(Ei(n))}function eb(n){return pe(n)&&De(n)==bn}function nb(n){return pe(n)&&Le(n)==le}function ib(n){return pe(n)&&oa(n.length)&&!!se[De(n)]}function Sf(n){return typeof n=="function"?n:n==null?$e:typeof n=="object"?Rt(n)?xf(n[0],n[1]):Pf(n):Jh(n)}function zl(n){if(!co(n))return s0(n);var o=[];for(var d in ne(n))te.call(n,d)&&d!="constructor"&&o.push(d);return o}function rb(n){if(!ue(n))return $b(n);var o=co(n),d=[];for(var T in n)T=="constructor"&&(o||!te.call(n,T))||d.push(T);return d}function Vl(n,o){return n<o}function wf(n,o){var d=-1,T=Be(n)?nt(n.length):[];return Qn(n,function(M,k,V){T[++d]=o(M,k,V)}),T}function Pf(n){var o=su(n);return o.length==1&&o[0][2]?ah(o[0][0],o[0][1]):function(d){return d===n||Wl(d,n,o)}}function xf(n,o){return lu(n)&&sh(o)?ah(On(n),o):function(d){var T=yu(d,n);return T===s&&T===o?bu(d,n):ao(o,T,h|b)}}function Ws(n,o,d,T,M){n!==o&&kl(o,function(k,V){if(M||(M=new dn),ue(k))ob(n,o,V,d,Ws,T,M);else{var K=T?T(cu(n,V),k,V+"",n,o,M):s;K===s&&(K=k),Ul(n,V,K)}},ke)}function ob(n,o,d,T,M,k,V){var K=cu(n,d),Q=cu(o,d),st=V.get(Q);if(st){Ul(n,d,st);return}var at=k?k(K,Q,d+"",n,o,V):s,ut=at===s;if(ut){var pt=Rt(Q),bt=!pt&&ni(Q),wt=!pt&&!bt&&br(Q);at=Q,pt||bt||wt?Rt(K)?at=K:ge(K)?at=Ue(K):bt?(ut=!1,at=$f(Q,!0)):wt?(ut=!1,at=Hf(Q,!0)):at=[]:ho(Q)||Ai(Q)?(at=K,Ai(K)?at=Uh(K):(!ue(K)||Fn(K))&&(at=oh(Q))):ut=!1}ut&&(V.set(Q,at),M(at,Q,T,k,V),V.delete(Q)),Ul(n,d,at)}function If(n,o){var d=n.length;if(!!d)return o+=o<0?d:0,Nn(o,d)?n[o]:s}function Mf(n,o,d){o.length?o=ae(o,function(k){return Rt(k)?function(V){return yi(V,k.length===1?k[0]:k)}:k}):o=[$e];var T=-1;o=ae(o,We(St()));var M=wf(n,function(k,V,K){var Q=ae(o,function(st){return st(k)});return{criteria:Q,index:++T,value:k}});return _y(M,function(k,V){return yb(k,V,d)})}function sb(n,o){return Rf(n,o,function(d,T){return bu(n,T)})}function Rf(n,o,d){for(var T=-1,M=o.length,k={};++T<M;){var V=o[T],K=yi(n,V);d(K,V)&&lo(k,ti(V,n),K)}return k}function ab(n){return function(o){return yi(o,n)}}function jl(n,o,d,T){var M=T?Ry:ur,k=-1,V=o.length,K=n;for(n===o&&(o=Ue(o)),d&&(K=ae(n,We(d)));++k<V;)for(var Q=0,st=o[k],at=d?d(st):st;(Q=M(K,at,Q,T))>-1;)K!==n&&Ls.call(K,Q,1),Ls.call(n,Q,1);return n}function _f(n,o){for(var d=n?o.length:0,T=d-1;d--;){var M=o[d];if(d==T||M!==k){var k=M;Nn(M)?Ls.call(n,M,1):Zl(n,M)}}return n}function Jl(n,o){return n+Fs(ff()*(o-n+1))}function lb(n,o,d,T){for(var M=-1,k=Ae(Ns((o-n)/(d||1)),0),V=nt(k);k--;)V[T?k:++M]=n,n+=d;return V}function Kl(n,o){var d="";if(!n||o<1||o>$)return d;do o%2&&(d+=n),o=Fs(o/2),o&&(n+=n);while(o);return d}function kt(n,o){return du(lh(n,o,$e),n+"")}function ub(n){return mf(Er(n))}function cb(n,o){var d=Er(n);return Xs(d,vi(o,0,d.length))}function lo(n,o,d,T){if(!ue(n))return n;o=ti(o,n);for(var M=-1,k=o.length,V=k-1,K=n;K!=null&&++M<k;){var Q=On(o[M]),st=d;if(Q==="__proto__"||Q==="constructor"||Q==="prototype")return n;if(M!=V){var at=K[Q];st=T?T(at,Q,K):s,st===s&&(st=ue(at)?at:Nn(o[M+1])?[]:{})}ro(K,Q,st),K=K[Q]}return n}var Lf=Us?function(n,o){return Us.set(n,o),n}:$e,db=Ds?function(n,o){return Ds(n,"toString",{configurable:!0,enumerable:!1,value:Au(o),writable:!0})}:$e;function fb(n){return Xs(Er(n))}function en(n,o,d){var T=-1,M=n.length;o<0&&(o=-o>M?0:M+o),d=d>M?M:d,d<0&&(d+=M),M=o>d?0:d-o>>>0,o>>>=0;for(var k=nt(M);++T<M;)k[T]=n[T+o];return k}function hb(n,o){var d;return Qn(n,function(T,M,k){return d=o(T,M,k),!d}),!!d}function zs(n,o,d){var T=0,M=n==null?T:n.length;if(typeof o=="number"&&o===o&&M<=X){for(;T<M;){var k=T+M>>>1,V=n[k];V!==null&&!Ve(V)&&(d?V<=o:V<o)?T=k+1:M=k}return M}return ql(n,o,$e,d)}function ql(n,o,d,T){var M=0,k=n==null?0:n.length;if(k===0)return 0;o=d(o);for(var V=o!==o,K=o===null,Q=Ve(o),st=o===s;M<k;){var at=Fs((M+k)/2),ut=d(n[at]),pt=ut!==s,bt=ut===null,wt=ut===ut,Ut=Ve(ut);if(V)var Pt=T||wt;else st?Pt=wt&&(T||pt):K?Pt=wt&&pt&&(T||!bt):Q?Pt=wt&&pt&&!bt&&(T||!Ut):bt||Ut?Pt=!1:Pt=T?ut<=o:ut<o;Pt?M=at+1:k=at}return _e(k,it)}function Df(n,o){for(var d=-1,T=n.length,M=0,k=[];++d<T;){var V=n[d],K=o?o(V):V;if(!d||!fn(K,Q)){var Q=K;k[M++]=V===0?0:V}}return k}function Nf(n){return typeof n=="number"?n:Ve(n)?J:+n}function ze(n){if(typeof n=="string")return n;if(Rt(n))return ae(n,ze)+"";if(Ve(n))return hf?hf.call(n):"";var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Xn(n,o,d){var T=-1,M=Os,k=n.length,V=!0,K=[],Q=K;if(d)V=!1,M=Cl;else if(k>=t){var st=o?null:Cb(n);if(st)return Ss(st);V=!1,M=Qr,Q=new gi}else Q=o?[]:K;t:for(;++T<k;){var at=n[T],ut=o?o(at):at;if(at=d||at!==0?at:0,V&&ut===ut){for(var pt=Q.length;pt--;)if(Q[pt]===ut)continue t;o&&Q.push(ut),K.push(at)}else M(Q,ut,d)||(Q!==K&&Q.push(ut),K.push(at))}return K}function Zl(n,o){return o=ti(o,n),n=uh(n,o),n==null||delete n[On(nn(o))]}function Ff(n,o,d,T){return lo(n,o,d(yi(n,o)),T)}function Vs(n,o,d,T){for(var M=n.length,k=T?M:-1;(T?k--:++k<M)&&o(n[k],k,n););return d?en(n,T?0:k,T?k+1:M):en(n,T?k+1:0,T?M:k)}function Uf(n,o){var d=n;return d instanceof Vt&&(d=d.value()),Sl(o,function(T,M){return M.func.apply(M.thisArg,Kn([T],M.args))},d)}function Yl(n,o,d){var T=n.length;if(T<2)return T?Xn(n[0]):[];for(var M=-1,k=nt(T);++M<T;)for(var V=n[M],K=-1;++K<T;)K!=M&&(k[M]=oo(k[M]||V,n[K],o,d));return Xn(Me(k,1),o,d)}function Bf(n,o,d){for(var T=-1,M=n.length,k=o.length,V={};++T<M;){var K=T<k?o[T]:s;d(V,n[T],K)}return V}function Ql(n){return ge(n)?n:[]}function Xl(n){return typeof n=="function"?n:$e}function ti(n,o){return Rt(n)?n:lu(n,o)?[n]:hh(Qt(n))}var pb=kt;function ei(n,o,d){var T=n.length;return d=d===s?T:d,!o&&d>=T?n:en(n,o,d)}var kf=e0||function(n){return Ce.clearTimeout(n)};function $f(n,o){if(o)return n.slice();var d=n.length,T=af?af(d):new n.constructor(d);return n.copy(T),T}function tu(n){var o=new n.constructor(n.byteLength);return new Rs(o).set(new Rs(n)),o}function mb(n,o){var d=o?tu(n.buffer):n.buffer;return new n.constructor(d,n.byteOffset,n.byteLength)}function gb(n){var o=new n.constructor(n.source,Td.exec(n));return o.lastIndex=n.lastIndex,o}function vb(n){return io?ne(io.call(n)):{}}function Hf(n,o){var d=o?tu(n.buffer):n.buffer;return new n.constructor(d,n.byteOffset,n.length)}function Gf(n,o){if(n!==o){var d=n!==s,T=n===null,M=n===n,k=Ve(n),V=o!==s,K=o===null,Q=o===o,st=Ve(o);if(!K&&!st&&!k&&n>o||k&&V&&Q&&!K&&!st||T&&V&&Q||!d&&Q||!M)return 1;if(!T&&!k&&!st&&n<o||st&&d&&M&&!T&&!k||K&&d&&M||!V&&M||!Q)return-1}return 0}function yb(n,o,d){for(var T=-1,M=n.criteria,k=o.criteria,V=M.length,K=d.length;++T<V;){var Q=Gf(M[T],k[T]);if(Q){if(T>=K)return Q;var st=d[T];return Q*(st=="desc"?-1:1)}}return n.index-o.index}function Wf(n,o,d,T){for(var M=-1,k=n.length,V=d.length,K=-1,Q=o.length,st=Ae(k-V,0),at=nt(Q+st),ut=!T;++K<Q;)at[K]=o[K];for(;++M<V;)(ut||M<k)&&(at[d[M]]=n[M]);for(;st--;)at[K++]=n[M++];return at}function zf(n,o,d,T){for(var M=-1,k=n.length,V=-1,K=d.length,Q=-1,st=o.length,at=Ae(k-K,0),ut=nt(at+st),pt=!T;++M<at;)ut[M]=n[M];for(var bt=M;++Q<st;)ut[bt+Q]=o[Q];for(;++V<K;)(pt||M<k)&&(ut[bt+d[V]]=n[M++]);return ut}function Ue(n,o){var d=-1,T=n.length;for(o||(o=nt(T));++d<T;)o[d]=n[d];return o}function Tn(n,o,d,T){var M=!d;d||(d={});for(var k=-1,V=o.length;++k<V;){var K=o[k],Q=T?T(d[K],n[K],K,d,n):s;Q===s&&(Q=n[K]),M?_n(d,K,Q):ro(d,K,Q)}return d}function bb(n,o){return Tn(n,au(n),o)}function Eb(n,o){return Tn(n,ih(n),o)}function js(n,o){return function(d,T){var M=Rt(d)?Sy:G0,k=o?o():{};return M(d,n,St(T,2),k)}}function gr(n){return kt(function(o,d){var T=-1,M=d.length,k=M>1?d[M-1]:s,V=M>2?d[2]:s;for(k=n.length>3&&typeof k=="function"?(M--,k):s,V&&Ne(d[0],d[1],V)&&(k=M<3?s:k,M=1),o=ne(o);++T<M;){var K=d[T];K&&n(o,K,T,k)}return o})}function Vf(n,o){return function(d,T){if(d==null)return d;if(!Be(d))return n(d,T);for(var M=d.length,k=o?M:-1,V=ne(d);(o?k--:++k<M)&&T(V[k],k,V)!==!1;);return d}}function jf(n){return function(o,d,T){for(var M=-1,k=ne(o),V=T(o),K=V.length;K--;){var Q=V[n?K:++M];if(d(k[Q],Q,k)===!1)break}return o}}function Ab(n,o,d){var T=o&w,M=uo(n);function k(){var V=this&&this!==Ce&&this instanceof k?M:n;return V.apply(T?d:this,arguments)}return k}function Jf(n){return function(o){o=Qt(o);var d=cr(o)?cn(o):s,T=d?d[0]:o.charAt(0),M=d?ei(d,1).join(""):o.slice(1);return T[n]()+M}}function vr(n){return function(o){return Sl(Vh(zh(o).replace(dy,"")),n,"")}}function uo(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var d=mr(n.prototype),T=n.apply(d,o);return ue(T)?T:d}}function Tb(n,o,d){var T=uo(n);function M(){for(var k=arguments.length,V=nt(k),K=k,Q=yr(M);K--;)V[K]=arguments[K];var st=k<3&&V[0]!==Q&&V[k-1]!==Q?[]:qn(V,Q);if(k-=st.length,k<d)return Qf(n,o,Js,M.placeholder,s,V,st,s,s,d-k);var at=this&&this!==Ce&&this instanceof M?T:n;return Ge(at,this,V)}return M}function Kf(n){return function(o,d,T){var M=ne(o);if(!Be(o)){var k=St(d,3);o=Se(o),d=function(K){return k(M[K],K,M)}}var V=n(o,d,T);return V>-1?M[k?o[V]:V]:s}}function qf(n){return Dn(function(o){var d=o.length,T=d,M=Xe.prototype.thru;for(n&&o.reverse();T--;){var k=o[T];if(typeof k!="function")throw new Qe(r);if(M&&!V&&Ys(k)=="wrapper")var V=new Xe([],!0)}for(T=V?T:d;++T<d;){k=o[T];var K=Ys(k),Q=K=="wrapper"?ou(k):s;Q&&uu(Q[0])&&Q[1]==(f|O|g|p)&&!Q[4].length&&Q[9]==1?V=V[Ys(Q[0])].apply(V,Q[3]):V=k.length==1&&uu(k)?V[K]():V.thru(k)}return function(){var st=arguments,at=st[0];if(V&&st.length==1&&Rt(at))return V.plant(at).value();for(var ut=0,pt=d?o[ut].apply(this,st):at;++ut<d;)pt=o[ut].call(this,pt);return pt}})}function Js(n,o,d,T,M,k,V,K,Q,st){var at=o&f,ut=o&w,pt=o&P,bt=o&(O|x),wt=o&S,Ut=pt?s:uo(n);function Pt(){for(var Gt=arguments.length,jt=nt(Gt),je=Gt;je--;)jt[je]=arguments[je];if(bt)var Fe=yr(Pt),Je=Dy(jt,Fe);if(T&&(jt=Wf(jt,T,M,bt)),k&&(jt=zf(jt,k,V,bt)),Gt-=Je,bt&&Gt<st){var ve=qn(jt,Fe);return Qf(n,o,Js,Pt.placeholder,d,jt,ve,K,Q,st-Gt)}var hn=ut?d:this,Bn=pt?hn[n]:n;return Gt=jt.length,K?jt=Gb(jt,K):wt&&Gt>1&&jt.reverse(),at&&Q<Gt&&(jt.length=Q),this&&this!==Ce&&this instanceof Pt&&(Bn=Ut||uo(Bn)),Bn.apply(hn,jt)}return Pt}function Zf(n,o){return function(d,T){return Z0(d,n,o(T),{})}}function Ks(n,o){return function(d,T){var M;if(d===s&&T===s)return o;if(d!==s&&(M=d),T!==s){if(M===s)return T;typeof d=="string"||typeof T=="string"?(d=ze(d),T=ze(T)):(d=Nf(d),T=Nf(T)),M=n(d,T)}return M}}function eu(n){return Dn(function(o){return o=ae(o,We(St())),kt(function(d){var T=this;return n(o,function(M){return Ge(M,T,d)})})})}function qs(n,o){o=o===s?" ":ze(o);var d=o.length;if(d<2)return d?Kl(o,n):o;var T=Kl(o,Ns(n/dr(o)));return cr(o)?ei(cn(T),0,n).join(""):T.slice(0,n)}function Ob(n,o,d,T){var M=o&w,k=uo(n);function V(){for(var K=-1,Q=arguments.length,st=-1,at=T.length,ut=nt(at+Q),pt=this&&this!==Ce&&this instanceof V?k:n;++st<at;)ut[st]=T[st];for(;Q--;)ut[st++]=arguments[++K];return Ge(pt,M?d:this,ut)}return V}function Yf(n){return function(o,d,T){return T&&typeof T!="number"&&Ne(o,d,T)&&(d=T=s),o=Un(o),d===s?(d=o,o=0):d=Un(d),T=T===s?o<d?1:-1:Un(T),lb(o,d,T,n)}}function Zs(n){return function(o,d){return typeof o=="string"&&typeof d=="string"||(o=rn(o),d=rn(d)),n(o,d)}}function Qf(n,o,d,T,M,k,V,K,Q,st){var at=o&O,ut=at?V:s,pt=at?s:V,bt=at?k:s,wt=at?s:k;o|=at?g:A,o&=~(at?A:g),o&C||(o&=~(w|P));var Ut=[n,o,M,bt,ut,wt,pt,K,Q,st],Pt=d.apply(s,Ut);return uu(n)&&ch(Pt,Ut),Pt.placeholder=T,dh(Pt,n,o)}function nu(n){var o=Ee[n];return function(d,T){if(d=rn(d),T=T==null?0:_e(Dt(T),292),T&&df(d)){var M=(Qt(d)+"e").split("e"),k=o(M[0]+"e"+(+M[1]+T));return M=(Qt(k)+"e").split("e"),+(M[0]+"e"+(+M[1]-T))}return o(d)}}var Cb=hr&&1/Ss(new hr([,-0]))[1]==L?function(n){return new hr(n)}:Cu;function Xf(n){return function(o){var d=Le(o);return d==ht?_l(o):d==le?Hy(o):Ly(o,n(o))}}function Ln(n,o,d,T,M,k,V,K){var Q=o&P;if(!Q&&typeof n!="function")throw new Qe(r);var st=T?T.length:0;if(st||(o&=~(g|A),T=M=s),V=V===s?V:Ae(Dt(V),0),K=K===s?K:Dt(K),st-=M?M.length:0,o&A){var at=T,ut=M;T=M=s}var pt=Q?s:ou(n),bt=[n,o,d,T,M,at,ut,k,V,K];if(pt&&kb(bt,pt),n=bt[0],o=bt[1],d=bt[2],T=bt[3],M=bt[4],K=bt[9]=bt[9]===s?Q?0:n.length:Ae(bt[9]-st,0),!K&&o&(O|x)&&(o&=~(O|x)),!o||o==w)var wt=Ab(n,o,d);else o==O||o==x?wt=Tb(n,o,K):(o==g||o==(w|g))&&!M.length?wt=Ob(n,o,d,T):wt=Js.apply(s,bt);var Ut=pt?Lf:ch;return dh(Ut(wt,bt),n,o)}function th(n,o,d,T){return n===s||fn(n,fr[d])&&!te.call(T,d)?o:n}function eh(n,o,d,T,M,k){return ue(n)&&ue(o)&&(k.set(o,n),Ws(n,o,s,eh,k),k.delete(o)),n}function Sb(n){return ho(n)?s:n}function nh(n,o,d,T,M,k){var V=d&h,K=n.length,Q=o.length;if(K!=Q&&!(V&&Q>K))return!1;var st=k.get(n),at=k.get(o);if(st&&at)return st==o&&at==n;var ut=-1,pt=!0,bt=d&b?new gi:s;for(k.set(n,o),k.set(o,n);++ut<K;){var wt=n[ut],Ut=o[ut];if(T)var Pt=V?T(Ut,wt,ut,o,n,k):T(wt,Ut,ut,n,o,k);if(Pt!==s){if(Pt)continue;pt=!1;break}if(bt){if(!wl(o,function(Gt,jt){if(!Qr(bt,jt)&&(wt===Gt||M(wt,Gt,d,T,k)))return bt.push(jt)})){pt=!1;break}}else if(!(wt===Ut||M(wt,Ut,d,T,k))){pt=!1;break}}return k.delete(n),k.delete(o),pt}function wb(n,o,d,T,M,k,V){switch(d){case ot:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case q:return!(n.byteLength!=o.byteLength||!k(new Rs(n),new Rs(o)));case et:case dt:case Yt:return fn(+n,+o);case Et:return n.name==o.name&&n.message==o.message;case bn:case En:return n==o+"";case ht:var K=_l;case le:var Q=T&h;if(K||(K=Ss),n.size!=o.size&&!Q)return!1;var st=V.get(n);if(st)return st==o;T|=b,V.set(n,o);var at=nh(K(n),K(o),T,M,k,V);return V.delete(n),at;case jn:if(io)return io.call(n)==io.call(o)}return!1}function Pb(n,o,d,T,M,k){var V=d&h,K=iu(n),Q=K.length,st=iu(o),at=st.length;if(Q!=at&&!V)return!1;for(var ut=Q;ut--;){var pt=K[ut];if(!(V?pt in o:te.call(o,pt)))return!1}var bt=k.get(n),wt=k.get(o);if(bt&&wt)return bt==o&&wt==n;var Ut=!0;k.set(n,o),k.set(o,n);for(var Pt=V;++ut<Q;){pt=K[ut];var Gt=n[pt],jt=o[pt];if(T)var je=V?T(jt,Gt,pt,o,n,k):T(Gt,jt,pt,n,o,k);if(!(je===s?Gt===jt||M(Gt,jt,d,T,k):je)){Ut=!1;break}Pt||(Pt=pt=="constructor")}if(Ut&&!Pt){var Fe=n.constructor,Je=o.constructor;Fe!=Je&&"constructor"in n&&"constructor"in o&&!(typeof Fe=="function"&&Fe instanceof Fe&&typeof Je=="function"&&Je instanceof Je)&&(Ut=!1)}return k.delete(n),k.delete(o),Ut}function Dn(n){return du(lh(n,s,vh),n+"")}function iu(n){return Tf(n,Se,au)}function ru(n){return Tf(n,ke,ih)}var ou=Us?function(n){return Us.get(n)}:Cu;function Ys(n){for(var o=n.name+"",d=pr[o],T=te.call(pr,o)?d.length:0;T--;){var M=d[T],k=M.func;if(k==null||k==n)return M.name}return o}function yr(n){var o=te.call(U,"placeholder")?U:n;return o.placeholder}function St(){var n=U.iteratee||Tu;return n=n===Tu?Sf:n,arguments.length?n(arguments[0],arguments[1]):n}function Qs(n,o){var d=n.__data__;return Nb(o)?d[typeof o=="string"?"string":"hash"]:d.map}function su(n){for(var o=Se(n),d=o.length;d--;){var T=o[d],M=n[T];o[d]=[T,M,sh(M)]}return o}function bi(n,o){var d=By(n,o);return Cf(d)?d:s}function xb(n){var o=te.call(n,pi),d=n[pi];try{n[pi]=s;var T=!0}catch(k){}var M=Is.call(n);return T&&(o?n[pi]=d:delete n[pi]),M}var au=Dl?function(n){return n==null?[]:(n=ne(n),Jn(Dl(n),function(o){return uf.call(n,o)}))}:Su,ih=Dl?function(n){for(var o=[];n;)Kn(o,au(n)),n=_s(n);return o}:Su,Le=De;(Nl&&Le(new Nl(new ArrayBuffer(1)))!=ot||to&&Le(new to)!=ht||Fl&&Le(Fl.resolve())!=he||hr&&Le(new hr)!=le||eo&&Le(new eo)!=fi)&&(Le=function(n){var o=De(n),d=o==oe?n.constructor:s,T=d?Ei(d):"";if(T)switch(T){case c0:return ot;case d0:return ht;case f0:return he;case h0:return le;case p0:return fi}return o});function Ib(n,o,d){for(var T=-1,M=d.length;++T<M;){var k=d[T],V=k.size;switch(k.type){case"drop":n+=V;break;case"dropRight":o-=V;break;case"take":o=_e(o,n+V);break;case"takeRight":n=Ae(n,o-V);break}}return{start:n,end:o}}function Mb(n){var o=n.match(Fv);return o?o[1].split(Uv):[]}function rh(n,o,d){o=ti(o,n);for(var T=-1,M=o.length,k=!1;++T<M;){var V=On(o[T]);if(!(k=n!=null&&d(n,V)))break;n=n[V]}return k||++T!=M?k:(M=n==null?0:n.length,!!M&&oa(M)&&Nn(V,M)&&(Rt(n)||Ai(n)))}function Rb(n){var o=n.length,d=new n.constructor(o);return o&&typeof n[0]=="string"&&te.call(n,"index")&&(d.index=n.index,d.input=n.input),d}function oh(n){return typeof n.constructor=="function"&&!co(n)?mr(_s(n)):{}}function _b(n,o,d){var T=n.constructor;switch(o){case q:return tu(n);case et:case dt:return new T(+n);case ot:return mb(n,d);case ct:case yt:case Ft:case Oe:case In:case dl:case fl:case hl:case pl:return Hf(n,d);case ht:return new T;case Yt:case En:return new T(n);case bn:return gb(n);case le:return new T;case jn:return vb(n)}}function Lb(n,o){var d=o.length;if(!d)return n;var T=d-1;return o[T]=(d>1?"& ":"")+o[T],o=o.join(d>2?", ":" "),n.replace(Nv,`{
/* [wrapped with `+o+`] */
`)}function Db(n){return Rt(n)||Ai(n)||!!(cf&&n&&n[cf])}function Nn(n,o){var d=typeof n;return o=o==null?$:o,!!o&&(d=="number"||d!="symbol"&&jv.test(n))&&n>-1&&n%1==0&&n<o}function Ne(n,o,d){if(!ue(d))return!1;var T=typeof o;return(T=="number"?Be(d)&&Nn(o,d.length):T=="string"&&o in d)?fn(d[o],n):!1}function lu(n,o){if(Rt(n))return!1;var d=typeof n;return d=="number"||d=="symbol"||d=="boolean"||n==null||Ve(n)?!0:Rv.test(n)||!Mv.test(n)||o!=null&&n in ne(o)}function Nb(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function uu(n){var o=Ys(n),d=U[o];if(typeof d!="function"||!(o in Vt.prototype))return!1;if(n===d)return!0;var T=ou(d);return!!T&&n===T[0]}function Fb(n){return!!sf&&sf in n}var Ub=Ps?Fn:wu;function co(n){var o=n&&n.constructor,d=typeof o=="function"&&o.prototype||fr;return n===d}function sh(n){return n===n&&!ue(n)}function ah(n,o){return function(d){return d==null?!1:d[n]===o&&(o!==s||n in ne(d))}}function Bb(n){var o=ia(n,function(T){return d.size===u&&d.clear(),T}),d=o.cache;return o}function kb(n,o){var d=n[1],T=o[1],M=d|T,k=M<(w|P|f),V=T==f&&d==O||T==f&&d==p&&n[7].length<=o[8]||T==(f|p)&&o[7].length<=o[8]&&d==O;if(!(k||V))return n;T&w&&(n[2]=o[2],M|=d&w?0:C);var K=o[3];if(K){var Q=n[3];n[3]=Q?Wf(Q,K,o[4]):K,n[4]=Q?qn(n[3],c):o[4]}return K=o[5],K&&(Q=n[5],n[5]=Q?zf(Q,K,o[6]):K,n[6]=Q?qn(n[5],c):o[6]),K=o[7],K&&(n[7]=K),T&f&&(n[8]=n[8]==null?o[8]:_e(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=M,n}function $b(n){var o=[];if(n!=null)for(var d in ne(n))o.push(d);return o}function Hb(n){return Is.call(n)}function lh(n,o,d){return o=Ae(o===s?n.length-1:o,0),function(){for(var T=arguments,M=-1,k=Ae(T.length-o,0),V=nt(k);++M<k;)V[M]=T[o+M];M=-1;for(var K=nt(o+1);++M<o;)K[M]=T[M];return K[o]=d(V),Ge(n,this,K)}}function uh(n,o){return o.length<2?n:yi(n,en(o,0,-1))}function Gb(n,o){for(var d=n.length,T=_e(o.length,d),M=Ue(n);T--;){var k=o[T];n[T]=Nn(k,d)?M[k]:s}return n}function cu(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var ch=fh(Lf),fo=i0||function(n,o){return Ce.setTimeout(n,o)},du=fh(db);function dh(n,o,d){var T=o+"";return du(n,Lb(T,Wb(Mb(T),d)))}function fh(n){var o=0,d=0;return function(){var T=a0(),M=z-(T-d);if(d=T,M>0){if(++o>=F)return arguments[0]}else o=0;return n.apply(s,arguments)}}function Xs(n,o){var d=-1,T=n.length,M=T-1;for(o=o===s?T:o;++d<o;){var k=Jl(d,M),V=n[k];n[k]=n[d],n[d]=V}return n.length=o,n}var hh=Bb(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(_v,function(d,T,M,k){o.push(M?k.replace($v,"$1"):T||d)}),o});function On(n){if(typeof n=="string"||Ve(n))return n;var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Ei(n){if(n!=null){try{return xs.call(n)}catch(o){}try{return n+""}catch(o){}}return""}function Wb(n,o){return Ye(_,function(d){var T="_."+d[0];o&d[1]&&!Os(n,T)&&n.push(T)}),n.sort()}function ph(n){if(n instanceof Vt)return n.clone();var o=new Xe(n.__wrapped__,n.__chain__);return o.__actions__=Ue(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function zb(n,o,d){(d?Ne(n,o,d):o===s)?o=1:o=Ae(Dt(o),0);var T=n==null?0:n.length;if(!T||o<1)return[];for(var M=0,k=0,V=nt(Ns(T/o));M<T;)V[k++]=en(n,M,M+=o);return V}function Vb(n){for(var o=-1,d=n==null?0:n.length,T=0,M=[];++o<d;){var k=n[o];k&&(M[T++]=k)}return M}function jb(){var n=arguments.length;if(!n)return[];for(var o=nt(n-1),d=arguments[0],T=n;T--;)o[T-1]=arguments[T];return Kn(Rt(d)?Ue(d):[d],Me(o,1))}var Jb=kt(function(n,o){return ge(n)?oo(n,Me(o,1,ge,!0)):[]}),Kb=kt(function(n,o){var d=nn(o);return ge(d)&&(d=s),ge(n)?oo(n,Me(o,1,ge,!0),St(d,2)):[]}),qb=kt(function(n,o){var d=nn(o);return ge(d)&&(d=s),ge(n)?oo(n,Me(o,1,ge,!0),s,d):[]});function Zb(n,o,d){var T=n==null?0:n.length;return T?(o=d||o===s?1:Dt(o),en(n,o<0?0:o,T)):[]}function Yb(n,o,d){var T=n==null?0:n.length;return T?(o=d||o===s?1:Dt(o),o=T-o,en(n,0,o<0?0:o)):[]}function Qb(n,o){return n&&n.length?Vs(n,St(o,3),!0,!0):[]}function Xb(n,o){return n&&n.length?Vs(n,St(o,3),!0):[]}function tE(n,o,d,T){var M=n==null?0:n.length;return M?(d&&typeof d!="number"&&Ne(n,o,d)&&(d=0,T=M),j0(n,o,d,T)):[]}function mh(n,o,d){var T=n==null?0:n.length;if(!T)return-1;var M=d==null?0:Dt(d);return M<0&&(M=Ae(T+M,0)),Cs(n,St(o,3),M)}function gh(n,o,d){var T=n==null?0:n.length;if(!T)return-1;var M=T-1;return d!==s&&(M=Dt(d),M=d<0?Ae(T+M,0):_e(M,T-1)),Cs(n,St(o,3),M,!0)}function vh(n){var o=n==null?0:n.length;return o?Me(n,1):[]}function eE(n){var o=n==null?0:n.length;return o?Me(n,L):[]}function nE(n,o){var d=n==null?0:n.length;return d?(o=o===s?1:Dt(o),Me(n,o)):[]}function iE(n){for(var o=-1,d=n==null?0:n.length,T={};++o<d;){var M=n[o];T[M[0]]=M[1]}return T}function yh(n){return n&&n.length?n[0]:s}function rE(n,o,d){var T=n==null?0:n.length;if(!T)return-1;var M=d==null?0:Dt(d);return M<0&&(M=Ae(T+M,0)),ur(n,o,M)}function oE(n){var o=n==null?0:n.length;return o?en(n,0,-1):[]}var sE=kt(function(n){var o=ae(n,Ql);return o.length&&o[0]===n[0]?Gl(o):[]}),aE=kt(function(n){var o=nn(n),d=ae(n,Ql);return o===nn(d)?o=s:d.pop(),d.length&&d[0]===n[0]?Gl(d,St(o,2)):[]}),lE=kt(function(n){var o=nn(n),d=ae(n,Ql);return o=typeof o=="function"?o:s,o&&d.pop(),d.length&&d[0]===n[0]?Gl(d,s,o):[]});function uE(n,o){return n==null?"":o0.call(n,o)}function nn(n){var o=n==null?0:n.length;return o?n[o-1]:s}function cE(n,o,d){var T=n==null?0:n.length;if(!T)return-1;var M=T;return d!==s&&(M=Dt(d),M=M<0?Ae(T+M,0):_e(M,T-1)),o===o?Wy(n,o,M):Cs(n,Yd,M,!0)}function dE(n,o){return n&&n.length?If(n,Dt(o)):s}var fE=kt(bh);function bh(n,o){return n&&n.length&&o&&o.length?jl(n,o):n}function hE(n,o,d){return n&&n.length&&o&&o.length?jl(n,o,St(d,2)):n}function pE(n,o,d){return n&&n.length&&o&&o.length?jl(n,o,s,d):n}var mE=Dn(function(n,o){var d=n==null?0:n.length,T=Bl(n,o);return _f(n,ae(o,function(M){return Nn(M,d)?+M:M}).sort(Gf)),T});function gE(n,o){var d=[];if(!(n&&n.length))return d;var T=-1,M=[],k=n.length;for(o=St(o,3);++T<k;){var V=n[T];o(V,T,n)&&(d.push(V),M.push(T))}return _f(n,M),d}function fu(n){return n==null?n:u0.call(n)}function vE(n,o,d){var T=n==null?0:n.length;return T?(d&&typeof d!="number"&&Ne(n,o,d)?(o=0,d=T):(o=o==null?0:Dt(o),d=d===s?T:Dt(d)),en(n,o,d)):[]}function yE(n,o){return zs(n,o)}function bE(n,o,d){return ql(n,o,St(d,2))}function EE(n,o){var d=n==null?0:n.length;if(d){var T=zs(n,o);if(T<d&&fn(n[T],o))return T}return-1}function AE(n,o){return zs(n,o,!0)}function TE(n,o,d){return ql(n,o,St(d,2),!0)}function OE(n,o){var d=n==null?0:n.length;if(d){var T=zs(n,o,!0)-1;if(fn(n[T],o))return T}return-1}function CE(n){return n&&n.length?Df(n):[]}function SE(n,o){return n&&n.length?Df(n,St(o,2)):[]}function wE(n){var o=n==null?0:n.length;return o?en(n,1,o):[]}function PE(n,o,d){return n&&n.length?(o=d||o===s?1:Dt(o),en(n,0,o<0?0:o)):[]}function xE(n,o,d){var T=n==null?0:n.length;return T?(o=d||o===s?1:Dt(o),o=T-o,en(n,o<0?0:o,T)):[]}function IE(n,o){return n&&n.length?Vs(n,St(o,3),!1,!0):[]}function ME(n,o){return n&&n.length?Vs(n,St(o,3)):[]}var RE=kt(function(n){return Xn(Me(n,1,ge,!0))}),_E=kt(function(n){var o=nn(n);return ge(o)&&(o=s),Xn(Me(n,1,ge,!0),St(o,2))}),LE=kt(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Xn(Me(n,1,ge,!0),s,o)});function DE(n){return n&&n.length?Xn(n):[]}function NE(n,o){return n&&n.length?Xn(n,St(o,2)):[]}function FE(n,o){return o=typeof o=="function"?o:s,n&&n.length?Xn(n,s,o):[]}function hu(n){if(!(n&&n.length))return[];var o=0;return n=Jn(n,function(d){if(ge(d))return o=Ae(d.length,o),!0}),Ml(o,function(d){return ae(n,Pl(d))})}function Eh(n,o){if(!(n&&n.length))return[];var d=hu(n);return o==null?d:ae(d,function(T){return Ge(o,s,T)})}var UE=kt(function(n,o){return ge(n)?oo(n,o):[]}),BE=kt(function(n){return Yl(Jn(n,ge))}),kE=kt(function(n){var o=nn(n);return ge(o)&&(o=s),Yl(Jn(n,ge),St(o,2))}),$E=kt(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Yl(Jn(n,ge),s,o)}),HE=kt(hu);function GE(n,o){return Bf(n||[],o||[],ro)}function WE(n,o){return Bf(n||[],o||[],lo)}var zE=kt(function(n){var o=n.length,d=o>1?n[o-1]:s;return d=typeof d=="function"?(n.pop(),d):s,Eh(n,d)});function Ah(n){var o=U(n);return o.__chain__=!0,o}function VE(n,o){return o(n),n}function ta(n,o){return o(n)}var jE=Dn(function(n){var o=n.length,d=o?n[0]:0,T=this.__wrapped__,M=function(k){return Bl(k,n)};return o>1||this.__actions__.length||!(T instanceof Vt)||!Nn(d)?this.thru(M):(T=T.slice(d,+d+(o?1:0)),T.__actions__.push({func:ta,args:[M],thisArg:s}),new Xe(T,this.__chain__).thru(function(k){return o&&!k.length&&k.push(s),k}))});function JE(){return Ah(this)}function KE(){return new Xe(this.value(),this.__chain__)}function qE(){this.__values__===s&&(this.__values__=Nh(this.value()));var n=this.__index__>=this.__values__.length,o=n?s:this.__values__[this.__index__++];return{done:n,value:o}}function ZE(){return this}function YE(n){for(var o,d=this;d instanceof ks;){var T=ph(d);T.__index__=0,T.__values__=s,o?M.__wrapped__=T:o=T;var M=T;d=d.__wrapped__}return M.__wrapped__=n,o}function QE(){var n=this.__wrapped__;if(n instanceof Vt){var o=n;return this.__actions__.length&&(o=new Vt(this)),o=o.reverse(),o.__actions__.push({func:ta,args:[fu],thisArg:s}),new Xe(o,this.__chain__)}return this.thru(fu)}function XE(){return Uf(this.__wrapped__,this.__actions__)}var tA=js(function(n,o,d){te.call(n,d)?++n[d]:_n(n,d,1)});function eA(n,o,d){var T=Rt(n)?qd:V0;return d&&Ne(n,o,d)&&(o=s),T(n,St(o,3))}function nA(n,o){var d=Rt(n)?Jn:Ef;return d(n,St(o,3))}var iA=Kf(mh),rA=Kf(gh);function oA(n,o){return Me(ea(n,o),1)}function sA(n,o){return Me(ea(n,o),L)}function aA(n,o,d){return d=d===s?1:Dt(d),Me(ea(n,o),d)}function Th(n,o){var d=Rt(n)?Ye:Qn;return d(n,St(o,3))}function Oh(n,o){var d=Rt(n)?wy:bf;return d(n,St(o,3))}var lA=js(function(n,o,d){te.call(n,d)?n[d].push(o):_n(n,d,[o])});function uA(n,o,d,T){n=Be(n)?n:Er(n),d=d&&!T?Dt(d):0;var M=n.length;return d<0&&(d=Ae(M+d,0)),sa(n)?d<=M&&n.indexOf(o,d)>-1:!!M&&ur(n,o,d)>-1}var cA=kt(function(n,o,d){var T=-1,M=typeof o=="function",k=Be(n)?nt(n.length):[];return Qn(n,function(V){k[++T]=M?Ge(o,V,d):so(V,o,d)}),k}),dA=js(function(n,o,d){_n(n,d,o)});function ea(n,o){var d=Rt(n)?ae:wf;return d(n,St(o,3))}function fA(n,o,d,T){return n==null?[]:(Rt(o)||(o=o==null?[]:[o]),d=T?s:d,Rt(d)||(d=d==null?[]:[d]),Mf(n,o,d))}var hA=js(function(n,o,d){n[d?0:1].push(o)},function(){return[[],[]]});function pA(n,o,d){var T=Rt(n)?Sl:Xd,M=arguments.length<3;return T(n,St(o,4),d,M,Qn)}function mA(n,o,d){var T=Rt(n)?Py:Xd,M=arguments.length<3;return T(n,St(o,4),d,M,bf)}function gA(n,o){var d=Rt(n)?Jn:Ef;return d(n,ra(St(o,3)))}function vA(n){var o=Rt(n)?mf:ub;return o(n)}function yA(n,o,d){(d?Ne(n,o,d):o===s)?o=1:o=Dt(o);var T=Rt(n)?$0:cb;return T(n,o)}function bA(n){var o=Rt(n)?H0:fb;return o(n)}function EA(n){if(n==null)return 0;if(Be(n))return sa(n)?dr(n):n.length;var o=Le(n);return o==ht||o==le?n.size:zl(n).length}function AA(n,o,d){var T=Rt(n)?wl:hb;return d&&Ne(n,o,d)&&(o=s),T(n,St(o,3))}var TA=kt(function(n,o){if(n==null)return[];var d=o.length;return d>1&&Ne(n,o[0],o[1])?o=[]:d>2&&Ne(o[0],o[1],o[2])&&(o=[o[0]]),Mf(n,Me(o,1),[])}),na=n0||function(){return Ce.Date.now()};function OA(n,o){if(typeof o!="function")throw new Qe(r);return n=Dt(n),function(){if(--n<1)return o.apply(this,arguments)}}function Ch(n,o,d){return o=d?s:o,o=n&&o==null?n.length:o,Ln(n,f,s,s,s,s,o)}function Sh(n,o){var d;if(typeof o!="function")throw new Qe(r);return n=Dt(n),function(){return--n>0&&(d=o.apply(this,arguments)),n<=1&&(o=s),d}}var pu=kt(function(n,o,d){var T=w;if(d.length){var M=qn(d,yr(pu));T|=g}return Ln(n,T,o,d,M)}),wh=kt(function(n,o,d){var T=w|P;if(d.length){var M=qn(d,yr(wh));T|=g}return Ln(o,T,n,d,M)});function Ph(n,o,d){o=d?s:o;var T=Ln(n,O,s,s,s,s,s,o);return T.placeholder=Ph.placeholder,T}function xh(n,o,d){o=d?s:o;var T=Ln(n,x,s,s,s,s,s,o);return T.placeholder=xh.placeholder,T}function Ih(n,o,d){var T,M,k,V,K,Q,st=0,at=!1,ut=!1,pt=!0;if(typeof n!="function")throw new Qe(r);o=rn(o)||0,ue(d)&&(at=!!d.leading,ut="maxWait"in d,k=ut?Ae(rn(d.maxWait)||0,o):k,pt="trailing"in d?!!d.trailing:pt);function bt(ve){var hn=T,Bn=M;return T=M=s,st=ve,V=n.apply(Bn,hn),V}function wt(ve){return st=ve,K=fo(Gt,o),at?bt(ve):V}function Ut(ve){var hn=ve-Q,Bn=ve-st,Kh=o-hn;return ut?_e(Kh,k-Bn):Kh}function Pt(ve){var hn=ve-Q,Bn=ve-st;return Q===s||hn>=o||hn<0||ut&&Bn>=k}function Gt(){var ve=na();if(Pt(ve))return jt(ve);K=fo(Gt,Ut(ve))}function jt(ve){return K=s,pt&&T?bt(ve):(T=M=s,V)}function je(){K!==s&&kf(K),st=0,T=Q=M=K=s}function Fe(){return K===s?V:jt(na())}function Je(){var ve=na(),hn=Pt(ve);if(T=arguments,M=this,Q=ve,hn){if(K===s)return wt(Q);if(ut)return kf(K),K=fo(Gt,o),bt(Q)}return K===s&&(K=fo(Gt,o)),V}return Je.cancel=je,Je.flush=Fe,Je}var CA=kt(function(n,o){return yf(n,1,o)}),SA=kt(function(n,o,d){return yf(n,rn(o)||0,d)});function wA(n){return Ln(n,S)}function ia(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Qe(r);var d=function(){var T=arguments,M=o?o.apply(this,T):T[0],k=d.cache;if(k.has(M))return k.get(M);var V=n.apply(this,T);return d.cache=k.set(M,V)||k,V};return d.cache=new(ia.Cache||Rn),d}ia.Cache=Rn;function ra(n){if(typeof n!="function")throw new Qe(r);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function PA(n){return Sh(2,n)}var xA=pb(function(n,o){o=o.length==1&&Rt(o[0])?ae(o[0],We(St())):ae(Me(o,1),We(St()));var d=o.length;return kt(function(T){for(var M=-1,k=_e(T.length,d);++M<k;)T[M]=o[M].call(this,T[M]);return Ge(n,this,T)})}),mu=kt(function(n,o){var d=qn(o,yr(mu));return Ln(n,g,s,o,d)}),Mh=kt(function(n,o){var d=qn(o,yr(Mh));return Ln(n,A,s,o,d)}),IA=Dn(function(n,o){return Ln(n,p,s,s,s,o)});function MA(n,o){if(typeof n!="function")throw new Qe(r);return o=o===s?o:Dt(o),kt(n,o)}function RA(n,o){if(typeof n!="function")throw new Qe(r);return o=o==null?0:Ae(Dt(o),0),kt(function(d){var T=d[o],M=ei(d,0,o);return T&&Kn(M,T),Ge(n,this,M)})}function _A(n,o,d){var T=!0,M=!0;if(typeof n!="function")throw new Qe(r);return ue(d)&&(T="leading"in d?!!d.leading:T,M="trailing"in d?!!d.trailing:M),Ih(n,o,{leading:T,maxWait:o,trailing:M})}function LA(n){return Ch(n,1)}function DA(n,o){return mu(Xl(o),n)}function NA(){if(!arguments.length)return[];var n=arguments[0];return Rt(n)?n:[n]}function FA(n){return tn(n,E)}function UA(n,o){return o=typeof o=="function"?o:s,tn(n,E,o)}function BA(n){return tn(n,m|E)}function kA(n,o){return o=typeof o=="function"?o:s,tn(n,m|E,o)}function $A(n,o){return o==null||vf(n,o,Se(o))}function fn(n,o){return n===o||n!==n&&o!==o}var HA=Zs(Hl),GA=Zs(function(n,o){return n>=o}),Ai=Of(function(){return arguments}())?Of:function(n){return pe(n)&&te.call(n,"callee")&&!uf.call(n,"callee")},Rt=nt.isArray,WA=Wd?We(Wd):Y0;function Be(n){return n!=null&&oa(n.length)&&!Fn(n)}function ge(n){return pe(n)&&Be(n)}function zA(n){return n===!0||n===!1||pe(n)&&De(n)==et}var ni=r0||wu,VA=zd?We(zd):Q0;function jA(n){return pe(n)&&n.nodeType===1&&!ho(n)}function JA(n){if(n==null)return!0;if(Be(n)&&(Rt(n)||typeof n=="string"||typeof n.splice=="function"||ni(n)||br(n)||Ai(n)))return!n.length;var o=Le(n);if(o==ht||o==le)return!n.size;if(co(n))return!zl(n).length;for(var d in n)if(te.call(n,d))return!1;return!0}function KA(n,o){return ao(n,o)}function qA(n,o,d){d=typeof d=="function"?d:s;var T=d?d(n,o):s;return T===s?ao(n,o,s,d):!!T}function gu(n){if(!pe(n))return!1;var o=De(n);return o==Et||o==gt||typeof n.message=="string"&&typeof n.name=="string"&&!ho(n)}function ZA(n){return typeof n=="number"&&df(n)}function Fn(n){if(!ue(n))return!1;var o=De(n);return o==Ct||o==zt||o==j||o==un}function Rh(n){return typeof n=="number"&&n==Dt(n)}function oa(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=$}function ue(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function pe(n){return n!=null&&typeof n=="object"}var _h=Vd?We(Vd):tb;function YA(n,o){return n===o||Wl(n,o,su(o))}function QA(n,o,d){return d=typeof d=="function"?d:s,Wl(n,o,su(o),d)}function XA(n){return Lh(n)&&n!=+n}function tT(n){if(Ub(n))throw new Mt(i);return Cf(n)}function eT(n){return n===null}function nT(n){return n==null}function Lh(n){return typeof n=="number"||pe(n)&&De(n)==Yt}function ho(n){if(!pe(n)||De(n)!=oe)return!1;var o=_s(n);if(o===null)return!0;var d=te.call(o,"constructor")&&o.constructor;return typeof d=="function"&&d instanceof d&&xs.call(d)==Qy}var vu=jd?We(jd):eb;function iT(n){return Rh(n)&&n>=-$&&n<=$}var Dh=Jd?We(Jd):nb;function sa(n){return typeof n=="string"||!Rt(n)&&pe(n)&&De(n)==En}function Ve(n){return typeof n=="symbol"||pe(n)&&De(n)==jn}var br=Kd?We(Kd):ib;function rT(n){return n===s}function oT(n){return pe(n)&&Le(n)==fi}function sT(n){return pe(n)&&De(n)==cl}var aT=Zs(Vl),lT=Zs(function(n,o){return n<=o});function Nh(n){if(!n)return[];if(Be(n))return sa(n)?cn(n):Ue(n);if(Xr&&n[Xr])return $y(n[Xr]());var o=Le(n),d=o==ht?_l:o==le?Ss:Er;return d(n)}function Un(n){if(!n)return n===0?n:0;if(n=rn(n),n===L||n===-L){var o=n<0?-1:1;return o*G}return n===n?n:0}function Dt(n){var o=Un(n),d=o%1;return o===o?d?o-d:o:0}function Fh(n){return n?vi(Dt(n),0,tt):0}function rn(n){if(typeof n=="number")return n;if(Ve(n))return J;if(ue(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=ue(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=tf(n);var d=Wv.test(n);return d||Vv.test(n)?Oy(n.slice(2),d?2:8):Gv.test(n)?J:+n}function Uh(n){return Tn(n,ke(n))}function uT(n){return n?vi(Dt(n),-$,$):n===0?n:0}function Qt(n){return n==null?"":ze(n)}var cT=gr(function(n,o){if(co(o)||Be(o)){Tn(o,Se(o),n);return}for(var d in o)te.call(o,d)&&ro(n,d,o[d])}),Bh=gr(function(n,o){Tn(o,ke(o),n)}),aa=gr(function(n,o,d,T){Tn(o,ke(o),n,T)}),dT=gr(function(n,o,d,T){Tn(o,Se(o),n,T)}),fT=Dn(Bl);function hT(n,o){var d=mr(n);return o==null?d:gf(d,o)}var pT=kt(function(n,o){n=ne(n);var d=-1,T=o.length,M=T>2?o[2]:s;for(M&&Ne(o[0],o[1],M)&&(T=1);++d<T;)for(var k=o[d],V=ke(k),K=-1,Q=V.length;++K<Q;){var st=V[K],at=n[st];(at===s||fn(at,fr[st])&&!te.call(n,st))&&(n[st]=k[st])}return n}),mT=kt(function(n){return n.push(s,eh),Ge(kh,s,n)});function gT(n,o){return Zd(n,St(o,3),An)}function vT(n,o){return Zd(n,St(o,3),$l)}function yT(n,o){return n==null?n:kl(n,St(o,3),ke)}function bT(n,o){return n==null?n:Af(n,St(o,3),ke)}function ET(n,o){return n&&An(n,St(o,3))}function AT(n,o){return n&&$l(n,St(o,3))}function TT(n){return n==null?[]:Gs(n,Se(n))}function OT(n){return n==null?[]:Gs(n,ke(n))}function yu(n,o,d){var T=n==null?s:yi(n,o);return T===s?d:T}function CT(n,o){return n!=null&&rh(n,o,J0)}function bu(n,o){return n!=null&&rh(n,o,K0)}var ST=Zf(function(n,o,d){o!=null&&typeof o.toString!="function"&&(o=Is.call(o)),n[o]=d},Au($e)),wT=Zf(function(n,o,d){o!=null&&typeof o.toString!="function"&&(o=Is.call(o)),te.call(n,o)?n[o].push(d):n[o]=[d]},St),PT=kt(so);function Se(n){return Be(n)?pf(n):zl(n)}function ke(n){return Be(n)?pf(n,!0):rb(n)}function xT(n,o){var d={};return o=St(o,3),An(n,function(T,M,k){_n(d,o(T,M,k),T)}),d}function IT(n,o){var d={};return o=St(o,3),An(n,function(T,M,k){_n(d,M,o(T,M,k))}),d}var MT=gr(function(n,o,d){Ws(n,o,d)}),kh=gr(function(n,o,d,T){Ws(n,o,d,T)}),RT=Dn(function(n,o){var d={};if(n==null)return d;var T=!1;o=ae(o,function(k){return k=ti(k,n),T||(T=k.length>1),k}),Tn(n,ru(n),d),T&&(d=tn(d,m|v|E,Sb));for(var M=o.length;M--;)Zl(d,o[M]);return d});function _T(n,o){return $h(n,ra(St(o)))}var LT=Dn(function(n,o){return n==null?{}:sb(n,o)});function $h(n,o){if(n==null)return{};var d=ae(ru(n),function(T){return[T]});return o=St(o),Rf(n,d,function(T,M){return o(T,M[0])})}function DT(n,o,d){o=ti(o,n);var T=-1,M=o.length;for(M||(M=1,n=s);++T<M;){var k=n==null?s:n[On(o[T])];k===s&&(T=M,k=d),n=Fn(k)?k.call(n):k}return n}function NT(n,o,d){return n==null?n:lo(n,o,d)}function FT(n,o,d,T){return T=typeof T=="function"?T:s,n==null?n:lo(n,o,d,T)}var Hh=Xf(Se),Gh=Xf(ke);function UT(n,o,d){var T=Rt(n),M=T||ni(n)||br(n);if(o=St(o,4),d==null){var k=n&&n.constructor;M?d=T?new k:[]:ue(n)?d=Fn(k)?mr(_s(n)):{}:d={}}return(M?Ye:An)(n,function(V,K,Q){return o(d,V,K,Q)}),d}function BT(n,o){return n==null?!0:Zl(n,o)}function kT(n,o,d){return n==null?n:Ff(n,o,Xl(d))}function $T(n,o,d,T){return T=typeof T=="function"?T:s,n==null?n:Ff(n,o,Xl(d),T)}function Er(n){return n==null?[]:Rl(n,Se(n))}function HT(n){return n==null?[]:Rl(n,ke(n))}function GT(n,o,d){return d===s&&(d=o,o=s),d!==s&&(d=rn(d),d=d===d?d:0),o!==s&&(o=rn(o),o=o===o?o:0),vi(rn(n),o,d)}function WT(n,o,d){return o=Un(o),d===s?(d=o,o=0):d=Un(d),n=rn(n),q0(n,o,d)}function zT(n,o,d){if(d&&typeof d!="boolean"&&Ne(n,o,d)&&(o=d=s),d===s&&(typeof o=="boolean"?(d=o,o=s):typeof n=="boolean"&&(d=n,n=s)),n===s&&o===s?(n=0,o=1):(n=Un(n),o===s?(o=n,n=0):o=Un(o)),n>o){var T=n;n=o,o=T}if(d||n%1||o%1){var M=ff();return _e(n+M*(o-n+Ty("1e-"+((M+"").length-1))),o)}return Jl(n,o)}var VT=vr(function(n,o,d){return o=o.toLowerCase(),n+(d?Wh(o):o)});function Wh(n){return Eu(Qt(n).toLowerCase())}function zh(n){return n=Qt(n),n&&n.replace(Jv,Ny).replace(fy,"")}function jT(n,o,d){n=Qt(n),o=ze(o);var T=n.length;d=d===s?T:vi(Dt(d),0,T);var M=d;return d-=o.length,d>=0&&n.slice(d,M)==o}function JT(n){return n=Qt(n),n&&Pv.test(n)?n.replace(Ed,Fy):n}function KT(n){return n=Qt(n),n&&Lv.test(n)?n.replace(ml,"\\$&"):n}var qT=vr(function(n,o,d){return n+(d?"-":"")+o.toLowerCase()}),ZT=vr(function(n,o,d){return n+(d?" ":"")+o.toLowerCase()}),YT=Jf("toLowerCase");function QT(n,o,d){n=Qt(n),o=Dt(o);var T=o?dr(n):0;if(!o||T>=o)return n;var M=(o-T)/2;return qs(Fs(M),d)+n+qs(Ns(M),d)}function XT(n,o,d){n=Qt(n),o=Dt(o);var T=o?dr(n):0;return o&&T<o?n+qs(o-T,d):n}function tO(n,o,d){n=Qt(n),o=Dt(o);var T=o?dr(n):0;return o&&T<o?qs(o-T,d)+n:n}function eO(n,o,d){return d||o==null?o=0:o&&(o=+o),l0(Qt(n).replace(gl,""),o||0)}function nO(n,o,d){return(d?Ne(n,o,d):o===s)?o=1:o=Dt(o),Kl(Qt(n),o)}function iO(){var n=arguments,o=Qt(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var rO=vr(function(n,o,d){return n+(d?"_":"")+o.toLowerCase()});function oO(n,o,d){return d&&typeof d!="number"&&Ne(n,o,d)&&(o=d=s),d=d===s?tt:d>>>0,d?(n=Qt(n),n&&(typeof o=="string"||o!=null&&!vu(o))&&(o=ze(o),!o&&cr(n))?ei(cn(n),0,d):n.split(o,d)):[]}var sO=vr(function(n,o,d){return n+(d?" ":"")+Eu(o)});function aO(n,o,d){return n=Qt(n),d=d==null?0:vi(Dt(d),0,n.length),o=ze(o),n.slice(d,d+o.length)==o}function lO(n,o,d){var T=U.templateSettings;d&&Ne(n,o,d)&&(o=s),n=Qt(n),o=aa({},o,T,th);var M=aa({},o.imports,T.imports,th),k=Se(M),V=Rl(M,k),K,Q,st=0,at=o.interpolate||Es,ut="__p += '",pt=Ll((o.escape||Es).source+"|"+at.source+"|"+(at===Ad?Hv:Es).source+"|"+(o.evaluate||Es).source+"|$","g"),bt="//# sourceURL="+(te.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++vy+"]")+`
`;n.replace(pt,function(Pt,Gt,jt,je,Fe,Je){return jt||(jt=je),ut+=n.slice(st,Je).replace(Kv,Uy),Gt&&(K=!0,ut+=`' +
__e(`+Gt+`) +
'`),Fe&&(Q=!0,ut+=`';
`+Fe+`;
__p += '`),jt&&(ut+=`' +
((__t = (`+jt+`)) == null ? '' : __t) +
'`),st=Je+Pt.length,Pt}),ut+=`';
`;var wt=te.call(o,"variable")&&o.variable;if(!wt)ut=`with (obj) {
`+ut+`
}
`;else if(kv.test(wt))throw new Mt(a);ut=(Q?ut.replace(Ov,""):ut).replace(Cv,"$1").replace(Sv,"$1;"),ut="function("+(wt||"obj")+`) {
`+(wt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ut+`return __p
}`;var Ut=jh(function(){return Kt(k,bt+"return "+ut).apply(s,V)});if(Ut.source=ut,gu(Ut))throw Ut;return Ut}function uO(n){return Qt(n).toLowerCase()}function cO(n){return Qt(n).toUpperCase()}function dO(n,o,d){if(n=Qt(n),n&&(d||o===s))return tf(n);if(!n||!(o=ze(o)))return n;var T=cn(n),M=cn(o),k=ef(T,M),V=nf(T,M)+1;return ei(T,k,V).join("")}function fO(n,o,d){if(n=Qt(n),n&&(d||o===s))return n.slice(0,of(n)+1);if(!n||!(o=ze(o)))return n;var T=cn(n),M=nf(T,cn(o))+1;return ei(T,0,M).join("")}function hO(n,o,d){if(n=Qt(n),n&&(d||o===s))return n.replace(gl,"");if(!n||!(o=ze(o)))return n;var T=cn(n),M=ef(T,cn(o));return ei(T,M).join("")}function pO(n,o){var d=y,T=I;if(ue(o)){var M="separator"in o?o.separator:M;d="length"in o?Dt(o.length):d,T="omission"in o?ze(o.omission):T}n=Qt(n);var k=n.length;if(cr(n)){var V=cn(n);k=V.length}if(d>=k)return n;var K=d-dr(T);if(K<1)return T;var Q=V?ei(V,0,K).join(""):n.slice(0,K);if(M===s)return Q+T;if(V&&(K+=Q.length-K),vu(M)){if(n.slice(K).search(M)){var st,at=Q;for(M.global||(M=Ll(M.source,Qt(Td.exec(M))+"g")),M.lastIndex=0;st=M.exec(at);)var ut=st.index;Q=Q.slice(0,ut===s?K:ut)}}else if(n.indexOf(ze(M),K)!=K){var pt=Q.lastIndexOf(M);pt>-1&&(Q=Q.slice(0,pt))}return Q+T}function mO(n){return n=Qt(n),n&&wv.test(n)?n.replace(bd,zy):n}var gO=vr(function(n,o,d){return n+(d?" ":"")+o.toUpperCase()}),Eu=Jf("toUpperCase");function Vh(n,o,d){return n=Qt(n),o=d?s:o,o===s?ky(n)?Jy(n):My(n):n.match(o)||[]}var jh=kt(function(n,o){try{return Ge(n,s,o)}catch(d){return gu(d)?d:new Mt(d)}}),vO=Dn(function(n,o){return Ye(o,function(d){d=On(d),_n(n,d,pu(n[d],n))}),n});function yO(n){var o=n==null?0:n.length,d=St();return n=o?ae(n,function(T){if(typeof T[1]!="function")throw new Qe(r);return[d(T[0]),T[1]]}):[],kt(function(T){for(var M=-1;++M<o;){var k=n[M];if(Ge(k[0],this,T))return Ge(k[1],this,T)}})}function bO(n){return z0(tn(n,m))}function Au(n){return function(){return n}}function EO(n,o){return n==null||n!==n?o:n}var AO=qf(),TO=qf(!0);function $e(n){return n}function Tu(n){return Sf(typeof n=="function"?n:tn(n,m))}function OO(n){return Pf(tn(n,m))}function CO(n,o){return xf(n,tn(o,m))}var SO=kt(function(n,o){return function(d){return so(d,n,o)}}),wO=kt(function(n,o){return function(d){return so(n,d,o)}});function Ou(n,o,d){var T=Se(o),M=Gs(o,T);d==null&&!(ue(o)&&(M.length||!T.length))&&(d=o,o=n,n=this,M=Gs(o,Se(o)));var k=!(ue(d)&&"chain"in d)||!!d.chain,V=Fn(n);return Ye(M,function(K){var Q=o[K];n[K]=Q,V&&(n.prototype[K]=function(){var st=this.__chain__;if(k||st){var at=n(this.__wrapped__),ut=at.__actions__=Ue(this.__actions__);return ut.push({func:Q,args:arguments,thisArg:n}),at.__chain__=st,at}return Q.apply(n,Kn([this.value()],arguments))})}),n}function PO(){return Ce._===this&&(Ce._=Xy),this}function Cu(){}function xO(n){return n=Dt(n),kt(function(o){return If(o,n)})}var IO=eu(ae),MO=eu(qd),RO=eu(wl);function Jh(n){return lu(n)?Pl(On(n)):ab(n)}function _O(n){return function(o){return n==null?s:yi(n,o)}}var LO=Yf(),DO=Yf(!0);function Su(){return[]}function wu(){return!1}function NO(){return{}}function FO(){return""}function UO(){return!0}function BO(n,o){if(n=Dt(n),n<1||n>$)return[];var d=tt,T=_e(n,tt);o=St(o),n-=tt;for(var M=Ml(T,o);++d<n;)o(d);return M}function kO(n){return Rt(n)?ae(n,On):Ve(n)?[n]:Ue(hh(Qt(n)))}function $O(n){var o=++Yy;return Qt(n)+o}var HO=Ks(function(n,o){return n+o},0),GO=nu("ceil"),WO=Ks(function(n,o){return n/o},1),zO=nu("floor");function VO(n){return n&&n.length?Hs(n,$e,Hl):s}function jO(n,o){return n&&n.length?Hs(n,St(o,2),Hl):s}function JO(n){return Qd(n,$e)}function KO(n,o){return Qd(n,St(o,2))}function qO(n){return n&&n.length?Hs(n,$e,Vl):s}function ZO(n,o){return n&&n.length?Hs(n,St(o,2),Vl):s}var YO=Ks(function(n,o){return n*o},1),QO=nu("round"),XO=Ks(function(n,o){return n-o},0);function tC(n){return n&&n.length?Il(n,$e):0}function eC(n,o){return n&&n.length?Il(n,St(o,2)):0}return U.after=OA,U.ary=Ch,U.assign=cT,U.assignIn=Bh,U.assignInWith=aa,U.assignWith=dT,U.at=fT,U.before=Sh,U.bind=pu,U.bindAll=vO,U.bindKey=wh,U.castArray=NA,U.chain=Ah,U.chunk=zb,U.compact=Vb,U.concat=jb,U.cond=yO,U.conforms=bO,U.constant=Au,U.countBy=tA,U.create=hT,U.curry=Ph,U.curryRight=xh,U.debounce=Ih,U.defaults=pT,U.defaultsDeep=mT,U.defer=CA,U.delay=SA,U.difference=Jb,U.differenceBy=Kb,U.differenceWith=qb,U.drop=Zb,U.dropRight=Yb,U.dropRightWhile=Qb,U.dropWhile=Xb,U.fill=tE,U.filter=nA,U.flatMap=oA,U.flatMapDeep=sA,U.flatMapDepth=aA,U.flatten=vh,U.flattenDeep=eE,U.flattenDepth=nE,U.flip=wA,U.flow=AO,U.flowRight=TO,U.fromPairs=iE,U.functions=TT,U.functionsIn=OT,U.groupBy=lA,U.initial=oE,U.intersection=sE,U.intersectionBy=aE,U.intersectionWith=lE,U.invert=ST,U.invertBy=wT,U.invokeMap=cA,U.iteratee=Tu,U.keyBy=dA,U.keys=Se,U.keysIn=ke,U.map=ea,U.mapKeys=xT,U.mapValues=IT,U.matches=OO,U.matchesProperty=CO,U.memoize=ia,U.merge=MT,U.mergeWith=kh,U.method=SO,U.methodOf=wO,U.mixin=Ou,U.negate=ra,U.nthArg=xO,U.omit=RT,U.omitBy=_T,U.once=PA,U.orderBy=fA,U.over=IO,U.overArgs=xA,U.overEvery=MO,U.overSome=RO,U.partial=mu,U.partialRight=Mh,U.partition=hA,U.pick=LT,U.pickBy=$h,U.property=Jh,U.propertyOf=_O,U.pull=fE,U.pullAll=bh,U.pullAllBy=hE,U.pullAllWith=pE,U.pullAt=mE,U.range=LO,U.rangeRight=DO,U.rearg=IA,U.reject=gA,U.remove=gE,U.rest=MA,U.reverse=fu,U.sampleSize=yA,U.set=NT,U.setWith=FT,U.shuffle=bA,U.slice=vE,U.sortBy=TA,U.sortedUniq=CE,U.sortedUniqBy=SE,U.split=oO,U.spread=RA,U.tail=wE,U.take=PE,U.takeRight=xE,U.takeRightWhile=IE,U.takeWhile=ME,U.tap=VE,U.throttle=_A,U.thru=ta,U.toArray=Nh,U.toPairs=Hh,U.toPairsIn=Gh,U.toPath=kO,U.toPlainObject=Uh,U.transform=UT,U.unary=LA,U.union=RE,U.unionBy=_E,U.unionWith=LE,U.uniq=DE,U.uniqBy=NE,U.uniqWith=FE,U.unset=BT,U.unzip=hu,U.unzipWith=Eh,U.update=kT,U.updateWith=$T,U.values=Er,U.valuesIn=HT,U.without=UE,U.words=Vh,U.wrap=DA,U.xor=BE,U.xorBy=kE,U.xorWith=$E,U.zip=HE,U.zipObject=GE,U.zipObjectDeep=WE,U.zipWith=zE,U.entries=Hh,U.entriesIn=Gh,U.extend=Bh,U.extendWith=aa,Ou(U,U),U.add=HO,U.attempt=jh,U.camelCase=VT,U.capitalize=Wh,U.ceil=GO,U.clamp=GT,U.clone=FA,U.cloneDeep=BA,U.cloneDeepWith=kA,U.cloneWith=UA,U.conformsTo=$A,U.deburr=zh,U.defaultTo=EO,U.divide=WO,U.endsWith=jT,U.eq=fn,U.escape=JT,U.escapeRegExp=KT,U.every=eA,U.find=iA,U.findIndex=mh,U.findKey=gT,U.findLast=rA,U.findLastIndex=gh,U.findLastKey=vT,U.floor=zO,U.forEach=Th,U.forEachRight=Oh,U.forIn=yT,U.forInRight=bT,U.forOwn=ET,U.forOwnRight=AT,U.get=yu,U.gt=HA,U.gte=GA,U.has=CT,U.hasIn=bu,U.head=yh,U.identity=$e,U.includes=uA,U.indexOf=rE,U.inRange=WT,U.invoke=PT,U.isArguments=Ai,U.isArray=Rt,U.isArrayBuffer=WA,U.isArrayLike=Be,U.isArrayLikeObject=ge,U.isBoolean=zA,U.isBuffer=ni,U.isDate=VA,U.isElement=jA,U.isEmpty=JA,U.isEqual=KA,U.isEqualWith=qA,U.isError=gu,U.isFinite=ZA,U.isFunction=Fn,U.isInteger=Rh,U.isLength=oa,U.isMap=_h,U.isMatch=YA,U.isMatchWith=QA,U.isNaN=XA,U.isNative=tT,U.isNil=nT,U.isNull=eT,U.isNumber=Lh,U.isObject=ue,U.isObjectLike=pe,U.isPlainObject=ho,U.isRegExp=vu,U.isSafeInteger=iT,U.isSet=Dh,U.isString=sa,U.isSymbol=Ve,U.isTypedArray=br,U.isUndefined=rT,U.isWeakMap=oT,U.isWeakSet=sT,U.join=uE,U.kebabCase=qT,U.last=nn,U.lastIndexOf=cE,U.lowerCase=ZT,U.lowerFirst=YT,U.lt=aT,U.lte=lT,U.max=VO,U.maxBy=jO,U.mean=JO,U.meanBy=KO,U.min=qO,U.minBy=ZO,U.stubArray=Su,U.stubFalse=wu,U.stubObject=NO,U.stubString=FO,U.stubTrue=UO,U.multiply=YO,U.nth=dE,U.noConflict=PO,U.noop=Cu,U.now=na,U.pad=QT,U.padEnd=XT,U.padStart=tO,U.parseInt=eO,U.random=zT,U.reduce=pA,U.reduceRight=mA,U.repeat=nO,U.replace=iO,U.result=DT,U.round=QO,U.runInContext=Z,U.sample=vA,U.size=EA,U.snakeCase=rO,U.some=AA,U.sortedIndex=yE,U.sortedIndexBy=bE,U.sortedIndexOf=EE,U.sortedLastIndex=AE,U.sortedLastIndexBy=TE,U.sortedLastIndexOf=OE,U.startCase=sO,U.startsWith=aO,U.subtract=XO,U.sum=tC,U.sumBy=eC,U.template=lO,U.times=BO,U.toFinite=Un,U.toInteger=Dt,U.toLength=Fh,U.toLower=uO,U.toNumber=rn,U.toSafeInteger=uT,U.toString=Qt,U.toUpper=cO,U.trim=dO,U.trimEnd=fO,U.trimStart=hO,U.truncate=pO,U.unescape=mO,U.uniqueId=$O,U.upperCase=gO,U.upperFirst=Eu,U.each=Th,U.eachRight=Oh,U.first=yh,Ou(U,function(){var n={};return An(U,function(o,d){te.call(U.prototype,d)||(n[d]=o)}),n}(),{chain:!1}),U.VERSION=e,Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){U[n].placeholder=U}),Ye(["drop","take"],function(n,o){Vt.prototype[n]=function(d){d=d===s?1:Ae(Dt(d),0);var T=this.__filtered__&&!o?new Vt(this):this.clone();return T.__filtered__?T.__takeCount__=_e(d,T.__takeCount__):T.__views__.push({size:_e(d,tt),type:n+(T.__dir__<0?"Right":"")}),T},Vt.prototype[n+"Right"]=function(d){return this.reverse()[n](d).reverse()}}),Ye(["filter","map","takeWhile"],function(n,o){var d=o+1,T=d==W||d==R;Vt.prototype[n]=function(M){var k=this.clone();return k.__iteratees__.push({iteratee:St(M,3),type:d}),k.__filtered__=k.__filtered__||T,k}}),Ye(["head","last"],function(n,o){var d="take"+(o?"Right":"");Vt.prototype[n]=function(){return this[d](1).value()[0]}}),Ye(["initial","tail"],function(n,o){var d="drop"+(o?"":"Right");Vt.prototype[n]=function(){return this.__filtered__?new Vt(this):this[d](1)}}),Vt.prototype.compact=function(){return this.filter($e)},Vt.prototype.find=function(n){return this.filter(n).head()},Vt.prototype.findLast=function(n){return this.reverse().find(n)},Vt.prototype.invokeMap=kt(function(n,o){return typeof n=="function"?new Vt(this):this.map(function(d){return so(d,n,o)})}),Vt.prototype.reject=function(n){return this.filter(ra(St(n)))},Vt.prototype.slice=function(n,o){n=Dt(n);var d=this;return d.__filtered__&&(n>0||o<0)?new Vt(d):(n<0?d=d.takeRight(-n):n&&(d=d.drop(n)),o!==s&&(o=Dt(o),d=o<0?d.dropRight(-o):d.take(o-n)),d)},Vt.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},Vt.prototype.toArray=function(){return this.take(tt)},An(Vt.prototype,function(n,o){var d=/^(?:filter|find|map|reject)|While$/.test(o),T=/^(?:head|last)$/.test(o),M=U[T?"take"+(o=="last"?"Right":""):o],k=T||/^find/.test(o);!M||(U.prototype[o]=function(){var V=this.__wrapped__,K=T?[1]:arguments,Q=V instanceof Vt,st=K[0],at=Q||Rt(V),ut=function(Gt){var jt=M.apply(U,Kn([Gt],K));return T&&pt?jt[0]:jt};at&&d&&typeof st=="function"&&st.length!=1&&(Q=at=!1);var pt=this.__chain__,bt=!!this.__actions__.length,wt=k&&!pt,Ut=Q&&!bt;if(!k&&at){V=Ut?V:new Vt(this);var Pt=n.apply(V,K);return Pt.__actions__.push({func:ta,args:[ut],thisArg:s}),new Xe(Pt,pt)}return wt&&Ut?n.apply(this,K):(Pt=this.thru(ut),wt?T?Pt.value()[0]:Pt.value():Pt)})}),Ye(["pop","push","shift","sort","splice","unshift"],function(n){var o=ws[n],d=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",T=/^(?:pop|shift)$/.test(n);U.prototype[n]=function(){var M=arguments;if(T&&!this.__chain__){var k=this.value();return o.apply(Rt(k)?k:[],M)}return this[d](function(V){return o.apply(Rt(V)?V:[],M)})}}),An(Vt.prototype,function(n,o){var d=U[o];if(d){var T=d.name+"";te.call(pr,T)||(pr[T]=[]),pr[T].push({name:o,func:d})}}),pr[Js(s,P).name]=[{name:"wrapper",func:s}],Vt.prototype.clone=m0,Vt.prototype.reverse=g0,Vt.prototype.value=v0,U.prototype.at=jE,U.prototype.chain=JE,U.prototype.commit=KE,U.prototype.next=qE,U.prototype.plant=YE,U.prototype.reverse=QE,U.prototype.toJSON=U.prototype.valueOf=U.prototype.value=XE,U.prototype.first=U.prototype.head,Xr&&(U.prototype[Xr]=ZE),U},Zn=Ky();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Ce._=Zn,define(function(){return Zn})):hi?((hi.exports=Zn)._=Zn,Tl._=Zn):Ce._=Zn}).call(Sr)});var Hp=ye((So,$u)=>{D();(function(s,e){typeof So=="object"&&typeof $u=="object"?$u.exports=e():typeof define=="function"&&define.amd?define([],e):typeof So=="object"?So.bowser=e():s.bowser=e()})(So,function(){return function(s){var e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={i,l:!1,exports:{}};return s[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=s,t.c=e,t.d=function(i,r,a){t.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:a})},t.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,r){if(1&r&&(i=t(i)),8&r||4&r&&typeof i=="object"&&i&&i.__esModule)return i;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:i}),2&r&&typeof i!="string")for(var l in i)t.d(a,l,function(u){return i[u]}.bind(null,l));return a},t.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(r,"a",r),r},t.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},t.p="",t(t.s=90)}({17:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i=t(18),r=function(){function a(){}return a.getFirstMatch=function(l,u){var c=u.match(l);return c&&c.length>0&&c[1]||""},a.getSecondMatch=function(l,u){var c=u.match(l);return c&&c.length>1&&c[2]||""},a.matchAndReturnConst=function(l,u,c){if(l.test(u))return c},a.getWindowsVersionName=function(l){switch(l){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},a.getMacOSVersionName=function(l){var u=l.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(u.push(0),u[0]===10)switch(u[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},a.getAndroidVersionName=function(l){var u=l.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(u.push(0),!(u[0]===1&&u[1]<5))return u[0]===1&&u[1]<6?"Cupcake":u[0]===1&&u[1]>=6?"Donut":u[0]===2&&u[1]<2?"Eclair":u[0]===2&&u[1]===2?"Froyo":u[0]===2&&u[1]>2?"Gingerbread":u[0]===3?"Honeycomb":u[0]===4&&u[1]<1?"Ice Cream Sandwich":u[0]===4&&u[1]<4?"Jelly Bean":u[0]===4&&u[1]>=4?"KitKat":u[0]===5?"Lollipop":u[0]===6?"Marshmallow":u[0]===7?"Nougat":u[0]===8?"Oreo":u[0]===9?"Pie":void 0},a.getVersionPrecision=function(l){return l.split(".").length},a.compareVersions=function(l,u,c){c===void 0&&(c=!1);var m=a.getVersionPrecision(l),v=a.getVersionPrecision(u),E=Math.max(m,v),h=0,b=a.map([l,u],function(w){var P=E-a.getVersionPrecision(w),C=w+new Array(P+1).join(".0");return a.map(C.split("."),function(O){return new Array(20-O.length).join("0")+O}).reverse()});for(c&&(h=E-Math.min(m,v)),E-=1;E>=h;){if(b[0][E]>b[1][E])return 1;if(b[0][E]===b[1][E]){if(E===h)return 0;E-=1}else if(b[0][E]<b[1][E])return-1}},a.map=function(l,u){var c,m=[];if(Array.prototype.map)return Array.prototype.map.call(l,u);for(c=0;c<l.length;c+=1)m.push(u(l[c]));return m},a.find=function(l,u){var c,m;if(Array.prototype.find)return Array.prototype.find.call(l,u);for(c=0,m=l.length;c<m;c+=1){var v=l[c];if(u(v,c))return v}},a.assign=function(l){for(var u,c,m=l,v=arguments.length,E=new Array(v>1?v-1:0),h=1;h<v;h++)E[h-1]=arguments[h];if(Object.assign)return Object.assign.apply(Object,[l].concat(E));var b=function(){var w=E[u];typeof w=="object"&&w!==null&&Object.keys(w).forEach(function(P){m[P]=w[P]})};for(u=0,c=E.length;u<c;u+=1)b();return l},a.getBrowserAlias=function(l){return i.BROWSER_ALIASES_MAP[l]},a.getBrowserTypeByAlias=function(l){return i.BROWSER_MAP[l]||""},a}();e.default=r,s.exports=e.default},18:function(s,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=t(91))&&i.__esModule?i:{default:i},a=t(18);function l(c,m){for(var v=0;v<m.length;v++){var E=m[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(c,E.key,E)}}var u=function(){function c(){}var m,v,E;return c.getParser=function(h,b){if(b===void 0&&(b=!1),typeof h!="string")throw new Error("UserAgent should be a string");return new r.default(h,b)},c.parse=function(h){return new r.default(h).getResult()},m=c,E=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(v=null)&&l(m.prototype,v),E&&l(m,E),c}();e.default=u,s.exports=e.default},91:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i=c(t(92)),r=c(t(93)),a=c(t(94)),l=c(t(95)),u=c(t(17));function c(v){return v&&v.__esModule?v:{default:v}}var m=function(){function v(h,b){if(b===void 0&&(b=!1),h==null||h==="")throw new Error("UserAgent parameter can't be empty");this._ua=h,this.parsedResult={},b!==!0&&this.parse()}var E=v.prototype;return E.getUA=function(){return this._ua},E.test=function(h){return h.test(this._ua)},E.parseBrowser=function(){var h=this;this.parsedResult.browser={};var b=u.default.find(i.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(P){return h.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.browser=b.describe(this.getUA())),this.parsedResult.browser},E.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},E.getBrowserName=function(h){return h?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},E.getBrowserVersion=function(){return this.getBrowser().version},E.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},E.parseOS=function(){var h=this;this.parsedResult.os={};var b=u.default.find(r.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(P){return h.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.os=b.describe(this.getUA())),this.parsedResult.os},E.getOSName=function(h){var b=this.getOS().name;return h?String(b).toLowerCase()||"":b||""},E.getOSVersion=function(){return this.getOS().version},E.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},E.getPlatformType=function(h){h===void 0&&(h=!1);var b=this.getPlatform().type;return h?String(b).toLowerCase()||"":b||""},E.parsePlatform=function(){var h=this;this.parsedResult.platform={};var b=u.default.find(a.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(P){return h.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.platform=b.describe(this.getUA())),this.parsedResult.platform},E.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},E.getEngineName=function(h){return h?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},E.parseEngine=function(){var h=this;this.parsedResult.engine={};var b=u.default.find(l.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(P){return h.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.engine=b.describe(this.getUA())),this.parsedResult.engine},E.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},E.getResult=function(){return u.default.assign({},this.parsedResult)},E.satisfies=function(h){var b=this,w={},P=0,C={},O=0;if(Object.keys(h).forEach(function(I){var F=h[I];typeof F=="string"?(C[I]=F,O+=1):typeof F=="object"&&(w[I]=F,P+=1)}),P>0){var x=Object.keys(w),g=u.default.find(x,function(I){return b.isOS(I)});if(g){var A=this.satisfies(w[g]);if(A!==void 0)return A}var f=u.default.find(x,function(I){return b.isPlatform(I)});if(f){var p=this.satisfies(w[f]);if(p!==void 0)return p}}if(O>0){var S=Object.keys(C),y=u.default.find(S,function(I){return b.isBrowser(I,!0)});if(y!==void 0)return this.compareVersion(C[y])}},E.isBrowser=function(h,b){b===void 0&&(b=!1);var w=this.getBrowserName().toLowerCase(),P=h.toLowerCase(),C=u.default.getBrowserTypeByAlias(P);return b&&C&&(P=C.toLowerCase()),P===w},E.compareVersion=function(h){var b=[0],w=h,P=!1,C=this.getBrowserVersion();if(typeof C=="string")return h[0]===">"||h[0]==="<"?(w=h.substr(1),h[1]==="="?(P=!0,w=h.substr(2)):b=[],h[0]===">"?b.push(1):b.push(-1)):h[0]==="="?w=h.substr(1):h[0]==="~"&&(P=!0,w=h.substr(1)),b.indexOf(u.default.compareVersions(C,w,P))>-1},E.isOS=function(h){return this.getOSName(!0)===String(h).toLowerCase()},E.isPlatform=function(h){return this.getPlatformType(!0)===String(h).toLowerCase()},E.isEngine=function(h){return this.getEngineName(!0)===String(h).toLowerCase()},E.is=function(h,b){return b===void 0&&(b=!1),this.isBrowser(h,b)||this.isOS(h)||this.isPlatform(h)},E.some=function(h){var b=this;return h===void 0&&(h=[]),h.some(function(w){return b.is(w)})},v}();e.default=m,s.exports=e.default},92:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=t(17))&&i.__esModule?i:{default:i},a=/version\/(\d+(\.?_?\d+)+)/i,l=[{test:[/googlebot/i],describe:function(u){var c={name:"Googlebot"},m=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/opera/i],describe:function(u){var c={name:"Opera"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/opr\/|opios/i],describe:function(u){var c={name:"Opera"},m=r.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/SamsungBrowser/i],describe:function(u){var c={name:"Samsung Internet for Android"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/Whale/i],describe:function(u){var c={name:"NAVER Whale Browser"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/MZBrowser/i],describe:function(u){var c={name:"MZ Browser"},m=r.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/focus/i],describe:function(u){var c={name:"Focus"},m=r.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/swing/i],describe:function(u){var c={name:"Swing"},m=r.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/coast/i],describe:function(u){var c={name:"Opera Coast"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(u){var c={name:"Opera Touch"},m=r.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/yabrowser/i],describe:function(u){var c={name:"Yandex Browser"},m=r.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/ucbrowser/i],describe:function(u){var c={name:"UC Browser"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/Maxthon|mxios/i],describe:function(u){var c={name:"Maxthon"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/epiphany/i],describe:function(u){var c={name:"Epiphany"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/puffin/i],describe:function(u){var c={name:"Puffin"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/sleipnir/i],describe:function(u){var c={name:"Sleipnir"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/k-meleon/i],describe:function(u){var c={name:"K-Meleon"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/micromessenger/i],describe:function(u){var c={name:"WeChat"},m=r.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/qqbrowser/i],describe:function(u){var c={name:/qqbrowserlite/i.test(u)?"QQ Browser Lite":"QQ Browser"},m=r.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/msie|trident/i],describe:function(u){var c={name:"Internet Explorer"},m=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/\sedg\//i],describe:function(u){var c={name:"Microsoft Edge"},m=r.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/edg([ea]|ios)/i],describe:function(u){var c={name:"Microsoft Edge"},m=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/vivaldi/i],describe:function(u){var c={name:"Vivaldi"},m=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/seamonkey/i],describe:function(u){var c={name:"SeaMonkey"},m=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/sailfish/i],describe:function(u){var c={name:"Sailfish"},m=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,u);return m&&(c.version=m),c}},{test:[/silk/i],describe:function(u){var c={name:"Amazon Silk"},m=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/phantom/i],describe:function(u){var c={name:"PhantomJS"},m=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/slimerjs/i],describe:function(u){var c={name:"SlimerJS"},m=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var c={name:"BlackBerry"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var c={name:"WebOS Browser"},m=r.default.getFirstMatch(a,u)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/bada/i],describe:function(u){var c={name:"Bada"},m=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/tizen/i],describe:function(u){var c={name:"Tizen"},m=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/qupzilla/i],describe:function(u){var c={name:"QupZilla"},m=r.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/firefox|iceweasel|fxios/i],describe:function(u){var c={name:"Firefox"},m=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/electron/i],describe:function(u){var c={name:"Electron"},m=r.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/MiuiBrowser/i],describe:function(u){var c={name:"Miui"},m=r.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/chromium/i],describe:function(u){var c={name:"Chromium"},m=r.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,u)||r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/chrome|crios|crmo/i],describe:function(u){var c={name:"Chrome"},m=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/GSA/i],describe:function(u){var c={name:"Google Search"},m=r.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:function(u){var c=!u.test(/like android/i),m=u.test(/android/i);return c&&m},describe:function(u){var c={name:"Android Browser"},m=r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/playstation 4/i],describe:function(u){var c={name:"PlayStation 4"},m=r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/safari|applewebkit/i],describe:function(u){var c={name:"Safari"},m=r.default.getFirstMatch(a,u);return m&&(c.version=m),c}},{test:[/.*/i],describe:function(u){var c=u.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:r.default.getFirstMatch(c,u),version:r.default.getSecondMatch(c,u)}}}];e.default=l,s.exports=e.default},93:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=t(17))&&i.__esModule?i:{default:i},a=t(18),l=[{test:[/Roku\/DVP/],describe:function(u){var c=r.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,u);return{name:a.OS_MAP.Roku,version:c}}},{test:[/windows phone/i],describe:function(u){var c=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.WindowsPhone,version:c}}},{test:[/windows /i],describe:function(u){var c=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,u),m=r.default.getWindowsVersionName(c);return{name:a.OS_MAP.Windows,version:c,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(u){var c={name:a.OS_MAP.iOS},m=r.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,u);return m&&(c.version=m),c}},{test:[/macintosh/i],describe:function(u){var c=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,u).replace(/[_\s]/g,"."),m=r.default.getMacOSVersionName(c),v={name:a.OS_MAP.MacOS,version:c};return m&&(v.versionName=m),v}},{test:[/(ipod|iphone|ipad)/i],describe:function(u){var c=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,u).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:c}}},{test:function(u){var c=!u.test(/like android/i),m=u.test(/android/i);return c&&m},describe:function(u){var c=r.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,u),m=r.default.getAndroidVersionName(c),v={name:a.OS_MAP.Android,version:c};return m&&(v.versionName=m),v}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var c=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,u),m={name:a.OS_MAP.WebOS};return c&&c.length&&(m.version=c),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var c=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,u)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,u)||r.default.getFirstMatch(/\bbb(\d+)/i,u);return{name:a.OS_MAP.BlackBerry,version:c}}},{test:[/bada/i],describe:function(u){var c=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Bada,version:c}}},{test:[/tizen/i],describe:function(u){var c=r.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Tizen,version:c}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(u){var c=r.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.PlayStation4,version:c}}}];e.default=l,s.exports=e.default},94:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=t(17))&&i.__esModule?i:{default:i},a=t(18),l=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(u){var c=r.default.getFirstMatch(/(can-l01)/i,u)&&"Nova",m={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return c&&(m.model=c),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){var c=u.test(/ipod|iphone/i),m=u.test(/like (ipod|iphone)/i);return c&&!m},describe:function(u){var c=r.default.getFirstMatch(/(ipod|iphone)/i,u);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:c}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName(!0)==="blackberry"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(u){return u.getBrowserName(!0)==="bada"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName()==="windows phone"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(u){var c=Number(String(u.getOSVersion()).split(".")[0]);return u.getOSName(!0)==="android"&&c>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){return u.getOSName(!0)==="android"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getOSName(!0)==="macos"},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(u){return u.getOSName(!0)==="windows"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="linux"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="playstation 4"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(u){return u.getOSName(!0)==="roku"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];e.default=l,s.exports=e.default},95:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,r=(i=t(17))&&i.__esModule?i:{default:i},a=t(18),l=[{test:function(u){return u.getBrowserName(!0)==="microsoft edge"},describe:function(u){if(/\sedg\//i.test(u))return{name:a.ENGINE_MAP.Blink};var c=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,u);return{name:a.ENGINE_MAP.EdgeHTML,version:c}}},{test:[/trident/i],describe:function(u){var c={name:a.ENGINE_MAP.Trident},m=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:function(u){return u.test(/presto/i)},describe:function(u){var c={name:a.ENGINE_MAP.Presto},m=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:function(u){var c=u.test(/gecko/i),m=u.test(/like gecko/i);return c&&!m},describe:function(u){var c={name:a.ENGINE_MAP.Gecko},m=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(u){var c={name:a.ENGINE_MAP.WebKit},m=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,u);return m&&(c.version=m),c}}];e.default=l,s.exports=e.default}})})});var Vp={};Xh(Vp,{version:()=>mS});var mS,jp=Iu(()=>{D();mS="lab"});var Jp={};Xh(Jp,{default:()=>gS});var gS,Kp=Iu(()=>{D();gS={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var qp=ye((Oa,zu)=>{D();(function(e,t){typeof Oa=="object"&&typeof zu=="object"?zu.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Oa=="object"?Oa.Ably=t():e.Ably=t()})(window,function(){return function(s){var e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={i,l:!1,exports:{}};return s[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=s,t.c=e,t.d=function(i,r,a){t.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:a})},t.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,r){if(r&1&&(i=t(i)),r&8||r&4&&typeof i=="object"&&i&&i.__esModule)return i;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:i}),r&2&&typeof i!="string")for(var l in i)t.d(a,l,function(u){return i[u]}.bind(null,l));return a},t.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(r,"a",r),r},t.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},t.p="",t(t.s=42)}([function(s,e,t){"use strict";t.r(e),t.d(e,"__extends",function(){return r}),t.d(e,"__assign",function(){return a}),t.d(e,"__rest",function(){return l}),t.d(e,"__decorate",function(){return u}),t.d(e,"__param",function(){return c}),t.d(e,"__metadata",function(){return m}),t.d(e,"__awaiter",function(){return v}),t.d(e,"__generator",function(){return E}),t.d(e,"__createBinding",function(){return h}),t.d(e,"__exportStar",function(){return b}),t.d(e,"__values",function(){return w}),t.d(e,"__read",function(){return P}),t.d(e,"__spread",function(){return C}),t.d(e,"__spreadArrays",function(){return O}),t.d(e,"__spreadArray",function(){return x}),t.d(e,"__await",function(){return g}),t.d(e,"__asyncGenerator",function(){return A}),t.d(e,"__asyncDelegator",function(){return f}),t.d(e,"__asyncValues",function(){return p}),t.d(e,"__makeTemplateObject",function(){return S}),t.d(e,"__importStar",function(){return I}),t.d(e,"__importDefault",function(){return F}),t.d(e,"__classPrivateFieldGet",function(){return z}),t.d(e,"__classPrivateFieldSet",function(){return W});var i=function(N,R){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,$){L.__proto__=$}||function(L,$){for(var G in $)Object.prototype.hasOwnProperty.call($,G)&&(L[G]=$[G])},i(N,R)};function r(N,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");i(N,R);function L(){this.constructor=N}N.prototype=R===null?Object.create(R):(L.prototype=R.prototype,new L)}var a=function(){return a=Object.assign||function(R){for(var L,$=1,G=arguments.length;$<G;$++){L=arguments[$];for(var J in L)Object.prototype.hasOwnProperty.call(L,J)&&(R[J]=L[J])}return R},a.apply(this,arguments)};function l(N,R){var L={};for(var $ in N)Object.prototype.hasOwnProperty.call(N,$)&&R.indexOf($)<0&&(L[$]=N[$]);if(N!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,$=Object.getOwnPropertySymbols(N);G<$.length;G++)R.indexOf($[G])<0&&Object.prototype.propertyIsEnumerable.call(N,$[G])&&(L[$[G]]=N[$[G]]);return L}function u(N,R,L,$){var G=arguments.length,J=G<3?R:$===null?$=Object.getOwnPropertyDescriptor(R,L):$,tt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(N,R,L,$);else for(var it=N.length-1;it>=0;it--)(tt=N[it])&&(J=(G<3?tt(J):G>3?tt(R,L,J):tt(R,L))||J);return G>3&&J&&Object.defineProperty(R,L,J),J}function c(N,R){return function(L,$){R(L,$,N)}}function m(N,R){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(N,R)}function v(N,R,L,$){function G(J){return J instanceof L?J:new L(function(tt){tt(J)})}return new(L||(L=Promise))(function(J,tt){function it(B){try{_($.next(B))}catch(H){tt(H)}}function X(B){try{_($.throw(B))}catch(H){tt(H)}}function _(B){B.done?J(B.value):G(B.value).then(it,X)}_(($=$.apply(N,R||[])).next())})}function E(N,R){var L={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},$,G,J,tt;return tt={next:it(0),throw:it(1),return:it(2)},typeof Symbol=="function"&&(tt[Symbol.iterator]=function(){return this}),tt;function it(_){return function(B){return X([_,B])}}function X(_){if($)throw new TypeError("Generator is already executing.");for(;L;)try{if($=1,G&&(J=_[0]&2?G.return:_[0]?G.throw||((J=G.return)&&J.call(G),0):G.next)&&!(J=J.call(G,_[1])).done)return J;switch(G=0,J&&(_=[_[0]&2,J.value]),_[0]){case 0:case 1:J=_;break;case 4:return L.label++,{value:_[1],done:!1};case 5:L.label++,G=_[1],_=[0];continue;case 7:_=L.ops.pop(),L.trys.pop();continue;default:if(J=L.trys,!(J=J.length>0&&J[J.length-1])&&(_[0]===6||_[0]===2)){L=0;continue}if(_[0]===3&&(!J||_[1]>J[0]&&_[1]<J[3])){L.label=_[1];break}if(_[0]===6&&L.label<J[1]){L.label=J[1],J=_;break}if(J&&L.label<J[2]){L.label=J[2],L.ops.push(_);break}J[2]&&L.ops.pop(),L.trys.pop();continue}_=R.call(N,L)}catch(B){_=[6,B],G=0}finally{$=J=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var h=Object.create?function(N,R,L,$){$===void 0&&($=L),Object.defineProperty(N,$,{enumerable:!0,get:function(){return R[L]}})}:function(N,R,L,$){$===void 0&&($=L),N[$]=R[L]};function b(N,R){for(var L in N)L!=="default"&&!Object.prototype.hasOwnProperty.call(R,L)&&h(R,N,L)}function w(N){var R=typeof Symbol=="function"&&Symbol.iterator,L=R&&N[R],$=0;if(L)return L.call(N);if(N&&typeof N.length=="number")return{next:function(){return N&&$>=N.length&&(N=void 0),{value:N&&N[$++],done:!N}}};throw new TypeError(R?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(N,R){var L=typeof Symbol=="function"&&N[Symbol.iterator];if(!L)return N;var $=L.call(N),G,J=[],tt;try{for(;(R===void 0||R-- >0)&&!(G=$.next()).done;)J.push(G.value)}catch(it){tt={error:it}}finally{try{G&&!G.done&&(L=$.return)&&L.call($)}finally{if(tt)throw tt.error}}return J}function C(){for(var N=[],R=0;R<arguments.length;R++)N=N.concat(P(arguments[R]));return N}function O(){for(var N=0,R=0,L=arguments.length;R<L;R++)N+=arguments[R].length;for(var $=Array(N),G=0,R=0;R<L;R++)for(var J=arguments[R],tt=0,it=J.length;tt<it;tt++,G++)$[G]=J[tt];return $}function x(N,R,L){if(L||arguments.length===2)for(var $=0,G=R.length,J;$<G;$++)(J||!($ in R))&&(J||(J=Array.prototype.slice.call(R,0,$)),J[$]=R[$]);return N.concat(J||Array.prototype.slice.call(R))}function g(N){return this instanceof g?(this.v=N,this):new g(N)}function A(N,R,L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=L.apply(N,R||[]),G,J=[];return G={},tt("next"),tt("throw"),tt("return"),G[Symbol.asyncIterator]=function(){return this},G;function tt(j){$[j]&&(G[j]=function(et){return new Promise(function(dt,gt){J.push([j,et,dt,gt])>1||it(j,et)})})}function it(j,et){try{X($[j](et))}catch(dt){H(J[0][3],dt)}}function X(j){j.value instanceof g?Promise.resolve(j.value.v).then(_,B):H(J[0][2],j)}function _(j){it("next",j)}function B(j){it("throw",j)}function H(j,et){j(et),J.shift(),J.length&&it(J[0][0],J[0][1])}}function f(N){var R,L;return R={},$("next"),$("throw",function(G){throw G}),$("return"),R[Symbol.iterator]=function(){return this},R;function $(G,J){R[G]=N[G]?function(tt){return(L=!L)?{value:g(N[G](tt)),done:G==="return"}:J?J(tt):tt}:J}}function p(N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var R=N[Symbol.asyncIterator],L;return R?R.call(N):(N=typeof w=="function"?w(N):N[Symbol.iterator](),L={},$("next"),$("throw"),$("return"),L[Symbol.asyncIterator]=function(){return this},L);function $(J){L[J]=N[J]&&function(tt){return new Promise(function(it,X){tt=N[J](tt),G(it,X,tt.done,tt.value)})}}function G(J,tt,it,X){Promise.resolve(X).then(function(_){J({value:_,done:it})},tt)}}function S(N,R){return Object.defineProperty?Object.defineProperty(N,"raw",{value:R}):N.raw=R,N}var y=Object.create?function(N,R){Object.defineProperty(N,"default",{enumerable:!0,value:R})}:function(N,R){N.default=R};function I(N){if(N&&N.__esModule)return N;var R={};if(N!=null)for(var L in N)L!=="default"&&Object.prototype.hasOwnProperty.call(N,L)&&h(R,N,L);return y(R,N),R}function F(N){return N&&N.__esModule?N:{default:N}}function z(N,R,L,$){if(L==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof R=="function"?N!==R||!$:!R.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return L==="m"?$:L==="a"?$.call(N):$?$.value:R.get(N)}function W(N,R,L,$,G){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof R=="function"?N!==R||!G:!R.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?G.call(N,L):G?G.value=L:R.set(N,L),L}},function(s,e,t){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var r=t(0),a=r.__importDefault(t(3)),l=r.__importStar(t(8)),u=r.__importDefault(t(4)),c=t(11),m=t(31);function v(q){return Math.floor(Math.random()*q.length)}function E(q){for(var ot=[],ct=1;ct<arguments.length;ct++)ot[ct-1]=arguments[ct];for(var yt=0;yt<ot.length;yt++){var Ft=ot[yt];if(!Ft)break;var Oe=Object.prototype.hasOwnProperty;for(var In in Ft)(!Oe||Oe.call(Ft,In))&&(q[In]=Ft[In])}return q}e.mixin=E;function h(q){return E({},q)}e.copy=h,e.isArray=Array.isArray||function(q){return Object.prototype.toString.call(q)=="[object Array]"};function b(q){return O(q)?[]:(0,e.isArray)(q)?q:[q]}e.ensureArray=b;function w(q){return Object.prototype.toString.call(q)=="[object Object]"}e.isObject=w;function P(q){for(var ot in q)return!1;return!0}e.isEmpty=P;function C(q,ot){for(var ct in q)if(ct!==ot)return!1;return!0}e.isOnlyPropIn=C;function O(q){return q==null}e.isEmptyArg=O;function x(q){var ot=new Object;for(var ct in q)ot[ct]=q[ct];return ot}e.shallowClone=x;function g(q,ot){var ct=function(){function Ft(){}return Ft}();ct.prototype=q;var yt=new ct;return ot&&E(yt,ot),yt}e.prototypicalClone=g;var A=function(q,ot){if(a.default.Config.inherits){a.default.Config.inherits(q,ot);return}q.super_=ot,q.prototype=g(ot.prototype,{constructor:q})};e.inherits=A;function f(q,ot){for(var ct in q)if(q[ct]==ot)return!0;return!1}e.containsValue=f;function p(q,ot){return(0,e.isArray)(ot)?S(q,ot):y(q,ot)}e.intersect=p;function S(q,ot){for(var ct=[],yt=0;yt<q.length;yt++){var Ft=q[yt];(0,e.arrIndexOf)(ot,Ft)!=-1&&ct.push(Ft)}return ct}e.arrIntersect=S;function y(q,ot){for(var ct=[],yt=0;yt<q.length;yt++){var Ft=q[yt];Ft in ot&&ct.push(Ft)}return ct}e.arrIntersectOb=y;function I(q,ot){for(var ct=[],yt=0;yt<q.length;yt++){var Ft=q[yt];(0,e.arrIndexOf)(ot,Ft)==-1&&ct.push(Ft)}return ct}e.arrSubtract=I,e.arrIndexOf=Array.prototype.indexOf?function(q,ot,ct){return q.indexOf(ot,ct)}:function(q,ot,ct){ct=ct||0;for(var yt=q.length;ct<yt;ct++)if(q[ct]===ot)return ct;return-1};function F(q,ot){return(0,e.arrIndexOf)(q,ot)!==-1}e.arrIn=F;function z(q,ot){var ct=(0,e.arrIndexOf)(q,ot),yt=ct!=-1;return yt&&q.splice(ct,1),yt}e.arrDeleteValue=z;function W(q,ot){var ct=q.slice();return z(ct,ot),ct}e.arrWithoutValue=W;function N(q,ot){var ct=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ct.push(yt);return ct}e.keysArray=N;function R(q,ot){var ct=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ct.push(q[yt]);return ct}e.valuesArray=R;function L(q,ot){for(var ct in q)Object.prototype.hasOwnProperty.call(q,ct)&&q[ct]&&ot(ct)}e.forInOwnNonNullProperties=L,e.arrForEach=Array.prototype.forEach?function(q,ot){q.forEach(ot)}:function(q,ot){for(var ct=q.length,yt=0;yt<ct;yt++)ot(q[yt],yt,q)};function $(q,ot){return(0,e.arrForEach)(q.slice(),ot)}e.safeArrForEach=$,e.arrMap=Array.prototype.map?function(q,ot){return q.map(ot)}:function(q,ot){for(var ct=[],yt=q.length,Ft=0;Ft<yt;Ft++)ct.push(ot(q[Ft],Ft,q));return ct},e.arrFilter=Array.prototype.filter?function(q,ot){return q.filter(ot)}:function(q,ot){for(var ct=[],yt=q.length,Ft=0;Ft<yt;Ft++)ot(q[Ft])&&ct.push(q[Ft]);return ct},e.arrEvery=Array.prototype.every?function(q,ot){return q.every(ot)}:function(q,ot){for(var ct=q.length,yt=0;yt<ct;yt++)if(!ot(q[yt],yt,q))return!1;return!0};function G(q,ot){if(q.length===0)return!0;var ct=q[0][ot];return(0,e.arrEvery)(q,function(yt){return yt[ot]===ct})}e.allSame=G;var J={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function tt(q,ot){var ct=J[ot||Yt.json];return{accept:ct,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultGetHeaders=tt;function it(q,ot){var ct,yt=ct=J[ot||Yt.json];return{accept:yt,"content-type":ct,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultPostHeaders=it;function X(q){return q.splice(v(q),1)[0]}e.arrPopRandomElement=X;function _(q){var ot=[];if(q)for(var ct in q)ot.push(encodeURIComponent(ct)+"="+encodeURIComponent(q[ct]));return ot.length?"?"+ot.join("&"):""}e.toQueryString=_;function B(q){for(var ot,ct=/([^?&=]+)=?([^&]*)/g,yt={};ot=ct.exec(q);)yt[decodeURIComponent(ot[1])]=decodeURIComponent(ot[2]);return yt}e.parseQueryString=B,e.now=Date.now||function(){return new Date().getTime()};function H(q){return typeof q=="object"&&q!==null&&(q.constructor.name=="ErrorInfo"||q.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=H;function j(q){var ot,ct;return q instanceof Error||((ot=q==null?void 0:q.constructor)===null||ot===void 0?void 0:ot.name)==="ErrorInfo"||((ct=q==null?void 0:q.constructor)===null||ct===void 0?void 0:ct.name)==="PartialErrorInfo"?q.toString():a.default.Config.inspect(q)}e.inspectError=j;function et(q){return a.default.BufferUtils.isBuffer(q)?q.toString():typeof q=="string"?q:a.default.Config.inspect(q)}e.inspectBody=et;function dt(q){if(a.default.BufferUtils.isBuffer(q))return a.default.BufferUtils.byteLength(q);if(typeof q=="string")return a.default.Config.stringByteSize(q);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof q)}e.dataSizeBytes=dt;function gt(){return String(Math.random()).substr(2)}e.cheapRandStr=gt;var Et=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.base64Encode(ot)}for(var ct=a.default.BufferUtils.base64CharSet,yt=Math.round(q*4/3),Ft="",Oe=0;Oe<yt;Oe++)Ft+=ct[v(ct)];return Ft};e.randomString=Et;var Ct=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.hexEncode(ot)}for(var ct=a.default.BufferUtils.hexCharSet,yt=q*2,Ft="",Oe=0;Oe<yt;Oe++)Ft+=ct[v(ct)];return Ft};e.randomHexString=Ct;function zt(q,ot){for(var ct=Math.min(ot,q.length),yt=q.slice(),Ft=[],Oe=0;Oe<ct;Oe++)Ft.push(X(yt));return Ft}e.arrChooseN=zt,e.trim=String.prototype.trim?function(q){return q.trim()}:function(q){return q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ht(q,ot,ct){return new Promise(function(yt,Ft){q[ot].apply(q,r.__spreadArray(r.__spreadArray([],ct,!1),[function(Oe,In){Oe?Ft(Oe):yt(In)}],!1))})}e.promisify=ht;var Yt;(function(q){q.msgpack="msgpack",q.json="json"})(Yt=e.Format||(e.Format={}));function be(q,ot){return ot=="msgpack"?a.default.Config.msgpack.decode(q):JSON.parse(String(q))}e.decodeBody=be;function oe(q,ot){return ot=="msgpack"?a.default.Config.msgpack.encode(q,!0):JSON.stringify(q)}e.encodeBody=oe;function he(q){return q.map(function(ot){return ot&&ot.toLowerCase()})}e.allToLowerCase=he;function un(q){return q.map(function(ot){return ot&&ot.toUpperCase()})}e.allToUpperCase=un;function bn(q){return Math.min((q+2)/3,2)}e.getBackoffCoefficient=bn;function le(){return 1-Math.random()*.2}e.getJitterCoefficient=le;function En(q,ot){return q*bn(ot)*le()}e.getRetryTime=En;function jn(){return i||(typeof window!="undefined"?window:self)}e.getGlobalObject=jn;function Yr(q,ot){return Object.keys(q).every(function(ct){return q[ct]===ot[ct]})&&Object.keys(ot).every(function(ct){return ot[ct]===q[ct]})}e.shallowEquals=Yr;function fi(q){var ot=/^(\[([^?]*)(?:(.*))\])?(.+)$/,ct=q.match(ot);if(!ct||!ct.length||ct.length<5)throw new u.default("regex match failed",400,40010);if(ct[2])throw new u.default("cannot use a derived option with a ".concat(ct[2]," channel"),400,40010);return{qualifierParam:ct[3]||"",channelName:ct[4]}}e.matchDerivedChannel=fi;function cl(q){return a.default.Config.createHmac?Buffer.from(q,"ascii").toString("base64"):(0,c.stringify)((0,m.parse)(q))}e.toBase64=cl}).call(this,t(13))},function(s,e,t){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importDefault(t(3)),l=i||(typeof window!="undefined"?window:self),u;(function(h){h[h.None=0]="None",h[h.Error=1]="Error",h[h.Major=2]="Major",h[h.Minor=3]="Minor",h[h.Micro=4]="Micro"})(u||(u={}));function c(h,b){return"".concat(h).padStart(b?3:2,"0")}function m(h){return a.default.Config.logTimestamps?function(b){var w=new Date;h(c(w.getHours())+":"+c(w.getMinutes())+":"+c(w.getSeconds())+"."+c(w.getMilliseconds(),1)+" "+b)}:h}var v=function(){var h,b,w,P;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((b=(h=l==null?void 0:l.console)===null||h===void 0?void 0:h.log)===null||b===void 0?void 0:b.apply)=="function"?(w=function(){for(var C=[],O=0;O<arguments.length;O++)C[O]=arguments[O]},P=console.warn?function(){for(var C=[],O=0;O<arguments.length;O++)C[O]=arguments[O]}:w):l!=null&&l.console.log?w=P=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=P=function(){},[w,P].map(m)},E=function(){function h(){h.logLevel=h.LOG_DEFAULT}return h.initLogHandlers=function(){var b=v(),w=b[0],P=b[1];this.logHandler=w,this.logErrorHandler=P},h.logLevel=u.Error,h.LOG_NONE=u.None,h.LOG_ERROR=u.Error,h.LOG_MAJOR=u.Major,h.LOG_MINOR=u.Minor,h.LOG_MICRO=u.Micro,h.LOG_DEFAULT=u.Error,h.LOG_DEBUG=u.Micro,h.logAction=function(b,w,P){h.shouldLog(b)&&(b===u.Error?h.logErrorHandler:h.logHandler)("Ably: "+w+": "+P)},h.deprecated=function(b,w){h.deprecatedWithMsg(b,"Please use '"+w+"' instead.")},h.deprecatedWithMsg=function(b,w){h.shouldLog(u.Error)&&h.logErrorHandler("Ably: Deprecation warning - '"+b+"' is deprecated and will be removed from a future version. "+w)},h.shouldLog=function(b){return b<=h.logLevel},h.setLog=function(b,w){b!==void 0&&(h.logLevel=b),w!==void 0&&(h.logHandler=h.logErrorHandler=w)},h}();e.default=E}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(){}return r}();e.default=i},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var i=t(0),r=i.__importDefault(t(3)),a=i.__importStar(t(1));function l(m){var v="["+m.constructor.name;return m.message&&(v+=": "+m.message),m.statusCode&&(v+="; statusCode="+m.statusCode),m.code&&(v+="; code="+m.code),m.cause&&(v+="; cause="+a.inspectError(m.cause)),m.href&&!(m.message&&m.message.indexOf("help.ably.io")>-1)&&(v+="; see "+m.href+" "),v+="]",v}var u=function(m){i.__extends(v,m);function v(E,h,b,w){var P=m.call(this,E)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(P,v.prototype),P.code=h,P.statusCode=b,P.cause=w,P}return v.prototype.toString=function(){return l(this)},v.fromValues=function(E){var h=E,b=h.message,w=h.code,P=h.statusCode;if(typeof b!="string"||typeof w!="number"||typeof P!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+r.default.Config.inspect(E));var C=Object.assign(new v(b,w,P),E);return C.code&&!C.href&&(C.href="https://help.ably.io/error/"+C.code),C},v}(Error);e.default=u;var c=function(m){i.__extends(v,m);function v(E,h,b,w){var P=m.call(this,E)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(P,v.prototype),P.code=h,P.statusCode=b,P.cause=w,P}return v.prototype.toString=function(){return l(this)},v}(Error);e.PartialErrorInfo=c},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(){if(typeof ArrayBuffer=="function"){var r=i,a=r.lib,l=a.WordArray,u=l.init,c=l.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var v=m.byteLength,E=[],h=0;h<v;h++)E[h>>>2]|=m[h]<<24-h%4*8;u.call(this,E,v)}else u.apply(this,arguments)};c.prototype=l}}(),i.lib.WordArray})},function(s,e,t){(function(i){(function(r,a){s.exports=e=a()})(this,function(){var r=r||function(a,l){var u;if(typeof window!="undefined"&&window.crypto&&(u=window.crypto),!u&&typeof window!="undefined"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof i!="undefined"&&i.crypto&&(u=i.crypto),!u)try{u=t(44)}catch(f){}var c=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch(f){}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function f(){}return function(p){var S;return f.prototype=p,S=new f,f.prototype=null,S}}(),v={},E=v.lib={},h=E.Base=function(){return{extend:function(f){var p=m(this);return f&&p.mixIn(f),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var p in f)f.hasOwnProperty(p)&&(this[p]=f[p]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),b=E.WordArray=h.extend({init:function(f,p){f=this.words=f||[],p!=l?this.sigBytes=p:this.sigBytes=f.length*4},toString:function(f){return(f||P).stringify(this)},concat:function(f){var p=this.words,S=f.words,y=this.sigBytes,I=f.sigBytes;if(this.clamp(),y%4)for(var F=0;F<I;F++){var z=S[F>>>2]>>>24-F%4*8&255;p[y+F>>>2]|=z<<24-(y+F)%4*8}else for(var F=0;F<I;F+=4)p[y+F>>>2]=S[F>>>2];return this.sigBytes+=I,this},clamp:function(){var f=this.words,p=this.sigBytes;f[p>>>2]&=4294967295<<32-p%4*8,f.length=a.ceil(p/4)},clone:function(){var f=h.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var p=[],S=0;S<f;S+=4)p.push(c());return new b.init(p,f)}}),w=v.enc={},P=w.Hex={stringify:function(f){for(var p=f.words,S=f.sigBytes,y=[],I=0;I<S;I++){var F=p[I>>>2]>>>24-I%4*8&255;y.push((F>>>4).toString(16)),y.push((F&15).toString(16))}return y.join("")},parse:function(f){for(var p=f.length,S=[],y=0;y<p;y+=2)S[y>>>3]|=parseInt(f.substr(y,2),16)<<24-y%8*4;return new b.init(S,p/2)}},C=w.Latin1={stringify:function(f){for(var p=f.words,S=f.sigBytes,y=[],I=0;I<S;I++){var F=p[I>>>2]>>>24-I%4*8&255;y.push(String.fromCharCode(F))}return y.join("")},parse:function(f){for(var p=f.length,S=[],y=0;y<p;y++)S[y>>>2]|=(f.charCodeAt(y)&255)<<24-y%4*8;return new b.init(S,p)}},O=w.Utf8={stringify:function(f){try{return decodeURIComponent(escape(C.stringify(f)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(f){return C.parse(unescape(encodeURIComponent(f)))}},x=E.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new b.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=O.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var p,S=this._data,y=S.words,I=S.sigBytes,F=this.blockSize,z=F*4,W=I/z;f?W=a.ceil(W):W=a.max((W|0)-this._minBufferSize,0);var N=W*F,R=a.min(N*4,I);if(N){for(var L=0;L<N;L+=F)this._doProcessBlock(y,L);p=y.splice(0,N),S.sigBytes-=R}return new b.init(p,R)},clone:function(){var f=h.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),g=E.Hasher=x.extend({cfg:h.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(f){return function(p,S){return new f.init(S).finalize(p)}},_createHmacHelper:function(f){return function(p,S){return new A.HMAC.init(f,S).finalize(p)}}}),A=v.algo={};return v}(Math);return r})}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(2)),l=i.__importDefault(t(3));function u(v,E,h){try{E.apply(v,h)}catch(b){a.default.logAction(a.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+b+"; stack = "+(b&&b.stack))}}function c(v,E,h){for(var b,w,P,C=0;C<v.length;C++)if(b=v[C],h&&(b=b[h]),r.isArray(b)){for(;(w=r.arrIndexOf(b,E))!==-1;)b.splice(w,1);h&&b.length===0&&delete v[C][h]}else if(r.isObject(b))for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&r.isArray(b[P])&&c([b],E,P)}var m=function(){function v(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return v.prototype.on=function(){for(var E=this,h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];if(h.length===1){var w=h[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h))}if(h.length===2){var P=h[0],C=h[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));if(r.isEmptyArg(P))this.any.push(C);else if(r.isArray(P))P.forEach(function(x){E.on(x,C)});else{if(typeof P!="string")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));var O=this.events[P]||(this.events[P]=[]);O.push(C)}}},v.prototype.off=function(){for(var E,h=this,b=[],w=0;w<arguments.length;w++)b[w]=arguments[w];if(b.length==0||r.isEmptyArg(b[0])&&r.isEmptyArg(b[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var P=b[0],C=b[1],O=null,x=null;if(b.length===1||!C)typeof P=="function"?O=P:x=P;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(b));E=[P,C],x=E[0],O=E[1]}if(O&&r.isEmptyArg(x)){c([this.any,this.events,this.anyOnce,this.eventsOnce],O);return}if(r.isArray(x)){x.forEach(function(g){h.off(g,O)});return}if(typeof x!="string")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(b));O?c([this.events,this.eventsOnce],O,x):(delete this.events[x],delete this.eventsOnce[x])},v.prototype.listeners=function(E){if(E){var h=this.events[E]||[];return this.eventsOnce[E]&&Array.prototype.push.apply(h,this.eventsOnce[E]),h.length?h:null}return this.any.length?this.any:null},v.prototype.emit=function(E){for(var h=[],b=1;b<arguments.length;b++)h[b-1]=arguments[b];var w={event:E},P=[];this.anyOnce.length&&(Array.prototype.push.apply(P,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(P,this.any);var C=this.eventsOnce[E];C&&(Array.prototype.push.apply(P,C),delete this.eventsOnce[E]);var O=this.events[E];O&&Array.prototype.push.apply(P,O),r.arrForEach(P,function(x){u(w,x,h)})},v.prototype.once=function(){for(var E=this,h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];var w=h.length;if((w===0||w===1&&typeof h[0]!="function")&&l.default.Config.Promise){var P=h[0];return new l.default.Config.Promise(function(f){E.once(P,f)})}var C=h[0],O=h[1];if(h.length===1&&typeof C=="function")this.anyOnce.push(C);else if(r.isEmptyArg(C)){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));this.anyOnce.push(O)}else if(r.isArray(C)){var x=this,g=function(){var f=Array.prototype.slice.call(arguments);if(r.arrForEach(C,function(p){x.off(p,g)}),typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));O.apply(this,f)};r.arrForEach(C,function(f){x.on(f,g)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));var A=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(O){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));A.push(O)}}},v.prototype.whenState=function(E,h,b){for(var w=this,P=[],C=3;C<arguments.length;C++)P[C-3]=arguments[C];var O={event:E};if(typeof E!="string"||typeof h!="string")throw"whenState requires a valid event String argument";if(typeof b!="function"&&l.default.Config.Promise)return new l.default.Config.Promise(function(x){v.prototype.whenState.apply(w,[E,h,x].concat(P))});E===h?u(O,b,P):this.once(E,b)},v}();e.default=m},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var i=t(0),r=i.__importDefault(t(3)),a=i.__importStar(t(1)),l=i.__importDefault(t(2)),u=i.__importDefault(t(4)),c=t(43),m="ably-js/"+c.version,v={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:c.version,protocolVersion:2,agent:m,getHost:E,getPort:h,getHttpScheme:b,environmentFallbackHosts:w,getFallbackHosts:P,getHosts:C,checkHost:O,objectifyOptions:f,normaliseOptions:p};function E(y,I,F){return F?I=I==y.restHost&&y.realtimeHost||I||y.realtimeHost:I=I||y.restHost,I}e.getHost=E;function h(y,I){return I||y.tls?y.tlsPort:y.port}e.getPort=h;function b(y){return y.tls?"https://":"http://"}e.getHttpScheme=b;function w(y){return[y+"-a-fallback.ably-realtime.com",y+"-b-fallback.ably-realtime.com",y+"-c-fallback.ably-realtime.com",y+"-d-fallback.ably-realtime.com",y+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=w;function P(y){var I=y.fallbackHosts,F=typeof y.httpMaxRetryCount!="undefined"?y.httpMaxRetryCount:v.httpMaxRetryCount;return I?a.arrChooseN(I,F):[]}e.getFallbackHosts=P;function C(y){return[y.restHost].concat(P(y))}e.getHosts=C;function O(y){if(typeof y!="string")throw new u.default("host must be a string; was a "+typeof y,4e4,400);if(!y.length)throw new u.default("host must not be zero-length",4e4,400)}function x(y,I,F){return y.realtimeHost?y.realtimeHost:y.restHost?(l.default.logAction(l.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+y.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+y.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),y.restHost):I?v.REALTIME_HOST:F+"-"+v.REALTIME_HOST}function g(y){var I={};for(var F in v.TIMEOUTS)I[F]=y[F]||v.TIMEOUTS[F];return I}function A(y){var I=v.agent;if(y.agents)for(var F in y.agents)I+=" "+F+"/"+y.agents[F];return I}e.getAgentString=A;function f(y){return typeof y=="string"?y.indexOf(":")==-1?{token:y}:{key:y}:y}e.objectifyOptions=f;function p(y){if(y.host&&(l.default.deprecated("host","restHost"),y.restHost=y.host),y.wsHost&&(l.default.deprecated("wsHost","realtimeHost"),y.realtimeHost=y.wsHost),y.queueEvents&&(l.default.deprecated("queueEvents","queueMessages"),y.queueMessages=y.queueEvents),y.fallbackHostsUseDefault){if(y.fallbackHosts){var I="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}if(y.port||y.tlsPort){var I="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}y.environment?l.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):l.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),y.fallbackHosts=v.FALLBACK_HOSTS}y.recover===!0&&(l.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),y.recover=function(X,_){_(!0)}),typeof y.recover=="function"&&y.closeOnUnload===!0&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),y.recover=void 0),"closeOnUnload"in y||(y.closeOnUnload=!y.recover),y.transports&&a.arrIn(y.transports,"xhr")&&(l.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),a.arrDeleteValue(y.transports,"xhr"),y.transports.push("xhr_streaming")),"queueMessages"in y||(y.queueMessages=!0);var F=y.environment&&String(y.environment).toLowerCase()||v.ENVIRONMENT,z=!F||F==="production";!y.fallbackHosts&&!y.restHost&&!y.realtimeHost&&!y.port&&!y.tlsPort&&(y.fallbackHosts=z?v.FALLBACK_HOSTS:w(F));var W=y.restHost||(z?v.REST_HOST:F+"-"+v.REST_HOST),N=x(y,z,F);a.arrForEach((y.fallbackHosts||[]).concat(W,N),O),y.port=y.port||v.PORT,y.tlsPort=y.tlsPort||v.TLS_PORT,"tls"in y||(y.tls=!0);var R=g(y);if("useBinaryProtocol"in y?y.useBinaryProtocol=r.default.Config.supportsBinary&&y.useBinaryProtocol:y.useBinaryProtocol=r.default.Config.preferBinary,y.clientId){var L=y.headers=y.headers||{};L["X-Ably-ClientId"]=r.default.BufferUtils.base64Encode(r.default.BufferUtils.utf8Encode(y.clientId))}"idempotentRestPublishing"in y||(y.idempotentRestPublishing=!0),y.promises&&!r.default.Config.Promise&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),y.promises=!1);var $=null,G=y.connectivityCheckUrl;if(y.connectivityCheckUrl){var J=y.connectivityCheckUrl.split("?"),tt=J[0],it=J[1];$=it?a.parseQueryString(it):{},tt.indexOf("://")===-1&&(tt="https://"+tt),G=tt}return i.__assign(i.__assign({},y),{useBinaryProtocol:"useBinaryProtocol"in y?r.default.Config.supportsBinary&&y.useBinaryProtocol:r.default.Config.preferBinary,realtimeHost:N,restHost:W,maxMessageSize:y.maxMessageSize||v.maxMessageSize,timeouts:R,connectivityCheckParams:$,connectivityCheckUrl:G})}e.normaliseOptions=p,e.default=v;function S(y){return Object.assign(v,y)}e.getDefaults=S},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),a=i.__importDefault(t(2)),l=i.__importDefault(t(4)),u=i.__importStar(t(1));function c(h){return!h||!h.channelOptions?{channelOptions:h,plugins:{},baseEncodedPreviousPayload:void 0}:h}function m(h){if(h&&h.cipher){if(!r.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var b=r.default.Crypto.getCipher(h.cipher);return{cipher:b.cipherParams,channelCipher:b.cipher}}return h!=null?h:{}}function v(h){var b=0;return h.name&&(b+=h.name.length),h.clientId&&(b+=h.clientId.length),h.extras&&(b+=JSON.stringify(h.extras).length),h.data&&(b+=u.dataSizeBytes(h.data)),b}var E=function(){function h(){}return h.prototype.toJSON=function(){var b=this.encoding,w=this.data;return w&&r.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(b=b?b+"/base64":"base64",w=r.default.BufferUtils.base64Encode(w)):w=r.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:b,data:w}},h.prototype.toString=function(){var b="[Message";return this.name&&(b+="; name="+this.name),this.id&&(b+="; id="+this.id),this.timestamp&&(b+="; timestamp="+this.timestamp),this.clientId&&(b+="; clientId="+this.clientId),this.connectionId&&(b+="; connectionId="+this.connectionId),this.encoding&&(b+="; encoding="+this.encoding),this.extras&&(b+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?b+="; data="+this.data:r.default.BufferUtils.isBuffer(this.data)?b+="; data (buffer)="+r.default.BufferUtils.base64Encode(this.data):b+="; data (json)="+JSON.stringify(this.data)),this.extras&&(b+="; extras="+JSON.stringify(this.extras)),b+="]",b},h.encrypt=function(b,w,P){var C=b.data,O=b.encoding,x=w.channelCipher;O=O?O+"/":"",r.default.BufferUtils.isBuffer(C)||(C=r.default.BufferUtils.utf8Encode(String(C)),O=O+"utf-8/"),x.encrypt(C,function(g,A){if(g){P(g);return}b.data=A,b.encoding=O+"cipher+"+x.algorithm,P(null,b)})},h.encode=function(b,w,P){var C=b.data,O=typeof C=="string"||r.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!O)if(u.isObject(C)||u.isArray(C))b.data=JSON.stringify(C),b.encoding=b.encoding?b.encoding+"/json":"json";else throw new l.default("Data type is unsupported",40013,400);w!=null&&w.cipher?h.encrypt(b,w,P):P(null,b)},h.encodeArray=function(b,w,P){for(var C=0,O=0;O<b.length;O++)h.encode(b[O],w,function(x){if(x){P(x);return}C++,C==b.length&&P(null,b)})},h.decode=function(b,w){var P=c(w),C=b.data,O=b.encoding;if(O){var x=O.split("/"),g=void 0,A=x.length,f=b.data,p="";try{for(;(g=A)>0;){var S=x[--A].match(/([-\w]+)(\+([\w-]+))?/);if(!S)break;switch(p=S[1],p){case"base64":f=r.default.BufferUtils.base64Decode(String(f)),g==x.length&&(C=f);continue;case"utf-8":f=r.default.BufferUtils.utf8Decode(f);continue;case"json":f=JSON.parse(f);continue;case"cipher":if(P.channelOptions!=null&&P.channelOptions.cipher&&P.channelOptions.channelCipher){var y=S[3],I=P.channelOptions.channelCipher;if(y!=I.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");f=I.decrypt(f);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!P.plugins||!P.plugins.vcdiff)throw new l.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new l.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var F=P.baseEncodedPreviousPayload;typeof F=="string"&&(F=r.default.BufferUtils.utf8Encode(F)),F=r.default.BufferUtils.toBuffer(F),f=r.default.BufferUtils.toBuffer(f),f=r.default.BufferUtils.typedArrayToBuffer(P.plugins.vcdiff.decode(f,F)),C=f}catch(W){throw new l.default("Vcdiff delta decode failed with "+W,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(W){var z=W;throw new l.default("Error processing the "+p+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{b.encoding=g<=0?null:x.slice(0,g).join("/"),b.data=f}}P.baseEncodedPreviousPayload=C},h.fromResponseBody=function(b,w,P){P&&(b=u.decodeBody(b,P));for(var C=0;C<b.length;C++){var O=b[C]=h.fromValues(b[C]);try{h.decode(O,w)}catch(x){a.default.logAction(a.default.LOG_ERROR,"Message.fromResponseBody()",x.toString())}}return b},h.fromValues=function(b){return Object.assign(new h,b)},h.fromValuesArray=function(b){for(var w=b.length,P=new Array(w),C=0;C<w;C++)P[C]=h.fromValues(b[C]);return P},h.fromEncoded=function(b,w){var P=h.fromValues(b),C=m(w!=null?w:null);try{h.decode(P,C)}catch(O){a.default.logAction(a.default.LOG_ERROR,"Message.fromEncoded()",O.toString())}return P},h.fromEncodedArray=function(b,w){return b.map(function(P){return h.fromEncoded(P,w)})},h.getMessagesSize=function(b){for(var w,P=0,C=0;C<b.length;C++)w=b[C],P+=w.size||(w.size=v(w));return P},h.serialize=u.encodeBody,h}();e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(4)),l=i.__importDefault(t(9)),u=i.__importDefault(t(15)),c={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},m=[];Object.keys(c).forEach(function(P){m[c[P]]=P});var v={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},E=Object.keys(v);v.MODE_ALL=v.PRESENCE|v.PUBLISH|v.SUBSCRIBE|v.PRESENCE_SUBSCRIBE;function h(P){var C=[];if(P)for(var O=0;O<P.length;O++)C.push(P[O].toString());return"[ "+C.join(", ")+" ]"}var b="id channel channelSerial connectionId count msgSerial timestamp".split(" "),w=function(){function P(){var C=this;this.hasFlag=function(O){return(C.flags&v[O])>0}}return P.prototype.setFlag=function(C){return this.flags=this.flags|v[C]},P.prototype.getMode=function(){return this.flags&&this.flags&v.MODE_ALL},P.prototype.encodeModesToFlags=function(C){var O=this;C.forEach(function(x){return O.setFlag(x)})},P.prototype.decodeModesFromFlags=function(){var C=this,O=[];return P.channelModes.forEach(function(x){C.hasFlag(x)&&O.push(x)}),O.length>0?O:void 0},P.fromValues=function(C){return Object.assign(new P,C)},P.Action=c,P.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],P.ActionName=m,P.serialize=r.encodeBody,P.deserialize=function(C,O){var x=r.decodeBody(C,O);return P.fromDeserialized(x)},P.fromDeserialized=function(C){var O=C.error;O&&(C.error=a.default.fromValues(O));var x=C.messages;if(x)for(var g=0;g<x.length;g++)x[g]=l.default.fromValues(x[g]);var A=C.presence;if(A)for(var g=0;g<A.length;g++)A[g]=u.default.fromValues(A[g],!0);return Object.assign(new P,C)},P.stringify=function(C){var O="[ProtocolMessage";C.action!==void 0&&(O+="; action="+P.ActionName[C.action]||!1);for(var x,g=0;g<b.length;g++)x=b[g],C[x]!==void 0&&(O+="; "+x+"="+C[x]);if(C.messages&&(O+="; messages="+h(l.default.fromValuesArray(C.messages))),C.presence&&(O+="; presence="+h(u.default.fromValuesArray(C.presence))),C.error&&(O+="; error="+a.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(O+="; token="+C.auth.accessToken),C.flags&&(O+="; flags="+E.filter(C.hasFlag).join(",")),C.params){var A="";r.forInOwnNonNullProperties(C.params,function(f){A.length>0&&(A+="; "),A+=f+"="+C.params[f]}),A.length>0&&(O+="; params=["+A+"]")}return O+="]",O},P}();e.default=w},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(){var r=i,a=r.lib,l=a.WordArray,u=r.enc,c=u.Base64={stringify:function(v){var E=v.words,h=v.sigBytes,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";v.clamp();for(var w=[],P=0;P<h;P+=3)for(var C=E[P>>>2]>>>24-P%4*8&255,O=E[P+1>>>2]>>>24-(P+1)%4*8&255,x=E[P+2>>>2]>>>24-(P+2)%4*8&255,g=C<<16|O<<8|x,A=0;A<4&&P+A*.75<h;A++)w.push(b.charAt(g>>>6*(3-A)&63));var f=b.charAt(64);if(f)for(;w.length%4;)w.push(f);return w.join("")},parse:function(v){var E=v.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var w=0;w<h.length;w++)b[h.charCodeAt(w)]=w}var P=h.charAt(64);if(P){var C=v.indexOf(P);C!==-1&&(E=C)}return m(v,E,b)}};function m(v,E,h){for(var b=[],w=0,P=0;P<E;P++)if(P%4){var C=h[v.charCodeAt(P-1)]<<P%4*2,O=h[v.charCodeAt(P)]>>>6-P%4*2,x=C|O;b[w>>>2]|=x<<24-w%4*8,w++}return l.create(b,w)}}(),i.enc.Base64})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(10)),l=i.__importDefault(t(26)),u=i.__importDefault(t(2)),c=i.__importDefault(t(8)),m=i.__importDefault(t(20)),v=i.__importDefault(t(17)),E=i.__importDefault(t(4)),h=i.__importDefault(t(21)),b=i.__importDefault(t(3));function w(O){var x=[80015,80017,80030];return O.code?v.default.isTokenErr(O)?!1:r.arrIn(x,O.code)?!0:O.code>=4e4&&O.code<5e4:!1}function P(O){return w(O)?[a.default.fromValues({action:a.default.Action.ERROR,error:O})]:[a.default.fromValues({action:a.default.Action.DISCONNECTED,error:O})]}var C=function(O){i.__extends(x,O);function x(g,A,f){var p=O.call(this,g,A,f,!0)||this;return p.onAuthUpdated=function(S){p.authParams={access_token:S.token}},p.stream="stream"in f?f.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return x.prototype.connect=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","starting"),l.default.prototype.connect.call(this);var A=this.params,f=A.options,p=c.default.getHost(f,A.host),S=c.default.getPort(f),y=f.tls?"https://":"http://";this.baseUri=y+p+":"+S+"/comet/";var I=this.baseUri+"connect";u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","uri: "+I),this.auth.getAuthParams(function(F,z){if(F){g.disconnect(F);return}if(!g.isDisposed){g.authParams=z;var W=g.params.getConnectParams(z);"stream"in W&&(g.stream=W.stream),u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+r.toQueryString(W));var N=!1,R=g.recvRequest=g.createRequest(I,null,W,null,g.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV);R.on("data",function(L){!g.recvRequest||(N||(N=!0,g.emit("preconnect")),g.onData(L))}),R.on("complete",function(L){if(g.recvRequest||(L=L||new E.default("Request cancelled",80003,400)),g.recvRequest=null,!N&&!L&&(N=!0,g.emit("preconnect")),g.onActivity(),L){L.code?g.onData(P(L)):g.disconnect(L);return}b.default.Config.nextTick(function(){g.recv()})}),R.exec()}})},x.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},x.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},x.prototype._requestCloseOrDisconnect=function(g){var A=this,f=g?this.closeUri:this.disconnectUri;if(f){var p=this.createRequest(f,null,this.authParams,null,h.default.REQ_SEND);p.on("complete",function(S){S&&(u.default.logAction(u.default.LOG_ERROR,"CometTransport.request"+(g?"Close()":"Disconnect()"),"request returned err = "+r.inspectError(S)),A.finish("disconnected",S))}),p.exec()}},x.prototype.dispose=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected()),b.default.Config.nextTick(function(){g.emit("disposed")}))},x.prototype.onConnect=function(g){var A;if(!this.isDisposed){var f=(A=g.connectionDetails)===null||A===void 0?void 0:A.connectionKey;l.default.prototype.onConnect.call(this,g);var p=this.baseUri+f;u.default.logAction(u.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}},x.prototype.send=function(g){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(g);return}var A=this.pendingItems||[];A.push(g),this.pendingItems=null,this.sendItems(A)},x.prototype.sendAnyPending=function(){var g=this.pendingItems;!g||(this.pendingItems=null,this.sendItems(g))},x.prototype.sendItems=function(g){var A=this,f=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(g),h.default.REQ_SEND);f.on("complete",function(p,S){if(p&&u.default.logAction(u.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+r.inspectError(p)),A.sendRequest=null,p){p.code?A.onData(P(p)):A.disconnect(p);return}S&&A.onData(S),A.pendingItems&&b.default.Config.nextTick(function(){A.sendRequest||A.sendAnyPending()})}),f.exec()},x.prototype.recv=function(){var g=this;if(!this.recvRequest&&!!this.isConnected){var A=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV_POLL);A.on("data",function(f){g.onData(f)}),A.on("complete",function(f){if(g.recvRequest=null,g.onActivity(),f){f.code?g.onData(P(f)):g.disconnect(f);return}b.default.Config.nextTick(function(){g.recv()})}),A.exec()}},x.prototype.onData=function(g){try{var A=this.decodeResponse(g);if(A&&A.length)for(var f=0;f<A.length;f++)this.onProtocolMessage(a.default.fromDeserialized(A[f]))}catch(p){u.default.logAction(u.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},x.prototype.encodeRequest=function(g){return JSON.stringify(g)},x.prototype.decodeResponse=function(g){return typeof g=="string"?JSON.parse(g):g},x}(l.default);e.default=C},function(s,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(i){typeof window=="object"&&(t=window)}s.exports=t},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),a=i.__importStar(t(1)),l=i.__importDefault(t(2)),u=i.__importDefault(t(17)),c=i.__importDefault(t(18)),m=t(4);function v(C,O,x,g,A){C.http.supportsAuthHeaders?C.auth.getAuthHeaders(function(f,p){f?g(f):A(a.mixin(p,O),x)}):C.auth.getAuthParams(function(f,p){f?g(f):A(O,a.mixin(p,x))})}function E(C,O){return function(x,g,A,f,p){if(x&&!g){C(x);return}if(!f)try{g=a.decodeBody(g,O)}catch(W){a.isErrorInfoOrPartialErrorInfo(W)?C(W):C(new m.PartialErrorInfo(a.inspectError(W),null));return}if(!g){C(new m.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var S=g,y=S.statusCode,I=S.response,F=S.headers;if(y===void 0){C(x,g,A,!0,p);return}if(y<200||y>=300){var z=I&&I.error||x;z||(z=new Error("Error in unenveloping "+g),z.statusCode=y),C(z,I,F,!0,y);return}C(x,I,F,!0,y)}}function h(C){var O=[];if(C)for(var x in C)O.push(x+"="+C[x]);return O.join("&")}function b(C,O){return C+(O?"?":"")+h(O)}function w(C,O,x,g){return function(A,f,p,S,y){A?l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received Error; "+b(x,g)+"; Error: "+a.inspectError(A)):l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received; "+b(x,g)+"; Headers: "+h(p)+"; StatusCode: "+y+"; Body: "+(r.default.BufferUtils.isBuffer(f)?f.toString():f)),C&&C(A,f,p,S,y)}}var P=function(){function C(){}return C.get=function(O,x,g,A,f,p){C.do(c.default.Get,O,x,null,g,A,f,p)},C.delete=function(O,x,g,A,f,p){C.do(c.default.Delete,O,x,null,g,A,f,p)},C.post=function(O,x,g,A,f,p,S){C.do(c.default.Post,O,x,g,A,f,p,S)},C.patch=function(O,x,g,A,f,p,S){C.do(c.default.Patch,O,x,g,A,f,p,S)},C.put=function(O,x,g,A,f,p,S){C.do(c.default.Put,O,x,g,A,f,p,S)},C.do=function(O,x,g,A,f,p,S,y){l.default.shouldLog(l.default.LOG_MICRO)&&(y=w(y,O,g,p)),S&&(y=y&&E(y,S),(p=p||{}).envelope=S);function I(F,z){var W;if(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+b(g,z)),l.default.shouldLog(l.default.LOG_MICRO)){var N=A;if(((W=F["content-type"])===null||W===void 0?void 0:W.indexOf("msgpack"))>0)try{N=r.default.Config.msgpack.decode(A)}catch(R){l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending MsgPack Decoding Error: "+a.inspectError(R))}l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+b(g,z)+"; Body: "+N)}x.http.do(O,x,g,F,A,z,function(R,L,$,G,J){if(R&&u.default.isTokenErr(R)){x.auth.authorize(null,null,function(tt){if(tt){y(tt);return}v(x,$,z,y,I)});return}y(R,L,$,G,J)})}v(x,f,p,y,I)},C}();e.default=P},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),a=i.__importDefault(t(3)),l=i.__importDefault(t(9)),u=i.__importStar(t(1));function c(v){return m.Actions.indexOf(v)}var m=function(){function v(){}return v.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},v.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var E=this.id.split(":");return{connectionId:E[0],msgSerial:parseInt(E[1],10),index:parseInt(E[2],10)}},v.prototype.toJSON=function(){var E=this.data,h=this.encoding;return E&&a.default.BufferUtils.isBuffer(E)&&(arguments.length>0?(h=h?h+"/base64":"base64",E=a.default.BufferUtils.base64Encode(E)):E=a.default.BufferUtils.toBuffer(E)),{id:this.id,clientId:this.clientId,action:c(this.action),data:E,encoding:h,extras:this.extras}},v.prototype.toString=function(){var E="[PresenceMessage";return E+="; action="+this.action,this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?E+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},v.fromResponseBody=function(E,h,b){var w=[];b&&(E=u.decodeBody(E,b));for(var P=0;P<E.length;P++){var C=w[P]=v.fromValues(E[P],!0);try{v.decode(C,h)}catch(O){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",O.toString())}}return w},v.fromValues=function(E,h){return h&&(E.action=v.Actions[E.action]),Object.assign(new v,E)},v.fromValuesArray=function(E){for(var h=E.length,b=new Array(h),w=0;w<h;w++)b[w]=v.fromValues(E[w]);return b},v.fromEncoded=function(E,h){var b=v.fromValues(E,!0);try{v.decode(b,h!=null?h:{})}catch(w){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return b},v.fromEncodedArray=function(E,h){return E.map(function(b){return v.fromEncoded(b,h)})},v.fromData=function(E){return E instanceof v?E:v.fromValues({data:E})},v.Actions=["absent","present","enter","leave","update"],v.encode=l.default.encode,v.decode=l.default.decode,v.getMessagesSize=l.default.getMessagesSize,v}();e.default=m},function(s,e,t){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importStar(t(1)),l=r.__importDefault(t(7)),u=r.__importStar(t(4)),c=r.__importDefault(t(2)),m=r.__importDefault(t(8)),v=r.__importDefault(t(21)),E=r.__importDefault(t(3));function h(y,I){return a.arrIn(a.allToLowerCase(a.keysArray(I)),"x-ably-errorcode")}function b(y,I){if(h(y,I))return y.error&&u.default.fromValues(y.error)}var w=function(){},P=0,C={},O=typeof i!="undefined"&&i.XDomainRequest;function x(){var y=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return y&&Number(y[1])}function g(){var y;return O&&(y=x())&&y===10}function A(y,I){return y.getResponseHeader&&y.getResponseHeader(I)}function f(y){return y.getResponseHeader&&(y.getResponseHeader("transfer-encoding")||!y.getResponseHeader("content-length"))}function p(y){for(var I=a.trim(y.getAllResponseHeaders()).split(`\r
`),F={},z=0;z<I.length;z++){var W=I[z].split(":").map(a.trim);F[W[0].toLowerCase()]=W[1]}return F}var S=function(y){r.__extends(I,y);function I(F,z,W,N,R,L,$){var G=y.call(this)||this;return W=W||{},W.rnd=a.cheapRandStr(),g()&&!W.envelope&&(W.envelope="json"),G.uri=F+a.toQueryString(W),G.headers=z||{},G.body=N,G.method=$?$.toUpperCase():a.isEmptyArg(N)?"GET":"POST",G.requestMode=R,G.timeouts=L,G.timedOut=!1,G.requestComplete=!1,G.id=String(++P),C[G.id]=G,G}return I.createRequest=function(F,z,W,N,R,L,$){var G=L||m.default.TIMEOUTS;return new I(F,z,a.copy(W),N,R,G,$)},I.prototype.complete=function(F,z,W,N,R){this.requestComplete||(this.requestComplete=!0,!F&&z&&this.emit("data",z),this.emit("complete",F,z,W,N,R),this.dispose())},I.prototype.abort=function(){this.dispose()},I.prototype.exec=function(){var F=this,z=this.headers,W=this.requestMode==v.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,N=this.timer=setTimeout(function(){F.timedOut=!0,L.abort()},W),R=this.method,L=this.xhr=new XMLHttpRequest,$=z.accept,G=this.body,J="text";if($?$.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):z.accept="application/json",G){var tt=z["content-type"]||(z["content-type"]="application/json");tt.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}L.open(R,this.uri,!0),L.responseType=J,"authorization"in z&&(L.withCredentials=!0);for(var it in z)L.setRequestHeader(it,z[it]);var X=function(ht,Yt,be,oe){var he,un=Yt+" (event type: "+ht.type+")";!((he=F==null?void 0:F.xhr)===null||he===void 0)&&he.statusText&&(un+=", current statusText is "+F.xhr.statusText),c.default.logAction(c.default.LOG_ERROR,"Request.on"+ht.type+"()",un),F.complete(new u.PartialErrorInfo(un,be,oe))};L.onerror=function(ht){X(ht,"XHR error occurred",null,400)},L.onabort=function(ht){F.timedOut?X(ht,"Request aborted due to request timeout expiring",null,408):X(ht,"Request cancelled",null,400)},L.ontimeout=function(ht){X(ht,"Request timed out",null,408)};var _,B,H,j=0,et=!1,dt=function(){if(clearTimeout(N),H=B<400,B==204){F.complete(null,null,null,null,B);return}_=F.requestMode==v.default.REQ_RECV_STREAM&&H&&f(L)},gt=function(){var ht;try{var Yt=A(L,"content-type"),be=Yt?Yt.indexOf("application/json")>=0:L.responseType=="text";if(be){var oe=L.responseType==="arraybuffer"?E.default.BufferUtils.utf8Decode(L.response):String(L.responseText);oe.length?ht=JSON.parse(oe):ht=oe,et=!0}else ht=L.response;ht.response!==void 0?(B=ht.statusCode,H=B<400,z=ht.headers,ht=ht.response):z=p(L)}catch(un){F.complete(new u.PartialErrorInfo("Malformed response body from server: "+un.message,null,400));return}if(H||a.isArray(ht)){F.complete(null,ht,z,et,B);return}var he=b(ht,z);he||(he=new u.PartialErrorInfo("Error response received from server: "+B+" body was: "+E.default.Config.inspect(ht),null,B)),F.complete(he,ht,z,et,B)};function Et(){for(var ht=L.responseText,Yt=ht.length-1,be,oe;j<Yt&&(be=ht.indexOf(`
`,j))>-1;)oe=ht.slice(j,be),j=be+1,Ct(oe)}var Ct=function(ht){try{ht=JSON.parse(ht)}catch(Yt){F.complete(new u.PartialErrorInfo("Malformed response body from server: "+Yt.message,null,400));return}F.emit("data",ht)},zt=function(){Et(),F.streamComplete=!0,E.default.Config.nextTick(function(){F.complete()})};L.onreadystatechange=function(){var ht=L.readyState;ht<3||L.status!==0&&(B===void 0&&(B=L.status,B===1223&&(B=204),dt()),ht==3&&_?Et():ht==4&&(_?zt():gt()))},L.send(G)},I.prototype.dispose=function(){var F=this.xhr;if(F){F.onreadystatechange=F.onerror=F.onabort=F.ontimeout=w,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||F.abort()}delete C[this.id]},I}(l.default);e.default=S}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),a=i.__importStar(t(1)),l=i.__importDefault(t(23)),u=i.__importDefault(t(4)),c=i.__importDefault(t(45)),m=t(11),v=i.__importDefault(t(18)),E=i.__importDefault(t(25)),h=i.__importDefault(t(3)),b=i.__importDefault(t(14)),w=Math.pow(2,17);function P(){}function C(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(W){return!!W.connection}function x(W){return a.isErrorInfoOrPartialErrorInfo(W)?(W.code||(W.statusCode===403?W.code=40300:(W.code=40170,W.statusCode=401)),W):new u.default(a.inspectError(W),W.code||40170,W.statusCode||401)}var g=function(W,N){if(h.default.Config.createHmac){var R=h.default.Config.createHmac("SHA256",N);return R.update(W),R.digest("base64")}return(0,m.stringify)((0,c.default)(W,N))};function A(W){if(!W)return"";typeof W=="string"&&(W=JSON.parse(W));var N=Object.create(null),R=a.keysArray(W,!0);if(!R)return"";R.sort();for(var L=0;L<R.length;L++)N[R[L]]=W[R[L]].sort();return JSON.stringify(N)}function f(W){if(W.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(W.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(W.key)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(W.tokenDetails)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var N="authOptions must include valid authentication parameters";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",N),new Error(N)}}function p(W){return"useTokenAuth"in W&&!W.useTokenAuth}function S(W){return W.useTokenAuth||!p(W)&&(W.authCallback||W.authUrl||W.token||W.tokenDetails)}function y(W){return!W.key&&!W.authCallback&&!W.authUrl}var I=0;function F(){return I++}var z=function(){function W(N,R){if(this.authOptions={},this.client=N,this.tokenParams=R.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,S(R)){if(R.key&&!g){var L="client-side token request signing not supported";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",L),new Error(L)}y(R)&&r.default.logAction(r.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(R.defaultTokenParams,R),f(this.authOptions)}else{if(!R.key){var L="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",L),new u.default(L,40160,401)}r.default.logAction(r.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(R)}}return W.prototype.authorize=function(N,R,L){var $=this,G;if(typeof N=="function"&&!L?(L=N,G=N=null):typeof R=="function"&&!L?(L=R,G=null):G=R,!L&&this.client.options.promises)return a.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new u.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(r.default.logAction(r.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),a.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(N,G,function(J,tt){if(J){$.client.connection&&J.statusCode===E.default.Forbidden&&$.client.connection.connectionManager.actOnErrorFromAuthorize(J),L==null||L(J);return}O($.client)?$.client.connection.connectionManager.onAuthUpdated(tt,L||P):L==null||L(null,tt)})},W.prototype.authorise=function(N,R,L){r.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(N,R,L)},W.prototype._forceNewToken=function(N,R,L){var $=this;this.tokenDetails=null,this._saveTokenOptions(N,R),f(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,J){delete $.tokenParams.timestamp,delete $.authOptions.queryTime,L(G,J)})},W.prototype.requestToken=function(N,R,L){var $=this;if(typeof N=="function"&&!L?(L=N,R=N=null):typeof R=="function"&&!L&&(L=R,R=null),!L&&this.client.options.promises)return a.promisify(this,"requestToken",arguments);R=R||this.authOptions,N=N||a.copy(this.tokenParams);var G=L||P,J,tt=this.client;if(R.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=R.authCallback;else if(R.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,et){var dt=a.mixin({accept:"application/json, text/plain"},R.authHeaders),gt=R.authMethod&&R.authMethod.toLowerCase()==="post",Et,Ct=R.authUrl.indexOf("?");Ct>-1&&(Et=a.parseQueryString(R.authUrl.slice(Ct)),R.authUrl=R.authUrl.slice(0,Ct),gt||(R.authParams=a.mixin(Et,R.authParams)));var zt=a.mixin({},R.authParams||{},j),ht=function(oe,he,un,bn){var le;if(oe?r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+a.inspectError(oe)):(le=un["content-type"],r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+le+"; body: "+a.inspectBody(he))),oe||bn)return et(oe,he);if(h.default.BufferUtils.isBuffer(he)&&(he=he.toString()),!le){et(new u.default("authUrl response is missing a content-type header",40170,401));return}var En=le.indexOf("application/json")>-1,jn=le.indexOf("text/plain")>-1||le.indexOf("application/jwt")>-1;if(!En&&!jn){et(new u.default("authUrl responded with unacceptable content-type "+le+", should be either text/plain, application/jwt or application/json",40170,401));return}if(En){if(he.length>w){et(new u.default("authUrl response exceeded max permitted length",40170,401));return}try{he=JSON.parse(he)}catch(Yr){et(new u.default("Unexpected error processing authURL response; err = "+Yr.message,40170,401));return}}et(null,he,le)};if(r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+R.authUrl+"; Params: "+JSON.stringify(zt)+"; method: "+(gt?"POST":"GET")),gt){var Yt=dt||{};Yt["content-type"]="application/x-www-form-urlencoded";var be=a.toQueryString(zt).slice(1);$.client.http.doUri(v.default.Post,tt,R.authUrl,Yt,be,Et,ht)}else $.client.http.doUri(v.default.Get,tt,R.authUrl,dt||{},null,zt,ht)};else if(R.key)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,et){$.createTokenRequest(j,R,et)};else{var it="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";r.default.logAction(r.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new u.default(it,40171,403));return}"capability"in N&&(N.capability=A(N.capability));var X=function(j,et){var dt=j.keyName,gt="/keys/"+dt+"/requestToken",Et=function(zt){return tt.baseUri(zt)+gt},Ct=a.defaultPostHeaders($.client.options);R.requestHeaders&&a.mixin(Ct,R.requestHeaders),r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+gt+"; Token params: "+JSON.stringify(j)),$.client.http.do(v.default.Post,tt,Et,Ct,JSON.stringify(j),null,et)},_=!1,B=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){_=!0;var j="Token request callback timed out after "+B/1e3+" seconds";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",j),G(new u.default(j,40170,401))},B);J(N,function(j,et,dt){if(!_){if(clearTimeout(H),j){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+a.inspectError(j)),G(x(j));return}if(typeof et=="string"){et.length===0?G(new u.default("Token string is empty",40170,401)):et.length>w?G(new u.default("Token string exceeded max permitted length (was "+et.length+" bytes)",40170,401)):et==="undefined"||et==="null"?G(new u.default("Token string was literal null/undefined",40170,401)):et[0]==="{"&&!(dt&&dt.indexOf("application/jwt")>-1)?G(new u.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:et});return}if(typeof et!="object"){var gt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof et;r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",gt),G(new u.default(gt,40170,401));return}var Et=JSON.stringify(et).length;if(Et>w&&!R.suppressMaxLengthCheck){G(new u.default("Token request/details object exceeded max permitted stringified size (was "+Et+" bytes)",40170,401));return}if("issued"in et){G(null,et);return}if(!("keyName"in et)){var gt="Expected token request callback to call back with a token string, token request object, or token details object";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",gt),G(new u.default(gt,40170,401));return}X(et,function(Ct,zt,ht,Yt){if(Ct){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+a.inspectError(Ct)),G(x(Ct));return}Yt||(zt=JSON.parse(zt)),r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,zt)})}})},W.prototype.createTokenRequest=function(N,R,L){var $=this;if(typeof N=="function"&&!L?(L=N,R=N=null):typeof R=="function"&&!L&&(L=R,R=null),!L&&this.client.options.promises)return a.promisify(this,"createTokenRequest",arguments);R=R||this.authOptions,N=N||a.copy(this.tokenParams);var G=R.key;if(!G){L(new u.default("No key specified",40101,403));return}var J=G.split(":"),tt=J[0],it=J[1];if(!it){L(new u.default("Invalid key specified",40101,403));return}if(N.clientId===""){L(new u.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in N&&(N.capability=A(N.capability));var X=a.mixin({keyName:tt},N),_=N.clientId||"",B=N.ttl||"",H=N.capability||"";(function(j){if(X.timestamp){j();return}$.getTimestamp(R&&R.queryTime,function(et,dt){if(et){L(et);return}X.timestamp=dt,j()})})(function(){var j=X.nonce||(X.nonce=C()),et=X.timestamp,dt=X.keyName+`
`+B+`
`+H+`
`+_+`
`+et+`
`+j+`
`;X.mac=X.mac||g(dt,it),r.default.logAction(r.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),L(null,X)})},W.prototype.getAuthParams=function(N){this.method=="basic"?N(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(R,L){if(R){N(R);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{access_token:L.token})})},W.prototype.getAuthHeaders=function(N){this.method=="basic"?N(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(R,L){if(R){N(R);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{authorization:"Bearer "+a.toBase64(L.token)})})},W.prototype.getTimestamp=function(N,R){!this.isTimeOffsetSet()&&(N||this.authOptions.queryTime)?this.client.time(R):R(null,this.getTimestampUsingOffset())},W.prototype.getTimestampUsingOffset=function(){return a.now()+(this.client.serverTimeOffset||0)},W.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},W.prototype._saveBasicOptions=function(N){this.method="basic",this.key=N.key,this.basicKey=a.toBase64(N.key),this.authOptions=N||{},"clientId"in N&&this._userSetClientId(N.clientId)},W.prototype._saveTokenOptions=function(N,R){this.method="token",N&&(this.tokenParams=N),R&&(R.token&&(R.tokenDetails=typeof R.token=="string"?{token:R.token}:R.token),R.tokenDetails&&(this.tokenDetails=R.tokenDetails),"clientId"in R&&this._userSetClientId(R.clientId),this.authOptions=R)},W.prototype._ensureValidAuthCredentials=function(N,R){var L=this,$=this.tokenDetails;if($){if(this._tokenClientIdMismatch($.clientId)){R(new u.default("Mismatch between clientId in token ("+$.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!$.expires||$.expires>=this.getTimestampUsingOffset()){r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+$.expires),R(null,$);return}r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(R),!(this.currentTokenRequestId!==null&&!N)){var G=this.currentTokenRequestId=F();this.requestToken(this.tokenParams,this.authOptions,function(J,tt){if(L.currentTokenRequestId>G){r.default.logAction(r.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}L.currentTokenRequestId=null;var it=L.waitingForTokenRequest||P;if(L.waitingForTokenRequest=null,J){it(J);return}it(null,L.tokenDetails=tt)})}},W.prototype._userSetClientId=function(N){if(typeof N=="string"||N===null){if(N==="*")throw new u.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var R=this._uncheckedSetClientId(N);if(R)throw R}else throw new u.default("clientId must be either a string or null",40012,400)},W.prototype._uncheckedSetClientId=function(N){if(this._tokenClientIdMismatch(N)){var R="Unexpected clientId mismatch: client has "+this.clientId+", requested "+N,L=new u.default(R,40102,401);return r.default.logAction(r.default.LOG_ERROR,"Auth._uncheckedSetClientId()",R),L}else return this.clientId=this.tokenParams.clientId=N,null},W.prototype._tokenClientIdMismatch=function(N){return!!(this.clientId&&this.clientId!=="*"&&N&&N!=="*"&&this.clientId!==N)},W.isTokenErr=function(N){return N.code&&N.code>=40140&&N.code<40150},W.prototype.revokeTokens=function(N,R,L){if(S(this.client.options))throw new u.default("Cannot revoke tokens when using token auth",40162,401);var $=this.client.options.keyName,G;if(typeof R=="function"?(L=R,G={}):G=R!=null?R:{},L===void 0){if(this.client.options.promises)return a.promisify(this,"revokeTokens",[N,G]);L=P}var J=L,tt=i.__assign({targets:N.map(function(B){return"".concat(B.type,":").concat(B.value)})},G),it=this.client.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,X=a.defaultPostHeaders(this.client.options,it);this.client.options.headers&&a.mixin(X,this.client.options.headers);var _=a.encodeBody(tt,it);b.default.post(this.client,"/keys/".concat($,"/revokeTokens"),_,X,{newBatchResponse:"true"},null,function(B,H,j,et){if(B){J(B);return}var dt=et?H:a.decodeBody(H,it);J(null,dt)})},W}();e.default=z},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r.Get="get",r.Delete="delete",r.Post="post",r.Put="put",r.Patch="patch"})(i||(i={})),e.default=i},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(2)),l=i.__importDefault(t(14));function u(b){var w=b.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&r.parseQueryString(w[2])}function c(b){typeof b=="string"&&(b=b.split(","));for(var w={},P=0;P<b.length;P++){var C=b[P].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(C){var O=u(C[1]);O&&(w[C[2]]=O)}}return w}function m(b,w,P){return!(P&&(w||typeof b.code=="number"))}var v=function(){function b(w,P,C,O,x,g){this.rest=w,this.path=P,this.headers=C,this.envelope=O!=null?O:null,this.bodyHandler=x,this.useHttpPaginatedResponse=g||!1}return b.prototype.get=function(w,P){var C=this;l.default.get(this.rest,this.path,this.headers,w,this.envelope,function(O,x,g,A,f){C.handlePage(O,x,g,A,f,P)})},b.prototype.delete=function(w,P){var C=this;l.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(O,x,g,A,f){C.handlePage(O,x,g,A,f,P)})},b.prototype.post=function(w,P,C){var O=this;l.default.post(this.rest,this.path,P,this.headers,w,this.envelope,function(x,g,A,f,p){C&&O.handlePage(x,g,A,f,p,C)})},b.prototype.put=function(w,P,C){var O=this;l.default.put(this.rest,this.path,P,this.headers,w,this.envelope,function(x,g,A,f,p){C&&O.handlePage(x,g,A,f,p,C)})},b.prototype.patch=function(w,P,C){var O=this;l.default.patch(this.rest,this.path,P,this.headers,w,this.envelope,function(x,g,A,f,p){C&&O.handlePage(x,g,A,f,p,C)})},b.prototype.handlePage=function(w,P,C,O,x,g){if(w&&m(w,P,this.useHttpPaginatedResponse)){a.default.logAction(a.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+r.inspectError(w)),g==null||g(w);return}var A,f,p;try{A=this.bodyHandler(P,C||{},O)}catch(S){g==null||g(w||S);return}C&&(f=C.Link||C.link)&&(p=c(f)),this.useHttpPaginatedResponse?g(null,new h(this,A,C||{},x,p,w)):g(null,new E(this,A,p))},b}(),E=function(){function b(w,P,C){var O=this;this.resource=w,this.items=P;var x=this;C&&("first"in C&&(this.first=function(g){if(!g&&x.resource.rest.options.promises)return r.promisify(x,"first",[]);x.get(C.first,g)}),"current"in C&&(this.current=function(g){if(!g&&x.resource.rest.options.promises)return r.promisify(x,"current",[]);x.get(C.current,g)}),this.next=function(g){if(!g&&x.resource.rest.options.promises)return r.promisify(x,"next",[]);"next"in C?x.get(C.next,g):g(null)},this.hasNext=function(){return"next"in C},this.isLast=function(){var g;return!(!((g=O.hasNext)===null||g===void 0)&&g.call(O))})}return b.prototype.get=function(w,P){var C=this.resource;l.default.get(C.rest,C.path,C.headers,w,C.envelope,function(O,x,g,A,f){C.handlePage(O,x,g,A,f,P)})},b}();e.PaginatedResult=E;var h=function(b){i.__extends(w,b);function w(P,C,O,x,g,A){var f=b.call(this,P,C,g)||this;return f.statusCode=x,f.success=x<300&&x>=200,f.headers=O,f.errorCode=A&&A.code,f.errorMessage=A&&A.message,f}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(E);e.HttpPaginatedResponse=h,e.default=v},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var i=t(0),r=i.__importDefault(t(4)),a={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},l={disconnected:function(){return r.default.fromValues({statusCode:400,code:a.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return r.default.fromValues({statusCode:400,code:a.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return r.default.fromValues({statusCode:400,code:a.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return r.default.fromValues({statusCode:400,code:a.CLOSING,message:"Connection closing"})},closed:function(){return r.default.fromValues({statusCode:400,code:a.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return r.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return r.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function u(c){return!c.statusCode||!c.code||c.statusCode>=500?!0:Object.values(a).includes(c.code)}e.isRetriable=u,e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r[r.REQ_SEND=0]="REQ_SEND",r[r.REQ_RECV=1]="REQ_RECV",r[r.REQ_RECV_POLL=2]="REQ_RECV_POLL",r[r.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(i||(i={})),e.default=i},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(5),t(58),t(11),t(40),t(32),t(24),t(27),t(28),t(59),t(60))})(this,function(i){return i})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),a=function(){function l(u){this.members=u||[]}return l.prototype.call=function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];for(var m=0,v=this.members;m<v.length;m++){var E=v[m];if(E)try{E.apply(void 0,u)}catch(h){r.default.logAction(r.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+h+"; stack = "+h.stack)}}},l.prototype.push=function(){for(var u,c=[],m=0;m<arguments.length;m++)c[m]=arguments[m];(u=this.members).push.apply(u,c)},l.create=function(u){var c=new l(u);return Object.assign(function(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];return c.call.apply(c,m)},{push:function(m){return c.push(m)}})},l}();e.default=a},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){(function(){var r=i,a=r.lib,l=a.Base,u=r.enc,c=u.Utf8,m=r.algo,v=m.HMAC=l.extend({init:function(E,h){E=this._hasher=new E.init,typeof h=="string"&&(h=c.parse(h));var b=E.blockSize,w=b*4;h.sigBytes>w&&(h=E.finalize(h)),h.clamp();for(var P=this._oKey=h.clone(),C=this._iKey=h.clone(),O=P.words,x=C.words,g=0;g<b;g++)O[g]^=1549556828,x[g]^=909522486;P.sigBytes=C.sigBytes=w,this.reset()},reset:function(){var E=this._hasher;E.reset(),E.update(this._iKey)},update:function(E){return this._hasher.update(E),this},finalize:function(E){var h=this._hasher,b=h.finalize(E);h.reset();var w=h.finalize(this._oKey.clone().concat(b));return w}})})()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var i;(function(a){a[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError"})(i||(i={}));function r(a){return a>=i.Success&&a<i.BadRequest}e.isSuccessCode=r,e.default=i},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(10)),a=i.__importStar(t(1)),l=i.__importDefault(t(7)),u=i.__importDefault(t(2)),c=i.__importDefault(t(20)),m=i.__importDefault(t(4)),v=i.__importDefault(t(3)),E=r.default.Action,h=r.default.fromValues({action:E.CLOSE}),b=r.default.fromValues({action:E.DISCONNECT}),w=function(P){i.__extends(C,P);function C(O,x,g,A){var f=P.call(this)||this;return A&&(g.format=void 0,g.heartbeats=!0),f.connectionManager=O,O.registerProposedTransport(f),f.auth=x,f.params=g,f.timeouts=g.options.timeouts,f.format=g.format,f.isConnected=!1,f.isFinished=!1,f.isDisposed=!1,f.maxIdleInterval=null,f.idleTimer=null,f.lastActivity=null,f}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",c.default.closed())},C.prototype.disconnect=function(O){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",O||c.default.disconnected())},C.prototype.fail=function(O){this.isConnected&&this.requestDisconnect(),this.finish("failed",O||c.default.failed())},C.prototype.finish=function(O,x){var g;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((g=this.idleTimer)!==null&&g!==void 0?g:void 0),this.idleTimer=null,this.emit(O,x),this.dispose())},C.prototype.onProtocolMessage=function(O){switch(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+r.default.stringify(O)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),O.action){case E.HEARTBEAT:u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",O.id);break;case E.CONNECTED:this.onConnect(O),this.emit("connected",O.error,O.connectionId,O.connectionDetails,O);break;case E.CLOSED:this.onClose(O);break;case E.DISCONNECTED:this.onDisconnect(O);break;case E.ACK:this.emit("ack",O.msgSerial,O.count);break;case E.NACK:this.emit("nack",O.msgSerial,O.count,O.error);break;case E.SYNC:this.connectionManager.onChannelMessage(O,this);break;case E.ACTIVATE:break;case E.AUTH:this.auth.authorize(function(x){x&&u.default.logAction(u.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+a.inspectError(x))});break;case E.ERROR:if(u.default.logAction(u.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+v.default.Config.inspect(O.error)+(O.channel?", channel: "+O.channel:"")),O.channel===void 0){this.onFatalError(O);break}this.connectionManager.onChannelMessage(O,this);break;default:this.connectionManager.onChannelMessage(O,this)}},C.prototype.onConnect=function(O){if(this.isConnected=!0,!O.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var x=O.connectionDetails.maxIdleInterval;x&&(this.maxIdleInterval=x+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(O){var x=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onDisconnect()","err = "+a.inspectError(x)),this.finish("disconnected",x)},C.prototype.onFatalError=function(O){var x=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onFatalError()","err = "+a.inspectError(x)),this.finish("failed",x)},C.prototype.onClose=function(O){var x=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onClose()","err = "+a.inspectError(x)),this.finish("closed",x)},C.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestClose()",""),this.send(h)},C.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(b)},C.prototype.ping=function(O){var x={action:r.default.Action.HEARTBEAT};O&&(x.id=O),this.send(r.default.fromValues(x))},C.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=a.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(O){var x=this;this.idleTimer||(this.idleTimer=setTimeout(function(){x.onIdleTimerExpire()},O))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var O=a.now()-this.lastActivity,x=this.maxIdleInterval-O;if(x<=0){var g="No activity seen from realtime in "+O+"ms; assuming connection has dropped";u.default.logAction(u.default.LOG_ERROR,"Transport.onIdleTimerExpire()",g),this.disconnect(new m.default(g,80003,408))}else this.setIdleTimer(x+100)},C.tryConnect=function(O,x,g,A,f){var p=new O(x,g,A),S,y=function(F){clearTimeout(S),f({event:this.event,error:F})},I=x.options.timeouts.realtimeRequestTimeout;S=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),y.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},I),p.on(["failed","disconnected"],y),p.on("preconnect",function(){u.default.logAction(u.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(S),p.off(["failed","disconnected"],y),f(null,p)}),p.connect()},C}(l.default);e.default=w},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(40),t(24))})(this,function(i){return function(){var r=i,a=r.lib,l=a.Base,u=a.WordArray,c=r.algo,m=c.MD5,v=c.EvpKDF=l.extend({cfg:l.extend({keySize:128/32,hasher:m,iterations:1}),init:function(E){this.cfg=this.cfg.extend(E)},compute:function(E,h){for(var b,w=this.cfg,P=w.hasher.create(),C=u.create(),O=C.words,x=w.keySize,g=w.iterations;O.length<x;){b&&P.update(b),b=P.update(E).finalize(h),P.reset();for(var A=1;A<g;A++)b=P.finalize(b),P.reset();C.concat(b)}return C.sigBytes=x*4,C}});r.EvpKDF=function(E,h,b){return v.create(b).compute(E,h)}}(),i.EvpKDF})},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(27))})(this,function(i){i.lib.Cipher||function(r){var a=i,l=a.lib,u=l.Base,c=l.WordArray,m=l.BufferedBlockAlgorithm,v=a.enc,E=v.Utf8,h=v.Base64,b=a.algo,w=b.EvpKDF,P=l.Cipher=m.extend({cfg:u.extend(),createEncryptor:function(R,L){return this.create(this._ENC_XFORM_MODE,R,L)},createDecryptor:function(R,L){return this.create(this._DEC_XFORM_MODE,R,L)},init:function(R,L,$){this.cfg=this.cfg.extend($),this._xformMode=R,this._key=L,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(R){return this._append(R),this._process()},finalize:function(R){R&&this._append(R);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function R(L){return typeof L=="string"?N:F}return function(L){return{encrypt:function($,G,J){return R(G).encrypt(L,$,G,J)},decrypt:function($,G,J){return R(G).decrypt(L,$,G,J)}}}}()}),C=l.StreamCipher=P.extend({_doFinalize:function(){var R=this._process(!0);return R},blockSize:1}),O=a.mode={},x=l.BlockCipherMode=u.extend({createEncryptor:function(R,L){return this.Encryptor.create(R,L)},createDecryptor:function(R,L){return this.Decryptor.create(R,L)},init:function(R,L){this._cipher=R,this._iv=L}}),g=O.CBC=function(){var R=x.extend();R.Encryptor=R.extend({processBlock:function($,G){var J=this._cipher,tt=J.blockSize;L.call(this,$,G,tt),J.encryptBlock($,G),this._prevBlock=$.slice(G,G+tt)}}),R.Decryptor=R.extend({processBlock:function($,G){var J=this._cipher,tt=J.blockSize,it=$.slice(G,G+tt);J.decryptBlock($,G),L.call(this,$,G,tt),this._prevBlock=it}});function L($,G,J){var tt,it=this._iv;it?(tt=it,this._iv=r):tt=this._prevBlock;for(var X=0;X<J;X++)$[G+X]^=tt[X]}return R}(),A=a.pad={},f=A.Pkcs7={pad:function(R,L){for(var $=L*4,G=$-R.sigBytes%$,J=G<<24|G<<16|G<<8|G,tt=[],it=0;it<G;it+=4)tt.push(J);var X=c.create(tt,G);R.concat(X)},unpad:function(R){var L=R.words[R.sigBytes-1>>>2]&255;R.sigBytes-=L}},p=l.BlockCipher=P.extend({cfg:P.cfg.extend({mode:g,padding:f}),reset:function(){var R;P.reset.call(this);var L=this.cfg,$=L.iv,G=L.mode;this._xformMode==this._ENC_XFORM_MODE?R=G.createEncryptor:(R=G.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==R?this._mode.init(this,$&&$.words):(this._mode=R.call(G,this,$&&$.words),this._mode.__creator=R)},_doProcessBlock:function(R,L){this._mode.processBlock(R,L)},_doFinalize:function(){var R,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),R=this._process(!0)):(R=this._process(!0),L.unpad(R)),R},blockSize:128/32}),S=l.CipherParams=u.extend({init:function(R){this.mixIn(R)},toString:function(R){return(R||this.formatter).stringify(this)}}),y=a.format={},I=y.OpenSSL={stringify:function(R){var L,$=R.ciphertext,G=R.salt;return G?L=c.create([1398893684,1701076831]).concat(G).concat($):L=$,L.toString(h)},parse:function(R){var L,$=h.parse(R),G=$.words;return G[0]==1398893684&&G[1]==1701076831&&(L=c.create(G.slice(2,4)),G.splice(0,4),$.sigBytes-=16),S.create({ciphertext:$,salt:L})}},F=l.SerializableCipher=u.extend({cfg:u.extend({format:I}),encrypt:function(R,L,$,G){G=this.cfg.extend(G);var J=R.createEncryptor($,G),tt=J.finalize(L),it=J.cfg;return S.create({ciphertext:tt,key:$,iv:it.iv,algorithm:R,mode:it.mode,padding:it.padding,blockSize:R.blockSize,formatter:G.format})},decrypt:function(R,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=R.createDecryptor($,G).finalize(L.ciphertext);return J},_parse:function(R,L){return typeof R=="string"?L.parse(R,this):R}}),z=a.kdf={},W=z.OpenSSL={execute:function(R,L,$,G){G||(G=c.random(64/8));var J=w.create({keySize:L+$}).compute(R,G),tt=c.create(J.words.slice(L),$*4);return J.sigBytes=L*4,S.create({key:J,iv:tt,salt:G})}},N=l.PasswordBasedCipher=F.extend({cfg:F.cfg.extend({kdf:W}),encrypt:function(R,L,$,G){G=this.cfg.extend(G);var J=G.kdf.execute($,R.keySize,R.ivSize);G.iv=J.iv;var tt=F.encrypt.call(this,R,L,J.key,G);return tt.mixIn(J),tt},decrypt:function(R,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=G.kdf.execute($,R.keySize,R.ivSize,L.salt);G.iv=J.iv;var tt=F.decrypt.call(this,R,L,J.key,G);return tt}})}()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(12)),l=i.__importDefault(t(3)),u=i.__importDefault(t(7)),c=t(4),m=i.__importDefault(t(8)),v=i.__importDefault(t(2)),E=i.__importDefault(t(21)),h=r.getGlobalObject(),b=function(){},w=h._ablyjs_jsonp={};w._=function(f){return w["_"+f]||b};var P=1,C="jsonp";function O(f,p,S,y,I,F,z){return F=F||m.default.TIMEOUTS,new g(void 0,f,p,r.copy(S),y,I,F,z)}e.createRequest=O;var x=function(f){i.__extends(p,f);function p(S,y,I){var F=f.call(this,S,y,I)||this;return F.shortName=C,I.stream=!1,F}return p.isAvailable=function(){return l.default.Config.jsonpSupported&&l.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(S,y,I,F,z,W,N){return W=(this===null||this===void 0?void 0:this.timeouts)||W||m.default.TIMEOUTS,O(S,y,I,F,z,W,N)},p}(a.default),g=function(f){i.__extends(p,f);function p(S,y,I,F,z,W,N,R){var L=f.call(this)||this;return S===void 0&&(S=P++),L.id=S,L.uri=y,L.params=F||{},L.params.rnd=r.cheapRandStr(),I&&(I["X-Ably-Version"]&&(L.params.v=I["X-Ably-Version"]),I["X-Ably-Lib"]&&(L.params.lib=I["X-Ably-Lib"])),L.body=z,L.method=R,L.requestMode=W,L.timeouts=N,L.requestComplete=!1,L}return p.prototype.exec=function(){var S=this,y=this.id,I=this.body,F=this.method,z=this.uri,W=this.params;W.callback="_ablyjs_jsonp._("+y+")",W.envelope="jsonp",I&&(W.body=I),F&&F!=="get"&&(W.method=F);var N=this.script=document.createElement("script"),R=z+r.toQueryString(W);N.src=R,N.src.split("/").slice(-1)[0]!==R.split("/").slice(-1)[0]&&v.default.logAction(v.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),N.async=!0,N.type="text/javascript",N.charset="UTF-8",N.onerror=function(G){S.complete(new c.PartialErrorInfo("JSONP script error (event: "+l.default.Config.inspect(G)+")",null,400))},w["_"+y]=function(G){if(G.statusCode){var J=G.response;if(G.statusCode==204)S.complete(null,null,null,G.statusCode);else if(!J)S.complete(new c.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||r.isArray(J))S.complete(null,J,G.headers,G.statusCode);else{var tt=J.error||new c.PartialErrorInfo("Error response received from server",null,G.statusCode);S.complete(tt)}}else S.complete(null,G)};var L=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),L);var $=document.getElementsByTagName("head")[0];$.insertBefore(N,$.firstChild)},p.prototype.complete=function(S,y,I,F){if(I=I||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;y&&(z=typeof y=="string"?"text/plain":"application/json",I["content-type"]=z,this.emit("data",y)),this.emit("complete",S,y,I,!0,F),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var S=this.timer;S&&(clearTimeout(S),this.timer=null);var y=this.script;y.parentNode&&y.parentNode.removeChild(y),delete w[this.id],this.emit("disposed")},p}(u.default);e.Request=g;function A(f){return h.JSONPTransport=x,x.isAvailable()&&(f.supportedTransports[C]=x),x}e.default=A},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(2)),l=i.__importDefault(t(8)),u=i.__importDefault(t(17)),c=i.__importDefault(t(46)),m=i.__importDefault(t(19)),v=i.__importDefault(t(33)),E=i.__importDefault(t(4)),h=i.__importDefault(t(49)),b=i.__importDefault(t(18)),w=i.__importDefault(t(3)),P=i.__importDefault(t(9)),C=i.__importDefault(t(15)),O=i.__importDefault(t(14)),x=function(){},g=function(){function f(p){if(!p){var S="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",S),new Error(S)}var y=l.default.objectifyOptions(p);y.log&&a.default.setLog(y.log.level,y.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(p));var I=this.options=l.default.normaliseOptions(y);if(I.key){var F=I.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!F){var S="invalid key parameter";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",S),new E.default(S,40400,404)}I.keyName=F[1],I.keySecret=F[2]}if("clientId"in I)if(typeof I.clientId=="string"||I.clientId===null){if(I.clientId==="*")throw new E.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new E.default("clientId must be either a string or null",40012,400);a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+l.default.version),this.baseUri=this.authority=function(z){return l.default.getHttpScheme(I)+z+":"+l.default.getPort(I,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http(I),this.auth=new u.default(this,I),this.channels=new A(this),this.push=new c.default(this)}return f.prototype.stats=function(p,S){if(S===void 0)if(typeof p=="function")S=p,p=null;else{if(this.options.promises)return r.promisify(this,"stats",[p]);S=x}var y=r.defaultGetHeaders(this.options),I=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,F=this.http.supportsLinkHeaders?void 0:I;this.options.headers&&r.mixin(y,this.options.headers),new m.default(this,"/stats",y,F,function(z,W,N){for(var R=N?z:JSON.parse(z),L=0;L<R.length;L++)R[L]=h.default.fromValues(R[L]);return R}).get(p,S)},f.prototype.time=function(p,S){var y=this;if(S===void 0){if(typeof p=="function")S=p,p=null;else if(this.options.promises)return r.promisify(this,"time",[p])}var I=S||x,F=r.defaultGetHeaders(this.options);this.options.headers&&r.mixin(F,this.options.headers);var z=function(W){return y.authority(W)+"/time"};this.http.do(b.default.Get,this,z,F,null,p,function(W,N,R,L){if(W){I(W);return}L||(N=JSON.parse(N));var $=N[0];if(!$){I(new E.default("Internal error (unexpected result type from GET /time)",5e4,500));return}y.serverTimeOffset=$-r.now(),I(null,$)})},f.prototype.request=function(p,S,y,I,F,z){var W=this.options.useBinaryProtocol,N=W?w.default.Config.msgpack.encode:JSON.stringify,R=W?w.default.Config.msgpack.decode:JSON.parse,L=W?r.Format.msgpack:r.Format.json,$=this.http.supportsLinkHeaders?void 0:L;y=y||{};var G=p.toLowerCase(),J=G=="get"?r.defaultGetHeaders(this.options,L):r.defaultPostHeaders(this.options,L);if(z===void 0){if(this.options.promises)return r.promisify(this,"request",[p,S,y,I,F]);z=x}typeof I!="string"&&(I=N(I)),this.options.headers&&r.mixin(J,this.options.headers),F&&r.mixin(J,F);var tt=new m.default(this,S,J,$,function(it,X,_){return r.ensureArray(_?it:R(it))},!0);if(!r.arrIn(w.default.Http.methods,G))throw new E.default("Unsupported method "+G,40500,405);r.arrIn(w.default.Http.methodsWithBody,G)?tt[G](y,I,z):tt[G](y,z)},f.prototype.batchPublish=function(p,S){if(S===void 0){if(this.options.promises)return r.promisify(this,"batchPublish",[p]);S=x}var y=S,I,F;r.isArray(p)?(I=p,F=!1):(I=[p],F=!0);var z=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,W=r.defaultPostHeaders(this.options,z);this.options.headers&&r.mixin(W,this.options.headers);var N=r.encodeBody(I,z);O.default.post(this,"/messages",N,W,{newBatchResponse:"true"},null,function(R,L,$,G){if(R){y(R);return}var J=G?L:r.decodeBody(L,z);F?y(null,J[0]):y(null,J)})},f.prototype.batchPresence=function(p,S){if(S===void 0){if(this.options.promises)return r.promisify(this,"batchPresence",[p]);S=x}var y=S,I=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,F=r.defaultPostHeaders(this.options,I);this.options.headers&&r.mixin(F,this.options.headers);var z=p.join(",");O.default.get(this,"/presence",F,{newBatchResponse:"true",channels:z},null,function(W,N,R,L){if(W){y(W);return}var $=L?N:r.decodeBody(N,I);y(null,$)})},f.prototype.setLog=function(p){a.default.setLog(p.level,p.handler)},f.Promise=function(p){return p=l.default.objectifyOptions(p),p.promises=!0,new f(p)},f.Callbacks=f,f.Platform=w.default,f.Message=P.default,f.PresenceMessage=C.default,f}(),A=function(){function f(p){this.rest=p,this.all=Object.create(null)}return f.prototype.get=function(p,S){p=String(p);var y=this.all[p];return y?S&&y.setOptions(S):this.all[p]=y=new v.default(this.rest,p,S),y},f.prototype.release=function(p){delete this.all[String(p)]},f}();e.default=g},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return i.enc.Utf8})},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(r){var a=i,l=a.lib,u=l.WordArray,c=l.Hasher,m=a.algo,v=[],E=[];(function(){function w(x){for(var g=r.sqrt(x),A=2;A<=g;A++)if(!(x%A))return!1;return!0}function P(x){return(x-(x|0))*4294967296|0}for(var C=2,O=0;O<64;)w(C)&&(O<8&&(v[O]=P(r.pow(C,1/2))),E[O]=P(r.pow(C,1/3)),O++),C++})();var h=[],b=m.SHA256=c.extend({_doReset:function(){this._hash=new u.init(v.slice(0))},_doProcessBlock:function(w,P){for(var C=this._hash.words,O=C[0],x=C[1],g=C[2],A=C[3],f=C[4],p=C[5],S=C[6],y=C[7],I=0;I<64;I++){if(I<16)h[I]=w[P+I]|0;else{var F=h[I-15],z=(F<<25|F>>>7)^(F<<14|F>>>18)^F>>>3,W=h[I-2],N=(W<<15|W>>>17)^(W<<13|W>>>19)^W>>>10;h[I]=z+h[I-7]+N+h[I-16]}var R=f&p^~f&S,L=O&x^O&g^x&g,$=(O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22),G=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),J=y+G+R+E[I]+h[I],tt=$+L;y=S,S=p,p=f,f=A+J|0,A=g,g=x,x=O,O=J+tt|0}C[0]=C[0]+O|0,C[1]=C[1]+x|0,C[2]=C[2]+g|0,C[3]=C[3]+A|0,C[4]=C[4]+f|0,C[5]=C[5]+p|0,C[6]=C[6]+S|0,C[7]=C[7]+y|0},_doFinalize:function(){var w=this._data,P=w.words,C=this._nDataBytes*8,O=w.sigBytes*8;return P[O>>>5]|=128<<24-O%32,P[(O+64>>>9<<4)+14]=r.floor(C/4294967296),P[(O+64>>>9<<4)+15]=C,w.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var w=c.clone.call(this);return w._hash=this._hash.clone(),w}});a.SHA256=c._createHelper(b),a.HmacSHA256=c._createHmacHelper(b)}(Math),i.SHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(7)),l=i.__importDefault(t(2)),u=i.__importDefault(t(34)),c=i.__importDefault(t(9)),m=i.__importDefault(t(4)),v=i.__importDefault(t(19)),E=i.__importDefault(t(14)),h=i.__importDefault(t(3));function b(){}var w=9;function P(x){return r.arrEvery(x,function(g){return!g.id})}function C(x){var g=x||{};if(g.cipher){if(!h.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=h.default.Crypto.getCipher(g.cipher);g.cipher=A.cipherParams,g.channelCipher=A.cipher}else"cipher"in g&&(g.cipher=void 0,g.channelCipher=null);return g}var O=function(x){i.__extends(g,x);function g(A,f,p){var S=x.call(this)||this;return l.default.logAction(l.default.LOG_MINOR,"Channel()","started; name = "+f),S.rest=A,S.name=f,S.basePath="/channels/"+encodeURIComponent(f),S.presence=new u.default(S),S.channelOptions=C(p),S}return g.prototype.setOptions=function(A){this.channelOptions=C(A)},g.prototype.history=function(A,f){if(l.default.logAction(l.default.LOG_MICRO,"Channel.history()","channel = "+this.name),f===void 0)if(typeof A=="function")f=A,A=null;else{if(this.rest.options.promises)return r.promisify(this,"history",arguments);f=b}this._history(A,f)},g.prototype._history=function(A,f){var p=this.rest,S=p.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:S,I=r.defaultGetHeaders(p.options,S);p.options.headers&&r.mixin(I,p.options.headers);var F=this.channelOptions;new v.default(p,this.basePath+"/messages",I,y,function(z,W,N){return c.default.fromResponseBody(z,F,N?void 0:S)}).get(A,f)},g.prototype.publish=function(){var A=this,f=arguments.length,p=arguments[0],S=arguments[1],y=arguments[f-1],I,F;if(typeof y!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);y=b}if(typeof p=="string"||p===null)I=[c.default.fromValues({name:p,data:S})],F=arguments[2];else if(r.isObject(p))I=[c.default.fromValues(p)],F=arguments[1];else if(r.isArray(p))I=c.default.fromValuesArray(p),F=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof F!="object"||!F)&&(F={});var z=this.rest,W=z.options,N=W.useBinaryProtocol?r.Format.msgpack:r.Format.json,R=z.options.idempotentRestPublishing,L=r.defaultPostHeaders(z.options,N);if(W.headers&&r.mixin(L,W.headers),R&&P(I)){var $=r.randomString(w);r.arrForEach(I,function(G,J){G.id=$+":"+J.toString()})}c.default.encodeArray(I,this.channelOptions,function(G){if(G){y(G);return}var J=c.default.getMessagesSize(I),tt=W.maxMessageSize;if(J>tt){y(new m.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+tt+" bytes)",40009,400));return}A._publish(c.default.serialize(I,N),L,F,y)})},g.prototype._publish=function(A,f,p,S){E.default.post(this.rest,this.basePath+"/messages",A,f,p,null,S)},g.prototype.status=function(A){if(typeof A!="function"&&this.rest.options.promises)return r.promisify(this,"status",[]);var f=this.rest.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,p=r.defaultPostHeaders(this.rest.options,f);E.default.get(this.rest,this.basePath,p,{},f,A||b)},g}(a.default);e.default=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(7)),l=i.__importDefault(t(2)),u=i.__importDefault(t(19)),c=i.__importDefault(t(15));function m(){}var v=function(E){i.__extends(h,E);function h(b){var w=E.call(this)||this;return w.channel=b,w.basePath=b.basePath+"/presence",w}return h.prototype.get=function(b,w){if(l.default.logAction(l.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof b=="function")w=b,b=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"get",arguments);w=m}var P=this.channel.rest,C=P.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:C,x=r.defaultGetHeaders(P.options,C);P.options.headers&&r.mixin(x,P.options.headers);var g=this.channel.channelOptions;new u.default(P,this.basePath,x,O,function(A,f,p){return c.default.fromResponseBody(A,g,p?void 0:C)}).get(b,w)},h.prototype.history=function(b,w){return l.default.logAction(l.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(b,w)},h.prototype._history=function(b,w){if(w===void 0)if(typeof b=="function")w=b,b=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"_history",[b]);w=m}var P=this.channel.rest,C=P.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:C,x=r.defaultGetHeaders(P.options,C);P.options.headers&&r.mixin(x,P.options.headers);var g=this.channel.channelOptions;new u.default(P,this.basePath+"/history",x,O,function(A,f,p){return c.default.fromResponseBody(A,g,p?void 0:C)}).get(b,w)},h}(a.default);e.default=v},function(s,e,t){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var r=t(0),a=r.__importDefault(t(10)),l=r.__importStar(t(1)),u=r.__importStar(t(52)),c=r.__importStar(t(8)),m=r.__importDefault(t(3)),v=r.__importDefault(t(7)),E=r.__importDefault(t(36)),h=r.__importDefault(t(2)),b=r.__importDefault(t(37)),w=r.__importStar(t(20)),P=r.__importStar(t(4)),C=r.__importDefault(t(17)),O=r.__importDefault(t(9)),x=r.__importDefault(t(23)),g=r.__importDefault(t(53)),A=r.__importDefault(t(26)),f=r.__importDefault(t(25)),p=function(){var it;return typeof m.default.WebStorage!="undefined"&&((it=m.default.WebStorage)===null||it===void 0?void 0:it.localSupported)},S=function(){var it;return typeof m.default.WebStorage!="undefined"&&((it=m.default.WebStorage)===null||it===void 0?void 0:it.sessionSupported)},y=a.default.Action,I=function(){},F="ably-transport-preference",z="ably-connection-recovery";function W(){var it,X;return S()&&((X=(it=m.default.WebStorage)===null||it===void 0?void 0:it.getSession)===null||X===void 0?void 0:X.call(it,z))}function N(it){var X,_;return S()&&((_=(X=m.default.WebStorage)===null||X===void 0?void 0:X.setSession)===null||_===void 0?void 0:_.call(X,z,it))}function R(){var it,X;return S()&&((X=(it=m.default.WebStorage)===null||it===void 0?void 0:it.removeSession)===null||X===void 0?void 0:X.call(it,z))}function L(it,X){return l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,it.shortName)>l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,X.shortName)}function $(it,X,_){var B;if(it.channel!==X.channel||(B=it.action)!==y.PRESENCE&&B!==y.MESSAGE||B!==X.action)return!1;var H=B===y.PRESENCE?"presence":"messages",j=it[H].concat(X[H]),et=O.default.getMessagesSize(j);return et>_||!l.allSame(j,"clientId")||!l.arrEvery(j,function(dt){return!dt.id})?!1:(it[H]=j,!0)}function G(it){try{return JSON.parse(it)}catch(X){return null}}var J=function(){function it(X,_,B,H){this.options=X,this.host=_,this.mode=B,this.connectionKey=H,this.format=X.useBinaryProtocol?l.Format.msgpack:l.Format.json}return it.prototype.getConnectParams=function(X){var _=X?l.copy(X):{},B=this.options;switch(this.mode){case"upgrade":_.upgrade=this.connectionKey;break;case"resume":_.resume=this.connectionKey;break;case"recover":{var H=G(B.recover);H&&(_.recover=H.connectionKey);break}default:}return B.clientId!==void 0&&(_.clientId=B.clientId),B.echoMessages===!1&&(_.echo="false"),this.format!==void 0&&(_.format=this.format),this.stream!==void 0&&(_.stream=this.stream),this.heartbeats!==void 0&&(_.heartbeats=this.heartbeats),_.v=c.default.protocolVersion,_.agent=encodeURIComponent((0,c.getAgentString)(this.options)),B.transportParams!==void 0&&l.mixin(_,B.transportParams),_},it.prototype.toString=function(){var X="[mode="+this.mode;return this.host&&(X+=",host="+this.host),this.connectionKey&&(X+=",connectionKey="+this.connectionKey),this.format&&(X+=",format="+this.format),X+="]",X},it}();e.TransportParams=J;var tt=function(it){r.__extends(X,it);function X(_,B){var H=it.call(this)||this;H.disconnectedRetryCount=0,X.initTransports(),H.realtime=_,H.options=B;var j=B.timeouts,et=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:et,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new E.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=j.connectionStateTtl,H.maxIdleInterval=null,H.transports=l.intersect(B.transports||c.default.defaultTransports,X.supportedTransports),H.baseTransport=l.intersect(c.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=l.intersect(H.transports,c.default.upgradeTransports),H.transportPreference=null,H.httpHosts=c.default.getHosts(B),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,h.default.logAction(h.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(B.transports||c.default.defaultTransports)+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var dt="no requested transports available";throw h.default.logAction(h.default.LOG_ERROR,"realtime.ConnectionManager()",dt),new Error(dt)}var gt=m.default.Config.addEventListener;return gt&&(S()&&typeof B.recover=="function"&&gt("beforeunload",H.persistConnection.bind(H)),B.closeOnUnload===!0&&gt("beforeunload",function(){h.default.logAction(h.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),gt("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(Et){Et.off()}),H.disconnectAllTransports(),H.startConnect())}),gt("offline",function(){H.state==H.states.connected&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return X.initTransports=function(){(0,g.default)(X),l.arrForEach(m.default.Transports,function(_){_(X)})},X.prototype.createTransportParams=function(_,B){return new J(this.options,_,B,this.connectionKey)},X.prototype.getTransportParams=function(_){var B=this,H=function(j){if(B.connectionKey){j("resume");return}if(typeof B.options.recover=="string"){j("recover");return}var et=B.options.recover,dt=W();if(dt&&typeof et=="function"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),et(dt,function(gt){gt?(B.options.recover=dt.recoveryKey,j("recover")):j("clean")});return}j("clean")};H(function(j){var et=B.createTransportParams(null,j);if(j==="recover"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+B.options.recover);var dt=G(B.options.recover);dt&&(B.msgSerial=dt.msgSerial)}else h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+et.toString());_(et)})},X.prototype.tryATransport=function(_,B,H){var j=this;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+B),A.default.tryConnect(X.supportedTransports[B],this,this.realtime.auth,_,function(et,dt){var gt=j.state;if(gt==j.states.closing||gt==j.states.closed||gt==j.states.failed){dt&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+gt.state+" while we were attempting the transport; closing "+dt),dt.close()),H(!0);return}if(et){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+B+" "+et.event+", err: "+et.error.toString()),C.default.isTokenErr(et.error)&&!(j.errorReason&&C.default.isTokenErr(j.errorReason))?(j.errorReason=et.error,j.realtime.auth._forceNewToken(null,null,function(Et){if(Et){j.actOnErrorFromAuthorize(Et);return}j.tryATransport(_,B,H)})):et.event==="failed"?(j.notifyState({state:"failed",error:et.error}),H(!0)):et.event==="disconnected"&&((0,w.isRetriable)(et.error)?H(!1):(j.notifyState({state:j.states.connecting.failState,error:et.error}),H(!0)));return}h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+B+"; setting pending"),j.setTransportPending(dt,_),H(null,dt)})},X.prototype.setTransportPending=function(_,B){var H=this,j=B.mode;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+_+"; mode = "+j),l.arrDeleteValue(this.proposedTransports,_),this.pendingTransports.push(_);var et=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];_.once("connected",function(gt,Et,Ct){j=="upgrade"&&H.activeProtocol?_.shortName!==et&&l.arrIn(H.getUpgradePossibilities(),et)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(gt,_,Et,Ct)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(gt,_,Et,Ct):(H.activateTransport(gt,_,Et,Ct),m.default.Config.nextTick(function(){H.connectImpl(B)})),j==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var dt=this;_.on(["disconnected","closed","failed"],function(gt){dt.deactivateTransport(_,this.event,gt)}),this.emit("transport.pending",_)},X.prototype.scheduleTransportActivation=function(_,B,H,j){var et=this,dt=this.activeProtocol&&this.activeProtocol.getTransport(),gt=function(){B.disconnect(),l.arrDeleteValue(et.pendingTransports,B)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),gt();return}if(dt&&!L(B,dt)){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+" is no better than current active transport "+dt.shortName+" - abandoning upgrade"),gt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+B);var Et=null;if(!B.isConnected){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+"is no longer connected; abandoning upgrade"),gt();return}if(this.state===this.states.connected)h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Et=this.activeProtocol;else if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),gt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+B);var Ct=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+B),B.send(a.default.fromValues({action:y.ACTIVATE})),et.activateTransport(_,B,H,j),et.state===et.states.synchronizing?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+B),et.state=et.states.connected):h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+et.state.state+", so leaving unchanged"),et.state.sendEvents&&et.sendQueuedMessages()};Et?Et.onceIdle(Ct):Ct()},X.prototype.activateTransport=function(_,B,H,j){var et=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+B),_&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+_),H&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),j&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(B);var dt=this.state,gt=this.states.connected.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+dt.state),dt.state==this.states.closing.state||dt.state==this.states.closed.state||dt.state==this.states.failed.state)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),B.disconnect(),!1;if(l.arrDeleteValue(this.pendingTransports,B),!B.isConnected)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+B+" since it appears to no longer be connected"),!1;var Et=this.activeProtocol;this.activeProtocol=new u.default(B),this.host=B.params.host;var Ct=j.connectionKey;if(Ct&&this.connectionKey!=Ct&&this.setConnection(H,j,!!_),this.onConnectionDetailsUpdate(j,B),m.default.Config.nextTick(function(){B.on("connected",function(ht,Yt,be){et.onConnectionDetailsUpdate(be,B),et.emit("update",new b.default(gt,gt,null,ht))})}),dt.state===this.states.connected.state?_&&(this.errorReason=this.realtime.connection.errorReason=_,this.emit("update",new b.default(gt,gt,null,_))):(this.notifyState({state:"connected",error:_}),this.errorReason=this.realtime.connection.errorReason=_||null),this.emit("transport.active",B),Et)if(Et.messageQueue.count()>0&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Et.transport.shortName+", new one is "+B.shortName+") finishing with "+Et.messageQueue.count()+" messages still pending"),Et.transport===B){var zt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",zt)}else Et.finish();return l.safeArrForEach(this.pendingTransports,function(ht){if(ht===B){var Yt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Yt),l.arrDeleteValue(et.pendingTransports,B)}else ht.disconnect()}),l.safeArrForEach(this.proposedTransports,function(ht){ht===B?(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+B.shortName+"; stack = "+new Error().stack),l.arrDeleteValue(et.proposedTransports,B)):ht.dispose()}),!0},X.prototype.deactivateTransport=function(_,B,H){var j=this.activeProtocol,et=j&&j.getTransport()===_,dt=l.arrDeleteValue(this.pendingTransports,_),gt=l.arrDeleteValue(this.proposedTransports,_),Et=this.noTransportsScheduledForActivation();if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+_),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+B+(et?"; was active":dt?"; was pending":gt?"; was proposed":"")+(Et?"":"; another transport is scheduled for activation")),H&&H.message&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),et&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),m.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",_),et&&Et||et&&B==="failed"||B==="closed"||j===null&&dt&&this.pendingTransports.length===0){if(B==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:B,error:H,retryImmediately:!0});return}var Ct=B==="failed"&&C.default.isTokenErr(H)?"disconnected":B;this.notifyState({state:Ct,error:H});return}et&&B==="disconnected"&&this.state!==this.states.synchronizing&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},X.prototype.noTransportsScheduledForActivation=function(){return l.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(_){return!_.isConnected})},X.prototype.setConnection=function(_,B,H){var j=this.connectionId,et=j&&j!==_,dt=!j&&H;(et||dt)&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==_&&h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=_,this.realtime.connection.key=this.connectionKey=B.connectionKey},X.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},X.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},X.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var _=l.now()-this.lastActivity;_>this.connectionStateTtl+this.maxIdleInterval&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+_+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},X.prototype.persistConnection=function(){if(S()){var _=this.createRecoveryKey();_&&N({recoveryKey:_,disconnectedAt:l.now(),location:i.location,clientId:this.realtime.auth.clientId})}},X.prototype.unpersistConnection=function(){R()},X.prototype.getError=function(){return this.errorReason||this.getStateError()},X.prototype.getStateError=function(){var _,B;return(B=(_=w.default)[this.state.state])===null||B===void 0?void 0:B.call(_)},X.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},X.prototype.enactStateChange=function(_){var B=_.current==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(B,"Connection state",_.current+(_.reason?"; reason: "+_.reason:"")),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+_.current+"; reason = "+(_.reason&&_.reason.message));var H=this.state=this.states[_.current];_.reason&&(this.errorReason=_.reason,this.realtime.connection.errorReason=_.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",_)},X.prototype.startTransitionTimer=function(_){var B=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+_.state),this.transitionTimer&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){B.transitionTimer&&(B.transitionTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager "+_.state+" timer expired","requesting new state: "+_.failState),B.notifyState({state:_.failState}))},_.retryDelay)},X.prototype.cancelTransitionTimer=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},X.prototype.startSuspendTimer=function(){var _=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){_.suspendTimer&&(_.suspendTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),_.states.connecting.failState="suspended",_.notifyState({state:"suspended"}))},this.connectionStateTtl))},X.prototype.checkSuspendTimer=function(_){_!=="disconnected"&&_!=="suspended"&&_!=="connecting"&&this.cancelSuspendTimer()},X.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},X.prototype.startRetryTimer=function(_){var B=this;this.retryTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),B.retryTimer=null,B.requestState({state:"connecting"})},_)},X.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},X.prototype.notifyState=function(_){var B=this,H,j,et=_.state,dt=et==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||_.retryImmediately||this.state===this.states.connecting&&_.error&&C.default.isTokenErr(_.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+et+(dt?"; will retry connection immediately":"")),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_.state),(et==="suspended"||et==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var gt=this.states[_.state],Et=gt.retryDelay;gt.state==="disconnected"&&(this.disconnectedRetryCount++,Et=l.getRetryTime(gt.retryDelay,this.disconnectedRetryCount));var Ct=new b.default(this.state.state,gt.state,Et,_.error||((j=(H=w.default)[gt.state])===null||j===void 0?void 0:j.call(H)));if(dt){var zt=function(){B.state===B.states.disconnected&&(B.lastAutoReconnectAttempt=l.now(),B.requestState({state:"connecting"}))},ht=this.lastAutoReconnectAttempt&&l.now()-this.lastAutoReconnectAttempt+1;ht&&ht<1e3?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ht+"ms ago, waiting another "+(1e3-ht)+"ms before trying again"),setTimeout(zt,1e3-ht)):m.default.Config.nextTick(zt)}else(et==="disconnected"||et==="suspended")&&this.startRetryTimer(Et);(et==="disconnected"&&!dt||et==="suspended"||gt.terminal)&&m.default.Config.nextTick(function(){B.disconnectAllTransports()}),et=="connected"&&!this.activeProtocol&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(Ct),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(et,Ct.reason),this.failQueuedMessages(Ct.reason))}},X.prototype.requestState=function(_){var B=this,H,j,et=_.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+et+"; current state: "+this.state.state),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(et),!(et=="connecting"&&this.state.state=="connected")&&!(et=="closing"&&this.state.state=="closed"))){var dt=this.states[et],gt=new b.default(this.state.state,dt.state,null,_.error||((j=(H=w.default)[dt.state])===null||j===void 0?void 0:j.call(H)));this.enactStateChange(gt),et=="connecting"&&m.default.Config.nextTick(function(){B.startConnect()}),et=="closing"&&this.closeImpl()}},X.prototype.startConnect=function(){var _=this;if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var B=this.realtime.auth,H=++this.connectCounter,j=function(){_.checkConnectionStateFreshness(),_.getTransportParams(function(dt){if(dt.mode==="recover"&&dt.options.recover){var gt=G(dt.options.recover);gt&&_.realtime.channels.recoverChannels(gt.channelSerials)}H===_.connectCounter&&_.connectImpl(dt,H)})};if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),B.method==="basic")j();else{var et=function(dt){H===_.connectCounter&&(dt?_.actOnErrorFromAuthorize(dt):j())};this.errorReason&&C.default.isTokenErr(this.errorReason)?B._forceNewToken(null,null,et):B._ensureValidAuthCredentials(!1,et)}},X.prototype.connectImpl=function(_,B){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(_):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(_,B):this.connectBase(_,B)},X.prototype.connectPreference=function(_,B){var H=this,j=this.getTransportPreference(),et=!1;l.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(_,B)),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var dt=setTimeout(function(){et=!0,H.state.state!==H.states.connected.state&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(_,B)},this.options.timeouts.preferenceConnectTimeout);_.host=this.httpHosts[0],this.tryATransport(_,j,function(gt,Et){clearTimeout(dt),et&&Et?(Et.off(),Et.disconnect(),l.arrDeleteValue(H.pendingTransports,Et)):!Et&&!gt&&(H.unpersistTransportPreference(),H.connectImpl(_,B))})},X.prototype.connectBase=function(_,B){var H=this,j=function(Ct){H.notifyState({state:H.states.connecting.failState,error:Ct})},et=this.httpHosts.slice(),dt=function(Ct,zt){B===H.connectCounter&&!zt&&!Ct&&Et()};h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var gt=et.shift();if(!gt){j(new P.default("Unable to connect (no available host)",80003,404));return}_.host=gt;var Et=function(){if(!et.length){j(new P.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){j(new P.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(Ct,zt){if(B===H.connectCounter){if(Ct){j(Ct);return}if(!zt){j(new P.default("Unable to connect (network unreachable)",80003,404));return}_.host=l.arrPopRandomElement(et),H.tryATransport(_,H.baseTransport,dt)}})};if(this.forceFallbackHost&&et.length){this.forceFallbackHost=!1,Et();return}this.tryATransport(_,this.baseTransport,dt)},X.prototype.getUpgradePossibilities=function(){var _=this.activeProtocol.getTransport().shortName,B=l.arrIndexOf(this.upgradeTransports,_);return this.upgradeTransports.slice(B+1)},X.prototype.upgradeIfNeeded=function(_){var B=this,H=this.getUpgradePossibilities();h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(H)),H.length&&l.arrForEach(H,function(j){var et=B.createTransportParams(_.host,"upgrade");B.tryATransport(et,j,I)})},X.prototype.closeImpl=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),l.safeArrForEach(this.pendingTransports,function(_){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+_),_&&_.close()}),l.safeArrForEach(this.proposedTransports,function(_){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+_),_&&_.dispose()}),this.activeProtocol&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},X.prototype.onAuthUpdated=function(_,B){var H=this,j;switch(this.state.state){case"connected":{if(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var et=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(et)})}var dt=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();dt&&dt.onAuthUpdated&&dt.onAuthUpdated(_);var gt=a.default.fromValues({action:y.AUTH,auth:{accessToken:_.token}});this.send(gt);var Et=function(){H.off(Ct),B(null,_)},Ct=function(ht){ht.current==="failed"&&(H.off(Et),H.off(Ct),B(ht.reason||H.getStateError()))};this.once("connectiondetails",Et),this.on("connectionstate",Ct);break}case"connecting":h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var zt=function(ht){switch(ht.current){case"connected":H.off(zt),B(null,_);break;case"failed":case"closed":case"suspended":H.off(zt),B(ht.reason||H.getStateError());break;default:break}};this.on("connectionstate",zt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},X.prototype.disconnectAllTransports=function(_){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(_?" except the active transport":"")),this.connectCounter++,l.safeArrForEach(this.pendingTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+B),B&&B.disconnect()}),this.pendingTransports=[],l.safeArrForEach(this.proposedTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+B),B&&B.dispose()}),this.proposedTransports=[],this.activeProtocol&&!_&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},X.prototype.send=function(_,B,H){H=H||I;var j=this.state;if(j.sendEvents){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new u.PendingMessage(_,H));return}var et=B&&j.queueEvents||j.forceQueueEvents;if(!et){var dt="rejecting event, queueEvent was "+B+", state was "+j.state;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()",dt),H(this.errorReason||new P.default(dt,9e4,400));return}h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(_)),this.queue(_,H)},X.prototype.sendImpl=function(_){var B=_.message;_.ackRequired&&!_.sendAttempted&&(B.msgSerial=this.msgSerial++);try{this.activeProtocol.send(_)}catch(H){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},X.prototype.queue=function(_,B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),j=this.options.maxMessageSize;H&&!H.sendAttempted&&$(H.message,_,j)?(H.merged||(H.callback=x.default.create([H.callback]),H.merged=!0),H.callback.push(B)):this.queuedMessages.push(new u.PendingMessage(_,B))},X.prototype.sendQueuedMessages=function(){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var _;_=this.queuedMessages.shift();)this.sendImpl(_)},X.prototype.queuePendingMessages=function(_){_&&_.length&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+_.length+" pending messages"),this.queuedMessages.prepend(_))},X.prototype.failQueuedMessages=function(_){var B=this.queuedMessages.count();B>0&&(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+B+" queued messages, err = "+l.inspectError(_)),this.queuedMessages.completeAllMessages(_))},X.prototype.onChannelMessage=function(_,B){var H=this.activeProtocol&&B===this.activeProtocol.getTransport(),j=l.arrIn(this.pendingTransports,B)&&this.state==this.states.synchronizing;H||j?this.realtime.channels.onChannelMessage(_):l.arrIndexOf([y.ACK,y.NACK,y.ERROR],_.action)>-1?this.realtime.channels.onChannelMessage(_):h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(_)+"on defunct transport; discarding")},X.prototype.ping=function(_,B){var H=this;if(_){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+_);var j=function(){_.off("heartbeat",gt),B(new P.default("Timeout waiting for heartbeat response",5e4,500))},et=l.now(),dt=l.cheapRandStr(),gt=function(Yt){if(Yt===dt){_.off("heartbeat",gt),clearTimeout(Et);var be=l.now()-et;B(null,be)}},Et=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);_.on("heartbeat",gt),_.ping(dt);return}if(this.state.state!=="connected"){B(new P.default("Unable to ping service; not connected",4e4,400));return}var Ct=!1,zt=function(Yt,be){H.off("transport.active",ht),Ct||(Ct=!0,B(Yt,be))},ht=function(){Ct||(Ct=!0,m.default.Config.nextTick(function(){H.ping(null,B)}))};this.on("transport.active",ht),this.ping(this.activeProtocol.getTransport(),zt)},X.prototype.abort=function(_){this.activeProtocol.getTransport().fail(_)},X.prototype.registerProposedTransport=function(_){this.proposedTransports.push(_)},X.prototype.getTransportPreference=function(){var _,B;return this.transportPreference||p()&&((B=(_=m.default.WebStorage)===null||_===void 0?void 0:_.get)===null||B===void 0?void 0:B.call(_,F))},X.prototype.persistTransportPreference=function(_){var B,H;l.arrIn(c.default.upgradeTransports,_.shortName)&&(this.transportPreference=_.shortName,p()&&((H=(B=m.default.WebStorage)===null||B===void 0?void 0:B.set)===null||H===void 0||H.call(B,F,_.shortName)))},X.prototype.unpersistTransportPreference=function(){var _,B;this.transportPreference=null,p()&&((B=(_=m.default.WebStorage)===null||_===void 0?void 0:_.remove)===null||B===void 0||B.call(_,F))},X.prototype.actOnErrorFromAuthorize=function(_){if(_.code===40171)this.notifyState({state:"failed",error:_});else if(_.code===40102)this.notifyState({state:"failed",error:_});else if(_.statusCode===f.default.Forbidden){var B="Client configured authentication provider returned 403; failing the connection";h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",B),this.notifyState({state:"failed",error:new P.default(B,80019,403,_)})}else{var B="Client configured authentication provider request failed";h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",B),this.notifyState({state:this.state.failState,error:new P.default(B,80019,401,_)})}},X.prototype.onConnectionDetailsUpdate=function(_,B){if(!!_){this.connectionDetails=_,_.maxMessageSize&&(this.options.maxMessageSize=_.maxMessageSize);var H=_.clientId;if(H){var j=this.realtime.auth._uncheckedSetClientId(H);if(j){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),B.fail(j);return}}var et=_.connectionStateTtl;et&&(this.connectionStateTtl=et),this.maxIdleInterval=_.maxIdleInterval,this.emit("connectiondetails",_)}},X.supportedTransports={},X}(v.default);e.default=tt}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(7)),a=i.__importDefault(t(2)),l=function(u){i.__extends(c,u);function c(){var m=u.call(this)||this;return m.messages=[],m}return c.prototype.count=function(){return this.messages.length},c.prototype.push=function(m){this.messages.push(m)},c.prototype.shift=function(){return this.messages.shift()},c.prototype.last=function(){return this.messages[this.messages.length-1]},c.prototype.copyAll=function(){return this.messages.slice()},c.prototype.append=function(m){this.messages.push.apply(this.messages,m)},c.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},c.prototype.completeMessages=function(m,v,E){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+v),E=E||null;var h=this.messages;if(h.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var b=h[0];if(b){var w=b.message.msgSerial,P=m+v;if(P>w)for(var C=h.splice(0,P-w),O=0,x=C;O<x.length;O++){var g=x[O];g.callback(E)}h.length==0&&this.emit("idle")}},c.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},c.prototype.resetSendAttempted=function(){for(var m=0,v=this.messages;m<v.length;m++){var E=v[m];E.sendAttempted=!1}},c.prototype.clear=function(){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},c}(r.default);e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(a,l,u,c){this.previous=a,this.current=l,u&&(this.retryIn=u),c&&(this.reason=c)}return r}();e.default=i},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(10)),a=i.__importDefault(t(7)),l=i.__importStar(t(1)),u=i.__importDefault(t(33)),c=i.__importDefault(t(2)),m=i.__importDefault(t(54)),v=i.__importDefault(t(9)),E=i.__importDefault(t(39)),h=i.__importStar(t(4)),b=i.__importDefault(t(15)),w=i.__importDefault(t(20)),P=r.default.Action,C=function(){};function O(g){if(g&&"params"in g&&!l.isObject(g.params))return new h.default("options.params must be an object",4e4,400);if(g&&"modes"in g){if(!l.isArray(g.modes))return new h.default("options.modes must be an array",4e4,400);for(var A=0;A<g.modes.length;A++){var f=g.modes[A];if(!f||typeof f!="string"||!l.arrIn(r.default.channelModes,String.prototype.toUpperCase.call(f)))return new h.default("Invalid channel mode: "+f,4e4,400)}}}var x=function(g){i.__extends(A,g);function A(f,p,S){var y=g.call(this,f,p,S)||this;return y.retryCount=0,y.history=function(I,F){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),F===void 0)if(typeof I=="function")F=I,I=null;else{if(this.rest.options.promises)return l.promisify(this,"history",arguments);F=C}if(I&&I.untilAttach){if(this.state!=="attached"){F(new h.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){F(new h.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete I.untilAttach,I.from_serial=this.properties.attachSerial}u.default.prototype._history.call(this,I,F)},y.whenState=function(I,F){return a.default.prototype.whenState.call(y,I,y.state,F)},c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),y.realtime=f,y.presence=new m.default(y),y.connectionManager=f.connection.connectionManager,y.state="initialized",y.subscriptions=new a.default,y.syncChannelSerial=void 0,y.properties={attachSerial:void 0,channelSerial:void 0},y.setOptions(S),y.errorReason=null,y._requestedFlags=null,y._mode=null,y._attachResume=!1,y._decodingContext={channelOptions:y.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},y._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},y._allChannelChanges=new a.default,y}return A.prototype.invalidStateError=function(){return new h.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},A.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},A.prototype.setOptions=function(f,p){if(!p&&this.rest.options.promises)return l.promisify(this,"setOptions",arguments);var S=p||function(I){I&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+I.toString())},y=O(f);if(y){S(y);return}u.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(I){switch(this.event){case"update":case"attached":S==null||S(null);return;default:S==null||S(I.reason);return}})):S()},A.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&((f==null?void 0:f.params)||(f==null?void 0:f.modes))},A.prototype.publish=function(){for(var f=this,p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var y=p[0],I=p.length,F=p[I-1];if(typeof F!="function"){if(this.realtime.options.promises)return l.promisify(this,"publish",arguments);F=C,++I}if(!this.connectionManager.activeState()){F(this.connectionManager.getError());return}if(I==2)if(l.isObject(y))y=[v.default.fromValues(y)];else if(l.isArray(y))y=v.default.fromValuesArray(y);else throw new h.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else y=[v.default.fromValues({name:p[0],data:p[1]})];var z=this.realtime.options.maxMessageSize;v.default.encodeArray(y,this.channelOptions,function(W){if(W){F(W);return}var N=v.default.getMessagesSize(y);if(N>z){F(new h.default("Maximum size of messages that can be published at once exceeded ( was "+N+" bytes; limit is "+z+" bytes)",40009,400));return}f.__publish(y,F)})},A.prototype.__publish=function(f,p){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var S=this.state;switch(S){case"failed":case"suspended":p(h.default.fromValues(this.invalidStateError()));break;default:{c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+S);var y=new r.default;y.action=P.MESSAGE,y.channel=this.name,y.messages=f,this.sendMessage(y,p);break}}},A.prototype.onEvent=function(f){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,S=0;S<f.length;S++){var y=f[S];p.emit(y.name,y)}},A.prototype.attach=function(f,p){var S;if(typeof f=="function"?(p=f,S=null):S=f,!p){if(this.realtime.options.promises)return l.promisify(this,"attach",arguments);p=function(y){y&&c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+y.toString())}}if(S)c.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=S;else if(this.state==="attached"){p(null,null);return}this._attach(!1,null,p)},A.prototype._attach=function(f,p,S){S||(S=function(I){I&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+I.toString())});var y=this.connectionManager;if(!y.activeState()){S(y.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",p),this.once(function(I){switch(this.event){case"attached":S==null||S(null,I);break;case"detached":case"suspended":case"failed":S==null||S(I.reason||y.getError()||new h.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":S==null||S(new h.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},A.prototype.attachImpl=function(){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var f=r.default.fromValues({action:P.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(l.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,C)},A.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return l.promisify(this,"detach",arguments);f=C}var p=this.connectionManager;if(!p.activeState()){f(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new h.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(S){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(S.reason||p.getError()||new h.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new h.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},A.prototype.detachImpl=function(f){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var p=r.default.fromValues({action:P.DETACH,channel:this.name});this.sendMessage(p,f||C)},A.prototype.subscribe=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var S=A.processListenerArgs(f),y=S[0],I=S[1],F=S[2];if(!F&&this.realtime.options.promises)return l.promisify(this,"subscribe",[y,I]);if(this.state==="failed"){F==null||F(h.default.fromValues(this.invalidStateError()));return}return y&&typeof y=="object"&&!Array.isArray(y)?this._subscribeFilter(y,I):this.subscriptions.on(y,I),this.attach(F||C)},A.prototype._subscribeFilter=function(f,p){var S=function(y){var I,F,z,W,N,R,L={name:y.name,refTimeserial:(F=(I=y.extras)===null||I===void 0?void 0:I.ref)===null||F===void 0?void 0:F.timeserial,refType:(W=(z=y.extras)===null||z===void 0?void 0:z.ref)===null||W===void 0?void 0:W.type,isRef:!!(!((R=(N=y.extras)===null||N===void 0?void 0:N.ref)===null||R===void 0)&&R.timeserial),clientId:y.clientId};Object.entries(f).find(function($){var G=$[0],J=$[1];return J!==void 0?L[G]!==J:!1})||p(y)};this._addFilteredSubscription(f,p,S),this.subscriptions.on(S)},A.prototype._addFilteredSubscription=function(f,p,S){var y;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var I=this.filteredSubscriptions.get(p);I.set(f,((y=I==null?void 0:I.get(f))===null||y===void 0?void 0:y.concat(S))||[S])}else this.filteredSubscriptions.set(p,new Map([[f,[S]]]))},A.prototype._getAndDeleteFilteredSubscriptions=function(f,p){var S=this;if(!this.filteredSubscriptions)return[];if(!p&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(z){var W,N=z[0],R=z[1],L=R.get(f);return R.delete(f),R.size===0&&((W=S.filteredSubscriptions)===null||W===void 0||W.delete(N)),L}).reduce(function(z,W){var N;return W?(N=z).concat.apply(N,W):z},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var y=this.filteredSubscriptions.get(p);if(!f){var I=Array.from(y.values()).reduce(function(z,W){return z.concat.apply(z,W)},[]);return this.filteredSubscriptions.delete(p),I}var F=y.get(f);return y.delete(f),F||[]},A.prototype.unsubscribe=function(){for(var f=this,p,S=[],y=0;y<arguments.length;y++)S[y]=arguments[y];var I=A.processListenerArgs(S),F=I[0],z=I[1];if(typeof F=="object"&&!z||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(z))){this._getAndDeleteFilteredSubscriptions(F,z).forEach(function(W){return f.subscriptions.off(W)});return}this.subscriptions.off(F,z)},A.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new h.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var p=r.default.fromValues({action:P.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),f.send(p)},A.prototype.sendMessage=function(f,p){this.connectionManager.send(f,this.realtime.options.queueMessages,p)},A.prototype.sendPresence=function(f,p){var S=r.default.fromValues({action:P.PRESENCE,channel:this.name,presence:l.isArray(f)?b.default.fromValuesArray(f):[b.default.fromValues(f)]});this.sendMessage(S,p)},A.prototype.onMessage=function(f){(f.action===P.ATTACHED||f.action===P.MESSAGE||f.action===P.PRESENCE)&&this.setChannelSerial(f.channelSerial);var p,S=!1;switch(f.action){case P.ATTACHED:{this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var y=f.decodeModesFromFlags();this.modes=y&&l.allToLowerCase(y)||void 0;var I=f.hasFlag("RESUMED"),F=f.hasFlag("HAS_PRESENCE"),z=f.hasFlag("HAS_BACKLOG");if(this.state==="attached"){I||this.presence.onAttached(F);var W=new E.default(this.state,this.state,I,z,f.error);this._allChannelChanges.emit("update",W),(!I||this.channelOptions.updateOnAttached)&&this.emit("update",W)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,I,F,z);break}case P.DETACHED:{var N=f.error?h.default.fromValues(f.error):new h.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",N):this.state==="attaching"?this.notifyState("suspended",N):this.requestState("attaching",N);break}case P.SYNC:if(S=!0,p=this.syncChannelSerial=f.channelSerial,!f.presence)break;case P.PRESENCE:{for(var R=f.presence,L=f.id,$=f.connectionId,G=f.timestamp,J=this.channelOptions,tt=void 0,it=0;it<R.length;it++)try{tt=R[it],b.default.decode(tt,J),tt.connectionId||(tt.connectionId=$),tt.timestamp||(tt.timestamp=G),tt.id||(tt.id=L+":"+it)}catch(et){c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",et.toString())}this.presence.setPresence(R,S,p);break}case P.MESSAGE:{if(this.state!=="attached"){c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var X=f.messages,_=X[0],B=X[X.length-1],L=f.id,$=f.connectionId,G=f.timestamp;if(_.extras&&_.extras.delta&&_.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new h.default(H,40018,400));break}for(var it=0;it<X.length;it++){var H=X[it];try{v.default.decode(H,this._decodingContext)}catch(zt){switch(c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",zt.toString()),zt.code){case 40018:this._startDecodeFailureRecovery(zt);return;case 40019:case 40021:this.notifyState("failed",zt);return}}H.connectionId||(H.connectionId=$),H.timestamp||(H.timestamp=G),H.id||(H.id=L+":"+it)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(X);break}case P.ERROR:{var j=f.error;j&&j.code==80016?this.checkPendingState():this.notifyState("failed",h.default.fromValues(j));break}default:c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(w.default.unknownChannelErr())}},A.prototype._startDecodeFailureRecovery=function(f){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},A.prototype.onAttached=function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},A.prototype.notifyState=function(f,p,S,y,I){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),l.arrIn(["detached","suspended","failed"],f)&&(this.properties.channelSerial=null),f!==this.state){this.presence.actOnChannelState(f,y,p),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var F=new E.default(this.state,f,S,I,p),z=f==="failed"?c.default.LOG_ERROR:c.default.LOG_MAJOR;c.default.logAction(z,'Channel state for channel "'+this.name+'"',f+(p?"; reason: "+p:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"&&this.onAttached(),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,F),this.emit(f,F)}},A.prototype.requestState=function(f,p){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,p),this.checkPendingState()},A.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},A.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new h.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new h.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},A.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},A.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},A.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var p=l.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},p)}},A.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},A.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new h.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},A.prototype.setChannelSerial=function(f){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+f+"; previous = "+this.properties.channelSerial),f&&(this.properties.channelSerial=f)},A}(u.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(a,l,u,c,m){this.previous=a,this.current=l,l==="attached"&&(this.resumed=u,this.hasBacklog=c),m&&(this.reason=m)}return r}();e.default=i},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(){var r=i,a=r.lib,l=a.WordArray,u=a.Hasher,c=r.algo,m=[],v=c.SHA1=u.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,h){for(var b=this._hash.words,w=b[0],P=b[1],C=b[2],O=b[3],x=b[4],g=0;g<80;g++){if(g<16)m[g]=E[h+g]|0;else{var A=m[g-3]^m[g-8]^m[g-14]^m[g-16];m[g]=A<<1|A>>>31}var f=(w<<5|w>>>27)+x+m[g];g<20?f+=(P&C|~P&O)+1518500249:g<40?f+=(P^C^O)+1859775393:g<60?f+=(P&C|P&O|C&O)-1894007588:f+=(P^C^O)-899497514,x=O,O=C,C=P<<30|P>>>2,P=w,w=f}b[0]=b[0]+w|0,b[1]=b[1]+P|0,b[2]=b[2]+C|0,b[3]=b[3]+O|0,b[4]=b[4]+x|0},_doFinalize:function(){var E=this._data,h=E.words,b=this._nDataBytes*8,w=E.sigBytes*8;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=Math.floor(b/4294967296),h[(w+64>>>9<<4)+15]=b,E.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var E=u.clone.call(this);return E._hash=this._hash.clone(),E}});r.SHA1=u._createHelper(v),r.HmacSHA1=u._createHmacHelper(v)}(),i.SHA1})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function i(g){if(g===void 0)return"undefined";var A,f;if(g instanceof ArrayBuffer?(f="ArrayBuffer",A=new DataView(g)):g instanceof DataView&&(f="DataView",A=g),!A)return JSON.stringify(g);for(var p=[],S=0;S<g.byteLength;S++){if(S>20){p.push("...");break}var y=A.getUint8(S).toString(16);y.length===1&&(y="0"+y),p.push(y)}return"<"+f+" "+p.join(" ")+">"}function r(g,A,f){for(var p=0,S=f.length;p<S;p++){var y=f.charCodeAt(p);if(y<128){g.setUint8(A++,y>>>0&127|0);continue}if(y<2048){g.setUint8(A++,y>>>6&31|192),g.setUint8(A++,y>>>0&63|128);continue}if(y<65536){g.setUint8(A++,y>>>12&15|224),g.setUint8(A++,y>>>6&63|128),g.setUint8(A++,y>>>0&63|128);continue}if(y<1114112){g.setUint8(A++,y>>>18&7|240),g.setUint8(A++,y>>>12&63|128),g.setUint8(A++,y>>>6&63|128),g.setUint8(A++,y>>>0&63|128);continue}throw new Error("bad codepoint "+y)}}function a(g,A,f){for(var p="",S=A,y=A+f;S<y;S++){var I=g.getUint8(S);if((I&128)===0){p+=String.fromCharCode(I);continue}if((I&224)===192){p+=String.fromCharCode((I&15)<<6|g.getUint8(++S)&63);continue}if((I&240)===224){p+=String.fromCharCode((I&15)<<12|(g.getUint8(++S)&63)<<6|(g.getUint8(++S)&63)<<0);continue}if((I&248)===240){p+=String.fromCharCode((I&7)<<18|(g.getUint8(++S)&63)<<12|(g.getUint8(++S)&63)<<6|(g.getUint8(++S)&63)<<0);continue}throw new Error("Invalid byte "+I.toString(16))}return p}function l(g){for(var A=0,f=0,p=g.length;f<p;f++){var S=g.charCodeAt(f);if(S<128){A+=1;continue}if(S<2048){A+=2;continue}if(S<65536){A+=3;continue}if(S<1114112){A+=4;continue}throw new Error("bad codepoint "+S)}return A}function u(g,A){var f=x(g,A);if(f!==0){var p=new ArrayBuffer(f),S=new DataView(p);return O(g,S,0,A),p}}var c=(1<<16)*(1<<16),m=1/c;function v(g,A){return A=A||0,g.getInt32(A)*c+g.getUint32(A+4)}function E(g,A){return A=A||0,g.getUint32(A)*c+g.getUint32(A+4)}function h(g,A,f){f<9223372036854776e3?(g.setInt32(A,Math.floor(f*m)),g.setInt32(A+4,f&-1)):(g.setUint32(A,2147483647),g.setUint32(A+4,2147483647))}function b(g,A,f){f<18446744073709552e3?(g.setUint32(A,Math.floor(f*m)),g.setInt32(A+4,f&-1)):(g.setUint32(A,4294967295),g.setUint32(A+4,4294967295))}var w=function(){function g(A,f){var p=this;this.map=function(S){for(var y={},I=0;I<S;I++){var F=p.parse();y[F]=p.parse()}return y},this.bin=function(S){var y=new ArrayBuffer(S);return new Uint8Array(y).set(new Uint8Array(p.view.buffer,p.offset,S),0),p.offset+=S,y},this.buf=this.bin,this.str=function(S){var y=a(p.view,p.offset,S);return p.offset+=S,y},this.array=function(S){for(var y=new Array(S),I=0;I<S;I++)y[I]=p.parse();return y},this.ext=function(S){return p.offset+=S,{type:p.view.getInt8(p.offset),data:p.buf(S)}},this.parse=function(){var S=p.view.getUint8(p.offset),y,I;if((S&128)===0)return p.offset++,S;if((S&240)===128)return I=S&15,p.offset++,p.map(I);if((S&240)===144)return I=S&15,p.offset++,p.array(I);if((S&224)===160)return I=S&31,p.offset++,p.str(I);if((S&224)===224)return y=p.view.getInt8(p.offset),p.offset++,y;switch(S){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(I);case 197:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(I);case 198:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(I);case 199:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(I);case 200:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(I);case 201:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(I);case 202:return y=p.view.getFloat32(p.offset+1),p.offset+=5,y;case 203:return y=p.view.getFloat64(p.offset+1),p.offset+=9,y;case 204:return y=p.view.getUint8(p.offset+1),p.offset+=2,y;case 205:return y=p.view.getUint16(p.offset+1),p.offset+=3,y;case 206:return y=p.view.getUint32(p.offset+1),p.offset+=5,y;case 207:return y=E(p.view,p.offset+1),p.offset+=9,y;case 208:return y=p.view.getInt8(p.offset+1),p.offset+=2,y;case 209:return y=p.view.getInt16(p.offset+1),p.offset+=3,y;case 210:return y=p.view.getInt32(p.offset+1),p.offset+=5,y;case 211:return y=v(p.view,p.offset+1),p.offset+=9,y;case 212:return I=1,p.offset++,p.ext(I);case 213:return I=2,p.offset++,p.ext(I);case 214:return I=4,p.offset++,p.ext(I);case 215:return I=8,p.offset++,p.ext(I);case 216:return I=16,p.offset++,p.ext(I);case 217:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.str(I);case 218:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.str(I);case 219:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.str(I);case 220:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.array(I);case 221:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.array(I);case 222:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.map(I);case 223:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.map(I)}throw new Error("Unknown type 0x"+S.toString(16))},this.offset=f||0,this.view=A}return g}();function P(g){var A=new DataView(g),f=new w(A),p=f.parse();if(f.offset!==g.byteLength)throw new Error(g.byteLength-f.offset+" trailing bytes");return p}function C(g,A){return Object.keys(g).filter(function(f){var p=g[f],S=typeof p;return(!A||p!=null)&&(S!=="function"||!!p.toJSON)})}function O(g,A,f,p){var S=typeof g;if(typeof g=="string"){var y=l(g);if(y<32)return A.setUint8(f,y|160),r(A,f+1,g),1+y;if(y<256)return A.setUint8(f,217),A.setUint8(f+1,y),r(A,f+2,g),2+y;if(y<65536)return A.setUint8(f,218),A.setUint16(f+1,y),r(A,f+3,g),3+y;if(y<4294967296)return A.setUint8(f,219),A.setUint32(f+1,y),r(A,f+5,g),5+y}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var I=g.byteLength;if(I<256)return A.setUint8(f,196),A.setUint8(f+1,I),new Uint8Array(A.buffer).set(new Uint8Array(g),f+2),2+I;if(I<65536)return A.setUint8(f,197),A.setUint16(f+1,I),new Uint8Array(A.buffer).set(new Uint8Array(g),f+3),3+I;if(I<4294967296)return A.setUint8(f,198),A.setUint32(f+1,I),new Uint8Array(A.buffer).set(new Uint8Array(g),f+5),5+I}if(typeof g=="number"){if(Math.floor(g)!==g)return A.setUint8(f,203),A.setFloat64(f+1,g),9;if(g>=0){if(g<128)return A.setUint8(f,g),1;if(g<256)return A.setUint8(f,204),A.setUint8(f+1,g),2;if(g<65536)return A.setUint8(f,205),A.setUint16(f+1,g),3;if(g<4294967296)return A.setUint8(f,206),A.setUint32(f+1,g),5;if(g<18446744073709552e3)return A.setUint8(f,207),b(A,f+1,g),9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return A.setInt8(f,g),1;if(g>=-128)return A.setUint8(f,208),A.setInt8(f+1,g),2;if(g>=-32768)return A.setUint8(f,209),A.setInt16(f+1,g),3;if(g>=-2147483648)return A.setUint8(f,210),A.setInt32(f+1,g),5;if(g>=-9223372036854776e3)return A.setUint8(f,211),h(A,f+1,g),9;throw new Error("Number too small -0x"+(-g).toString(16).substr(1))}if(S==="undefined")return p?0:(A.setUint8(f,212),A.setUint8(f+1,0),A.setUint8(f+2,0),3);if(g===null)return p?0:(A.setUint8(f,192),1);if(S==="boolean")return A.setUint8(f,g?195:194),1;if(typeof g.toJSON=="function")return O(g.toJSON(),A,f,p);if(S==="object"){var F,z=0,W=void 0,N=Array.isArray(g);if(N?F=g.length:(W=C(g,p),F=W.length),F<16?(A.setUint8(f,F|(N?144:128)),z=1):F<65536?(A.setUint8(f,N?220:222),A.setUint16(f+1,F),z=3):F<4294967296&&(A.setUint8(f,N?221:223),A.setUint32(f+1,F),z=5),N)for(var R=0;R<F;R++)z+=O(g[R],A,f+z,p);else if(W)for(var R=0;R<F;R++){var L=W[R];z+=O(L,A,f+z),z+=O(g[L],A,f+z,p)}return z}if(S==="function")return 0;throw new Error("Unknown type "+S)}function x(g,A){var f=typeof g;if(f==="string"){var p=l(g);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var S=g.byteLength;if(S<256)return 2+S;if(S<65536)return 3+S;if(S<4294967296)return 5+S}if(typeof g=="number"){if(Math.floor(g)!==g)return 9;if(g>=0){if(g<128)return 1;if(g<256)return 2;if(g<65536)return 3;if(g<4294967296)return 5;if(g<18446744073709552e3)return 9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return 1;if(g>=-128)return 2;if(g>=-32768)return 3;if(g>=-2147483648)return 5;if(g>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+g.toString(16).substr(1))}if(f==="boolean")return 1;if(g===null)return A?0:1;if(g===void 0)return A?0:3;if(typeof g.toJSON=="function")return x(g.toJSON(),A);if(f==="object"){var y,I=0;if(Array.isArray(g)){y=g.length;for(var F=0;F<y;F++)I+=x(g[F],A)}else{var z=C(g,A);y=z.length;for(var F=0;F<y;F++){var W=z[F];I+=x(W)+x(g[W],A)}}if(y<16)return 1+I;if(y<65536)return 3+I;if(y<4294967296)return 5+I;throw new Error("Array or object too long 0x"+y.toString(16))}if(f==="function")return 0;throw new Error("Unknown type "+f)}e.default={encode:u,decode:P,inspect:i,utf8Write:r,utf8Read:a,utf8ByteCount:l}},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(30)),a=i.__importDefault(t(50)),l=i.__importDefault(t(3)),u=i.__importDefault(t(4)),c=i.__importDefault(t(55)),m=i.__importDefault(t(57)),v=i.__importDefault(t(62)),E=i.__importDefault(t(64)),h=i.__importDefault(t(68)),b=i.__importDefault(t(2)),w=t(8),P=i.__importDefault(t(65)),C=i.__importDefault(t(66)),O=i.__importDefault(t(41)),x=(0,m.default)(E.default,c.default);l.default.Crypto=x,l.default.BufferUtils=c.default,l.default.Http=v.default,l.default.Config=E.default,l.default.Transports=h.default,l.default.WebStorage=P.default,r.default.Crypto=x,a.default.Crypto=x,b.default.initLogHandlers(),l.default.Defaults=(0,w.getDefaults)(C.default),l.default.Config.agent&&(l.default.Defaults.agent+=" "+l.default.Config.agent),l.default.Config.noUpgrade&&(l.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:u.default,Rest:r.default,Realtime:a.default,msgpack:O.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(s,e){},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(32),t(24))})(this,function(i){return i.HmacSHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(47)),l=i.__importDefault(t(14)),u=i.__importDefault(t(19)),c=i.__importDefault(t(4)),m=i.__importDefault(t(48)),v=function(){},E=function(){function P(C){this.rest=C,this.admin=new h(C)}return P}(),h=function(){function P(C){this.rest=C,this.deviceRegistrations=new b(C),this.channelSubscriptions=new w(C)}return P.prototype.publish=function(C,O,x){var g=this.rest,A=g.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(g.options,A),p={},S=r.mixin({recipient:C},O);if(typeof x!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);x=v}g.options.headers&&r.mixin(f,g.options.headers),g.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var y=r.encodeBody(S,A);l.default.post(g,"/push/publish",y,f,p,null,function(I){return x(I)})},P}(),b=function(){function P(C){this.rest=C}return P.prototype.save=function(C,O){var x=this.rest,g=a.default.fromValues(C),A=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(x.options,A),p={};if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);O=v}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var S=r.encodeBody(g,A);l.default.put(x,"/push/deviceRegistrations/"+encodeURIComponent(C.id),S,f,p,null,function(y,I,F,z){O(y,y?void 0:a.default.fromResponseBody(I,z?void 0:A))})},P.prototype.get=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,g),f=C.id||C;if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"get",arguments);O=v}if(typeof f!="string"||!f.length){O(new c.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&r.mixin(A,x.options.headers),l.default.get(x,"/push/deviceRegistrations/"+encodeURIComponent(f),A,{},null,function(p,S,y,I){O(p,p?void 0:a.default.fromResponseBody(S,I?void 0:g))})},P.prototype.list=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:g,f=r.defaultGetHeaders(x.options,g);if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);O=v}x.options.headers&&r.mixin(f,x.options.headers),new u.default(x,"/push/deviceRegistrations",f,A,function(p,S,y){return a.default.fromResponseBody(p,y?void 0:g)}).get(C,O)},P.prototype.remove=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,g),f={},p=C.id||C;if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"remove",arguments);O=v}if(typeof p!="string"||!p.length){O(new c.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(f,{fullWait:"true"}),l.default.delete(x,"/push/deviceRegistrations/"+encodeURIComponent(p),A,f,null,function(S){return O(S)})},P.prototype.removeWhere=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,g);if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);O=v}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),l.default.delete(x,"/push/deviceRegistrations",A,C,null,function(f){return O(f)})},P}(),w=function(){function P(C){this.remove=P.prototype.removeWhere,this.rest=C}return P.prototype.save=function(C,O){var x=this.rest,g=m.default.fromValues(C),A=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(x.options,A),p={};if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);O=v}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var S=r.encodeBody(g,A);l.default.post(x,"/push/channelSubscriptions",S,f,p,null,function(y,I,F,z){O(y,!y&&m.default.fromResponseBody(I,z?void 0:A))})},P.prototype.list=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:g,f=r.defaultGetHeaders(x.options,g);if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);O=v}x.options.headers&&r.mixin(f,x.options.headers),new u.default(x,"/push/channelSubscriptions",f,A,function(p,S,y){return m.default.fromResponseBody(p,y?void 0:g)}).get(C,O)},P.prototype.removeWhere=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,g);if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);O=v}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),l.default.delete(x,"/push/channelSubscriptions",A,C,null,function(f){return O(f)})},P.prototype.listChannels=function(C,O){var x=this.rest,g=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:g,f=r.defaultGetHeaders(x.options,g);if(typeof O!="function"){if(this.rest.options.promises)return r.promisify(this,"listChannels",arguments);O=v}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),new u.default(x,"/push/channels",f,A,function(p,S,y){for(var I=!y&&g?r.decodeBody(p,g):p,F=0;F<I.length;F++)I[F]=String(I[F]);return I}).get(C,O)},P}();e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(4)),l;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(l||(l={}));var u;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(u||(u={}));var c=function(){function m(){}return m.prototype.toJSON=function(){var v,E,h;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(v=this.push)===null||v===void 0?void 0:v.recipient,state:(E=this.push)===null||E===void 0?void 0:E.state,error:(h=this.push)===null||h===void 0?void 0:h.error}}},m.prototype.toString=function(){var v,E,h,b,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((v=this.push)===null||v===void 0)&&v.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((E=this.push)===null||E===void 0)&&E.state&&(w+="; push.state="+this.push.state),!((h=this.push)===null||h===void 0)&&h.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((b=this.push)===null||b===void 0)&&b.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},m.fromResponseBody=function(v,E){return E&&(v=r.decodeBody(v,E)),r.isArray(v)?m.fromValuesArray(v):m.fromValues(v)},m.fromValues=function(v){return v.error=v.error&&a.default.fromValues(v.error),Object.assign(new m,v)},m.fromValuesArray=function(v){for(var E=v.length,h=new Array(E),b=0;b<E;b++)h[b]=m.fromValues(v[b]);return h},m.toRequestBody=r.encodeBody,m}();e.default=c},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=function(){function l(){}return l.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},l.prototype.toString=function(){var u="[PushChannelSubscription";return this.channel&&(u+="; channel="+this.channel),this.deviceId&&(u+="; deviceId="+this.deviceId),this.clientId&&(u+="; clientId="+this.clientId),u+="]",u},l.fromResponseBody=function(u,c){return c&&(u=r.decodeBody(u,c)),r.isArray(u)?l.fromValuesArray(u):l.fromValues(u)},l.fromValues=function(u){return Object.assign(new l,u)},l.fromValuesArray=function(u){for(var c=u.length,m=new Array(c),v=0;v<c;v++)m[v]=l.fromValues(u[v]);return m},l.toRequestBody=r.encodeBody,l}();e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=function(){function x(g){this.count=g&&g.count||0,this.data=g&&g.data||0,this.uncompressedData=g&&g.uncompressedData||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return x}(),l=function(x){i.__extends(g,x);function g(A){var f=x.call(this,A)||this;return A&&A.category&&(f.category={},r.forInOwnNonNullProperties(A.category,function(p){f.category[p]=new a(A.category[p])})),f}return g}(a),u=function(){function x(g){this.peak=g&&g.peak||0,this.min=g&&g.min||0,this.mean=g&&g.mean||0,this.opened=g&&g.opened||0,this.refused=g&&g.refused||0}return x}(),c=function(){function x(g){this.succeeded=g&&g.succeeded||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return x}(),m=function(){function x(g){this.plain=new u(g&&g.plain),this.tls=new u(g&&g.tls),this.all=new u(g&&g.all)}return x}(),v=function(){function x(g){this.messages=new l(g&&g.messages),this.presence=new l(g&&g.presence),this.all=new l(g&&g.all)}return x}(),E=function(){function x(g){this.realtime=new v(g&&g.realtime),this.rest=new v(g&&g.rest),this.webhook=new v(g&&g.webhook),this.sharedQueue=new v(g&&g.sharedQueue),this.externalQueue=new v(g&&g.externalQueue),this.httpEvent=new v(g&&g.httpEvent),this.push=new v(g&&g.push),this.all=new v(g&&g.all)}return x}(),h=function(){function x(g){this.all=new v(g&&g.all),this.inbound=new E(g&&g.inbound),this.outbound=new E(g&&g.outbound)}return x}(),b=function(){function x(g){this.all=new v(g&&g.all),this.producerPaid=new h(g&&g.producerPaid),this.consumerPaid=new h(g&&g.consumerPaid)}return x}(),w=function(){function x(g){this.messages=g&&g.messages||0;var A=g&&g.notifications;this.notifications={invalid:A&&A.invalid||0,attempted:A&&A.attempted||0,successful:A&&A.successful||0,failed:A&&A.failed||0},this.directPublishes=g&&g.directPublishes||0}return x}(),P=function(){function x(g){this.succeeded=g&&g.succeeded||0,this.skipped=g&&g.skipped||0,this.failed=g&&g.failed||0}return x}(),C=function(){function x(g){var A=this;this.delta=void 0,g&&g.delta&&(this.delta={},r.forInOwnNonNullProperties(g.delta,function(f){A.delta[f]=new P(g.delta[f])}))}return x}(),O=function(x){i.__extends(g,x);function g(A){var f=x.call(this,A)||this;return f.persisted=new v(A&&A.persisted),f.connections=new m(A&&A.connections),f.channels=new u(A&&A.channels),f.apiRequests=new c(A&&A.apiRequests),f.tokenRequests=new c(A&&A.tokenRequests),f.xchgProducer=new b(A&&A.xchgProducer),f.xchgConsumer=new b(A&&A.xchgConsumer),f.push=new w(A&&A.pushStats),f.processed=new C(A&&A.processed),f.inProgress=A&&A.inProgress||void 0,f.unit=A&&A.unit||void 0,f.intervalId=A&&A.intervalId||void 0,f}return g.fromValues=function(A){return new g(A)},g}(h);e.default=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(30)),l=i.__importDefault(t(7)),u=i.__importDefault(t(2)),c=i.__importDefault(t(51)),m=i.__importDefault(t(38)),v=i.__importDefault(t(8)),E=i.__importDefault(t(4)),h=i.__importDefault(t(10)),b=i.__importDefault(t(35)),w=i.__importDefault(t(3)),P=i.__importDefault(t(9)),C=function(x){i.__extends(g,x);function g(A){var f=x.call(this,A)||this;return u.default.logAction(u.default.LOG_MINOR,"Realtime()",""),f.connection=new c.default(f,f.options),f.channels=new O(f),A.autoConnect!==!1&&f.connect(),f}return g.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},g.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},g.Promise=function(A){return A=v.default.objectifyOptions(A),A.promises=!0,new g(A)},g.Callbacks=g,g.Utils=r,g.ConnectionManager=b.default,g.Platform=w.default,g.ProtocolMessage=h.default,g.Message=P.default,g}(a.default),O=function(x){i.__extends(g,x);function g(A){var f=x.call(this)||this;return f.realtime=A,f.all=Object.create(null),A.connection.connectionManager.on("transport.active",function(){f.onTransportActive()}),f}return g.prototype.channelSerials=function(){for(var A={},f=0,p=r.keysArray(this.all,!0);f<p.length;f++){var S=p[f],y=this.all[S];y.properties.channelSerial&&(A[S]=y.properties.channelSerial)}return A},g.prototype.recoverChannels=function(A){for(var f=0,p=r.keysArray(A,!0);f<p.length;f++){var S=p[f],y=this.get(S);y.properties.channelSerial=A[S]}},g.prototype.onChannelMessage=function(A){var f=A.channel;if(f===void 0){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+A.action);return}var p=this.all[f];if(!p){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+f);return}p.onMessage(A)},g.prototype.onTransportActive=function(){for(var A in this.all){var f=this.all[A];f.state==="attaching"||f.state==="detaching"?f.checkPendingState():f.state==="suspended"?f._attach(!1,null):f.state==="attached"&&f.requestState("attaching")}},g.prototype.propogateConnectionInterruption=function(A,f){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},S=["attaching","attached","detaching","suspended"],y=p[A];for(var I in this.all){var F=this.all[I];r.arrIn(S,F.state)&&F.notifyState(y,f)}},g.prototype.get=function(A,f){A=String(A);var p=this.all[A];if(!p)p=this.all[A]=new m.default(this.realtime,A,f);else if(f){if(p._shouldReattachToSetOptions(f))throw new E.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(f)}return p},g.prototype.getDerived=function(A,f,p){if(f.filter){var S=r.toBase64(f.filter),y=r.matchDerivedChannel(A);A="[filter=".concat(S).concat(y.qualifierParam,"]").concat(y.channelName)}return this.get(A,p)},g.prototype.release=function(A){A=String(A);var f=this.all[A];if(!!f){var p=f.getReleaseErr();if(p)throw p;delete this.all[A]}},g}(l.default);e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(7)),l=i.__importDefault(t(35)),u=i.__importDefault(t(2)),c=i.__importDefault(t(37)),m=i.__importDefault(t(3));function v(){}var E=function(h){i.__extends(b,h);function b(w,P){var C=h.call(this)||this;return C.whenState=function(O,x){return a.default.prototype.whenState.call(C,O,C.state,x,new c.default(void 0,O))},C.ably=w,C.connectionManager=new l.default(w,P),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(O){var x=C.state=O.current;m.default.Config.nextTick(function(){C.emit(x,O)})}),C.connectionManager.on("update",function(O){m.default.Config.nextTick(function(){C.emit("update",O)})}),C}return b.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},b.prototype.ping=function(w){if(u.default.logAction(u.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return r.promisify(this,"ping",arguments);w=v}this.connectionManager.ping(null,w)},b.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(b.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),b.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},b}(a.default);e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var i=t(0),r=i.__importDefault(t(10)),a=i.__importStar(t(1)),l=i.__importDefault(t(7)),u=i.__importDefault(t(2)),c=i.__importDefault(t(36)),m=i.__importDefault(t(4)),v=r.default.Action,E=function(){function b(w,P){this.message=w,this.callback=P,this.merged=!1;var C=w.action;this.sendAttempted=!1,this.ackRequired=C==v.MESSAGE||C==v.PRESENCE}return b}();e.PendingMessage=E;var h=function(b){i.__extends(w,b);function w(P){var C=b.call(this)||this;return C.transport=P,C.messageQueue=new c.default,P.on("ack",function(O,x){C.onAck(O,x)}),P.on("nack",function(O,x,g){C.onNack(O,x,g)}),C}return w.prototype.onAck=function(P,C){u.default.logAction(u.default.LOG_MICRO,"Protocol.onAck()","serial = "+P+"; count = "+C),this.messageQueue.completeMessages(P,C)},w.prototype.onNack=function(P,C,O){u.default.logAction(u.default.LOG_ERROR,"Protocol.onNack()","serial = "+P+"; count = "+C+"; err = "+a.inspectError(O)),O||(O=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(P,C,O)},w.prototype.onceIdle=function(P){var C=this.messageQueue;if(C.count()===0){P();return}C.once("idle",P)},w.prototype.send=function(P){P.ackRequired&&this.messageQueue.push(P),u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Protocol.send()","sending msg; "+r.default.stringify(P.message)),P.sendAttempted=!0,this.transport.send(P.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var P=this.transport;this.onceIdle(function(){P.disconnect()})},w}(l.default);e.default=h},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),a=i.__importStar(t(1)),l=i.__importDefault(t(26)),u=i.__importDefault(t(8)),c=i.__importDefault(t(2)),m=i.__importDefault(t(10)),v=i.__importDefault(t(4)),E="web_socket";function h(P){return!!P.on}var b=function(P){i.__extends(C,P);function C(O,x,g){var A=P.call(this,O,x,g)||this;return A.shortName=E,g.heartbeats=r.default.Config.useProtocolHeartbeats,A.wsHost=u.default.getHost(g.options,g.host,!0),A}return C.isAvailable=function(){return!!r.default.Config.WebSocket},C.prototype.createWebSocket=function(O,x){return this.uri=O+a.toQueryString(x),new r.default.Config.WebSocket(this.uri)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),l.default.prototype.connect.call(this);var O=this,x=this.params,g=x.options,A=g.tls?"wss://":"ws://",f=A+this.wsHost+":"+u.default.getPort(g)+"/";c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+f),this.auth.getAuthParams(function(p,S){if(!O.isDisposed){var y="";for(var I in S)y+=" "+I+": "+S[I]+";";if(c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+y+" err: "+p),p){O.disconnect(p);return}var F=x.getConnectParams(S);try{var z=O.wsConnection=O.createWebSocket(f,F);z.binaryType=r.default.Config.binaryType,z.onopen=function(){O.onWsOpen()},z.onclose=function(W){O.onWsClose(W)},z.onmessage=function(W){O.onWsData(W.data)},z.onerror=function(W){O.onWsError(W)},h(z)&&z.on("ping",function(){O.onActivity()})}catch(W){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(W.stack||W.message)),O.disconnect(W)}}})},C.prototype.send=function(O){var x=this.wsConnection;if(!x){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{x.send(m.default.serialize(O,this.params.format))}catch(A){var g="Exception from ws connection when trying to send: "+a.inspectError(A);c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()",g),this.finish("disconnected",new v.default(g,5e4,500))}},C.prototype.onWsData=function(O){c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+O.length+"; type = "+typeof O);try{this.onProtocolMessage(m.default.deserialize(O,this.format))}catch(x){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+x.stack)}},C.prototype.onWsOpen=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(O){var x,g;if(typeof O=="object"?(g=O.code,x=O.wasClean||g===1e3):(g=O,x=g==1e3),delete this.wsConnection,x){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var A=new v.default("Websocket closed",80003,400);this.finish("disconnected",A)}else{var f="Unclean disconnection of WebSocket ; code = "+g,A=new v.default(f,80003,400);c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()",f),this.finish("disconnected",A)}this.emit("disposed")},C.prototype.onWsError=function(O){var x=this;c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+O.message),r.default.Config.nextTick(function(){x.disconnect(Error(O.message))})},C.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var O=this.wsConnection;O&&(O.onmessage=function(){},delete this.wsConnection,r.default.Config.nextTick(function(){if(c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!O)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");O.close()}))},C}(l.default);function w(P){return b.isAvailable()&&(P.supportedTransports[E]=b),b}e.default=w},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),a=i.__importDefault(t(34)),l=i.__importDefault(t(7)),u=i.__importDefault(t(2)),c=i.__importDefault(t(15)),m=i.__importStar(t(4)),v=i.__importDefault(t(38)),E=i.__importDefault(t(23)),h=i.__importDefault(t(39)),b=function(){};function w(A){return A.channel.realtime.auth.clientId}function P(A){var f=A.channel.realtime,p=f.auth.clientId;return(!p||p==="*")&&f.connection.state==="connected"}function C(A,f,p){switch(A.state){case"attached":case"suspended":p();break;case"initialized":case"detached":case"detaching":case"attaching":A.attach(function(S){S?f(S):p()});break;default:f(m.default.fromValues(A.invalidStateError()))}}function O(A,f){if(A.isSynthesized()||f.isSynthesized())return A.timestamp>=f.timestamp;var p=A.parseId(),S=f.parseId();return p.msgSerial===S.msgSerial?p.index>S.index:p.msgSerial>S.msgSerial}var x=function(A){i.__extends(f,A);function f(p){var S=A.call(this,p)||this;return S.channel=p,S.syncComplete=!1,S.members=new g(S,function(y){return y.clientId+":"+y.connectionId}),S._myMembers=new g(S,function(y){return y.clientId}),S.subscriptions=new l.default,S.pendingPresence=[],S}return f.prototype.enter=function(p,S){if(P(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"enter",S)},f.prototype.update=function(p,S){if(P(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"update",S)},f.prototype.enterClient=function(p,S,y){return this._enterOrUpdateClient(void 0,p,S,"enter",y)},f.prototype.updateClient=function(p,S,y){return this._enterOrUpdateClient(void 0,p,S,"update",y)},f.prototype._enterOrUpdateClient=function(p,S,y,I,F){var z=this;if(!F)if(typeof y=="function")F=y,y=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"_enterOrUpdateClient",[p,S,y,I]);F=b}var W=this.channel;if(!W.connectionManager.activeState()){F(W.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence."+I+"Client()","channel = "+W.name+", id = "+p+", client = "+(S||"(implicit) "+w(this)));var N=c.default.fromData(y);N.action=I,p&&(N.id=p),S&&(N.clientId=S),c.default.encode(N,W.channelOptions,function(R){if(R){F(R);return}switch(W.state){case"attached":W.sendPresence(N,F);break;case"initialized":case"detached":W.attach();case"attaching":z.pendingPresence.push({presence:N,callback:F});break;default:R=new m.PartialErrorInfo("Unable to "+I+" presence channel while in "+W.state+" state",90001),R.code=90001,F(R)}})},f.prototype.leave=function(p,S){if(P(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,p,S)},f.prototype.leaveClient=function(p,S,y){if(!y)if(typeof S=="function")y=S,S=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"leaveClient",[p,S]);y=b}var I=this.channel;if(!I.connectionManager.activeState()){y==null||y(I.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+p);var F=c.default.fromValues({action:"leave",data:S});switch(p&&(F.clientId=p),I.state){case"attached":I.sendPresence(F,y);break;case"attaching":this.pendingPresence.push({presence:F,callback:y});break;case"initialized":case"failed":{var z=new m.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);y==null||y(z);break}default:y==null||y(I.invalidStateError())}},f.prototype.get=function(p,S){var y=this,I=Array.prototype.slice.call(arguments);I.length==1&&typeof I[0]=="function"&&I.unshift(null),p=I[0],S=I[1];var F=!p||("waitForSync"in p?p.waitForSync:!0);if(!S){if(this.channel.realtime.options.promises)return r.promisify(this,"get",I);S=b}function z(W){S(null,p?W.list(p):W.values())}if(this.channel.state==="suspended"){F?S(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):z(this.members);return}C(this.channel,S,function(){var W=y.members;F?W.waitSync(function(){z(W)}):z(W)})},f.prototype.history=function(p,S){if(u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),S===void 0)if(typeof p=="function")S=p,p=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"history",arguments);S=b}p&&p.untilAttach&&(this.channel.state==="attached"?(delete p.untilAttach,p.from_serial=this.channel.properties.attachSerial):S(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),a.default.prototype._history.call(this,p,S)},f.prototype.setPresence=function(p,S,y){u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+p.length+" participants; syncChannelSerial = "+y);var I,F,z=this.members,W=this._myMembers,N=[],R=this.channel.connectionManager.connectionId;S&&(this.members.startSync(),y&&(F=y.match(/^[\w-]+:(.*)$/))&&(I=F[1]));for(var L=0;L<p.length;L++){var $=c.default.fromValues(p[L]);switch($.action){case"leave":z.remove($)&&N.push($),$.connectionId===R&&!$.isSynthesized()&&W.remove($);break;case"enter":case"present":case"update":z.put($)&&N.push($),$.connectionId===R&&W.put($);break}}S&&!I&&(z.endSync(),this.channel.syncChannelSerial=null);for(var L=0;L<N.length;L++){var $=N[L];this.subscriptions.emit($.action,$)}},f.prototype.onAttached=function(p){u.default.logAction(u.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+p),p?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var S=this.pendingPresence,y=S.length;if(y){this.pendingPresence=[];var I=[],F=E.default.create();u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+y+" queued presence messages");for(var z=0;z<y;z++){var W=S[z];I.push(W.presence),F.push(W.callback)}this.channel.sendPresence(I,F)}},f.prototype.actOnChannelState=function(p,S,y){switch(p){case"attached":this.onAttached(S);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(y);break}},f.prototype.failPendingPresence=function(p){if(this.pendingPresence.length){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+r.inspectError(p));for(var S=0;S<this.pendingPresence.length;S++)try{this.pendingPresence[S].callback(p)}catch(y){}this.pendingPresence=[]}},f.prototype._clearMyMembers=function(){this._myMembers.clear()},f.prototype._ensureMyMembersPresent=function(){var p=this,S=this._myMembers,y=function(z){if(z){var W="Presence auto-re-enter failed: "+z.toString(),N=new m.default(W,91004,400);u.default.logAction(u.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",W);var R=new h.default(p.channel.state,p.channel.state,!0,!1,N);p.channel.emit("update",R)}};for(var I in S.map){var F=S.map[I];u.default.logAction(u.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+F.clientId+'" into the presence set'),this._enterOrUpdateClient(F.id,F.clientId,F.data,"enter",y)}},f.prototype._synthesizeLeaves=function(p){var S=this.subscriptions;r.arrForEach(p,function(y){var I=c.default.fromValues({action:"leave",connectionId:y.connectionId,clientId:y.clientId,data:y.data,encoding:y.encoding,timestamp:r.now()});S.emit("leave",I)})},f.prototype.on=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];u.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,p)},f.prototype.off=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];u.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,p)},f.prototype.subscribe=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var y=v.default.processListenerArgs(p),I=y[0],F=y[1],z=y[2],W=this.channel;if(!z){if(this.channel.realtime.options.promises)return r.promisify(this,"subscribe",[I,F]);z=b}if(W.state==="failed"){z(m.default.fromValues(W.invalidStateError()));return}this.subscriptions.on(I,F),W.attach(z)},f.prototype.unsubscribe=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var y=v.default.processListenerArgs(p),I=y[0],F=y[1];this.subscriptions.off(I,F)},f}(a.default),g=function(A){i.__extends(f,A);function f(p,S){var y=A.call(this)||this;return y.presence=p,y.map=Object.create(null),y.syncInProgress=!1,y.residualMembers=null,y.memberKey=S,y}return f.prototype.get=function(p){return this.map[p]},f.prototype.getClient=function(p){var S=this.map,y=[];for(var I in S){var F=S[I];F.clientId==p&&F.action!="absent"&&y.push(F)}return y},f.prototype.list=function(p){var S=this.map,y=p&&p.clientId,I=p&&p.connectionId,F=[];for(var z in S){var W=S[z];W.action!=="absent"&&(y&&y!=W.clientId||I&&I!=W.connectionId||F.push(W))}return F},f.prototype.put=function(p){(p.action==="enter"||p.action==="update")&&(p=c.default.fromValues(p),p.action="present");var S=this.map,y=this.memberKey(p);this.residualMembers&&delete this.residualMembers[y];var I=S[y];return I&&!O(p,I)?!1:(S[y]=p,!0)},f.prototype.values=function(){var p=this.map,S=[];for(var y in p){var I=p[y];I.action!="absent"&&S.push(I)}return S},f.prototype.remove=function(p){var S=this.map,y=this.memberKey(p),I=S[y];return I&&!O(p,I)?!1:(this.syncInProgress?(p=c.default.fromValues(p),p.action="absent",S[y]=p):delete S[y],!0)},f.prototype.startSync=function(){var p=this.map,S=this.syncInProgress;u.default.logAction(u.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),this.syncInProgress||(this.residualMembers=r.copy(p),this.setInProgress(!0))},f.prototype.endSync=function(){var p=this.map,S=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),S){for(var y in p){var I=p[y];I.action==="absent"&&delete p[y]}this.presence._synthesizeLeaves(r.valuesArray(this.residualMembers));for(var y in this.residualMembers)delete p[y];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},f.prototype.waitSync=function(p){var S=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),!S){p();return}this.once("sync",p)},f.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},f.prototype.setInProgress=function(p){u.default.logAction(u.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+p),this.syncInProgress=p,this.presence.syncComplete=!p},f}(l.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=t(56),a=t(31),l=t(11),u=i.__importDefault(t(5)),c=i.__importDefault(t(3)),m=function(){function v(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return v.prototype.isWordArray=function(E){return E!=null&&E.sigBytes!==void 0},v.prototype.isArrayBuffer=function(E){return E!=null&&E.constructor===ArrayBuffer},v.prototype.isTypedArray=function(E){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(E)},v.prototype.uint8ViewToBase64=function(E){for(var h="",b=this.base64CharSet,w=E.byteLength,P=w%3,C=w-P,O,x,g,A,f,p=0;p<C;p=p+3)f=E[p]<<16|E[p+1]<<8|E[p+2],O=(f&16515072)>>18,x=(f&258048)>>12,g=(f&4032)>>6,A=f&63,h+=b[O]+b[x]+b[g]+b[A];return P==1?(f=E[C],O=(f&252)>>2,x=(f&3)<<4,h+=b[O]+b[x]+"=="):P==2&&(f=E[C]<<8|E[C+1],O=(f&64512)>>10,x=(f&1008)>>4,g=(f&15)<<2,h+=b[O]+b[x]+b[g]+"="),h},v.prototype.base64ToArrayBuffer=function(E){for(var h=atob==null?void 0:atob(E),b=h.length,w=new Uint8Array(b),P=0;P<b;P++){var C=h.charCodeAt(P);w[P]=C}return w.buffer},v.prototype.isBuffer=function(E){return this.isArrayBuffer(E)||this.isWordArray(E)||this.isTypedArray(E)},v.prototype.toBuffer=function(E){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(E))return new Uint8Array(E);if(this.isTypedArray(E))return new Uint8Array(E.buffer);if(this.isWordArray(E)){for(var h=new ArrayBuffer(E.sigBytes),b=new Uint8Array(h),w=0;w<E.sigBytes;w++)b[w]=E.words[w>>>2]>>>24-w%4*8&255;return b}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},v.prototype.toArrayBuffer=function(E){return this.isArrayBuffer(E)?E:this.toBuffer(E).buffer},v.prototype.toWordArray=function(E){return this.isTypedArray(E)&&(E=E.buffer),this.isWordArray(E)?E:u.default.create(E)},v.prototype.base64Encode=function(E){return this.isWordArray(E)?(0,l.stringify)(E):this.uint8ViewToBase64(this.toBuffer(E))},v.prototype.base64Decode=function(E){return ArrayBuffer&&c.default.Config.atob?this.base64ToArrayBuffer(E):(0,l.parse)(E)},v.prototype.hexEncode=function(E){return(0,r.stringify)(this.toWordArray(E))},v.prototype.hexDecode=function(E){var h=(0,r.parse)(E);return ArrayBuffer?this.toArrayBuffer(h):h},v.prototype.utf8Encode=function(E){return c.default.Config.TextEncoder?new c.default.Config.TextEncoder().encode(E).buffer:(0,a.parse)(E)},v.prototype.utf8Decode=function(E){if(!this.isBuffer(E))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(E)?new TextDecoder().decode(E):(E=this.toWordArray(E),(0,a.stringify)(E))},v.prototype.bufferCompare=function(E,h){if(!E)return-1;if(!h)return 1;var b=this.toWordArray(E),w=this.toWordArray(h);b.clamp(),w.clamp();var P=b.sigBytes-w.sigBytes;if(P!=0)return P;for(var C=b.words,O=w.words,x=0;x<C.length;x++)if(P=C[x]-O[x],P!=0)return P;return 0},v.prototype.byteLength=function(E){return this.isArrayBuffer(E)||this.isTypedArray(E)?E.byteLength:this.isWordArray(E)?E.sigBytes:-1},v.prototype.typedArrayToBuffer=function(E){return E.buffer},v}();e.default=new m},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return i.enc.Hex})},function(s,e,t){"use strict";t.r(e);var i=t(5),r=t.n(i),a=t(11),l=t.n(a),u=t(22),c=t.n(u),m=t(2),v=t.n(m),E=t(4),h=t.n(E),b=function(w,P){var C="aes",O=256,x="cbc",g=16,A=4,f=4294967296,p=2147483648,S;if(w.getRandomWordArray)S=w.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&w.getRandomValues){var y=new Uint32Array(A);S=function($,G){var J=$/4,tt=J==A?y:new Uint32Array(J);w.getRandomValues(tt,function(it){typeof G!="undefined"&&G(it,P.toWordArray(tt))})}}else S=function($,G){v.a.logAction(v.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var J=$/4,tt=new Array(J),it=0;it<J;it++)tt[it]=Math.floor(Math.random()*f)-p;G(null,r.a.create(tt))};function I($){return $+g&-g}function F($){if($.algorithm==="aes"&&$.mode==="cbc"){if($.keyLength===128||$.keyLength===256)return;throw new Error("Unsupported key length "+$.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function z($){return $.replace("_","/").replace("-","+")}var W=[r.a.create([269488144,269488144,269488144,269488144],16),r.a.create([16777216],1),r.a.create([33685504],2),r.a.create([50529024],3),r.a.create([67372036],4),r.a.create([84215045,83886080],5),r.a.create([101058054,101056512],6),r.a.create([117901063,117901056],7),r.a.create([134744072,134744072],8),r.a.create([151587081,151587081,150994944],9),r.a.create([168430090,168430090,168427520],10),r.a.create([185273099,185273099,185273088],11),r.a.create([202116108,202116108,202116108],12),r.a.create([218959117,218959117,218959117,218103808],13),r.a.create([235802126,235802126,235802126,235798528],14),r.a.create([252645135,252645135,252645135,252645135],15),r.a.create([269488144,269488144,269488144,269488144],16)];function N(){}function R(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}N.CipherParams=R,N.getDefaultParams=function($){var G;if(typeof $=="function"||typeof $=="string"){if(v.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof $=="function")N.generateRandomKey(function(tt){$(null,N.getDefaultParams({key:tt}))});else if(typeof arguments[1]=="function")arguments[1](null,N.getDefaultParams({key:$}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!$.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof $.key=="string"?G=Object(a.parse)(z($.key)):G=P.toWordArray($.key);var J=new R;if(J.key=G,J.algorithm=$.algorithm||C,J.keyLength=G.words.length*(4*8),J.mode=$.mode||x,$.keyLength&&$.keyLength!==J.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+$.keyLength+" was specified, but the key actually has length "+J.keyLength);return F(J),J},N.generateRandomKey=function($,G){arguments.length==1&&typeof $=="function"&&(G=$,$=void 0),S(($||O)/8,function(J,tt){G!==void 0&&G(J?h.a.fromValues(J):null,tt)})},N.getCipher=function($){var G=$ instanceof R?$:N.getDefaultParams($);return{cipherParams:G,cipher:new L(G,A,$.iv)}};function L($,G,J){this.algorithm=$.algorithm+"-"+String($.keyLength)+"-"+$.mode,this.cjsAlgorithm=$.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=P.toWordArray($.key),J&&(this.iv=P.toWordArray(J).clone()),this.blockLengthWords=G}return L.prototype.encrypt=function($,G){v.a.logAction(v.a.LOG_MICRO,"CBCCipher.encrypt()",""),$=P.toWordArray($);var J=$.sigBytes,tt=I(J),it=this,X=function(){it.getIv(function(_,B){if(_){G(_);return}var H=it.encryptCipher.process($.concat(W[tt-J])),j=B.concat(H);G(null,j)})};this.encryptCipher?X():this.iv?(this.encryptCipher=c.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):S(g,function(_,B){if(_){G(_);return}it.encryptCipher=c.a.algo[it.cjsAlgorithm].createEncryptor(it.key,{iv:B}),it.iv=B,X()})},L.prototype.decrypt=function($){v.a.logAction(v.a.LOG_MICRO,"CBCCipher.decrypt()",""),$=P.toWordArray($);var G=this.blockLengthWords,J=$.words,tt=r.a.create(J.slice(0,G)),it=r.a.create(J.slice(G)),X=c.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:tt}),_=X.process(it),B=X.finalize();return X.reset(),B&&B.sigBytes&&_.concat(B),_},L.prototype.getIv=function($){if(this.iv){var G=this.iv;this.iv=null,$(null,G);return}var J=this;S(g,function(tt,it){if(tt){$(tt);return}$(null,J.encryptCipher.process(it))})},N};e.default=b},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(){var r=i,a=r.lib,l=a.WordArray,u=r.enc,c=u.Utf16=u.Utf16BE={stringify:function(v){for(var E=v.words,h=v.sigBytes,b=[],w=0;w<h;w+=2){var P=E[w>>>2]>>>16-w%4*8&65535;b.push(String.fromCharCode(P))}return b.join("")},parse:function(v){for(var E=v.length,h=[],b=0;b<E;b++)h[b>>>1]|=v.charCodeAt(b)<<16-b%2*16;return l.create(h,E*2)}};u.Utf16LE={stringify:function(v){for(var E=v.words,h=v.sigBytes,b=[],w=0;w<h;w+=2){var P=m(E[w>>>2]>>>16-w%4*8&65535);b.push(String.fromCharCode(P))}return b.join("")},parse:function(v){for(var E=v.length,h=[],b=0;b<E;b++)h[b>>>1]|=m(v.charCodeAt(b)<<16-b%2*16);return l.create(h,E*2)}};function m(v){return v<<8&4278255360|v>>>8&16711935}}(),i.enc.Utf16})},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(28))})(this,function(i){return function(r){var a=i,l=a.lib,u=l.CipherParams,c=a.enc,m=c.Hex,v=a.format,E=v.Hex={stringify:function(h){return h.ciphertext.toString(m)},parse:function(h){var b=m.parse(h);return u.create({ciphertext:b})}}}(),i.format.Hex})},function(s,e,t){(function(i,r){s.exports=e=r(t(6),t(11),t(61),t(27),t(28))})(this,function(i){return function(){var r=i,a=r.lib,l=a.BlockCipher,u=r.algo,c=[],m=[],v=[],E=[],h=[],b=[],w=[],P=[],C=[],O=[];(function(){for(var A=[],f=0;f<256;f++)f<128?A[f]=f<<1:A[f]=f<<1^283;for(var p=0,S=0,f=0;f<256;f++){var y=S^S<<1^S<<2^S<<3^S<<4;y=y>>>8^y&255^99,c[p]=y,m[y]=p;var I=A[p],F=A[I],z=A[F],W=A[y]*257^y*16843008;v[p]=W<<24|W>>>8,E[p]=W<<16|W>>>16,h[p]=W<<8|W>>>24,b[p]=W;var W=z*16843009^F*65537^I*257^p*16843008;w[y]=W<<24|W>>>8,P[y]=W<<16|W>>>16,C[y]=W<<8|W>>>24,O[y]=W,p?(p=I^A[A[A[z^I]]],S^=A[A[S]]):p=S=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],g=u.AES=l.extend({_doReset:function(){var A;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var f=this._keyPriorReset=this._key,p=f.words,S=f.sigBytes/4,y=this._nRounds=S+6,I=(y+1)*4,F=this._keySchedule=[],z=0;z<I;z++)z<S?F[z]=p[z]:(A=F[z-1],z%S?S>6&&z%S==4&&(A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255]):(A=A<<8|A>>>24,A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255],A^=x[z/S|0]<<24),F[z]=F[z-S]^A);for(var W=this._invKeySchedule=[],N=0;N<I;N++){var z=I-N;if(N%4)var A=F[z];else var A=F[z-4];N<4||z<=4?W[N]=A:W[N]=w[c[A>>>24]]^P[c[A>>>16&255]]^C[c[A>>>8&255]]^O[c[A&255]]}}},encryptBlock:function(A,f){this._doCryptBlock(A,f,this._keySchedule,v,E,h,b,c)},decryptBlock:function(A,f){var p=A[f+1];A[f+1]=A[f+3],A[f+3]=p,this._doCryptBlock(A,f,this._invKeySchedule,w,P,C,O,m);var p=A[f+1];A[f+1]=A[f+3],A[f+3]=p},_doCryptBlock:function(A,f,p,S,y,I,F,z){for(var W=this._nRounds,N=A[f]^p[0],R=A[f+1]^p[1],L=A[f+2]^p[2],$=A[f+3]^p[3],G=4,J=1;J<W;J++){var tt=S[N>>>24]^y[R>>>16&255]^I[L>>>8&255]^F[$&255]^p[G++],it=S[R>>>24]^y[L>>>16&255]^I[$>>>8&255]^F[N&255]^p[G++],X=S[L>>>24]^y[$>>>16&255]^I[N>>>8&255]^F[R&255]^p[G++],_=S[$>>>24]^y[N>>>16&255]^I[R>>>8&255]^F[L&255]^p[G++];N=tt,R=it,L=X,$=_}var tt=(z[N>>>24]<<24|z[R>>>16&255]<<16|z[L>>>8&255]<<8|z[$&255])^p[G++],it=(z[R>>>24]<<24|z[L>>>16&255]<<16|z[$>>>8&255]<<8|z[N&255])^p[G++],X=(z[L>>>24]<<24|z[$>>>16&255]<<16|z[N>>>8&255]<<8|z[R&255])^p[G++],_=(z[$>>>24]<<24|z[N>>>16&255]<<16|z[R>>>8&255]<<8|z[L&255])^p[G++];A[f]=tt,A[f+1]=it,A[f+2]=X,A[f+3]=_},keySize:256/32});r.AES=l._createHelper(g)}(),i.AES})},function(s,e,t){(function(i,r){s.exports=e=r(t(6))})(this,function(i){return function(r){var a=i,l=a.lib,u=l.WordArray,c=l.Hasher,m=a.algo,v=[];(function(){for(var C=0;C<64;C++)v[C]=r.abs(r.sin(C+1))*4294967296|0})();var E=m.MD5=c.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,O){for(var x=0;x<16;x++){var g=O+x,A=C[g];C[g]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}var f=this._hash.words,p=C[O+0],S=C[O+1],y=C[O+2],I=C[O+3],F=C[O+4],z=C[O+5],W=C[O+6],N=C[O+7],R=C[O+8],L=C[O+9],$=C[O+10],G=C[O+11],J=C[O+12],tt=C[O+13],it=C[O+14],X=C[O+15],_=f[0],B=f[1],H=f[2],j=f[3];_=h(_,B,H,j,p,7,v[0]),j=h(j,_,B,H,S,12,v[1]),H=h(H,j,_,B,y,17,v[2]),B=h(B,H,j,_,I,22,v[3]),_=h(_,B,H,j,F,7,v[4]),j=h(j,_,B,H,z,12,v[5]),H=h(H,j,_,B,W,17,v[6]),B=h(B,H,j,_,N,22,v[7]),_=h(_,B,H,j,R,7,v[8]),j=h(j,_,B,H,L,12,v[9]),H=h(H,j,_,B,$,17,v[10]),B=h(B,H,j,_,G,22,v[11]),_=h(_,B,H,j,J,7,v[12]),j=h(j,_,B,H,tt,12,v[13]),H=h(H,j,_,B,it,17,v[14]),B=h(B,H,j,_,X,22,v[15]),_=b(_,B,H,j,S,5,v[16]),j=b(j,_,B,H,W,9,v[17]),H=b(H,j,_,B,G,14,v[18]),B=b(B,H,j,_,p,20,v[19]),_=b(_,B,H,j,z,5,v[20]),j=b(j,_,B,H,$,9,v[21]),H=b(H,j,_,B,X,14,v[22]),B=b(B,H,j,_,F,20,v[23]),_=b(_,B,H,j,L,5,v[24]),j=b(j,_,B,H,it,9,v[25]),H=b(H,j,_,B,I,14,v[26]),B=b(B,H,j,_,R,20,v[27]),_=b(_,B,H,j,tt,5,v[28]),j=b(j,_,B,H,y,9,v[29]),H=b(H,j,_,B,N,14,v[30]),B=b(B,H,j,_,J,20,v[31]),_=w(_,B,H,j,z,4,v[32]),j=w(j,_,B,H,R,11,v[33]),H=w(H,j,_,B,G,16,v[34]),B=w(B,H,j,_,it,23,v[35]),_=w(_,B,H,j,S,4,v[36]),j=w(j,_,B,H,F,11,v[37]),H=w(H,j,_,B,N,16,v[38]),B=w(B,H,j,_,$,23,v[39]),_=w(_,B,H,j,tt,4,v[40]),j=w(j,_,B,H,p,11,v[41]),H=w(H,j,_,B,I,16,v[42]),B=w(B,H,j,_,W,23,v[43]),_=w(_,B,H,j,L,4,v[44]),j=w(j,_,B,H,J,11,v[45]),H=w(H,j,_,B,X,16,v[46]),B=w(B,H,j,_,y,23,v[47]),_=P(_,B,H,j,p,6,v[48]),j=P(j,_,B,H,N,10,v[49]),H=P(H,j,_,B,it,15,v[50]),B=P(B,H,j,_,z,21,v[51]),_=P(_,B,H,j,J,6,v[52]),j=P(j,_,B,H,I,10,v[53]),H=P(H,j,_,B,$,15,v[54]),B=P(B,H,j,_,S,21,v[55]),_=P(_,B,H,j,R,6,v[56]),j=P(j,_,B,H,X,10,v[57]),H=P(H,j,_,B,W,15,v[58]),B=P(B,H,j,_,tt,21,v[59]),_=P(_,B,H,j,F,6,v[60]),j=P(j,_,B,H,G,10,v[61]),H=P(H,j,_,B,y,15,v[62]),B=P(B,H,j,_,L,21,v[63]),f[0]=f[0]+_|0,f[1]=f[1]+B|0,f[2]=f[2]+H|0,f[3]=f[3]+j|0},_doFinalize:function(){var C=this._data,O=C.words,x=this._nDataBytes*8,g=C.sigBytes*8;O[g>>>5]|=128<<24-g%32;var A=r.floor(x/4294967296),f=x;O[(g+64>>>9<<4)+15]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,O[(g+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,C.sigBytes=(O.length+1)*4,this._process();for(var p=this._hash,S=p.words,y=0;y<4;y++){var I=S[y];S[y]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}return p},clone:function(){var C=c.clone.call(this);return C._hash=this._hash.clone(),C}});function h(C,O,x,g,A,f,p){var S=C+(O&x|~O&g)+A+p;return(S<<f|S>>>32-f)+O}function b(C,O,x,g,A,f,p){var S=C+(O&g|x&~g)+A+p;return(S<<f|S>>>32-f)+O}function w(C,O,x,g,A,f,p){var S=C+(O^x^g)+A+p;return(S<<f|S>>>32-f)+O}function P(C,O,x,g,A,f,p){var S=C+(x^(O|~g))+A+p;return(S<<f|S>>>32-f)+O}a.MD5=c._createHelper(E),a.HmacMD5=c._createHmacHelper(E)}(Math),i.MD5})},function(s,e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importDefault(t(3)),l=r.__importStar(t(1)),u=r.__importDefault(t(8)),c=t(4),m=r.__importDefault(t(18)),v=r.__importDefault(t(16)),E=r.__importDefault(t(21)),h=r.__importDefault(t(2)),b=t(29),w=r.__importDefault(t(63)),P=t(25);function C(g){var A=g.statusCode;return A===408&&!g.code||A===400&&!g.code||A>=500&&A<=504}function O(g){var A=g.connection,f=A&&A.connectionManager.host;return f?[f].concat(u.default.getFallbackHosts(g.options)):u.default.getHosts(g.options)}var x=(i=function(){function g(A){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=O,this.options=A||{};var f=this.options.connectivityCheckUrl||u.default.connectivityCheckUrl,p=this.options.connectivityCheckParams,S=!this.options.connectivityCheckUrl;a.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(y,I,F,z,W,N,R){var L=v.default.createRequest(F,z,W,N,E.default.REQ_SEND,I&&I.options.timeouts,y);return L.once("complete",R),L.exec(),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(y){y(null,!0)}:this.checkConnectivity=function(y){h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,p,function(I,F,z,W,N){var R=!1;S?R=!I&&(F==null?void 0:F.replace(/\n/,""))=="yes":R=!I&&(0,P.isSuccessCode)(N),h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+R),y(null,R)})}):a.default.Config.jsonpSupported?(this.Request=function(y,I,F,z,W,N,R){var L=(0,b.createRequest)(F,z,W,N,E.default.REQ_SEND,I&&I.options.timeouts,y);return L.once("complete",R),a.default.Config.nextTick(function(){L.exec()}),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(y){y(null,!0)}:this.checkConnectivity=function(y){var I=this,F=u.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(y);return}this.checksInProgress=[y],h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+F);var z=new b.Request("isTheInternetUp",F,null,null,null,E.default.REQ_SEND,u.default.TIMEOUTS);z.once("complete",function(W,N){var R=!W&&N;h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+R);for(var L=0;L<I.checksInProgress.length;L++)I.checksInProgress[L](null,R);I.checksInProgress=null}),a.default.Config.nextTick(function(){z.exec()})}):a.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=w.default,this.checkConnectivity=function(y){h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,null,function(I,F){var z=!I&&(F==null?void 0:F.replace(/\n/,""))=="yes";h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+z),y(null,z)})}):this.Request=function(y,I,F,z,W,N,R){R(new c.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return g.prototype.do=function(A,f,p,S,y,I,F){var z=this,W=typeof p=="function"?p:function($){return f.baseUri($)+p},N=f._currentFallback;if(N)if(N.validUntil>l.now()){if(!this.Request){F==null||F(new c.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(A,f,W(N.host),S,I,y,function($){for(var G=[],J=1;J<arguments.length;J++)G[J-1]=arguments[J];if($&&C($)){f._currentFallback=null,z.do(A,f,p,S,y,I,F);return}F==null||F.apply(void 0,r.__spreadArray([$],G,!1))});return}else f._currentFallback=null;var R=O(f);if(R.length===1){this.doUri(A,f,W(R[0]),S,y,I,F);return}var L=function($,G){var J=$.shift();z.doUri(A,f,W(J),S,y,I,function(tt){for(var it=[],X=1;X<arguments.length;X++)it[X-1]=arguments[X];if(tt&&C(tt)&&$.length){L($,!0);return}G&&(f._currentFallback={host:J,validUntil:l.now()+f.options.timeouts.fallbackRetryTimeout}),F==null||F.apply(void 0,r.__spreadArray([tt],it,!1))})};L(R)},g.prototype.doUri=function(A,f,p,S,y,I,F){if(!this.Request){F(new c.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(A,f,p,S,I,y,F)},g}(),i.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],i.methodsWithoutBody=[m.default.Get,m.default.Delete],i.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],i);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(4)),a=i.__importDefault(t(3)),l=i.__importDefault(t(8)),u=i.__importStar(t(1)),c=t(1);function m(h,b){return!!b.get("x-ably-errorcode")}function v(h,b){if(m(h,b))return h.error&&r.default.fromValues(h.error)}function E(h,b,w,P,C,O,x){var g=new Headers(P||{}),A=h?h.toUpperCase():u.isEmptyArg(O)?"GET":"POST",f=new AbortController,p=setTimeout(function(){f.abort(),x(new r.PartialErrorInfo("Request timed out",null,408))},b?b.options.timeouts.httpRequestTimeout:l.default.TIMEOUTS.httpRequestTimeout),S={method:A,headers:g,body:O};a.default.Config.isWebworker||(S.credentials=g.has("authorization")?"include":"same-origin"),(0,c.getGlobalObject)().fetch(w+"?"+new URLSearchParams(C||{}),S).then(function(y){clearTimeout(p);var I=y.headers.get("Content-Type"),F;I&&I.indexOf("application/x-msgpack")>-1?F=y.arrayBuffer():I&&I.indexOf("application/json")>-1?F=y.json():F=y.text(),F.then(function(z){var W=!!I&&I.indexOf("application/x-msgpack")===-1;if(y.ok)x(null,z,y.headers,W,y.status);else{var N=v(z,y.headers)||new r.PartialErrorInfo("Error response received from server: "+y.status+" body was: "+a.default.Config.inspect(z),null,y.status);x(N,z,y.headers,W,y.status)}})}).catch(function(y){clearTimeout(p),x(y)})}e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(41)),a=i.__importStar(t(1)),l=a.getGlobalObject();function u(){var E=l.location;return!l.WebSocket||!E||!E.origin||E.origin.indexOf("http")>-1}var c=l.navigator&&l.navigator.userAgent.toString(),m=l.location&&l.location.href,v={agent:"browser",logTimestamps:!0,userAgent:c,currentUrl:m,noUpgrade:c&&!!c.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:l.WebSocket,fetchSupported:!!l.fetch,xhrSupported:l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:u(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:r.default,supportsBinary:!!l.TextDecoder,preferBinary:!1,ArrayBuffer:l.ArrayBuffer,atob:l.atob,nextTick:typeof l.setImmediate!="undefined"?l.setImmediate.bind(l):function(E){setTimeout(E,0)},addEventListener:l.addEventListener,inspect:JSON.stringify,stringByteSize:function(E){return l.TextDecoder&&new l.TextEncoder().encode(E).length||E.length},TextEncoder:l.TextEncoder,TextDecoder:l.TextDecoder,Promise:l.Promise,getRandomValues:function(E){if(E!==void 0)return function(h,b){E.getRandomValues(h),b&&b(null)}}(l.crypto||msCrypto)};e.default=v},function(s,e,t){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importStar(t(1)),l="ablyjs-storage-test",u=function(){function c(){try{i.sessionStorage.setItem(l,l),i.sessionStorage.removeItem(l),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{i.localStorage.setItem(l,l),i.localStorage.removeItem(l),this.localSupported=!0}catch(m){this.localSupported=!1}}return c.prototype.get=function(m){return this._get(m,!1)},c.prototype.getSession=function(m){return this._get(m,!0)},c.prototype.remove=function(m){return this._remove(m,!1)},c.prototype.removeSession=function(m){return this._remove(m,!0)},c.prototype.set=function(m,v,E){return this._set(m,v,E,!1)},c.prototype.setSession=function(m,v,E){return this._set(m,v,E,!0)},c.prototype._set=function(m,v,E,h){var b={value:v};return E&&(b.expires=a.now()+E),this.storageInterface(h).setItem(m,JSON.stringify(b))},c.prototype._get=function(m,v){if(v&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!v&&!this.localSupported)throw new Error("Local Storage not supported");var E=this.storageInterface(v).getItem(m);if(!E)return null;var h=JSON.parse(E);return h.expires&&h.expires<a.now()?(this.storageInterface(v).removeItem(m),null):h.value},c.prototype._remove=function(m,v){return this.storageInterface(v).removeItem(m)},c.prototype.storageInterface=function(m){return m?i.sessionStorage:i.localStorage},c}();e.default=new u}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(67)),a={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],baseTransportOrder:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],transportPreferenceOrder:[r.default.JsonP,r.default.XhrPolling,r.default.XhrStreaming,r.default.WebSocket],upgradeTransports:[r.default.XhrStreaming,r.default.WebSocket]};e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r.WebSocket="web_socket",r.Comet="comet",r.XhrStreaming="xhr_streaming",r.XhrPolling="xhr_polling",r.JsonP="jsonp"})(i||(i={})),e.default=i},function(s,e,t){"use strict";t.r(e);var i=t(29),r=t.n(i),a=t(1),l=t(3),u=t.n(l),c=t(12),m=t.n(c),v=t(16),E=t.n(v),h=function(O){var x="xhr_polling";function g(A,f,p){p.stream=!1,m.a.call(this,A,f,p),this.shortName=x}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(A,f,p,S,y){return E.a.createRequest(A,f,p,S,y,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[x]=g),g},b=h,w=function(O){var x="xhr_streaming";function g(A,f,p){m.a.call(this,A,f,p),this.shortName=x}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.streamingSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(A,f,p,S,y){return E.a.createRequest(A,f,p,S,y,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[x]=g),g},P=w,C=e.default=[r.a,b,P]}]).default})});D();D();var mo=(A=>(A.MEETING_START="meeting.start",A.MEETING_LEAVE="meeting.leave",A.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",A.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",A.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",A.MEETING_PARTICIPANT_LEFT="meeting.participant-left",A.MEETING_JOIN="meeting.join",A.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",A.MEETING_HOST_CHANGE="meeting.host-change",A.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",A.MEETING_DEVICES_CHANGE="meeting.devices-change",A.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",A.MEETING_STATE_UPDATE="meeting.state-update",A.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",A.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",A.MY_PARTICIPANT_UPDATED="my-participant.update",A.MY_PARTICIPANT_LEFT="my-participant.left",A.MY_PARTICIPANT_JOINED="my-participant.joined",A.MEETING_KICK_PARTICIPANT="meeting.kick-participant",A.DESTROY="destroy",A))(mo||{}),go=(l=>(l.FRAME_LOAD="frame.load",l.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",l.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",l.FRAME_LOCALE_UPDATE="frame.locales-update",l.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",l.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",l))(go||{}),ua=(u=>(u.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",u.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",u.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",u.TOGGLE_CAM="meeting-controls.toggle-cam",u.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",u.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",u.HANG_UP="hang-up",u))(ua||{}),Cn=(P=>(P.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",P.REALTIME_HOST_CHANGE="realtime.host-change",P.REALTIME_HOST_AVAILABLE="realtime.host-available",P.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",P.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",P.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",P.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",P.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",P.REALTIME_GATHER="realtime.gather",P.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",P.REALTIME_LOCAL_FOLLOW_PARTICIPANT="realtime.local-follow-participant",P.REALTIME_SET_AVATAR="realtime.set-avatar",P.REALTIME_DRAWING_CHANGE="realtime.drawing-change",P.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",P.REALTIME_PRIVATE_MODE="realtime.private-mode",P))(Cn||{});var ca=(v=>(v[v.MEETING_FAILED=-1]="MEETING_FAILED",v[v.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",v[v.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",v[v.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",v[v.MEETING_CONNECTING=3]="MEETING_CONNECTING",v[v.MEETING_CONNECTED=4]="MEETING_CONNECTED",v[v.MEETING_RECONNECT=5]="MEETING_RECONNECT",v[v.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",v[v.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",v[v.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",v))(ca||{}),da=(l=>(l.JOINED="participant.joined",l.LOCAL_JOINED="participant.local-joined",l.LEFT="participant.left",l.LOCAL_LEFT="participant.local-left",l.LOCAL_UPDATED="participant.updated",l.LIST_UPDATED="participant.list-updated",l))(da||{}),vo=(u=>(u[u.NOT_AVAILABLE=0]="NOT_AVAILABLE",u[u.GOOD=1]="GOOD",u[u.BAD=2]="BAD",u[u.POOR=3]="POOR",u[u.DISCONNECTED=4]="DISCONNECTED",u[u.RECONNECTING=5]="RECONNECTING",u[u.LOST_CONNECTION=6]="LOST_CONNECTION",u))(vo||{}),Mu=(u=>(u.NO_CAM="devices.no-cam",u.NO_DEVICES="devices.no-devices",u.DEVICES_BLOCKED="devices.blocked",u.DEVICES_CAM_BLOCKED="devices.cam-blocked",u.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",u.DEVICES_UNKNOWN_ERROR="devices.unknown-error",u.DEVICES_ALLOWED="devices.allowed",u))(Mu||{});D();var Ar=(i=>(i.HOST="host",i.GUEST="guest",i.AUDIENCE="audience",i))(Ar||{});D();D();D();D();var Re=(r,a,l,...u)=>Lt(void 0,[r,a,l,...u],function*(s,e,t,i={}){let c=yield fetch(s,{method:e,headers:lt({"Content-Type":"application/json"},i),body:t?JSON.stringify(t):null});if(!c.ok)throw c;try{return yield c.json()}catch(m){return c.ok}});D();var rp=pn(Ru()),qt=class{constructor(e){this.debug=(0,rp.default)(e)}log(e,...t){this.debug(e,...t)}};D();D();var Bp=pn(Nu());var At=class{constructor(e={}){this.subscribe=e=>{this.callbacks.push(e)};this.unsubscribe=e=>{this.callbacks=this.callbacks.filter(t=>t!==e)};this.publish=(...e)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,e).catch(i=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(e)}
            Error: ${i}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(e,t)=>new Promise((i,r)=>{try{let a=e(...t);i(a)}catch(a){r(a)}});let{logger:t,throttleTime:i}=e;this.logger=t!=null?t:new qt("@superviz/sdk/observer-helper"),this.throttle=i,this.callbacks=[],this.throttle&&(this.publish=(0,Bp.default)(this.publish,this.throttle))}};var Oi=class{constructor(){this.observers={};this.subscribe=(e,t)=>{this.logger.log(`subscribed to ${e} event`),this.observers[e]||(this.observers[e]=new At({logger:this.logger})),this.observers[e].subscribe(t)};this.unsubscribe=(e,t)=>{if(this.logger.log(`unsubscribed from ${e} event`),!!this.observers[e]){if(!t){this.observers[e].destroy(),delete this.observers[e];return}this.observers[e].unsubscribe(t)}};this.publish=(e,t)=>{e in this.observers&&this.observers[e].publish(t)}}};D();D();D();var kp=pn(wr()),Fu=class{setConfig(e){this.configuration=e}get(e,t){return this.configuration?kp.default.get(this.configuration,e,t):t}},Tt=new Fu;var me=class{static createUrl(e,t,i={}){let r=new URL(t,e);return Object.keys(i).forEach(a=>r.searchParams.append(a,i[a])),r.toString()}static validateApiKey(e,t){let i="/user/checkapikey",r=this.createUrl(e,i);return Re(r,"POST",{apiKey:t})}static fetchConfig(e,t){let i="/immersive-config",r=this.createUrl(e,i);return Re(r,"POST",{apiKey:t})}static fetchLimits(e,t){return Lt(this,null,function*(){let i="/user/check_limits",r=this.createUrl(e,i);return(yield Re(r,"GET","",{apikey:t})).usage})}static fetchWaterMark(e,t){return Lt(this,null,function*(){let i="/user/watermark",r=this.createUrl(e,i),{message:a}=yield Re(r,"POST",{apiKey:t});return a})}static createAnnotations(e,t,i){return Lt(this,null,function*(){let r="/annotations",a=this.createUrl(e,r);return Re(a,"POST",lt({},i),{apikey:t})})}static updateComment(e,t,i,r){return Lt(this,null,function*(){let a=`/comments/${i}`,l=this.createUrl(e,a);return Re(l,"PUT",{text:r},{apikey:t})})}static createComment(e,t,i){return Lt(this,null,function*(){let r="/comments",a=this.createUrl(e,r);return Re(a,"POST",lt({},i),{apikey:t})})}static fetchAnnotation(e,t,i){return Lt(this,null,function*(){let r="/annotations",a=this.createUrl(e,r,{roomId:i.roomId,url:i.url});return Re(a,"GET",void 0,{apikey:t})})}static resolveAnnotation(e,t,i){return Lt(this,null,function*(){let r=`/annotations/resolve/${i}`,a=this.createUrl(e,r);return Re(a,"POST",{},{apikey:t})})}static deleteComment(e,t,i){return Lt(this,null,function*(){let r=`/comments/${i}`,a=this.createUrl(e,r);return Re(a,"DELETE",{},{apikey:t})})}static deleteAnnotation(e,t,i){return Lt(this,null,function*(){let r=`/annotations/${i}`,a=this.createUrl(e,r);return Re(a,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(e){return Lt(this,null,function*(){let t=Tt.get("apiUrl"),i="/participants",r=this.createUrl(t,i);return Re(r,"POST",lt({},e),{apikey:Tt.get("apiKey")})})}static sendActivity(e,t,i,r){return Lt(this,null,function*(){let a="/activity",l=Tt.get("apiUrl"),u=Tt.get("roomId"),c=Tt.get("apiKey"),m=this.createUrl(l,a);return Re(m,"POST",{groupId:t,groupName:i,meetingId:u,product:r,userId:e},{apikey:c})})}static validadeParticipantIsEnteringTwice(e,t,i,r){return Lt(this,null,function*(){let a=window.btoa(r),u=`https://rest.ably.io/channels/${`superviz:${t.toLowerCase()}-${i}`}/presence`;try{return(yield(yield fetch(u,{headers:{Authorization:`Basic ${a}`}})).json()).some(E=>JSON.parse(E.data).id===e.id)}catch(c){throw new Error("Failed to fetch realtime participants")}})}};D();var on=class extends Oi{constructor(){super(...arguments);this.isAttached=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let c=`${this.name} @ attach - params are required`;throw this.logger.log(c),new Error(c)}let{realtime:i,localParticipant:r,group:a,config:l,eventBus:u}=t;if(!i.isDomainWhitelisted){let c=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(c);return}if(Tt.setConfig(l),this.realtime=i,this.localParticipant=r,this.group=a,this.eventBus=u,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),Object.values(this.observers).forEach(t=>{t.reset(),t.destroy()}),this.observers=void 0,this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1}}};D();var Uu=(a=>(a.presence3dMatterport="presence",a.presence3dAutodesk="presence",a.presence3dThreejs="presence",a.realtime="presence",a.whoIsOnline="presence",a))(Uu||{});D();var Bu=(t=>(t.LEFT="left",t.RIGHT="right",t))(Bu||{}),ku=(r=>(r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r))(ku||{});var Eo=class extends on{constructor(t,i){super();this.sidebarOpen=!1;this.onPinFixed=t=>{this.coordinates=t};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),this.pinAdapter.setActive(this.sidebarOpen),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var c,m;this.button=document.createElement("superviz-comments-button");let t=(c=this.layoutOptions)==null?void 0:c.buttonLocation,i=(m=this.layoutOptions)==null?void 0:m.position;if(!t){document.body.appendChild(this.button),this.button.commentsPosition=i;return}let r="",a=Object.values(ku),l=!1,u=!a.includes(t.toLocaleLowerCase());if(u){let v=window.document.body.querySelector(`#${t}`);v?(v.appendChild(this.button),r="position: relative"):(l=!0,t="top-left")}if(!u||l){document.body.appendChild(this.button);let[v,E]=t.split("-");r=`${v}: 20px; ${E}: 20px;`}this.button.positionStyles=r,this.button.commentsPosition=i};this.positionComments=()=>{var l;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left: 0;",document.body.appendChild(this.element);let t=(l=this.layoutOptions)==null?void 0:l.position;if(!t)return;let i=Object.values(Bu),r=t.toLocaleLowerCase();if(!i.includes(r))return;let a=t==="left"?"left: 0;":"right: 0;";this.element.side=a};this.createAnnotation=i=>Lt(this,[i],function*({detail:t}){try{let{text:r}=t,{url:a}=this,l=lt({},this.coordinates),u=yield me.createAnnotations(Tt.get("apiUrl"),Tt.get("apiKey"),{roomId:Tt.get("roomId"),position:JSON.stringify(l),url:a,userId:this.localParticipant.id}),c=yield this.createComment(u.uuid,r);this.addAnnotation(_t(lt({},u),{comments:[c]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:u.uuid,haltGoToPin:!0},composed:!0,bubbles:!0}))}catch(r){this.logger.log("error when creating annotation",r)}});this.deleteAnnotation=i=>Lt(this,[i],function*({detail:t}){try{let{uuid:r}=t;yield me.deleteAnnotation(Tt.get("apiUrl"),Tt.get("apiKey"),r);let a=this.annotations.filter(l=>l.uuid!==r);this.updateAnnotationList(a),this.pinAdapter.removeAnnotationPin(r),this.element.updateAnnotations(this.annotations)}catch(r){this.logger.log("error when deleting annotation",r)}});this.updateComment=i=>Lt(this,[i],function*({detail:t}){try{let{uuid:r,text:a}=t;yield me.updateComment(Tt.get("apiUrl"),Tt.get("apiKey"),r,a);let l=this.annotations.map(u=>Object.assign({},u,{comments:u.comments.map(c=>c.uuid===r?Object.assign({},c,{text:a}):c)}));this.updateAnnotationList(l)}catch(r){this.logger.log("error when updating comment",r)}});this.resolveAnnotation=i=>Lt(this,[i],function*({detail:t}){try{let{uuid:r}=t,{resolved:a}=yield me.resolveAnnotation(Tt.get("apiUrl"),Tt.get("apiKey"),r),l=this.annotations.map(u=>u.uuid===r?Object.assign({},u,{resolved:a}):u);if(this.updateAnnotationList(l),a){this.pinAdapter.removeAnnotationPin(r);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(r){this.logger.log("error when resolve annotation",r)}});this.deleteComment=i=>Lt(this,[i],function*({detail:t}){try{let{uuid:r,annotationId:a}=t;if(!r||!a)return;yield me.deleteComment(Tt.get("apiUrl"),Tt.get("apiKey"),r);let l=this.annotations.find(c=>c.uuid===a);l.comments=l.comments.filter(c=>c.uuid!==r);let u=this.annotations.map(c=>c.uuid===a?l:c);this.element.updateAnnotations(u),this.updateAnnotationList(u)}catch(r){this.logger.log("error when deleting comment",r)}});this.onAnnotationListUpdate=t=>{let{data:i,clientId:r}=t;this.localParticipant.id!==r&&(this.annotations=i,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new qt("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions=i!=null?i:{position:"left",buttonLocation:"top-left"},setTimeout(()=>{var r,a,l,u,c;t.setCommentsMetadata((a=(r=this.layoutOptions)==null?void 0:r.position)!=null?a:"left",(u=(l=this.localParticipant)==null?void 0:l.avatar)==null?void 0:u.imageUrl,(c=this.localParticipant)==null?void 0:c.name)}),this.pinAdapter=t}get url(){let t=new URL(this.clientUrl);return t.search="",t.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){this.logger.log("comments component @ destroy"),this.destroyListeners(),this.button.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){this.button.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("toggle",this.toggleAnnotationSidebar),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){this.button.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("create-annotation",this.createAnnotation),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}createComment(t,i,r=!1){return Lt(this,null,function*(){try{let a=yield me.createComment(Tt.get("apiUrl"),Tt.get("apiKey"),{annotationId:t,userId:this.localParticipant.id,text:i});return r&&this.addComment(t,a),a}catch(a){this.logger.log("error when creating comment",a)}})}addAnnotation(t){let i=[t,...this.annotations];this.element.updateAnnotations(i),this.pinAdapter.updateAnnotations(i),this.updateAnnotationList(i)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,i){let r=this.annotations.find(l=>l.uuid===t);r.comments.push(i);let a=this.annotations.map(l=>l.uuid===t?r:l);this.updateAnnotationList(a),this.element.updateAnnotations(a)}fetchAnnotations(){return Lt(this,null,function*(){try{let t=yield me.fetchAnnotation(Tt.get("apiUrl"),Tt.get("apiKey"),{roomId:Tt.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return Lt(this,null,function*(){try{let t=yield me.fetchWaterMark(Tt.get("apiUrl"),Tt.get("apiKey"));this.element.waterMarkStatus(t)}catch(t){this.logger.log("error when fetching waterMark",t)}})}};D();D();var To=(t=>(t.ADD="add",t.SHOW="show",t))(To||{});var Oo=class{constructor(e,t){this.isPinsVisible=!0;this.selectedPin=null;this.temporaryPinCoordinates=null;this.commentsSide="left";this.localParticipant={};this.setCommentsMetadata=(e,t,i)=>{this.commentsSide=e,this.localParticipant.avatar=t,this.localParticipant.name=i};this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),requestAnimationFrame(this.animate)};this.setMouseDownCoordinates=({x:e,y:t})=>{this.mouseDownCoordinates={x:e,y:t}};this.annotationSelected=({detail:{uuid:e,haltGoToPin:t}})=>{var a,l;if(!e)return;let i=JSON.parse((l=(a=this.selectedPin)==null?void 0:a.getAttribute("annotation"))!=null?l:"{}");if(this.resetPins(),(i==null?void 0:i.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let r=this.pins.get(e);!r||(r.setAttribute("active",""),this.selectedPin=r,!t&&this.goToPin(e))};this.onClick=e=>{if(!this.isActive)return;let t=this.canvas.getBoundingClientRect(),{x:i,y:r}=this.mouseDownCoordinates,a=i-t.x,l=r-t.y,u=e.clientX-t.left,c=e.clientY-t.top;if(Math.hypot(u-a,c-l)>10)return;let h=this.canvas.getContext("2d").getTransform().inverse(),b=new DOMPoint(u,c-31).matrixTransform(h);this.onPinFixedObserver.publish({x:b.x,y:b.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:b.x,y:b.y},this.renderTemporaryPin();let w=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,w.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.pins.forEach(i=>{i.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};this.hideTemporaryPin=e=>{var i;let t=e.target;this.canvas.contains(t)||((i=this.pins.get("temporary-pin"))==null?void 0:i.contains(t))||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};if(this.logger=new qt("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(e),this.isActive=!1,this.pins=new Map,this.goToPinCallback=t==null?void 0:t.onGoToPin,!this.canvas){let i=`Canvas with id ${e} not found`;throw this.logger.log(i),new Error(i)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new At({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate)}destroy(){this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame)}setPinsVisibility(e){if(this.isPinsVisible=e,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(e){if(this.isActive=e,this.isActive){this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.addListeners();return}this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(e){let t=this.pins.get(e);!t||(t.remove(),this.pins.delete(e),e!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==e)))}renderTemporaryPin(){var v,E;let e=document.getElementById("superviz-temporary-pin");e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.canvasSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("localAvatar",(v=this.localParticipant.avatar)!=null?v:""),e.setAttribute("localName",(E=this.localParticipant.name)!=null?E:""),e.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(e));let{x:t,y:i}=this.temporaryPinCoordinates,a=this.canvas.getContext("2d").getTransform(),l=a.e,u=a.f,c=t+l,m=i+u;e.setAttribute("position",JSON.stringify({x:c,y:m})),this.pins.set("temporary-pin",e)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let e=this.canvas.getBoundingClientRect(),t=this.divWrapper;return t||(t=document.createElement("div"),t.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),t.style.position="absolute",t.style.top=`${this.canvas.offsetTop}px`,t.style.left=`${this.canvas.offsetLeft}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){if((!this.annotations.length||this.canvas.style.display==="none")&&!this.pins.get("temporary-pin")){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{if(e.resolved)return;let t=JSON.parse(e.position);if((t==null?void 0:t.type)!=="canvas")return;let{x:i,y:r}=t,l=this.canvas.getContext("2d").getTransform(),u=l.e,c=l.f,m=i+u,v=r+c;if(this.pins.has(e.uuid)){let h=this.pins.get(e.uuid);if(this.divWrapper.clientWidth>m&&this.divWrapper.clientHeight>v){h.setAttribute("style","opacity: 1"),this.pins.get(e.uuid).setAttribute("position",JSON.stringify({x:m,y:v}));return}h.setAttribute("style","opacity: 0");return}let E=document.createElement("superviz-comments-annotation-pin");E.setAttribute("type","show"),E.setAttribute("annotation",JSON.stringify(e)),E.setAttribute("position",JSON.stringify({x:m,y:v})),E.id=e.uuid,this.divWrapper.appendChild(E),this.pins.set(e.uuid,E)})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}goToPin(e){let t=this.annotations.find(b=>b.uuid===e);if(!t)return;let i=JSON.parse(t.position);if((i==null?void 0:i.type)!=="canvas")return;let r=this.canvas.getBoundingClientRect(),{width:a,height:l}=r,{x:u,y:c}=i,m=a/2,v=l/2,E=m-u,h=v-c;this.goToPinCallback&&this.goToPinCallback({x:E,y:h})}};D();var $p=pn(wr());var Co=class{constructor(e,t={}){this.localParticipant={};this.isPinsVisible=!0;this.selectedPin=null;this.dataAttribute="data-superviz-id";this.commentsSide="left";this.temporaryPinCoordinates={};this.elementsWithDataId={};this.divWrappers=new Map;this.voidElementsWrappers=new Map;this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))};this.setCommentsMetadata=(e,t,i)=>{this.commentsSide=e,this.localParticipant.avatar=t,this.localParticipant.name=i};this.hideTemporaryPin=e=>{let t=e.target;this.divWrappers.forEach(i=>{var r;i.contains(t)||((r=this.pins.get("temporary-pin"))==null?void 0:r.contains(t))||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})})};this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))};this.annotationSelected=({detail:{uuid:e}})=>{if(!e)return;let t=this.annotations.find(a=>{var l;return a.uuid===((l=this.selectedPin)==null?void 0:l.id)});if(this.resetPins(),(t==null?void 0:t.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let i=this.pins.get(e);if(!i)return;i.setAttribute("active",""),this.selectedPin=i;let r=this.annotations.find(a=>a.uuid===e);this.selectedPin.setAttribute("elementId",JSON.parse(r.position).elementId)};this.onClick=e=>{if(!this.isActive||e.target===this.pins.get("temporary-pin"))return;let t=e.target,i=e.currentTarget;if(t!==i&&this.pins.has(t.id))return;let r=i.getAttribute("data-wrapper-id"),a=i.getBoundingClientRect(),{x:l,y:u}=this.mouseDownCoordinates,c=e.clientX-a.left,m=e.clientY-a.top,v=l-a.x,E=u-a.y;if(Math.hypot(c-v,m-E)>10)return;let{width:b,height:w}=i.getBoundingClientRect(),P=32,C=i.getBoundingClientRect().width/i.offsetWidth||1;c=c*100/b,m=(m-P*C)*100/w,this.onPinFixedObserver.publish({x:c,y:m,type:"html",elementId:r}),this.resetSelectedPin(),this.temporaryPinCoordinates=_t(lt({},this.temporaryPinCoordinates),{x:c,y:m}),this.renderTemporaryPin(r);let O=this.divWrappers.get(r).querySelector("#superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,O.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseDown=({x:e,y:t})=>{this.mouseDownCoordinates={x:e,y:t}};this.handleMutationObserverChanges=e=>{e.forEach(t=>{var m;let{target:i,oldValue:r}=t,a=i.getAttribute(this.dataAttribute);if(!a&&!r||a===r)return;let l=this.dataAttributeValueFilters.some(v=>r.match(v));if(!a&&r&&!l){this.removeAnnotationPin("temporary-pin"),this.clearElement(r),((m=this.selectedPin)==null?void 0:m.getAttribute("elementId"))===r&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null);return}let c=this.dataAttributeValueFilters.some(v=>a.match(v));(r&&this.elementsWithDataId[r]||c)&&this.clearElement(r),!c&&(this.setElementReadyToPin(i,a),this.renderAnnotationsPins())})};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))};if(this.logger=new qt("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(e),!this.container){let a=`Element with id ${e} not found`;throw this.logger.log(a),new Error(a)}if(typeof t!="object")throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:i,dataAttributeValueFilters:r}=t;if(i==="")throw new Error("dataAttributeName must be a non-empty string");if(i===null)throw new Error("dataAttributeName cannot be null");if(i!==void 0&&typeof i!="string")throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=i||this.dataAttribute,this.dataAttributeValueFilters=r||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new At({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach(e=>e.remove()),this.divWrappers.clear(),this.pins.forEach(e=>e.remove()),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(e){this.divWrappers.get(e).addEventListener("click",this.onClick,!0),this.divWrappers.get(e).addEventListener("mousedown",this.onMouseDown)}removeElementListeners(e){this.divWrappers.get(e).removeEventListener("click",this.onClick,!0),this.divWrappers.get(e).removeEventListener("mousedown",this.onMouseDown)}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){Object.keys(this.elementsWithDataId).forEach(e=>this.addElementListeners(e)),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){Object.keys(this.elementsWithDataId).forEach(e=>this.removeElementListeners(e)),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach(t=>{let i=t.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some((a,l)=>i.match(a))||this.setElementReadyToPin(t,i)})}setAddCursor(){Object.keys(this.elementsWithDataId).forEach(e=>{this.divWrappers.get(e).style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.divWrappers.get(e).style.pointerEvents="auto"})}removeAddCursor(){Object.keys(this.elementsWithDataId).forEach(e=>{this.divWrappers.get(e).style.cursor="default",this.divWrappers.get(e).style.pointerEvents="none"})}setPinsVisibility(e){this.isPinsVisible=e,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(e){let t=this.pins.get(e);!t&&e==="temporary-pin"||(t&&(t.remove(),this.pins.delete(e)),e!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==e)))}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(e){if(this.isActive=e,this.isActive){this.addListeners(),this.setAddCursor(),this.prepareElements();return}this.removeListeners(),this.removeAddCursor()}renderTemporaryPin(e){var a,l,u;(a=this.temporaryPinCoordinates).elementId||(a.elementId=e);let t=this.pins.get("temporary-pin");if(e&&e!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=e,t=null),!t){let c=this.elementsWithDataId[e].getBoundingClientRect();t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(c)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("localAvatar",(l=this.localParticipant.avatar)!=null?l:""),t.setAttribute("localName",(u=this.localParticipant.name)!=null?u:""),t.setAttribute("keepPositionRatio",""),t.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(e,t)}let{x:i,y:r}=this.temporaryPinCoordinates;t.setAttribute("position",JSON.stringify({x:i,y:r})),this.pins.set("temporary-pin",t)}renderAnnotationsPins(){if(!this.annotations.length){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{if(e.resolved)return;let{x:t,y:i,elementId:r,type:a}=JSON.parse(e.position);if(a!=="html"||this.pins.has(e.uuid)||!this.elementsWithDataId[r])return;let u=this.divWrappers.get(r);if(!u)return;let{width:c,height:m}=u.getBoundingClientRect(),v=this.createPin(e,t,i);u.appendChild(v),this.pins.set(e.uuid,v)})}updatePinsPositions(){this.voidElementsWrappers.forEach((e,t)=>{let i=JSON.stringify(e.getBoundingClientRect()),r=this.elementsWithDataId[t].getBoundingClientRect();(0,$p.isEqual)(JSON.stringify(r),i)||(e.style.setProperty("top",`${r.top}px`),e.style.setProperty("left",`${r.left}px`),e.style.setProperty("width",`${r.width}px`),e.style.setProperty("height",`${r.height}px`))})}clearElement(e){if(!this.elementsWithDataId[e])return;let i=this.divWrappers.get(e);if(i){let r=i.children,{length:a}=r;for(let l=0;l<a;++l){let u=r.item(l);this.pins.delete(u.id)}i.remove()}this.voidElementsWrappers.delete(e),this.removeElementListeners(e),this.divWrappers.delete(e),this.elementsWithDataId[e]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}setElementReadyToPin(e,t){if(!this.elementsWithDataId[t]){if(this.elementsWithDataId[t]=e,!this.divWrappers.get(t)){let i=this.createWrapper(e,t);this.divWrappers.set(t,i)}!this.isActive||!this.isPinsVisible||(this.divWrappers.get(t).style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.divWrappers.get(t).style.pointerEvents="auto",this.addElementListeners(t))}}addTemporaryPinToElement(e,t){if(!this.elementsWithDataId[e])return;let r=this.divWrappers.get(e);!r||r.appendChild(t)}createPin(e,t,i){let r=document.createElement("superviz-comments-annotation-pin");return r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(e)),r.setAttribute("position",JSON.stringify({x:t,y:i})),r.setAttribute("keepPositionRatio",""),r.id=e.uuid,r}createWrapper(e,t){let i=e,r=`superviz-id-${t}`;if(this.divWrappers.get(t))return;let a=i.getBoundingClientRect(),l=document.createElement("div");if(l.setAttribute("data-wrapper-id",t),l.id=r,l.style.position="absolute",l.style.pointerEvents="none",l.style.transform="translateX(0) translateY(0) scale(1)",l.style.cursor="default",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",!this.VOID_ELEMENTS.includes(this.elementsWithDataId[t].tagName.toLowerCase()))return this.elementsWithDataId[t].appendChild(l),this.setPositionNotStatic(this.elementsWithDataId[t]),l;l.style.position="fixed",l.style.top=`${a.top}px`,l.style.left=`${a.left}px`,l.style.width=`${a.width}px`,l.style.height=`${a.height}px`;let u=this.elementsWithDataId[t].parentElement;return u||(u=document.body),this.setPositionNotStatic(u),u.appendChild(l),this.voidElementsWrappers.set(t,l),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),l}setPositionNotStatic(e){let{position:t}=window.getComputedStyle(e);t==="static"&&e.style.setProperty("position","relative")}};D();var Hu=pn(wr());D();var Sn=pn(Hp()),wo=class{constructor(){this.browser=Sn.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Sn.default.PLATFORMS_MAP.mobile)||this.browser.is(Sn.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Sn.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};D();var ma=class{constructor(){this.updateMeetingConnectionStatus=e=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=e,this.connectionStatusObserver.publish(e),this.logger.log("CONNECTION STATUS CHANGE",e)};this.onUpdateBrowserOnlineStatus=e=>{let{type:t}=e;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new qt("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new At({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};D();D();var ga=class{build(e,t,i,r={},a={}){let l=document.querySelector(`#${e}`),u=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(r).forEach(([c,m])=>{u.searchParams.set(c,m)}),Object.entries(a).forEach(([c,m])=>{this.element.setAttribute(c,m)}),this.element.src=u.toString(),this.element.id=i,l.appendChild(this.element),this.wrapperId=e}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let e=document.querySelector(`#${this.wrapperId}`);!!e&&!!e.querySelector(`#${this.element.id}`)&&e.removeChild(this.element),this.wrapperId=null,this.element=null}};D();var va=class{constructor(e){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(e,t={})=>{this.logger.log("MessageBridge","Posting message to frame",e,t),this.contentWindow.postMessage({type:e,data:t},this.allowedOrigins)};this.listen=(e,t)=>{this.observers[e]||(this.observers[e]=new At({logger:this.logger})),this.observers[e].subscribe(t)};this.onReceiveMessage=e=>{let{type:t,data:i,source:r}=e.data;if(this.sourceBlockList.includes(r)||this.originBlockList.includes(e.origin))return;let a=!!t,l=!this.domains.length||this.domains.includes(e.origin),u=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${e.type}
        ORIGIN: ${e.origin}
        DATA: ${JSON.stringify(e.data)} `),!a||!l||!u){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(i)};let{contentWindow:t,domains:i=[],allowedOrigins:r="*",sourceBlockList:a=[],logger:l}=e;if(this.logger=l,this.domains=i,this.allowedOrigins=r,this.sourceBlockList.push(...a),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([e,t])=>{t.reset(),delete this.observers[e]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};D();var Po=(i=>(i.RIGHT="right",i.CENTER="center",i.LEFT="left",i))(Po||{}),ya=(t=>(t.GRID="grid",t.LIST="list",t))(ya||{}),ba=(r=>(r.RIGHT="right",r.LEFT="left",r.TOP="top",r.BOTTOM="bottom",r))(ba||{});var Gp="sv-video-frame",xo=class{constructor(e){this.logger=new qt("@superviz/sdk/video-conference-manager");this.frameStateObserver=new At({logger:this.logger});this.frameSizeObserver=new At({logger:this.logger});this.waitingForHostObserver=new At({logger:this.logger});this.realtimeEventsObserver=new At({logger:this.logger});this.sameAccountErrorObserver=new At({logger:this.logger});this.devicesObserver=new At({logger:this.logger});this.meetingStateObserver=new At({logger:this.logger});this.meetingConnectionObserver=new At({logger:this.logger});this.participantJoinedObserver=new At({logger:this.logger});this.participantLeftObserver=new At({logger:this.logger});this.participantListObserver=new At({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(e,t)=>{let i=e,r=t,a=["left","right","bottom","top"].includes(r),l=["left","right","center"].includes(i);return a||(r="right"),l||(i="right"),this.browserService.isMobileDevice?(r="bottom",{layoutPosition:i,camerasPosition:r}):(i==="left"&&r==="right"&&(i="right"),i==="right"&&r==="left"&&(i="left"),{layoutPosition:i,camerasPosition:r})};this.onFrameLoad=()=>{this.messageBridge=new va({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=e=>{let t=e!=null?e:{};["top","bottom","left","right"].forEach(i=>{Object.keys(t).includes(i)||(t[i]=0)}),this.frameOffset=t};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=e=>{let t=document.createElement("style"),{bottom:i,left:r,right:a,top:l}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${l}px;
        --superviz-offset-right: ${a}px;
        --superviz-offset-left: ${r}px;
        --superviz-offset-bottom: ${i}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${e}`)};this.onFrameDimensionsUpdate=({width:e,height:t})=>{let i=document.getElementById(Gp),{bottom:r,right:a,left:l,top:u}=this.frameOffset,c=this.isWaterMarkEnabled?40:0,m=`${e}px`,v=`${t+c}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${a}px - ${l}px)`),t>=window.innerHeight&&(v=`calc(100% - ${u}px - ${r}px)`),i.style.width=m,i.style.height=v,this.frameSizeObserver.publish({width:i.offsetWidth,height:i.offsetHeight})};this.onWindowResize=()=>{let{top:e,bottom:t,right:i,left:r}=this.frameOffset,{innerHeight:a,innerWidth:l}=window,u=a-e-t,c=l-i-r;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:u,width:c})};this.updateFrameLocale=()=>{var a,l;if(!this.frameLocale||!((a=this.frameLocale)!=null&&a.language)&&((l=this.frameLocale)==null?void 0:l.locales))return;let{language:e,locales:t}=this.frameLocale,i=t.map(u=>u==null?void 0:u.language),r=["en",...i];if(e&&!r.includes(e))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=e=>{this.participantJoinedObserver.publish(e)};this.onParticipantLeft=e=>{this.participantLeftObserver.publish(e)};this.onMeetingHostChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:e})};this.onMeetingKickParticipant=e=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:e})};this.onFollowParticipantDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:e})};this.onGoToDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:e})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:e})};this.onDrawingChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:e})};this.onTranscriptChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:e})};this.onSameAccountError=e=>{this.sameAccountErrorObserver.publish(e)};this.onDevicesChange=e=>{this.devicesObserver.publish(e)};this.meetingStateUpdate=e=>{this.meetingStateObserver.publish(e)};this.onConnectionStatusChange=e=>{this.meetingConnectionObserver.publish(e)};this.onWaitingForHostDidChange=e=>{this.waitingForHostObserver.publish(e)};this.onParticipantListUpdate=e=>{this.participantListObserver.publish(e)};var z,W,N,R;let{language:t,canUseCams:i,canUseChat:r,canUseScreenshare:a,canUseDefaultAvatars:l,canUseFollow:u,canUseGoTo:c,canUseGather:m,canShowAudienceList:v,canUseDefaultToolbar:E,canUseTranscription:h,browserService:b,offset:w,locales:P,avatars:C,customColors:O,waterMark:x,layoutPosition:g,camerasPosition:A,skipMeetingSettings:f,devices:p,layoutMode:S,collaborationMode:y}=e;this.browserService=b;let I=this.layoutModalsAndCamerasConfig(g,A),F=document.createElement("div");this.frameConfig={apiKey:Tt.get("apiKey"),apiUrl:Tt.get("apiUrl"),ablyKey:Tt.get("ablyKey"),debug:Tt.get("debug"),roomId:Tt.get("roomId"),limits:Tt.get("limits"),collaborationMode:y,canUseFollow:u,canUseGoTo:c,canUseCams:i,canUseChat:r,canUseGather:m,canUseScreenshare:a,canUseDefaultAvatars:l,canUseTranscription:h,canShowAudienceList:v,camerasPosition:(z=I.camerasPosition)!=null?z:"right",canUseDefaultToolbar:E,devices:{audioInput:(W=p==null?void 0:p.audioInput)!=null?W:!0,audioOutput:(N=p==null?void 0:p.audioOutput)!=null?N:!0,videoInput:(R=p==null?void 0:p.videoInput)!=null?R:!0},waterMark:x,layoutMode:S,skipMeetingSettings:f,layoutPosition:I.layoutPosition},this.customColors=O,F.classList.add("sv_video_wrapper"),F.id="sv-video-wrapper",document.body.appendChild(F),this.updateFrameState(1),this.bricklayer=new ga,this.bricklayer.build(F.id,Tt.get("conferenceLayerUrl"),Gp,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(w),this.setFrameStyle(I.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:P},this.meetingAvatars=C,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(e){e!==this.frameState&&(this.frameState=e,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[e])}start(e){this.messageBridge.publish("meeting.start",_t(lt({},e),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var e,t;(e=this.messageBridge)==null||e.destroy(),(t=this.bricklayer)==null||t.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(e,t){this.messageBridge.publish(e,t)}};var Io=class extends on{constructor(t){var i,r;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var t,i,r,a,l,u,c,m,v,E,h,b,w,P,C,O,x,g,A,f,p,S,y,I,F,z,W,N,R,L,$,G,J,tt,it;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseTranscription:((i=this.params)==null?void 0:i.transcriptOff)===!1,canShowAudienceList:(a=(r=this.params)==null?void 0:r.showAudienceList)!=null?a:!0,canUseChat:!((l=this.params)!=null&&l.chatOff),canUseCams:!((u=this.params)!=null&&u.camsOff),canUseScreenshare:!((c=this.params)!=null&&c.screenshareOff),canUseDefaultAvatars:!!((m=this.params)!=null&&m.defaultAvatars)&&!((E=(v=this.localParticipant)==null?void 0:v.avatar)!=null&&E.model3DUrl),canUseGather:!!((h=this.params)!=null&&h.enableGather),canUseFollow:!!((b=this.params)!=null&&b.enableFollow),canUseGoTo:!!((w=this.params)!=null&&w.enableGoTo),canUseDefaultToolbar:(C=(P=this.params)==null?void 0:P.defaultToolbar)!=null?C:!0,camerasPosition:(x=(O=this.params)==null?void 0:O.collaborationMode)==null?void 0:x.position,devices:(g=this.params)==null?void 0:g.devices,skipMeetingSettings:(A=this.params)==null?void 0:A.skipMeetingSettings,browserService:this.browserService,offset:(f=this.params)==null?void 0:f.offset,locales:(S=(p=this.params)==null?void 0:p.locales)!=null?S:[],avatars:(I=(y=this.params)==null?void 0:y.avatars)!=null?I:[],customColors:Tt.get("colors"),collaborationMode:(W=(z=(F=this.params)==null?void 0:F.collaborationMode)==null?void 0:z.enabled)!=null?W:!0,layoutPosition:((R=(N=this.params)==null?void 0:N.collaborationMode)==null?void 0:R.enabled)===!1?"center":(G=($=(L=this.params)==null?void 0:L.collaborationMode)==null?void 0:$.modalPosition)!=null?G:"center",layoutMode:(it=(tt=(J=this.params)==null?void 0:J.collaborationMode)==null?void 0:tt.initialView)!=null?it:"list",waterMark:this.showWaterMarkType},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new xo(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video conference @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=t=>{var i;return{id:t.clientId,color:this.realtime.getSlotColor((i=t.data)==null?void 0:i.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video conference @ on connection status change",t);let i=[2,4,3,6];i.includes(t)&&this.realtime.freezeSync(!0),i.includes(this.connectionService.oldConnectionStatus)&&!i.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video conference @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.internalRemoveComponent()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video conference @ on frame state change",t),t===2&&(this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:Tt.get("roomId")}),this.publish("meeting.start"))};this.onRealtimeEventFromFrame=({event:t,data:i})=>{this.logger.log("video conference @ on realtime event from frame",t,i);let r={["realtime.host-change"]:a=>this.realtime.setHost(a),["realtime.gather"]:a=>this.realtime.setGather(a),["realtime.grid-mode-change"]:a=>this.realtime.setGridMode(a),["realtime.drawing-change"]:a=>{this.realtime.setDrawing(a)},["realtime.follow-participant"]:a=>{this.realtime.setFollowParticipant(a)},["meeting.kick-participant"]:a=>{this.realtime.setKickParticipant(a)},["realtime.transcript-change"]:a=>{this.realtime.setTranscript(a)},["realtime.go-to-participant"]:a=>{this.eventBus.publish("realtime.go-to-participant",a)}}[t](i);this.publish(t,i)};this.onParticipantJoined=t=>{if(this.logger.log("video conference @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type});return}this.realtime.updateMyProperties({name:t.name,type:t.type})};this.onParticipantLeft=t=>{this.logger.log("video conference @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.internalRemoveComponent()};this.onParticipantListUpdate=t=>{this.logger.log("video conference @ on participant list update",t),!(0,Hu.isEqual)(this.participantsOnMeeting,t)&&(this.publish("meeting.participant-list-update",t),this.participantsOnMeeting.length!==t.length&&this.publish("meeting.amount-of-participants-update",t.length),this.participantsOnMeeting=t)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video conference @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.internalRemoveComponent()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.internalRemoveComponent()};this.onRoomInfoUpdated=t=>{this.logger.log("video conference @ on room info updated",t);let{isGridModeEnable:i,followParticipantId:r,gather:a,drawing:l,transcript:u}=t;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",i),this.videoManager.publishMessageToFrame("realtime.drawing-change",l),this.videoManager.publishMessageToFrame("realtime.follow-participant",r),this.videoManager.publishMessageToFrame("realtime.transcript-change",u),this.realtime.hostClientId===this.localParticipant.id&&a&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video conference @ on participants did change",t);let i=Object.values(t).map(r=>({timestamp:r.timestamp,connectionId:r.connectionId,participantId:r.clientId,color:this.realtime.getSlotColor(r.data.slotIndex).name,name:r.data.name,isHost:this.realtime.hostClientId===r.clientId,avatar:r.data.avatar,type:r.data.type}));(0,Hu.isEqual)(this.participantToFrameList,i)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",i),this.participantToFrameList=i};this.onHostParticipantDidChange=t=>{this.logger.log("video conference @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t==null?void 0:t.newHostParticipantId)};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video conference @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video conference @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.params=_t(lt({},t),{userType:(r=(i=t==null?void 0:t.participantType)!=null?i:t==null?void 0:t.userType)!=null?r:"guest"}),this.name="videoConference",this.logger=new qt(`@superviz/sdk/${"videoConference"}`),this.browserService=new wo,this.connectionService=new ma,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){var t;this.logger.log("video conference @ start"),this.params.userType!=="guest"&&(this.localParticipant.type=this.params.userType),this.realtime.setKickParticipantsOnHostLeave(!((t=this.params)!=null&&t.allowGuests)),this.suscribeToRealtimeEvents(),this.showWaterMarkType=Tt.get("waterMark"),this.startVideo()}destroy(){this.logger.log("video conference @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}internalRemoveComponent(){this.logger.log("video conference @ internal remove component");let{data:t}=this.realtime.participant,i=t.activeComponents.filter(r=>r!=="videoConference");this.realtime.updateMyProperties({activeComponents:i,type:"guest"}),this.realtime.setKickParticipantsOnHostLeave(!1),this.detach()}};D();var Mo=class extends on{constructor(t,i){super();this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.setParticipantPrivate=t=>{this.isPrivate=t,this.realtime.updatePresenceMouse(_t(lt({},this.localParticipant),{visible:!t}))};this.animate=()=>{this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.goToMouse=t=>{let i=this.presences.get(t);if(!i)return;let r=this.canvas.getBoundingClientRect(),{width:a,height:l}=r,{x:u,y:c}=i,m=a/2,v=l/2,E=m-u,h=v-c;this.goToMouseCallback&&this.goToMouseCallback({x:E,y:h})};this.onMyParticipantMouseMove=t=>{let i=this.canvas.getContext("2d"),r=this.canvas.getBoundingClientRect(),a=t.x-r.left,l=t.y-r.top,c=(i==null?void 0:i.getTransform()).inverse(),m=new DOMPoint(a,l).matrixTransform(c);this.realtime.updatePresenceMouse(_t(lt({},this.localParticipant),{x:m.x,y:m.y,visible:!this.isPrivate}))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.values(t).forEach(i=>{if(i.id!==this.localParticipant.id){if(this.following&&i.id!==this.following&&this.presences.has(i.id)){this.removePresenceMouseParticipant(i.id);return}this.presences.set(i.id,i)}}),this.following&&this.presences.get(this.following)&&this.goToMouse(this.following)};this.onMyParticipantMouseOut=t=>{let{x:i,y:r,width:a,height:l}=this.canvas.getBoundingClientRect();t.x>0&&t.y>0&&t.x<i+a&&t.y<r+l||this.realtime.updatePresenceMouse(lt({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=t=>{this.removePresenceMouseParticipant(t.id)};this.updateParticipantsMouses=()=>{this.presences.forEach(t=>{if(!(t!=null&&t.visible)){this.removePresenceMouseParticipant(t.id);return}this.renderPresenceMouses(t)})};this.renderPresenceMouses=t=>{let r=document.getElementById(`mouse-${t.id}`);r||(r=this.createMouseElement(t));let a=document.getElementById(`mouse-${t.id}`),l=document.getElementById(`mouse-${t.id}`);if(!a||!l)return;let u=a.getElementsByClassName("mouse-user-name")[0],c=l.getElementsByClassName("pointer-mouse")[0];c&&(c.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${t.slotIndex}.svg)`),u&&(u.style.color=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A",u.style.backgroundColor=t.color,u.innerHTML=t.name);let{x:m,y:v}=t,E=this.canvas.getContext("2d"),h=E==null?void 0:E.getTransform(),b=h==null?void 0:h.e,w=h==null?void 0:h.f,P=m+b,C=v+w,O=this.divWrapper.clientWidth>P&&this.divWrapper.clientHeight>C&&t.visible;r.style.opacity=O?"1":"0",r.style.left=`${P}px`,r.style.top=`${C}px`};this.followMouse=t=>{this.following=t};if(this.name="presence",this.logger=new qt(`@superviz/sdk/${"presence"}`),this.canvas=document.getElementById(t),this.presences=new Map,!this.canvas){let r=`Canvas with id ${t} not found`;throw this.logger.log(r),new Error(r)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=i==null?void 0:i.onGoToPresence}get textColorValues(){return[2,4,5,7,8,16]}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),i=document.getElementById("superviz-presence-mouse-wrapper");return i||(i=document.createElement("div"),i.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(i)),i.style.position="fixed",i.style.top=`${t.top}px`,i.style.left=`${t.left}px`,i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.pointerEvents="none",i.style.overflow="hidden",i.style.zIndex="2",i}removePresenceMouseParticipant(t){let i=document.getElementById(`mouse-${t}`);i&&(i.remove(),this.presences.delete(t))}createMouseElement(t){let i=document.createElement("div");i.setAttribute("id",`mouse-${t.id}`),i.setAttribute("class","mouse-follower");let r=document.createElement("div");r.setAttribute("class","pointer-mouse");let a=document.createElement("div");return a.setAttribute("class","mouse-user-name"),a.innerHTML=t.name,i.appendChild(r),i.appendChild(a),this.divWrapper.appendChild(i),i}};D();D();var Ea=class{constructor(e){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("pubsub service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new At),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("pubsub service @ publish",{event:e,data:t}),this.realtime.setSyncProperty(e,t)};this.publishEventToClient=(e,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(e=>e.destroy()),this.observers.clear()};this.onSyncPropertiesChange=e=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:e}),Object.entries(e).forEach(([t,i])=>{this.publishEventToClient(t,i)})};this.logger=new qt("@superviz/sdk/pubsub"),this.realtime=e,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(e){return this.realtime.fetchSyncClientProperty(e)}};D();var Aa=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(Aa||{}),Ta=(e=>(e.REALTIME_STATE_CHANGED="realtime-component.state-changed",e))(Ta||{});var Ro=class extends on{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=(t,i)=>{if(!this.pubsub){let r=`Realtime component is not started yet. You can't publish event ${t} before start`;this.logger.log(r);return}this.pubsub.publish(t,i)};this.subscribe=(t,i)=>{if(!this.pubsub){this.callbacksToSubscribeWhenJoined.push({event:t,callback:i});return}this.pubsub.subscribe(t,i)};this.unsubscribe=(t,i)=>{this.pubsub.unsubscribe(t,i)};this.name="realtime",this.logger=new qt("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new Ea(this.realtime),this.callbacksToSubscribeWhenJoined.forEach(({event:t,callback:i})=>{this.pubsub.subscribe(t,i)}),this.changeState("STARTED")}fetchHistory(t){return this.pubsub.fetchHistory(t)}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.pubsub.publishEventToClient("realtime-component.state-changed",this.state)}};D();var Wp=pn(wr());D();var Gu=(r=>(r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r))(Gu||{});var _o=class extends on{constructor(t){super();this.participants=[];this.onParticipantListUpdate=t=>{let r=Object.values(t).filter(({data:a})=>{var l;return(l=a.activeComponents)==null?void 0:l.includes("whoIsOnline")}).filter(({data:{isPrivate:a,id:l}})=>!a||a&&l===this.localParticipant.id).map(({data:a})=>{let{slotIndex:l,id:u,name:c,avatar:m,activeComponents:v}=a,{color:E}=this.realtime.getSlotColor(l),h=this.localParticipant.id===u,b=v.some(w=>w.includes("presence"));return this.setLocalData(h,!b,E,b),{name:c,id:u,slotIndex:l,color:E,isLocal:h,joinedPresence:b,avatar:m}});(0,Wp.isEqual)(r,this.participants)||(this.following&&(r.find(({id:l})=>l===this.following)||this.stopFollowing({clientId:this.following})),this.participants=r,this.element.updateParticipants(this.participants))};this.setLocalData=(t,i,r,a)=>{!t||(this.element.disableDropdown=i,this.element.localParticipantData={color:r,id:this.localParticipant.id,joinedPresence:a})};this.goToMousePointer=({detail:t})=>{this.eventBus.publish("realtime.go-to-participant",t.id)};this.followMousePointer=({detail:t})=>{this.eventBus.publish("realtime.local-follow-participant",t.id),this.following=t.id};this.setPrivate=({detail:{isPrivate:t,id:i}})=>{this.eventBus.publish("realtime.private-mode",t),this.realtime.setPrivateWIOParticipant(i,t)};this.setFollow=t=>{var i;if(t.clientId!==this.localParticipant.id){if(this.followMousePointer({detail:{id:(i=t==null?void 0:t.data)==null?void 0:i.id}}),!t.data.id){this.element.following=void 0;return}this.following=t.data.id,this.element.following=t.data}};this.follow=t=>{var i;this.realtime.setFollowWIOParticipant(lt({},t.detail)),this.following=(i=t.detail)==null?void 0:i.id};this.stopFollowing=t=>{var i;t.clientId===((i=this.element.following)==null?void 0:i.id)&&(this.element.following=void 0,this.following=void 0,this.eventBus.publish("realtime.local-follow-participant",void 0))};this.gather=t=>{this.realtime.setGatherWIOParticipant(lt({},t.detail))};this.position=t!=null?t:"top-right",this.name="whoIsOnline",this.logger=new qt("@superviz/sdk/who-is-online-component")}start(){this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners(),this.realtime.enterWIOChannel(this.localParticipant)}destroy(){this.unsubscribeToRealtimeEvents(),this.realtime.leaveWIOChannel(),this.removeListeners(),this.element.remove(),this.element=null,this.participants=null}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.subscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.subscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.subscribe(this.setFollow),this.realtime.gatherWIOObserver.subscribe(this.goToMousePointer)}unsubscribeToRealtimeEvents(){this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.unsubscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.unsubscribe(this.setFollow),this.realtime.gatherWIOObserver.unsubscribe(this.goToMousePointer)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(Gu).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[r,a]=this.position.split("-");this.element.position=`${r}: 20px; ${a}: 40px;`;return}let i=document.getElementById(this.position);if(!i){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}i.appendChild(this.element),this.element.position="position: relative;"}};D();var Zu=pn(Ru());D();var Wu=(O=>(O.svPrimary="sv-primary",O.svPrimary900="sv-primary-900",O.svPrimary200="sv-primary-200",O.svSecondary="sv-secondary",O.svGray="sv-gray",O.svSuccess="sv-success",O.svDanger="sv-danger",O.svBlack="sv-black",O.svWhite="sv-white",O.svGray100="sv-gray-100",O.svGray200="sv-gray-200",O.svGray300="sv-gray-300",O.svGray400="sv-gray-400",O.svGray500="sv-gray-500",O.svGray600="sv-gray-600",O.svGray700="sv-gray-700",O.svGray800="sv-gray-800",O))(Wu||{});D();function pS(s,e){return Lt(this,null,function*(){try{return(yield me.validateApiKey(s,e))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var zp=pS;D();D();var Pr=class{static getRemoteConfig(){return Lt(this,arguments,function*(e="prod"){let{version:t}=yield Promise.resolve().then(()=>(jp(),Vp));if(e==="local"){let{remoteConfig:a}=yield Promise.resolve().then(()=>(Kp(),Jp));return a}let i={version:t,environment:e},r=this.createUrl(i);return Re(r,"GET",null)})}static createUrl({version:e,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${e}?env=${t}`}};Pr.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";D();var Ku=pn(wr());D();var Lo=class{constructor(){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("event bus service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new At),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("event bus service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("event bus service @ publish",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(e=>{e.reset(),e.destroy()}),this.observers.clear()};this.logger=new qt("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};D();var Do=class{static checkComponentLimit(e){var r,a;let t=(r=Uu[e])!=null?r:e,i=Tt.get("limits");return(a=i==null?void 0:i[t])!=null?a:!1}};D();D();var Ju=pn(qp()),Si=pn(Nu());D();var Ca=(O=>(O[O.yellow=0]="yellow",O[O.turquoise=1]="turquoise",O[O.orange=2]="orange",O[O.blue=3]="blue",O[O.pink=4]="pink",O[O.purple=5]="purple",O[O.green=6]="green",O[O.red=7]="red",O[O.bluedark=8]="bluedark",O[O.pinklight=9]="pinklight",O[O.purplelight=10]="purplelight",O[O.greenlight=11]="greenlight",O[O.orangelight=12]="orangelight",O[O.bluelight=13]="bluelight",O[O.redlight=14]="redlight",O[O.brown=15]="brown",O[O.gray=16]="gray",O))(Ca||{}),Vu=(s=>(s[s["#FFEF33"]=0]="#FFEF33",s[s["#31E0B0"]=1]="#31E0B0",s[s["#FF5E10"]=2]="#FF5E10",s[s["#00ABF7"]=3]="#00ABF7",s[s["#FF00BB"]=4]="#FF00BB",s[s["#9C29FF"]=5]="#9C29FF",s[s["#6FDD00"]=6]="#6FDD00",s[s["#E30000"]=7]="#E30000",s[s["#304AFF"]=8]="#304AFF",s[s["#FF89C4"]=9]="#FF89C4",s[s["#D597FF"]=10]="#D597FF",s[s["#C6EC5C"]=11]="#C6EC5C",s[s["#FFA115"]=12]="#FFA115",s[s["#75DEFE"]=13]="#75DEFE",s[s["#FAA291"]=14]="#FAA291",s[s["#BB813F"]=15]="#BB813F",s[s["#878291"]=16]="#878291",s))(Vu||{});D();var ju=(c=>(c[c.DISCONNECTED=0]="DISCONNECTED",c[c.INITIALIZING=1]="INITIALIZING",c[c.READY_TO_JOIN=2]="READY_TO_JOIN",c[c.CONNECTING=3]="CONNECTING",c[c.CONNECTED=4]="CONNECTED",c[c.JOINED=5]="JOINED",c[c.FAILED=-1]="FAILED",c[c.RETRYING=-2]="RETRYING",c))(ju||{});D();var Sa=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new qt("@superviz/sdk/realtime-service"),this.participantsObserver=new At({logger:this.logger}),this.participantJoinedObserver=new At({logger:this.logger}),this.participantLeaveObserver=new At({logger:this.logger}),this.syncPropertiesObserver=new At({logger:this.logger}),this.reconnectObserver=new At({logger:this.logger}),this.roomInfoUpdatedObserver=new At({logger:this.logger}),this.roomListUpdatedObserver=new At({logger:this.logger}),this.hostObserver=new At({logger:this.logger}),this.hostAvailabilityObserver=new At({logger:this.logger}),this.realtimeStateObserver=new At({logger:this.logger}),this.kickAllParticipantsObserver=new At({logger:this.logger}),this.kickParticipantObserver=new At({logger:this.logger}),this.authenticationObserver=new At({logger:this.logger}),this.domainRefusedObserver=new At({logger:this.logger}),this.commentsObserver=new At({logger:this.logger}),this.presenceMouseObserver=new At({logger:this.logger}),this.privateModeWIOObserver=new At({logger:this.logger}),this.followWIOObserver=new At({logger:this.logger}),this.gatherWIOObserver=new At({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new At({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new At({logger:this.logger}),this.presenceSlotsInfosObserver=new At({logger:this.logger}),this.presence3dObserver=new At({logger:this.logger}),this.presence3dLeaveObserver=new At({logger:this.logger}),this.presence3dJoinedObserver=new At({logger:this.logger})}subscribeToParticipantUpdate(e,t){this.participantObservers[e]||(this.participantObservers[e]=new At({logger:this.logger})),this.participantObservers[e].subscribe(t)}unsubscribeFromParticipantUpdate(e,t){this.participantObservers[e]&&this.participantObservers[e].unsubscribe(t)}subscribeToParticipant3DUpdate(e,t){this.participants3DObservers[e]||(this.participants3DObservers[e]=new At({logger:this.logger})),this.participants3DObservers[e].subscribe(t)}unsubscribeFromParticipant3DUpdate(e,t){this.participants3DObservers[e]&&this.participants3DObservers[e].unsubscribe(t)}getSlotColor(e){let t=e!=null?e:16;return{color:Vu[t],name:Ca[t]}}};var vS=1e3*60,Zp=6e4,yS=1e4,Yp=1e3,bS=100,Ci=null,xr=class extends Sa{constructor(t,i){super();this.participants={};this.participantsWIO={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceWIOChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=t=>{if(!t){this.updateRoomProperties({hostClientId:null});return}let i=this.participants[t];this.updateRoomProperties({hostClientId:i.clientId})};this.setKickParticipant=t=>{if(!t)return;let i=this.participants[t];this.updateRoomProperties({kickParticipant:i})};this.freezeSync=t=>{var i,r;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(i=this.broadcastChannel)==null||i.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(r=this.broadcastChannel)==null||r.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t),this.updatePresence3D(this.myParticipant.data)};this.setKickParticipantsOnHostLeave=t=>{this.shouldKickParticipantsOnHostLeave=t};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{if(this.clientSyncPropertiesQueue[t]=this.clientSyncPropertiesQueue[t].sort((l,u)=>l.timestamp-u.timestamp),!this.clientSyncPropertiesQueue[t].length)return;let{data:i,lengthToBeSplitted:r}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[t]),a=i;this.clientSyncPropertiesQueue[t].splice(0,r),this.clientSyncChannel.publish(t,a,l=>{!l||this.logger.log("REALTIME","Error in publish client sync properties",l.message)})})};this.saveClientRoomState=(t,i)=>Lt(this,null,function*(){let r=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},r,{[t]:i[i.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=t=>Lt(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties);let i=Object.values(this.participants).some(r=>{var a,l;return((l=(a=r.data)==null?void 0:a.activeComponents)==null?void 0:l.includes("videoConference"))&&r.data.type==="host"});t.hostClientId&&i&&Ci&&(clearTimeout(Ci),Ci=null,this.hostAvailabilityObserver.publish(!0)),!t.hostClientId&&i?(this.hostParticipantId=null,this.hostPassingHandle()):!!(t!=null&&t.hostClientId)&&(t==null?void 0:t.hostClientId)!==this.hostParticipantId?this.updateHostInfo(t.hostClientId):!i&&!!(t!=null&&t.hostClientId)?this.updateHostInfo(null):!t.hostClientId&&!Ci&&!i&&this.hostParticipantId&&(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Si.default)((t={})=>{let i=t;this.isMessageTooBig(i)||this.left||!this.enableSync||this.isSyncFrozen||(i.avatar===void 0&&delete i.avatar,this.myParticipant.data=lt(lt({},this.myParticipant.data),i),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},Yp);this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let i=lt(lt({},this.localRoomProperties),t);this.supervizChannel.publish("update",i)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((i,r)=>{r.forEach(a=>{t[a.clientId]=lt({},a)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=t=>{let i=[];if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{a||i.push({clientId:u.clientId,type:u.data.type})})}),!t||!i.some(a=>a.clientId===t&&a.type==="host")){this.hostPassingHandle();return}Ci&&(clearTimeout(Ci),this.hostAvailabilityObserver.publish(!0));let r=this.hostParticipantId;this.hostParticipantId=t,this.hostObserver.publish({oldHostParticipantId:r,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var i;let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((i=this.myParticipant)==null?void 0:i.data.type)==="host"&&(t.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(t)};this.hostPassingHandle=(0,Si.default)(()=>Lt(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((t,i)=>{let r=i.filter(l=>l.data.type==="host").map(l=>l.clientId);if(this.shouldKickParticipantsOnHostLeave&&!r.length){this.hostAvailabilityObserver.publish(!1),Ci=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},vS),this.setHost(null);return}let a=r[0];(a===this.localParticipantId||!r.length)&&this.setHost(a)})}),1e3);this.findSlotIndex=t=>{let i=t,r=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((u,c)=>{if(u){r=[];return}c.forEach(m=>{m.connectionId===i.connectionId&&(i=m),m.connectionId!==i.connectionId&&m.data.hasOwnProperty("slotIndex")&&r.splice(r.indexOf(m.data.slotIndex),1)})}),r.length===0)return;let a=r[0];this.myParticipant.data.slotIndex=a,this.updateMyProperties({slotIndex:a});let l=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(i)},l)};this.confirmSlot=(0,Si.default)(t=>Lt(this,null,function*(){let i=[],r=t;if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{u.connectionId===r.connectionId&&(r=u),u.connectionId!==r.connectionId&&u.data.slotIndex!==void 0&&i.push(u.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||i.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(r);else{let a=yield this.fetchRoomProperties();this.updateRoomProperties(a)}}),1e3);this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties()};this.syncBroadcast=(0,Si.default)(()=>{let t=btoa(this.ablyKey),i=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(i,{headers:{Authorization:`Basic ${t}`}}).then(r=>r.json()).then(r=>{this.broadcastChannel.publish("update",r)})},1e3);this.isMessageTooBig=(t,i=Zp)=>{let r=JSON.stringify(t);return new TextEncoder().encode(r).length>i?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterPresenceMouseChannel=t=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(t)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel.presence.leave(),this.presenceMouseChannel=null)};this.updatePresenceMouse=(0,Si.default)(t=>{let i=Object.assign({},this.participantsMouse[t.id]||{},t);this.presenceMouseChannel.presence.update(i)},bS);this.onPresenceMouseChannelEnter=t=>{let i=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=_t(lt({},t.data),{slotIndex:i,color:this.getSlotColor(i).color}),this.presenceMouseParticipantJoinedObserver.publish(this.participantsMouse[t.clientId])};this.onPresenceMouseChannelLeave=t=>{this.presenceMouseParticipantLeaveObserver.publish(this.participantsMouse[t.clientId]),delete this.participantsMouse[t.clientId]};this.publishPresenceMouseUpdate=t=>{let i=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=_t(lt({},t.data),{slotIndex:i,color:this.getSlotColor(i).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.enterWIOChannel=t=>{this.presenceWIOChannel||(this.presenceWIOChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-wio`)),this.presenceWIOChannel.attach(),this.presenceWIOChannel.subscribe("private",this.onSetPrivate),this.presenceWIOChannel.subscribe("follow",this.onSetFollow),this.presenceWIOChannel.subscribe("gather",this.onSetGather)};this.leaveWIOChannel=()=>{!this.presenceWIOChannel||(this.presenceWIOChannel.unsubscribe(),this.presenceWIOChannel.detach(),this.presenceWIOChannel=null)};this.onSetPrivate=({data:{id:t,isPrivate:i}})=>{this.participants[t].data.isPrivate=i,this.privateModeWIOObserver.publish(this.participants)};this.onSetFollow=t=>{this.followWIOObserver.publish(t)};this.onSetGather=({data:t})=>{this.gatherWIOObserver.publish({detail:{id:t.id}})};this.setPrivateWIOParticipant=(t,i)=>{this.presenceWIOChannel.publish("private",{id:t,isPrivate:i})};this.setFollowWIOParticipant=t=>{this.presenceWIOChannel.publish("follow",lt({},t))};this.setGatherWIOParticipant=t=>{this.presenceWIOChannel.publish("gather",lt({},t))};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=(0,Si.default)(t=>{var r,a,l;if(!t||!t.id)return;let i=Object.assign({},(a=(r=this.participantsOn3d[t.id])==null?void 0:r.data)!=null?a:{},t);this.participantsOn3d[t.id]=_t(lt({},this.participants[i.id]),{data:lt(lt({},i),(l=this.participants[i.id])==null?void 0:l.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(i)},Yp);this.onPresence3DChannelEnter=t=>{var r;t.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let i=this.getParticipantSlot(t.clientId);this.presence3dJoinedObserver.publish(_t(lt({},t),{data:_t(lt(lt({},t.data),(r=this.participants[t.clientId])==null?void 0:r.data),{slotIndex:i,color:this.getSlotColor(i).color})}))};this.onPresence3DChannelLeave=t=>{delete this.participantsOn3d[t.clientId],this.presence3dLeaveObserver.publish(t)};this.publish3DUpdate=t=>{var a;let i=this.getParticipantSlot(t.clientId),r=_t(lt({},t),{data:_t(lt(lt({},t.data),(a=this.participants[t.clientId])==null?void 0:a.data),{slotIndex:i,color:this.getSlotColor(i).color})});this.participantsOn3d[t.clientId]=r,this.participants3DObservers[t.clientId]&&this.participants3DObservers[t.clientId].publish(r),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=i,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,i;return(i=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?i:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:i,apiKey:r}){this.myParticipant={data:_t(lt({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${i.toLowerCase()}-${r}`,this.apiKey=r,this.client||this.buildClient()}auth(t,i){if(!this.domainWhitelisted)return;let r=new Ju.default.Rest({key:this.ablyKey}),{origin:a}=window.location;r.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:a,apiKey:this.apiKey}},(l,u)=>{var c;l&&this.authenticationObserver.publish("realtime.authentication-failed"),(c=l==null?void 0:l.message)!=null&&c.includes("this domain don't have permission")&&(this.domainWhitelisted=!1,this.domainRefusedObserver.publish(this.domainWhitelisted)),i(l,u)})}join(t){let i=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(i),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{isGridModeEnable:t}))}setDrawing(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{drawing:t}))}setTranscript(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{transcript:t}))}setSyncProperty(t,i){let r=(a,l)=>({name:a,data:l,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(r(t,i),yS)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",t,i),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(r(t,i))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var i,r;if(t){let a=t.toString();if(this.participants&&this.participants[a])return(r=(i=this.participants[t])==null?void 0:i.data)==null?void 0:r.slotIndex}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){var c,m,v,E,h;if(!this.isJoinedRoom)return;let{clientId:i}=t,r=Object.assign({},t,{participantId:t.clientId}),a=(v=(m=(c=this.participants[r.clientId])==null?void 0:c.data)==null?void 0:m.activeComponents)==null?void 0:v.includes("videoConference"),l=(h=(E=r.data)==null?void 0:E.activeComponents)==null?void 0:h.includes("videoConference"),u=a&&!l;this.publishParticipantUpdate(r),this.participants&&this.participants[i]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast(),u&&this.hostPassingHandle()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:i,data:r}=t,a={};a[i]=r,this.syncPropertiesObserver.publish(a),t.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(i,r)}onReceiveBroadcastSync(t){t.data.forEach(r=>{var l;let a=r.clientId;this.participants[a]=r,(l=r.data)!=null&&l.isAudience||(this.participants[a].data=JSON.parse(this.participants[a].data),this.publishParticipantUpdate(this.participants[a]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Ju.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${ju[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,i)=>{this.supervizChannel.history((r,a)=>{var u;r&&i(r);let l=(u=a.items[0])==null?void 0:u.data;t(l||null)})})}fetchSyncClientProperty(t){return Lt(this,null,function*(){try{let i=yield new Promise((r,a)=>{this.clientRoomStateChannel.history((l,u)=>{var m;l&&a(l);let c=(m=u==null?void 0:u.items[0])==null?void 0:m.data;r(c||null)})});if(t&&!i[t])throw new Error(`Event ${t} not found in the history`);return t?i[t]:i}catch(i){this.logger.log("REALTIME","Error in fetch client realtime data",i.message),this.throw(i.message)}})}onStateChange(){var v,E,h;let t=(v=this.supervizChannelState)==null?void 0:v.current,i=(E=this.connectionState)==null?void 0:E.current,r=i==="connected",a=["initialized","connecting"].includes(i),l=["closed","closing"].includes(i)||["detaching","detached"].includes(t),u={[0]:l,[1]:a,[2]:!t&&r,[3]:t==="attaching",[4]:t==="attached"&&r,[-1]:t==="failed"||i==="failed",[-2]:i==="suspended"||t==="suspended"},c=Object.entries(u).find(([b,w])=>w&&b)[0],m=Number(c);if(!!this.domainWhitelisted){if(m===2&&(this.currentReconnectAttempt=0),r&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(h=this.connectionState)!=null&&h.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return Lt(this,null,function*(){var i;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(t),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let r=this.myParticipant.data.type==="host";(i=this.localRoomProperties)!=null&&i.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):r&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;let i=t.data.participantId===this.hostParticipantId;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),i&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}spliceArrayBySize(t,i=Zp){let r=c=>{let m=JSON.stringify(c);return new TextEncoder().encode(m).length},a=0,l=[],u=[];for(let c=0;c<t.length;c++){let m=r(t[c]);a+m<=i?(u.push(t[c]),a+=m):(l.push(u),u=[t[c]],a=m)}return u.length>0&&l.push(u),{data:l[0],lengthToBeSplitted:l[0].length}}enterPresence3DChannel(t){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(t)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(t)}};D();var qu=class extends Oi{constructor({participant:t,group:i}){super();this.isDestroyed=!1;this.activeComponents=[];this.activeComponentsInstances=[];this.eventBus=new Lo;this.participants=[];this.addComponent=t=>{!this.canAddComponent(t)||(t.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:Tt.configuration,eventBus:this.eventBus}),this.activeComponents.push(t.name),this.activeComponentsInstances.push(t),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),me.sendActivity(this.participant.id,this.group.id,this.group.name,t.name))};this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let i=`Component ${t.name} is not initialized yet.`;this.logger.log(i);return}t.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(i=>i.name!==t.name),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.destroy=()=>{this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(t=>{this.logger.log("launcher service @ destroy - removing component",t.name),this.removeComponent(t)}),this.activeComponents=[],this.activeComponentsInstances=[],this.participant=void 0,this.eventBus.destroy(),this.eventBus=void 0,this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeave),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.unsubscribe(this.onHostAvailabilityChange),this.realtime.leave(),this.realtime=void 0,this.isDestroyed=!0};this.canAddComponent=t=>{var u;let i=(u=this.realtime)==null?void 0:u.isDomainWhitelisted,r=Do.checkComponentLimit(t.name),a=this.activeComponents.includes(t.name),l=[{isValid:!this.isDestroyed,message:"Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:i,message:`Component ${t.name} can't be used because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dev-dashboard.superviz.com/developer`},{isValid:!a,message:`Component ${t.name} is already active. Please remove it first`},{isValid:r,message:`You reached the limit usage of ${t.name}`}];for(let c=0;c<l.length;c++){let{isValid:m,message:v}=l[c];if(!m)return this.logger.log(v),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:Tt.get("apiKey"),roomId:Tt.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=t=>{var a;this.logger.log("launcher service @ onParticipantListUpdate",t);let i=Object.values(t).map(l=>{var u,c,m,v,E,h;return{id:l.data.id,name:(u=l.data)==null?void 0:u.name,type:(c=l.data)==null?void 0:c.type,avatar:(m=l.data)==null?void 0:m.avatar,avatarConfig:(v=l.data)==null?void 0:v.avatarConfig,isHost:this.realtime.hostClientId===l.clientId,color:this.realtime.getSlotColor((E=l.data)==null?void 0:E.slotIndex).color,activeComponents:(h=l.data)==null?void 0:h.activeComponents}}),r=i.find(l=>{var u;return(l==null?void 0:l.id)===((u=this.participant)==null?void 0:u.id)});(0,Ku.isEqual)(this.participants,i)||(this.participants=i,this.publish("participant.list-updated",i),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",i)),r&&!(0,Ku.isEqual)(this.participant,r)&&(this.activeComponents=(a=r.activeComponents)!=null?a:[],this.activeComponentsInstances=this.activeComponentsInstances.filter(l=>r.activeComponents?this.activeComponents.includes(l.name):!0),this.participant=r,this.publish("participant.updated",r),this.logger.log("Publishing ParticipantEvent.UPDATED",r)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",i)};this.onParticipantJoined=t=>{this.logger.log("launcher service @ onParticipantJoined");let i=this.participants.find(r=>r.id===t.data.id);!i||(i.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",i)),this.logger.log("launcher service @ onParticipantJoined - participant joined",i),this.publish("participant.joined",i))};this.onParticipantLeave=t=>{this.logger.log("launcher service @ onParticipantLeave");let i=this.participants.find(r=>r.id===t.data.id);!i||(i.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",i)),this.logger.log("launcher service @ onParticipantLeave - participant left",i),this.publish("participant.left",i))};this.onHostParticipantDidChange=t=>{let i=this.participants.find(r=>r.id===(t==null?void 0:t.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",i),this.publish("realtime.host-change",i))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=_t(lt({},t),{type:"guest"}),this.group=i,this.logger=new qt("@superviz/sdk/launcher"),this.realtime=new xr(Tt.get("apiUrl"),Tt.get("ablyKey")),this.eventBus=new Lo,this.logger.log("launcher created"),this.startRealtime()}},Qp=s=>{let e=new qu(s);return{destroy:e.destroy,subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}};var ES=({group:s,participant:e,roomId:t,customColors:i})=>{if(i&&AS(i),!s||!s.name||!s.id)throw new Error("Group fields is required");if(!e||!e.id||!e.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},AS=s=>{Object.entries(s).forEach(([e,t])=>{if(!Object.values(Wu).includes(e))throw new Error(`Color ${e} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(t))throw new Error(`Color ${e} is not a valid color variable value. Please check the documentation for more information.`)})},TS=(s,e)=>Lt(void 0,null,function*(){var b;if(!(s&&s.trim()))throw new Error("API key is required");if(!e)throw new Error("Options is required");ES(e),e.debug?Zu.debug.enable("*"):Zu.debug.disable();let{apiUrl:i,conferenceLayerUrl:r}=yield Pr.getRemoteConfig(e.environment);if(!(yield zp(i,s)))throw new Error("Failed to validate API key");let[l,u,c]=yield Promise.all([me.fetchConfig(i,s),me.fetchLimits(i,s),me.fetchWaterMark(i,s)]).catch(()=>{throw new Error("Failed to load configuration from server")});if(!l||!l.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:m}=l,{participant:v,roomId:E}=e;if(yield me.validadeParticipantIsEnteringTwice(v,E,s,m))throw new Error("Participant is already in the room");return Tt.setConfig({apiUrl:i,ablyKey:m,apiKey:s,conferenceLayerUrl:r,environment:l,roomId:e.roomId,debug:e.debug,limits:u,waterMark:c,colors:e.customColors}),me.createOrUpdateParticipant({name:v.name,participantId:v.id,avatar:(b=v.avatar)==null?void 0:b.imageUrl}),Qp(e)}),Yu=TS;D();D();D();D();D();var wa=globalThis,xa=wa.ShadowRoot&&(wa.ShadyCSS===void 0||wa.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,tm=Symbol(),Xp=new WeakMap,Pa=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==tm)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(xa&&e===void 0){let i=t!==void 0&&t.length===1;i&&(e=Xp.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&Xp.set(t,e))}return e}toString(){return this.cssText}},em=s=>new Pa(typeof s=="string"?s:s+"",void 0,tm);var Qu=(s,e)=>{if(xa)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let i=document.createElement("style"),r=wa.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=t.cssText,s.appendChild(i)}},Ia=xa?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return em(t)})(s):s;var{is:OS,defineProperty:CS,getOwnPropertyDescriptor:SS,getOwnPropertyNames:wS,getOwnPropertySymbols:PS,getPrototypeOf:xS}=Object,ii=globalThis,nm=ii.trustedTypes,IS=nm?nm.emptyScript:"",Xu=ii.reactiveElementPolyfillSupport,No=(s,e)=>s,Ma={toAttribute(s,e){switch(e){case Boolean:s=s?IS:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(i){t=null}}return t}},tc=(s,e)=>!OS(s,e),im={attribute:!0,type:String,converter:Ma,reflect:!1,hasChanged:tc},rm,om;(rm=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(om=ii.litPropertyMetadata)!=null||(ii.litPropertyMetadata=new WeakMap);var wi=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=im){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let i=Symbol(),r=this.getPropertyDescriptor(e,i,t);r!==void 0&&CS(this.prototype,e,r)}}static getPropertyDescriptor(e,t,i){var l;let{get:r,set:a}=(l=SS(this.prototype,e))!=null?l:{get(){return this[t]},set(u){this[t]=u}};return{get(){return r==null?void 0:r.call(this)},set(u){let c=r==null?void 0:r.call(this);a.call(this,u),this.requestUpdate(e,c,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:im}static _$Ei(){if(this.hasOwnProperty(No("elementProperties")))return;let e=xS(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(No("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(No("properties"))){let t=this.properties,i=[...wS(t),...PS(t)];for(let r of i)this.createProperty(r,t[r])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[i,r]of t)this.elementProperties.set(i,r)}this._$Eh=new Map;for(let[t,i]of this.elementProperties){let r=this._$Eu(t,i);r!==void 0&&this._$Eh.set(r,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let r of i)t.unshift(Ia(r))}else e!==void 0&&t.push(Ia(e));return t}static _$Eu(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,i;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)==null||i.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return Qu(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(i=>{var r;return(r=i.hostConnected)==null?void 0:r.call(i)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var i;return(i=t.hostDisconnected)==null?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t){var a;let i=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,i);if(r!==void 0&&i.reflect===!0){let l=(((a=i.converter)==null?void 0:a.toAttribute)!==void 0?i.converter:Ma).toAttribute(t,i.type);this._$Em=e,l==null?this.removeAttribute(r):this.setAttribute(r,l),this._$Em=null}}_$AK(e,t){var a;let i=this.constructor,r=i._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let l=i.getPropertyOptions(r),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:Ma;this._$Em=r,this[r]=u.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,i,r=!1,a){var l;if(e!==void 0){if(i!=null||(i=this.constructor.getPropertyOptions(e)),!((l=i.hasChanged)!=null?l:tc)(r?a:this[e],t))return;this.C(e,t,i)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,i){var r;this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$Em!==e&&((r=this._$Ej)!=null?r:this._$Ej=new Set).add(e)}_$EP(){return Lt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let r=this.constructor.elementProperties;if(r.size>0)for(let[a,l]of r)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(i=this._$ES)==null||i.forEach(r=>{var a;return(a=r.hostUpdate)==null?void 0:a.call(r)}),this.update(t)):this._$ET()}catch(r){throw e=!1,this._$ET(),r}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(i=>{var r;return(r=i.hostUpdated)==null?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},sm;wi.elementStyles=[],wi.shadowRootOptions={mode:"open"},wi[No("elementProperties")]=new Map,wi[No("finalized")]=new Map,Xu==null||Xu({ReactiveElement:wi}),((sm=ii.reactiveElementVersions)!=null?sm:ii.reactiveElementVersions=[]).push("2.0.0");D();var Uo=globalThis,Ra=Uo.trustedTypes,am=Ra?Ra.createPolicy("lit-html",{createHTML:s=>s}):void 0,ic="$lit$",kn=`lit$${(Math.random()+"").slice(9)}$`,rc="?"+kn,MS=`<${rc}>`,Ii=document,_a=()=>Ii.createComment(""),Bo=s=>s===null||typeof s!="object"&&typeof s!="function",pm=Array.isArray,mm=s=>pm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",ec=`[ 	
\f\r]`,Fo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,lm=/-->/g,um=/>/g,Pi=RegExp(`>|${ec}(?:([^\\s"'>=/]+)(${ec}*=${ec}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),cm=/'/g,dm=/"/g,gm=/^(?:script|style|textarea|title)$/i,vm=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),mM=vm(1),gM=vm(2),$n=Symbol.for("lit-noChange"),we=Symbol.for("lit-nothing"),fm=new WeakMap,xi=Ii.createTreeWalker(Ii,129);function ym(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return am!==void 0?am.createHTML(e):e}var bm=(s,e)=>{let t=s.length-1,i=[],r,a=e===2?"<svg>":"",l=Fo;for(let u=0;u<t;u++){let c=s[u],m,v,E=-1,h=0;for(;h<c.length&&(l.lastIndex=h,v=l.exec(c),v!==null);)h=l.lastIndex,l===Fo?v[1]==="!--"?l=lm:v[1]!==void 0?l=um:v[2]!==void 0?(gm.test(v[2])&&(r=RegExp("</"+v[2],"g")),l=Pi):v[3]!==void 0&&(l=Pi):l===Pi?v[0]===">"?(l=r!=null?r:Fo,E=-1):v[1]===void 0?E=-2:(E=l.lastIndex-v[2].length,m=v[1],l=v[3]===void 0?Pi:v[3]==='"'?dm:cm):l===dm||l===cm?l=Pi:l===lm||l===um?l=Fo:(l=Pi,r=void 0);let b=l===Pi&&s[u+1].startsWith("/>")?" ":"";a+=l===Fo?c+MS:E>=0?(i.push(m),c.slice(0,E)+ic+c.slice(E)+kn+b):c+kn+(E===-2?u:b)}return[ym(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),i]},Mi=class{constructor({strings:e,_$litType$:t},i){let r;this.parts=[];let a=0,l=0,u=e.length-1,c=this.parts,[m,v]=bm(e,t);if(this.el=Mi.createElement(m,i),xi.currentNode=this.el.content,t===2){let E=this.el.content.firstChild;E.replaceWith(...E.childNodes)}for(;(r=xi.nextNode())!==null&&c.length<u;){if(r.nodeType===1){if(r.hasAttributes())for(let E of r.getAttributeNames())if(E.endsWith(ic)){let h=v[l++],b=r.getAttribute(E).split(kn),w=/([.?@])?(.*)/.exec(h);c.push({type:1,index:a,name:w[2],strings:b,ctor:w[1]==="."?Da:w[1]==="?"?Na:w[1]==="@"?Fa:Li}),r.removeAttribute(E)}else E.startsWith(kn)&&(c.push({type:6,index:a}),r.removeAttribute(E));if(gm.test(r.tagName)){let E=r.textContent.split(kn),h=E.length-1;if(h>0){r.textContent=Ra?Ra.emptyScript:"";for(let b=0;b<h;b++)r.append(E[b],_a()),xi.nextNode(),c.push({type:2,index:++a});r.append(E[h],_a())}}}else if(r.nodeType===8)if(r.data===rc)c.push({type:2,index:a});else{let E=-1;for(;(E=r.data.indexOf(kn,E+1))!==-1;)c.push({type:7,index:a}),E+=kn.length-1}a++}}static createElement(e,t){let i=Ii.createElement("template");return i.innerHTML=e,i}};function Ri(s,e,t=s,i){var l,u,c;if(e===$n)return e;let r=i!==void 0?(l=t._$Co)==null?void 0:l[i]:t._$Cl,a=Bo(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==a&&((u=r==null?void 0:r._$AO)==null||u.call(r,!1),a===void 0?r=void 0:(r=new a(s),r._$AT(s,t,i)),i!==void 0?((c=t._$Co)!=null?c:t._$Co=[])[i]=r:t._$Cl=r),r!==void 0&&(e=Ri(s,r._$AS(s,e.values),r,i)),e}var La=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:i}=this._$AD,r=((m=e==null?void 0:e.creationScope)!=null?m:Ii).importNode(t,!0);xi.currentNode=r;let a=xi.nextNode(),l=0,u=0,c=i[0];for(;c!==void 0;){if(l===c.index){let v;c.type===2?v=new _i(a,a.nextSibling,this,e):c.type===1?v=new c.ctor(a,c.name,c.strings,this,e):c.type===6&&(v=new Ua(a,this,e)),this._$AV.push(v),c=i[++u]}l!==(c==null?void 0:c.index)&&(a=xi.nextNode(),l++)}return xi.currentNode=Ii,r}p(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},_i=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,i,r){var a;this.type=2,this._$AH=we,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=r,this._$Cv=(a=r==null?void 0:r.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ri(this,e,t),Bo(e)?e===we||e==null||e===""?(this._$AH!==we&&this._$AR(),this._$AH=we):e!==this._$AH&&e!==$n&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):mm(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==we&&Bo(this._$AH)?this._$AA.nextSibling.data=e:this.$(Ii.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:i}=e,r=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=Mi.createElement(ym(i.h,i.h[0]),this.options)),i);if(((a=this._$AH)==null?void 0:a._$AD)===r)this._$AH.p(t);else{let l=new La(r,this),u=l.u(this.options);l.p(t),this.$(u),this._$AH=l}}_$AC(e){let t=fm.get(e.strings);return t===void 0&&fm.set(e.strings,t=new Mi(e)),t}T(e){pm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,r=0;for(let a of e)r===t.length?t.push(i=new _i(this.k(_a()),this.k(_a()),this,this.options)):i=t[r],i._$AI(a),r++;r<t.length&&(this._$AR(i&&i._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Li=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,r,a){this.type=1,this._$AH=we,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=a,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=we}_$AI(e,t=this,i,r){let a=this.strings,l=!1;if(a===void 0)e=Ri(this,e,t,0),l=!Bo(e)||e!==this._$AH&&e!==$n,l&&(this._$AH=e);else{let u=e,c,m;for(e=a[0],c=0;c<a.length-1;c++)m=Ri(this,u[i+c],t,c),m===$n&&(m=this._$AH[c]),l||(l=!Bo(m)||m!==this._$AH[c]),m===we?e=we:e!==we&&(e+=(m!=null?m:"")+a[c+1]),this._$AH[c]=m}l&&!r&&this.j(e)}j(e){e===we?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},Da=class extends Li{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===we?void 0:e}},Na=class extends Li{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==we)}},Fa=class extends Li{constructor(e,t,i,r,a){super(e,t,i,r,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Ri(this,e,t,0))!=null?l:we)===$n)return;let i=this._$AH,r=e===we&&i!==we||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,a=e!==we&&(i===we||r);r&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;typeof this._$AH=="function"?this._$AH.call((i=(t=this.options)==null?void 0:t.host)!=null?i:this.element,e):this._$AH.handleEvent(e)}},Ua=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ri(this,e)}},Em={S:ic,A:kn,P:rc,C:1,M:bm,L:La,R:mm,V:Ri,D:_i,I:Li,H:Na,N:Fa,U:Da,B:Ua},nc=Uo.litHtmlPolyfillSupport,hm;nc==null||nc(Mi,_i),((hm=Uo.litHtmlVersions)!=null?hm:Uo.litHtmlVersions=[]).push("3.0.0");D();D();D();var Ba=globalThis,ka=Ba.ShadowRoot&&(Ba.ShadyCSS===void 0||Ba.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,oc=Symbol(),Am=new WeakMap,ko=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==oc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(ka&&e===void 0){let i=t!==void 0&&t.length===1;i&&(e=Am.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&Am.set(t,e))}return e}toString(){return this.cssText}},Tm=s=>new ko(typeof s=="string"?s:s+"",void 0,oc),xt=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((i,r,a)=>i+(l=>{if(l._$cssResult$===!0)return l.cssText;if(typeof l=="number")return l;throw Error("Value passed to 'css' function must be a 'css' function result: "+l+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+s[a+1],s[0]);return new ko(t,s,oc)},sc=(s,e)=>{if(ka)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let i=document.createElement("style"),r=Ba.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=t.cssText,s.appendChild(i)}},$a=ka?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return Tm(t)})(s):s;var{is:RS,defineProperty:_S,getOwnPropertyDescriptor:LS,getOwnPropertyNames:DS,getOwnPropertySymbols:NS,getPrototypeOf:FS}=Object,ri=globalThis,Om=ri.trustedTypes,US=Om?Om.emptyScript:"",ac=ri.reactiveElementPolyfillSupport,$o=(s,e)=>s,lc={toAttribute(s,e){switch(e){case Boolean:s=s?US:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(i){t=null}}return t}},xm=(s,e)=>!RS(s,e),Cm={attribute:!0,type:String,converter:lc,reflect:!1,hasChanged:xm},Sm,wm;(Sm=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(wm=ri.litPropertyMetadata)!=null||(ri.litPropertyMetadata=new WeakMap);var Hn=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Cm){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let i=Symbol(),r=this.getPropertyDescriptor(e,i,t);r!==void 0&&_S(this.prototype,e,r)}}static getPropertyDescriptor(e,t,i){var l;let{get:r,set:a}=(l=LS(this.prototype,e))!=null?l:{get(){return this[t]},set(u){this[t]=u}};return{get(){return r==null?void 0:r.call(this)},set(u){let c=r==null?void 0:r.call(this);a.call(this,u),this.requestUpdate(e,c,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:Cm}static _$Ei(){if(this.hasOwnProperty($o("elementProperties")))return;let e=FS(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty($o("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty($o("properties"))){let t=this.properties,i=[...DS(t),...NS(t)];for(let r of i)this.createProperty(r,t[r])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[i,r]of t)this.elementProperties.set(i,r)}this._$Eh=new Map;for(let[t,i]of this.elementProperties){let r=this._$Eu(t,i);r!==void 0&&this._$Eh.set(r,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let r of i)t.unshift($a(r))}else e!==void 0&&t.push($a(e));return t}static _$Eu(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,i;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)==null||i.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return sc(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(i=>{var r;return(r=i.hostConnected)==null?void 0:r.call(i)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var i;return(i=t.hostDisconnected)==null?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t){var a;let i=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,i);if(r!==void 0&&i.reflect===!0){let l=(((a=i.converter)==null?void 0:a.toAttribute)!==void 0?i.converter:lc).toAttribute(t,i.type);this._$Em=e,l==null?this.removeAttribute(r):this.setAttribute(r,l),this._$Em=null}}_$AK(e,t){var a;let i=this.constructor,r=i._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let l=i.getPropertyOptions(r),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:lc;this._$Em=r,this[r]=u.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,i,r=!1,a){var l;if(e!==void 0){if(i!=null||(i=this.constructor.getPropertyOptions(e)),!((l=i.hasChanged)!=null?l:xm)(r?a:this[e],t))return;this.C(e,t,i)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,i){var r;this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$Em!==e&&((r=this._$Ej)!=null?r:this._$Ej=new Set).add(e)}_$EP(){return Lt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let r=this.constructor.elementProperties;if(r.size>0)for(let[a,l]of r)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(i=this._$ES)==null||i.forEach(r=>{var a;return(a=r.hostUpdate)==null?void 0:a.call(r)}),this.update(t)):this._$ET()}catch(r){throw e=!1,this._$ET(),r}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(i=>{var r;return(r=i.hostUpdated)==null?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},Pm;Hn.elementStyles=[],Hn.shadowRootOptions={mode:"open"},Hn[$o("elementProperties")]=new Map,Hn[$o("finalized")]=new Map,ac==null||ac({ReactiveElement:Hn}),((Pm=ri.reactiveElementVersions)!=null?Pm:ri.reactiveElementVersions=[]).push("2.0.0");D();var Go=globalThis,Ha=Go.trustedTypes,Im=Ha?Ha.createPolicy("lit-html",{createHTML:s=>s}):void 0,Fm="$lit$",oi=`lit$${(Math.random()+"").slice(9)}$`,Um="?"+oi,BS=`<${Um}>`,Fi=document,Wo=()=>Fi.createComment(""),zo=s=>s===null||typeof s!="object"&&typeof s!="function",Bm=Array.isArray,kS=s=>Bm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",uc=`[ 	
\f\r]`,Ho=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Mm=/-->/g,Rm=/>/g,Di=RegExp(`>|${uc}(?:([^\\s"'>=/]+)(${uc}*=${uc}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),_m=/'/g,Lm=/"/g,km=/^(?:script|style|textarea|title)$/i,$m=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),ft=$m(1),TM=$m(2),Ui=Symbol.for("lit-noChange"),Pe=Symbol.for("lit-nothing"),Dm=new WeakMap,Ni=Fi.createTreeWalker(Fi,129);function Hm(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Im!==void 0?Im.createHTML(e):e}var $S=(s,e)=>{let t=s.length-1,i=[],r,a=e===2?"<svg>":"",l=Ho;for(let u=0;u<t;u++){let c=s[u],m,v,E=-1,h=0;for(;h<c.length&&(l.lastIndex=h,v=l.exec(c),v!==null);)h=l.lastIndex,l===Ho?v[1]==="!--"?l=Mm:v[1]!==void 0?l=Rm:v[2]!==void 0?(km.test(v[2])&&(r=RegExp("</"+v[2],"g")),l=Di):v[3]!==void 0&&(l=Di):l===Di?v[0]===">"?(l=r!=null?r:Ho,E=-1):v[1]===void 0?E=-2:(E=l.lastIndex-v[2].length,m=v[1],l=v[3]===void 0?Di:v[3]==='"'?Lm:_m):l===Lm||l===_m?l=Di:l===Mm||l===Rm?l=Ho:(l=Di,r=void 0);let b=l===Di&&s[u+1].startsWith("/>")?" ":"";a+=l===Ho?c+BS:E>=0?(i.push(m),c.slice(0,E)+Fm+c.slice(E)+oi+b):c+oi+(E===-2?u:b)}return[Hm(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),i]},Bi=class{constructor({strings:e,_$litType$:t},i){let r;this.parts=[];let a=0,l=0,u=e.length-1,c=this.parts,[m,v]=$S(e,t);if(this.el=Bi.createElement(m,i),Ni.currentNode=this.el.content,t===2){let E=this.el.content.firstChild;E.replaceWith(...E.childNodes)}for(;(r=Ni.nextNode())!==null&&c.length<u;){if(r.nodeType===1){if(r.hasAttributes())for(let E of r.getAttributeNames())if(E.endsWith(Fm)){let h=v[l++],b=r.getAttribute(E).split(oi),w=/([.?@])?(.*)/.exec(h);c.push({type:1,index:a,name:w[2],strings:b,ctor:w[1]==="."?fc:w[1]==="?"?hc:w[1]==="@"?pc:Mr}),r.removeAttribute(E)}else E.startsWith(oi)&&(c.push({type:6,index:a}),r.removeAttribute(E));if(km.test(r.tagName)){let E=r.textContent.split(oi),h=E.length-1;if(h>0){r.textContent=Ha?Ha.emptyScript:"";for(let b=0;b<h;b++)r.append(E[b],Wo()),Ni.nextNode(),c.push({type:2,index:++a});r.append(E[h],Wo())}}}else if(r.nodeType===8)if(r.data===Um)c.push({type:2,index:a});else{let E=-1;for(;(E=r.data.indexOf(oi,E+1))!==-1;)c.push({type:7,index:a}),E+=oi.length-1}a++}}static createElement(e,t){let i=Fi.createElement("template");return i.innerHTML=e,i}};function Ir(s,e,t=s,i){var l,u,c;if(e===Ui)return e;let r=i!==void 0?(l=t._$Co)==null?void 0:l[i]:t._$Cl,a=zo(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==a&&((u=r==null?void 0:r._$AO)==null||u.call(r,!1),a===void 0?r=void 0:(r=new a(s),r._$AT(s,t,i)),i!==void 0?((c=t._$Co)!=null?c:t._$Co=[])[i]=r:t._$Cl=r),r!==void 0&&(e=Ir(s,r._$AS(s,e.values),r,i)),e}var dc=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:i}=this._$AD,r=((m=e==null?void 0:e.creationScope)!=null?m:Fi).importNode(t,!0);Ni.currentNode=r;let a=Ni.nextNode(),l=0,u=0,c=i[0];for(;c!==void 0;){if(l===c.index){let v;c.type===2?v=new ki(a,a.nextSibling,this,e):c.type===1?v=new c.ctor(a,c.name,c.strings,this,e):c.type===6&&(v=new mc(a,this,e)),this._$AV.push(v),c=i[++u]}l!==(c==null?void 0:c.index)&&(a=Ni.nextNode(),l++)}return Ni.currentNode=Fi,r}p(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},ki=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,i,r){var a;this.type=2,this._$AH=Pe,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=r,this._$Cv=(a=r==null?void 0:r.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ir(this,e,t),zo(e)?e===Pe||e==null||e===""?(this._$AH!==Pe&&this._$AR(),this._$AH=Pe):e!==this._$AH&&e!==Ui&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):kS(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Pe&&zo(this._$AH)?this._$AA.nextSibling.data=e:this.$(Fi.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:i}=e,r=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=Bi.createElement(Hm(i.h,i.h[0]),this.options)),i);if(((a=this._$AH)==null?void 0:a._$AD)===r)this._$AH.p(t);else{let l=new dc(r,this),u=l.u(this.options);l.p(t),this.$(u),this._$AH=l}}_$AC(e){let t=Dm.get(e.strings);return t===void 0&&Dm.set(e.strings,t=new Bi(e)),t}T(e){Bm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,r=0;for(let a of e)r===t.length?t.push(i=new ki(this.k(Wo()),this.k(Wo()),this,this.options)):i=t[r],i._$AI(a),r++;r<t.length&&(this._$AR(i&&i._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Mr=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,r,a){this.type=1,this._$AH=Pe,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=a,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Pe}_$AI(e,t=this,i,r){let a=this.strings,l=!1;if(a===void 0)e=Ir(this,e,t,0),l=!zo(e)||e!==this._$AH&&e!==Ui,l&&(this._$AH=e);else{let u=e,c,m;for(e=a[0],c=0;c<a.length-1;c++)m=Ir(this,u[i+c],t,c),m===Ui&&(m=this._$AH[c]),l||(l=!zo(m)||m!==this._$AH[c]),m===Pe?e=Pe:e!==Pe&&(e+=(m!=null?m:"")+a[c+1]),this._$AH[c]=m}l&&!r&&this.j(e)}j(e){e===Pe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},fc=class extends Mr{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Pe?void 0:e}},hc=class extends Mr{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Pe)}},pc=class extends Mr{constructor(e,t,i,r,a){super(e,t,i,r,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Ir(this,e,t,0))!=null?l:Pe)===Ui)return;let i=this._$AH,r=e===Pe&&i!==Pe||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,a=e!==Pe&&(i===Pe||r);r&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;typeof this._$AH=="function"?this._$AH.call((i=(t=this.options)==null?void 0:t.host)!=null?i:this.element,e):this._$AH.handleEvent(e)}},mc=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ir(this,e)}};var cc=Go.litHtmlPolyfillSupport,Nm;cc==null||cc(Bi,ki),((Nm=Go.litHtmlVersions)!=null?Nm:Go.litHtmlVersions=[]).push("3.0.0");var Gm=(s,e,t)=>{var a,l;let i=(a=t==null?void 0:t.renderBefore)!=null?a:e,r=i._$litPart$;if(r===void 0){let u=(l=t==null?void 0:t.renderBefore)!=null?l:null;i._$litPart$=r=new ki(e.insertBefore(Wo(),u),u,void 0,t!=null?t:{})}return r._$AI(s),r};var It=class extends Hn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,i;let e=super.createRenderRoot();return(i=(t=this.renderOptions).renderBefore)!=null||(t.renderBefore=e.firstChild),e}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Gm(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Ui}},Wm;It._$litElement$=!0,It["finalized"]=!0,(Wm=globalThis.litElementHydrateSupport)==null||Wm.call(globalThis,{LitElement:It});var gc=globalThis.litElementPolyfillSupport;gc==null||gc({LitElement:It});var zm;((zm=globalThis.litElementVersions)!=null?zm:globalThis.litElementVersions=[]).push("4.0.0");D();D();D();var Ht=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};D();D();D();D();D();D();D();D();D();var $i=class extends It{render(){return ft` <div>Hello from SuperViz, ${this.name}</div> `}};$i.properties={name:{type:String}},$i.styles=xt`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,$i=$t([Ht("superviz-hello-world")],$i);D();D();D();D();var vc=xt`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;D();var yc=xt`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;D();var bc=xt`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;D();var Ec=xt`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }

  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }
`;var Wt=s=>{var t;class e extends s{connectedCallback(){setTimeout(()=>{var u,c;let r=document.getElementById("superviz-style"),a=this.createCustomColors(),l=document.createElement("style");l.innerHTML=(r==null?void 0:r.innerHTML)||"",(u=this.shadowRoot)==null||u.appendChild(l),a&&((c=this.shadowRoot)==null||c.appendChild(a))}),super.connectedCallback()}createCustomColors(){if(!Tt.get("colors"))return;let r=document.createElement("style"),a=Object.entries(Tt.get("colors")).map(([l,u])=>`--${l}: ${u} !important;`).join(" ");return r.innerHTML=`
      * {
        ${a}
      }
    `,r}emitEvent(r,a,l={composed:!0,bubbles:!0}){let u=new CustomEvent(r,lt({detail:a},l));this.dispatchEvent(u)}}return e.styles=[vc,yc,bc,Ec,(t=s.styles)!=null?t:[]],e};D();var Ac=(a=>(a[a.xs=14]="xs",a[a.sm=18]="sm",a[a.md=24]="md",a[a.lg=36]="lg",a[a.xl=44]="xl",a))(Ac||{});var Vm=Wt(It),HS=[Vm.styles],Hi=class extends Vm{constructor(){super();this.name="",this.size="md"}get iconSize(){if(!!this.allowSetSize)return Ac[this.size]}render(){return ft`
      <i
        class="sv-icon sv-icon-${this.name}_${this.size}"
        style="font-size: ${this.iconSize}px"
      ></i>
    `}};Hi.properties={name:{type:String},size:{type:String},allowSetSize:{type:Boolean}},Hi.styles=[HS,xt`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }
    `],Hi=$t([Ht("superviz-icon")],Hi);D();D();D();D();var Wa={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},za=s=>(...e)=>({_$litDirective$:s,values:e}),Rr=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var ee=za(class extends Rr{constructor(s){var e;if(super(s),s.type!==Wa.ATTRIBUTE||s.name!=="class"||((e=s.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){var i,r;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(a=>a!=="")));for(let a in e)e[a]&&!((i=this.st)!=null&&i.has(a))&&this.it.add(a);return this.render(e)}let t=s.element.classList;for(let a of this.it)a in e||(t.remove(a),this.it.delete(a));for(let a in e){let l=!!e[a];l===this.it.has(a)||((r=this.st)==null?void 0:r.has(a))||(l?(t.add(a),this.it.add(a)):(t.remove(a),this.it.delete(a)))}return $n}});D();var jm=xt`
  .dropdown {
    position: relative;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
    z-index: 20;
  }

  .header {
    display: grid;
    grid-template-rows: 41px 1px;
    align-items: center;
    padding: 0 10px;
    height: 42px;
    font-size: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .items {
    list-style: none;
    padding: 0;
    color: #9fa5b5;
    margin: 0;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    right: 0;
    top: 4px;
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 4px;
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    left: 0;
    top: 4px;
  }

  .menu--top-left {
    min-width: 103px;
    position: absolute;
    right: 0;
    bottom: 44px;
  }

  .menu--top-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 44px;
  }

  .menu--top-right {
    min-width: 103px;
    position: absolute;
    left: 0;
    bottom: 44px;
  }

  .text.username {
    font-size: 14px;
    text-align: center;

    display: inline-block;
    vertical-align: middle;
    line-height: normal;
  }

  .items li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 0 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
    height: 42px;
  }

  .sv-icon {
    width: 40px;
    height: 40px;
    background-color: red;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .items li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
    justify-self: flex-end;
  }

  .option-label {
    white-space: nowrap;
  }

  @media (max-width: 780px) {
    .menu--top-left,
    .menu--top-center,
    .menu--top-right {
      bottom: 36px;
    }
  }
`;D();var Jm=Wt(It),GS=[Jm.styles,jm],Gi=class extends Jm{constructor(){super();this.menu=void 0;this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let i=t.composedPath(),r=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],c=i.includes(r),m=i.includes(a),v=i.includes(u);c||m||v||this.close()};this.close=()=>{this.open=!1,this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let i=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",i,{bubbles:!1,composed:!0})};this.adjustPosition=()=>{this.adjustPositionVertical(),this.adjustPositionHorizontal()};this.tooltip=()=>this.canShowTooltip?ft` <superviz-tooltip
      tooltipData=${JSON.stringify(this.onHoverData)}
      ?shiftTooltipLeft=${this.shiftTooltipLeft}
    ></superviz-tooltip>`:"";this.showTooltip=!1}disconnectedCallback(){var i;super.disconnectedCallback(),document.removeEventListener("click",this.onClickOutDropdown);let t=this.shadowRoot.querySelector(".dropdown");t==null||t.removeEventListener("mouseenter",()=>{this.showTooltip=!0}),t==null||t.removeEventListener("mouseleave",()=>{this.showTooltip=!1}),(i=this.dropdownResizeObserver)==null||i.disconnect()}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:this.name},{bubbles:!1,composed:!1}),this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown)}}get dropdownBounds(){this.dropdownContent||(this.dropdownContent=this.shadowRoot.querySelector(".dropdown-content"));let t=this.dropdownContent.getBoundingClientRect(),{y:i,height:r,x:a,width:l}=this.menu.getBoundingClientRect();return{top:i,bottom:i+r+4,left:a,right:a+l,height:r+4,width:l,contentX:t.x,contentY:t.y,contentWidth:t.width}}positionVerticalAction(){let{top:t,bottom:i}=this.dropdownBounds,{innerHeight:r}=window,a=i>r,l=t<0;return a&&this.position.includes("bottom")||l&&this.position.includes("top")?2:!a&&!l&&this.shouldUseOriginalVertical()?1:0}positionHorizontalAction(){if(this.dropdownCovered())return 0;let{right:t,left:i,contentX:r,contentWidth:a,width:l}=this.dropdownBounds,{innerWidth:u}=window,c=t>u,v=i<0||c;if(v&&!this.position.includes("center"))return 2;if(this.position.includes("center")){let E=r+a/2,h=E-l/2<0,b=E+l/2>u;if(h||b)return 2}return!v&&this.shouldUseOriginalHorizontal()?1:this.shouldCenter()&&this.position!==this.originalPosition&&!this.position.includes("center")?3:0}dropdownCovered(){let{left:t,right:i}=this.dropdownBounds,{innerWidth:r}=window;if(this.position.includes("center"))return!1;let a=i>r&&this.position.includes("left"),l=t<0&&this.position.includes("right");return a||l}shouldCenter(){let{contentX:t,contentWidth:i,width:r}=this.dropdownBounds,a=t+i/2,l=a-r/2<0,u=a+r/2>window.innerWidth;return!(l||u)}shouldUseOriginalVertical(){let{height:t,contentY:i}=this.dropdownBounds,{innerHeight:r}=window,a=i+t;return this.originalPosition.includes("bottom")?t+a<r:i-t>0}shouldUseOriginalHorizontal(){let{width:t,contentX:i}=this.dropdownBounds,{innerWidth:r}=window,a=i+t;return this.position===this.originalPosition?!1:this.originalPosition.includes("center")?a<r&&i-t>0:this.originalPosition.includes("left")?i-t>0:a<r}adjustPositionVertical(){let{top:t,bottom:i}=this.dropdownBounds,{innerHeight:r}=window,a=this.positionVerticalAction();if(a===0)return;if(a===1){let m=this.originalPosition.split("-")[0];this.position=this.position.replace(/top|bottom/,m);return}let l=r-i>t?"bottom":"top",u=this.position.split("-")[0],c=this.position.replace(u,l);this.position=c}adjustPositionHorizontal(){let{left:t,right:i,width:r}=this.dropdownBounds,a=t<0,l=i>window.innerWidth,u=this.positionHorizontalAction();if(u===0)return;if(u===1){let w=this.originalPosition.split("-")[1];this.position=this.position.replace(/left|center|right/,w);return}let c=a?i:t,m=(a?r:-r)/2-20,v=c+m;if(a=v<0,l=v+r>window.innerWidth,!(a||l)&&u===3||u===3){let w=this.position.replace(/left|right/,"center");this.position=w;return}if(this.position.includes("center")){let w=a?"right":"left",P=this.position.replace("center",w);this.position=P;return}let b=this.position.replace(/left|right/,"center");this.position=b}setMenu(){var t;if(!this.menu){this.menu=this.shadowRoot.querySelector(".menu");let i={rootMargin:"0px",threshold:1},r=new IntersectionObserver(this.adjustPosition,i);this.dropdownResizeObserver=new ResizeObserver(this.adjustPosition);let a=this.menu;r.observe(a),this.dropdownResizeObserver.observe((t=this.scrollableParent)!=null?t:document.body)}}get scrollableParent(){let t;this.host||(this.host=this.getRootNode().host);let i=this.host;for(;!t;){let r=i==null?void 0:i.parentElement;if(this.isScrollable(r)){t=r;break}if(i=r,!i)break}return t}isScrollable(t){if(!t)return!1;let i=t.scrollHeight>t.clientHeight,r=window.getComputedStyle(t).overflowY,a=window.getComputedStyle(t).overflowX,l=r.indexOf("hidden")!==-1,u=a.indexOf("hidden")!==-1;return i&&!l&&!u}get renderHeader(){return this.name?ft` <div class="header">
      <span class="text username">${this.name}</span>
      <span class="sv-hr"></span>
    </div>`:ft``}toggle(){this.disabled||(this.originalPosition||(this.originalPosition=this.position),this.setMenu(),this.open=!this.open,this.emitEvent("open",{open:this.open}),this.open&&setTimeout(()=>this.adjustPosition()))}get supervizIcons(){var t;return(t=this.icons)==null?void 0:t.map(i=>ft`<superviz-icon allowSetSize=${!0} name="${i}" size="sm"></superviz-icon>`)}get listOptions(){return this.options.map((t,i)=>{var a;let r={text:!0,"text-bold":!0,active:(t==null?void 0:t[this.returnTo])&&this.active===(t==null?void 0:t[this.returnTo])};return ft`<li @click=${()=>this.callbackSelected(t)} class=${ee(r)}>
        ${(a=this.supervizIcons)==null?void 0:a.at(i)} <span class="option-label">${t[this.label]}</span>
      </li>`})}render(){let t={menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu--top-left":this.position==="top-left","menu--top-center":this.position==="top-center","menu--top-right":this.position==="top-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right","who-is-online-dropdown":this.name};return ft`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${ee(t)}>
          ${this.renderHeader}
          <ul class="items">
            ${this.listOptions}
          </ul>
        </div>
      </div>
    `}};Gi.styles=GS,Gi.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},position:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]},icons:{type:Array},name:{type:String},onHoverData:{type:Object},showTooltip:{type:Boolean},dropdown:{type:Object},canShowTooltip:{type:Boolean},drodpdownSizes:{type:Object},shiftTooltipLeft:{type:Boolean}},Gi=$t([Ht("superviz-dropdown")],Gi);D();D();var Km=xt`
  .superviz-who-is-online__tooltip {
    --host-height: 0px;
    --host-width: 0px;
    --vertical-offset: 12px;

    background-color: rgb(var(--sv-gray-600));
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    border-radius: 2px;
    cursor: default;
    display: none;
    transition: opacity 0.2s ease-in-out display 0s;
    overflow-x: clip;
    z-index: 100;
  }

  .tooltip-extras {
    left: 29px;
    top: 60px;
    z-index: 10;
  }

  .superviz-who-is-online__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    background-color: rgb(var(--sv-gray-600));
    transform: rotate(45deg);
    border-top-left-radius: 3px;
    border-bottom-right-radius: 3px;
  }

  .show-tooltip {
    opacity: 1;
    display: block;
  }

  .tooltip-name,
  .tooltip-action {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
  }

  .tooltip-name {
    color: white;
    font-size: 14px;
  }

  .tooltip-action {
    color: rgb(var(--sv-gray-400));
    font-size: 12px;
  }

  .tooltip-top {
    top: auto;
    bottom: calc(var(--host-height) + var(--vertical-offset));
  }

  .tooltip-bottom {
    top: calc(var(--host-height) + var(--vertical-offset));
    bottom: auto;
  }

  .tooltip-left {
    translate: -50% 0;
  }

  .tooltip-center {
    left: 50%;
    transform: translateX(-50%);
    right: auto;
  }

  .tooltip-right {
    translate: 50% 0;
  }

  .tooltip-bottom .superviz-who-is-online__tooltip-arrow {
    top: -6.5px;
  }

  .tooltip-top .superviz-who-is-online__tooltip-arrow {
    bottom: -6.5px;
  }

  .tooltip-center .superviz-who-is-online__tooltip-arrow {
    left: 0;
    margin-left: 50%;
    translate: -50% 0;
  }

  .tooltip-left .superviz-who-is-online__tooltip-arrow {
    translate: 50% 0;
    border-radius: 0;
    right: 0;
  }

  .tooltip-right .superviz-who-is-online__tooltip-arrow {
    translate: -100% 0;
    border-radius: 0;
  }

  .shift-left {
    left: 0;
    transform: translateX(-22%);
    --vertical-offset: 2px;
  }

  @media (max-width: 780px) {
    .tooltip-extras {
      top: 52px;
      left: 25px;
    }
  }
`;D();var qm=Wt(It),WS=[qm.styles,Km],Wi=class extends qm{constructor(){super();this.hide=()=>{this.showTooltip=!1};this.show=()=>{this.showTooltip=!0};this.adjustTooltipVerticalPosition=()=>{let{bottom:t,top:i}=this.tooltip.getBoundingClientRect(),r=window.innerHeight;this.tooltipVerticalPosition.includes("top")&&i<0&&(this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("top","bottom")),this.tooltipVerticalPosition.includes("bottom")&&t>r&&(this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("bottom","top"))};this.adjustTooltipHorizontalPosition=()=>{let{left:t,right:i}=this.tooltip.getBoundingClientRect(),r=window.innerWidth;t<0&&(this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","right")),i>r&&(this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","left"))};this.adjustTooltipPosition=()=>{this.tooltip||(this.tooltip=this.shadowRoot.querySelector(".superviz-who-is-online__tooltip")),this.adjustTooltipVerticalPosition(),this.adjustTooltipHorizontalPosition()};this.tooltipVerticalPosition="tooltip-bottom",this.tooltipHorizontalPosition="tooltip-center",this.showTooltip=!1,this.parentSizes={height:0,width:0}}firstUpdated(t){let{parentElement:i}=this;i==null||i.addEventListener("mouseenter",this.show),i==null||i.addEventListener("mouseleave",this.hide),this.tooltipVerticalPosition="tooltip-bottom",this.tooltipHorizontalPosition="tooltip-center"}disconnectedCallback(){super.disconnectedCallback();let{parentElement:t}=this;t==null||t.removeEventListener("mouseenter",this.show),t==null||t.removeEventListener("mouseleave",this.hide)}updated(t){if(t.has("showTooltip")&&this.showTooltip){let{parentElement:i}=this;if(!i)return;let{height:r,width:a}=i.getBoundingClientRect();(this.parentSizes.height!==r||this.parentSizes.width!==a)&&(this.parentSizes={height:r,width:a})}}renderTooltip(){var a,l,u,c;setTimeout(()=>this.adjustTooltipPosition());let t=this.tooltipVerticalPosition,i=this.tooltipHorizontalPosition,r={"superviz-who-is-online__tooltip":!0,"tooltip-extras":this.tooltipOnLeft,"show-tooltip":this.showTooltip,"shift-left":this.shiftTooltipLeft};return r[t]=!0,r[i]=!0,ft`<div
      class=${ee(r)}
      style="--host-height: ${(a=this.parentSizes)==null?void 0:a.height}px; --host-width: ${(l=this.parentSizes)==null?void 0:l.width}px;"
    >
      <p class="tooltip-name">${(u=this.tooltipData)==null?void 0:u.name}</p>
      <p class="tooltip-action">${(c=this.tooltipData)==null?void 0:c.action}</p>
      <div class="superviz-who-is-online__tooltip-arrow"></div>
    </div>`}render(){return ft`${this.renderTooltip()}`}};Wi.styles=WS,Wi.properties={tooltipData:{type:Object},tooltipOnLeft:{type:Boolean},showTooltip:{type:Boolean},tooltip:{type:Object},tooltipVerticalPosition:{type:String},tooltipHorizontalPosition:{type:String},parentSizes:{type:Object},shiftTooltipLeft:{type:Boolean}},Wi=$t([Ht("superviz-tooltip")],Wi);D();D();D();var Va=xt`
  .modal--overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: rgba(var(--sv-gray-400), 0.8);

    z-index: 99;
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: transparent;

    z-index: 99;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var Zm=Wt(It),zS=[Zm.styles,Va],_r=class extends Zm{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};_r.styles=zS,_r=$t([Ht("superviz-modal")],_r);D();var Ym=Wt(It),VS=[Ym.styles,Va],Lr=class extends Ym{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>ft`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,i=()=>ft`
        <div class="modal--body">
          <div class="modal--body-content">
            ${this.options.body}
          </div>
        </div>
      `,r=()=>{if(this.options.footer)return ft`
          <div class="modal--footer">
            ${this.options.footer}
          </div>
        `;let a=this.options.confirmLabel||"OK",l=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?ft`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>${l}</button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
          </div>
        `:ft`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
        </div>
      `};return ft`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">
          ${t()}

          ${i()}

          ${r()}
        </div>
      </div>
    `}};Lr.styles=VS,Lr=$t([Ht("superviz-modal-container")],Lr);D();D();D();D();var Tc=xt`
  .container {
    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    height: 100%;

    z-index: 99;
  }

  .container-close {
    display: none;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }
`;D();var Oc=xt`
  div.topbar {
    display: flex;
    justify-content: space-between;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  div.topbar span {
    margin: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .toggle-icon {
    cursor: pointer;
    transition: 0.15s;
    border-radius: 50%;
    aspect-ratio: 1;
  }

  .toggle-icon:hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
`;D();var Cc=xt`
  .reply {
    padding-left: 24px !important;
  }

  .comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comment-item__user {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comment-item__actions superviz-dropdown,
  .comment-item__actions button {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comment-item__user-details {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comment-item__avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comment-item__avatar img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comment-item__content__body {
    color: rgb(var(--sv-gray-700));
  }

  .hidden {
    display: none;
  }
`;D();var Sc=xt`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;D();var wc=xt`
  .comment-input {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 288px;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
    position: relative;
    min-height: 40px;
    box-sizing: border-box;
  }

  .comment-input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  #comment-input--textarea {
    all: unset;
    border: 0px;
    text-align: left;
    border-radius: 4px;
    outline: none;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-y: scroll;
    resize: none;
    line-height: 1rem;
    max-height: 5rem;
    appearance: none;
    height: 40px;
    width: 100%;
    box-sizing: border-box;

    padding-top: 7px;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 11px solid transparent;
    border-left: 11px solid transparent;
  }

  #comment-input--textarea:invalid {
    border-top: 15px solid transparent;
  }

  #comment-input--textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
    line-height: 14px;
  }

  .comment-input--options {
    display: flex;
    justify-content: space-between;
    box-sizing: border-box;
    overflow: hidden;
    height: 0;
    transition: 0.25s;
  }

  .active-textarea {
    height: 40px;
    padding: 4px 8px;
  }

  .sv-hr {
    border: none;
    width: 100%;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
    height: 0;
    position: absolute;
  }

  .active-hr {
    border-top: 1px solid rgb(var(--sv-gray-300));
    opacity: 1;
    position: relative;
    visibility: visible;
  }

  .comment-actions {
    position: absolute;
    left: 8px;
    bottom: 3px;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
  }

  .active-textarea > .comment-actions {
    opacity: 1;
    visibility: visible;
  }

  .mention {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 32px;
    width: 32px;
    border-radius: 100%;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
    transition: 0.25s background-color ease-in;
  }

  .mention:hover {
    background-color: rgb(var(--sv-gray-200));
  }

  .comment-input--send-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-primary));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgba(var(--sv-white), 1);
    border: 0px;
  }

  .align-send-btn > superviz-icon {
    cursor: pointer;
  }

  .comment-input--send-btn:disabled {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-gray-200));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgb(var(--sv-gray-600));
    border: 0px;
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
    position: absolute;
    right: 8px;
    bottom: 4px;
  }

  #comment-input--textarea:focus::placeholder {
    color: transparent;
  }
`;D();var Pc=xt`
  .annotation-item--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
  }

  .annotation-item:hover:not(.annotation-item--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    padding: 8px;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  div:last-child {
    margin-left: 8px;
  }

  .comments-container {
    display: flex;
    flex-direction: column;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    display: none;
  }

  .annotation-item {
    padding: 8px;
    cursor: pointer;
  }
`;D();var xc=xt`
  .annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;D();var Ic=xt`
  .annotation-pin,
  .annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    pointer-events: auto;
    z-index: 10;
  }

  .annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: rgb(var(--sv-white));
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid rgb(var(--sv-white));
    box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.25);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    box-sizing: border-box;
    cursor: pointer;
  }

  .annotation-pin:hover,
  .annotation-pin:focus,
  .annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: rgb(var(--sv-white));
  }

  .annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;

    object-fit: contain;
  }

  .annotation-pin__avatar--add {
    color: rgb(var(--sv-gray-700));
    background-color: rgb(var(--sv-white));
  }

  .floating-input {
    position: absolute;
    top: -2px;
    opacity: 0;
  }

  .left .floating-input {
    right: auto;
    left: 0;
    transform: translateX(calc(-100% - 7px));
    opacity: 1;
  }

  .right .floating-input {
    left: auto;
    right: 0;
    transform: translateX(calc(100% + 7px));
    opacity: 1;
  }
`;D();var Mc=xt`
  .select {
    display: flex;
    width: 100%;
    justify-content: flex-start;
    align-items: center;
  }

  .select-container {
    white-space: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
`;D();var Rc=xt`
  button.float-button {
    position: fixed;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    gap: 4px;
    border: none;

    background-color: rgba(var(--sv-white));
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    transition: all 300ms;
    cursor: pointer;
    overflow: hidden;
    padding-left: 10px;

    z-index: 99;
  }

  button.float-button p {
    opacity: 0;
    transition: opacity 100ms linear;
  }

  button.float-button:hover p {
    opacity: 1;
    transition-delay: 200ms;
  }

  button.float-button:not(:hover) {
    transition-delay: 100ms;
  }

  .hide-button {
    display: none !important;
  }

  button.float-button:hover {
    width: 110px;
    border-radius: 30px;
  }
`;D();var _c=xt`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;D();var Lc;function Dc(s){let e=s.querySelector("#superviz-comments");if(e&&!Lc){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};Lc=new MutationObserver(i=>{i.forEach(r=>{!r.removedNodes.length||r.removedNodes.forEach(a=>{a.id==="poweredby-footer"&&jS(s)})})}),Lc.observe(e,t)}}function jS(s){let e=document.createElement("div");e.id="poweredby-footer",e.className="footer";let t=document.createElement("div");t.className="powered-by powered-by--horizontal";let i=document.createElement("a");i.href="https://superviz.com/",i.target="_blank",i.className="link";let r=document.createElement("div");r.textContent="Powered by";let a=document.createElement("img");a.width=48,a.height=8.86,a.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",t.appendChild(i),i.appendChild(r),r.appendChild(a),e.appendChild(t);let l=s.getElementById("superviz-comments");l&&l.appendChild(e),Dc(s)}var Qm=Wt(It),JS=[Qm.styles,Tc,_c],zi=class extends Qm{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1,this.side="left: 0px"}updateAnnotations(t){this.annotations=t}toggle(){this.emitEvent("toggle",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:i}=t;this.annotationFilter=i}updated(t){super.updated(t),this.updateComplete.then(()=>{let i=this.shadowRoot.querySelector(".superviz-comments");!i||(this.waterMarkState&&Dc(this.shadowRoot),i.setAttribute("style",this.side))})}render(){let t=[this.open?"container":"container-close","superviz-comments"].join(" "),i=ft` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`,r=this.waterMarkState?i:"";return ft`
      <div id="superviz-comments" class=${t}>
        <div class="header">
          <superviz-comments-topbar
            @close=${this.toggle}
            side=${this.side.split(":")[0]}
          ></superviz-comments-topbar>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          class="content"
        ></superviz-comments-content>
        ${r}
      </div>
    `}};zi.styles=JS,zi.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String}},zi=$t([Ht("superviz-comments")],zi);D();D();var KS=Wt(It),qS=[KS.styles,Oc],Vi=class extends Wt(It){close(){this.dispatchEvent(new CustomEvent("close"))}render(){return ft`
      <div class="topbar">
        <span class="text text-bold">COMMENTS</span>
        <span @click=${this.close} class="toggle-icon">
          <superviz-icon name=${this.side} size="lg"></superviz-icon>
        </span>
      </div>
    `}};Vi.styles=qS,Vi.properties={side:{type:String}},Vi=$t([Ht("superviz-comments-topbar")],Vi);D();D();D();D();var{D:ZS}=Em;var Xm=()=>document.createComment(""),Dr=(s,e,t)=>{var a;let i=s._$AA.parentNode,r=e===void 0?s._$AB:e._$AA;if(t===void 0){let l=i.insertBefore(Xm(),r),u=i.insertBefore(Xm(),r);t=new ZS(l,u,s,s.options)}else{let l=t._$AB.nextSibling,u=t._$AM,c=u!==s;if(c){let m;(a=t._$AQ)==null||a.call(t,s),t._$AM=s,t._$AP!==void 0&&(m=s._$AU)!==u._$AU&&t._$AP(m)}if(l!==r||c){let m=t._$AA;for(;m!==l;){let v=m.nextSibling;i.insertBefore(m,r),m=v}}}return t},si=(s,e,t=s)=>(s._$AI(e,t),s),YS={},tg=(s,e=YS)=>s._$AH=e,eg=s=>s._$AH,Ja=s=>{var i;(i=s._$AP)==null||i.call(s,!1,!0);let e=s._$AA,t=s._$AB.nextSibling;for(;e!==t;){let r=e.nextSibling;e.remove(),e=r}};var ng=(s,e,t)=>{let i=new Map;for(let r=e;r<=t;r++)i.set(s[r],r);return i},Nr=za(class extends Rr{constructor(s){if(super(s),s.type!==Wa.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let i;t===void 0?t=e:e!==void 0&&(i=e);let r=[],a=[],l=0;for(let u of s)r[l]=i?i(u,l):l,a[l]=t(u,l),l++;return{values:a,keys:r}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,i]){var P;let r=eg(s),{values:a,keys:l}=this.ht(e,t,i);if(!Array.isArray(r))return this.dt=l,a;let u=(P=this.dt)!=null?P:this.dt=[],c=[],m,v,E=0,h=r.length-1,b=0,w=a.length-1;for(;E<=h&&b<=w;)if(r[E]===null)E++;else if(r[h]===null)h--;else if(u[E]===l[b])c[b]=si(r[E],a[b]),E++,b++;else if(u[h]===l[w])c[w]=si(r[h],a[w]),h--,w--;else if(u[E]===l[w])c[w]=si(r[E],a[w]),Dr(s,c[w+1],r[E]),E++,w--;else if(u[h]===l[b])c[b]=si(r[h],a[b]),Dr(s,r[E],r[h]),h--,b++;else if(m===void 0&&(m=ng(l,b,w),v=ng(u,E,h)),m.has(u[E]))if(m.has(u[h])){let C=v.get(l[b]),O=C!==void 0?r[C]:null;if(O===null){let x=Dr(s,r[E]);si(x,a[b]),c[b]=x}else c[b]=si(O,a[b]),Dr(s,r[E],O),r[C]=null;b++}else Ja(r[h]),h--;else Ja(r[E]),E++;for(;b<=w;){let C=Dr(s,c[w+1]);si(C,a[b]),c[b++]=C}for(;E<=h;){let C=r[E++];C!==null&&Ja(C)}return this.dt=l,tg(s,c),$n}});var ig=Wt(It),QS=[ig.styles,Sc],ji=class extends ig{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:t})=>{let{uuid:i}=t;if(this.selectedAnnotation===i){this.selectedAnnotation=null;return}this.selectedAnnotation=i};this.checkLastAnnotation=t=>{var a,l;let i=this.annotations.filter(u=>u.resolved),r=this.annotations.filter(u=>!u.resolved);return this.annotationFilter==="all"?t===((a=i[i.length-1])==null?void 0:a.uuid):t===((l=r[r.length-1])==null?void 0:l.uuid)};this.annotations=[]}updated(t){super.updated(t),this.updateComplete.then(()=>{let i=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!i)return;let r=this.lastCommentId===this.selectedAnnotation,a=r?0:-150,l=i.getClientRects()[0];!l||(this.scrollBy(0,l.y+a),r&&setTimeout(()=>{this.scrollBy(0,l.y+a)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return ft` ${Nr(this.annotations.filter(t=>{var i;return(i=t.comments)==null?void 0:i.length}),t=>t.uuid,t=>ft`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(t)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${t.uuid}
          isLastComment=${this.checkLastAnnotation(t.uuid)}
        >
        </superviz-comments-annotation-item>
      `)}`}};ji.styles=QS,ji.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String}},ji=$t([Ht("superviz-comments-content")],ji);D();D();D();D();D();var Gn=class extends Error{},Ka=class extends Gn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},qa=class extends Gn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},Za=class extends Gn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},Wn=class extends Gn{},Fr=class extends Gn{constructor(e){super(`Invalid unit ${e}`)}},xe=class extends Gn{},mn=class extends Gn{constructor(){super("Zone is an abstract class")}};D();D();D();var mt="numeric",gn="short",qe="long",ai={year:mt,month:mt,day:mt},Vo={year:mt,month:gn,day:mt},Nc={year:mt,month:gn,day:mt,weekday:gn},jo={year:mt,month:qe,day:mt},Jo={year:mt,month:qe,day:mt,weekday:qe},Ko={hour:mt,minute:mt},qo={hour:mt,minute:mt,second:mt},Zo={hour:mt,minute:mt,second:mt,timeZoneName:gn},Yo={hour:mt,minute:mt,second:mt,timeZoneName:qe},Qo={hour:mt,minute:mt,hourCycle:"h23"},Xo={hour:mt,minute:mt,second:mt,hourCycle:"h23"},ts={hour:mt,minute:mt,second:mt,hourCycle:"h23",timeZoneName:gn},es={hour:mt,minute:mt,second:mt,hourCycle:"h23",timeZoneName:qe},ns={year:mt,month:mt,day:mt,hour:mt,minute:mt},is={year:mt,month:mt,day:mt,hour:mt,minute:mt,second:mt},rs={year:mt,month:gn,day:mt,hour:mt,minute:mt},os={year:mt,month:gn,day:mt,hour:mt,minute:mt,second:mt},Fc={year:mt,month:gn,day:mt,weekday:gn,hour:mt,minute:mt},ss={year:mt,month:qe,day:mt,hour:mt,minute:mt,timeZoneName:gn},as={year:mt,month:qe,day:mt,hour:mt,minute:mt,second:mt,timeZoneName:gn},ls={year:mt,month:qe,day:mt,weekday:qe,hour:mt,minute:mt,timeZoneName:qe},us={year:mt,month:qe,day:mt,weekday:qe,hour:mt,minute:mt,second:mt,timeZoneName:qe};D();D();D();D();var He=class{get type(){throw new mn}get name(){throw new mn}get ianaName(){return this.name}get isUniversal(){throw new mn}offsetName(e,t){throw new mn}formatOffset(e,t){throw new mn}offset(e){throw new mn}equals(e){throw new mn}get isValid(){throw new mn}};var Uc=null,wn=class extends He{static get instance(){return Uc===null&&(Uc=new wn),Uc}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Qa(e,t,i)}formatOffset(e,t){return li(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}};D();var tl={};function XS(s){return tl[s]||(tl[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),tl[s]}var tw={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function ew(s,e){let t=s.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,r,a,l,u,c,m,v]=i;return[l,r,a,u,c,m,v]}function nw(s,e){let t=s.formatToParts(e),i=[];for(let r=0;r<t.length;r++){let{type:a,value:l}=t[r],u=tw[a];a==="era"?i[u]=l:Nt(u)||(i[u]=parseInt(l,10))}return i}var Xa={},Te=class extends He{static create(e){return Xa[e]||(Xa[e]=new Te(e)),Xa[e]}static resetCache(){Xa={},tl={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Te.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Qa(e,t,i,this.name)}formatOffset(e,t){return li(this.offset(e),t)}offset(e){let t=new Date(e);if(isNaN(t))return NaN;let i=XS(this.name),[r,a,l,u,c,m,v]=i.formatToParts?nw(i,t):ew(i,t);u==="BC"&&(r=-Math.abs(r)+1);let h=Ur({year:r,month:a,day:l,hour:c===24?0:c,minute:m,second:v,millisecond:0}),b=+t,w=b%1e3;return b-=w>=0?w:1e3+w,(h-b)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}};D();var rg={};function iw(s,e={}){let t=JSON.stringify([s,e]),i=rg[t];return i||(i=new Intl.ListFormat(s,e),rg[t]=i),i}var Bc={};function kc(s,e={}){let t=JSON.stringify([s,e]),i=Bc[t];return i||(i=new Intl.DateTimeFormat(s,e),Bc[t]=i),i}var $c={};function rw(s,e={}){let t=JSON.stringify([s,e]),i=$c[t];return i||(i=new Intl.NumberFormat(s,e),$c[t]=i),i}var Hc={};function ow(s,e={}){let l=e,{base:t}=l,i=xu(l,["base"]),r=JSON.stringify([s,i]),a=Hc[r];return a||(a=new Intl.RelativeTimeFormat(s,e),Hc[r]=a),a}var cs=null;function sw(){return cs||(cs=new Intl.DateTimeFormat().resolvedOptions().locale,cs)}function aw(s){let e=s.indexOf("-x-");e!==-1&&(s=s.substring(0,e));let t=s.indexOf("-u-");if(t===-1)return[s];{let i,r;try{i=kc(s).resolvedOptions(),r=s}catch(u){let c=s.substring(0,t);i=kc(c).resolvedOptions(),r=c}let{numberingSystem:a,calendar:l}=i;return[r,a,l]}}function lw(s,e,t){return(t||e)&&(s.includes("-u-")||(s+="-u"),t&&(s+=`-ca-${t}`),e&&(s+=`-nu-${e}`)),s}function uw(s){let e=[];for(let t=1;t<=12;t++){let i=Ot.utc(2009,t,1);e.push(s(i))}return e}function cw(s){let e=[];for(let t=1;t<=7;t++){let i=Ot.utc(2016,11,13+t);e.push(s(i))}return e}function el(s,e,t,i){let r=s.listingMode();return r==="error"?null:r==="en"?t(e):i(e)}function dw(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var Gc=class{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;let u=i,{padTo:r,floor:a}=u,l=xu(u,["padTo","floor"]);if(!t||Object.keys(l).length>0){let c=lt({useGrouping:!1},i);i.padTo>0&&(c.minimumIntegerDigits=i.padTo),this.inf=rw(e,c)}}format(e){if(this.inf){let t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{let t=this.floor?Math.floor(e):Br(e,3);return ce(t,this.padTo)}}},Wc=class{constructor(e,t,i){this.opts=i,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let l=-1*(e.offset/60),u=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;e.offset!==0&&Te.create(u).valid?(r=u,this.dt=e):(r="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let a=lt({},this.opts);a.timeZone=a.timeZone||r,this.dtf=kc(t,a)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){let i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return _t(lt({},t),{value:i})}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},zc=class{constructor(e,t,i){this.opts=lt({style:"long"},i),!t&&nl()&&(this.rtf=ow(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):og(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}},Jt=class{static fromOpts(e){return Jt.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,i,r=!1){let a=e||Xt.defaultLocale,l=a||(r?"en-US":sw()),u=t||Xt.defaultNumberingSystem,c=i||Xt.defaultOutputCalendar;return new Jt(l,u,c,a)}static resetCache(){cs=null,Bc={},$c={},Hc={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i}={}){return Jt.create(e,t,i)}constructor(e,t,i,r){let[a,l,u]=aw(e);this.locale=a,this.numberingSystem=t||l||null,this.outputCalendar=i||u||null,this.intl=lw(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=dw(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Jt.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone(_t(lt({},e),{defaultToEN:!0}))}redefaultToSystem(e={}){return this.clone(_t(lt({},e),{defaultToEN:!1}))}months(e,t=!1){return el(this,e,Vc,()=>{let i=t?{month:e,day:"numeric"}:{month:e},r=t?"format":"standalone";return this.monthsCache[r][e]||(this.monthsCache[r][e]=uw(a=>this.extract(a,i,"month"))),this.monthsCache[r][e]})}weekdays(e,t=!1){return el(this,e,jc,()=>{let i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=cw(a=>this.extract(a,i,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return el(this,void 0,()=>Jc,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ot.utc(2016,11,13,9),Ot.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return el(this,e,Kc,()=>{let t={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ot.utc(-40,1,1),Ot.utc(2017,1,1)].map(i=>this.extract(i,t,"era"))),this.eraCache[e]})}extract(e,t,i){let r=this.dtFormatter(e,t),a=r.formatToParts(),l=a.find(u=>u.type.toLowerCase()===i);return l?l.value:null}numberFormatter(e={}){return new Gc(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Wc(e,this.intl,t)}relFormatter(e={}){return new zc(this.intl,this.isEnglish(),e)}listFormatter(e={}){return iw(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}};D();D();var Zc=null,de=class extends He{static get utcInstance(){return Zc===null&&(Zc=new de(0)),Zc}static instance(e){return e===0?de.utcInstance:new de(e)}static parseSpecifier(e){if(e){let t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new de(Ji(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${li(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${li(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return li(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}};D();var kr=class extends He{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function vn(s,e){let t;if(Nt(s)||s===null)return e;if(s instanceof He)return s;if(sg(s)){let i=s.toLowerCase();return i==="default"?e:i==="local"||i==="system"?wn.instance:i==="utc"||i==="gmt"?de.utcInstance:de.parseSpecifier(i)||Te.create(s)}else return Pn(s)?de.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new kr(s)}var ag=()=>Date.now(),lg="system",ug=null,cg=null,dg=null,fg=60,hg,Xt=class{static get now(){return ag}static set now(e){ag=e}static set defaultZone(e){lg=e}static get defaultZone(){return vn(lg,wn.instance)}static get defaultLocale(){return ug}static set defaultLocale(e){ug=e}static get defaultNumberingSystem(){return cg}static set defaultNumberingSystem(e){cg=e}static get defaultOutputCalendar(){return dg}static set defaultOutputCalendar(e){dg=e}static get twoDigitCutoffYear(){return fg}static set twoDigitCutoffYear(e){fg=e%100}static get throwOnInvalid(){return hg}static set throwOnInvalid(e){hg=e}static resetCaches(){Jt.resetCache(),Te.resetCache()}};function Nt(s){return typeof s=="undefined"}function Pn(s){return typeof s=="number"}function ds(s){return typeof s=="number"&&s%1===0}function sg(s){return typeof s=="string"}function pg(s){return Object.prototype.toString.call(s)==="[object Date]"}function nl(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function mg(s){return Array.isArray(s)?s:[s]}function Yc(s,e,t){if(s.length!==0)return s.reduce((i,r)=>{let a=[e(r),r];return i&&t(i[0],a[0])===i[0]?i:a},null)[1]}function gg(s,e){return e.reduce((t,i)=>(t[i]=s[i],t),{})}function ui(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function xn(s,e,t){return ds(s)&&s>=e&&s<=t}function fw(s,e){return s-e*Math.floor(s/e)}function ce(s,e=2){let t=s<0,i;return t?i="-"+(""+-s).padStart(e,"0"):i=(""+s).padStart(e,"0"),i}function zn(s){if(!(Nt(s)||s===null||s===""))return parseInt(s,10)}function ci(s){if(!(Nt(s)||s===null||s===""))return parseFloat(s)}function fs(s){if(!(Nt(s)||s===null||s==="")){let e=parseFloat("0."+s)*1e3;return Math.floor(e)}}function Br(s,e,t=!1){let i=Qh(10,e);return(t?Math.trunc:Math.round)(s*i)/i}function Ki(s){return s%4===0&&(s%100!==0||s%400===0)}function qi(s){return Ki(s)?366:365}function $r(s,e){let t=fw(e-1,12)+1,i=s+(e-t)/12;return t===2?Ki(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function Ur(s){let e=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(e=new Date(e),e.setUTCFullYear(s.year,s.month-1,s.day)),+e}function Hr(s){let e=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,t=s-1,i=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||i===3?53:52}function hs(s){return s>99?s:s>Xt.twoDigitCutoffYear?1900+s:2e3+s}function Qa(s,e,t,i=null){let r=new Date(s),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(a.timeZone=i);let l=lt({timeZoneName:e},a),u=new Intl.DateTimeFormat(t,l).formatToParts(r).find(c=>c.type.toLowerCase()==="timezonename");return u?u.value:null}function Ji(s,e){let t=parseInt(s,10);Number.isNaN(t)&&(t=0);let i=parseInt(e,10)||0,r=t<0||Object.is(t,-0)?-i:i;return t*60+r}function Qc(s){let e=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(e))throw new xe(`Invalid unit value ${s}`);return e}function Gr(s,e){let t={};for(let i in s)if(ui(s,i)){let r=s[i];if(r==null)continue;t[e(i)]=Qc(r)}return t}function li(s,e){let t=Math.trunc(Math.abs(s/60)),i=Math.trunc(Math.abs(s%60)),r=s>=0?"+":"-";switch(e){case"short":return`${r}${ce(t,2)}:${ce(i,2)}`;case"narrow":return`${r}${t}${i>0?`:${i}`:""}`;case"techie":return`${r}${ce(t,2)}${ce(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function ps(s){return gg(s,["hour","minute","second","millisecond"])}var hw=["January","February","March","April","May","June","July","August","September","October","November","December"],Xc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pw=["J","F","M","A","M","J","J","A","S","O","N","D"];function Vc(s){switch(s){case"narrow":return[...pw];case"short":return[...Xc];case"long":return[...hw];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var td=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ed=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],mw=["M","T","W","T","F","S","S"];function jc(s){switch(s){case"narrow":return[...mw];case"short":return[...ed];case"long":return[...td];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Jc=["AM","PM"],gw=["Before Christ","Anno Domini"],vw=["BC","AD"],yw=["B","A"];function Kc(s){switch(s){case"narrow":return[...yw];case"short":return[...vw];case"long":return[...gw];default:return null}}function vg(s){return Jc[s.hour<12?0:1]}function yg(s,e){return jc(e)[s.weekday-1]}function bg(s,e){return Vc(e)[s.month-1]}function Eg(s,e){return Kc(e)[s.year<0?0:1]}function og(s,e,t="always",i=!1){let r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(s)===-1;if(t==="auto"&&a){let E=s==="days";switch(e){case 1:return E?"tomorrow":`next ${r[s][0]}`;case-1:return E?"yesterday":`last ${r[s][0]}`;case 0:return E?"today":`this ${r[s][0]}`;default:}}let l=Object.is(e,-0)||e<0,u=Math.abs(e),c=u===1,m=r[s],v=i?c?m[1]:m[2]||m[1]:c?r[s][0]:s;return l?`${u} ${v} ago`:`in ${u} ${v}`}function Ag(s,e){let t="";for(let i of s)i.literal?t+=i.val:t+=e(i.val);return t}var bw={D:ai,DD:Vo,DDD:jo,DDDD:Jo,t:Ko,tt:qo,ttt:Zo,tttt:Yo,T:Qo,TT:Xo,TTT:ts,TTTT:es,f:ns,ff:rs,fff:ss,ffff:ls,F:is,FF:os,FFF:as,FFFF:us},fe=class{static create(e,t={}){return new fe(e,t)}static parseFormat(e){let t=null,i="",r=!1,a=[];for(let l=0;l<e.length;l++){let u=e.charAt(l);u==="'"?(i.length>0&&a.push({literal:r||/^\s+$/.test(i),val:i}),t=null,i="",r=!r):r||u===t?i+=u:(i.length>0&&a.push({literal:/^\s+$/.test(i),val:i}),i=u,t=u)}return i.length>0&&a.push({literal:r||/^\s+$/.test(i),val:i}),a}static macroTokenToFormatOpts(e){return bw[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,lt(lt({},this.opts),t)).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,lt(lt({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return ce(e,t);let i=lt({},this.opts);return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){let i=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(b,w)=>this.loc.extract(e,b,w),l=b=>e.isOffsetFixed&&e.offset===0&&b.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,b.format):"",u=()=>i?vg(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),c=(b,w)=>i?bg(e,b):a(w?{month:b}:{month:b,day:"numeric"},"month"),m=(b,w)=>i?yg(e,b):a(w?{weekday:b}:{weekday:b,month:"long",day:"numeric"},"weekday"),v=b=>{let w=fe.macroTokenToFormatOpts(b);return w?this.formatWithSystemDefault(e,w):b},E=b=>i?Eg(e,b):a({era:b},"era"),h=b=>{switch(b){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return u();case"d":return r?a({day:"numeric"},"day"):this.num(e.day);case"dd":return r?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return r?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return c("short",!0);case"LLLL":return c("long",!0);case"LLLLL":return c("narrow",!0);case"M":return r?a({month:"numeric"},"month"):this.num(e.month);case"MM":return r?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return c("short",!1);case"MMMM":return c("long",!1);case"MMMMM":return c("narrow",!1);case"y":return r?a({year:"numeric"},"year"):this.num(e.year);case"yy":return r?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return E("short");case"GG":return E("long");case"GGGGG":return E("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return v(b)}};return Ag(fe.parseFormat(t),h)}formatDurationFromString(e,t){let i=c=>{switch(c[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=c=>m=>{let v=i(m);return v?this.num(c.get(v),m.length):m},a=fe.parseFormat(t),l=a.reduce((c,{literal:m,val:v})=>m?c:c.concat(v),[]),u=e.shiftTo(...l.map(i).filter(c=>c));return Ag(a,r(u))}};D();var Ie=class{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};D();var Og=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function zr(...s){let e=s.reduce((t,i)=>t+i.source,"");return RegExp(`^${e}$`)}function Vr(...s){return e=>s.reduce(([t,i,r],a)=>{let[l,u,c]=a(e,r);return[lt(lt({},t),l),u||i,c]},[{},null,1]).slice(0,2)}function jr(s,...e){if(s==null)return[null,null];for(let[t,i]of e){let r=t.exec(s);if(r)return i(r)}return[null,null]}function Cg(...s){return(e,t)=>{let i={},r;for(r=0;r<s.length;r++)i[s[r]]=zn(e[t+r]);return[i,null,t+r]}}var Sg=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Ew=`(?:${Sg.source}?(?:\\[(${Og.source})\\])?)?`,nd=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,wg=RegExp(`${nd.source}${Ew}`),id=RegExp(`(?:T${wg.source})?`),Aw=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Tw=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Ow=/(\d{4})-?(\d{3})/,Cw=Cg("weekYear","weekNumber","weekDay"),Sw=Cg("year","ordinal"),ww=/(\d{4})-(\d\d)-(\d\d)/,Pg=RegExp(`${nd.source} ?(?:${Sg.source}|(${Og.source}))?`),Pw=RegExp(`(?: ${Pg.source})?`);function Wr(s,e,t){let i=s[e];return Nt(i)?t:zn(i)}function xw(s,e){return[{year:Wr(s,e),month:Wr(s,e+1,1),day:Wr(s,e+2,1)},null,e+3]}function Jr(s,e){return[{hours:Wr(s,e,0),minutes:Wr(s,e+1,0),seconds:Wr(s,e+2,0),milliseconds:fs(s[e+3])},null,e+4]}function ms(s,e){let t=!s[e]&&!s[e+1],i=Ji(s[e+1],s[e+2]),r=t?null:de.instance(i);return[{},r,e+3]}function gs(s,e){let t=s[e]?Te.create(s[e]):null;return[{},t,e+1]}var Iw=RegExp(`^T?${nd.source}$`),Mw=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Rw(s){let[e,t,i,r,a,l,u,c,m]=s,v=e[0]==="-",E=c&&c[0]==="-",h=(b,w=!1)=>b!==void 0&&(w||b&&v)?-b:b;return[{years:h(ci(t)),months:h(ci(i)),weeks:h(ci(r)),days:h(ci(a)),hours:h(ci(l)),minutes:h(ci(u)),seconds:h(ci(c),c==="-0"),milliseconds:h(fs(m),E)}]}var _w={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function rd(s,e,t,i,r,a,l){let u={year:e.length===2?hs(zn(e)):zn(e),month:Xc.indexOf(t)+1,day:zn(i),hour:zn(r),minute:zn(a)};return l&&(u.second=zn(l)),s&&(u.weekday=s.length>3?td.indexOf(s)+1:ed.indexOf(s)+1),u}var Lw=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Dw(s){let[,e,t,i,r,a,l,u,c,m,v,E]=s,h=rd(e,r,i,t,a,l,u),b;return c?b=_w[c]:m?b=0:b=Ji(v,E),[h,new de(b)]}function Nw(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var Fw=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Uw=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Bw=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Tg(s){let[,e,t,i,r,a,l,u]=s;return[rd(e,r,i,t,a,l,u),de.utcInstance]}function kw(s){let[,e,t,i,r,a,l,u]=s;return[rd(e,u,t,i,r,a,l),de.utcInstance]}var $w=zr(Aw,id),Hw=zr(Tw,id),Gw=zr(Ow,id),Ww=zr(wg),xg=Vr(xw,Jr,ms,gs),zw=Vr(Cw,Jr,ms,gs),Vw=Vr(Sw,Jr,ms,gs),jw=Vr(Jr,ms,gs);function Ig(s){return jr(s,[$w,xg],[Hw,zw],[Gw,Vw],[Ww,jw])}function Mg(s){return jr(Nw(s),[Lw,Dw])}function Rg(s){return jr(s,[Fw,Tg],[Uw,Tg],[Bw,kw])}function _g(s){return jr(s,[Mw,Rw])}var Jw=Vr(Jr);function Lg(s){return jr(s,[Iw,Jw])}var Kw=zr(ww,Pw),qw=zr(Pg),Zw=Vr(Jr,ms,gs);function Dg(s){return jr(s,[Kw,xg],[qw,Zw])}var Ng="Invalid Duration",Ug={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Yw=lt({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Ug),sn=146097/400,Kr=146097/4800,Qw=lt({years:{quarters:4,months:12,weeks:sn/7,days:sn,hours:sn*24,minutes:sn*24*60,seconds:sn*24*60*60,milliseconds:sn*24*60*60*1e3},quarters:{months:3,weeks:sn/28,days:sn/4,hours:sn*24/4,minutes:sn*24*60/4,seconds:sn*24*60*60/4,milliseconds:sn*24*60*60*1e3/4},months:{weeks:Kr/7,days:Kr,hours:Kr*24,minutes:Kr*24*60,seconds:Kr*24*60*60,milliseconds:Kr*24*60*60*1e3}},Ug),Zi=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Xw=Zi.slice(0).reverse();function di(s,e,t=!1){let i={values:t?e.values:lt(lt({},s.values),e.values||{}),loc:s.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||s.conversionAccuracy,matrix:e.matrix||s.matrix};return new Bt(i)}function Bg(s,e){var i;let t=(i=e.milliseconds)!=null?i:0;for(let r of Xw.slice(1))e[r]&&(t+=e[r]*s[r].milliseconds);return t}function Fg(s,e){let t=Bg(s,e)<0?-1:1;Zi.reduceRight((i,r)=>{if(Nt(e[r]))return i;if(i){let a=e[i]*t,l=s[r][i],u=Math.floor(a/l);e[r]+=u*t,e[i]-=u*l*t}return r},null),Zi.reduce((i,r)=>{if(Nt(e[r]))return i;if(i){let a=e[i]%1;e[i]-=a,e[r]+=a*s[i][r]}return r},null)}function tP(s){let e={};for(let[t,i]of Object.entries(s))i!==0&&(e[t]=i);return e}var Bt=class{constructor(e){let t=e.conversionAccuracy==="longterm"||!1,i=t?Qw:Yw;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Jt.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return Bt.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new xe(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Bt({values:Gr(e,Bt.normalizeUnit),loc:Jt.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Pn(e))return Bt.fromMillis(e);if(Bt.isDuration(e))return e;if(typeof e=="object")return Bt.fromObject(e);throw new xe(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){let[i]=_g(e);return i?Bt.fromObject(i,t):Bt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){let[i]=Lg(e);return i?Bt.fromObject(i,t):Bt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new xe("need to specify a reason the Duration is invalid");let i=e instanceof Ie?e:new Ie(e,t);if(Xt.throwOnInvalid)throw new Za(i);return new Bt({invalid:i})}static normalizeUnit(e){let t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new Fr(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){let i=_t(lt({},t),{floor:t.round!==!1&&t.floor!==!1});return this.isValid?fe.create(this.loc,i).formatDurationFromString(this,e):Ng}toHuman(e={}){if(!this.isValid)return Ng;let t=Zi.map(i=>{let r=this.values[i];return Nt(r)?null:this.loc.numberFormatter(_t(lt({style:"unit",unitDisplay:"long"},e),{unit:i.slice(0,-1)})).format(r)}).filter(i=>i);return this.loc.listFormatter(lt({type:"conjunction",style:e.listStyle||"narrow"},e)).format(t)}toObject(){return this.isValid?lt({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Br(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let t=this.toMillis();return t<0||t>=864e5?null:(e=_t(lt({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{includeOffset:!1}),Ot.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Bg(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let t=Bt.fromDurationLike(e),i={};for(let r of Zi)(ui(t.values,r)||ui(this.values,r))&&(i[r]=t.get(r)+this.get(r));return di(this,{values:i},!0)}minus(e){if(!this.isValid)return this;let t=Bt.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;let t={};for(let i of Object.keys(this.values))t[i]=Qc(e(this.values[i],i));return di(this,{values:t},!0)}get(e){return this[Bt.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let t=lt(lt({},this.values),Gr(e,Bt.normalizeUnit));return di(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:r}={}){let l={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:i};return di(this,l)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return Fg(this.matrix,e),di(this,{values:e},!0)}rescale(){if(!this.isValid)return this;let e=tP(this.normalize().shiftToAll().toObject());return di(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(l=>Bt.normalizeUnit(l));let t={},i={},r=this.toObject(),a;for(let l of Zi)if(e.indexOf(l)>=0){a=l;let u=0;for(let m in i)u+=this.matrix[m][l]*i[m],i[m]=0;Pn(r[l])&&(u+=r[l]);let c=Math.trunc(u);t[l]=c,i[l]=(u*1e3-c*1e3)/1e3}else Pn(r[l])&&(i[l]=r[l]);for(let l in i)i[l]!==0&&(t[a]+=l===a?i[l]:i[l]/this.matrix[a][l]);return Fg(this.matrix,t),di(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return di(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(i,r){return i===void 0||i===0?r===void 0||r===0:i===r}for(let i of Zi)if(!t(this.values[i],e.values[i]))return!1;return!0}};D();var qr="Invalid Interval";function eP(s,e){return!s||!s.isValid?ie.invalid("missing or invalid start"):!e||!e.isValid?ie.invalid("missing or invalid end"):e<s?ie.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${e.toISO()}`):null}var ie=class{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new xe("need to specify a reason the Interval is invalid");let i=e instanceof Ie?e:new Ie(e,t);if(Xt.throwOnInvalid)throw new qa(i);return new ie({invalid:i})}static fromDateTimes(e,t){let i=Zr(e),r=Zr(t),a=eP(i,r);return a==null?new ie({start:i,end:r}):a}static after(e,t){let i=Bt.fromDurationLike(t),r=Zr(e);return ie.fromDateTimes(r,r.plus(i))}static before(e,t){let i=Bt.fromDurationLike(t),r=Zr(e);return ie.fromDateTimes(r.minus(i),r)}static fromISO(e,t){let[i,r]=(e||"").split("/",2);if(i&&r){let a,l;try{a=Ot.fromISO(i,t),l=a.isValid}catch(m){l=!1}let u,c;try{u=Ot.fromISO(r,t),c=u.isValid}catch(m){c=!1}if(l&&c)return ie.fromDateTimes(a,u);if(l){let m=Bt.fromISO(r,t);if(m.isValid)return ie.after(a,m)}else if(c){let m=Bt.fromISO(i,t);if(m.isValid)return ie.before(u,m)}}return ie.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let t=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(t,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?ie.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];let t=e.map(Zr).filter(l=>this.contains(l)).sort(),i=[],{s:r}=this,a=0;for(;r<this.e;){let l=t[a]||this.e,u=+l>+this.e?this.e:l;i.push(ie.fromDateTimes(r,u)),r=u,a+=1}return i}splitBy(e){let t=Bt.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:i}=this,r=1,a,l=[];for(;i<this.e;){let u=this.start.plus(t.mapUnits(c=>c*r));a=+u>+this.e?this.e:u,l.push(ie.fromDateTimes(i,a)),i=a,r+=1}return l}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:ie.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;let t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return ie.fromDateTimes(t,i)}static merge(e){let[t,i]=e.sort((r,a)=>r.s-a.s).reduce(([r,a],l)=>a?a.overlaps(l)||a.abutsStart(l)?[r,a.union(l)]:[r.concat([a]),l]:[r,l],[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0,r=[],a=e.map(c=>[{time:c.s,type:"s"},{time:c.e,type:"e"}]),l=Array.prototype.concat(...a),u=l.sort((c,m)=>c.time-m.time);for(let c of u)i+=c.type==="s"?1:-1,i===1?t=c.time:(t&&+t!=+c.time&&r.push(ie.fromDateTimes(t,c.time)),t=null);return ie.merge(r)}difference(...e){return ie.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:qr}toLocaleString(e=ai,t={}){return this.isValid?fe.create(this.s.loc.clone(t),e).formatInterval(this):qr}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:qr}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:qr}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:qr}toFormat(e,{separator:t=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:qr}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Bt.invalid(this.invalidReason)}mapEndpoints(e){return ie.fromDateTimes(e(this.s),e(this.e))}};D();var Vn=class{static hasDST(e=Xt.defaultZone){let t=Ot.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Te.isValidZone(e)}static normalizeZone(e){return vn(e,Xt.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||Jt.create(t,i,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||Jt.create(t,i,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||Jt.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||Jt.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Jt.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Jt.create(t,null,"gregory").eras(e)}static features(){return{relative:nl()}}};D();function kg(s,e){let t=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=t(e)-t(s);return Math.floor(Bt.fromMillis(i).as("days"))}function nP(s,e,t){let i=[["years",(c,m)=>m.year-c.year],["quarters",(c,m)=>m.quarter-c.quarter+(m.year-c.year)*4],["months",(c,m)=>m.month-c.month+(m.year-c.year)*12],["weeks",(c,m)=>{let v=kg(c,m);return(v-v%7)/7}],["days",kg]],r={},a=s,l,u;for(let[c,m]of i)t.indexOf(c)>=0&&(l=c,r[c]=m(s,e),u=a.plus(r),u>e?(r[c]--,s=a.plus(r),s>e&&(u=s,r[c]--,s=a.plus(r))):s=u);return[s,r,u,l]}function $g(s,e,t,i){let[r,a,l,u]=nP(s,e,t),c=e-r,m=t.filter(E=>["hours","minutes","seconds","milliseconds"].indexOf(E)>=0);m.length===0&&(l<e&&(l=r.plus({[u]:1})),l!==r&&(a[u]=(a[u]||0)+c/(l-r)));let v=Bt.fromObject(a,i);return m.length>0?Bt.fromMillis(c,i).shiftTo(...m).plus(v):v}D();D();var od={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Hg={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},iP=od.hanidec.replace(/[\[|\]]/g,"").split("");function Gg(s){let e=parseInt(s,10);if(isNaN(e)){e="";for(let t=0;t<s.length;t++){let i=s.charCodeAt(t);if(s[t].search(od.hanidec)!==-1)e+=iP.indexOf(s[t]);else for(let r in Hg){let[a,l]=Hg[r];i>=a&&i<=l&&(e+=i-a)}}return parseInt(e,10)}else return e}function an({numberingSystem:s},e=""){return new RegExp(`${od[s||"latn"]}${e}`)}var rP="missing Intl.DateTimeFormat.formatToParts support";function Zt(s,e=t=>t){return{regex:s,deser:([t])=>e(Gg(t))}}var oP=String.fromCharCode(160),Vg=`[ ${oP}]`,jg=new RegExp(Vg,"g");function sP(s){return s.replace(/\./g,"\\.?").replace(jg,Vg)}function Wg(s){return s.replace(/\./g,"").replace(jg," ").toLowerCase()}function yn(s,e){return s===null?null:{regex:RegExp(s.map(sP).join("|")),deser:([t])=>s.findIndex(i=>Wg(t)===Wg(i))+e}}function zg(s,e){return{regex:s,deser:([,t,i])=>Ji(t,i),groups:e}}function il(s){return{regex:s,deser:([e])=>e}}function aP(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function lP(s,e){let t=an(e),i=an(e,"{2}"),r=an(e,"{3}"),a=an(e,"{4}"),l=an(e,"{6}"),u=an(e,"{1,2}"),c=an(e,"{1,3}"),m=an(e,"{1,6}"),v=an(e,"{1,9}"),E=an(e,"{2,4}"),h=an(e,"{4,6}"),b=C=>({regex:RegExp(aP(C.val)),deser:([O])=>O,literal:!0}),P=(C=>{if(s.literal)return b(C);switch(C.val){case"G":return yn(e.eras("short"),0);case"GG":return yn(e.eras("long"),0);case"y":return Zt(m);case"yy":return Zt(E,hs);case"yyyy":return Zt(a);case"yyyyy":return Zt(h);case"yyyyyy":return Zt(l);case"M":return Zt(u);case"MM":return Zt(i);case"MMM":return yn(e.months("short",!0),1);case"MMMM":return yn(e.months("long",!0),1);case"L":return Zt(u);case"LL":return Zt(i);case"LLL":return yn(e.months("short",!1),1);case"LLLL":return yn(e.months("long",!1),1);case"d":return Zt(u);case"dd":return Zt(i);case"o":return Zt(c);case"ooo":return Zt(r);case"HH":return Zt(i);case"H":return Zt(u);case"hh":return Zt(i);case"h":return Zt(u);case"mm":return Zt(i);case"m":return Zt(u);case"q":return Zt(u);case"qq":return Zt(i);case"s":return Zt(u);case"ss":return Zt(i);case"S":return Zt(c);case"SSS":return Zt(r);case"u":return il(v);case"uu":return il(u);case"uuu":return Zt(t);case"a":return yn(e.meridiems(),0);case"kkkk":return Zt(a);case"kk":return Zt(E,hs);case"W":return Zt(u);case"WW":return Zt(i);case"E":case"c":return Zt(t);case"EEE":return yn(e.weekdays("short",!1),1);case"EEEE":return yn(e.weekdays("long",!1),1);case"ccc":return yn(e.weekdays("short",!0),1);case"cccc":return yn(e.weekdays("long",!0),1);case"Z":case"ZZ":return zg(new RegExp(`([+-]${u.source})(?::(${i.source}))?`),2);case"ZZZ":return zg(new RegExp(`([+-]${u.source})(${i.source})?`),2);case"z":return il(/[a-z_+-/]{1,256}?/i);case" ":return il(/[^\S\n\r]/);default:return b(C)}})(s)||{invalidReason:rP};return P.token=s,P}var uP={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function cP(s,e,t){let{type:i,value:r}=s;if(i==="literal"){let c=/^\s+$/.test(r);return{literal:!c,val:c?" ":r}}let a=e[i],l=i;i==="hour"&&(e.hour12!=null?l=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?l="hour12":l="hour24":l=t.hour12?"hour12":"hour24");let u=uP[l];if(typeof u=="object"&&(u=u[a]),u)return{literal:!1,val:u}}function dP(s){return[`^${s.map(t=>t.regex).reduce((t,i)=>`${t}(${i.source})`,"")}$`,s]}function fP(s,e,t){let i=s.match(e);if(i){let r={},a=1;for(let l in t)if(ui(t,l)){let u=t[l],c=u.groups?u.groups+1:1;!u.literal&&u.token&&(r[u.token.val[0]]=u.deser(i.slice(a,a+c))),a+=c}return[i,r]}else return[i,{}]}function hP(s){let e=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},t=null,i;return Nt(s.z)||(t=Te.create(s.z)),Nt(s.Z)||(t||(t=new de(s.Z)),i=s.Z),Nt(s.q)||(s.M=(s.q-1)*3+1),Nt(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),Nt(s.u)||(s.S=fs(s.u)),[Object.keys(s).reduce((a,l)=>{let u=e(l);return u&&(a[u]=s[l]),a},{}),t,i]}var sd=null;function pP(){return sd||(sd=Ot.fromMillis(1555555555555)),sd}function mP(s,e){if(s.literal)return s;let t=fe.macroTokenToFormatOpts(s.val),i=ud(t,e);return i==null||i.includes(void 0)?s:i}function ad(s,e){return Array.prototype.concat(...s.map(t=>mP(t,e)))}function ld(s,e,t){let i=ad(fe.parseFormat(t),s),r=i.map(l=>lP(l,s)),a=r.find(l=>l.invalidReason);if(a)return{input:e,tokens:i,invalidReason:a.invalidReason};{let[l,u]=dP(r),c=RegExp(l,"i"),[m,v]=fP(e,c,u),[E,h,b]=v?hP(v):[null,null,void 0];if(ui(v,"a")&&ui(v,"H"))throw new Wn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:c,rawMatches:m,matches:v,result:E,zone:h,specificOffset:b}}}function Jg(s,e,t){let{result:i,zone:r,specificOffset:a,invalidReason:l}=ld(s,e,t);return[i,r,a,l]}function ud(s,e){if(!s)return null;let i=fe.create(e,s).dtFormatter(pP()),r=i.formatToParts(),a=i.resolvedOptions();return r.map(l=>cP(l,s,a))}D();var Kg=[0,31,59,90,120,151,181,212,243,273,304,334],qg=[0,31,60,91,121,152,182,213,244,274,305,335];function ln(s,e){return new Ie("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${s}, which is invalid`)}function Zg(s,e,t){let i=new Date(Date.UTC(s,e-1,t));s<100&&s>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);let r=i.getUTCDay();return r===0?7:r}function Yg(s,e,t){return t+(Ki(s)?qg:Kg)[e-1]}function Qg(s,e){let t=Ki(s)?qg:Kg,i=t.findIndex(a=>a<e),r=e-t[i];return{month:i+1,day:r}}function rl(s){let{year:e,month:t,day:i}=s,r=Yg(e,t,i),a=Zg(e,t,i),l=Math.floor((r-a+10)/7),u;return l<1?(u=e-1,l=Hr(u)):l>Hr(e)?(u=e+1,l=1):u=e,lt({weekYear:u,weekNumber:l,weekday:a},ps(s))}function cd(s){let{weekYear:e,weekNumber:t,weekday:i}=s,r=Zg(e,1,4),a=qi(e),l=t*7+i-r-3,u;l<1?(u=e-1,l+=qi(u)):l>a?(u=e+1,l-=qi(e)):u=e;let{month:c,day:m}=Qg(u,l);return lt({year:u,month:c,day:m},ps(s))}function ol(s){let{year:e,month:t,day:i}=s,r=Yg(e,t,i);return lt({year:e,ordinal:r},ps(s))}function dd(s){let{year:e,ordinal:t}=s,{month:i,day:r}=Qg(e,t);return lt({year:e,month:i,day:r},ps(s))}function Xg(s){let e=ds(s.weekYear),t=xn(s.weekNumber,1,Hr(s.weekYear)),i=xn(s.weekday,1,7);return e?t?i?!1:ln("weekday",s.weekday):ln("week",s.week):ln("weekYear",s.weekYear)}function tv(s){let e=ds(s.year),t=xn(s.ordinal,1,qi(s.year));return e?t?!1:ln("ordinal",s.ordinal):ln("year",s.year)}function fd(s){let e=ds(s.year),t=xn(s.month,1,12),i=xn(s.day,1,$r(s.year,s.month));return e?t?i?!1:ln("day",s.day):ln("month",s.month):ln("year",s.year)}function hd(s){let{hour:e,minute:t,second:i,millisecond:r}=s,a=xn(e,0,23)||e===24&&t===0&&i===0&&r===0,l=xn(t,0,59),u=xn(i,0,59),c=xn(r,0,999);return a?l?u?c?!1:ln("millisecond",r):ln("second",i):ln("minute",t):ln("hour",e)}var pd="Invalid DateTime",ev=864e13;function sl(s){return new Ie("unsupported zone",`the zone "${s.name}" is not supported`)}function md(s){return s.weekData===null&&(s.weekData=rl(s.c)),s.weekData}function Yi(s,e){let t={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Ot(_t(lt(lt({},t),e),{old:t}))}function lv(s,e,t){let i=s-e*60*1e3,r=t.offset(i);if(e===r)return[i,e];i-=(r-e)*60*1e3;let a=t.offset(i);return r===a?[i,r]:[s-Math.min(r,a)*60*1e3,Math.max(r,a)]}function al(s,e){s+=e*60*1e3;let t=new Date(s);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function ul(s,e,t){return lv(Ur(s),e,t)}function nv(s,e){let t=s.o,i=s.c.year+Math.trunc(e.years),r=s.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,a=_t(lt({},s.c),{year:i,month:r,day:Math.min(s.c.day,$r(i,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7}),l=Bt.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),u=Ur(a),[c,m]=lv(u,t,s.zone);return l!==0&&(c+=l,m=s.zone.offset(c)),{ts:c,o:m}}function vs(s,e,t,i,r,a){let{setZone:l,zone:u}=t;if(s&&Object.keys(s).length!==0||e){let c=e||u,m=Ot.fromObject(s,_t(lt({},t),{zone:c,specificOffset:a}));return l?m:m.setZone(u)}else return Ot.invalid(new Ie("unparsable",`the input "${r}" can't be parsed as ${i}`))}function ll(s,e,t=!0){return s.isValid?fe.create(Jt.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(s,e):null}function gd(s,e){let t=s.c.year>9999||s.c.year<0,i="";return t&&s.c.year>=0&&(i+="+"),i+=ce(s.c.year,t?6:4),e?(i+="-",i+=ce(s.c.month),i+="-",i+=ce(s.c.day)):(i+=ce(s.c.month),i+=ce(s.c.day)),i}function iv(s,e,t,i,r,a){let l=ce(s.c.hour);return e?(l+=":",l+=ce(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=":")):l+=ce(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=ce(s.c.second),(s.c.millisecond!==0||!i)&&(l+=".",l+=ce(s.c.millisecond,3))),r&&(s.isOffsetFixed&&s.offset===0&&!a?l+="Z":s.o<0?(l+="-",l+=ce(Math.trunc(-s.o/60)),l+=":",l+=ce(Math.trunc(-s.o%60))):(l+="+",l+=ce(Math.trunc(s.o/60)),l+=":",l+=ce(Math.trunc(s.o%60)))),a&&(l+="["+s.zone.ianaName+"]"),l}var uv={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},gP={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},vP={ordinal:1,hour:0,minute:0,second:0,millisecond:0},cv=["year","month","day","hour","minute","second","millisecond"],yP=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],bP=["year","ordinal","hour","minute","second","millisecond"];function rv(s){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!e)throw new Fr(s);return e}function ov(s,e){let t=vn(e.zone,Xt.defaultZone),i=Jt.fromObject(e),r=Xt.now(),a,l;if(Nt(s.year))a=r;else{for(let m of cv)Nt(s[m])&&(s[m]=uv[m]);let u=fd(s)||hd(s);if(u)return Ot.invalid(u);let c=t.offset(r);[a,l]=ul(s,c,t)}return new Ot({ts:a,zone:t,loc:i,o:l})}function sv(s,e,t){let i=Nt(t.round)?!0:t.round,r=(l,u)=>(l=Br(l,i||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(l,u)),a=l=>t.calendary?e.hasSame(s,l)?0:e.startOf(l).diff(s.startOf(l),l).get(l):e.diff(s,l).get(l);if(t.unit)return r(a(t.unit),t.unit);for(let l of t.units){let u=a(l);if(Math.abs(u)>=1)return r(u,l)}return r(s>e?-0:0,t.units[t.units.length-1])}function av(s){let e={},t;return s.length>0&&typeof s[s.length-1]=="object"?(e=s[s.length-1],t=Array.from(s).slice(0,s.length-1)):t=Array.from(s),[e,t]}var Ot=class{constructor(e){let t=e.zone||Xt.defaultZone,i=e.invalid||(Number.isNaN(e.ts)?new Ie("invalid input"):null)||(t.isValid?null:sl(t));this.ts=Nt(e.ts)?Xt.now():e.ts;let r=null,a=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,a]=[e.old.c,e.old.o];else{let u=t.offset(this.ts);r=al(this.ts,u),i=Number.isNaN(r.year)?new Ie("invalid input"):null,r=i?null:r,a=i?null:u}this._zone=t,this.loc=e.loc||Jt.create(),this.invalid=i,this.weekData=null,this.c=r,this.o=a,this.isLuxonDateTime=!0}static now(){return new Ot({})}static local(){let[e,t]=av(arguments),[i,r,a,l,u,c,m]=t;return ov({year:i,month:r,day:a,hour:l,minute:u,second:c,millisecond:m},e)}static utc(){let[e,t]=av(arguments),[i,r,a,l,u,c,m]=t;return e.zone=de.utcInstance,ov({year:i,month:r,day:a,hour:l,minute:u,second:c,millisecond:m},e)}static fromJSDate(e,t={}){let i=pg(e)?e.valueOf():NaN;if(Number.isNaN(i))return Ot.invalid("invalid input");let r=vn(t.zone,Xt.defaultZone);return r.isValid?new Ot({ts:i,zone:r,loc:Jt.fromObject(t)}):Ot.invalid(sl(r))}static fromMillis(e,t={}){if(Pn(e))return e<-ev||e>ev?Ot.invalid("Timestamp out of range"):new Ot({ts:e,zone:vn(t.zone,Xt.defaultZone),loc:Jt.fromObject(t)});throw new xe(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Pn(e))return new Ot({ts:e*1e3,zone:vn(t.zone,Xt.defaultZone),loc:Jt.fromObject(t)});throw new xe("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};let i=vn(t.zone,Xt.defaultZone);if(!i.isValid)return Ot.invalid(sl(i));let r=Xt.now(),a=Nt(t.specificOffset)?i.offset(r):t.specificOffset,l=Gr(e,rv),u=!Nt(l.ordinal),c=!Nt(l.year),m=!Nt(l.month)||!Nt(l.day),v=c||m,E=l.weekYear||l.weekNumber,h=Jt.fromObject(t);if((v||u)&&E)throw new Wn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&u)throw new Wn("Can't mix ordinal dates with month/day");let b=E||l.weekday&&!v,w,P,C=al(r,a);b?(w=yP,P=gP,C=rl(C)):u?(w=bP,P=vP,C=ol(C)):(w=cv,P=uv);let O=!1;for(let y of w){let I=l[y];Nt(I)?O?l[y]=P[y]:l[y]=C[y]:O=!0}let x=b?Xg(l):u?tv(l):fd(l),g=x||hd(l);if(g)return Ot.invalid(g);let A=b?cd(l):u?dd(l):l,[f,p]=ul(A,a,i),S=new Ot({ts:f,zone:i,o:p,loc:h});return l.weekday&&v&&e.weekday!==S.weekday?Ot.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${S.toISO()}`):S}static fromISO(e,t={}){let[i,r]=Ig(e);return vs(i,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){let[i,r]=Mg(e);return vs(i,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){let[i,r]=Rg(e);return vs(i,r,t,"HTTP",t)}static fromFormat(e,t,i={}){if(Nt(e)||Nt(t))throw new xe("fromFormat requires an input string and a format");let{locale:r=null,numberingSystem:a=null}=i,l=Jt.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0}),[u,c,m,v]=Jg(l,e,t);return v?Ot.invalid(v):vs(u,c,i,`format ${t}`,e,m)}static fromString(e,t,i={}){return Ot.fromFormat(e,t,i)}static fromSQL(e,t={}){let[i,r]=Dg(e);return vs(i,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new xe("need to specify a reason the DateTime is invalid");let i=e instanceof Ie?e:new Ie(e,t);if(Xt.throwOnInvalid)throw new Ka(i);return new Ot({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){let i=ud(e,Jt.fromObject(t));return i?i.map(r=>r?r.val:null).join(""):null}static expandFormat(e,t={}){return ad(fe.parseFormat(e),Jt.fromObject(t)).map(r=>r.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?md(this).weekYear:NaN}get weekNumber(){return this.isValid?md(this).weekNumber:NaN}get weekday(){return this.isValid?md(this).weekday:NaN}get ordinal(){return this.isValid?ol(this.c).ordinal:NaN}get monthShort(){return this.isValid?Vn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Vn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Vn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Vn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,t=6e4,i=Ur(this.c),r=this.zone.offset(i-e),a=this.zone.offset(i+e),l=this.zone.offset(i-r*t),u=this.zone.offset(i-a*t);if(l===u)return[this];let c=i-l*t,m=i-u*t,v=al(c,l),E=al(m,u);return v.hour===E.hour&&v.minute===E.minute&&v.second===E.second&&v.millisecond===E.millisecond?[Yi(this,{ts:c}),Yi(this,{ts:m})]:[this]}get isInLeapYear(){return Ki(this.year)}get daysInMonth(){return $r(this.year,this.month)}get daysInYear(){return this.isValid?qi(this.year):NaN}get weeksInWeekYear(){return this.isValid?Hr(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:t,numberingSystem:i,calendar:r}=fe.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(de.instance(e),t)}toLocal(){return this.setZone(Xt.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if(e=vn(e,Xt.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||i){let a=e.offset(this.ts),l=this.toObject();[r]=ul(l,a,e)}return Yi(this,{ts:r,zone:e})}else return Ot.invalid(sl(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){let r=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i});return Yi(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let t=Gr(e,rv),i=!Nt(t.weekYear)||!Nt(t.weekNumber)||!Nt(t.weekday),r=!Nt(t.ordinal),a=!Nt(t.year),l=!Nt(t.month)||!Nt(t.day),u=a||l,c=t.weekYear||t.weekNumber;if((u||r)&&c)throw new Wn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&r)throw new Wn("Can't mix ordinal dates with month/day");let m;i?m=cd(lt(lt({},rl(this.c)),t)):Nt(t.ordinal)?(m=lt(lt({},this.toObject()),t),Nt(t.day)&&(m.day=Math.min($r(m.year,m.month),m.day))):m=dd(lt(lt({},ol(this.c)),t));let[v,E]=ul(m,this.o,this.zone);return Yi(this,{ts:v,o:E})}plus(e){if(!this.isValid)return this;let t=Bt.fromDurationLike(e);return Yi(this,nv(this,t))}minus(e){if(!this.isValid)return this;let t=Bt.fromDurationLike(e).negate();return Yi(this,nv(this,t))}startOf(e){if(!this.isValid)return this;let t={},i=Bt.normalizeUnit(e);switch(i){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break;case"milliseconds":break}if(i==="weeks"&&(t.weekday=1),i==="quarters"){let r=Math.ceil(this.month/3);t.month=(r-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?fe.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):pd}toLocaleString(e=ai,t={}){return this.isValid?fe.create(this.loc.clone(t),e).formatDateTime(this):pd}toLocaleParts(e={}){return this.isValid?fe.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:r=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;let l=e==="extended",u=gd(this,l);return u+="T",u+=iv(this,l,t,i,r,a),u}toISODate({format:e="extended"}={}){return this.isValid?gd(this,e==="extended"):null}toISOWeekDate(){return ll(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:r=!1,extendedZone:a=!1,format:l="extended"}={}){return this.isValid?(r?"T":"")+iv(this,l==="extended",t,e,i,a):null}toRFC2822(){return ll(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ll(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?gd(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(i&&(r+=" "),t?r+="z":e&&(r+="ZZ")),ll(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():pd}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let t=lt({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return Bt.invalid("created by diffing an invalid DateTime");let r=lt({locale:this.locale,numberingSystem:this.numberingSystem},i),a=mg(t).map(Bt.normalizeUnit),l=e.valueOf()>this.valueOf(),u=l?this:e,c=l?e:this,m=$g(u,c,a,r);return l?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(Ot.now(),e,t)}until(e){return this.isValid?ie.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;let i=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t)<=i&&i<=r.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let t=e.base||Ot.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0,r=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(r=e.unit,a=void 0),sv(t,this.plus(i),_t(lt({},e),{numeric:"always",units:r,unit:a}))}toRelativeCalendar(e={}){return this.isValid?sv(e.base||Ot.fromObject({},{zone:this.zone}),this,_t(lt({},e),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...e){if(!e.every(Ot.isDateTime))throw new xe("min requires all arguments be DateTimes");return Yc(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(Ot.isDateTime))throw new xe("max requires all arguments be DateTimes");return Yc(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,i={}){let{locale:r=null,numberingSystem:a=null}=i,l=Jt.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0});return ld(l,e,t)}static fromStringExplain(e,t,i={}){return Ot.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return ai}static get DATE_MED(){return Vo}static get DATE_MED_WITH_WEEKDAY(){return Nc}static get DATE_FULL(){return jo}static get DATE_HUGE(){return Jo}static get TIME_SIMPLE(){return Ko}static get TIME_WITH_SECONDS(){return qo}static get TIME_WITH_SHORT_OFFSET(){return Zo}static get TIME_WITH_LONG_OFFSET(){return Yo}static get TIME_24_SIMPLE(){return Qo}static get TIME_24_WITH_SECONDS(){return Xo}static get TIME_24_WITH_SHORT_OFFSET(){return ts}static get TIME_24_WITH_LONG_OFFSET(){return es}static get DATETIME_SHORT(){return ns}static get DATETIME_SHORT_WITH_SECONDS(){return is}static get DATETIME_MED(){return rs}static get DATETIME_MED_WITH_SECONDS(){return os}static get DATETIME_MED_WITH_WEEKDAY(){return Fc}static get DATETIME_FULL(){return ss}static get DATETIME_FULL_WITH_SECONDS(){return as}static get DATETIME_HUGE(){return ls}static get DATETIME_HUGE_WITH_SECONDS(){return us}};function Zr(s){if(Ot.isDateTime(s))return s;if(s&&s.valueOf&&Pn(s.valueOf()))return Ot.fromJSDate(s);if(s&&typeof s=="object")return Ot.fromObject(s);throw new xe(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var dv=Wt(It),EP=[dv.styles,Cc],Qi=class extends dv{constructor(){super();this.updateComment=({detail:t})=>{let{text:i}=t;this.text=i,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,text:i})};this.resolveAnnotation=t=>{t.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly"};this.resolved=!1}getAvatar(){var t;return this.avatar?ft` <div class="comment-item__avatar">
        <img src=${this.avatar} />
      </div>`:ft`<div class="comment-item__avatar">
      <p class="text text-bold">${((t=this.username[0])==null?void 0:t.toUpperCase())||"A"}</p>
    </div>`}render(){let t=this.annotationFilter==="all"?"resolve":"undo",i=b=>Ot.fromISO(b).toFormat("yyyy-dd-MM"),r=this.resolvable?"comment-item__resolve":"hidden",a=[{label:"EDIT"},{label:"DELETE"}],l=({detail:b})=>{b==="EDIT"&&(this.mode="editable"),b==="DELETE"&&(this.deleteCommentModalOpen=!0)},u=()=>{this.text.length<120||(this.expandElipsis=!0)},c=()=>{if(this.mode==="editable")return ft`
        <superviz-comments-comment-input
          class="comment-item--editable"
          editable
          @click=${b=>b.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{if(this.mode!=="editable")return ft`
        <span
          id="comment-text"
          @click=${u}
          class="text text-big sv-gray-700 ${h}"
          >${this.text}</span
        >
      `},v=()=>{this.deleteCommentModalOpen=!1},E={"comment-item":!0,reply:!this.primaryComment},h=!this.expandElipsis&&this.text.length>120?"line-clamp":"";return ft`
      <div class=${ee(E)}>
        <div class="comment-item__user">
          <div class="comment-item__user-details">
            ${this.getAvatar()}
            <span class="text text-bold sv-gray-600">${this.username}</span>
            <span class="text text-small sv-gray-500">${i(this.createdAt)}</span>
          </div>
          <div class="comment-item__actions">
            <button
              @click=${this.resolveAnnotation}
              class="icon-button icon-button--clickable icon-button--xsmall ${r}"
            >
              <superviz-icon name=${t} size="md"></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(a)}
              label="label"
              returnTo="label"
              position="bottom-left"
              @selected=${l}
              @click=${b=>b.stopPropagation()}
            >
              <button slot="dropdown" class="icon-button icon-button--clickable icon-button--small">
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comment-item__content">
          <div class="comment-item__content__body">${c()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${v}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};Qi.styles=EP,Qi.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String}},Qi=$t([Ht("superviz-comments-comment-item")],Qi);D();var fv=Wt(It),AP=[fv.styles,wc],Xi=class extends fv{constructor(){super();this.getSendBtn=()=>this.shadowRoot.querySelector(".comment-input--send-btn");this.sendEnter=t=>{if(t.key!=="Enter"||t.shiftKey)return;let i=this.commentInput,r=i.value.trim();if(!r)return;let a=this.getSendBtn();this.emitEvent(this.eventType,{text:r},{composed:!1,bubbles:!1}),i.value="",a.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1})};this.onTextareaFocus=()=>{let t=this.optionsContainer,i=this.horizontalRule;t.classList.add("active-textarea"),i.classList.add("active-hr")};this.onTextareaLoseFocus=()=>{let t=this.optionsContainer,i=this.horizontalRule;this.commentInput.value.length||(t.classList.remove("active-textarea"),i.classList.remove("active-hr"))};this.btnActive=!1,this.text=""}firstUpdated(t){this.emitEvent("comment-input-ready",{},{composed:!1,bubbles:!1})}get commentInput(){return this.shadowRoot.getElementById("comment-input--textarea")}get optionsContainer(){return this.shadowRoot.querySelector(".comment-input--options")}get horizontalRule(){return this.shadowRoot.querySelector(".sv-hr")}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&this.addEventListener("keyup",this.sendEnter)}disconnectedCallback(){super.disconnectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&this.removeEventListener("keyup",this.sendEnter)}updated(t){if(t.has("text")&&this.text.length>0){let i=this.commentInput;i.value=this.text,this.updateHeight()}if(t.has("btnActive")){let i=this.getSendBtn();i.disabled=!this.btnActive}}updateHeight(){let t=this.commentInput;t.style.height="40px";let i=t.scrollHeight+16;i===47&&(i=40),t.style.height=`${i}px`;let r=this.getSendBtn();r.disabled=!(t.value.length>0)}send(t){t.preventDefault();let i=this.commentInput,r=this.getSendBtn(),a=i.value;this.emitEvent(this.eventType,{text:a},{composed:!1,bubbles:!1}),i.value="",r.disabled=!0,this.updateHeight()}render(){var r;let t=()=>{if(!!this.editable)return ft`
        <button
          id="close"
          @click=${()=>this.closeEditMode()}
          class="icon-button icon-button--medium icon-button--clickable"
          @click=${this.send}
        >
          <superviz-icon name="close" size="md"></superviz-icon>
        </button>
        <button id="confirm" class="comment-input--send-btn" disabled @click=${this.send}>
          <superviz-icon name="check" size="md"></superviz-icon>
        </button>
      `},i=()=>{if(!this.editable)return ft`
        <button class="comment-input--send-btn align-send-btn" disabled @click=${this.send}>
          <superviz-icon name="line-arrow-right" size="sm" allowSetSize=${!0}></superviz-icon>
        </button>
      `};return ft`
      <div class="comment-input">
        <textarea
          id="comment-input--textarea"
          placeholder=${(r=this.placeholder)!=null?r:"Add comment..."}
          @input=${this.updateHeight}
          @focus=${this.onTextareaFocus}
          @blur=${this.onTextareaLoseFocus}
          spellcheck="false"
        ></textarea>
        <hr class="sv-hr" />
        <div class="comment-input--options">
          <div class="comment-input-options">
            ${i()} ${t()}
          </div>
        </div>
      </div>
    `}};Xi.styles=AP,Xi.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean},placeholder:{type:String}},Xi=$t([Ht("superviz-comments-comment-input")],Xi);D();var hv=Wt(It),TP=[hv.styles,Ic],tr=class extends hv{constructor(){super();this.focusInput=()=>{var t,i;this.inputElement||(this.inputElement=(i=(t=this.shadowRoot)==null?void 0:t.querySelector("superviz-comments-comment-input"))==null?void 0:i.shadowRoot.querySelector("textarea")),this.inputElement.focus()};this.setInputSide=()=>{let a=this.commentsSide==="right"?320:0,l=this.annotationSides.right+293,u=this.containerSides.right-a;if(l<u){this.horizontalSide="right";return}a=this.commentsSide==="left"?320:0;let c=this.annotationSides.left-293,m=this.containerSides.left+a;if(c>m){this.horizontalSide="left";return}this.horizontalSide=m-c>l-u?"right":"left"};this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:_t(lt({},t),{position:_t(lt({},this.originalPosition),{type:"canvas"})})})),this.annotation=null};this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null};this.avatar=()=>{if(this.type==="add"&&!this.showInput)return ft`<div class="annotation-pin__avatar annotation-pin__avatar--add">
        <superviz-icon name="add" allowSetSize="true"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?ft`<div class="annotation-pin__avatar">
        <img src=${t} />
      </div>`:ft`<div class="annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`};this.input=()=>{if(!(!this.showInput||this.annotationSent))return ft`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
      >
      </superviz-comments-comment-input>
    </div>`};this.position={x:0,y:0}}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var i;super.firstUpdated(t),this.showInput&&(this.originalPosition=lt({},this.position),this.pinAnnotation=(i=this.shadowRoot)==null?void 0:i.querySelector(".annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){super.connectedCallback(),this.type==="add"&&(window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}disconnectedCallback(){super.disconnectedCallback(),this.type==="add"&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,i,r,a;return((a=(r=(i=(t=this.annotation)==null?void 0:t.comments)==null?void 0:i.at(0))==null?void 0:r.participant)==null?void 0:a.avatar)||this.localAvatar}get userInitial(){var i,r,a,l,u;return(((u=(l=(a=(r=(i=this.annotation)==null?void 0:i.comments)==null?void 0:r.at(0))==null?void 0:a.participant)==null?void 0:l.name)!=null?u:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:(t=this.annotation)==null?void 0:t.uuid}}))}render(){let t={"annotation-pin":!0,"annotation-pin--active":this.active};t[this.horizontalSide]=!0;let i="";return this.keepPositionRatio?i=`top: ${this.position.y}%; left: ${this.position.x}%;`:i=`top: ${this.position.y}px; left: ${this.position.x}px;`,this.type==="add"?ft`
        <div class=${ee(t)} style=${i}>${this.avatar()} ${this.input()}</div>
      `:ft`
      <div @click=${this.emitClick} class=${ee(t)} style=${i}>${this.avatar()}</div>
    `}};tr.styles=TP,tr.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean}},tr=$t([Ht("superviz-comments-annotation-pin")],tr);D();var pv=Wt(It),OP=[pv.styles,Pc],er=class extends pv{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))};this.resolveAnnotation=({detail:t})=>{let{uuid:i}=this.annotation,{resolved:r,type:a}=t,l=a==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=r,this.emitEvent("resolve-annotation",{uuid:i,resolved:r}),l&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpantedCommentesTemplate=(t,i)=>{var r,a,l,u;return i===0?ft``:ft`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar=${(u=(l=(a=(r=this.annotation)==null?void 0:r.comments)==null?void 0:a.at(i))==null?void 0:l.participant)==null?void 0:u.avatar}
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
      ></superviz-comments-comment-item>
    `}}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHiddenAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{"annotation-item":!0,"annotation-item--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,hidden:!(!this.expandComments&&this.replies>=1)}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,hidden:!(this.isSelected&&this.expandComments)}}firstUpdated(){this.resolved=this.annotation.resolved}updated(t){if(t.has("selected")){let i=this.selected===this.annotation.uuid;this.expandComments=i}}createComment({detail:t}){let{text:i}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,text:i})}generateAvatarCommentsTemplate(){var i,r,a,l,u,c;let t=[];for(let m=1;m<=this.repliesSize;m++)(r=(i=this.annotation.comments[m])==null?void 0:i.participant)!=null&&r.avatar?t.push(ft`
          <div class="avatar">
            <img src=${(l=(a=this.annotation.comments[m])==null?void 0:a.participant)==null?void 0:l.avatar} />
          </div>
        `):t.push(ft`
          <div class="avatar">
            <p class="text text-bold">
              ${((c=(u=this.annotation.comments[m])==null?void 0:u.participant.name[0])==null?void 0:c.toUpperCase())||"A"}
            </p>
          </div>
        `);return ft`
      ${t}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?ft`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${ee({hidden:this.filterIsResolved})}
      >
      </superviz-comments-annotation-resolved>
    `:ft``}render(){var t,i,r,a,l,u,c,m,v,E;return ft`
      ${this.annotationResolvedTemplate()}

      <div class=${ee(this.shouldHiddenAnnotation)}>
        <div class=${ee(this.annotationClasses)} @click=${this.selectAnnotation}>
          <div>
            <superviz-comments-comment-item
              uuid=${(t=this.annotation.comments)==null?void 0:t[0].uuid}
              annotationId=${this.annotation.uuid}
              username=${((r=(i=this.annotation.comments)==null?void 0:i[0].participant)==null?void 0:r.name)||"Anonymous"}
              text=${(a=this.annotation.comments)==null?void 0:a[0].text}
              createdAt=${(l=this.annotation.comments)==null?void 0:l[0].createdAt}
              primaryComment
              avatar=${(v=(m=(c=(u=this.annotation)==null?void 0:u.comments)==null?void 0:c.at(0))==null?void 0:m.participant)==null?void 0:v.avatar}
              resolvable
              ?resolved=${this.resolved}
              annotationFilter=${this.annotationFilter}
              @resolve-annotation=${this.resolveAnnotation}
            ></superviz-comments-comment-item>

            <div class=${ee(this.avatarCommentsClasses)}>
              <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
            </div>
          </div>

          <div class=${ee(this.commentsClasses)}>
            ${(E=this.annotation.comments)==null?void 0:E.map(this.generateExpantedCommentesTemplate)}
            <superviz-comments-comment-input
              @create-comment=${this.createComment}
              eventType="create-comment"
              @click=${h=>h.stopPropagation()}
              placeholder="Reply"
            ></superviz-comments-comment-input>
          </div>
        </div>
        <div class=${ee(this.hrClasses)}></div>
      </div>
    `}};er.styles=OP,er.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String}},er=$t([Ht("superviz-comments-annotation-item")],er);D();var mv=Wt(It),CP=[mv.styles],nr=class extends mv{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:ft`<span class="text text-big sv-gray-600">Are you sure you want to delete this comment? <br /> This action cannot be undone</span>`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return ft`<slot name="modal-handler" @click=${this.toggle}></slot>`},i=()=>{if(!!this.open)return ft`
        <superviz-modal></superviz-modal>
      `};return ft`
      ${t()}
      ${i()}
    `}};nr.styles=CP,nr.properties={open:{type:Boolean},useSlot:{type:Boolean}},nr=$t([Ht("superviz-comments-delete-comments-modal")],nr);D();var gv=Wt(It),SP=[gv.styles,xc],wP=10*1e3,ir=class extends gv{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=wP,this.isCanceled=!1}firstUpdated(){this.setTimer()}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?ft``:this.isCanceled?ft``:ft`
      <div class="annotation-resolved">
        <span class="text text-big sv-gray-700">You resolved this comment</span>
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};ir.styles=SP,ir.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},ir=$t([Ht("superviz-comments-annotation-resolved")],ir);D();var vv=Wt(It),PP=[vv.styles,Mc],ys=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],rr=class extends vv{constructor(){super();this.caret="down"}render(){let t=this.filter==="all"?ys[0].label:ys[1].label,i=({detail:u})=>{this.emitEvent("select",{filter:u}),r()},r=()=>{this.caret=this.caret==="down"?"up":"down"},a=this.filter==="all"?ys[0].code:ys[1].code,l={text:!0,"text-bold":!0,"select-content":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return ft`
      <div class="select">
        <div class="select-container">
          <superviz-dropdown
            options=${JSON.stringify(ys)}
            active=${a}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${r}
            @selected=${i}
            @close=${r}
          >
            <div class="content" slot="dropdown">
              <span class=${ee(l)}>${t}</span>
              <superviz-icon name=${this.caret} size="md"></superviz-icon>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};rr.styles=PP,rr.properties={filter:{type:String},caret:{type:String}},rr=$t([Ht("superviz-comments-annotation-filter")],rr);D();var yv=Wt(It),xP=[yv.styles,Rc],or=class extends yv{constructor(){super();this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden})}updated(t){super.updated(t),this.updateComplete.then(()=>{let i=this.shadowRoot.querySelector(".float-button");if(!i)return;i.setAttribute("style",this.positionStyles);let r=window.document.body.getBoundingClientRect().width,a=i.getBoundingClientRect(),l=320;if(!this.commentsPosition||this.commentsPosition==="left"){this.shouldHide=a.x<l;return}this.shouldHide=r-a.right<l})}render(){let t={"float-button":!0,"hide-button":!this.isHidden&&this.shouldHide};return ft` <button @click=${this.toggle} class="${ee(t)}">
      <superviz-icon allowSetSize=${!0} size="sm" name="comment"></superviz-icon>

      <p class="text text-big text-bold">Comments</p>
    </button>`}};or.styles=xP,or.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String}},or=$t([Ht("superviz-comments-button")],or);D();D();D();var bs=(m=>(m.GOTO="go to",m.LOCAL_FOLLOW="follow",m.LOCAL_UNFOLLOW="unfollow",m.FOLLOW="everyone follows me",m.UNFOLLOW="stop followers",m.PRIVATE="private mode",m.LEAVE_PRIVATE="leave private mode",m.GATHER="gather all",m.STOP_GATHER="stop gather all",m))(bs||{});D();D();var vd=xt`
  .superviz-who-is-online {
    display: flex;
    align-items: center;
    gap: 4px;
    position: relative;
  }

  .wio-content {
    display: flex;
    flex-direction: column;
    position: fixed;
    z-index: 99;
  }

  .superviz-who-is-online__participant {
    --border-color: #aea9b8;

    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    cursor: pointer;
    transition: opacity 0.3s ease-in-out;
  }

  .superviz-who-is-online__participant:before {
    content: '';
    position: absolute;
    width: 40px;
    height: 40px;
    box-sizing: border-box;
    border-radius: 50%;
    border: 2px solid var(--border-color);
  }

  .followed:before {
    border-style: dashed !important;
    animation: rotate 15s linear infinite;
  }

  .private {
    opacity: 0.3;
  }

  @keyframes rotate {
    100% {
      transform: rotate(1turn);
    }
  }

  .superviz-who-is-online__participant.disable-dropdown {
    cursor: default;
  }

  .message {
    box-sizing: border-box;
    margin-top: 9px;
    font-size: 12px;
    padding: 8px 10px;
    font-family: 'Roboto';
    border-radius: 6px;
    align-self: flex-end;
    background-color: #fff;
    color: rgb(var(--sv-gray-700));

    border: 2px solid #e0e0e0;
  }

  .message span {
    margin-left: 3px;
    text-decoration: underline;
    cursor: pointer;
  }

  .superviz-who-is-online__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 18px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .superviz-who-is-online__excess {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Roboto;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
    color: #26242a;
    cursor: pointer;
  }

  .excess_participants:hover,
  .excess_participants--open {
    background-color: #aea9b8 !important;
  }

  .excess_participants:hover > div,
  .excess_participants--open > div {
    color: #fff !important;
  }

  @media (max-width: 780px) {
    .superviz-who-is-online__participant,
    .superviz-who-is-online__participant::before {
      width: 32px;
      height: 32px;
    }

    .superviz-who-is-online__avatar {
      width: 24px;
      height: 24px;
    }

    .superviz-who-is-online {
      gap: 8px;
    }
  }
`;D();var yd=xt`
  .dropdown {
    position: relative;
  }

  .who-is-online-dropdown__content {
    display: flex;
    user-select: none;
    align-items: center;
    justify-items: start;
    gap: 4px;
    width: 100%;
    padding: 10px;
    border-radius: 2px;
    position: relative;
    cursor: pointer;
  }

  .who-is-online-dropdown__content.disable-dropdown {
    cursor: default;
  }

  .who-is-online-dropdown__content:hover,
  .who-is-online-dropdown__content--selected {
    background-color: rgb(var(--sv-gray-200));
  }

  .who-is-online-dropdown__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .who-is-online-dropdown__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 14px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .dropdown-list {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .dropdown-list > div {
    padding: 4px;
    min-width: 216px;
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .menu--bottom {
    top: 4px;
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .menu--top {
    bottom: 44px;
    min-width: 103px;
    position: absolute;
    right: 0px;
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .superviz-who-is-online-dropdown__tooltip {
    background-color: rgb(var(--sv-gray-600));
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: absolute;
    top: 52px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 2px;
    opacity: 0;
    cursor: default;
    display: none;
    transition: opacity 0.2s ease-in-out display 0s;
  }

  .superviz-who-is-online-dropdown__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    top: 0px;
    left: 50%;
    transform: rotate(45deg) translateX(-50%);
    background-color: rgb(var(--sv-gray-600));
    border-top-left-radius: 3px;
  }

  .dropdown-content:hover + .superviz-who-is-online-dropdown__tooltip {
    opacity: 1;
    display: block;
  }

  .tooltip-content {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
    color: white;
    font-size: 14px;
  }

  .user-name {
    font-size: 14px;
    line-height: 20px;
    font-family: 'Open sans';
    color: rgb(var(--sv-gray-600));
  }

  .icon {
    flex: 1;
    justify-content: flex-end;
    display: flex;
  }

  .hide-icon {
    display: none;
  }

  @media (max-width: 780px) {
    .sv-icon,
    .who-is-online-dropdown__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online-dropdown__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online-dropdown__avatar {
      width: 24px;
      height: 24px;
    }

    .dropdown-list > div {
      min-width: 192px;
    }

    .menu--top {
      bottom: 36px;
    }

    .superviz-who-is-online-dropdown__tooltip {
      top: 44px;
    }
  }
`;var bv=Wt(It),IP=[bv.styles,vd],sr=class extends bv{constructor(){super();this.onClickOutDropdown=({detail:t})=>{this.open=t.open};this.dropdownOptionsHandler=({detail:t})=>{var c;let{id:i,label:r,name:a,color:l,slotIndex:u}=t;if(r==="go to"&&this.emitEvent("realtime.go-to-participant",{id:i}),["follow","unfollow"].includes(r)){if(((c=this.following)==null?void 0:c.id)===i){this.stopFollowing();return}this.following={name:a,id:i,color:l},this.swapParticipantBeingFollowedPosition(),this.emitEvent("realtime.local-follow-participant",{id:i})}if(["private mode","leave private mode"].includes(r)&&(this.isPrivate=r==="private mode",this.emitEvent("realtime.private-mode",{id:i,isPrivate:this.isPrivate}),this.everyoneFollowsMe=!1),["everyone follows me","stop followers"].includes(r)){if(this.following&&this.stopFollowing(),this.everyoneFollowsMe){this.stopEveryoneFollowsMe();return}this.everyoneFollowsMe=!0,this.following=void 0,this.emitEvent("realtime.follow-participant",{id:i,name:a,color:l,slotIndex:u})}r==="gather all"&&this.emitEvent("realtime.gather",{id:i})};this.toggleShowTooltip=()=>{this.showTooltip=!this.showTooltip};this.position="top: 20px; right: 40px;",this.showTooltip=!0,this.open=!1,this.textColorValues=[2,4,5,7,8,16]}updateParticipants(t){this.participants=t}toggleOpen(){this.open=!this.open}dropdownPosition(t){if(this.participants.length===1)return"bottom-center";if(t===0)return"bottom-right";let i=this.participants.length>4,r=t+1===this.participants.length;return i||!r?"bottom-center":"bottom-left"}renderExcessParticipants(){var l;let t=this.participants.length-4;if(t<=0)return ft``;let i=this.participants.slice(4).map(({name:u,color:c,id:m,slotIndex:v,isLocal:E,avatar:h,joinedPresence:b})=>({name:u,color:c,id:m,slotIndex:v,avatar:h,isLocal:E,joinedPresence:b})),r={"superviz-who-is-online__participant":!0,excess_participants:!0,"excess_participants--open":this.open};return ft`
      <superviz-who-is-online-dropdown
        label="label"
        returnTo="label"
        position="bottom"
        @selected=${this.dropdownOptionsHandler}
        participants=${JSON.stringify(i)}
        @clickout=${this.onClickOutDropdown}
        ?disableDropdown=${this.disableDropdown}
        following=${JSON.stringify(this.following)}
        ?showSeeMoreTooltip=${this.showTooltip}
        @toggle=${this.toggleOpen}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        ?localParticipantJoinedPresence=${(l=this.localParticipantData)==null?void 0:l.joinedPresence}
      >
        <div class=${ee(r)} slot="dropdown">
          <div class="superviz-who-is-online__excess" style="color: #AEA9B8;">+${t}</div>
        </div>
      </superviz-who-is-online-dropdown>
    `}stopEveryoneFollowsMe(){this.everyoneFollowsMe=!1,this.emitEvent("realtime.follow-participant",void 0)}getAvatar(t){var r,a;if((r=t.avatar)!=null&&r.imageUrl)return ft` <img
        class="superviz-who-is-online__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let i=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A";return ft`<div
      class="superviz-who-is-online__avatar"
      style="background-color: ${t.color}; color: ${i}"
    >
      ${(a=t.name)==null?void 0:a.at(0).toUpperCase()}
    </div>`}getOptions(t,i,r){let{id:a,slotIndex:l,name:u,color:c}=t,m={id:a,name:u,color:c,slotIndex:l},{isPrivate:v}=this;return(r?["GATHER",this.everyoneFollowsMe?"UNFOLLOW":"FOLLOW",v?"LEAVE_PRIVATE":"PRIVATE"]:["GOTO",i?"LOCAL_UNFOLLOW":"LOCAL_FOLLOW"]).map(b=>_t(lt({},m),{label:bs[b]}))}getIcons(t,i){return t?["gather",this.everyoneFollowsMe?"send-off":"send","eye_inative"]:["place",i?"send-off":"send"]}putLocalParticipationFirst(){var a;if(this.participants[0].isLocal)return;let t=(a=this.participants)==null?void 0:a.find(({isLocal:l})=>l);if(!t)return;let i=[...this.participants],r=i.indexOf(t);i.splice(r,1),i.unshift(t),this.participants=i}swapParticipantBeingFollowedPosition(){var l;let t=(l=this.participants)==null?void 0:l.findIndex(({id:u})=>{var c;return u===((c=this.following)==null?void 0:c.id)}),i=1;if(t<4||!t)return;let r=[...this.participants],a=r[t];r[t]=r[i],r[i]=a,this.participants=r}stopFollowing(){this.following=void 0,this.emitEvent("realtime.local-follow-participant",{id:void 0})}cancelPrivate(){this.isPrivate=void 0,this.emitEvent("realtime.private-mode",{id:this.localParticipantData.id})}followingMessage(){if(!this.following)return"";let{name:t,color:i}=this.following;return ft`<div class="message" style="border-color: ${i}">
      Following: ${t} <span @click=${this.stopFollowing}>Stop</span>
    </div>`}everyoneFollowsMeMessage(){if(!this.everyoneFollowsMe)return"";let{color:t}=this.localParticipantData;return ft`<div class="message" style="border-color: ${t}">
      Everyone is following you <span @click=${this.stopEveryoneFollowsMe}>Stop</span>
    </div>`}privateMessage(){if(!this.isPrivate)return"";let{color:t}=this.localParticipantData;return ft`<div class="message" style="border-color: ${t}">
      You are in Private Mode <span @click=${this.cancelPrivate}>Cancel</span>
    </div>`}renderParticipants(){return this.participants?(this.putLocalParticipationFirst(),this.swapParticipantBeingFollowedPosition(),ft`<div class="superviz-who-is-online">
      ${Nr(this.participants.slice(0,4),t=>t.id,(t,i)=>{var x,g;let{joinedPresence:r,isLocal:a,id:l,name:u,color:c}=t,m=((x=this.following)==null?void 0:x.id)===l,v=this.getOptions(t,m,a),E=this.getIcons(a,m),h=this.dropdownPosition(i),b=!r||this.disableDropdown,w={"superviz-who-is-online__participant":!0,"disable-dropdown":b,followed:m||a&&this.everyoneFollowsMe,private:a&&this.isPrivate},C=u+(a?" (you)":""),O={name:u};return((g=this.localParticipantData)==null?void 0:g.joinedPresence)&&r&&!a&&(O.action="Click to Follow"),a&&(O.action="You"),ft`
            <superviz-dropdown
              options=${JSON.stringify(v)}
              label="label"
              position="${h}"
              @selected=${this.dropdownOptionsHandler}
              @toggle-dropdown-state=${this.toggleShowTooltip}
              icons="${JSON.stringify(E)}"
              name="${C}"
              ?disabled=${b}
              ?canShowTooltip=${this.showTooltip}
              onHoverData=${JSON.stringify(O)}
            >
              <div slot="dropdown" class=${ee(w)} style="--border-color: ${c}">
                ${this.getAvatar(t)}
              </div>
            </superviz-dropdown>
          `})}
      ${this.renderExcessParticipants()}
    </div>`):ft``}updated(t){super.updated(t),this.updateComplete.then(()=>{let i=this.shadowRoot.querySelector(".wio-content");if(!i)return;let r=this.position.includes("left")?"flex-start":"flex-end",a=`${this.position} align-items: ${r};`;i.setAttribute("style",a)})}render(){return ft`<div class="wio-content">
      ${this.renderParticipants()} ${this.followingMessage()} ${this.everyoneFollowsMeMessage()}
      ${this.privateMessage()}
    </div> `}};sr.styles=IP,sr.properties={position:{type:String},participants:{type:Object},open:{type:Boolean},disableDropdown:{type:Boolean},following:{type:Object},localParticipantColor:{type:String},isPrivate:{type:Boolean},everyoneFollowsMe:{type:Boolean},showTooltip:{type:Boolean}},sr=$t([Ht("superviz-who-is-online")],sr);D();D();var Ev=Wt(It),MP=[Ev.styles,yd],ar=class extends Ev{constructor(){super();this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let i=t.composedPath(),r=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],c=i.includes(r),m=i.includes(a),v=i.includes(u);c||m||v||this.close()};this.close=()=>{this.open=!1,this.selected="",this.emitEvent("clickout",{bubbles:!1,composed:!1})};this.selectParticipant=t=>()=>{this.selected=t};this.toggleShowTooltip=()=>{this.showParticipantTooltip=!this.showParticipantTooltip};this.adjustPosition=()=>{let{top:t,bottom:i}=this.dropdownBounds,{innerHeight:r}=window,a=this.positionAction();if(a===0)return;if(a===1){let m=this.originalPosition.split("-")[0];this.position=this.position.replace(/top|bottom/,m);return}let l=r-i>t?"bottom":"top",u=this.position.split("-")[0],c=this.position.replace(u,l);this.position=c};this.tooltip=()=>this.showSeeMoreTooltip?ft`<superviz-tooltip
      tooltipData=${JSON.stringify({name:"See more"})}
    ></superviz-tooltip>`:"";this.textColorValues=[2,4,5,7,8,16],this.selected="",this.showParticipantTooltip=!0}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:"toggle"}),this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown)}}getAvatar(t){var r,a;if((r=t.avatar)!=null&&r.imageUrl)return ft` <img
        class="who-is-online-dropdown__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let i=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A";return ft`<div
      class="who-is-online-dropdown__avatar"
      style="background-color: ${t.color}; color: ${i}"
    >
      ${(a=t.name)==null?void 0:a.at(0).toUpperCase()}
    </div>`}renderParticipants(){if(!this.participants)return;let t=["place","send"];return Nr(this.participants,i=>i.id,i=>{var C,O;let{id:r,slotIndex:a,joinedPresence:l,isLocal:u,color:c,name:m}=i,v=!l||u||this.disableDropdown,E={"who-is-online-dropdown__content":!0,"who-is-online-dropdown__content--selected":this.selected===r,"disable-dropdown":v,followed:((C=this.following)==null?void 0:C.id)===r},h={icon:!0,"hide-icon":v},b=((O=this.following)==null?void 0:O.id)===r,w=Object.values(bs).map((x,g)=>({label:b&&g?"UNFOLLOW":x,id:r,name:m,color:c,slotIndex:a})).slice(0,2),P={name:m};return this.localParticipantJoinedPresence&&l&&(P.action="Click to Follow"),ft`
        <superviz-dropdown
        options=${JSON.stringify(w)}
        label="label"
        position="bottom-right"
        @selected=${this.close}
        icons="${JSON.stringify(t)}"
        ?disabled=${v}
        onHoverData=${JSON.stringify(P)}
        ?canShowTooltip=${this.showParticipantTooltip}
        ?shiftTooltipLeft=${!0}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        >
        <div 
          class=${ee(E)} 
          @click=${this.selectParticipant(r)} slot="dropdown">
          <div class="who-is-online-dropdown__participant" style="border-color: 
          ${c}">
              ${this.getAvatar(i)}
            </div>
            <span class="user-name">${m}</span>
            <superviz-icon 
              class=${ee(h)} 
              name="right" 
              color="var(--sv-gray-600)">
          </superviz-icon>
          </div>
        </div>
      </superviz-dropdown>
      `})}setMenu(){var t;if(!this.menu){this.menu=this.shadowRoot.querySelector(".menu");let i={rootMargin:"0px",threshold:1},r=new IntersectionObserver(this.adjustPosition,i),a=new ResizeObserver(this.adjustPosition),l=this.menu;r.observe(l),a.observe((t=this.scrollableParent)!=null?t:document.body)}}get scrollableParent(){let t;this.host||(this.host=this.getRootNode().host);let i=this.host;for(;!t;){let r=i==null?void 0:i.parentElement;if(this.isScrollable(r)){t=r;break}if(i=r,!i)break}return t}isScrollable(t){if(!t)return!1;let i=t.scrollHeight>t.clientHeight,r=window.getComputedStyle(t).overflowY,a=window.getComputedStyle(t).overflowX,l=r.indexOf("hidden")!==-1,u=a.indexOf("hidden")!==-1;return i&&!l&&!u}get dropdownBounds(){this.dropdownContent||(this.dropdownContent=this.shadowRoot.querySelector(".dropdown-content"));let t=this.dropdownContent.getBoundingClientRect(),{y:i,height:r}=this.menu.getBoundingClientRect();return{top:i,bottom:i+r+4,height:r+4,contentY:t.y}}shouldUseOriginalVertical(){let{height:t,contentY:i}=this.dropdownBounds,{innerHeight:r}=window,a=i+t;return this.originalPosition.includes("bottom")?t+a<r:i-t>0}positionAction(){let{top:t,bottom:i}=this.dropdownBounds,{innerHeight:r}=window,a=i>r,l=t<0;return a&&this.position.includes("bottom")||l&&this.position.includes("top")?2:!a&&!l&&this.shouldUseOriginalVertical()?1:0}toggle(){this.originalPosition||(this.originalPosition=this.position),this.setMenu(),this.open=!this.open,this.open&&(this.selected="",setTimeout(()=>this.adjustPosition()))}get menuClasses(){return{menu:!0,"menu--bottom":this.position==="bottom","menu--top":this.position==="top","menu-open":this.open}}render(){return ft`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${ee(this.menuClasses)}>${this.renderParticipants()}</div>
      </div>
    `}};ar.styles=MP,ar.properties={open:{type:Boolean},align:{type:String},position:{type:String},participants:{type:Array},selected:{type:String},disableDropdown:{type:Boolean},following:{type:Object},showSeeMoreTooltip:{type:Boolean},showParticipantTooltip:{type:Boolean},localParticipantJoinedPresence:{type:Boolean}},ar=$t([Ht("superviz-who-is-online-dropdown")],ar);D();D();function Av(s){if(typeof document!="undefined"){let e=document.createElement("style");e.id="superviz-style";let t=document.createTextNode(s);e.appendChild(t),document.head.appendChild(e)}}var Tv=`@import"https://unpkg.com/@superviz/sv-icons@0.8.10/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:17px;width:17px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg)}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:yellow;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2;transition:all .3s ease-in-out}
`;Av(Tv);D();D();D();window&&(window.SuperVizRoom={init:Yu,MeetingEvent:mo,DeviceEvent:Mu,RealtimeEvent:Cn,MeetingState:ca,MeetingConnectionStatus:vo,MeetingControlsEvent:ua,ParticipantEvent:da,FrameEvent:go,LayoutMode:ya,VideoConference:Io,MousePointers:Mo,Realtime:Ro,Comments:Eo,CanvasPin:Oo,HTMLPin:Co,WhoIsOnline:_o,ParticipantType:Ar,LayoutPosition:Po,CamerasPosition:ba,RealtimeComponentState:Aa,RealtimeComponentEvent:Ta});var TU=Yu;export{wo as BrowserService,ba as CamerasPosition,Mu as DeviceEvent,go as FrameEvent,ya as LayoutMode,Po as LayoutPosition,vo as MeetingConnectionStatus,ua as MeetingControlsEvent,mo as MeetingEvent,ca as MeetingState,At as Observer,da as ParticipantEvent,Ar as ParticipantType,To as PinMode,Ta as RealtimeComponentEvent,Aa as RealtimeComponentState,Cn as RealtimeEvent,TU as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
