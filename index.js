var XO=Object.create;var fo=Object.defineProperty,tS=Object.defineProperties,qh=Object.getOwnPropertyDescriptor,eS=Object.getOwnPropertyDescriptors,nS=Object.getOwnPropertyNames,oa=Object.getOwnPropertySymbols,rS=Object.getPrototypeOf,Su=Object.prototype.hasOwnProperty,Zh=Object.prototype.propertyIsEnumerable;var Yh=Math.pow,Kh=(s,e,t)=>e in s?fo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,dt=(s,e)=>{for(var t in e||(e={}))Su.call(e,t)&&Kh(s,t,e[t]);if(oa)for(var t of oa(e))Zh.call(e,t)&&Kh(s,t,e[t]);return s},jt=(s,e)=>tS(s,eS(e));var Tu=(s,e)=>{var t={};for(var r in s)Su.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&oa)for(var r of oa(s))e.indexOf(r)<0&&Zh.call(s,r)&&(t[r]=s[r]);return t};var wu=(s,e)=>()=>(s&&(e=s(s=0)),e);var ve=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Qh=(s,e)=>{for(var t in e)fo(s,t,{get:e[t],enumerable:!0})},iS=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of nS(e))!Su.call(s,i)&&i!==t&&fo(s,i,{get:()=>e[i],enumerable:!(r=qh(e,i))||r.enumerable});return s};var On=(s,e,t)=>(t=s!=null?XO(rS(s)):{},iS(e||!s||!s.__esModule?fo(t,"default",{value:s,enumerable:!0}):t,s));var kt=(s,e,t,r)=>{for(var i=r>1?void 0:r?qh(e,t):e,a=s.length-1,l;a>=0;a--)(l=s[a])&&(i=(r?l(e,t,i):l(i))||i);return r&&i&&fo(e,t,i),i};var _t=(s,e,t)=>new Promise((r,i)=>{var a=d=>{try{u(t.next(d))}catch(m){i(m)}},l=d=>{try{u(t.throw(d))}catch(m){i(m)}},u=d=>d.done?r(d.value):Promise.resolve(d.value).then(a,l);u((t=t.apply(s,e)).next())});var Q,N=wu(()=>{Q={}});var tp=ve((L1,Xh)=>{N();var Ai=1e3,Oi=Ai*60,Si=Oi*60,Ar=Si*24,sS=Ar*7,aS=Ar*365.25;Xh.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return lS(s);if(t==="number"&&isFinite(s))return e.long?cS(s):uS(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function lS(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*aS;case"weeks":case"week":case"w":return t*sS;case"days":case"day":case"d":return t*Ar;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Si;case"minutes":case"minute":case"mins":case"min":case"m":return t*Oi;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ai;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function uS(s){var e=Math.abs(s);return e>=Ar?Math.round(s/Ar)+"d":e>=Si?Math.round(s/Si)+"h":e>=Oi?Math.round(s/Oi)+"m":e>=Ai?Math.round(s/Ai)+"s":s+"ms"}function cS(s){var e=Math.abs(s);return e>=Ar?ua(s,e,Ar,"day"):e>=Si?ua(s,e,Si,"hour"):e>=Oi?ua(s,e,Oi,"minute"):e>=Ai?ua(s,e,Ai,"second"):s+" ms"}function ua(s,e,t,r){var i=e>=t*1.5;return Math.round(s/t)+" "+r+(i?"s":"")}});var np=ve((N1,ep)=>{N();function dS(s){t.debug=t,t.default=t,t.coerce=d,t.disable=a,t.enable=i,t.enabled=l,t.humanize=tp(),t.destroy=m,Object.keys(s).forEach(y=>{t[y]=s[y]}),t.names=[],t.skips=[],t.formatters={};function e(y){let C=0;for(let h=0;h<y.length;h++)C=(C<<5)-C+y.charCodeAt(h),C|=0;return t.colors[Math.abs(C)%t.colors.length]}t.selectColor=e;function t(y){let C,h=null,E,w;function x(...S){if(!x.enabled)return;let O=x,P=Number(new Date),g=P-(C||P);O.diff=g,O.prev=C,O.curr=P,C=P,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let b=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(p,T)=>{if(p==="%%")return"%";b++;let v=t.formatters[T];if(typeof v=="function"){let I=S[b];p=v.call(O,I),S.splice(b,1),b--}return p}),t.formatArgs.call(O,S),(O.log||t.log).apply(O,S)}return x.namespace=y,x.useColors=t.useColors(),x.color=t.selectColor(y),x.extend=r,x.destroy=t.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(E!==t.namespaces&&(E=t.namespaces,w=t.enabled(y)),w),set:S=>{h=S}}),typeof t.init=="function"&&t.init(x),x}function r(y,C){let h=t(this.namespace+(typeof C=="undefined"?":":C)+y);return h.log=this.log,h}function i(y){t.save(y),t.namespaces=y,t.names=[],t.skips=[];let C,h=(typeof y=="string"?y:"").split(/[\s,]+/),E=h.length;for(C=0;C<E;C++)!h[C]||(y=h[C].replace(/\*/g,".*?"),y[0]==="-"?t.skips.push(new RegExp("^"+y.slice(1)+"$")):t.names.push(new RegExp("^"+y+"$")))}function a(){let y=[...t.names.map(u),...t.skips.map(u).map(C=>"-"+C)].join(",");return t.enable(""),y}function l(y){if(y[y.length-1]==="*")return!0;let C,h;for(C=0,h=t.skips.length;C<h;C++)if(t.skips[C].test(y))return!1;for(C=0,h=t.names.length;C<h;C++)if(t.names[C].test(y))return!0;return!1}function u(y){return y.toString().substring(2,y.toString().length-2).replace(/\.\*\?$/,"*")}function d(y){return y instanceof Error?y.stack||y.message:y}function m(){}return t.enable(t.load()),t}ep.exports=dS});var Iu=ve((Ke,ca)=>{N();Ke.formatArgs=hS;Ke.save=pS;Ke.load=mS;Ke.useColors=fS;Ke.storage=gS();Ke.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Ke.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function fS(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function hS(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+ca.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),s.splice(r,0,e)}Ke.log=console.debug||console.log||(()=>{});function pS(s){try{s?Ke.storage.setItem("debug",s):Ke.storage.removeItem("debug")}catch(e){}}function mS(){let s;try{s=Ke.storage.getItem("debug")}catch(e){}return!s&&typeof process!="undefined"&&"env"in process&&(s=Q.DEBUG),s}function gS(){try{return localStorage}catch(s){}}ca.exports=np()(Ke);var{formatters:vS}=ca.exports;vS.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var da=ve((F1,ip)=>{N();function yS(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}ip.exports=yS});var sp=ve((U1,op)=>{N();var bS=typeof global=="object"&&global&&global.Object===Object&&global;op.exports=bS});var Pu=ve((B1,ap)=>{N();var ES=sp(),CS=typeof self=="object"&&self&&self.Object===Object&&self,AS=ES||CS||Function("return this")();ap.exports=AS});var up=ve((k1,lp)=>{N();var OS=Pu(),SS=function(){return OS.Date.now()};lp.exports=SS});var dp=ve(($1,cp)=>{N();var TS=/\s/;function wS(s){for(var e=s.length;e--&&TS.test(s.charAt(e)););return e}cp.exports=wS});var hp=ve((H1,fp)=>{N();var xS=dp(),IS=/^\s+/;function PS(s){return s&&s.slice(0,xS(s)+1).replace(IS,"")}fp.exports=PS});var Ru=ve((G1,pp)=>{N();var RS=Pu(),MS=RS.Symbol;pp.exports=MS});var yp=ve((W1,vp)=>{N();var mp=Ru(),gp=Object.prototype,_S=gp.hasOwnProperty,LS=gp.toString,go=mp?mp.toStringTag:void 0;function NS(s){var e=_S.call(s,go),t=s[go];try{s[go]=void 0;var r=!0}catch(a){}var i=LS.call(s);return r&&(e?s[go]=t:delete s[go]),i}vp.exports=NS});var Ep=ve((z1,bp)=>{N();var DS=Object.prototype,FS=DS.toString;function US(s){return FS.call(s)}bp.exports=US});var Sp=ve((V1,Op)=>{N();var Cp=Ru(),BS=yp(),kS=Ep(),$S="[object Null]",HS="[object Undefined]",Ap=Cp?Cp.toStringTag:void 0;function GS(s){return s==null?s===void 0?HS:$S:Ap&&Ap in Object(s)?BS(s):kS(s)}Op.exports=GS});var wp=ve((j1,Tp)=>{N();function WS(s){return s!=null&&typeof s=="object"}Tp.exports=WS});var Ip=ve((J1,xp)=>{N();var zS=Sp(),VS=wp(),jS="[object Symbol]";function JS(s){return typeof s=="symbol"||VS(s)&&zS(s)==jS}xp.exports=JS});var _p=ve((K1,Mp)=>{N();var KS=hp(),Pp=da(),qS=Ip(),Rp=0/0,ZS=/^[-+]0x[0-9a-f]+$/i,YS=/^0b[01]+$/i,QS=/^0o[0-7]+$/i,XS=parseInt;function tT(s){if(typeof s=="number")return s;if(qS(s))return Rp;if(Pp(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=Pp(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=KS(s);var t=YS.test(s);return t||QS.test(s)?XS(s.slice(2),t?2:8):ZS.test(s)?Rp:+s}Mp.exports=tT});var Dp=ve((q1,Np)=>{N();var eT=da(),Mu=up(),Lp=_p(),nT="Expected a function",rT=Math.max,iT=Math.min;function oT(s,e,t){var r,i,a,l,u,d,m=0,y=!1,C=!1,h=!0;if(typeof s!="function")throw new TypeError(nT);e=Lp(e)||0,eT(t)&&(y=!!t.leading,C="maxWait"in t,a=C?rT(Lp(t.maxWait)||0,e):a,h="trailing"in t?!!t.trailing:h);function E(p){var T=r,v=i;return r=i=void 0,m=p,l=s.apply(v,T),l}function w(p){return m=p,u=setTimeout(O,e),y?E(p):l}function x(p){var T=p-d,v=p-m,I=e-T;return C?iT(I,a-v):I}function S(p){var T=p-d,v=p-m;return d===void 0||T>=e||T<0||C&&v>=a}function O(){var p=Mu();if(S(p))return P(p);u=setTimeout(O,x(p))}function P(p){return u=void 0,h&&r?E(p):(r=i=void 0,l)}function g(){u!==void 0&&clearTimeout(u),m=0,r=d=i=u=void 0}function b(){return u===void 0?l:P(Mu())}function f(){var p=Mu(),T=S(p);if(r=arguments,i=this,d=p,T){if(u===void 0)return w(d);if(C)return clearTimeout(u),u=setTimeout(O,e),E(d)}return u===void 0&&(u=setTimeout(O,e)),l}return f.cancel=g,f.flush=b,f}Np.exports=oT});var _u=ve((Z1,Fp)=>{N();var sT=Dp(),aT=da(),lT="Expected a function";function uT(s,e,t){var r=!0,i=!0;if(typeof s!="function")throw new TypeError(lT);return aT(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),sT(s,e,{leading:r,maxWait:e,trailing:i})}Fp.exports=uT});var yo=ve((Ti,vo)=>{N();(function(){var s,e="4.17.21",t=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",m=1,y=2,C=4,h=1,E=2,w=1,x=2,S=4,O=8,P=16,g=32,b=64,f=128,p=256,T=512,v=30,I="...",U=800,z=16,W=1,D=2,M=3,L=1/0,$=9007199254740991,G=17976931348623157e292,J=0/0,tt=4294967295,rt=tt-1,X=tt>>>1,_=[["ary",f],["bind",w],["bindKey",x],["curry",O],["curryRight",P],["flip",T],["partial",g],["partialRight",b],["rearg",p]],B="[object Arguments]",H="[object Array]",j="[object AsyncFunction]",et="[object Boolean]",ct="[object Date]",mt="[object DOMException]",Et="[object Error]",St="[object Function]",Wt="[object GeneratorFunction]",ft="[object Map]",Zt="[object Number]",be="[object Null]",oe="[object Object]",he="[object Promise]",un="[object Proxy]",yn="[object RegExp]",le="[object Set]",bn="[object String]",Vn="[object Symbol]",qi="[object Undefined]",dr="[object WeakMap]",al="[object WeakSet]",q="[object ArrayBuffer]",ot="[object DataView]",ut="[object Float32Array]",yt="[object Float64Array]",Dt="[object Int8Array]",Oe="[object Int16Array]",In="[object Int32Array]",ll="[object Uint8Array]",ul="[object Uint8ClampedArray]",cl="[object Uint16Array]",dl="[object Uint32Array]",Ev=/\b__p \+= '';/g,Cv=/\b(__p \+=) '' \+/g,Av=/(__e\(.*?\)|\b__t\)) \+\n'';/g,yd=/&(?:amp|lt|gt|quot|#39);/g,bd=/[&<>"']/g,Ov=RegExp(yd.source),Sv=RegExp(bd.source),Tv=/<%-([\s\S]+?)%>/g,wv=/<%([\s\S]+?)%>/g,Ed=/<%=([\s\S]+?)%>/g,xv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Iv=/^\w*$/,Pv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fl=/[\\^$.*+?()[\]{}|]/g,Rv=RegExp(fl.source),hl=/^\s+/,Mv=/\s/,_v=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Lv=/\{\n\/\* \[wrapped with (.+)\] \*/,Nv=/,? & /,Dv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Fv=/[()=,{}\[\]\/\s]/,Uv=/\\(\\)?/g,Bv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Cd=/\w*$/,kv=/^[-+]0x[0-9a-f]+$/i,$v=/^0b[01]+$/i,Hv=/^\[object .+?Constructor\]$/,Gv=/^0o[0-7]+$/i,Wv=/^(?:0|[1-9]\d*)$/,zv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vs=/($^)/,Vv=/['\n\r\u2028\u2029\\]/g,ys="\\ud800-\\udfff",jv="\\u0300-\\u036f",Jv="\\ufe20-\\ufe2f",Kv="\\u20d0-\\u20ff",Ad=jv+Jv+Kv,Od="\\u2700-\\u27bf",Sd="a-z\\xdf-\\xf6\\xf8-\\xff",qv="\\xac\\xb1\\xd7\\xf7",Zv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Yv="\\u2000-\\u206f",Qv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Td="A-Z\\xc0-\\xd6\\xd8-\\xde",wd="\\ufe0e\\ufe0f",xd=qv+Zv+Yv+Qv,pl="['\u2019]",Xv="["+ys+"]",Id="["+xd+"]",bs="["+Ad+"]",Pd="\\d+",ty="["+Od+"]",Rd="["+Sd+"]",Md="[^"+ys+xd+Pd+Od+Sd+Td+"]",ml="\\ud83c[\\udffb-\\udfff]",ey="(?:"+bs+"|"+ml+")",_d="[^"+ys+"]",gl="(?:\\ud83c[\\udde6-\\uddff]){2}",vl="[\\ud800-\\udbff][\\udc00-\\udfff]",li="["+Td+"]",Ld="\\u200d",Nd="(?:"+Rd+"|"+Md+")",ny="(?:"+li+"|"+Md+")",Dd="(?:"+pl+"(?:d|ll|m|re|s|t|ve))?",Fd="(?:"+pl+"(?:D|LL|M|RE|S|T|VE))?",Ud=ey+"?",Bd="["+wd+"]?",ry="(?:"+Ld+"(?:"+[_d,gl,vl].join("|")+")"+Bd+Ud+")*",iy="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",oy="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",kd=Bd+Ud+ry,sy="(?:"+[ty,gl,vl].join("|")+")"+kd,ay="(?:"+[_d+bs+"?",bs,gl,vl,Xv].join("|")+")",ly=RegExp(pl,"g"),uy=RegExp(bs,"g"),yl=RegExp(ml+"(?="+ml+")|"+ay+kd,"g"),cy=RegExp([li+"?"+Rd+"+"+Dd+"(?="+[Id,li,"$"].join("|")+")",ny+"+"+Fd+"(?="+[Id,li+Nd,"$"].join("|")+")",li+"?"+Nd+"+"+Dd,li+"+"+Fd,oy,iy,Pd,sy].join("|"),"g"),dy=RegExp("["+Ld+ys+Ad+wd+"]"),fy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],py=-1,se={};se[ut]=se[yt]=se[Dt]=se[Oe]=se[In]=se[ll]=se[ul]=se[cl]=se[dl]=!0,se[B]=se[H]=se[q]=se[et]=se[ot]=se[ct]=se[Et]=se[St]=se[ft]=se[Zt]=se[oe]=se[yn]=se[le]=se[bn]=se[dr]=!1;var ie={};ie[B]=ie[H]=ie[q]=ie[ot]=ie[et]=ie[ct]=ie[ut]=ie[yt]=ie[Dt]=ie[Oe]=ie[In]=ie[ft]=ie[Zt]=ie[oe]=ie[yn]=ie[le]=ie[bn]=ie[Vn]=ie[ll]=ie[ul]=ie[cl]=ie[dl]=!0,ie[Et]=ie[St]=ie[dr]=!1;var my={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},gy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},vy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},yy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},by=parseFloat,Ey=parseInt,$d=typeof global=="object"&&global&&global.Object===Object&&global,Cy=typeof self=="object"&&self&&self.Object===Object&&self,Se=$d||Cy||Function("return this")(),bl=typeof Ti=="object"&&Ti&&!Ti.nodeType&&Ti,fr=bl&&typeof vo=="object"&&vo&&!vo.nodeType&&vo,Hd=fr&&fr.exports===bl,El=Hd&&$d.process,Ze=function(){try{var Z=fr&&fr.require&&fr.require("util").types;return Z||El&&El.binding&&El.binding("util")}catch(it){}}(),Gd=Ze&&Ze.isArrayBuffer,Wd=Ze&&Ze.isDate,zd=Ze&&Ze.isMap,Vd=Ze&&Ze.isRegExp,jd=Ze&&Ze.isSet,Jd=Ze&&Ze.isTypedArray;function Ge(Z,it,nt){switch(nt.length){case 0:return Z.call(it);case 1:return Z.call(it,nt[0]);case 2:return Z.call(it,nt[0],nt[1]);case 3:return Z.call(it,nt[0],nt[1],nt[2])}return Z.apply(it,nt)}function Ay(Z,it,nt,vt){for(var Rt=-1,Kt=Z==null?0:Z.length;++Rt<Kt;){var Ee=Z[Rt];it(vt,Ee,nt(Ee),Z)}return vt}function Ye(Z,it){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt&&it(Z[nt],nt,Z)!==!1;);return Z}function Oy(Z,it){for(var nt=Z==null?0:Z.length;nt--&&it(Z[nt],nt,Z)!==!1;);return Z}function Kd(Z,it){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt;)if(!it(Z[nt],nt,Z))return!1;return!0}function jn(Z,it){for(var nt=-1,vt=Z==null?0:Z.length,Rt=0,Kt=[];++nt<vt;){var Ee=Z[nt];it(Ee,nt,Z)&&(Kt[Rt++]=Ee)}return Kt}function Es(Z,it){var nt=Z==null?0:Z.length;return!!nt&&ui(Z,it,0)>-1}function Cl(Z,it,nt){for(var vt=-1,Rt=Z==null?0:Z.length;++vt<Rt;)if(nt(it,Z[vt]))return!0;return!1}function ae(Z,it){for(var nt=-1,vt=Z==null?0:Z.length,Rt=Array(vt);++nt<vt;)Rt[nt]=it(Z[nt],nt,Z);return Rt}function Jn(Z,it){for(var nt=-1,vt=it.length,Rt=Z.length;++nt<vt;)Z[Rt+nt]=it[nt];return Z}function Al(Z,it,nt,vt){var Rt=-1,Kt=Z==null?0:Z.length;for(vt&&Kt&&(nt=Z[++Rt]);++Rt<Kt;)nt=it(nt,Z[Rt],Rt,Z);return nt}function Sy(Z,it,nt,vt){var Rt=Z==null?0:Z.length;for(vt&&Rt&&(nt=Z[--Rt]);Rt--;)nt=it(nt,Z[Rt],Rt,Z);return nt}function Ol(Z,it){for(var nt=-1,vt=Z==null?0:Z.length;++nt<vt;)if(it(Z[nt],nt,Z))return!0;return!1}var Ty=Sl("length");function wy(Z){return Z.split("")}function xy(Z){return Z.match(Dv)||[]}function qd(Z,it,nt){var vt;return nt(Z,function(Rt,Kt,Ee){if(it(Rt,Kt,Ee))return vt=Kt,!1}),vt}function Cs(Z,it,nt,vt){for(var Rt=Z.length,Kt=nt+(vt?1:-1);vt?Kt--:++Kt<Rt;)if(it(Z[Kt],Kt,Z))return Kt;return-1}function ui(Z,it,nt){return it===it?ky(Z,it,nt):Cs(Z,Zd,nt)}function Iy(Z,it,nt,vt){for(var Rt=nt-1,Kt=Z.length;++Rt<Kt;)if(vt(Z[Rt],it))return Rt;return-1}function Zd(Z){return Z!==Z}function Yd(Z,it){var nt=Z==null?0:Z.length;return nt?wl(Z,it)/nt:J}function Sl(Z){return function(it){return it==null?s:it[Z]}}function Tl(Z){return function(it){return Z==null?s:Z[it]}}function Qd(Z,it,nt,vt,Rt){return Rt(Z,function(Kt,Ee,ee){nt=vt?(vt=!1,Kt):it(nt,Kt,Ee,ee)}),nt}function Py(Z,it){var nt=Z.length;for(Z.sort(it);nt--;)Z[nt]=Z[nt].value;return Z}function wl(Z,it){for(var nt,vt=-1,Rt=Z.length;++vt<Rt;){var Kt=it(Z[vt]);Kt!==s&&(nt=nt===s?Kt:nt+Kt)}return nt}function xl(Z,it){for(var nt=-1,vt=Array(Z);++nt<Z;)vt[nt]=it(nt);return vt}function Ry(Z,it){return ae(it,function(nt){return[nt,Z[nt]]})}function Xd(Z){return Z&&Z.slice(0,rf(Z)+1).replace(hl,"")}function We(Z){return function(it){return Z(it)}}function Il(Z,it){return ae(it,function(nt){return Z[nt]})}function Zi(Z,it){return Z.has(it)}function tf(Z,it){for(var nt=-1,vt=Z.length;++nt<vt&&ui(it,Z[nt],0)>-1;);return nt}function ef(Z,it){for(var nt=Z.length;nt--&&ui(it,Z[nt],0)>-1;);return nt}function My(Z,it){for(var nt=Z.length,vt=0;nt--;)Z[nt]===it&&++vt;return vt}var _y=Tl(my),Ly=Tl(gy);function Ny(Z){return"\\"+yy[Z]}function Dy(Z,it){return Z==null?s:Z[it]}function ci(Z){return dy.test(Z)}function Fy(Z){return fy.test(Z)}function Uy(Z){for(var it,nt=[];!(it=Z.next()).done;)nt.push(it.value);return nt}function Pl(Z){var it=-1,nt=Array(Z.size);return Z.forEach(function(vt,Rt){nt[++it]=[Rt,vt]}),nt}function nf(Z,it){return function(nt){return Z(it(nt))}}function Kn(Z,it){for(var nt=-1,vt=Z.length,Rt=0,Kt=[];++nt<vt;){var Ee=Z[nt];(Ee===it||Ee===d)&&(Z[nt]=d,Kt[Rt++]=nt)}return Kt}function As(Z){var it=-1,nt=Array(Z.size);return Z.forEach(function(vt){nt[++it]=vt}),nt}function By(Z){var it=-1,nt=Array(Z.size);return Z.forEach(function(vt){nt[++it]=[vt,vt]}),nt}function ky(Z,it,nt){for(var vt=nt-1,Rt=Z.length;++vt<Rt;)if(Z[vt]===it)return vt;return-1}function $y(Z,it,nt){for(var vt=nt+1;vt--;)if(Z[vt]===it)return vt;return vt}function di(Z){return ci(Z)?Gy(Z):Ty(Z)}function cn(Z){return ci(Z)?Wy(Z):wy(Z)}function rf(Z){for(var it=Z.length;it--&&Mv.test(Z.charAt(it)););return it}var Hy=Tl(vy);function Gy(Z){for(var it=yl.lastIndex=0;yl.test(Z);)++it;return it}function Wy(Z){return Z.match(yl)||[]}function zy(Z){return Z.match(cy)||[]}var Vy=function Z(it){it=it==null?Se:qn.defaults(Se.Object(),it,qn.pick(Se,hy));var nt=it.Array,vt=it.Date,Rt=it.Error,Kt=it.Function,Ee=it.Math,ee=it.Object,Rl=it.RegExp,jy=it.String,Qe=it.TypeError,Os=nt.prototype,Jy=Kt.prototype,fi=ee.prototype,Ss=it["__core-js_shared__"],Ts=Jy.toString,Xt=fi.hasOwnProperty,Ky=0,of=function(){var n=/[^.]+$/.exec(Ss&&Ss.keys&&Ss.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),ws=fi.toString,qy=Ts.call(ee),Zy=Se._,Yy=Rl("^"+Ts.call(Xt).replace(fl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xs=Hd?it.Buffer:s,Zn=it.Symbol,Is=it.Uint8Array,sf=xs?xs.allocUnsafe:s,Ps=nf(ee.getPrototypeOf,ee),af=ee.create,lf=fi.propertyIsEnumerable,Rs=Os.splice,uf=Zn?Zn.isConcatSpreadable:s,Yi=Zn?Zn.iterator:s,hr=Zn?Zn.toStringTag:s,Ms=function(){try{var n=yr(ee,"defineProperty");return n({},"",{}),n}catch(o){}}(),Qy=it.clearTimeout!==Se.clearTimeout&&it.clearTimeout,Xy=vt&&vt.now!==Se.Date.now&&vt.now,t0=it.setTimeout!==Se.setTimeout&&it.setTimeout,_s=Ee.ceil,Ls=Ee.floor,Ml=ee.getOwnPropertySymbols,e0=xs?xs.isBuffer:s,cf=it.isFinite,n0=Os.join,r0=nf(ee.keys,ee),Ce=Ee.max,_e=Ee.min,i0=vt.now,o0=it.parseInt,df=Ee.random,s0=Os.reverse,_l=yr(it,"DataView"),Qi=yr(it,"Map"),Ll=yr(it,"Promise"),hi=yr(it,"Set"),Xi=yr(it,"WeakMap"),to=yr(ee,"create"),Ns=Xi&&new Xi,pi={},a0=br(_l),l0=br(Qi),u0=br(Ll),c0=br(hi),d0=br(Xi),Ds=Zn?Zn.prototype:s,eo=Ds?Ds.valueOf:s,ff=Ds?Ds.toString:s;function F(n){if(pe(n)&&!Mt(n)&&!(n instanceof zt)){if(n instanceof Xe)return n;if(Xt.call(n,"__wrapped__"))return hh(n)}return new Xe(n)}var mi=function(){function n(){}return function(o){if(!ue(o))return{};if(af)return af(o);n.prototype=o;var c=new n;return n.prototype=s,c}}();function Fs(){}function Xe(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=s}F.templateSettings={escape:Tv,evaluate:wv,interpolate:Ed,variable:"",imports:{_:F}},F.prototype=Fs.prototype,F.prototype.constructor=F,Xe.prototype=mi(Fs.prototype),Xe.prototype.constructor=Xe;function zt(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function f0(){var n=new zt(this.__wrapped__);return n.__actions__=Ue(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ue(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ue(this.__views__),n}function h0(){if(this.__filtered__){var n=new zt(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function p0(){var n=this.__wrapped__.value(),o=this.__dir__,c=Mt(n),A=o<0,R=c?n.length:0,k=wb(0,R,this.__views__),V=k.start,K=k.end,Y=K-V,st=A?K:V-1,at=this.__iteratees__,lt=at.length,ht=0,bt=_e(Y,this.__takeCount__);if(!c||!A&&R==Y&&bt==Y)return Ff(n,this.__actions__);var wt=[];t:for(;Y--&&ht<bt;){st+=o;for(var Ft=-1,xt=n[st];++Ft<lt;){var Ht=at[Ft],Vt=Ht.iteratee,je=Ht.type,Fe=Vt(xt);if(je==D)xt=Fe;else if(!Fe){if(je==W)continue t;break t}}wt[ht++]=xt}return wt}zt.prototype=mi(Fs.prototype),zt.prototype.constructor=zt;function pr(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function m0(){this.__data__=to?to(null):{},this.size=0}function g0(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function v0(n){var o=this.__data__;if(to){var c=o[n];return c===l?s:c}return Xt.call(o,n)?o[n]:s}function y0(n){var o=this.__data__;return to?o[n]!==s:Xt.call(o,n)}function b0(n,o){var c=this.__data__;return this.size+=this.has(n)?0:1,c[n]=to&&o===s?l:o,this}pr.prototype.clear=m0,pr.prototype.delete=g0,pr.prototype.get=v0,pr.prototype.has=y0,pr.prototype.set=b0;function Pn(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function E0(){this.__data__=[],this.size=0}function C0(n){var o=this.__data__,c=Us(o,n);if(c<0)return!1;var A=o.length-1;return c==A?o.pop():Rs.call(o,c,1),--this.size,!0}function A0(n){var o=this.__data__,c=Us(o,n);return c<0?s:o[c][1]}function O0(n){return Us(this.__data__,n)>-1}function S0(n,o){var c=this.__data__,A=Us(c,n);return A<0?(++this.size,c.push([n,o])):c[A][1]=o,this}Pn.prototype.clear=E0,Pn.prototype.delete=C0,Pn.prototype.get=A0,Pn.prototype.has=O0,Pn.prototype.set=S0;function Rn(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function T0(){this.size=0,this.__data__={hash:new pr,map:new(Qi||Pn),string:new pr}}function w0(n){var o=qs(this,n).delete(n);return this.size-=o?1:0,o}function x0(n){return qs(this,n).get(n)}function I0(n){return qs(this,n).has(n)}function P0(n,o){var c=qs(this,n),A=c.size;return c.set(n,o),this.size+=c.size==A?0:1,this}Rn.prototype.clear=T0,Rn.prototype.delete=w0,Rn.prototype.get=x0,Rn.prototype.has=I0,Rn.prototype.set=P0;function mr(n){var o=-1,c=n==null?0:n.length;for(this.__data__=new Rn;++o<c;)this.add(n[o])}function R0(n){return this.__data__.set(n,l),this}function M0(n){return this.__data__.has(n)}mr.prototype.add=mr.prototype.push=R0,mr.prototype.has=M0;function dn(n){var o=this.__data__=new Pn(n);this.size=o.size}function _0(){this.__data__=new Pn,this.size=0}function L0(n){var o=this.__data__,c=o.delete(n);return this.size=o.size,c}function N0(n){return this.__data__.get(n)}function D0(n){return this.__data__.has(n)}function F0(n,o){var c=this.__data__;if(c instanceof Pn){var A=c.__data__;if(!Qi||A.length<t-1)return A.push([n,o]),this.size=++c.size,this;c=this.__data__=new Rn(A)}return c.set(n,o),this.size=c.size,this}dn.prototype.clear=_0,dn.prototype.delete=L0,dn.prototype.get=N0,dn.prototype.has=D0,dn.prototype.set=F0;function hf(n,o){var c=Mt(n),A=!c&&Er(n),R=!c&&!A&&er(n),k=!c&&!A&&!R&&bi(n),V=c||A||R||k,K=V?xl(n.length,jy):[],Y=K.length;for(var st in n)(o||Xt.call(n,st))&&!(V&&(st=="length"||R&&(st=="offset"||st=="parent")||k&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||Nn(st,Y)))&&K.push(st);return K}function pf(n){var o=n.length;return o?n[zl(0,o-1)]:s}function U0(n,o){return Zs(Ue(n),gr(o,0,n.length))}function B0(n){return Zs(Ue(n))}function Nl(n,o,c){(c!==s&&!fn(n[o],c)||c===s&&!(o in n))&&Mn(n,o,c)}function no(n,o,c){var A=n[o];(!(Xt.call(n,o)&&fn(A,c))||c===s&&!(o in n))&&Mn(n,o,c)}function Us(n,o){for(var c=n.length;c--;)if(fn(n[c][0],o))return c;return-1}function k0(n,o,c,A){return Yn(n,function(R,k,V){o(A,R,c(R),V)}),A}function mf(n,o){return n&&Cn(o,Te(o),n)}function $0(n,o){return n&&Cn(o,ke(o),n)}function Mn(n,o,c){o=="__proto__"&&Ms?Ms(n,o,{configurable:!0,enumerable:!0,value:c,writable:!0}):n[o]=c}function Dl(n,o){for(var c=-1,A=o.length,R=nt(A),k=n==null;++c<A;)R[c]=k?s:mu(n,o[c]);return R}function gr(n,o,c){return n===n&&(c!==s&&(n=n<=c?n:c),o!==s&&(n=n>=o?n:o)),n}function tn(n,o,c,A,R,k){var V,K=o&m,Y=o&y,st=o&C;if(c&&(V=R?c(n,A,R,k):c(n)),V!==s)return V;if(!ue(n))return n;var at=Mt(n);if(at){if(V=Ib(n),!K)return Ue(n,V)}else{var lt=Le(n),ht=lt==St||lt==Wt;if(er(n))return kf(n,K);if(lt==oe||lt==B||ht&&!R){if(V=Y||ht?{}:ih(n),!K)return Y?vb(n,$0(V,n)):gb(n,mf(V,n))}else{if(!ie[lt])return R?n:{};V=Pb(n,lt,K)}}k||(k=new dn);var bt=k.get(n);if(bt)return bt;k.set(n,V),Lh(n)?n.forEach(function(xt){V.add(tn(xt,o,c,xt,n,k))}):Mh(n)&&n.forEach(function(xt,Ht){V.set(Ht,tn(xt,o,c,Ht,n,k))});var wt=st?Y?eu:tu:Y?ke:Te,Ft=at?s:wt(n);return Ye(Ft||n,function(xt,Ht){Ft&&(Ht=xt,xt=n[Ht]),no(V,Ht,tn(xt,o,c,Ht,n,k))}),V}function H0(n){var o=Te(n);return function(c){return gf(c,n,o)}}function gf(n,o,c){var A=c.length;if(n==null)return!A;for(n=ee(n);A--;){var R=c[A],k=o[R],V=n[R];if(V===s&&!(R in n)||!k(V))return!1}return!0}function vf(n,o,c){if(typeof n!="function")throw new Qe(i);return uo(function(){n.apply(s,c)},o)}function ro(n,o,c,A){var R=-1,k=Es,V=!0,K=n.length,Y=[],st=o.length;if(!K)return Y;c&&(o=ae(o,We(c))),A?(k=Cl,V=!1):o.length>=t&&(k=Zi,V=!1,o=new mr(o));t:for(;++R<K;){var at=n[R],lt=c==null?at:c(at);if(at=A||at!==0?at:0,V&&lt===lt){for(var ht=st;ht--;)if(o[ht]===lt)continue t;Y.push(at)}else k(o,lt,A)||Y.push(at)}return Y}var Yn=zf(En),yf=zf(Ul,!0);function G0(n,o){var c=!0;return Yn(n,function(A,R,k){return c=!!o(A,R,k),c}),c}function Bs(n,o,c){for(var A=-1,R=n.length;++A<R;){var k=n[A],V=o(k);if(V!=null&&(K===s?V===V&&!Ve(V):c(V,K)))var K=V,Y=k}return Y}function W0(n,o,c,A){var R=n.length;for(c=Lt(c),c<0&&(c=-c>R?0:R+c),A=A===s||A>R?R:Lt(A),A<0&&(A+=R),A=c>A?0:Dh(A);c<A;)n[c++]=o;return n}function bf(n,o){var c=[];return Yn(n,function(A,R,k){o(A,R,k)&&c.push(A)}),c}function Re(n,o,c,A,R){var k=-1,V=n.length;for(c||(c=Mb),R||(R=[]);++k<V;){var K=n[k];o>0&&c(K)?o>1?Re(K,o-1,c,A,R):Jn(R,K):A||(R[R.length]=K)}return R}var Fl=Vf(),Ef=Vf(!0);function En(n,o){return n&&Fl(n,o,Te)}function Ul(n,o){return n&&Ef(n,o,Te)}function ks(n,o){return jn(o,function(c){return Dn(n[c])})}function vr(n,o){o=Xn(o,n);for(var c=0,A=o.length;n!=null&&c<A;)n=n[An(o[c++])];return c&&c==A?n:s}function Cf(n,o,c){var A=o(n);return Mt(n)?A:Jn(A,c(n))}function Ne(n){return n==null?n===s?qi:be:hr&&hr in ee(n)?Tb(n):Bb(n)}function Bl(n,o){return n>o}function z0(n,o){return n!=null&&Xt.call(n,o)}function V0(n,o){return n!=null&&o in ee(n)}function j0(n,o,c){return n>=_e(o,c)&&n<Ce(o,c)}function kl(n,o,c){for(var A=c?Cl:Es,R=n[0].length,k=n.length,V=k,K=nt(k),Y=1/0,st=[];V--;){var at=n[V];V&&o&&(at=ae(at,We(o))),Y=_e(at.length,Y),K[V]=!c&&(o||R>=120&&at.length>=120)?new mr(V&&at):s}at=n[0];var lt=-1,ht=K[0];t:for(;++lt<R&&st.length<Y;){var bt=at[lt],wt=o?o(bt):bt;if(bt=c||bt!==0?bt:0,!(ht?Zi(ht,wt):A(st,wt,c))){for(V=k;--V;){var Ft=K[V];if(!(Ft?Zi(Ft,wt):A(n[V],wt,c)))continue t}ht&&ht.push(wt),st.push(bt)}}return st}function J0(n,o,c,A){return En(n,function(R,k,V){o(A,c(R),k,V)}),A}function io(n,o,c){o=Xn(o,n),n=lh(n,o);var A=n==null?n:n[An(nn(o))];return A==null?s:Ge(A,n,c)}function Af(n){return pe(n)&&Ne(n)==B}function K0(n){return pe(n)&&Ne(n)==q}function q0(n){return pe(n)&&Ne(n)==ct}function oo(n,o,c,A,R){return n===o?!0:n==null||o==null||!pe(n)&&!pe(o)?n!==n&&o!==o:Z0(n,o,c,A,oo,R)}function Z0(n,o,c,A,R,k){var V=Mt(n),K=Mt(o),Y=V?H:Le(n),st=K?H:Le(o);Y=Y==B?oe:Y,st=st==B?oe:st;var at=Y==oe,lt=st==oe,ht=Y==st;if(ht&&er(n)){if(!er(o))return!1;V=!0,at=!1}if(ht&&!at)return k||(k=new dn),V||bi(n)?eh(n,o,c,A,R,k):Ob(n,o,Y,c,A,R,k);if(!(c&h)){var bt=at&&Xt.call(n,"__wrapped__"),wt=lt&&Xt.call(o,"__wrapped__");if(bt||wt){var Ft=bt?n.value():n,xt=wt?o.value():o;return k||(k=new dn),R(Ft,xt,c,A,k)}}return ht?(k||(k=new dn),Sb(n,o,c,A,R,k)):!1}function Y0(n){return pe(n)&&Le(n)==ft}function $l(n,o,c,A){var R=c.length,k=R,V=!A;if(n==null)return!k;for(n=ee(n);R--;){var K=c[R];if(V&&K[2]?K[1]!==n[K[0]]:!(K[0]in n))return!1}for(;++R<k;){K=c[R];var Y=K[0],st=n[Y],at=K[1];if(V&&K[2]){if(st===s&&!(Y in n))return!1}else{var lt=new dn;if(A)var ht=A(st,at,Y,n,o,lt);if(!(ht===s?oo(at,st,h|E,A,lt):ht))return!1}}return!0}function Of(n){if(!ue(n)||Lb(n))return!1;var o=Dn(n)?Yy:Hv;return o.test(br(n))}function Q0(n){return pe(n)&&Ne(n)==yn}function X0(n){return pe(n)&&Le(n)==le}function tb(n){return pe(n)&&na(n.length)&&!!se[Ne(n)]}function Sf(n){return typeof n=="function"?n:n==null?$e:typeof n=="object"?Mt(n)?xf(n[0],n[1]):wf(n):jh(n)}function Hl(n){if(!lo(n))return r0(n);var o=[];for(var c in ee(n))Xt.call(n,c)&&c!="constructor"&&o.push(c);return o}function eb(n){if(!ue(n))return Ub(n);var o=lo(n),c=[];for(var A in n)A=="constructor"&&(o||!Xt.call(n,A))||c.push(A);return c}function Gl(n,o){return n<o}function Tf(n,o){var c=-1,A=Be(n)?nt(n.length):[];return Yn(n,function(R,k,V){A[++c]=o(R,k,V)}),A}function wf(n){var o=ru(n);return o.length==1&&o[0][2]?sh(o[0][0],o[0][1]):function(c){return c===n||$l(c,n,o)}}function xf(n,o){return ou(n)&&oh(o)?sh(An(n),o):function(c){var A=mu(c,n);return A===s&&A===o?gu(c,n):oo(o,A,h|E)}}function $s(n,o,c,A,R){n!==o&&Fl(o,function(k,V){if(R||(R=new dn),ue(k))nb(n,o,V,c,$s,A,R);else{var K=A?A(au(n,V),k,V+"",n,o,R):s;K===s&&(K=k),Nl(n,V,K)}},ke)}function nb(n,o,c,A,R,k,V){var K=au(n,c),Y=au(o,c),st=V.get(Y);if(st){Nl(n,c,st);return}var at=k?k(K,Y,c+"",n,o,V):s,lt=at===s;if(lt){var ht=Mt(Y),bt=!ht&&er(Y),wt=!ht&&!bt&&bi(Y);at=Y,ht||bt||wt?Mt(K)?at=K:me(K)?at=Ue(K):bt?(lt=!1,at=kf(Y,!0)):wt?(lt=!1,at=$f(Y,!0)):at=[]:co(Y)||Er(Y)?(at=K,Er(K)?at=Fh(K):(!ue(K)||Dn(K))&&(at=ih(Y))):lt=!1}lt&&(V.set(Y,at),R(at,Y,A,k,V),V.delete(Y)),Nl(n,c,at)}function If(n,o){var c=n.length;if(!!c)return o+=o<0?c:0,Nn(o,c)?n[o]:s}function Pf(n,o,c){o.length?o=ae(o,function(k){return Mt(k)?function(V){return vr(V,k.length===1?k[0]:k)}:k}):o=[$e];var A=-1;o=ae(o,We(Tt()));var R=Tf(n,function(k,V,K){var Y=ae(o,function(st){return st(k)});return{criteria:Y,index:++A,value:k}});return Py(R,function(k,V){return mb(k,V,c)})}function rb(n,o){return Rf(n,o,function(c,A){return gu(n,A)})}function Rf(n,o,c){for(var A=-1,R=o.length,k={};++A<R;){var V=o[A],K=vr(n,V);c(K,V)&&so(k,Xn(V,n),K)}return k}function ib(n){return function(o){return vr(o,n)}}function Wl(n,o,c,A){var R=A?Iy:ui,k=-1,V=o.length,K=n;for(n===o&&(o=Ue(o)),c&&(K=ae(n,We(c)));++k<V;)for(var Y=0,st=o[k],at=c?c(st):st;(Y=R(K,at,Y,A))>-1;)K!==n&&Rs.call(K,Y,1),Rs.call(n,Y,1);return n}function Mf(n,o){for(var c=n?o.length:0,A=c-1;c--;){var R=o[c];if(c==A||R!==k){var k=R;Nn(R)?Rs.call(n,R,1):Jl(n,R)}}return n}function zl(n,o){return n+Ls(df()*(o-n+1))}function ob(n,o,c,A){for(var R=-1,k=Ce(_s((o-n)/(c||1)),0),V=nt(k);k--;)V[A?k:++R]=n,n+=c;return V}function Vl(n,o){var c="";if(!n||o<1||o>$)return c;do o%2&&(c+=n),o=Ls(o/2),o&&(n+=n);while(o);return c}function Bt(n,o){return lu(ah(n,o,$e),n+"")}function sb(n){return pf(Ei(n))}function ab(n,o){var c=Ei(n);return Zs(c,gr(o,0,c.length))}function so(n,o,c,A){if(!ue(n))return n;o=Xn(o,n);for(var R=-1,k=o.length,V=k-1,K=n;K!=null&&++R<k;){var Y=An(o[R]),st=c;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return n;if(R!=V){var at=K[Y];st=A?A(at,Y,K):s,st===s&&(st=ue(at)?at:Nn(o[R+1])?[]:{})}no(K,Y,st),K=K[Y]}return n}var _f=Ns?function(n,o){return Ns.set(n,o),n}:$e,lb=Ms?function(n,o){return Ms(n,"toString",{configurable:!0,enumerable:!1,value:yu(o),writable:!0})}:$e;function ub(n){return Zs(Ei(n))}function en(n,o,c){var A=-1,R=n.length;o<0&&(o=-o>R?0:R+o),c=c>R?R:c,c<0&&(c+=R),R=o>c?0:c-o>>>0,o>>>=0;for(var k=nt(R);++A<R;)k[A]=n[A+o];return k}function cb(n,o){var c;return Yn(n,function(A,R,k){return c=o(A,R,k),!c}),!!c}function Hs(n,o,c){var A=0,R=n==null?A:n.length;if(typeof o=="number"&&o===o&&R<=X){for(;A<R;){var k=A+R>>>1,V=n[k];V!==null&&!Ve(V)&&(c?V<=o:V<o)?A=k+1:R=k}return R}return jl(n,o,$e,c)}function jl(n,o,c,A){var R=0,k=n==null?0:n.length;if(k===0)return 0;o=c(o);for(var V=o!==o,K=o===null,Y=Ve(o),st=o===s;R<k;){var at=Ls((R+k)/2),lt=c(n[at]),ht=lt!==s,bt=lt===null,wt=lt===lt,Ft=Ve(lt);if(V)var xt=A||wt;else st?xt=wt&&(A||ht):K?xt=wt&&ht&&(A||!bt):Y?xt=wt&&ht&&!bt&&(A||!Ft):bt||Ft?xt=!1:xt=A?lt<=o:lt<o;xt?R=at+1:k=at}return _e(k,rt)}function Lf(n,o){for(var c=-1,A=n.length,R=0,k=[];++c<A;){var V=n[c],K=o?o(V):V;if(!c||!fn(K,Y)){var Y=K;k[R++]=V===0?0:V}}return k}function Nf(n){return typeof n=="number"?n:Ve(n)?J:+n}function ze(n){if(typeof n=="string")return n;if(Mt(n))return ae(n,ze)+"";if(Ve(n))return ff?ff.call(n):"";var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Qn(n,o,c){var A=-1,R=Es,k=n.length,V=!0,K=[],Y=K;if(c)V=!1,R=Cl;else if(k>=t){var st=o?null:Cb(n);if(st)return As(st);V=!1,R=Zi,Y=new mr}else Y=o?[]:K;t:for(;++A<k;){var at=n[A],lt=o?o(at):at;if(at=c||at!==0?at:0,V&&lt===lt){for(var ht=Y.length;ht--;)if(Y[ht]===lt)continue t;o&&Y.push(lt),K.push(at)}else R(Y,lt,c)||(Y!==K&&Y.push(lt),K.push(at))}return K}function Jl(n,o){return o=Xn(o,n),n=lh(n,o),n==null||delete n[An(nn(o))]}function Df(n,o,c,A){return so(n,o,c(vr(n,o)),A)}function Gs(n,o,c,A){for(var R=n.length,k=A?R:-1;(A?k--:++k<R)&&o(n[k],k,n););return c?en(n,A?0:k,A?k+1:R):en(n,A?k+1:0,A?R:k)}function Ff(n,o){var c=n;return c instanceof zt&&(c=c.value()),Al(o,function(A,R){return R.func.apply(R.thisArg,Jn([A],R.args))},c)}function Kl(n,o,c){var A=n.length;if(A<2)return A?Qn(n[0]):[];for(var R=-1,k=nt(A);++R<A;)for(var V=n[R],K=-1;++K<A;)K!=R&&(k[R]=ro(k[R]||V,n[K],o,c));return Qn(Re(k,1),o,c)}function Uf(n,o,c){for(var A=-1,R=n.length,k=o.length,V={};++A<R;){var K=A<k?o[A]:s;c(V,n[A],K)}return V}function ql(n){return me(n)?n:[]}function Zl(n){return typeof n=="function"?n:$e}function Xn(n,o){return Mt(n)?n:ou(n,o)?[n]:fh(Yt(n))}var db=Bt;function tr(n,o,c){var A=n.length;return c=c===s?A:c,!o&&c>=A?n:en(n,o,c)}var Bf=Qy||function(n){return Se.clearTimeout(n)};function kf(n,o){if(o)return n.slice();var c=n.length,A=sf?sf(c):new n.constructor(c);return n.copy(A),A}function Yl(n){var o=new n.constructor(n.byteLength);return new Is(o).set(new Is(n)),o}function fb(n,o){var c=o?Yl(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.byteLength)}function hb(n){var o=new n.constructor(n.source,Cd.exec(n));return o.lastIndex=n.lastIndex,o}function pb(n){return eo?ee(eo.call(n)):{}}function $f(n,o){var c=o?Yl(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.length)}function Hf(n,o){if(n!==o){var c=n!==s,A=n===null,R=n===n,k=Ve(n),V=o!==s,K=o===null,Y=o===o,st=Ve(o);if(!K&&!st&&!k&&n>o||k&&V&&Y&&!K&&!st||A&&V&&Y||!c&&Y||!R)return 1;if(!A&&!k&&!st&&n<o||st&&c&&R&&!A&&!k||K&&c&&R||!V&&R||!Y)return-1}return 0}function mb(n,o,c){for(var A=-1,R=n.criteria,k=o.criteria,V=R.length,K=c.length;++A<V;){var Y=Hf(R[A],k[A]);if(Y){if(A>=K)return Y;var st=c[A];return Y*(st=="desc"?-1:1)}}return n.index-o.index}function Gf(n,o,c,A){for(var R=-1,k=n.length,V=c.length,K=-1,Y=o.length,st=Ce(k-V,0),at=nt(Y+st),lt=!A;++K<Y;)at[K]=o[K];for(;++R<V;)(lt||R<k)&&(at[c[R]]=n[R]);for(;st--;)at[K++]=n[R++];return at}function Wf(n,o,c,A){for(var R=-1,k=n.length,V=-1,K=c.length,Y=-1,st=o.length,at=Ce(k-K,0),lt=nt(at+st),ht=!A;++R<at;)lt[R]=n[R];for(var bt=R;++Y<st;)lt[bt+Y]=o[Y];for(;++V<K;)(ht||R<k)&&(lt[bt+c[V]]=n[R++]);return lt}function Ue(n,o){var c=-1,A=n.length;for(o||(o=nt(A));++c<A;)o[c]=n[c];return o}function Cn(n,o,c,A){var R=!c;c||(c={});for(var k=-1,V=o.length;++k<V;){var K=o[k],Y=A?A(c[K],n[K],K,c,n):s;Y===s&&(Y=n[K]),R?Mn(c,K,Y):no(c,K,Y)}return c}function gb(n,o){return Cn(n,iu(n),o)}function vb(n,o){return Cn(n,nh(n),o)}function Ws(n,o){return function(c,A){var R=Mt(c)?Ay:k0,k=o?o():{};return R(c,n,Tt(A,2),k)}}function gi(n){return Bt(function(o,c){var A=-1,R=c.length,k=R>1?c[R-1]:s,V=R>2?c[2]:s;for(k=n.length>3&&typeof k=="function"?(R--,k):s,V&&De(c[0],c[1],V)&&(k=R<3?s:k,R=1),o=ee(o);++A<R;){var K=c[A];K&&n(o,K,A,k)}return o})}function zf(n,o){return function(c,A){if(c==null)return c;if(!Be(c))return n(c,A);for(var R=c.length,k=o?R:-1,V=ee(c);(o?k--:++k<R)&&A(V[k],k,V)!==!1;);return c}}function Vf(n){return function(o,c,A){for(var R=-1,k=ee(o),V=A(o),K=V.length;K--;){var Y=V[n?K:++R];if(c(k[Y],Y,k)===!1)break}return o}}function yb(n,o,c){var A=o&w,R=ao(n);function k(){var V=this&&this!==Se&&this instanceof k?R:n;return V.apply(A?c:this,arguments)}return k}function jf(n){return function(o){o=Yt(o);var c=ci(o)?cn(o):s,A=c?c[0]:o.charAt(0),R=c?tr(c,1).join(""):o.slice(1);return A[n]()+R}}function vi(n){return function(o){return Al(zh(Wh(o).replace(ly,"")),n,"")}}function ao(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var c=mi(n.prototype),A=n.apply(c,o);return ue(A)?A:c}}function bb(n,o,c){var A=ao(n);function R(){for(var k=arguments.length,V=nt(k),K=k,Y=yi(R);K--;)V[K]=arguments[K];var st=k<3&&V[0]!==Y&&V[k-1]!==Y?[]:Kn(V,Y);if(k-=st.length,k<c)return Yf(n,o,zs,R.placeholder,s,V,st,s,s,c-k);var at=this&&this!==Se&&this instanceof R?A:n;return Ge(at,this,V)}return R}function Jf(n){return function(o,c,A){var R=ee(o);if(!Be(o)){var k=Tt(c,3);o=Te(o),c=function(K){return k(R[K],K,R)}}var V=n(o,c,A);return V>-1?R[k?o[V]:V]:s}}function Kf(n){return Ln(function(o){var c=o.length,A=c,R=Xe.prototype.thru;for(n&&o.reverse();A--;){var k=o[A];if(typeof k!="function")throw new Qe(i);if(R&&!V&&Ks(k)=="wrapper")var V=new Xe([],!0)}for(A=V?A:c;++A<c;){k=o[A];var K=Ks(k),Y=K=="wrapper"?nu(k):s;Y&&su(Y[0])&&Y[1]==(f|O|g|p)&&!Y[4].length&&Y[9]==1?V=V[Ks(Y[0])].apply(V,Y[3]):V=k.length==1&&su(k)?V[K]():V.thru(k)}return function(){var st=arguments,at=st[0];if(V&&st.length==1&&Mt(at))return V.plant(at).value();for(var lt=0,ht=c?o[lt].apply(this,st):at;++lt<c;)ht=o[lt].call(this,ht);return ht}})}function zs(n,o,c,A,R,k,V,K,Y,st){var at=o&f,lt=o&w,ht=o&x,bt=o&(O|P),wt=o&T,Ft=ht?s:ao(n);function xt(){for(var Ht=arguments.length,Vt=nt(Ht),je=Ht;je--;)Vt[je]=arguments[je];if(bt)var Fe=yi(xt),Je=My(Vt,Fe);if(A&&(Vt=Gf(Vt,A,R,bt)),k&&(Vt=Wf(Vt,k,V,bt)),Ht-=Je,bt&&Ht<st){var ge=Kn(Vt,Fe);return Yf(n,o,zs,xt.placeholder,c,Vt,ge,K,Y,st-Ht)}var hn=lt?c:this,Un=ht?hn[n]:n;return Ht=Vt.length,K?Vt=kb(Vt,K):wt&&Ht>1&&Vt.reverse(),at&&Y<Ht&&(Vt.length=Y),this&&this!==Se&&this instanceof xt&&(Un=Ft||ao(Un)),Un.apply(hn,Vt)}return xt}function qf(n,o){return function(c,A){return J0(c,n,o(A),{})}}function Vs(n,o){return function(c,A){var R;if(c===s&&A===s)return o;if(c!==s&&(R=c),A!==s){if(R===s)return A;typeof c=="string"||typeof A=="string"?(c=ze(c),A=ze(A)):(c=Nf(c),A=Nf(A)),R=n(c,A)}return R}}function Ql(n){return Ln(function(o){return o=ae(o,We(Tt())),Bt(function(c){var A=this;return n(o,function(R){return Ge(R,A,c)})})})}function js(n,o){o=o===s?" ":ze(o);var c=o.length;if(c<2)return c?Vl(o,n):o;var A=Vl(o,_s(n/di(o)));return ci(o)?tr(cn(A),0,n).join(""):A.slice(0,n)}function Eb(n,o,c,A){var R=o&w,k=ao(n);function V(){for(var K=-1,Y=arguments.length,st=-1,at=A.length,lt=nt(at+Y),ht=this&&this!==Se&&this instanceof V?k:n;++st<at;)lt[st]=A[st];for(;Y--;)lt[st++]=arguments[++K];return Ge(ht,R?c:this,lt)}return V}function Zf(n){return function(o,c,A){return A&&typeof A!="number"&&De(o,c,A)&&(c=A=s),o=Fn(o),c===s?(c=o,o=0):c=Fn(c),A=A===s?o<c?1:-1:Fn(A),ob(o,c,A,n)}}function Js(n){return function(o,c){return typeof o=="string"&&typeof c=="string"||(o=rn(o),c=rn(c)),n(o,c)}}function Yf(n,o,c,A,R,k,V,K,Y,st){var at=o&O,lt=at?V:s,ht=at?s:V,bt=at?k:s,wt=at?s:k;o|=at?g:b,o&=~(at?b:g),o&S||(o&=~(w|x));var Ft=[n,o,R,bt,lt,wt,ht,K,Y,st],xt=c.apply(s,Ft);return su(n)&&uh(xt,Ft),xt.placeholder=A,ch(xt,n,o)}function Xl(n){var o=Ee[n];return function(c,A){if(c=rn(c),A=A==null?0:_e(Lt(A),292),A&&cf(c)){var R=(Yt(c)+"e").split("e"),k=o(R[0]+"e"+(+R[1]+A));return R=(Yt(k)+"e").split("e"),+(R[0]+"e"+(+R[1]-A))}return o(c)}}var Cb=hi&&1/As(new hi([,-0]))[1]==L?function(n){return new hi(n)}:Cu;function Qf(n){return function(o){var c=Le(o);return c==ft?Pl(o):c==le?By(o):Ry(o,n(o))}}function _n(n,o,c,A,R,k,V,K){var Y=o&x;if(!Y&&typeof n!="function")throw new Qe(i);var st=A?A.length:0;if(st||(o&=~(g|b),A=R=s),V=V===s?V:Ce(Lt(V),0),K=K===s?K:Lt(K),st-=R?R.length:0,o&b){var at=A,lt=R;A=R=s}var ht=Y?s:nu(n),bt=[n,o,c,A,R,at,lt,k,V,K];if(ht&&Fb(bt,ht),n=bt[0],o=bt[1],c=bt[2],A=bt[3],R=bt[4],K=bt[9]=bt[9]===s?Y?0:n.length:Ce(bt[9]-st,0),!K&&o&(O|P)&&(o&=~(O|P)),!o||o==w)var wt=yb(n,o,c);else o==O||o==P?wt=bb(n,o,K):(o==g||o==(w|g))&&!R.length?wt=Eb(n,o,c,A):wt=zs.apply(s,bt);var Ft=ht?_f:uh;return ch(Ft(wt,bt),n,o)}function Xf(n,o,c,A){return n===s||fn(n,fi[c])&&!Xt.call(A,c)?o:n}function th(n,o,c,A,R,k){return ue(n)&&ue(o)&&(k.set(o,n),$s(n,o,s,th,k),k.delete(o)),n}function Ab(n){return co(n)?s:n}function eh(n,o,c,A,R,k){var V=c&h,K=n.length,Y=o.length;if(K!=Y&&!(V&&Y>K))return!1;var st=k.get(n),at=k.get(o);if(st&&at)return st==o&&at==n;var lt=-1,ht=!0,bt=c&E?new mr:s;for(k.set(n,o),k.set(o,n);++lt<K;){var wt=n[lt],Ft=o[lt];if(A)var xt=V?A(Ft,wt,lt,o,n,k):A(wt,Ft,lt,n,o,k);if(xt!==s){if(xt)continue;ht=!1;break}if(bt){if(!Ol(o,function(Ht,Vt){if(!Zi(bt,Vt)&&(wt===Ht||R(wt,Ht,c,A,k)))return bt.push(Vt)})){ht=!1;break}}else if(!(wt===Ft||R(wt,Ft,c,A,k))){ht=!1;break}}return k.delete(n),k.delete(o),ht}function Ob(n,o,c,A,R,k,V){switch(c){case ot:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case q:return!(n.byteLength!=o.byteLength||!k(new Is(n),new Is(o)));case et:case ct:case Zt:return fn(+n,+o);case Et:return n.name==o.name&&n.message==o.message;case yn:case bn:return n==o+"";case ft:var K=Pl;case le:var Y=A&h;if(K||(K=As),n.size!=o.size&&!Y)return!1;var st=V.get(n);if(st)return st==o;A|=E,V.set(n,o);var at=eh(K(n),K(o),A,R,k,V);return V.delete(n),at;case Vn:if(eo)return eo.call(n)==eo.call(o)}return!1}function Sb(n,o,c,A,R,k){var V=c&h,K=tu(n),Y=K.length,st=tu(o),at=st.length;if(Y!=at&&!V)return!1;for(var lt=Y;lt--;){var ht=K[lt];if(!(V?ht in o:Xt.call(o,ht)))return!1}var bt=k.get(n),wt=k.get(o);if(bt&&wt)return bt==o&&wt==n;var Ft=!0;k.set(n,o),k.set(o,n);for(var xt=V;++lt<Y;){ht=K[lt];var Ht=n[ht],Vt=o[ht];if(A)var je=V?A(Vt,Ht,ht,o,n,k):A(Ht,Vt,ht,n,o,k);if(!(je===s?Ht===Vt||R(Ht,Vt,c,A,k):je)){Ft=!1;break}xt||(xt=ht=="constructor")}if(Ft&&!xt){var Fe=n.constructor,Je=o.constructor;Fe!=Je&&"constructor"in n&&"constructor"in o&&!(typeof Fe=="function"&&Fe instanceof Fe&&typeof Je=="function"&&Je instanceof Je)&&(Ft=!1)}return k.delete(n),k.delete(o),Ft}function Ln(n){return lu(ah(n,s,gh),n+"")}function tu(n){return Cf(n,Te,iu)}function eu(n){return Cf(n,ke,nh)}var nu=Ns?function(n){return Ns.get(n)}:Cu;function Ks(n){for(var o=n.name+"",c=pi[o],A=Xt.call(pi,o)?c.length:0;A--;){var R=c[A],k=R.func;if(k==null||k==n)return R.name}return o}function yi(n){var o=Xt.call(F,"placeholder")?F:n;return o.placeholder}function Tt(){var n=F.iteratee||bu;return n=n===bu?Sf:n,arguments.length?n(arguments[0],arguments[1]):n}function qs(n,o){var c=n.__data__;return _b(o)?c[typeof o=="string"?"string":"hash"]:c.map}function ru(n){for(var o=Te(n),c=o.length;c--;){var A=o[c],R=n[A];o[c]=[A,R,oh(R)]}return o}function yr(n,o){var c=Dy(n,o);return Of(c)?c:s}function Tb(n){var o=Xt.call(n,hr),c=n[hr];try{n[hr]=s;var A=!0}catch(k){}var R=ws.call(n);return A&&(o?n[hr]=c:delete n[hr]),R}var iu=Ml?function(n){return n==null?[]:(n=ee(n),jn(Ml(n),function(o){return lf.call(n,o)}))}:Au,nh=Ml?function(n){for(var o=[];n;)Jn(o,iu(n)),n=Ps(n);return o}:Au,Le=Ne;(_l&&Le(new _l(new ArrayBuffer(1)))!=ot||Qi&&Le(new Qi)!=ft||Ll&&Le(Ll.resolve())!=he||hi&&Le(new hi)!=le||Xi&&Le(new Xi)!=dr)&&(Le=function(n){var o=Ne(n),c=o==oe?n.constructor:s,A=c?br(c):"";if(A)switch(A){case a0:return ot;case l0:return ft;case u0:return he;case c0:return le;case d0:return dr}return o});function wb(n,o,c){for(var A=-1,R=c.length;++A<R;){var k=c[A],V=k.size;switch(k.type){case"drop":n+=V;break;case"dropRight":o-=V;break;case"take":o=_e(o,n+V);break;case"takeRight":n=Ce(n,o-V);break}}return{start:n,end:o}}function xb(n){var o=n.match(Lv);return o?o[1].split(Nv):[]}function rh(n,o,c){o=Xn(o,n);for(var A=-1,R=o.length,k=!1;++A<R;){var V=An(o[A]);if(!(k=n!=null&&c(n,V)))break;n=n[V]}return k||++A!=R?k:(R=n==null?0:n.length,!!R&&na(R)&&Nn(V,R)&&(Mt(n)||Er(n)))}function Ib(n){var o=n.length,c=new n.constructor(o);return o&&typeof n[0]=="string"&&Xt.call(n,"index")&&(c.index=n.index,c.input=n.input),c}function ih(n){return typeof n.constructor=="function"&&!lo(n)?mi(Ps(n)):{}}function Pb(n,o,c){var A=n.constructor;switch(o){case q:return Yl(n);case et:case ct:return new A(+n);case ot:return fb(n,c);case ut:case yt:case Dt:case Oe:case In:case ll:case ul:case cl:case dl:return $f(n,c);case ft:return new A;case Zt:case bn:return new A(n);case yn:return hb(n);case le:return new A;case Vn:return pb(n)}}function Rb(n,o){var c=o.length;if(!c)return n;var A=c-1;return o[A]=(c>1?"& ":"")+o[A],o=o.join(c>2?", ":" "),n.replace(_v,`{
/* [wrapped with `+o+`] */
`)}function Mb(n){return Mt(n)||Er(n)||!!(uf&&n&&n[uf])}function Nn(n,o){var c=typeof n;return o=o==null?$:o,!!o&&(c=="number"||c!="symbol"&&Wv.test(n))&&n>-1&&n%1==0&&n<o}function De(n,o,c){if(!ue(c))return!1;var A=typeof o;return(A=="number"?Be(c)&&Nn(o,c.length):A=="string"&&o in c)?fn(c[o],n):!1}function ou(n,o){if(Mt(n))return!1;var c=typeof n;return c=="number"||c=="symbol"||c=="boolean"||n==null||Ve(n)?!0:Iv.test(n)||!xv.test(n)||o!=null&&n in ee(o)}function _b(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function su(n){var o=Ks(n),c=F[o];if(typeof c!="function"||!(o in zt.prototype))return!1;if(n===c)return!0;var A=nu(c);return!!A&&n===A[0]}function Lb(n){return!!of&&of in n}var Nb=Ss?Dn:Ou;function lo(n){var o=n&&n.constructor,c=typeof o=="function"&&o.prototype||fi;return n===c}function oh(n){return n===n&&!ue(n)}function sh(n,o){return function(c){return c==null?!1:c[n]===o&&(o!==s||n in ee(c))}}function Db(n){var o=ta(n,function(A){return c.size===u&&c.clear(),A}),c=o.cache;return o}function Fb(n,o){var c=n[1],A=o[1],R=c|A,k=R<(w|x|f),V=A==f&&c==O||A==f&&c==p&&n[7].length<=o[8]||A==(f|p)&&o[7].length<=o[8]&&c==O;if(!(k||V))return n;A&w&&(n[2]=o[2],R|=c&w?0:S);var K=o[3];if(K){var Y=n[3];n[3]=Y?Gf(Y,K,o[4]):K,n[4]=Y?Kn(n[3],d):o[4]}return K=o[5],K&&(Y=n[5],n[5]=Y?Wf(Y,K,o[6]):K,n[6]=Y?Kn(n[5],d):o[6]),K=o[7],K&&(n[7]=K),A&f&&(n[8]=n[8]==null?o[8]:_e(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=R,n}function Ub(n){var o=[];if(n!=null)for(var c in ee(n))o.push(c);return o}function Bb(n){return ws.call(n)}function ah(n,o,c){return o=Ce(o===s?n.length-1:o,0),function(){for(var A=arguments,R=-1,k=Ce(A.length-o,0),V=nt(k);++R<k;)V[R]=A[o+R];R=-1;for(var K=nt(o+1);++R<o;)K[R]=A[R];return K[o]=c(V),Ge(n,this,K)}}function lh(n,o){return o.length<2?n:vr(n,en(o,0,-1))}function kb(n,o){for(var c=n.length,A=_e(o.length,c),R=Ue(n);A--;){var k=o[A];n[A]=Nn(k,c)?R[k]:s}return n}function au(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var uh=dh(_f),uo=t0||function(n,o){return Se.setTimeout(n,o)},lu=dh(lb);function ch(n,o,c){var A=o+"";return lu(n,Rb(A,$b(xb(A),c)))}function dh(n){var o=0,c=0;return function(){var A=i0(),R=z-(A-c);if(c=A,R>0){if(++o>=U)return arguments[0]}else o=0;return n.apply(s,arguments)}}function Zs(n,o){var c=-1,A=n.length,R=A-1;for(o=o===s?A:o;++c<o;){var k=zl(c,R),V=n[k];n[k]=n[c],n[c]=V}return n.length=o,n}var fh=Db(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(Pv,function(c,A,R,k){o.push(R?k.replace(Uv,"$1"):A||c)}),o});function An(n){if(typeof n=="string"||Ve(n))return n;var o=n+"";return o=="0"&&1/n==-L?"-0":o}function br(n){if(n!=null){try{return Ts.call(n)}catch(o){}try{return n+""}catch(o){}}return""}function $b(n,o){return Ye(_,function(c){var A="_."+c[0];o&c[1]&&!Es(n,A)&&n.push(A)}),n.sort()}function hh(n){if(n instanceof zt)return n.clone();var o=new Xe(n.__wrapped__,n.__chain__);return o.__actions__=Ue(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function Hb(n,o,c){(c?De(n,o,c):o===s)?o=1:o=Ce(Lt(o),0);var A=n==null?0:n.length;if(!A||o<1)return[];for(var R=0,k=0,V=nt(_s(A/o));R<A;)V[k++]=en(n,R,R+=o);return V}function Gb(n){for(var o=-1,c=n==null?0:n.length,A=0,R=[];++o<c;){var k=n[o];k&&(R[A++]=k)}return R}function Wb(){var n=arguments.length;if(!n)return[];for(var o=nt(n-1),c=arguments[0],A=n;A--;)o[A-1]=arguments[A];return Jn(Mt(c)?Ue(c):[c],Re(o,1))}var zb=Bt(function(n,o){return me(n)?ro(n,Re(o,1,me,!0)):[]}),Vb=Bt(function(n,o){var c=nn(o);return me(c)&&(c=s),me(n)?ro(n,Re(o,1,me,!0),Tt(c,2)):[]}),jb=Bt(function(n,o){var c=nn(o);return me(c)&&(c=s),me(n)?ro(n,Re(o,1,me,!0),s,c):[]});function Jb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Lt(o),en(n,o<0?0:o,A)):[]}function Kb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Lt(o),o=A-o,en(n,0,o<0?0:o)):[]}function qb(n,o){return n&&n.length?Gs(n,Tt(o,3),!0,!0):[]}function Zb(n,o){return n&&n.length?Gs(n,Tt(o,3),!0):[]}function Yb(n,o,c,A){var R=n==null?0:n.length;return R?(c&&typeof c!="number"&&De(n,o,c)&&(c=0,A=R),W0(n,o,c,A)):[]}function ph(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var R=c==null?0:Lt(c);return R<0&&(R=Ce(A+R,0)),Cs(n,Tt(o,3),R)}function mh(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var R=A-1;return c!==s&&(R=Lt(c),R=c<0?Ce(A+R,0):_e(R,A-1)),Cs(n,Tt(o,3),R,!0)}function gh(n){var o=n==null?0:n.length;return o?Re(n,1):[]}function Qb(n){var o=n==null?0:n.length;return o?Re(n,L):[]}function Xb(n,o){var c=n==null?0:n.length;return c?(o=o===s?1:Lt(o),Re(n,o)):[]}function tE(n){for(var o=-1,c=n==null?0:n.length,A={};++o<c;){var R=n[o];A[R[0]]=R[1]}return A}function vh(n){return n&&n.length?n[0]:s}function eE(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var R=c==null?0:Lt(c);return R<0&&(R=Ce(A+R,0)),ui(n,o,R)}function nE(n){var o=n==null?0:n.length;return o?en(n,0,-1):[]}var rE=Bt(function(n){var o=ae(n,ql);return o.length&&o[0]===n[0]?kl(o):[]}),iE=Bt(function(n){var o=nn(n),c=ae(n,ql);return o===nn(c)?o=s:c.pop(),c.length&&c[0]===n[0]?kl(c,Tt(o,2)):[]}),oE=Bt(function(n){var o=nn(n),c=ae(n,ql);return o=typeof o=="function"?o:s,o&&c.pop(),c.length&&c[0]===n[0]?kl(c,s,o):[]});function sE(n,o){return n==null?"":n0.call(n,o)}function nn(n){var o=n==null?0:n.length;return o?n[o-1]:s}function aE(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var R=A;return c!==s&&(R=Lt(c),R=R<0?Ce(A+R,0):_e(R,A-1)),o===o?$y(n,o,R):Cs(n,Zd,R,!0)}function lE(n,o){return n&&n.length?If(n,Lt(o)):s}var uE=Bt(yh);function yh(n,o){return n&&n.length&&o&&o.length?Wl(n,o):n}function cE(n,o,c){return n&&n.length&&o&&o.length?Wl(n,o,Tt(c,2)):n}function dE(n,o,c){return n&&n.length&&o&&o.length?Wl(n,o,s,c):n}var fE=Ln(function(n,o){var c=n==null?0:n.length,A=Dl(n,o);return Mf(n,ae(o,function(R){return Nn(R,c)?+R:R}).sort(Hf)),A});function hE(n,o){var c=[];if(!(n&&n.length))return c;var A=-1,R=[],k=n.length;for(o=Tt(o,3);++A<k;){var V=n[A];o(V,A,n)&&(c.push(V),R.push(A))}return Mf(n,R),c}function uu(n){return n==null?n:s0.call(n)}function pE(n,o,c){var A=n==null?0:n.length;return A?(c&&typeof c!="number"&&De(n,o,c)?(o=0,c=A):(o=o==null?0:Lt(o),c=c===s?A:Lt(c)),en(n,o,c)):[]}function mE(n,o){return Hs(n,o)}function gE(n,o,c){return jl(n,o,Tt(c,2))}function vE(n,o){var c=n==null?0:n.length;if(c){var A=Hs(n,o);if(A<c&&fn(n[A],o))return A}return-1}function yE(n,o){return Hs(n,o,!0)}function bE(n,o,c){return jl(n,o,Tt(c,2),!0)}function EE(n,o){var c=n==null?0:n.length;if(c){var A=Hs(n,o,!0)-1;if(fn(n[A],o))return A}return-1}function CE(n){return n&&n.length?Lf(n):[]}function AE(n,o){return n&&n.length?Lf(n,Tt(o,2)):[]}function OE(n){var o=n==null?0:n.length;return o?en(n,1,o):[]}function SE(n,o,c){return n&&n.length?(o=c||o===s?1:Lt(o),en(n,0,o<0?0:o)):[]}function TE(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Lt(o),o=A-o,en(n,o<0?0:o,A)):[]}function wE(n,o){return n&&n.length?Gs(n,Tt(o,3),!1,!0):[]}function xE(n,o){return n&&n.length?Gs(n,Tt(o,3)):[]}var IE=Bt(function(n){return Qn(Re(n,1,me,!0))}),PE=Bt(function(n){var o=nn(n);return me(o)&&(o=s),Qn(Re(n,1,me,!0),Tt(o,2))}),RE=Bt(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Qn(Re(n,1,me,!0),s,o)});function ME(n){return n&&n.length?Qn(n):[]}function _E(n,o){return n&&n.length?Qn(n,Tt(o,2)):[]}function LE(n,o){return o=typeof o=="function"?o:s,n&&n.length?Qn(n,s,o):[]}function cu(n){if(!(n&&n.length))return[];var o=0;return n=jn(n,function(c){if(me(c))return o=Ce(c.length,o),!0}),xl(o,function(c){return ae(n,Sl(c))})}function bh(n,o){if(!(n&&n.length))return[];var c=cu(n);return o==null?c:ae(c,function(A){return Ge(o,s,A)})}var NE=Bt(function(n,o){return me(n)?ro(n,o):[]}),DE=Bt(function(n){return Kl(jn(n,me))}),FE=Bt(function(n){var o=nn(n);return me(o)&&(o=s),Kl(jn(n,me),Tt(o,2))}),UE=Bt(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Kl(jn(n,me),s,o)}),BE=Bt(cu);function kE(n,o){return Uf(n||[],o||[],no)}function $E(n,o){return Uf(n||[],o||[],so)}var HE=Bt(function(n){var o=n.length,c=o>1?n[o-1]:s;return c=typeof c=="function"?(n.pop(),c):s,bh(n,c)});function Eh(n){var o=F(n);return o.__chain__=!0,o}function GE(n,o){return o(n),n}function Ys(n,o){return o(n)}var WE=Ln(function(n){var o=n.length,c=o?n[0]:0,A=this.__wrapped__,R=function(k){return Dl(k,n)};return o>1||this.__actions__.length||!(A instanceof zt)||!Nn(c)?this.thru(R):(A=A.slice(c,+c+(o?1:0)),A.__actions__.push({func:Ys,args:[R],thisArg:s}),new Xe(A,this.__chain__).thru(function(k){return o&&!k.length&&k.push(s),k}))});function zE(){return Eh(this)}function VE(){return new Xe(this.value(),this.__chain__)}function jE(){this.__values__===s&&(this.__values__=Nh(this.value()));var n=this.__index__>=this.__values__.length,o=n?s:this.__values__[this.__index__++];return{done:n,value:o}}function JE(){return this}function KE(n){for(var o,c=this;c instanceof Fs;){var A=hh(c);A.__index__=0,A.__values__=s,o?R.__wrapped__=A:o=A;var R=A;c=c.__wrapped__}return R.__wrapped__=n,o}function qE(){var n=this.__wrapped__;if(n instanceof zt){var o=n;return this.__actions__.length&&(o=new zt(this)),o=o.reverse(),o.__actions__.push({func:Ys,args:[uu],thisArg:s}),new Xe(o,this.__chain__)}return this.thru(uu)}function ZE(){return Ff(this.__wrapped__,this.__actions__)}var YE=Ws(function(n,o,c){Xt.call(n,c)?++n[c]:Mn(n,c,1)});function QE(n,o,c){var A=Mt(n)?Kd:G0;return c&&De(n,o,c)&&(o=s),A(n,Tt(o,3))}function XE(n,o){var c=Mt(n)?jn:bf;return c(n,Tt(o,3))}var tC=Jf(ph),eC=Jf(mh);function nC(n,o){return Re(Qs(n,o),1)}function rC(n,o){return Re(Qs(n,o),L)}function iC(n,o,c){return c=c===s?1:Lt(c),Re(Qs(n,o),c)}function Ch(n,o){var c=Mt(n)?Ye:Yn;return c(n,Tt(o,3))}function Ah(n,o){var c=Mt(n)?Oy:yf;return c(n,Tt(o,3))}var oC=Ws(function(n,o,c){Xt.call(n,c)?n[c].push(o):Mn(n,c,[o])});function sC(n,o,c,A){n=Be(n)?n:Ei(n),c=c&&!A?Lt(c):0;var R=n.length;return c<0&&(c=Ce(R+c,0)),ra(n)?c<=R&&n.indexOf(o,c)>-1:!!R&&ui(n,o,c)>-1}var aC=Bt(function(n,o,c){var A=-1,R=typeof o=="function",k=Be(n)?nt(n.length):[];return Yn(n,function(V){k[++A]=R?Ge(o,V,c):io(V,o,c)}),k}),lC=Ws(function(n,o,c){Mn(n,c,o)});function Qs(n,o){var c=Mt(n)?ae:Tf;return c(n,Tt(o,3))}function uC(n,o,c,A){return n==null?[]:(Mt(o)||(o=o==null?[]:[o]),c=A?s:c,Mt(c)||(c=c==null?[]:[c]),Pf(n,o,c))}var cC=Ws(function(n,o,c){n[c?0:1].push(o)},function(){return[[],[]]});function dC(n,o,c){var A=Mt(n)?Al:Qd,R=arguments.length<3;return A(n,Tt(o,4),c,R,Yn)}function fC(n,o,c){var A=Mt(n)?Sy:Qd,R=arguments.length<3;return A(n,Tt(o,4),c,R,yf)}function hC(n,o){var c=Mt(n)?jn:bf;return c(n,ea(Tt(o,3)))}function pC(n){var o=Mt(n)?pf:sb;return o(n)}function mC(n,o,c){(c?De(n,o,c):o===s)?o=1:o=Lt(o);var A=Mt(n)?U0:ab;return A(n,o)}function gC(n){var o=Mt(n)?B0:ub;return o(n)}function vC(n){if(n==null)return 0;if(Be(n))return ra(n)?di(n):n.length;var o=Le(n);return o==ft||o==le?n.size:Hl(n).length}function yC(n,o,c){var A=Mt(n)?Ol:cb;return c&&De(n,o,c)&&(o=s),A(n,Tt(o,3))}var bC=Bt(function(n,o){if(n==null)return[];var c=o.length;return c>1&&De(n,o[0],o[1])?o=[]:c>2&&De(o[0],o[1],o[2])&&(o=[o[0]]),Pf(n,Re(o,1),[])}),Xs=Xy||function(){return Se.Date.now()};function EC(n,o){if(typeof o!="function")throw new Qe(i);return n=Lt(n),function(){if(--n<1)return o.apply(this,arguments)}}function Oh(n,o,c){return o=c?s:o,o=n&&o==null?n.length:o,_n(n,f,s,s,s,s,o)}function Sh(n,o){var c;if(typeof o!="function")throw new Qe(i);return n=Lt(n),function(){return--n>0&&(c=o.apply(this,arguments)),n<=1&&(o=s),c}}var du=Bt(function(n,o,c){var A=w;if(c.length){var R=Kn(c,yi(du));A|=g}return _n(n,A,o,c,R)}),Th=Bt(function(n,o,c){var A=w|x;if(c.length){var R=Kn(c,yi(Th));A|=g}return _n(o,A,n,c,R)});function wh(n,o,c){o=c?s:o;var A=_n(n,O,s,s,s,s,s,o);return A.placeholder=wh.placeholder,A}function xh(n,o,c){o=c?s:o;var A=_n(n,P,s,s,s,s,s,o);return A.placeholder=xh.placeholder,A}function Ih(n,o,c){var A,R,k,V,K,Y,st=0,at=!1,lt=!1,ht=!0;if(typeof n!="function")throw new Qe(i);o=rn(o)||0,ue(c)&&(at=!!c.leading,lt="maxWait"in c,k=lt?Ce(rn(c.maxWait)||0,o):k,ht="trailing"in c?!!c.trailing:ht);function bt(ge){var hn=A,Un=R;return A=R=s,st=ge,V=n.apply(Un,hn),V}function wt(ge){return st=ge,K=uo(Ht,o),at?bt(ge):V}function Ft(ge){var hn=ge-Y,Un=ge-st,Jh=o-hn;return lt?_e(Jh,k-Un):Jh}function xt(ge){var hn=ge-Y,Un=ge-st;return Y===s||hn>=o||hn<0||lt&&Un>=k}function Ht(){var ge=Xs();if(xt(ge))return Vt(ge);K=uo(Ht,Ft(ge))}function Vt(ge){return K=s,ht&&A?bt(ge):(A=R=s,V)}function je(){K!==s&&Bf(K),st=0,A=Y=R=K=s}function Fe(){return K===s?V:Vt(Xs())}function Je(){var ge=Xs(),hn=xt(ge);if(A=arguments,R=this,Y=ge,hn){if(K===s)return wt(Y);if(lt)return Bf(K),K=uo(Ht,o),bt(Y)}return K===s&&(K=uo(Ht,o)),V}return Je.cancel=je,Je.flush=Fe,Je}var CC=Bt(function(n,o){return vf(n,1,o)}),AC=Bt(function(n,o,c){return vf(n,rn(o)||0,c)});function OC(n){return _n(n,T)}function ta(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Qe(i);var c=function(){var A=arguments,R=o?o.apply(this,A):A[0],k=c.cache;if(k.has(R))return k.get(R);var V=n.apply(this,A);return c.cache=k.set(R,V)||k,V};return c.cache=new(ta.Cache||Rn),c}ta.Cache=Rn;function ea(n){if(typeof n!="function")throw new Qe(i);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function SC(n){return Sh(2,n)}var TC=db(function(n,o){o=o.length==1&&Mt(o[0])?ae(o[0],We(Tt())):ae(Re(o,1),We(Tt()));var c=o.length;return Bt(function(A){for(var R=-1,k=_e(A.length,c);++R<k;)A[R]=o[R].call(this,A[R]);return Ge(n,this,A)})}),fu=Bt(function(n,o){var c=Kn(o,yi(fu));return _n(n,g,s,o,c)}),Ph=Bt(function(n,o){var c=Kn(o,yi(Ph));return _n(n,b,s,o,c)}),wC=Ln(function(n,o){return _n(n,p,s,s,s,o)});function xC(n,o){if(typeof n!="function")throw new Qe(i);return o=o===s?o:Lt(o),Bt(n,o)}function IC(n,o){if(typeof n!="function")throw new Qe(i);return o=o==null?0:Ce(Lt(o),0),Bt(function(c){var A=c[o],R=tr(c,0,o);return A&&Jn(R,A),Ge(n,this,R)})}function PC(n,o,c){var A=!0,R=!0;if(typeof n!="function")throw new Qe(i);return ue(c)&&(A="leading"in c?!!c.leading:A,R="trailing"in c?!!c.trailing:R),Ih(n,o,{leading:A,maxWait:o,trailing:R})}function RC(n){return Oh(n,1)}function MC(n,o){return fu(Zl(o),n)}function _C(){if(!arguments.length)return[];var n=arguments[0];return Mt(n)?n:[n]}function LC(n){return tn(n,C)}function NC(n,o){return o=typeof o=="function"?o:s,tn(n,C,o)}function DC(n){return tn(n,m|C)}function FC(n,o){return o=typeof o=="function"?o:s,tn(n,m|C,o)}function UC(n,o){return o==null||gf(n,o,Te(o))}function fn(n,o){return n===o||n!==n&&o!==o}var BC=Js(Bl),kC=Js(function(n,o){return n>=o}),Er=Af(function(){return arguments}())?Af:function(n){return pe(n)&&Xt.call(n,"callee")&&!lf.call(n,"callee")},Mt=nt.isArray,$C=Gd?We(Gd):K0;function Be(n){return n!=null&&na(n.length)&&!Dn(n)}function me(n){return pe(n)&&Be(n)}function HC(n){return n===!0||n===!1||pe(n)&&Ne(n)==et}var er=e0||Ou,GC=Wd?We(Wd):q0;function WC(n){return pe(n)&&n.nodeType===1&&!co(n)}function zC(n){if(n==null)return!0;if(Be(n)&&(Mt(n)||typeof n=="string"||typeof n.splice=="function"||er(n)||bi(n)||Er(n)))return!n.length;var o=Le(n);if(o==ft||o==le)return!n.size;if(lo(n))return!Hl(n).length;for(var c in n)if(Xt.call(n,c))return!1;return!0}function VC(n,o){return oo(n,o)}function jC(n,o,c){c=typeof c=="function"?c:s;var A=c?c(n,o):s;return A===s?oo(n,o,s,c):!!A}function hu(n){if(!pe(n))return!1;var o=Ne(n);return o==Et||o==mt||typeof n.message=="string"&&typeof n.name=="string"&&!co(n)}function JC(n){return typeof n=="number"&&cf(n)}function Dn(n){if(!ue(n))return!1;var o=Ne(n);return o==St||o==Wt||o==j||o==un}function Rh(n){return typeof n=="number"&&n==Lt(n)}function na(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=$}function ue(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function pe(n){return n!=null&&typeof n=="object"}var Mh=zd?We(zd):Y0;function KC(n,o){return n===o||$l(n,o,ru(o))}function qC(n,o,c){return c=typeof c=="function"?c:s,$l(n,o,ru(o),c)}function ZC(n){return _h(n)&&n!=+n}function YC(n){if(Nb(n))throw new Rt(r);return Of(n)}function QC(n){return n===null}function XC(n){return n==null}function _h(n){return typeof n=="number"||pe(n)&&Ne(n)==Zt}function co(n){if(!pe(n)||Ne(n)!=oe)return!1;var o=Ps(n);if(o===null)return!0;var c=Xt.call(o,"constructor")&&o.constructor;return typeof c=="function"&&c instanceof c&&Ts.call(c)==qy}var pu=Vd?We(Vd):Q0;function tA(n){return Rh(n)&&n>=-$&&n<=$}var Lh=jd?We(jd):X0;function ra(n){return typeof n=="string"||!Mt(n)&&pe(n)&&Ne(n)==bn}function Ve(n){return typeof n=="symbol"||pe(n)&&Ne(n)==Vn}var bi=Jd?We(Jd):tb;function eA(n){return n===s}function nA(n){return pe(n)&&Le(n)==dr}function rA(n){return pe(n)&&Ne(n)==al}var iA=Js(Gl),oA=Js(function(n,o){return n<=o});function Nh(n){if(!n)return[];if(Be(n))return ra(n)?cn(n):Ue(n);if(Yi&&n[Yi])return Uy(n[Yi]());var o=Le(n),c=o==ft?Pl:o==le?As:Ei;return c(n)}function Fn(n){if(!n)return n===0?n:0;if(n=rn(n),n===L||n===-L){var o=n<0?-1:1;return o*G}return n===n?n:0}function Lt(n){var o=Fn(n),c=o%1;return o===o?c?o-c:o:0}function Dh(n){return n?gr(Lt(n),0,tt):0}function rn(n){if(typeof n=="number")return n;if(Ve(n))return J;if(ue(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=ue(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=Xd(n);var c=$v.test(n);return c||Gv.test(n)?Ey(n.slice(2),c?2:8):kv.test(n)?J:+n}function Fh(n){return Cn(n,ke(n))}function sA(n){return n?gr(Lt(n),-$,$):n===0?n:0}function Yt(n){return n==null?"":ze(n)}var aA=gi(function(n,o){if(lo(o)||Be(o)){Cn(o,Te(o),n);return}for(var c in o)Xt.call(o,c)&&no(n,c,o[c])}),Uh=gi(function(n,o){Cn(o,ke(o),n)}),ia=gi(function(n,o,c,A){Cn(o,ke(o),n,A)}),lA=gi(function(n,o,c,A){Cn(o,Te(o),n,A)}),uA=Ln(Dl);function cA(n,o){var c=mi(n);return o==null?c:mf(c,o)}var dA=Bt(function(n,o){n=ee(n);var c=-1,A=o.length,R=A>2?o[2]:s;for(R&&De(o[0],o[1],R)&&(A=1);++c<A;)for(var k=o[c],V=ke(k),K=-1,Y=V.length;++K<Y;){var st=V[K],at=n[st];(at===s||fn(at,fi[st])&&!Xt.call(n,st))&&(n[st]=k[st])}return n}),fA=Bt(function(n){return n.push(s,th),Ge(Bh,s,n)});function hA(n,o){return qd(n,Tt(o,3),En)}function pA(n,o){return qd(n,Tt(o,3),Ul)}function mA(n,o){return n==null?n:Fl(n,Tt(o,3),ke)}function gA(n,o){return n==null?n:Ef(n,Tt(o,3),ke)}function vA(n,o){return n&&En(n,Tt(o,3))}function yA(n,o){return n&&Ul(n,Tt(o,3))}function bA(n){return n==null?[]:ks(n,Te(n))}function EA(n){return n==null?[]:ks(n,ke(n))}function mu(n,o,c){var A=n==null?s:vr(n,o);return A===s?c:A}function CA(n,o){return n!=null&&rh(n,o,z0)}function gu(n,o){return n!=null&&rh(n,o,V0)}var AA=qf(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=ws.call(o)),n[o]=c},yu($e)),OA=qf(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=ws.call(o)),Xt.call(n,o)?n[o].push(c):n[o]=[c]},Tt),SA=Bt(io);function Te(n){return Be(n)?hf(n):Hl(n)}function ke(n){return Be(n)?hf(n,!0):eb(n)}function TA(n,o){var c={};return o=Tt(o,3),En(n,function(A,R,k){Mn(c,o(A,R,k),A)}),c}function wA(n,o){var c={};return o=Tt(o,3),En(n,function(A,R,k){Mn(c,R,o(A,R,k))}),c}var xA=gi(function(n,o,c){$s(n,o,c)}),Bh=gi(function(n,o,c,A){$s(n,o,c,A)}),IA=Ln(function(n,o){var c={};if(n==null)return c;var A=!1;o=ae(o,function(k){return k=Xn(k,n),A||(A=k.length>1),k}),Cn(n,eu(n),c),A&&(c=tn(c,m|y|C,Ab));for(var R=o.length;R--;)Jl(c,o[R]);return c});function PA(n,o){return kh(n,ea(Tt(o)))}var RA=Ln(function(n,o){return n==null?{}:rb(n,o)});function kh(n,o){if(n==null)return{};var c=ae(eu(n),function(A){return[A]});return o=Tt(o),Rf(n,c,function(A,R){return o(A,R[0])})}function MA(n,o,c){o=Xn(o,n);var A=-1,R=o.length;for(R||(R=1,n=s);++A<R;){var k=n==null?s:n[An(o[A])];k===s&&(A=R,k=c),n=Dn(k)?k.call(n):k}return n}function _A(n,o,c){return n==null?n:so(n,o,c)}function LA(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:so(n,o,c,A)}var $h=Qf(Te),Hh=Qf(ke);function NA(n,o,c){var A=Mt(n),R=A||er(n)||bi(n);if(o=Tt(o,4),c==null){var k=n&&n.constructor;R?c=A?new k:[]:ue(n)?c=Dn(k)?mi(Ps(n)):{}:c={}}return(R?Ye:En)(n,function(V,K,Y){return o(c,V,K,Y)}),c}function DA(n,o){return n==null?!0:Jl(n,o)}function FA(n,o,c){return n==null?n:Df(n,o,Zl(c))}function UA(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:Df(n,o,Zl(c),A)}function Ei(n){return n==null?[]:Il(n,Te(n))}function BA(n){return n==null?[]:Il(n,ke(n))}function kA(n,o,c){return c===s&&(c=o,o=s),c!==s&&(c=rn(c),c=c===c?c:0),o!==s&&(o=rn(o),o=o===o?o:0),gr(rn(n),o,c)}function $A(n,o,c){return o=Fn(o),c===s?(c=o,o=0):c=Fn(c),n=rn(n),j0(n,o,c)}function HA(n,o,c){if(c&&typeof c!="boolean"&&De(n,o,c)&&(o=c=s),c===s&&(typeof o=="boolean"?(c=o,o=s):typeof n=="boolean"&&(c=n,n=s)),n===s&&o===s?(n=0,o=1):(n=Fn(n),o===s?(o=n,n=0):o=Fn(o)),n>o){var A=n;n=o,o=A}if(c||n%1||o%1){var R=df();return _e(n+R*(o-n+by("1e-"+((R+"").length-1))),o)}return zl(n,o)}var GA=vi(function(n,o,c){return o=o.toLowerCase(),n+(c?Gh(o):o)});function Gh(n){return vu(Yt(n).toLowerCase())}function Wh(n){return n=Yt(n),n&&n.replace(zv,_y).replace(uy,"")}function WA(n,o,c){n=Yt(n),o=ze(o);var A=n.length;c=c===s?A:gr(Lt(c),0,A);var R=c;return c-=o.length,c>=0&&n.slice(c,R)==o}function zA(n){return n=Yt(n),n&&Sv.test(n)?n.replace(bd,Ly):n}function VA(n){return n=Yt(n),n&&Rv.test(n)?n.replace(fl,"\\$&"):n}var jA=vi(function(n,o,c){return n+(c?"-":"")+o.toLowerCase()}),JA=vi(function(n,o,c){return n+(c?" ":"")+o.toLowerCase()}),KA=jf("toLowerCase");function qA(n,o,c){n=Yt(n),o=Lt(o);var A=o?di(n):0;if(!o||A>=o)return n;var R=(o-A)/2;return js(Ls(R),c)+n+js(_s(R),c)}function ZA(n,o,c){n=Yt(n),o=Lt(o);var A=o?di(n):0;return o&&A<o?n+js(o-A,c):n}function YA(n,o,c){n=Yt(n),o=Lt(o);var A=o?di(n):0;return o&&A<o?js(o-A,c)+n:n}function QA(n,o,c){return c||o==null?o=0:o&&(o=+o),o0(Yt(n).replace(hl,""),o||0)}function XA(n,o,c){return(c?De(n,o,c):o===s)?o=1:o=Lt(o),Vl(Yt(n),o)}function tO(){var n=arguments,o=Yt(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var eO=vi(function(n,o,c){return n+(c?"_":"")+o.toLowerCase()});function nO(n,o,c){return c&&typeof c!="number"&&De(n,o,c)&&(o=c=s),c=c===s?tt:c>>>0,c?(n=Yt(n),n&&(typeof o=="string"||o!=null&&!pu(o))&&(o=ze(o),!o&&ci(n))?tr(cn(n),0,c):n.split(o,c)):[]}var rO=vi(function(n,o,c){return n+(c?" ":"")+vu(o)});function iO(n,o,c){return n=Yt(n),c=c==null?0:gr(Lt(c),0,n.length),o=ze(o),n.slice(c,c+o.length)==o}function oO(n,o,c){var A=F.templateSettings;c&&De(n,o,c)&&(o=s),n=Yt(n),o=ia({},o,A,Xf);var R=ia({},o.imports,A.imports,Xf),k=Te(R),V=Il(R,k),K,Y,st=0,at=o.interpolate||vs,lt="__p += '",ht=Rl((o.escape||vs).source+"|"+at.source+"|"+(at===Ed?Bv:vs).source+"|"+(o.evaluate||vs).source+"|$","g"),bt="//# sourceURL="+(Xt.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++py+"]")+`
`;n.replace(ht,function(xt,Ht,Vt,je,Fe,Je){return Vt||(Vt=je),lt+=n.slice(st,Je).replace(Vv,Ny),Ht&&(K=!0,lt+=`' +
__e(`+Ht+`) +
'`),Fe&&(Y=!0,lt+=`';
`+Fe+`;
__p += '`),Vt&&(lt+=`' +
((__t = (`+Vt+`)) == null ? '' : __t) +
'`),st=Je+xt.length,xt}),lt+=`';
`;var wt=Xt.call(o,"variable")&&o.variable;if(!wt)lt=`with (obj) {
`+lt+`
}
`;else if(Fv.test(wt))throw new Rt(a);lt=(Y?lt.replace(Ev,""):lt).replace(Cv,"$1").replace(Av,"$1;"),lt="function("+(wt||"obj")+`) {
`+(wt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+lt+`return __p
}`;var Ft=Vh(function(){return Kt(k,bt+"return "+lt).apply(s,V)});if(Ft.source=lt,hu(Ft))throw Ft;return Ft}function sO(n){return Yt(n).toLowerCase()}function aO(n){return Yt(n).toUpperCase()}function lO(n,o,c){if(n=Yt(n),n&&(c||o===s))return Xd(n);if(!n||!(o=ze(o)))return n;var A=cn(n),R=cn(o),k=tf(A,R),V=ef(A,R)+1;return tr(A,k,V).join("")}function uO(n,o,c){if(n=Yt(n),n&&(c||o===s))return n.slice(0,rf(n)+1);if(!n||!(o=ze(o)))return n;var A=cn(n),R=ef(A,cn(o))+1;return tr(A,0,R).join("")}function cO(n,o,c){if(n=Yt(n),n&&(c||o===s))return n.replace(hl,"");if(!n||!(o=ze(o)))return n;var A=cn(n),R=tf(A,cn(o));return tr(A,R).join("")}function dO(n,o){var c=v,A=I;if(ue(o)){var R="separator"in o?o.separator:R;c="length"in o?Lt(o.length):c,A="omission"in o?ze(o.omission):A}n=Yt(n);var k=n.length;if(ci(n)){var V=cn(n);k=V.length}if(c>=k)return n;var K=c-di(A);if(K<1)return A;var Y=V?tr(V,0,K).join(""):n.slice(0,K);if(R===s)return Y+A;if(V&&(K+=Y.length-K),pu(R)){if(n.slice(K).search(R)){var st,at=Y;for(R.global||(R=Rl(R.source,Yt(Cd.exec(R))+"g")),R.lastIndex=0;st=R.exec(at);)var lt=st.index;Y=Y.slice(0,lt===s?K:lt)}}else if(n.indexOf(ze(R),K)!=K){var ht=Y.lastIndexOf(R);ht>-1&&(Y=Y.slice(0,ht))}return Y+A}function fO(n){return n=Yt(n),n&&Ov.test(n)?n.replace(yd,Hy):n}var hO=vi(function(n,o,c){return n+(c?" ":"")+o.toUpperCase()}),vu=jf("toUpperCase");function zh(n,o,c){return n=Yt(n),o=c?s:o,o===s?Fy(n)?zy(n):xy(n):n.match(o)||[]}var Vh=Bt(function(n,o){try{return Ge(n,s,o)}catch(c){return hu(c)?c:new Rt(c)}}),pO=Ln(function(n,o){return Ye(o,function(c){c=An(c),Mn(n,c,du(n[c],n))}),n});function mO(n){var o=n==null?0:n.length,c=Tt();return n=o?ae(n,function(A){if(typeof A[1]!="function")throw new Qe(i);return[c(A[0]),A[1]]}):[],Bt(function(A){for(var R=-1;++R<o;){var k=n[R];if(Ge(k[0],this,A))return Ge(k[1],this,A)}})}function gO(n){return H0(tn(n,m))}function yu(n){return function(){return n}}function vO(n,o){return n==null||n!==n?o:n}var yO=Kf(),bO=Kf(!0);function $e(n){return n}function bu(n){return Sf(typeof n=="function"?n:tn(n,m))}function EO(n){return wf(tn(n,m))}function CO(n,o){return xf(n,tn(o,m))}var AO=Bt(function(n,o){return function(c){return io(c,n,o)}}),OO=Bt(function(n,o){return function(c){return io(n,c,o)}});function Eu(n,o,c){var A=Te(o),R=ks(o,A);c==null&&!(ue(o)&&(R.length||!A.length))&&(c=o,o=n,n=this,R=ks(o,Te(o)));var k=!(ue(c)&&"chain"in c)||!!c.chain,V=Dn(n);return Ye(R,function(K){var Y=o[K];n[K]=Y,V&&(n.prototype[K]=function(){var st=this.__chain__;if(k||st){var at=n(this.__wrapped__),lt=at.__actions__=Ue(this.__actions__);return lt.push({func:Y,args:arguments,thisArg:n}),at.__chain__=st,at}return Y.apply(n,Jn([this.value()],arguments))})}),n}function SO(){return Se._===this&&(Se._=Zy),this}function Cu(){}function TO(n){return n=Lt(n),Bt(function(o){return If(o,n)})}var wO=Ql(ae),xO=Ql(Kd),IO=Ql(Ol);function jh(n){return ou(n)?Sl(An(n)):ib(n)}function PO(n){return function(o){return n==null?s:vr(n,o)}}var RO=Zf(),MO=Zf(!0);function Au(){return[]}function Ou(){return!1}function _O(){return{}}function LO(){return""}function NO(){return!0}function DO(n,o){if(n=Lt(n),n<1||n>$)return[];var c=tt,A=_e(n,tt);o=Tt(o),n-=tt;for(var R=xl(A,o);++c<n;)o(c);return R}function FO(n){return Mt(n)?ae(n,An):Ve(n)?[n]:Ue(fh(Yt(n)))}function UO(n){var o=++Ky;return Yt(n)+o}var BO=Vs(function(n,o){return n+o},0),kO=Xl("ceil"),$O=Vs(function(n,o){return n/o},1),HO=Xl("floor");function GO(n){return n&&n.length?Bs(n,$e,Bl):s}function WO(n,o){return n&&n.length?Bs(n,Tt(o,2),Bl):s}function zO(n){return Yd(n,$e)}function VO(n,o){return Yd(n,Tt(o,2))}function jO(n){return n&&n.length?Bs(n,$e,Gl):s}function JO(n,o){return n&&n.length?Bs(n,Tt(o,2),Gl):s}var KO=Vs(function(n,o){return n*o},1),qO=Xl("round"),ZO=Vs(function(n,o){return n-o},0);function YO(n){return n&&n.length?wl(n,$e):0}function QO(n,o){return n&&n.length?wl(n,Tt(o,2)):0}return F.after=EC,F.ary=Oh,F.assign=aA,F.assignIn=Uh,F.assignInWith=ia,F.assignWith=lA,F.at=uA,F.before=Sh,F.bind=du,F.bindAll=pO,F.bindKey=Th,F.castArray=_C,F.chain=Eh,F.chunk=Hb,F.compact=Gb,F.concat=Wb,F.cond=mO,F.conforms=gO,F.constant=yu,F.countBy=YE,F.create=cA,F.curry=wh,F.curryRight=xh,F.debounce=Ih,F.defaults=dA,F.defaultsDeep=fA,F.defer=CC,F.delay=AC,F.difference=zb,F.differenceBy=Vb,F.differenceWith=jb,F.drop=Jb,F.dropRight=Kb,F.dropRightWhile=qb,F.dropWhile=Zb,F.fill=Yb,F.filter=XE,F.flatMap=nC,F.flatMapDeep=rC,F.flatMapDepth=iC,F.flatten=gh,F.flattenDeep=Qb,F.flattenDepth=Xb,F.flip=OC,F.flow=yO,F.flowRight=bO,F.fromPairs=tE,F.functions=bA,F.functionsIn=EA,F.groupBy=oC,F.initial=nE,F.intersection=rE,F.intersectionBy=iE,F.intersectionWith=oE,F.invert=AA,F.invertBy=OA,F.invokeMap=aC,F.iteratee=bu,F.keyBy=lC,F.keys=Te,F.keysIn=ke,F.map=Qs,F.mapKeys=TA,F.mapValues=wA,F.matches=EO,F.matchesProperty=CO,F.memoize=ta,F.merge=xA,F.mergeWith=Bh,F.method=AO,F.methodOf=OO,F.mixin=Eu,F.negate=ea,F.nthArg=TO,F.omit=IA,F.omitBy=PA,F.once=SC,F.orderBy=uC,F.over=wO,F.overArgs=TC,F.overEvery=xO,F.overSome=IO,F.partial=fu,F.partialRight=Ph,F.partition=cC,F.pick=RA,F.pickBy=kh,F.property=jh,F.propertyOf=PO,F.pull=uE,F.pullAll=yh,F.pullAllBy=cE,F.pullAllWith=dE,F.pullAt=fE,F.range=RO,F.rangeRight=MO,F.rearg=wC,F.reject=hC,F.remove=hE,F.rest=xC,F.reverse=uu,F.sampleSize=mC,F.set=_A,F.setWith=LA,F.shuffle=gC,F.slice=pE,F.sortBy=bC,F.sortedUniq=CE,F.sortedUniqBy=AE,F.split=nO,F.spread=IC,F.tail=OE,F.take=SE,F.takeRight=TE,F.takeRightWhile=wE,F.takeWhile=xE,F.tap=GE,F.throttle=PC,F.thru=Ys,F.toArray=Nh,F.toPairs=$h,F.toPairsIn=Hh,F.toPath=FO,F.toPlainObject=Fh,F.transform=NA,F.unary=RC,F.union=IE,F.unionBy=PE,F.unionWith=RE,F.uniq=ME,F.uniqBy=_E,F.uniqWith=LE,F.unset=DA,F.unzip=cu,F.unzipWith=bh,F.update=FA,F.updateWith=UA,F.values=Ei,F.valuesIn=BA,F.without=NE,F.words=zh,F.wrap=MC,F.xor=DE,F.xorBy=FE,F.xorWith=UE,F.zip=BE,F.zipObject=kE,F.zipObjectDeep=$E,F.zipWith=HE,F.entries=$h,F.entriesIn=Hh,F.extend=Uh,F.extendWith=ia,Eu(F,F),F.add=BO,F.attempt=Vh,F.camelCase=GA,F.capitalize=Gh,F.ceil=kO,F.clamp=kA,F.clone=LC,F.cloneDeep=DC,F.cloneDeepWith=FC,F.cloneWith=NC,F.conformsTo=UC,F.deburr=Wh,F.defaultTo=vO,F.divide=$O,F.endsWith=WA,F.eq=fn,F.escape=zA,F.escapeRegExp=VA,F.every=QE,F.find=tC,F.findIndex=ph,F.findKey=hA,F.findLast=eC,F.findLastIndex=mh,F.findLastKey=pA,F.floor=HO,F.forEach=Ch,F.forEachRight=Ah,F.forIn=mA,F.forInRight=gA,F.forOwn=vA,F.forOwnRight=yA,F.get=mu,F.gt=BC,F.gte=kC,F.has=CA,F.hasIn=gu,F.head=vh,F.identity=$e,F.includes=sC,F.indexOf=eE,F.inRange=$A,F.invoke=SA,F.isArguments=Er,F.isArray=Mt,F.isArrayBuffer=$C,F.isArrayLike=Be,F.isArrayLikeObject=me,F.isBoolean=HC,F.isBuffer=er,F.isDate=GC,F.isElement=WC,F.isEmpty=zC,F.isEqual=VC,F.isEqualWith=jC,F.isError=hu,F.isFinite=JC,F.isFunction=Dn,F.isInteger=Rh,F.isLength=na,F.isMap=Mh,F.isMatch=KC,F.isMatchWith=qC,F.isNaN=ZC,F.isNative=YC,F.isNil=XC,F.isNull=QC,F.isNumber=_h,F.isObject=ue,F.isObjectLike=pe,F.isPlainObject=co,F.isRegExp=pu,F.isSafeInteger=tA,F.isSet=Lh,F.isString=ra,F.isSymbol=Ve,F.isTypedArray=bi,F.isUndefined=eA,F.isWeakMap=nA,F.isWeakSet=rA,F.join=sE,F.kebabCase=jA,F.last=nn,F.lastIndexOf=aE,F.lowerCase=JA,F.lowerFirst=KA,F.lt=iA,F.lte=oA,F.max=GO,F.maxBy=WO,F.mean=zO,F.meanBy=VO,F.min=jO,F.minBy=JO,F.stubArray=Au,F.stubFalse=Ou,F.stubObject=_O,F.stubString=LO,F.stubTrue=NO,F.multiply=KO,F.nth=lE,F.noConflict=SO,F.noop=Cu,F.now=Xs,F.pad=qA,F.padEnd=ZA,F.padStart=YA,F.parseInt=QA,F.random=HA,F.reduce=dC,F.reduceRight=fC,F.repeat=XA,F.replace=tO,F.result=MA,F.round=qO,F.runInContext=Z,F.sample=pC,F.size=vC,F.snakeCase=eO,F.some=yC,F.sortedIndex=mE,F.sortedIndexBy=gE,F.sortedIndexOf=vE,F.sortedLastIndex=yE,F.sortedLastIndexBy=bE,F.sortedLastIndexOf=EE,F.startCase=rO,F.startsWith=iO,F.subtract=ZO,F.sum=YO,F.sumBy=QO,F.template=oO,F.times=DO,F.toFinite=Fn,F.toInteger=Lt,F.toLength=Dh,F.toLower=sO,F.toNumber=rn,F.toSafeInteger=sA,F.toString=Yt,F.toUpper=aO,F.trim=lO,F.trimEnd=uO,F.trimStart=cO,F.truncate=dO,F.unescape=fO,F.uniqueId=UO,F.upperCase=hO,F.upperFirst=vu,F.each=Ch,F.eachRight=Ah,F.first=vh,Eu(F,function(){var n={};return En(F,function(o,c){Xt.call(F.prototype,c)||(n[c]=o)}),n}(),{chain:!1}),F.VERSION=e,Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){F[n].placeholder=F}),Ye(["drop","take"],function(n,o){zt.prototype[n]=function(c){c=c===s?1:Ce(Lt(c),0);var A=this.__filtered__&&!o?new zt(this):this.clone();return A.__filtered__?A.__takeCount__=_e(c,A.__takeCount__):A.__views__.push({size:_e(c,tt),type:n+(A.__dir__<0?"Right":"")}),A},zt.prototype[n+"Right"]=function(c){return this.reverse()[n](c).reverse()}}),Ye(["filter","map","takeWhile"],function(n,o){var c=o+1,A=c==W||c==M;zt.prototype[n]=function(R){var k=this.clone();return k.__iteratees__.push({iteratee:Tt(R,3),type:c}),k.__filtered__=k.__filtered__||A,k}}),Ye(["head","last"],function(n,o){var c="take"+(o?"Right":"");zt.prototype[n]=function(){return this[c](1).value()[0]}}),Ye(["initial","tail"],function(n,o){var c="drop"+(o?"":"Right");zt.prototype[n]=function(){return this.__filtered__?new zt(this):this[c](1)}}),zt.prototype.compact=function(){return this.filter($e)},zt.prototype.find=function(n){return this.filter(n).head()},zt.prototype.findLast=function(n){return this.reverse().find(n)},zt.prototype.invokeMap=Bt(function(n,o){return typeof n=="function"?new zt(this):this.map(function(c){return io(c,n,o)})}),zt.prototype.reject=function(n){return this.filter(ea(Tt(n)))},zt.prototype.slice=function(n,o){n=Lt(n);var c=this;return c.__filtered__&&(n>0||o<0)?new zt(c):(n<0?c=c.takeRight(-n):n&&(c=c.drop(n)),o!==s&&(o=Lt(o),c=o<0?c.dropRight(-o):c.take(o-n)),c)},zt.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},zt.prototype.toArray=function(){return this.take(tt)},En(zt.prototype,function(n,o){var c=/^(?:filter|find|map|reject)|While$/.test(o),A=/^(?:head|last)$/.test(o),R=F[A?"take"+(o=="last"?"Right":""):o],k=A||/^find/.test(o);!R||(F.prototype[o]=function(){var V=this.__wrapped__,K=A?[1]:arguments,Y=V instanceof zt,st=K[0],at=Y||Mt(V),lt=function(Ht){var Vt=R.apply(F,Jn([Ht],K));return A&&ht?Vt[0]:Vt};at&&c&&typeof st=="function"&&st.length!=1&&(Y=at=!1);var ht=this.__chain__,bt=!!this.__actions__.length,wt=k&&!ht,Ft=Y&&!bt;if(!k&&at){V=Ft?V:new zt(this);var xt=n.apply(V,K);return xt.__actions__.push({func:Ys,args:[lt],thisArg:s}),new Xe(xt,ht)}return wt&&Ft?n.apply(this,K):(xt=this.thru(lt),wt?A?xt.value()[0]:xt.value():xt)})}),Ye(["pop","push","shift","sort","splice","unshift"],function(n){var o=Os[n],c=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",A=/^(?:pop|shift)$/.test(n);F.prototype[n]=function(){var R=arguments;if(A&&!this.__chain__){var k=this.value();return o.apply(Mt(k)?k:[],R)}return this[c](function(V){return o.apply(Mt(V)?V:[],R)})}}),En(zt.prototype,function(n,o){var c=F[o];if(c){var A=c.name+"";Xt.call(pi,A)||(pi[A]=[]),pi[A].push({name:o,func:c})}}),pi[zs(s,x).name]=[{name:"wrapper",func:s}],zt.prototype.clone=f0,zt.prototype.reverse=h0,zt.prototype.value=p0,F.prototype.at=WE,F.prototype.chain=zE,F.prototype.commit=VE,F.prototype.next=jE,F.prototype.plant=KE,F.prototype.reverse=qE,F.prototype.toJSON=F.prototype.valueOf=F.prototype.value=ZE,F.prototype.first=F.prototype.head,Yi&&(F.prototype[Yi]=JE),F},qn=Vy();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Se._=qn,define(function(){return qn})):fr?((fr.exports=qn)._=qn,bl._=qn):Se._=qn}).call(Ti)});var kp=ve((Ao,Uu)=>{N();(function(s,e){typeof Ao=="object"&&typeof Uu=="object"?Uu.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Ao=="object"?Ao.bowser=e():s.bowser=e()})(Ao,function(){return function(s){var e={};function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=s,t.c=e,t.d=function(r,i,a){t.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,i){if(1&i&&(r=t(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var l in r)t.d(a,l,function(u){return r[u]}.bind(null,l));return a},t.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(i,"a",i),i},t.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},t.p="",t(t.s=90)}({17:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=t(18),i=function(){function a(){}return a.getFirstMatch=function(l,u){var d=u.match(l);return d&&d.length>0&&d[1]||""},a.getSecondMatch=function(l,u){var d=u.match(l);return d&&d.length>1&&d[2]||""},a.matchAndReturnConst=function(l,u,d){if(l.test(u))return d},a.getWindowsVersionName=function(l){switch(l){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},a.getMacOSVersionName=function(l){var u=l.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(u.push(0),u[0]===10)switch(u[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},a.getAndroidVersionName=function(l){var u=l.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(u.push(0),!(u[0]===1&&u[1]<5))return u[0]===1&&u[1]<6?"Cupcake":u[0]===1&&u[1]>=6?"Donut":u[0]===2&&u[1]<2?"Eclair":u[0]===2&&u[1]===2?"Froyo":u[0]===2&&u[1]>2?"Gingerbread":u[0]===3?"Honeycomb":u[0]===4&&u[1]<1?"Ice Cream Sandwich":u[0]===4&&u[1]<4?"Jelly Bean":u[0]===4&&u[1]>=4?"KitKat":u[0]===5?"Lollipop":u[0]===6?"Marshmallow":u[0]===7?"Nougat":u[0]===8?"Oreo":u[0]===9?"Pie":void 0},a.getVersionPrecision=function(l){return l.split(".").length},a.compareVersions=function(l,u,d){d===void 0&&(d=!1);var m=a.getVersionPrecision(l),y=a.getVersionPrecision(u),C=Math.max(m,y),h=0,E=a.map([l,u],function(w){var x=C-a.getVersionPrecision(w),S=w+new Array(x+1).join(".0");return a.map(S.split("."),function(O){return new Array(20-O.length).join("0")+O}).reverse()});for(d&&(h=C-Math.min(m,y)),C-=1;C>=h;){if(E[0][C]>E[1][C])return 1;if(E[0][C]===E[1][C]){if(C===h)return 0;C-=1}else if(E[0][C]<E[1][C])return-1}},a.map=function(l,u){var d,m=[];if(Array.prototype.map)return Array.prototype.map.call(l,u);for(d=0;d<l.length;d+=1)m.push(u(l[d]));return m},a.find=function(l,u){var d,m;if(Array.prototype.find)return Array.prototype.find.call(l,u);for(d=0,m=l.length;d<m;d+=1){var y=l[d];if(u(y,d))return y}},a.assign=function(l){for(var u,d,m=l,y=arguments.length,C=new Array(y>1?y-1:0),h=1;h<y;h++)C[h-1]=arguments[h];if(Object.assign)return Object.assign.apply(Object,[l].concat(C));var E=function(){var w=C[u];typeof w=="object"&&w!==null&&Object.keys(w).forEach(function(x){m[x]=w[x]})};for(u=0,d=C.length;u<d;u+=1)E();return l},a.getBrowserAlias=function(l){return r.BROWSER_ALIASES_MAP[l]},a.getBrowserTypeByAlias=function(l){return r.BROWSER_MAP[l]||""},a}();e.default=i,s.exports=e.default},18:function(s,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(91))&&r.__esModule?r:{default:r},a=t(18);function l(d,m){for(var y=0;y<m.length;y++){var C=m[y];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(d,C.key,C)}}var u=function(){function d(){}var m,y,C;return d.getParser=function(h,E){if(E===void 0&&(E=!1),typeof h!="string")throw new Error("UserAgent should be a string");return new i.default(h,E)},d.parse=function(h){return new i.default(h).getResult()},m=d,C=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(y=null)&&l(m.prototype,y),C&&l(m,C),d}();e.default=u,s.exports=e.default},91:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=d(t(92)),i=d(t(93)),a=d(t(94)),l=d(t(95)),u=d(t(17));function d(y){return y&&y.__esModule?y:{default:y}}var m=function(){function y(h,E){if(E===void 0&&(E=!1),h==null||h==="")throw new Error("UserAgent parameter can't be empty");this._ua=h,this.parsedResult={},E!==!0&&this.parse()}var C=y.prototype;return C.getUA=function(){return this._ua},C.test=function(h){return h.test(this._ua)},C.parseBrowser=function(){var h=this;this.parsedResult.browser={};var E=u.default.find(r.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.browser=E.describe(this.getUA())),this.parsedResult.browser},C.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},C.getBrowserName=function(h){return h?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},C.getBrowserVersion=function(){return this.getBrowser().version},C.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},C.parseOS=function(){var h=this;this.parsedResult.os={};var E=u.default.find(i.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.os=E.describe(this.getUA())),this.parsedResult.os},C.getOSName=function(h){var E=this.getOS().name;return h?String(E).toLowerCase()||"":E||""},C.getOSVersion=function(){return this.getOS().version},C.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},C.getPlatformType=function(h){h===void 0&&(h=!1);var E=this.getPlatform().type;return h?String(E).toLowerCase()||"":E||""},C.parsePlatform=function(){var h=this;this.parsedResult.platform={};var E=u.default.find(a.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.platform=E.describe(this.getUA())),this.parsedResult.platform},C.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},C.getEngineName=function(h){return h?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},C.parseEngine=function(){var h=this;this.parsedResult.engine={};var E=u.default.find(l.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.engine=E.describe(this.getUA())),this.parsedResult.engine},C.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},C.getResult=function(){return u.default.assign({},this.parsedResult)},C.satisfies=function(h){var E=this,w={},x=0,S={},O=0;if(Object.keys(h).forEach(function(I){var U=h[I];typeof U=="string"?(S[I]=U,O+=1):typeof U=="object"&&(w[I]=U,x+=1)}),x>0){var P=Object.keys(w),g=u.default.find(P,function(I){return E.isOS(I)});if(g){var b=this.satisfies(w[g]);if(b!==void 0)return b}var f=u.default.find(P,function(I){return E.isPlatform(I)});if(f){var p=this.satisfies(w[f]);if(p!==void 0)return p}}if(O>0){var T=Object.keys(S),v=u.default.find(T,function(I){return E.isBrowser(I,!0)});if(v!==void 0)return this.compareVersion(S[v])}},C.isBrowser=function(h,E){E===void 0&&(E=!1);var w=this.getBrowserName().toLowerCase(),x=h.toLowerCase(),S=u.default.getBrowserTypeByAlias(x);return E&&S&&(x=S.toLowerCase()),x===w},C.compareVersion=function(h){var E=[0],w=h,x=!1,S=this.getBrowserVersion();if(typeof S=="string")return h[0]===">"||h[0]==="<"?(w=h.substr(1),h[1]==="="?(x=!0,w=h.substr(2)):E=[],h[0]===">"?E.push(1):E.push(-1)):h[0]==="="?w=h.substr(1):h[0]==="~"&&(x=!0,w=h.substr(1)),E.indexOf(u.default.compareVersions(S,w,x))>-1},C.isOS=function(h){return this.getOSName(!0)===String(h).toLowerCase()},C.isPlatform=function(h){return this.getPlatformType(!0)===String(h).toLowerCase()},C.isEngine=function(h){return this.getEngineName(!0)===String(h).toLowerCase()},C.is=function(h,E){return E===void 0&&(E=!1),this.isBrowser(h,E)||this.isOS(h)||this.isPlatform(h)},C.some=function(h){var E=this;return h===void 0&&(h=[]),h.some(function(w){return E.is(w)})},y}();e.default=m,s.exports=e.default},92:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=/version\/(\d+(\.?_?\d+)+)/i,l=[{test:[/googlebot/i],describe:function(u){var d={name:"Googlebot"},m=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/opera/i],describe:function(u){var d={name:"Opera"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/opr\/|opios/i],describe:function(u){var d={name:"Opera"},m=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/SamsungBrowser/i],describe:function(u){var d={name:"Samsung Internet for Android"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/Whale/i],describe:function(u){var d={name:"NAVER Whale Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/MZBrowser/i],describe:function(u){var d={name:"MZ Browser"},m=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/focus/i],describe:function(u){var d={name:"Focus"},m=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/swing/i],describe:function(u){var d={name:"Swing"},m=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/coast/i],describe:function(u){var d={name:"Opera Coast"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(u){var d={name:"Opera Touch"},m=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/yabrowser/i],describe:function(u){var d={name:"Yandex Browser"},m=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/ucbrowser/i],describe:function(u){var d={name:"UC Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/Maxthon|mxios/i],describe:function(u){var d={name:"Maxthon"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/epiphany/i],describe:function(u){var d={name:"Epiphany"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/puffin/i],describe:function(u){var d={name:"Puffin"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/sleipnir/i],describe:function(u){var d={name:"Sleipnir"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/k-meleon/i],describe:function(u){var d={name:"K-Meleon"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/micromessenger/i],describe:function(u){var d={name:"WeChat"},m=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/qqbrowser/i],describe:function(u){var d={name:/qqbrowserlite/i.test(u)?"QQ Browser Lite":"QQ Browser"},m=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/msie|trident/i],describe:function(u){var d={name:"Internet Explorer"},m=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/\sedg\//i],describe:function(u){var d={name:"Microsoft Edge"},m=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/edg([ea]|ios)/i],describe:function(u){var d={name:"Microsoft Edge"},m=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/vivaldi/i],describe:function(u){var d={name:"Vivaldi"},m=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/seamonkey/i],describe:function(u){var d={name:"SeaMonkey"},m=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/sailfish/i],describe:function(u){var d={name:"Sailfish"},m=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,u);return m&&(d.version=m),d}},{test:[/silk/i],describe:function(u){var d={name:"Amazon Silk"},m=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/phantom/i],describe:function(u){var d={name:"PhantomJS"},m=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/slimerjs/i],describe:function(u){var d={name:"SlimerJS"},m=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var d={name:"BlackBerry"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var d={name:"WebOS Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/bada/i],describe:function(u){var d={name:"Bada"},m=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/tizen/i],describe:function(u){var d={name:"Tizen"},m=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/qupzilla/i],describe:function(u){var d={name:"QupZilla"},m=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(u){var d={name:"Firefox"},m=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/electron/i],describe:function(u){var d={name:"Electron"},m=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/MiuiBrowser/i],describe:function(u){var d={name:"Miui"},m=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/chromium/i],describe:function(u){var d={name:"Chromium"},m=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/chrome|crios|crmo/i],describe:function(u){var d={name:"Chrome"},m=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/GSA/i],describe:function(u){var d={name:"Google Search"},m=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:function(u){var d=!u.test(/like android/i),m=u.test(/android/i);return d&&m},describe:function(u){var d={name:"Android Browser"},m=i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/playstation 4/i],describe:function(u){var d={name:"PlayStation 4"},m=i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/safari|applewebkit/i],describe:function(u){var d={name:"Safari"},m=i.default.getFirstMatch(a,u);return m&&(d.version=m),d}},{test:[/.*/i],describe:function(u){var d=u.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(d,u),version:i.default.getSecondMatch(d,u)}}}];e.default=l,s.exports=e.default},93:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),l=[{test:[/Roku\/DVP/],describe:function(u){var d=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,u);return{name:a.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(u){var d=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(u){var d=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,u),m=i.default.getWindowsVersionName(d);return{name:a.OS_MAP.Windows,version:d,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(u){var d={name:a.OS_MAP.iOS},m=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,u);return m&&(d.version=m),d}},{test:[/macintosh/i],describe:function(u){var d=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,u).replace(/[_\s]/g,"."),m=i.default.getMacOSVersionName(d),y={name:a.OS_MAP.MacOS,version:d};return m&&(y.versionName=m),y}},{test:[/(ipod|iphone|ipad)/i],describe:function(u){var d=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,u).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:d}}},{test:function(u){var d=!u.test(/like android/i),m=u.test(/android/i);return d&&m},describe:function(u){var d=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,u),m=i.default.getAndroidVersionName(d),y={name:a.OS_MAP.Android,version:d};return m&&(y.versionName=m),y}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var d=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,u),m={name:a.OS_MAP.WebOS};return d&&d.length&&(m.version=d),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var d=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,u)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,u)||i.default.getFirstMatch(/\bbb(\d+)/i,u);return{name:a.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(u){var d=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(u){var d=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(u){var d=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.PlayStation4,version:d}}}];e.default=l,s.exports=e.default},94:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),l=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(u){var d=i.default.getFirstMatch(/(can-l01)/i,u)&&"Nova",m={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(m.model=d),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){var d=u.test(/ipod|iphone/i),m=u.test(/like (ipod|iphone)/i);return d&&!m},describe:function(u){var d=i.default.getFirstMatch(/(ipod|iphone)/i,u);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName(!0)==="blackberry"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(u){return u.getBrowserName(!0)==="bada"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName()==="windows phone"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(u){var d=Number(String(u.getOSVersion()).split(".")[0]);return u.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){return u.getOSName(!0)==="android"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getOSName(!0)==="macos"},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(u){return u.getOSName(!0)==="windows"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="linux"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="playstation 4"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(u){return u.getOSName(!0)==="roku"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];e.default=l,s.exports=e.default},95:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),l=[{test:function(u){return u.getBrowserName(!0)==="microsoft edge"},describe:function(u){if(/\sedg\//i.test(u))return{name:a.ENGINE_MAP.Blink};var d=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,u);return{name:a.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(u){var d={name:a.ENGINE_MAP.Trident},m=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:function(u){return u.test(/presto/i)},describe:function(u){var d={name:a.ENGINE_MAP.Presto},m=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:function(u){var d=u.test(/gecko/i),m=u.test(/like gecko/i);return d&&!m},describe:function(u){var d={name:a.ENGINE_MAP.Gecko},m=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(u){var d={name:a.ENGINE_MAP.WebKit},m=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,u);return m&&(d.version=m),d}}];e.default=l,s.exports=e.default}})})});var Wp={};Qh(Wp,{version:()=>fT});var fT,zp=wu(()=>{N();fT="lab"});var Vp={};Qh(Vp,{default:()=>hT});var hT,jp=wu(()=>{N();hT={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var Jp=ve((Ca,Hu)=>{N();(function(e,t){typeof Ca=="object"&&typeof Hu=="object"?Hu.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Ca=="object"?Ca.Ably=t():e.Ably=t()})(window,function(){return function(s){var e={};function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=s,t.c=e,t.d=function(r,i,a){t.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,i){if(i&1&&(r=t(r)),i&8||i&4&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),i&2&&typeof r!="string")for(var l in r)t.d(a,l,function(u){return r[u]}.bind(null,l));return a},t.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(i,"a",i),i},t.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},t.p="",t(t.s=42)}([function(s,e,t){"use strict";t.r(e),t.d(e,"__extends",function(){return i}),t.d(e,"__assign",function(){return a}),t.d(e,"__rest",function(){return l}),t.d(e,"__decorate",function(){return u}),t.d(e,"__param",function(){return d}),t.d(e,"__metadata",function(){return m}),t.d(e,"__awaiter",function(){return y}),t.d(e,"__generator",function(){return C}),t.d(e,"__createBinding",function(){return h}),t.d(e,"__exportStar",function(){return E}),t.d(e,"__values",function(){return w}),t.d(e,"__read",function(){return x}),t.d(e,"__spread",function(){return S}),t.d(e,"__spreadArrays",function(){return O}),t.d(e,"__spreadArray",function(){return P}),t.d(e,"__await",function(){return g}),t.d(e,"__asyncGenerator",function(){return b}),t.d(e,"__asyncDelegator",function(){return f}),t.d(e,"__asyncValues",function(){return p}),t.d(e,"__makeTemplateObject",function(){return T}),t.d(e,"__importStar",function(){return I}),t.d(e,"__importDefault",function(){return U}),t.d(e,"__classPrivateFieldGet",function(){return z}),t.d(e,"__classPrivateFieldSet",function(){return W});var r=function(D,M){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,$){L.__proto__=$}||function(L,$){for(var G in $)Object.prototype.hasOwnProperty.call($,G)&&(L[G]=$[G])},r(D,M)};function i(D,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");r(D,M);function L(){this.constructor=D}D.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}var a=function(){return a=Object.assign||function(M){for(var L,$=1,G=arguments.length;$<G;$++){L=arguments[$];for(var J in L)Object.prototype.hasOwnProperty.call(L,J)&&(M[J]=L[J])}return M},a.apply(this,arguments)};function l(D,M){var L={};for(var $ in D)Object.prototype.hasOwnProperty.call(D,$)&&M.indexOf($)<0&&(L[$]=D[$]);if(D!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,$=Object.getOwnPropertySymbols(D);G<$.length;G++)M.indexOf($[G])<0&&Object.prototype.propertyIsEnumerable.call(D,$[G])&&(L[$[G]]=D[$[G]]);return L}function u(D,M,L,$){var G=arguments.length,J=G<3?M:$===null?$=Object.getOwnPropertyDescriptor(M,L):$,tt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(D,M,L,$);else for(var rt=D.length-1;rt>=0;rt--)(tt=D[rt])&&(J=(G<3?tt(J):G>3?tt(M,L,J):tt(M,L))||J);return G>3&&J&&Object.defineProperty(M,L,J),J}function d(D,M){return function(L,$){M(L,$,D)}}function m(D,M){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(D,M)}function y(D,M,L,$){function G(J){return J instanceof L?J:new L(function(tt){tt(J)})}return new(L||(L=Promise))(function(J,tt){function rt(B){try{_($.next(B))}catch(H){tt(H)}}function X(B){try{_($.throw(B))}catch(H){tt(H)}}function _(B){B.done?J(B.value):G(B.value).then(rt,X)}_(($=$.apply(D,M||[])).next())})}function C(D,M){var L={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},$,G,J,tt;return tt={next:rt(0),throw:rt(1),return:rt(2)},typeof Symbol=="function"&&(tt[Symbol.iterator]=function(){return this}),tt;function rt(_){return function(B){return X([_,B])}}function X(_){if($)throw new TypeError("Generator is already executing.");for(;L;)try{if($=1,G&&(J=_[0]&2?G.return:_[0]?G.throw||((J=G.return)&&J.call(G),0):G.next)&&!(J=J.call(G,_[1])).done)return J;switch(G=0,J&&(_=[_[0]&2,J.value]),_[0]){case 0:case 1:J=_;break;case 4:return L.label++,{value:_[1],done:!1};case 5:L.label++,G=_[1],_=[0];continue;case 7:_=L.ops.pop(),L.trys.pop();continue;default:if(J=L.trys,!(J=J.length>0&&J[J.length-1])&&(_[0]===6||_[0]===2)){L=0;continue}if(_[0]===3&&(!J||_[1]>J[0]&&_[1]<J[3])){L.label=_[1];break}if(_[0]===6&&L.label<J[1]){L.label=J[1],J=_;break}if(J&&L.label<J[2]){L.label=J[2],L.ops.push(_);break}J[2]&&L.ops.pop(),L.trys.pop();continue}_=M.call(D,L)}catch(B){_=[6,B],G=0}finally{$=J=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var h=Object.create?function(D,M,L,$){$===void 0&&($=L),Object.defineProperty(D,$,{enumerable:!0,get:function(){return M[L]}})}:function(D,M,L,$){$===void 0&&($=L),D[$]=M[L]};function E(D,M){for(var L in D)L!=="default"&&!Object.prototype.hasOwnProperty.call(M,L)&&h(M,D,L)}function w(D){var M=typeof Symbol=="function"&&Symbol.iterator,L=M&&D[M],$=0;if(L)return L.call(D);if(D&&typeof D.length=="number")return{next:function(){return D&&$>=D.length&&(D=void 0),{value:D&&D[$++],done:!D}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(D,M){var L=typeof Symbol=="function"&&D[Symbol.iterator];if(!L)return D;var $=L.call(D),G,J=[],tt;try{for(;(M===void 0||M-- >0)&&!(G=$.next()).done;)J.push(G.value)}catch(rt){tt={error:rt}}finally{try{G&&!G.done&&(L=$.return)&&L.call($)}finally{if(tt)throw tt.error}}return J}function S(){for(var D=[],M=0;M<arguments.length;M++)D=D.concat(x(arguments[M]));return D}function O(){for(var D=0,M=0,L=arguments.length;M<L;M++)D+=arguments[M].length;for(var $=Array(D),G=0,M=0;M<L;M++)for(var J=arguments[M],tt=0,rt=J.length;tt<rt;tt++,G++)$[G]=J[tt];return $}function P(D,M,L){if(L||arguments.length===2)for(var $=0,G=M.length,J;$<G;$++)(J||!($ in M))&&(J||(J=Array.prototype.slice.call(M,0,$)),J[$]=M[$]);return D.concat(J||Array.prototype.slice.call(M))}function g(D){return this instanceof g?(this.v=D,this):new g(D)}function b(D,M,L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=L.apply(D,M||[]),G,J=[];return G={},tt("next"),tt("throw"),tt("return"),G[Symbol.asyncIterator]=function(){return this},G;function tt(j){$[j]&&(G[j]=function(et){return new Promise(function(ct,mt){J.push([j,et,ct,mt])>1||rt(j,et)})})}function rt(j,et){try{X($[j](et))}catch(ct){H(J[0][3],ct)}}function X(j){j.value instanceof g?Promise.resolve(j.value.v).then(_,B):H(J[0][2],j)}function _(j){rt("next",j)}function B(j){rt("throw",j)}function H(j,et){j(et),J.shift(),J.length&&rt(J[0][0],J[0][1])}}function f(D){var M,L;return M={},$("next"),$("throw",function(G){throw G}),$("return"),M[Symbol.iterator]=function(){return this},M;function $(G,J){M[G]=D[G]?function(tt){return(L=!L)?{value:g(D[G](tt)),done:G==="return"}:J?J(tt):tt}:J}}function p(D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var M=D[Symbol.asyncIterator],L;return M?M.call(D):(D=typeof w=="function"?w(D):D[Symbol.iterator](),L={},$("next"),$("throw"),$("return"),L[Symbol.asyncIterator]=function(){return this},L);function $(J){L[J]=D[J]&&function(tt){return new Promise(function(rt,X){tt=D[J](tt),G(rt,X,tt.done,tt.value)})}}function G(J,tt,rt,X){Promise.resolve(X).then(function(_){J({value:_,done:rt})},tt)}}function T(D,M){return Object.defineProperty?Object.defineProperty(D,"raw",{value:M}):D.raw=M,D}var v=Object.create?function(D,M){Object.defineProperty(D,"default",{enumerable:!0,value:M})}:function(D,M){D.default=M};function I(D){if(D&&D.__esModule)return D;var M={};if(D!=null)for(var L in D)L!=="default"&&Object.prototype.hasOwnProperty.call(D,L)&&h(M,D,L);return v(M,D),M}function U(D){return D&&D.__esModule?D:{default:D}}function z(D,M,L,$){if(L==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof M=="function"?D!==M||!$:!M.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return L==="m"?$:L==="a"?$.call(D):$?$.value:M.get(D)}function W(D,M,L,$,G){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof M=="function"?D!==M||!G:!M.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?G.call(D,L):G?G.value=L:M.set(D,L),L}},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var i=t(0),a=i.__importDefault(t(3)),l=i.__importStar(t(8)),u=i.__importDefault(t(4)),d=t(11),m=t(31);function y(q){return Math.floor(Math.random()*q.length)}function C(q){for(var ot=[],ut=1;ut<arguments.length;ut++)ot[ut-1]=arguments[ut];for(var yt=0;yt<ot.length;yt++){var Dt=ot[yt];if(!Dt)break;var Oe=Object.prototype.hasOwnProperty;for(var In in Dt)(!Oe||Oe.call(Dt,In))&&(q[In]=Dt[In])}return q}e.mixin=C;function h(q){return C({},q)}e.copy=h,e.isArray=Array.isArray||function(q){return Object.prototype.toString.call(q)=="[object Array]"};function E(q){return O(q)?[]:(0,e.isArray)(q)?q:[q]}e.ensureArray=E;function w(q){return Object.prototype.toString.call(q)=="[object Object]"}e.isObject=w;function x(q){for(var ot in q)return!1;return!0}e.isEmpty=x;function S(q,ot){for(var ut in q)if(ut!==ot)return!1;return!0}e.isOnlyPropIn=S;function O(q){return q==null}e.isEmptyArg=O;function P(q){var ot=new Object;for(var ut in q)ot[ut]=q[ut];return ot}e.shallowClone=P;function g(q,ot){var ut=function(){function Dt(){}return Dt}();ut.prototype=q;var yt=new ut;return ot&&C(yt,ot),yt}e.prototypicalClone=g;var b=function(q,ot){if(a.default.Config.inherits){a.default.Config.inherits(q,ot);return}q.super_=ot,q.prototype=g(ot.prototype,{constructor:q})};e.inherits=b;function f(q,ot){for(var ut in q)if(q[ut]==ot)return!0;return!1}e.containsValue=f;function p(q,ot){return(0,e.isArray)(ot)?T(q,ot):v(q,ot)}e.intersect=p;function T(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Dt=q[yt];(0,e.arrIndexOf)(ot,Dt)!=-1&&ut.push(Dt)}return ut}e.arrIntersect=T;function v(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Dt=q[yt];Dt in ot&&ut.push(Dt)}return ut}e.arrIntersectOb=v;function I(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Dt=q[yt];(0,e.arrIndexOf)(ot,Dt)==-1&&ut.push(Dt)}return ut}e.arrSubtract=I,e.arrIndexOf=Array.prototype.indexOf?function(q,ot,ut){return q.indexOf(ot,ut)}:function(q,ot,ut){ut=ut||0;for(var yt=q.length;ut<yt;ut++)if(q[ut]===ot)return ut;return-1};function U(q,ot){return(0,e.arrIndexOf)(q,ot)!==-1}e.arrIn=U;function z(q,ot){var ut=(0,e.arrIndexOf)(q,ot),yt=ut!=-1;return yt&&q.splice(ut,1),yt}e.arrDeleteValue=z;function W(q,ot){var ut=q.slice();return z(ut,ot),ut}e.arrWithoutValue=W;function D(q,ot){var ut=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ut.push(yt);return ut}e.keysArray=D;function M(q,ot){var ut=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ut.push(q[yt]);return ut}e.valuesArray=M;function L(q,ot){for(var ut in q)Object.prototype.hasOwnProperty.call(q,ut)&&q[ut]&&ot(ut)}e.forInOwnNonNullProperties=L,e.arrForEach=Array.prototype.forEach?function(q,ot){q.forEach(ot)}:function(q,ot){for(var ut=q.length,yt=0;yt<ut;yt++)ot(q[yt],yt,q)};function $(q,ot){return(0,e.arrForEach)(q.slice(),ot)}e.safeArrForEach=$,e.arrMap=Array.prototype.map?function(q,ot){return q.map(ot)}:function(q,ot){for(var ut=[],yt=q.length,Dt=0;Dt<yt;Dt++)ut.push(ot(q[Dt],Dt,q));return ut},e.arrFilter=Array.prototype.filter?function(q,ot){return q.filter(ot)}:function(q,ot){for(var ut=[],yt=q.length,Dt=0;Dt<yt;Dt++)ot(q[Dt])&&ut.push(q[Dt]);return ut},e.arrEvery=Array.prototype.every?function(q,ot){return q.every(ot)}:function(q,ot){for(var ut=q.length,yt=0;yt<ut;yt++)if(!ot(q[yt],yt,q))return!1;return!0};function G(q,ot){if(q.length===0)return!0;var ut=q[0][ot];return(0,e.arrEvery)(q,function(yt){return yt[ot]===ut})}e.allSame=G;var J={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function tt(q,ot){var ut=J[ot||Zt.json];return{accept:ut,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultGetHeaders=tt;function rt(q,ot){var ut,yt=ut=J[ot||Zt.json];return{accept:yt,"content-type":ut,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultPostHeaders=rt;function X(q){return q.splice(y(q),1)[0]}e.arrPopRandomElement=X;function _(q){var ot=[];if(q)for(var ut in q)ot.push(encodeURIComponent(ut)+"="+encodeURIComponent(q[ut]));return ot.length?"?"+ot.join("&"):""}e.toQueryString=_;function B(q){for(var ot,ut=/([^?&=]+)=?([^&]*)/g,yt={};ot=ut.exec(q);)yt[decodeURIComponent(ot[1])]=decodeURIComponent(ot[2]);return yt}e.parseQueryString=B,e.now=Date.now||function(){return new Date().getTime()};function H(q){return typeof q=="object"&&q!==null&&(q.constructor.name=="ErrorInfo"||q.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=H;function j(q){var ot,ut;return q instanceof Error||((ot=q==null?void 0:q.constructor)===null||ot===void 0?void 0:ot.name)==="ErrorInfo"||((ut=q==null?void 0:q.constructor)===null||ut===void 0?void 0:ut.name)==="PartialErrorInfo"?q.toString():a.default.Config.inspect(q)}e.inspectError=j;function et(q){return a.default.BufferUtils.isBuffer(q)?q.toString():typeof q=="string"?q:a.default.Config.inspect(q)}e.inspectBody=et;function ct(q){if(a.default.BufferUtils.isBuffer(q))return a.default.BufferUtils.byteLength(q);if(typeof q=="string")return a.default.Config.stringByteSize(q);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof q)}e.dataSizeBytes=ct;function mt(){return String(Math.random()).substr(2)}e.cheapRandStr=mt;var Et=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.base64Encode(ot)}for(var ut=a.default.BufferUtils.base64CharSet,yt=Math.round(q*4/3),Dt="",Oe=0;Oe<yt;Oe++)Dt+=ut[y(ut)];return Dt};e.randomString=Et;var St=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.hexEncode(ot)}for(var ut=a.default.BufferUtils.hexCharSet,yt=q*2,Dt="",Oe=0;Oe<yt;Oe++)Dt+=ut[y(ut)];return Dt};e.randomHexString=St;function Wt(q,ot){for(var ut=Math.min(ot,q.length),yt=q.slice(),Dt=[],Oe=0;Oe<ut;Oe++)Dt.push(X(yt));return Dt}e.arrChooseN=Wt,e.trim=String.prototype.trim?function(q){return q.trim()}:function(q){return q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ft(q,ot,ut){return new Promise(function(yt,Dt){q[ot].apply(q,i.__spreadArray(i.__spreadArray([],ut,!1),[function(Oe,In){Oe?Dt(Oe):yt(In)}],!1))})}e.promisify=ft;var Zt;(function(q){q.msgpack="msgpack",q.json="json"})(Zt=e.Format||(e.Format={}));function be(q,ot){return ot=="msgpack"?a.default.Config.msgpack.decode(q):JSON.parse(String(q))}e.decodeBody=be;function oe(q,ot){return ot=="msgpack"?a.default.Config.msgpack.encode(q,!0):JSON.stringify(q)}e.encodeBody=oe;function he(q){return q.map(function(ot){return ot&&ot.toLowerCase()})}e.allToLowerCase=he;function un(q){return q.map(function(ot){return ot&&ot.toUpperCase()})}e.allToUpperCase=un;function yn(q){return Math.min((q+2)/3,2)}e.getBackoffCoefficient=yn;function le(){return 1-Math.random()*.2}e.getJitterCoefficient=le;function bn(q,ot){return q*yn(ot)*le()}e.getRetryTime=bn;function Vn(){return r||(typeof window!="undefined"?window:self)}e.getGlobalObject=Vn;function qi(q,ot){return Object.keys(q).every(function(ut){return q[ut]===ot[ut]})&&Object.keys(ot).every(function(ut){return ot[ut]===q[ut]})}e.shallowEquals=qi;function dr(q){var ot=/^(\[([^?]*)(?:(.*))\])?(.+)$/,ut=q.match(ot);if(!ut||!ut.length||ut.length<5)throw new u.default("regex match failed",400,40010);if(ut[2])throw new u.default("cannot use a derived option with a ".concat(ut[2]," channel"),400,40010);return{qualifierParam:ut[3]||"",channelName:ut[4]}}e.matchDerivedChannel=dr;function al(q){return a.default.Config.createHmac?Buffer.from(q,"ascii").toString("base64"):(0,d.stringify)((0,m.parse)(q))}e.toBase64=al}).call(this,t(13))},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importDefault(t(3)),l=r||(typeof window!="undefined"?window:self),u;(function(h){h[h.None=0]="None",h[h.Error=1]="Error",h[h.Major=2]="Major",h[h.Minor=3]="Minor",h[h.Micro=4]="Micro"})(u||(u={}));function d(h,E){return"".concat(h).padStart(E?3:2,"0")}function m(h){return a.default.Config.logTimestamps?function(E){var w=new Date;h(d(w.getHours())+":"+d(w.getMinutes())+":"+d(w.getSeconds())+"."+d(w.getMilliseconds(),1)+" "+E)}:h}var y=function(){var h,E,w,x;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((E=(h=l==null?void 0:l.console)===null||h===void 0?void 0:h.log)===null||E===void 0?void 0:E.apply)=="function"?(w=function(){for(var S=[],O=0;O<arguments.length;O++)S[O]=arguments[O]},x=console.warn?function(){for(var S=[],O=0;O<arguments.length;O++)S[O]=arguments[O]}:w):l!=null&&l.console.log?w=x=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=x=function(){},[w,x].map(m)},C=function(){function h(){h.logLevel=h.LOG_DEFAULT}return h.initLogHandlers=function(){var E=y(),w=E[0],x=E[1];this.logHandler=w,this.logErrorHandler=x},h.logLevel=u.Error,h.LOG_NONE=u.None,h.LOG_ERROR=u.Error,h.LOG_MAJOR=u.Major,h.LOG_MINOR=u.Minor,h.LOG_MICRO=u.Micro,h.LOG_DEFAULT=u.Error,h.LOG_DEBUG=u.Micro,h.logAction=function(E,w,x){h.shouldLog(E)&&(E===u.Error?h.logErrorHandler:h.logHandler)("Ably: "+w+": "+x)},h.deprecated=function(E,w){h.deprecatedWithMsg(E,"Please use '"+w+"' instead.")},h.deprecatedWithMsg=function(E,w){h.shouldLog(u.Error)&&h.logErrorHandler("Ably: Deprecation warning - '"+E+"' is deprecated and will be removed from a future version. "+w)},h.shouldLog=function(E){return E<=h.logLevel},h.setLog=function(E,w){E!==void 0&&(h.logLevel=E),w!==void 0&&(h.logHandler=h.logErrorHandler=w)},h}();e.default=C}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(){}return i}();e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1));function l(m){var y="["+m.constructor.name;return m.message&&(y+=": "+m.message),m.statusCode&&(y+="; statusCode="+m.statusCode),m.code&&(y+="; code="+m.code),m.cause&&(y+="; cause="+a.inspectError(m.cause)),m.href&&!(m.message&&m.message.indexOf("help.ably.io")>-1)&&(y+="; see "+m.href+" "),y+="]",y}var u=function(m){r.__extends(y,m);function y(C,h,E,w){var x=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(x,y.prototype),x.code=h,x.statusCode=E,x.cause=w,x}return y.prototype.toString=function(){return l(this)},y.fromValues=function(C){var h=C,E=h.message,w=h.code,x=h.statusCode;if(typeof E!="string"||typeof w!="number"||typeof x!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(C));var S=Object.assign(new y(E,w,x),C);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S},y}(Error);e.default=u;var d=function(m){r.__extends(y,m);function y(C,h,E,w){var x=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(x,y.prototype),x.code=h,x.statusCode=E,x.cause=w,x}return y.prototype.toString=function(){return l(this)},y}(Error);e.PartialErrorInfo=d},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){if(typeof ArrayBuffer=="function"){var i=r,a=i.lib,l=a.WordArray,u=l.init,d=l.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var y=m.byteLength,C=[],h=0;h<y;h++)C[h>>>2]|=m[h]<<24-h%4*8;u.call(this,C,y)}else u.apply(this,arguments)};d.prototype=l}}(),r.lib.WordArray})},function(s,e,t){(function(r){(function(i,a){s.exports=e=a()})(this,function(){var i=i||function(a,l){var u;if(typeof window!="undefined"&&window.crypto&&(u=window.crypto),!u&&typeof window!="undefined"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof r!="undefined"&&r.crypto&&(u=r.crypto),!u)try{u=t(44)}catch(f){}var d=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch(f){}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function f(){}return function(p){var T;return f.prototype=p,T=new f,f.prototype=null,T}}(),y={},C=y.lib={},h=C.Base=function(){return{extend:function(f){var p=m(this);return f&&p.mixIn(f),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var p in f)f.hasOwnProperty(p)&&(this[p]=f[p]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=C.WordArray=h.extend({init:function(f,p){f=this.words=f||[],p!=l?this.sigBytes=p:this.sigBytes=f.length*4},toString:function(f){return(f||x).stringify(this)},concat:function(f){var p=this.words,T=f.words,v=this.sigBytes,I=f.sigBytes;if(this.clamp(),v%4)for(var U=0;U<I;U++){var z=T[U>>>2]>>>24-U%4*8&255;p[v+U>>>2]|=z<<24-(v+U)%4*8}else for(var U=0;U<I;U+=4)p[v+U>>>2]=T[U>>>2];return this.sigBytes+=I,this},clamp:function(){var f=this.words,p=this.sigBytes;f[p>>>2]&=4294967295<<32-p%4*8,f.length=a.ceil(p/4)},clone:function(){var f=h.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var p=[],T=0;T<f;T+=4)p.push(d());return new E.init(p,f)}}),w=y.enc={},x=w.Hex={stringify:function(f){for(var p=f.words,T=f.sigBytes,v=[],I=0;I<T;I++){var U=p[I>>>2]>>>24-I%4*8&255;v.push((U>>>4).toString(16)),v.push((U&15).toString(16))}return v.join("")},parse:function(f){for(var p=f.length,T=[],v=0;v<p;v+=2)T[v>>>3]|=parseInt(f.substr(v,2),16)<<24-v%8*4;return new E.init(T,p/2)}},S=w.Latin1={stringify:function(f){for(var p=f.words,T=f.sigBytes,v=[],I=0;I<T;I++){var U=p[I>>>2]>>>24-I%4*8&255;v.push(String.fromCharCode(U))}return v.join("")},parse:function(f){for(var p=f.length,T=[],v=0;v<p;v++)T[v>>>2]|=(f.charCodeAt(v)&255)<<24-v%4*8;return new E.init(T,p)}},O=w.Utf8={stringify:function(f){try{return decodeURIComponent(escape(S.stringify(f)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(f){return S.parse(unescape(encodeURIComponent(f)))}},P=C.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=O.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var p,T=this._data,v=T.words,I=T.sigBytes,U=this.blockSize,z=U*4,W=I/z;f?W=a.ceil(W):W=a.max((W|0)-this._minBufferSize,0);var D=W*U,M=a.min(D*4,I);if(D){for(var L=0;L<D;L+=U)this._doProcessBlock(v,L);p=v.splice(0,D),T.sigBytes-=M}return new E.init(p,M)},clone:function(){var f=h.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),g=C.Hasher=P.extend({cfg:h.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){P.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(f){return function(p,T){return new f.init(T).finalize(p)}},_createHmacHelper:function(f){return function(p,T){return new b.HMAC.init(f,T).finalize(p)}}}),b=y.algo={};return y}(Math);return i})}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),l=r.__importDefault(t(3));function u(y,C,h){try{C.apply(y,h)}catch(E){a.default.logAction(a.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function d(y,C,h){for(var E,w,x,S=0;S<y.length;S++)if(E=y[S],h&&(E=E[h]),i.isArray(E)){for(;(w=i.arrIndexOf(E,C))!==-1;)E.splice(w,1);h&&E.length===0&&delete y[S][h]}else if(i.isObject(E))for(x in E)Object.prototype.hasOwnProperty.call(E,x)&&i.isArray(E[x])&&d([E],C,x)}var m=function(){function y(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return y.prototype.on=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];if(h.length===1){var w=h[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h))}if(h.length===2){var x=h[0],S=h[1];if(typeof S!="function")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));if(i.isEmptyArg(x))this.any.push(S);else if(i.isArray(x))x.forEach(function(P){C.on(P,S)});else{if(typeof x!="string")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));var O=this.events[x]||(this.events[x]=[]);O.push(S)}}},y.prototype.off=function(){for(var C,h=this,E=[],w=0;w<arguments.length;w++)E[w]=arguments[w];if(E.length==0||i.isEmptyArg(E[0])&&i.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var x=E[0],S=E[1],O=null,P=null;if(E.length===1||!S)typeof x=="function"?O=x:P=x;else{if(typeof S!="function")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(E));C=[x,S],P=C[0],O=C[1]}if(O&&i.isEmptyArg(P)){d([this.any,this.events,this.anyOnce,this.eventsOnce],O);return}if(i.isArray(P)){P.forEach(function(g){h.off(g,O)});return}if(typeof P!="string")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(E));O?d([this.events,this.eventsOnce],O,P):(delete this.events[P],delete this.eventsOnce[P])},y.prototype.listeners=function(C){if(C){var h=this.events[C]||[];return this.eventsOnce[C]&&Array.prototype.push.apply(h,this.eventsOnce[C]),h.length?h:null}return this.any.length?this.any:null},y.prototype.emit=function(C){for(var h=[],E=1;E<arguments.length;E++)h[E-1]=arguments[E];var w={event:C},x=[];this.anyOnce.length&&(Array.prototype.push.apply(x,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(x,this.any);var S=this.eventsOnce[C];S&&(Array.prototype.push.apply(x,S),delete this.eventsOnce[C]);var O=this.events[C];O&&Array.prototype.push.apply(x,O),i.arrForEach(x,function(P){u(w,P,h)})},y.prototype.once=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];var w=h.length;if((w===0||w===1&&typeof h[0]!="function")&&l.default.Config.Promise){var x=h[0];return new l.default.Config.Promise(function(f){C.once(x,f)})}var S=h[0],O=h[1];if(h.length===1&&typeof S=="function")this.anyOnce.push(S);else if(i.isEmptyArg(S)){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));this.anyOnce.push(O)}else if(i.isArray(S)){var P=this,g=function(){var f=Array.prototype.slice.call(arguments);if(i.arrForEach(S,function(p){P.off(p,g)}),typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));O.apply(this,f)};i.arrForEach(S,function(f){P.on(f,g)})}else{if(typeof S!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));var b=this.eventsOnce[S]||(this.eventsOnce[S]=[]);if(O){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));b.push(O)}}},y.prototype.whenState=function(C,h,E){for(var w=this,x=[],S=3;S<arguments.length;S++)x[S-3]=arguments[S];var O={event:C};if(typeof C!="string"||typeof h!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&l.default.Config.Promise)return new l.default.Config.Promise(function(P){y.prototype.whenState.apply(w,[C,h,P].concat(x))});C===h?u(O,E,x):this.once(C,E)},y}();e.default=m},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),l=r.__importDefault(t(2)),u=r.__importDefault(t(4)),d=t(43),m="ably-js/"+d.version,y={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:d.version,protocolVersion:2,agent:m,getHost:C,getPort:h,getHttpScheme:E,environmentFallbackHosts:w,getFallbackHosts:x,getHosts:S,checkHost:O,objectifyOptions:f,normaliseOptions:p};function C(v,I,U){return U?I=I==v.restHost&&v.realtimeHost||I||v.realtimeHost:I=I||v.restHost,I}e.getHost=C;function h(v,I){return I||v.tls?v.tlsPort:v.port}e.getPort=h;function E(v){return v.tls?"https://":"http://"}e.getHttpScheme=E;function w(v){return[v+"-a-fallback.ably-realtime.com",v+"-b-fallback.ably-realtime.com",v+"-c-fallback.ably-realtime.com",v+"-d-fallback.ably-realtime.com",v+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=w;function x(v){var I=v.fallbackHosts,U=typeof v.httpMaxRetryCount!="undefined"?v.httpMaxRetryCount:y.httpMaxRetryCount;return I?a.arrChooseN(I,U):[]}e.getFallbackHosts=x;function S(v){return[v.restHost].concat(x(v))}e.getHosts=S;function O(v){if(typeof v!="string")throw new u.default("host must be a string; was a "+typeof v,4e4,400);if(!v.length)throw new u.default("host must not be zero-length",4e4,400)}function P(v,I,U){return v.realtimeHost?v.realtimeHost:v.restHost?(l.default.logAction(l.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+v.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+v.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),v.restHost):I?y.REALTIME_HOST:U+"-"+y.REALTIME_HOST}function g(v){var I={};for(var U in y.TIMEOUTS)I[U]=v[U]||y.TIMEOUTS[U];return I}function b(v){var I=y.agent;if(v.agents)for(var U in v.agents)I+=" "+U+"/"+v.agents[U];return I}e.getAgentString=b;function f(v){return typeof v=="string"?v.indexOf(":")==-1?{token:v}:{key:v}:v}e.objectifyOptions=f;function p(v){if(v.host&&(l.default.deprecated("host","restHost"),v.restHost=v.host),v.wsHost&&(l.default.deprecated("wsHost","realtimeHost"),v.realtimeHost=v.wsHost),v.queueEvents&&(l.default.deprecated("queueEvents","queueMessages"),v.queueMessages=v.queueEvents),v.fallbackHostsUseDefault){if(v.fallbackHosts){var I="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}if(v.port||v.tlsPort){var I="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}v.environment?l.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):l.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),v.fallbackHosts=y.FALLBACK_HOSTS}v.recover===!0&&(l.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),v.recover=function(X,_){_(!0)}),typeof v.recover=="function"&&v.closeOnUnload===!0&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),v.recover=void 0),"closeOnUnload"in v||(v.closeOnUnload=!v.recover),v.transports&&a.arrIn(v.transports,"xhr")&&(l.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),a.arrDeleteValue(v.transports,"xhr"),v.transports.push("xhr_streaming")),"queueMessages"in v||(v.queueMessages=!0);var U=v.environment&&String(v.environment).toLowerCase()||y.ENVIRONMENT,z=!U||U==="production";!v.fallbackHosts&&!v.restHost&&!v.realtimeHost&&!v.port&&!v.tlsPort&&(v.fallbackHosts=z?y.FALLBACK_HOSTS:w(U));var W=v.restHost||(z?y.REST_HOST:U+"-"+y.REST_HOST),D=P(v,z,U);a.arrForEach((v.fallbackHosts||[]).concat(W,D),O),v.port=v.port||y.PORT,v.tlsPort=v.tlsPort||y.TLS_PORT,"tls"in v||(v.tls=!0);var M=g(v);if("useBinaryProtocol"in v?v.useBinaryProtocol=i.default.Config.supportsBinary&&v.useBinaryProtocol:v.useBinaryProtocol=i.default.Config.preferBinary,v.clientId){var L=v.headers=v.headers||{};L["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(v.clientId))}"idempotentRestPublishing"in v||(v.idempotentRestPublishing=!0),v.promises&&!i.default.Config.Promise&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),v.promises=!1);var $=null,G=v.connectivityCheckUrl;if(v.connectivityCheckUrl){var J=v.connectivityCheckUrl.split("?"),tt=J[0],rt=J[1];$=rt?a.parseQueryString(rt):{},tt.indexOf("://")===-1&&(tt="https://"+tt),G=tt}return r.__assign(r.__assign({},v),{useBinaryProtocol:"useBinaryProtocol"in v?i.default.Config.supportsBinary&&v.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:D,restHost:W,maxMessageSize:v.maxMessageSize||y.maxMessageSize,timeouts:M,connectivityCheckParams:$,connectivityCheckUrl:G})}e.normaliseOptions=p,e.default=y;function T(v){return Object.assign(y,v)}e.getDefaults=T},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importDefault(t(2)),l=r.__importDefault(t(4)),u=r.__importStar(t(1));function d(h){return!h||!h.channelOptions?{channelOptions:h,plugins:{},baseEncodedPreviousPayload:void 0}:h}function m(h){if(h&&h.cipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=i.default.Crypto.getCipher(h.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return h!=null?h:{}}function y(h){var E=0;return h.name&&(E+=h.name.length),h.clientId&&(E+=h.clientId.length),h.extras&&(E+=JSON.stringify(h.extras).length),h.data&&(E+=u.dataSizeBytes(h.data)),E}var C=function(){function h(){}return h.prototype.toJSON=function(){var E=this.encoding,w=this.data;return w&&i.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(E=E?E+"/base64":"base64",w=i.default.BufferUtils.base64Encode(w)):w=i.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:w}},h.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},h.encrypt=function(E,w,x){var S=E.data,O=E.encoding,P=w.channelCipher;O=O?O+"/":"",i.default.BufferUtils.isBuffer(S)||(S=i.default.BufferUtils.utf8Encode(String(S)),O=O+"utf-8/"),P.encrypt(S,function(g,b){if(g){x(g);return}E.data=b,E.encoding=O+"cipher+"+P.algorithm,x(null,E)})},h.encode=function(E,w,x){var S=E.data,O=typeof S=="string"||i.default.BufferUtils.isBuffer(S)||S===null||S===void 0;if(!O)if(u.isObject(S)||u.isArray(S))E.data=JSON.stringify(S),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new l.default("Data type is unsupported",40013,400);w!=null&&w.cipher?h.encrypt(E,w,x):x(null,E)},h.encodeArray=function(E,w,x){for(var S=0,O=0;O<E.length;O++)h.encode(E[O],w,function(P){if(P){x(P);return}S++,S==E.length&&x(null,E)})},h.decode=function(E,w){var x=d(w),S=E.data,O=E.encoding;if(O){var P=O.split("/"),g=void 0,b=P.length,f=E.data,p="";try{for(;(g=b)>0;){var T=P[--b].match(/([-\w]+)(\+([\w-]+))?/);if(!T)break;switch(p=T[1],p){case"base64":f=i.default.BufferUtils.base64Decode(String(f)),g==P.length&&(S=f);continue;case"utf-8":f=i.default.BufferUtils.utf8Decode(f);continue;case"json":f=JSON.parse(f);continue;case"cipher":if(x.channelOptions!=null&&x.channelOptions.cipher&&x.channelOptions.channelCipher){var v=T[3],I=x.channelOptions.channelCipher;if(v!=I.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");f=I.decrypt(f);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!x.plugins||!x.plugins.vcdiff)throw new l.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new l.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var U=x.baseEncodedPreviousPayload;typeof U=="string"&&(U=i.default.BufferUtils.utf8Encode(U)),U=i.default.BufferUtils.toBuffer(U),f=i.default.BufferUtils.toBuffer(f),f=i.default.BufferUtils.typedArrayToBuffer(x.plugins.vcdiff.decode(f,U)),S=f}catch(W){throw new l.default("Vcdiff delta decode failed with "+W,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(W){var z=W;throw new l.default("Error processing the "+p+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{E.encoding=g<=0?null:P.slice(0,g).join("/"),E.data=f}}x.baseEncodedPreviousPayload=S},h.fromResponseBody=function(E,w,x){x&&(E=u.decodeBody(E,x));for(var S=0;S<E.length;S++){var O=E[S]=h.fromValues(E[S]);try{h.decode(O,w)}catch(P){a.default.logAction(a.default.LOG_ERROR,"Message.fromResponseBody()",P.toString())}}return E},h.fromValues=function(E){return Object.assign(new h,E)},h.fromValuesArray=function(E){for(var w=E.length,x=new Array(w),S=0;S<w;S++)x[S]=h.fromValues(E[S]);return x},h.fromEncoded=function(E,w){var x=h.fromValues(E),S=m(w!=null?w:null);try{h.decode(x,S)}catch(O){a.default.logAction(a.default.LOG_ERROR,"Message.fromEncoded()",O.toString())}return x},h.fromEncodedArray=function(E,w){return E.map(function(x){return h.fromEncoded(x,w)})},h.getMessagesSize=function(E){for(var w,x=0,S=0;S<E.length;S++)w=E[S],x+=w.size||(w.size=y(w));return x},h.serialize=u.encodeBody,h}();e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(4)),l=r.__importDefault(t(9)),u=r.__importDefault(t(15)),d={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},m=[];Object.keys(d).forEach(function(x){m[d[x]]=x});var y={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},C=Object.keys(y);y.MODE_ALL=y.PRESENCE|y.PUBLISH|y.SUBSCRIBE|y.PRESENCE_SUBSCRIBE;function h(x){var S=[];if(x)for(var O=0;O<x.length;O++)S.push(x[O].toString());return"[ "+S.join(", ")+" ]"}var E="id channel channelSerial connectionId count msgSerial timestamp".split(" "),w=function(){function x(){var S=this;this.hasFlag=function(O){return(S.flags&y[O])>0}}return x.prototype.setFlag=function(S){return this.flags=this.flags|y[S]},x.prototype.getMode=function(){return this.flags&&this.flags&y.MODE_ALL},x.prototype.encodeModesToFlags=function(S){var O=this;S.forEach(function(P){return O.setFlag(P)})},x.prototype.decodeModesFromFlags=function(){var S=this,O=[];return x.channelModes.forEach(function(P){S.hasFlag(P)&&O.push(P)}),O.length>0?O:void 0},x.fromValues=function(S){return Object.assign(new x,S)},x.Action=d,x.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],x.ActionName=m,x.serialize=i.encodeBody,x.deserialize=function(S,O){var P=i.decodeBody(S,O);return x.fromDeserialized(P)},x.fromDeserialized=function(S){var O=S.error;O&&(S.error=a.default.fromValues(O));var P=S.messages;if(P)for(var g=0;g<P.length;g++)P[g]=l.default.fromValues(P[g]);var b=S.presence;if(b)for(var g=0;g<b.length;g++)b[g]=u.default.fromValues(b[g],!0);return Object.assign(new x,S)},x.stringify=function(S){var O="[ProtocolMessage";S.action!==void 0&&(O+="; action="+x.ActionName[S.action]||!1);for(var P,g=0;g<E.length;g++)P=E[g],S[P]!==void 0&&(O+="; "+P+"="+S[P]);if(S.messages&&(O+="; messages="+h(l.default.fromValuesArray(S.messages))),S.presence&&(O+="; presence="+h(u.default.fromValuesArray(S.presence))),S.error&&(O+="; error="+a.default.fromValues(S.error).toString()),S.auth&&S.auth.accessToken&&(O+="; token="+S.auth.accessToken),S.flags&&(O+="; flags="+C.filter(S.hasFlag).join(",")),S.params){var b="";i.forInOwnNonNullProperties(S.params,function(f){b.length>0&&(b+="; "),b+=f+"="+S.params[f]}),b.length>0&&(O+="; params=["+b+"]")}return O+="]",O},x}();e.default=w},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=i.enc,d=u.Base64={stringify:function(y){var C=y.words,h=y.sigBytes,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.clamp();for(var w=[],x=0;x<h;x+=3)for(var S=C[x>>>2]>>>24-x%4*8&255,O=C[x+1>>>2]>>>24-(x+1)%4*8&255,P=C[x+2>>>2]>>>24-(x+2)%4*8&255,g=S<<16|O<<8|P,b=0;b<4&&x+b*.75<h;b++)w.push(E.charAt(g>>>6*(3-b)&63));var f=E.charAt(64);if(f)for(;w.length%4;)w.push(f);return w.join("")},parse:function(y){var C=y.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var w=0;w<h.length;w++)E[h.charCodeAt(w)]=w}var x=h.charAt(64);if(x){var S=y.indexOf(x);S!==-1&&(C=S)}return m(y,C,E)}};function m(y,C,h){for(var E=[],w=0,x=0;x<C;x++)if(x%4){var S=h[y.charCodeAt(x-1)]<<x%4*2,O=h[y.charCodeAt(x)]>>>6-x%4*2,P=S|O;E[w>>>2]|=P<<24-w%4*8,w++}return l.create(E,w)}}(),r.enc.Base64})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(10)),l=r.__importDefault(t(26)),u=r.__importDefault(t(2)),d=r.__importDefault(t(8)),m=r.__importDefault(t(20)),y=r.__importDefault(t(17)),C=r.__importDefault(t(4)),h=r.__importDefault(t(21)),E=r.__importDefault(t(3));function w(O){var P=[80015,80017,80030];return O.code?y.default.isTokenErr(O)?!1:i.arrIn(P,O.code)?!0:O.code>=4e4&&O.code<5e4:!1}function x(O){return w(O)?[a.default.fromValues({action:a.default.Action.ERROR,error:O})]:[a.default.fromValues({action:a.default.Action.DISCONNECTED,error:O})]}var S=function(O){r.__extends(P,O);function P(g,b,f){var p=O.call(this,g,b,f,!0)||this;return p.onAuthUpdated=function(T){p.authParams={access_token:T.token}},p.stream="stream"in f?f.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return P.prototype.connect=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","starting"),l.default.prototype.connect.call(this);var b=this.params,f=b.options,p=d.default.getHost(f,b.host),T=d.default.getPort(f),v=f.tls?"https://":"http://";this.baseUri=v+p+":"+T+"/comet/";var I=this.baseUri+"connect";u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","uri: "+I),this.auth.getAuthParams(function(U,z){if(U){g.disconnect(U);return}if(!g.isDisposed){g.authParams=z;var W=g.params.getConnectParams(z);"stream"in W&&(g.stream=W.stream),u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(W));var D=!1,M=g.recvRequest=g.createRequest(I,null,W,null,g.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV);M.on("data",function(L){!g.recvRequest||(D||(D=!0,g.emit("preconnect")),g.onData(L))}),M.on("complete",function(L){if(g.recvRequest||(L=L||new C.default("Request cancelled",80003,400)),g.recvRequest=null,!D&&!L&&(D=!0,g.emit("preconnect")),g.onActivity(),L){L.code?g.onData(x(L)):g.disconnect(L);return}E.default.Config.nextTick(function(){g.recv()})}),M.exec()}})},P.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},P.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},P.prototype._requestCloseOrDisconnect=function(g){var b=this,f=g?this.closeUri:this.disconnectUri;if(f){var p=this.createRequest(f,null,this.authParams,null,h.default.REQ_SEND);p.on("complete",function(T){T&&(u.default.logAction(u.default.LOG_ERROR,"CometTransport.request"+(g?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(T)),b.finish("disconnected",T))}),p.exec()}},P.prototype.dispose=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected()),E.default.Config.nextTick(function(){g.emit("disposed")}))},P.prototype.onConnect=function(g){var b;if(!this.isDisposed){var f=(b=g.connectionDetails)===null||b===void 0?void 0:b.connectionKey;l.default.prototype.onConnect.call(this,g);var p=this.baseUri+f;u.default.logAction(u.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}},P.prototype.send=function(g){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(g);return}var b=this.pendingItems||[];b.push(g),this.pendingItems=null,this.sendItems(b)},P.prototype.sendAnyPending=function(){var g=this.pendingItems;!g||(this.pendingItems=null,this.sendItems(g))},P.prototype.sendItems=function(g){var b=this,f=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(g),h.default.REQ_SEND);f.on("complete",function(p,T){if(p&&u.default.logAction(u.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),b.sendRequest=null,p){p.code?b.onData(x(p)):b.disconnect(p);return}T&&b.onData(T),b.pendingItems&&E.default.Config.nextTick(function(){b.sendRequest||b.sendAnyPending()})}),f.exec()},P.prototype.recv=function(){var g=this;if(!this.recvRequest&&!!this.isConnected){var b=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV_POLL);b.on("data",function(f){g.onData(f)}),b.on("complete",function(f){if(g.recvRequest=null,g.onActivity(),f){f.code?g.onData(x(f)):g.disconnect(f);return}E.default.Config.nextTick(function(){g.recv()})}),b.exec()}},P.prototype.onData=function(g){try{var b=this.decodeResponse(g);if(b&&b.length)for(var f=0;f<b.length;f++)this.onProtocolMessage(a.default.fromDeserialized(b[f]))}catch(p){u.default.logAction(u.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},P.prototype.encodeRequest=function(g){return JSON.stringify(g)},P.prototype.decodeResponse=function(g){return typeof g=="string"?JSON.parse(g):g},P}(l.default);e.default=S},function(s,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(r){typeof window=="object"&&(t=window)}s.exports=t},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),l=r.__importDefault(t(2)),u=r.__importDefault(t(17)),d=r.__importDefault(t(18)),m=t(4);function y(S,O,P,g,b){S.http.supportsAuthHeaders?S.auth.getAuthHeaders(function(f,p){f?g(f):b(a.mixin(p,O),P)}):S.auth.getAuthParams(function(f,p){f?g(f):b(O,a.mixin(p,P))})}function C(S,O){return function(P,g,b,f,p){if(P&&!g){S(P);return}if(!f)try{g=a.decodeBody(g,O)}catch(W){a.isErrorInfoOrPartialErrorInfo(W)?S(W):S(new m.PartialErrorInfo(a.inspectError(W),null));return}if(!g){S(new m.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var T=g,v=T.statusCode,I=T.response,U=T.headers;if(v===void 0){S(P,g,b,!0,p);return}if(v<200||v>=300){var z=I&&I.error||P;z||(z=new Error("Error in unenveloping "+g),z.statusCode=v),S(z,I,U,!0,v);return}S(P,I,U,!0,v)}}function h(S){var O=[];if(S)for(var P in S)O.push(P+"="+S[P]);return O.join("&")}function E(S,O){return S+(O?"?":"")+h(O)}function w(S,O,P,g){return function(b,f,p,T,v){b?l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received Error; "+E(P,g)+"; Error: "+a.inspectError(b)):l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received; "+E(P,g)+"; Headers: "+h(p)+"; StatusCode: "+v+"; Body: "+(i.default.BufferUtils.isBuffer(f)?f.toString():f)),S&&S(b,f,p,T,v)}}var x=function(){function S(){}return S.get=function(O,P,g,b,f,p){S.do(d.default.Get,O,P,null,g,b,f,p)},S.delete=function(O,P,g,b,f,p){S.do(d.default.Delete,O,P,null,g,b,f,p)},S.post=function(O,P,g,b,f,p,T){S.do(d.default.Post,O,P,g,b,f,p,T)},S.patch=function(O,P,g,b,f,p,T){S.do(d.default.Patch,O,P,g,b,f,p,T)},S.put=function(O,P,g,b,f,p,T){S.do(d.default.Put,O,P,g,b,f,p,T)},S.do=function(O,P,g,b,f,p,T,v){l.default.shouldLog(l.default.LOG_MICRO)&&(v=w(v,O,g,p)),T&&(v=v&&C(v,T),(p=p||{}).envelope=T);function I(U,z){var W;if(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+E(g,z)),l.default.shouldLog(l.default.LOG_MICRO)){var D=b;if(((W=U["content-type"])===null||W===void 0?void 0:W.indexOf("msgpack"))>0)try{D=i.default.Config.msgpack.decode(b)}catch(M){l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending MsgPack Decoding Error: "+a.inspectError(M))}l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+E(g,z)+"; Body: "+D)}P.http.do(O,P,g,U,b,z,function(M,L,$,G,J){if(M&&u.default.isTokenErr(M)){P.auth.authorize(null,null,function(tt){if(tt){v(tt);return}y(P,$,z,v,I)});return}v(M,L,$,G,J)})}y(P,f,p,v,I)},S}();e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=r.__importDefault(t(3)),l=r.__importDefault(t(9)),u=r.__importStar(t(1));function d(y){return m.Actions.indexOf(y)}var m=function(){function y(){}return y.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},y.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var C=this.id.split(":");return{connectionId:C[0],msgSerial:parseInt(C[1],10),index:parseInt(C[2],10)}},y.prototype.toJSON=function(){var C=this.data,h=this.encoding;return C&&a.default.BufferUtils.isBuffer(C)&&(arguments.length>0?(h=h?h+"/base64":"base64",C=a.default.BufferUtils.base64Encode(C)):C=a.default.BufferUtils.toBuffer(C)),{id:this.id,clientId:this.clientId,action:d(this.action),data:C,encoding:h,extras:this.extras}},y.prototype.toString=function(){var C="[PresenceMessage";return C+="; action="+this.action,this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?C+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),this.extras&&(C+="; extras="+JSON.stringify(this.extras)),C+="]",C},y.fromResponseBody=function(C,h,E){var w=[];E&&(C=u.decodeBody(C,E));for(var x=0;x<C.length;x++){var S=w[x]=y.fromValues(C[x],!0);try{y.decode(S,h)}catch(O){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",O.toString())}}return w},y.fromValues=function(C,h){return h&&(C.action=y.Actions[C.action]),Object.assign(new y,C)},y.fromValuesArray=function(C){for(var h=C.length,E=new Array(h),w=0;w<h;w++)E[w]=y.fromValues(C[w]);return E},y.fromEncoded=function(C,h){var E=y.fromValues(C,!0);try{y.decode(E,h!=null?h:{})}catch(w){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return E},y.fromEncodedArray=function(C,h){return C.map(function(E){return y.fromEncoded(E,h)})},y.fromData=function(C){return C instanceof y?C:y.fromValues({data:C})},y.Actions=["absent","present","enter","leave","update"],y.encode=l.default.encode,y.decode=l.default.decode,y.getMessagesSize=l.default.getMessagesSize,y}();e.default=m},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importStar(t(1)),l=i.__importDefault(t(7)),u=i.__importStar(t(4)),d=i.__importDefault(t(2)),m=i.__importDefault(t(8)),y=i.__importDefault(t(21)),C=i.__importDefault(t(3));function h(v,I){return a.arrIn(a.allToLowerCase(a.keysArray(I)),"x-ably-errorcode")}function E(v,I){if(h(v,I))return v.error&&u.default.fromValues(v.error)}var w=function(){},x=0,S={},O=typeof r!="undefined"&&r.XDomainRequest;function P(){var v=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return v&&Number(v[1])}function g(){var v;return O&&(v=P())&&v===10}function b(v,I){return v.getResponseHeader&&v.getResponseHeader(I)}function f(v){return v.getResponseHeader&&(v.getResponseHeader("transfer-encoding")||!v.getResponseHeader("content-length"))}function p(v){for(var I=a.trim(v.getAllResponseHeaders()).split(`\r
`),U={},z=0;z<I.length;z++){var W=I[z].split(":").map(a.trim);U[W[0].toLowerCase()]=W[1]}return U}var T=function(v){i.__extends(I,v);function I(U,z,W,D,M,L,$){var G=v.call(this)||this;return W=W||{},W.rnd=a.cheapRandStr(),g()&&!W.envelope&&(W.envelope="json"),G.uri=U+a.toQueryString(W),G.headers=z||{},G.body=D,G.method=$?$.toUpperCase():a.isEmptyArg(D)?"GET":"POST",G.requestMode=M,G.timeouts=L,G.timedOut=!1,G.requestComplete=!1,G.id=String(++x),S[G.id]=G,G}return I.createRequest=function(U,z,W,D,M,L,$){var G=L||m.default.TIMEOUTS;return new I(U,z,a.copy(W),D,M,G,$)},I.prototype.complete=function(U,z,W,D,M){this.requestComplete||(this.requestComplete=!0,!U&&z&&this.emit("data",z),this.emit("complete",U,z,W,D,M),this.dispose())},I.prototype.abort=function(){this.dispose()},I.prototype.exec=function(){var U=this,z=this.headers,W=this.requestMode==y.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,D=this.timer=setTimeout(function(){U.timedOut=!0,L.abort()},W),M=this.method,L=this.xhr=new XMLHttpRequest,$=z.accept,G=this.body,J="text";if($?$.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):z.accept="application/json",G){var tt=z["content-type"]||(z["content-type"]="application/json");tt.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}L.open(M,this.uri,!0),L.responseType=J,"authorization"in z&&(L.withCredentials=!0);for(var rt in z)L.setRequestHeader(rt,z[rt]);var X=function(ft,Zt,be,oe){var he,un=Zt+" (event type: "+ft.type+")";!((he=U==null?void 0:U.xhr)===null||he===void 0)&&he.statusText&&(un+=", current statusText is "+U.xhr.statusText),d.default.logAction(d.default.LOG_ERROR,"Request.on"+ft.type+"()",un),U.complete(new u.PartialErrorInfo(un,be,oe))};L.onerror=function(ft){X(ft,"XHR error occurred",null,400)},L.onabort=function(ft){U.timedOut?X(ft,"Request aborted due to request timeout expiring",null,408):X(ft,"Request cancelled",null,400)},L.ontimeout=function(ft){X(ft,"Request timed out",null,408)};var _,B,H,j=0,et=!1,ct=function(){if(clearTimeout(D),H=B<400,B==204){U.complete(null,null,null,null,B);return}_=U.requestMode==y.default.REQ_RECV_STREAM&&H&&f(L)},mt=function(){var ft;try{var Zt=b(L,"content-type"),be=Zt?Zt.indexOf("application/json")>=0:L.responseType=="text";if(be){var oe=L.responseType==="arraybuffer"?C.default.BufferUtils.utf8Decode(L.response):String(L.responseText);oe.length?ft=JSON.parse(oe):ft=oe,et=!0}else ft=L.response;ft.response!==void 0?(B=ft.statusCode,H=B<400,z=ft.headers,ft=ft.response):z=p(L)}catch(un){U.complete(new u.PartialErrorInfo("Malformed response body from server: "+un.message,null,400));return}if(H||a.isArray(ft)){U.complete(null,ft,z,et,B);return}var he=E(ft,z);he||(he=new u.PartialErrorInfo("Error response received from server: "+B+" body was: "+C.default.Config.inspect(ft),null,B)),U.complete(he,ft,z,et,B)};function Et(){for(var ft=L.responseText,Zt=ft.length-1,be,oe;j<Zt&&(be=ft.indexOf(`
`,j))>-1;)oe=ft.slice(j,be),j=be+1,St(oe)}var St=function(ft){try{ft=JSON.parse(ft)}catch(Zt){U.complete(new u.PartialErrorInfo("Malformed response body from server: "+Zt.message,null,400));return}U.emit("data",ft)},Wt=function(){Et(),U.streamComplete=!0,C.default.Config.nextTick(function(){U.complete()})};L.onreadystatechange=function(){var ft=L.readyState;ft<3||L.status!==0&&(B===void 0&&(B=L.status,B===1223&&(B=204),ct()),ft==3&&_?Et():ft==4&&(_?Wt():mt()))},L.send(G)},I.prototype.dispose=function(){var U=this.xhr;if(U){U.onreadystatechange=U.onerror=U.onabort=U.ontimeout=w,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||U.abort()}delete S[this.id]},I}(l.default);e.default=T}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=r.__importStar(t(1)),l=r.__importDefault(t(23)),u=r.__importDefault(t(4)),d=r.__importDefault(t(45)),m=t(11),y=r.__importDefault(t(18)),C=r.__importDefault(t(25)),h=r.__importDefault(t(3)),E=r.__importDefault(t(14)),w=Math.pow(2,17);function x(){}function S(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(W){return!!W.connection}function P(W){return a.isErrorInfoOrPartialErrorInfo(W)?(W.code||(W.statusCode===403?W.code=40300:(W.code=40170,W.statusCode=401)),W):new u.default(a.inspectError(W),W.code||40170,W.statusCode||401)}var g=function(W,D){if(h.default.Config.createHmac){var M=h.default.Config.createHmac("SHA256",D);return M.update(W),M.digest("base64")}return(0,m.stringify)((0,d.default)(W,D))};function b(W){if(!W)return"";typeof W=="string"&&(W=JSON.parse(W));var D=Object.create(null),M=a.keysArray(W,!0);if(!M)return"";M.sort();for(var L=0;L<M.length;L++)D[M[L]]=W[M[L]].sort();return JSON.stringify(D)}function f(W){if(W.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(W.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(W.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(W.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var D="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",D),new Error(D)}}function p(W){return"useTokenAuth"in W&&!W.useTokenAuth}function T(W){return W.useTokenAuth||!p(W)&&(W.authCallback||W.authUrl||W.token||W.tokenDetails)}function v(W){return!W.key&&!W.authCallback&&!W.authUrl}var I=0;function U(){return I++}var z=function(){function W(D,M){if(this.authOptions={},this.client=D,this.tokenParams=M.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,T(M)){if(M.key&&!g){var L="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new Error(L)}v(M)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(M.defaultTokenParams,M),f(this.authOptions)}else{if(!M.key){var L="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new u.default(L,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(M)}}return W.prototype.authorize=function(D,M,L){var $=this,G;if(typeof D=="function"&&!L?(L=D,G=D=null):typeof M=="function"&&!L?(L=M,G=null):G=M,!L&&this.client.options.promises)return a.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new u.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),a.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(D,G,function(J,tt){if(J){$.client.connection&&J.statusCode===C.default.Forbidden&&$.client.connection.connectionManager.actOnErrorFromAuthorize(J),L==null||L(J);return}O($.client)?$.client.connection.connectionManager.onAuthUpdated(tt,L||x):L==null||L(null,tt)})},W.prototype.authorise=function(D,M,L){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(D,M,L)},W.prototype._forceNewToken=function(D,M,L){var $=this;this.tokenDetails=null,this._saveTokenOptions(D,M),f(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,J){delete $.tokenParams.timestamp,delete $.authOptions.queryTime,L(G,J)})},W.prototype.requestToken=function(D,M,L){var $=this;if(typeof D=="function"&&!L?(L=D,M=D=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return a.promisify(this,"requestToken",arguments);M=M||this.authOptions,D=D||a.copy(this.tokenParams);var G=L||x,J,tt=this.client;if(M.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=M.authCallback;else if(M.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,et){var ct=a.mixin({accept:"application/json, text/plain"},M.authHeaders),mt=M.authMethod&&M.authMethod.toLowerCase()==="post",Et,St=M.authUrl.indexOf("?");St>-1&&(Et=a.parseQueryString(M.authUrl.slice(St)),M.authUrl=M.authUrl.slice(0,St),mt||(M.authParams=a.mixin(Et,M.authParams)));var Wt=a.mixin({},M.authParams||{},j),ft=function(oe,he,un,yn){var le;if(oe?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+a.inspectError(oe)):(le=un["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+le+"; body: "+a.inspectBody(he))),oe||yn)return et(oe,he);if(h.default.BufferUtils.isBuffer(he)&&(he=he.toString()),!le){et(new u.default("authUrl response is missing a content-type header",40170,401));return}var bn=le.indexOf("application/json")>-1,Vn=le.indexOf("text/plain")>-1||le.indexOf("application/jwt")>-1;if(!bn&&!Vn){et(new u.default("authUrl responded with unacceptable content-type "+le+", should be either text/plain, application/jwt or application/json",40170,401));return}if(bn){if(he.length>w){et(new u.default("authUrl response exceeded max permitted length",40170,401));return}try{he=JSON.parse(he)}catch(qi){et(new u.default("Unexpected error processing authURL response; err = "+qi.message,40170,401));return}}et(null,he,le)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+M.authUrl+"; Params: "+JSON.stringify(Wt)+"; method: "+(mt?"POST":"GET")),mt){var Zt=ct||{};Zt["content-type"]="application/x-www-form-urlencoded";var be=a.toQueryString(Wt).slice(1);$.client.http.doUri(y.default.Post,tt,M.authUrl,Zt,be,Et,ft)}else $.client.http.doUri(y.default.Get,tt,M.authUrl,ct||{},null,Wt,ft)};else if(M.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,et){$.createTokenRequest(j,M,et)};else{var rt="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new u.default(rt,40171,403));return}"capability"in D&&(D.capability=b(D.capability));var X=function(j,et){var ct=j.keyName,mt="/keys/"+ct+"/requestToken",Et=function(Wt){return tt.baseUri(Wt)+mt},St=a.defaultPostHeaders($.client.options);M.requestHeaders&&a.mixin(St,M.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+mt+"; Token params: "+JSON.stringify(j)),$.client.http.do(y.default.Post,tt,Et,St,JSON.stringify(j),null,et)},_=!1,B=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){_=!0;var j="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",j),G(new u.default(j,40170,401))},B);J(D,function(j,et,ct){if(!_){if(clearTimeout(H),j){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+a.inspectError(j)),G(P(j));return}if(typeof et=="string"){et.length===0?G(new u.default("Token string is empty",40170,401)):et.length>w?G(new u.default("Token string exceeded max permitted length (was "+et.length+" bytes)",40170,401)):et==="undefined"||et==="null"?G(new u.default("Token string was literal null/undefined",40170,401)):et[0]==="{"&&!(ct&&ct.indexOf("application/jwt")>-1)?G(new u.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:et});return}if(typeof et!="object"){var mt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof et;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",mt),G(new u.default(mt,40170,401));return}var Et=JSON.stringify(et).length;if(Et>w&&!M.suppressMaxLengthCheck){G(new u.default("Token request/details object exceeded max permitted stringified size (was "+Et+" bytes)",40170,401));return}if("issued"in et){G(null,et);return}if(!("keyName"in et)){var mt="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",mt),G(new u.default(mt,40170,401));return}X(et,function(St,Wt,ft,Zt){if(St){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+a.inspectError(St)),G(P(St));return}Zt||(Wt=JSON.parse(Wt)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,Wt)})}})},W.prototype.createTokenRequest=function(D,M,L){var $=this;if(typeof D=="function"&&!L?(L=D,M=D=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return a.promisify(this,"createTokenRequest",arguments);M=M||this.authOptions,D=D||a.copy(this.tokenParams);var G=M.key;if(!G){L(new u.default("No key specified",40101,403));return}var J=G.split(":"),tt=J[0],rt=J[1];if(!rt){L(new u.default("Invalid key specified",40101,403));return}if(D.clientId===""){L(new u.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in D&&(D.capability=b(D.capability));var X=a.mixin({keyName:tt},D),_=D.clientId||"",B=D.ttl||"",H=D.capability||"";(function(j){if(X.timestamp){j();return}$.getTimestamp(M&&M.queryTime,function(et,ct){if(et){L(et);return}X.timestamp=ct,j()})})(function(){var j=X.nonce||(X.nonce=S()),et=X.timestamp,ct=X.keyName+`
`+B+`
`+H+`
`+_+`
`+et+`
`+j+`
`;X.mac=X.mac||g(ct,rt),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),L(null,X)})},W.prototype.getAuthParams=function(D){this.method=="basic"?D(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){D(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{access_token:L.token})})},W.prototype.getAuthHeaders=function(D){this.method=="basic"?D(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){D(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{authorization:"Bearer "+a.toBase64(L.token)})})},W.prototype.getTimestamp=function(D,M){!this.isTimeOffsetSet()&&(D||this.authOptions.queryTime)?this.client.time(M):M(null,this.getTimestampUsingOffset())},W.prototype.getTimestampUsingOffset=function(){return a.now()+(this.client.serverTimeOffset||0)},W.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},W.prototype._saveBasicOptions=function(D){this.method="basic",this.key=D.key,this.basicKey=a.toBase64(D.key),this.authOptions=D||{},"clientId"in D&&this._userSetClientId(D.clientId)},W.prototype._saveTokenOptions=function(D,M){this.method="token",D&&(this.tokenParams=D),M&&(M.token&&(M.tokenDetails=typeof M.token=="string"?{token:M.token}:M.token),M.tokenDetails&&(this.tokenDetails=M.tokenDetails),"clientId"in M&&this._userSetClientId(M.clientId),this.authOptions=M)},W.prototype._ensureValidAuthCredentials=function(D,M){var L=this,$=this.tokenDetails;if($){if(this._tokenClientIdMismatch($.clientId)){M(new u.default("Mismatch between clientId in token ("+$.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!$.expires||$.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+$.expires),M(null,$);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(M),!(this.currentTokenRequestId!==null&&!D)){var G=this.currentTokenRequestId=U();this.requestToken(this.tokenParams,this.authOptions,function(J,tt){if(L.currentTokenRequestId>G){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}L.currentTokenRequestId=null;var rt=L.waitingForTokenRequest||x;if(L.waitingForTokenRequest=null,J){rt(J);return}rt(null,L.tokenDetails=tt)})}},W.prototype._userSetClientId=function(D){if(typeof D=="string"||D===null){if(D==="*")throw new u.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var M=this._uncheckedSetClientId(D);if(M)throw M}else throw new u.default("clientId must be either a string or null",40012,400)},W.prototype._uncheckedSetClientId=function(D){if(this._tokenClientIdMismatch(D)){var M="Unexpected clientId mismatch: client has "+this.clientId+", requested "+D,L=new u.default(M,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",M),L}else return this.clientId=this.tokenParams.clientId=D,null},W.prototype._tokenClientIdMismatch=function(D){return!!(this.clientId&&this.clientId!=="*"&&D&&D!=="*"&&this.clientId!==D)},W.isTokenErr=function(D){return D.code&&D.code>=40140&&D.code<40150},W.prototype.revokeTokens=function(D,M,L){if(T(this.client.options))throw new u.default("Cannot revoke tokens when using token auth",40162,401);var $=this.client.options.keyName,G;if(typeof M=="function"?(L=M,G={}):G=M!=null?M:{},L===void 0){if(this.client.options.promises)return a.promisify(this,"revokeTokens",[D,G]);L=x}var J=L,tt=r.__assign({targets:D.map(function(B){return"".concat(B.type,":").concat(B.value)})},G),rt=this.client.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,X=a.defaultPostHeaders(this.client.options,rt);this.client.options.headers&&a.mixin(X,this.client.options.headers);var _=a.encodeBody(tt,rt);E.default.post(this.client,"/keys/".concat($,"/revokeTokens"),_,X,{newBatchResponse:"true"},null,function(B,H,j,et){if(B){J(B);return}var ct=et?H:a.decodeBody(H,rt);J(null,ct)})},W}();e.default=z},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(r||(r={})),e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),l=r.__importDefault(t(14));function u(E){var w=E.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&i.parseQueryString(w[2])}function d(E){typeof E=="string"&&(E=E.split(","));for(var w={},x=0;x<E.length;x++){var S=E[x].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(S){var O=u(S[1]);O&&(w[S[2]]=O)}}return w}function m(E,w,x){return!(x&&(w||typeof E.code=="number"))}var y=function(){function E(w,x,S,O,P,g){this.rest=w,this.path=x,this.headers=S,this.envelope=O!=null?O:null,this.bodyHandler=P,this.useHttpPaginatedResponse=g||!1}return E.prototype.get=function(w,x){var S=this;l.default.get(this.rest,this.path,this.headers,w,this.envelope,function(O,P,g,b,f){S.handlePage(O,P,g,b,f,x)})},E.prototype.delete=function(w,x){var S=this;l.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(O,P,g,b,f){S.handlePage(O,P,g,b,f,x)})},E.prototype.post=function(w,x,S){var O=this;l.default.post(this.rest,this.path,x,this.headers,w,this.envelope,function(P,g,b,f,p){S&&O.handlePage(P,g,b,f,p,S)})},E.prototype.put=function(w,x,S){var O=this;l.default.put(this.rest,this.path,x,this.headers,w,this.envelope,function(P,g,b,f,p){S&&O.handlePage(P,g,b,f,p,S)})},E.prototype.patch=function(w,x,S){var O=this;l.default.patch(this.rest,this.path,x,this.headers,w,this.envelope,function(P,g,b,f,p){S&&O.handlePage(P,g,b,f,p,S)})},E.prototype.handlePage=function(w,x,S,O,P,g){if(w&&m(w,x,this.useHttpPaginatedResponse)){a.default.logAction(a.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(w)),g==null||g(w);return}var b,f,p;try{b=this.bodyHandler(x,S||{},O)}catch(T){g==null||g(w||T);return}S&&(f=S.Link||S.link)&&(p=d(f)),this.useHttpPaginatedResponse?g(null,new h(this,b,S||{},P,p,w)):g(null,new C(this,b,p))},E}(),C=function(){function E(w,x,S){var O=this;this.resource=w,this.items=x;var P=this;S&&("first"in S&&(this.first=function(g){if(!g&&P.resource.rest.options.promises)return i.promisify(P,"first",[]);P.get(S.first,g)}),"current"in S&&(this.current=function(g){if(!g&&P.resource.rest.options.promises)return i.promisify(P,"current",[]);P.get(S.current,g)}),this.next=function(g){if(!g&&P.resource.rest.options.promises)return i.promisify(P,"next",[]);"next"in S?P.get(S.next,g):g(null)},this.hasNext=function(){return"next"in S},this.isLast=function(){var g;return!(!((g=O.hasNext)===null||g===void 0)&&g.call(O))})}return E.prototype.get=function(w,x){var S=this.resource;l.default.get(S.rest,S.path,S.headers,w,S.envelope,function(O,P,g,b,f){S.handlePage(O,P,g,b,f,x)})},E}();e.PaginatedResult=C;var h=function(E){r.__extends(w,E);function w(x,S,O,P,g,b){var f=E.call(this,x,S,g)||this;return f.statusCode=P,f.success=P<300&&P>=200,f.headers=O,f.errorCode=b&&b.code,f.errorMessage=b&&b.message,f}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(C);e.HttpPaginatedResponse=h,e.default=y},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var r=t(0),i=r.__importDefault(t(4)),a={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},l={disconnected:function(){return i.default.fromValues({statusCode:400,code:a.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return i.default.fromValues({statusCode:400,code:a.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return i.default.fromValues({statusCode:400,code:a.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return i.default.fromValues({statusCode:400,code:a.CLOSING,message:"Connection closing"})},closed:function(){return i.default.fromValues({statusCode:400,code:a.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function u(d){return!d.statusCode||!d.code||d.statusCode>=500?!0:Object.values(a).includes(d.code)}e.isRetriable=u,e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(r||(r={})),e.default=r},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(5),t(58),t(11),t(40),t(32),t(24),t(27),t(28),t(59),t(60))})(this,function(r){return r})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=function(){function l(u){this.members=u||[]}return l.prototype.call=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];for(var m=0,y=this.members;m<y.length;m++){var C=y[m];if(C)try{C.apply(void 0,u)}catch(h){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+h+"; stack = "+h.stack)}}},l.prototype.push=function(){for(var u,d=[],m=0;m<arguments.length;m++)d[m]=arguments[m];(u=this.members).push.apply(u,d)},l.create=function(u){var d=new l(u);return Object.assign(function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];return d.call.apply(d,m)},{push:function(m){return d.push(m)}})},l}();e.default=a},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){(function(){var i=r,a=i.lib,l=a.Base,u=i.enc,d=u.Utf8,m=i.algo,y=m.HMAC=l.extend({init:function(C,h){C=this._hasher=new C.init,typeof h=="string"&&(h=d.parse(h));var E=C.blockSize,w=E*4;h.sigBytes>w&&(h=C.finalize(h)),h.clamp();for(var x=this._oKey=h.clone(),S=this._iKey=h.clone(),O=x.words,P=S.words,g=0;g<E;g++)O[g]^=1549556828,P[g]^=909522486;x.sigBytes=S.sigBytes=w,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var h=this._hasher,E=h.finalize(C);h.reset();var w=h.finalize(this._oKey.clone().concat(E));return w}})})()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var r;(function(a){a[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError"})(r||(r={}));function i(a){return a>=r.Success&&a<r.BadRequest}e.isSuccessCode=i,e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(10)),a=r.__importStar(t(1)),l=r.__importDefault(t(7)),u=r.__importDefault(t(2)),d=r.__importDefault(t(20)),m=r.__importDefault(t(4)),y=r.__importDefault(t(3)),C=i.default.Action,h=i.default.fromValues({action:C.CLOSE}),E=i.default.fromValues({action:C.DISCONNECT}),w=function(x){r.__extends(S,x);function S(O,P,g,b){var f=x.call(this)||this;return b&&(g.format=void 0,g.heartbeats=!0),f.connectionManager=O,O.registerProposedTransport(f),f.auth=P,f.params=g,f.timeouts=g.options.timeouts,f.format=g.format,f.isConnected=!1,f.isFinished=!1,f.isDisposed=!1,f.maxIdleInterval=null,f.idleTimer=null,f.lastActivity=null,f}return S.prototype.connect=function(){},S.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",d.default.closed())},S.prototype.disconnect=function(O){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",O||d.default.disconnected())},S.prototype.fail=function(O){this.isConnected&&this.requestDisconnect(),this.finish("failed",O||d.default.failed())},S.prototype.finish=function(O,P){var g;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((g=this.idleTimer)!==null&&g!==void 0?g:void 0),this.idleTimer=null,this.emit(O,P),this.dispose())},S.prototype.onProtocolMessage=function(O){switch(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(O)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),O.action){case C.HEARTBEAT:u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",O.id);break;case C.CONNECTED:this.onConnect(O),this.emit("connected",O.error,O.connectionId,O.connectionDetails,O);break;case C.CLOSED:this.onClose(O);break;case C.DISCONNECTED:this.onDisconnect(O);break;case C.ACK:this.emit("ack",O.msgSerial,O.count);break;case C.NACK:this.emit("nack",O.msgSerial,O.count,O.error);break;case C.SYNC:this.connectionManager.onChannelMessage(O,this);break;case C.ACTIVATE:break;case C.AUTH:this.auth.authorize(function(P){P&&u.default.logAction(u.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+a.inspectError(P))});break;case C.ERROR:if(u.default.logAction(u.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+y.default.Config.inspect(O.error)+(O.channel?", channel: "+O.channel:"")),O.channel===void 0){this.onFatalError(O);break}this.connectionManager.onChannelMessage(O,this);break;default:this.connectionManager.onChannelMessage(O,this)}},S.prototype.onConnect=function(O){if(this.isConnected=!0,!O.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var P=O.connectionDetails.maxIdleInterval;P&&(this.maxIdleInterval=P+this.timeouts.realtimeRequestTimeout,this.onActivity())},S.prototype.onDisconnect=function(O){var P=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onDisconnect()","err = "+a.inspectError(P)),this.finish("disconnected",P)},S.prototype.onFatalError=function(O){var P=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onFatalError()","err = "+a.inspectError(P)),this.finish("failed",P)},S.prototype.onClose=function(O){var P=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onClose()","err = "+a.inspectError(P)),this.finish("closed",P)},S.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestClose()",""),this.send(h)},S.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},S.prototype.ping=function(O){var P={action:i.default.Action.HEARTBEAT};O&&(P.id=O),this.send(i.default.fromValues(P))},S.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},S.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=a.now(),this.setIdleTimer(this.maxIdleInterval+100))},S.prototype.setIdleTimer=function(O){var P=this;this.idleTimer||(this.idleTimer=setTimeout(function(){P.onIdleTimerExpire()},O))},S.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var O=a.now()-this.lastActivity,P=this.maxIdleInterval-O;if(P<=0){var g="No activity seen from realtime in "+O+"ms; assuming connection has dropped";u.default.logAction(u.default.LOG_ERROR,"Transport.onIdleTimerExpire()",g),this.disconnect(new m.default(g,80003,408))}else this.setIdleTimer(P+100)},S.tryConnect=function(O,P,g,b,f){var p=new O(P,g,b),T,v=function(U){clearTimeout(T),f({event:this.event,error:U})},I=P.options.timeouts.realtimeRequestTimeout;T=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),v.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},I),p.on(["failed","disconnected"],v),p.on("preconnect",function(){u.default.logAction(u.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(T),p.off(["failed","disconnected"],v),f(null,p)}),p.connect()},S}(l.default);e.default=w},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(40),t(24))})(this,function(r){return function(){var i=r,a=i.lib,l=a.Base,u=a.WordArray,d=i.algo,m=d.MD5,y=d.EvpKDF=l.extend({cfg:l.extend({keySize:128/32,hasher:m,iterations:1}),init:function(C){this.cfg=this.cfg.extend(C)},compute:function(C,h){for(var E,w=this.cfg,x=w.hasher.create(),S=u.create(),O=S.words,P=w.keySize,g=w.iterations;O.length<P;){E&&x.update(E),E=x.update(C).finalize(h),x.reset();for(var b=1;b<g;b++)E=x.finalize(E),x.reset();S.concat(E)}return S.sigBytes=P*4,S}});i.EvpKDF=function(C,h,E){return y.create(E).compute(C,h)}}(),r.EvpKDF})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(27))})(this,function(r){r.lib.Cipher||function(i){var a=r,l=a.lib,u=l.Base,d=l.WordArray,m=l.BufferedBlockAlgorithm,y=a.enc,C=y.Utf8,h=y.Base64,E=a.algo,w=E.EvpKDF,x=l.Cipher=m.extend({cfg:u.extend(),createEncryptor:function(M,L){return this.create(this._ENC_XFORM_MODE,M,L)},createDecryptor:function(M,L){return this.create(this._DEC_XFORM_MODE,M,L)},init:function(M,L,$){this.cfg=this.cfg.extend($),this._xformMode=M,this._key=L,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(M){return this._append(M),this._process()},finalize:function(M){M&&this._append(M);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function M(L){return typeof L=="string"?D:U}return function(L){return{encrypt:function($,G,J){return M(G).encrypt(L,$,G,J)},decrypt:function($,G,J){return M(G).decrypt(L,$,G,J)}}}}()}),S=l.StreamCipher=x.extend({_doFinalize:function(){var M=this._process(!0);return M},blockSize:1}),O=a.mode={},P=l.BlockCipherMode=u.extend({createEncryptor:function(M,L){return this.Encryptor.create(M,L)},createDecryptor:function(M,L){return this.Decryptor.create(M,L)},init:function(M,L){this._cipher=M,this._iv=L}}),g=O.CBC=function(){var M=P.extend();M.Encryptor=M.extend({processBlock:function($,G){var J=this._cipher,tt=J.blockSize;L.call(this,$,G,tt),J.encryptBlock($,G),this._prevBlock=$.slice(G,G+tt)}}),M.Decryptor=M.extend({processBlock:function($,G){var J=this._cipher,tt=J.blockSize,rt=$.slice(G,G+tt);J.decryptBlock($,G),L.call(this,$,G,tt),this._prevBlock=rt}});function L($,G,J){var tt,rt=this._iv;rt?(tt=rt,this._iv=i):tt=this._prevBlock;for(var X=0;X<J;X++)$[G+X]^=tt[X]}return M}(),b=a.pad={},f=b.Pkcs7={pad:function(M,L){for(var $=L*4,G=$-M.sigBytes%$,J=G<<24|G<<16|G<<8|G,tt=[],rt=0;rt<G;rt+=4)tt.push(J);var X=d.create(tt,G);M.concat(X)},unpad:function(M){var L=M.words[M.sigBytes-1>>>2]&255;M.sigBytes-=L}},p=l.BlockCipher=x.extend({cfg:x.cfg.extend({mode:g,padding:f}),reset:function(){var M;x.reset.call(this);var L=this.cfg,$=L.iv,G=L.mode;this._xformMode==this._ENC_XFORM_MODE?M=G.createEncryptor:(M=G.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==M?this._mode.init(this,$&&$.words):(this._mode=M.call(G,this,$&&$.words),this._mode.__creator=M)},_doProcessBlock:function(M,L){this._mode.processBlock(M,L)},_doFinalize:function(){var M,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),M=this._process(!0)):(M=this._process(!0),L.unpad(M)),M},blockSize:128/32}),T=l.CipherParams=u.extend({init:function(M){this.mixIn(M)},toString:function(M){return(M||this.formatter).stringify(this)}}),v=a.format={},I=v.OpenSSL={stringify:function(M){var L,$=M.ciphertext,G=M.salt;return G?L=d.create([1398893684,1701076831]).concat(G).concat($):L=$,L.toString(h)},parse:function(M){var L,$=h.parse(M),G=$.words;return G[0]==1398893684&&G[1]==1701076831&&(L=d.create(G.slice(2,4)),G.splice(0,4),$.sigBytes-=16),T.create({ciphertext:$,salt:L})}},U=l.SerializableCipher=u.extend({cfg:u.extend({format:I}),encrypt:function(M,L,$,G){G=this.cfg.extend(G);var J=M.createEncryptor($,G),tt=J.finalize(L),rt=J.cfg;return T.create({ciphertext:tt,key:$,iv:rt.iv,algorithm:M,mode:rt.mode,padding:rt.padding,blockSize:M.blockSize,formatter:G.format})},decrypt:function(M,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=M.createDecryptor($,G).finalize(L.ciphertext);return J},_parse:function(M,L){return typeof M=="string"?L.parse(M,this):M}}),z=a.kdf={},W=z.OpenSSL={execute:function(M,L,$,G){G||(G=d.random(64/8));var J=w.create({keySize:L+$}).compute(M,G),tt=d.create(J.words.slice(L),$*4);return J.sigBytes=L*4,T.create({key:J,iv:tt,salt:G})}},D=l.PasswordBasedCipher=U.extend({cfg:U.cfg.extend({kdf:W}),encrypt:function(M,L,$,G){G=this.cfg.extend(G);var J=G.kdf.execute($,M.keySize,M.ivSize);G.iv=J.iv;var tt=U.encrypt.call(this,M,L,J.key,G);return tt.mixIn(J),tt},decrypt:function(M,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=G.kdf.execute($,M.keySize,M.ivSize,L.salt);G.iv=J.iv;var tt=U.decrypt.call(this,M,L,J.key,G);return tt}})}()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(12)),l=r.__importDefault(t(3)),u=r.__importDefault(t(7)),d=t(4),m=r.__importDefault(t(8)),y=r.__importDefault(t(2)),C=r.__importDefault(t(21)),h=i.getGlobalObject(),E=function(){},w=h._ablyjs_jsonp={};w._=function(f){return w["_"+f]||E};var x=1,S="jsonp";function O(f,p,T,v,I,U,z){return U=U||m.default.TIMEOUTS,new g(void 0,f,p,i.copy(T),v,I,U,z)}e.createRequest=O;var P=function(f){r.__extends(p,f);function p(T,v,I){var U=f.call(this,T,v,I)||this;return U.shortName=S,I.stream=!1,U}return p.isAvailable=function(){return l.default.Config.jsonpSupported&&l.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(T,v,I,U,z,W,D){return W=(this===null||this===void 0?void 0:this.timeouts)||W||m.default.TIMEOUTS,O(T,v,I,U,z,W,D)},p}(a.default),g=function(f){r.__extends(p,f);function p(T,v,I,U,z,W,D,M){var L=f.call(this)||this;return T===void 0&&(T=x++),L.id=T,L.uri=v,L.params=U||{},L.params.rnd=i.cheapRandStr(),I&&(I["X-Ably-Version"]&&(L.params.v=I["X-Ably-Version"]),I["X-Ably-Lib"]&&(L.params.lib=I["X-Ably-Lib"])),L.body=z,L.method=M,L.requestMode=W,L.timeouts=D,L.requestComplete=!1,L}return p.prototype.exec=function(){var T=this,v=this.id,I=this.body,U=this.method,z=this.uri,W=this.params;W.callback="_ablyjs_jsonp._("+v+")",W.envelope="jsonp",I&&(W.body=I),U&&U!=="get"&&(W.method=U);var D=this.script=document.createElement("script"),M=z+i.toQueryString(W);D.src=M,D.src.split("/").slice(-1)[0]!==M.split("/").slice(-1)[0]&&y.default.logAction(y.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),D.async=!0,D.type="text/javascript",D.charset="UTF-8",D.onerror=function(G){T.complete(new d.PartialErrorInfo("JSONP script error (event: "+l.default.Config.inspect(G)+")",null,400))},w["_"+v]=function(G){if(G.statusCode){var J=G.response;if(G.statusCode==204)T.complete(null,null,null,G.statusCode);else if(!J)T.complete(new d.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||i.isArray(J))T.complete(null,J,G.headers,G.statusCode);else{var tt=J.error||new d.PartialErrorInfo("Error response received from server",null,G.statusCode);T.complete(tt)}}else T.complete(null,G)};var L=this.requestMode==C.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),L);var $=document.getElementsByTagName("head")[0];$.insertBefore(D,$.firstChild)},p.prototype.complete=function(T,v,I,U){if(I=I||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;v&&(z=typeof v=="string"?"text/plain":"application/json",I["content-type"]=z,this.emit("data",v)),this.emit("complete",T,v,I,!0,U),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var T=this.timer;T&&(clearTimeout(T),this.timer=null);var v=this.script;v.parentNode&&v.parentNode.removeChild(v),delete w[this.id],this.emit("disposed")},p}(u.default);e.Request=g;function b(f){return h.JSONPTransport=P,P.isAvailable()&&(f.supportedTransports[S]=P),P}e.default=b},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),l=r.__importDefault(t(8)),u=r.__importDefault(t(17)),d=r.__importDefault(t(46)),m=r.__importDefault(t(19)),y=r.__importDefault(t(33)),C=r.__importDefault(t(4)),h=r.__importDefault(t(49)),E=r.__importDefault(t(18)),w=r.__importDefault(t(3)),x=r.__importDefault(t(9)),S=r.__importDefault(t(15)),O=r.__importDefault(t(14)),P=function(){},g=function(){function f(p){if(!p){var T="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",T),new Error(T)}var v=l.default.objectifyOptions(p);v.log&&a.default.setLog(v.log.level,v.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(p));var I=this.options=l.default.normaliseOptions(v);if(I.key){var U=I.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!U){var T="invalid key parameter";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",T),new C.default(T,40400,404)}I.keyName=U[1],I.keySecret=U[2]}if("clientId"in I)if(typeof I.clientId=="string"||I.clientId===null){if(I.clientId==="*")throw new C.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new C.default("clientId must be either a string or null",40012,400);a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+l.default.version),this.baseUri=this.authority=function(z){return l.default.getHttpScheme(I)+z+":"+l.default.getPort(I,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http(I),this.auth=new u.default(this,I),this.channels=new b(this),this.push=new d.default(this)}return f.prototype.stats=function(p,T){if(T===void 0)if(typeof p=="function")T=p,p=null;else{if(this.options.promises)return i.promisify(this,"stats",[p]);T=P}var v=i.defaultGetHeaders(this.options),I=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:I;this.options.headers&&i.mixin(v,this.options.headers),new m.default(this,"/stats",v,U,function(z,W,D){for(var M=D?z:JSON.parse(z),L=0;L<M.length;L++)M[L]=h.default.fromValues(M[L]);return M}).get(p,T)},f.prototype.time=function(p,T){var v=this;if(T===void 0){if(typeof p=="function")T=p,p=null;else if(this.options.promises)return i.promisify(this,"time",[p])}var I=T||P,U=i.defaultGetHeaders(this.options);this.options.headers&&i.mixin(U,this.options.headers);var z=function(W){return v.authority(W)+"/time"};this.http.do(E.default.Get,this,z,U,null,p,function(W,D,M,L){if(W){I(W);return}L||(D=JSON.parse(D));var $=D[0];if(!$){I(new C.default("Internal error (unexpected result type from GET /time)",5e4,500));return}v.serverTimeOffset=$-i.now(),I(null,$)})},f.prototype.request=function(p,T,v,I,U,z){var W=this.options.useBinaryProtocol,D=W?w.default.Config.msgpack.encode:JSON.stringify,M=W?w.default.Config.msgpack.decode:JSON.parse,L=W?i.Format.msgpack:i.Format.json,$=this.http.supportsLinkHeaders?void 0:L;v=v||{};var G=p.toLowerCase(),J=G=="get"?i.defaultGetHeaders(this.options,L):i.defaultPostHeaders(this.options,L);if(z===void 0){if(this.options.promises)return i.promisify(this,"request",[p,T,v,I,U]);z=P}typeof I!="string"&&(I=D(I)),this.options.headers&&i.mixin(J,this.options.headers),U&&i.mixin(J,U);var tt=new m.default(this,T,J,$,function(rt,X,_){return i.ensureArray(_?rt:M(rt))},!0);if(!i.arrIn(w.default.Http.methods,G))throw new C.default("Unsupported method "+G,40500,405);i.arrIn(w.default.Http.methodsWithBody,G)?tt[G](v,I,z):tt[G](v,z)},f.prototype.batchPublish=function(p,T){if(T===void 0){if(this.options.promises)return i.promisify(this,"batchPublish",[p]);T=P}var v=T,I,U;i.isArray(p)?(I=p,U=!1):(I=[p],U=!0);var z=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,W=i.defaultPostHeaders(this.options,z);this.options.headers&&i.mixin(W,this.options.headers);var D=i.encodeBody(I,z);O.default.post(this,"/messages",D,W,{newBatchResponse:"true"},null,function(M,L,$,G){if(M){v(M);return}var J=G?L:i.decodeBody(L,z);U?v(null,J[0]):v(null,J)})},f.prototype.batchPresence=function(p,T){if(T===void 0){if(this.options.promises)return i.promisify(this,"batchPresence",[p]);T=P}var v=T,I=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,U=i.defaultPostHeaders(this.options,I);this.options.headers&&i.mixin(U,this.options.headers);var z=p.join(",");O.default.get(this,"/presence",U,{newBatchResponse:"true",channels:z},null,function(W,D,M,L){if(W){v(W);return}var $=L?D:i.decodeBody(D,I);v(null,$)})},f.prototype.setLog=function(p){a.default.setLog(p.level,p.handler)},f.Promise=function(p){return p=l.default.objectifyOptions(p),p.promises=!0,new f(p)},f.Callbacks=f,f.Platform=w.default,f.Message=x.default,f.PresenceMessage=S.default,f}(),b=function(){function f(p){this.rest=p,this.all=Object.create(null)}return f.prototype.get=function(p,T){p=String(p);var v=this.all[p];return v?T&&v.setOptions(T):this.all[p]=v=new y.default(this.rest,p,T),v},f.prototype.release=function(p){delete this.all[String(p)]},f}();e.default=g},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return r.enc.Utf8})},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.WordArray,d=l.Hasher,m=a.algo,y=[],C=[];(function(){function w(P){for(var g=i.sqrt(P),b=2;b<=g;b++)if(!(P%b))return!1;return!0}function x(P){return(P-(P|0))*4294967296|0}for(var S=2,O=0;O<64;)w(S)&&(O<8&&(y[O]=x(i.pow(S,1/2))),C[O]=x(i.pow(S,1/3)),O++),S++})();var h=[],E=m.SHA256=d.extend({_doReset:function(){this._hash=new u.init(y.slice(0))},_doProcessBlock:function(w,x){for(var S=this._hash.words,O=S[0],P=S[1],g=S[2],b=S[3],f=S[4],p=S[5],T=S[6],v=S[7],I=0;I<64;I++){if(I<16)h[I]=w[x+I]|0;else{var U=h[I-15],z=(U<<25|U>>>7)^(U<<14|U>>>18)^U>>>3,W=h[I-2],D=(W<<15|W>>>17)^(W<<13|W>>>19)^W>>>10;h[I]=z+h[I-7]+D+h[I-16]}var M=f&p^~f&T,L=O&P^O&g^P&g,$=(O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22),G=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),J=v+G+M+C[I]+h[I],tt=$+L;v=T,T=p,p=f,f=b+J|0,b=g,g=P,P=O,O=J+tt|0}S[0]=S[0]+O|0,S[1]=S[1]+P|0,S[2]=S[2]+g|0,S[3]=S[3]+b|0,S[4]=S[4]+f|0,S[5]=S[5]+p|0,S[6]=S[6]+T|0,S[7]=S[7]+v|0},_doFinalize:function(){var w=this._data,x=w.words,S=this._nDataBytes*8,O=w.sigBytes*8;return x[O>>>5]|=128<<24-O%32,x[(O+64>>>9<<4)+14]=i.floor(S/4294967296),x[(O+64>>>9<<4)+15]=S,w.sigBytes=x.length*4,this._process(),this._hash},clone:function(){var w=d.clone.call(this);return w._hash=this._hash.clone(),w}});a.SHA256=d._createHelper(E),a.HmacSHA256=d._createHmacHelper(E)}(Math),r.SHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),l=r.__importDefault(t(2)),u=r.__importDefault(t(34)),d=r.__importDefault(t(9)),m=r.__importDefault(t(4)),y=r.__importDefault(t(19)),C=r.__importDefault(t(14)),h=r.__importDefault(t(3));function E(){}var w=9;function x(P){return i.arrEvery(P,function(g){return!g.id})}function S(P){var g=P||{};if(g.cipher){if(!h.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var b=h.default.Crypto.getCipher(g.cipher);g.cipher=b.cipherParams,g.channelCipher=b.cipher}else"cipher"in g&&(g.cipher=void 0,g.channelCipher=null);return g}var O=function(P){r.__extends(g,P);function g(b,f,p){var T=P.call(this)||this;return l.default.logAction(l.default.LOG_MINOR,"Channel()","started; name = "+f),T.rest=b,T.name=f,T.basePath="/channels/"+encodeURIComponent(f),T.presence=new u.default(T),T.channelOptions=S(p),T}return g.prototype.setOptions=function(b){this.channelOptions=S(b)},g.prototype.history=function(b,f){if(l.default.logAction(l.default.LOG_MICRO,"Channel.history()","channel = "+this.name),f===void 0)if(typeof b=="function")f=b,b=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);f=E}this._history(b,f)},g.prototype._history=function(b,f){var p=this.rest,T=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:T,I=i.defaultGetHeaders(p.options,T);p.options.headers&&i.mixin(I,p.options.headers);var U=this.channelOptions;new y.default(p,this.basePath+"/messages",I,v,function(z,W,D){return d.default.fromResponseBody(z,U,D?void 0:T)}).get(b,f)},g.prototype.publish=function(){var b=this,f=arguments.length,p=arguments[0],T=arguments[1],v=arguments[f-1],I,U;if(typeof v!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);v=E}if(typeof p=="string"||p===null)I=[d.default.fromValues({name:p,data:T})],U=arguments[2];else if(i.isObject(p))I=[d.default.fromValues(p)],U=arguments[1];else if(i.isArray(p))I=d.default.fromValuesArray(p),U=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof U!="object"||!U)&&(U={});var z=this.rest,W=z.options,D=W.useBinaryProtocol?i.Format.msgpack:i.Format.json,M=z.options.idempotentRestPublishing,L=i.defaultPostHeaders(z.options,D);if(W.headers&&i.mixin(L,W.headers),M&&x(I)){var $=i.randomString(w);i.arrForEach(I,function(G,J){G.id=$+":"+J.toString()})}d.default.encodeArray(I,this.channelOptions,function(G){if(G){v(G);return}var J=d.default.getMessagesSize(I),tt=W.maxMessageSize;if(J>tt){v(new m.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+tt+" bytes)",40009,400));return}b._publish(d.default.serialize(I,D),L,U,v)})},g.prototype._publish=function(b,f,p,T){C.default.post(this.rest,this.basePath+"/messages",b,f,p,null,T)},g.prototype.status=function(b){if(typeof b!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var f=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(this.rest.options,f);C.default.get(this.rest,this.basePath,p,{},f,b||E)},g}(a.default);e.default=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),l=r.__importDefault(t(2)),u=r.__importDefault(t(19)),d=r.__importDefault(t(15));function m(){}var y=function(C){r.__extends(h,C);function h(E){var w=C.call(this)||this;return w.channel=E,w.basePath=E.basePath+"/presence",w}return h.prototype.get=function(E,w){if(l.default.logAction(l.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);w=m}var x=this.channel.rest,S=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:S,P=i.defaultGetHeaders(x.options,S);x.options.headers&&i.mixin(P,x.options.headers);var g=this.channel.channelOptions;new u.default(x,this.basePath,P,O,function(b,f,p){return d.default.fromResponseBody(b,g,p?void 0:S)}).get(E,w)},h.prototype.history=function(E,w){return l.default.logAction(l.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,w)},h.prototype._history=function(E,w){if(w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",[E]);w=m}var x=this.channel.rest,S=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:S,P=i.defaultGetHeaders(x.options,S);x.options.headers&&i.mixin(P,x.options.headers);var g=this.channel.channelOptions;new u.default(x,this.basePath+"/history",P,O,function(b,f,p){return d.default.fromResponseBody(b,g,p?void 0:S)}).get(E,w)},h}(a.default);e.default=y},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var i=t(0),a=i.__importDefault(t(10)),l=i.__importStar(t(1)),u=i.__importStar(t(52)),d=i.__importStar(t(8)),m=i.__importDefault(t(3)),y=i.__importDefault(t(7)),C=i.__importDefault(t(36)),h=i.__importDefault(t(2)),E=i.__importDefault(t(37)),w=i.__importStar(t(20)),x=i.__importStar(t(4)),S=i.__importDefault(t(17)),O=i.__importDefault(t(9)),P=i.__importDefault(t(23)),g=i.__importDefault(t(53)),b=i.__importDefault(t(26)),f=i.__importDefault(t(25)),p=function(){var rt;return typeof m.default.WebStorage!="undefined"&&((rt=m.default.WebStorage)===null||rt===void 0?void 0:rt.localSupported)},T=function(){var rt;return typeof m.default.WebStorage!="undefined"&&((rt=m.default.WebStorage)===null||rt===void 0?void 0:rt.sessionSupported)},v=a.default.Action,I=function(){},U="ably-transport-preference",z="ably-connection-recovery";function W(){var rt,X;return T()&&((X=(rt=m.default.WebStorage)===null||rt===void 0?void 0:rt.getSession)===null||X===void 0?void 0:X.call(rt,z))}function D(rt){var X,_;return T()&&((_=(X=m.default.WebStorage)===null||X===void 0?void 0:X.setSession)===null||_===void 0?void 0:_.call(X,z,rt))}function M(){var rt,X;return T()&&((X=(rt=m.default.WebStorage)===null||rt===void 0?void 0:rt.removeSession)===null||X===void 0?void 0:X.call(rt,z))}function L(rt,X){return l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,rt.shortName)>l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,X.shortName)}function $(rt,X,_){var B;if(rt.channel!==X.channel||(B=rt.action)!==v.PRESENCE&&B!==v.MESSAGE||B!==X.action)return!1;var H=B===v.PRESENCE?"presence":"messages",j=rt[H].concat(X[H]),et=O.default.getMessagesSize(j);return et>_||!l.allSame(j,"clientId")||!l.arrEvery(j,function(ct){return!ct.id})?!1:(rt[H]=j,!0)}function G(rt){try{return JSON.parse(rt)}catch(X){return null}}var J=function(){function rt(X,_,B,H){this.options=X,this.host=_,this.mode=B,this.connectionKey=H,this.format=X.useBinaryProtocol?l.Format.msgpack:l.Format.json}return rt.prototype.getConnectParams=function(X){var _=X?l.copy(X):{},B=this.options;switch(this.mode){case"upgrade":_.upgrade=this.connectionKey;break;case"resume":_.resume=this.connectionKey;break;case"recover":{var H=G(B.recover);H&&(_.recover=H.connectionKey);break}default:}return B.clientId!==void 0&&(_.clientId=B.clientId),B.echoMessages===!1&&(_.echo="false"),this.format!==void 0&&(_.format=this.format),this.stream!==void 0&&(_.stream=this.stream),this.heartbeats!==void 0&&(_.heartbeats=this.heartbeats),_.v=d.default.protocolVersion,_.agent=encodeURIComponent((0,d.getAgentString)(this.options)),B.transportParams!==void 0&&l.mixin(_,B.transportParams),_},rt.prototype.toString=function(){var X="[mode="+this.mode;return this.host&&(X+=",host="+this.host),this.connectionKey&&(X+=",connectionKey="+this.connectionKey),this.format&&(X+=",format="+this.format),X+="]",X},rt}();e.TransportParams=J;var tt=function(rt){i.__extends(X,rt);function X(_,B){var H=rt.call(this)||this;H.disconnectedRetryCount=0,X.initTransports(),H.realtime=_,H.options=B;var j=B.timeouts,et=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:et,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new C.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=j.connectionStateTtl,H.maxIdleInterval=null,H.transports=l.intersect(B.transports||d.default.defaultTransports,X.supportedTransports),H.baseTransport=l.intersect(d.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=l.intersect(H.transports,d.default.upgradeTransports),H.transportPreference=null,H.httpHosts=d.default.getHosts(B),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,h.default.logAction(h.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(B.transports||d.default.defaultTransports)+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var ct="no requested transports available";throw h.default.logAction(h.default.LOG_ERROR,"realtime.ConnectionManager()",ct),new Error(ct)}var mt=m.default.Config.addEventListener;return mt&&(T()&&typeof B.recover=="function"&&mt("beforeunload",H.persistConnection.bind(H)),B.closeOnUnload===!0&&mt("beforeunload",function(){h.default.logAction(h.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),mt("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(Et){Et.off()}),H.disconnectAllTransports(),H.startConnect())}),mt("offline",function(){H.state==H.states.connected&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return X.initTransports=function(){(0,g.default)(X),l.arrForEach(m.default.Transports,function(_){_(X)})},X.prototype.createTransportParams=function(_,B){return new J(this.options,_,B,this.connectionKey)},X.prototype.getTransportParams=function(_){var B=this,H=function(j){if(B.connectionKey){j("resume");return}if(typeof B.options.recover=="string"){j("recover");return}var et=B.options.recover,ct=W();if(ct&&typeof et=="function"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),et(ct,function(mt){mt?(B.options.recover=ct.recoveryKey,j("recover")):j("clean")});return}j("clean")};H(function(j){var et=B.createTransportParams(null,j);if(j==="recover"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+B.options.recover);var ct=G(B.options.recover);ct&&(B.msgSerial=ct.msgSerial)}else h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+et.toString());_(et)})},X.prototype.tryATransport=function(_,B,H){var j=this;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+B),b.default.tryConnect(X.supportedTransports[B],this,this.realtime.auth,_,function(et,ct){var mt=j.state;if(mt==j.states.closing||mt==j.states.closed||mt==j.states.failed){ct&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+mt.state+" while we were attempting the transport; closing "+ct),ct.close()),H(!0);return}if(et){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+B+" "+et.event+", err: "+et.error.toString()),S.default.isTokenErr(et.error)&&!(j.errorReason&&S.default.isTokenErr(j.errorReason))?(j.errorReason=et.error,j.realtime.auth._forceNewToken(null,null,function(Et){if(Et){j.actOnErrorFromAuthorize(Et);return}j.tryATransport(_,B,H)})):et.event==="failed"?(j.notifyState({state:"failed",error:et.error}),H(!0)):et.event==="disconnected"&&((0,w.isRetriable)(et.error)?H(!1):(j.notifyState({state:j.states.connecting.failState,error:et.error}),H(!0)));return}h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+B+"; setting pending"),j.setTransportPending(ct,_),H(null,ct)})},X.prototype.setTransportPending=function(_,B){var H=this,j=B.mode;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+_+"; mode = "+j),l.arrDeleteValue(this.proposedTransports,_),this.pendingTransports.push(_);var et=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];_.once("connected",function(mt,Et,St){j=="upgrade"&&H.activeProtocol?_.shortName!==et&&l.arrIn(H.getUpgradePossibilities(),et)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(mt,_,Et,St)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(mt,_,Et,St):(H.activateTransport(mt,_,Et,St),m.default.Config.nextTick(function(){H.connectImpl(B)})),j==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var ct=this;_.on(["disconnected","closed","failed"],function(mt){ct.deactivateTransport(_,this.event,mt)}),this.emit("transport.pending",_)},X.prototype.scheduleTransportActivation=function(_,B,H,j){var et=this,ct=this.activeProtocol&&this.activeProtocol.getTransport(),mt=function(){B.disconnect(),l.arrDeleteValue(et.pendingTransports,B)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),mt();return}if(ct&&!L(B,ct)){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+" is no better than current active transport "+ct.shortName+" - abandoning upgrade"),mt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+B);var Et=null;if(!B.isConnected){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+"is no longer connected; abandoning upgrade"),mt();return}if(this.state===this.states.connected)h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Et=this.activeProtocol;else if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),mt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+B);var St=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+B),B.send(a.default.fromValues({action:v.ACTIVATE})),et.activateTransport(_,B,H,j),et.state===et.states.synchronizing?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+B),et.state=et.states.connected):h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+et.state.state+", so leaving unchanged"),et.state.sendEvents&&et.sendQueuedMessages()};Et?Et.onceIdle(St):St()},X.prototype.activateTransport=function(_,B,H,j){var et=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+B),_&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+_),H&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),j&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(B);var ct=this.state,mt=this.states.connected.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ct.state),ct.state==this.states.closing.state||ct.state==this.states.closed.state||ct.state==this.states.failed.state)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),B.disconnect(),!1;if(l.arrDeleteValue(this.pendingTransports,B),!B.isConnected)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+B+" since it appears to no longer be connected"),!1;var Et=this.activeProtocol;this.activeProtocol=new u.default(B),this.host=B.params.host;var St=j.connectionKey;if(St&&this.connectionKey!=St&&this.setConnection(H,j,!!_),this.onConnectionDetailsUpdate(j,B),m.default.Config.nextTick(function(){B.on("connected",function(ft,Zt,be){et.onConnectionDetailsUpdate(be,B),et.emit("update",new E.default(mt,mt,null,ft))})}),ct.state===this.states.connected.state?_&&(this.errorReason=this.realtime.connection.errorReason=_,this.emit("update",new E.default(mt,mt,null,_))):(this.notifyState({state:"connected",error:_}),this.errorReason=this.realtime.connection.errorReason=_||null),this.emit("transport.active",B),Et)if(Et.messageQueue.count()>0&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Et.transport.shortName+", new one is "+B.shortName+") finishing with "+Et.messageQueue.count()+" messages still pending"),Et.transport===B){var Wt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Wt)}else Et.finish();return l.safeArrForEach(this.pendingTransports,function(ft){if(ft===B){var Zt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Zt),l.arrDeleteValue(et.pendingTransports,B)}else ft.disconnect()}),l.safeArrForEach(this.proposedTransports,function(ft){ft===B?(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+B.shortName+"; stack = "+new Error().stack),l.arrDeleteValue(et.proposedTransports,B)):ft.dispose()}),!0},X.prototype.deactivateTransport=function(_,B,H){var j=this.activeProtocol,et=j&&j.getTransport()===_,ct=l.arrDeleteValue(this.pendingTransports,_),mt=l.arrDeleteValue(this.proposedTransports,_),Et=this.noTransportsScheduledForActivation();if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+_),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+B+(et?"; was active":ct?"; was pending":mt?"; was proposed":"")+(Et?"":"; another transport is scheduled for activation")),H&&H.message&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),et&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),m.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",_),et&&Et||et&&B==="failed"||B==="closed"||j===null&&ct&&this.pendingTransports.length===0){if(B==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:B,error:H,retryImmediately:!0});return}var St=B==="failed"&&S.default.isTokenErr(H)?"disconnected":B;this.notifyState({state:St,error:H});return}et&&B==="disconnected"&&this.state!==this.states.synchronizing&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},X.prototype.noTransportsScheduledForActivation=function(){return l.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(_){return!_.isConnected})},X.prototype.setConnection=function(_,B,H){var j=this.connectionId,et=j&&j!==_,ct=!j&&H;(et||ct)&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==_&&h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=_,this.realtime.connection.key=this.connectionKey=B.connectionKey},X.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},X.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},X.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var _=l.now()-this.lastActivity;_>this.connectionStateTtl+this.maxIdleInterval&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+_+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},X.prototype.persistConnection=function(){if(T()){var _=this.createRecoveryKey();_&&D({recoveryKey:_,disconnectedAt:l.now(),location:r.location,clientId:this.realtime.auth.clientId})}},X.prototype.unpersistConnection=function(){M()},X.prototype.getError=function(){return this.errorReason||this.getStateError()},X.prototype.getStateError=function(){var _,B;return(B=(_=w.default)[this.state.state])===null||B===void 0?void 0:B.call(_)},X.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},X.prototype.enactStateChange=function(_){var B=_.current==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(B,"Connection state",_.current+(_.reason?"; reason: "+_.reason:"")),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+_.current+"; reason = "+(_.reason&&_.reason.message));var H=this.state=this.states[_.current];_.reason&&(this.errorReason=_.reason,this.realtime.connection.errorReason=_.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",_)},X.prototype.startTransitionTimer=function(_){var B=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+_.state),this.transitionTimer&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){B.transitionTimer&&(B.transitionTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager "+_.state+" timer expired","requesting new state: "+_.failState),B.notifyState({state:_.failState}))},_.retryDelay)},X.prototype.cancelTransitionTimer=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},X.prototype.startSuspendTimer=function(){var _=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){_.suspendTimer&&(_.suspendTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),_.states.connecting.failState="suspended",_.notifyState({state:"suspended"}))},this.connectionStateTtl))},X.prototype.checkSuspendTimer=function(_){_!=="disconnected"&&_!=="suspended"&&_!=="connecting"&&this.cancelSuspendTimer()},X.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},X.prototype.startRetryTimer=function(_){var B=this;this.retryTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),B.retryTimer=null,B.requestState({state:"connecting"})},_)},X.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},X.prototype.notifyState=function(_){var B=this,H,j,et=_.state,ct=et==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||_.retryImmediately||this.state===this.states.connecting&&_.error&&S.default.isTokenErr(_.error)&&!(this.errorReason&&S.default.isTokenErr(this.errorReason)));if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+et+(ct?"; will retry connection immediately":"")),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_.state),(et==="suspended"||et==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var mt=this.states[_.state],Et=mt.retryDelay;mt.state==="disconnected"&&(this.disconnectedRetryCount++,Et=l.getRetryTime(mt.retryDelay,this.disconnectedRetryCount));var St=new E.default(this.state.state,mt.state,Et,_.error||((j=(H=w.default)[mt.state])===null||j===void 0?void 0:j.call(H)));if(ct){var Wt=function(){B.state===B.states.disconnected&&(B.lastAutoReconnectAttempt=l.now(),B.requestState({state:"connecting"}))},ft=this.lastAutoReconnectAttempt&&l.now()-this.lastAutoReconnectAttempt+1;ft&&ft<1e3?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ft+"ms ago, waiting another "+(1e3-ft)+"ms before trying again"),setTimeout(Wt,1e3-ft)):m.default.Config.nextTick(Wt)}else(et==="disconnected"||et==="suspended")&&this.startRetryTimer(Et);(et==="disconnected"&&!ct||et==="suspended"||mt.terminal)&&m.default.Config.nextTick(function(){B.disconnectAllTransports()}),et=="connected"&&!this.activeProtocol&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(St),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(et,St.reason),this.failQueuedMessages(St.reason))}},X.prototype.requestState=function(_){var B=this,H,j,et=_.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+et+"; current state: "+this.state.state),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(et),!(et=="connecting"&&this.state.state=="connected")&&!(et=="closing"&&this.state.state=="closed"))){var ct=this.states[et],mt=new E.default(this.state.state,ct.state,null,_.error||((j=(H=w.default)[ct.state])===null||j===void 0?void 0:j.call(H)));this.enactStateChange(mt),et=="connecting"&&m.default.Config.nextTick(function(){B.startConnect()}),et=="closing"&&this.closeImpl()}},X.prototype.startConnect=function(){var _=this;if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var B=this.realtime.auth,H=++this.connectCounter,j=function(){_.checkConnectionStateFreshness(),_.getTransportParams(function(ct){if(ct.mode==="recover"&&ct.options.recover){var mt=G(ct.options.recover);mt&&_.realtime.channels.recoverChannels(mt.channelSerials)}H===_.connectCounter&&_.connectImpl(ct,H)})};if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),B.method==="basic")j();else{var et=function(ct){H===_.connectCounter&&(ct?_.actOnErrorFromAuthorize(ct):j())};this.errorReason&&S.default.isTokenErr(this.errorReason)?B._forceNewToken(null,null,et):B._ensureValidAuthCredentials(!1,et)}},X.prototype.connectImpl=function(_,B){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(_):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(_,B):this.connectBase(_,B)},X.prototype.connectPreference=function(_,B){var H=this,j=this.getTransportPreference(),et=!1;l.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(_,B)),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var ct=setTimeout(function(){et=!0,H.state.state!==H.states.connected.state&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(_,B)},this.options.timeouts.preferenceConnectTimeout);_.host=this.httpHosts[0],this.tryATransport(_,j,function(mt,Et){clearTimeout(ct),et&&Et?(Et.off(),Et.disconnect(),l.arrDeleteValue(H.pendingTransports,Et)):!Et&&!mt&&(H.unpersistTransportPreference(),H.connectImpl(_,B))})},X.prototype.connectBase=function(_,B){var H=this,j=function(St){H.notifyState({state:H.states.connecting.failState,error:St})},et=this.httpHosts.slice(),ct=function(St,Wt){B===H.connectCounter&&!Wt&&!St&&Et()};h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var mt=et.shift();if(!mt){j(new x.default("Unable to connect (no available host)",80003,404));return}_.host=mt;var Et=function(){if(!et.length){j(new x.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){j(new x.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(St,Wt){if(B===H.connectCounter){if(St){j(St);return}if(!Wt){j(new x.default("Unable to connect (network unreachable)",80003,404));return}_.host=l.arrPopRandomElement(et),H.tryATransport(_,H.baseTransport,ct)}})};if(this.forceFallbackHost&&et.length){this.forceFallbackHost=!1,Et();return}this.tryATransport(_,this.baseTransport,ct)},X.prototype.getUpgradePossibilities=function(){var _=this.activeProtocol.getTransport().shortName,B=l.arrIndexOf(this.upgradeTransports,_);return this.upgradeTransports.slice(B+1)},X.prototype.upgradeIfNeeded=function(_){var B=this,H=this.getUpgradePossibilities();h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(H)),H.length&&l.arrForEach(H,function(j){var et=B.createTransportParams(_.host,"upgrade");B.tryATransport(et,j,I)})},X.prototype.closeImpl=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),l.safeArrForEach(this.pendingTransports,function(_){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+_),_&&_.close()}),l.safeArrForEach(this.proposedTransports,function(_){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+_),_&&_.dispose()}),this.activeProtocol&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},X.prototype.onAuthUpdated=function(_,B){var H=this,j;switch(this.state.state){case"connected":{if(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var et=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(et)})}var ct=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();ct&&ct.onAuthUpdated&&ct.onAuthUpdated(_);var mt=a.default.fromValues({action:v.AUTH,auth:{accessToken:_.token}});this.send(mt);var Et=function(){H.off(St),B(null,_)},St=function(ft){ft.current==="failed"&&(H.off(Et),H.off(St),B(ft.reason||H.getStateError()))};this.once("connectiondetails",Et),this.on("connectionstate",St);break}case"connecting":h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Wt=function(ft){switch(ft.current){case"connected":H.off(Wt),B(null,_);break;case"failed":case"closed":case"suspended":H.off(Wt),B(ft.reason||H.getStateError());break;default:break}};this.on("connectionstate",Wt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},X.prototype.disconnectAllTransports=function(_){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(_?" except the active transport":"")),this.connectCounter++,l.safeArrForEach(this.pendingTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+B),B&&B.disconnect()}),this.pendingTransports=[],l.safeArrForEach(this.proposedTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+B),B&&B.dispose()}),this.proposedTransports=[],this.activeProtocol&&!_&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},X.prototype.send=function(_,B,H){H=H||I;var j=this.state;if(j.sendEvents){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new u.PendingMessage(_,H));return}var et=B&&j.queueEvents||j.forceQueueEvents;if(!et){var ct="rejecting event, queueEvent was "+B+", state was "+j.state;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()",ct),H(this.errorReason||new x.default(ct,9e4,400));return}h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(_)),this.queue(_,H)},X.prototype.sendImpl=function(_){var B=_.message;_.ackRequired&&!_.sendAttempted&&(B.msgSerial=this.msgSerial++);try{this.activeProtocol.send(_)}catch(H){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},X.prototype.queue=function(_,B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),j=this.options.maxMessageSize;H&&!H.sendAttempted&&$(H.message,_,j)?(H.merged||(H.callback=P.default.create([H.callback]),H.merged=!0),H.callback.push(B)):this.queuedMessages.push(new u.PendingMessage(_,B))},X.prototype.sendQueuedMessages=function(){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var _;_=this.queuedMessages.shift();)this.sendImpl(_)},X.prototype.queuePendingMessages=function(_){_&&_.length&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+_.length+" pending messages"),this.queuedMessages.prepend(_))},X.prototype.failQueuedMessages=function(_){var B=this.queuedMessages.count();B>0&&(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+B+" queued messages, err = "+l.inspectError(_)),this.queuedMessages.completeAllMessages(_))},X.prototype.onChannelMessage=function(_,B){var H=this.activeProtocol&&B===this.activeProtocol.getTransport(),j=l.arrIn(this.pendingTransports,B)&&this.state==this.states.synchronizing;H||j?this.realtime.channels.onChannelMessage(_):l.arrIndexOf([v.ACK,v.NACK,v.ERROR],_.action)>-1?this.realtime.channels.onChannelMessage(_):h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(_)+"on defunct transport; discarding")},X.prototype.ping=function(_,B){var H=this;if(_){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+_);var j=function(){_.off("heartbeat",mt),B(new x.default("Timeout waiting for heartbeat response",5e4,500))},et=l.now(),ct=l.cheapRandStr(),mt=function(Zt){if(Zt===ct){_.off("heartbeat",mt),clearTimeout(Et);var be=l.now()-et;B(null,be)}},Et=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);_.on("heartbeat",mt),_.ping(ct);return}if(this.state.state!=="connected"){B(new x.default("Unable to ping service; not connected",4e4,400));return}var St=!1,Wt=function(Zt,be){H.off("transport.active",ft),St||(St=!0,B(Zt,be))},ft=function(){St||(St=!0,m.default.Config.nextTick(function(){H.ping(null,B)}))};this.on("transport.active",ft),this.ping(this.activeProtocol.getTransport(),Wt)},X.prototype.abort=function(_){this.activeProtocol.getTransport().fail(_)},X.prototype.registerProposedTransport=function(_){this.proposedTransports.push(_)},X.prototype.getTransportPreference=function(){var _,B;return this.transportPreference||p()&&((B=(_=m.default.WebStorage)===null||_===void 0?void 0:_.get)===null||B===void 0?void 0:B.call(_,U))},X.prototype.persistTransportPreference=function(_){var B,H;l.arrIn(d.default.upgradeTransports,_.shortName)&&(this.transportPreference=_.shortName,p()&&((H=(B=m.default.WebStorage)===null||B===void 0?void 0:B.set)===null||H===void 0||H.call(B,U,_.shortName)))},X.prototype.unpersistTransportPreference=function(){var _,B;this.transportPreference=null,p()&&((B=(_=m.default.WebStorage)===null||_===void 0?void 0:_.remove)===null||B===void 0||B.call(_,U))},X.prototype.actOnErrorFromAuthorize=function(_){if(_.code===40171)this.notifyState({state:"failed",error:_});else if(_.code===40102)this.notifyState({state:"failed",error:_});else if(_.statusCode===f.default.Forbidden){var B="Client configured authentication provider returned 403; failing the connection";h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",B),this.notifyState({state:"failed",error:new x.default(B,80019,403,_)})}else{var B="Client configured authentication provider request failed";h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",B),this.notifyState({state:this.state.failState,error:new x.default(B,80019,401,_)})}},X.prototype.onConnectionDetailsUpdate=function(_,B){if(!!_){this.connectionDetails=_,_.maxMessageSize&&(this.options.maxMessageSize=_.maxMessageSize);var H=_.clientId;if(H){var j=this.realtime.auth._uncheckedSetClientId(H);if(j){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),B.fail(j);return}}var et=_.connectionStateTtl;et&&(this.connectionStateTtl=et),this.maxIdleInterval=_.maxIdleInterval,this.emit("connectiondetails",_)}},X.supportedTransports={},X}(y.default);e.default=tt}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(7)),a=r.__importDefault(t(2)),l=function(u){r.__extends(d,u);function d(){var m=u.call(this)||this;return m.messages=[],m}return d.prototype.count=function(){return this.messages.length},d.prototype.push=function(m){this.messages.push(m)},d.prototype.shift=function(){return this.messages.shift()},d.prototype.last=function(){return this.messages[this.messages.length-1]},d.prototype.copyAll=function(){return this.messages.slice()},d.prototype.append=function(m){this.messages.push.apply(this.messages,m)},d.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},d.prototype.completeMessages=function(m,y,C){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+y),C=C||null;var h=this.messages;if(h.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=h[0];if(E){var w=E.message.msgSerial,x=m+y;if(x>w)for(var S=h.splice(0,x-w),O=0,P=S;O<P.length;O++){var g=P[O];g.callback(C)}h.length==0&&this.emit("idle")}},d.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},d.prototype.resetSendAttempted=function(){for(var m=0,y=this.messages;m<y.length;m++){var C=y[m];C.sendAttempted=!1}},d.prototype.clear=function(){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},d}(i.default);e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(a,l,u,d){this.previous=a,this.current=l,u&&(this.retryIn=u),d&&(this.reason=d)}return i}();e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(10)),a=r.__importDefault(t(7)),l=r.__importStar(t(1)),u=r.__importDefault(t(33)),d=r.__importDefault(t(2)),m=r.__importDefault(t(54)),y=r.__importDefault(t(9)),C=r.__importDefault(t(39)),h=r.__importStar(t(4)),E=r.__importDefault(t(15)),w=r.__importDefault(t(20)),x=i.default.Action,S=function(){};function O(g){if(g&&"params"in g&&!l.isObject(g.params))return new h.default("options.params must be an object",4e4,400);if(g&&"modes"in g){if(!l.isArray(g.modes))return new h.default("options.modes must be an array",4e4,400);for(var b=0;b<g.modes.length;b++){var f=g.modes[b];if(!f||typeof f!="string"||!l.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(f)))return new h.default("Invalid channel mode: "+f,4e4,400)}}}var P=function(g){r.__extends(b,g);function b(f,p,T){var v=g.call(this,f,p,T)||this;return v.retryCount=0,v.history=function(I,U){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),U===void 0)if(typeof I=="function")U=I,I=null;else{if(this.rest.options.promises)return l.promisify(this,"history",arguments);U=S}if(I&&I.untilAttach){if(this.state!=="attached"){U(new h.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){U(new h.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete I.untilAttach,I.from_serial=this.properties.attachSerial}u.default.prototype._history.call(this,I,U)},v.whenState=function(I,U){return a.default.prototype.whenState.call(v,I,v.state,U)},d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),v.realtime=f,v.presence=new m.default(v),v.connectionManager=f.connection.connectionManager,v.state="initialized",v.subscriptions=new a.default,v.syncChannelSerial=void 0,v.properties={attachSerial:void 0,channelSerial:void 0},v.setOptions(T),v.errorReason=null,v._requestedFlags=null,v._mode=null,v._attachResume=!1,v._decodingContext={channelOptions:v.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},v._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},v._allChannelChanges=new a.default,v}return b.prototype.invalidStateError=function(){return new h.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},b.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},b.prototype.setOptions=function(f,p){if(!p&&this.rest.options.promises)return l.promisify(this,"setOptions",arguments);var T=p||function(I){I&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+I.toString())},v=O(f);if(v){T(v);return}u.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(I){switch(this.event){case"update":case"attached":T==null||T(null);return;default:T==null||T(I.reason);return}})):T()},b.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&((f==null?void 0:f.params)||(f==null?void 0:f.modes))},b.prototype.publish=function(){for(var f=this,p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=p[0],I=p.length,U=p[I-1];if(typeof U!="function"){if(this.realtime.options.promises)return l.promisify(this,"publish",arguments);U=S,++I}if(!this.connectionManager.activeState()){U(this.connectionManager.getError());return}if(I==2)if(l.isObject(v))v=[y.default.fromValues(v)];else if(l.isArray(v))v=y.default.fromValuesArray(v);else throw new h.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else v=[y.default.fromValues({name:p[0],data:p[1]})];var z=this.realtime.options.maxMessageSize;y.default.encodeArray(v,this.channelOptions,function(W){if(W){U(W);return}var D=y.default.getMessagesSize(v);if(D>z){U(new h.default("Maximum size of messages that can be published at once exceeded ( was "+D+" bytes; limit is "+z+" bytes)",40009,400));return}f.__publish(v,U)})},b.prototype.__publish=function(f,p){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var T=this.state;switch(T){case"failed":case"suspended":p(h.default.fromValues(this.invalidStateError()));break;default:{d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+T);var v=new i.default;v.action=x.MESSAGE,v.channel=this.name,v.messages=f,this.sendMessage(v,p);break}}},b.prototype.onEvent=function(f){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,T=0;T<f.length;T++){var v=f[T];p.emit(v.name,v)}},b.prototype.attach=function(f,p){var T;if(typeof f=="function"?(p=f,T=null):T=f,!p){if(this.realtime.options.promises)return l.promisify(this,"attach",arguments);p=function(v){v&&d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+v.toString())}}if(T)d.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=T;else if(this.state==="attached"){p(null,null);return}this._attach(!1,null,p)},b.prototype._attach=function(f,p,T){T||(T=function(I){I&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+I.toString())});var v=this.connectionManager;if(!v.activeState()){T(v.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",p),this.once(function(I){switch(this.event){case"attached":T==null||T(null,I);break;case"detached":case"suspended":case"failed":T==null||T(I.reason||v.getError()||new h.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":T==null||T(new h.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},b.prototype.attachImpl=function(){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var f=i.default.fromValues({action:x.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(l.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,S)},b.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return l.promisify(this,"detach",arguments);f=S}var p=this.connectionManager;if(!p.activeState()){f(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new h.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(T){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(T.reason||p.getError()||new h.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new h.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},b.prototype.detachImpl=function(f){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var p=i.default.fromValues({action:x.DETACH,channel:this.name});this.sendMessage(p,f||S)},b.prototype.subscribe=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var T=b.processListenerArgs(f),v=T[0],I=T[1],U=T[2];if(!U&&this.realtime.options.promises)return l.promisify(this,"subscribe",[v,I]);if(this.state==="failed"){U==null||U(h.default.fromValues(this.invalidStateError()));return}return v&&typeof v=="object"&&!Array.isArray(v)?this._subscribeFilter(v,I):this.subscriptions.on(v,I),this.attach(U||S)},b.prototype._subscribeFilter=function(f,p){var T=function(v){var I,U,z,W,D,M,L={name:v.name,refTimeserial:(U=(I=v.extras)===null||I===void 0?void 0:I.ref)===null||U===void 0?void 0:U.timeserial,refType:(W=(z=v.extras)===null||z===void 0?void 0:z.ref)===null||W===void 0?void 0:W.type,isRef:!!(!((M=(D=v.extras)===null||D===void 0?void 0:D.ref)===null||M===void 0)&&M.timeserial),clientId:v.clientId};Object.entries(f).find(function($){var G=$[0],J=$[1];return J!==void 0?L[G]!==J:!1})||p(v)};this._addFilteredSubscription(f,p,T),this.subscriptions.on(T)},b.prototype._addFilteredSubscription=function(f,p,T){var v;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var I=this.filteredSubscriptions.get(p);I.set(f,((v=I==null?void 0:I.get(f))===null||v===void 0?void 0:v.concat(T))||[T])}else this.filteredSubscriptions.set(p,new Map([[f,[T]]]))},b.prototype._getAndDeleteFilteredSubscriptions=function(f,p){var T=this;if(!this.filteredSubscriptions)return[];if(!p&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(z){var W,D=z[0],M=z[1],L=M.get(f);return M.delete(f),M.size===0&&((W=T.filteredSubscriptions)===null||W===void 0||W.delete(D)),L}).reduce(function(z,W){var D;return W?(D=z).concat.apply(D,W):z},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var v=this.filteredSubscriptions.get(p);if(!f){var I=Array.from(v.values()).reduce(function(z,W){return z.concat.apply(z,W)},[]);return this.filteredSubscriptions.delete(p),I}var U=v.get(f);return v.delete(f),U||[]},b.prototype.unsubscribe=function(){for(var f=this,p,T=[],v=0;v<arguments.length;v++)T[v]=arguments[v];var I=b.processListenerArgs(T),U=I[0],z=I[1];if(typeof U=="object"&&!z||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(z))){this._getAndDeleteFilteredSubscriptions(U,z).forEach(function(W){return f.subscriptions.off(W)});return}this.subscriptions.off(U,z)},b.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new h.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var p=i.default.fromValues({action:x.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),f.send(p)},b.prototype.sendMessage=function(f,p){this.connectionManager.send(f,this.realtime.options.queueMessages,p)},b.prototype.sendPresence=function(f,p){var T=i.default.fromValues({action:x.PRESENCE,channel:this.name,presence:l.isArray(f)?E.default.fromValuesArray(f):[E.default.fromValues(f)]});this.sendMessage(T,p)},b.prototype.onMessage=function(f){(f.action===x.ATTACHED||f.action===x.MESSAGE||f.action===x.PRESENCE)&&this.setChannelSerial(f.channelSerial);var p,T=!1;switch(f.action){case x.ATTACHED:{this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var v=f.decodeModesFromFlags();this.modes=v&&l.allToLowerCase(v)||void 0;var I=f.hasFlag("RESUMED"),U=f.hasFlag("HAS_PRESENCE"),z=f.hasFlag("HAS_BACKLOG");if(this.state==="attached"){I||this.presence.onAttached(U);var W=new C.default(this.state,this.state,I,z,f.error);this._allChannelChanges.emit("update",W),(!I||this.channelOptions.updateOnAttached)&&this.emit("update",W)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,I,U,z);break}case x.DETACHED:{var D=f.error?h.default.fromValues(f.error):new h.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",D):this.state==="attaching"?this.notifyState("suspended",D):this.requestState("attaching",D);break}case x.SYNC:if(T=!0,p=this.syncChannelSerial=f.channelSerial,!f.presence)break;case x.PRESENCE:{for(var M=f.presence,L=f.id,$=f.connectionId,G=f.timestamp,J=this.channelOptions,tt=void 0,rt=0;rt<M.length;rt++)try{tt=M[rt],E.default.decode(tt,J),tt.connectionId||(tt.connectionId=$),tt.timestamp||(tt.timestamp=G),tt.id||(tt.id=L+":"+rt)}catch(et){d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",et.toString())}this.presence.setPresence(M,T,p);break}case x.MESSAGE:{if(this.state!=="attached"){d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var X=f.messages,_=X[0],B=X[X.length-1],L=f.id,$=f.connectionId,G=f.timestamp;if(_.extras&&_.extras.delta&&_.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new h.default(H,40018,400));break}for(var rt=0;rt<X.length;rt++){var H=X[rt];try{y.default.decode(H,this._decodingContext)}catch(Wt){switch(d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",Wt.toString()),Wt.code){case 40018:this._startDecodeFailureRecovery(Wt);return;case 40019:case 40021:this.notifyState("failed",Wt);return}}H.connectionId||(H.connectionId=$),H.timestamp||(H.timestamp=G),H.id||(H.id=L+":"+rt)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(X);break}case x.ERROR:{var j=f.error;j&&j.code==80016?this.checkPendingState():this.notifyState("failed",h.default.fromValues(j));break}default:d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(w.default.unknownChannelErr())}},b.prototype._startDecodeFailureRecovery=function(f){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},b.prototype.onAttached=function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},b.prototype.notifyState=function(f,p,T,v,I){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),l.arrIn(["detached","suspended","failed"],f)&&(this.properties.channelSerial=null),f!==this.state){this.presence.actOnChannelState(f,v,p),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var U=new C.default(this.state,f,T,I,p),z=f==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(z,'Channel state for channel "'+this.name+'"',f+(p?"; reason: "+p:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"&&this.onAttached(),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,U),this.emit(f,U)}},b.prototype.requestState=function(f,p){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,p),this.checkPendingState()},b.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},b.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new h.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new h.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},b.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},b.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},b.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var p=l.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},p)}},b.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},b.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new h.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},b.prototype.setChannelSerial=function(f){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+f+"; previous = "+this.properties.channelSerial),f&&(this.properties.channelSerial=f)},b}(u.default);e.default=P},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(a,l,u,d,m){this.previous=a,this.current=l,l==="attached"&&(this.resumed=u,this.hasBacklog=d),m&&(this.reason=m)}return i}();e.default=r},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=a.Hasher,d=i.algo,m=[],y=d.SHA1=u.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,h){for(var E=this._hash.words,w=E[0],x=E[1],S=E[2],O=E[3],P=E[4],g=0;g<80;g++){if(g<16)m[g]=C[h+g]|0;else{var b=m[g-3]^m[g-8]^m[g-14]^m[g-16];m[g]=b<<1|b>>>31}var f=(w<<5|w>>>27)+P+m[g];g<20?f+=(x&S|~x&O)+1518500249:g<40?f+=(x^S^O)+1859775393:g<60?f+=(x&S|x&O|S&O)-1894007588:f+=(x^S^O)-899497514,P=O,O=S,S=x<<30|x>>>2,x=w,w=f}E[0]=E[0]+w|0,E[1]=E[1]+x|0,E[2]=E[2]+S|0,E[3]=E[3]+O|0,E[4]=E[4]+P|0},_doFinalize:function(){var C=this._data,h=C.words,E=this._nDataBytes*8,w=C.sigBytes*8;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=Math.floor(E/4294967296),h[(w+64>>>9<<4)+15]=E,C.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var C=u.clone.call(this);return C._hash=this._hash.clone(),C}});i.SHA1=u._createHelper(y),i.HmacSHA1=u._createHmacHelper(y)}(),r.SHA1})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function r(g){if(g===void 0)return"undefined";var b,f;if(g instanceof ArrayBuffer?(f="ArrayBuffer",b=new DataView(g)):g instanceof DataView&&(f="DataView",b=g),!b)return JSON.stringify(g);for(var p=[],T=0;T<g.byteLength;T++){if(T>20){p.push("...");break}var v=b.getUint8(T).toString(16);v.length===1&&(v="0"+v),p.push(v)}return"<"+f+" "+p.join(" ")+">"}function i(g,b,f){for(var p=0,T=f.length;p<T;p++){var v=f.charCodeAt(p);if(v<128){g.setUint8(b++,v>>>0&127|0);continue}if(v<2048){g.setUint8(b++,v>>>6&31|192),g.setUint8(b++,v>>>0&63|128);continue}if(v<65536){g.setUint8(b++,v>>>12&15|224),g.setUint8(b++,v>>>6&63|128),g.setUint8(b++,v>>>0&63|128);continue}if(v<1114112){g.setUint8(b++,v>>>18&7|240),g.setUint8(b++,v>>>12&63|128),g.setUint8(b++,v>>>6&63|128),g.setUint8(b++,v>>>0&63|128);continue}throw new Error("bad codepoint "+v)}}function a(g,b,f){for(var p="",T=b,v=b+f;T<v;T++){var I=g.getUint8(T);if((I&128)===0){p+=String.fromCharCode(I);continue}if((I&224)===192){p+=String.fromCharCode((I&15)<<6|g.getUint8(++T)&63);continue}if((I&240)===224){p+=String.fromCharCode((I&15)<<12|(g.getUint8(++T)&63)<<6|(g.getUint8(++T)&63)<<0);continue}if((I&248)===240){p+=String.fromCharCode((I&7)<<18|(g.getUint8(++T)&63)<<12|(g.getUint8(++T)&63)<<6|(g.getUint8(++T)&63)<<0);continue}throw new Error("Invalid byte "+I.toString(16))}return p}function l(g){for(var b=0,f=0,p=g.length;f<p;f++){var T=g.charCodeAt(f);if(T<128){b+=1;continue}if(T<2048){b+=2;continue}if(T<65536){b+=3;continue}if(T<1114112){b+=4;continue}throw new Error("bad codepoint "+T)}return b}function u(g,b){var f=P(g,b);if(f!==0){var p=new ArrayBuffer(f),T=new DataView(p);return O(g,T,0,b),p}}var d=(1<<16)*(1<<16),m=1/d;function y(g,b){return b=b||0,g.getInt32(b)*d+g.getUint32(b+4)}function C(g,b){return b=b||0,g.getUint32(b)*d+g.getUint32(b+4)}function h(g,b,f){f<9223372036854776e3?(g.setInt32(b,Math.floor(f*m)),g.setInt32(b+4,f&-1)):(g.setUint32(b,2147483647),g.setUint32(b+4,2147483647))}function E(g,b,f){f<18446744073709552e3?(g.setUint32(b,Math.floor(f*m)),g.setInt32(b+4,f&-1)):(g.setUint32(b,4294967295),g.setUint32(b+4,4294967295))}var w=function(){function g(b,f){var p=this;this.map=function(T){for(var v={},I=0;I<T;I++){var U=p.parse();v[U]=p.parse()}return v},this.bin=function(T){var v=new ArrayBuffer(T);return new Uint8Array(v).set(new Uint8Array(p.view.buffer,p.offset,T),0),p.offset+=T,v},this.buf=this.bin,this.str=function(T){var v=a(p.view,p.offset,T);return p.offset+=T,v},this.array=function(T){for(var v=new Array(T),I=0;I<T;I++)v[I]=p.parse();return v},this.ext=function(T){return p.offset+=T,{type:p.view.getInt8(p.offset),data:p.buf(T)}},this.parse=function(){var T=p.view.getUint8(p.offset),v,I;if((T&128)===0)return p.offset++,T;if((T&240)===128)return I=T&15,p.offset++,p.map(I);if((T&240)===144)return I=T&15,p.offset++,p.array(I);if((T&224)===160)return I=T&31,p.offset++,p.str(I);if((T&224)===224)return v=p.view.getInt8(p.offset),p.offset++,v;switch(T){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(I);case 197:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(I);case 198:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(I);case 199:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(I);case 200:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(I);case 201:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(I);case 202:return v=p.view.getFloat32(p.offset+1),p.offset+=5,v;case 203:return v=p.view.getFloat64(p.offset+1),p.offset+=9,v;case 204:return v=p.view.getUint8(p.offset+1),p.offset+=2,v;case 205:return v=p.view.getUint16(p.offset+1),p.offset+=3,v;case 206:return v=p.view.getUint32(p.offset+1),p.offset+=5,v;case 207:return v=C(p.view,p.offset+1),p.offset+=9,v;case 208:return v=p.view.getInt8(p.offset+1),p.offset+=2,v;case 209:return v=p.view.getInt16(p.offset+1),p.offset+=3,v;case 210:return v=p.view.getInt32(p.offset+1),p.offset+=5,v;case 211:return v=y(p.view,p.offset+1),p.offset+=9,v;case 212:return I=1,p.offset++,p.ext(I);case 213:return I=2,p.offset++,p.ext(I);case 214:return I=4,p.offset++,p.ext(I);case 215:return I=8,p.offset++,p.ext(I);case 216:return I=16,p.offset++,p.ext(I);case 217:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.str(I);case 218:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.str(I);case 219:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.str(I);case 220:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.array(I);case 221:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.array(I);case 222:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.map(I);case 223:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.map(I)}throw new Error("Unknown type 0x"+T.toString(16))},this.offset=f||0,this.view=b}return g}();function x(g){var b=new DataView(g),f=new w(b),p=f.parse();if(f.offset!==g.byteLength)throw new Error(g.byteLength-f.offset+" trailing bytes");return p}function S(g,b){return Object.keys(g).filter(function(f){var p=g[f],T=typeof p;return(!b||p!=null)&&(T!=="function"||!!p.toJSON)})}function O(g,b,f,p){var T=typeof g;if(typeof g=="string"){var v=l(g);if(v<32)return b.setUint8(f,v|160),i(b,f+1,g),1+v;if(v<256)return b.setUint8(f,217),b.setUint8(f+1,v),i(b,f+2,g),2+v;if(v<65536)return b.setUint8(f,218),b.setUint16(f+1,v),i(b,f+3,g),3+v;if(v<4294967296)return b.setUint8(f,219),b.setUint32(f+1,v),i(b,f+5,g),5+v}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var I=g.byteLength;if(I<256)return b.setUint8(f,196),b.setUint8(f+1,I),new Uint8Array(b.buffer).set(new Uint8Array(g),f+2),2+I;if(I<65536)return b.setUint8(f,197),b.setUint16(f+1,I),new Uint8Array(b.buffer).set(new Uint8Array(g),f+3),3+I;if(I<4294967296)return b.setUint8(f,198),b.setUint32(f+1,I),new Uint8Array(b.buffer).set(new Uint8Array(g),f+5),5+I}if(typeof g=="number"){if(Math.floor(g)!==g)return b.setUint8(f,203),b.setFloat64(f+1,g),9;if(g>=0){if(g<128)return b.setUint8(f,g),1;if(g<256)return b.setUint8(f,204),b.setUint8(f+1,g),2;if(g<65536)return b.setUint8(f,205),b.setUint16(f+1,g),3;if(g<4294967296)return b.setUint8(f,206),b.setUint32(f+1,g),5;if(g<18446744073709552e3)return b.setUint8(f,207),E(b,f+1,g),9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return b.setInt8(f,g),1;if(g>=-128)return b.setUint8(f,208),b.setInt8(f+1,g),2;if(g>=-32768)return b.setUint8(f,209),b.setInt16(f+1,g),3;if(g>=-2147483648)return b.setUint8(f,210),b.setInt32(f+1,g),5;if(g>=-9223372036854776e3)return b.setUint8(f,211),h(b,f+1,g),9;throw new Error("Number too small -0x"+(-g).toString(16).substr(1))}if(T==="undefined")return p?0:(b.setUint8(f,212),b.setUint8(f+1,0),b.setUint8(f+2,0),3);if(g===null)return p?0:(b.setUint8(f,192),1);if(T==="boolean")return b.setUint8(f,g?195:194),1;if(typeof g.toJSON=="function")return O(g.toJSON(),b,f,p);if(T==="object"){var U,z=0,W=void 0,D=Array.isArray(g);if(D?U=g.length:(W=S(g,p),U=W.length),U<16?(b.setUint8(f,U|(D?144:128)),z=1):U<65536?(b.setUint8(f,D?220:222),b.setUint16(f+1,U),z=3):U<4294967296&&(b.setUint8(f,D?221:223),b.setUint32(f+1,U),z=5),D)for(var M=0;M<U;M++)z+=O(g[M],b,f+z,p);else if(W)for(var M=0;M<U;M++){var L=W[M];z+=O(L,b,f+z),z+=O(g[L],b,f+z,p)}return z}if(T==="function")return 0;throw new Error("Unknown type "+T)}function P(g,b){var f=typeof g;if(f==="string"){var p=l(g);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var T=g.byteLength;if(T<256)return 2+T;if(T<65536)return 3+T;if(T<4294967296)return 5+T}if(typeof g=="number"){if(Math.floor(g)!==g)return 9;if(g>=0){if(g<128)return 1;if(g<256)return 2;if(g<65536)return 3;if(g<4294967296)return 5;if(g<18446744073709552e3)return 9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return 1;if(g>=-128)return 2;if(g>=-32768)return 3;if(g>=-2147483648)return 5;if(g>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+g.toString(16).substr(1))}if(f==="boolean")return 1;if(g===null)return b?0:1;if(g===void 0)return b?0:3;if(typeof g.toJSON=="function")return P(g.toJSON(),b);if(f==="object"){var v,I=0;if(Array.isArray(g)){v=g.length;for(var U=0;U<v;U++)I+=P(g[U],b)}else{var z=S(g,b);v=z.length;for(var U=0;U<v;U++){var W=z[U];I+=P(W)+P(g[W],b)}}if(v<16)return 1+I;if(v<65536)return 3+I;if(v<4294967296)return 5+I;throw new Error("Array or object too long 0x"+v.toString(16))}if(f==="function")return 0;throw new Error("Unknown type "+f)}e.default={encode:u,decode:x,inspect:r,utf8Write:i,utf8Read:a,utf8ByteCount:l}},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(30)),a=r.__importDefault(t(50)),l=r.__importDefault(t(3)),u=r.__importDefault(t(4)),d=r.__importDefault(t(55)),m=r.__importDefault(t(57)),y=r.__importDefault(t(62)),C=r.__importDefault(t(64)),h=r.__importDefault(t(68)),E=r.__importDefault(t(2)),w=t(8),x=r.__importDefault(t(65)),S=r.__importDefault(t(66)),O=r.__importDefault(t(41)),P=(0,m.default)(C.default,d.default);l.default.Crypto=P,l.default.BufferUtils=d.default,l.default.Http=y.default,l.default.Config=C.default,l.default.Transports=h.default,l.default.WebStorage=x.default,i.default.Crypto=P,a.default.Crypto=P,E.default.initLogHandlers(),l.default.Defaults=(0,w.getDefaults)(S.default),l.default.Config.agent&&(l.default.Defaults.agent+=" "+l.default.Config.agent),l.default.Config.noUpgrade&&(l.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:u.default,Rest:i.default,Realtime:a.default,msgpack:O.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(s,e){},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(32),t(24))})(this,function(r){return r.HmacSHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(47)),l=r.__importDefault(t(14)),u=r.__importDefault(t(19)),d=r.__importDefault(t(4)),m=r.__importDefault(t(48)),y=function(){},C=function(){function x(S){this.rest=S,this.admin=new h(S)}return x}(),h=function(){function x(S){this.rest=S,this.deviceRegistrations=new E(S),this.channelSubscriptions=new w(S)}return x.prototype.publish=function(S,O,P){var g=this.rest,b=g.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(g.options,b),p={},T=i.mixin({recipient:S},O);if(typeof P!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);P=y}g.options.headers&&i.mixin(f,g.options.headers),g.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var v=i.encodeBody(T,b);l.default.post(g,"/push/publish",v,f,p,null,function(I){return P(I)})},x}(),E=function(){function x(S){this.rest=S}return x.prototype.save=function(S,O){var P=this.rest,g=a.default.fromValues(S),b=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(P.options,b),p={};if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);O=y}P.options.headers&&i.mixin(f,P.options.headers),P.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var T=i.encodeBody(g,b);l.default.put(P,"/push/deviceRegistrations/"+encodeURIComponent(S.id),T,f,p,null,function(v,I,U,z){O(v,v?void 0:a.default.fromResponseBody(I,z?void 0:b))})},x.prototype.get=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=i.defaultGetHeaders(P.options,g),f=S.id||S;if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);O=y}if(typeof f!="string"||!f.length){O(new d.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}P.options.headers&&i.mixin(b,P.options.headers),l.default.get(P,"/push/deviceRegistrations/"+encodeURIComponent(f),b,{},null,function(p,T,v,I){O(p,p?void 0:a.default.fromResponseBody(T,I?void 0:g))})},x.prototype.list=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.rest.http.supportsLinkHeaders?void 0:g,f=i.defaultGetHeaders(P.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);O=y}P.options.headers&&i.mixin(f,P.options.headers),new u.default(P,"/push/deviceRegistrations",f,b,function(p,T,v){return a.default.fromResponseBody(p,v?void 0:g)}).get(S,O)},x.prototype.remove=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=i.defaultGetHeaders(P.options,g),f={},p=S.id||S;if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);O=y}if(typeof p!="string"||!p.length){O(new d.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}P.options.headers&&i.mixin(b,P.options.headers),P.options.pushFullWait&&i.mixin(f,{fullWait:"true"}),l.default.delete(P,"/push/deviceRegistrations/"+encodeURIComponent(p),b,f,null,function(T){return O(T)})},x.prototype.removeWhere=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=i.defaultGetHeaders(P.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);O=y}P.options.headers&&i.mixin(b,P.options.headers),P.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),l.default.delete(P,"/push/deviceRegistrations",b,S,null,function(f){return O(f)})},x}(),w=function(){function x(S){this.remove=x.prototype.removeWhere,this.rest=S}return x.prototype.save=function(S,O){var P=this.rest,g=m.default.fromValues(S),b=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(P.options,b),p={};if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);O=y}P.options.headers&&i.mixin(f,P.options.headers),P.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var T=i.encodeBody(g,b);l.default.post(P,"/push/channelSubscriptions",T,f,p,null,function(v,I,U,z){O(v,!v&&m.default.fromResponseBody(I,z?void 0:b))})},x.prototype.list=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.rest.http.supportsLinkHeaders?void 0:g,f=i.defaultGetHeaders(P.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);O=y}P.options.headers&&i.mixin(f,P.options.headers),new u.default(P,"/push/channelSubscriptions",f,b,function(p,T,v){return m.default.fromResponseBody(p,v?void 0:g)}).get(S,O)},x.prototype.removeWhere=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=i.defaultGetHeaders(P.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);O=y}P.options.headers&&i.mixin(b,P.options.headers),P.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),l.default.delete(P,"/push/channelSubscriptions",b,S,null,function(f){return O(f)})},x.prototype.listChannels=function(S,O){var P=this.rest,g=P.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,b=this.rest.http.supportsLinkHeaders?void 0:g,f=i.defaultGetHeaders(P.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);O=y}P.options.headers&&i.mixin(f,P.options.headers),P.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),new u.default(P,"/push/channels",f,b,function(p,T,v){for(var I=!v&&g?i.decodeBody(p,g):p,U=0;U<I.length;U++)I[U]=String(I[U]);return I}).get(S,O)},x}();e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(4)),l;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(l||(l={}));var u;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(u||(u={}));var d=function(){function m(){}return m.prototype.toJSON=function(){var y,C,h;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(y=this.push)===null||y===void 0?void 0:y.recipient,state:(C=this.push)===null||C===void 0?void 0:C.state,error:(h=this.push)===null||h===void 0?void 0:h.error}}},m.prototype.toString=function(){var y,C,h,E,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((y=this.push)===null||y===void 0)&&y.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((C=this.push)===null||C===void 0)&&C.state&&(w+="; push.state="+this.push.state),!((h=this.push)===null||h===void 0)&&h.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},m.fromResponseBody=function(y,C){return C&&(y=i.decodeBody(y,C)),i.isArray(y)?m.fromValuesArray(y):m.fromValues(y)},m.fromValues=function(y){return y.error=y.error&&a.default.fromValues(y.error),Object.assign(new m,y)},m.fromValuesArray=function(y){for(var C=y.length,h=new Array(C),E=0;E<C;E++)h[E]=m.fromValues(y[E]);return h},m.toRequestBody=i.encodeBody,m}();e.default=d},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=function(){function l(){}return l.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},l.prototype.toString=function(){var u="[PushChannelSubscription";return this.channel&&(u+="; channel="+this.channel),this.deviceId&&(u+="; deviceId="+this.deviceId),this.clientId&&(u+="; clientId="+this.clientId),u+="]",u},l.fromResponseBody=function(u,d){return d&&(u=i.decodeBody(u,d)),i.isArray(u)?l.fromValuesArray(u):l.fromValues(u)},l.fromValues=function(u){return Object.assign(new l,u)},l.fromValuesArray=function(u){for(var d=u.length,m=new Array(d),y=0;y<d;y++)m[y]=l.fromValues(u[y]);return m},l.toRequestBody=i.encodeBody,l}();e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=function(){function P(g){this.count=g&&g.count||0,this.data=g&&g.data||0,this.uncompressedData=g&&g.uncompressedData||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return P}(),l=function(P){r.__extends(g,P);function g(b){var f=P.call(this,b)||this;return b&&b.category&&(f.category={},i.forInOwnNonNullProperties(b.category,function(p){f.category[p]=new a(b.category[p])})),f}return g}(a),u=function(){function P(g){this.peak=g&&g.peak||0,this.min=g&&g.min||0,this.mean=g&&g.mean||0,this.opened=g&&g.opened||0,this.refused=g&&g.refused||0}return P}(),d=function(){function P(g){this.succeeded=g&&g.succeeded||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return P}(),m=function(){function P(g){this.plain=new u(g&&g.plain),this.tls=new u(g&&g.tls),this.all=new u(g&&g.all)}return P}(),y=function(){function P(g){this.messages=new l(g&&g.messages),this.presence=new l(g&&g.presence),this.all=new l(g&&g.all)}return P}(),C=function(){function P(g){this.realtime=new y(g&&g.realtime),this.rest=new y(g&&g.rest),this.webhook=new y(g&&g.webhook),this.sharedQueue=new y(g&&g.sharedQueue),this.externalQueue=new y(g&&g.externalQueue),this.httpEvent=new y(g&&g.httpEvent),this.push=new y(g&&g.push),this.all=new y(g&&g.all)}return P}(),h=function(){function P(g){this.all=new y(g&&g.all),this.inbound=new C(g&&g.inbound),this.outbound=new C(g&&g.outbound)}return P}(),E=function(){function P(g){this.all=new y(g&&g.all),this.producerPaid=new h(g&&g.producerPaid),this.consumerPaid=new h(g&&g.consumerPaid)}return P}(),w=function(){function P(g){this.messages=g&&g.messages||0;var b=g&&g.notifications;this.notifications={invalid:b&&b.invalid||0,attempted:b&&b.attempted||0,successful:b&&b.successful||0,failed:b&&b.failed||0},this.directPublishes=g&&g.directPublishes||0}return P}(),x=function(){function P(g){this.succeeded=g&&g.succeeded||0,this.skipped=g&&g.skipped||0,this.failed=g&&g.failed||0}return P}(),S=function(){function P(g){var b=this;this.delta=void 0,g&&g.delta&&(this.delta={},i.forInOwnNonNullProperties(g.delta,function(f){b.delta[f]=new x(g.delta[f])}))}return P}(),O=function(P){r.__extends(g,P);function g(b){var f=P.call(this,b)||this;return f.persisted=new y(b&&b.persisted),f.connections=new m(b&&b.connections),f.channels=new u(b&&b.channels),f.apiRequests=new d(b&&b.apiRequests),f.tokenRequests=new d(b&&b.tokenRequests),f.xchgProducer=new E(b&&b.xchgProducer),f.xchgConsumer=new E(b&&b.xchgConsumer),f.push=new w(b&&b.pushStats),f.processed=new S(b&&b.processed),f.inProgress=b&&b.inProgress||void 0,f.unit=b&&b.unit||void 0,f.intervalId=b&&b.intervalId||void 0,f}return g.fromValues=function(b){return new g(b)},g}(h);e.default=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(30)),l=r.__importDefault(t(7)),u=r.__importDefault(t(2)),d=r.__importDefault(t(51)),m=r.__importDefault(t(38)),y=r.__importDefault(t(8)),C=r.__importDefault(t(4)),h=r.__importDefault(t(10)),E=r.__importDefault(t(35)),w=r.__importDefault(t(3)),x=r.__importDefault(t(9)),S=function(P){r.__extends(g,P);function g(b){var f=P.call(this,b)||this;return u.default.logAction(u.default.LOG_MINOR,"Realtime()",""),f.connection=new d.default(f,f.options),f.channels=new O(f),b.autoConnect!==!1&&f.connect(),f}return g.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},g.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},g.Promise=function(b){return b=y.default.objectifyOptions(b),b.promises=!0,new g(b)},g.Callbacks=g,g.Utils=i,g.ConnectionManager=E.default,g.Platform=w.default,g.ProtocolMessage=h.default,g.Message=x.default,g}(a.default),O=function(P){r.__extends(g,P);function g(b){var f=P.call(this)||this;return f.realtime=b,f.all=Object.create(null),b.connection.connectionManager.on("transport.active",function(){f.onTransportActive()}),f}return g.prototype.channelSerials=function(){for(var b={},f=0,p=i.keysArray(this.all,!0);f<p.length;f++){var T=p[f],v=this.all[T];v.properties.channelSerial&&(b[T]=v.properties.channelSerial)}return b},g.prototype.recoverChannels=function(b){for(var f=0,p=i.keysArray(b,!0);f<p.length;f++){var T=p[f],v=this.get(T);v.properties.channelSerial=b[T]}},g.prototype.onChannelMessage=function(b){var f=b.channel;if(f===void 0){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+b.action);return}var p=this.all[f];if(!p){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+f);return}p.onMessage(b)},g.prototype.onTransportActive=function(){for(var b in this.all){var f=this.all[b];f.state==="attaching"||f.state==="detaching"?f.checkPendingState():f.state==="suspended"?f._attach(!1,null):f.state==="attached"&&f.requestState("attaching")}},g.prototype.propogateConnectionInterruption=function(b,f){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},T=["attaching","attached","detaching","suspended"],v=p[b];for(var I in this.all){var U=this.all[I];i.arrIn(T,U.state)&&U.notifyState(v,f)}},g.prototype.get=function(b,f){b=String(b);var p=this.all[b];if(!p)p=this.all[b]=new m.default(this.realtime,b,f);else if(f){if(p._shouldReattachToSetOptions(f))throw new C.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(f)}return p},g.prototype.getDerived=function(b,f,p){if(f.filter){var T=i.toBase64(f.filter),v=i.matchDerivedChannel(b);b="[filter=".concat(T).concat(v.qualifierParam,"]").concat(v.channelName)}return this.get(b,p)},g.prototype.release=function(b){b=String(b);var f=this.all[b];if(!!f){var p=f.getReleaseErr();if(p)throw p;delete this.all[b]}},g}(l.default);e.default=S},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),l=r.__importDefault(t(35)),u=r.__importDefault(t(2)),d=r.__importDefault(t(37)),m=r.__importDefault(t(3));function y(){}var C=function(h){r.__extends(E,h);function E(w,x){var S=h.call(this)||this;return S.whenState=function(O,P){return a.default.prototype.whenState.call(S,O,S.state,P,new d.default(void 0,O))},S.ably=w,S.connectionManager=new l.default(w,x),S.state=S.connectionManager.state.state,S.key=void 0,S.id=void 0,S.errorReason=null,S.connectionManager.on("connectionstate",function(O){var P=S.state=O.current;m.default.Config.nextTick(function(){S.emit(P,O)})}),S.connectionManager.on("update",function(O){m.default.Config.nextTick(function(){S.emit("update",O)})}),S}return E.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(w){if(u.default.logAction(u.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);w=y}this.connectionManager.ping(null,w)},E.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(E.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),E.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},E}(a.default);e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var r=t(0),i=r.__importDefault(t(10)),a=r.__importStar(t(1)),l=r.__importDefault(t(7)),u=r.__importDefault(t(2)),d=r.__importDefault(t(36)),m=r.__importDefault(t(4)),y=i.default.Action,C=function(){function E(w,x){this.message=w,this.callback=x,this.merged=!1;var S=w.action;this.sendAttempted=!1,this.ackRequired=S==y.MESSAGE||S==y.PRESENCE}return E}();e.PendingMessage=C;var h=function(E){r.__extends(w,E);function w(x){var S=E.call(this)||this;return S.transport=x,S.messageQueue=new d.default,x.on("ack",function(O,P){S.onAck(O,P)}),x.on("nack",function(O,P,g){S.onNack(O,P,g)}),S}return w.prototype.onAck=function(x,S){u.default.logAction(u.default.LOG_MICRO,"Protocol.onAck()","serial = "+x+"; count = "+S),this.messageQueue.completeMessages(x,S)},w.prototype.onNack=function(x,S,O){u.default.logAction(u.default.LOG_ERROR,"Protocol.onNack()","serial = "+x+"; count = "+S+"; err = "+a.inspectError(O)),O||(O=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(x,S,O)},w.prototype.onceIdle=function(x){var S=this.messageQueue;if(S.count()===0){x();return}S.once("idle",x)},w.prototype.send=function(x){x.ackRequired&&this.messageQueue.push(x),u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(x.message)),x.sendAttempted=!0,this.transport.send(x.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var x=this.transport;this.onceIdle(function(){x.disconnect()})},w}(l.default);e.default=h},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),l=r.__importDefault(t(26)),u=r.__importDefault(t(8)),d=r.__importDefault(t(2)),m=r.__importDefault(t(10)),y=r.__importDefault(t(4)),C="web_socket";function h(x){return!!x.on}var E=function(x){r.__extends(S,x);function S(O,P,g){var b=x.call(this,O,P,g)||this;return b.shortName=C,g.heartbeats=i.default.Config.useProtocolHeartbeats,b.wsHost=u.default.getHost(g.options,g.host,!0),b}return S.isAvailable=function(){return!!i.default.Config.WebSocket},S.prototype.createWebSocket=function(O,P){return this.uri=O+a.toQueryString(P),new i.default.Config.WebSocket(this.uri)},S.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},S.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),l.default.prototype.connect.call(this);var O=this,P=this.params,g=P.options,b=g.tls?"wss://":"ws://",f=b+this.wsHost+":"+u.default.getPort(g)+"/";d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+f),this.auth.getAuthParams(function(p,T){if(!O.isDisposed){var v="";for(var I in T)v+=" "+I+": "+T[I]+";";if(d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+v+" err: "+p),p){O.disconnect(p);return}var U=P.getConnectParams(T);try{var z=O.wsConnection=O.createWebSocket(f,U);z.binaryType=i.default.Config.binaryType,z.onopen=function(){O.onWsOpen()},z.onclose=function(W){O.onWsClose(W)},z.onmessage=function(W){O.onWsData(W.data)},z.onerror=function(W){O.onWsError(W)},h(z)&&z.on("ping",function(){O.onActivity()})}catch(W){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(W.stack||W.message)),O.disconnect(W)}}})},S.prototype.send=function(O){var P=this.wsConnection;if(!P){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{P.send(m.default.serialize(O,this.params.format))}catch(b){var g="Exception from ws connection when trying to send: "+a.inspectError(b);d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()",g),this.finish("disconnected",new y.default(g,5e4,500))}},S.prototype.onWsData=function(O){d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+O.length+"; type = "+typeof O);try{this.onProtocolMessage(m.default.deserialize(O,this.format))}catch(P){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+P.stack)}},S.prototype.onWsOpen=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},S.prototype.onWsClose=function(O){var P,g;if(typeof O=="object"?(g=O.code,P=O.wasClean||g===1e3):(g=O,P=g==1e3),delete this.wsConnection,P){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var b=new y.default("Websocket closed",80003,400);this.finish("disconnected",b)}else{var f="Unclean disconnection of WebSocket ; code = "+g,b=new y.default(f,80003,400);d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()",f),this.finish("disconnected",b)}this.emit("disposed")},S.prototype.onWsError=function(O){var P=this;d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+O.message),i.default.Config.nextTick(function(){P.disconnect(Error(O.message))})},S.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var O=this.wsConnection;O&&(O.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!O)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");O.close()}))},S}(l.default);function w(x){return E.isAvailable()&&(x.supportedTransports[C]=E),E}e.default=w},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(34)),l=r.__importDefault(t(7)),u=r.__importDefault(t(2)),d=r.__importDefault(t(15)),m=r.__importStar(t(4)),y=r.__importDefault(t(38)),C=r.__importDefault(t(23)),h=r.__importDefault(t(39)),E=function(){};function w(b){return b.channel.realtime.auth.clientId}function x(b){var f=b.channel.realtime,p=f.auth.clientId;return(!p||p==="*")&&f.connection.state==="connected"}function S(b,f,p){switch(b.state){case"attached":case"suspended":p();break;case"initialized":case"detached":case"detaching":case"attaching":b.attach(function(T){T?f(T):p()});break;default:f(m.default.fromValues(b.invalidStateError()))}}function O(b,f){if(b.isSynthesized()||f.isSynthesized())return b.timestamp>=f.timestamp;var p=b.parseId(),T=f.parseId();return p.msgSerial===T.msgSerial?p.index>T.index:p.msgSerial>T.msgSerial}var P=function(b){r.__extends(f,b);function f(p){var T=b.call(this,p)||this;return T.channel=p,T.syncComplete=!1,T.members=new g(T,function(v){return v.clientId+":"+v.connectionId}),T._myMembers=new g(T,function(v){return v.clientId}),T.subscriptions=new l.default,T.pendingPresence=[],T}return f.prototype.enter=function(p,T){if(x(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"enter",T)},f.prototype.update=function(p,T){if(x(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"update",T)},f.prototype.enterClient=function(p,T,v){return this._enterOrUpdateClient(void 0,p,T,"enter",v)},f.prototype.updateClient=function(p,T,v){return this._enterOrUpdateClient(void 0,p,T,"update",v)},f.prototype._enterOrUpdateClient=function(p,T,v,I,U){var z=this;if(!U)if(typeof v=="function")U=v,v=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[p,T,v,I]);U=E}var W=this.channel;if(!W.connectionManager.activeState()){U(W.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence."+I+"Client()","channel = "+W.name+", id = "+p+", client = "+(T||"(implicit) "+w(this)));var D=d.default.fromData(v);D.action=I,p&&(D.id=p),T&&(D.clientId=T),d.default.encode(D,W.channelOptions,function(M){if(M){U(M);return}switch(W.state){case"attached":W.sendPresence(D,U);break;case"initialized":case"detached":W.attach();case"attaching":z.pendingPresence.push({presence:D,callback:U});break;default:M=new m.PartialErrorInfo("Unable to "+I+" presence channel while in "+W.state+" state",90001),M.code=90001,U(M)}})},f.prototype.leave=function(p,T){if(x(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,p,T)},f.prototype.leaveClient=function(p,T,v){if(!v)if(typeof T=="function")v=T,T=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[p,T]);v=E}var I=this.channel;if(!I.connectionManager.activeState()){v==null||v(I.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+p);var U=d.default.fromValues({action:"leave",data:T});switch(p&&(U.clientId=p),I.state){case"attached":I.sendPresence(U,v);break;case"attaching":this.pendingPresence.push({presence:U,callback:v});break;case"initialized":case"failed":{var z=new m.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);v==null||v(z);break}default:v==null||v(I.invalidStateError())}},f.prototype.get=function(p,T){var v=this,I=Array.prototype.slice.call(arguments);I.length==1&&typeof I[0]=="function"&&I.unshift(null),p=I[0],T=I[1];var U=!p||("waitForSync"in p?p.waitForSync:!0);if(!T){if(this.channel.realtime.options.promises)return i.promisify(this,"get",I);T=E}function z(W){T(null,p?W.list(p):W.values())}if(this.channel.state==="suspended"){U?T(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):z(this.members);return}S(this.channel,T,function(){var W=v.members;U?W.waitSync(function(){z(W)}):z(W)})},f.prototype.history=function(p,T){if(u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),T===void 0)if(typeof p=="function")T=p,p=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);T=E}p&&p.untilAttach&&(this.channel.state==="attached"?(delete p.untilAttach,p.from_serial=this.channel.properties.attachSerial):T(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),a.default.prototype._history.call(this,p,T)},f.prototype.setPresence=function(p,T,v){u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+p.length+" participants; syncChannelSerial = "+v);var I,U,z=this.members,W=this._myMembers,D=[],M=this.channel.connectionManager.connectionId;T&&(this.members.startSync(),v&&(U=v.match(/^[\w-]+:(.*)$/))&&(I=U[1]));for(var L=0;L<p.length;L++){var $=d.default.fromValues(p[L]);switch($.action){case"leave":z.remove($)&&D.push($),$.connectionId===M&&!$.isSynthesized()&&W.remove($);break;case"enter":case"present":case"update":z.put($)&&D.push($),$.connectionId===M&&W.put($);break}}T&&!I&&(z.endSync(),this.channel.syncChannelSerial=null);for(var L=0;L<D.length;L++){var $=D[L];this.subscriptions.emit($.action,$)}},f.prototype.onAttached=function(p){u.default.logAction(u.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+p),p?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var T=this.pendingPresence,v=T.length;if(v){this.pendingPresence=[];var I=[],U=C.default.create();u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+v+" queued presence messages");for(var z=0;z<v;z++){var W=T[z];I.push(W.presence),U.push(W.callback)}this.channel.sendPresence(I,U)}},f.prototype.actOnChannelState=function(p,T,v){switch(p){case"attached":this.onAttached(T);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(v);break}},f.prototype.failPendingPresence=function(p){if(this.pendingPresence.length){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(p));for(var T=0;T<this.pendingPresence.length;T++)try{this.pendingPresence[T].callback(p)}catch(v){}this.pendingPresence=[]}},f.prototype._clearMyMembers=function(){this._myMembers.clear()},f.prototype._ensureMyMembersPresent=function(){var p=this,T=this._myMembers,v=function(z){if(z){var W="Presence auto-re-enter failed: "+z.toString(),D=new m.default(W,91004,400);u.default.logAction(u.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",W);var M=new h.default(p.channel.state,p.channel.state,!0,!1,D);p.channel.emit("update",M)}};for(var I in T.map){var U=T.map[I];u.default.logAction(u.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+U.clientId+'" into the presence set'),this._enterOrUpdateClient(U.id,U.clientId,U.data,"enter",v)}},f.prototype._synthesizeLeaves=function(p){var T=this.subscriptions;i.arrForEach(p,function(v){var I=d.default.fromValues({action:"leave",connectionId:v.connectionId,clientId:v.clientId,data:v.data,encoding:v.encoding,timestamp:i.now()});T.emit("leave",I)})},f.prototype.on=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];u.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,p)},f.prototype.off=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];u.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,p)},f.prototype.subscribe=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=y.default.processListenerArgs(p),I=v[0],U=v[1],z=v[2],W=this.channel;if(!z){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[I,U]);z=E}if(W.state==="failed"){z(m.default.fromValues(W.invalidStateError()));return}this.subscriptions.on(I,U),W.attach(z)},f.prototype.unsubscribe=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=y.default.processListenerArgs(p),I=v[0],U=v[1];this.subscriptions.off(I,U)},f}(a.default),g=function(b){r.__extends(f,b);function f(p,T){var v=b.call(this)||this;return v.presence=p,v.map=Object.create(null),v.syncInProgress=!1,v.residualMembers=null,v.memberKey=T,v}return f.prototype.get=function(p){return this.map[p]},f.prototype.getClient=function(p){var T=this.map,v=[];for(var I in T){var U=T[I];U.clientId==p&&U.action!="absent"&&v.push(U)}return v},f.prototype.list=function(p){var T=this.map,v=p&&p.clientId,I=p&&p.connectionId,U=[];for(var z in T){var W=T[z];W.action!=="absent"&&(v&&v!=W.clientId||I&&I!=W.connectionId||U.push(W))}return U},f.prototype.put=function(p){(p.action==="enter"||p.action==="update")&&(p=d.default.fromValues(p),p.action="present");var T=this.map,v=this.memberKey(p);this.residualMembers&&delete this.residualMembers[v];var I=T[v];return I&&!O(p,I)?!1:(T[v]=p,!0)},f.prototype.values=function(){var p=this.map,T=[];for(var v in p){var I=p[v];I.action!="absent"&&T.push(I)}return T},f.prototype.remove=function(p){var T=this.map,v=this.memberKey(p),I=T[v];return I&&!O(p,I)?!1:(this.syncInProgress?(p=d.default.fromValues(p),p.action="absent",T[v]=p):delete T[v],!0)},f.prototype.startSync=function(){var p=this.map,T=this.syncInProgress;u.default.logAction(u.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),this.syncInProgress||(this.residualMembers=i.copy(p),this.setInProgress(!0))},f.prototype.endSync=function(){var p=this.map,T=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),T){for(var v in p){var I=p[v];I.action==="absent"&&delete p[v]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var v in this.residualMembers)delete p[v];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},f.prototype.waitSync=function(p){var T=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),!T){p();return}this.once("sync",p)},f.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},f.prototype.setInProgress=function(p){u.default.logAction(u.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+p),this.syncInProgress=p,this.presence.syncComplete=!p},f}(l.default);e.default=P},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=t(56),a=t(31),l=t(11),u=r.__importDefault(t(5)),d=r.__importDefault(t(3)),m=function(){function y(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return y.prototype.isWordArray=function(C){return C!=null&&C.sigBytes!==void 0},y.prototype.isArrayBuffer=function(C){return C!=null&&C.constructor===ArrayBuffer},y.prototype.isTypedArray=function(C){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C)},y.prototype.uint8ViewToBase64=function(C){for(var h="",E=this.base64CharSet,w=C.byteLength,x=w%3,S=w-x,O,P,g,b,f,p=0;p<S;p=p+3)f=C[p]<<16|C[p+1]<<8|C[p+2],O=(f&16515072)>>18,P=(f&258048)>>12,g=(f&4032)>>6,b=f&63,h+=E[O]+E[P]+E[g]+E[b];return x==1?(f=C[S],O=(f&252)>>2,P=(f&3)<<4,h+=E[O]+E[P]+"=="):x==2&&(f=C[S]<<8|C[S+1],O=(f&64512)>>10,P=(f&1008)>>4,g=(f&15)<<2,h+=E[O]+E[P]+E[g]+"="),h},y.prototype.base64ToArrayBuffer=function(C){for(var h=atob==null?void 0:atob(C),E=h.length,w=new Uint8Array(E),x=0;x<E;x++){var S=h.charCodeAt(x);w[x]=S}return w.buffer},y.prototype.isBuffer=function(C){return this.isArrayBuffer(C)||this.isWordArray(C)||this.isTypedArray(C)},y.prototype.toBuffer=function(C){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(C))return new Uint8Array(C);if(this.isTypedArray(C))return new Uint8Array(C.buffer);if(this.isWordArray(C)){for(var h=new ArrayBuffer(C.sigBytes),E=new Uint8Array(h),w=0;w<C.sigBytes;w++)E[w]=C.words[w>>>2]>>>24-w%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},y.prototype.toArrayBuffer=function(C){return this.isArrayBuffer(C)?C:this.toBuffer(C).buffer},y.prototype.toWordArray=function(C){return this.isTypedArray(C)&&(C=C.buffer),this.isWordArray(C)?C:u.default.create(C)},y.prototype.base64Encode=function(C){return this.isWordArray(C)?(0,l.stringify)(C):this.uint8ViewToBase64(this.toBuffer(C))},y.prototype.base64Decode=function(C){return ArrayBuffer&&d.default.Config.atob?this.base64ToArrayBuffer(C):(0,l.parse)(C)},y.prototype.hexEncode=function(C){return(0,i.stringify)(this.toWordArray(C))},y.prototype.hexDecode=function(C){var h=(0,i.parse)(C);return ArrayBuffer?this.toArrayBuffer(h):h},y.prototype.utf8Encode=function(C){return d.default.Config.TextEncoder?new d.default.Config.TextEncoder().encode(C).buffer:(0,a.parse)(C)},y.prototype.utf8Decode=function(C){if(!this.isBuffer(C))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(C)?new TextDecoder().decode(C):(C=this.toWordArray(C),(0,a.stringify)(C))},y.prototype.bufferCompare=function(C,h){if(!C)return-1;if(!h)return 1;var E=this.toWordArray(C),w=this.toWordArray(h);E.clamp(),w.clamp();var x=E.sigBytes-w.sigBytes;if(x!=0)return x;for(var S=E.words,O=w.words,P=0;P<S.length;P++)if(x=S[P]-O[P],x!=0)return x;return 0},y.prototype.byteLength=function(C){return this.isArrayBuffer(C)||this.isTypedArray(C)?C.byteLength:this.isWordArray(C)?C.sigBytes:-1},y.prototype.typedArrayToBuffer=function(C){return C.buffer},y}();e.default=new m},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return r.enc.Hex})},function(s,e,t){"use strict";t.r(e);var r=t(5),i=t.n(r),a=t(11),l=t.n(a),u=t(22),d=t.n(u),m=t(2),y=t.n(m),C=t(4),h=t.n(C),E=function(w,x){var S="aes",O=256,P="cbc",g=16,b=4,f=4294967296,p=2147483648,T;if(w.getRandomWordArray)T=w.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&w.getRandomValues){var v=new Uint32Array(b);T=function($,G){var J=$/4,tt=J==b?v:new Uint32Array(J);w.getRandomValues(tt,function(rt){typeof G!="undefined"&&G(rt,x.toWordArray(tt))})}}else T=function($,G){y.a.logAction(y.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var J=$/4,tt=new Array(J),rt=0;rt<J;rt++)tt[rt]=Math.floor(Math.random()*f)-p;G(null,i.a.create(tt))};function I($){return $+g&-g}function U($){if($.algorithm==="aes"&&$.mode==="cbc"){if($.keyLength===128||$.keyLength===256)return;throw new Error("Unsupported key length "+$.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function z($){return $.replace("_","/").replace("-","+")}var W=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function D(){}function M(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}D.CipherParams=M,D.getDefaultParams=function($){var G;if(typeof $=="function"||typeof $=="string"){if(y.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof $=="function")D.generateRandomKey(function(tt){$(null,D.getDefaultParams({key:tt}))});else if(typeof arguments[1]=="function")arguments[1](null,D.getDefaultParams({key:$}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!$.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof $.key=="string"?G=Object(a.parse)(z($.key)):G=x.toWordArray($.key);var J=new M;if(J.key=G,J.algorithm=$.algorithm||S,J.keyLength=G.words.length*(4*8),J.mode=$.mode||P,$.keyLength&&$.keyLength!==J.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+$.keyLength+" was specified, but the key actually has length "+J.keyLength);return U(J),J},D.generateRandomKey=function($,G){arguments.length==1&&typeof $=="function"&&(G=$,$=void 0),T(($||O)/8,function(J,tt){G!==void 0&&G(J?h.a.fromValues(J):null,tt)})},D.getCipher=function($){var G=$ instanceof M?$:D.getDefaultParams($);return{cipherParams:G,cipher:new L(G,b,$.iv)}};function L($,G,J){this.algorithm=$.algorithm+"-"+String($.keyLength)+"-"+$.mode,this.cjsAlgorithm=$.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=x.toWordArray($.key),J&&(this.iv=x.toWordArray(J).clone()),this.blockLengthWords=G}return L.prototype.encrypt=function($,G){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.encrypt()",""),$=x.toWordArray($);var J=$.sigBytes,tt=I(J),rt=this,X=function(){rt.getIv(function(_,B){if(_){G(_);return}var H=rt.encryptCipher.process($.concat(W[tt-J])),j=B.concat(H);G(null,j)})};this.encryptCipher?X():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):T(g,function(_,B){if(_){G(_);return}rt.encryptCipher=d.a.algo[rt.cjsAlgorithm].createEncryptor(rt.key,{iv:B}),rt.iv=B,X()})},L.prototype.decrypt=function($){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.decrypt()",""),$=x.toWordArray($);var G=this.blockLengthWords,J=$.words,tt=i.a.create(J.slice(0,G)),rt=i.a.create(J.slice(G)),X=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:tt}),_=X.process(rt),B=X.finalize();return X.reset(),B&&B.sigBytes&&_.concat(B),_},L.prototype.getIv=function($){if(this.iv){var G=this.iv;this.iv=null,$(null,G);return}var J=this;T(g,function(tt,rt){if(tt){$(tt);return}$(null,J.encryptCipher.process(rt))})},D};e.default=E},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=i.enc,d=u.Utf16=u.Utf16BE={stringify:function(y){for(var C=y.words,h=y.sigBytes,E=[],w=0;w<h;w+=2){var x=C[w>>>2]>>>16-w%4*8&65535;E.push(String.fromCharCode(x))}return E.join("")},parse:function(y){for(var C=y.length,h=[],E=0;E<C;E++)h[E>>>1]|=y.charCodeAt(E)<<16-E%2*16;return l.create(h,C*2)}};u.Utf16LE={stringify:function(y){for(var C=y.words,h=y.sigBytes,E=[],w=0;w<h;w+=2){var x=m(C[w>>>2]>>>16-w%4*8&65535);E.push(String.fromCharCode(x))}return E.join("")},parse:function(y){for(var C=y.length,h=[],E=0;E<C;E++)h[E>>>1]|=m(y.charCodeAt(E)<<16-E%2*16);return l.create(h,C*2)}};function m(y){return y<<8&4278255360|y>>>8&16711935}}(),r.enc.Utf16})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(28))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.CipherParams,d=a.enc,m=d.Hex,y=a.format,C=y.Hex={stringify:function(h){return h.ciphertext.toString(m)},parse:function(h){var E=m.parse(h);return u.create({ciphertext:E})}}}(),r.format.Hex})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(11),t(61),t(27),t(28))})(this,function(r){return function(){var i=r,a=i.lib,l=a.BlockCipher,u=i.algo,d=[],m=[],y=[],C=[],h=[],E=[],w=[],x=[],S=[],O=[];(function(){for(var b=[],f=0;f<256;f++)f<128?b[f]=f<<1:b[f]=f<<1^283;for(var p=0,T=0,f=0;f<256;f++){var v=T^T<<1^T<<2^T<<3^T<<4;v=v>>>8^v&255^99,d[p]=v,m[v]=p;var I=b[p],U=b[I],z=b[U],W=b[v]*257^v*16843008;y[p]=W<<24|W>>>8,C[p]=W<<16|W>>>16,h[p]=W<<8|W>>>24,E[p]=W;var W=z*16843009^U*65537^I*257^p*16843008;w[v]=W<<24|W>>>8,x[v]=W<<16|W>>>16,S[v]=W<<8|W>>>24,O[v]=W,p?(p=I^b[b[b[z^I]]],T^=b[b[T]]):p=T=1}})();var P=[0,1,2,4,8,16,32,64,128,27,54],g=u.AES=l.extend({_doReset:function(){var b;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var f=this._keyPriorReset=this._key,p=f.words,T=f.sigBytes/4,v=this._nRounds=T+6,I=(v+1)*4,U=this._keySchedule=[],z=0;z<I;z++)z<T?U[z]=p[z]:(b=U[z-1],z%T?T>6&&z%T==4&&(b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255]):(b=b<<8|b>>>24,b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255],b^=P[z/T|0]<<24),U[z]=U[z-T]^b);for(var W=this._invKeySchedule=[],D=0;D<I;D++){var z=I-D;if(D%4)var b=U[z];else var b=U[z-4];D<4||z<=4?W[D]=b:W[D]=w[d[b>>>24]]^x[d[b>>>16&255]]^S[d[b>>>8&255]]^O[d[b&255]]}}},encryptBlock:function(b,f){this._doCryptBlock(b,f,this._keySchedule,y,C,h,E,d)},decryptBlock:function(b,f){var p=b[f+1];b[f+1]=b[f+3],b[f+3]=p,this._doCryptBlock(b,f,this._invKeySchedule,w,x,S,O,m);var p=b[f+1];b[f+1]=b[f+3],b[f+3]=p},_doCryptBlock:function(b,f,p,T,v,I,U,z){for(var W=this._nRounds,D=b[f]^p[0],M=b[f+1]^p[1],L=b[f+2]^p[2],$=b[f+3]^p[3],G=4,J=1;J<W;J++){var tt=T[D>>>24]^v[M>>>16&255]^I[L>>>8&255]^U[$&255]^p[G++],rt=T[M>>>24]^v[L>>>16&255]^I[$>>>8&255]^U[D&255]^p[G++],X=T[L>>>24]^v[$>>>16&255]^I[D>>>8&255]^U[M&255]^p[G++],_=T[$>>>24]^v[D>>>16&255]^I[M>>>8&255]^U[L&255]^p[G++];D=tt,M=rt,L=X,$=_}var tt=(z[D>>>24]<<24|z[M>>>16&255]<<16|z[L>>>8&255]<<8|z[$&255])^p[G++],rt=(z[M>>>24]<<24|z[L>>>16&255]<<16|z[$>>>8&255]<<8|z[D&255])^p[G++],X=(z[L>>>24]<<24|z[$>>>16&255]<<16|z[D>>>8&255]<<8|z[M&255])^p[G++],_=(z[$>>>24]<<24|z[D>>>16&255]<<16|z[M>>>8&255]<<8|z[L&255])^p[G++];b[f]=tt,b[f+1]=rt,b[f+2]=X,b[f+3]=_},keySize:256/32});i.AES=l._createHelper(g)}(),r.AES})},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.WordArray,d=l.Hasher,m=a.algo,y=[];(function(){for(var S=0;S<64;S++)y[S]=i.abs(i.sin(S+1))*4294967296|0})();var C=m.MD5=d.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,O){for(var P=0;P<16;P++){var g=O+P,b=S[g];S[g]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}var f=this._hash.words,p=S[O+0],T=S[O+1],v=S[O+2],I=S[O+3],U=S[O+4],z=S[O+5],W=S[O+6],D=S[O+7],M=S[O+8],L=S[O+9],$=S[O+10],G=S[O+11],J=S[O+12],tt=S[O+13],rt=S[O+14],X=S[O+15],_=f[0],B=f[1],H=f[2],j=f[3];_=h(_,B,H,j,p,7,y[0]),j=h(j,_,B,H,T,12,y[1]),H=h(H,j,_,B,v,17,y[2]),B=h(B,H,j,_,I,22,y[3]),_=h(_,B,H,j,U,7,y[4]),j=h(j,_,B,H,z,12,y[5]),H=h(H,j,_,B,W,17,y[6]),B=h(B,H,j,_,D,22,y[7]),_=h(_,B,H,j,M,7,y[8]),j=h(j,_,B,H,L,12,y[9]),H=h(H,j,_,B,$,17,y[10]),B=h(B,H,j,_,G,22,y[11]),_=h(_,B,H,j,J,7,y[12]),j=h(j,_,B,H,tt,12,y[13]),H=h(H,j,_,B,rt,17,y[14]),B=h(B,H,j,_,X,22,y[15]),_=E(_,B,H,j,T,5,y[16]),j=E(j,_,B,H,W,9,y[17]),H=E(H,j,_,B,G,14,y[18]),B=E(B,H,j,_,p,20,y[19]),_=E(_,B,H,j,z,5,y[20]),j=E(j,_,B,H,$,9,y[21]),H=E(H,j,_,B,X,14,y[22]),B=E(B,H,j,_,U,20,y[23]),_=E(_,B,H,j,L,5,y[24]),j=E(j,_,B,H,rt,9,y[25]),H=E(H,j,_,B,I,14,y[26]),B=E(B,H,j,_,M,20,y[27]),_=E(_,B,H,j,tt,5,y[28]),j=E(j,_,B,H,v,9,y[29]),H=E(H,j,_,B,D,14,y[30]),B=E(B,H,j,_,J,20,y[31]),_=w(_,B,H,j,z,4,y[32]),j=w(j,_,B,H,M,11,y[33]),H=w(H,j,_,B,G,16,y[34]),B=w(B,H,j,_,rt,23,y[35]),_=w(_,B,H,j,T,4,y[36]),j=w(j,_,B,H,U,11,y[37]),H=w(H,j,_,B,D,16,y[38]),B=w(B,H,j,_,$,23,y[39]),_=w(_,B,H,j,tt,4,y[40]),j=w(j,_,B,H,p,11,y[41]),H=w(H,j,_,B,I,16,y[42]),B=w(B,H,j,_,W,23,y[43]),_=w(_,B,H,j,L,4,y[44]),j=w(j,_,B,H,J,11,y[45]),H=w(H,j,_,B,X,16,y[46]),B=w(B,H,j,_,v,23,y[47]),_=x(_,B,H,j,p,6,y[48]),j=x(j,_,B,H,D,10,y[49]),H=x(H,j,_,B,rt,15,y[50]),B=x(B,H,j,_,z,21,y[51]),_=x(_,B,H,j,J,6,y[52]),j=x(j,_,B,H,I,10,y[53]),H=x(H,j,_,B,$,15,y[54]),B=x(B,H,j,_,T,21,y[55]),_=x(_,B,H,j,M,6,y[56]),j=x(j,_,B,H,X,10,y[57]),H=x(H,j,_,B,W,15,y[58]),B=x(B,H,j,_,tt,21,y[59]),_=x(_,B,H,j,U,6,y[60]),j=x(j,_,B,H,G,10,y[61]),H=x(H,j,_,B,v,15,y[62]),B=x(B,H,j,_,L,21,y[63]),f[0]=f[0]+_|0,f[1]=f[1]+B|0,f[2]=f[2]+H|0,f[3]=f[3]+j|0},_doFinalize:function(){var S=this._data,O=S.words,P=this._nDataBytes*8,g=S.sigBytes*8;O[g>>>5]|=128<<24-g%32;var b=i.floor(P/4294967296),f=P;O[(g+64>>>9<<4)+15]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,O[(g+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,S.sigBytes=(O.length+1)*4,this._process();for(var p=this._hash,T=p.words,v=0;v<4;v++){var I=T[v];T[v]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}return p},clone:function(){var S=d.clone.call(this);return S._hash=this._hash.clone(),S}});function h(S,O,P,g,b,f,p){var T=S+(O&P|~O&g)+b+p;return(T<<f|T>>>32-f)+O}function E(S,O,P,g,b,f,p){var T=S+(O&g|P&~g)+b+p;return(T<<f|T>>>32-f)+O}function w(S,O,P,g,b,f,p){var T=S+(O^P^g)+b+p;return(T<<f|T>>>32-f)+O}function x(S,O,P,g,b,f,p){var T=S+(P^(O|~g))+b+p;return(T<<f|T>>>32-f)+O}a.MD5=d._createHelper(C),a.HmacMD5=d._createHmacHelper(C)}(Math),r.MD5})},function(s,e,t){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importDefault(t(3)),l=i.__importStar(t(1)),u=i.__importDefault(t(8)),d=t(4),m=i.__importDefault(t(18)),y=i.__importDefault(t(16)),C=i.__importDefault(t(21)),h=i.__importDefault(t(2)),E=t(29),w=i.__importDefault(t(63)),x=t(25);function S(g){var b=g.statusCode;return b===408&&!g.code||b===400&&!g.code||b>=500&&b<=504}function O(g){var b=g.connection,f=b&&b.connectionManager.host;return f?[f].concat(u.default.getFallbackHosts(g.options)):u.default.getHosts(g.options)}var P=(r=function(){function g(b){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=O,this.options=b||{};var f=this.options.connectivityCheckUrl||u.default.connectivityCheckUrl,p=this.options.connectivityCheckParams,T=!this.options.connectivityCheckUrl;a.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(v,I,U,z,W,D,M){var L=y.default.createRequest(U,z,W,D,C.default.REQ_SEND,I&&I.options.timeouts,v);return L.once("complete",M),L.exec(),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,p,function(I,U,z,W,D){var M=!1;T?M=!I&&(U==null?void 0:U.replace(/\n/,""))=="yes":M=!I&&(0,x.isSuccessCode)(D),h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+M),v(null,M)})}):a.default.Config.jsonpSupported?(this.Request=function(v,I,U,z,W,D,M){var L=(0,E.createRequest)(U,z,W,D,C.default.REQ_SEND,I&&I.options.timeouts,v);return L.once("complete",M),a.default.Config.nextTick(function(){L.exec()}),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){var I=this,U=u.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(v);return}this.checksInProgress=[v],h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+U);var z=new E.Request("isTheInternetUp",U,null,null,null,C.default.REQ_SEND,u.default.TIMEOUTS);z.once("complete",function(W,D){var M=!W&&D;h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+M);for(var L=0;L<I.checksInProgress.length;L++)I.checksInProgress[L](null,M);I.checksInProgress=null}),a.default.Config.nextTick(function(){z.exec()})}):a.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=w.default,this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,null,function(I,U){var z=!I&&(U==null?void 0:U.replace(/\n/,""))=="yes";h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+z),v(null,z)})}):this.Request=function(v,I,U,z,W,D,M){M(new d.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return g.prototype.do=function(b,f,p,T,v,I,U){var z=this,W=typeof p=="function"?p:function($){return f.baseUri($)+p},D=f._currentFallback;if(D)if(D.validUntil>l.now()){if(!this.Request){U==null||U(new d.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(b,f,W(D.host),T,I,v,function($){for(var G=[],J=1;J<arguments.length;J++)G[J-1]=arguments[J];if($&&S($)){f._currentFallback=null,z.do(b,f,p,T,v,I,U);return}U==null||U.apply(void 0,i.__spreadArray([$],G,!1))});return}else f._currentFallback=null;var M=O(f);if(M.length===1){this.doUri(b,f,W(M[0]),T,v,I,U);return}var L=function($,G){var J=$.shift();z.doUri(b,f,W(J),T,v,I,function(tt){for(var rt=[],X=1;X<arguments.length;X++)rt[X-1]=arguments[X];if(tt&&S(tt)&&$.length){L($,!0);return}G&&(f._currentFallback={host:J,validUntil:l.now()+f.options.timeouts.fallbackRetryTimeout}),U==null||U.apply(void 0,i.__spreadArray([tt],rt,!1))})};L(M)},g.prototype.doUri=function(b,f,p,T,v,I,U){if(!this.Request){U(new d.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(b,f,p,T,I,v,U)},g}(),r.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],r.methodsWithoutBody=[m.default.Get,m.default.Delete],r.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],r);e.default=P},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(4)),a=r.__importDefault(t(3)),l=r.__importDefault(t(8)),u=r.__importStar(t(1)),d=t(1);function m(h,E){return!!E.get("x-ably-errorcode")}function y(h,E){if(m(h,E))return h.error&&i.default.fromValues(h.error)}function C(h,E,w,x,S,O,P){var g=new Headers(x||{}),b=h?h.toUpperCase():u.isEmptyArg(O)?"GET":"POST",f=new AbortController,p=setTimeout(function(){f.abort(),P(new i.PartialErrorInfo("Request timed out",null,408))},E?E.options.timeouts.httpRequestTimeout:l.default.TIMEOUTS.httpRequestTimeout),T={method:b,headers:g,body:O};a.default.Config.isWebworker||(T.credentials=g.has("authorization")?"include":"same-origin"),(0,d.getGlobalObject)().fetch(w+"?"+new URLSearchParams(S||{}),T).then(function(v){clearTimeout(p);var I=v.headers.get("Content-Type"),U;I&&I.indexOf("application/x-msgpack")>-1?U=v.arrayBuffer():I&&I.indexOf("application/json")>-1?U=v.json():U=v.text(),U.then(function(z){var W=!!I&&I.indexOf("application/x-msgpack")===-1;if(v.ok)P(null,z,v.headers,W,v.status);else{var D=y(z,v.headers)||new i.PartialErrorInfo("Error response received from server: "+v.status+" body was: "+a.default.Config.inspect(z),null,v.status);P(D,z,v.headers,W,v.status)}})}).catch(function(v){clearTimeout(p),P(v)})}e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(41)),a=r.__importStar(t(1)),l=a.getGlobalObject();function u(){var C=l.location;return!l.WebSocket||!C||!C.origin||C.origin.indexOf("http")>-1}var d=l.navigator&&l.navigator.userAgent.toString(),m=l.location&&l.location.href,y={agent:"browser",logTimestamps:!0,userAgent:d,currentUrl:m,noUpgrade:d&&!!d.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:l.WebSocket,fetchSupported:!!l.fetch,xhrSupported:l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:u(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!l.TextDecoder,preferBinary:!1,ArrayBuffer:l.ArrayBuffer,atob:l.atob,nextTick:typeof l.setImmediate!="undefined"?l.setImmediate.bind(l):function(C){setTimeout(C,0)},addEventListener:l.addEventListener,inspect:JSON.stringify,stringByteSize:function(C){return l.TextDecoder&&new l.TextEncoder().encode(C).length||C.length},TextEncoder:l.TextEncoder,TextDecoder:l.TextDecoder,Promise:l.Promise,getRandomValues:function(C){if(C!==void 0)return function(h,E){C.getRandomValues(h),E&&E(null)}}(l.crypto||msCrypto)};e.default=y},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importStar(t(1)),l="ablyjs-storage-test",u=function(){function d(){try{r.sessionStorage.setItem(l,l),r.sessionStorage.removeItem(l),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{r.localStorage.setItem(l,l),r.localStorage.removeItem(l),this.localSupported=!0}catch(m){this.localSupported=!1}}return d.prototype.get=function(m){return this._get(m,!1)},d.prototype.getSession=function(m){return this._get(m,!0)},d.prototype.remove=function(m){return this._remove(m,!1)},d.prototype.removeSession=function(m){return this._remove(m,!0)},d.prototype.set=function(m,y,C){return this._set(m,y,C,!1)},d.prototype.setSession=function(m,y,C){return this._set(m,y,C,!0)},d.prototype._set=function(m,y,C,h){var E={value:y};return C&&(E.expires=a.now()+C),this.storageInterface(h).setItem(m,JSON.stringify(E))},d.prototype._get=function(m,y){if(y&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!y&&!this.localSupported)throw new Error("Local Storage not supported");var C=this.storageInterface(y).getItem(m);if(!C)return null;var h=JSON.parse(C);return h.expires&&h.expires<a.now()?(this.storageInterface(y).removeItem(m),null):h.value},d.prototype._remove=function(m,y){return this.storageInterface(y).removeItem(m)},d.prototype.storageInterface=function(m){return m?r.sessionStorage:r.localStorage},d}();e.default=new u}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(67)),a={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(r||(r={})),e.default=r},function(s,e,t){"use strict";t.r(e);var r=t(29),i=t.n(r),a=t(1),l=t(3),u=t.n(l),d=t(12),m=t.n(d),y=t(16),C=t.n(y),h=function(O){var P="xhr_polling";function g(b,f,p){p.stream=!1,m.a.call(this,b,f,p),this.shortName=P}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(b,f,p,T,v){return C.a.createRequest(b,f,p,T,v,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[P]=g),g},E=h,w=function(O){var P="xhr_streaming";function g(b,f,p){m.a.call(this,b,f,p),this.shortName=P}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.streamingSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(b,f,p,T,v){return C.a.createRequest(b,f,p,T,v,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[P]=g),g},x=w,S=e.default=[i.a,E,x]}]).default})});N();N();var ho=(b=>(b.MEETING_START="meeting.start",b.MEETING_LEAVE="meeting.leave",b.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",b.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",b.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",b.MEETING_PARTICIPANT_LEFT="meeting.participant-left",b.MEETING_JOIN="meeting.join",b.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",b.MEETING_HOST_CHANGE="meeting.host-change",b.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",b.MEETING_DEVICES_CHANGE="meeting.devices-change",b.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",b.MEETING_STATE_UPDATE="meeting.state-update",b.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",b.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",b.MY_PARTICIPANT_UPDATED="my-participant.update",b.MY_PARTICIPANT_LEFT="my-participant.left",b.MY_PARTICIPANT_JOINED="my-participant.joined",b.MEETING_KICK_PARTICIPANT="meeting.kick-participant",b.DESTROY="destroy",b))(ho||{}),po=(l=>(l.FRAME_LOAD="frame.load",l.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",l.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",l.FRAME_LOCALE_UPDATE="frame.locales-update",l.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",l.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",l))(po||{}),sa=(u=>(u.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",u.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",u.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",u.TOGGLE_CAM="meeting-controls.toggle-cam",u.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",u.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",u.HANG_UP="hang-up",u))(sa||{}),Cr=(E=>(E.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",E.REALTIME_HOST_CHANGE="realtime.host-change",E.REALTIME_HOST_AVAILABLE="realtime.host-available",E.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",E.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",E.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",E.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",E.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",E.REALTIME_GATHER="realtime.gather",E.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",E.REALTIME_SET_AVATAR="realtime.set-avatar",E.REALTIME_DRAWING_CHANGE="realtime.drawing-change",E.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",E))(Cr||{});var aa=(y=>(y[y.MEETING_FAILED=-1]="MEETING_FAILED",y[y.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",y[y.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",y[y.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",y[y.MEETING_CONNECTING=3]="MEETING_CONNECTING",y[y.MEETING_CONNECTED=4]="MEETING_CONNECTED",y[y.MEETING_RECONNECT=5]="MEETING_RECONNECT",y[y.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",y[y.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",y[y.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",y))(aa||{}),la=(l=>(l.JOINED="participant.joined",l.LOCAL_JOINED="participant.local-joined",l.LEFT="participant.left",l.LOCAL_LEFT="participant.local-left",l.LOCAL_UPDATED="participant.updated",l.LIST_UPDATED="participant.list-updated",l))(la||{}),mo=(u=>(u[u.NOT_AVAILABLE=0]="NOT_AVAILABLE",u[u.GOOD=1]="GOOD",u[u.BAD=2]="BAD",u[u.POOR=3]="POOR",u[u.DISCONNECTED=4]="DISCONNECTED",u[u.RECONNECTING=5]="RECONNECTING",u[u.LOST_CONNECTION=6]="LOST_CONNECTION",u))(mo||{}),xu=(l=>(l.NO_CAM="devices.no-cam",l.NO_DEVICES="devices.no-devices",l.DEVICES_BLOCKED="devices.blocked",l.DEVICES_CAM_BLOCKED="devices.cam-blocked",l.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",l.DEVICES_UNKNOWN_ERROR="devices.unknown-error",l))(xu||{});N();var Ci=(r=>(r.HOST="host",r.GUEST="guest",r.AUDIENCE="audience",r))(Ci||{});N();N();N();N();var Me=(i,a,l,...u)=>_t(void 0,[i,a,l,...u],function*(s,e,t,r={}){let d=yield fetch(s,{method:e,headers:dt({"Content-Type":"application/json"},r),body:t?JSON.stringify(t):null});if(!d.ok)throw d;try{return yield d.json()}catch(m){return d.ok}});N();var rp=On(Iu()),te=class{constructor(e){this.debug=(0,rp.default)(e)}log(e,...t){this.debug(e,...t)}};N();N();var Up=On(_u());var Ct=class{constructor(e={}){this.subscribe=e=>{this.callbacks.push(e)};this.unsubscribe=e=>{this.callbacks=this.callbacks.filter(t=>t!==e)};this.publish=(...e)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,e).catch(r=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(e)}
            Error: ${r}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(e,t)=>new Promise((r,i)=>{try{let a=e(...t);r(a)}catch(a){i(a)}});let{logger:t,throttleTime:r}=e;this.logger=t!=null?t:new te("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,Up.default)(this.publish,this.throttle))}};var Or=class{constructor(){this.observers={};this.subscribe=(e,t)=>{this.logger.log(`subscribed to ${e} event`),this.observers[e]||(this.observers[e]=new Ct({logger:this.logger})),this.observers[e].subscribe(t)};this.unsubscribe=(e,t)=>{if(this.logger.log(`unsubscribed from ${e} event`),!!this.observers[e]){if(!t){this.observers[e].destroy(),delete this.observers[e];return}this.observers[e].unsubscribe(t)}};this.publish=(e,t)=>{e in this.observers&&this.observers[e].publish(t)}}};N();N();N();var Bp=On(yo()),Lu=class{setConfig(e){this.configuration=e}get(e,t){return this.configuration?Bp.default.get(this.configuration,e,t):t}},At=new Lu;var ye=class{static createUrl(e,t,r={}){let i=new URL(t,e);return Object.keys(r).forEach(a=>i.searchParams.append(a,r[a])),i.toString()}static validateApiKey(e,t){let r="/user/checkapikey",i=this.createUrl(e,r);return Me(i,"POST",{apiKey:t})}static fetchConfig(e,t){let r="/immersive-config",i=this.createUrl(e,r);return Me(i,"POST",{apiKey:t})}static fetchLimits(e,t){return _t(this,null,function*(){let r="/user/check_limits",i=this.createUrl(e,r);return(yield Me(i,"GET","",{apikey:t})).usage})}static fetchWaterMark(e,t){return _t(this,null,function*(){let r="/user/watermark",i=this.createUrl(e,r),{message:a}=yield Me(i,"POST",{apiKey:t});return a})}static createAnnotations(e,t,r){return _t(this,null,function*(){let i="/annotations",a=this.createUrl(e,i);return Me(a,"POST",dt({},r),{apikey:t})})}static updateComment(e,t,r,i){return _t(this,null,function*(){let a=`/comments/${r}`,l=this.createUrl(e,a);return Me(l,"PUT",{text:i},{apikey:t})})}static createComment(e,t,r){return _t(this,null,function*(){let i="/comments",a=this.createUrl(e,i);return Me(a,"POST",dt({},r),{apikey:t})})}static fetchAnnotation(e,t,r){return _t(this,null,function*(){let i="/annotations",a=this.createUrl(e,i,{roomId:r.roomId,url:r.url});return Me(a,"GET",void 0,{apikey:t})})}static resolveAnnotation(e,t,r){return _t(this,null,function*(){let i=`/annotations/resolve/${r}`,a=this.createUrl(e,i);return Me(a,"POST",{},{apikey:t})})}static deleteComment(e,t,r){return _t(this,null,function*(){let i=`/comments/${r}`,a=this.createUrl(e,i);return Me(a,"DELETE",{},{apikey:t})})}static deleteAnnotation(e,t,r){return _t(this,null,function*(){let i=`/annotations/${r}`,a=this.createUrl(e,i);return Me(a,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(e,t){return _t(this,null,function*(){let r=At.get("apiUrl"),i="/participants",a=this.createUrl(r,i);return Me(a,"POST",dt({},t),{apikey:e})})}static sendActivity(e,t,r,i){return _t(this,null,function*(){let a="/activity",l=At.get("apiUrl"),u=At.get("roomId"),d=At.get("apiKey"),m=this.createUrl(l,a);return Me(m,"POST",{groupId:t,groupName:r,meetingId:u,product:i,userId:e},{apikey:d})})}};N();var on=class extends Or{constructor(){super(...arguments);this.isAttached=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let d=`${this.name} @ attach - params are required`;throw this.logger.log(d),new Error(d)}let{realtime:r,localParticipant:i,group:a,config:l,eventBus:u}=t;if(!r.isDomainWhitelisted){let d=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(d);return}if(At.setConfig(l),this.realtime=r,this.localParticipant=i,this.group=a,this.eventBus=u,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),Object.values(this.observers).forEach(t=>{t.reset(),t.destroy()}),this.observers=void 0,this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1}}};N();var Nu=(a=>(a.presence3dMatterport="presence",a.presence3dAutodesk="presence",a.presence3dThreejs="presence",a.realtime="presence",a.whoIsOnline="presence",a))(Nu||{});N();var Du=(t=>(t.LEFT="left",t.RIGHT="right",t))(Du||{}),Fu=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(Fu||{});var bo=class extends on{constructor(t,r){super();this.sidebarOpen=!1;this.onFixedPin=t=>{document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:dt({},t),composed:!0,bubbles:!0}))};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),this.pinAdapter.setActive(this.sidebarOpen),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var d,m;this.button=document.createElement("superviz-comments-button");let t=(d=this.layoutOptions)==null?void 0:d.buttonLocation,r=(m=this.layoutOptions)==null?void 0:m.position;if(!t){document.body.appendChild(this.button),this.button.commentsPosition=r;return}let i="",a=Object.values(Fu),l=!1,u=!a.includes(t.toLocaleLowerCase());if(u){let y=window.document.body.querySelector(`#${t}`);y?(y.appendChild(this.button),i="position: relative"):(l=!0,t="top-left")}if(!u||l){document.body.appendChild(this.button);let[y,C]=t.split("-");i=`${y}: 20px; ${C}: 20px;`}this.button.positionStyles=i,this.button.commentsPosition=r};this.positionComments=()=>{var l;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left: 0;",document.body.appendChild(this.element);let t=(l=this.layoutOptions)==null?void 0:l.position;if(!t)return;let r=Object.values(Du),i=t.toLocaleLowerCase();if(!r.includes(i))return;let a=t==="left"?"left: 0;":"right: 0;";this.element.side=a};this.createAnnotation=r=>_t(this,[r],function*({detail:t}){try{let{position:i,text:a}=t,{url:l}=this,u=yield ye.createAnnotations(At.get("apiUrl"),At.get("apiKey"),{roomId:At.get("roomId"),position:JSON.stringify(i),url:l,userId:this.localParticipant.id}),d=yield this.createComment(u.uuid,a);this.addAnnotation(jt(dt({},u),{comments:[d]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:u.uuid},composed:!0,bubbles:!0}))}catch(i){this.logger.log("error when creating annotation",i)}});this.deleteAnnotation=r=>_t(this,[r],function*({detail:t}){try{let{uuid:i}=t;yield ye.deleteAnnotation(At.get("apiUrl"),At.get("apiKey"),i);let a=this.annotations.filter(l=>l.uuid!==i);this.updateAnnotationList(a),this.pinAdapter.removeAnnotationPin(i),this.element.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when deleting annotation",i)}});this.updateComment=r=>_t(this,[r],function*({detail:t}){try{let{uuid:i,text:a}=t;yield ye.updateComment(At.get("apiUrl"),At.get("apiKey"),i,a);let l=this.annotations.map(u=>Object.assign({},u,{comments:u.comments.map(d=>d.uuid===i?Object.assign({},d,{text:a}):d)}));this.updateAnnotationList(l)}catch(i){this.logger.log("error when updating comment",i)}});this.resolveAnnotation=r=>_t(this,[r],function*({detail:t}){try{let{uuid:i}=t,{resolved:a}=yield ye.resolveAnnotation(At.get("apiUrl"),At.get("apiKey"),i),l=this.annotations.map(u=>u.uuid===i?Object.assign({},u,{resolved:a}):u);if(this.updateAnnotationList(l),a){this.pinAdapter.removeAnnotationPin(i);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when resolve annotation",i)}});this.deleteComment=r=>_t(this,[r],function*({detail:t}){try{let{uuid:i,annotationId:a}=t;if(!i||!a)return;yield ye.deleteComment(At.get("apiUrl"),At.get("apiKey"),i);let l=this.annotations.find(d=>d.uuid===a);l.comments=l.comments.filter(d=>d.uuid!==i);let u=this.annotations.map(d=>d.uuid===a?l:d);this.element.updateAnnotations(u),this.updateAnnotationList(u)}catch(i){this.logger.log("error when deleting comment",i)}});this.onAnnotationListUpdate=t=>{let{data:r,clientId:i}=t;this.localParticipant.id!==i&&(this.annotations=r,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new te("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions=r!=null?r:{position:"left",buttonLocation:"top-left"},this.pinAdapter=t}get url(){let t=new URL(this.clientUrl);return t.search="",t.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){this.logger.log("comments component @ destroy"),this.destroyListeners(),this.button.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){this.button.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onFixedPin)}destroyListeners(){this.button.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("create-annotation",this.createAnnotation),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onFixedPin)}createComment(t,r,i=!1){return _t(this,null,function*(){try{let a=yield ye.createComment(At.get("apiUrl"),At.get("apiKey"),{annotationId:t,userId:this.localParticipant.id,text:r});return i&&this.addComment(t,a),a}catch(a){this.logger.log("error when creating comment",a)}})}addAnnotation(t){let r=[t,...this.annotations];this.element.updateAnnotations(r),this.pinAdapter.updateAnnotations(r),this.updateAnnotationList(r)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,r){let i=this.annotations.find(l=>l.uuid===t);i.comments.push(r);let a=this.annotations.map(l=>l.uuid===t?i:l);this.updateAnnotationList(a),this.element.updateAnnotations(a)}fetchAnnotations(){return _t(this,null,function*(){try{let t=yield ye.fetchAnnotation(At.get("apiUrl"),At.get("apiKey"),{roomId:At.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return _t(this,null,function*(){try{let t=yield ye.fetchWaterMark(At.get("apiUrl"),At.get("apiKey"));this.element.waterMarkStatus(t)}catch(t){this.logger.log("error when fetching waterMark",t)}})}};N();N();var fa=(t=>(t.ADD="add",t.SHOW="show",t))(fa||{});var Co=class{constructor(e,t){this.isPinsVisible=!0;this.selectedPin=null;this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"))};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.renderDivWrapper()),requestAnimationFrame(this.animate)};this.annotationSelected=({detail:e})=>{var a,l;let{uuid:t}=e;if(!t)return;let r=JSON.parse((l=(a=this.selectedPin)==null?void 0:a.getAttribute("annotation"))!=null?l:"{}");if(this.resetPins(),(r==null?void 0:r.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let i=this.pins.get(t);!i||(i.setAttribute("active",""),this.selectedPin=i,this.goToPin(t))};this.onClick=e=>{if(!this.isActive)return;let t=this.canvas.getContext("2d"),r=this.canvas.getBoundingClientRect(),i=e.clientX-r.left,a=e.clientY-r.top,l=t.getTransform(),u=l.e,d=l.f,m=l.inverse(),y=new DOMPoint(i,a).matrixTransform(m),C=y.x+u,h=y.y+d;this.onPinFixedObserver.publish({x:y.x,y:y.y,type:"canvas"}),this.resetSelectedPin(),this.createTemporaryPin({x:C,y:h,type:"canvas"}),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseMove=e=>{let{x:t,y:r}=e;this.mouseElement||(this.mouseElement=this.createMouseElement()),this.mouseElement.setAttribute("position",JSON.stringify({x:t,y:r}))};this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.canvas.style.cursor="default"};this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.pins.forEach(r=>{r.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};if(this.logger=new te("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvasId=e,this.canvas=document.getElementById(e),this.isActive=!1,this.pins=new Map,this.goToPinCallback=t==null?void 0:t.onGoToPin,!this.canvas){let r=`Canvas with id ${e} not found`;throw this.logger.log(r),new Error(r)}document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.style.position="relative",this.onPinFixedObserver=new Ct({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate)}destroy(){this.removeListeners(),this.removeAnnotationsPins(),this.mouseElement=null,this.pins=new Map,this.divWrapper.remove(),this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar)}setPinsVisibility(e){if(this.isPinsVisible=e,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(e){if(this.isActive=e,this.canvas.style.cursor=e?"none":"default",this.isActive){this.addListeners();return}this.removeListeners()}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(e){let t=this.pins.get(e);!t||(t.remove(),this.pins.delete(e),this.annotations=this.annotations.filter(r=>r.uuid!==e))}createTemporaryPin(e){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttributeNode(document.createAttribute("active"))),t.setAttribute("position",JSON.stringify(e)),this.divWrapper.appendChild(t),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseout",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("select-annotation",this.annotationSelected)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseout",this.onMouseLeave),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("select-annotation",this.annotationSelected)}createMouseElement(){let e=document.createElement("superviz-comments-annotation-pin");return e.setAttribute("type","add"),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(e),this.canvas.style.cursor="none",e}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let e=this.canvas.getBoundingClientRect(),t=document.createElement("div");return t.id="superviz-canvas-wrapper",this.canvas.parentElement.style.position="relative",t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){if(!this.annotations||this.canvas.style.display==="none"){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{let t=JSON.parse(e.position);if(e.resolved){this.removeAnnotationPin(e.uuid);return}if((t==null?void 0:t.type)!=="canvas")return;let{x:r,y:i}=t,l=this.canvas.getContext("2d").getTransform(),u=l.e,d=l.f,m=r+u,y=i+d;if(this.pins.has(e.uuid)){let h=this.pins.get(e.uuid);if(this.divWrapper.clientWidth>m&&this.divWrapper.clientHeight>y){h.setAttribute("style","opacity: 1"),this.pins.get(e.uuid).setAttribute("position",JSON.stringify({x:m,y}));return}h.setAttribute("style","opacity: 0");return}let C=document.createElement("superviz-comments-annotation-pin");C.setAttribute("type","show"),C.setAttribute("annotation",JSON.stringify(e)),C.setAttribute("position",JSON.stringify({x:m,y})),C.id=e.uuid,this.divWrapper.appendChild(C),this.pins.set(e.uuid,C)})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}goToPin(e){let t=this.annotations.find(E=>E.uuid===e);if(!t)return;let r=JSON.parse(t.position);if((r==null?void 0:r.type)!=="canvas")return;let i=this.canvas.getBoundingClientRect(),{width:a,height:l}=i,{x:u,y:d}=r,m=a/2,y=l/2,C=m-u,h=y-d;this.goToPinCallback&&this.goToPinCallback({x:C,y:h})}};N();var Bu=On(yo());N();var Sn=On(kp()),Oo=class{constructor(){this.browser=Sn.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Sn.default.PLATFORMS_MAP.mobile)||this.browser.is(Sn.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Sn.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};N();var ha=class{constructor(){this.updateMeetingConnectionStatus=e=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=e,this.connectionStatusObserver.publish(e),this.logger.log("CONNECTION STATUS CHANGE",e)};this.onUpdateBrowserOnlineStatus=e=>{let{type:t}=e;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new te("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new Ct({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};N();N();var pa=class{build(e,t,r,i={},a={}){let l=document.querySelector(`#${e}`),u=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(i).forEach(([d,m])=>{u.searchParams.set(d,m)}),Object.entries(a).forEach(([d,m])=>{this.element.setAttribute(d,m)}),this.element.src=u.toString(),this.element.id=r,l.appendChild(this.element),this.wrapperId=e}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let e=document.querySelector(`#${this.wrapperId}`);!!e&&!!e.querySelector(`#${this.element.id}`)&&e.removeChild(this.element),this.wrapperId=null,this.element=null}};N();var ma=class{constructor(e){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(e,t={})=>{this.logger.log("MessageBridge","Posting message to frame",e,t),this.contentWindow.postMessage({type:e,data:t},this.allowedOrigins)};this.listen=(e,t)=>{this.observers[e]||(this.observers[e]=new Ct({logger:this.logger})),this.observers[e].subscribe(t)};this.onReceiveMessage=e=>{let{type:t,data:r,source:i}=e.data;if(this.sourceBlockList.includes(i)||this.originBlockList.includes(e.origin))return;let a=!!t,l=!this.domains.length||this.domains.includes(e.origin),u=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${e.type}
        ORIGIN: ${e.origin}
        DATA: ${JSON.stringify(e.data)} `),!a||!l||!u){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(r)};let{contentWindow:t,domains:r=[],allowedOrigins:i="*",sourceBlockList:a=[],logger:l}=e;if(this.logger=l,this.domains=r,this.allowedOrigins=i,this.sourceBlockList.push(...a),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([e,t])=>{t.reset(),delete this.observers[e]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};N();var So=(r=>(r.RIGHT="right",r.CENTER="center",r.LEFT="left",r))(So||{}),ga=(t=>(t.GRID="grid",t.LIST="list",t))(ga||{}),va=(i=>(i.RIGHT="right",i.LEFT="left",i.TOP="top",i.BOTTOM="bottom",i))(va||{});var $p="sv-video-frame",To=class{constructor(e){this.logger=new te("@superviz/sdk/video-conference-manager");this.frameStateObserver=new Ct({logger:this.logger});this.frameSizeObserver=new Ct({logger:this.logger});this.waitingForHostObserver=new Ct({logger:this.logger});this.realtimeEventsObserver=new Ct({logger:this.logger});this.sameAccountErrorObserver=new Ct({logger:this.logger});this.devicesObserver=new Ct({logger:this.logger});this.meetingStateObserver=new Ct({logger:this.logger});this.meetingConnectionObserver=new Ct({logger:this.logger});this.participantJoinedObserver=new Ct({logger:this.logger});this.participantLeftObserver=new Ct({logger:this.logger});this.participantListObserver=new Ct({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(e,t)=>{let r=e,i=t,a=["left","right","bottom","top"].includes(i),l=["left","right","center"].includes(r);return a||(i="right"),l||(r="right"),this.browserService.isMobileDevice?(i="bottom",{layoutPosition:r,camerasPosition:i}):(r==="left"&&i==="right"&&(r="right"),r==="right"&&i==="left"&&(r="left"),{layoutPosition:r,camerasPosition:i})};this.onFrameLoad=()=>{this.messageBridge=new ma({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=e=>{let t=e!=null?e:{};["top","bottom","left","right"].forEach(r=>{Object.keys(t).includes(r)||(t[r]=0)}),this.frameOffset=t};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=e=>{let t=document.createElement("style"),{bottom:r,left:i,right:a,top:l}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${l}px;
        --superviz-offset-right: ${a}px;
        --superviz-offset-left: ${i}px;
        --superviz-offset-bottom: ${r}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${e}`)};this.onFrameDimensionsUpdate=({width:e,height:t})=>{let r=document.getElementById($p),{bottom:i,right:a,left:l,top:u}=this.frameOffset,d=this.isWaterMarkEnabled?40:0,m=`${e}px`,y=`${t+d}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${a}px - ${l}px)`),t>=window.innerHeight&&(y=`calc(100% - ${u}px - ${i}px)`),r.style.width=m,r.style.height=y,this.frameSizeObserver.publish({width:r.offsetWidth,height:r.offsetHeight})};this.onWindowResize=()=>{let{top:e,bottom:t,right:r,left:i}=this.frameOffset,{innerHeight:a,innerWidth:l}=window,u=a-e-t,d=l-r-i;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:u,width:d})};this.updateFrameLocale=()=>{var a,l;if(!this.frameLocale||!((a=this.frameLocale)!=null&&a.language)&&((l=this.frameLocale)==null?void 0:l.locales))return;let{language:e,locales:t}=this.frameLocale,r=t.map(u=>u==null?void 0:u.language),i=["en",...r];if(e&&!i.includes(e))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=e=>{this.participantJoinedObserver.publish(e)};this.onParticipantLeft=e=>{this.participantLeftObserver.publish(e)};this.onMeetingHostChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:e})};this.onMeetingKickParticipant=e=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:e})};this.onFollowParticipantDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:e})};this.onGoToDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:e})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:e})};this.onDrawingChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:e})};this.onTranscriptChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:e})};this.onSameAccountError=e=>{this.sameAccountErrorObserver.publish(e)};this.onDevicesChange=e=>{this.devicesObserver.publish(e)};this.meetingStateUpdate=e=>{this.meetingStateObserver.publish(e)};this.onConnectionStatusChange=e=>{this.meetingConnectionObserver.publish(e)};this.onWaitingForHostDidChange=e=>{this.waitingForHostObserver.publish(e)};this.onParticipantListUpdate=e=>{this.participantListObserver.publish(e)};var U,z,W,D;let{language:t,canUseCams:r,canUseChat:i,canUseScreenshare:a,canUseDefaultAvatars:l,canUseFollow:u,canUseGoTo:d,canUseGather:m,canUseDefaultToolbar:y,canUseTranscription:C,browserService:h,offset:E,locales:w,avatars:x,customColors:S,waterMark:O,layoutPosition:P,camerasPosition:g,skipMeetingSettings:b,devices:f,layoutMode:p,collaborationMode:T}=e;this.browserService=h;let v=this.layoutModalsAndCamerasConfig(P,g),I=document.createElement("div");this.frameConfig={apiKey:At.get("apiKey"),apiUrl:At.get("apiUrl"),ablyKey:At.get("ablyKey"),debug:At.get("debug"),roomId:At.get("roomId"),limits:At.get("limits"),collaborationMode:T,canUseFollow:u,canUseGoTo:d,canUseCams:r,canUseChat:i,canUseGather:m,canUseScreenshare:a,canUseDefaultAvatars:l,canUseTranscription:C,camerasPosition:(U=v.camerasPosition)!=null?U:"right",canUseDefaultToolbar:y,devices:{audioInput:(z=f==null?void 0:f.audioInput)!=null?z:!0,audioOutput:(W=f==null?void 0:f.audioOutput)!=null?W:!0,videoInput:(D=f==null?void 0:f.videoInput)!=null?D:!0},waterMark:O,layoutMode:p,skipMeetingSettings:b,layoutPosition:v.layoutPosition},this.customColors=S,I.classList.add("sv_video_wrapper"),I.id="sv-video-wrapper",document.body.appendChild(I),this.updateFrameState(1),this.bricklayer=new pa,this.bricklayer.build(I.id,At.get("conferenceLayerUrl"),$p,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(E),this.setFrameStyle(v.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:w},this.meetingAvatars=x,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(e){e!==this.frameState&&(this.frameState=e,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[e])}start(e){this.messageBridge.publish("meeting.start",jt(dt({},e),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var e,t;(e=this.messageBridge)==null||e.destroy(),(t=this.bricklayer)==null||t.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(e,t){this.messageBridge.publish(e,t)}};var wo=class extends on{constructor(t){var r,i;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var t,r,i,a,l,u,d,m,y,C,h,E,w,x,S,O,P,g,b,f,p,T,v,I,U,z,W,D,M,L,$;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseTranscription:((r=this.params)==null?void 0:r.transcriptOff)===!1,canUseChat:!((i=this.params)!=null&&i.chatOff),canUseCams:!((a=this.params)!=null&&a.camsOff),canUseScreenshare:!((l=this.params)!=null&&l.screenshareOff),canUseDefaultAvatars:!!((u=this.params)!=null&&u.defaultAvatars)&&!((m=(d=this.localParticipant)==null?void 0:d.avatar)!=null&&m.model3DUrl),canUseGather:!!((y=this.params)!=null&&y.enableGather),canUseFollow:!!((C=this.params)!=null&&C.enableFollow),canUseGoTo:!!((h=this.params)!=null&&h.enableGoTo),canUseDefaultToolbar:(w=(E=this.params)==null?void 0:E.defaultToolbar)!=null?w:!0,camerasPosition:(S=(x=this.params)==null?void 0:x.collaborationMode)==null?void 0:S.position,devices:(O=this.params)==null?void 0:O.devices,skipMeetingSettings:(P=this.params)==null?void 0:P.skipMeetingSettings,browserService:this.browserService,offset:(g=this.params)==null?void 0:g.offset,locales:(f=(b=this.params)==null?void 0:b.locales)!=null?f:[],avatars:(T=(p=this.params)==null?void 0:p.avatars)!=null?T:[],customColors:At.get("colors"),collaborationMode:(U=(I=(v=this.params)==null?void 0:v.collaborationMode)==null?void 0:I.enabled)!=null?U:!1,layoutPosition:(D=(W=(z=this.params)==null?void 0:z.collaborationMode)==null?void 0:W.modalPosition)!=null?D:"center",layoutMode:($=(L=(M=this.params)==null?void 0:M.collaborationMode)==null?void 0:L.initialView)!=null?$:"list",waterMark:this.showWaterMarkType},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new To(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video conference @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=t=>{var r;return{id:t.clientId,color:this.realtime.getSlotColor((r=t.data)==null?void 0:r.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video conference @ on connection status change",t);let r=[2,4,3,6];r.includes(t)&&this.realtime.freezeSync(!0),r.includes(this.connectionService.oldConnectionStatus)&&!r.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video conference @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.internalRemoveComponent()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video conference @ on frame state change",t),t===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:At.get("roomId")})};this.onRealtimeEventFromFrame=({event:t,data:r})=>{this.logger.log("video conference @ on realtime event from frame",t,r);let i={["realtime.host-change"]:a=>this.realtime.setHost(a),["realtime.gather"]:a=>this.realtime.setGather(a),["realtime.grid-mode-change"]:a=>this.realtime.setGridMode(a),["realtime.drawing-change"]:a=>{this.realtime.setDrawing(a)},["realtime.follow-participant"]:a=>{this.realtime.setFollowParticipant(a)},["meeting.kick-participant"]:a=>{this.realtime.setKickParticipant(a)},["realtime.transcript-change"]:a=>{this.realtime.setTranscript(a)},["realtime.go-to-participant"]:a=>{this.eventBus.publish("realtime.go-to-participant",a)}}[t](r);this.publish(t,r)};this.onParticipantJoined=t=>{if(this.logger.log("video conference @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type});return}this.realtime.updateMyProperties({name:t.name,type:t.type})};this.onParticipantLeft=t=>{this.logger.log("video conference @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.internalRemoveComponent()};this.onParticipantListUpdate=t=>{this.logger.log("video conference @ on participant list update",t),!(0,Bu.isEqual)(this.participantsOnMeeting,t)&&(this.publish("meeting.participant-list-update",t),this.participantsOnMeeting.length!==t.length&&this.publish("meeting.amount-of-participants-update",t.length),this.participantsOnMeeting=t)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video conference @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.internalRemoveComponent()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.internalRemoveComponent()};this.onRoomInfoUpdated=t=>{this.logger.log("video conference @ on room info updated",t);let{isGridModeEnable:r,followParticipantId:i,gather:a,drawing:l,transcript:u}=t;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",r),this.videoManager.publishMessageToFrame("realtime.drawing-change",l),this.videoManager.publishMessageToFrame("realtime.follow-participant",i),this.videoManager.publishMessageToFrame("realtime.transcript-change",u),this.realtime.hostClientId===this.localParticipant.id&&a&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video conference @ on participants did change",t);let r=Object.values(t).map(i=>({timestamp:i.timestamp,connectionId:i.connectionId,participantId:i.clientId,color:this.realtime.getSlotColor(i.data.slotIndex).name,name:i.data.name,isHost:this.realtime.hostClientId===i.clientId,avatar:i.data.avatar,type:i.data.type}));(0,Bu.isEqual)(this.participantToFrameList,r)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",r),this.participantToFrameList=r};this.onHostParticipantDidChange=t=>{this.logger.log("video conference @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t==null?void 0:t.newHostParticipantId)};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video conference @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video conference @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.params=jt(dt({},t),{userType:(i=(r=t==null?void 0:t.participantType)!=null?r:t==null?void 0:t.userType)!=null?i:"guest"}),this.name="videoConference",this.logger=new te(`@superviz/sdk/${"videoConference"}`),this.browserService=new Oo,this.connectionService=new ha,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){var t;this.logger.log("video conference @ start"),this.publish("meeting.start"),this.params.userType!=="guest"&&(this.localParticipant.type=this.params.userType),this.realtime.setKickParticipantsOnHostLeave(!((t=this.params)!=null&&t.allowGuests)),this.suscribeToRealtimeEvents(),this.showWaterMarkType=At.get("waterMark"),this.startVideo()}destroy(){this.logger.log("video conference @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}internalRemoveComponent(){this.logger.log("video conference @ internal remove component");let{data:t}=this.realtime.participant,r=t.activeComponents.filter(i=>i!=="videoConference");this.realtime.updateMyProperties({activeComponents:r,type:"guest"}),this.realtime.setKickParticipantsOnHostLeave(!1),this.detach()}};N();var xo=class extends on{constructor(t,r){super();this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.animate=()=>{this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.onMyParticipantMouseMove=t=>{let r=this.canvas.getContext("2d"),i=this.canvas.getBoundingClientRect(),a=t.x-i.left,l=t.y-i.top,d=(r==null?void 0:r.getTransform()).inverse(),m=new DOMPoint(a,l).matrixTransform(d);this.realtime.updatePresenceMouse(jt(dt({},this.localParticipant),{x:m.x,y:m.y,visible:!0}))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.keys(t).forEach(r=>{let i=t[r];i.id!==this.localParticipant.id&&this.presences.set(i.id,i)})};this.onMyParticipantMouseOut=()=>{this.realtime.updatePresenceMouse(dt({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=t=>{this.removePresenceMouseParticipant(t.id)};this.updateParticipantsMouses=()=>{this.presences.forEach(t=>{if(!(t!=null&&t.visible)){this.removePresenceMouseParticipant(t.id);return}this.renderPresenMouses(t)})};this.renderPresenMouses=t=>{let i=document.getElementById(`mouse-${t.id}`);i||(i=this.createMouseElement(t));let a=document.getElementById(`mouse-${t.id}`),l=document.getElementById(`mouse-${t.id}`);if(!a||!l)return;let u=a.getElementsByClassName("mouse-user-name")[0],d=l.getElementsByClassName("pointer-mouse")[0];d&&(d.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${t.slotIndex}.svg)`),u&&(u.style.color=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A",u.style.backgroundColor=t.color,u.innerHTML=t.name);let{x:m,y}=t,C=this.canvas.getContext("2d"),h=C==null?void 0:C.getTransform(),E=h==null?void 0:h.e,w=h==null?void 0:h.f,x=m+E,S=y+w,O=this.divWrapper.clientWidth>x&&this.divWrapper.clientHeight>S&&t.visible;i.style.opacity=O?"1":"0",i.style.left=`${x}px`,i.style.top=`${S}px`};if(this.name="presence",this.logger=new te(`@superviz/sdk/${"presence"}`),this.canvas=document.getElementById(t),this.presences=new Map,!this.canvas){let i=`Canvas with id ${t} not found`;throw this.logger.log(i),new Error(i)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=r==null?void 0:r.onGoToPin}get textColorValues(){return[2,4,5,7,8,16]}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}goToMouse(t){let r=this.presences.get(t);if(!r)return;let i=this.canvas.getBoundingClientRect(),{width:a,height:l}=i,{x:u,y:d}=r,m=a/2,y=l/2,C=m-u,h=y-d;this.goToMouseCallback&&this.goToMouseCallback({x:C,y:h})}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),r=document.getElementById("superviz-presence-mouse-wrapper");return r||(r=document.createElement("div"),r.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(r)),r.style.position="fixed",r.style.top=`${t.top}px`,r.style.left=`${t.left}px`,r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,r.style.pointerEvents="none",r.style.overflow="hidden",r.style.zIndex="2",r}removePresenceMouseParticipant(t){let r=document.getElementById(`mouse-${t}`);r&&(r.remove(),this.presences.delete(t))}createMouseElement(t){let r=document.createElement("div");r.setAttribute("id",`mouse-${t.id}`),r.setAttribute("class","mouse-follower");let i=document.createElement("div");i.setAttribute("class","pointer-mouse");let a=document.createElement("div");return a.setAttribute("class","mouse-user-name"),a.innerHTML=t.name,r.appendChild(i),r.appendChild(a),this.divWrapper.appendChild(r),r}};N();N();var ya=class{constructor(e){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("pubsub service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Ct),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("pubsub service @ publish",{event:e,data:t}),this.realtime.setSyncProperty(e,t)};this.publishEventToClient=(e,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(e=>e.destroy()),this.observers.clear()};this.onSyncPropertiesChange=e=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:e}),Object.entries(e).forEach(([t,r])=>{this.publishEventToClient(t,r)})};this.logger=new te("@superviz/sdk/pubsub"),this.realtime=e,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(e){return this.realtime.fetchSyncClientProperty(e)}};N();var ba=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(ba||{}),Ea=(e=>(e.REALTIME_STATE_CHANGED="realtime-component.state-changed",e))(Ea||{});var Io=class extends on{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=(t,r)=>{if(!this.pubsub){let i=`Realtime component is not started yet. You can't publish event ${t} before start`;this.logger.log(i);return}this.pubsub.publish(t,r)};this.subscribe=(t,r)=>{if(!this.pubsub){this.callbacksToSubscribeWhenJoined.push({event:t,callback:r});return}this.pubsub.subscribe(t,r)};this.unsubscribe=(t,r)=>{this.pubsub.unsubscribe(t,r)};this.name="realtime",this.logger=new te("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new ya(this.realtime),this.callbacksToSubscribeWhenJoined.forEach(({event:t,callback:r})=>{this.pubsub.subscribe(t,r)}),this.changeState("STARTED")}fetchHistory(t){return this.pubsub.fetchHistory(t)}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.pubsub.publishEventToClient("realtime-component.state-changed",this.state)}};N();var Hp=On(yo());N();var ku=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(ku||{});var Po=class extends on{constructor(t){super();this.participants=[];this.onParticipantListUpdate=t=>{let i=Object.values(t).filter(({data:a})=>{var l;return(l=a.activeComponents)==null?void 0:l.includes("whoIsOnline")}).map(({data:a})=>{let{slotIndex:l,id:u,name:d,avatar:m}=a,{color:y}=this.realtime.getSlotColor(l),C=this.localParticipant.id===u;return{name:d,id:u,slotIndex:l,color:y,isLocal:C}});(0,Hp.isEqual)(i,this.participants)||(this.participants=i,this.element.participants=this.participants)};this.position=t!=null?t:"top-right",this.name="whoIsOnline",this.logger=new te("@superviz/sdk/who-is-online-component")}start(){this.subscribeToRealtimeEvents(),this.positionWhoIsOnline()}destroy(){this.unsubscribeToRealtimeEvents(),this.element.remove(),this.element=null,this.participants=null}subscribeToRealtimeEvents(){this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)}unsubscribeToRealtimeEvents(){this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(ku).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[i,a]=this.position.split("-");this.element.position=`${i}: 20px; ${a}: 40px;`;return}let r=document.getElementById(this.position);if(!r){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}r.appendChild(this.element),this.element.position="position: relative;"}};N();var qu=On(Iu());N();var $u=(O=>(O.svPrimary="sv-primary",O.svPrimary900="sv-primary-900",O.svPrimary200="sv-primary-200",O.svSecondary="sv-secondary",O.svGray="sv-gray",O.svSuccess="sv-success",O.svDanger="sv-danger",O.svBlack="sv-black",O.svWhite="sv-white",O.svGray100="sv-gray-100",O.svGray200="sv-gray-200",O.svGray300="sv-gray-300",O.svGray400="sv-gray-400",O.svGray500="sv-gray-500",O.svGray600="sv-gray-600",O.svGray700="sv-gray-700",O.svGray800="sv-gray-800",O))($u||{});N();function dT(s,e){return _t(this,null,function*(){try{return(yield ye.validateApiKey(s,e))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var Gp=dT;N();N();var wi=class{static getRemoteConfig(){return _t(this,arguments,function*(e="prod"){let{version:t}=yield Promise.resolve().then(()=>(zp(),Wp));if(e==="local"){let{remoteConfig:a}=yield Promise.resolve().then(()=>(jp(),Vp));return a}let r={version:t,environment:e},i=this.createUrl(r);return Me(i,"GET",null)})}static createUrl({version:e,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${e}?env=${t}`}};wi.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";N();var Ju=On(yo());N();var Ro=class{constructor(){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("event bus service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Ct),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("event bus service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("event bus service @ publish",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(e=>{e.reset(),e.destroy()}),this.observers.clear()};this.logger=new te("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};N();var Mo=class{static checkComponentLimit(e){var i,a;let t=(i=Nu[e])!=null?i:e,r=At.get("limits");return(a=r==null?void 0:r[t])!=null?a:!1}};N();N();var ju=On(Jp()),Tr=On(_u());N();var Gu=(d=>(d[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d))(Gu||{});N();N();var Wu=(O=>(O[O.yellow=0]="yellow",O[O.turquoise=1]="turquoise",O[O.orange=2]="orange",O[O.blue=3]="blue",O[O.pink=4]="pink",O[O.purple=5]="purple",O[O.green=6]="green",O[O.red=7]="red",O[O.bluedark=8]="bluedark",O[O.pinklight=9]="pinklight",O[O.purplelight=10]="purplelight",O[O.greenlight=11]="greenlight",O[O.orangelight=12]="orangelight",O[O.bluelight=13]="bluelight",O[O.redlight=14]="redlight",O[O.brown=15]="brown",O[O.gray=16]="gray",O))(Wu||{}),zu=(s=>(s[s["#FFEF33"]=0]="#FFEF33",s[s["#31E0B0"]=1]="#31E0B0",s[s["#FF5E10"]=2]="#FF5E10",s[s["#00ABF7"]=3]="#00ABF7",s[s["#FF00BB"]=4]="#FF00BB",s[s["#9C29FF"]=5]="#9C29FF",s[s["#6FDD00"]=6]="#6FDD00",s[s["#E30000"]=7]="#E30000",s[s["#304AFF"]=8]="#304AFF",s[s["#FF89C4"]=9]="#FF89C4",s[s["#D597FF"]=10]="#D597FF",s[s["#C6EC5C"]=11]="#C6EC5C",s[s["#FFA115"]=12]="#FFA115",s[s["#75DEFE"]=13]="#75DEFE",s[s["#FAA291"]=14]="#FAA291",s[s["#BB813F"]=15]="#BB813F",s[s["#878291"]=16]="#878291",s))(zu||{});var Aa=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new te("@superviz/sdk/realtime-service"),this.participantsObserver=new Ct({logger:this.logger}),this.participantJoinedObserver=new Ct({logger:this.logger}),this.participantLeaveObserver=new Ct({logger:this.logger}),this.syncPropertiesObserver=new Ct({logger:this.logger}),this.reconnectObserver=new Ct({logger:this.logger}),this.roomInfoUpdatedObserver=new Ct({logger:this.logger}),this.roomListUpdatedObserver=new Ct({logger:this.logger}),this.hostObserver=new Ct({logger:this.logger}),this.hostAvailabilityObserver=new Ct({logger:this.logger}),this.realtimeStateObserver=new Ct({logger:this.logger}),this.kickAllParticipantsObserver=new Ct({logger:this.logger}),this.kickParticipantObserver=new Ct({logger:this.logger}),this.authenticationObserver=new Ct({logger:this.logger}),this.domainRefusedObserver=new Ct({logger:this.logger}),this.commentsObserver=new Ct({logger:this.logger}),this.presenceMouseObserver=new Ct({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Ct({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Ct({logger:this.logger}),this.presenceSlotsInfosObserver=new Ct({logger:this.logger}),this.presence3dObserver=new Ct({logger:this.logger}),this.presence3dLeaveObserver=new Ct({logger:this.logger}),this.presence3dJoinedObserver=new Ct({logger:this.logger})}subscribeToParticipantUpdate(e,t){this.participantObservers[e]||(this.participantObservers[e]=new Ct({logger:this.logger})),this.participantObservers[e].subscribe(t)}unsubscribeFromParticipantUpdate(e,t){this.participantObservers[e]&&this.participantObservers[e].unsubscribe(t)}subscribeToParticipant3DUpdate(e,t){this.participants3DObservers[e]||(this.participants3DObservers[e]=new Ct({logger:this.logger})),this.participants3DObservers[e].subscribe(t)}unsubscribeFromParticipant3DUpdate(e,t){this.participants3DObservers[e]&&this.participants3DObservers[e].unsubscribe(t)}getSlotColor(e){let t=e!=null?e:16;return{color:zu[t],name:Wu[t]}}};var pT=1e3*60,Kp=6e4,mT=1e4,Vu=1e3,Sr=null,xi=class extends Aa{constructor(t,r){super();this.participants={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=t=>{if(!t){this.updateRoomProperties({hostClientId:null});return}let r=this.participants[t];this.updateRoomProperties({hostClientId:r.clientId})};this.setKickParticipant=t=>{if(!t)return;let r=this.participants[t];this.updateRoomProperties({kickParticipant:r})};this.freezeSync=t=>{var r,i;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(r=this.broadcastChannel)==null||r.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t),this.updatePresence3D(this.myParticipant.data)};this.setKickParticipantsOnHostLeave=t=>{this.shouldKickParticipantsOnHostLeave=t};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{if(this.clientSyncPropertiesQueue[t]=this.clientSyncPropertiesQueue[t].sort((l,u)=>l.timestamp-u.timestamp),!this.clientSyncPropertiesQueue[t].length)return;let{data:r,lengthToBeSplitted:i}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[t]),a=r;this.clientSyncPropertiesQueue[t].splice(0,i),this.clientSyncChannel.publish(t,a,l=>{!l||this.logger.log("REALTIME","Error in publish client sync properties",l.message)})})};this.saveClientRoomState=(t,r)=>_t(this,null,function*(){let i=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},i,{[t]:r[r.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=t=>_t(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties);let r=Object.values(this.participants).some(i=>{var a,l;return((l=(a=i.data)==null?void 0:a.activeComponents)==null?void 0:l.includes("videoConference"))&&i.data.type==="host"});t.hostClientId&&r&&Sr&&(clearTimeout(Sr),Sr=null,this.hostAvailabilityObserver.publish(!0)),!t.hostClientId&&r?(this.hostParticipantId=null,this.hostPassingHandle()):!!(t!=null&&t.hostClientId)&&(t==null?void 0:t.hostClientId)!==this.hostParticipantId?this.updateHostInfo(t.hostClientId):!r&&!!(t!=null&&t.hostClientId)?this.updateHostInfo(null):!t.hostClientId&&!Sr&&!r&&this.hostParticipantId&&(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Tr.default)((t={})=>{let r=t;this.isMessageTooBig(r)||this.left||!this.enableSync||this.isSyncFrozen||(r.avatar===void 0&&delete r.avatar,this.myParticipant.data=dt(dt({},this.myParticipant.data),r),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},Vu);this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let r=dt(dt({},this.localRoomProperties),t);this.supervizChannel.publish("update",r)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((r,i)=>{i.forEach(a=>{t[a.clientId]=dt({},a)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=t=>{let r=[];if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{a||r.push({clientId:u.clientId,type:u.data.type})})}),!t||!r.some(a=>a.clientId===t&&a.type==="host")){this.hostPassingHandle();return}Sr&&(clearTimeout(Sr),this.hostAvailabilityObserver.publish(!0));let i=this.hostParticipantId;this.hostParticipantId=t,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var r;let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((r=this.myParticipant)==null?void 0:r.data.type)==="host"&&(t.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(t)};this.hostPassingHandle=(0,Tr.default)(()=>_t(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((t,r)=>{let i=r.filter(l=>l.data.type==="host").map(l=>l.clientId);if(this.shouldKickParticipantsOnHostLeave&&!i.length){this.hostAvailabilityObserver.publish(!1),Sr=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},pT),this.setHost(null);return}let a=i[0];(a===this.localParticipantId||!i.length)&&this.setHost(a)})}),1e3);this.findSlotIndex=t=>{let r=t,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((u,d)=>{if(u){i=[];return}d.forEach(m=>{m.connectionId===r.connectionId&&(r=m),m.connectionId!==r.connectionId&&m.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(m.data.slotIndex),1)})}),i.length===0)return;let a=i[0];this.myParticipant.data.slotIndex=a,this.updateMyProperties({slotIndex:a});let l=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(r)},l)};this.confirmSlot=(0,Tr.default)(t=>_t(this,null,function*(){let r=[],i=t;if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{u.connectionId===i.connectionId&&(i=u),u.connectionId!==i.connectionId&&u.data.slotIndex!==void 0&&r.push(u.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||r.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let a=yield this.fetchRoomProperties();this.updateRoomProperties(a)}}),1e3);this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties()};this.syncBroadcast=(0,Tr.default)(()=>{let t=btoa(this.ablyKey),r=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(r,{headers:{Authorization:`Basic ${t}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(t,r=Kp)=>{let i=JSON.stringify(t);return new TextEncoder().encode(i).length>r?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterPresenceMouseChannel=t=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(t)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel.presence.leave(),this.presenceMouseChannel=null)};this.updatePresenceMouse=(0,Tr.default)(t=>{let r=Object.assign({},this.participantsMouse[t.id]||{},t);this.presenceMouseChannel.presence.update(r)},Vu);this.onPresenceMouseChannelEnter=t=>{let r=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=jt(dt({},t.data),{slotIndex:r,color:this.getSlotColor(r).color}),this.presenceMouseParticipantJoinedObserver.publish(this.participantsMouse[t.clientId])};this.onPresenceMouseChannelLeave=t=>{this.presenceMouseParticipantLeaveObserver.publish(this.participantsMouse[t.clientId]),delete this.participantsMouse[t.clientId]};this.publishPresenceMouseUpdate=t=>{let r=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=jt(dt({},t.data),{slotIndex:r,color:this.getSlotColor(r).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=(0,Tr.default)(t=>{var i,a,l;let r=Object.assign({},(a=(i=this.participantsOn3d[t.id])==null?void 0:i.data)!=null?a:{},t);this.participantsOn3d[t.id]=jt(dt({},this.participants[r.id]),{data:dt(dt({},r),(l=this.participants[r.id])==null?void 0:l.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(r)},Vu);this.onPresence3DChannelEnter=t=>{var i;t.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let r=this.getParticipantSlot(t.clientId);this.presence3dJoinedObserver.publish(jt(dt({},t),{data:jt(dt(dt({},t.data),(i=this.participants[t.clientId])==null?void 0:i.data),{slotIndex:r,color:this.getSlotColor(r).color})}))};this.onPresence3DChannelLeave=t=>{delete this.participantsOn3d[t.clientId],this.presence3dLeaveObserver.publish(t)};this.publish3DUpdate=t=>{var a;let r=this.getParticipantSlot(t.clientId),i=jt(dt({},t),{data:jt(dt(dt({},t.data),(a=this.participants[t.clientId])==null?void 0:a.data),{slotIndex:r,color:this.getSlotColor(r).color})});this.participantsOn3d[t.clientId]=i,this.participants3DObservers[t.clientId]&&this.participants3DObservers[t.clientId].publish(i),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=r,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,r;return(r=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?r:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:r,apiKey:i}){this.myParticipant={data:jt(dt({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${r.toLowerCase()}-${i}`,this.apiKey=i,this.client||this.buildClient()}auth(t,r){if(!this.domainWhitelisted)return;let i=new ju.default.Rest({key:this.ablyKey}),{origin:a}=window.location;i.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:a,apiKey:this.apiKey}},(l,u)=>{var d;l&&this.authenticationObserver.publish("realtime.authentication-failed"),(d=l==null?void 0:l.message)!=null&&d.includes("this domain don't have permission")&&(this.domainWhitelisted=!1,this.domainRefusedObserver.publish(this.domainWhitelisted)),r(l,u)})}join(t){let r=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(r),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{isGridModeEnable:t}))}setDrawing(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{drawing:t}))}setTranscript(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{transcript:t}))}setSyncProperty(t,r){let i=(a,l)=>({name:a,data:l,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(i(t,r),mT)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",t,r),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(i(t,r))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var r,i;if(t){let a=t.toString();if(this.participants&&this.participants[a])return(i=(r=this.participants[t])==null?void 0:r.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){var d,m,y,C,h;if(!this.isJoinedRoom)return;let{clientId:r}=t,i=Object.assign({},t,{participantId:t.clientId}),a=(y=(m=(d=this.participants[i.clientId])==null?void 0:d.data)==null?void 0:m.activeComponents)==null?void 0:y.includes("videoConference"),l=(h=(C=i.data)==null?void 0:C.activeComponents)==null?void 0:h.includes("videoConference"),u=a&&!l;this.publishParticipantUpdate(i),this.participants&&this.participants[r]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast(),u&&this.hostPassingHandle()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:r,data:i}=t,a={};a[r]=i,this.syncPropertiesObserver.publish(a),t.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(r,i)}onReceiveBroadcastSync(t){t.data.forEach(i=>{var l;let a=i.clientId;this.participants[a]=i,(l=i.data)!=null&&l.isAudience||(this.participants[a].data=JSON.parse(this.participants[a].data),this.publishParticipantUpdate(this.participants[a]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new ju.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${Gu[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,r)=>{this.supervizChannel.history((i,a)=>{var u;i&&r(i);let l=(u=a.items[0])==null?void 0:u.data;t(l||null)})})}fetchSyncClientProperty(t){return _t(this,null,function*(){try{let r=yield new Promise((i,a)=>{this.clientRoomStateChannel.history((l,u)=>{var m;l&&a(l);let d=(m=u==null?void 0:u.items[0])==null?void 0:m.data;i(d||null)})});if(t&&!r[t])throw new Error(`Event ${t} not found in the history`);return t?r[t]:r}catch(r){this.logger.log("REALTIME","Error in fetch client realtime data",r.message),this.throw(r.message)}})}onStateChange(){var y,C,h;let t=(y=this.supervizChannelState)==null?void 0:y.current,r=(C=this.connectionState)==null?void 0:C.current,i=r==="connected",a=["initialized","connecting"].includes(r),l=["closed","closing"].includes(r)||["detaching","detached"].includes(t),u={[0]:l,[1]:a,[2]:!t&&i,[3]:t==="attaching",[4]:t==="attached"&&i,[-1]:t==="failed"||r==="failed",[-2]:r==="suspended"||t==="suspended"},d=Object.entries(u).find(([E,w])=>w&&E)[0],m=Number(d);if(!!this.domainWhitelisted){if(m===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(h=this.connectionState)!=null&&h.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return _t(this,null,function*(){var r;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(t),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let i=this.myParticipant.data.type==="host";(r=this.localRoomProperties)!=null&&r.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):i&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;let r=t.data.participantId===this.hostParticipantId;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),r&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}spliceArrayBySize(t,r=Kp){let i=d=>{let m=JSON.stringify(d);return new TextEncoder().encode(m).length},a=0,l=[],u=[];for(let d=0;d<t.length;d++){let m=i(t[d]);a+m<=r?(u.push(t[d]),a+=m):(l.push(u),u=[t[d]],a=m)}return u.length>0&&l.push(u),{data:l[0],lengthToBeSplitted:l[0].length}}enterPresence3DChannel(t){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(t)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(t)}};N();var Ku=class extends Or{constructor({participant:t,group:r}){super();this.isDestroyed=!1;this.activeComponents=[];this.activeComponentsInstances=[];this.eventBus=new Ro;this.participants=[];this.addComponent=t=>{var r,i;!this.canAddComponent(t)||(t.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:At.configuration,eventBus:this.eventBus}),this.activeComponents.push(t.name),this.activeComponentsInstances.push(t),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),ye.sendActivity(this.participant.id,this.group.id,this.group.name,t.name),ye.createOrUpdateParticipant(At.get("apiKey"),{name:(r=this.participant)==null?void 0:r.name,participantId:(i=this.participant)==null?void 0:i.id}))};this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let r=`Component ${t.name} is not initialized yet.`;this.logger.log(r);return}t.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(r=>r.name!==t.name),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.destroy=()=>{this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(t=>{this.logger.log("launcher service @ destroy - removing component",t.name),this.removeComponent(t)}),this.activeComponents=[],this.activeComponentsInstances=[],this.participant=void 0,this.eventBus.destroy(),this.eventBus=void 0,this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeave),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.unsubscribe(this.onHostAvailabilityChange),this.realtime.leave(),this.realtime=void 0,this.isDestroyed=!0};this.canAddComponent=t=>{var u;let r=(u=this.realtime)==null?void 0:u.isDomainWhitelisted,i=Mo.checkComponentLimit(t.name),a=this.activeComponents.includes(t.name),l=[{isValid:!this.isDestroyed,message:"Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:r,message:`Component ${t.name} can't be used because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dev-dashboard.superviz.com/developer`},{isValid:!a,message:`Component ${t.name} is already active. Please remove it first`},{isValid:i,message:`You reached the limit usage of ${t.name}`}];for(let d=0;d<l.length;d++){let{isValid:m,message:y}=l[d];if(!m)return this.logger.log(y),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:At.get("apiKey"),roomId:At.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=t=>{var a;this.logger.log("launcher service @ onParticipantListUpdate",t);let r=Object.values(t).map(l=>{var u,d,m,y,C,h;return{id:l.data.id,name:(u=l.data)==null?void 0:u.name,type:(d=l.data)==null?void 0:d.type,avatar:(m=l.data)==null?void 0:m.avatar,avatarConfig:(y=l.data)==null?void 0:y.avatarConfig,isHost:this.realtime.hostClientId===l.clientId,color:this.realtime.getSlotColor((C=l.data)==null?void 0:C.slotIndex).color,activeComponents:(h=l.data)==null?void 0:h.activeComponents}}),i=r.find(l=>{var u;return(l==null?void 0:l.id)===((u=this.participant)==null?void 0:u.id)});(0,Ju.isEqual)(this.participants,r)||(this.participants=r,this.publish("participant.list-updated",r),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",r)),i&&!(0,Ju.isEqual)(this.participant,i)&&(this.activeComponents=(a=i.activeComponents)!=null?a:[],this.activeComponentsInstances=this.activeComponentsInstances.filter(l=>i.activeComponents?this.activeComponents.includes(l.name):!0),this.participant=i,this.publish("participant.updated",i),this.logger.log("Publishing ParticipantEvent.UPDATED",i)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",r)};this.onParticipantJoined=t=>{this.logger.log("launcher service @ onParticipantJoined");let r=this.participants.find(i=>i.id===t.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",r)),this.logger.log("launcher service @ onParticipantJoined - participant joined",r),this.publish("participant.joined",r))};this.onParticipantLeave=t=>{this.logger.log("launcher service @ onParticipantLeave");let r=this.participants.find(i=>i.id===t.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",r)),this.logger.log("launcher service @ onParticipantLeave - participant left",r),this.publish("participant.left",r))};this.onHostParticipantDidChange=t=>{let r=this.participants.find(i=>i.id===(t==null?void 0:t.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",r),this.publish("realtime.host-change",r))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=jt(dt({},t),{type:"guest"}),this.group=r,this.logger=new te("@superviz/sdk/launcher"),this.realtime=new xi(At.get("apiUrl"),At.get("ablyKey")),this.eventBus=new Ro,this.logger.log("launcher created"),this.startRealtime()}},qp=s=>{let e=new Ku(s);return{destroy:e.destroy,subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}};var gT=({group:s,participant:e,roomId:t,customColors:r})=>{if(r&&vT(r),!s||!s.name||!s.id)throw new Error("Group fields is required");if(!e||!e.id||!e.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},vT=s=>{Object.entries(s).forEach(([e,t])=>{if(!Object.values($u).includes(e))throw new Error(`Color ${e} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(t))throw new Error(`Color ${e} is not a valid color variable value. Please check the documentation for more information.`)})},yT=(s,e)=>_t(void 0,null,function*(){if(!(s&&s.trim()))throw new Error("API key is required");if(!e)throw new Error("Options is required");gT(e),e.debug?qu.debug.enable("*"):qu.debug.disable();let{apiUrl:r,conferenceLayerUrl:i}=yield wi.getRemoteConfig(e.environment);if(!(yield Gp(r,s)))throw new Error("Failed to validate API key");let l=yield ye.fetchConfig(r,s),u=yield ye.fetchLimits(r,s),d=yield ye.fetchWaterMark(r,s);if(!l||!l.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:m}=l;return At.setConfig({apiUrl:r,ablyKey:m,apiKey:s,conferenceLayerUrl:i,environment:l,roomId:e.roomId,debug:e.debug,limits:u,waterMark:d,colors:e.customColors}),qp(e)}),Zu=yT;N();N();N();N();N();var Oa=globalThis,Ta=Oa.ShadowRoot&&(Oa.ShadyCSS===void 0||Oa.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Yp=Symbol(),Zp=new WeakMap,Sa=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==Yp)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Ta&&e===void 0){let r=t!==void 0&&t.length===1;r&&(e=Zp.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&Zp.set(t,e))}return e}toString(){return this.cssText}},Qp=s=>new Sa(typeof s=="string"?s:s+"",void 0,Yp);var Yu=(s,e)=>{if(Ta)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let r=document.createElement("style"),i=Oa.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,s.appendChild(r)}},wa=Ta?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return Qp(t)})(s):s;var{is:bT,defineProperty:ET,getOwnPropertyDescriptor:CT,getOwnPropertyNames:AT,getOwnPropertySymbols:OT,getPrototypeOf:ST}=Object,nr=globalThis,Xp=nr.trustedTypes,TT=Xp?Xp.emptyScript:"",Qu=nr.reactiveElementPolyfillSupport,_o=(s,e)=>s,xa={toAttribute(s,e){switch(e){case Boolean:s=s?TT:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(r){t=null}}return t}},Xu=(s,e)=>!bT(s,e),tm={attribute:!0,type:String,converter:xa,reflect:!1,hasChanged:Xu},em,nm;(em=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(nm=nr.litPropertyMetadata)!=null||(nr.litPropertyMetadata=new WeakMap);var wr=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=tm){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&ET(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){var l;let{get:i,set:a}=(l=CT(this.prototype,e))!=null?l:{get(){return this[t]},set(u){this[t]=u}};return{get(){return i==null?void 0:i.call(this)},set(u){let d=i==null?void 0:i.call(this);a.call(this,u),this.requestUpdate(e,d,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:tm}static _$Ei(){if(this.hasOwnProperty(_o("elementProperties")))return;let e=ST(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(_o("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(_o("properties"))){let t=this.properties,r=[...AT(t),...OT(t)];for(let i of r)this.createProperty(i,t[i])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[t,r]of this.elementProperties){let i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let r=new Set(e.flat(1/0).reverse());for(let i of r)t.unshift(wa(i))}else e!==void 0&&t.push(wa(e));return t}static _$Eu(e,t){let r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,r;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return Yu(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$EO(e,t){var a;let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){let l=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:xa).toAttribute(t,r.type);this._$Em=e,l==null?this.removeAttribute(i):this.setAttribute(i,l),this._$Em=null}}_$AK(e,t){var a;let r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){let l=r.getPropertyOptions(i),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:xa;this._$Em=i,this[i]=u.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,r,i=!1,a){var l;if(e!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(e)),!((l=r.hasChanged)!=null?l:Xu)(i?a:this[e],t))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,r){var i;this._$AL.has(e)||this._$AL.set(e,t),r.reflect===!0&&this._$Em!==e&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(e)}_$EP(){return _t(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,l]of i)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(t)):this._$ET()}catch(i){throw e=!1,this._$ET(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},rm;wr.elementStyles=[],wr.shadowRootOptions={mode:"open"},wr[_o("elementProperties")]=new Map,wr[_o("finalized")]=new Map,Qu==null||Qu({ReactiveElement:wr}),((rm=nr.reactiveElementVersions)!=null?rm:nr.reactiveElementVersions=[]).push("2.0.0");N();var No=globalThis,Ia=No.trustedTypes,im=Ia?Ia.createPolicy("lit-html",{createHTML:s=>s}):void 0,nc="$lit$",Bn=`lit$${(Math.random()+"").slice(9)}$`,rc="?"+Bn,wT=`<${rc}>`,Pr=document,Pa=()=>Pr.createComment(""),Do=s=>s===null||typeof s!="object"&&typeof s!="function",dm=Array.isArray,fm=s=>dm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",tc=`[ 	
\f\r]`,Lo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,om=/-->/g,sm=/>/g,xr=RegExp(`>|${tc}(?:([^\\s"'>=/]+)(${tc}*=${tc}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),am=/'/g,lm=/"/g,hm=/^(?:script|style|textarea|title)$/i,pm=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),oR=pm(1),sR=pm(2),kn=Symbol.for("lit-noChange"),we=Symbol.for("lit-nothing"),um=new WeakMap,Ir=Pr.createTreeWalker(Pr,129);function mm(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return im!==void 0?im.createHTML(e):e}var gm=(s,e)=>{let t=s.length-1,r=[],i,a=e===2?"<svg>":"",l=Lo;for(let u=0;u<t;u++){let d=s[u],m,y,C=-1,h=0;for(;h<d.length&&(l.lastIndex=h,y=l.exec(d),y!==null);)h=l.lastIndex,l===Lo?y[1]==="!--"?l=om:y[1]!==void 0?l=sm:y[2]!==void 0?(hm.test(y[2])&&(i=RegExp("</"+y[2],"g")),l=xr):y[3]!==void 0&&(l=xr):l===xr?y[0]===">"?(l=i!=null?i:Lo,C=-1):y[1]===void 0?C=-2:(C=l.lastIndex-y[2].length,m=y[1],l=y[3]===void 0?xr:y[3]==='"'?lm:am):l===lm||l===am?l=xr:l===om||l===sm?l=Lo:(l=xr,i=void 0);let E=l===xr&&s[u+1].startsWith("/>")?" ":"";a+=l===Lo?d+wT:C>=0?(r.push(m),d.slice(0,C)+nc+d.slice(C)+Bn+E):d+Bn+(C===-2?u:E)}return[mm(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),r]},Rr=class{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let a=0,l=0,u=e.length-1,d=this.parts,[m,y]=gm(e,t);if(this.el=Rr.createElement(m,r),Ir.currentNode=this.el.content,t===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Ir.nextNode())!==null&&d.length<u;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(nc)){let h=y[l++],E=i.getAttribute(C).split(Bn),w=/([.?@])?(.*)/.exec(h);d.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?Ma:w[1]==="?"?_a:w[1]==="@"?La:Lr}),i.removeAttribute(C)}else C.startsWith(Bn)&&(d.push({type:6,index:a}),i.removeAttribute(C));if(hm.test(i.tagName)){let C=i.textContent.split(Bn),h=C.length-1;if(h>0){i.textContent=Ia?Ia.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],Pa()),Ir.nextNode(),d.push({type:2,index:++a});i.append(C[h],Pa())}}}else if(i.nodeType===8)if(i.data===rc)d.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(Bn,C+1))!==-1;)d.push({type:7,index:a}),C+=Bn.length-1}a++}}static createElement(e,t){let r=Pr.createElement("template");return r.innerHTML=e,r}};function Mr(s,e,t=s,r){var l,u,d;if(e===kn)return e;let i=r!==void 0?(l=t._$Co)==null?void 0:l[r]:t._$Cl,a=Do(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((u=i==null?void 0:i._$AO)==null||u.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,t,r)),r!==void 0?((d=t._$Co)!=null?d:t._$Co=[])[r]=i:t._$Cl=i),i!==void 0&&(e=Mr(s,i._$AS(s,e.values),i,r)),e}var Ra=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:r}=this._$AD,i=((m=e==null?void 0:e.creationScope)!=null?m:Pr).importNode(t,!0);Ir.currentNode=i;let a=Ir.nextNode(),l=0,u=0,d=r[0];for(;d!==void 0;){if(l===d.index){let y;d.type===2?y=new _r(a,a.nextSibling,this,e):d.type===1?y=new d.ctor(a,d.name,d.strings,this,e):d.type===6&&(y=new Na(a,this,e)),this._$AV.push(y),d=r[++u]}l!==(d==null?void 0:d.index)&&(a=Ir.nextNode(),l++)}return Ir.currentNode=Pr,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},_r=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,r,i){var a;this.type=2,this._$AH=we,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Mr(this,e,t),Do(e)?e===we||e==null||e===""?(this._$AH!==we&&this._$AR(),this._$AH=we):e!==this._$AH&&e!==kn&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):fm(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==we&&Do(this._$AH)?this._$AA.nextSibling.data=e:this.$(Pr.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Rr.createElement(mm(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(t);else{let l=new Ra(i,this),u=l.u(this.options);l.p(t),this.$(u),this._$AH=l}}_$AC(e){let t=um.get(e.strings);return t===void 0&&um.set(e.strings,t=new Rr(e)),t}T(e){dm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let a of e)i===t.length?t.push(r=new _r(this.k(Pa()),this.k(Pa()),this,this.options)):r=t[i],r._$AI(a),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e&&e!==this._$AB;){let i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Lr=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,a){this.type=1,this._$AH=we,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=we}_$AI(e,t=this,r,i){let a=this.strings,l=!1;if(a===void 0)e=Mr(this,e,t,0),l=!Do(e)||e!==this._$AH&&e!==kn,l&&(this._$AH=e);else{let u=e,d,m;for(e=a[0],d=0;d<a.length-1;d++)m=Mr(this,u[r+d],t,d),m===kn&&(m=this._$AH[d]),l||(l=!Do(m)||m!==this._$AH[d]),m===we?e=we:e!==we&&(e+=(m!=null?m:"")+a[d+1]),this._$AH[d]=m}l&&!i&&this.j(e)}j(e){e===we?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},Ma=class extends Lr{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===we?void 0:e}},_a=class extends Lr{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==we)}},La=class extends Lr{constructor(e,t,r,i,a){super(e,t,r,i,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Mr(this,e,t,0))!=null?l:we)===kn)return;let r=this._$AH,i=e===we&&r!==we||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==we&&(r===we||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;typeof this._$AH=="function"?this._$AH.call((r=(t=this.options)==null?void 0:t.host)!=null?r:this.element,e):this._$AH.handleEvent(e)}},Na=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Mr(this,e)}},vm={S:nc,A:Bn,P:rc,C:1,M:gm,L:Ra,R:fm,V:Mr,D:_r,I:Lr,H:_a,N:La,U:Ma,B:Na},ec=No.litHtmlPolyfillSupport,cm;ec==null||ec(Rr,_r),((cm=No.litHtmlVersions)!=null?cm:No.litHtmlVersions=[]).push("3.0.0");N();N();N();var Da=globalThis,Fa=Da.ShadowRoot&&(Da.ShadyCSS===void 0||Da.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ic=Symbol(),ym=new WeakMap,Fo=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==ic)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Fa&&e===void 0){let r=t!==void 0&&t.length===1;r&&(e=ym.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&ym.set(t,e))}return e}toString(){return this.cssText}},bm=s=>new Fo(typeof s=="string"?s:s+"",void 0,ic),It=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((r,i,a)=>r+(l=>{if(l._$cssResult$===!0)return l.cssText;if(typeof l=="number")return l;throw Error("Value passed to 'css' function must be a 'css' function result: "+l+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[a+1],s[0]);return new Fo(t,s,ic)},oc=(s,e)=>{if(Fa)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let r=document.createElement("style"),i=Da.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,s.appendChild(r)}},Ua=Fa?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return bm(t)})(s):s;var{is:xT,defineProperty:IT,getOwnPropertyDescriptor:PT,getOwnPropertyNames:RT,getOwnPropertySymbols:MT,getPrototypeOf:_T}=Object,rr=globalThis,Em=rr.trustedTypes,LT=Em?Em.emptyScript:"",sc=rr.reactiveElementPolyfillSupport,Uo=(s,e)=>s,ac={toAttribute(s,e){switch(e){case Boolean:s=s?LT:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(r){t=null}}return t}},Tm=(s,e)=>!xT(s,e),Cm={attribute:!0,type:String,converter:ac,reflect:!1,hasChanged:Tm},Am,Om;(Am=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Om=rr.litPropertyMetadata)!=null||(rr.litPropertyMetadata=new WeakMap);var $n=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Cm){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&IT(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){var l;let{get:i,set:a}=(l=PT(this.prototype,e))!=null?l:{get(){return this[t]},set(u){this[t]=u}};return{get(){return i==null?void 0:i.call(this)},set(u){let d=i==null?void 0:i.call(this);a.call(this,u),this.requestUpdate(e,d,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:Cm}static _$Ei(){if(this.hasOwnProperty(Uo("elementProperties")))return;let e=_T(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Uo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Uo("properties"))){let t=this.properties,r=[...RT(t),...MT(t)];for(let i of r)this.createProperty(i,t[i])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[t,r]of this.elementProperties){let i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let r=new Set(e.flat(1/0).reverse());for(let i of r)t.unshift(Ua(i))}else e!==void 0&&t.push(Ua(e));return t}static _$Eu(e,t){let r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,r;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return oc(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$EO(e,t){var a;let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){let l=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:ac).toAttribute(t,r.type);this._$Em=e,l==null?this.removeAttribute(i):this.setAttribute(i,l),this._$Em=null}}_$AK(e,t){var a;let r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){let l=r.getPropertyOptions(i),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:ac;this._$Em=i,this[i]=u.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,r,i=!1,a){var l;if(e!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(e)),!((l=r.hasChanged)!=null?l:Tm)(i?a:this[e],t))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,r){var i;this._$AL.has(e)||this._$AL.set(e,t),r.reflect===!0&&this._$Em!==e&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(e)}_$EP(){return _t(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,l]of i)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(t)):this._$ET()}catch(i){throw e=!1,this._$ET(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},Sm;$n.elementStyles=[],$n.shadowRootOptions={mode:"open"},$n[Uo("elementProperties")]=new Map,$n[Uo("finalized")]=new Map,sc==null||sc({ReactiveElement:$n}),((Sm=rr.reactiveElementVersions)!=null?Sm:rr.reactiveElementVersions=[]).push("2.0.0");N();var ko=globalThis,Ba=ko.trustedTypes,wm=Ba?Ba.createPolicy("lit-html",{createHTML:s=>s}):void 0,Lm="$lit$",ir=`lit$${(Math.random()+"").slice(9)}$`,Nm="?"+ir,NT=`<${Nm}>`,Fr=document,$o=()=>Fr.createComment(""),Ho=s=>s===null||typeof s!="object"&&typeof s!="function",Dm=Array.isArray,DT=s=>Dm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",lc=`[ 	
\f\r]`,Bo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,xm=/-->/g,Im=/>/g,Nr=RegExp(`>|${lc}(?:([^\\s"'>=/]+)(${lc}*=${lc}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Pm=/'/g,Rm=/"/g,Fm=/^(?:script|style|textarea|title)$/i,Um=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),gt=Um(1),fR=Um(2),Ur=Symbol.for("lit-noChange"),xe=Symbol.for("lit-nothing"),Mm=new WeakMap,Dr=Fr.createTreeWalker(Fr,129);function Bm(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return wm!==void 0?wm.createHTML(e):e}var FT=(s,e)=>{let t=s.length-1,r=[],i,a=e===2?"<svg>":"",l=Bo;for(let u=0;u<t;u++){let d=s[u],m,y,C=-1,h=0;for(;h<d.length&&(l.lastIndex=h,y=l.exec(d),y!==null);)h=l.lastIndex,l===Bo?y[1]==="!--"?l=xm:y[1]!==void 0?l=Im:y[2]!==void 0?(Fm.test(y[2])&&(i=RegExp("</"+y[2],"g")),l=Nr):y[3]!==void 0&&(l=Nr):l===Nr?y[0]===">"?(l=i!=null?i:Bo,C=-1):y[1]===void 0?C=-2:(C=l.lastIndex-y[2].length,m=y[1],l=y[3]===void 0?Nr:y[3]==='"'?Rm:Pm):l===Rm||l===Pm?l=Nr:l===xm||l===Im?l=Bo:(l=Nr,i=void 0);let E=l===Nr&&s[u+1].startsWith("/>")?" ":"";a+=l===Bo?d+NT:C>=0?(r.push(m),d.slice(0,C)+Lm+d.slice(C)+ir+E):d+ir+(C===-2?u:E)}return[Bm(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),r]},Br=class{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let a=0,l=0,u=e.length-1,d=this.parts,[m,y]=FT(e,t);if(this.el=Br.createElement(m,r),Dr.currentNode=this.el.content,t===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Dr.nextNode())!==null&&d.length<u;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(Lm)){let h=y[l++],E=i.getAttribute(C).split(ir),w=/([.?@])?(.*)/.exec(h);d.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?dc:w[1]==="?"?fc:w[1]==="@"?hc:Pi}),i.removeAttribute(C)}else C.startsWith(ir)&&(d.push({type:6,index:a}),i.removeAttribute(C));if(Fm.test(i.tagName)){let C=i.textContent.split(ir),h=C.length-1;if(h>0){i.textContent=Ba?Ba.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],$o()),Dr.nextNode(),d.push({type:2,index:++a});i.append(C[h],$o())}}}else if(i.nodeType===8)if(i.data===Nm)d.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(ir,C+1))!==-1;)d.push({type:7,index:a}),C+=ir.length-1}a++}}static createElement(e,t){let r=Fr.createElement("template");return r.innerHTML=e,r}};function Ii(s,e,t=s,r){var l,u,d;if(e===Ur)return e;let i=r!==void 0?(l=t._$Co)==null?void 0:l[r]:t._$Cl,a=Ho(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((u=i==null?void 0:i._$AO)==null||u.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,t,r)),r!==void 0?((d=t._$Co)!=null?d:t._$Co=[])[r]=i:t._$Cl=i),i!==void 0&&(e=Ii(s,i._$AS(s,e.values),i,r)),e}var cc=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:r}=this._$AD,i=((m=e==null?void 0:e.creationScope)!=null?m:Fr).importNode(t,!0);Dr.currentNode=i;let a=Dr.nextNode(),l=0,u=0,d=r[0];for(;d!==void 0;){if(l===d.index){let y;d.type===2?y=new kr(a,a.nextSibling,this,e):d.type===1?y=new d.ctor(a,d.name,d.strings,this,e):d.type===6&&(y=new pc(a,this,e)),this._$AV.push(y),d=r[++u]}l!==(d==null?void 0:d.index)&&(a=Dr.nextNode(),l++)}return Dr.currentNode=Fr,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},kr=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,r,i){var a;this.type=2,this._$AH=xe,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ii(this,e,t),Ho(e)?e===xe||e==null||e===""?(this._$AH!==xe&&this._$AR(),this._$AH=xe):e!==this._$AH&&e!==Ur&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):DT(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==xe&&Ho(this._$AH)?this._$AA.nextSibling.data=e:this.$(Fr.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Br.createElement(Bm(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(t);else{let l=new cc(i,this),u=l.u(this.options);l.p(t),this.$(u),this._$AH=l}}_$AC(e){let t=Mm.get(e.strings);return t===void 0&&Mm.set(e.strings,t=new Br(e)),t}T(e){Dm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let a of e)i===t.length?t.push(r=new kr(this.k($o()),this.k($o()),this,this.options)):r=t[i],r._$AI(a),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e&&e!==this._$AB;){let i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Pi=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,a){this.type=1,this._$AH=xe,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=xe}_$AI(e,t=this,r,i){let a=this.strings,l=!1;if(a===void 0)e=Ii(this,e,t,0),l=!Ho(e)||e!==this._$AH&&e!==Ur,l&&(this._$AH=e);else{let u=e,d,m;for(e=a[0],d=0;d<a.length-1;d++)m=Ii(this,u[r+d],t,d),m===Ur&&(m=this._$AH[d]),l||(l=!Ho(m)||m!==this._$AH[d]),m===xe?e=xe:e!==xe&&(e+=(m!=null?m:"")+a[d+1]),this._$AH[d]=m}l&&!i&&this.j(e)}j(e){e===xe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},dc=class extends Pi{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===xe?void 0:e}},fc=class extends Pi{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==xe)}},hc=class extends Pi{constructor(e,t,r,i,a){super(e,t,r,i,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Ii(this,e,t,0))!=null?l:xe)===Ur)return;let r=this._$AH,i=e===xe&&r!==xe||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==xe&&(r===xe||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;typeof this._$AH=="function"?this._$AH.call((r=(t=this.options)==null?void 0:t.host)!=null?r:this.element,e):this._$AH.handleEvent(e)}},pc=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Ii(this,e)}};var uc=ko.litHtmlPolyfillSupport,_m;uc==null||uc(Br,kr),((_m=ko.litHtmlVersions)!=null?_m:ko.litHtmlVersions=[]).push("3.0.0");var km=(s,e,t)=>{var a,l;let r=(a=t==null?void 0:t.renderBefore)!=null?a:e,i=r._$litPart$;if(i===void 0){let u=(l=t==null?void 0:t.renderBefore)!=null?l:null;r._$litPart$=i=new kr(e.insertBefore($o(),u),u,void 0,t!=null?t:{})}return i._$AI(s),i};var Pt=class extends $n{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,r;let e=super.createRenderRoot();return(r=(t=this.renderOptions).renderBefore)!=null||(t.renderBefore=e.firstChild),e}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=km(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Ur}},$m;Pt._$litElement$=!0,Pt["finalized"]=!0,($m=globalThis.litElementHydrateSupport)==null||$m.call(globalThis,{LitElement:Pt});var mc=globalThis.litElementPolyfillSupport;mc==null||mc({LitElement:Pt});var Hm;((Hm=globalThis.litElementVersions)!=null?Hm:globalThis.litElementVersions=[]).push("4.0.0");N();N();N();var $t=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};N();N();N();N();N();N();N();N();N();var $r=class extends Pt{render(){return gt` <div>Hello from SuperViz, ${this.name}</div> `}};$r.properties={name:{type:String}},$r.styles=It`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,$r=kt([$t("superviz-hello-world")],$r);N();N();N();N();var gc=It`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;N();var vc=It`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;N();var yc=It`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;N();var bc=It`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }

  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }
`;var Gt=s=>{var t;class e extends s{connectedCallback(){setTimeout(()=>{var u,d;let i=document.getElementById("superviz-style"),a=this.createCustomColors(),l=document.createElement("style");l.innerHTML=(i==null?void 0:i.innerHTML)||"",(u=this.shadowRoot)==null||u.appendChild(l),a&&((d=this.shadowRoot)==null||d.appendChild(a))}),super.connectedCallback()}createCustomColors(){if(!At.get("colors"))return;let i=document.createElement("style"),a=Object.entries(At.get("colors")).map(([l,u])=>`--${l}: ${u} !important;`).join(" ");return i.innerHTML=`
      * {
        ${a}
      }
    `,i}emitEvent(i,a,l={composed:!0,bubbles:!0}){let u=new CustomEvent(i,dt({detail:a},l));this.dispatchEvent(u)}}return e.styles=[gc,vc,yc,bc,(t=s.styles)!=null?t:[]],e};var Gm=Gt(Pt),UT=[Gm.styles],Hr=class extends Gm{constructor(){super();this.name="",this.size="md"}render(){return gt` <i class="sv-icon sv-icon-${this.name}_${this.size}"></i> `}};Hr.properties={name:{type:String},size:{type:String}},Hr.styles=[UT,It`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }
    `],Hr=kt([$t("superviz-icon")],Hr);N();N();N();N();var $a={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Ha=s=>(...e)=>({_$litDirective$:s,values:e}),Ri=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var ne=Ha(class extends Ri{constructor(s){var e;if(super(s),s.type!==$a.ATTRIBUTE||s.name!=="class"||((e=s.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){var r,i;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(a=>a!=="")));for(let a in e)e[a]&&!((r=this.st)!=null&&r.has(a))&&this.it.add(a);return this.render(e)}let t=s.element.classList;for(let a of this.it)a in e||(t.remove(a),this.it.delete(a));for(let a in e){let l=!!e[a];l===this.it.has(a)||((i=this.st)==null?void 0:i.has(a))||(l?(t.add(a),this.it.add(a)):(t.remove(a),this.it.delete(a)))}return kn}});N();var Wm=It`
  .dropdown {
    position: relative;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .header {
    display: flex;
    flex-direction: column;
    gap: 5px;
    padding: 5px 10px 0;
    font-size: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .who-is-online-dropdown {
    padding: 4px;
  }

  .items {
    list-style: none;
    padding: 0;
    color: #9fa5b5;
    margin: 0;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    right: 0;
    top: 4px;
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 4px;
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    left: 0;
    top: 4px;
  }

  .menu--top-left {
    min-width: 103px;
    position: absolute;
    right: 0;
    bottom: 44px;
  }

  .menu--top-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 44px;
  }

  .menu--top-right {
    min-width: 103px;
    position: absolute;
    left: 0;
    bottom: 44px;
  }

  .items li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 5px 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
  }

  .sv-icon {
    width: 40px;
    height: 40px;
    background-color: red;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .items li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .sv-hr {
    width: 100%;
    height: 0.8px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }

  @media (max-width: 780px) {
    .menu--top-left,
    .menu--top-center,
    .menu--top-right {
      bottom: 36px;
    }
  }
`;N();var zm=Gt(Pt),BT=[zm.styles,Wm],Gr=class extends zm{constructor(){super(...arguments);this.menu=void 0;this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let r=t.composedPath(),i=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],d=r.includes(i),m=r.includes(a),y=r.includes(u);d||m||y||(this.open=!1)};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let r=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",r,{bubbles:!1,composed:!1})};this.adjustPosition=()=>{this.adjustPositionVertical(),this.adjustPositionHorizontal()}}updated(t){if(!!t.has("open")){if(this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown),this.close()}}get dropdownBounds(){this.dropdownContent||(this.dropdownContent=this.shadowRoot.querySelector(".dropdown-content"));let t=this.dropdownContent.getBoundingClientRect(),{y:r,height:i,x:a,width:l}=this.menu.getBoundingClientRect();return{top:r,bottom:r+i+4,left:a,right:a+l,height:i+4,width:l,contentX:t.x,contentY:t.y,contentWidth:t.width}}positionVerticalAction(){let{top:t,bottom:r}=this.dropdownBounds,{innerHeight:i}=window,a=r>i,l=t<0;return a&&this.position.includes("bottom")||l&&this.position.includes("top")?2:!a&&!l&&this.shouldUseOriginalVertical()?1:0}positionHorizontalAction(){if(this.dropdownCovered())return 0;let{right:t,left:r,contentX:i,contentWidth:a,width:l}=this.dropdownBounds,{innerWidth:u}=window,d=t>u,y=r<0||d;if(y&&!this.position.includes("center"))return 2;if(this.position.includes("center")){let C=i+a/2,h=C-l/2<0,E=C+l/2>u;if(h||E)return 2}return!y&&this.shouldUseOriginalHorizontal()?1:this.shouldCenter()&&this.position!==this.originalPosition&&!this.position.includes("center")?3:0}dropdownCovered(){let{left:t,right:r}=this.dropdownBounds,{innerWidth:i}=window;if(this.position.includes("center"))return!1;let a=r>i&&this.position.includes("left"),l=t<0&&this.position.includes("right");return a||l}shouldCenter(){let{contentX:t,contentWidth:r,width:i}=this.dropdownBounds,a=t+r/2,l=a-i/2<0,u=a+i/2>window.innerWidth;return!(l||u)}shouldUseOriginalVertical(){let{height:t,contentY:r}=this.dropdownBounds,{innerHeight:i}=window,a=r+t;return this.originalPosition.includes("bottom")?t+a<i:r-t>0}shouldUseOriginalHorizontal(){let{width:t,contentX:r}=this.dropdownBounds,{innerWidth:i}=window,a=r+t;return this.position===this.originalPosition?!1:this.originalPosition.includes("center")?a<i&&r-t>0:this.originalPosition.includes("left")?r-t>0:a<i}adjustPositionVertical(){let{top:t,bottom:r}=this.dropdownBounds,{innerHeight:i}=window,a=this.positionVerticalAction();if(a===0)return;if(a===1){let m=this.originalPosition.split("-")[0];this.position=this.position.replace(/top|bottom/,m);return}let l=i-r>t?"bottom":"top",u=this.position.split("-")[0],d=this.position.replace(u,l);this.position=d}adjustPositionHorizontal(){let{left:t,right:r,width:i}=this.dropdownBounds,a=t<0,l=r>window.innerWidth,u=this.positionHorizontalAction();if(u===0)return;if(u===1){let w=this.originalPosition.split("-")[1];this.position=this.position.replace(/left|center|right/,w);return}let d=a?r:t,m=(a?i:-i)/2-20,y=d+m;if(a=y<0,l=y+i>window.innerWidth,!(a||l)&&u===3||u===3){let w=this.position.replace(/left|right/,"center");this.position=w;return}if(this.position.includes("center")){let w=a?"right":"left",x=this.position.replace("center",w);this.position=x;return}let E=this.position.replace(/left|right/,"center");this.position=E}setMenu(){var t;if(!this.menu){this.menu=this.shadowRoot.querySelector(".menu");let r={rootMargin:"0px",threshold:1},i=new IntersectionObserver(this.adjustPosition,r),a=new ResizeObserver(this.adjustPosition),l=this.menu;i.observe(l),a.observe((t=this.scrollableParent)!=null?t:document.body)}}get scrollableParent(){let t;this.host||(this.host=this.getRootNode().host);let r=this.host;for(;!t;){let i=r==null?void 0:r.parentElement;if(this.isScrollable(i)){t=i;break}if(r=i,!r)break}return t}isScrollable(t){if(!t)return!1;let r=t.scrollHeight>t.clientHeight,i=window.getComputedStyle(t).overflowY,a=window.getComputedStyle(t).overflowX,l=i.indexOf("hidden")!==-1,u=a.indexOf("hidden")!==-1;return r&&!l&&!u}get renderHeader(){return this.name?gt` <div class="header">
      <span class="text">${this.name}</span>
      <span class="sv-hr"></span>
    </div>`:gt``}toggle(){this.disabled||(this.originalPosition||(this.originalPosition=this.position),this.setMenu(),this.open=!this.open,this.open&&setTimeout(()=>this.adjustPosition()))}render(){var a;let t={menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu--top-left":this.position==="top-left","menu--top-center":this.position==="top-center","menu--top-right":this.position==="top-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right","who-is-online-dropdown":this.name},r=(a=this.icons)==null?void 0:a.map(l=>gt`<superviz-icon name="${l}" size="sm"></superviz-icon>`),i=this.options.map((l,u)=>{let d={text:!0,"text-bold":!0,active:(l==null?void 0:l[this.returnTo])&&this.active===(l==null?void 0:l[this.returnTo])};return gt`<li @click=${()=>this.callbackSelected(l)} class=${ne(d)}>
        ${r==null?void 0:r.at(u)} ${l[this.label]}
      </li>`});return gt`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <div class=${ne(t)}>
          ${this.renderHeader}
          <ul class="items">
            ${i}
          </ul>
        </div>
      </div>
    `}};Gr.styles=BT,Gr.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},position:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]},icons:{type:Array},name:{type:String}},Gr=kt([$t("superviz-dropdown")],Gr);N();N();N();var Ga=It`  
  .modal--overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: rgba(var(--sv-gray-400), 0.8);
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: transparent;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var Vm=Gt(Pt),kT=[Vm.styles,Ga],Mi=class extends Vm{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};Mi.styles=kT,Mi=kt([$t("superviz-modal")],Mi);N();var jm=Gt(Pt),$T=[jm.styles,Ga],_i=class extends jm{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>gt`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,r=()=>gt`
        <div class="modal--body">
          <div class="modal--body-content">
            ${this.options.body}
          </div>
        </div>
      `,i=()=>{if(this.options.footer)return gt`
          <div class="modal--footer">
            ${this.options.footer}
          </div>
        `;let a=this.options.confirmLabel||"OK",l=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?gt`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>${l}</button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
          </div>
        `:gt`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
        </div>
      `};return gt`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">
          ${t()}

          ${r()}

          ${i()}
        </div>
      </div>
    `}};_i.styles=$T,_i=kt([$t("superviz-modal-container")],_i);N();N();N();N();var Ec=It`
  .container {
    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    height: 100%;
  }

  .container-close {
    display: none;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }
`;N();var Cc=It`
  div.topbar {
    display: flex;
    justify-content: space-between;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  div.topbar span {
    margin: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .toggle-icon {
    cursor: pointer;
    transition: 0.15s;
    border-radius: 50%;
    aspect-ratio: 1;
  }

  .toggle-icon:hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
`;N();var Ac=It`
  .annotations {
    display: flex;
    flex-direction: column;
    background-color: rgb(var(--sv-gray-400));
    min-height: 10px;
    padding: 8px;
  }

  .annotations--add-comment-btn {
    color: rgb(var(--sv-white));
    text-align: center;
    padding: 8px;
  }

  .annotations--comments-input {
    width: 288px;
    padding: 8px;
  }

  .hidden {
    display: none;
  }
`;N();var Oc=It`
  .reply {
    padding-left: 24px !important;
  }

  .comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comment-item__user {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comment-item__actions superviz-dropdown,
  .comment-item__actions button {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comment-item__user-details {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comment-item__avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comment-item__content__body {
    color: rgb(var(--sv-gray-700));
  }

  .hidden {
    display: none;
  }
`;N();var Sc=It`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;N();var Tc=It`
  .comment-input {
    display: flex;
    flex-direction: column;
    width: 100%;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
  }

  .comment-input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comment-input:focus-within > .sv-hr {
    background: rgb(var(--sv-gray-500))
  }

  #comment-input--textarea {
    all: unset;
    border: 0px;
    border-radius: 4px;
    outline: none;
    height: 13px;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    padding: 12px 11px !important;
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    resize: none;
    appearance: none;
    width: 90%;
  }

  #comment-input--textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
  }

  .comment-input--options {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
  }

  .mention {
    display: none;
  }

  .comment-input--send-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-primary));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgba(var(--sv-white), 1);
    border: 0px;
    cursor: pointer;
  }

  .align-send-btn > superviz-icon {
    margin-right: 2px;
    margin-top: 4px;
  }

  .comment-input--send-btn:disabled {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-gray-200));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgb(var(--sv-gray-400));
    border: 0px;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
  }
`;N();var wc=It`
  .annotation-item--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
  }

  .annotation-item:hover:not(.annotation-item--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    padding: 8px;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  div:last-child {
    margin-left: 8px;
  }

  .comments-container {
    display: flex;
    flex-direction: column;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    display: none;
  }

  .annotation-item {
    padding: 8px;
    cursor: pointer;
  }
`;N();var xc=It`
  .annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;N();var Ic=It`
  .annotation-pin,
  .annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: rgb(var(--sv-white));
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid rgb(var(--sv-white));
    box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.25);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    cursor: pointer;
  }

  .annotation-pin:hover,
  .annotation-pin:focus,
  .annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: rgb(var(--sv-white));
  }

  .annotation-pin__avatar--add {
    font-size: 24px;
    color: rgb(var(--sv-gray-700));
    background-color: rgb(var(--sv-white));
  }

  .annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;

    object-fit: cover;
  }
`;N();var Pc=It`
  .select {
    display: flex;
    width: 100%;
    justify-content: flex-end;
    align-items: center;
  }

  .select-container {
    text-wrap: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
`;N();var Rc=It`
  button.float-button {
    position: fixed;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    gap: 4px;
    border: none;

    background-color: rgba(var(--sv-white));
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    transition: all 300ms;
    cursor: pointer;
    overflow: hidden;
    padding-left: 12px;
  }

  button.float-button p {
    visibility: hidden;
  }

  .hide-button {
    display: none !important;
  }

  button.float-button:hover {
    width: 110px;
    border-radius: 30px;
  }

  button.float-button:hover p {
    visibility: visible;
    animation: expand 300ms ease-in-out;
  }
`;N();var Mc=It`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;N();var _c;function Lc(s){let e=s.querySelector("#superviz-comments");if(e&&!_c){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};_c=new MutationObserver(r=>{r.forEach(i=>{!i.removedNodes.length||i.removedNodes.forEach(a=>{a.id==="poweredby-footer"&&HT(s)})})}),_c.observe(e,t)}}function HT(s){let e=document.createElement("div");e.id="poweredby-footer",e.className="footer";let t=document.createElement("div");t.className="powered-by powered-by--horizontal";let r=document.createElement("a");r.href="https://superviz.com/",r.target="_blank",r.className="link";let i=document.createElement("div");i.textContent="Powered by";let a=document.createElement("img");a.width=48,a.height=8.86,a.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",t.appendChild(r),r.appendChild(i),i.appendChild(a),e.appendChild(t);let l=s.getElementById("superviz-comments");l&&l.appendChild(e),Lc(s)}var Jm=Gt(Pt),GT=[Jm.styles,Ec,Mc],Wr=class extends Jm{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1}updateAnnotations(t){this.annotations=t}toggle(){this.emitEvent("toggle",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:r}=t;this.annotationFilter=r}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".superviz-comments");!r||(this.waterMarkState&&Lc(this.shadowRoot),r.setAttribute("style",this.side))})}render(){let t=[this.open?"container":"container-close","superviz-comments"].join(" "),r=gt` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`,i=this.waterMarkState?r:"";return gt`
      <div id="superviz-comments" class=${t}>
        <div class="header">
          <superviz-comments-topbar @close=${this.toggle}></superviz-comments-topbar>
          <superviz-comments-annotations id="annotations" open=${this.open}>
          </superviz-comments-annotations>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          class="content"
        ></superviz-comments-content>
        ${i}
      </div>
    `}};Wr.styles=GT,Wr.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String}},Wr=kt([$t("superviz-comments")],Wr);N();N();var WT=Gt(Pt),zT=[WT.styles,Cc],zr=class extends Gt(Pt){constructor(){super();this.side="left"}close(){this.dispatchEvent(new CustomEvent("close"))}render(){return this.side==="left"?gt`
        <div class="topbar">
          <span @click=${this.close} class="toggle-icon">
            <superviz-icon name="left" size="lg"></superviz-icon>
          </span>
          <span class="text text-bold">COMMENTS</span>
        </div>
      `:gt`
      <div class="topbar">
        <span class="text text-bold">COMMENTS</span>
        <span @click=${this.close} class="toggle-icon">
          <superviz-icon name="right" size="lg"></superviz-icon>
        </span>
      </div>
    `}};zr.styles=zT,zr.properties={side:{type:String}},zr=kt([$t("superviz-comments-topbar")],zr);N();var Km=Gt(Pt),VT=[Km.styles,Ac],Vr=class extends Km{constructor(){super(...arguments);this.prepareToCreateAnnotation=r=>_t(this,[r],function*({detail:t}){this.annotation=t,yield this.updateComplete,this.emitEvent("comment-input-focus",t)});this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{(t==null?void 0:t.key)==="Escape"&&(this.annotation=null)}}createComment({detail:t}){this.emitEvent("create-annotation",t),this.annotation=null}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)})}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)})}render(){let t={"annotations--comments-input":!0,hidden:!this.annotation};return gt`
      <div class="annotations">
        <span class="text text-big text-bold annotations--add-comment-btn">
          Click anywhere to add a comment
        </span>
        <div class=${ne(t)}>
          <superviz-comments-comment-input
            @create-annotation=${this.createComment}
            eventType="create-annotation"
          >
          </superviz-comments-comment-input>
        </div>
      </div>
    `}};Vr.styles=VT,Vr.properties={annotation:{type:Object}},Vr=kt([$t("superviz-comments-annotations")],Vr);N();N();N();N();var{D:jT}=vm;var qm=()=>document.createComment(""),Li=(s,e,t)=>{var a;let r=s._$AA.parentNode,i=e===void 0?s._$AB:e._$AA;if(t===void 0){let l=r.insertBefore(qm(),i),u=r.insertBefore(qm(),i);t=new jT(l,u,s,s.options)}else{let l=t._$AB.nextSibling,u=t._$AM,d=u!==s;if(d){let m;(a=t._$AQ)==null||a.call(t,s),t._$AM=s,t._$AP!==void 0&&(m=s._$AU)!==u._$AU&&t._$AP(m)}if(l!==i||d){let m=t._$AA;for(;m!==l;){let y=m.nextSibling;r.insertBefore(m,i),m=y}}}return t},or=(s,e,t=s)=>(s._$AI(e,t),s),JT={},Zm=(s,e=JT)=>s._$AH=e,Ym=s=>s._$AH,za=s=>{var r;(r=s._$AP)==null||r.call(s,!1,!0);let e=s._$AA,t=s._$AB.nextSibling;for(;e!==t;){let i=e.nextSibling;e.remove(),e=i}};var Qm=(s,e,t)=>{let r=new Map;for(let i=e;i<=t;i++)r.set(s[i],i);return r},Xm=Ha(class extends Ri{constructor(s){if(super(s),s.type!==$a.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let r;t===void 0?t=e:e!==void 0&&(r=e);let i=[],a=[],l=0;for(let u of s)i[l]=r?r(u,l):l,a[l]=t(u,l),l++;return{values:a,keys:i}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,r]){var x;let i=Ym(s),{values:a,keys:l}=this.ht(e,t,r);if(!Array.isArray(i))return this.dt=l,a;let u=(x=this.dt)!=null?x:this.dt=[],d=[],m,y,C=0,h=i.length-1,E=0,w=a.length-1;for(;C<=h&&E<=w;)if(i[C]===null)C++;else if(i[h]===null)h--;else if(u[C]===l[E])d[E]=or(i[C],a[E]),C++,E++;else if(u[h]===l[w])d[w]=or(i[h],a[w]),h--,w--;else if(u[C]===l[w])d[w]=or(i[C],a[w]),Li(s,d[w+1],i[C]),C++,w--;else if(u[h]===l[E])d[E]=or(i[h],a[E]),Li(s,i[C],i[h]),h--,E++;else if(m===void 0&&(m=Qm(l,E,w),y=Qm(u,C,h)),m.has(u[C]))if(m.has(u[h])){let S=y.get(l[E]),O=S!==void 0?i[S]:null;if(O===null){let P=Li(s,i[C]);or(P,a[E]),d[E]=P}else d[E]=or(O,a[E]),Li(s,i[C],O),i[S]=null;E++}else za(i[h]),h--;else za(i[C]),C++;for(;E<=w;){let S=Li(s,d[w+1]);or(S,a[E]),d[E++]=S}for(;C<=h;){let S=i[C++];S!==null&&za(S)}return this.dt=l,Zm(s,d),kn}});var tg=Gt(Pt),KT=[tg.styles,Sc],jr=class extends tg{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:t})=>{let{uuid:r}=t;if(this.selectedAnnotation===r){this.selectedAnnotation=null;return}this.selectedAnnotation=r};this.checkLastAnnotation=t=>{var a,l;let r=this.annotations.filter(u=>u.resolved),i=this.annotations.filter(u=>!u.resolved);return this.annotationFilter==="all"?t===((a=r[r.length-1])==null?void 0:a.uuid):t===((l=i[i.length-1])==null?void 0:l.uuid)};this.annotations=[]}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!r)return;let i=this.lastCommentId===this.selectedAnnotation,a=i?0:-150,l=r.getClientRects()[0];!l||(this.scrollBy(0,l.y+a),i&&setTimeout(()=>{this.scrollBy(0,l.y+a)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return gt` ${Xm(this.annotations.filter(t=>t.comments.length),t=>t.uuid,t=>gt`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(t)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${t.uuid}
          isLastComment=${this.checkLastAnnotation(t.uuid)}
        >
        </superviz-comments-annotation-item>
      `)}`}};jr.styles=KT,jr.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String}},jr=kt([$t("superviz-comments-content")],jr);N();N();N();N();N();var Hn=class extends Error{},Va=class extends Hn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},ja=class extends Hn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},Ja=class extends Hn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},Gn=class extends Hn{},Ni=class extends Hn{constructor(e){super(`Invalid unit ${e}`)}},Ie=class extends Hn{},pn=class extends Hn{constructor(){super("Zone is an abstract class")}};N();N();N();var pt="numeric",mn="short",qe="long",sr={year:pt,month:pt,day:pt},Go={year:pt,month:mn,day:pt},Nc={year:pt,month:mn,day:pt,weekday:mn},Wo={year:pt,month:qe,day:pt},zo={year:pt,month:qe,day:pt,weekday:qe},Vo={hour:pt,minute:pt},jo={hour:pt,minute:pt,second:pt},Jo={hour:pt,minute:pt,second:pt,timeZoneName:mn},Ko={hour:pt,minute:pt,second:pt,timeZoneName:qe},qo={hour:pt,minute:pt,hourCycle:"h23"},Zo={hour:pt,minute:pt,second:pt,hourCycle:"h23"},Yo={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:mn},Qo={hour:pt,minute:pt,second:pt,hourCycle:"h23",timeZoneName:qe},Xo={year:pt,month:pt,day:pt,hour:pt,minute:pt},ts={year:pt,month:pt,day:pt,hour:pt,minute:pt,second:pt},es={year:pt,month:mn,day:pt,hour:pt,minute:pt},ns={year:pt,month:mn,day:pt,hour:pt,minute:pt,second:pt},Dc={year:pt,month:mn,day:pt,weekday:mn,hour:pt,minute:pt},rs={year:pt,month:qe,day:pt,hour:pt,minute:pt,timeZoneName:mn},is={year:pt,month:qe,day:pt,hour:pt,minute:pt,second:pt,timeZoneName:mn},os={year:pt,month:qe,day:pt,weekday:qe,hour:pt,minute:pt,timeZoneName:qe},ss={year:pt,month:qe,day:pt,weekday:qe,hour:pt,minute:pt,second:pt,timeZoneName:qe};N();N();N();N();var He=class{get type(){throw new pn}get name(){throw new pn}get ianaName(){return this.name}get isUniversal(){throw new pn}offsetName(e,t){throw new pn}formatOffset(e,t){throw new pn}offset(e){throw new pn}equals(e){throw new pn}get isValid(){throw new pn}};var Fc=null,Tn=class extends He{static get instance(){return Fc===null&&(Fc=new Tn),Fc}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return qa(e,t,r)}formatOffset(e,t){return ar(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}};N();var Ya={};function qT(s){return Ya[s]||(Ya[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Ya[s]}var ZT={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function YT(s,e){let t=s.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,i,a,l,u,d,m,y]=r;return[l,i,a,u,d,m,y]}function QT(s,e){let t=s.formatToParts(e),r=[];for(let i=0;i<t.length;i++){let{type:a,value:l}=t[i],u=ZT[a];a==="era"?r[u]=l:Nt(u)||(r[u]=parseInt(l,10))}return r}var Za={},Ae=class extends He{static create(e){return Za[e]||(Za[e]=new Ae(e)),Za[e]}static resetCache(){Za={},Ya={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ae.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return qa(e,t,r,this.name)}formatOffset(e,t){return ar(this.offset(e),t)}offset(e){let t=new Date(e);if(isNaN(t))return NaN;let r=qT(this.name),[i,a,l,u,d,m,y]=r.formatToParts?QT(r,t):YT(r,t);u==="BC"&&(i=-Math.abs(i)+1);let h=Di({year:i,month:a,day:l,hour:d===24?0:d,minute:m,second:y,millisecond:0}),E=+t,w=E%1e3;return E-=w>=0?w:1e3+w,(h-E)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}};N();var eg={};function XT(s,e={}){let t=JSON.stringify([s,e]),r=eg[t];return r||(r=new Intl.ListFormat(s,e),eg[t]=r),r}var Uc={};function Bc(s,e={}){let t=JSON.stringify([s,e]),r=Uc[t];return r||(r=new Intl.DateTimeFormat(s,e),Uc[t]=r),r}var kc={};function tw(s,e={}){let t=JSON.stringify([s,e]),r=kc[t];return r||(r=new Intl.NumberFormat(s,e),kc[t]=r),r}var $c={};function ew(s,e={}){let l=e,{base:t}=l,r=Tu(l,["base"]),i=JSON.stringify([s,r]),a=$c[i];return a||(a=new Intl.RelativeTimeFormat(s,e),$c[i]=a),a}var as=null;function nw(){return as||(as=new Intl.DateTimeFormat().resolvedOptions().locale,as)}function rw(s){let e=s.indexOf("-x-");e!==-1&&(s=s.substring(0,e));let t=s.indexOf("-u-");if(t===-1)return[s];{let r,i;try{r=Bc(s).resolvedOptions(),i=s}catch(u){let d=s.substring(0,t);r=Bc(d).resolvedOptions(),i=d}let{numberingSystem:a,calendar:l}=r;return[i,a,l]}}function iw(s,e,t){return(t||e)&&(s.includes("-u-")||(s+="-u"),t&&(s+=`-ca-${t}`),e&&(s+=`-nu-${e}`)),s}function ow(s){let e=[];for(let t=1;t<=12;t++){let r=Ot.utc(2009,t,1);e.push(s(r))}return e}function sw(s){let e=[];for(let t=1;t<=7;t++){let r=Ot.utc(2016,11,13+t);e.push(s(r))}return e}function Qa(s,e,t,r){let i=s.listingMode();return i==="error"?null:i==="en"?t(e):r(e)}function aw(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var Hc=class{constructor(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;let u=r,{padTo:i,floor:a}=u,l=Tu(u,["padTo","floor"]);if(!t||Object.keys(l).length>0){let d=dt({useGrouping:!1},r);r.padTo>0&&(d.minimumIntegerDigits=r.padTo),this.inf=tw(e,d)}}format(e){if(this.inf){let t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{let t=this.floor?Math.floor(e):Fi(e,3);return ce(t,this.padTo)}}},Gc=class{constructor(e,t,r){this.opts=r,this.originalZone=void 0;let i;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let l=-1*(e.offset/60),u=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;e.offset!==0&&Ae.create(u).valid?(i=u,this.dt=e):(i="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,i=e.zone.name):(i="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let a=dt({},this.opts);a.timeZone=a.timeZone||i,this.dtf=Bc(t,a)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){let r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return jt(dt({},t),{value:r})}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},Wc=class{constructor(e,t,r){this.opts=dt({style:"long"},r),!t&&Xa()&&(this.rtf=ew(e,r))}format(e,t){return this.rtf?this.rtf.format(e,t):ng(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}},Jt=class{static fromOpts(e){return Jt.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,r,i=!1){let a=e||Qt.defaultLocale,l=a||(i?"en-US":nw()),u=t||Qt.defaultNumberingSystem,d=r||Qt.defaultOutputCalendar;return new Jt(l,u,d,a)}static resetCache(){as=null,Uc={},kc={},$c={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:r}={}){return Jt.create(e,t,r)}constructor(e,t,r,i){let[a,l,u]=rw(e);this.locale=a,this.numberingSystem=t||l||null,this.outputCalendar=r||u||null,this.intl=iw(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=aw(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Jt.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone(jt(dt({},e),{defaultToEN:!0}))}redefaultToSystem(e={}){return this.clone(jt(dt({},e),{defaultToEN:!1}))}months(e,t=!1){return Qa(this,e,zc,()=>{let r=t?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";return this.monthsCache[i][e]||(this.monthsCache[i][e]=ow(a=>this.extract(a,r,"month"))),this.monthsCache[i][e]})}weekdays(e,t=!1){return Qa(this,e,Vc,()=>{let r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},i=t?"format":"standalone";return this.weekdaysCache[i][e]||(this.weekdaysCache[i][e]=sw(a=>this.extract(a,r,"weekday"))),this.weekdaysCache[i][e]})}meridiems(){return Qa(this,void 0,()=>jc,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ot.utc(2016,11,13,9),Ot.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return Qa(this,e,Jc,()=>{let t={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ot.utc(-40,1,1),Ot.utc(2017,1,1)].map(r=>this.extract(r,t,"era"))),this.eraCache[e]})}extract(e,t,r){let i=this.dtFormatter(e,t),a=i.formatToParts(),l=a.find(u=>u.type.toLowerCase()===r);return l?l.value:null}numberFormatter(e={}){return new Hc(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Gc(e,this.intl,t)}relFormatter(e={}){return new Wc(this.intl,this.isEnglish(),e)}listFormatter(e={}){return XT(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}};N();N();var qc=null,de=class extends He{static get utcInstance(){return qc===null&&(qc=new de(0)),qc}static instance(e){return e===0?de.utcInstance:new de(e)}static parseSpecifier(e){if(e){let t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new de(Jr(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${ar(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${ar(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return ar(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}};N();var Ui=class extends He{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function gn(s,e){let t;if(Nt(s)||s===null)return e;if(s instanceof He)return s;if(rg(s)){let r=s.toLowerCase();return r==="default"?e:r==="local"||r==="system"?Tn.instance:r==="utc"||r==="gmt"?de.utcInstance:de.parseSpecifier(r)||Ae.create(s)}else return wn(s)?de.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new Ui(s)}var ig=()=>Date.now(),og="system",sg=null,ag=null,lg=null,ug=60,cg,Qt=class{static get now(){return ig}static set now(e){ig=e}static set defaultZone(e){og=e}static get defaultZone(){return gn(og,Tn.instance)}static get defaultLocale(){return sg}static set defaultLocale(e){sg=e}static get defaultNumberingSystem(){return ag}static set defaultNumberingSystem(e){ag=e}static get defaultOutputCalendar(){return lg}static set defaultOutputCalendar(e){lg=e}static get twoDigitCutoffYear(){return ug}static set twoDigitCutoffYear(e){ug=e%100}static get throwOnInvalid(){return cg}static set throwOnInvalid(e){cg=e}static resetCaches(){Jt.resetCache(),Ae.resetCache()}};function Nt(s){return typeof s=="undefined"}function wn(s){return typeof s=="number"}function ls(s){return typeof s=="number"&&s%1===0}function rg(s){return typeof s=="string"}function dg(s){return Object.prototype.toString.call(s)==="[object Date]"}function Xa(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function fg(s){return Array.isArray(s)?s:[s]}function Zc(s,e,t){if(s.length!==0)return s.reduce((r,i)=>{let a=[e(i),i];return r&&t(r[0],a[0])===r[0]?r:a},null)[1]}function hg(s,e){return e.reduce((t,r)=>(t[r]=s[r],t),{})}function lr(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function xn(s,e,t){return ls(s)&&s>=e&&s<=t}function lw(s,e){return s-e*Math.floor(s/e)}function ce(s,e=2){let t=s<0,r;return t?r="-"+(""+-s).padStart(e,"0"):r=(""+s).padStart(e,"0"),r}function Wn(s){if(!(Nt(s)||s===null||s===""))return parseInt(s,10)}function ur(s){if(!(Nt(s)||s===null||s===""))return parseFloat(s)}function us(s){if(!(Nt(s)||s===null||s==="")){let e=parseFloat("0."+s)*1e3;return Math.floor(e)}}function Fi(s,e,t=!1){let r=Yh(10,e);return(t?Math.trunc:Math.round)(s*r)/r}function Kr(s){return s%4===0&&(s%100!==0||s%400===0)}function qr(s){return Kr(s)?366:365}function Bi(s,e){let t=lw(e-1,12)+1,r=s+(e-t)/12;return t===2?Kr(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function Di(s){let e=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(e=new Date(e),e.setUTCFullYear(s.year,s.month-1,s.day)),+e}function ki(s){let e=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,t=s-1,r=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||r===3?53:52}function cs(s){return s>99?s:s>Qt.twoDigitCutoffYear?1900+s:2e3+s}function qa(s,e,t,r=null){let i=new Date(s),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(a.timeZone=r);let l=dt({timeZoneName:e},a),u=new Intl.DateTimeFormat(t,l).formatToParts(i).find(d=>d.type.toLowerCase()==="timezonename");return u?u.value:null}function Jr(s,e){let t=parseInt(s,10);Number.isNaN(t)&&(t=0);let r=parseInt(e,10)||0,i=t<0||Object.is(t,-0)?-r:r;return t*60+i}function Yc(s){let e=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(e))throw new Ie(`Invalid unit value ${s}`);return e}function $i(s,e){let t={};for(let r in s)if(lr(s,r)){let i=s[r];if(i==null)continue;t[e(r)]=Yc(i)}return t}function ar(s,e){let t=Math.trunc(Math.abs(s/60)),r=Math.trunc(Math.abs(s%60)),i=s>=0?"+":"-";switch(e){case"short":return`${i}${ce(t,2)}:${ce(r,2)}`;case"narrow":return`${i}${t}${r>0?`:${r}`:""}`;case"techie":return`${i}${ce(t,2)}${ce(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function ds(s){return hg(s,["hour","minute","second","millisecond"])}var uw=["January","February","March","April","May","June","July","August","September","October","November","December"],Qc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],cw=["J","F","M","A","M","J","J","A","S","O","N","D"];function zc(s){switch(s){case"narrow":return[...cw];case"short":return[...Qc];case"long":return[...uw];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var Xc=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],td=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],dw=["M","T","W","T","F","S","S"];function Vc(s){switch(s){case"narrow":return[...dw];case"short":return[...td];case"long":return[...Xc];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var jc=["AM","PM"],fw=["Before Christ","Anno Domini"],hw=["BC","AD"],pw=["B","A"];function Jc(s){switch(s){case"narrow":return[...pw];case"short":return[...hw];case"long":return[...fw];default:return null}}function pg(s){return jc[s.hour<12?0:1]}function mg(s,e){return Vc(e)[s.weekday-1]}function gg(s,e){return zc(e)[s.month-1]}function vg(s,e){return Jc(e)[s.year<0?0:1]}function ng(s,e,t="always",r=!1){let i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(s)===-1;if(t==="auto"&&a){let C=s==="days";switch(e){case 1:return C?"tomorrow":`next ${i[s][0]}`;case-1:return C?"yesterday":`last ${i[s][0]}`;case 0:return C?"today":`this ${i[s][0]}`;default:}}let l=Object.is(e,-0)||e<0,u=Math.abs(e),d=u===1,m=i[s],y=r?d?m[1]:m[2]||m[1]:d?i[s][0]:s;return l?`${u} ${y} ago`:`in ${u} ${y}`}function yg(s,e){let t="";for(let r of s)r.literal?t+=r.val:t+=e(r.val);return t}var mw={D:sr,DD:Go,DDD:Wo,DDDD:zo,t:Vo,tt:jo,ttt:Jo,tttt:Ko,T:qo,TT:Zo,TTT:Yo,TTTT:Qo,f:Xo,ff:es,fff:rs,ffff:os,F:ts,FF:ns,FFF:is,FFFF:ss},fe=class{static create(e,t={}){return new fe(e,t)}static parseFormat(e){let t=null,r="",i=!1,a=[];for(let l=0;l<e.length;l++){let u=e.charAt(l);u==="'"?(r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),t=null,r="",i=!i):i||u===t?r+=u:(r.length>0&&a.push({literal:/^\s+$/.test(r),val:r}),r=u,t=u)}return r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),a}static macroTokenToFormatOpts(e){return mw[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,dt(dt({},this.opts),t)).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,dt(dt({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return ce(e,t);let r=dt({},this.opts);return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){let r=this.loc.listingMode()==="en",i=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(E,w)=>this.loc.extract(e,E,w),l=E=>e.isOffsetFixed&&e.offset===0&&E.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,E.format):"",u=()=>r?pg(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),d=(E,w)=>r?gg(e,E):a(w?{month:E}:{month:E,day:"numeric"},"month"),m=(E,w)=>r?mg(e,E):a(w?{weekday:E}:{weekday:E,month:"long",day:"numeric"},"weekday"),y=E=>{let w=fe.macroTokenToFormatOpts(E);return w?this.formatWithSystemDefault(e,w):E},C=E=>r?vg(e,E):a({era:E},"era"),h=E=>{switch(E){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return u();case"d":return i?a({day:"numeric"},"day"):this.num(e.day);case"dd":return i?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return i?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return i?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return d("short",!0);case"LLLL":return d("long",!0);case"LLLLL":return d("narrow",!0);case"M":return i?a({month:"numeric"},"month"):this.num(e.month);case"MM":return i?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return d("short",!1);case"MMMM":return d("long",!1);case"MMMMM":return d("narrow",!1);case"y":return i?a({year:"numeric"},"year"):this.num(e.year);case"yy":return i?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return i?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return i?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return C("short");case"GG":return C("long");case"GGGGG":return C("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return y(E)}};return yg(fe.parseFormat(t),h)}formatDurationFromString(e,t){let r=d=>{switch(d[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},i=d=>m=>{let y=r(m);return y?this.num(d.get(y),m.length):m},a=fe.parseFormat(t),l=a.reduce((d,{literal:m,val:y})=>m?d:d.concat(y),[]),u=e.shiftTo(...l.map(r).filter(d=>d));return yg(a,i(u))}};N();var Pe=class{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};N();var Eg=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Gi(...s){let e=s.reduce((t,r)=>t+r.source,"");return RegExp(`^${e}$`)}function Wi(...s){return e=>s.reduce(([t,r,i],a)=>{let[l,u,d]=a(e,i);return[dt(dt({},t),l),u||r,d]},[{},null,1]).slice(0,2)}function zi(s,...e){if(s==null)return[null,null];for(let[t,r]of e){let i=t.exec(s);if(i)return r(i)}return[null,null]}function Cg(...s){return(e,t)=>{let r={},i;for(i=0;i<s.length;i++)r[s[i]]=Wn(e[t+i]);return[r,null,t+i]}}var Ag=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,gw=`(?:${Ag.source}?(?:\\[(${Eg.source})\\])?)?`,ed=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Og=RegExp(`${ed.source}${gw}`),nd=RegExp(`(?:T${Og.source})?`),vw=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,yw=/(\d{4})-?W(\d\d)(?:-?(\d))?/,bw=/(\d{4})-?(\d{3})/,Ew=Cg("weekYear","weekNumber","weekDay"),Cw=Cg("year","ordinal"),Aw=/(\d{4})-(\d\d)-(\d\d)/,Sg=RegExp(`${ed.source} ?(?:${Ag.source}|(${Eg.source}))?`),Ow=RegExp(`(?: ${Sg.source})?`);function Hi(s,e,t){let r=s[e];return Nt(r)?t:Wn(r)}function Sw(s,e){return[{year:Hi(s,e),month:Hi(s,e+1,1),day:Hi(s,e+2,1)},null,e+3]}function Vi(s,e){return[{hours:Hi(s,e,0),minutes:Hi(s,e+1,0),seconds:Hi(s,e+2,0),milliseconds:us(s[e+3])},null,e+4]}function fs(s,e){let t=!s[e]&&!s[e+1],r=Jr(s[e+1],s[e+2]),i=t?null:de.instance(r);return[{},i,e+3]}function hs(s,e){let t=s[e]?Ae.create(s[e]):null;return[{},t,e+1]}var Tw=RegExp(`^T?${ed.source}$`),ww=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function xw(s){let[e,t,r,i,a,l,u,d,m]=s,y=e[0]==="-",C=d&&d[0]==="-",h=(E,w=!1)=>E!==void 0&&(w||E&&y)?-E:E;return[{years:h(ur(t)),months:h(ur(r)),weeks:h(ur(i)),days:h(ur(a)),hours:h(ur(l)),minutes:h(ur(u)),seconds:h(ur(d),d==="-0"),milliseconds:h(us(m),C)}]}var Iw={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function rd(s,e,t,r,i,a,l){let u={year:e.length===2?cs(Wn(e)):Wn(e),month:Qc.indexOf(t)+1,day:Wn(r),hour:Wn(i),minute:Wn(a)};return l&&(u.second=Wn(l)),s&&(u.weekday=s.length>3?Xc.indexOf(s)+1:td.indexOf(s)+1),u}var Pw=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Rw(s){let[,e,t,r,i,a,l,u,d,m,y,C]=s,h=rd(e,i,r,t,a,l,u),E;return d?E=Iw[d]:m?E=0:E=Jr(y,C),[h,new de(E)]}function Mw(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var _w=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Lw=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Nw=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function bg(s){let[,e,t,r,i,a,l,u]=s;return[rd(e,i,r,t,a,l,u),de.utcInstance]}function Dw(s){let[,e,t,r,i,a,l,u]=s;return[rd(e,u,t,r,i,a,l),de.utcInstance]}var Fw=Gi(vw,nd),Uw=Gi(yw,nd),Bw=Gi(bw,nd),kw=Gi(Og),Tg=Wi(Sw,Vi,fs,hs),$w=Wi(Ew,Vi,fs,hs),Hw=Wi(Cw,Vi,fs,hs),Gw=Wi(Vi,fs,hs);function wg(s){return zi(s,[Fw,Tg],[Uw,$w],[Bw,Hw],[kw,Gw])}function xg(s){return zi(Mw(s),[Pw,Rw])}function Ig(s){return zi(s,[_w,bg],[Lw,bg],[Nw,Dw])}function Pg(s){return zi(s,[ww,xw])}var Ww=Wi(Vi);function Rg(s){return zi(s,[Tw,Ww])}var zw=Gi(Aw,Ow),Vw=Gi(Sg),jw=Wi(Vi,fs,hs);function Mg(s){return zi(s,[zw,Tg],[Vw,jw])}var _g="Invalid Duration",Ng={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Jw=dt({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Ng),sn=146097/400,ji=146097/4800,Kw=dt({years:{quarters:4,months:12,weeks:sn/7,days:sn,hours:sn*24,minutes:sn*24*60,seconds:sn*24*60*60,milliseconds:sn*24*60*60*1e3},quarters:{months:3,weeks:sn/28,days:sn/4,hours:sn*24/4,minutes:sn*24*60/4,seconds:sn*24*60*60/4,milliseconds:sn*24*60*60*1e3/4},months:{weeks:ji/7,days:ji,hours:ji*24,minutes:ji*24*60,seconds:ji*24*60*60,milliseconds:ji*24*60*60*1e3}},Ng),Zr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],qw=Zr.slice(0).reverse();function cr(s,e,t=!1){let r={values:t?e.values:dt(dt({},s.values),e.values||{}),loc:s.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||s.conversionAccuracy,matrix:e.matrix||s.matrix};return new Ut(r)}function Dg(s,e){var r;let t=(r=e.milliseconds)!=null?r:0;for(let i of qw.slice(1))e[i]&&(t+=e[i]*s[i].milliseconds);return t}function Lg(s,e){let t=Dg(s,e)<0?-1:1;Zr.reduceRight((r,i)=>{if(Nt(e[i]))return r;if(r){let a=e[r]*t,l=s[i][r],u=Math.floor(a/l);e[i]+=u*t,e[r]-=u*l*t}return i},null),Zr.reduce((r,i)=>{if(Nt(e[i]))return r;if(r){let a=e[r]%1;e[r]-=a,e[i]+=a*s[r][i]}return i},null)}function Zw(s){let e={};for(let[t,r]of Object.entries(s))r!==0&&(e[t]=r);return e}var Ut=class{constructor(e){let t=e.conversionAccuracy==="longterm"||!1,r=t?Kw:Jw;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Jt.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,t){return Ut.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new Ie(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ut({values:$i(e,Ut.normalizeUnit),loc:Jt.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(wn(e))return Ut.fromMillis(e);if(Ut.isDuration(e))return e;if(typeof e=="object")return Ut.fromObject(e);throw new Ie(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){let[r]=Pg(e);return r?Ut.fromObject(r,t):Ut.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){let[r]=Rg(e);return r?Ut.fromObject(r,t):Ut.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the Duration is invalid");let r=e instanceof Pe?e:new Pe(e,t);if(Qt.throwOnInvalid)throw new Ja(r);return new Ut({invalid:r})}static normalizeUnit(e){let t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new Ni(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){let r=jt(dt({},t),{floor:t.round!==!1&&t.floor!==!1});return this.isValid?fe.create(this.loc,r).formatDurationFromString(this,e):_g}toHuman(e={}){if(!this.isValid)return _g;let t=Zr.map(r=>{let i=this.values[r];return Nt(i)?null:this.loc.numberFormatter(jt(dt({style:"unit",unitDisplay:"long"},e),{unit:r.slice(0,-1)})).format(i)}).filter(r=>r);return this.loc.listFormatter(dt({type:"conjunction",style:e.listStyle||"narrow"},e)).format(t)}toObject(){return this.isValid?dt({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Fi(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let t=this.toMillis();return t<0||t>=864e5?null:(e=jt(dt({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{includeOffset:!1}),Ot.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Dg(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let t=Ut.fromDurationLike(e),r={};for(let i of Zr)(lr(t.values,i)||lr(this.values,i))&&(r[i]=t.get(i)+this.get(i));return cr(this,{values:r},!0)}minus(e){if(!this.isValid)return this;let t=Ut.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;let t={};for(let r of Object.keys(this.values))t[r]=Yc(e(this.values[r],r));return cr(this,{values:t},!0)}get(e){return this[Ut.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let t=dt(dt({},this.values),$i(e,Ut.normalizeUnit));return cr(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:r,matrix:i}={}){let l={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:i,conversionAccuracy:r};return cr(this,l)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return Lg(this.matrix,e),cr(this,{values:e},!0)}rescale(){if(!this.isValid)return this;let e=Zw(this.normalize().shiftToAll().toObject());return cr(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(l=>Ut.normalizeUnit(l));let t={},r={},i=this.toObject(),a;for(let l of Zr)if(e.indexOf(l)>=0){a=l;let u=0;for(let m in r)u+=this.matrix[m][l]*r[m],r[m]=0;wn(i[l])&&(u+=i[l]);let d=Math.trunc(u);t[l]=d,r[l]=(u*1e3-d*1e3)/1e3}else wn(i[l])&&(r[l]=i[l]);for(let l in r)r[l]!==0&&(t[a]+=l===a?r[l]:r[l]/this.matrix[a][l]);return Lg(this.matrix,t),cr(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return cr(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(r,i){return r===void 0||r===0?i===void 0||i===0:r===i}for(let r of Zr)if(!t(this.values[r],e.values[r]))return!1;return!0}};N();var Ji="Invalid Interval";function Yw(s,e){return!s||!s.isValid?re.invalid("missing or invalid start"):!e||!e.isValid?re.invalid("missing or invalid end"):e<s?re.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${e.toISO()}`):null}var re=class{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the Interval is invalid");let r=e instanceof Pe?e:new Pe(e,t);if(Qt.throwOnInvalid)throw new ja(r);return new re({invalid:r})}static fromDateTimes(e,t){let r=Ki(e),i=Ki(t),a=Yw(r,i);return a==null?new re({start:r,end:i}):a}static after(e,t){let r=Ut.fromDurationLike(t),i=Ki(e);return re.fromDateTimes(i,i.plus(r))}static before(e,t){let r=Ut.fromDurationLike(t),i=Ki(e);return re.fromDateTimes(i.minus(r),i)}static fromISO(e,t){let[r,i]=(e||"").split("/",2);if(r&&i){let a,l;try{a=Ot.fromISO(r,t),l=a.isValid}catch(m){l=!1}let u,d;try{u=Ot.fromISO(i,t),d=u.isValid}catch(m){d=!1}if(l&&d)return re.fromDateTimes(a,u);if(l){let m=Ut.fromISO(i,t);if(m.isValid)return re.after(a,m)}else if(d){let m=Ut.fromISO(r,t);if(m.isValid)return re.before(u,m)}}return re.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let t=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(t,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?re.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];let t=e.map(Ki).filter(l=>this.contains(l)).sort(),r=[],{s:i}=this,a=0;for(;i<this.e;){let l=t[a]||this.e,u=+l>+this.e?this.e:l;r.push(re.fromDateTimes(i,u)),i=u,a+=1}return r}splitBy(e){let t=Ut.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:r}=this,i=1,a,l=[];for(;r<this.e;){let u=this.start.plus(t.mapUnits(d=>d*i));a=+u>+this.e?this.e:u,l.push(re.fromDateTimes(r,a)),r=a,i+=1}return l}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let t=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return t>=r?null:re.fromDateTimes(t,r)}union(e){if(!this.isValid)return this;let t=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return re.fromDateTimes(t,r)}static merge(e){let[t,r]=e.sort((i,a)=>i.s-a.s).reduce(([i,a],l)=>a?a.overlaps(l)||a.abutsStart(l)?[i,a.union(l)]:[i.concat([a]),l]:[i,l],[[],null]);return r&&t.push(r),t}static xor(e){let t=null,r=0,i=[],a=e.map(d=>[{time:d.s,type:"s"},{time:d.e,type:"e"}]),l=Array.prototype.concat(...a),u=l.sort((d,m)=>d.time-m.time);for(let d of u)r+=d.type==="s"?1:-1,r===1?t=d.time:(t&&+t!=+d.time&&i.push(re.fromDateTimes(t,d.time)),t=null);return re.merge(i)}difference(...e){return re.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Ji}toLocaleString(e=sr,t={}){return this.isValid?fe.create(this.s.loc.clone(t),e).formatInterval(this):Ji}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ji}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ji}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ji}toFormat(e,{separator:t=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Ji}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Ut.invalid(this.invalidReason)}mapEndpoints(e){return re.fromDateTimes(e(this.s),e(this.e))}};N();var zn=class{static hasDST(e=Qt.defaultZone){let t=Ot.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Ae.isValidZone(e)}static normalizeZone(e){return gn(e,Qt.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Jt.create(t,r,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Jt.create(t,r,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Jt.create(t,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Jt.create(t,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Jt.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Jt.create(t,null,"gregory").eras(e)}static features(){return{relative:Xa()}}};N();function Fg(s,e){let t=i=>i.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=t(e)-t(s);return Math.floor(Ut.fromMillis(r).as("days"))}function Qw(s,e,t){let r=[["years",(d,m)=>m.year-d.year],["quarters",(d,m)=>m.quarter-d.quarter+(m.year-d.year)*4],["months",(d,m)=>m.month-d.month+(m.year-d.year)*12],["weeks",(d,m)=>{let y=Fg(d,m);return(y-y%7)/7}],["days",Fg]],i={},a=s,l,u;for(let[d,m]of r)t.indexOf(d)>=0&&(l=d,i[d]=m(s,e),u=a.plus(i),u>e?(i[d]--,s=a.plus(i),s>e&&(u=s,i[d]--,s=a.plus(i))):s=u);return[s,i,u,l]}function Ug(s,e,t,r){let[i,a,l,u]=Qw(s,e,t),d=e-i,m=t.filter(C=>["hours","minutes","seconds","milliseconds"].indexOf(C)>=0);m.length===0&&(l<e&&(l=i.plus({[u]:1})),l!==i&&(a[u]=(a[u]||0)+d/(l-i)));let y=Ut.fromObject(a,r);return m.length>0?Ut.fromMillis(d,r).shiftTo(...m).plus(y):y}N();N();var id={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Bg={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Xw=id.hanidec.replace(/[\[|\]]/g,"").split("");function kg(s){let e=parseInt(s,10);if(isNaN(e)){e="";for(let t=0;t<s.length;t++){let r=s.charCodeAt(t);if(s[t].search(id.hanidec)!==-1)e+=Xw.indexOf(s[t]);else for(let i in Bg){let[a,l]=Bg[i];r>=a&&r<=l&&(e+=r-a)}}return parseInt(e,10)}else return e}function an({numberingSystem:s},e=""){return new RegExp(`${id[s||"latn"]}${e}`)}var t1="missing Intl.DateTimeFormat.formatToParts support";function qt(s,e=t=>t){return{regex:s,deser:([t])=>e(kg(t))}}var e1=String.fromCharCode(160),Gg=`[ ${e1}]`,Wg=new RegExp(Gg,"g");function n1(s){return s.replace(/\./g,"\\.?").replace(Wg,Gg)}function $g(s){return s.replace(/\./g,"").replace(Wg," ").toLowerCase()}function vn(s,e){return s===null?null:{regex:RegExp(s.map(n1).join("|")),deser:([t])=>s.findIndex(r=>$g(t)===$g(r))+e}}function Hg(s,e){return{regex:s,deser:([,t,r])=>Jr(t,r),groups:e}}function tl(s){return{regex:s,deser:([e])=>e}}function r1(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i1(s,e){let t=an(e),r=an(e,"{2}"),i=an(e,"{3}"),a=an(e,"{4}"),l=an(e,"{6}"),u=an(e,"{1,2}"),d=an(e,"{1,3}"),m=an(e,"{1,6}"),y=an(e,"{1,9}"),C=an(e,"{2,4}"),h=an(e,"{4,6}"),E=S=>({regex:RegExp(r1(S.val)),deser:([O])=>O,literal:!0}),x=(S=>{if(s.literal)return E(S);switch(S.val){case"G":return vn(e.eras("short"),0);case"GG":return vn(e.eras("long"),0);case"y":return qt(m);case"yy":return qt(C,cs);case"yyyy":return qt(a);case"yyyyy":return qt(h);case"yyyyyy":return qt(l);case"M":return qt(u);case"MM":return qt(r);case"MMM":return vn(e.months("short",!0),1);case"MMMM":return vn(e.months("long",!0),1);case"L":return qt(u);case"LL":return qt(r);case"LLL":return vn(e.months("short",!1),1);case"LLLL":return vn(e.months("long",!1),1);case"d":return qt(u);case"dd":return qt(r);case"o":return qt(d);case"ooo":return qt(i);case"HH":return qt(r);case"H":return qt(u);case"hh":return qt(r);case"h":return qt(u);case"mm":return qt(r);case"m":return qt(u);case"q":return qt(u);case"qq":return qt(r);case"s":return qt(u);case"ss":return qt(r);case"S":return qt(d);case"SSS":return qt(i);case"u":return tl(y);case"uu":return tl(u);case"uuu":return qt(t);case"a":return vn(e.meridiems(),0);case"kkkk":return qt(a);case"kk":return qt(C,cs);case"W":return qt(u);case"WW":return qt(r);case"E":case"c":return qt(t);case"EEE":return vn(e.weekdays("short",!1),1);case"EEEE":return vn(e.weekdays("long",!1),1);case"ccc":return vn(e.weekdays("short",!0),1);case"cccc":return vn(e.weekdays("long",!0),1);case"Z":case"ZZ":return Hg(new RegExp(`([+-]${u.source})(?::(${r.source}))?`),2);case"ZZZ":return Hg(new RegExp(`([+-]${u.source})(${r.source})?`),2);case"z":return tl(/[a-z_+-/]{1,256}?/i);case" ":return tl(/[^\S\n\r]/);default:return E(S)}})(s)||{invalidReason:t1};return x.token=s,x}var o1={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function s1(s,e,t){let{type:r,value:i}=s;if(r==="literal"){let d=/^\s+$/.test(i);return{literal:!d,val:d?" ":i}}let a=e[r],l=r;r==="hour"&&(e.hour12!=null?l=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?l="hour12":l="hour24":l=t.hour12?"hour12":"hour24");let u=o1[l];if(typeof u=="object"&&(u=u[a]),u)return{literal:!1,val:u}}function a1(s){return[`^${s.map(t=>t.regex).reduce((t,r)=>`${t}(${r.source})`,"")}$`,s]}function l1(s,e,t){let r=s.match(e);if(r){let i={},a=1;for(let l in t)if(lr(t,l)){let u=t[l],d=u.groups?u.groups+1:1;!u.literal&&u.token&&(i[u.token.val[0]]=u.deser(r.slice(a,a+d))),a+=d}return[r,i]}else return[r,{}]}function u1(s){let e=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},t=null,r;return Nt(s.z)||(t=Ae.create(s.z)),Nt(s.Z)||(t||(t=new de(s.Z)),r=s.Z),Nt(s.q)||(s.M=(s.q-1)*3+1),Nt(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),Nt(s.u)||(s.S=us(s.u)),[Object.keys(s).reduce((a,l)=>{let u=e(l);return u&&(a[u]=s[l]),a},{}),t,r]}var od=null;function c1(){return od||(od=Ot.fromMillis(1555555555555)),od}function d1(s,e){if(s.literal)return s;let t=fe.macroTokenToFormatOpts(s.val),r=ld(t,e);return r==null||r.includes(void 0)?s:r}function sd(s,e){return Array.prototype.concat(...s.map(t=>d1(t,e)))}function ad(s,e,t){let r=sd(fe.parseFormat(t),s),i=r.map(l=>i1(l,s)),a=i.find(l=>l.invalidReason);if(a)return{input:e,tokens:r,invalidReason:a.invalidReason};{let[l,u]=a1(i),d=RegExp(l,"i"),[m,y]=l1(e,d,u),[C,h,E]=y?u1(y):[null,null,void 0];if(lr(y,"a")&&lr(y,"H"))throw new Gn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:d,rawMatches:m,matches:y,result:C,zone:h,specificOffset:E}}}function zg(s,e,t){let{result:r,zone:i,specificOffset:a,invalidReason:l}=ad(s,e,t);return[r,i,a,l]}function ld(s,e){if(!s)return null;let r=fe.create(e,s).dtFormatter(c1()),i=r.formatToParts(),a=r.resolvedOptions();return i.map(l=>s1(l,s,a))}N();var Vg=[0,31,59,90,120,151,181,212,243,273,304,334],jg=[0,31,60,91,121,152,182,213,244,274,305,335];function ln(s,e){return new Pe("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${s}, which is invalid`)}function Jg(s,e,t){let r=new Date(Date.UTC(s,e-1,t));s<100&&s>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);let i=r.getUTCDay();return i===0?7:i}function Kg(s,e,t){return t+(Kr(s)?jg:Vg)[e-1]}function qg(s,e){let t=Kr(s)?jg:Vg,r=t.findIndex(a=>a<e),i=e-t[r];return{month:r+1,day:i}}function el(s){let{year:e,month:t,day:r}=s,i=Kg(e,t,r),a=Jg(e,t,r),l=Math.floor((i-a+10)/7),u;return l<1?(u=e-1,l=ki(u)):l>ki(e)?(u=e+1,l=1):u=e,dt({weekYear:u,weekNumber:l,weekday:a},ds(s))}function ud(s){let{weekYear:e,weekNumber:t,weekday:r}=s,i=Jg(e,1,4),a=qr(e),l=t*7+r-i-3,u;l<1?(u=e-1,l+=qr(u)):l>a?(u=e+1,l-=qr(e)):u=e;let{month:d,day:m}=qg(u,l);return dt({year:u,month:d,day:m},ds(s))}function nl(s){let{year:e,month:t,day:r}=s,i=Kg(e,t,r);return dt({year:e,ordinal:i},ds(s))}function cd(s){let{year:e,ordinal:t}=s,{month:r,day:i}=qg(e,t);return dt({year:e,month:r,day:i},ds(s))}function Zg(s){let e=ls(s.weekYear),t=xn(s.weekNumber,1,ki(s.weekYear)),r=xn(s.weekday,1,7);return e?t?r?!1:ln("weekday",s.weekday):ln("week",s.week):ln("weekYear",s.weekYear)}function Yg(s){let e=ls(s.year),t=xn(s.ordinal,1,qr(s.year));return e?t?!1:ln("ordinal",s.ordinal):ln("year",s.year)}function dd(s){let e=ls(s.year),t=xn(s.month,1,12),r=xn(s.day,1,Bi(s.year,s.month));return e?t?r?!1:ln("day",s.day):ln("month",s.month):ln("year",s.year)}function fd(s){let{hour:e,minute:t,second:r,millisecond:i}=s,a=xn(e,0,23)||e===24&&t===0&&r===0&&i===0,l=xn(t,0,59),u=xn(r,0,59),d=xn(i,0,999);return a?l?u?d?!1:ln("millisecond",i):ln("second",r):ln("minute",t):ln("hour",e)}var hd="Invalid DateTime",Qg=864e13;function rl(s){return new Pe("unsupported zone",`the zone "${s.name}" is not supported`)}function pd(s){return s.weekData===null&&(s.weekData=el(s.c)),s.weekData}function Yr(s,e){let t={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Ot(jt(dt(dt({},t),e),{old:t}))}function ov(s,e,t){let r=s-e*60*1e3,i=t.offset(r);if(e===i)return[r,e];r-=(i-e)*60*1e3;let a=t.offset(r);return i===a?[r,i]:[s-Math.min(i,a)*60*1e3,Math.max(i,a)]}function il(s,e){s+=e*60*1e3;let t=new Date(s);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function sl(s,e,t){return ov(Di(s),e,t)}function Xg(s,e){let t=s.o,r=s.c.year+Math.trunc(e.years),i=s.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,a=jt(dt({},s.c),{year:r,month:i,day:Math.min(s.c.day,Bi(r,i))+Math.trunc(e.days)+Math.trunc(e.weeks)*7}),l=Ut.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),u=Di(a),[d,m]=ov(u,t,s.zone);return l!==0&&(d+=l,m=s.zone.offset(d)),{ts:d,o:m}}function ps(s,e,t,r,i,a){let{setZone:l,zone:u}=t;if(s&&Object.keys(s).length!==0||e){let d=e||u,m=Ot.fromObject(s,jt(dt({},t),{zone:d,specificOffset:a}));return l?m:m.setZone(u)}else return Ot.invalid(new Pe("unparsable",`the input "${i}" can't be parsed as ${r}`))}function ol(s,e,t=!0){return s.isValid?fe.create(Jt.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(s,e):null}function md(s,e){let t=s.c.year>9999||s.c.year<0,r="";return t&&s.c.year>=0&&(r+="+"),r+=ce(s.c.year,t?6:4),e?(r+="-",r+=ce(s.c.month),r+="-",r+=ce(s.c.day)):(r+=ce(s.c.month),r+=ce(s.c.day)),r}function tv(s,e,t,r,i,a){let l=ce(s.c.hour);return e?(l+=":",l+=ce(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=":")):l+=ce(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=ce(s.c.second),(s.c.millisecond!==0||!r)&&(l+=".",l+=ce(s.c.millisecond,3))),i&&(s.isOffsetFixed&&s.offset===0&&!a?l+="Z":s.o<0?(l+="-",l+=ce(Math.trunc(-s.o/60)),l+=":",l+=ce(Math.trunc(-s.o%60))):(l+="+",l+=ce(Math.trunc(s.o/60)),l+=":",l+=ce(Math.trunc(s.o%60)))),a&&(l+="["+s.zone.ianaName+"]"),l}var sv={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},f1={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},h1={ordinal:1,hour:0,minute:0,second:0,millisecond:0},av=["year","month","day","hour","minute","second","millisecond"],p1=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],m1=["year","ordinal","hour","minute","second","millisecond"];function ev(s){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!e)throw new Ni(s);return e}function nv(s,e){let t=gn(e.zone,Qt.defaultZone),r=Jt.fromObject(e),i=Qt.now(),a,l;if(Nt(s.year))a=i;else{for(let m of av)Nt(s[m])&&(s[m]=sv[m]);let u=dd(s)||fd(s);if(u)return Ot.invalid(u);let d=t.offset(i);[a,l]=sl(s,d,t)}return new Ot({ts:a,zone:t,loc:r,o:l})}function rv(s,e,t){let r=Nt(t.round)?!0:t.round,i=(l,u)=>(l=Fi(l,r||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(l,u)),a=l=>t.calendary?e.hasSame(s,l)?0:e.startOf(l).diff(s.startOf(l),l).get(l):e.diff(s,l).get(l);if(t.unit)return i(a(t.unit),t.unit);for(let l of t.units){let u=a(l);if(Math.abs(u)>=1)return i(u,l)}return i(s>e?-0:0,t.units[t.units.length-1])}function iv(s){let e={},t;return s.length>0&&typeof s[s.length-1]=="object"?(e=s[s.length-1],t=Array.from(s).slice(0,s.length-1)):t=Array.from(s),[e,t]}var Ot=class{constructor(e){let t=e.zone||Qt.defaultZone,r=e.invalid||(Number.isNaN(e.ts)?new Pe("invalid input"):null)||(t.isValid?null:rl(t));this.ts=Nt(e.ts)?Qt.now():e.ts;let i=null,a=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[i,a]=[e.old.c,e.old.o];else{let u=t.offset(this.ts);i=il(this.ts,u),r=Number.isNaN(i.year)?new Pe("invalid input"):null,i=r?null:i,a=r?null:u}this._zone=t,this.loc=e.loc||Jt.create(),this.invalid=r,this.weekData=null,this.c=i,this.o=a,this.isLuxonDateTime=!0}static now(){return new Ot({})}static local(){let[e,t]=iv(arguments),[r,i,a,l,u,d,m]=t;return nv({year:r,month:i,day:a,hour:l,minute:u,second:d,millisecond:m},e)}static utc(){let[e,t]=iv(arguments),[r,i,a,l,u,d,m]=t;return e.zone=de.utcInstance,nv({year:r,month:i,day:a,hour:l,minute:u,second:d,millisecond:m},e)}static fromJSDate(e,t={}){let r=dg(e)?e.valueOf():NaN;if(Number.isNaN(r))return Ot.invalid("invalid input");let i=gn(t.zone,Qt.defaultZone);return i.isValid?new Ot({ts:r,zone:i,loc:Jt.fromObject(t)}):Ot.invalid(rl(i))}static fromMillis(e,t={}){if(wn(e))return e<-Qg||e>Qg?Ot.invalid("Timestamp out of range"):new Ot({ts:e,zone:gn(t.zone,Qt.defaultZone),loc:Jt.fromObject(t)});throw new Ie(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(wn(e))return new Ot({ts:e*1e3,zone:gn(t.zone,Qt.defaultZone),loc:Jt.fromObject(t)});throw new Ie("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};let r=gn(t.zone,Qt.defaultZone);if(!r.isValid)return Ot.invalid(rl(r));let i=Qt.now(),a=Nt(t.specificOffset)?r.offset(i):t.specificOffset,l=$i(e,ev),u=!Nt(l.ordinal),d=!Nt(l.year),m=!Nt(l.month)||!Nt(l.day),y=d||m,C=l.weekYear||l.weekNumber,h=Jt.fromObject(t);if((y||u)&&C)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&u)throw new Gn("Can't mix ordinal dates with month/day");let E=C||l.weekday&&!y,w,x,S=il(i,a);E?(w=p1,x=f1,S=el(S)):u?(w=m1,x=h1,S=nl(S)):(w=av,x=sv);let O=!1;for(let v of w){let I=l[v];Nt(I)?O?l[v]=x[v]:l[v]=S[v]:O=!0}let P=E?Zg(l):u?Yg(l):dd(l),g=P||fd(l);if(g)return Ot.invalid(g);let b=E?ud(l):u?cd(l):l,[f,p]=sl(b,a,r),T=new Ot({ts:f,zone:r,o:p,loc:h});return l.weekday&&y&&e.weekday!==T.weekday?Ot.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${T.toISO()}`):T}static fromISO(e,t={}){let[r,i]=wg(e);return ps(r,i,t,"ISO 8601",e)}static fromRFC2822(e,t={}){let[r,i]=xg(e);return ps(r,i,t,"RFC 2822",e)}static fromHTTP(e,t={}){let[r,i]=Ig(e);return ps(r,i,t,"HTTP",t)}static fromFormat(e,t,r={}){if(Nt(e)||Nt(t))throw new Ie("fromFormat requires an input string and a format");let{locale:i=null,numberingSystem:a=null}=r,l=Jt.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0}),[u,d,m,y]=zg(l,e,t);return y?Ot.invalid(y):ps(u,d,r,`format ${t}`,e,m)}static fromString(e,t,r={}){return Ot.fromFormat(e,t,r)}static fromSQL(e,t={}){let[r,i]=Mg(e);return ps(r,i,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the DateTime is invalid");let r=e instanceof Pe?e:new Pe(e,t);if(Qt.throwOnInvalid)throw new Va(r);return new Ot({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){let r=ld(e,Jt.fromObject(t));return r?r.map(i=>i?i.val:null).join(""):null}static expandFormat(e,t={}){return sd(fe.parseFormat(e),Jt.fromObject(t)).map(i=>i.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?pd(this).weekYear:NaN}get weekNumber(){return this.isValid?pd(this).weekNumber:NaN}get weekday(){return this.isValid?pd(this).weekday:NaN}get ordinal(){return this.isValid?nl(this.c).ordinal:NaN}get monthShort(){return this.isValid?zn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,t=6e4,r=Di(this.c),i=this.zone.offset(r-e),a=this.zone.offset(r+e),l=this.zone.offset(r-i*t),u=this.zone.offset(r-a*t);if(l===u)return[this];let d=r-l*t,m=r-u*t,y=il(d,l),C=il(m,u);return y.hour===C.hour&&y.minute===C.minute&&y.second===C.second&&y.millisecond===C.millisecond?[Yr(this,{ts:d}),Yr(this,{ts:m})]:[this]}get isInLeapYear(){return Kr(this.year)}get daysInMonth(){return Bi(this.year,this.month)}get daysInYear(){return this.isValid?qr(this.year):NaN}get weeksInWeekYear(){return this.isValid?ki(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:t,numberingSystem:r,calendar:i}=fe.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:r,outputCalendar:i}}toUTC(e=0,t={}){return this.setZone(de.instance(e),t)}toLocal(){return this.setZone(Qt.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:r=!1}={}){if(e=gn(e,Qt.defaultZone),e.equals(this.zone))return this;if(e.isValid){let i=this.ts;if(t||r){let a=e.offset(this.ts),l=this.toObject();[i]=sl(l,a,e)}return Yr(this,{ts:i,zone:e})}else return Ot.invalid(rl(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:r}={}){let i=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:r});return Yr(this,{loc:i})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let t=$i(e,ev),r=!Nt(t.weekYear)||!Nt(t.weekNumber)||!Nt(t.weekday),i=!Nt(t.ordinal),a=!Nt(t.year),l=!Nt(t.month)||!Nt(t.day),u=a||l,d=t.weekYear||t.weekNumber;if((u||i)&&d)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&i)throw new Gn("Can't mix ordinal dates with month/day");let m;r?m=ud(dt(dt({},el(this.c)),t)):Nt(t.ordinal)?(m=dt(dt({},this.toObject()),t),Nt(t.day)&&(m.day=Math.min(Bi(m.year,m.month),m.day))):m=cd(dt(dt({},nl(this.c)),t));let[y,C]=sl(m,this.o,this.zone);return Yr(this,{ts:y,o:C})}plus(e){if(!this.isValid)return this;let t=Ut.fromDurationLike(e);return Yr(this,Xg(this,t))}minus(e){if(!this.isValid)return this;let t=Ut.fromDurationLike(e).negate();return Yr(this,Xg(this,t))}startOf(e){if(!this.isValid)return this;let t={},r=Ut.normalizeUnit(e);switch(r){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break;case"milliseconds":break}if(r==="weeks"&&(t.weekday=1),r==="quarters"){let i=Math.ceil(this.month/3);t.month=(i-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?fe.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):hd}toLocaleString(e=sr,t={}){return this.isValid?fe.create(this.loc.clone(t),e).formatDateTime(this):hd}toLocaleParts(e={}){return this.isValid?fe.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:r=!1,includeOffset:i=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;let l=e==="extended",u=md(this,l);return u+="T",u+=tv(this,l,t,r,i,a),u}toISODate({format:e="extended"}={}){return this.isValid?md(this,e==="extended"):null}toISOWeekDate(){return ol(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:r=!0,includePrefix:i=!1,extendedZone:a=!1,format:l="extended"}={}){return this.isValid?(i?"T":"")+tv(this,l==="extended",t,e,r,a):null}toRFC2822(){return ol(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ol(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?md(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:r=!0}={}){let i="HH:mm:ss.SSS";return(t||e)&&(r&&(i+=" "),t?i+="z":e&&(i+="ZZ")),ol(this,i,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():hd}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let t=dt({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ut.invalid("created by diffing an invalid DateTime");let i=dt({locale:this.locale,numberingSystem:this.numberingSystem},r),a=fg(t).map(Ut.normalizeUnit),l=e.valueOf()>this.valueOf(),u=l?this:e,d=l?e:this,m=Ug(u,d,a,i);return l?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(Ot.now(),e,t)}until(e){return this.isValid?re.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;let r=e.valueOf(),i=this.setZone(e.zone,{keepLocalTime:!0});return i.startOf(t)<=r&&r<=i.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let t=e.base||Ot.fromObject({},{zone:this.zone}),r=e.padding?this<t?-e.padding:e.padding:0,i=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(i=e.unit,a=void 0),rv(t,this.plus(r),jt(dt({},e),{numeric:"always",units:i,unit:a}))}toRelativeCalendar(e={}){return this.isValid?rv(e.base||Ot.fromObject({},{zone:this.zone}),this,jt(dt({},e),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...e){if(!e.every(Ot.isDateTime))throw new Ie("min requires all arguments be DateTimes");return Zc(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(Ot.isDateTime))throw new Ie("max requires all arguments be DateTimes");return Zc(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,r={}){let{locale:i=null,numberingSystem:a=null}=r,l=Jt.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0});return ad(l,e,t)}static fromStringExplain(e,t,r={}){return Ot.fromFormatExplain(e,t,r)}static get DATE_SHORT(){return sr}static get DATE_MED(){return Go}static get DATE_MED_WITH_WEEKDAY(){return Nc}static get DATE_FULL(){return Wo}static get DATE_HUGE(){return zo}static get TIME_SIMPLE(){return Vo}static get TIME_WITH_SECONDS(){return jo}static get TIME_WITH_SHORT_OFFSET(){return Jo}static get TIME_WITH_LONG_OFFSET(){return Ko}static get TIME_24_SIMPLE(){return qo}static get TIME_24_WITH_SECONDS(){return Zo}static get TIME_24_WITH_SHORT_OFFSET(){return Yo}static get TIME_24_WITH_LONG_OFFSET(){return Qo}static get DATETIME_SHORT(){return Xo}static get DATETIME_SHORT_WITH_SECONDS(){return ts}static get DATETIME_MED(){return es}static get DATETIME_MED_WITH_SECONDS(){return ns}static get DATETIME_MED_WITH_WEEKDAY(){return Dc}static get DATETIME_FULL(){return rs}static get DATETIME_FULL_WITH_SECONDS(){return is}static get DATETIME_HUGE(){return os}static get DATETIME_HUGE_WITH_SECONDS(){return ss}};function Ki(s){if(Ot.isDateTime(s))return s;if(s&&s.valueOf&&wn(s.valueOf()))return Ot.fromJSDate(s);if(s&&typeof s=="object")return Ot.fromObject(s);throw new Ie(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var lv=Gt(Pt),g1=[lv.styles,Oc],Qr=class extends lv{constructor(){super();this.updateComment=({detail:t})=>{let{text:r}=t;this.text=r,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,text:r})};this.resolveAnnotation=t=>{t.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly"};this.resolved=!1}render(){var E;let t=this.annotationFilter==="all"?"resolve":"undo",r=w=>Ot.fromISO(w).toFormat("yyyy-dd-MM"),i=this.resolvable?"comment-item__resolve":"hidden",a=[{label:"EDIT"},{label:"DELETE"}],l=({detail:w})=>{w==="EDIT"&&(this.mode="editable"),w==="DELETE"&&(this.deleteCommentModalOpen=!0)},u=()=>{this.text.length<120||(this.expandElipsis=!0)},d=()=>{if(this.mode==="editable")return gt`
        <superviz-comments-comment-input
          class="comment-item--editable"
          editable
          @click=${w=>w.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{if(this.mode!=="editable")return gt`
        <span
          id="comment-text"
          @click=${u}
          class="text text-big sv-gray-700 ${h}"
          >${this.text}</span
        >
      `},y=()=>{this.deleteCommentModalOpen=!1},C={"comment-item":!0,reply:!this.primaryComment},h=!this.expandElipsis&&this.text.length>120?"line-clamp":"";return gt`
      <div class=${ne(C)}>
        <div class="comment-item__user">
          <div class="comment-item__user-details">
            <div class="comment-item__avatar">
              <p class="text text-bold">${((E=this.username[0])==null?void 0:E.toUpperCase())||"A"}</p>
            </div>
            <span class="text text-bold sv-gray-600">${this.username}</span>
            <span class="text text-small sv-gray-500">${r(this.createdAt)}</span>
          </div>
          <div class="comment-item__actions">
            <button
              @click=${this.resolveAnnotation}
              class="icon-button icon-button--clickable icon-button--xsmall ${i}"
            >
              <superviz-icon name=${t} size="md"></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(a)}
              label="label"
              returnTo="label"
              position="bottom-left"
              @selected=${l}
              @click=${w=>w.stopPropagation()}
            >
              <button slot="dropdown" class="icon-button icon-button--clickable icon-button--small">
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comment-item__content">
          <div class="comment-item__content__body">${d()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${y}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};Qr.styles=g1,Qr.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String}},Qr=kt([$t("superviz-comments-comment-item")],Qr);N();var uv=Gt(Pt),v1=[uv.styles,Tc],Xr=class extends uv{constructor(){super();this.pinCoordinates=null;this.getCommentInput=()=>this.shadowRoot.getElementById("comment-input--textarea");this.getCommentInputContainer=()=>this.shadowRoot.getElementById("comment-input--container");this.getSendBtn=()=>this.shadowRoot.querySelector(".comment-input--send-btn");this.commentInputFocus=({detail:t})=>{this.pinCoordinates=t,this.getCommentInput().focus()};this.sendEnter=t=>{if(t.key!=="Enter"||t.shiftKey)return;let r=this.getCommentInput(),i=r.value.trim();if(!i)return;let a=this.getSendBtn();this.emitEvent(this.eventType,{text:i,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",a.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1})};this.btnActive=!1,this.text=""}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&(window.document.body.addEventListener("comment-input-focus",this.commentInputFocus),this.addEventListener("keyup",this.sendEnter))}disconnectedCallback(){super.disconnectedCallback(),this.eventType==="create-annotation"&&window.document.body.removeEventListener("comment-input-focus",this.commentInputFocus)}updated(t){if(t.has("text")&&this.text.length>0){let r=this.getCommentInput();r.value=this.text,this.updateHeight()}if(t.has("btnActive")){let r=this.getSendBtn();r.disabled=!this.btnActive}}updateHeight(){let t=this.getCommentInput(),r=this.getCommentInputContainer();t.style.height="0px",r.style.height="0px";let i=t.scrollHeight+4,a=t.scrollHeight;t.style.height=`${i}px`,r.style.height=`${a}px`;let l=this.getSendBtn();l.disabled=!(t.value.length>0)}send(t){t.preventDefault();let r=this.getCommentInput(),i=this.getSendBtn(),a=r.value;this.emitEvent(this.eventType,{text:a,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",i.disabled=!0,this.updateHeight()}render(){var i;let t=()=>{if(!!this.editable)return gt`
        <button
          id="close"
          @click=${()=>this.closeEditMode()}
          class="icon-button icon-button--medium icon-button--clickable"
          @click=${this.send}
        >
          <superviz-icon name="close" size="md"></superviz-icon>
        </button>
        <button id="confirm" class="comment-input--send-btn" disabled @click=${this.send}>
          <superviz-icon name="check" size="md"></superviz-icon>
        </button>
      `},r=()=>{if(!this.editable)return gt`
        <button class="comment-input--send-btn align-send-btn" disabled @click=${this.send}>
          <superviz-icon name="send" size="sm"></superviz-icon>
        </button>
      `};return gt`
      <div class="comment-input">
        <div id="comment-input--container">
          <textarea
            id="comment-input--textarea"
            placeholder=${(i=this.placeholder)!=null?i:"Add comment..."}
            @input=${this.updateHeight}
          ></textarea>
        </div>
        <div class="sv-hr"></div>
        <div class="comment-input--options">
          <div>
            <button class="icon-button mention">
              <superviz-icon name="mention" size="sm"></superviz-icon>
            </button>
          </div>
          <div class="comment-input-options">
            ${r()} ${t()}
          </div>
        </div>
      </div>
    `}};Xr.styles=v1,Xr.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean},placeholder:{type:String}},Xr=kt([$t("superviz-comments-comment-input")],Xr);N();var cv=Gt(Pt),y1=[cv.styles,Ic],ti=class extends cv{constructor(){super();this.position={x:0,y:0}}get userInitial(){var r,i,a;return(((a=(i=(r=this.annotation)==null?void 0:r.comments[0])==null?void 0:i.participant)==null?void 0:a.name)||"Anonymous")[0].toUpperCase()}emitClick(){document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:this.annotation.uuid}}))}render(){var r,i;let t={"annotation-pin":!0,"annotation-pin--active":this.active};return this.type==="add"?gt`
        <div
          class=${ne(t)}
          style=${`top: ${this.position.y}px; left: ${this.position.x}px;`}
        >
          <div class="annotation-pin__avatar annotation-pin__avatar--add">
            <superviz-icon name="add"></superviz-icon>
          </div>
        </div>
      `:gt`
      <div
        @click=${this.emitClick}
        class=${ne(t)}
        style=${`top: ${(r=this.position)==null?void 0:r.y}px; left: ${(i=this.position)==null?void 0:i.x}px; pointer-events: auto;`}
      >
        <div class="annotation-pin__avatar">
          <p class="text text-bold text-big">${this.userInitial}</p>
          <!-- <img src="https://picsum.photos/200/300" alt="" /> -->
        </div>
      </div>
    `}};ti.styles=y1,ti.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean}},ti=kt([$t("superviz-comments-annotation-pin")],ti);N();var dv=Gt(Pt),b1=[dv.styles,wc],ei=class extends dv{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))};this.resolveAnnotation=({detail:t})=>{let{uuid:r}=this.annotation,{resolved:i,type:a}=t,l=a==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=i,this.emitEvent("resolve-annotation",{uuid:r,resolved:i}),l&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpantedCommentesTemplate=(t,r)=>r===0?gt``:gt`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar="https://picsum.photos/200/300"
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
      ></superviz-comments-comment-item>
    `}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHiddenAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{"annotation-item":!0,"annotation-item--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,hidden:!(!this.expandComments&&this.replies>=1)}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,hidden:!(this.isSelected&&this.expandComments)}}firstUpdated(){this.resolved=this.annotation.resolved}updated(t){if(t.has("selected")){let r=this.selected===this.annotation.uuid;this.expandComments=r}}createComment({detail:t}){let{text:r}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,text:r})}generateAvatarCommentsTemplate(){var r,i;let t=[];for(let a=1;a<=this.repliesSize;a++)t.push(gt`
        <div class="avatar">
          <p class="text text-bold">
            ${((i=(r=this.annotation.comments[a])==null?void 0:r.participant.name[0])==null?void 0:i.toUpperCase())||"A"}
          </p>
        </div>
      `);return gt`
      ${t}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?gt`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${ne({hidden:this.filterIsResolved})}
      >
      </superviz-comments-annotation-resolved>
    `:gt``}render(){var t,r,i,a,l,u;return gt`
      ${this.annotationResolvedTemplate()}

      <div class=${ne(this.shouldHiddenAnnotation)}>
        <div class=${ne(this.annotationClasses)} @click=${this.selectAnnotation}>
          <div>
            <superviz-comments-comment-item
              uuid=${(t=this.annotation.comments)==null?void 0:t[0].uuid}
              annotationId=${this.annotation.uuid}
              username=${((i=(r=this.annotation.comments)==null?void 0:r[0].participant)==null?void 0:i.name)||"Anonymous"}
              text=${(a=this.annotation.comments)==null?void 0:a[0].text}
              createdAt=${(l=this.annotation.comments)==null?void 0:l[0].createdAt}
              primaryComment
              resolvable
              ?resolved=${this.resolved}
              annotationFilter=${this.annotationFilter}
              @resolve-annotation=${this.resolveAnnotation}
            ></superviz-comments-comment-item>

            <div class=${ne(this.avatarCommentsClasses)}>
              <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
            </div>
          </div>

          <div class=${ne(this.commentsClasses)}>
            ${(u=this.annotation.comments)==null?void 0:u.map(this.generateExpantedCommentesTemplate)}
            <superviz-comments-comment-input
              @create-comment=${this.createComment}
              eventType="create-comment"
              @click=${d=>d.stopPropagation()}
              placeholder="Reply"
            ></superviz-comments-comment-input>
          </div>
        </div>
        <div class=${ne(this.hrClasses)}></div>
      </div>
    `}};ei.styles=b1,ei.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String}},ei=kt([$t("superviz-comments-annotation-item")],ei);N();var fv=Gt(Pt),E1=[fv.styles],ni=class extends fv{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:gt`<span class="text text-big sv-gray-600">Are you sure you want to delete this comment? <br /> This action cannot be undone</span>`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return gt`<slot name="modal-handler" @click=${this.toggle}></slot>`},r=()=>{if(!!this.open)return gt`
        <superviz-modal></superviz-modal>
      `};return gt`
      ${t()}
      ${r()}
    `}};ni.styles=E1,ni.properties={open:{type:Boolean},useSlot:{type:Boolean}},ni=kt([$t("superviz-comments-delete-comments-modal")],ni);N();var hv=Gt(Pt),C1=[hv.styles,xc],A1=10*1e3,ri=class extends hv{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=A1,this.isCanceled=!1}firstUpdated(){this.setTimer()}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?gt``:this.isCanceled?gt``:gt`
      <div class="annotation-resolved">
        <span class="text text-big sv-gray-700">You resolved this comment</span>
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};ri.styles=C1,ri.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},ri=kt([$t("superviz-comments-annotation-resolved")],ri);N();var pv=Gt(Pt),O1=[pv.styles,Pc],ms=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],ii=class extends pv{constructor(){super();this.caret="down"}render(){let t=this.filter==="all"?ms[0].label:ms[1].label,r=({detail:u})=>{this.emitEvent("select",{filter:u}),i()},i=()=>{this.caret=this.caret==="down"?"up":"down"},a=this.filter==="all"?ms[0].code:ms[1].code,l={text:!0,"text-bold":!0,"select-content":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return gt`
      <div class="select">
        <div class="select-container">
          <superviz-dropdown
            options=${JSON.stringify(ms)}
            active=${a}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${i}
            @selected=${r}
            @close=${i}
          >
            <div class="content" slot="dropdown">
              <span class=${ne(l)}>${t}</span>
              <superviz-icon name=${this.caret} size="md"></superviz-icon>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};ii.styles=O1,ii.properties={filter:{type:String},caret:{type:String}},ii=kt([$t("superviz-comments-annotation-filter")],ii);N();var mv=Gt(Pt),S1=[mv.styles,Rc],oi=class extends mv{constructor(){super();this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden})}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".float-button");if(!r)return;r.setAttribute("style",this.positionStyles);let i=window.document.body.getBoundingClientRect().width,a=r.getBoundingClientRect(),l=320;if(!this.commentsPosition||this.commentsPosition==="left"){this.shouldHide=a.x<l;return}this.shouldHide=i-a.right<l})}render(){let t={"float-button":!0,"hide-button":!this.isHidden&&this.shouldHide};return gt` <button @click=${this.toggle} class="${ne(t)}">
      <superviz-icon name="comment"></superviz-icon>

      <p class="text text-big text-bold">Comments</p>
    </button>`}};oi.styles=S1,oi.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String}},oi=kt([$t("superviz-comments-button")],oi);N();N();N();var gs=(t=>(t.GOTO="GO TO",t.FOLLOW="FOLLOW",t))(gs||{});N();N();var gd=It`
  .superviz-who-is-online {
    position: fixed;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .superviz-who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #aea9b8;
    user-select: none;
  }

  .superviz-who-is-online__participant:not(.local) {
    cursor: pointer;
  }

  .superviz-who-is-online__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 18px;
    line-height: 18px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .superviz-who-is-online__excess {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Roboto;
    font-size: 16px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
    color: #26242a;
    cursor: pointer;
  }

  .excess_participants:hover,
  .excess_participants--open {
    background-color: #aea9b8 !important;
  }

  .excess_participants:hover > div,
  .excess_participants--open > div {
    color: #fff !important;
  }

  @media (max-width: 780px) {
    .superviz-who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .superviz-who-is-online__avatar {
      width: 24px;
      height: 24px;
    }

    .superviz-who-is-online {
      gap: 8px;
    }
  }
`;N();var vd=It`
  .dropdown {
    position: relative;
  }

  .who-is-online-dropdown__content {
    display: flex;
    user-select: none;
    align-items: center;
    justify-items: start;
    gap: 4px;
    width: 100%;
    padding: 10px;
    border-radius: 2px;
    position: relative;
  }

  .who-is-online-dropdown__content:not(.local) {
    cursor: pointer;
  }

  .who-is-online-dropdown__content:hover,
  .who-is-online-dropdown__content--selected {
    background-color: rgb(var(--sv-gray-200));
  }

  .who-is-online-dropdown__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .who-is-online-dropdown__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 18px;
    line-height: 18px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .dropdown-list {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .dropdown-list > div {
    padding: 4px;
    min-width: 216px;
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .menu--bottom {
    top: 4px;
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .menu--top {
    bottom: 44px;
    min-width: 103px;
    position: absolute;
    right: 0px;
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .user-name {
    font-size: 14px;
    line-height: 20px;
    font-family: 'Open sans';
    color: rgb(var(--sv-gray-600));
  }

  .icon {
    flex: 1;
    justify-content: flex-end;
    display: flex;
    visibility: hidden;
  }

  @media (max-width: 780px) {
    .sv-icon,
    .who-is-online-dropdown__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online-dropdown__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online-dropdown__avatar {
      width: 24px;
      height: 24px;
    }

    .dropdown-list > div {
      min-width: 192px;
    }
  }

  @media (max-width: 780px) {
    .menu--top {
      bottom: 36px;
    }
  }
`;var gv=Gt(Pt),T1=[gv.styles,gd],si=class extends gv{constructor(){super();this.onClickOutDropdown=({detail:t})=>{this.open=t.open};this.dropdownOptionsHandler=({detail:t})=>{};this.position="top: 20px; right: 40px;",this.open=!1,this.textColorValues=[2,4,5,7,8,16]}updateParticipants(t){this.participants=t}toggleOpen(){this.open=!this.open}dropdownPosition(t){if(this.participants.length===1)return"bottom-center";if(t===0)return"bottom-right";let r=this.participants.length>4,i=t+1===this.participants.length;return r||!i?"bottom-center":"bottom-left"}renderExcessParticipants(){let t=this.participants.length-4;if(t<=0)return gt``;let r=this.participants.slice(4).map(({name:l,color:u,id:d,slotIndex:m,avatar:y,isLocal:C})=>({name:l,color:u,id:d,slotIndex:m,avatar:y,isLocal:C})),i={"superviz-who-is-online__participant":!0,excess_participants:!0,"excess_participants--open":this.open};return gt`
      <superviz-who-is-online-dropdown
        label="label"
        returnTo="label"
        position="bottom"
        @selected=${this.dropdownOptionsHandler}
        participants=${JSON.stringify(r)}
        @clickout=${this.onClickOutDropdown}
      >
        <div class=${ne(i)} slot="dropdown" @click=${this.toggleOpen}>
          <div class="superviz-who-is-online__excess" style="color: #AEA9B8;">+${t}</div>
        </div>
      </superviz-who-is-online-dropdown>
    `}getAvatar(t){var i,a;if((i=t.avatar)!=null&&i.imageUrl)return gt` <img
        class="superviz-who-is-online__avatar"
        src=${t.avatar.imageUrl}
      />`;let r=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A";return gt`<div
      class="superviz-who-is-online__avatar"
      style="background-color: ${t.color}; color: ${r}"
    >
      ${(a=t.name)==null?void 0:a.at(0)}
    </div>`}renderParticipants(){if(!this.participants)return gt``;let t=["place","send"];return gt`${this.participants.slice(0,4).map((r,i)=>{var m;let a=this.textColorValues.includes(r.slotIndex)?"#FFFFFF":"#26242A",l=Object.values(gs).map(y=>({label:y,id:r.id})).splice(0,1),u={"superviz-who-is-online__participant":!0,local:r.isLocal},d=this.dropdownPosition(i);return gt`
        <superviz-dropdown
          options=${JSON.stringify(l)}
          label="label"
          position="${d}"
          @selected=${this.dropdownOptionsHandler}
          icons="${JSON.stringify(t)}"
          name="${r.name}"
          ?disabled=${r.isLocal}
        >
          -->
          <div
            slot="dropdown"
            class=${ne(u)}
            style="border-color: ${r.color}"
          >
            <div
              class="superviz-who-is-online__avatar"
              style="background-color: ${r.color}; color: ${a}"
            >
              ${(m=r.name)==null?void 0:m.at(0).toUpperCase()}
            </div>
          </div>
        </superviz-dropdown>
      `})}
    ${this.renderExcessParticipants()} `}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".superviz-who-is-online");!r||r.setAttribute("style",this.position)})}render(){return gt` <div class="superviz-who-is-online">${this.renderParticipants()}</div>`}};si.styles=T1,si.properties={position:{type:String},participants:{type:Object},open:{type:Boolean}},si=kt([$t("superviz-who-is-online")],si);N();N();var vv=Gt(Pt),w1=[vv.styles,vd],ai=class extends vv{constructor(){super();this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let r=t.composedPath(),i=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],d=r.includes(i),m=r.includes(a),y=r.includes(u);d||m||y||(this.open=!1,this.selected="",this.emitEvent("clickout",{detail:{open:this.open},bubbles:!1,composed:!1}))};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.dropdownOptionsHandler=({detail:t})=>{};this.selectParticipant=t=>()=>{this.selected=t};this.adjustPosition=()=>{let{top:t,bottom:r}=this.dropdownBounds,{innerHeight:i}=window,a=this.positionAction();if(a===0)return;if(a===1){let m=this.originalPosition.split("-")[0];this.position=this.position.replace(/top|bottom/,m);return}let l=i-r>t?"bottom":"top",u=this.position.split("-")[0],d=this.position.replace(u,l);this.position=d};this.textColorValues=[2,4,5,7,8,16],this.selected=""}updated(t){if(t.has("open")){if(this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown),this.close()}}getAvatar(t){var i,a;if((i=t.avatar)!=null&&i.imageUrl)return gt` <img
        class="who-is-online-dropdown__avatar"
        src=${t.avatar.imageUrl}
      />`;let r=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A";return gt`<div
      class="who-is-online-dropdown__avatar"
      style="background-color: ${t.color}; color: ${r}"
    >
      ${(a=t.name)==null?void 0:a.at(0)}
    </div>`}renderParticipants(){if(!this.participants)return;let t=["place","send"];return this.participants.map(r=>{let i=this.textColorValues.includes(r.slotIndex)?"#FFFFFF":"#26242A",a={"who-is-online-dropdown__content":!0,"who-is-online-dropdown__content--selected":this.selected===r.id,local:r.isLocal},l=Object.values(gs).map(u=>({label:u,id:r.id})).splice(0,1);return gt`
        <superviz-dropdown
        options=${JSON.stringify(l)}
        label="label"
        position="bottom-right"
        
        icons="${JSON.stringify(t)}"
        ?disabled=${r.isLocal}
        >
        <div 
          class=${ne(a)} 
          @click=${this.selectParticipant(r.id)} slot="dropdown">
          <div class="who-is-online-dropdown__participant" style="border-color: 
          ${r.color}">
              ${this.getAvatar(r)}
            </div>
            <span class="user-name">${r.name}</span>
            <superviz-icon class="icon" name="right" color="var(--sv-gray-600)"></superviz-icon>
          </div>
        </div>
      </superviz-dropdown>
      `})}setMenu(){var t;if(!this.menu){this.menu=this.shadowRoot.querySelector(".menu");let r={rootMargin:"0px",threshold:1},i=new IntersectionObserver(this.adjustPosition,r),a=new ResizeObserver(this.adjustPosition),l=this.menu;i.observe(l),a.observe((t=this.scrollableParent)!=null?t:document.body)}}get scrollableParent(){let t;this.host||(this.host=this.getRootNode().host);let r=this.host;for(;!t;){let i=r==null?void 0:r.parentElement;if(this.isScrollable(i)){t=i;break}if(r=i,!r)break}return t}isScrollable(t){if(!t)return!1;let r=t.scrollHeight>t.clientHeight,i=window.getComputedStyle(t).overflowY,a=window.getComputedStyle(t).overflowX,l=i.indexOf("hidden")!==-1,u=a.indexOf("hidden")!==-1;return r&&!l&&!u}get dropdownBounds(){this.dropdownContent||(this.dropdownContent=this.shadowRoot.querySelector(".dropdown-content"));let t=this.dropdownContent.getBoundingClientRect(),{y:r,height:i}=this.menu.getBoundingClientRect();return{top:r,bottom:r+i+4,height:i+4,contentY:t.y}}shouldUseOriginalVertical(){let{height:t,contentY:r}=this.dropdownBounds,{innerHeight:i}=window,a=r+t;return this.originalPosition.includes("bottom")?t+a<i:r-t>0}positionAction(){let{top:t,bottom:r}=this.dropdownBounds,{innerHeight:i}=window,a=r>i,l=t<0;return a&&this.position.includes("bottom")||l&&this.position.includes("top")?2:!a&&!l&&this.shouldUseOriginalVertical()?1:0}toggle(){this.originalPosition||(this.originalPosition=this.position),this.setMenu(),this.open=!this.open,this.open&&(this.selected="",setTimeout(()=>this.adjustPosition()))}get menuClasses(){return{menu:!0,"menu--bottom":this.position==="bottom","menu--top":this.position==="top","menu-open":this.open}}render(){return gt`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <div class=${ne(this.menuClasses)}>${this.renderParticipants()}</div>
      </div>
    `}};ai.styles=w1,ai.properties={open:{type:Boolean},align:{type:String},position:{type:String},participants:{type:Array},selected:{type:String}},ai=kt([$t("superviz-who-is-online-dropdown")],ai);N();N();function yv(s){if(typeof document!="undefined"){let e=document.createElement("style");e.id="superviz-style";let t=document.createTextNode(s);e.appendChild(t),document.head.appendChild(e)}}var bv=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:17px;width:17px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg)}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:yellow;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2;transition:all .3s ease-in-out}
`;yv(bv);N();N();N();window&&(window.SuperVizRoom={init:Zu,MeetingEvent:ho,DeviceEvent:xu,RealtimeEvent:Cr,MeetingState:aa,MeetingConnectionStatus:mo,MeetingControlsEvent:sa,ParticipantEvent:la,FrameEvent:po,LayoutMode:ga,VideoConference:wo,MousePointers:xo,Realtime:Io,Comments:bo,CanvasPin:Co,WhoIsOnline:Po,ParticipantType:Ci,LayoutPosition:So,CamerasPosition:va,RealtimeComponentState:ba,RealtimeComponentEvent:Ea});var ZF=Zu;export{Oo as BrowserService,va as CamerasPosition,xu as DeviceEvent,po as FrameEvent,ga as LayoutMode,So as LayoutPosition,mo as MeetingConnectionStatus,sa as MeetingControlsEvent,ho as MeetingEvent,aa as MeetingState,Ct as Observer,la as ParticipantEvent,Ci as ParticipantType,fa as PinMode,Ea as RealtimeComponentEvent,ba as RealtimeComponentState,Cr as RealtimeEvent,ZF as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
