var zS=Object.create;var lo=Object.defineProperty,VS=Object.defineProperties,Gh=Object.getOwnPropertyDescriptor,jS=Object.getOwnPropertyDescriptors,KS=Object.getOwnPropertyNames,Qs=Object.getOwnPropertySymbols,JS=Object.getPrototypeOf,El=Object.prototype.hasOwnProperty,Wh=Object.prototype.propertyIsEnumerable;var zh=Math.pow,Hh=(s,e,t)=>e in s?lo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fe=(s,e)=>{for(var t in e||(e={}))El.call(e,t)&&Hh(s,t,e[t]);if(Qs)for(var t of Qs(e))Wh.call(e,t)&&Hh(s,t,e[t]);return s},Ve=(s,e)=>VS(s,jS(e));var Al=(s,e)=>{var t={};for(var r in s)El.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&Qs)for(var r of Qs(s))e.indexOf(r)<0&&Wh.call(s,r)&&(t[r]=s[r]);return t};var Cl=(s,e)=>()=>(s&&(e=s(s=0)),e);var gt=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Vh=(s,e)=>{for(var t in e)lo(s,t,{get:e[t],enumerable:!0})},qS=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of KS(e))!El.call(s,i)&&i!==t&&lo(s,i,{get:()=>e[i],enumerable:!(r=Gh(e,i))||r.enumerable});return s};var Un=(s,e,t)=>(t=s!=null?zS(JS(s)):{},qS(e||!s||!s.__esModule?lo(t,"default",{value:s,enumerable:!0}):t,s));var Ge=(s,e,t,r)=>{for(var i=r>1?void 0:r?Gh(e,t):e,a=s.length-1,u;a>=0;a--)(u=s[a])&&(i=(r?u(e,t,i):u(i))||i);return r&&i&&lo(e,t,i),i};var Me=(s,e,t)=>new Promise((r,i)=>{var a=f=>{try{l(t.next(f))}catch(m){i(m)}},u=f=>{try{l(t.throw(f))}catch(m){i(m)}},l=f=>f.done?r(f.value):Promise.resolve(f.value).then(a,u);l((t=t.apply(s,e)).next())});var Q,U=Cl(()=>{Q={}});var Kh=gt((Aw,jh)=>{U();var bi=1e3,Ei=bi*60,Ai=Ei*60,Cr=Ai*24,YS=Cr*7,QS=Cr*365.25;jh.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return XS(s);if(t==="number"&&isFinite(s))return e.long?tT(s):eT(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function XS(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*QS;case"weeks":case"week":case"w":return t*YS;case"days":case"day":case"d":return t*Cr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ai;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ei;case"seconds":case"second":case"secs":case"sec":case"s":return t*bi;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function eT(s){var e=Math.abs(s);return e>=Cr?Math.round(s/Cr)+"d":e>=Ai?Math.round(s/Ai)+"h":e>=Ei?Math.round(s/Ei)+"m":e>=bi?Math.round(s/bi)+"s":s+"ms"}function tT(s){var e=Math.abs(s);return e>=Cr?na(s,e,Cr,"day"):e>=Ai?na(s,e,Ai,"hour"):e>=Ei?na(s,e,Ei,"minute"):e>=bi?na(s,e,bi,"second"):s+" ms"}function na(s,e,t,r){var i=e>=t*1.5;return Math.round(s/t)+" "+r+(i?"s":"")}});var qh=gt((Cw,Jh)=>{U();function nT(s){t.debug=t,t.default=t,t.coerce=f,t.disable=a,t.enable=i,t.enabled=u,t.humanize=Kh(),t.destroy=m,Object.keys(s).forEach(b=>{t[b]=s[b]}),t.names=[],t.skips=[],t.formatters={};function e(b){let C=0;for(let h=0;h<b.length;h++)C=(C<<5)-C+b.charCodeAt(h),C|=0;return t.colors[Math.abs(C)%t.colors.length]}t.selectColor=e;function t(b){let C,h=null,E,w;function I(...S){if(!I.enabled)return;let T=I,x=Number(new Date),g=x-(C||x);T.diff=g,T.prev=C,T.curr=x,C=x,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let y=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(p,O)=>{if(p==="%%")return"%";y++;let v=t.formatters[O];if(typeof v=="function"){let R=S[y];p=v.call(T,R),S.splice(y,1),y--}return p}),t.formatArgs.call(T,S),(T.log||t.log).apply(T,S)}return I.namespace=b,I.useColors=t.useColors(),I.color=t.selectColor(b),I.extend=r,I.destroy=t.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(E!==t.namespaces&&(E=t.namespaces,w=t.enabled(b)),w),set:S=>{h=S}}),typeof t.init=="function"&&t.init(I),I}function r(b,C){let h=t(this.namespace+(typeof C=="undefined"?":":C)+b);return h.log=this.log,h}function i(b){t.save(b),t.namespaces=b,t.names=[],t.skips=[];let C,h=(typeof b=="string"?b:"").split(/[\s,]+/),E=h.length;for(C=0;C<E;C++)!h[C]||(b=h[C].replace(/\*/g,".*?"),b[0]==="-"?t.skips.push(new RegExp("^"+b.slice(1)+"$")):t.names.push(new RegExp("^"+b+"$")))}function a(){let b=[...t.names.map(l),...t.skips.map(l).map(C=>"-"+C)].join(",");return t.enable(""),b}function u(b){if(b[b.length-1]==="*")return!0;let C,h;for(C=0,h=t.skips.length;C<h;C++)if(t.skips[C].test(b))return!1;for(C=0,h=t.names.length;C<h;C++)if(t.names[C].test(b))return!0;return!1}function l(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}function f(b){return b instanceof Error?b.stack||b.message:b}function m(){}return t.enable(t.load()),t}Jh.exports=nT});var Tl=gt((Jt,ra)=>{U();Jt.formatArgs=iT;Jt.save=oT;Jt.load=sT;Jt.useColors=rT;Jt.storage=aT();Jt.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Jt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function rT(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function iT(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+ra.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),s.splice(r,0,e)}Jt.log=console.debug||console.log||(()=>{});function oT(s){try{s?Jt.storage.setItem("debug",s):Jt.storage.removeItem("debug")}catch(e){}}function sT(){let s;try{s=Jt.storage.getItem("debug")}catch(e){}return!s&&typeof process!="undefined"&&"env"in process&&(s=Q.DEBUG),s}function aT(){try{return localStorage}catch(s){}}ra.exports=qh()(Jt);var{formatters:uT}=ra.exports;uT.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ia=gt((Tw,Yh)=>{U();function lT(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}Yh.exports=lT});var Xh=gt((Ow,Qh)=>{U();var cT=typeof global=="object"&&global&&global.Object===Object&&global;Qh.exports=cT});var Ol=gt((ww,ep)=>{U();var fT=Xh(),dT=typeof self=="object"&&self&&self.Object===Object&&self,hT=fT||dT||Function("return this")();ep.exports=hT});var np=gt((Iw,tp)=>{U();var pT=Ol(),mT=function(){return pT.Date.now()};tp.exports=mT});var ip=gt((Rw,rp)=>{U();var gT=/\s/;function vT(s){for(var e=s.length;e--&&gT.test(s.charAt(e)););return e}rp.exports=vT});var sp=gt((xw,op)=>{U();var yT=ip(),bT=/^\s+/;function ET(s){return s&&s.slice(0,yT(s)+1).replace(bT,"")}op.exports=ET});var wl=gt((Mw,ap)=>{U();var AT=Ol(),CT=AT.Symbol;ap.exports=CT});var fp=gt((_w,cp)=>{U();var up=wl(),lp=Object.prototype,ST=lp.hasOwnProperty,TT=lp.toString,po=up?up.toStringTag:void 0;function OT(s){var e=ST.call(s,po),t=s[po];try{s[po]=void 0;var r=!0}catch(a){}var i=TT.call(s);return r&&(e?s[po]=t:delete s[po]),i}cp.exports=OT});var hp=gt((Pw,dp)=>{U();var wT=Object.prototype,IT=wT.toString;function RT(s){return IT.call(s)}dp.exports=RT});var vp=gt((Lw,gp)=>{U();var pp=wl(),xT=fp(),MT=hp(),_T="[object Null]",PT="[object Undefined]",mp=pp?pp.toStringTag:void 0;function LT(s){return s==null?s===void 0?PT:_T:mp&&mp in Object(s)?xT(s):MT(s)}gp.exports=LT});var bp=gt((Dw,yp)=>{U();function DT(s){return s!=null&&typeof s=="object"}yp.exports=DT});var Ap=gt((Nw,Ep)=>{U();var NT=vp(),FT=bp(),UT="[object Symbol]";function BT(s){return typeof s=="symbol"||FT(s)&&NT(s)==UT}Ep.exports=BT});var Op=gt((Fw,Tp)=>{U();var kT=sp(),Cp=ia(),$T=Ap(),Sp=0/0,HT=/^[-+]0x[0-9a-f]+$/i,GT=/^0b[01]+$/i,WT=/^0o[0-7]+$/i,zT=parseInt;function VT(s){if(typeof s=="number")return s;if($T(s))return Sp;if(Cp(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=Cp(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=kT(s);var t=GT.test(s);return t||WT.test(s)?zT(s.slice(2),t?2:8):HT.test(s)?Sp:+s}Tp.exports=VT});var Rp=gt((Uw,Ip)=>{U();var jT=ia(),Il=np(),wp=Op(),KT="Expected a function",JT=Math.max,qT=Math.min;function ZT(s,e,t){var r,i,a,u,l,f,m=0,b=!1,C=!1,h=!0;if(typeof s!="function")throw new TypeError(KT);e=wp(e)||0,jT(t)&&(b=!!t.leading,C="maxWait"in t,a=C?JT(wp(t.maxWait)||0,e):a,h="trailing"in t?!!t.trailing:h);function E(p){var O=r,v=i;return r=i=void 0,m=p,u=s.apply(v,O),u}function w(p){return m=p,l=setTimeout(T,e),b?E(p):u}function I(p){var O=p-f,v=p-m,R=e-O;return C?qT(R,a-v):R}function S(p){var O=p-f,v=p-m;return f===void 0||O>=e||O<0||C&&v>=a}function T(){var p=Il();if(S(p))return x(p);l=setTimeout(T,I(p))}function x(p){return l=void 0,h&&r?E(p):(r=i=void 0,u)}function g(){l!==void 0&&clearTimeout(l),m=0,r=f=i=l=void 0}function y(){return l===void 0?u:x(Il())}function d(){var p=Il(),O=S(p);if(r=arguments,i=this,f=p,O){if(l===void 0)return w(f);if(C)return clearTimeout(l),l=setTimeout(T,e),E(f)}return l===void 0&&(l=setTimeout(T,e)),u}return d.cancel=g,d.flush=y,d}Ip.exports=ZT});var Rl=gt((Bw,xp)=>{U();var YT=Rp(),QT=ia(),XT="Expected a function";function eO(s,e,t){var r=!0,i=!0;if(typeof s!="function")throw new TypeError(XT);return QT(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),YT(s,e,{leading:r,maxWait:e,trailing:i})}xp.exports=eO});var oa=gt((Ci,mo)=>{U();(function(){var s,e="4.17.21",t=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",a="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",l=500,f="__lodash_placeholder__",m=1,b=2,C=4,h=1,E=2,w=1,I=2,S=4,T=8,x=16,g=32,y=64,d=128,p=256,O=512,v=30,R="...",N=800,z=16,W=1,F=2,_=3,L=1/0,$=9007199254740991,G=17976931348623157e292,K=0/0,ee=4294967295,re=ee-1,X=ee>>>1,P=[["ary",d],["bind",w],["bindKey",I],["curry",T],["curryRight",x],["flip",O],["partial",g],["partialRight",y],["rearg",p]],B="[object Arguments]",H="[object Array]",j="[object AsyncFunction]",te="[object Boolean]",ce="[object Date]",me="[object DOMException]",be="[object Error]",Se="[object Function]",$e="[object GeneratorFunction]",de="[object Map]",Ze="[object Number]",bt="[object Null]",it="[object Object]",dt="[object Promise]",un="[object Proxy]",vn="[object RegExp]",at="[object Set]",yn="[object String]",Vn="[object Symbol]",Ki="[object Undefined]",fr="[object WeakMap]",ru="[object WeakSet]",q="[object ArrayBuffer]",oe="[object DataView]",le="[object Float32Array]",ve="[object Float64Array]",Ne="[object Int8Array]",St="[object Int16Array]",In="[object Int32Array]",iu="[object Uint8Array]",ou="[object Uint8ClampedArray]",su="[object Uint16Array]",au="[object Uint32Array]",fv=/\b__p \+= '';/g,dv=/\b(__p \+=) '' \+/g,hv=/(__e\(.*?\)|\b__t\)) \+\n'';/g,df=/&(?:amp|lt|gt|quot|#39);/g,hf=/[&<>"']/g,pv=RegExp(df.source),mv=RegExp(hf.source),gv=/<%-([\s\S]+?)%>/g,vv=/<%([\s\S]+?)%>/g,pf=/<%=([\s\S]+?)%>/g,yv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bv=/^\w*$/,Ev=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,uu=/[\\^$.*+?()[\]{}|]/g,Av=RegExp(uu.source),lu=/^\s+/,Cv=/\s/,Sv=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Tv=/\{\n\/\* \[wrapped with (.+)\] \*/,Ov=/,? & /,wv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Iv=/[()=,{}\[\]\/\s]/,Rv=/\\(\\)?/g,xv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mf=/\w*$/,Mv=/^[-+]0x[0-9a-f]+$/i,_v=/^0b[01]+$/i,Pv=/^\[object .+?Constructor\]$/,Lv=/^0o[0-7]+$/i,Dv=/^(?:0|[1-9]\d*)$/,Nv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,cs=/($^)/,Fv=/['\n\r\u2028\u2029\\]/g,fs="\\ud800-\\udfff",Uv="\\u0300-\\u036f",Bv="\\ufe20-\\ufe2f",kv="\\u20d0-\\u20ff",gf=Uv+Bv+kv,vf="\\u2700-\\u27bf",yf="a-z\\xdf-\\xf6\\xf8-\\xff",$v="\\xac\\xb1\\xd7\\xf7",Hv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Gv="\\u2000-\\u206f",Wv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bf="A-Z\\xc0-\\xd6\\xd8-\\xde",Ef="\\ufe0e\\ufe0f",Af=$v+Hv+Gv+Wv,cu="['\u2019]",zv="["+fs+"]",Cf="["+Af+"]",ds="["+gf+"]",Sf="\\d+",Vv="["+vf+"]",Tf="["+yf+"]",Of="[^"+fs+Af+Sf+vf+yf+bf+"]",fu="\\ud83c[\\udffb-\\udfff]",jv="(?:"+ds+"|"+fu+")",wf="[^"+fs+"]",du="(?:\\ud83c[\\udde6-\\uddff]){2}",hu="[\\ud800-\\udbff][\\udc00-\\udfff]",oi="["+bf+"]",If="\\u200d",Rf="(?:"+Tf+"|"+Of+")",Kv="(?:"+oi+"|"+Of+")",xf="(?:"+cu+"(?:d|ll|m|re|s|t|ve))?",Mf="(?:"+cu+"(?:D|LL|M|RE|S|T|VE))?",_f=jv+"?",Pf="["+Ef+"]?",Jv="(?:"+If+"(?:"+[wf,du,hu].join("|")+")"+Pf+_f+")*",qv="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Zv="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lf=Pf+_f+Jv,Yv="(?:"+[Vv,du,hu].join("|")+")"+Lf,Qv="(?:"+[wf+ds+"?",ds,du,hu,zv].join("|")+")",Xv=RegExp(cu,"g"),ey=RegExp(ds,"g"),pu=RegExp(fu+"(?="+fu+")|"+Qv+Lf,"g"),ty=RegExp([oi+"?"+Tf+"+"+xf+"(?="+[Cf,oi,"$"].join("|")+")",Kv+"+"+Mf+"(?="+[Cf,oi+Rf,"$"].join("|")+")",oi+"?"+Rf+"+"+xf,oi+"+"+Mf,Zv,qv,Sf,Yv].join("|"),"g"),ny=RegExp("["+If+fs+gf+Ef+"]"),ry=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,iy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oy=-1,ot={};ot[le]=ot[ve]=ot[Ne]=ot[St]=ot[In]=ot[iu]=ot[ou]=ot[su]=ot[au]=!0,ot[B]=ot[H]=ot[q]=ot[te]=ot[oe]=ot[ce]=ot[be]=ot[Se]=ot[de]=ot[Ze]=ot[it]=ot[vn]=ot[at]=ot[yn]=ot[fr]=!1;var rt={};rt[B]=rt[H]=rt[q]=rt[oe]=rt[te]=rt[ce]=rt[le]=rt[ve]=rt[Ne]=rt[St]=rt[In]=rt[de]=rt[Ze]=rt[it]=rt[vn]=rt[at]=rt[yn]=rt[Vn]=rt[iu]=rt[ou]=rt[su]=rt[au]=!0,rt[be]=rt[Se]=rt[fr]=!1;var sy={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},ay={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},uy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ly={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},cy=parseFloat,fy=parseInt,Df=typeof global=="object"&&global&&global.Object===Object&&global,dy=typeof self=="object"&&self&&self.Object===Object&&self,Tt=Df||dy||Function("return this")(),mu=typeof Ci=="object"&&Ci&&!Ci.nodeType&&Ci,dr=mu&&typeof mo=="object"&&mo&&!mo.nodeType&&mo,Nf=dr&&dr.exports===mu,gu=Nf&&Df.process,Zt=function(){try{var Z=dr&&dr.require&&dr.require("util").types;return Z||gu&&gu.binding&&gu.binding("util")}catch(ie){}}(),Ff=Zt&&Zt.isArrayBuffer,Uf=Zt&&Zt.isDate,Bf=Zt&&Zt.isMap,kf=Zt&&Zt.isRegExp,$f=Zt&&Zt.isSet,Hf=Zt&&Zt.isTypedArray;function Gt(Z,ie,ne){switch(ne.length){case 0:return Z.call(ie);case 1:return Z.call(ie,ne[0]);case 2:return Z.call(ie,ne[0],ne[1]);case 3:return Z.call(ie,ne[0],ne[1],ne[2])}return Z.apply(ie,ne)}function hy(Z,ie,ne,ge){for(var Re=-1,Je=Z==null?0:Z.length;++Re<Je;){var Et=Z[Re];ie(ge,Et,ne(Et),Z)}return ge}function Yt(Z,ie){for(var ne=-1,ge=Z==null?0:Z.length;++ne<ge&&ie(Z[ne],ne,Z)!==!1;);return Z}function py(Z,ie){for(var ne=Z==null?0:Z.length;ne--&&ie(Z[ne],ne,Z)!==!1;);return Z}function Gf(Z,ie){for(var ne=-1,ge=Z==null?0:Z.length;++ne<ge;)if(!ie(Z[ne],ne,Z))return!1;return!0}function jn(Z,ie){for(var ne=-1,ge=Z==null?0:Z.length,Re=0,Je=[];++ne<ge;){var Et=Z[ne];ie(Et,ne,Z)&&(Je[Re++]=Et)}return Je}function hs(Z,ie){var ne=Z==null?0:Z.length;return!!ne&&si(Z,ie,0)>-1}function vu(Z,ie,ne){for(var ge=-1,Re=Z==null?0:Z.length;++ge<Re;)if(ne(ie,Z[ge]))return!0;return!1}function st(Z,ie){for(var ne=-1,ge=Z==null?0:Z.length,Re=Array(ge);++ne<ge;)Re[ne]=ie(Z[ne],ne,Z);return Re}function Kn(Z,ie){for(var ne=-1,ge=ie.length,Re=Z.length;++ne<ge;)Z[Re+ne]=ie[ne];return Z}function yu(Z,ie,ne,ge){var Re=-1,Je=Z==null?0:Z.length;for(ge&&Je&&(ne=Z[++Re]);++Re<Je;)ne=ie(ne,Z[Re],Re,Z);return ne}function my(Z,ie,ne,ge){var Re=Z==null?0:Z.length;for(ge&&Re&&(ne=Z[--Re]);Re--;)ne=ie(ne,Z[Re],Re,Z);return ne}function bu(Z,ie){for(var ne=-1,ge=Z==null?0:Z.length;++ne<ge;)if(ie(Z[ne],ne,Z))return!0;return!1}var gy=Eu("length");function vy(Z){return Z.split("")}function yy(Z){return Z.match(wv)||[]}function Wf(Z,ie,ne){var ge;return ne(Z,function(Re,Je,Et){if(ie(Re,Je,Et))return ge=Je,!1}),ge}function ps(Z,ie,ne,ge){for(var Re=Z.length,Je=ne+(ge?1:-1);ge?Je--:++Je<Re;)if(ie(Z[Je],Je,Z))return Je;return-1}function si(Z,ie,ne){return ie===ie?My(Z,ie,ne):ps(Z,zf,ne)}function by(Z,ie,ne,ge){for(var Re=ne-1,Je=Z.length;++Re<Je;)if(ge(Z[Re],ie))return Re;return-1}function zf(Z){return Z!==Z}function Vf(Z,ie){var ne=Z==null?0:Z.length;return ne?Cu(Z,ie)/ne:K}function Eu(Z){return function(ie){return ie==null?s:ie[Z]}}function Au(Z){return function(ie){return Z==null?s:Z[ie]}}function jf(Z,ie,ne,ge,Re){return Re(Z,function(Je,Et,et){ne=ge?(ge=!1,Je):ie(ne,Je,Et,et)}),ne}function Ey(Z,ie){var ne=Z.length;for(Z.sort(ie);ne--;)Z[ne]=Z[ne].value;return Z}function Cu(Z,ie){for(var ne,ge=-1,Re=Z.length;++ge<Re;){var Je=ie(Z[ge]);Je!==s&&(ne=ne===s?Je:ne+Je)}return ne}function Su(Z,ie){for(var ne=-1,ge=Array(Z);++ne<Z;)ge[ne]=ie(ne);return ge}function Ay(Z,ie){return st(ie,function(ne){return[ne,Z[ne]]})}function Kf(Z){return Z&&Z.slice(0,Yf(Z)+1).replace(lu,"")}function Wt(Z){return function(ie){return Z(ie)}}function Tu(Z,ie){return st(ie,function(ne){return Z[ne]})}function Ji(Z,ie){return Z.has(ie)}function Jf(Z,ie){for(var ne=-1,ge=Z.length;++ne<ge&&si(ie,Z[ne],0)>-1;);return ne}function qf(Z,ie){for(var ne=Z.length;ne--&&si(ie,Z[ne],0)>-1;);return ne}function Cy(Z,ie){for(var ne=Z.length,ge=0;ne--;)Z[ne]===ie&&++ge;return ge}var Sy=Au(sy),Ty=Au(ay);function Oy(Z){return"\\"+ly[Z]}function wy(Z,ie){return Z==null?s:Z[ie]}function ai(Z){return ny.test(Z)}function Iy(Z){return ry.test(Z)}function Ry(Z){for(var ie,ne=[];!(ie=Z.next()).done;)ne.push(ie.value);return ne}function Ou(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ge,Re){ne[++ie]=[Re,ge]}),ne}function Zf(Z,ie){return function(ne){return Z(ie(ne))}}function Jn(Z,ie){for(var ne=-1,ge=Z.length,Re=0,Je=[];++ne<ge;){var Et=Z[ne];(Et===ie||Et===f)&&(Z[ne]=f,Je[Re++]=ne)}return Je}function ms(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ge){ne[++ie]=ge}),ne}function xy(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ge){ne[++ie]=[ge,ge]}),ne}function My(Z,ie,ne){for(var ge=ne-1,Re=Z.length;++ge<Re;)if(Z[ge]===ie)return ge;return-1}function _y(Z,ie,ne){for(var ge=ne+1;ge--;)if(Z[ge]===ie)return ge;return ge}function ui(Z){return ai(Z)?Ly(Z):gy(Z)}function ln(Z){return ai(Z)?Dy(Z):vy(Z)}function Yf(Z){for(var ie=Z.length;ie--&&Cv.test(Z.charAt(ie)););return ie}var Py=Au(uy);function Ly(Z){for(var ie=pu.lastIndex=0;pu.test(Z);)++ie;return ie}function Dy(Z){return Z.match(pu)||[]}function Ny(Z){return Z.match(ty)||[]}var Fy=function Z(ie){ie=ie==null?Tt:qn.defaults(Tt.Object(),ie,qn.pick(Tt,iy));var ne=ie.Array,ge=ie.Date,Re=ie.Error,Je=ie.Function,Et=ie.Math,et=ie.Object,wu=ie.RegExp,Uy=ie.String,Qt=ie.TypeError,gs=ne.prototype,By=Je.prototype,li=et.prototype,vs=ie["__core-js_shared__"],ys=By.toString,Xe=li.hasOwnProperty,ky=0,Qf=function(){var n=/[^.]+$/.exec(vs&&vs.keys&&vs.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),bs=li.toString,$y=ys.call(et),Hy=Tt._,Gy=wu("^"+ys.call(Xe).replace(uu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Es=Nf?ie.Buffer:s,Zn=ie.Symbol,As=ie.Uint8Array,Xf=Es?Es.allocUnsafe:s,Cs=Zf(et.getPrototypeOf,et),ed=et.create,td=li.propertyIsEnumerable,Ss=gs.splice,nd=Zn?Zn.isConcatSpreadable:s,qi=Zn?Zn.iterator:s,hr=Zn?Zn.toStringTag:s,Ts=function(){try{var n=yr(et,"defineProperty");return n({},"",{}),n}catch(o){}}(),Wy=ie.clearTimeout!==Tt.clearTimeout&&ie.clearTimeout,zy=ge&&ge.now!==Tt.Date.now&&ge.now,Vy=ie.setTimeout!==Tt.setTimeout&&ie.setTimeout,Os=Et.ceil,ws=Et.floor,Iu=et.getOwnPropertySymbols,jy=Es?Es.isBuffer:s,rd=ie.isFinite,Ky=gs.join,Jy=Zf(et.keys,et),At=Et.max,Pt=Et.min,qy=ge.now,Zy=ie.parseInt,id=Et.random,Yy=gs.reverse,Ru=yr(ie,"DataView"),Zi=yr(ie,"Map"),xu=yr(ie,"Promise"),ci=yr(ie,"Set"),Yi=yr(ie,"WeakMap"),Qi=yr(et,"create"),Is=Yi&&new Yi,fi={},Qy=br(Ru),Xy=br(Zi),e0=br(xu),t0=br(ci),n0=br(Yi),Rs=Zn?Zn.prototype:s,Xi=Rs?Rs.valueOf:s,od=Rs?Rs.toString:s;function D(n){if(ht(n)&&!xe(n)&&!(n instanceof He)){if(n instanceof Xt)return n;if(Xe.call(n,"__wrapped__"))return sh(n)}return new Xt(n)}var di=function(){function n(){}return function(o){if(!ut(o))return{};if(ed)return ed(o);n.prototype=o;var c=new n;return n.prototype=s,c}}();function xs(){}function Xt(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=s}D.templateSettings={escape:gv,evaluate:vv,interpolate:pf,variable:"",imports:{_:D}},D.prototype=xs.prototype,D.prototype.constructor=D,Xt.prototype=di(xs.prototype),Xt.prototype.constructor=Xt;function He(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ee,this.__views__=[]}function r0(){var n=new He(this.__wrapped__);return n.__actions__=Ut(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ut(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ut(this.__views__),n}function i0(){if(this.__filtered__){var n=new He(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function o0(){var n=this.__wrapped__.value(),o=this.__dir__,c=xe(n),A=o<0,M=c?n.length:0,k=vb(0,M,this.__views__),V=k.start,J=k.end,Y=J-V,se=A?J:V-1,ae=this.__iteratees__,ue=ae.length,he=0,ye=Pt(Y,this.__takeCount__);if(!c||!A&&M==Y&&ye==Y)return xd(n,this.__actions__);var Oe=[];e:for(;Y--&&he<ye;){se+=o;for(var Fe=-1,we=n[se];++Fe<ue;){var ke=ae[Fe],ze=ke.iteratee,jt=ke.type,Ft=ze(we);if(jt==F)we=Ft;else if(!Ft){if(jt==W)continue e;break e}}Oe[he++]=we}return Oe}He.prototype=di(xs.prototype),He.prototype.constructor=He;function pr(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function s0(){this.__data__=Qi?Qi(null):{},this.size=0}function a0(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function u0(n){var o=this.__data__;if(Qi){var c=o[n];return c===u?s:c}return Xe.call(o,n)?o[n]:s}function l0(n){var o=this.__data__;return Qi?o[n]!==s:Xe.call(o,n)}function c0(n,o){var c=this.__data__;return this.size+=this.has(n)?0:1,c[n]=Qi&&o===s?u:o,this}pr.prototype.clear=s0,pr.prototype.delete=a0,pr.prototype.get=u0,pr.prototype.has=l0,pr.prototype.set=c0;function Rn(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function f0(){this.__data__=[],this.size=0}function d0(n){var o=this.__data__,c=Ms(o,n);if(c<0)return!1;var A=o.length-1;return c==A?o.pop():Ss.call(o,c,1),--this.size,!0}function h0(n){var o=this.__data__,c=Ms(o,n);return c<0?s:o[c][1]}function p0(n){return Ms(this.__data__,n)>-1}function m0(n,o){var c=this.__data__,A=Ms(c,n);return A<0?(++this.size,c.push([n,o])):c[A][1]=o,this}Rn.prototype.clear=f0,Rn.prototype.delete=d0,Rn.prototype.get=h0,Rn.prototype.has=p0,Rn.prototype.set=m0;function xn(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function g0(){this.size=0,this.__data__={hash:new pr,map:new(Zi||Rn),string:new pr}}function v0(n){var o=Gs(this,n).delete(n);return this.size-=o?1:0,o}function y0(n){return Gs(this,n).get(n)}function b0(n){return Gs(this,n).has(n)}function E0(n,o){var c=Gs(this,n),A=c.size;return c.set(n,o),this.size+=c.size==A?0:1,this}xn.prototype.clear=g0,xn.prototype.delete=v0,xn.prototype.get=y0,xn.prototype.has=b0,xn.prototype.set=E0;function mr(n){var o=-1,c=n==null?0:n.length;for(this.__data__=new xn;++o<c;)this.add(n[o])}function A0(n){return this.__data__.set(n,u),this}function C0(n){return this.__data__.has(n)}mr.prototype.add=mr.prototype.push=A0,mr.prototype.has=C0;function cn(n){var o=this.__data__=new Rn(n);this.size=o.size}function S0(){this.__data__=new Rn,this.size=0}function T0(n){var o=this.__data__,c=o.delete(n);return this.size=o.size,c}function O0(n){return this.__data__.get(n)}function w0(n){return this.__data__.has(n)}function I0(n,o){var c=this.__data__;if(c instanceof Rn){var A=c.__data__;if(!Zi||A.length<t-1)return A.push([n,o]),this.size=++c.size,this;c=this.__data__=new xn(A)}return c.set(n,o),this.size=c.size,this}cn.prototype.clear=S0,cn.prototype.delete=T0,cn.prototype.get=O0,cn.prototype.has=w0,cn.prototype.set=I0;function sd(n,o){var c=xe(n),A=!c&&Er(n),M=!c&&!A&&tr(n),k=!c&&!A&&!M&&gi(n),V=c||A||M||k,J=V?Su(n.length,Uy):[],Y=J.length;for(var se in n)(o||Xe.call(n,se))&&!(V&&(se=="length"||M&&(se=="offset"||se=="parent")||k&&(se=="buffer"||se=="byteLength"||se=="byteOffset")||Ln(se,Y)))&&J.push(se);return J}function ad(n){var o=n.length;return o?n[$u(0,o-1)]:s}function R0(n,o){return Ws(Ut(n),gr(o,0,n.length))}function x0(n){return Ws(Ut(n))}function Mu(n,o,c){(c!==s&&!fn(n[o],c)||c===s&&!(o in n))&&Mn(n,o,c)}function eo(n,o,c){var A=n[o];(!(Xe.call(n,o)&&fn(A,c))||c===s&&!(o in n))&&Mn(n,o,c)}function Ms(n,o){for(var c=n.length;c--;)if(fn(n[c][0],o))return c;return-1}function M0(n,o,c,A){return Yn(n,function(M,k,V){o(A,M,c(M),V)}),A}function ud(n,o){return n&&En(o,Ot(o),n)}function _0(n,o){return n&&En(o,kt(o),n)}function Mn(n,o,c){o=="__proto__"&&Ts?Ts(n,o,{configurable:!0,enumerable:!0,value:c,writable:!0}):n[o]=c}function _u(n,o){for(var c=-1,A=o.length,M=ne(A),k=n==null;++c<A;)M[c]=k?s:fl(n,o[c]);return M}function gr(n,o,c){return n===n&&(c!==s&&(n=n<=c?n:c),o!==s&&(n=n>=o?n:o)),n}function en(n,o,c,A,M,k){var V,J=o&m,Y=o&b,se=o&C;if(c&&(V=M?c(n,A,M,k):c(n)),V!==s)return V;if(!ut(n))return n;var ae=xe(n);if(ae){if(V=bb(n),!J)return Ut(n,V)}else{var ue=Lt(n),he=ue==Se||ue==$e;if(tr(n))return Pd(n,J);if(ue==it||ue==B||he&&!M){if(V=Y||he?{}:Yd(n),!J)return Y?ub(n,_0(V,n)):ab(n,ud(V,n))}else{if(!rt[ue])return M?n:{};V=Eb(n,ue,J)}}k||(k=new cn);var ye=k.get(n);if(ye)return ye;k.set(n,V),wh(n)?n.forEach(function(we){V.add(en(we,o,c,we,n,k))}):Th(n)&&n.forEach(function(we,ke){V.set(ke,en(we,o,c,ke,n,k))});var Oe=se?Y?Yu:Zu:Y?kt:Ot,Fe=ae?s:Oe(n);return Yt(Fe||n,function(we,ke){Fe&&(ke=we,we=n[ke]),eo(V,ke,en(we,o,c,ke,n,k))}),V}function P0(n){var o=Ot(n);return function(c){return ld(c,n,o)}}function ld(n,o,c){var A=c.length;if(n==null)return!A;for(n=et(n);A--;){var M=c[A],k=o[M],V=n[M];if(V===s&&!(M in n)||!k(V))return!1}return!0}function cd(n,o,c){if(typeof n!="function")throw new Qt(i);return ao(function(){n.apply(s,c)},o)}function to(n,o,c,A){var M=-1,k=hs,V=!0,J=n.length,Y=[],se=o.length;if(!J)return Y;c&&(o=st(o,Wt(c))),A?(k=vu,V=!1):o.length>=t&&(k=Ji,V=!1,o=new mr(o));e:for(;++M<J;){var ae=n[M],ue=c==null?ae:c(ae);if(ae=A||ae!==0?ae:0,V&&ue===ue){for(var he=se;he--;)if(o[he]===ue)continue e;Y.push(ae)}else k(o,ue,A)||Y.push(ae)}return Y}var Yn=Ud(bn),fd=Ud(Lu,!0);function L0(n,o){var c=!0;return Yn(n,function(A,M,k){return c=!!o(A,M,k),c}),c}function _s(n,o,c){for(var A=-1,M=n.length;++A<M;){var k=n[A],V=o(k);if(V!=null&&(J===s?V===V&&!Vt(V):c(V,J)))var J=V,Y=k}return Y}function D0(n,o,c,A){var M=n.length;for(c=Le(c),c<0&&(c=-c>M?0:M+c),A=A===s||A>M?M:Le(A),A<0&&(A+=M),A=c>A?0:Rh(A);c<A;)n[c++]=o;return n}function dd(n,o){var c=[];return Yn(n,function(A,M,k){o(A,M,k)&&c.push(A)}),c}function Mt(n,o,c,A,M){var k=-1,V=n.length;for(c||(c=Cb),M||(M=[]);++k<V;){var J=n[k];o>0&&c(J)?o>1?Mt(J,o-1,c,A,M):Kn(M,J):A||(M[M.length]=J)}return M}var Pu=Bd(),hd=Bd(!0);function bn(n,o){return n&&Pu(n,o,Ot)}function Lu(n,o){return n&&hd(n,o,Ot)}function Ps(n,o){return jn(o,function(c){return Dn(n[c])})}function vr(n,o){o=Xn(o,n);for(var c=0,A=o.length;n!=null&&c<A;)n=n[An(o[c++])];return c&&c==A?n:s}function pd(n,o,c){var A=o(n);return xe(n)?A:Kn(A,c(n))}function Dt(n){return n==null?n===s?Ki:bt:hr&&hr in et(n)?gb(n):xb(n)}function Du(n,o){return n>o}function N0(n,o){return n!=null&&Xe.call(n,o)}function F0(n,o){return n!=null&&o in et(n)}function U0(n,o,c){return n>=Pt(o,c)&&n<At(o,c)}function Nu(n,o,c){for(var A=c?vu:hs,M=n[0].length,k=n.length,V=k,J=ne(k),Y=1/0,se=[];V--;){var ae=n[V];V&&o&&(ae=st(ae,Wt(o))),Y=Pt(ae.length,Y),J[V]=!c&&(o||M>=120&&ae.length>=120)?new mr(V&&ae):s}ae=n[0];var ue=-1,he=J[0];e:for(;++ue<M&&se.length<Y;){var ye=ae[ue],Oe=o?o(ye):ye;if(ye=c||ye!==0?ye:0,!(he?Ji(he,Oe):A(se,Oe,c))){for(V=k;--V;){var Fe=J[V];if(!(Fe?Ji(Fe,Oe):A(n[V],Oe,c)))continue e}he&&he.push(Oe),se.push(ye)}}return se}function B0(n,o,c,A){return bn(n,function(M,k,V){o(A,c(M),k,V)}),A}function no(n,o,c){o=Xn(o,n),n=th(n,o);var A=n==null?n:n[An(nn(o))];return A==null?s:Gt(A,n,c)}function md(n){return ht(n)&&Dt(n)==B}function k0(n){return ht(n)&&Dt(n)==q}function $0(n){return ht(n)&&Dt(n)==ce}function ro(n,o,c,A,M){return n===o?!0:n==null||o==null||!ht(n)&&!ht(o)?n!==n&&o!==o:H0(n,o,c,A,ro,M)}function H0(n,o,c,A,M,k){var V=xe(n),J=xe(o),Y=V?H:Lt(n),se=J?H:Lt(o);Y=Y==B?it:Y,se=se==B?it:se;var ae=Y==it,ue=se==it,he=Y==se;if(he&&tr(n)){if(!tr(o))return!1;V=!0,ae=!1}if(he&&!ae)return k||(k=new cn),V||gi(n)?Jd(n,o,c,A,M,k):pb(n,o,Y,c,A,M,k);if(!(c&h)){var ye=ae&&Xe.call(n,"__wrapped__"),Oe=ue&&Xe.call(o,"__wrapped__");if(ye||Oe){var Fe=ye?n.value():n,we=Oe?o.value():o;return k||(k=new cn),M(Fe,we,c,A,k)}}return he?(k||(k=new cn),mb(n,o,c,A,M,k)):!1}function G0(n){return ht(n)&&Lt(n)==de}function Fu(n,o,c,A){var M=c.length,k=M,V=!A;if(n==null)return!k;for(n=et(n);M--;){var J=c[M];if(V&&J[2]?J[1]!==n[J[0]]:!(J[0]in n))return!1}for(;++M<k;){J=c[M];var Y=J[0],se=n[Y],ae=J[1];if(V&&J[2]){if(se===s&&!(Y in n))return!1}else{var ue=new cn;if(A)var he=A(se,ae,Y,n,o,ue);if(!(he===s?ro(ae,se,h|E,A,ue):he))return!1}}return!0}function gd(n){if(!ut(n)||Tb(n))return!1;var o=Dn(n)?Gy:Pv;return o.test(br(n))}function W0(n){return ht(n)&&Dt(n)==vn}function z0(n){return ht(n)&&Lt(n)==at}function V0(n){return ht(n)&&qs(n.length)&&!!ot[Dt(n)]}function vd(n){return typeof n=="function"?n:n==null?$t:typeof n=="object"?xe(n)?Ed(n[0],n[1]):bd(n):kh(n)}function Uu(n){if(!so(n))return Jy(n);var o=[];for(var c in et(n))Xe.call(n,c)&&c!="constructor"&&o.push(c);return o}function j0(n){if(!ut(n))return Rb(n);var o=so(n),c=[];for(var A in n)A=="constructor"&&(o||!Xe.call(n,A))||c.push(A);return c}function Bu(n,o){return n<o}function yd(n,o){var c=-1,A=Bt(n)?ne(n.length):[];return Yn(n,function(M,k,V){A[++c]=o(M,k,V)}),A}function bd(n){var o=Xu(n);return o.length==1&&o[0][2]?Xd(o[0][0],o[0][1]):function(c){return c===n||Fu(c,n,o)}}function Ed(n,o){return tl(n)&&Qd(o)?Xd(An(n),o):function(c){var A=fl(c,n);return A===s&&A===o?dl(c,n):ro(o,A,h|E)}}function Ls(n,o,c,A,M){n!==o&&Pu(o,function(k,V){if(M||(M=new cn),ut(k))K0(n,o,V,c,Ls,A,M);else{var J=A?A(rl(n,V),k,V+"",n,o,M):s;J===s&&(J=k),Mu(n,V,J)}},kt)}function K0(n,o,c,A,M,k,V){var J=rl(n,c),Y=rl(o,c),se=V.get(Y);if(se){Mu(n,c,se);return}var ae=k?k(J,Y,c+"",n,o,V):s,ue=ae===s;if(ue){var he=xe(Y),ye=!he&&tr(Y),Oe=!he&&!ye&&gi(Y);ae=Y,he||ye||Oe?xe(J)?ae=J:pt(J)?ae=Ut(J):ye?(ue=!1,ae=Pd(Y,!0)):Oe?(ue=!1,ae=Ld(Y,!0)):ae=[]:uo(Y)||Er(Y)?(ae=J,Er(J)?ae=xh(J):(!ut(J)||Dn(J))&&(ae=Yd(Y))):ue=!1}ue&&(V.set(Y,ae),M(ae,Y,A,k,V),V.delete(Y)),Mu(n,c,ae)}function Ad(n,o){var c=n.length;if(!!c)return o+=o<0?c:0,Ln(o,c)?n[o]:s}function Cd(n,o,c){o.length?o=st(o,function(k){return xe(k)?function(V){return vr(V,k.length===1?k[0]:k)}:k}):o=[$t];var A=-1;o=st(o,Wt(Te()));var M=yd(n,function(k,V,J){var Y=st(o,function(se){return se(k)});return{criteria:Y,index:++A,value:k}});return Ey(M,function(k,V){return sb(k,V,c)})}function J0(n,o){return Sd(n,o,function(c,A){return dl(n,A)})}function Sd(n,o,c){for(var A=-1,M=o.length,k={};++A<M;){var V=o[A],J=vr(n,V);c(J,V)&&io(k,Xn(V,n),J)}return k}function q0(n){return function(o){return vr(o,n)}}function ku(n,o,c,A){var M=A?by:si,k=-1,V=o.length,J=n;for(n===o&&(o=Ut(o)),c&&(J=st(n,Wt(c)));++k<V;)for(var Y=0,se=o[k],ae=c?c(se):se;(Y=M(J,ae,Y,A))>-1;)J!==n&&Ss.call(J,Y,1),Ss.call(n,Y,1);return n}function Td(n,o){for(var c=n?o.length:0,A=c-1;c--;){var M=o[c];if(c==A||M!==k){var k=M;Ln(M)?Ss.call(n,M,1):Wu(n,M)}}return n}function $u(n,o){return n+ws(id()*(o-n+1))}function Z0(n,o,c,A){for(var M=-1,k=At(Os((o-n)/(c||1)),0),V=ne(k);k--;)V[A?k:++M]=n,n+=c;return V}function Hu(n,o){var c="";if(!n||o<1||o>$)return c;do o%2&&(c+=n),o=ws(o/2),o&&(n+=n);while(o);return c}function Be(n,o){return il(eh(n,o,$t),n+"")}function Y0(n){return ad(vi(n))}function Q0(n,o){var c=vi(n);return Ws(c,gr(o,0,c.length))}function io(n,o,c,A){if(!ut(n))return n;o=Xn(o,n);for(var M=-1,k=o.length,V=k-1,J=n;J!=null&&++M<k;){var Y=An(o[M]),se=c;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return n;if(M!=V){var ae=J[Y];se=A?A(ae,Y,J):s,se===s&&(se=ut(ae)?ae:Ln(o[M+1])?[]:{})}eo(J,Y,se),J=J[Y]}return n}var Od=Is?function(n,o){return Is.set(n,o),n}:$t,X0=Ts?function(n,o){return Ts(n,"toString",{configurable:!0,enumerable:!1,value:pl(o),writable:!0})}:$t;function eb(n){return Ws(vi(n))}function tn(n,o,c){var A=-1,M=n.length;o<0&&(o=-o>M?0:M+o),c=c>M?M:c,c<0&&(c+=M),M=o>c?0:c-o>>>0,o>>>=0;for(var k=ne(M);++A<M;)k[A]=n[A+o];return k}function tb(n,o){var c;return Yn(n,function(A,M,k){return c=o(A,M,k),!c}),!!c}function Ds(n,o,c){var A=0,M=n==null?A:n.length;if(typeof o=="number"&&o===o&&M<=X){for(;A<M;){var k=A+M>>>1,V=n[k];V!==null&&!Vt(V)&&(c?V<=o:V<o)?A=k+1:M=k}return M}return Gu(n,o,$t,c)}function Gu(n,o,c,A){var M=0,k=n==null?0:n.length;if(k===0)return 0;o=c(o);for(var V=o!==o,J=o===null,Y=Vt(o),se=o===s;M<k;){var ae=ws((M+k)/2),ue=c(n[ae]),he=ue!==s,ye=ue===null,Oe=ue===ue,Fe=Vt(ue);if(V)var we=A||Oe;else se?we=Oe&&(A||he):J?we=Oe&&he&&(A||!ye):Y?we=Oe&&he&&!ye&&(A||!Fe):ye||Fe?we=!1:we=A?ue<=o:ue<o;we?M=ae+1:k=ae}return Pt(k,re)}function wd(n,o){for(var c=-1,A=n.length,M=0,k=[];++c<A;){var V=n[c],J=o?o(V):V;if(!c||!fn(J,Y)){var Y=J;k[M++]=V===0?0:V}}return k}function Id(n){return typeof n=="number"?n:Vt(n)?K:+n}function zt(n){if(typeof n=="string")return n;if(xe(n))return st(n,zt)+"";if(Vt(n))return od?od.call(n):"";var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Qn(n,o,c){var A=-1,M=hs,k=n.length,V=!0,J=[],Y=J;if(c)V=!1,M=vu;else if(k>=t){var se=o?null:db(n);if(se)return ms(se);V=!1,M=Ji,Y=new mr}else Y=o?[]:J;e:for(;++A<k;){var ae=n[A],ue=o?o(ae):ae;if(ae=c||ae!==0?ae:0,V&&ue===ue){for(var he=Y.length;he--;)if(Y[he]===ue)continue e;o&&Y.push(ue),J.push(ae)}else M(Y,ue,c)||(Y!==J&&Y.push(ue),J.push(ae))}return J}function Wu(n,o){return o=Xn(o,n),n=th(n,o),n==null||delete n[An(nn(o))]}function Rd(n,o,c,A){return io(n,o,c(vr(n,o)),A)}function Ns(n,o,c,A){for(var M=n.length,k=A?M:-1;(A?k--:++k<M)&&o(n[k],k,n););return c?tn(n,A?0:k,A?k+1:M):tn(n,A?k+1:0,A?M:k)}function xd(n,o){var c=n;return c instanceof He&&(c=c.value()),yu(o,function(A,M){return M.func.apply(M.thisArg,Kn([A],M.args))},c)}function zu(n,o,c){var A=n.length;if(A<2)return A?Qn(n[0]):[];for(var M=-1,k=ne(A);++M<A;)for(var V=n[M],J=-1;++J<A;)J!=M&&(k[M]=to(k[M]||V,n[J],o,c));return Qn(Mt(k,1),o,c)}function Md(n,o,c){for(var A=-1,M=n.length,k=o.length,V={};++A<M;){var J=A<k?o[A]:s;c(V,n[A],J)}return V}function Vu(n){return pt(n)?n:[]}function ju(n){return typeof n=="function"?n:$t}function Xn(n,o){return xe(n)?n:tl(n,o)?[n]:oh(Ye(n))}var nb=Be;function er(n,o,c){var A=n.length;return c=c===s?A:c,!o&&c>=A?n:tn(n,o,c)}var _d=Wy||function(n){return Tt.clearTimeout(n)};function Pd(n,o){if(o)return n.slice();var c=n.length,A=Xf?Xf(c):new n.constructor(c);return n.copy(A),A}function Ku(n){var o=new n.constructor(n.byteLength);return new As(o).set(new As(n)),o}function rb(n,o){var c=o?Ku(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.byteLength)}function ib(n){var o=new n.constructor(n.source,mf.exec(n));return o.lastIndex=n.lastIndex,o}function ob(n){return Xi?et(Xi.call(n)):{}}function Ld(n,o){var c=o?Ku(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.length)}function Dd(n,o){if(n!==o){var c=n!==s,A=n===null,M=n===n,k=Vt(n),V=o!==s,J=o===null,Y=o===o,se=Vt(o);if(!J&&!se&&!k&&n>o||k&&V&&Y&&!J&&!se||A&&V&&Y||!c&&Y||!M)return 1;if(!A&&!k&&!se&&n<o||se&&c&&M&&!A&&!k||J&&c&&M||!V&&M||!Y)return-1}return 0}function sb(n,o,c){for(var A=-1,M=n.criteria,k=o.criteria,V=M.length,J=c.length;++A<V;){var Y=Dd(M[A],k[A]);if(Y){if(A>=J)return Y;var se=c[A];return Y*(se=="desc"?-1:1)}}return n.index-o.index}function Nd(n,o,c,A){for(var M=-1,k=n.length,V=c.length,J=-1,Y=o.length,se=At(k-V,0),ae=ne(Y+se),ue=!A;++J<Y;)ae[J]=o[J];for(;++M<V;)(ue||M<k)&&(ae[c[M]]=n[M]);for(;se--;)ae[J++]=n[M++];return ae}function Fd(n,o,c,A){for(var M=-1,k=n.length,V=-1,J=c.length,Y=-1,se=o.length,ae=At(k-J,0),ue=ne(ae+se),he=!A;++M<ae;)ue[M]=n[M];for(var ye=M;++Y<se;)ue[ye+Y]=o[Y];for(;++V<J;)(he||M<k)&&(ue[ye+c[V]]=n[M++]);return ue}function Ut(n,o){var c=-1,A=n.length;for(o||(o=ne(A));++c<A;)o[c]=n[c];return o}function En(n,o,c,A){var M=!c;c||(c={});for(var k=-1,V=o.length;++k<V;){var J=o[k],Y=A?A(c[J],n[J],J,c,n):s;Y===s&&(Y=n[J]),M?Mn(c,J,Y):eo(c,J,Y)}return c}function ab(n,o){return En(n,el(n),o)}function ub(n,o){return En(n,qd(n),o)}function Fs(n,o){return function(c,A){var M=xe(c)?hy:M0,k=o?o():{};return M(c,n,Te(A,2),k)}}function hi(n){return Be(function(o,c){var A=-1,M=c.length,k=M>1?c[M-1]:s,V=M>2?c[2]:s;for(k=n.length>3&&typeof k=="function"?(M--,k):s,V&&Nt(c[0],c[1],V)&&(k=M<3?s:k,M=1),o=et(o);++A<M;){var J=c[A];J&&n(o,J,A,k)}return o})}function Ud(n,o){return function(c,A){if(c==null)return c;if(!Bt(c))return n(c,A);for(var M=c.length,k=o?M:-1,V=et(c);(o?k--:++k<M)&&A(V[k],k,V)!==!1;);return c}}function Bd(n){return function(o,c,A){for(var M=-1,k=et(o),V=A(o),J=V.length;J--;){var Y=V[n?J:++M];if(c(k[Y],Y,k)===!1)break}return o}}function lb(n,o,c){var A=o&w,M=oo(n);function k(){var V=this&&this!==Tt&&this instanceof k?M:n;return V.apply(A?c:this,arguments)}return k}function kd(n){return function(o){o=Ye(o);var c=ai(o)?ln(o):s,A=c?c[0]:o.charAt(0),M=c?er(c,1).join(""):o.slice(1);return A[n]()+M}}function pi(n){return function(o){return yu(Uh(Fh(o).replace(Xv,"")),n,"")}}function oo(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var c=di(n.prototype),A=n.apply(c,o);return ut(A)?A:c}}function cb(n,o,c){var A=oo(n);function M(){for(var k=arguments.length,V=ne(k),J=k,Y=mi(M);J--;)V[J]=arguments[J];var se=k<3&&V[0]!==Y&&V[k-1]!==Y?[]:Jn(V,Y);if(k-=se.length,k<c)return zd(n,o,Us,M.placeholder,s,V,se,s,s,c-k);var ae=this&&this!==Tt&&this instanceof M?A:n;return Gt(ae,this,V)}return M}function $d(n){return function(o,c,A){var M=et(o);if(!Bt(o)){var k=Te(c,3);o=Ot(o),c=function(J){return k(M[J],J,M)}}var V=n(o,c,A);return V>-1?M[k?o[V]:V]:s}}function Hd(n){return Pn(function(o){var c=o.length,A=c,M=Xt.prototype.thru;for(n&&o.reverse();A--;){var k=o[A];if(typeof k!="function")throw new Qt(i);if(M&&!V&&Hs(k)=="wrapper")var V=new Xt([],!0)}for(A=V?A:c;++A<c;){k=o[A];var J=Hs(k),Y=J=="wrapper"?Qu(k):s;Y&&nl(Y[0])&&Y[1]==(d|T|g|p)&&!Y[4].length&&Y[9]==1?V=V[Hs(Y[0])].apply(V,Y[3]):V=k.length==1&&nl(k)?V[J]():V.thru(k)}return function(){var se=arguments,ae=se[0];if(V&&se.length==1&&xe(ae))return V.plant(ae).value();for(var ue=0,he=c?o[ue].apply(this,se):ae;++ue<c;)he=o[ue].call(this,he);return he}})}function Us(n,o,c,A,M,k,V,J,Y,se){var ae=o&d,ue=o&w,he=o&I,ye=o&(T|x),Oe=o&O,Fe=he?s:oo(n);function we(){for(var ke=arguments.length,ze=ne(ke),jt=ke;jt--;)ze[jt]=arguments[jt];if(ye)var Ft=mi(we),Kt=Cy(ze,Ft);if(A&&(ze=Nd(ze,A,M,ye)),k&&(ze=Fd(ze,k,V,ye)),ke-=Kt,ye&&ke<se){var mt=Jn(ze,Ft);return zd(n,o,Us,we.placeholder,c,ze,mt,J,Y,se-ke)}var dn=ue?c:this,Fn=he?dn[n]:n;return ke=ze.length,J?ze=Mb(ze,J):Oe&&ke>1&&ze.reverse(),ae&&Y<ke&&(ze.length=Y),this&&this!==Tt&&this instanceof we&&(Fn=Fe||oo(Fn)),Fn.apply(dn,ze)}return we}function Gd(n,o){return function(c,A){return B0(c,n,o(A),{})}}function Bs(n,o){return function(c,A){var M;if(c===s&&A===s)return o;if(c!==s&&(M=c),A!==s){if(M===s)return A;typeof c=="string"||typeof A=="string"?(c=zt(c),A=zt(A)):(c=Id(c),A=Id(A)),M=n(c,A)}return M}}function Ju(n){return Pn(function(o){return o=st(o,Wt(Te())),Be(function(c){var A=this;return n(o,function(M){return Gt(M,A,c)})})})}function ks(n,o){o=o===s?" ":zt(o);var c=o.length;if(c<2)return c?Hu(o,n):o;var A=Hu(o,Os(n/ui(o)));return ai(o)?er(ln(A),0,n).join(""):A.slice(0,n)}function fb(n,o,c,A){var M=o&w,k=oo(n);function V(){for(var J=-1,Y=arguments.length,se=-1,ae=A.length,ue=ne(ae+Y),he=this&&this!==Tt&&this instanceof V?k:n;++se<ae;)ue[se]=A[se];for(;Y--;)ue[se++]=arguments[++J];return Gt(he,M?c:this,ue)}return V}function Wd(n){return function(o,c,A){return A&&typeof A!="number"&&Nt(o,c,A)&&(c=A=s),o=Nn(o),c===s?(c=o,o=0):c=Nn(c),A=A===s?o<c?1:-1:Nn(A),Z0(o,c,A,n)}}function $s(n){return function(o,c){return typeof o=="string"&&typeof c=="string"||(o=rn(o),c=rn(c)),n(o,c)}}function zd(n,o,c,A,M,k,V,J,Y,se){var ae=o&T,ue=ae?V:s,he=ae?s:V,ye=ae?k:s,Oe=ae?s:k;o|=ae?g:y,o&=~(ae?y:g),o&S||(o&=~(w|I));var Fe=[n,o,M,ye,ue,Oe,he,J,Y,se],we=c.apply(s,Fe);return nl(n)&&nh(we,Fe),we.placeholder=A,rh(we,n,o)}function qu(n){var o=Et[n];return function(c,A){if(c=rn(c),A=A==null?0:Pt(Le(A),292),A&&rd(c)){var M=(Ye(c)+"e").split("e"),k=o(M[0]+"e"+(+M[1]+A));return M=(Ye(k)+"e").split("e"),+(M[0]+"e"+(+M[1]-A))}return o(c)}}var db=ci&&1/ms(new ci([,-0]))[1]==L?function(n){return new ci(n)}:vl;function Vd(n){return function(o){var c=Lt(o);return c==de?Ou(o):c==at?xy(o):Ay(o,n(o))}}function _n(n,o,c,A,M,k,V,J){var Y=o&I;if(!Y&&typeof n!="function")throw new Qt(i);var se=A?A.length:0;if(se||(o&=~(g|y),A=M=s),V=V===s?V:At(Le(V),0),J=J===s?J:Le(J),se-=M?M.length:0,o&y){var ae=A,ue=M;A=M=s}var he=Y?s:Qu(n),ye=[n,o,c,A,M,ae,ue,k,V,J];if(he&&Ib(ye,he),n=ye[0],o=ye[1],c=ye[2],A=ye[3],M=ye[4],J=ye[9]=ye[9]===s?Y?0:n.length:At(ye[9]-se,0),!J&&o&(T|x)&&(o&=~(T|x)),!o||o==w)var Oe=lb(n,o,c);else o==T||o==x?Oe=cb(n,o,J):(o==g||o==(w|g))&&!M.length?Oe=fb(n,o,c,A):Oe=Us.apply(s,ye);var Fe=he?Od:nh;return rh(Fe(Oe,ye),n,o)}function jd(n,o,c,A){return n===s||fn(n,li[c])&&!Xe.call(A,c)?o:n}function Kd(n,o,c,A,M,k){return ut(n)&&ut(o)&&(k.set(o,n),Ls(n,o,s,Kd,k),k.delete(o)),n}function hb(n){return uo(n)?s:n}function Jd(n,o,c,A,M,k){var V=c&h,J=n.length,Y=o.length;if(J!=Y&&!(V&&Y>J))return!1;var se=k.get(n),ae=k.get(o);if(se&&ae)return se==o&&ae==n;var ue=-1,he=!0,ye=c&E?new mr:s;for(k.set(n,o),k.set(o,n);++ue<J;){var Oe=n[ue],Fe=o[ue];if(A)var we=V?A(Fe,Oe,ue,o,n,k):A(Oe,Fe,ue,n,o,k);if(we!==s){if(we)continue;he=!1;break}if(ye){if(!bu(o,function(ke,ze){if(!Ji(ye,ze)&&(Oe===ke||M(Oe,ke,c,A,k)))return ye.push(ze)})){he=!1;break}}else if(!(Oe===Fe||M(Oe,Fe,c,A,k))){he=!1;break}}return k.delete(n),k.delete(o),he}function pb(n,o,c,A,M,k,V){switch(c){case oe:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case q:return!(n.byteLength!=o.byteLength||!k(new As(n),new As(o)));case te:case ce:case Ze:return fn(+n,+o);case be:return n.name==o.name&&n.message==o.message;case vn:case yn:return n==o+"";case de:var J=Ou;case at:var Y=A&h;if(J||(J=ms),n.size!=o.size&&!Y)return!1;var se=V.get(n);if(se)return se==o;A|=E,V.set(n,o);var ae=Jd(J(n),J(o),A,M,k,V);return V.delete(n),ae;case Vn:if(Xi)return Xi.call(n)==Xi.call(o)}return!1}function mb(n,o,c,A,M,k){var V=c&h,J=Zu(n),Y=J.length,se=Zu(o),ae=se.length;if(Y!=ae&&!V)return!1;for(var ue=Y;ue--;){var he=J[ue];if(!(V?he in o:Xe.call(o,he)))return!1}var ye=k.get(n),Oe=k.get(o);if(ye&&Oe)return ye==o&&Oe==n;var Fe=!0;k.set(n,o),k.set(o,n);for(var we=V;++ue<Y;){he=J[ue];var ke=n[he],ze=o[he];if(A)var jt=V?A(ze,ke,he,o,n,k):A(ke,ze,he,n,o,k);if(!(jt===s?ke===ze||M(ke,ze,c,A,k):jt)){Fe=!1;break}we||(we=he=="constructor")}if(Fe&&!we){var Ft=n.constructor,Kt=o.constructor;Ft!=Kt&&"constructor"in n&&"constructor"in o&&!(typeof Ft=="function"&&Ft instanceof Ft&&typeof Kt=="function"&&Kt instanceof Kt)&&(Fe=!1)}return k.delete(n),k.delete(o),Fe}function Pn(n){return il(eh(n,s,lh),n+"")}function Zu(n){return pd(n,Ot,el)}function Yu(n){return pd(n,kt,qd)}var Qu=Is?function(n){return Is.get(n)}:vl;function Hs(n){for(var o=n.name+"",c=fi[o],A=Xe.call(fi,o)?c.length:0;A--;){var M=c[A],k=M.func;if(k==null||k==n)return M.name}return o}function mi(n){var o=Xe.call(D,"placeholder")?D:n;return o.placeholder}function Te(){var n=D.iteratee||ml;return n=n===ml?vd:n,arguments.length?n(arguments[0],arguments[1]):n}function Gs(n,o){var c=n.__data__;return Sb(o)?c[typeof o=="string"?"string":"hash"]:c.map}function Xu(n){for(var o=Ot(n),c=o.length;c--;){var A=o[c],M=n[A];o[c]=[A,M,Qd(M)]}return o}function yr(n,o){var c=wy(n,o);return gd(c)?c:s}function gb(n){var o=Xe.call(n,hr),c=n[hr];try{n[hr]=s;var A=!0}catch(k){}var M=bs.call(n);return A&&(o?n[hr]=c:delete n[hr]),M}var el=Iu?function(n){return n==null?[]:(n=et(n),jn(Iu(n),function(o){return td.call(n,o)}))}:yl,qd=Iu?function(n){for(var o=[];n;)Kn(o,el(n)),n=Cs(n);return o}:yl,Lt=Dt;(Ru&&Lt(new Ru(new ArrayBuffer(1)))!=oe||Zi&&Lt(new Zi)!=de||xu&&Lt(xu.resolve())!=dt||ci&&Lt(new ci)!=at||Yi&&Lt(new Yi)!=fr)&&(Lt=function(n){var o=Dt(n),c=o==it?n.constructor:s,A=c?br(c):"";if(A)switch(A){case Qy:return oe;case Xy:return de;case e0:return dt;case t0:return at;case n0:return fr}return o});function vb(n,o,c){for(var A=-1,M=c.length;++A<M;){var k=c[A],V=k.size;switch(k.type){case"drop":n+=V;break;case"dropRight":o-=V;break;case"take":o=Pt(o,n+V);break;case"takeRight":n=At(n,o-V);break}}return{start:n,end:o}}function yb(n){var o=n.match(Tv);return o?o[1].split(Ov):[]}function Zd(n,o,c){o=Xn(o,n);for(var A=-1,M=o.length,k=!1;++A<M;){var V=An(o[A]);if(!(k=n!=null&&c(n,V)))break;n=n[V]}return k||++A!=M?k:(M=n==null?0:n.length,!!M&&qs(M)&&Ln(V,M)&&(xe(n)||Er(n)))}function bb(n){var o=n.length,c=new n.constructor(o);return o&&typeof n[0]=="string"&&Xe.call(n,"index")&&(c.index=n.index,c.input=n.input),c}function Yd(n){return typeof n.constructor=="function"&&!so(n)?di(Cs(n)):{}}function Eb(n,o,c){var A=n.constructor;switch(o){case q:return Ku(n);case te:case ce:return new A(+n);case oe:return rb(n,c);case le:case ve:case Ne:case St:case In:case iu:case ou:case su:case au:return Ld(n,c);case de:return new A;case Ze:case yn:return new A(n);case vn:return ib(n);case at:return new A;case Vn:return ob(n)}}function Ab(n,o){var c=o.length;if(!c)return n;var A=c-1;return o[A]=(c>1?"& ":"")+o[A],o=o.join(c>2?", ":" "),n.replace(Sv,`{
/* [wrapped with `+o+`] */
`)}function Cb(n){return xe(n)||Er(n)||!!(nd&&n&&n[nd])}function Ln(n,o){var c=typeof n;return o=o==null?$:o,!!o&&(c=="number"||c!="symbol"&&Dv.test(n))&&n>-1&&n%1==0&&n<o}function Nt(n,o,c){if(!ut(c))return!1;var A=typeof o;return(A=="number"?Bt(c)&&Ln(o,c.length):A=="string"&&o in c)?fn(c[o],n):!1}function tl(n,o){if(xe(n))return!1;var c=typeof n;return c=="number"||c=="symbol"||c=="boolean"||n==null||Vt(n)?!0:bv.test(n)||!yv.test(n)||o!=null&&n in et(o)}function Sb(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function nl(n){var o=Hs(n),c=D[o];if(typeof c!="function"||!(o in He.prototype))return!1;if(n===c)return!0;var A=Qu(c);return!!A&&n===A[0]}function Tb(n){return!!Qf&&Qf in n}var Ob=vs?Dn:bl;function so(n){var o=n&&n.constructor,c=typeof o=="function"&&o.prototype||li;return n===c}function Qd(n){return n===n&&!ut(n)}function Xd(n,o){return function(c){return c==null?!1:c[n]===o&&(o!==s||n in et(c))}}function wb(n){var o=Ks(n,function(A){return c.size===l&&c.clear(),A}),c=o.cache;return o}function Ib(n,o){var c=n[1],A=o[1],M=c|A,k=M<(w|I|d),V=A==d&&c==T||A==d&&c==p&&n[7].length<=o[8]||A==(d|p)&&o[7].length<=o[8]&&c==T;if(!(k||V))return n;A&w&&(n[2]=o[2],M|=c&w?0:S);var J=o[3];if(J){var Y=n[3];n[3]=Y?Nd(Y,J,o[4]):J,n[4]=Y?Jn(n[3],f):o[4]}return J=o[5],J&&(Y=n[5],n[5]=Y?Fd(Y,J,o[6]):J,n[6]=Y?Jn(n[5],f):o[6]),J=o[7],J&&(n[7]=J),A&d&&(n[8]=n[8]==null?o[8]:Pt(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=M,n}function Rb(n){var o=[];if(n!=null)for(var c in et(n))o.push(c);return o}function xb(n){return bs.call(n)}function eh(n,o,c){return o=At(o===s?n.length-1:o,0),function(){for(var A=arguments,M=-1,k=At(A.length-o,0),V=ne(k);++M<k;)V[M]=A[o+M];M=-1;for(var J=ne(o+1);++M<o;)J[M]=A[M];return J[o]=c(V),Gt(n,this,J)}}function th(n,o){return o.length<2?n:vr(n,tn(o,0,-1))}function Mb(n,o){for(var c=n.length,A=Pt(o.length,c),M=Ut(n);A--;){var k=o[A];n[A]=Ln(k,c)?M[k]:s}return n}function rl(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var nh=ih(Od),ao=Vy||function(n,o){return Tt.setTimeout(n,o)},il=ih(X0);function rh(n,o,c){var A=o+"";return il(n,Ab(A,_b(yb(A),c)))}function ih(n){var o=0,c=0;return function(){var A=qy(),M=z-(A-c);if(c=A,M>0){if(++o>=N)return arguments[0]}else o=0;return n.apply(s,arguments)}}function Ws(n,o){var c=-1,A=n.length,M=A-1;for(o=o===s?A:o;++c<o;){var k=$u(c,M),V=n[k];n[k]=n[c],n[c]=V}return n.length=o,n}var oh=wb(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(Ev,function(c,A,M,k){o.push(M?k.replace(Rv,"$1"):A||c)}),o});function An(n){if(typeof n=="string"||Vt(n))return n;var o=n+"";return o=="0"&&1/n==-L?"-0":o}function br(n){if(n!=null){try{return ys.call(n)}catch(o){}try{return n+""}catch(o){}}return""}function _b(n,o){return Yt(P,function(c){var A="_."+c[0];o&c[1]&&!hs(n,A)&&n.push(A)}),n.sort()}function sh(n){if(n instanceof He)return n.clone();var o=new Xt(n.__wrapped__,n.__chain__);return o.__actions__=Ut(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function Pb(n,o,c){(c?Nt(n,o,c):o===s)?o=1:o=At(Le(o),0);var A=n==null?0:n.length;if(!A||o<1)return[];for(var M=0,k=0,V=ne(Os(A/o));M<A;)V[k++]=tn(n,M,M+=o);return V}function Lb(n){for(var o=-1,c=n==null?0:n.length,A=0,M=[];++o<c;){var k=n[o];k&&(M[A++]=k)}return M}function Db(){var n=arguments.length;if(!n)return[];for(var o=ne(n-1),c=arguments[0],A=n;A--;)o[A-1]=arguments[A];return Kn(xe(c)?Ut(c):[c],Mt(o,1))}var Nb=Be(function(n,o){return pt(n)?to(n,Mt(o,1,pt,!0)):[]}),Fb=Be(function(n,o){var c=nn(o);return pt(c)&&(c=s),pt(n)?to(n,Mt(o,1,pt,!0),Te(c,2)):[]}),Ub=Be(function(n,o){var c=nn(o);return pt(c)&&(c=s),pt(n)?to(n,Mt(o,1,pt,!0),s,c):[]});function Bb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),tn(n,o<0?0:o,A)):[]}function kb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),o=A-o,tn(n,0,o<0?0:o)):[]}function $b(n,o){return n&&n.length?Ns(n,Te(o,3),!0,!0):[]}function Hb(n,o){return n&&n.length?Ns(n,Te(o,3),!0):[]}function Gb(n,o,c,A){var M=n==null?0:n.length;return M?(c&&typeof c!="number"&&Nt(n,o,c)&&(c=0,A=M),D0(n,o,c,A)):[]}function ah(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var M=c==null?0:Le(c);return M<0&&(M=At(A+M,0)),ps(n,Te(o,3),M)}function uh(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var M=A-1;return c!==s&&(M=Le(c),M=c<0?At(A+M,0):Pt(M,A-1)),ps(n,Te(o,3),M,!0)}function lh(n){var o=n==null?0:n.length;return o?Mt(n,1):[]}function Wb(n){var o=n==null?0:n.length;return o?Mt(n,L):[]}function zb(n,o){var c=n==null?0:n.length;return c?(o=o===s?1:Le(o),Mt(n,o)):[]}function Vb(n){for(var o=-1,c=n==null?0:n.length,A={};++o<c;){var M=n[o];A[M[0]]=M[1]}return A}function ch(n){return n&&n.length?n[0]:s}function jb(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var M=c==null?0:Le(c);return M<0&&(M=At(A+M,0)),si(n,o,M)}function Kb(n){var o=n==null?0:n.length;return o?tn(n,0,-1):[]}var Jb=Be(function(n){var o=st(n,Vu);return o.length&&o[0]===n[0]?Nu(o):[]}),qb=Be(function(n){var o=nn(n),c=st(n,Vu);return o===nn(c)?o=s:c.pop(),c.length&&c[0]===n[0]?Nu(c,Te(o,2)):[]}),Zb=Be(function(n){var o=nn(n),c=st(n,Vu);return o=typeof o=="function"?o:s,o&&c.pop(),c.length&&c[0]===n[0]?Nu(c,s,o):[]});function Yb(n,o){return n==null?"":Ky.call(n,o)}function nn(n){var o=n==null?0:n.length;return o?n[o-1]:s}function Qb(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var M=A;return c!==s&&(M=Le(c),M=M<0?At(A+M,0):Pt(M,A-1)),o===o?_y(n,o,M):ps(n,zf,M,!0)}function Xb(n,o){return n&&n.length?Ad(n,Le(o)):s}var eE=Be(fh);function fh(n,o){return n&&n.length&&o&&o.length?ku(n,o):n}function tE(n,o,c){return n&&n.length&&o&&o.length?ku(n,o,Te(c,2)):n}function nE(n,o,c){return n&&n.length&&o&&o.length?ku(n,o,s,c):n}var rE=Pn(function(n,o){var c=n==null?0:n.length,A=_u(n,o);return Td(n,st(o,function(M){return Ln(M,c)?+M:M}).sort(Dd)),A});function iE(n,o){var c=[];if(!(n&&n.length))return c;var A=-1,M=[],k=n.length;for(o=Te(o,3);++A<k;){var V=n[A];o(V,A,n)&&(c.push(V),M.push(A))}return Td(n,M),c}function ol(n){return n==null?n:Yy.call(n)}function oE(n,o,c){var A=n==null?0:n.length;return A?(c&&typeof c!="number"&&Nt(n,o,c)?(o=0,c=A):(o=o==null?0:Le(o),c=c===s?A:Le(c)),tn(n,o,c)):[]}function sE(n,o){return Ds(n,o)}function aE(n,o,c){return Gu(n,o,Te(c,2))}function uE(n,o){var c=n==null?0:n.length;if(c){var A=Ds(n,o);if(A<c&&fn(n[A],o))return A}return-1}function lE(n,o){return Ds(n,o,!0)}function cE(n,o,c){return Gu(n,o,Te(c,2),!0)}function fE(n,o){var c=n==null?0:n.length;if(c){var A=Ds(n,o,!0)-1;if(fn(n[A],o))return A}return-1}function dE(n){return n&&n.length?wd(n):[]}function hE(n,o){return n&&n.length?wd(n,Te(o,2)):[]}function pE(n){var o=n==null?0:n.length;return o?tn(n,1,o):[]}function mE(n,o,c){return n&&n.length?(o=c||o===s?1:Le(o),tn(n,0,o<0?0:o)):[]}function gE(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),o=A-o,tn(n,o<0?0:o,A)):[]}function vE(n,o){return n&&n.length?Ns(n,Te(o,3),!1,!0):[]}function yE(n,o){return n&&n.length?Ns(n,Te(o,3)):[]}var bE=Be(function(n){return Qn(Mt(n,1,pt,!0))}),EE=Be(function(n){var o=nn(n);return pt(o)&&(o=s),Qn(Mt(n,1,pt,!0),Te(o,2))}),AE=Be(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Qn(Mt(n,1,pt,!0),s,o)});function CE(n){return n&&n.length?Qn(n):[]}function SE(n,o){return n&&n.length?Qn(n,Te(o,2)):[]}function TE(n,o){return o=typeof o=="function"?o:s,n&&n.length?Qn(n,s,o):[]}function sl(n){if(!(n&&n.length))return[];var o=0;return n=jn(n,function(c){if(pt(c))return o=At(c.length,o),!0}),Su(o,function(c){return st(n,Eu(c))})}function dh(n,o){if(!(n&&n.length))return[];var c=sl(n);return o==null?c:st(c,function(A){return Gt(o,s,A)})}var OE=Be(function(n,o){return pt(n)?to(n,o):[]}),wE=Be(function(n){return zu(jn(n,pt))}),IE=Be(function(n){var o=nn(n);return pt(o)&&(o=s),zu(jn(n,pt),Te(o,2))}),RE=Be(function(n){var o=nn(n);return o=typeof o=="function"?o:s,zu(jn(n,pt),s,o)}),xE=Be(sl);function ME(n,o){return Md(n||[],o||[],eo)}function _E(n,o){return Md(n||[],o||[],io)}var PE=Be(function(n){var o=n.length,c=o>1?n[o-1]:s;return c=typeof c=="function"?(n.pop(),c):s,dh(n,c)});function hh(n){var o=D(n);return o.__chain__=!0,o}function LE(n,o){return o(n),n}function zs(n,o){return o(n)}var DE=Pn(function(n){var o=n.length,c=o?n[0]:0,A=this.__wrapped__,M=function(k){return _u(k,n)};return o>1||this.__actions__.length||!(A instanceof He)||!Ln(c)?this.thru(M):(A=A.slice(c,+c+(o?1:0)),A.__actions__.push({func:zs,args:[M],thisArg:s}),new Xt(A,this.__chain__).thru(function(k){return o&&!k.length&&k.push(s),k}))});function NE(){return hh(this)}function FE(){return new Xt(this.value(),this.__chain__)}function UE(){this.__values__===s&&(this.__values__=Ih(this.value()));var n=this.__index__>=this.__values__.length,o=n?s:this.__values__[this.__index__++];return{done:n,value:o}}function BE(){return this}function kE(n){for(var o,c=this;c instanceof xs;){var A=sh(c);A.__index__=0,A.__values__=s,o?M.__wrapped__=A:o=A;var M=A;c=c.__wrapped__}return M.__wrapped__=n,o}function $E(){var n=this.__wrapped__;if(n instanceof He){var o=n;return this.__actions__.length&&(o=new He(this)),o=o.reverse(),o.__actions__.push({func:zs,args:[ol],thisArg:s}),new Xt(o,this.__chain__)}return this.thru(ol)}function HE(){return xd(this.__wrapped__,this.__actions__)}var GE=Fs(function(n,o,c){Xe.call(n,c)?++n[c]:Mn(n,c,1)});function WE(n,o,c){var A=xe(n)?Gf:L0;return c&&Nt(n,o,c)&&(o=s),A(n,Te(o,3))}function zE(n,o){var c=xe(n)?jn:dd;return c(n,Te(o,3))}var VE=$d(ah),jE=$d(uh);function KE(n,o){return Mt(Vs(n,o),1)}function JE(n,o){return Mt(Vs(n,o),L)}function qE(n,o,c){return c=c===s?1:Le(c),Mt(Vs(n,o),c)}function ph(n,o){var c=xe(n)?Yt:Yn;return c(n,Te(o,3))}function mh(n,o){var c=xe(n)?py:fd;return c(n,Te(o,3))}var ZE=Fs(function(n,o,c){Xe.call(n,c)?n[c].push(o):Mn(n,c,[o])});function YE(n,o,c,A){n=Bt(n)?n:vi(n),c=c&&!A?Le(c):0;var M=n.length;return c<0&&(c=At(M+c,0)),Zs(n)?c<=M&&n.indexOf(o,c)>-1:!!M&&si(n,o,c)>-1}var QE=Be(function(n,o,c){var A=-1,M=typeof o=="function",k=Bt(n)?ne(n.length):[];return Yn(n,function(V){k[++A]=M?Gt(o,V,c):no(V,o,c)}),k}),XE=Fs(function(n,o,c){Mn(n,c,o)});function Vs(n,o){var c=xe(n)?st:yd;return c(n,Te(o,3))}function eA(n,o,c,A){return n==null?[]:(xe(o)||(o=o==null?[]:[o]),c=A?s:c,xe(c)||(c=c==null?[]:[c]),Cd(n,o,c))}var tA=Fs(function(n,o,c){n[c?0:1].push(o)},function(){return[[],[]]});function nA(n,o,c){var A=xe(n)?yu:jf,M=arguments.length<3;return A(n,Te(o,4),c,M,Yn)}function rA(n,o,c){var A=xe(n)?my:jf,M=arguments.length<3;return A(n,Te(o,4),c,M,fd)}function iA(n,o){var c=xe(n)?jn:dd;return c(n,Js(Te(o,3)))}function oA(n){var o=xe(n)?ad:Y0;return o(n)}function sA(n,o,c){(c?Nt(n,o,c):o===s)?o=1:o=Le(o);var A=xe(n)?R0:Q0;return A(n,o)}function aA(n){var o=xe(n)?x0:eb;return o(n)}function uA(n){if(n==null)return 0;if(Bt(n))return Zs(n)?ui(n):n.length;var o=Lt(n);return o==de||o==at?n.size:Uu(n).length}function lA(n,o,c){var A=xe(n)?bu:tb;return c&&Nt(n,o,c)&&(o=s),A(n,Te(o,3))}var cA=Be(function(n,o){if(n==null)return[];var c=o.length;return c>1&&Nt(n,o[0],o[1])?o=[]:c>2&&Nt(o[0],o[1],o[2])&&(o=[o[0]]),Cd(n,Mt(o,1),[])}),js=zy||function(){return Tt.Date.now()};function fA(n,o){if(typeof o!="function")throw new Qt(i);return n=Le(n),function(){if(--n<1)return o.apply(this,arguments)}}function gh(n,o,c){return o=c?s:o,o=n&&o==null?n.length:o,_n(n,d,s,s,s,s,o)}function vh(n,o){var c;if(typeof o!="function")throw new Qt(i);return n=Le(n),function(){return--n>0&&(c=o.apply(this,arguments)),n<=1&&(o=s),c}}var al=Be(function(n,o,c){var A=w;if(c.length){var M=Jn(c,mi(al));A|=g}return _n(n,A,o,c,M)}),yh=Be(function(n,o,c){var A=w|I;if(c.length){var M=Jn(c,mi(yh));A|=g}return _n(o,A,n,c,M)});function bh(n,o,c){o=c?s:o;var A=_n(n,T,s,s,s,s,s,o);return A.placeholder=bh.placeholder,A}function Eh(n,o,c){o=c?s:o;var A=_n(n,x,s,s,s,s,s,o);return A.placeholder=Eh.placeholder,A}function Ah(n,o,c){var A,M,k,V,J,Y,se=0,ae=!1,ue=!1,he=!0;if(typeof n!="function")throw new Qt(i);o=rn(o)||0,ut(c)&&(ae=!!c.leading,ue="maxWait"in c,k=ue?At(rn(c.maxWait)||0,o):k,he="trailing"in c?!!c.trailing:he);function ye(mt){var dn=A,Fn=M;return A=M=s,se=mt,V=n.apply(Fn,dn),V}function Oe(mt){return se=mt,J=ao(ke,o),ae?ye(mt):V}function Fe(mt){var dn=mt-Y,Fn=mt-se,$h=o-dn;return ue?Pt($h,k-Fn):$h}function we(mt){var dn=mt-Y,Fn=mt-se;return Y===s||dn>=o||dn<0||ue&&Fn>=k}function ke(){var mt=js();if(we(mt))return ze(mt);J=ao(ke,Fe(mt))}function ze(mt){return J=s,he&&A?ye(mt):(A=M=s,V)}function jt(){J!==s&&_d(J),se=0,A=Y=M=J=s}function Ft(){return J===s?V:ze(js())}function Kt(){var mt=js(),dn=we(mt);if(A=arguments,M=this,Y=mt,dn){if(J===s)return Oe(Y);if(ue)return _d(J),J=ao(ke,o),ye(Y)}return J===s&&(J=ao(ke,o)),V}return Kt.cancel=jt,Kt.flush=Ft,Kt}var dA=Be(function(n,o){return cd(n,1,o)}),hA=Be(function(n,o,c){return cd(n,rn(o)||0,c)});function pA(n){return _n(n,O)}function Ks(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Qt(i);var c=function(){var A=arguments,M=o?o.apply(this,A):A[0],k=c.cache;if(k.has(M))return k.get(M);var V=n.apply(this,A);return c.cache=k.set(M,V)||k,V};return c.cache=new(Ks.Cache||xn),c}Ks.Cache=xn;function Js(n){if(typeof n!="function")throw new Qt(i);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function mA(n){return vh(2,n)}var gA=nb(function(n,o){o=o.length==1&&xe(o[0])?st(o[0],Wt(Te())):st(Mt(o,1),Wt(Te()));var c=o.length;return Be(function(A){for(var M=-1,k=Pt(A.length,c);++M<k;)A[M]=o[M].call(this,A[M]);return Gt(n,this,A)})}),ul=Be(function(n,o){var c=Jn(o,mi(ul));return _n(n,g,s,o,c)}),Ch=Be(function(n,o){var c=Jn(o,mi(Ch));return _n(n,y,s,o,c)}),vA=Pn(function(n,o){return _n(n,p,s,s,s,o)});function yA(n,o){if(typeof n!="function")throw new Qt(i);return o=o===s?o:Le(o),Be(n,o)}function bA(n,o){if(typeof n!="function")throw new Qt(i);return o=o==null?0:At(Le(o),0),Be(function(c){var A=c[o],M=er(c,0,o);return A&&Kn(M,A),Gt(n,this,M)})}function EA(n,o,c){var A=!0,M=!0;if(typeof n!="function")throw new Qt(i);return ut(c)&&(A="leading"in c?!!c.leading:A,M="trailing"in c?!!c.trailing:M),Ah(n,o,{leading:A,maxWait:o,trailing:M})}function AA(n){return gh(n,1)}function CA(n,o){return ul(ju(o),n)}function SA(){if(!arguments.length)return[];var n=arguments[0];return xe(n)?n:[n]}function TA(n){return en(n,C)}function OA(n,o){return o=typeof o=="function"?o:s,en(n,C,o)}function wA(n){return en(n,m|C)}function IA(n,o){return o=typeof o=="function"?o:s,en(n,m|C,o)}function RA(n,o){return o==null||ld(n,o,Ot(o))}function fn(n,o){return n===o||n!==n&&o!==o}var xA=$s(Du),MA=$s(function(n,o){return n>=o}),Er=md(function(){return arguments}())?md:function(n){return ht(n)&&Xe.call(n,"callee")&&!td.call(n,"callee")},xe=ne.isArray,_A=Ff?Wt(Ff):k0;function Bt(n){return n!=null&&qs(n.length)&&!Dn(n)}function pt(n){return ht(n)&&Bt(n)}function PA(n){return n===!0||n===!1||ht(n)&&Dt(n)==te}var tr=jy||bl,LA=Uf?Wt(Uf):$0;function DA(n){return ht(n)&&n.nodeType===1&&!uo(n)}function NA(n){if(n==null)return!0;if(Bt(n)&&(xe(n)||typeof n=="string"||typeof n.splice=="function"||tr(n)||gi(n)||Er(n)))return!n.length;var o=Lt(n);if(o==de||o==at)return!n.size;if(so(n))return!Uu(n).length;for(var c in n)if(Xe.call(n,c))return!1;return!0}function FA(n,o){return ro(n,o)}function UA(n,o,c){c=typeof c=="function"?c:s;var A=c?c(n,o):s;return A===s?ro(n,o,s,c):!!A}function ll(n){if(!ht(n))return!1;var o=Dt(n);return o==be||o==me||typeof n.message=="string"&&typeof n.name=="string"&&!uo(n)}function BA(n){return typeof n=="number"&&rd(n)}function Dn(n){if(!ut(n))return!1;var o=Dt(n);return o==Se||o==$e||o==j||o==un}function Sh(n){return typeof n=="number"&&n==Le(n)}function qs(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=$}function ut(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function ht(n){return n!=null&&typeof n=="object"}var Th=Bf?Wt(Bf):G0;function kA(n,o){return n===o||Fu(n,o,Xu(o))}function $A(n,o,c){return c=typeof c=="function"?c:s,Fu(n,o,Xu(o),c)}function HA(n){return Oh(n)&&n!=+n}function GA(n){if(Ob(n))throw new Re(r);return gd(n)}function WA(n){return n===null}function zA(n){return n==null}function Oh(n){return typeof n=="number"||ht(n)&&Dt(n)==Ze}function uo(n){if(!ht(n)||Dt(n)!=it)return!1;var o=Cs(n);if(o===null)return!0;var c=Xe.call(o,"constructor")&&o.constructor;return typeof c=="function"&&c instanceof c&&ys.call(c)==$y}var cl=kf?Wt(kf):W0;function VA(n){return Sh(n)&&n>=-$&&n<=$}var wh=$f?Wt($f):z0;function Zs(n){return typeof n=="string"||!xe(n)&&ht(n)&&Dt(n)==yn}function Vt(n){return typeof n=="symbol"||ht(n)&&Dt(n)==Vn}var gi=Hf?Wt(Hf):V0;function jA(n){return n===s}function KA(n){return ht(n)&&Lt(n)==fr}function JA(n){return ht(n)&&Dt(n)==ru}var qA=$s(Bu),ZA=$s(function(n,o){return n<=o});function Ih(n){if(!n)return[];if(Bt(n))return Zs(n)?ln(n):Ut(n);if(qi&&n[qi])return Ry(n[qi]());var o=Lt(n),c=o==de?Ou:o==at?ms:vi;return c(n)}function Nn(n){if(!n)return n===0?n:0;if(n=rn(n),n===L||n===-L){var o=n<0?-1:1;return o*G}return n===n?n:0}function Le(n){var o=Nn(n),c=o%1;return o===o?c?o-c:o:0}function Rh(n){return n?gr(Le(n),0,ee):0}function rn(n){if(typeof n=="number")return n;if(Vt(n))return K;if(ut(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=ut(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=Kf(n);var c=_v.test(n);return c||Lv.test(n)?fy(n.slice(2),c?2:8):Mv.test(n)?K:+n}function xh(n){return En(n,kt(n))}function YA(n){return n?gr(Le(n),-$,$):n===0?n:0}function Ye(n){return n==null?"":zt(n)}var QA=hi(function(n,o){if(so(o)||Bt(o)){En(o,Ot(o),n);return}for(var c in o)Xe.call(o,c)&&eo(n,c,o[c])}),Mh=hi(function(n,o){En(o,kt(o),n)}),Ys=hi(function(n,o,c,A){En(o,kt(o),n,A)}),XA=hi(function(n,o,c,A){En(o,Ot(o),n,A)}),eC=Pn(_u);function tC(n,o){var c=di(n);return o==null?c:ud(c,o)}var nC=Be(function(n,o){n=et(n);var c=-1,A=o.length,M=A>2?o[2]:s;for(M&&Nt(o[0],o[1],M)&&(A=1);++c<A;)for(var k=o[c],V=kt(k),J=-1,Y=V.length;++J<Y;){var se=V[J],ae=n[se];(ae===s||fn(ae,li[se])&&!Xe.call(n,se))&&(n[se]=k[se])}return n}),rC=Be(function(n){return n.push(s,Kd),Gt(_h,s,n)});function iC(n,o){return Wf(n,Te(o,3),bn)}function oC(n,o){return Wf(n,Te(o,3),Lu)}function sC(n,o){return n==null?n:Pu(n,Te(o,3),kt)}function aC(n,o){return n==null?n:hd(n,Te(o,3),kt)}function uC(n,o){return n&&bn(n,Te(o,3))}function lC(n,o){return n&&Lu(n,Te(o,3))}function cC(n){return n==null?[]:Ps(n,Ot(n))}function fC(n){return n==null?[]:Ps(n,kt(n))}function fl(n,o,c){var A=n==null?s:vr(n,o);return A===s?c:A}function dC(n,o){return n!=null&&Zd(n,o,N0)}function dl(n,o){return n!=null&&Zd(n,o,F0)}var hC=Gd(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=bs.call(o)),n[o]=c},pl($t)),pC=Gd(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=bs.call(o)),Xe.call(n,o)?n[o].push(c):n[o]=[c]},Te),mC=Be(no);function Ot(n){return Bt(n)?sd(n):Uu(n)}function kt(n){return Bt(n)?sd(n,!0):j0(n)}function gC(n,o){var c={};return o=Te(o,3),bn(n,function(A,M,k){Mn(c,o(A,M,k),A)}),c}function vC(n,o){var c={};return o=Te(o,3),bn(n,function(A,M,k){Mn(c,M,o(A,M,k))}),c}var yC=hi(function(n,o,c){Ls(n,o,c)}),_h=hi(function(n,o,c,A){Ls(n,o,c,A)}),bC=Pn(function(n,o){var c={};if(n==null)return c;var A=!1;o=st(o,function(k){return k=Xn(k,n),A||(A=k.length>1),k}),En(n,Yu(n),c),A&&(c=en(c,m|b|C,hb));for(var M=o.length;M--;)Wu(c,o[M]);return c});function EC(n,o){return Ph(n,Js(Te(o)))}var AC=Pn(function(n,o){return n==null?{}:J0(n,o)});function Ph(n,o){if(n==null)return{};var c=st(Yu(n),function(A){return[A]});return o=Te(o),Sd(n,c,function(A,M){return o(A,M[0])})}function CC(n,o,c){o=Xn(o,n);var A=-1,M=o.length;for(M||(M=1,n=s);++A<M;){var k=n==null?s:n[An(o[A])];k===s&&(A=M,k=c),n=Dn(k)?k.call(n):k}return n}function SC(n,o,c){return n==null?n:io(n,o,c)}function TC(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:io(n,o,c,A)}var Lh=Vd(Ot),Dh=Vd(kt);function OC(n,o,c){var A=xe(n),M=A||tr(n)||gi(n);if(o=Te(o,4),c==null){var k=n&&n.constructor;M?c=A?new k:[]:ut(n)?c=Dn(k)?di(Cs(n)):{}:c={}}return(M?Yt:bn)(n,function(V,J,Y){return o(c,V,J,Y)}),c}function wC(n,o){return n==null?!0:Wu(n,o)}function IC(n,o,c){return n==null?n:Rd(n,o,ju(c))}function RC(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:Rd(n,o,ju(c),A)}function vi(n){return n==null?[]:Tu(n,Ot(n))}function xC(n){return n==null?[]:Tu(n,kt(n))}function MC(n,o,c){return c===s&&(c=o,o=s),c!==s&&(c=rn(c),c=c===c?c:0),o!==s&&(o=rn(o),o=o===o?o:0),gr(rn(n),o,c)}function _C(n,o,c){return o=Nn(o),c===s?(c=o,o=0):c=Nn(c),n=rn(n),U0(n,o,c)}function PC(n,o,c){if(c&&typeof c!="boolean"&&Nt(n,o,c)&&(o=c=s),c===s&&(typeof o=="boolean"?(c=o,o=s):typeof n=="boolean"&&(c=n,n=s)),n===s&&o===s?(n=0,o=1):(n=Nn(n),o===s?(o=n,n=0):o=Nn(o)),n>o){var A=n;n=o,o=A}if(c||n%1||o%1){var M=id();return Pt(n+M*(o-n+cy("1e-"+((M+"").length-1))),o)}return $u(n,o)}var LC=pi(function(n,o,c){return o=o.toLowerCase(),n+(c?Nh(o):o)});function Nh(n){return hl(Ye(n).toLowerCase())}function Fh(n){return n=Ye(n),n&&n.replace(Nv,Sy).replace(ey,"")}function DC(n,o,c){n=Ye(n),o=zt(o);var A=n.length;c=c===s?A:gr(Le(c),0,A);var M=c;return c-=o.length,c>=0&&n.slice(c,M)==o}function NC(n){return n=Ye(n),n&&mv.test(n)?n.replace(hf,Ty):n}function FC(n){return n=Ye(n),n&&Av.test(n)?n.replace(uu,"\\$&"):n}var UC=pi(function(n,o,c){return n+(c?"-":"")+o.toLowerCase()}),BC=pi(function(n,o,c){return n+(c?" ":"")+o.toLowerCase()}),kC=kd("toLowerCase");function $C(n,o,c){n=Ye(n),o=Le(o);var A=o?ui(n):0;if(!o||A>=o)return n;var M=(o-A)/2;return ks(ws(M),c)+n+ks(Os(M),c)}function HC(n,o,c){n=Ye(n),o=Le(o);var A=o?ui(n):0;return o&&A<o?n+ks(o-A,c):n}function GC(n,o,c){n=Ye(n),o=Le(o);var A=o?ui(n):0;return o&&A<o?ks(o-A,c)+n:n}function WC(n,o,c){return c||o==null?o=0:o&&(o=+o),Zy(Ye(n).replace(lu,""),o||0)}function zC(n,o,c){return(c?Nt(n,o,c):o===s)?o=1:o=Le(o),Hu(Ye(n),o)}function VC(){var n=arguments,o=Ye(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var jC=pi(function(n,o,c){return n+(c?"_":"")+o.toLowerCase()});function KC(n,o,c){return c&&typeof c!="number"&&Nt(n,o,c)&&(o=c=s),c=c===s?ee:c>>>0,c?(n=Ye(n),n&&(typeof o=="string"||o!=null&&!cl(o))&&(o=zt(o),!o&&ai(n))?er(ln(n),0,c):n.split(o,c)):[]}var JC=pi(function(n,o,c){return n+(c?" ":"")+hl(o)});function qC(n,o,c){return n=Ye(n),c=c==null?0:gr(Le(c),0,n.length),o=zt(o),n.slice(c,c+o.length)==o}function ZC(n,o,c){var A=D.templateSettings;c&&Nt(n,o,c)&&(o=s),n=Ye(n),o=Ys({},o,A,jd);var M=Ys({},o.imports,A.imports,jd),k=Ot(M),V=Tu(M,k),J,Y,se=0,ae=o.interpolate||cs,ue="__p += '",he=wu((o.escape||cs).source+"|"+ae.source+"|"+(ae===pf?xv:cs).source+"|"+(o.evaluate||cs).source+"|$","g"),ye="//# sourceURL="+(Xe.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oy+"]")+`
`;n.replace(he,function(we,ke,ze,jt,Ft,Kt){return ze||(ze=jt),ue+=n.slice(se,Kt).replace(Fv,Oy),ke&&(J=!0,ue+=`' +
__e(`+ke+`) +
'`),Ft&&(Y=!0,ue+=`';
`+Ft+`;
__p += '`),ze&&(ue+=`' +
((__t = (`+ze+`)) == null ? '' : __t) +
'`),se=Kt+we.length,we}),ue+=`';
`;var Oe=Xe.call(o,"variable")&&o.variable;if(!Oe)ue=`with (obj) {
`+ue+`
}
`;else if(Iv.test(Oe))throw new Re(a);ue=(Y?ue.replace(fv,""):ue).replace(dv,"$1").replace(hv,"$1;"),ue="function("+(Oe||"obj")+`) {
`+(Oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ue+`return __p
}`;var Fe=Bh(function(){return Je(k,ye+"return "+ue).apply(s,V)});if(Fe.source=ue,ll(Fe))throw Fe;return Fe}function YC(n){return Ye(n).toLowerCase()}function QC(n){return Ye(n).toUpperCase()}function XC(n,o,c){if(n=Ye(n),n&&(c||o===s))return Kf(n);if(!n||!(o=zt(o)))return n;var A=ln(n),M=ln(o),k=Jf(A,M),V=qf(A,M)+1;return er(A,k,V).join("")}function eS(n,o,c){if(n=Ye(n),n&&(c||o===s))return n.slice(0,Yf(n)+1);if(!n||!(o=zt(o)))return n;var A=ln(n),M=qf(A,ln(o))+1;return er(A,0,M).join("")}function tS(n,o,c){if(n=Ye(n),n&&(c||o===s))return n.replace(lu,"");if(!n||!(o=zt(o)))return n;var A=ln(n),M=Jf(A,ln(o));return er(A,M).join("")}function nS(n,o){var c=v,A=R;if(ut(o)){var M="separator"in o?o.separator:M;c="length"in o?Le(o.length):c,A="omission"in o?zt(o.omission):A}n=Ye(n);var k=n.length;if(ai(n)){var V=ln(n);k=V.length}if(c>=k)return n;var J=c-ui(A);if(J<1)return A;var Y=V?er(V,0,J).join(""):n.slice(0,J);if(M===s)return Y+A;if(V&&(J+=Y.length-J),cl(M)){if(n.slice(J).search(M)){var se,ae=Y;for(M.global||(M=wu(M.source,Ye(mf.exec(M))+"g")),M.lastIndex=0;se=M.exec(ae);)var ue=se.index;Y=Y.slice(0,ue===s?J:ue)}}else if(n.indexOf(zt(M),J)!=J){var he=Y.lastIndexOf(M);he>-1&&(Y=Y.slice(0,he))}return Y+A}function rS(n){return n=Ye(n),n&&pv.test(n)?n.replace(df,Py):n}var iS=pi(function(n,o,c){return n+(c?" ":"")+o.toUpperCase()}),hl=kd("toUpperCase");function Uh(n,o,c){return n=Ye(n),o=c?s:o,o===s?Iy(n)?Ny(n):yy(n):n.match(o)||[]}var Bh=Be(function(n,o){try{return Gt(n,s,o)}catch(c){return ll(c)?c:new Re(c)}}),oS=Pn(function(n,o){return Yt(o,function(c){c=An(c),Mn(n,c,al(n[c],n))}),n});function sS(n){var o=n==null?0:n.length,c=Te();return n=o?st(n,function(A){if(typeof A[1]!="function")throw new Qt(i);return[c(A[0]),A[1]]}):[],Be(function(A){for(var M=-1;++M<o;){var k=n[M];if(Gt(k[0],this,A))return Gt(k[1],this,A)}})}function aS(n){return P0(en(n,m))}function pl(n){return function(){return n}}function uS(n,o){return n==null||n!==n?o:n}var lS=Hd(),cS=Hd(!0);function $t(n){return n}function ml(n){return vd(typeof n=="function"?n:en(n,m))}function fS(n){return bd(en(n,m))}function dS(n,o){return Ed(n,en(o,m))}var hS=Be(function(n,o){return function(c){return no(c,n,o)}}),pS=Be(function(n,o){return function(c){return no(n,c,o)}});function gl(n,o,c){var A=Ot(o),M=Ps(o,A);c==null&&!(ut(o)&&(M.length||!A.length))&&(c=o,o=n,n=this,M=Ps(o,Ot(o)));var k=!(ut(c)&&"chain"in c)||!!c.chain,V=Dn(n);return Yt(M,function(J){var Y=o[J];n[J]=Y,V&&(n.prototype[J]=function(){var se=this.__chain__;if(k||se){var ae=n(this.__wrapped__),ue=ae.__actions__=Ut(this.__actions__);return ue.push({func:Y,args:arguments,thisArg:n}),ae.__chain__=se,ae}return Y.apply(n,Kn([this.value()],arguments))})}),n}function mS(){return Tt._===this&&(Tt._=Hy),this}function vl(){}function gS(n){return n=Le(n),Be(function(o){return Ad(o,n)})}var vS=Ju(st),yS=Ju(Gf),bS=Ju(bu);function kh(n){return tl(n)?Eu(An(n)):q0(n)}function ES(n){return function(o){return n==null?s:vr(n,o)}}var AS=Wd(),CS=Wd(!0);function yl(){return[]}function bl(){return!1}function SS(){return{}}function TS(){return""}function OS(){return!0}function wS(n,o){if(n=Le(n),n<1||n>$)return[];var c=ee,A=Pt(n,ee);o=Te(o),n-=ee;for(var M=Su(A,o);++c<n;)o(c);return M}function IS(n){return xe(n)?st(n,An):Vt(n)?[n]:Ut(oh(Ye(n)))}function RS(n){var o=++ky;return Ye(n)+o}var xS=Bs(function(n,o){return n+o},0),MS=qu("ceil"),_S=Bs(function(n,o){return n/o},1),PS=qu("floor");function LS(n){return n&&n.length?_s(n,$t,Du):s}function DS(n,o){return n&&n.length?_s(n,Te(o,2),Du):s}function NS(n){return Vf(n,$t)}function FS(n,o){return Vf(n,Te(o,2))}function US(n){return n&&n.length?_s(n,$t,Bu):s}function BS(n,o){return n&&n.length?_s(n,Te(o,2),Bu):s}var kS=Bs(function(n,o){return n*o},1),$S=qu("round"),HS=Bs(function(n,o){return n-o},0);function GS(n){return n&&n.length?Cu(n,$t):0}function WS(n,o){return n&&n.length?Cu(n,Te(o,2)):0}return D.after=fA,D.ary=gh,D.assign=QA,D.assignIn=Mh,D.assignInWith=Ys,D.assignWith=XA,D.at=eC,D.before=vh,D.bind=al,D.bindAll=oS,D.bindKey=yh,D.castArray=SA,D.chain=hh,D.chunk=Pb,D.compact=Lb,D.concat=Db,D.cond=sS,D.conforms=aS,D.constant=pl,D.countBy=GE,D.create=tC,D.curry=bh,D.curryRight=Eh,D.debounce=Ah,D.defaults=nC,D.defaultsDeep=rC,D.defer=dA,D.delay=hA,D.difference=Nb,D.differenceBy=Fb,D.differenceWith=Ub,D.drop=Bb,D.dropRight=kb,D.dropRightWhile=$b,D.dropWhile=Hb,D.fill=Gb,D.filter=zE,D.flatMap=KE,D.flatMapDeep=JE,D.flatMapDepth=qE,D.flatten=lh,D.flattenDeep=Wb,D.flattenDepth=zb,D.flip=pA,D.flow=lS,D.flowRight=cS,D.fromPairs=Vb,D.functions=cC,D.functionsIn=fC,D.groupBy=ZE,D.initial=Kb,D.intersection=Jb,D.intersectionBy=qb,D.intersectionWith=Zb,D.invert=hC,D.invertBy=pC,D.invokeMap=QE,D.iteratee=ml,D.keyBy=XE,D.keys=Ot,D.keysIn=kt,D.map=Vs,D.mapKeys=gC,D.mapValues=vC,D.matches=fS,D.matchesProperty=dS,D.memoize=Ks,D.merge=yC,D.mergeWith=_h,D.method=hS,D.methodOf=pS,D.mixin=gl,D.negate=Js,D.nthArg=gS,D.omit=bC,D.omitBy=EC,D.once=mA,D.orderBy=eA,D.over=vS,D.overArgs=gA,D.overEvery=yS,D.overSome=bS,D.partial=ul,D.partialRight=Ch,D.partition=tA,D.pick=AC,D.pickBy=Ph,D.property=kh,D.propertyOf=ES,D.pull=eE,D.pullAll=fh,D.pullAllBy=tE,D.pullAllWith=nE,D.pullAt=rE,D.range=AS,D.rangeRight=CS,D.rearg=vA,D.reject=iA,D.remove=iE,D.rest=yA,D.reverse=ol,D.sampleSize=sA,D.set=SC,D.setWith=TC,D.shuffle=aA,D.slice=oE,D.sortBy=cA,D.sortedUniq=dE,D.sortedUniqBy=hE,D.split=KC,D.spread=bA,D.tail=pE,D.take=mE,D.takeRight=gE,D.takeRightWhile=vE,D.takeWhile=yE,D.tap=LE,D.throttle=EA,D.thru=zs,D.toArray=Ih,D.toPairs=Lh,D.toPairsIn=Dh,D.toPath=IS,D.toPlainObject=xh,D.transform=OC,D.unary=AA,D.union=bE,D.unionBy=EE,D.unionWith=AE,D.uniq=CE,D.uniqBy=SE,D.uniqWith=TE,D.unset=wC,D.unzip=sl,D.unzipWith=dh,D.update=IC,D.updateWith=RC,D.values=vi,D.valuesIn=xC,D.without=OE,D.words=Uh,D.wrap=CA,D.xor=wE,D.xorBy=IE,D.xorWith=RE,D.zip=xE,D.zipObject=ME,D.zipObjectDeep=_E,D.zipWith=PE,D.entries=Lh,D.entriesIn=Dh,D.extend=Mh,D.extendWith=Ys,gl(D,D),D.add=xS,D.attempt=Bh,D.camelCase=LC,D.capitalize=Nh,D.ceil=MS,D.clamp=MC,D.clone=TA,D.cloneDeep=wA,D.cloneDeepWith=IA,D.cloneWith=OA,D.conformsTo=RA,D.deburr=Fh,D.defaultTo=uS,D.divide=_S,D.endsWith=DC,D.eq=fn,D.escape=NC,D.escapeRegExp=FC,D.every=WE,D.find=VE,D.findIndex=ah,D.findKey=iC,D.findLast=jE,D.findLastIndex=uh,D.findLastKey=oC,D.floor=PS,D.forEach=ph,D.forEachRight=mh,D.forIn=sC,D.forInRight=aC,D.forOwn=uC,D.forOwnRight=lC,D.get=fl,D.gt=xA,D.gte=MA,D.has=dC,D.hasIn=dl,D.head=ch,D.identity=$t,D.includes=YE,D.indexOf=jb,D.inRange=_C,D.invoke=mC,D.isArguments=Er,D.isArray=xe,D.isArrayBuffer=_A,D.isArrayLike=Bt,D.isArrayLikeObject=pt,D.isBoolean=PA,D.isBuffer=tr,D.isDate=LA,D.isElement=DA,D.isEmpty=NA,D.isEqual=FA,D.isEqualWith=UA,D.isError=ll,D.isFinite=BA,D.isFunction=Dn,D.isInteger=Sh,D.isLength=qs,D.isMap=Th,D.isMatch=kA,D.isMatchWith=$A,D.isNaN=HA,D.isNative=GA,D.isNil=zA,D.isNull=WA,D.isNumber=Oh,D.isObject=ut,D.isObjectLike=ht,D.isPlainObject=uo,D.isRegExp=cl,D.isSafeInteger=VA,D.isSet=wh,D.isString=Zs,D.isSymbol=Vt,D.isTypedArray=gi,D.isUndefined=jA,D.isWeakMap=KA,D.isWeakSet=JA,D.join=Yb,D.kebabCase=UC,D.last=nn,D.lastIndexOf=Qb,D.lowerCase=BC,D.lowerFirst=kC,D.lt=qA,D.lte=ZA,D.max=LS,D.maxBy=DS,D.mean=NS,D.meanBy=FS,D.min=US,D.minBy=BS,D.stubArray=yl,D.stubFalse=bl,D.stubObject=SS,D.stubString=TS,D.stubTrue=OS,D.multiply=kS,D.nth=Xb,D.noConflict=mS,D.noop=vl,D.now=js,D.pad=$C,D.padEnd=HC,D.padStart=GC,D.parseInt=WC,D.random=PC,D.reduce=nA,D.reduceRight=rA,D.repeat=zC,D.replace=VC,D.result=CC,D.round=$S,D.runInContext=Z,D.sample=oA,D.size=uA,D.snakeCase=jC,D.some=lA,D.sortedIndex=sE,D.sortedIndexBy=aE,D.sortedIndexOf=uE,D.sortedLastIndex=lE,D.sortedLastIndexBy=cE,D.sortedLastIndexOf=fE,D.startCase=JC,D.startsWith=qC,D.subtract=HS,D.sum=GS,D.sumBy=WS,D.template=ZC,D.times=wS,D.toFinite=Nn,D.toInteger=Le,D.toLength=Rh,D.toLower=YC,D.toNumber=rn,D.toSafeInteger=YA,D.toString=Ye,D.toUpper=QC,D.trim=XC,D.trimEnd=eS,D.trimStart=tS,D.truncate=nS,D.unescape=rS,D.uniqueId=RS,D.upperCase=iS,D.upperFirst=hl,D.each=ph,D.eachRight=mh,D.first=ch,gl(D,function(){var n={};return bn(D,function(o,c){Xe.call(D.prototype,c)||(n[c]=o)}),n}(),{chain:!1}),D.VERSION=e,Yt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){D[n].placeholder=D}),Yt(["drop","take"],function(n,o){He.prototype[n]=function(c){c=c===s?1:At(Le(c),0);var A=this.__filtered__&&!o?new He(this):this.clone();return A.__filtered__?A.__takeCount__=Pt(c,A.__takeCount__):A.__views__.push({size:Pt(c,ee),type:n+(A.__dir__<0?"Right":"")}),A},He.prototype[n+"Right"]=function(c){return this.reverse()[n](c).reverse()}}),Yt(["filter","map","takeWhile"],function(n,o){var c=o+1,A=c==W||c==_;He.prototype[n]=function(M){var k=this.clone();return k.__iteratees__.push({iteratee:Te(M,3),type:c}),k.__filtered__=k.__filtered__||A,k}}),Yt(["head","last"],function(n,o){var c="take"+(o?"Right":"");He.prototype[n]=function(){return this[c](1).value()[0]}}),Yt(["initial","tail"],function(n,o){var c="drop"+(o?"":"Right");He.prototype[n]=function(){return this.__filtered__?new He(this):this[c](1)}}),He.prototype.compact=function(){return this.filter($t)},He.prototype.find=function(n){return this.filter(n).head()},He.prototype.findLast=function(n){return this.reverse().find(n)},He.prototype.invokeMap=Be(function(n,o){return typeof n=="function"?new He(this):this.map(function(c){return no(c,n,o)})}),He.prototype.reject=function(n){return this.filter(Js(Te(n)))},He.prototype.slice=function(n,o){n=Le(n);var c=this;return c.__filtered__&&(n>0||o<0)?new He(c):(n<0?c=c.takeRight(-n):n&&(c=c.drop(n)),o!==s&&(o=Le(o),c=o<0?c.dropRight(-o):c.take(o-n)),c)},He.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},He.prototype.toArray=function(){return this.take(ee)},bn(He.prototype,function(n,o){var c=/^(?:filter|find|map|reject)|While$/.test(o),A=/^(?:head|last)$/.test(o),M=D[A?"take"+(o=="last"?"Right":""):o],k=A||/^find/.test(o);!M||(D.prototype[o]=function(){var V=this.__wrapped__,J=A?[1]:arguments,Y=V instanceof He,se=J[0],ae=Y||xe(V),ue=function(ke){var ze=M.apply(D,Kn([ke],J));return A&&he?ze[0]:ze};ae&&c&&typeof se=="function"&&se.length!=1&&(Y=ae=!1);var he=this.__chain__,ye=!!this.__actions__.length,Oe=k&&!he,Fe=Y&&!ye;if(!k&&ae){V=Fe?V:new He(this);var we=n.apply(V,J);return we.__actions__.push({func:zs,args:[ue],thisArg:s}),new Xt(we,he)}return Oe&&Fe?n.apply(this,J):(we=this.thru(ue),Oe?A?we.value()[0]:we.value():we)})}),Yt(["pop","push","shift","sort","splice","unshift"],function(n){var o=gs[n],c=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",A=/^(?:pop|shift)$/.test(n);D.prototype[n]=function(){var M=arguments;if(A&&!this.__chain__){var k=this.value();return o.apply(xe(k)?k:[],M)}return this[c](function(V){return o.apply(xe(V)?V:[],M)})}}),bn(He.prototype,function(n,o){var c=D[o];if(c){var A=c.name+"";Xe.call(fi,A)||(fi[A]=[]),fi[A].push({name:o,func:c})}}),fi[Us(s,I).name]=[{name:"wrapper",func:s}],He.prototype.clone=r0,He.prototype.reverse=i0,He.prototype.value=o0,D.prototype.at=DE,D.prototype.chain=NE,D.prototype.commit=FE,D.prototype.next=UE,D.prototype.plant=kE,D.prototype.reverse=$E,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=HE,D.prototype.first=D.prototype.head,qi&&(D.prototype[qi]=BE),D},qn=Fy();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Tt._=qn,define(function(){return qn})):dr?((dr.exports=qn)._=qn,mu._=qn):Tt._=qn}).call(Ci)});var Pp=gt((yo,Ll)=>{U();(function(s,e){typeof yo=="object"&&typeof Ll=="object"?Ll.exports=e():typeof define=="function"&&define.amd?define([],e):typeof yo=="object"?yo.bowser=e():s.bowser=e()})(yo,function(){return function(s){var e={};function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=s,t.c=e,t.d=function(r,i,a){t.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,i){if(1&i&&(r=t(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var u in r)t.d(a,u,function(l){return r[l]}.bind(null,u));return a},t.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(i,"a",i),i},t.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},t.p="",t(t.s=90)}({17:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=t(18),i=function(){function a(){}return a.getFirstMatch=function(u,l){var f=l.match(u);return f&&f.length>0&&f[1]||""},a.getSecondMatch=function(u,l){var f=l.match(u);return f&&f.length>1&&f[2]||""},a.matchAndReturnConst=function(u,l,f){if(u.test(l))return f},a.getWindowsVersionName=function(u){switch(u){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},a.getMacOSVersionName=function(u){var l=u.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(l.push(0),l[0]===10)switch(l[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},a.getAndroidVersionName=function(u){var l=u.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(l.push(0),!(l[0]===1&&l[1]<5))return l[0]===1&&l[1]<6?"Cupcake":l[0]===1&&l[1]>=6?"Donut":l[0]===2&&l[1]<2?"Eclair":l[0]===2&&l[1]===2?"Froyo":l[0]===2&&l[1]>2?"Gingerbread":l[0]===3?"Honeycomb":l[0]===4&&l[1]<1?"Ice Cream Sandwich":l[0]===4&&l[1]<4?"Jelly Bean":l[0]===4&&l[1]>=4?"KitKat":l[0]===5?"Lollipop":l[0]===6?"Marshmallow":l[0]===7?"Nougat":l[0]===8?"Oreo":l[0]===9?"Pie":void 0},a.getVersionPrecision=function(u){return u.split(".").length},a.compareVersions=function(u,l,f){f===void 0&&(f=!1);var m=a.getVersionPrecision(u),b=a.getVersionPrecision(l),C=Math.max(m,b),h=0,E=a.map([u,l],function(w){var I=C-a.getVersionPrecision(w),S=w+new Array(I+1).join(".0");return a.map(S.split("."),function(T){return new Array(20-T.length).join("0")+T}).reverse()});for(f&&(h=C-Math.min(m,b)),C-=1;C>=h;){if(E[0][C]>E[1][C])return 1;if(E[0][C]===E[1][C]){if(C===h)return 0;C-=1}else if(E[0][C]<E[1][C])return-1}},a.map=function(u,l){var f,m=[];if(Array.prototype.map)return Array.prototype.map.call(u,l);for(f=0;f<u.length;f+=1)m.push(l(u[f]));return m},a.find=function(u,l){var f,m;if(Array.prototype.find)return Array.prototype.find.call(u,l);for(f=0,m=u.length;f<m;f+=1){var b=u[f];if(l(b,f))return b}},a.assign=function(u){for(var l,f,m=u,b=arguments.length,C=new Array(b>1?b-1:0),h=1;h<b;h++)C[h-1]=arguments[h];if(Object.assign)return Object.assign.apply(Object,[u].concat(C));var E=function(){var w=C[l];typeof w=="object"&&w!==null&&Object.keys(w).forEach(function(I){m[I]=w[I]})};for(l=0,f=C.length;l<f;l+=1)E();return u},a.getBrowserAlias=function(u){return r.BROWSER_ALIASES_MAP[u]},a.getBrowserTypeByAlias=function(u){return r.BROWSER_MAP[u]||""},a}();e.default=i,s.exports=e.default},18:function(s,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(91))&&r.__esModule?r:{default:r},a=t(18);function u(f,m){for(var b=0;b<m.length;b++){var C=m[b];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(f,C.key,C)}}var l=function(){function f(){}var m,b,C;return f.getParser=function(h,E){if(E===void 0&&(E=!1),typeof h!="string")throw new Error("UserAgent should be a string");return new i.default(h,E)},f.parse=function(h){return new i.default(h).getResult()},m=f,C=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(b=null)&&u(m.prototype,b),C&&u(m,C),f}();e.default=l,s.exports=e.default},91:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=f(t(92)),i=f(t(93)),a=f(t(94)),u=f(t(95)),l=f(t(17));function f(b){return b&&b.__esModule?b:{default:b}}var m=function(){function b(h,E){if(E===void 0&&(E=!1),h==null||h==="")throw new Error("UserAgent parameter can't be empty");this._ua=h,this.parsedResult={},E!==!0&&this.parse()}var C=b.prototype;return C.getUA=function(){return this._ua},C.test=function(h){return h.test(this._ua)},C.parseBrowser=function(){var h=this;this.parsedResult.browser={};var E=l.default.find(r.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(I){return h.test(I)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.browser=E.describe(this.getUA())),this.parsedResult.browser},C.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},C.getBrowserName=function(h){return h?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},C.getBrowserVersion=function(){return this.getBrowser().version},C.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},C.parseOS=function(){var h=this;this.parsedResult.os={};var E=l.default.find(i.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(I){return h.test(I)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.os=E.describe(this.getUA())),this.parsedResult.os},C.getOSName=function(h){var E=this.getOS().name;return h?String(E).toLowerCase()||"":E||""},C.getOSVersion=function(){return this.getOS().version},C.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},C.getPlatformType=function(h){h===void 0&&(h=!1);var E=this.getPlatform().type;return h?String(E).toLowerCase()||"":E||""},C.parsePlatform=function(){var h=this;this.parsedResult.platform={};var E=l.default.find(a.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(I){return h.test(I)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.platform=E.describe(this.getUA())),this.parsedResult.platform},C.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},C.getEngineName=function(h){return h?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},C.parseEngine=function(){var h=this;this.parsedResult.engine={};var E=l.default.find(u.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(I){return h.test(I)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.engine=E.describe(this.getUA())),this.parsedResult.engine},C.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},C.getResult=function(){return l.default.assign({},this.parsedResult)},C.satisfies=function(h){var E=this,w={},I=0,S={},T=0;if(Object.keys(h).forEach(function(R){var N=h[R];typeof N=="string"?(S[R]=N,T+=1):typeof N=="object"&&(w[R]=N,I+=1)}),I>0){var x=Object.keys(w),g=l.default.find(x,function(R){return E.isOS(R)});if(g){var y=this.satisfies(w[g]);if(y!==void 0)return y}var d=l.default.find(x,function(R){return E.isPlatform(R)});if(d){var p=this.satisfies(w[d]);if(p!==void 0)return p}}if(T>0){var O=Object.keys(S),v=l.default.find(O,function(R){return E.isBrowser(R,!0)});if(v!==void 0)return this.compareVersion(S[v])}},C.isBrowser=function(h,E){E===void 0&&(E=!1);var w=this.getBrowserName().toLowerCase(),I=h.toLowerCase(),S=l.default.getBrowserTypeByAlias(I);return E&&S&&(I=S.toLowerCase()),I===w},C.compareVersion=function(h){var E=[0],w=h,I=!1,S=this.getBrowserVersion();if(typeof S=="string")return h[0]===">"||h[0]==="<"?(w=h.substr(1),h[1]==="="?(I=!0,w=h.substr(2)):E=[],h[0]===">"?E.push(1):E.push(-1)):h[0]==="="?w=h.substr(1):h[0]==="~"&&(I=!0,w=h.substr(1)),E.indexOf(l.default.compareVersions(S,w,I))>-1},C.isOS=function(h){return this.getOSName(!0)===String(h).toLowerCase()},C.isPlatform=function(h){return this.getPlatformType(!0)===String(h).toLowerCase()},C.isEngine=function(h){return this.getEngineName(!0)===String(h).toLowerCase()},C.is=function(h,E){return E===void 0&&(E=!1),this.isBrowser(h,E)||this.isOS(h)||this.isPlatform(h)},C.some=function(h){var E=this;return h===void 0&&(h=[]),h.some(function(w){return E.is(w)})},b}();e.default=m,s.exports=e.default},92:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=/version\/(\d+(\.?_?\d+)+)/i,u=[{test:[/googlebot/i],describe:function(l){var f={name:"Googlebot"},m=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/opera/i],describe:function(l){var f={name:"Opera"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/opr\/|opios/i],describe:function(l){var f={name:"Opera"},m=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/SamsungBrowser/i],describe:function(l){var f={name:"Samsung Internet for Android"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/Whale/i],describe:function(l){var f={name:"NAVER Whale Browser"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/MZBrowser/i],describe:function(l){var f={name:"MZ Browser"},m=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/focus/i],describe:function(l){var f={name:"Focus"},m=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/swing/i],describe:function(l){var f={name:"Swing"},m=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/coast/i],describe:function(l){var f={name:"Opera Coast"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(l){var f={name:"Opera Touch"},m=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/yabrowser/i],describe:function(l){var f={name:"Yandex Browser"},m=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/ucbrowser/i],describe:function(l){var f={name:"UC Browser"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/Maxthon|mxios/i],describe:function(l){var f={name:"Maxthon"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/epiphany/i],describe:function(l){var f={name:"Epiphany"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/puffin/i],describe:function(l){var f={name:"Puffin"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/sleipnir/i],describe:function(l){var f={name:"Sleipnir"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/k-meleon/i],describe:function(l){var f={name:"K-Meleon"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/micromessenger/i],describe:function(l){var f={name:"WeChat"},m=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/qqbrowser/i],describe:function(l){var f={name:/qqbrowserlite/i.test(l)?"QQ Browser Lite":"QQ Browser"},m=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/msie|trident/i],describe:function(l){var f={name:"Internet Explorer"},m=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/\sedg\//i],describe:function(l){var f={name:"Microsoft Edge"},m=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/edg([ea]|ios)/i],describe:function(l){var f={name:"Microsoft Edge"},m=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/vivaldi/i],describe:function(l){var f={name:"Vivaldi"},m=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/seamonkey/i],describe:function(l){var f={name:"SeaMonkey"},m=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/sailfish/i],describe:function(l){var f={name:"Sailfish"},m=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,l);return m&&(f.version=m),f}},{test:[/silk/i],describe:function(l){var f={name:"Amazon Silk"},m=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/phantom/i],describe:function(l){var f={name:"PhantomJS"},m=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/slimerjs/i],describe:function(l){var f={name:"SlimerJS"},m=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var f={name:"BlackBerry"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var f={name:"WebOS Browser"},m=i.default.getFirstMatch(a,l)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/bada/i],describe:function(l){var f={name:"Bada"},m=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/tizen/i],describe:function(l){var f={name:"Tizen"},m=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/qupzilla/i],describe:function(l){var f={name:"QupZilla"},m=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(l){var f={name:"Firefox"},m=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/electron/i],describe:function(l){var f={name:"Electron"},m=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/MiuiBrowser/i],describe:function(l){var f={name:"Miui"},m=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/chromium/i],describe:function(l){var f={name:"Chromium"},m=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,l)||i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/chrome|crios|crmo/i],describe:function(l){var f={name:"Chrome"},m=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/GSA/i],describe:function(l){var f={name:"Google Search"},m=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:function(l){var f=!l.test(/like android/i),m=l.test(/android/i);return f&&m},describe:function(l){var f={name:"Android Browser"},m=i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/playstation 4/i],describe:function(l){var f={name:"PlayStation 4"},m=i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/safari|applewebkit/i],describe:function(l){var f={name:"Safari"},m=i.default.getFirstMatch(a,l);return m&&(f.version=m),f}},{test:[/.*/i],describe:function(l){var f=l.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(f,l),version:i.default.getSecondMatch(f,l)}}}];e.default=u,s.exports=e.default},93:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),u=[{test:[/Roku\/DVP/],describe:function(l){var f=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,l);return{name:a.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(l){var f=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,l);return{name:a.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(l){var f=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,l),m=i.default.getWindowsVersionName(f);return{name:a.OS_MAP.Windows,version:f,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(l){var f={name:a.OS_MAP.iOS},m=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,l);return m&&(f.version=m),f}},{test:[/macintosh/i],describe:function(l){var f=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,l).replace(/[_\s]/g,"."),m=i.default.getMacOSVersionName(f),b={name:a.OS_MAP.MacOS,version:f};return m&&(b.versionName=m),b}},{test:[/(ipod|iphone|ipad)/i],describe:function(l){var f=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,l).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:f}}},{test:function(l){var f=!l.test(/like android/i),m=l.test(/android/i);return f&&m},describe:function(l){var f=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,l),m=i.default.getAndroidVersionName(f),b={name:a.OS_MAP.Android,version:f};return m&&(b.versionName=m),b}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var f=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,l),m={name:a.OS_MAP.WebOS};return f&&f.length&&(m.version=f),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var f=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,l)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,l)||i.default.getFirstMatch(/\bbb(\d+)/i,l);return{name:a.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(l){var f=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,l);return{name:a.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(l){var f=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,l);return{name:a.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(l){var f=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,l);return{name:a.OS_MAP.PlayStation4,version:f}}}];e.default=u,s.exports=e.default},94:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),u=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(l){var f=i.default.getFirstMatch(/(can-l01)/i,l)&&"Nova",m={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(m.model=f),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(l){var f=l.test(/ipod|iphone/i),m=l.test(/like (ipod|iphone)/i);return f&&!m},describe:function(l){var f=i.default.getFirstMatch(/(ipod|iphone)/i,l);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName(!0)==="blackberry"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(l){return l.getBrowserName(!0)==="bada"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName()==="windows phone"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(l){var f=Number(String(l.getOSVersion()).split(".")[0]);return l.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(l){return l.getOSName(!0)==="android"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getOSName(!0)==="macos"},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(l){return l.getOSName(!0)==="windows"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="linux"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="playstation 4"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(l){return l.getOSName(!0)==="roku"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];e.default=u,s.exports=e.default},95:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,i=(r=t(17))&&r.__esModule?r:{default:r},a=t(18),u=[{test:function(l){return l.getBrowserName(!0)==="microsoft edge"},describe:function(l){if(/\sedg\//i.test(l))return{name:a.ENGINE_MAP.Blink};var f=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,l);return{name:a.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(l){var f={name:a.ENGINE_MAP.Trident},m=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:function(l){return l.test(/presto/i)},describe:function(l){var f={name:a.ENGINE_MAP.Presto},m=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:function(l){var f=l.test(/gecko/i),m=l.test(/like gecko/i);return f&&!m},describe:function(l){var f={name:a.ENGINE_MAP.Gecko},m=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(l){var f={name:a.ENGINE_MAP.WebKit},m=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,l);return m&&(f.version=m),f}}];e.default=u,s.exports=e.default}})})});var Np={};Vh(Np,{version:()=>rO});var rO,Fp=Cl(()=>{U();rO="lab"});var Up={};Vh(Up,{default:()=>iO});var iO,Bp=Cl(()=>{U();iO={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var kp=gt((va,Nl)=>{U();(function(e,t){typeof va=="object"&&typeof Nl=="object"?Nl.exports=t():typeof define=="function"&&define.amd?define([],t):typeof va=="object"?va.Ably=t():e.Ably=t()})(window,function(){return function(s){var e={};function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=s,t.c=e,t.d=function(r,i,a){t.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,i){if(i&1&&(r=t(r)),i&8||i&4&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),i&2&&typeof r!="string")for(var u in r)t.d(a,u,function(l){return r[l]}.bind(null,u));return a},t.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(i,"a",i),i},t.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},t.p="",t(t.s=42)}([function(s,e,t){"use strict";t.r(e),t.d(e,"__extends",function(){return i}),t.d(e,"__assign",function(){return a}),t.d(e,"__rest",function(){return u}),t.d(e,"__decorate",function(){return l}),t.d(e,"__param",function(){return f}),t.d(e,"__metadata",function(){return m}),t.d(e,"__awaiter",function(){return b}),t.d(e,"__generator",function(){return C}),t.d(e,"__createBinding",function(){return h}),t.d(e,"__exportStar",function(){return E}),t.d(e,"__values",function(){return w}),t.d(e,"__read",function(){return I}),t.d(e,"__spread",function(){return S}),t.d(e,"__spreadArrays",function(){return T}),t.d(e,"__spreadArray",function(){return x}),t.d(e,"__await",function(){return g}),t.d(e,"__asyncGenerator",function(){return y}),t.d(e,"__asyncDelegator",function(){return d}),t.d(e,"__asyncValues",function(){return p}),t.d(e,"__makeTemplateObject",function(){return O}),t.d(e,"__importStar",function(){return R}),t.d(e,"__importDefault",function(){return N}),t.d(e,"__classPrivateFieldGet",function(){return z}),t.d(e,"__classPrivateFieldSet",function(){return W});var r=function(F,_){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,$){L.__proto__=$}||function(L,$){for(var G in $)Object.prototype.hasOwnProperty.call($,G)&&(L[G]=$[G])},r(F,_)};function i(F,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");r(F,_);function L(){this.constructor=F}F.prototype=_===null?Object.create(_):(L.prototype=_.prototype,new L)}var a=function(){return a=Object.assign||function(_){for(var L,$=1,G=arguments.length;$<G;$++){L=arguments[$];for(var K in L)Object.prototype.hasOwnProperty.call(L,K)&&(_[K]=L[K])}return _},a.apply(this,arguments)};function u(F,_){var L={};for(var $ in F)Object.prototype.hasOwnProperty.call(F,$)&&_.indexOf($)<0&&(L[$]=F[$]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,$=Object.getOwnPropertySymbols(F);G<$.length;G++)_.indexOf($[G])<0&&Object.prototype.propertyIsEnumerable.call(F,$[G])&&(L[$[G]]=F[$[G]]);return L}function l(F,_,L,$){var G=arguments.length,K=G<3?_:$===null?$=Object.getOwnPropertyDescriptor(_,L):$,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(F,_,L,$);else for(var re=F.length-1;re>=0;re--)(ee=F[re])&&(K=(G<3?ee(K):G>3?ee(_,L,K):ee(_,L))||K);return G>3&&K&&Object.defineProperty(_,L,K),K}function f(F,_){return function(L,$){_(L,$,F)}}function m(F,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(F,_)}function b(F,_,L,$){function G(K){return K instanceof L?K:new L(function(ee){ee(K)})}return new(L||(L=Promise))(function(K,ee){function re(B){try{P($.next(B))}catch(H){ee(H)}}function X(B){try{P($.throw(B))}catch(H){ee(H)}}function P(B){B.done?K(B.value):G(B.value).then(re,X)}P(($=$.apply(F,_||[])).next())})}function C(F,_){var L={label:0,sent:function(){if(K[0]&1)throw K[1];return K[1]},trys:[],ops:[]},$,G,K,ee;return ee={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function re(P){return function(B){return X([P,B])}}function X(P){if($)throw new TypeError("Generator is already executing.");for(;L;)try{if($=1,G&&(K=P[0]&2?G.return:P[0]?G.throw||((K=G.return)&&K.call(G),0):G.next)&&!(K=K.call(G,P[1])).done)return K;switch(G=0,K&&(P=[P[0]&2,K.value]),P[0]){case 0:case 1:K=P;break;case 4:return L.label++,{value:P[1],done:!1};case 5:L.label++,G=P[1],P=[0];continue;case 7:P=L.ops.pop(),L.trys.pop();continue;default:if(K=L.trys,!(K=K.length>0&&K[K.length-1])&&(P[0]===6||P[0]===2)){L=0;continue}if(P[0]===3&&(!K||P[1]>K[0]&&P[1]<K[3])){L.label=P[1];break}if(P[0]===6&&L.label<K[1]){L.label=K[1],K=P;break}if(K&&L.label<K[2]){L.label=K[2],L.ops.push(P);break}K[2]&&L.ops.pop(),L.trys.pop();continue}P=_.call(F,L)}catch(B){P=[6,B],G=0}finally{$=K=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}}var h=Object.create?function(F,_,L,$){$===void 0&&($=L),Object.defineProperty(F,$,{enumerable:!0,get:function(){return _[L]}})}:function(F,_,L,$){$===void 0&&($=L),F[$]=_[L]};function E(F,_){for(var L in F)L!=="default"&&!Object.prototype.hasOwnProperty.call(_,L)&&h(_,F,L)}function w(F){var _=typeof Symbol=="function"&&Symbol.iterator,L=_&&F[_],$=0;if(L)return L.call(F);if(F&&typeof F.length=="number")return{next:function(){return F&&$>=F.length&&(F=void 0),{value:F&&F[$++],done:!F}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")}function I(F,_){var L=typeof Symbol=="function"&&F[Symbol.iterator];if(!L)return F;var $=L.call(F),G,K=[],ee;try{for(;(_===void 0||_-- >0)&&!(G=$.next()).done;)K.push(G.value)}catch(re){ee={error:re}}finally{try{G&&!G.done&&(L=$.return)&&L.call($)}finally{if(ee)throw ee.error}}return K}function S(){for(var F=[],_=0;_<arguments.length;_++)F=F.concat(I(arguments[_]));return F}function T(){for(var F=0,_=0,L=arguments.length;_<L;_++)F+=arguments[_].length;for(var $=Array(F),G=0,_=0;_<L;_++)for(var K=arguments[_],ee=0,re=K.length;ee<re;ee++,G++)$[G]=K[ee];return $}function x(F,_,L){if(L||arguments.length===2)for(var $=0,G=_.length,K;$<G;$++)(K||!($ in _))&&(K||(K=Array.prototype.slice.call(_,0,$)),K[$]=_[$]);return F.concat(K||Array.prototype.slice.call(_))}function g(F){return this instanceof g?(this.v=F,this):new g(F)}function y(F,_,L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=L.apply(F,_||[]),G,K=[];return G={},ee("next"),ee("throw"),ee("return"),G[Symbol.asyncIterator]=function(){return this},G;function ee(j){$[j]&&(G[j]=function(te){return new Promise(function(ce,me){K.push([j,te,ce,me])>1||re(j,te)})})}function re(j,te){try{X($[j](te))}catch(ce){H(K[0][3],ce)}}function X(j){j.value instanceof g?Promise.resolve(j.value.v).then(P,B):H(K[0][2],j)}function P(j){re("next",j)}function B(j){re("throw",j)}function H(j,te){j(te),K.shift(),K.length&&re(K[0][0],K[0][1])}}function d(F){var _,L;return _={},$("next"),$("throw",function(G){throw G}),$("return"),_[Symbol.iterator]=function(){return this},_;function $(G,K){_[G]=F[G]?function(ee){return(L=!L)?{value:g(F[G](ee)),done:G==="return"}:K?K(ee):ee}:K}}function p(F){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=F[Symbol.asyncIterator],L;return _?_.call(F):(F=typeof w=="function"?w(F):F[Symbol.iterator](),L={},$("next"),$("throw"),$("return"),L[Symbol.asyncIterator]=function(){return this},L);function $(K){L[K]=F[K]&&function(ee){return new Promise(function(re,X){ee=F[K](ee),G(re,X,ee.done,ee.value)})}}function G(K,ee,re,X){Promise.resolve(X).then(function(P){K({value:P,done:re})},ee)}}function O(F,_){return Object.defineProperty?Object.defineProperty(F,"raw",{value:_}):F.raw=_,F}var v=Object.create?function(F,_){Object.defineProperty(F,"default",{enumerable:!0,value:_})}:function(F,_){F.default=_};function R(F){if(F&&F.__esModule)return F;var _={};if(F!=null)for(var L in F)L!=="default"&&Object.prototype.hasOwnProperty.call(F,L)&&h(_,F,L);return v(_,F),_}function N(F){return F&&F.__esModule?F:{default:F}}function z(F,_,L,$){if(L==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?F!==_||!$:!_.has(F))throw new TypeError("Cannot read private member from an object whose class did not declare it");return L==="m"?$:L==="a"?$.call(F):$?$.value:_.get(F)}function W(F,_,L,$,G){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?F!==_||!G:!_.has(F))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?G.call(F,L):G?G.value=L:_.set(F,L),L}},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var i=t(0),a=i.__importDefault(t(3)),u=i.__importStar(t(8)),l=i.__importDefault(t(4)),f=t(11),m=t(31);function b(q){return Math.floor(Math.random()*q.length)}function C(q){for(var oe=[],le=1;le<arguments.length;le++)oe[le-1]=arguments[le];for(var ve=0;ve<oe.length;ve++){var Ne=oe[ve];if(!Ne)break;var St=Object.prototype.hasOwnProperty;for(var In in Ne)(!St||St.call(Ne,In))&&(q[In]=Ne[In])}return q}e.mixin=C;function h(q){return C({},q)}e.copy=h,e.isArray=Array.isArray||function(q){return Object.prototype.toString.call(q)=="[object Array]"};function E(q){return T(q)?[]:(0,e.isArray)(q)?q:[q]}e.ensureArray=E;function w(q){return Object.prototype.toString.call(q)=="[object Object]"}e.isObject=w;function I(q){for(var oe in q)return!1;return!0}e.isEmpty=I;function S(q,oe){for(var le in q)if(le!==oe)return!1;return!0}e.isOnlyPropIn=S;function T(q){return q==null}e.isEmptyArg=T;function x(q){var oe=new Object;for(var le in q)oe[le]=q[le];return oe}e.shallowClone=x;function g(q,oe){var le=function(){function Ne(){}return Ne}();le.prototype=q;var ve=new le;return oe&&C(ve,oe),ve}e.prototypicalClone=g;var y=function(q,oe){if(a.default.Config.inherits){a.default.Config.inherits(q,oe);return}q.super_=oe,q.prototype=g(oe.prototype,{constructor:q})};e.inherits=y;function d(q,oe){for(var le in q)if(q[le]==oe)return!0;return!1}e.containsValue=d;function p(q,oe){return(0,e.isArray)(oe)?O(q,oe):v(q,oe)}e.intersect=p;function O(q,oe){for(var le=[],ve=0;ve<q.length;ve++){var Ne=q[ve];(0,e.arrIndexOf)(oe,Ne)!=-1&&le.push(Ne)}return le}e.arrIntersect=O;function v(q,oe){for(var le=[],ve=0;ve<q.length;ve++){var Ne=q[ve];Ne in oe&&le.push(Ne)}return le}e.arrIntersectOb=v;function R(q,oe){for(var le=[],ve=0;ve<q.length;ve++){var Ne=q[ve];(0,e.arrIndexOf)(oe,Ne)==-1&&le.push(Ne)}return le}e.arrSubtract=R,e.arrIndexOf=Array.prototype.indexOf?function(q,oe,le){return q.indexOf(oe,le)}:function(q,oe,le){le=le||0;for(var ve=q.length;le<ve;le++)if(q[le]===oe)return le;return-1};function N(q,oe){return(0,e.arrIndexOf)(q,oe)!==-1}e.arrIn=N;function z(q,oe){var le=(0,e.arrIndexOf)(q,oe),ve=le!=-1;return ve&&q.splice(le,1),ve}e.arrDeleteValue=z;function W(q,oe){var le=q.slice();return z(le,oe),le}e.arrWithoutValue=W;function F(q,oe){var le=[];for(var ve in q)oe&&!Object.prototype.hasOwnProperty.call(q,ve)||le.push(ve);return le}e.keysArray=F;function _(q,oe){var le=[];for(var ve in q)oe&&!Object.prototype.hasOwnProperty.call(q,ve)||le.push(q[ve]);return le}e.valuesArray=_;function L(q,oe){for(var le in q)Object.prototype.hasOwnProperty.call(q,le)&&q[le]&&oe(le)}e.forInOwnNonNullProperties=L,e.arrForEach=Array.prototype.forEach?function(q,oe){q.forEach(oe)}:function(q,oe){for(var le=q.length,ve=0;ve<le;ve++)oe(q[ve],ve,q)};function $(q,oe){return(0,e.arrForEach)(q.slice(),oe)}e.safeArrForEach=$,e.arrMap=Array.prototype.map?function(q,oe){return q.map(oe)}:function(q,oe){for(var le=[],ve=q.length,Ne=0;Ne<ve;Ne++)le.push(oe(q[Ne],Ne,q));return le},e.arrFilter=Array.prototype.filter?function(q,oe){return q.filter(oe)}:function(q,oe){for(var le=[],ve=q.length,Ne=0;Ne<ve;Ne++)oe(q[Ne])&&le.push(q[Ne]);return le},e.arrEvery=Array.prototype.every?function(q,oe){return q.every(oe)}:function(q,oe){for(var le=q.length,ve=0;ve<le;ve++)if(!oe(q[ve],ve,q))return!1;return!0};function G(q,oe){if(q.length===0)return!0;var le=q[0][oe];return(0,e.arrEvery)(q,function(ve){return ve[oe]===le})}e.allSame=G;var K={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function ee(q,oe){var le=K[oe||Ze.json];return{accept:le,"X-Ably-Version":u.default.protocolVersion.toString(),"Ably-Agent":(0,u.getAgentString)(q)}}e.defaultGetHeaders=ee;function re(q,oe){var le,ve=le=K[oe||Ze.json];return{accept:ve,"content-type":le,"X-Ably-Version":u.default.protocolVersion.toString(),"Ably-Agent":(0,u.getAgentString)(q)}}e.defaultPostHeaders=re;function X(q){return q.splice(b(q),1)[0]}e.arrPopRandomElement=X;function P(q){var oe=[];if(q)for(var le in q)oe.push(encodeURIComponent(le)+"="+encodeURIComponent(q[le]));return oe.length?"?"+oe.join("&"):""}e.toQueryString=P;function B(q){for(var oe,le=/([^?&=]+)=?([^&]*)/g,ve={};oe=le.exec(q);)ve[decodeURIComponent(oe[1])]=decodeURIComponent(oe[2]);return ve}e.parseQueryString=B,e.now=Date.now||function(){return new Date().getTime()};function H(q){return typeof q=="object"&&q!==null&&(q.constructor.name=="ErrorInfo"||q.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=H;function j(q){var oe,le;return q instanceof Error||((oe=q==null?void 0:q.constructor)===null||oe===void 0?void 0:oe.name)==="ErrorInfo"||((le=q==null?void 0:q.constructor)===null||le===void 0?void 0:le.name)==="PartialErrorInfo"?q.toString():a.default.Config.inspect(q)}e.inspectError=j;function te(q){return a.default.BufferUtils.isBuffer(q)?q.toString():typeof q=="string"?q:a.default.Config.inspect(q)}e.inspectBody=te;function ce(q){if(a.default.BufferUtils.isBuffer(q))return a.default.BufferUtils.byteLength(q);if(typeof q=="string")return a.default.Config.stringByteSize(q);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof q)}e.dataSizeBytes=ce;function me(){return String(Math.random()).substr(2)}e.cheapRandStr=me;var be=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(q);return a.default.Config.getRandomValues(oe),a.default.BufferUtils.base64Encode(oe)}for(var le=a.default.BufferUtils.base64CharSet,ve=Math.round(q*4/3),Ne="",St=0;St<ve;St++)Ne+=le[b(le)];return Ne};e.randomString=be;var Se=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(q);return a.default.Config.getRandomValues(oe),a.default.BufferUtils.hexEncode(oe)}for(var le=a.default.BufferUtils.hexCharSet,ve=q*2,Ne="",St=0;St<ve;St++)Ne+=le[b(le)];return Ne};e.randomHexString=Se;function $e(q,oe){for(var le=Math.min(oe,q.length),ve=q.slice(),Ne=[],St=0;St<le;St++)Ne.push(X(ve));return Ne}e.arrChooseN=$e,e.trim=String.prototype.trim?function(q){return q.trim()}:function(q){return q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function de(q,oe,le){return new Promise(function(ve,Ne){q[oe].apply(q,i.__spreadArray(i.__spreadArray([],le,!1),[function(St,In){St?Ne(St):ve(In)}],!1))})}e.promisify=de;var Ze;(function(q){q.msgpack="msgpack",q.json="json"})(Ze=e.Format||(e.Format={}));function bt(q,oe){return oe=="msgpack"?a.default.Config.msgpack.decode(q):JSON.parse(String(q))}e.decodeBody=bt;function it(q,oe){return oe=="msgpack"?a.default.Config.msgpack.encode(q,!0):JSON.stringify(q)}e.encodeBody=it;function dt(q){return q.map(function(oe){return oe&&oe.toLowerCase()})}e.allToLowerCase=dt;function un(q){return q.map(function(oe){return oe&&oe.toUpperCase()})}e.allToUpperCase=un;function vn(q){return Math.min((q+2)/3,2)}e.getBackoffCoefficient=vn;function at(){return 1-Math.random()*.2}e.getJitterCoefficient=at;function yn(q,oe){return q*vn(oe)*at()}e.getRetryTime=yn;function Vn(){return r||(typeof window!="undefined"?window:self)}e.getGlobalObject=Vn;function Ki(q,oe){return Object.keys(q).every(function(le){return q[le]===oe[le]})&&Object.keys(oe).every(function(le){return oe[le]===q[le]})}e.shallowEquals=Ki;function fr(q){var oe=/^(\[([^?]*)(?:(.*))\])?(.+)$/,le=q.match(oe);if(!le||!le.length||le.length<5)throw new l.default("regex match failed",400,40010);if(le[2])throw new l.default("cannot use a derived option with a ".concat(le[2]," channel"),400,40010);return{qualifierParam:le[3]||"",channelName:le[4]}}e.matchDerivedChannel=fr;function ru(q){return a.default.Config.createHmac?Buffer.from(q,"ascii").toString("base64"):(0,f.stringify)((0,m.parse)(q))}e.toBase64=ru}).call(this,t(13))},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importDefault(t(3)),u=r||(typeof window!="undefined"?window:self),l;(function(h){h[h.None=0]="None",h[h.Error=1]="Error",h[h.Major=2]="Major",h[h.Minor=3]="Minor",h[h.Micro=4]="Micro"})(l||(l={}));function f(h,E){return"".concat(h).padStart(E?3:2,"0")}function m(h){return a.default.Config.logTimestamps?function(E){var w=new Date;h(f(w.getHours())+":"+f(w.getMinutes())+":"+f(w.getSeconds())+"."+f(w.getMilliseconds(),1)+" "+E)}:h}var b=function(){var h,E,w,I;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((E=(h=u==null?void 0:u.console)===null||h===void 0?void 0:h.log)===null||E===void 0?void 0:E.apply)=="function"?(w=function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T]},I=console.warn?function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T]}:w):u!=null&&u.console.log?w=I=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=I=function(){},[w,I].map(m)},C=function(){function h(){h.logLevel=h.LOG_DEFAULT}return h.initLogHandlers=function(){var E=b(),w=E[0],I=E[1];this.logHandler=w,this.logErrorHandler=I},h.logLevel=l.Error,h.LOG_NONE=l.None,h.LOG_ERROR=l.Error,h.LOG_MAJOR=l.Major,h.LOG_MINOR=l.Minor,h.LOG_MICRO=l.Micro,h.LOG_DEFAULT=l.Error,h.LOG_DEBUG=l.Micro,h.logAction=function(E,w,I){h.shouldLog(E)&&(E===l.Error?h.logErrorHandler:h.logHandler)("Ably: "+w+": "+I)},h.deprecated=function(E,w){h.deprecatedWithMsg(E,"Please use '"+w+"' instead.")},h.deprecatedWithMsg=function(E,w){h.shouldLog(l.Error)&&h.logErrorHandler("Ably: Deprecation warning - '"+E+"' is deprecated and will be removed from a future version. "+w)},h.shouldLog=function(E){return E<=h.logLevel},h.setLog=function(E,w){E!==void 0&&(h.logLevel=E),w!==void 0&&(h.logHandler=h.logErrorHandler=w)},h}();e.default=C}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(){}return i}();e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1));function u(m){var b="["+m.constructor.name;return m.message&&(b+=": "+m.message),m.statusCode&&(b+="; statusCode="+m.statusCode),m.code&&(b+="; code="+m.code),m.cause&&(b+="; cause="+a.inspectError(m.cause)),m.href&&!(m.message&&m.message.indexOf("help.ably.io")>-1)&&(b+="; see "+m.href+" "),b+="]",b}var l=function(m){r.__extends(b,m);function b(C,h,E,w){var I=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(I,b.prototype),I.code=h,I.statusCode=E,I.cause=w,I}return b.prototype.toString=function(){return u(this)},b.fromValues=function(C){var h=C,E=h.message,w=h.code,I=h.statusCode;if(typeof E!="string"||typeof w!="number"||typeof I!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(C));var S=Object.assign(new b(E,w,I),C);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S},b}(Error);e.default=l;var f=function(m){r.__extends(b,m);function b(C,h,E,w){var I=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(I,b.prototype),I.code=h,I.statusCode=E,I.cause=w,I}return b.prototype.toString=function(){return u(this)},b}(Error);e.PartialErrorInfo=f},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){if(typeof ArrayBuffer=="function"){var i=r,a=i.lib,u=a.WordArray,l=u.init,f=u.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var b=m.byteLength,C=[],h=0;h<b;h++)C[h>>>2]|=m[h]<<24-h%4*8;l.call(this,C,b)}else l.apply(this,arguments)};f.prototype=u}}(),r.lib.WordArray})},function(s,e,t){(function(r){(function(i,a){s.exports=e=a()})(this,function(){var i=i||function(a,u){var l;if(typeof window!="undefined"&&window.crypto&&(l=window.crypto),!l&&typeof window!="undefined"&&window.msCrypto&&(l=window.msCrypto),!l&&typeof r!="undefined"&&r.crypto&&(l=r.crypto),!l)try{l=t(44)}catch(d){}var f=function(){if(l){if(typeof l.getRandomValues=="function")try{return l.getRandomValues(new Uint32Array(1))[0]}catch(d){}if(typeof l.randomBytes=="function")try{return l.randomBytes(4).readInt32LE()}catch(d){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function d(){}return function(p){var O;return d.prototype=p,O=new d,d.prototype=null,O}}(),b={},C=b.lib={},h=C.Base=function(){return{extend:function(d){var p=m(this);return d&&p.mixIn(d),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var p in d)d.hasOwnProperty(p)&&(this[p]=d[p]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=C.WordArray=h.extend({init:function(d,p){d=this.words=d||[],p!=u?this.sigBytes=p:this.sigBytes=d.length*4},toString:function(d){return(d||I).stringify(this)},concat:function(d){var p=this.words,O=d.words,v=this.sigBytes,R=d.sigBytes;if(this.clamp(),v%4)for(var N=0;N<R;N++){var z=O[N>>>2]>>>24-N%4*8&255;p[v+N>>>2]|=z<<24-(v+N)%4*8}else for(var N=0;N<R;N+=4)p[v+N>>>2]=O[N>>>2];return this.sigBytes+=R,this},clamp:function(){var d=this.words,p=this.sigBytes;d[p>>>2]&=4294967295<<32-p%4*8,d.length=a.ceil(p/4)},clone:function(){var d=h.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var p=[],O=0;O<d;O+=4)p.push(f());return new E.init(p,d)}}),w=b.enc={},I=w.Hex={stringify:function(d){for(var p=d.words,O=d.sigBytes,v=[],R=0;R<O;R++){var N=p[R>>>2]>>>24-R%4*8&255;v.push((N>>>4).toString(16)),v.push((N&15).toString(16))}return v.join("")},parse:function(d){for(var p=d.length,O=[],v=0;v<p;v+=2)O[v>>>3]|=parseInt(d.substr(v,2),16)<<24-v%8*4;return new E.init(O,p/2)}},S=w.Latin1={stringify:function(d){for(var p=d.words,O=d.sigBytes,v=[],R=0;R<O;R++){var N=p[R>>>2]>>>24-R%4*8&255;v.push(String.fromCharCode(N))}return v.join("")},parse:function(d){for(var p=d.length,O=[],v=0;v<p;v++)O[v>>>2]|=(d.charCodeAt(v)&255)<<24-v%4*8;return new E.init(O,p)}},T=w.Utf8={stringify:function(d){try{return decodeURIComponent(escape(S.stringify(d)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(d){return S.parse(unescape(encodeURIComponent(d)))}},x=C.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=T.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var p,O=this._data,v=O.words,R=O.sigBytes,N=this.blockSize,z=N*4,W=R/z;d?W=a.ceil(W):W=a.max((W|0)-this._minBufferSize,0);var F=W*N,_=a.min(F*4,R);if(F){for(var L=0;L<F;L+=N)this._doProcessBlock(v,L);p=v.splice(0,F),O.sigBytes-=_}return new E.init(p,_)},clone:function(){var d=h.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0}),g=C.Hasher=x.extend({cfg:h.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(d){return function(p,O){return new d.init(O).finalize(p)}},_createHmacHelper:function(d){return function(p,O){return new y.HMAC.init(d,O).finalize(p)}}}),y=b.algo={};return b}(Math);return i})}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),u=r.__importDefault(t(3));function l(b,C,h){try{C.apply(b,h)}catch(E){a.default.logAction(a.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function f(b,C,h){for(var E,w,I,S=0;S<b.length;S++)if(E=b[S],h&&(E=E[h]),i.isArray(E)){for(;(w=i.arrIndexOf(E,C))!==-1;)E.splice(w,1);h&&E.length===0&&delete b[S][h]}else if(i.isObject(E))for(I in E)Object.prototype.hasOwnProperty.call(E,I)&&i.isArray(E[I])&&f([E],C,I)}var m=function(){function b(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return b.prototype.on=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];if(h.length===1){var w=h[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+u.default.Config.inspect(h))}if(h.length===2){var I=h[0],S=h[1];if(typeof S!="function")throw new Error("EventListener.on(): Invalid arguments: "+u.default.Config.inspect(h));if(i.isEmptyArg(I))this.any.push(S);else if(i.isArray(I))I.forEach(function(x){C.on(x,S)});else{if(typeof I!="string")throw new Error("EventListener.on(): Invalid arguments: "+u.default.Config.inspect(h));var T=this.events[I]||(this.events[I]=[]);T.push(S)}}},b.prototype.off=function(){for(var C,h=this,E=[],w=0;w<arguments.length;w++)E[w]=arguments[w];if(E.length==0||i.isEmptyArg(E[0])&&i.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var I=E[0],S=E[1],T=null,x=null;if(E.length===1||!S)typeof I=="function"?T=I:x=I;else{if(typeof S!="function")throw new Error("EventEmitter.off(): invalid arguments:"+u.default.Config.inspect(E));C=[I,S],x=C[0],T=C[1]}if(T&&i.isEmptyArg(x)){f([this.any,this.events,this.anyOnce,this.eventsOnce],T);return}if(i.isArray(x)){x.forEach(function(g){h.off(g,T)});return}if(typeof x!="string")throw new Error("EventEmitter.off(): invalid arguments:"+u.default.Config.inspect(E));T?f([this.events,this.eventsOnce],T,x):(delete this.events[x],delete this.eventsOnce[x])},b.prototype.listeners=function(C){if(C){var h=this.events[C]||[];return this.eventsOnce[C]&&Array.prototype.push.apply(h,this.eventsOnce[C]),h.length?h:null}return this.any.length?this.any:null},b.prototype.emit=function(C){for(var h=[],E=1;E<arguments.length;E++)h[E-1]=arguments[E];var w={event:C},I=[];this.anyOnce.length&&(Array.prototype.push.apply(I,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(I,this.any);var S=this.eventsOnce[C];S&&(Array.prototype.push.apply(I,S),delete this.eventsOnce[C]);var T=this.events[C];T&&Array.prototype.push.apply(I,T),i.arrForEach(I,function(x){l(w,x,h)})},b.prototype.once=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];var w=h.length;if((w===0||w===1&&typeof h[0]!="function")&&u.default.Config.Promise){var I=h[0];return new u.default.Config.Promise(function(d){C.once(I,d)})}var S=h[0],T=h[1];if(h.length===1&&typeof S=="function")this.anyOnce.push(S);else if(i.isEmptyArg(S)){if(typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+u.default.Config.inspect(h));this.anyOnce.push(T)}else if(i.isArray(S)){var x=this,g=function(){var d=Array.prototype.slice.call(arguments);if(i.arrForEach(S,function(p){x.off(p,g)}),typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+u.default.Config.inspect(h));T.apply(this,d)};i.arrForEach(S,function(d){x.on(d,g)})}else{if(typeof S!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+u.default.Config.inspect(h));var y=this.eventsOnce[S]||(this.eventsOnce[S]=[]);if(T){if(typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+u.default.Config.inspect(h));y.push(T)}}},b.prototype.whenState=function(C,h,E){for(var w=this,I=[],S=3;S<arguments.length;S++)I[S-3]=arguments[S];var T={event:C};if(typeof C!="string"||typeof h!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&u.default.Config.Promise)return new u.default.Config.Promise(function(x){b.prototype.whenState.apply(w,[C,h,x].concat(I))});C===h?l(T,E,I):this.once(C,E)},b}();e.default=m},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),u=r.__importDefault(t(2)),l=r.__importDefault(t(4)),f=t(43),m="ably-js/"+f.version,b={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:f.version,protocolVersion:2,agent:m,getHost:C,getPort:h,getHttpScheme:E,environmentFallbackHosts:w,getFallbackHosts:I,getHosts:S,checkHost:T,objectifyOptions:d,normaliseOptions:p};function C(v,R,N){return N?R=R==v.restHost&&v.realtimeHost||R||v.realtimeHost:R=R||v.restHost,R}e.getHost=C;function h(v,R){return R||v.tls?v.tlsPort:v.port}e.getPort=h;function E(v){return v.tls?"https://":"http://"}e.getHttpScheme=E;function w(v){return[v+"-a-fallback.ably-realtime.com",v+"-b-fallback.ably-realtime.com",v+"-c-fallback.ably-realtime.com",v+"-d-fallback.ably-realtime.com",v+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=w;function I(v){var R=v.fallbackHosts,N=typeof v.httpMaxRetryCount!="undefined"?v.httpMaxRetryCount:b.httpMaxRetryCount;return R?a.arrChooseN(R,N):[]}e.getFallbackHosts=I;function S(v){return[v.restHost].concat(I(v))}e.getHosts=S;function T(v){if(typeof v!="string")throw new l.default("host must be a string; was a "+typeof v,4e4,400);if(!v.length)throw new l.default("host must not be zero-length",4e4,400)}function x(v,R,N){return v.realtimeHost?v.realtimeHost:v.restHost?(u.default.logAction(u.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+v.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+v.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),v.restHost):R?b.REALTIME_HOST:N+"-"+b.REALTIME_HOST}function g(v){var R={};for(var N in b.TIMEOUTS)R[N]=v[N]||b.TIMEOUTS[N];return R}function y(v){var R=b.agent;if(v.agents)for(var N in v.agents)R+=" "+N+"/"+v.agents[N];return R}e.getAgentString=y;function d(v){return typeof v=="string"?v.indexOf(":")==-1?{token:v}:{key:v}:v}e.objectifyOptions=d;function p(v){if(v.host&&(u.default.deprecated("host","restHost"),v.restHost=v.host),v.wsHost&&(u.default.deprecated("wsHost","realtimeHost"),v.realtimeHost=v.wsHost),v.queueEvents&&(u.default.deprecated("queueEvents","queueMessages"),v.queueMessages=v.queueEvents),v.fallbackHostsUseDefault){if(v.fallbackHosts){var R="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw u.default.logAction(u.default.LOG_ERROR,"Defaults.normaliseOptions",R),new l.default(R,4e4,400)}if(v.port||v.tlsPort){var R="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw u.default.logAction(u.default.LOG_ERROR,"Defaults.normaliseOptions",R),new l.default(R,4e4,400)}v.environment?u.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):u.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),v.fallbackHosts=b.FALLBACK_HOSTS}v.recover===!0&&(u.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),v.recover=function(X,P){P(!0)}),typeof v.recover=="function"&&v.closeOnUnload===!0&&(u.default.logAction(u.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),v.recover=void 0),"closeOnUnload"in v||(v.closeOnUnload=!v.recover),v.transports&&a.arrIn(v.transports,"xhr")&&(u.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),a.arrDeleteValue(v.transports,"xhr"),v.transports.push("xhr_streaming")),"queueMessages"in v||(v.queueMessages=!0);var N=v.environment&&String(v.environment).toLowerCase()||b.ENVIRONMENT,z=!N||N==="production";!v.fallbackHosts&&!v.restHost&&!v.realtimeHost&&!v.port&&!v.tlsPort&&(v.fallbackHosts=z?b.FALLBACK_HOSTS:w(N));var W=v.restHost||(z?b.REST_HOST:N+"-"+b.REST_HOST),F=x(v,z,N);a.arrForEach((v.fallbackHosts||[]).concat(W,F),T),v.port=v.port||b.PORT,v.tlsPort=v.tlsPort||b.TLS_PORT,"tls"in v||(v.tls=!0);var _=g(v);if("useBinaryProtocol"in v?v.useBinaryProtocol=i.default.Config.supportsBinary&&v.useBinaryProtocol:v.useBinaryProtocol=i.default.Config.preferBinary,v.clientId){var L=v.headers=v.headers||{};L["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(v.clientId))}"idempotentRestPublishing"in v||(v.idempotentRestPublishing=!0),v.promises&&!i.default.Config.Promise&&(u.default.logAction(u.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),v.promises=!1);var $=null,G=v.connectivityCheckUrl;if(v.connectivityCheckUrl){var K=v.connectivityCheckUrl.split("?"),ee=K[0],re=K[1];$=re?a.parseQueryString(re):{},ee.indexOf("://")===-1&&(ee="https://"+ee),G=ee}return r.__assign(r.__assign({},v),{useBinaryProtocol:"useBinaryProtocol"in v?i.default.Config.supportsBinary&&v.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:F,restHost:W,maxMessageSize:v.maxMessageSize||b.maxMessageSize,timeouts:_,connectivityCheckParams:$,connectivityCheckUrl:G})}e.normaliseOptions=p,e.default=b;function O(v){return Object.assign(b,v)}e.getDefaults=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importDefault(t(2)),u=r.__importDefault(t(4)),l=r.__importStar(t(1));function f(h){return!h||!h.channelOptions?{channelOptions:h,plugins:{},baseEncodedPreviousPayload:void 0}:h}function m(h){if(h&&h.cipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=i.default.Crypto.getCipher(h.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return h!=null?h:{}}function b(h){var E=0;return h.name&&(E+=h.name.length),h.clientId&&(E+=h.clientId.length),h.extras&&(E+=JSON.stringify(h.extras).length),h.data&&(E+=l.dataSizeBytes(h.data)),E}var C=function(){function h(){}return h.prototype.toJSON=function(){var E=this.encoding,w=this.data;return w&&i.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(E=E?E+"/base64":"base64",w=i.default.BufferUtils.base64Encode(w)):w=i.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:w}},h.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},h.encrypt=function(E,w,I){var S=E.data,T=E.encoding,x=w.channelCipher;T=T?T+"/":"",i.default.BufferUtils.isBuffer(S)||(S=i.default.BufferUtils.utf8Encode(String(S)),T=T+"utf-8/"),x.encrypt(S,function(g,y){if(g){I(g);return}E.data=y,E.encoding=T+"cipher+"+x.algorithm,I(null,E)})},h.encode=function(E,w,I){var S=E.data,T=typeof S=="string"||i.default.BufferUtils.isBuffer(S)||S===null||S===void 0;if(!T)if(l.isObject(S)||l.isArray(S))E.data=JSON.stringify(S),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new u.default("Data type is unsupported",40013,400);w!=null&&w.cipher?h.encrypt(E,w,I):I(null,E)},h.encodeArray=function(E,w,I){for(var S=0,T=0;T<E.length;T++)h.encode(E[T],w,function(x){if(x){I(x);return}S++,S==E.length&&I(null,E)})},h.decode=function(E,w){var I=f(w),S=E.data,T=E.encoding;if(T){var x=T.split("/"),g=void 0,y=x.length,d=E.data,p="";try{for(;(g=y)>0;){var O=x[--y].match(/([-\w]+)(\+([\w-]+))?/);if(!O)break;switch(p=O[1],p){case"base64":d=i.default.BufferUtils.base64Decode(String(d)),g==x.length&&(S=d);continue;case"utf-8":d=i.default.BufferUtils.utf8Decode(d);continue;case"json":d=JSON.parse(d);continue;case"cipher":if(I.channelOptions!=null&&I.channelOptions.cipher&&I.channelOptions.channelCipher){var v=O[3],R=I.channelOptions.channelCipher;if(v!=R.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");d=R.decrypt(d);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!I.plugins||!I.plugins.vcdiff)throw new u.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new u.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var N=I.baseEncodedPreviousPayload;typeof N=="string"&&(N=i.default.BufferUtils.utf8Encode(N)),N=i.default.BufferUtils.toBuffer(N),d=i.default.BufferUtils.toBuffer(d),d=i.default.BufferUtils.typedArrayToBuffer(I.plugins.vcdiff.decode(d,N)),S=d}catch(W){throw new u.default("Vcdiff delta decode failed with "+W,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(W){var z=W;throw new u.default("Error processing the "+p+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{E.encoding=g<=0?null:x.slice(0,g).join("/"),E.data=d}}I.baseEncodedPreviousPayload=S},h.fromResponseBody=function(E,w,I){I&&(E=l.decodeBody(E,I));for(var S=0;S<E.length;S++){var T=E[S]=h.fromValues(E[S]);try{h.decode(T,w)}catch(x){a.default.logAction(a.default.LOG_ERROR,"Message.fromResponseBody()",x.toString())}}return E},h.fromValues=function(E){return Object.assign(new h,E)},h.fromValuesArray=function(E){for(var w=E.length,I=new Array(w),S=0;S<w;S++)I[S]=h.fromValues(E[S]);return I},h.fromEncoded=function(E,w){var I=h.fromValues(E),S=m(w!=null?w:null);try{h.decode(I,S)}catch(T){a.default.logAction(a.default.LOG_ERROR,"Message.fromEncoded()",T.toString())}return I},h.fromEncodedArray=function(E,w){return E.map(function(I){return h.fromEncoded(I,w)})},h.getMessagesSize=function(E){for(var w,I=0,S=0;S<E.length;S++)w=E[S],I+=w.size||(w.size=b(w));return I},h.serialize=l.encodeBody,h}();e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(4)),u=r.__importDefault(t(9)),l=r.__importDefault(t(15)),f={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},m=[];Object.keys(f).forEach(function(I){m[f[I]]=I});var b={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},C=Object.keys(b);b.MODE_ALL=b.PRESENCE|b.PUBLISH|b.SUBSCRIBE|b.PRESENCE_SUBSCRIBE;function h(I){var S=[];if(I)for(var T=0;T<I.length;T++)S.push(I[T].toString());return"[ "+S.join(", ")+" ]"}var E="id channel channelSerial connectionId count msgSerial timestamp".split(" "),w=function(){function I(){var S=this;this.hasFlag=function(T){return(S.flags&b[T])>0}}return I.prototype.setFlag=function(S){return this.flags=this.flags|b[S]},I.prototype.getMode=function(){return this.flags&&this.flags&b.MODE_ALL},I.prototype.encodeModesToFlags=function(S){var T=this;S.forEach(function(x){return T.setFlag(x)})},I.prototype.decodeModesFromFlags=function(){var S=this,T=[];return I.channelModes.forEach(function(x){S.hasFlag(x)&&T.push(x)}),T.length>0?T:void 0},I.fromValues=function(S){return Object.assign(new I,S)},I.Action=f,I.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],I.ActionName=m,I.serialize=i.encodeBody,I.deserialize=function(S,T){var x=i.decodeBody(S,T);return I.fromDeserialized(x)},I.fromDeserialized=function(S){var T=S.error;T&&(S.error=a.default.fromValues(T));var x=S.messages;if(x)for(var g=0;g<x.length;g++)x[g]=u.default.fromValues(x[g]);var y=S.presence;if(y)for(var g=0;g<y.length;g++)y[g]=l.default.fromValues(y[g],!0);return Object.assign(new I,S)},I.stringify=function(S){var T="[ProtocolMessage";S.action!==void 0&&(T+="; action="+I.ActionName[S.action]||!1);for(var x,g=0;g<E.length;g++)x=E[g],S[x]!==void 0&&(T+="; "+x+"="+S[x]);if(S.messages&&(T+="; messages="+h(u.default.fromValuesArray(S.messages))),S.presence&&(T+="; presence="+h(l.default.fromValuesArray(S.presence))),S.error&&(T+="; error="+a.default.fromValues(S.error).toString()),S.auth&&S.auth.accessToken&&(T+="; token="+S.auth.accessToken),S.flags&&(T+="; flags="+C.filter(S.hasFlag).join(",")),S.params){var y="";i.forInOwnNonNullProperties(S.params,function(d){y.length>0&&(y+="; "),y+=d+"="+S.params[d]}),y.length>0&&(T+="; params=["+y+"]")}return T+="]",T},I}();e.default=w},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,u=a.WordArray,l=i.enc,f=l.Base64={stringify:function(b){var C=b.words,h=b.sigBytes,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.clamp();for(var w=[],I=0;I<h;I+=3)for(var S=C[I>>>2]>>>24-I%4*8&255,T=C[I+1>>>2]>>>24-(I+1)%4*8&255,x=C[I+2>>>2]>>>24-(I+2)%4*8&255,g=S<<16|T<<8|x,y=0;y<4&&I+y*.75<h;y++)w.push(E.charAt(g>>>6*(3-y)&63));var d=E.charAt(64);if(d)for(;w.length%4;)w.push(d);return w.join("")},parse:function(b){var C=b.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var w=0;w<h.length;w++)E[h.charCodeAt(w)]=w}var I=h.charAt(64);if(I){var S=b.indexOf(I);S!==-1&&(C=S)}return m(b,C,E)}};function m(b,C,h){for(var E=[],w=0,I=0;I<C;I++)if(I%4){var S=h[b.charCodeAt(I-1)]<<I%4*2,T=h[b.charCodeAt(I)]>>>6-I%4*2,x=S|T;E[w>>>2]|=x<<24-w%4*8,w++}return u.create(E,w)}}(),r.enc.Base64})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(10)),u=r.__importDefault(t(26)),l=r.__importDefault(t(2)),f=r.__importDefault(t(8)),m=r.__importDefault(t(20)),b=r.__importDefault(t(17)),C=r.__importDefault(t(4)),h=r.__importDefault(t(21)),E=r.__importDefault(t(3));function w(T){var x=[80015,80017,80030];return T.code?b.default.isTokenErr(T)?!1:i.arrIn(x,T.code)?!0:T.code>=4e4&&T.code<5e4:!1}function I(T){return w(T)?[a.default.fromValues({action:a.default.Action.ERROR,error:T})]:[a.default.fromValues({action:a.default.Action.DISCONNECTED,error:T})]}var S=function(T){r.__extends(x,T);function x(g,y,d){var p=T.call(this,g,y,d,!0)||this;return p.onAuthUpdated=function(O){p.authParams={access_token:O.token}},p.stream="stream"in d?d.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return x.prototype.connect=function(){var g=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","starting"),u.default.prototype.connect.call(this);var y=this.params,d=y.options,p=f.default.getHost(d,y.host),O=f.default.getPort(d),v=d.tls?"https://":"http://";this.baseUri=v+p+":"+O+"/comet/";var R=this.baseUri+"connect";l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","uri: "+R),this.auth.getAuthParams(function(N,z){if(N){g.disconnect(N);return}if(!g.isDisposed){g.authParams=z;var W=g.params.getConnectParams(z);"stream"in W&&(g.stream=W.stream),l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(W));var F=!1,_=g.recvRequest=g.createRequest(R,null,W,null,g.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV);_.on("data",function(L){!g.recvRequest||(F||(F=!0,g.emit("preconnect")),g.onData(L))}),_.on("complete",function(L){if(g.recvRequest||(L=L||new C.default("Request cancelled",80003,400)),g.recvRequest=null,!F&&!L&&(F=!0,g.emit("preconnect")),g.onActivity(),L){L.code?g.onData(I(L)):g.disconnect(L);return}E.default.Config.nextTick(function(){g.recv()})}),_.exec()}})},x.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},x.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},x.prototype._requestCloseOrDisconnect=function(g){var y=this,d=g?this.closeUri:this.disconnectUri;if(d){var p=this.createRequest(d,null,this.authParams,null,h.default.REQ_SEND);p.on("complete",function(O){O&&(l.default.logAction(l.default.LOG_ERROR,"CometTransport.request"+(g?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(O)),y.finish("disconnected",O))}),p.exec()}},x.prototype.dispose=function(){var g=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected()),E.default.Config.nextTick(function(){g.emit("disposed")}))},x.prototype.onConnect=function(g){var y;if(!this.isDisposed){var d=(y=g.connectionDetails)===null||y===void 0?void 0:y.connectionKey;u.default.prototype.onConnect.call(this,g);var p=this.baseUri+d;l.default.logAction(l.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}},x.prototype.send=function(g){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(g);return}var y=this.pendingItems||[];y.push(g),this.pendingItems=null,this.sendItems(y)},x.prototype.sendAnyPending=function(){var g=this.pendingItems;!g||(this.pendingItems=null,this.sendItems(g))},x.prototype.sendItems=function(g){var y=this,d=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(g),h.default.REQ_SEND);d.on("complete",function(p,O){if(p&&l.default.logAction(l.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),y.sendRequest=null,p){p.code?y.onData(I(p)):y.disconnect(p);return}O&&y.onData(O),y.pendingItems&&E.default.Config.nextTick(function(){y.sendRequest||y.sendAnyPending()})}),d.exec()},x.prototype.recv=function(){var g=this;if(!this.recvRequest&&!!this.isConnected){var y=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV_POLL);y.on("data",function(d){g.onData(d)}),y.on("complete",function(d){if(g.recvRequest=null,g.onActivity(),d){d.code?g.onData(I(d)):g.disconnect(d);return}E.default.Config.nextTick(function(){g.recv()})}),y.exec()}},x.prototype.onData=function(g){try{var y=this.decodeResponse(g);if(y&&y.length)for(var d=0;d<y.length;d++)this.onProtocolMessage(a.default.fromDeserialized(y[d]))}catch(p){l.default.logAction(l.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},x.prototype.encodeRequest=function(g){return JSON.stringify(g)},x.prototype.decodeResponse=function(g){return typeof g=="string"?JSON.parse(g):g},x}(u.default);e.default=S},function(s,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(r){typeof window=="object"&&(t=window)}s.exports=t},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),u=r.__importDefault(t(2)),l=r.__importDefault(t(17)),f=r.__importDefault(t(18)),m=t(4);function b(S,T,x,g,y){S.http.supportsAuthHeaders?S.auth.getAuthHeaders(function(d,p){d?g(d):y(a.mixin(p,T),x)}):S.auth.getAuthParams(function(d,p){d?g(d):y(T,a.mixin(p,x))})}function C(S,T){return function(x,g,y,d,p){if(x&&!g){S(x);return}if(!d)try{g=a.decodeBody(g,T)}catch(W){a.isErrorInfoOrPartialErrorInfo(W)?S(W):S(new m.PartialErrorInfo(a.inspectError(W),null));return}if(!g){S(new m.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var O=g,v=O.statusCode,R=O.response,N=O.headers;if(v===void 0){S(x,g,y,!0,p);return}if(v<200||v>=300){var z=R&&R.error||x;z||(z=new Error("Error in unenveloping "+g),z.statusCode=v),S(z,R,N,!0,v);return}S(x,R,N,!0,v)}}function h(S){var T=[];if(S)for(var x in S)T.push(x+"="+S[x]);return T.join("&")}function E(S,T){return S+(T?"?":"")+h(T)}function w(S,T,x,g){return function(y,d,p,O,v){y?u.default.logAction(u.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+E(x,g)+"; Error: "+a.inspectError(y)):u.default.logAction(u.default.LOG_MICRO,"Resource."+T+"()","Received; "+E(x,g)+"; Headers: "+h(p)+"; StatusCode: "+v+"; Body: "+(i.default.BufferUtils.isBuffer(d)?d.toString():d)),S&&S(y,d,p,O,v)}}var I=function(){function S(){}return S.get=function(T,x,g,y,d,p){S.do(f.default.Get,T,x,null,g,y,d,p)},S.delete=function(T,x,g,y,d,p){S.do(f.default.Delete,T,x,null,g,y,d,p)},S.post=function(T,x,g,y,d,p,O){S.do(f.default.Post,T,x,g,y,d,p,O)},S.patch=function(T,x,g,y,d,p,O){S.do(f.default.Patch,T,x,g,y,d,p,O)},S.put=function(T,x,g,y,d,p,O){S.do(f.default.Put,T,x,g,y,d,p,O)},S.do=function(T,x,g,y,d,p,O,v){u.default.shouldLog(u.default.LOG_MICRO)&&(v=w(v,T,g,p)),O&&(v=v&&C(v,O),(p=p||{}).envelope=O);function R(N,z){var W;if(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Resource."+T+"()","Sending; "+E(g,z)),u.default.shouldLog(u.default.LOG_MICRO)){var F=y;if(((W=N["content-type"])===null||W===void 0?void 0:W.indexOf("msgpack"))>0)try{F=i.default.Config.msgpack.decode(y)}catch(_){u.default.logAction(u.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+a.inspectError(_))}u.default.logAction(u.default.LOG_MICRO,"Resource."+T+"()","Sending; "+E(g,z)+"; Body: "+F)}x.http.do(T,x,g,N,y,z,function(_,L,$,G,K){if(_&&l.default.isTokenErr(_)){x.auth.authorize(null,null,function(ee){if(ee){v(ee);return}b(x,$,z,v,R)});return}v(_,L,$,G,K)})}b(x,d,p,v,R)},S}();e.default=I},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=r.__importDefault(t(3)),u=r.__importDefault(t(9)),l=r.__importStar(t(1));function f(b){return m.Actions.indexOf(b)}var m=function(){function b(){}return b.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},b.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var C=this.id.split(":");return{connectionId:C[0],msgSerial:parseInt(C[1],10),index:parseInt(C[2],10)}},b.prototype.toJSON=function(){var C=this.data,h=this.encoding;return C&&a.default.BufferUtils.isBuffer(C)&&(arguments.length>0?(h=h?h+"/base64":"base64",C=a.default.BufferUtils.base64Encode(C)):C=a.default.BufferUtils.toBuffer(C)),{id:this.id,clientId:this.clientId,action:f(this.action),data:C,encoding:h,extras:this.extras}},b.prototype.toString=function(){var C="[PresenceMessage";return C+="; action="+this.action,this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?C+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),this.extras&&(C+="; extras="+JSON.stringify(this.extras)),C+="]",C},b.fromResponseBody=function(C,h,E){var w=[];E&&(C=l.decodeBody(C,E));for(var I=0;I<C.length;I++){var S=w[I]=b.fromValues(C[I],!0);try{b.decode(S,h)}catch(T){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",T.toString())}}return w},b.fromValues=function(C,h){return h&&(C.action=b.Actions[C.action]),Object.assign(new b,C)},b.fromValuesArray=function(C){for(var h=C.length,E=new Array(h),w=0;w<h;w++)E[w]=b.fromValues(C[w]);return E},b.fromEncoded=function(C,h){var E=b.fromValues(C,!0);try{b.decode(E,h!=null?h:{})}catch(w){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return E},b.fromEncodedArray=function(C,h){return C.map(function(E){return b.fromEncoded(E,h)})},b.fromData=function(C){return C instanceof b?C:b.fromValues({data:C})},b.Actions=["absent","present","enter","leave","update"],b.encode=u.default.encode,b.decode=u.default.decode,b.getMessagesSize=u.default.getMessagesSize,b}();e.default=m},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importStar(t(1)),u=i.__importDefault(t(7)),l=i.__importStar(t(4)),f=i.__importDefault(t(2)),m=i.__importDefault(t(8)),b=i.__importDefault(t(21)),C=i.__importDefault(t(3));function h(v,R){return a.arrIn(a.allToLowerCase(a.keysArray(R)),"x-ably-errorcode")}function E(v,R){if(h(v,R))return v.error&&l.default.fromValues(v.error)}var w=function(){},I=0,S={},T=typeof r!="undefined"&&r.XDomainRequest;function x(){var v=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return v&&Number(v[1])}function g(){var v;return T&&(v=x())&&v===10}function y(v,R){return v.getResponseHeader&&v.getResponseHeader(R)}function d(v){return v.getResponseHeader&&(v.getResponseHeader("transfer-encoding")||!v.getResponseHeader("content-length"))}function p(v){for(var R=a.trim(v.getAllResponseHeaders()).split(`\r
`),N={},z=0;z<R.length;z++){var W=R[z].split(":").map(a.trim);N[W[0].toLowerCase()]=W[1]}return N}var O=function(v){i.__extends(R,v);function R(N,z,W,F,_,L,$){var G=v.call(this)||this;return W=W||{},W.rnd=a.cheapRandStr(),g()&&!W.envelope&&(W.envelope="json"),G.uri=N+a.toQueryString(W),G.headers=z||{},G.body=F,G.method=$?$.toUpperCase():a.isEmptyArg(F)?"GET":"POST",G.requestMode=_,G.timeouts=L,G.timedOut=!1,G.requestComplete=!1,G.id=String(++I),S[G.id]=G,G}return R.createRequest=function(N,z,W,F,_,L,$){var G=L||m.default.TIMEOUTS;return new R(N,z,a.copy(W),F,_,G,$)},R.prototype.complete=function(N,z,W,F,_){this.requestComplete||(this.requestComplete=!0,!N&&z&&this.emit("data",z),this.emit("complete",N,z,W,F,_),this.dispose())},R.prototype.abort=function(){this.dispose()},R.prototype.exec=function(){var N=this,z=this.headers,W=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,F=this.timer=setTimeout(function(){N.timedOut=!0,L.abort()},W),_=this.method,L=this.xhr=new XMLHttpRequest,$=z.accept,G=this.body,K="text";if($?$.indexOf("application/x-msgpack")===0&&(K="arraybuffer"):z.accept="application/json",G){var ee=z["content-type"]||(z["content-type"]="application/json");ee.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}L.open(_,this.uri,!0),L.responseType=K,"authorization"in z&&(L.withCredentials=!0);for(var re in z)L.setRequestHeader(re,z[re]);var X=function(de,Ze,bt,it){var dt,un=Ze+" (event type: "+de.type+")";!((dt=N==null?void 0:N.xhr)===null||dt===void 0)&&dt.statusText&&(un+=", current statusText is "+N.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+de.type+"()",un),N.complete(new l.PartialErrorInfo(un,bt,it))};L.onerror=function(de){X(de,"XHR error occurred",null,400)},L.onabort=function(de){N.timedOut?X(de,"Request aborted due to request timeout expiring",null,408):X(de,"Request cancelled",null,400)},L.ontimeout=function(de){X(de,"Request timed out",null,408)};var P,B,H,j=0,te=!1,ce=function(){if(clearTimeout(F),H=B<400,B==204){N.complete(null,null,null,null,B);return}P=N.requestMode==b.default.REQ_RECV_STREAM&&H&&d(L)},me=function(){var de;try{var Ze=y(L,"content-type"),bt=Ze?Ze.indexOf("application/json")>=0:L.responseType=="text";if(bt){var it=L.responseType==="arraybuffer"?C.default.BufferUtils.utf8Decode(L.response):String(L.responseText);it.length?de=JSON.parse(it):de=it,te=!0}else de=L.response;de.response!==void 0?(B=de.statusCode,H=B<400,z=de.headers,de=de.response):z=p(L)}catch(un){N.complete(new l.PartialErrorInfo("Malformed response body from server: "+un.message,null,400));return}if(H||a.isArray(de)){N.complete(null,de,z,te,B);return}var dt=E(de,z);dt||(dt=new l.PartialErrorInfo("Error response received from server: "+B+" body was: "+C.default.Config.inspect(de),null,B)),N.complete(dt,de,z,te,B)};function be(){for(var de=L.responseText,Ze=de.length-1,bt,it;j<Ze&&(bt=de.indexOf(`
`,j))>-1;)it=de.slice(j,bt),j=bt+1,Se(it)}var Se=function(de){try{de=JSON.parse(de)}catch(Ze){N.complete(new l.PartialErrorInfo("Malformed response body from server: "+Ze.message,null,400));return}N.emit("data",de)},$e=function(){be(),N.streamComplete=!0,C.default.Config.nextTick(function(){N.complete()})};L.onreadystatechange=function(){var de=L.readyState;de<3||L.status!==0&&(B===void 0&&(B=L.status,B===1223&&(B=204),ce()),de==3&&P?be():de==4&&(P?$e():me()))},L.send(G)},R.prototype.dispose=function(){var N=this.xhr;if(N){N.onreadystatechange=N.onerror=N.onabort=N.ontimeout=w,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||N.abort()}delete S[this.id]},R}(u.default);e.default=O}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=r.__importStar(t(1)),u=r.__importDefault(t(23)),l=r.__importDefault(t(4)),f=r.__importDefault(t(45)),m=t(11),b=r.__importDefault(t(18)),C=r.__importDefault(t(25)),h=r.__importDefault(t(3)),E=r.__importDefault(t(14)),w=Math.pow(2,17);function I(){}function S(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function T(W){return!!W.connection}function x(W){return a.isErrorInfoOrPartialErrorInfo(W)?(W.code||(W.statusCode===403?W.code=40300:(W.code=40170,W.statusCode=401)),W):new l.default(a.inspectError(W),W.code||40170,W.statusCode||401)}var g=function(W,F){if(h.default.Config.createHmac){var _=h.default.Config.createHmac("SHA256",F);return _.update(W),_.digest("base64")}return(0,m.stringify)((0,f.default)(W,F))};function y(W){if(!W)return"";typeof W=="string"&&(W=JSON.parse(W));var F=Object.create(null),_=a.keysArray(W,!0);if(!_)return"";_.sort();for(var L=0;L<_.length;L++)F[_[L]]=W[_[L]].sort();return JSON.stringify(F)}function d(W){if(W.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(W.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(W.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(W.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var F="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",F),new Error(F)}}function p(W){return"useTokenAuth"in W&&!W.useTokenAuth}function O(W){return W.useTokenAuth||!p(W)&&(W.authCallback||W.authUrl||W.token||W.tokenDetails)}function v(W){return!W.key&&!W.authCallback&&!W.authUrl}var R=0;function N(){return R++}var z=function(){function W(F,_){if(this.authOptions={},this.client=F,this.tokenParams=_.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,O(_)){if(_.key&&!g){var L="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new Error(L)}v(_)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(_.defaultTokenParams,_),d(this.authOptions)}else{if(!_.key){var L="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new l.default(L,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(_)}}return W.prototype.authorize=function(F,_,L){var $=this,G;if(typeof F=="function"&&!L?(L=F,G=F=null):typeof _=="function"&&!L?(L=_,G=null):G=_,!L&&this.client.options.promises)return a.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new l.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),a.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(F,G,function(K,ee){if(K){$.client.connection&&K.statusCode===C.default.Forbidden&&$.client.connection.connectionManager.actOnErrorFromAuthorize(K),L==null||L(K);return}T($.client)?$.client.connection.connectionManager.onAuthUpdated(ee,L||I):L==null||L(null,ee)})},W.prototype.authorise=function(F,_,L){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(F,_,L)},W.prototype._forceNewToken=function(F,_,L){var $=this;this.tokenDetails=null,this._saveTokenOptions(F,_),d(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,K){delete $.tokenParams.timestamp,delete $.authOptions.queryTime,L(G,K)})},W.prototype.requestToken=function(F,_,L){var $=this;if(typeof F=="function"&&!L?(L=F,_=F=null):typeof _=="function"&&!L&&(L=_,_=null),!L&&this.client.options.promises)return a.promisify(this,"requestToken",arguments);_=_||this.authOptions,F=F||a.copy(this.tokenParams);var G=L||I,K,ee=this.client;if(_.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),K=_.authCallback;else if(_.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),K=function(j,te){var ce=a.mixin({accept:"application/json, text/plain"},_.authHeaders),me=_.authMethod&&_.authMethod.toLowerCase()==="post",be,Se=_.authUrl.indexOf("?");Se>-1&&(be=a.parseQueryString(_.authUrl.slice(Se)),_.authUrl=_.authUrl.slice(0,Se),me||(_.authParams=a.mixin(be,_.authParams)));var $e=a.mixin({},_.authParams||{},j),de=function(it,dt,un,vn){var at;if(it?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+a.inspectError(it)):(at=un["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+at+"; body: "+a.inspectBody(dt))),it||vn)return te(it,dt);if(h.default.BufferUtils.isBuffer(dt)&&(dt=dt.toString()),!at){te(new l.default("authUrl response is missing a content-type header",40170,401));return}var yn=at.indexOf("application/json")>-1,Vn=at.indexOf("text/plain")>-1||at.indexOf("application/jwt")>-1;if(!yn&&!Vn){te(new l.default("authUrl responded with unacceptable content-type "+at+", should be either text/plain, application/jwt or application/json",40170,401));return}if(yn){if(dt.length>w){te(new l.default("authUrl response exceeded max permitted length",40170,401));return}try{dt=JSON.parse(dt)}catch(Ki){te(new l.default("Unexpected error processing authURL response; err = "+Ki.message,40170,401));return}}te(null,dt,at)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+_.authUrl+"; Params: "+JSON.stringify($e)+"; method: "+(me?"POST":"GET")),me){var Ze=ce||{};Ze["content-type"]="application/x-www-form-urlencoded";var bt=a.toQueryString($e).slice(1);$.client.http.doUri(b.default.Post,ee,_.authUrl,Ze,bt,be,de)}else $.client.http.doUri(b.default.Get,ee,_.authUrl,ce||{},null,$e,de)};else if(_.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),K=function(j,te){$.createTokenRequest(j,_,te)};else{var re="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new l.default(re,40171,403));return}"capability"in F&&(F.capability=y(F.capability));var X=function(j,te){var ce=j.keyName,me="/keys/"+ce+"/requestToken",be=function($e){return ee.baseUri($e)+me},Se=a.defaultPostHeaders($.client.options);_.requestHeaders&&a.mixin(Se,_.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+me+"; Token params: "+JSON.stringify(j)),$.client.http.do(b.default.Post,ee,be,Se,JSON.stringify(j),null,te)},P=!1,B=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){P=!0;var j="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",j),G(new l.default(j,40170,401))},B);K(F,function(j,te,ce){if(!P){if(clearTimeout(H),j){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+a.inspectError(j)),G(x(j));return}if(typeof te=="string"){te.length===0?G(new l.default("Token string is empty",40170,401)):te.length>w?G(new l.default("Token string exceeded max permitted length (was "+te.length+" bytes)",40170,401)):te==="undefined"||te==="null"?G(new l.default("Token string was literal null/undefined",40170,401)):te[0]==="{"&&!(ce&&ce.indexOf("application/jwt")>-1)?G(new l.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:te});return}if(typeof te!="object"){var me="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof te;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),G(new l.default(me,40170,401));return}var be=JSON.stringify(te).length;if(be>w&&!_.suppressMaxLengthCheck){G(new l.default("Token request/details object exceeded max permitted stringified size (was "+be+" bytes)",40170,401));return}if("issued"in te){G(null,te);return}if(!("keyName"in te)){var me="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),G(new l.default(me,40170,401));return}X(te,function(Se,$e,de,Ze){if(Se){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+a.inspectError(Se)),G(x(Se));return}Ze||($e=JSON.parse($e)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,$e)})}})},W.prototype.createTokenRequest=function(F,_,L){var $=this;if(typeof F=="function"&&!L?(L=F,_=F=null):typeof _=="function"&&!L&&(L=_,_=null),!L&&this.client.options.promises)return a.promisify(this,"createTokenRequest",arguments);_=_||this.authOptions,F=F||a.copy(this.tokenParams);var G=_.key;if(!G){L(new l.default("No key specified",40101,403));return}var K=G.split(":"),ee=K[0],re=K[1];if(!re){L(new l.default("Invalid key specified",40101,403));return}if(F.clientId===""){L(new l.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in F&&(F.capability=y(F.capability));var X=a.mixin({keyName:ee},F),P=F.clientId||"",B=F.ttl||"",H=F.capability||"";(function(j){if(X.timestamp){j();return}$.getTimestamp(_&&_.queryTime,function(te,ce){if(te){L(te);return}X.timestamp=ce,j()})})(function(){var j=X.nonce||(X.nonce=S()),te=X.timestamp,ce=X.keyName+`
`+B+`
`+H+`
`+P+`
`+te+`
`+j+`
`;X.mac=X.mac||g(ce,re),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),L(null,X)})},W.prototype.getAuthParams=function(F){this.method=="basic"?F(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(_,L){if(_){F(_);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");F(null,{access_token:L.token})})},W.prototype.getAuthHeaders=function(F){this.method=="basic"?F(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(_,L){if(_){F(_);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");F(null,{authorization:"Bearer "+a.toBase64(L.token)})})},W.prototype.getTimestamp=function(F,_){!this.isTimeOffsetSet()&&(F||this.authOptions.queryTime)?this.client.time(_):_(null,this.getTimestampUsingOffset())},W.prototype.getTimestampUsingOffset=function(){return a.now()+(this.client.serverTimeOffset||0)},W.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},W.prototype._saveBasicOptions=function(F){this.method="basic",this.key=F.key,this.basicKey=a.toBase64(F.key),this.authOptions=F||{},"clientId"in F&&this._userSetClientId(F.clientId)},W.prototype._saveTokenOptions=function(F,_){this.method="token",F&&(this.tokenParams=F),_&&(_.token&&(_.tokenDetails=typeof _.token=="string"?{token:_.token}:_.token),_.tokenDetails&&(this.tokenDetails=_.tokenDetails),"clientId"in _&&this._userSetClientId(_.clientId),this.authOptions=_)},W.prototype._ensureValidAuthCredentials=function(F,_){var L=this,$=this.tokenDetails;if($){if(this._tokenClientIdMismatch($.clientId)){_(new l.default("Mismatch between clientId in token ("+$.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!$.expires||$.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+$.expires),_(null,$);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=u.default.create())).push(_),!(this.currentTokenRequestId!==null&&!F)){var G=this.currentTokenRequestId=N();this.requestToken(this.tokenParams,this.authOptions,function(K,ee){if(L.currentTokenRequestId>G){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}L.currentTokenRequestId=null;var re=L.waitingForTokenRequest||I;if(L.waitingForTokenRequest=null,K){re(K);return}re(null,L.tokenDetails=ee)})}},W.prototype._userSetClientId=function(F){if(typeof F=="string"||F===null){if(F==="*")throw new l.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var _=this._uncheckedSetClientId(F);if(_)throw _}else throw new l.default("clientId must be either a string or null",40012,400)},W.prototype._uncheckedSetClientId=function(F){if(this._tokenClientIdMismatch(F)){var _="Unexpected clientId mismatch: client has "+this.clientId+", requested "+F,L=new l.default(_,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",_),L}else return this.clientId=this.tokenParams.clientId=F,null},W.prototype._tokenClientIdMismatch=function(F){return!!(this.clientId&&this.clientId!=="*"&&F&&F!=="*"&&this.clientId!==F)},W.isTokenErr=function(F){return F.code&&F.code>=40140&&F.code<40150},W.prototype.revokeTokens=function(F,_,L){if(O(this.client.options))throw new l.default("Cannot revoke tokens when using token auth",40162,401);var $=this.client.options.keyName,G;if(typeof _=="function"?(L=_,G={}):G=_!=null?_:{},L===void 0){if(this.client.options.promises)return a.promisify(this,"revokeTokens",[F,G]);L=I}var K=L,ee=r.__assign({targets:F.map(function(B){return"".concat(B.type,":").concat(B.value)})},G),re=this.client.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,X=a.defaultPostHeaders(this.client.options,re);this.client.options.headers&&a.mixin(X,this.client.options.headers);var P=a.encodeBody(ee,re);E.default.post(this.client,"/keys/".concat($,"/revokeTokens"),P,X,{newBatchResponse:"true"},null,function(B,H,j,te){if(B){K(B);return}var ce=te?H:a.decodeBody(H,re);K(null,ce)})},W}();e.default=z},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(r||(r={})),e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),u=r.__importDefault(t(14));function l(E){var w=E.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&i.parseQueryString(w[2])}function f(E){typeof E=="string"&&(E=E.split(","));for(var w={},I=0;I<E.length;I++){var S=E[I].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(S){var T=l(S[1]);T&&(w[S[2]]=T)}}return w}function m(E,w,I){return!(I&&(w||typeof E.code=="number"))}var b=function(){function E(w,I,S,T,x,g){this.rest=w,this.path=I,this.headers=S,this.envelope=T!=null?T:null,this.bodyHandler=x,this.useHttpPaginatedResponse=g||!1}return E.prototype.get=function(w,I){var S=this;u.default.get(this.rest,this.path,this.headers,w,this.envelope,function(T,x,g,y,d){S.handlePage(T,x,g,y,d,I)})},E.prototype.delete=function(w,I){var S=this;u.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(T,x,g,y,d){S.handlePage(T,x,g,y,d,I)})},E.prototype.post=function(w,I,S){var T=this;u.default.post(this.rest,this.path,I,this.headers,w,this.envelope,function(x,g,y,d,p){S&&T.handlePage(x,g,y,d,p,S)})},E.prototype.put=function(w,I,S){var T=this;u.default.put(this.rest,this.path,I,this.headers,w,this.envelope,function(x,g,y,d,p){S&&T.handlePage(x,g,y,d,p,S)})},E.prototype.patch=function(w,I,S){var T=this;u.default.patch(this.rest,this.path,I,this.headers,w,this.envelope,function(x,g,y,d,p){S&&T.handlePage(x,g,y,d,p,S)})},E.prototype.handlePage=function(w,I,S,T,x,g){if(w&&m(w,I,this.useHttpPaginatedResponse)){a.default.logAction(a.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(w)),g==null||g(w);return}var y,d,p;try{y=this.bodyHandler(I,S||{},T)}catch(O){g==null||g(w||O);return}S&&(d=S.Link||S.link)&&(p=f(d)),this.useHttpPaginatedResponse?g(null,new h(this,y,S||{},x,p,w)):g(null,new C(this,y,p))},E}(),C=function(){function E(w,I,S){var T=this;this.resource=w,this.items=I;var x=this;S&&("first"in S&&(this.first=function(g){if(!g&&x.resource.rest.options.promises)return i.promisify(x,"first",[]);x.get(S.first,g)}),"current"in S&&(this.current=function(g){if(!g&&x.resource.rest.options.promises)return i.promisify(x,"current",[]);x.get(S.current,g)}),this.next=function(g){if(!g&&x.resource.rest.options.promises)return i.promisify(x,"next",[]);"next"in S?x.get(S.next,g):g(null)},this.hasNext=function(){return"next"in S},this.isLast=function(){var g;return!(!((g=T.hasNext)===null||g===void 0)&&g.call(T))})}return E.prototype.get=function(w,I){var S=this.resource;u.default.get(S.rest,S.path,S.headers,w,S.envelope,function(T,x,g,y,d){S.handlePage(T,x,g,y,d,I)})},E}();e.PaginatedResult=C;var h=function(E){r.__extends(w,E);function w(I,S,T,x,g,y){var d=E.call(this,I,S,g)||this;return d.statusCode=x,d.success=x<300&&x>=200,d.headers=T,d.errorCode=y&&y.code,d.errorMessage=y&&y.message,d}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(C);e.HttpPaginatedResponse=h,e.default=b},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var r=t(0),i=r.__importDefault(t(4)),a={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},u={disconnected:function(){return i.default.fromValues({statusCode:400,code:a.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return i.default.fromValues({statusCode:400,code:a.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return i.default.fromValues({statusCode:400,code:a.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return i.default.fromValues({statusCode:400,code:a.CLOSING,message:"Connection closing"})},closed:function(){return i.default.fromValues({statusCode:400,code:a.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function l(f){return!f.statusCode||!f.code||f.statusCode>=500?!0:Object.values(a).includes(f.code)}e.isRetriable=l,e.default=u},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(r||(r={})),e.default=r},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(5),t(58),t(11),t(40),t(32),t(24),t(27),t(28),t(59),t(60))})(this,function(r){return r})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(2)),a=function(){function u(l){this.members=l||[]}return u.prototype.call=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];for(var m=0,b=this.members;m<b.length;m++){var C=b[m];if(C)try{C.apply(void 0,l)}catch(h){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+h+"; stack = "+h.stack)}}},u.prototype.push=function(){for(var l,f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];(l=this.members).push.apply(l,f)},u.create=function(l){var f=new u(l);return Object.assign(function(){for(var m=[],b=0;b<arguments.length;b++)m[b]=arguments[b];return f.call.apply(f,m)},{push:function(m){return f.push(m)}})},u}();e.default=a},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){(function(){var i=r,a=i.lib,u=a.Base,l=i.enc,f=l.Utf8,m=i.algo,b=m.HMAC=u.extend({init:function(C,h){C=this._hasher=new C.init,typeof h=="string"&&(h=f.parse(h));var E=C.blockSize,w=E*4;h.sigBytes>w&&(h=C.finalize(h)),h.clamp();for(var I=this._oKey=h.clone(),S=this._iKey=h.clone(),T=I.words,x=S.words,g=0;g<E;g++)T[g]^=1549556828,x[g]^=909522486;I.sigBytes=S.sigBytes=w,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var h=this._hasher,E=h.finalize(C);h.reset();var w=h.finalize(this._oKey.clone().concat(E));return w}})})()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var r;(function(a){a[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError"})(r||(r={}));function i(a){return a>=r.Success&&a<r.BadRequest}e.isSuccessCode=i,e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(10)),a=r.__importStar(t(1)),u=r.__importDefault(t(7)),l=r.__importDefault(t(2)),f=r.__importDefault(t(20)),m=r.__importDefault(t(4)),b=r.__importDefault(t(3)),C=i.default.Action,h=i.default.fromValues({action:C.CLOSE}),E=i.default.fromValues({action:C.DISCONNECT}),w=function(I){r.__extends(S,I);function S(T,x,g,y){var d=I.call(this)||this;return y&&(g.format=void 0,g.heartbeats=!0),d.connectionManager=T,T.registerProposedTransport(d),d.auth=x,d.params=g,d.timeouts=g.options.timeouts,d.format=g.format,d.isConnected=!1,d.isFinished=!1,d.isDisposed=!1,d.maxIdleInterval=null,d.idleTimer=null,d.lastActivity=null,d}return S.prototype.connect=function(){},S.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",f.default.closed())},S.prototype.disconnect=function(T){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",T||f.default.disconnected())},S.prototype.fail=function(T){this.isConnected&&this.requestDisconnect(),this.finish("failed",T||f.default.failed())},S.prototype.finish=function(T,x){var g;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((g=this.idleTimer)!==null&&g!==void 0?g:void 0),this.idleTimer=null,this.emit(T,x),this.dispose())},S.prototype.onProtocolMessage=function(T){switch(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(T)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),T.action){case C.HEARTBEAT:l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",T.id);break;case C.CONNECTED:this.onConnect(T),this.emit("connected",T.error,T.connectionId,T.connectionDetails,T);break;case C.CLOSED:this.onClose(T);break;case C.DISCONNECTED:this.onDisconnect(T);break;case C.ACK:this.emit("ack",T.msgSerial,T.count);break;case C.NACK:this.emit("nack",T.msgSerial,T.count,T.error);break;case C.SYNC:this.connectionManager.onChannelMessage(T,this);break;case C.ACTIVATE:break;case C.AUTH:this.auth.authorize(function(x){x&&l.default.logAction(l.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+a.inspectError(x))});break;case C.ERROR:if(l.default.logAction(l.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+b.default.Config.inspect(T.error)+(T.channel?", channel: "+T.channel:"")),T.channel===void 0){this.onFatalError(T);break}this.connectionManager.onChannelMessage(T,this);break;default:this.connectionManager.onChannelMessage(T,this)}},S.prototype.onConnect=function(T){if(this.isConnected=!0,!T.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var x=T.connectionDetails.maxIdleInterval;x&&(this.maxIdleInterval=x+this.timeouts.realtimeRequestTimeout,this.onActivity())},S.prototype.onDisconnect=function(T){var x=T&&T.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onDisconnect()","err = "+a.inspectError(x)),this.finish("disconnected",x)},S.prototype.onFatalError=function(T){var x=T&&T.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onFatalError()","err = "+a.inspectError(x)),this.finish("failed",x)},S.prototype.onClose=function(T){var x=T&&T.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onClose()","err = "+a.inspectError(x)),this.finish("closed",x)},S.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestClose()",""),this.send(h)},S.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},S.prototype.ping=function(T){var x={action:i.default.Action.HEARTBEAT};T&&(x.id=T),this.send(i.default.fromValues(x))},S.prototype.dispose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},S.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=a.now(),this.setIdleTimer(this.maxIdleInterval+100))},S.prototype.setIdleTimer=function(T){var x=this;this.idleTimer||(this.idleTimer=setTimeout(function(){x.onIdleTimerExpire()},T))},S.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var T=a.now()-this.lastActivity,x=this.maxIdleInterval-T;if(x<=0){var g="No activity seen from realtime in "+T+"ms; assuming connection has dropped";l.default.logAction(l.default.LOG_ERROR,"Transport.onIdleTimerExpire()",g),this.disconnect(new m.default(g,80003,408))}else this.setIdleTimer(x+100)},S.tryConnect=function(T,x,g,y,d){var p=new T(x,g,y),O,v=function(N){clearTimeout(O),d({event:this.event,error:N})},R=x.options.timeouts.realtimeRequestTimeout;O=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),v.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},R),p.on(["failed","disconnected"],v),p.on("preconnect",function(){l.default.logAction(l.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(O),p.off(["failed","disconnected"],v),d(null,p)}),p.connect()},S}(u.default);e.default=w},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(40),t(24))})(this,function(r){return function(){var i=r,a=i.lib,u=a.Base,l=a.WordArray,f=i.algo,m=f.MD5,b=f.EvpKDF=u.extend({cfg:u.extend({keySize:128/32,hasher:m,iterations:1}),init:function(C){this.cfg=this.cfg.extend(C)},compute:function(C,h){for(var E,w=this.cfg,I=w.hasher.create(),S=l.create(),T=S.words,x=w.keySize,g=w.iterations;T.length<x;){E&&I.update(E),E=I.update(C).finalize(h),I.reset();for(var y=1;y<g;y++)E=I.finalize(E),I.reset();S.concat(E)}return S.sigBytes=x*4,S}});i.EvpKDF=function(C,h,E){return b.create(E).compute(C,h)}}(),r.EvpKDF})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(27))})(this,function(r){r.lib.Cipher||function(i){var a=r,u=a.lib,l=u.Base,f=u.WordArray,m=u.BufferedBlockAlgorithm,b=a.enc,C=b.Utf8,h=b.Base64,E=a.algo,w=E.EvpKDF,I=u.Cipher=m.extend({cfg:l.extend(),createEncryptor:function(_,L){return this.create(this._ENC_XFORM_MODE,_,L)},createDecryptor:function(_,L){return this.create(this._DEC_XFORM_MODE,_,L)},init:function(_,L,$){this.cfg=this.cfg.extend($),this._xformMode=_,this._key=L,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(_){return this._append(_),this._process()},finalize:function(_){_&&this._append(_);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function _(L){return typeof L=="string"?F:N}return function(L){return{encrypt:function($,G,K){return _(G).encrypt(L,$,G,K)},decrypt:function($,G,K){return _(G).decrypt(L,$,G,K)}}}}()}),S=u.StreamCipher=I.extend({_doFinalize:function(){var _=this._process(!0);return _},blockSize:1}),T=a.mode={},x=u.BlockCipherMode=l.extend({createEncryptor:function(_,L){return this.Encryptor.create(_,L)},createDecryptor:function(_,L){return this.Decryptor.create(_,L)},init:function(_,L){this._cipher=_,this._iv=L}}),g=T.CBC=function(){var _=x.extend();_.Encryptor=_.extend({processBlock:function($,G){var K=this._cipher,ee=K.blockSize;L.call(this,$,G,ee),K.encryptBlock($,G),this._prevBlock=$.slice(G,G+ee)}}),_.Decryptor=_.extend({processBlock:function($,G){var K=this._cipher,ee=K.blockSize,re=$.slice(G,G+ee);K.decryptBlock($,G),L.call(this,$,G,ee),this._prevBlock=re}});function L($,G,K){var ee,re=this._iv;re?(ee=re,this._iv=i):ee=this._prevBlock;for(var X=0;X<K;X++)$[G+X]^=ee[X]}return _}(),y=a.pad={},d=y.Pkcs7={pad:function(_,L){for(var $=L*4,G=$-_.sigBytes%$,K=G<<24|G<<16|G<<8|G,ee=[],re=0;re<G;re+=4)ee.push(K);var X=f.create(ee,G);_.concat(X)},unpad:function(_){var L=_.words[_.sigBytes-1>>>2]&255;_.sigBytes-=L}},p=u.BlockCipher=I.extend({cfg:I.cfg.extend({mode:g,padding:d}),reset:function(){var _;I.reset.call(this);var L=this.cfg,$=L.iv,G=L.mode;this._xformMode==this._ENC_XFORM_MODE?_=G.createEncryptor:(_=G.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==_?this._mode.init(this,$&&$.words):(this._mode=_.call(G,this,$&&$.words),this._mode.__creator=_)},_doProcessBlock:function(_,L){this._mode.processBlock(_,L)},_doFinalize:function(){var _,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),_=this._process(!0)):(_=this._process(!0),L.unpad(_)),_},blockSize:128/32}),O=u.CipherParams=l.extend({init:function(_){this.mixIn(_)},toString:function(_){return(_||this.formatter).stringify(this)}}),v=a.format={},R=v.OpenSSL={stringify:function(_){var L,$=_.ciphertext,G=_.salt;return G?L=f.create([1398893684,1701076831]).concat(G).concat($):L=$,L.toString(h)},parse:function(_){var L,$=h.parse(_),G=$.words;return G[0]==1398893684&&G[1]==1701076831&&(L=f.create(G.slice(2,4)),G.splice(0,4),$.sigBytes-=16),O.create({ciphertext:$,salt:L})}},N=u.SerializableCipher=l.extend({cfg:l.extend({format:R}),encrypt:function(_,L,$,G){G=this.cfg.extend(G);var K=_.createEncryptor($,G),ee=K.finalize(L),re=K.cfg;return O.create({ciphertext:ee,key:$,iv:re.iv,algorithm:_,mode:re.mode,padding:re.padding,blockSize:_.blockSize,formatter:G.format})},decrypt:function(_,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var K=_.createDecryptor($,G).finalize(L.ciphertext);return K},_parse:function(_,L){return typeof _=="string"?L.parse(_,this):_}}),z=a.kdf={},W=z.OpenSSL={execute:function(_,L,$,G){G||(G=f.random(64/8));var K=w.create({keySize:L+$}).compute(_,G),ee=f.create(K.words.slice(L),$*4);return K.sigBytes=L*4,O.create({key:K,iv:ee,salt:G})}},F=u.PasswordBasedCipher=N.extend({cfg:N.cfg.extend({kdf:W}),encrypt:function(_,L,$,G){G=this.cfg.extend(G);var K=G.kdf.execute($,_.keySize,_.ivSize);G.iv=K.iv;var ee=N.encrypt.call(this,_,L,K.key,G);return ee.mixIn(K),ee},decrypt:function(_,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var K=G.kdf.execute($,_.keySize,_.ivSize,L.salt);G.iv=K.iv;var ee=N.decrypt.call(this,_,L,K.key,G);return ee}})}()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(12)),u=r.__importDefault(t(3)),l=r.__importDefault(t(7)),f=t(4),m=r.__importDefault(t(8)),b=r.__importDefault(t(2)),C=r.__importDefault(t(21)),h=i.getGlobalObject(),E=function(){},w=h._ablyjs_jsonp={};w._=function(d){return w["_"+d]||E};var I=1,S="jsonp";function T(d,p,O,v,R,N,z){return N=N||m.default.TIMEOUTS,new g(void 0,d,p,i.copy(O),v,R,N,z)}e.createRequest=T;var x=function(d){r.__extends(p,d);function p(O,v,R){var N=d.call(this,O,v,R)||this;return N.shortName=S,R.stream=!1,N}return p.isAvailable=function(){return u.default.Config.jsonpSupported&&u.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(O,v,R,N,z,W,F){return W=(this===null||this===void 0?void 0:this.timeouts)||W||m.default.TIMEOUTS,T(O,v,R,N,z,W,F)},p}(a.default),g=function(d){r.__extends(p,d);function p(O,v,R,N,z,W,F,_){var L=d.call(this)||this;return O===void 0&&(O=I++),L.id=O,L.uri=v,L.params=N||{},L.params.rnd=i.cheapRandStr(),R&&(R["X-Ably-Version"]&&(L.params.v=R["X-Ably-Version"]),R["X-Ably-Lib"]&&(L.params.lib=R["X-Ably-Lib"])),L.body=z,L.method=_,L.requestMode=W,L.timeouts=F,L.requestComplete=!1,L}return p.prototype.exec=function(){var O=this,v=this.id,R=this.body,N=this.method,z=this.uri,W=this.params;W.callback="_ablyjs_jsonp._("+v+")",W.envelope="jsonp",R&&(W.body=R),N&&N!=="get"&&(W.method=N);var F=this.script=document.createElement("script"),_=z+i.toQueryString(W);F.src=_,F.src.split("/").slice(-1)[0]!==_.split("/").slice(-1)[0]&&b.default.logAction(b.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),F.async=!0,F.type="text/javascript",F.charset="UTF-8",F.onerror=function(G){O.complete(new f.PartialErrorInfo("JSONP script error (event: "+u.default.Config.inspect(G)+")",null,400))},w["_"+v]=function(G){if(G.statusCode){var K=G.response;if(G.statusCode==204)O.complete(null,null,null,G.statusCode);else if(!K)O.complete(new f.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||i.isArray(K))O.complete(null,K,G.headers,G.statusCode);else{var ee=K.error||new f.PartialErrorInfo("Error response received from server",null,G.statusCode);O.complete(ee)}}else O.complete(null,G)};var L=this.requestMode==C.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),L);var $=document.getElementsByTagName("head")[0];$.insertBefore(F,$.firstChild)},p.prototype.complete=function(O,v,R,N){if(R=R||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;v&&(z=typeof v=="string"?"text/plain":"application/json",R["content-type"]=z,this.emit("data",v)),this.emit("complete",O,v,R,!0,N),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var O=this.timer;O&&(clearTimeout(O),this.timer=null);var v=this.script;v.parentNode&&v.parentNode.removeChild(v),delete w[this.id],this.emit("disposed")},p}(l.default);e.Request=g;function y(d){return h.JSONPTransport=x,x.isAvailable()&&(d.supportedTransports[S]=x),x}e.default=y},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(2)),u=r.__importDefault(t(8)),l=r.__importDefault(t(17)),f=r.__importDefault(t(46)),m=r.__importDefault(t(19)),b=r.__importDefault(t(33)),C=r.__importDefault(t(4)),h=r.__importDefault(t(49)),E=r.__importDefault(t(18)),w=r.__importDefault(t(3)),I=r.__importDefault(t(9)),S=r.__importDefault(t(15)),T=r.__importDefault(t(14)),x=function(){},g=function(){function d(p){if(!p){var O="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",O),new Error(O)}var v=u.default.objectifyOptions(p);v.log&&a.default.setLog(v.log.level,v.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(p));var R=this.options=u.default.normaliseOptions(v);if(R.key){var N=R.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!N){var O="invalid key parameter";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",O),new C.default(O,40400,404)}R.keyName=N[1],R.keySecret=N[2]}if("clientId"in R)if(typeof R.clientId=="string"||R.clientId===null){if(R.clientId==="*")throw new C.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new C.default("clientId must be either a string or null",40012,400);a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+u.default.version),this.baseUri=this.authority=function(z){return u.default.getHttpScheme(R)+z+":"+u.default.getPort(R,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http(R),this.auth=new l.default(this,R),this.channels=new y(this),this.push=new f.default(this)}return d.prototype.stats=function(p,O){if(O===void 0)if(typeof p=="function")O=p,p=null;else{if(this.options.promises)return i.promisify(this,"stats",[p]);O=x}var v=i.defaultGetHeaders(this.options),R=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,N=this.http.supportsLinkHeaders?void 0:R;this.options.headers&&i.mixin(v,this.options.headers),new m.default(this,"/stats",v,N,function(z,W,F){for(var _=F?z:JSON.parse(z),L=0;L<_.length;L++)_[L]=h.default.fromValues(_[L]);return _}).get(p,O)},d.prototype.time=function(p,O){var v=this;if(O===void 0){if(typeof p=="function")O=p,p=null;else if(this.options.promises)return i.promisify(this,"time",[p])}var R=O||x,N=i.defaultGetHeaders(this.options);this.options.headers&&i.mixin(N,this.options.headers);var z=function(W){return v.authority(W)+"/time"};this.http.do(E.default.Get,this,z,N,null,p,function(W,F,_,L){if(W){R(W);return}L||(F=JSON.parse(F));var $=F[0];if(!$){R(new C.default("Internal error (unexpected result type from GET /time)",5e4,500));return}v.serverTimeOffset=$-i.now(),R(null,$)})},d.prototype.request=function(p,O,v,R,N,z){var W=this.options.useBinaryProtocol,F=W?w.default.Config.msgpack.encode:JSON.stringify,_=W?w.default.Config.msgpack.decode:JSON.parse,L=W?i.Format.msgpack:i.Format.json,$=this.http.supportsLinkHeaders?void 0:L;v=v||{};var G=p.toLowerCase(),K=G=="get"?i.defaultGetHeaders(this.options,L):i.defaultPostHeaders(this.options,L);if(z===void 0){if(this.options.promises)return i.promisify(this,"request",[p,O,v,R,N]);z=x}typeof R!="string"&&(R=F(R)),this.options.headers&&i.mixin(K,this.options.headers),N&&i.mixin(K,N);var ee=new m.default(this,O,K,$,function(re,X,P){return i.ensureArray(P?re:_(re))},!0);if(!i.arrIn(w.default.Http.methods,G))throw new C.default("Unsupported method "+G,40500,405);i.arrIn(w.default.Http.methodsWithBody,G)?ee[G](v,R,z):ee[G](v,z)},d.prototype.batchPublish=function(p,O){if(O===void 0){if(this.options.promises)return i.promisify(this,"batchPublish",[p]);O=x}var v=O,R,N;i.isArray(p)?(R=p,N=!1):(R=[p],N=!0);var z=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,W=i.defaultPostHeaders(this.options,z);this.options.headers&&i.mixin(W,this.options.headers);var F=i.encodeBody(R,z);T.default.post(this,"/messages",F,W,{newBatchResponse:"true"},null,function(_,L,$,G){if(_){v(_);return}var K=G?L:i.decodeBody(L,z);N?v(null,K[0]):v(null,K)})},d.prototype.batchPresence=function(p,O){if(O===void 0){if(this.options.promises)return i.promisify(this,"batchPresence",[p]);O=x}var v=O,R=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,N=i.defaultPostHeaders(this.options,R);this.options.headers&&i.mixin(N,this.options.headers);var z=p.join(",");T.default.get(this,"/presence",N,{newBatchResponse:"true",channels:z},null,function(W,F,_,L){if(W){v(W);return}var $=L?F:i.decodeBody(F,R);v(null,$)})},d.prototype.setLog=function(p){a.default.setLog(p.level,p.handler)},d.Promise=function(p){return p=u.default.objectifyOptions(p),p.promises=!0,new d(p)},d.Callbacks=d,d.Platform=w.default,d.Message=I.default,d.PresenceMessage=S.default,d}(),y=function(){function d(p){this.rest=p,this.all=Object.create(null)}return d.prototype.get=function(p,O){p=String(p);var v=this.all[p];return v?O&&v.setOptions(O):this.all[p]=v=new b.default(this.rest,p,O),v},d.prototype.release=function(p){delete this.all[String(p)]},d}();e.default=g},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return r.enc.Utf8})},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(i){var a=r,u=a.lib,l=u.WordArray,f=u.Hasher,m=a.algo,b=[],C=[];(function(){function w(x){for(var g=i.sqrt(x),y=2;y<=g;y++)if(!(x%y))return!1;return!0}function I(x){return(x-(x|0))*4294967296|0}for(var S=2,T=0;T<64;)w(S)&&(T<8&&(b[T]=I(i.pow(S,1/2))),C[T]=I(i.pow(S,1/3)),T++),S++})();var h=[],E=m.SHA256=f.extend({_doReset:function(){this._hash=new l.init(b.slice(0))},_doProcessBlock:function(w,I){for(var S=this._hash.words,T=S[0],x=S[1],g=S[2],y=S[3],d=S[4],p=S[5],O=S[6],v=S[7],R=0;R<64;R++){if(R<16)h[R]=w[I+R]|0;else{var N=h[R-15],z=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,W=h[R-2],F=(W<<15|W>>>17)^(W<<13|W>>>19)^W>>>10;h[R]=z+h[R-7]+F+h[R-16]}var _=d&p^~d&O,L=T&x^T&g^x&g,$=(T<<30|T>>>2)^(T<<19|T>>>13)^(T<<10|T>>>22),G=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),K=v+G+_+C[R]+h[R],ee=$+L;v=O,O=p,p=d,d=y+K|0,y=g,g=x,x=T,T=K+ee|0}S[0]=S[0]+T|0,S[1]=S[1]+x|0,S[2]=S[2]+g|0,S[3]=S[3]+y|0,S[4]=S[4]+d|0,S[5]=S[5]+p|0,S[6]=S[6]+O|0,S[7]=S[7]+v|0},_doFinalize:function(){var w=this._data,I=w.words,S=this._nDataBytes*8,T=w.sigBytes*8;return I[T>>>5]|=128<<24-T%32,I[(T+64>>>9<<4)+14]=i.floor(S/4294967296),I[(T+64>>>9<<4)+15]=S,w.sigBytes=I.length*4,this._process(),this._hash},clone:function(){var w=f.clone.call(this);return w._hash=this._hash.clone(),w}});a.SHA256=f._createHelper(E),a.HmacSHA256=f._createHmacHelper(E)}(Math),r.SHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),u=r.__importDefault(t(2)),l=r.__importDefault(t(34)),f=r.__importDefault(t(9)),m=r.__importDefault(t(4)),b=r.__importDefault(t(19)),C=r.__importDefault(t(14)),h=r.__importDefault(t(3));function E(){}var w=9;function I(x){return i.arrEvery(x,function(g){return!g.id})}function S(x){var g=x||{};if(g.cipher){if(!h.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var y=h.default.Crypto.getCipher(g.cipher);g.cipher=y.cipherParams,g.channelCipher=y.cipher}else"cipher"in g&&(g.cipher=void 0,g.channelCipher=null);return g}var T=function(x){r.__extends(g,x);function g(y,d,p){var O=x.call(this)||this;return u.default.logAction(u.default.LOG_MINOR,"Channel()","started; name = "+d),O.rest=y,O.name=d,O.basePath="/channels/"+encodeURIComponent(d),O.presence=new l.default(O),O.channelOptions=S(p),O}return g.prototype.setOptions=function(y){this.channelOptions=S(y)},g.prototype.history=function(y,d){if(u.default.logAction(u.default.LOG_MICRO,"Channel.history()","channel = "+this.name),d===void 0)if(typeof y=="function")d=y,y=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);d=E}this._history(y,d)},g.prototype._history=function(y,d){var p=this.rest,O=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:O,R=i.defaultGetHeaders(p.options,O);p.options.headers&&i.mixin(R,p.options.headers);var N=this.channelOptions;new b.default(p,this.basePath+"/messages",R,v,function(z,W,F){return f.default.fromResponseBody(z,N,F?void 0:O)}).get(y,d)},g.prototype.publish=function(){var y=this,d=arguments.length,p=arguments[0],O=arguments[1],v=arguments[d-1],R,N;if(typeof v!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);v=E}if(typeof p=="string"||p===null)R=[f.default.fromValues({name:p,data:O})],N=arguments[2];else if(i.isObject(p))R=[f.default.fromValues(p)],N=arguments[1];else if(i.isArray(p))R=f.default.fromValuesArray(p),N=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof N!="object"||!N)&&(N={});var z=this.rest,W=z.options,F=W.useBinaryProtocol?i.Format.msgpack:i.Format.json,_=z.options.idempotentRestPublishing,L=i.defaultPostHeaders(z.options,F);if(W.headers&&i.mixin(L,W.headers),_&&I(R)){var $=i.randomString(w);i.arrForEach(R,function(G,K){G.id=$+":"+K.toString()})}f.default.encodeArray(R,this.channelOptions,function(G){if(G){v(G);return}var K=f.default.getMessagesSize(R),ee=W.maxMessageSize;if(K>ee){v(new m.default("Maximum size of messages that can be published at once exceeded ( was "+K+" bytes; limit is "+ee+" bytes)",40009,400));return}y._publish(f.default.serialize(R,F),L,N,v)})},g.prototype._publish=function(y,d,p,O){C.default.post(this.rest,this.basePath+"/messages",y,d,p,null,O)},g.prototype.status=function(y){if(typeof y!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var d=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(this.rest.options,d);C.default.get(this.rest,this.basePath,p,{},d,y||E)},g}(a.default);e.default=T},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),u=r.__importDefault(t(2)),l=r.__importDefault(t(19)),f=r.__importDefault(t(15));function m(){}var b=function(C){r.__extends(h,C);function h(E){var w=C.call(this)||this;return w.channel=E,w.basePath=E.basePath+"/presence",w}return h.prototype.get=function(E,w){if(u.default.logAction(u.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);w=m}var I=this.channel.rest,S=I.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,T=this.channel.rest.http.supportsLinkHeaders?void 0:S,x=i.defaultGetHeaders(I.options,S);I.options.headers&&i.mixin(x,I.options.headers);var g=this.channel.channelOptions;new l.default(I,this.basePath,x,T,function(y,d,p){return f.default.fromResponseBody(y,g,p?void 0:S)}).get(E,w)},h.prototype.history=function(E,w){return u.default.logAction(u.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,w)},h.prototype._history=function(E,w){if(w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",[E]);w=m}var I=this.channel.rest,S=I.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,T=this.channel.rest.http.supportsLinkHeaders?void 0:S,x=i.defaultGetHeaders(I.options,S);I.options.headers&&i.mixin(x,I.options.headers);var g=this.channel.channelOptions;new l.default(I,this.basePath+"/history",x,T,function(y,d,p){return f.default.fromResponseBody(y,g,p?void 0:S)}).get(E,w)},h}(a.default);e.default=b},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var i=t(0),a=i.__importDefault(t(10)),u=i.__importStar(t(1)),l=i.__importStar(t(52)),f=i.__importStar(t(8)),m=i.__importDefault(t(3)),b=i.__importDefault(t(7)),C=i.__importDefault(t(36)),h=i.__importDefault(t(2)),E=i.__importDefault(t(37)),w=i.__importStar(t(20)),I=i.__importStar(t(4)),S=i.__importDefault(t(17)),T=i.__importDefault(t(9)),x=i.__importDefault(t(23)),g=i.__importDefault(t(53)),y=i.__importDefault(t(26)),d=i.__importDefault(t(25)),p=function(){var re;return typeof m.default.WebStorage!="undefined"&&((re=m.default.WebStorage)===null||re===void 0?void 0:re.localSupported)},O=function(){var re;return typeof m.default.WebStorage!="undefined"&&((re=m.default.WebStorage)===null||re===void 0?void 0:re.sessionSupported)},v=a.default.Action,R=function(){},N="ably-transport-preference",z="ably-connection-recovery";function W(){var re,X;return O()&&((X=(re=m.default.WebStorage)===null||re===void 0?void 0:re.getSession)===null||X===void 0?void 0:X.call(re,z))}function F(re){var X,P;return O()&&((P=(X=m.default.WebStorage)===null||X===void 0?void 0:X.setSession)===null||P===void 0?void 0:P.call(X,z,re))}function _(){var re,X;return O()&&((X=(re=m.default.WebStorage)===null||re===void 0?void 0:re.removeSession)===null||X===void 0?void 0:X.call(re,z))}function L(re,X){return u.arrIndexOf(m.default.Defaults.transportPreferenceOrder,re.shortName)>u.arrIndexOf(m.default.Defaults.transportPreferenceOrder,X.shortName)}function $(re,X,P){var B;if(re.channel!==X.channel||(B=re.action)!==v.PRESENCE&&B!==v.MESSAGE||B!==X.action)return!1;var H=B===v.PRESENCE?"presence":"messages",j=re[H].concat(X[H]),te=T.default.getMessagesSize(j);return te>P||!u.allSame(j,"clientId")||!u.arrEvery(j,function(ce){return!ce.id})?!1:(re[H]=j,!0)}function G(re){try{return JSON.parse(re)}catch(X){return null}}var K=function(){function re(X,P,B,H){this.options=X,this.host=P,this.mode=B,this.connectionKey=H,this.format=X.useBinaryProtocol?u.Format.msgpack:u.Format.json}return re.prototype.getConnectParams=function(X){var P=X?u.copy(X):{},B=this.options;switch(this.mode){case"upgrade":P.upgrade=this.connectionKey;break;case"resume":P.resume=this.connectionKey;break;case"recover":{var H=G(B.recover);H&&(P.recover=H.connectionKey);break}default:}return B.clientId!==void 0&&(P.clientId=B.clientId),B.echoMessages===!1&&(P.echo="false"),this.format!==void 0&&(P.format=this.format),this.stream!==void 0&&(P.stream=this.stream),this.heartbeats!==void 0&&(P.heartbeats=this.heartbeats),P.v=f.default.protocolVersion,P.agent=encodeURIComponent((0,f.getAgentString)(this.options)),B.transportParams!==void 0&&u.mixin(P,B.transportParams),P},re.prototype.toString=function(){var X="[mode="+this.mode;return this.host&&(X+=",host="+this.host),this.connectionKey&&(X+=",connectionKey="+this.connectionKey),this.format&&(X+=",format="+this.format),X+="]",X},re}();e.TransportParams=K;var ee=function(re){i.__extends(X,re);function X(P,B){var H=re.call(this)||this;H.disconnectedRetryCount=0,X.initTransports(),H.realtime=P,H.options=B;var j=B.timeouts,te=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:te,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new C.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=j.connectionStateTtl,H.maxIdleInterval=null,H.transports=u.intersect(B.transports||f.default.defaultTransports,X.supportedTransports),H.baseTransport=u.intersect(f.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=u.intersect(H.transports,f.default.upgradeTransports),H.transportPreference=null,H.httpHosts=f.default.getHosts(B),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,h.default.logAction(h.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(B.transports||f.default.defaultTransports)+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var ce="no requested transports available";throw h.default.logAction(h.default.LOG_ERROR,"realtime.ConnectionManager()",ce),new Error(ce)}var me=m.default.Config.addEventListener;return me&&(O()&&typeof B.recover=="function"&&me("beforeunload",H.persistConnection.bind(H)),B.closeOnUnload===!0&&me("beforeunload",function(){h.default.logAction(h.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),me("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(be){be.off()}),H.disconnectAllTransports(),H.startConnect())}),me("offline",function(){H.state==H.states.connected&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return X.initTransports=function(){(0,g.default)(X),u.arrForEach(m.default.Transports,function(P){P(X)})},X.prototype.createTransportParams=function(P,B){return new K(this.options,P,B,this.connectionKey)},X.prototype.getTransportParams=function(P){var B=this,H=function(j){if(B.connectionKey){j("resume");return}if(typeof B.options.recover=="string"){j("recover");return}var te=B.options.recover,ce=W();if(ce&&typeof te=="function"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),te(ce,function(me){me?(B.options.recover=ce.recoveryKey,j("recover")):j("clean")});return}j("clean")};H(function(j){var te=B.createTransportParams(null,j);if(j==="recover"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+B.options.recover);var ce=G(B.options.recover);ce&&(B.msgSerial=ce.msgSerial)}else h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+te.toString());P(te)})},X.prototype.tryATransport=function(P,B,H){var j=this;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+B),y.default.tryConnect(X.supportedTransports[B],this,this.realtime.auth,P,function(te,ce){var me=j.state;if(me==j.states.closing||me==j.states.closed||me==j.states.failed){ce&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+me.state+" while we were attempting the transport; closing "+ce),ce.close()),H(!0);return}if(te){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+B+" "+te.event+", err: "+te.error.toString()),S.default.isTokenErr(te.error)&&!(j.errorReason&&S.default.isTokenErr(j.errorReason))?(j.errorReason=te.error,j.realtime.auth._forceNewToken(null,null,function(be){if(be){j.actOnErrorFromAuthorize(be);return}j.tryATransport(P,B,H)})):te.event==="failed"?(j.notifyState({state:"failed",error:te.error}),H(!0)):te.event==="disconnected"&&((0,w.isRetriable)(te.error)?H(!1):(j.notifyState({state:j.states.connecting.failState,error:te.error}),H(!0)));return}h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+B+"; setting pending"),j.setTransportPending(ce,P),H(null,ce)})},X.prototype.setTransportPending=function(P,B){var H=this,j=B.mode;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+P+"; mode = "+j),u.arrDeleteValue(this.proposedTransports,P),this.pendingTransports.push(P);var te=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];P.once("connected",function(me,be,Se){j=="upgrade"&&H.activeProtocol?P.shortName!==te&&u.arrIn(H.getUpgradePossibilities(),te)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(me,P,be,Se)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(me,P,be,Se):(H.activateTransport(me,P,be,Se),m.default.Config.nextTick(function(){H.connectImpl(B)})),j==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var ce=this;P.on(["disconnected","closed","failed"],function(me){ce.deactivateTransport(P,this.event,me)}),this.emit("transport.pending",P)},X.prototype.scheduleTransportActivation=function(P,B,H,j){var te=this,ce=this.activeProtocol&&this.activeProtocol.getTransport(),me=function(){B.disconnect(),u.arrDeleteValue(te.pendingTransports,B)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),me();return}if(ce&&!L(B,ce)){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+" is no better than current active transport "+ce.shortName+" - abandoning upgrade"),me();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+B);var be=null;if(!B.isConnected){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+"is no longer connected; abandoning upgrade"),me();return}if(this.state===this.states.connected)h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,be=this.activeProtocol;else if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),me();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+B);var Se=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+B),B.send(a.default.fromValues({action:v.ACTIVATE})),te.activateTransport(P,B,H,j),te.state===te.states.synchronizing?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+B),te.state=te.states.connected):h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+te.state.state+", so leaving unchanged"),te.state.sendEvents&&te.sendQueuedMessages()};be?be.onceIdle(Se):Se()},X.prototype.activateTransport=function(P,B,H,j){var te=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+B),P&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+P),H&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),j&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(B);var ce=this.state,me=this.states.connected.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ce.state),ce.state==this.states.closing.state||ce.state==this.states.closed.state||ce.state==this.states.failed.state)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),B.disconnect(),!1;if(u.arrDeleteValue(this.pendingTransports,B),!B.isConnected)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+B+" since it appears to no longer be connected"),!1;var be=this.activeProtocol;this.activeProtocol=new l.default(B),this.host=B.params.host;var Se=j.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(H,j,!!P),this.onConnectionDetailsUpdate(j,B),m.default.Config.nextTick(function(){B.on("connected",function(de,Ze,bt){te.onConnectionDetailsUpdate(bt,B),te.emit("update",new E.default(me,me,null,de))})}),ce.state===this.states.connected.state?P&&(this.errorReason=this.realtime.connection.errorReason=P,this.emit("update",new E.default(me,me,null,P))):(this.notifyState({state:"connected",error:P}),this.errorReason=this.realtime.connection.errorReason=P||null),this.emit("transport.active",B),be)if(be.messageQueue.count()>0&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+be.transport.shortName+", new one is "+B.shortName+") finishing with "+be.messageQueue.count()+" messages still pending"),be.transport===B){var $e="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",$e)}else be.finish();return u.safeArrForEach(this.pendingTransports,function(de){if(de===B){var Ze="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+B.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Ze),u.arrDeleteValue(te.pendingTransports,B)}else de.disconnect()}),u.safeArrForEach(this.proposedTransports,function(de){de===B?(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+B.shortName+"; stack = "+new Error().stack),u.arrDeleteValue(te.proposedTransports,B)):de.dispose()}),!0},X.prototype.deactivateTransport=function(P,B,H){var j=this.activeProtocol,te=j&&j.getTransport()===P,ce=u.arrDeleteValue(this.pendingTransports,P),me=u.arrDeleteValue(this.proposedTransports,P),be=this.noTransportsScheduledForActivation();if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+P),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+B+(te?"; was active":ce?"; was pending":me?"; was proposed":"")+(be?"":"; another transport is scheduled for activation")),H&&H.message&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),te&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),m.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",P),te&&be||te&&B==="failed"||B==="closed"||j===null&&ce&&this.pendingTransports.length===0){if(B==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:B,error:H,retryImmediately:!0});return}var Se=B==="failed"&&S.default.isTokenErr(H)?"disconnected":B;this.notifyState({state:Se,error:H});return}te&&B==="disconnected"&&this.state!==this.states.synchronizing&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},X.prototype.noTransportsScheduledForActivation=function(){return u.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(P){return!P.isConnected})},X.prototype.setConnection=function(P,B,H){var j=this.connectionId,te=j&&j!==P,ce=!j&&H;(te||ce)&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==P&&h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=P,this.realtime.connection.key=this.connectionKey=B.connectionKey},X.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},X.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},X.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var P=u.now()-this.lastActivity;P>this.connectionStateTtl+this.maxIdleInterval&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+P+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},X.prototype.persistConnection=function(){if(O()){var P=this.createRecoveryKey();P&&F({recoveryKey:P,disconnectedAt:u.now(),location:r.location,clientId:this.realtime.auth.clientId})}},X.prototype.unpersistConnection=function(){_()},X.prototype.getError=function(){return this.errorReason||this.getStateError()},X.prototype.getStateError=function(){var P,B;return(B=(P=w.default)[this.state.state])===null||B===void 0?void 0:B.call(P)},X.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},X.prototype.enactStateChange=function(P){var B=P.current==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(B,"Connection state",P.current+(P.reason?"; reason: "+P.reason:"")),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+P.current+"; reason = "+(P.reason&&P.reason.message));var H=this.state=this.states[P.current];P.reason&&(this.errorReason=P.reason,this.realtime.connection.errorReason=P.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",P)},X.prototype.startTransitionTimer=function(P){var B=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+P.state),this.transitionTimer&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){B.transitionTimer&&(B.transitionTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager "+P.state+" timer expired","requesting new state: "+P.failState),B.notifyState({state:P.failState}))},P.retryDelay)},X.prototype.cancelTransitionTimer=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},X.prototype.startSuspendTimer=function(){var P=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){P.suspendTimer&&(P.suspendTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),P.states.connecting.failState="suspended",P.notifyState({state:"suspended"}))},this.connectionStateTtl))},X.prototype.checkSuspendTimer=function(P){P!=="disconnected"&&P!=="suspended"&&P!=="connecting"&&this.cancelSuspendTimer()},X.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},X.prototype.startRetryTimer=function(P){var B=this;this.retryTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),B.retryTimer=null,B.requestState({state:"connecting"})},P)},X.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},X.prototype.notifyState=function(P){var B=this,H,j,te=P.state,ce=te==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||P.retryImmediately||this.state===this.states.connecting&&P.error&&S.default.isTokenErr(P.error)&&!(this.errorReason&&S.default.isTokenErr(this.errorReason)));if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+te+(ce?"; will retry connection immediately":"")),te!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(P.state),(te==="suspended"||te==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var me=this.states[P.state],be=me.retryDelay;me.state==="disconnected"&&(this.disconnectedRetryCount++,be=u.getRetryTime(me.retryDelay,this.disconnectedRetryCount));var Se=new E.default(this.state.state,me.state,be,P.error||((j=(H=w.default)[me.state])===null||j===void 0?void 0:j.call(H)));if(ce){var $e=function(){B.state===B.states.disconnected&&(B.lastAutoReconnectAttempt=u.now(),B.requestState({state:"connecting"}))},de=this.lastAutoReconnectAttempt&&u.now()-this.lastAutoReconnectAttempt+1;de&&de<1e3?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+de+"ms ago, waiting another "+(1e3-de)+"ms before trying again"),setTimeout($e,1e3-de)):m.default.Config.nextTick($e)}else(te==="disconnected"||te==="suspended")&&this.startRetryTimer(be);(te==="disconnected"&&!ce||te==="suspended"||me.terminal)&&m.default.Config.nextTick(function(){B.disconnectAllTransports()}),te=="connected"&&!this.activeProtocol&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(Se),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(te,Se.reason),this.failQueuedMessages(Se.reason))}},X.prototype.requestState=function(P){var B=this,H,j,te=P.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+te+"; current state: "+this.state.state),te!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(te),!(te=="connecting"&&this.state.state=="connected")&&!(te=="closing"&&this.state.state=="closed"))){var ce=this.states[te],me=new E.default(this.state.state,ce.state,null,P.error||((j=(H=w.default)[ce.state])===null||j===void 0?void 0:j.call(H)));this.enactStateChange(me),te=="connecting"&&m.default.Config.nextTick(function(){B.startConnect()}),te=="closing"&&this.closeImpl()}},X.prototype.startConnect=function(){var P=this;if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var B=this.realtime.auth,H=++this.connectCounter,j=function(){P.checkConnectionStateFreshness(),P.getTransportParams(function(ce){if(ce.mode==="recover"&&ce.options.recover){var me=G(ce.options.recover);me&&P.realtime.channels.recoverChannels(me.channelSerials)}H===P.connectCounter&&P.connectImpl(ce,H)})};if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),B.method==="basic")j();else{var te=function(ce){H===P.connectCounter&&(ce?P.actOnErrorFromAuthorize(ce):j())};this.errorReason&&S.default.isTokenErr(this.errorReason)?B._forceNewToken(null,null,te):B._ensureValidAuthCredentials(!1,te)}},X.prototype.connectImpl=function(P,B){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(P):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(P,B):this.connectBase(P,B)},X.prototype.connectPreference=function(P,B){var H=this,j=this.getTransportPreference(),te=!1;u.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(P,B)),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var ce=setTimeout(function(){te=!0,H.state.state!==H.states.connected.state&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(P,B)},this.options.timeouts.preferenceConnectTimeout);P.host=this.httpHosts[0],this.tryATransport(P,j,function(me,be){clearTimeout(ce),te&&be?(be.off(),be.disconnect(),u.arrDeleteValue(H.pendingTransports,be)):!be&&!me&&(H.unpersistTransportPreference(),H.connectImpl(P,B))})},X.prototype.connectBase=function(P,B){var H=this,j=function(Se){H.notifyState({state:H.states.connecting.failState,error:Se})},te=this.httpHosts.slice(),ce=function(Se,$e){B===H.connectCounter&&!$e&&!Se&&be()};h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var me=te.shift();if(!me){j(new I.default("Unable to connect (no available host)",80003,404));return}P.host=me;var be=function(){if(!te.length){j(new I.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){j(new I.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(Se,$e){if(B===H.connectCounter){if(Se){j(Se);return}if(!$e){j(new I.default("Unable to connect (network unreachable)",80003,404));return}P.host=u.arrPopRandomElement(te),H.tryATransport(P,H.baseTransport,ce)}})};if(this.forceFallbackHost&&te.length){this.forceFallbackHost=!1,be();return}this.tryATransport(P,this.baseTransport,ce)},X.prototype.getUpgradePossibilities=function(){var P=this.activeProtocol.getTransport().shortName,B=u.arrIndexOf(this.upgradeTransports,P);return this.upgradeTransports.slice(B+1)},X.prototype.upgradeIfNeeded=function(P){var B=this,H=this.getUpgradePossibilities();h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(H)),H.length&&u.arrForEach(H,function(j){var te=B.createTransportParams(P.host,"upgrade");B.tryATransport(te,j,R)})},X.prototype.closeImpl=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),u.safeArrForEach(this.pendingTransports,function(P){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+P),P&&P.close()}),u.safeArrForEach(this.proposedTransports,function(P){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+P),P&&P.dispose()}),this.activeProtocol&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},X.prototype.onAuthUpdated=function(P,B){var H=this,j;switch(this.state.state){case"connected":{if(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var te=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(te)})}var ce=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();ce&&ce.onAuthUpdated&&ce.onAuthUpdated(P);var me=a.default.fromValues({action:v.AUTH,auth:{accessToken:P.token}});this.send(me);var be=function(){H.off(Se),B(null,P)},Se=function(de){de.current==="failed"&&(H.off(be),H.off(Se),B(de.reason||H.getStateError()))};this.once("connectiondetails",be),this.on("connectionstate",Se);break}case"connecting":h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var $e=function(de){switch(de.current){case"connected":H.off($e),B(null,P);break;case"failed":case"closed":case"suspended":H.off($e),B(de.reason||H.getStateError());break;default:break}};this.on("connectionstate",$e),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},X.prototype.disconnectAllTransports=function(P){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(P?" except the active transport":"")),this.connectCounter++,u.safeArrForEach(this.pendingTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+B),B&&B.disconnect()}),this.pendingTransports=[],u.safeArrForEach(this.proposedTransports,function(B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+B),B&&B.dispose()}),this.proposedTransports=[],this.activeProtocol&&!P&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},X.prototype.send=function(P,B,H){H=H||R;var j=this.state;if(j.sendEvents){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new l.PendingMessage(P,H));return}var te=B&&j.queueEvents||j.forceQueueEvents;if(!te){var ce="rejecting event, queueEvent was "+B+", state was "+j.state;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()",ce),H(this.errorReason||new I.default(ce,9e4,400));return}h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(P)),this.queue(P,H)},X.prototype.sendImpl=function(P){var B=P.message;P.ackRequired&&!P.sendAttempted&&(B.msgSerial=this.msgSerial++);try{this.activeProtocol.send(P)}catch(H){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},X.prototype.queue=function(P,B){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),j=this.options.maxMessageSize;H&&!H.sendAttempted&&$(H.message,P,j)?(H.merged||(H.callback=x.default.create([H.callback]),H.merged=!0),H.callback.push(B)):this.queuedMessages.push(new l.PendingMessage(P,B))},X.prototype.sendQueuedMessages=function(){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var P;P=this.queuedMessages.shift();)this.sendImpl(P)},X.prototype.queuePendingMessages=function(P){P&&P.length&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+P.length+" pending messages"),this.queuedMessages.prepend(P))},X.prototype.failQueuedMessages=function(P){var B=this.queuedMessages.count();B>0&&(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+B+" queued messages, err = "+u.inspectError(P)),this.queuedMessages.completeAllMessages(P))},X.prototype.onChannelMessage=function(P,B){var H=this.activeProtocol&&B===this.activeProtocol.getTransport(),j=u.arrIn(this.pendingTransports,B)&&this.state==this.states.synchronizing;H||j?this.realtime.channels.onChannelMessage(P):u.arrIndexOf([v.ACK,v.NACK,v.ERROR],P.action)>-1?this.realtime.channels.onChannelMessage(P):h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(P)+"on defunct transport; discarding")},X.prototype.ping=function(P,B){var H=this;if(P){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+P);var j=function(){P.off("heartbeat",me),B(new I.default("Timeout waiting for heartbeat response",5e4,500))},te=u.now(),ce=u.cheapRandStr(),me=function(Ze){if(Ze===ce){P.off("heartbeat",me),clearTimeout(be);var bt=u.now()-te;B(null,bt)}},be=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);P.on("heartbeat",me),P.ping(ce);return}if(this.state.state!=="connected"){B(new I.default("Unable to ping service; not connected",4e4,400));return}var Se=!1,$e=function(Ze,bt){H.off("transport.active",de),Se||(Se=!0,B(Ze,bt))},de=function(){Se||(Se=!0,m.default.Config.nextTick(function(){H.ping(null,B)}))};this.on("transport.active",de),this.ping(this.activeProtocol.getTransport(),$e)},X.prototype.abort=function(P){this.activeProtocol.getTransport().fail(P)},X.prototype.registerProposedTransport=function(P){this.proposedTransports.push(P)},X.prototype.getTransportPreference=function(){var P,B;return this.transportPreference||p()&&((B=(P=m.default.WebStorage)===null||P===void 0?void 0:P.get)===null||B===void 0?void 0:B.call(P,N))},X.prototype.persistTransportPreference=function(P){var B,H;u.arrIn(f.default.upgradeTransports,P.shortName)&&(this.transportPreference=P.shortName,p()&&((H=(B=m.default.WebStorage)===null||B===void 0?void 0:B.set)===null||H===void 0||H.call(B,N,P.shortName)))},X.prototype.unpersistTransportPreference=function(){var P,B;this.transportPreference=null,p()&&((B=(P=m.default.WebStorage)===null||P===void 0?void 0:P.remove)===null||B===void 0||B.call(P,N))},X.prototype.actOnErrorFromAuthorize=function(P){if(P.code===40171)this.notifyState({state:"failed",error:P});else if(P.code===40102)this.notifyState({state:"failed",error:P});else if(P.statusCode===d.default.Forbidden){var B="Client configured authentication provider returned 403; failing the connection";h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",B),this.notifyState({state:"failed",error:new I.default(B,80019,403,P)})}else{var B="Client configured authentication provider request failed";h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",B),this.notifyState({state:this.state.failState,error:new I.default(B,80019,401,P)})}},X.prototype.onConnectionDetailsUpdate=function(P,B){if(!!P){this.connectionDetails=P,P.maxMessageSize&&(this.options.maxMessageSize=P.maxMessageSize);var H=P.clientId;if(H){var j=this.realtime.auth._uncheckedSetClientId(H);if(j){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),B.fail(j);return}}var te=P.connectionStateTtl;te&&(this.connectionStateTtl=te),this.maxIdleInterval=P.maxIdleInterval,this.emit("connectiondetails",P)}},X.supportedTransports={},X}(b.default);e.default=ee}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(7)),a=r.__importDefault(t(2)),u=function(l){r.__extends(f,l);function f(){var m=l.call(this)||this;return m.messages=[],m}return f.prototype.count=function(){return this.messages.length},f.prototype.push=function(m){this.messages.push(m)},f.prototype.shift=function(){return this.messages.shift()},f.prototype.last=function(){return this.messages[this.messages.length-1]},f.prototype.copyAll=function(){return this.messages.slice()},f.prototype.append=function(m){this.messages.push.apply(this.messages,m)},f.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},f.prototype.completeMessages=function(m,b,C){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+b),C=C||null;var h=this.messages;if(h.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=h[0];if(E){var w=E.message.msgSerial,I=m+b;if(I>w)for(var S=h.splice(0,I-w),T=0,x=S;T<x.length;T++){var g=x[T];g.callback(C)}h.length==0&&this.emit("idle")}},f.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},f.prototype.resetSendAttempted=function(){for(var m=0,b=this.messages;m<b.length;m++){var C=b[m];C.sendAttempted=!1}},f.prototype.clear=function(){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},f}(i.default);e.default=u},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(a,u,l,f){this.previous=a,this.current=u,l&&(this.retryIn=l),f&&(this.reason=f)}return i}();e.default=r},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(10)),a=r.__importDefault(t(7)),u=r.__importStar(t(1)),l=r.__importDefault(t(33)),f=r.__importDefault(t(2)),m=r.__importDefault(t(54)),b=r.__importDefault(t(9)),C=r.__importDefault(t(39)),h=r.__importStar(t(4)),E=r.__importDefault(t(15)),w=r.__importDefault(t(20)),I=i.default.Action,S=function(){};function T(g){if(g&&"params"in g&&!u.isObject(g.params))return new h.default("options.params must be an object",4e4,400);if(g&&"modes"in g){if(!u.isArray(g.modes))return new h.default("options.modes must be an array",4e4,400);for(var y=0;y<g.modes.length;y++){var d=g.modes[y];if(!d||typeof d!="string"||!u.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(d)))return new h.default("Invalid channel mode: "+d,4e4,400)}}}var x=function(g){r.__extends(y,g);function y(d,p,O){var v=g.call(this,d,p,O)||this;return v.retryCount=0,v.history=function(R,N){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),N===void 0)if(typeof R=="function")N=R,R=null;else{if(this.rest.options.promises)return u.promisify(this,"history",arguments);N=S}if(R&&R.untilAttach){if(this.state!=="attached"){N(new h.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){N(new h.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete R.untilAttach,R.from_serial=this.properties.attachSerial}l.default.prototype._history.call(this,R,N)},v.whenState=function(R,N){return a.default.prototype.whenState.call(v,R,v.state,N)},f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),v.realtime=d,v.presence=new m.default(v),v.connectionManager=d.connection.connectionManager,v.state="initialized",v.subscriptions=new a.default,v.syncChannelSerial=void 0,v.properties={attachSerial:void 0,channelSerial:void 0},v.setOptions(O),v.errorReason=null,v._requestedFlags=null,v._mode=null,v._attachResume=!1,v._decodingContext={channelOptions:v.channelOptions,plugins:d.options.plugins||{},baseEncodedPreviousPayload:void 0},v._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},v._allChannelChanges=new a.default,v}return y.prototype.invalidStateError=function(){return new h.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},y.processListenerArgs=function(d){return d=Array.prototype.slice.call(d),typeof d[0]=="function"&&d.unshift(null),d[d.length-1]==null&&d.pop(),d},y.prototype.setOptions=function(d,p){if(!p&&this.rest.options.promises)return u.promisify(this,"setOptions",arguments);var O=p||function(R){R&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+R.toString())},v=T(d);if(v){O(v);return}l.default.prototype.setOptions.call(this,d),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(d)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(R){switch(this.event){case"update":case"attached":O==null||O(null);return;default:O==null||O(R.reason);return}})):O()},y.prototype._shouldReattachToSetOptions=function(d){return(this.state==="attached"||this.state==="attaching")&&((d==null?void 0:d.params)||(d==null?void 0:d.modes))},y.prototype.publish=function(){for(var d=this,p=[],O=0;O<arguments.length;O++)p[O]=arguments[O];var v=p[0],R=p.length,N=p[R-1];if(typeof N!="function"){if(this.realtime.options.promises)return u.promisify(this,"publish",arguments);N=S,++R}if(!this.connectionManager.activeState()){N(this.connectionManager.getError());return}if(R==2)if(u.isObject(v))v=[b.default.fromValues(v)];else if(u.isArray(v))v=b.default.fromValuesArray(v);else throw new h.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else v=[b.default.fromValues({name:p[0],data:p[1]})];var z=this.realtime.options.maxMessageSize;b.default.encodeArray(v,this.channelOptions,function(W){if(W){N(W);return}var F=b.default.getMessagesSize(v);if(F>z){N(new h.default("Maximum size of messages that can be published at once exceeded ( was "+F+" bytes; limit is "+z+" bytes)",40009,400));return}d.__publish(v,N)})},y.prototype.__publish=function(d,p){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+d.length);var O=this.state;switch(O){case"failed":case"suspended":p(h.default.fromValues(this.invalidStateError()));break;default:{f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+O);var v=new i.default;v.action=I.MESSAGE,v.channel=this.name,v.messages=d,this.sendMessage(v,p);break}}},y.prototype.onEvent=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,O=0;O<d.length;O++){var v=d[O];p.emit(v.name,v)}},y.prototype.attach=function(d,p){var O;if(typeof d=="function"?(p=d,O=null):O=d,!p){if(this.realtime.options.promises)return u.promisify(this,"attach",arguments);p=function(v){v&&f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+v.toString())}}if(O)f.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=O;else if(this.state==="attached"){p(null,null);return}this._attach(!1,null,p)},y.prototype._attach=function(d,p,O){O||(O=function(R){R&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+R.toString())});var v=this.connectionManager;if(!v.activeState()){O(v.getError());return}(this.state!=="attaching"||d)&&this.requestState("attaching",p),this.once(function(R){switch(this.event){case"attached":O==null||O(null,R);break;case"detached":case"suspended":case"failed":O==null||O(R.reason||v.getError()||new h.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":O==null||O(new h.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},y.prototype.attachImpl=function(){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var d=i.default.fromValues({action:I.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?d.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&d.encodeModesToFlags(u.allToUpperCase(this.channelOptions.modes)),this._attachResume&&d.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(d.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(d,S)},y.prototype.detach=function(d){if(!d){if(this.realtime.options.promises)return u.promisify(this,"detach",arguments);d=S}var p=this.connectionManager;if(!p.activeState()){d(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),d();break;case"detached":d();break;case"failed":d(new h.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(O){switch(this.event){case"detached":d();break;case"attached":case"suspended":case"failed":d(O.reason||p.getError()||new h.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":d(new h.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},y.prototype.detachImpl=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var p=i.default.fromValues({action:I.DETACH,channel:this.name});this.sendMessage(p,d||S)},y.prototype.subscribe=function(){for(var d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];var O=y.processListenerArgs(d),v=O[0],R=O[1],N=O[2];if(!N&&this.realtime.options.promises)return u.promisify(this,"subscribe",[v,R]);if(this.state==="failed"){N==null||N(h.default.fromValues(this.invalidStateError()));return}return v&&typeof v=="object"&&!Array.isArray(v)?this._subscribeFilter(v,R):this.subscriptions.on(v,R),this.attach(N||S)},y.prototype._subscribeFilter=function(d,p){var O=function(v){var R,N,z,W,F,_,L={name:v.name,refTimeserial:(N=(R=v.extras)===null||R===void 0?void 0:R.ref)===null||N===void 0?void 0:N.timeserial,refType:(W=(z=v.extras)===null||z===void 0?void 0:z.ref)===null||W===void 0?void 0:W.type,isRef:!!(!((_=(F=v.extras)===null||F===void 0?void 0:F.ref)===null||_===void 0)&&_.timeserial),clientId:v.clientId};Object.entries(d).find(function($){var G=$[0],K=$[1];return K!==void 0?L[G]!==K:!1})||p(v)};this._addFilteredSubscription(d,p,O),this.subscriptions.on(O)},y.prototype._addFilteredSubscription=function(d,p,O){var v;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var R=this.filteredSubscriptions.get(p);R.set(d,((v=R==null?void 0:R.get(d))===null||v===void 0?void 0:v.concat(O))||[O])}else this.filteredSubscriptions.set(p,new Map([[d,[O]]]))},y.prototype._getAndDeleteFilteredSubscriptions=function(d,p){var O=this;if(!this.filteredSubscriptions)return[];if(!p&&d)return Array.from(this.filteredSubscriptions.entries()).map(function(z){var W,F=z[0],_=z[1],L=_.get(d);return _.delete(d),_.size===0&&((W=O.filteredSubscriptions)===null||W===void 0||W.delete(F)),L}).reduce(function(z,W){var F;return W?(F=z).concat.apply(F,W):z},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var v=this.filteredSubscriptions.get(p);if(!d){var R=Array.from(v.values()).reduce(function(z,W){return z.concat.apply(z,W)},[]);return this.filteredSubscriptions.delete(p),R}var N=v.get(d);return v.delete(d),N||[]},y.prototype.unsubscribe=function(){for(var d=this,p,O=[],v=0;v<arguments.length;v++)O[v]=arguments[v];var R=y.processListenerArgs(O),N=R[0],z=R[1];if(typeof N=="object"&&!z||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(z))){this._getAndDeleteFilteredSubscriptions(N,z).forEach(function(W){return d.subscriptions.off(W)});return}this.subscriptions.off(N,z)},y.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new h.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var d=this.connectionManager;if(!d.activeState())throw d.getError();var p=i.default.fromValues({action:I.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),d.send(p)},y.prototype.sendMessage=function(d,p){this.connectionManager.send(d,this.realtime.options.queueMessages,p)},y.prototype.sendPresence=function(d,p){var O=i.default.fromValues({action:I.PRESENCE,channel:this.name,presence:u.isArray(d)?E.default.fromValuesArray(d):[E.default.fromValues(d)]});this.sendMessage(O,p)},y.prototype.onMessage=function(d){(d.action===I.ATTACHED||d.action===I.MESSAGE||d.action===I.PRESENCE)&&this.setChannelSerial(d.channelSerial);var p,O=!1;switch(d.action){case I.ATTACHED:{this.properties.attachSerial=d.channelSerial,this._mode=d.getMode(),this.params=d.params||{};var v=d.decodeModesFromFlags();this.modes=v&&u.allToLowerCase(v)||void 0;var R=d.hasFlag("RESUMED"),N=d.hasFlag("HAS_PRESENCE"),z=d.hasFlag("HAS_BACKLOG");if(this.state==="attached"){R||this.presence.onAttached(N);var W=new C.default(this.state,this.state,R,z,d.error);this._allChannelChanges.emit("update",W),(!R||this.channelOptions.updateOnAttached)&&this.emit("update",W)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",d.error,R,N,z);break}case I.DETACHED:{var F=d.error?h.default.fromValues(d.error):new h.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",F):this.state==="attaching"?this.notifyState("suspended",F):this.requestState("attaching",F);break}case I.SYNC:if(O=!0,p=this.syncChannelSerial=d.channelSerial,!d.presence)break;case I.PRESENCE:{for(var _=d.presence,L=d.id,$=d.connectionId,G=d.timestamp,K=this.channelOptions,ee=void 0,re=0;re<_.length;re++)try{ee=_[re],E.default.decode(ee,K),ee.connectionId||(ee.connectionId=$),ee.timestamp||(ee.timestamp=G),ee.id||(ee.id=L+":"+re)}catch(te){f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",te.toString())}this.presence.setPresence(_,O,p);break}case I.MESSAGE:{if(this.state!=="attached"){f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+d.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var X=d.messages,P=X[0],B=X[X.length-1],L=d.id,$=d.connectionId,G=d.timestamp;if(P.extras&&P.extras.delta&&P.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+d.id+'" on this channel "'+this.name+'".';f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new h.default(H,40018,400));break}for(var re=0;re<X.length;re++){var H=X[re];try{b.default.decode(H,this._decodingContext)}catch($e){switch(f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",$e.toString()),$e.code){case 40018:this._startDecodeFailureRecovery($e);return;case 40019:case 40021:this.notifyState("failed",$e);return}}H.connectionId||(H.connectionId=$),H.timestamp||(H.timestamp=G),H.id||(H.id=L+":"+re)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=d.channelSerial,this.onEvent(X);break}case I.ERROR:{var j=d.error;j&&j.code==80016?this.checkPendingState():this.notifyState("failed",h.default.fromValues(j));break}default:f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+d.action+")"),this.connectionManager.abort(w.default.unknownChannelErr())}},y.prototype._startDecodeFailureRecovery=function(d){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,d,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},y.prototype.onAttached=function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},y.prototype.notifyState=function(d,p,O,v,R){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+d),this.clearStateTimer(),u.arrIn(["detached","suspended","failed"],d)&&(this.properties.channelSerial=null),d!==this.state){this.presence.actOnChannelState(d,v,p),d==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var N=new C.default(this.state,d,O,R,p),z=d==="failed"?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(z,'Channel state for channel "'+this.name+'"',d+(p?"; reason: "+p:"")),d!=="attaching"&&d!=="suspended"&&(this.retryCount=0),d==="attached"&&this.onAttached(),d==="attached"?this._attachResume=!0:(d==="detaching"||d==="failed")&&(this._attachResume=!1),this.state=d,this._allChannelChanges.emit(d,N),this.emit(d,N)}},y.prototype.requestState=function(d,p){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+d),this.notifyState(d,p),this.checkPendingState()},y.prototype.checkPendingState=function(){var d=this.connectionManager.state;if(!(d.sendEvents||d.forceQueueEvents)){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},y.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var d=new h.default("Channel attach timed out",90007,408);this.notifyState("suspended",d);break}case"detaching":{var d=new h.default("Channel detach timed out",90007,408);this.notifyState("attached",d);break}default:this.checkPendingState();break}},y.prototype.startStateTimerIfNotRunning=function(){var d=this;this.stateTimer||(this.stateTimer=setTimeout(function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),d.stateTimer=null,d.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},y.prototype.clearStateTimer=function(){var d=this.stateTimer;d&&(clearTimeout(d),this.stateTimer=null)},y.prototype.startRetryTimer=function(){var d=this;if(!this.retryTimer){this.retryCount++;var p=u.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){d.state==="suspended"&&d.connectionManager.state.sendEvents&&(d.retryTimer=null,f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),d.requestState("attaching"))},p)}},y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},y.prototype.getReleaseErr=function(){var d=this.state;return d==="initialized"||d==="detached"||d==="failed"?null:new h.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+d,90001,400)},y.prototype.setChannelSerial=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+d+"; previous = "+this.properties.channelSerial),d&&(this.properties.channelSerial=d)},y}(l.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function i(a,u,l,f,m){this.previous=a,this.current=u,u==="attached"&&(this.resumed=l,this.hasBacklog=f),m&&(this.reason=m)}return i}();e.default=r},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,u=a.WordArray,l=a.Hasher,f=i.algo,m=[],b=f.SHA1=l.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,h){for(var E=this._hash.words,w=E[0],I=E[1],S=E[2],T=E[3],x=E[4],g=0;g<80;g++){if(g<16)m[g]=C[h+g]|0;else{var y=m[g-3]^m[g-8]^m[g-14]^m[g-16];m[g]=y<<1|y>>>31}var d=(w<<5|w>>>27)+x+m[g];g<20?d+=(I&S|~I&T)+1518500249:g<40?d+=(I^S^T)+1859775393:g<60?d+=(I&S|I&T|S&T)-1894007588:d+=(I^S^T)-899497514,x=T,T=S,S=I<<30|I>>>2,I=w,w=d}E[0]=E[0]+w|0,E[1]=E[1]+I|0,E[2]=E[2]+S|0,E[3]=E[3]+T|0,E[4]=E[4]+x|0},_doFinalize:function(){var C=this._data,h=C.words,E=this._nDataBytes*8,w=C.sigBytes*8;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=Math.floor(E/4294967296),h[(w+64>>>9<<4)+15]=E,C.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var C=l.clone.call(this);return C._hash=this._hash.clone(),C}});i.SHA1=l._createHelper(b),i.HmacSHA1=l._createHmacHelper(b)}(),r.SHA1})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function r(g){if(g===void 0)return"undefined";var y,d;if(g instanceof ArrayBuffer?(d="ArrayBuffer",y=new DataView(g)):g instanceof DataView&&(d="DataView",y=g),!y)return JSON.stringify(g);for(var p=[],O=0;O<g.byteLength;O++){if(O>20){p.push("...");break}var v=y.getUint8(O).toString(16);v.length===1&&(v="0"+v),p.push(v)}return"<"+d+" "+p.join(" ")+">"}function i(g,y,d){for(var p=0,O=d.length;p<O;p++){var v=d.charCodeAt(p);if(v<128){g.setUint8(y++,v>>>0&127|0);continue}if(v<2048){g.setUint8(y++,v>>>6&31|192),g.setUint8(y++,v>>>0&63|128);continue}if(v<65536){g.setUint8(y++,v>>>12&15|224),g.setUint8(y++,v>>>6&63|128),g.setUint8(y++,v>>>0&63|128);continue}if(v<1114112){g.setUint8(y++,v>>>18&7|240),g.setUint8(y++,v>>>12&63|128),g.setUint8(y++,v>>>6&63|128),g.setUint8(y++,v>>>0&63|128);continue}throw new Error("bad codepoint "+v)}}function a(g,y,d){for(var p="",O=y,v=y+d;O<v;O++){var R=g.getUint8(O);if((R&128)===0){p+=String.fromCharCode(R);continue}if((R&224)===192){p+=String.fromCharCode((R&15)<<6|g.getUint8(++O)&63);continue}if((R&240)===224){p+=String.fromCharCode((R&15)<<12|(g.getUint8(++O)&63)<<6|(g.getUint8(++O)&63)<<0);continue}if((R&248)===240){p+=String.fromCharCode((R&7)<<18|(g.getUint8(++O)&63)<<12|(g.getUint8(++O)&63)<<6|(g.getUint8(++O)&63)<<0);continue}throw new Error("Invalid byte "+R.toString(16))}return p}function u(g){for(var y=0,d=0,p=g.length;d<p;d++){var O=g.charCodeAt(d);if(O<128){y+=1;continue}if(O<2048){y+=2;continue}if(O<65536){y+=3;continue}if(O<1114112){y+=4;continue}throw new Error("bad codepoint "+O)}return y}function l(g,y){var d=x(g,y);if(d!==0){var p=new ArrayBuffer(d),O=new DataView(p);return T(g,O,0,y),p}}var f=(1<<16)*(1<<16),m=1/f;function b(g,y){return y=y||0,g.getInt32(y)*f+g.getUint32(y+4)}function C(g,y){return y=y||0,g.getUint32(y)*f+g.getUint32(y+4)}function h(g,y,d){d<9223372036854776e3?(g.setInt32(y,Math.floor(d*m)),g.setInt32(y+4,d&-1)):(g.setUint32(y,2147483647),g.setUint32(y+4,2147483647))}function E(g,y,d){d<18446744073709552e3?(g.setUint32(y,Math.floor(d*m)),g.setInt32(y+4,d&-1)):(g.setUint32(y,4294967295),g.setUint32(y+4,4294967295))}var w=function(){function g(y,d){var p=this;this.map=function(O){for(var v={},R=0;R<O;R++){var N=p.parse();v[N]=p.parse()}return v},this.bin=function(O){var v=new ArrayBuffer(O);return new Uint8Array(v).set(new Uint8Array(p.view.buffer,p.offset,O),0),p.offset+=O,v},this.buf=this.bin,this.str=function(O){var v=a(p.view,p.offset,O);return p.offset+=O,v},this.array=function(O){for(var v=new Array(O),R=0;R<O;R++)v[R]=p.parse();return v},this.ext=function(O){return p.offset+=O,{type:p.view.getInt8(p.offset),data:p.buf(O)}},this.parse=function(){var O=p.view.getUint8(p.offset),v,R;if((O&128)===0)return p.offset++,O;if((O&240)===128)return R=O&15,p.offset++,p.map(R);if((O&240)===144)return R=O&15,p.offset++,p.array(R);if((O&224)===160)return R=O&31,p.offset++,p.str(R);if((O&224)===224)return v=p.view.getInt8(p.offset),p.offset++,v;switch(O){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return R=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(R);case 197:return R=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(R);case 198:return R=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(R);case 199:return R=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(R);case 200:return R=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(R);case 201:return R=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(R);case 202:return v=p.view.getFloat32(p.offset+1),p.offset+=5,v;case 203:return v=p.view.getFloat64(p.offset+1),p.offset+=9,v;case 204:return v=p.view.getUint8(p.offset+1),p.offset+=2,v;case 205:return v=p.view.getUint16(p.offset+1),p.offset+=3,v;case 206:return v=p.view.getUint32(p.offset+1),p.offset+=5,v;case 207:return v=C(p.view,p.offset+1),p.offset+=9,v;case 208:return v=p.view.getInt8(p.offset+1),p.offset+=2,v;case 209:return v=p.view.getInt16(p.offset+1),p.offset+=3,v;case 210:return v=p.view.getInt32(p.offset+1),p.offset+=5,v;case 211:return v=b(p.view,p.offset+1),p.offset+=9,v;case 212:return R=1,p.offset++,p.ext(R);case 213:return R=2,p.offset++,p.ext(R);case 214:return R=4,p.offset++,p.ext(R);case 215:return R=8,p.offset++,p.ext(R);case 216:return R=16,p.offset++,p.ext(R);case 217:return R=p.view.getUint8(p.offset+1),p.offset+=2,p.str(R);case 218:return R=p.view.getUint16(p.offset+1),p.offset+=3,p.str(R);case 219:return R=p.view.getUint32(p.offset+1),p.offset+=5,p.str(R);case 220:return R=p.view.getUint16(p.offset+1),p.offset+=3,p.array(R);case 221:return R=p.view.getUint32(p.offset+1),p.offset+=5,p.array(R);case 222:return R=p.view.getUint16(p.offset+1),p.offset+=3,p.map(R);case 223:return R=p.view.getUint32(p.offset+1),p.offset+=5,p.map(R)}throw new Error("Unknown type 0x"+O.toString(16))},this.offset=d||0,this.view=y}return g}();function I(g){var y=new DataView(g),d=new w(y),p=d.parse();if(d.offset!==g.byteLength)throw new Error(g.byteLength-d.offset+" trailing bytes");return p}function S(g,y){return Object.keys(g).filter(function(d){var p=g[d],O=typeof p;return(!y||p!=null)&&(O!=="function"||!!p.toJSON)})}function T(g,y,d,p){var O=typeof g;if(typeof g=="string"){var v=u(g);if(v<32)return y.setUint8(d,v|160),i(y,d+1,g),1+v;if(v<256)return y.setUint8(d,217),y.setUint8(d+1,v),i(y,d+2,g),2+v;if(v<65536)return y.setUint8(d,218),y.setUint16(d+1,v),i(y,d+3,g),3+v;if(v<4294967296)return y.setUint8(d,219),y.setUint32(d+1,v),i(y,d+5,g),5+v}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var R=g.byteLength;if(R<256)return y.setUint8(d,196),y.setUint8(d+1,R),new Uint8Array(y.buffer).set(new Uint8Array(g),d+2),2+R;if(R<65536)return y.setUint8(d,197),y.setUint16(d+1,R),new Uint8Array(y.buffer).set(new Uint8Array(g),d+3),3+R;if(R<4294967296)return y.setUint8(d,198),y.setUint32(d+1,R),new Uint8Array(y.buffer).set(new Uint8Array(g),d+5),5+R}if(typeof g=="number"){if(Math.floor(g)!==g)return y.setUint8(d,203),y.setFloat64(d+1,g),9;if(g>=0){if(g<128)return y.setUint8(d,g),1;if(g<256)return y.setUint8(d,204),y.setUint8(d+1,g),2;if(g<65536)return y.setUint8(d,205),y.setUint16(d+1,g),3;if(g<4294967296)return y.setUint8(d,206),y.setUint32(d+1,g),5;if(g<18446744073709552e3)return y.setUint8(d,207),E(y,d+1,g),9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return y.setInt8(d,g),1;if(g>=-128)return y.setUint8(d,208),y.setInt8(d+1,g),2;if(g>=-32768)return y.setUint8(d,209),y.setInt16(d+1,g),3;if(g>=-2147483648)return y.setUint8(d,210),y.setInt32(d+1,g),5;if(g>=-9223372036854776e3)return y.setUint8(d,211),h(y,d+1,g),9;throw new Error("Number too small -0x"+(-g).toString(16).substr(1))}if(O==="undefined")return p?0:(y.setUint8(d,212),y.setUint8(d+1,0),y.setUint8(d+2,0),3);if(g===null)return p?0:(y.setUint8(d,192),1);if(O==="boolean")return y.setUint8(d,g?195:194),1;if(typeof g.toJSON=="function")return T(g.toJSON(),y,d,p);if(O==="object"){var N,z=0,W=void 0,F=Array.isArray(g);if(F?N=g.length:(W=S(g,p),N=W.length),N<16?(y.setUint8(d,N|(F?144:128)),z=1):N<65536?(y.setUint8(d,F?220:222),y.setUint16(d+1,N),z=3):N<4294967296&&(y.setUint8(d,F?221:223),y.setUint32(d+1,N),z=5),F)for(var _=0;_<N;_++)z+=T(g[_],y,d+z,p);else if(W)for(var _=0;_<N;_++){var L=W[_];z+=T(L,y,d+z),z+=T(g[L],y,d+z,p)}return z}if(O==="function")return 0;throw new Error("Unknown type "+O)}function x(g,y){var d=typeof g;if(d==="string"){var p=u(g);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var O=g.byteLength;if(O<256)return 2+O;if(O<65536)return 3+O;if(O<4294967296)return 5+O}if(typeof g=="number"){if(Math.floor(g)!==g)return 9;if(g>=0){if(g<128)return 1;if(g<256)return 2;if(g<65536)return 3;if(g<4294967296)return 5;if(g<18446744073709552e3)return 9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return 1;if(g>=-128)return 2;if(g>=-32768)return 3;if(g>=-2147483648)return 5;if(g>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+g.toString(16).substr(1))}if(d==="boolean")return 1;if(g===null)return y?0:1;if(g===void 0)return y?0:3;if(typeof g.toJSON=="function")return x(g.toJSON(),y);if(d==="object"){var v,R=0;if(Array.isArray(g)){v=g.length;for(var N=0;N<v;N++)R+=x(g[N],y)}else{var z=S(g,y);v=z.length;for(var N=0;N<v;N++){var W=z[N];R+=x(W)+x(g[W],y)}}if(v<16)return 1+R;if(v<65536)return 3+R;if(v<4294967296)return 5+R;throw new Error("Array or object too long 0x"+v.toString(16))}if(d==="function")return 0;throw new Error("Unknown type "+d)}e.default={encode:l,decode:I,inspect:r,utf8Write:i,utf8Read:a,utf8ByteCount:u}},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(30)),a=r.__importDefault(t(50)),u=r.__importDefault(t(3)),l=r.__importDefault(t(4)),f=r.__importDefault(t(55)),m=r.__importDefault(t(57)),b=r.__importDefault(t(62)),C=r.__importDefault(t(64)),h=r.__importDefault(t(68)),E=r.__importDefault(t(2)),w=t(8),I=r.__importDefault(t(65)),S=r.__importDefault(t(66)),T=r.__importDefault(t(41)),x=(0,m.default)(C.default,f.default);u.default.Crypto=x,u.default.BufferUtils=f.default,u.default.Http=b.default,u.default.Config=C.default,u.default.Transports=h.default,u.default.WebStorage=I.default,i.default.Crypto=x,a.default.Crypto=x,E.default.initLogHandlers(),u.default.Defaults=(0,w.getDefaults)(S.default),u.default.Config.agent&&(u.default.Defaults.agent+=" "+u.default.Config.agent),u.default.Config.noUpgrade&&(u.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:l.default,Rest:i.default,Realtime:a.default,msgpack:T.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(s,e){},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(32),t(24))})(this,function(r){return r.HmacSHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(47)),u=r.__importDefault(t(14)),l=r.__importDefault(t(19)),f=r.__importDefault(t(4)),m=r.__importDefault(t(48)),b=function(){},C=function(){function I(S){this.rest=S,this.admin=new h(S)}return I}(),h=function(){function I(S){this.rest=S,this.deviceRegistrations=new E(S),this.channelSubscriptions=new w(S)}return I.prototype.publish=function(S,T,x){var g=this.rest,y=g.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(g.options,y),p={},O=i.mixin({recipient:S},T);if(typeof x!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);x=b}g.options.headers&&i.mixin(d,g.options.headers),g.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var v=i.encodeBody(O,y);u.default.post(g,"/push/publish",v,d,p,null,function(R){return x(R)})},I}(),E=function(){function I(S){this.rest=S}return I.prototype.save=function(S,T){var x=this.rest,g=a.default.fromValues(S),y=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(x.options,y),p={};if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);T=b}x.options.headers&&i.mixin(d,x.options.headers),x.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var O=i.encodeBody(g,y);u.default.put(x,"/push/deviceRegistrations/"+encodeURIComponent(S.id),O,d,p,null,function(v,R,N,z){T(v,v?void 0:a.default.fromResponseBody(R,z?void 0:y))})},I.prototype.get=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(x.options,g),d=S.id||S;if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);T=b}if(typeof d!="string"||!d.length){T(new f.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&i.mixin(y,x.options.headers),u.default.get(x,"/push/deviceRegistrations/"+encodeURIComponent(d),y,{},null,function(p,O,v,R){T(p,p?void 0:a.default.fromResponseBody(O,R?void 0:g))})},I.prototype.list=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(x.options,g);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);T=b}x.options.headers&&i.mixin(d,x.options.headers),new l.default(x,"/push/deviceRegistrations",d,y,function(p,O,v){return a.default.fromResponseBody(p,v?void 0:g)}).get(S,T)},I.prototype.remove=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(x.options,g),d={},p=S.id||S;if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);T=b}if(typeof p!="string"||!p.length){T(new f.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&i.mixin(y,x.options.headers),x.options.pushFullWait&&i.mixin(d,{fullWait:"true"}),u.default.delete(x,"/push/deviceRegistrations/"+encodeURIComponent(p),y,d,null,function(O){return T(O)})},I.prototype.removeWhere=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(x.options,g);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);T=b}x.options.headers&&i.mixin(y,x.options.headers),x.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),u.default.delete(x,"/push/deviceRegistrations",y,S,null,function(d){return T(d)})},I}(),w=function(){function I(S){this.remove=I.prototype.removeWhere,this.rest=S}return I.prototype.save=function(S,T){var x=this.rest,g=m.default.fromValues(S),y=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(x.options,y),p={};if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);T=b}x.options.headers&&i.mixin(d,x.options.headers),x.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var O=i.encodeBody(g,y);u.default.post(x,"/push/channelSubscriptions",O,d,p,null,function(v,R,N,z){T(v,!v&&m.default.fromResponseBody(R,z?void 0:y))})},I.prototype.list=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(x.options,g);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);T=b}x.options.headers&&i.mixin(d,x.options.headers),new l.default(x,"/push/channelSubscriptions",d,y,function(p,O,v){return m.default.fromResponseBody(p,v?void 0:g)}).get(S,T)},I.prototype.removeWhere=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(x.options,g);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);T=b}x.options.headers&&i.mixin(y,x.options.headers),x.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),u.default.delete(x,"/push/channelSubscriptions",y,S,null,function(d){return T(d)})},I.prototype.listChannels=function(S,T){var x=this.rest,g=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(x.options,g);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);T=b}x.options.headers&&i.mixin(d,x.options.headers),x.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),new l.default(x,"/push/channels",d,y,function(p,O,v){for(var R=!v&&g?i.decodeBody(p,g):p,N=0;N<R.length;N++)R[N]=String(R[N]);return R}).get(S,T)},I}();e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(4)),u;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(u||(u={}));var l;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(l||(l={}));var f=function(){function m(){}return m.prototype.toJSON=function(){var b,C,h;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(b=this.push)===null||b===void 0?void 0:b.recipient,state:(C=this.push)===null||C===void 0?void 0:C.state,error:(h=this.push)===null||h===void 0?void 0:h.error}}},m.prototype.toString=function(){var b,C,h,E,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((b=this.push)===null||b===void 0)&&b.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((C=this.push)===null||C===void 0)&&C.state&&(w+="; push.state="+this.push.state),!((h=this.push)===null||h===void 0)&&h.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},m.fromResponseBody=function(b,C){return C&&(b=i.decodeBody(b,C)),i.isArray(b)?m.fromValuesArray(b):m.fromValues(b)},m.fromValues=function(b){return b.error=b.error&&a.default.fromValues(b.error),Object.assign(new m,b)},m.fromValuesArray=function(b){for(var C=b.length,h=new Array(C),E=0;E<C;E++)h[E]=m.fromValues(b[E]);return h},m.toRequestBody=i.encodeBody,m}();e.default=f},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=function(){function u(){}return u.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},u.prototype.toString=function(){var l="[PushChannelSubscription";return this.channel&&(l+="; channel="+this.channel),this.deviceId&&(l+="; deviceId="+this.deviceId),this.clientId&&(l+="; clientId="+this.clientId),l+="]",l},u.fromResponseBody=function(l,f){return f&&(l=i.decodeBody(l,f)),i.isArray(l)?u.fromValuesArray(l):u.fromValues(l)},u.fromValues=function(l){return Object.assign(new u,l)},u.fromValuesArray=function(l){for(var f=l.length,m=new Array(f),b=0;b<f;b++)m[b]=u.fromValues(l[b]);return m},u.toRequestBody=i.encodeBody,u}();e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=function(){function x(g){this.count=g&&g.count||0,this.data=g&&g.data||0,this.uncompressedData=g&&g.uncompressedData||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return x}(),u=function(x){r.__extends(g,x);function g(y){var d=x.call(this,y)||this;return y&&y.category&&(d.category={},i.forInOwnNonNullProperties(y.category,function(p){d.category[p]=new a(y.category[p])})),d}return g}(a),l=function(){function x(g){this.peak=g&&g.peak||0,this.min=g&&g.min||0,this.mean=g&&g.mean||0,this.opened=g&&g.opened||0,this.refused=g&&g.refused||0}return x}(),f=function(){function x(g){this.succeeded=g&&g.succeeded||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return x}(),m=function(){function x(g){this.plain=new l(g&&g.plain),this.tls=new l(g&&g.tls),this.all=new l(g&&g.all)}return x}(),b=function(){function x(g){this.messages=new u(g&&g.messages),this.presence=new u(g&&g.presence),this.all=new u(g&&g.all)}return x}(),C=function(){function x(g){this.realtime=new b(g&&g.realtime),this.rest=new b(g&&g.rest),this.webhook=new b(g&&g.webhook),this.sharedQueue=new b(g&&g.sharedQueue),this.externalQueue=new b(g&&g.externalQueue),this.httpEvent=new b(g&&g.httpEvent),this.push=new b(g&&g.push),this.all=new b(g&&g.all)}return x}(),h=function(){function x(g){this.all=new b(g&&g.all),this.inbound=new C(g&&g.inbound),this.outbound=new C(g&&g.outbound)}return x}(),E=function(){function x(g){this.all=new b(g&&g.all),this.producerPaid=new h(g&&g.producerPaid),this.consumerPaid=new h(g&&g.consumerPaid)}return x}(),w=function(){function x(g){this.messages=g&&g.messages||0;var y=g&&g.notifications;this.notifications={invalid:y&&y.invalid||0,attempted:y&&y.attempted||0,successful:y&&y.successful||0,failed:y&&y.failed||0},this.directPublishes=g&&g.directPublishes||0}return x}(),I=function(){function x(g){this.succeeded=g&&g.succeeded||0,this.skipped=g&&g.skipped||0,this.failed=g&&g.failed||0}return x}(),S=function(){function x(g){var y=this;this.delta=void 0,g&&g.delta&&(this.delta={},i.forInOwnNonNullProperties(g.delta,function(d){y.delta[d]=new I(g.delta[d])}))}return x}(),T=function(x){r.__extends(g,x);function g(y){var d=x.call(this,y)||this;return d.persisted=new b(y&&y.persisted),d.connections=new m(y&&y.connections),d.channels=new l(y&&y.channels),d.apiRequests=new f(y&&y.apiRequests),d.tokenRequests=new f(y&&y.tokenRequests),d.xchgProducer=new E(y&&y.xchgProducer),d.xchgConsumer=new E(y&&y.xchgConsumer),d.push=new w(y&&y.pushStats),d.processed=new S(y&&y.processed),d.inProgress=y&&y.inProgress||void 0,d.unit=y&&y.unit||void 0,d.intervalId=y&&y.intervalId||void 0,d}return g.fromValues=function(y){return new g(y)},g}(h);e.default=T},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(30)),u=r.__importDefault(t(7)),l=r.__importDefault(t(2)),f=r.__importDefault(t(51)),m=r.__importDefault(t(38)),b=r.__importDefault(t(8)),C=r.__importDefault(t(4)),h=r.__importDefault(t(10)),E=r.__importDefault(t(35)),w=r.__importDefault(t(3)),I=r.__importDefault(t(9)),S=function(x){r.__extends(g,x);function g(y){var d=x.call(this,y)||this;return l.default.logAction(l.default.LOG_MINOR,"Realtime()",""),d.connection=new f.default(d,d.options),d.channels=new T(d),y.autoConnect!==!1&&d.connect(),d}return g.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},g.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},g.Promise=function(y){return y=b.default.objectifyOptions(y),y.promises=!0,new g(y)},g.Callbacks=g,g.Utils=i,g.ConnectionManager=E.default,g.Platform=w.default,g.ProtocolMessage=h.default,g.Message=I.default,g}(a.default),T=function(x){r.__extends(g,x);function g(y){var d=x.call(this)||this;return d.realtime=y,d.all=Object.create(null),y.connection.connectionManager.on("transport.active",function(){d.onTransportActive()}),d}return g.prototype.channelSerials=function(){for(var y={},d=0,p=i.keysArray(this.all,!0);d<p.length;d++){var O=p[d],v=this.all[O];v.properties.channelSerial&&(y[O]=v.properties.channelSerial)}return y},g.prototype.recoverChannels=function(y){for(var d=0,p=i.keysArray(y,!0);d<p.length;d++){var O=p[d],v=this.get(O);v.properties.channelSerial=y[O]}},g.prototype.onChannelMessage=function(y){var d=y.channel;if(d===void 0){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+y.action);return}var p=this.all[d];if(!p){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+d);return}p.onMessage(y)},g.prototype.onTransportActive=function(){for(var y in this.all){var d=this.all[y];d.state==="attaching"||d.state==="detaching"?d.checkPendingState():d.state==="suspended"?d._attach(!1,null):d.state==="attached"&&d.requestState("attaching")}},g.prototype.propogateConnectionInterruption=function(y,d){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},O=["attaching","attached","detaching","suspended"],v=p[y];for(var R in this.all){var N=this.all[R];i.arrIn(O,N.state)&&N.notifyState(v,d)}},g.prototype.get=function(y,d){y=String(y);var p=this.all[y];if(!p)p=this.all[y]=new m.default(this.realtime,y,d);else if(d){if(p._shouldReattachToSetOptions(d))throw new C.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(d)}return p},g.prototype.getDerived=function(y,d,p){if(d.filter){var O=i.toBase64(d.filter),v=i.matchDerivedChannel(y);y="[filter=".concat(O).concat(v.qualifierParam,"]").concat(v.channelName)}return this.get(y,p)},g.prototype.release=function(y){y=String(y);var d=this.all[y];if(!!d){var p=d.getReleaseErr();if(p)throw p;delete this.all[y]}},g}(u.default);e.default=S},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(7)),u=r.__importDefault(t(35)),l=r.__importDefault(t(2)),f=r.__importDefault(t(37)),m=r.__importDefault(t(3));function b(){}var C=function(h){r.__extends(E,h);function E(w,I){var S=h.call(this)||this;return S.whenState=function(T,x){return a.default.prototype.whenState.call(S,T,S.state,x,new f.default(void 0,T))},S.ably=w,S.connectionManager=new u.default(w,I),S.state=S.connectionManager.state.state,S.key=void 0,S.id=void 0,S.errorReason=null,S.connectionManager.on("connectionstate",function(T){var x=S.state=T.current;m.default.Config.nextTick(function(){S.emit(x,T)})}),S.connectionManager.on("update",function(T){m.default.Config.nextTick(function(){S.emit("update",T)})}),S}return E.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(w){if(l.default.logAction(l.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);w=b}this.connectionManager.ping(null,w)},E.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(E.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),E.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},E}(a.default);e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var r=t(0),i=r.__importDefault(t(10)),a=r.__importStar(t(1)),u=r.__importDefault(t(7)),l=r.__importDefault(t(2)),f=r.__importDefault(t(36)),m=r.__importDefault(t(4)),b=i.default.Action,C=function(){function E(w,I){this.message=w,this.callback=I,this.merged=!1;var S=w.action;this.sendAttempted=!1,this.ackRequired=S==b.MESSAGE||S==b.PRESENCE}return E}();e.PendingMessage=C;var h=function(E){r.__extends(w,E);function w(I){var S=E.call(this)||this;return S.transport=I,S.messageQueue=new f.default,I.on("ack",function(T,x){S.onAck(T,x)}),I.on("nack",function(T,x,g){S.onNack(T,x,g)}),S}return w.prototype.onAck=function(I,S){l.default.logAction(l.default.LOG_MICRO,"Protocol.onAck()","serial = "+I+"; count = "+S),this.messageQueue.completeMessages(I,S)},w.prototype.onNack=function(I,S,T){l.default.logAction(l.default.LOG_ERROR,"Protocol.onNack()","serial = "+I+"; count = "+S+"; err = "+a.inspectError(T)),T||(T=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(I,S,T)},w.prototype.onceIdle=function(I){var S=this.messageQueue;if(S.count()===0){I();return}S.once("idle",I)},w.prototype.send=function(I){I.ackRequired&&this.messageQueue.push(I),l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(I.message)),I.sendAttempted=!0,this.transport.send(I.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var I=this.transport;this.onceIdle(function(){I.disconnect()})},w}(u.default);e.default=h},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(3)),a=r.__importStar(t(1)),u=r.__importDefault(t(26)),l=r.__importDefault(t(8)),f=r.__importDefault(t(2)),m=r.__importDefault(t(10)),b=r.__importDefault(t(4)),C="web_socket";function h(I){return!!I.on}var E=function(I){r.__extends(S,I);function S(T,x,g){var y=I.call(this,T,x,g)||this;return y.shortName=C,g.heartbeats=i.default.Config.useProtocolHeartbeats,y.wsHost=l.default.getHost(g.options,g.host,!0),y}return S.isAvailable=function(){return!!i.default.Config.WebSocket},S.prototype.createWebSocket=function(T,x){return this.uri=T+a.toQueryString(x),new i.default.Config.WebSocket(this.uri)},S.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},S.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),u.default.prototype.connect.call(this);var T=this,x=this.params,g=x.options,y=g.tls?"wss://":"ws://",d=y+this.wsHost+":"+l.default.getPort(g)+"/";f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+d),this.auth.getAuthParams(function(p,O){if(!T.isDisposed){var v="";for(var R in O)v+=" "+R+": "+O[R]+";";if(f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+v+" err: "+p),p){T.disconnect(p);return}var N=x.getConnectParams(O);try{var z=T.wsConnection=T.createWebSocket(d,N);z.binaryType=i.default.Config.binaryType,z.onopen=function(){T.onWsOpen()},z.onclose=function(W){T.onWsClose(W)},z.onmessage=function(W){T.onWsData(W.data)},z.onerror=function(W){T.onWsError(W)},h(z)&&z.on("ping",function(){T.onActivity()})}catch(W){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(W.stack||W.message)),T.disconnect(W)}}})},S.prototype.send=function(T){var x=this.wsConnection;if(!x){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{x.send(m.default.serialize(T,this.params.format))}catch(y){var g="Exception from ws connection when trying to send: "+a.inspectError(y);f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()",g),this.finish("disconnected",new b.default(g,5e4,500))}},S.prototype.onWsData=function(T){f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+T.length+"; type = "+typeof T);try{this.onProtocolMessage(m.default.deserialize(T,this.format))}catch(x){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+x.stack)}},S.prototype.onWsOpen=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},S.prototype.onWsClose=function(T){var x,g;if(typeof T=="object"?(g=T.code,x=T.wasClean||g===1e3):(g=T,x=g==1e3),delete this.wsConnection,x){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var y=new b.default("Websocket closed",80003,400);this.finish("disconnected",y)}else{var d="Unclean disconnection of WebSocket ; code = "+g,y=new b.default(d,80003,400);f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()",d),this.finish("disconnected",y)}this.emit("disposed")},S.prototype.onWsError=function(T){var x=this;f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+T.message),i.default.Config.nextTick(function(){x.disconnect(Error(T.message))})},S.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var T=this.wsConnection;T&&(T.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!T)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");T.close()}))},S}(u.default);function w(I){return E.isAvailable()&&(I.supportedTransports[C]=E),E}e.default=w},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(1)),a=r.__importDefault(t(34)),u=r.__importDefault(t(7)),l=r.__importDefault(t(2)),f=r.__importDefault(t(15)),m=r.__importStar(t(4)),b=r.__importDefault(t(38)),C=r.__importDefault(t(23)),h=r.__importDefault(t(39)),E=function(){};function w(y){return y.channel.realtime.auth.clientId}function I(y){var d=y.channel.realtime,p=d.auth.clientId;return(!p||p==="*")&&d.connection.state==="connected"}function S(y,d,p){switch(y.state){case"attached":case"suspended":p();break;case"initialized":case"detached":case"detaching":case"attaching":y.attach(function(O){O?d(O):p()});break;default:d(m.default.fromValues(y.invalidStateError()))}}function T(y,d){if(y.isSynthesized()||d.isSynthesized())return y.timestamp>=d.timestamp;var p=y.parseId(),O=d.parseId();return p.msgSerial===O.msgSerial?p.index>O.index:p.msgSerial>O.msgSerial}var x=function(y){r.__extends(d,y);function d(p){var O=y.call(this,p)||this;return O.channel=p,O.syncComplete=!1,O.members=new g(O,function(v){return v.clientId+":"+v.connectionId}),O._myMembers=new g(O,function(v){return v.clientId}),O.subscriptions=new u.default,O.pendingPresence=[],O}return d.prototype.enter=function(p,O){if(I(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"enter",O)},d.prototype.update=function(p,O){if(I(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"update",O)},d.prototype.enterClient=function(p,O,v){return this._enterOrUpdateClient(void 0,p,O,"enter",v)},d.prototype.updateClient=function(p,O,v){return this._enterOrUpdateClient(void 0,p,O,"update",v)},d.prototype._enterOrUpdateClient=function(p,O,v,R,N){var z=this;if(!N)if(typeof v=="function")N=v,v=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[p,O,v,R]);N=E}var W=this.channel;if(!W.connectionManager.activeState()){N(W.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence."+R+"Client()","channel = "+W.name+", id = "+p+", client = "+(O||"(implicit) "+w(this)));var F=f.default.fromData(v);F.action=R,p&&(F.id=p),O&&(F.clientId=O),f.default.encode(F,W.channelOptions,function(_){if(_){N(_);return}switch(W.state){case"attached":W.sendPresence(F,N);break;case"initialized":case"detached":W.attach();case"attaching":z.pendingPresence.push({presence:F,callback:N});break;default:_=new m.PartialErrorInfo("Unable to "+R+" presence channel while in "+W.state+" state",90001),_.code=90001,N(_)}})},d.prototype.leave=function(p,O){if(I(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,p,O)},d.prototype.leaveClient=function(p,O,v){if(!v)if(typeof O=="function")v=O,O=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[p,O]);v=E}var R=this.channel;if(!R.connectionManager.activeState()){v==null||v(R.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+p);var N=f.default.fromValues({action:"leave",data:O});switch(p&&(N.clientId=p),R.state){case"attached":R.sendPresence(N,v);break;case"attaching":this.pendingPresence.push({presence:N,callback:v});break;case"initialized":case"failed":{var z=new m.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);v==null||v(z);break}default:v==null||v(R.invalidStateError())}},d.prototype.get=function(p,O){var v=this,R=Array.prototype.slice.call(arguments);R.length==1&&typeof R[0]=="function"&&R.unshift(null),p=R[0],O=R[1];var N=!p||("waitForSync"in p?p.waitForSync:!0);if(!O){if(this.channel.realtime.options.promises)return i.promisify(this,"get",R);O=E}function z(W){O(null,p?W.list(p):W.values())}if(this.channel.state==="suspended"){N?O(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):z(this.members);return}S(this.channel,O,function(){var W=v.members;N?W.waitSync(function(){z(W)}):z(W)})},d.prototype.history=function(p,O){if(l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),O===void 0)if(typeof p=="function")O=p,p=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);O=E}p&&p.untilAttach&&(this.channel.state==="attached"?(delete p.untilAttach,p.from_serial=this.channel.properties.attachSerial):O(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),a.default.prototype._history.call(this,p,O)},d.prototype.setPresence=function(p,O,v){l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+p.length+" participants; syncChannelSerial = "+v);var R,N,z=this.members,W=this._myMembers,F=[],_=this.channel.connectionManager.connectionId;O&&(this.members.startSync(),v&&(N=v.match(/^[\w-]+:(.*)$/))&&(R=N[1]));for(var L=0;L<p.length;L++){var $=f.default.fromValues(p[L]);switch($.action){case"leave":z.remove($)&&F.push($),$.connectionId===_&&!$.isSynthesized()&&W.remove($);break;case"enter":case"present":case"update":z.put($)&&F.push($),$.connectionId===_&&W.put($);break}}O&&!R&&(z.endSync(),this.channel.syncChannelSerial=null);for(var L=0;L<F.length;L++){var $=F[L];this.subscriptions.emit($.action,$)}},d.prototype.onAttached=function(p){l.default.logAction(l.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+p),p?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var O=this.pendingPresence,v=O.length;if(v){this.pendingPresence=[];var R=[],N=C.default.create();l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+v+" queued presence messages");for(var z=0;z<v;z++){var W=O[z];R.push(W.presence),N.push(W.callback)}this.channel.sendPresence(R,N)}},d.prototype.actOnChannelState=function(p,O,v){switch(p){case"attached":this.onAttached(O);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(v);break}},d.prototype.failPendingPresence=function(p){if(this.pendingPresence.length){l.default.logAction(l.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(p));for(var O=0;O<this.pendingPresence.length;O++)try{this.pendingPresence[O].callback(p)}catch(v){}this.pendingPresence=[]}},d.prototype._clearMyMembers=function(){this._myMembers.clear()},d.prototype._ensureMyMembersPresent=function(){var p=this,O=this._myMembers,v=function(z){if(z){var W="Presence auto-re-enter failed: "+z.toString(),F=new m.default(W,91004,400);l.default.logAction(l.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",W);var _=new h.default(p.channel.state,p.channel.state,!0,!1,F);p.channel.emit("update",_)}};for(var R in O.map){var N=O.map[R];l.default.logAction(l.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+N.clientId+'" into the presence set'),this._enterOrUpdateClient(N.id,N.clientId,N.data,"enter",v)}},d.prototype._synthesizeLeaves=function(p){var O=this.subscriptions;i.arrForEach(p,function(v){var R=f.default.fromValues({action:"leave",connectionId:v.connectionId,clientId:v.clientId,data:v.data,encoding:v.encoding,timestamp:i.now()});O.emit("leave",R)})},d.prototype.on=function(){for(var p=[],O=0;O<arguments.length;O++)p[O]=arguments[O];l.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,p)},d.prototype.off=function(){for(var p=[],O=0;O<arguments.length;O++)p[O]=arguments[O];l.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,p)},d.prototype.subscribe=function(){for(var p=[],O=0;O<arguments.length;O++)p[O]=arguments[O];var v=b.default.processListenerArgs(p),R=v[0],N=v[1],z=v[2],W=this.channel;if(!z){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[R,N]);z=E}if(W.state==="failed"){z(m.default.fromValues(W.invalidStateError()));return}this.subscriptions.on(R,N),W.attach(z)},d.prototype.unsubscribe=function(){for(var p=[],O=0;O<arguments.length;O++)p[O]=arguments[O];var v=b.default.processListenerArgs(p),R=v[0],N=v[1];this.subscriptions.off(R,N)},d}(a.default),g=function(y){r.__extends(d,y);function d(p,O){var v=y.call(this)||this;return v.presence=p,v.map=Object.create(null),v.syncInProgress=!1,v.residualMembers=null,v.memberKey=O,v}return d.prototype.get=function(p){return this.map[p]},d.prototype.getClient=function(p){var O=this.map,v=[];for(var R in O){var N=O[R];N.clientId==p&&N.action!="absent"&&v.push(N)}return v},d.prototype.list=function(p){var O=this.map,v=p&&p.clientId,R=p&&p.connectionId,N=[];for(var z in O){var W=O[z];W.action!=="absent"&&(v&&v!=W.clientId||R&&R!=W.connectionId||N.push(W))}return N},d.prototype.put=function(p){(p.action==="enter"||p.action==="update")&&(p=f.default.fromValues(p),p.action="present");var O=this.map,v=this.memberKey(p);this.residualMembers&&delete this.residualMembers[v];var R=O[v];return R&&!T(p,R)?!1:(O[v]=p,!0)},d.prototype.values=function(){var p=this.map,O=[];for(var v in p){var R=p[v];R.action!="absent"&&O.push(R)}return O},d.prototype.remove=function(p){var O=this.map,v=this.memberKey(p),R=O[v];return R&&!T(p,R)?!1:(this.syncInProgress?(p=f.default.fromValues(p),p.action="absent",O[v]=p):delete O[v],!0)},d.prototype.startSync=function(){var p=this.map,O=this.syncInProgress;l.default.logAction(l.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),this.syncInProgress||(this.residualMembers=i.copy(p),this.setInProgress(!0))},d.prototype.endSync=function(){var p=this.map,O=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),O){for(var v in p){var R=p[v];R.action==="absent"&&delete p[v]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var v in this.residualMembers)delete p[v];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},d.prototype.waitSync=function(p){var O=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),!O){p();return}this.once("sync",p)},d.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},d.prototype.setInProgress=function(p){l.default.logAction(l.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+p),this.syncInProgress=p,this.presence.syncComplete=!p},d}(u.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=t(56),a=t(31),u=t(11),l=r.__importDefault(t(5)),f=r.__importDefault(t(3)),m=function(){function b(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return b.prototype.isWordArray=function(C){return C!=null&&C.sigBytes!==void 0},b.prototype.isArrayBuffer=function(C){return C!=null&&C.constructor===ArrayBuffer},b.prototype.isTypedArray=function(C){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C)},b.prototype.uint8ViewToBase64=function(C){for(var h="",E=this.base64CharSet,w=C.byteLength,I=w%3,S=w-I,T,x,g,y,d,p=0;p<S;p=p+3)d=C[p]<<16|C[p+1]<<8|C[p+2],T=(d&16515072)>>18,x=(d&258048)>>12,g=(d&4032)>>6,y=d&63,h+=E[T]+E[x]+E[g]+E[y];return I==1?(d=C[S],T=(d&252)>>2,x=(d&3)<<4,h+=E[T]+E[x]+"=="):I==2&&(d=C[S]<<8|C[S+1],T=(d&64512)>>10,x=(d&1008)>>4,g=(d&15)<<2,h+=E[T]+E[x]+E[g]+"="),h},b.prototype.base64ToArrayBuffer=function(C){for(var h=atob==null?void 0:atob(C),E=h.length,w=new Uint8Array(E),I=0;I<E;I++){var S=h.charCodeAt(I);w[I]=S}return w.buffer},b.prototype.isBuffer=function(C){return this.isArrayBuffer(C)||this.isWordArray(C)||this.isTypedArray(C)},b.prototype.toBuffer=function(C){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(C))return new Uint8Array(C);if(this.isTypedArray(C))return new Uint8Array(C.buffer);if(this.isWordArray(C)){for(var h=new ArrayBuffer(C.sigBytes),E=new Uint8Array(h),w=0;w<C.sigBytes;w++)E[w]=C.words[w>>>2]>>>24-w%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},b.prototype.toArrayBuffer=function(C){return this.isArrayBuffer(C)?C:this.toBuffer(C).buffer},b.prototype.toWordArray=function(C){return this.isTypedArray(C)&&(C=C.buffer),this.isWordArray(C)?C:l.default.create(C)},b.prototype.base64Encode=function(C){return this.isWordArray(C)?(0,u.stringify)(C):this.uint8ViewToBase64(this.toBuffer(C))},b.prototype.base64Decode=function(C){return ArrayBuffer&&f.default.Config.atob?this.base64ToArrayBuffer(C):(0,u.parse)(C)},b.prototype.hexEncode=function(C){return(0,i.stringify)(this.toWordArray(C))},b.prototype.hexDecode=function(C){var h=(0,i.parse)(C);return ArrayBuffer?this.toArrayBuffer(h):h},b.prototype.utf8Encode=function(C){return f.default.Config.TextEncoder?new f.default.Config.TextEncoder().encode(C).buffer:(0,a.parse)(C)},b.prototype.utf8Decode=function(C){if(!this.isBuffer(C))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(C)?new TextDecoder().decode(C):(C=this.toWordArray(C),(0,a.stringify)(C))},b.prototype.bufferCompare=function(C,h){if(!C)return-1;if(!h)return 1;var E=this.toWordArray(C),w=this.toWordArray(h);E.clamp(),w.clamp();var I=E.sigBytes-w.sigBytes;if(I!=0)return I;for(var S=E.words,T=w.words,x=0;x<S.length;x++)if(I=S[x]-T[x],I!=0)return I;return 0},b.prototype.byteLength=function(C){return this.isArrayBuffer(C)||this.isTypedArray(C)?C.byteLength:this.isWordArray(C)?C.sigBytes:-1},b.prototype.typedArrayToBuffer=function(C){return C.buffer},b}();e.default=new m},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return r.enc.Hex})},function(s,e,t){"use strict";t.r(e);var r=t(5),i=t.n(r),a=t(11),u=t.n(a),l=t(22),f=t.n(l),m=t(2),b=t.n(m),C=t(4),h=t.n(C),E=function(w,I){var S="aes",T=256,x="cbc",g=16,y=4,d=4294967296,p=2147483648,O;if(w.getRandomWordArray)O=w.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&w.getRandomValues){var v=new Uint32Array(y);O=function($,G){var K=$/4,ee=K==y?v:new Uint32Array(K);w.getRandomValues(ee,function(re){typeof G!="undefined"&&G(re,I.toWordArray(ee))})}}else O=function($,G){b.a.logAction(b.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var K=$/4,ee=new Array(K),re=0;re<K;re++)ee[re]=Math.floor(Math.random()*d)-p;G(null,i.a.create(ee))};function R($){return $+g&-g}function N($){if($.algorithm==="aes"&&$.mode==="cbc"){if($.keyLength===128||$.keyLength===256)return;throw new Error("Unsupported key length "+$.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function z($){return $.replace("_","/").replace("-","+")}var W=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function F(){}function _(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}F.CipherParams=_,F.getDefaultParams=function($){var G;if(typeof $=="function"||typeof $=="string"){if(b.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof $=="function")F.generateRandomKey(function(ee){$(null,F.getDefaultParams({key:ee}))});else if(typeof arguments[1]=="function")arguments[1](null,F.getDefaultParams({key:$}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!$.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof $.key=="string"?G=Object(a.parse)(z($.key)):G=I.toWordArray($.key);var K=new _;if(K.key=G,K.algorithm=$.algorithm||S,K.keyLength=G.words.length*(4*8),K.mode=$.mode||x,$.keyLength&&$.keyLength!==K.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+$.keyLength+" was specified, but the key actually has length "+K.keyLength);return N(K),K},F.generateRandomKey=function($,G){arguments.length==1&&typeof $=="function"&&(G=$,$=void 0),O(($||T)/8,function(K,ee){G!==void 0&&G(K?h.a.fromValues(K):null,ee)})},F.getCipher=function($){var G=$ instanceof _?$:F.getDefaultParams($);return{cipherParams:G,cipher:new L(G,y,$.iv)}};function L($,G,K){this.algorithm=$.algorithm+"-"+String($.keyLength)+"-"+$.mode,this.cjsAlgorithm=$.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=I.toWordArray($.key),K&&(this.iv=I.toWordArray(K).clone()),this.blockLengthWords=G}return L.prototype.encrypt=function($,G){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.encrypt()",""),$=I.toWordArray($);var K=$.sigBytes,ee=R(K),re=this,X=function(){re.getIv(function(P,B){if(P){G(P);return}var H=re.encryptCipher.process($.concat(W[ee-K])),j=B.concat(H);G(null,j)})};this.encryptCipher?X():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):O(g,function(P,B){if(P){G(P);return}re.encryptCipher=f.a.algo[re.cjsAlgorithm].createEncryptor(re.key,{iv:B}),re.iv=B,X()})},L.prototype.decrypt=function($){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.decrypt()",""),$=I.toWordArray($);var G=this.blockLengthWords,K=$.words,ee=i.a.create(K.slice(0,G)),re=i.a.create(K.slice(G)),X=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:ee}),P=X.process(re),B=X.finalize();return X.reset(),B&&B.sigBytes&&P.concat(B),P},L.prototype.getIv=function($){if(this.iv){var G=this.iv;this.iv=null,$(null,G);return}var K=this;O(g,function(ee,re){if(ee){$(ee);return}$(null,K.encryptCipher.process(re))})},F};e.default=E},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(){var i=r,a=i.lib,u=a.WordArray,l=i.enc,f=l.Utf16=l.Utf16BE={stringify:function(b){for(var C=b.words,h=b.sigBytes,E=[],w=0;w<h;w+=2){var I=C[w>>>2]>>>16-w%4*8&65535;E.push(String.fromCharCode(I))}return E.join("")},parse:function(b){for(var C=b.length,h=[],E=0;E<C;E++)h[E>>>1]|=b.charCodeAt(E)<<16-E%2*16;return u.create(h,C*2)}};l.Utf16LE={stringify:function(b){for(var C=b.words,h=b.sigBytes,E=[],w=0;w<h;w+=2){var I=m(C[w>>>2]>>>16-w%4*8&65535);E.push(String.fromCharCode(I))}return E.join("")},parse:function(b){for(var C=b.length,h=[],E=0;E<C;E++)h[E>>>1]|=m(b.charCodeAt(E)<<16-E%2*16);return u.create(h,C*2)}};function m(b){return b<<8&4278255360|b>>>8&16711935}}(),r.enc.Utf16})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(28))})(this,function(r){return function(i){var a=r,u=a.lib,l=u.CipherParams,f=a.enc,m=f.Hex,b=a.format,C=b.Hex={stringify:function(h){return h.ciphertext.toString(m)},parse:function(h){var E=m.parse(h);return l.create({ciphertext:E})}}}(),r.format.Hex})},function(s,e,t){(function(r,i){s.exports=e=i(t(6),t(11),t(61),t(27),t(28))})(this,function(r){return function(){var i=r,a=i.lib,u=a.BlockCipher,l=i.algo,f=[],m=[],b=[],C=[],h=[],E=[],w=[],I=[],S=[],T=[];(function(){for(var y=[],d=0;d<256;d++)d<128?y[d]=d<<1:y[d]=d<<1^283;for(var p=0,O=0,d=0;d<256;d++){var v=O^O<<1^O<<2^O<<3^O<<4;v=v>>>8^v&255^99,f[p]=v,m[v]=p;var R=y[p],N=y[R],z=y[N],W=y[v]*257^v*16843008;b[p]=W<<24|W>>>8,C[p]=W<<16|W>>>16,h[p]=W<<8|W>>>24,E[p]=W;var W=z*16843009^N*65537^R*257^p*16843008;w[v]=W<<24|W>>>8,I[v]=W<<16|W>>>16,S[v]=W<<8|W>>>24,T[v]=W,p?(p=R^y[y[y[z^R]]],O^=y[y[O]]):p=O=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],g=l.AES=u.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var d=this._keyPriorReset=this._key,p=d.words,O=d.sigBytes/4,v=this._nRounds=O+6,R=(v+1)*4,N=this._keySchedule=[],z=0;z<R;z++)z<O?N[z]=p[z]:(y=N[z-1],z%O?O>6&&z%O==4&&(y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255]):(y=y<<8|y>>>24,y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255],y^=x[z/O|0]<<24),N[z]=N[z-O]^y);for(var W=this._invKeySchedule=[],F=0;F<R;F++){var z=R-F;if(F%4)var y=N[z];else var y=N[z-4];F<4||z<=4?W[F]=y:W[F]=w[f[y>>>24]]^I[f[y>>>16&255]]^S[f[y>>>8&255]]^T[f[y&255]]}}},encryptBlock:function(y,d){this._doCryptBlock(y,d,this._keySchedule,b,C,h,E,f)},decryptBlock:function(y,d){var p=y[d+1];y[d+1]=y[d+3],y[d+3]=p,this._doCryptBlock(y,d,this._invKeySchedule,w,I,S,T,m);var p=y[d+1];y[d+1]=y[d+3],y[d+3]=p},_doCryptBlock:function(y,d,p,O,v,R,N,z){for(var W=this._nRounds,F=y[d]^p[0],_=y[d+1]^p[1],L=y[d+2]^p[2],$=y[d+3]^p[3],G=4,K=1;K<W;K++){var ee=O[F>>>24]^v[_>>>16&255]^R[L>>>8&255]^N[$&255]^p[G++],re=O[_>>>24]^v[L>>>16&255]^R[$>>>8&255]^N[F&255]^p[G++],X=O[L>>>24]^v[$>>>16&255]^R[F>>>8&255]^N[_&255]^p[G++],P=O[$>>>24]^v[F>>>16&255]^R[_>>>8&255]^N[L&255]^p[G++];F=ee,_=re,L=X,$=P}var ee=(z[F>>>24]<<24|z[_>>>16&255]<<16|z[L>>>8&255]<<8|z[$&255])^p[G++],re=(z[_>>>24]<<24|z[L>>>16&255]<<16|z[$>>>8&255]<<8|z[F&255])^p[G++],X=(z[L>>>24]<<24|z[$>>>16&255]<<16|z[F>>>8&255]<<8|z[_&255])^p[G++],P=(z[$>>>24]<<24|z[F>>>16&255]<<16|z[_>>>8&255]<<8|z[L&255])^p[G++];y[d]=ee,y[d+1]=re,y[d+2]=X,y[d+3]=P},keySize:256/32});i.AES=u._createHelper(g)}(),r.AES})},function(s,e,t){(function(r,i){s.exports=e=i(t(6))})(this,function(r){return function(i){var a=r,u=a.lib,l=u.WordArray,f=u.Hasher,m=a.algo,b=[];(function(){for(var S=0;S<64;S++)b[S]=i.abs(i.sin(S+1))*4294967296|0})();var C=m.MD5=f.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,T){for(var x=0;x<16;x++){var g=T+x,y=S[g];S[g]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var d=this._hash.words,p=S[T+0],O=S[T+1],v=S[T+2],R=S[T+3],N=S[T+4],z=S[T+5],W=S[T+6],F=S[T+7],_=S[T+8],L=S[T+9],$=S[T+10],G=S[T+11],K=S[T+12],ee=S[T+13],re=S[T+14],X=S[T+15],P=d[0],B=d[1],H=d[2],j=d[3];P=h(P,B,H,j,p,7,b[0]),j=h(j,P,B,H,O,12,b[1]),H=h(H,j,P,B,v,17,b[2]),B=h(B,H,j,P,R,22,b[3]),P=h(P,B,H,j,N,7,b[4]),j=h(j,P,B,H,z,12,b[5]),H=h(H,j,P,B,W,17,b[6]),B=h(B,H,j,P,F,22,b[7]),P=h(P,B,H,j,_,7,b[8]),j=h(j,P,B,H,L,12,b[9]),H=h(H,j,P,B,$,17,b[10]),B=h(B,H,j,P,G,22,b[11]),P=h(P,B,H,j,K,7,b[12]),j=h(j,P,B,H,ee,12,b[13]),H=h(H,j,P,B,re,17,b[14]),B=h(B,H,j,P,X,22,b[15]),P=E(P,B,H,j,O,5,b[16]),j=E(j,P,B,H,W,9,b[17]),H=E(H,j,P,B,G,14,b[18]),B=E(B,H,j,P,p,20,b[19]),P=E(P,B,H,j,z,5,b[20]),j=E(j,P,B,H,$,9,b[21]),H=E(H,j,P,B,X,14,b[22]),B=E(B,H,j,P,N,20,b[23]),P=E(P,B,H,j,L,5,b[24]),j=E(j,P,B,H,re,9,b[25]),H=E(H,j,P,B,R,14,b[26]),B=E(B,H,j,P,_,20,b[27]),P=E(P,B,H,j,ee,5,b[28]),j=E(j,P,B,H,v,9,b[29]),H=E(H,j,P,B,F,14,b[30]),B=E(B,H,j,P,K,20,b[31]),P=w(P,B,H,j,z,4,b[32]),j=w(j,P,B,H,_,11,b[33]),H=w(H,j,P,B,G,16,b[34]),B=w(B,H,j,P,re,23,b[35]),P=w(P,B,H,j,O,4,b[36]),j=w(j,P,B,H,N,11,b[37]),H=w(H,j,P,B,F,16,b[38]),B=w(B,H,j,P,$,23,b[39]),P=w(P,B,H,j,ee,4,b[40]),j=w(j,P,B,H,p,11,b[41]),H=w(H,j,P,B,R,16,b[42]),B=w(B,H,j,P,W,23,b[43]),P=w(P,B,H,j,L,4,b[44]),j=w(j,P,B,H,K,11,b[45]),H=w(H,j,P,B,X,16,b[46]),B=w(B,H,j,P,v,23,b[47]),P=I(P,B,H,j,p,6,b[48]),j=I(j,P,B,H,F,10,b[49]),H=I(H,j,P,B,re,15,b[50]),B=I(B,H,j,P,z,21,b[51]),P=I(P,B,H,j,K,6,b[52]),j=I(j,P,B,H,R,10,b[53]),H=I(H,j,P,B,$,15,b[54]),B=I(B,H,j,P,O,21,b[55]),P=I(P,B,H,j,_,6,b[56]),j=I(j,P,B,H,X,10,b[57]),H=I(H,j,P,B,W,15,b[58]),B=I(B,H,j,P,ee,21,b[59]),P=I(P,B,H,j,N,6,b[60]),j=I(j,P,B,H,G,10,b[61]),H=I(H,j,P,B,v,15,b[62]),B=I(B,H,j,P,L,21,b[63]),d[0]=d[0]+P|0,d[1]=d[1]+B|0,d[2]=d[2]+H|0,d[3]=d[3]+j|0},_doFinalize:function(){var S=this._data,T=S.words,x=this._nDataBytes*8,g=S.sigBytes*8;T[g>>>5]|=128<<24-g%32;var y=i.floor(x/4294967296),d=x;T[(g+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,T[(g+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,S.sigBytes=(T.length+1)*4,this._process();for(var p=this._hash,O=p.words,v=0;v<4;v++){var R=O[v];O[v]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return p},clone:function(){var S=f.clone.call(this);return S._hash=this._hash.clone(),S}});function h(S,T,x,g,y,d,p){var O=S+(T&x|~T&g)+y+p;return(O<<d|O>>>32-d)+T}function E(S,T,x,g,y,d,p){var O=S+(T&g|x&~g)+y+p;return(O<<d|O>>>32-d)+T}function w(S,T,x,g,y,d,p){var O=S+(T^x^g)+y+p;return(O<<d|O>>>32-d)+T}function I(S,T,x,g,y,d,p){var O=S+(x^(T|~g))+y+p;return(O<<d|O>>>32-d)+T}a.MD5=f._createHelper(C),a.HmacMD5=f._createHmacHelper(C)}(Math),r.MD5})},function(s,e,t){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importDefault(t(3)),u=i.__importStar(t(1)),l=i.__importDefault(t(8)),f=t(4),m=i.__importDefault(t(18)),b=i.__importDefault(t(16)),C=i.__importDefault(t(21)),h=i.__importDefault(t(2)),E=t(29),w=i.__importDefault(t(63)),I=t(25);function S(g){var y=g.statusCode;return y===408&&!g.code||y===400&&!g.code||y>=500&&y<=504}function T(g){var y=g.connection,d=y&&y.connectionManager.host;return d?[d].concat(l.default.getFallbackHosts(g.options)):l.default.getHosts(g.options)}var x=(r=function(){function g(y){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=T,this.options=y||{};var d=this.options.connectivityCheckUrl||l.default.connectivityCheckUrl,p=this.options.connectivityCheckParams,O=!this.options.connectivityCheckUrl;a.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(v,R,N,z,W,F,_){var L=b.default.createRequest(N,z,W,F,C.default.REQ_SEND,R&&R.options.timeouts,v);return L.once("complete",_),L.exec(),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+d),this.doUri(m.default.Get,null,d,null,null,p,function(R,N,z,W,F){var _=!1;O?_=!R&&(N==null?void 0:N.replace(/\n/,""))=="yes":_=!R&&(0,I.isSuccessCode)(F),h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+_),v(null,_)})}):a.default.Config.jsonpSupported?(this.Request=function(v,R,N,z,W,F,_){var L=(0,E.createRequest)(N,z,W,F,C.default.REQ_SEND,R&&R.options.timeouts,v);return L.once("complete",_),a.default.Config.nextTick(function(){L.exec()}),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){var R=this,N=l.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(v);return}this.checksInProgress=[v],h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+N);var z=new E.Request("isTheInternetUp",N,null,null,null,C.default.REQ_SEND,l.default.TIMEOUTS);z.once("complete",function(W,F){var _=!W&&F;h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+_);for(var L=0;L<R.checksInProgress.length;L++)R.checksInProgress[L](null,_);R.checksInProgress=null}),a.default.Config.nextTick(function(){z.exec()})}):a.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=w.default,this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+d),this.doUri(m.default.Get,null,d,null,null,null,function(R,N){var z=!R&&(N==null?void 0:N.replace(/\n/,""))=="yes";h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+z),v(null,z)})}):this.Request=function(v,R,N,z,W,F,_){_(new f.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return g.prototype.do=function(y,d,p,O,v,R,N){var z=this,W=typeof p=="function"?p:function($){return d.baseUri($)+p},F=d._currentFallback;if(F)if(F.validUntil>u.now()){if(!this.Request){N==null||N(new f.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(y,d,W(F.host),O,R,v,function($){for(var G=[],K=1;K<arguments.length;K++)G[K-1]=arguments[K];if($&&S($)){d._currentFallback=null,z.do(y,d,p,O,v,R,N);return}N==null||N.apply(void 0,i.__spreadArray([$],G,!1))});return}else d._currentFallback=null;var _=T(d);if(_.length===1){this.doUri(y,d,W(_[0]),O,v,R,N);return}var L=function($,G){var K=$.shift();z.doUri(y,d,W(K),O,v,R,function(ee){for(var re=[],X=1;X<arguments.length;X++)re[X-1]=arguments[X];if(ee&&S(ee)&&$.length){L($,!0);return}G&&(d._currentFallback={host:K,validUntil:u.now()+d.options.timeouts.fallbackRetryTimeout}),N==null||N.apply(void 0,i.__spreadArray([ee],re,!1))})};L(_)},g.prototype.doUri=function(y,d,p,O,v,R,N){if(!this.Request){N(new f.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(y,d,p,O,R,v,N)},g}(),r.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],r.methodsWithoutBody=[m.default.Get,m.default.Delete],r.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],r);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importStar(t(4)),a=r.__importDefault(t(3)),u=r.__importDefault(t(8)),l=r.__importStar(t(1)),f=t(1);function m(h,E){return!!E.get("x-ably-errorcode")}function b(h,E){if(m(h,E))return h.error&&i.default.fromValues(h.error)}function C(h,E,w,I,S,T,x){var g=new Headers(I||{}),y=h?h.toUpperCase():l.isEmptyArg(T)?"GET":"POST",d=new AbortController,p=setTimeout(function(){d.abort(),x(new i.PartialErrorInfo("Request timed out",null,408))},E?E.options.timeouts.httpRequestTimeout:u.default.TIMEOUTS.httpRequestTimeout),O={method:y,headers:g,body:T};a.default.Config.isWebworker||(O.credentials=g.has("authorization")?"include":"same-origin"),(0,f.getGlobalObject)().fetch(w+"?"+new URLSearchParams(S||{}),O).then(function(v){clearTimeout(p);var R=v.headers.get("Content-Type"),N;R&&R.indexOf("application/x-msgpack")>-1?N=v.arrayBuffer():R&&R.indexOf("application/json")>-1?N=v.json():N=v.text(),N.then(function(z){var W=!!R&&R.indexOf("application/x-msgpack")===-1;if(v.ok)x(null,z,v.headers,W,v.status);else{var F=b(z,v.headers)||new i.PartialErrorInfo("Error response received from server: "+v.status+" body was: "+a.default.Config.inspect(z),null,v.status);x(F,z,v.headers,W,v.status)}})}).catch(function(v){clearTimeout(p),x(v)})}e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(41)),a=r.__importStar(t(1)),u=a.getGlobalObject();function l(){var C=u.location;return!u.WebSocket||!C||!C.origin||C.origin.indexOf("http")>-1}var f=u.navigator&&u.navigator.userAgent.toString(),m=u.location&&u.location.href,b={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:m,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:u.WebSocket,fetchSupported:!!u.fetch,xhrSupported:u.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:l(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!u.TextDecoder,preferBinary:!1,ArrayBuffer:u.ArrayBuffer,atob:u.atob,nextTick:typeof u.setImmediate!="undefined"?u.setImmediate.bind(u):function(C){setTimeout(C,0)},addEventListener:u.addEventListener,inspect:JSON.stringify,stringByteSize:function(C){return u.TextDecoder&&new u.TextEncoder().encode(C).length||C.length},TextEncoder:u.TextEncoder,TextDecoder:u.TextDecoder,Promise:u.Promise,getRandomValues:function(C){if(C!==void 0)return function(h,E){C.getRandomValues(h),E&&E(null)}}(u.crypto||msCrypto)};e.default=b},function(s,e,t){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),a=i.__importStar(t(1)),u="ablyjs-storage-test",l=function(){function f(){try{r.sessionStorage.setItem(u,u),r.sessionStorage.removeItem(u),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{r.localStorage.setItem(u,u),r.localStorage.removeItem(u),this.localSupported=!0}catch(m){this.localSupported=!1}}return f.prototype.get=function(m){return this._get(m,!1)},f.prototype.getSession=function(m){return this._get(m,!0)},f.prototype.remove=function(m){return this._remove(m,!1)},f.prototype.removeSession=function(m){return this._remove(m,!0)},f.prototype.set=function(m,b,C){return this._set(m,b,C,!1)},f.prototype.setSession=function(m,b,C){return this._set(m,b,C,!0)},f.prototype._set=function(m,b,C,h){var E={value:b};return C&&(E.expires=a.now()+C),this.storageInterface(h).setItem(m,JSON.stringify(E))},f.prototype._get=function(m,b){if(b&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!b&&!this.localSupported)throw new Error("Local Storage not supported");var C=this.storageInterface(b).getItem(m);if(!C)return null;var h=JSON.parse(C);return h.expires&&h.expires<a.now()?(this.storageInterface(b).removeItem(m),null):h.value},f.prototype._remove=function(m,b){return this.storageInterface(b).removeItem(m)},f.prototype.storageInterface=function(m){return m?r.sessionStorage:r.localStorage},f}();e.default=new l}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),i=r.__importDefault(t(67)),a={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(r||(r={})),e.default=r},function(s,e,t){"use strict";t.r(e);var r=t(29),i=t.n(r),a=t(1),u=t(3),l=t.n(u),f=t(12),m=t.n(f),b=t(16),C=t.n(b),h=function(T){var x="xhr_polling";function g(y,d,p){p.stream=!1,m.a.call(this,y,d,p),this.shortName=x}return a.inherits(g,m.a),g.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.allowComet},g.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(y,d,p,O,v){return C.a.createRequest(y,d,p,O,v,this.timeouts)},typeof T!="undefined"&&g.isAvailable()&&(T.supportedTransports[x]=g),g},E=h,w=function(T){var x="xhr_streaming";function g(y,d,p){m.a.call(this,y,d,p),this.shortName=x}return a.inherits(g,m.a),g.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.streamingSupported&&l.a.Config.allowComet},g.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(y,d,p,O,v){return C.a.createRequest(y,d,p,O,v,this.timeouts)},typeof T!="undefined"&&g.isAvailable()&&(T.supportedTransports[x]=g),g},I=w,S=e.default=[i.a,E,I]}]).default})});U();U();var co=(y=>(y.MEETING_START="meeting.start",y.MEETING_LEAVE="meeting.leave",y.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",y.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",y.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",y.MEETING_PARTICIPANT_LEFT="meeting.participant-left",y.MEETING_JOIN="meeting.join",y.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",y.MEETING_HOST_CHANGE="meeting.host-change",y.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",y.MEETING_DEVICES_CHANGE="meeting.devices-change",y.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",y.MEETING_STATE_UPDATE="meeting.state-update",y.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",y.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",y.MY_PARTICIPANT_UPDATED="my-participant.update",y.MY_PARTICIPANT_LEFT="my-participant.left",y.MY_PARTICIPANT_JOINED="my-participant.joined",y.MEETING_KICK_PARTICIPANT="meeting.kick-participant",y.DESTROY="destroy",y))(co||{}),fo=(u=>(u.FRAME_LOAD="frame.load",u.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",u.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",u.FRAME_LOCALE_UPDATE="frame.locales-update",u.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",u.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",u))(fo||{}),Xs=(l=>(l.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",l.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",l.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",l.TOGGLE_CAM="meeting-controls.toggle-cam",l.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",l.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",l.HANG_UP="hang-up",l))(Xs||{}),Ar=(E=>(E.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",E.REALTIME_HOST_CHANGE="realtime.host-change",E.REALTIME_HOST_AVAILABLE="realtime.host-available",E.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",E.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",E.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",E.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",E.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",E.REALTIME_GATHER="realtime.gather",E.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",E.REALTIME_SET_AVATAR="realtime.set-avatar",E.REALTIME_DRAWING_CHANGE="realtime.drawing-change",E.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",E))(Ar||{});var ea=(b=>(b[b.MEETING_FAILED=-1]="MEETING_FAILED",b[b.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",b[b.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",b[b.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",b[b.MEETING_CONNECTING=3]="MEETING_CONNECTING",b[b.MEETING_CONNECTED=4]="MEETING_CONNECTED",b[b.MEETING_RECONNECT=5]="MEETING_RECONNECT",b[b.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",b[b.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",b[b.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",b))(ea||{}),ta=(u=>(u.JOINED="participant.joined",u.LOCAL_JOINED="participant.local-joined",u.LEFT="participant.left",u.LOCAL_LEFT="participant.local-left",u.LOCAL_UPDATED="participant.updated",u.LIST_UPDATED="participant.list-updated",u))(ta||{}),ho=(l=>(l[l.NOT_AVAILABLE=0]="NOT_AVAILABLE",l[l.GOOD=1]="GOOD",l[l.BAD=2]="BAD",l[l.POOR=3]="POOR",l[l.DISCONNECTED=4]="DISCONNECTED",l[l.RECONNECTING=5]="RECONNECTING",l[l.LOST_CONNECTION=6]="LOST_CONNECTION",l))(ho||{}),Sl=(u=>(u.NO_CAM="devices.no-cam",u.NO_DEVICES="devices.no-devices",u.DEVICES_BLOCKED="devices.blocked",u.DEVICES_CAM_BLOCKED="devices.cam-blocked",u.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",u.DEVICES_UNKNOWN_ERROR="devices.unknown-error",u))(Sl||{});U();var yi=(r=>(r.HOST="host",r.GUEST="guest",r.AUDIENCE="audience",r))(yi||{});U();U();U();U();var _t=(i,a,u,...l)=>Me(void 0,[i,a,u,...l],function*(s,e,t,r={}){let f=yield fetch(s,{method:e,headers:fe({"Content-Type":"application/json"},r),body:t?JSON.stringify(t):null});if(!f.ok)throw f;try{return yield f.json()}catch(m){return f.ok}});U();var Zh=Un(Tl()),tt=class{constructor(e){this.debug=(0,Zh.default)(e)}log(e,...t){this.debug(e,...t)}};U();U();var Mp=Un(Rl());var Ae=class{constructor(e={}){this.subscribe=e=>{this.callbacks.push(e)};this.unsubscribe=e=>{this.callbacks=this.callbacks.filter(t=>t!==e)};this.publish=(...e)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,e).catch(r=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(e)}
            Error: ${r}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(e,t)=>new Promise((r,i)=>{try{let a=e(...t);r(a)}catch(a){i(a)}});let{logger:t,throttleTime:r}=e;this.logger=t!=null?t:new tt("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,Mp.default)(this.publish,this.throttle))}};var Sr=class{constructor(){this.observers={};this.subscribe=(e,t)=>{this.logger.log(`subscribed to ${e} event`),this.observers[e]||(this.observers[e]=new Ae({logger:this.logger})),this.observers[e].subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log(`unsubscribed from ${e} event`),this.observers[e]&&(this.observers[e].reset(),delete this.observers[e])};this.publish=(e,t)=>{e in this.observers&&this.observers[e].publish(t)}}};U();U();U();var _p=Un(oa()),xl=class{setConfig(e){this.configuration=e}get(e,t){if(!this.configuration)throw new Error("configs is not available");return(0,_p.get)(this.configuration,e,t)}},Ie=new xl;var vt=class{static createUrl(e,t,r={}){let i=new URL(t,e);return Object.keys(r).forEach(a=>i.searchParams.append(a,r[a])),i.toString()}static validateApiKey(e,t){let r="/user/checkapikey",i=this.createUrl(e,r);return _t(i,"POST",{apiKey:t})}static fetchConfig(e,t){let r="/immersive-config",i=this.createUrl(e,r);return _t(i,"POST",{apiKey:t})}static fetchLimits(e,t){return Me(this,null,function*(){let r="/user/check_limits",i=this.createUrl(e,r);return(yield _t(i,"GET","",{apikey:t})).usage})}static fetchWaterMark(e,t){return Me(this,null,function*(){let r="/user/watermark",i=this.createUrl(e,r),{message:a}=yield _t(i,"POST",{apiKey:t});return a})}static createAnnotations(e,t,r){return Me(this,null,function*(){let i="/annotations",a=this.createUrl(e,i);return _t(a,"POST",fe({},r),{apikey:t})})}static updateComment(e,t,r,i){return Me(this,null,function*(){let a=`/comments/${r}`,u=this.createUrl(e,a);return _t(u,"PUT",{text:i},{apikey:t})})}static createComment(e,t,r){return Me(this,null,function*(){let i="/comments",a=this.createUrl(e,i);return _t(a,"POST",fe({},r),{apikey:t})})}static fetchAnnotation(e,t,r){return Me(this,null,function*(){let i="/annotations",a=this.createUrl(e,i,{roomId:r.roomId,url:r.url});return _t(a,"GET",void 0,{apikey:t})})}static resolveAnnotation(e,t,r){return Me(this,null,function*(){let i=`/annotations/resolve/${r}`,a=this.createUrl(e,i);return _t(a,"POST",{},{apikey:t})})}static deleteComment(e,t,r){return Me(this,null,function*(){let i=`/comments/${r}`,a=this.createUrl(e,i);return _t(a,"DELETE",{},{apikey:t})})}static deleteAnnotation(e,t,r){return Me(this,null,function*(){let i=`/annotations/${r}`,a=this.createUrl(e,i);return _t(a,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(e,t){return Me(this,null,function*(){let r=Ie.get("apiUrl"),i="/participants",a=this.createUrl(r,i);return _t(a,"POST",fe({},t),{apikey:e})})}static sendActivity(e,t,r,i){return Me(this,null,function*(){let a="/activity",u=Ie.get("apiUrl"),l=Ie.get("roomId"),f=Ie.get("apiKey"),m=this.createUrl(u,a);return _t(m,"POST",{groupId:t,groupName:r,meetingId:l,product:i,userId:e},{apikey:f})})}};U();var Cn=class extends Sr{constructor(){super(...arguments);this.isAttached=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let f=`${this.name} @ attach - params are required`;throw this.logger.log(f),new Error(f)}let{realtime:r,localParticipant:i,group:a,config:u,eventBus:l}=t;if(!r.isDomainWhitelisted){let f=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(f);return}if(Ie.setConfig(u),this.realtime=r,this.localParticipant=i,this.group=a,this.eventBus=l,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1,Object.keys(this.observers).forEach(t=>this.unsubscribe(t))}}};U();var Ml=(i=>(i.presence3dMatterport="presence",i.presence3dAutodesk="presence",i.presence3dThreejs="presence",i.realtime="presence",i))(Ml||{});U();var _l=(t=>(t.LEFT="left",t.RIGHT="right",t))(_l||{}),Pl=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(Pl||{});var go=class extends Cn{constructor(t,r){super();this.sidebarOpen=!1;this.onFixedPin=t=>{document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:fe({},t),composed:!0,bubbles:!0}))};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),this.pinAdapter.setActive(this.sidebarOpen),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var f,m;this.button=document.createElement("superviz-comments-button");let t=(f=this.layoutOptions)==null?void 0:f.buttonLocation,r=(m=this.layoutOptions)==null?void 0:m.position;if(!t){document.body.appendChild(this.button),this.button.commentsPosition=r;return}let i="",a=Object.values(Pl),u=!1,l=!a.includes(t.toLocaleLowerCase());if(l){let b=window.document.body.querySelector(`#${t}`);b?(b.appendChild(this.button),i="position: relative"):(u=!0,t="top-left")}if(!l||u){document.body.appendChild(this.button);let[b,C]=t.split("-");i=`${b}: 20px; ${C}: 20px;`}this.button.positionStyles=i,this.button.commentsPosition=r};this.positionComments=()=>{var u;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left: 0;",document.body.appendChild(this.element);let t=(u=this.layoutOptions)==null?void 0:u.position;if(!t)return;let r=Object.values(_l),i=t.toLocaleLowerCase();if(!r.includes(i))return;let a=t==="left"?"left: 0;":"right: 0;";this.element.side=a};this.createAnnotation=r=>Me(this,[r],function*({detail:t}){try{let{position:i,text:a}=t,{url:u}=this,l=yield vt.createAnnotations(Ie.get("apiUrl"),Ie.get("apiKey"),{roomId:Ie.get("roomId"),position:JSON.stringify(i),url:u,userId:this.localParticipant.id}),f=yield this.createComment(l.uuid,a);this.addAnnotation(Ve(fe({},l),{comments:[f]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:l.uuid},composed:!0,bubbles:!0}))}catch(i){this.logger.log("error when creating annotation",i)}});this.deleteAnnotation=r=>Me(this,[r],function*({detail:t}){try{let{uuid:i}=t;yield vt.deleteAnnotation(Ie.get("apiUrl"),Ie.get("apiKey"),i);let a=this.annotations.filter(u=>u.uuid!==i);this.updateAnnotationList(a),this.pinAdapter.removeAnnotationPin(i),this.element.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when deleting annotation",i)}});this.updateComment=r=>Me(this,[r],function*({detail:t}){try{let{uuid:i,text:a}=t;yield vt.updateComment(Ie.get("apiUrl"),Ie.get("apiKey"),i,a);let u=this.annotations.map(l=>Object.assign({},l,{comments:l.comments.map(f=>f.uuid===i?Object.assign({},f,{text:a}):f)}));this.updateAnnotationList(u)}catch(i){this.logger.log("error when updating comment",i)}});this.resolveAnnotation=r=>Me(this,[r],function*({detail:t}){try{let{uuid:i}=t,{resolved:a}=yield vt.resolveAnnotation(Ie.get("apiUrl"),Ie.get("apiKey"),i),u=this.annotations.map(l=>l.uuid===i?Object.assign({},l,{resolved:a}):l);if(this.updateAnnotationList(u),a){this.pinAdapter.removeAnnotationPin(i);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when resolve annotation",i)}});this.deleteComment=r=>Me(this,[r],function*({detail:t}){try{let{uuid:i,annotationId:a}=t;if(!i||!a)return;yield vt.deleteComment(Ie.get("apiUrl"),Ie.get("apiKey"),i);let u=this.annotations.find(f=>f.uuid===a);u.comments=u.comments.filter(f=>f.uuid!==i);let l=this.annotations.map(f=>f.uuid===a?u:f);this.element.updateAnnotations(l),this.updateAnnotationList(l)}catch(i){this.logger.log("error when deleting comment",i)}});this.onAnnotationListUpdate=t=>{let{data:r,clientId:i}=t;this.localParticipant.id!==i&&(this.annotations=r,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new tt("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions=r!=null?r:{position:"left",buttonLocation:"top-left"},this.pinAdapter=t}get url(){let t=new URL(this.clientUrl);return t.search="",t.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){this.destroyListeners(),document.body.querySelector("superviz-comments").remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){this.button.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onFixedPin)}destroyListeners(){this.button.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("create-annotation",this.createAnnotation),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onFixedPin)}createComment(t,r,i=!1){return Me(this,null,function*(){try{let a=yield vt.createComment(Ie.get("apiUrl"),Ie.get("apiKey"),{annotationId:t,userId:this.localParticipant.id,text:r});return i&&this.addComment(t,a),a}catch(a){this.logger.log("error when creating comment",a)}})}addAnnotation(t){let r=[t,...this.annotations];this.element.updateAnnotations(r),this.pinAdapter.updateAnnotations(r),this.updateAnnotationList(r)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,r){let i=this.annotations.find(u=>u.uuid===t);i.comments.push(r);let a=this.annotations.map(u=>u.uuid===t?i:u);this.updateAnnotationList(a),this.element.updateAnnotations(a)}fetchAnnotations(){return Me(this,null,function*(){try{let t=yield vt.fetchAnnotation(Ie.get("apiUrl"),Ie.get("apiKey"),{roomId:Ie.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return Me(this,null,function*(){try{let t=yield vt.fetchWaterMark(Ie.get("apiUrl"),Ie.get("apiKey"));this.element.waterMarkStatus(t)}catch(t){this.logger.log("error when fetching waterMark",t)}})}};U();U();var aa=(t=>(t.ADD="add",t.SHOW="show",t))(aa||{});var vo=class{constructor(e){this.isPinsVisible=!0;this.divWrapperReplacementInterval=null;this.selectedPin=null;this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"))};this.annotationSelected=({detail:e})=>{var a,u;let{uuid:t}=e;if(!t)return;let r=JSON.parse((u=(a=this.selectedPin)==null?void 0:a.getAttribute("annotation"))!=null?u:"{}");if(this.resetPins(),(r==null?void 0:r.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let i=this.pins.get(t);!i||(i.setAttribute("active",""),this.selectedPin=i,this.scrollIntoView(i))};this.onClick=e=>{if(!this.isActive)return;let{x:t,y:r}=e,i=this.divWrapper.getBoundingClientRect(),a=t-i.x,u=r-i.y;this.onPinFixedObserver.publish({x:a,y:u,type:"canvas"}),this.resetSelectedPin(),this.createTemporaryPin({x:a,y:u,type:"canvas"}),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseMove=e=>{let{x:t,y:r}=e;this.mouseElement||(this.mouseElement=this.createMouseElement()),this.mouseElement.setAttribute("position",JSON.stringify({x:t,y:r}))};this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.canvas.style.cursor="default"};this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.pins.forEach(r=>{r.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};if(this.logger=new tt("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvasId=e,this.canvas=document.getElementById(e),this.isActive=!1,this.pins=new Map,!this.canvas){let t=`Canvas with id ${e} not found`;throw this.logger.log(t),new Error(t)}document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.style.position="relative",this.onPinFixedObserver=new Ae({logger:this.logger}),this.divWrapper=this.createDivWrapper(),this.annotations=[]}destroy(){this.removeListeners(),this.mouseElement=null,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}setPinsVisibility(e){if(this.isPinsVisible=e,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(e){if(this.isActive=e,this.canvas.style.cursor=e?"none":"default",this.isActive){this.addListeners();return}this.removeListeners()}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,!(!this.isActive&&!this.isPinsVisible)&&this.renderAnnotationsPins()}removeAnnotationPin(e){let t=this.pins.get(e);!t||(t.remove(),this.pins.delete(e))}createTemporaryPin(e){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttributeNode(document.createAttribute("active"))),t.setAttribute("position",JSON.stringify(e)),this.divWrapper.appendChild(t),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseout",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("select-annotation",this.annotationSelected)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseout",this.onMouseLeave),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("select-annotation",this.annotationSelected)}createMouseElement(){let e=document.createElement("superviz-comments-annotation-pin");return e.setAttribute("type","add"),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(e),this.canvas.style.cursor="none",e}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}createDivWrapper(){let e=this.canvas.getBoundingClientRect(),t=document.createElement("div");return this.canvas.parentElement.style.position="relative",t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let r=this.canvas.getBoundingClientRect();t.style.top=`${r.top}px`,t.style.left=`${r.left}px`,t.style.width=`${r.width}px`,t.style.height=`${r.height}px`},1)),this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){if(!this.annotations||this.canvas.style.display==="none"){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{let t=JSON.parse(e.position);if(e.resolved){this.removeAnnotationPin(e.uuid);return}if(t.type!=="canvas"||this.pins.has(e.uuid))return;let{x:r,y:i}=t,a=document.createElement("superviz-comments-annotation-pin");a.setAttribute("type","show"),a.setAttribute("annotation",JSON.stringify(e)),a.setAttribute("position",JSON.stringify({x:r,y:i})),this.divWrapper.appendChild(a),this.pins.set(e.uuid,a)})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}scrollIntoView(e){if(!e||this.divWrapper.clientWidth<=this.divWrapper.parentElement.clientWidth&&this.divWrapper.clientHeight<=this.divWrapper.parentElement.clientHeight)return;let t,r=this.divWrapper;for(;!t;){let a=r==null?void 0:r.parentElement;if(this.isScrollable(a)){t=a;break}if(r=a,!r)break}let i=JSON.parse(e.getAttribute("position"));!t||t.scrollTo({top:i.y,left:i.x,behavior:"smooth"})}isScrollable(e){if(!e)return!1;let t=e.scrollHeight>e.clientHeight,r=window.getComputedStyle(e).overflowY,i=window.getComputedStyle(e).overflowX,a=r.indexOf("hidden")!==-1,u=i.indexOf("hidden")!==-1;return t&&!a&&!u}};U();var Dl=Un(oa());U();var Sn=Un(Pp()),bo=class{constructor(){this.browser=Sn.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Sn.default.PLATFORMS_MAP.mobile)||this.browser.is(Sn.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Sn.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};U();var ua=class{constructor(){this.updateMeetingConnectionStatus=e=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=e,this.connectionStatusObserver.publish(e),this.logger.log("CONNECTION STATUS CHANGE",e)};this.onUpdateBrowserOnlineStatus=e=>{let{type:t}=e;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new tt("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new Ae({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};U();U();var la=class{build(e,t,r,i={},a={}){let u=document.querySelector(`#${e}`),l=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(i).forEach(([f,m])=>{l.searchParams.set(f,m)}),Object.entries(a).forEach(([f,m])=>{this.element.setAttribute(f,m)}),this.element.src=l.toString(),this.element.id=r,u.appendChild(this.element),this.wrapperId=e}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let e=document.querySelector(`#${this.wrapperId}`);!!e&&!!e.querySelector(`#${this.element.id}`)&&e.removeChild(this.element),this.wrapperId=null,this.element=null}};U();var ca=class{constructor(e){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(e,t={})=>{this.logger.log("MessageBridge","Posting message to frame",e,t),this.contentWindow.postMessage({type:e,data:t},this.allowedOrigins)};this.listen=(e,t)=>{this.observers[e]||(this.observers[e]=new Ae({logger:this.logger})),this.observers[e].subscribe(t)};this.onReceiveMessage=e=>{let{type:t,data:r,source:i}=e.data;if(this.sourceBlockList.includes(i)||this.originBlockList.includes(e.origin))return;let a=!!t,u=!this.domains.length||this.domains.includes(e.origin),l=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${e.type}
        ORIGIN: ${e.origin}
        DATA: ${JSON.stringify(e.data)} `),!a||!u||!l){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(r)};let{contentWindow:t,domains:r=[],allowedOrigins:i="*",sourceBlockList:a=[],logger:u}=e;if(this.logger=u,this.domains=r,this.allowedOrigins=i,this.sourceBlockList.push(...a),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([e,t])=>{t.reset(),delete this.observers[e]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};U();var fa=(r=>(r.RIGHT="right",r.CENTER="center",r.LEFT="left",r))(fa||{}),da=(t=>(t.GRID="grid",t.LIST="list",t))(da||{}),ha=(i=>(i.RIGHT="right",i.LEFT="left",i.TOP="top",i.BOTTOM="bottom",i))(ha||{});var Lp="sv-video-frame",Eo=class{constructor(e){this.logger=new tt("@superviz/sdk/video-conference-manager");this.frameStateObserver=new Ae({logger:this.logger});this.frameSizeObserver=new Ae({logger:this.logger});this.waitingForHostObserver=new Ae({logger:this.logger});this.realtimeEventsObserver=new Ae({logger:this.logger});this.sameAccountErrorObserver=new Ae({logger:this.logger});this.devicesObserver=new Ae({logger:this.logger});this.meetingStateObserver=new Ae({logger:this.logger});this.meetingConnectionObserver=new Ae({logger:this.logger});this.participantJoinedObserver=new Ae({logger:this.logger});this.participantLeftObserver=new Ae({logger:this.logger});this.participantListObserver=new Ae({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(e,t)=>{let r=e,i=t,a=["left","right","bottom","top"].includes(i),u=["left","right","center"].includes(r);return a||(i="right"),u||(r="right"),this.browserService.isMobileDevice?(i="bottom",{layoutPosition:r,camerasPosition:i}):(r==="left"&&i==="right"&&(r="right"),r==="right"&&i==="left"&&(r="left"),{layoutPosition:r,camerasPosition:i})};this.onFrameLoad=()=>{this.messageBridge=new ca({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=e=>{let t=e!=null?e:{};["top","bottom","left","right"].forEach(r=>{Object.keys(t).includes(r)||(t[r]=0)}),this.frameOffset=t};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=e=>{let t=document.createElement("style"),{bottom:r,left:i,right:a,top:u}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${u}px;
        --superviz-offset-right: ${a}px;
        --superviz-offset-left: ${i}px;
        --superviz-offset-bottom: ${r}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${e}`)};this.onFrameDimensionsUpdate=({width:e,height:t})=>{let r=document.getElementById(Lp),{bottom:i,right:a,left:u,top:l}=this.frameOffset,f=this.isWaterMarkEnabled?40:0,m=`${e}px`,b=`${t+f}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${a}px - ${u}px)`),t>=window.innerHeight&&(b=`calc(100% - ${l}px - ${i}px)`),r.style.width=m,r.style.height=b,this.frameSizeObserver.publish({width:r.offsetWidth,height:r.offsetHeight})};this.onWindowResize=()=>{let{top:e,bottom:t,right:r,left:i}=this.frameOffset,{innerHeight:a,innerWidth:u}=window,l=a-e-t,f=u-r-i;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:l,width:f})};this.updateFrameLocale=()=>{var a,u;if(!this.frameLocale||!((a=this.frameLocale)!=null&&a.language)&&((u=this.frameLocale)==null?void 0:u.locales))return;let{language:e,locales:t}=this.frameLocale,r=t.map(l=>l==null?void 0:l.language),i=["en",...r];if(e&&!i.includes(e))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=e=>{this.participantJoinedObserver.publish(e)};this.onParticipantLeft=e=>{this.participantLeftObserver.publish(e)};this.onMeetingHostChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:e})};this.onMeetingKickParticipant=e=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:e})};this.onFollowParticipantDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:e})};this.onGoToDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:e})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:e})};this.onDrawingChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:e})};this.onTranscriptChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:e})};this.onSameAccountError=e=>{this.sameAccountErrorObserver.publish(e)};this.onDevicesChange=e=>{this.devicesObserver.publish(e)};this.meetingStateUpdate=e=>{this.meetingStateObserver.publish(e)};this.onConnectionStatusChange=e=>{this.meetingConnectionObserver.publish(e)};this.onWaitingForHostDidChange=e=>{this.waitingForHostObserver.publish(e)};this.onParticipantListUpdate=e=>{this.participantListObserver.publish(e)};var v,R,N,z;let{language:t,canUseCams:r,canUseChat:i,canUseScreenshare:a,canUseDefaultAvatars:u,canUseFollow:l,canUseGoTo:f,canUseGather:m,browserService:b,offset:C,canUseDefaultToolbar:h,locales:E,avatars:w,customColors:I,waterMark:S,layoutPosition:T,camerasPosition:x,skipMeetingSettings:g,devices:y,layoutMode:d}=e;this.browserService=b;let p=this.layoutModalsAndCamerasConfig(T,x),O=document.createElement("div");this.frameConfig={apiKey:Ie.get("apiKey"),apiUrl:Ie.get("apiUrl"),ablyKey:Ie.get("ablyKey"),debug:Ie.get("debug"),roomId:Ie.get("roomId"),limits:Ie.get("limits"),canUseFollow:l,canUseGoTo:f,canUseCams:r,canUseChat:i,canUseGather:m,canUseScreenshare:a,canUseDefaultAvatars:u,camerasPosition:(v=p.camerasPosition)!=null?v:"right",canUseDefaultToolbar:h,devices:{audioInput:(R=y==null?void 0:y.audioInput)!=null?R:!0,audioOutput:(N=y==null?void 0:y.audioOutput)!=null?N:!0,videoInput:(z=y==null?void 0:y.videoInput)!=null?z:!0},waterMark:S,layoutMode:d,skipMeetingSettings:g,layoutPosition:p.layoutPosition},this.customColors=I,O.classList.add("sv_video_wrapper"),O.id="sv-video-wrapper",document.body.appendChild(O),this.updateFrameState(1),this.bricklayer=new la,this.bricklayer.build(O.id,Ie.get("conferenceLayerUrl"),Lp,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(C),this.setFrameStyle(p.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:E},this.meetingAvatars=w,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(e){e!==this.frameState&&(this.frameState=e,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[e])}start(e){this.messageBridge.publish("meeting.start",Ve(fe({},e),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var e,t;(e=this.messageBridge)==null||e.destroy(),(t=this.bricklayer)==null||t.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(e,t){this.messageBridge.publish(e,t)}};var Ao=class extends Cn{constructor(t){var r;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var t,r,i,a,u,l,f,m,b,C,h,E,w,I,S,T,x,g,y,d,p,O,v,R,N,z,W;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseChat:!((r=this.params)!=null&&r.chatOff),canUseCams:!((i=this.params)!=null&&i.camsOff),canUseScreenshare:!((a=this.params)!=null&&a.screenshareOff),canUseDefaultAvatars:!!((u=this.params)!=null&&u.defaultAvatars)&&!((f=(l=this.localParticipant)==null?void 0:l.avatar)!=null&&f.model3DUrl),canUseGather:!!((m=this.params)!=null&&m.enableGather),canUseFollow:!!((b=this.params)!=null&&b.enableFollow),canUseGoTo:!!((C=this.params)!=null&&C.enableGoTo),canUseDefaultToolbar:(E=(h=this.params)==null?void 0:h.defaultToolbar)!=null?E:!0,camerasPosition:(I=(w=this.params)==null?void 0:w.collaborationMode)==null?void 0:I.position,devices:(S=this.params)==null?void 0:S.devices,skipMeetingSettings:(T=this.params)==null?void 0:T.skipMeetingSettings,browserService:this.browserService,offset:(x=this.params)==null?void 0:x.offset,locales:(y=(g=this.params)==null?void 0:g.locales)!=null?y:[],avatars:(p=(d=this.params)==null?void 0:d.avatars)!=null?p:[],customColors:(O=this.params)==null?void 0:O.customColors,layoutPosition:(R=(v=this.params)==null?void 0:v.collaborationMode)==null?void 0:R.modalPosition,layoutMode:(W=(z=(N=this.params)==null?void 0:N.collaborationMode)==null?void 0:z.initialView)!=null?W:"list",waterMark:this.showWaterMarkType},this.logger.log("video component @ start video",this.videoConfig),this.videoManager=new Eo(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video component @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video component @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video component @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video component @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=t=>{var r;return{id:t.clientId,color:this.realtime.getSlotColor((r=t.data)==null?void 0:r.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video component @ on connection status change",t);let r=[2,4,3,6];r.includes(t)&&this.realtime.freezeSync(!0),r.includes(this.connectionService.oldConnectionStatus)&&!r.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video component @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.internalRemoveComponent()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video component @ on frame state change",t),t===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:Ie.get("roomId")})};this.onRealtimeEventFromFrame=({event:t,data:r})=>{this.logger.log("video component @ on realtime event from frame",t,r);let i={["realtime.host-change"]:a=>this.realtime.setHost(a),["realtime.gather"]:a=>this.realtime.setGather(a),["realtime.grid-mode-change"]:a=>this.realtime.setGridMode(a),["realtime.drawing-change"]:a=>{this.realtime.setDrawing(a)},["realtime.follow-participant"]:a=>{this.realtime.setFollowParticipant(a)},["meeting.kick-participant"]:a=>{this.realtime.setKickParticipant(a)},["realtime.transcript-change"]:a=>{this.realtime.setTranscript(a)},["realtime.go-to-participant"]:a=>{this.eventBus.publish("realtime.go-to-participant",a)}}[t](r);this.publish(t,r)};this.onParticipantJoined=t=>{if(this.logger.log("video component @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type});return}this.realtime.updateMyProperties({name:t.name,type:t.type})};this.onParticipantLeft=t=>{this.logger.log("video component @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.internalRemoveComponent()};this.onParticipantListUpdate=t=>{this.logger.log("video component @ on participant list update",t),!(0,Dl.isEqual)(this.participantsOnMeeting,t)&&(this.publish("meeting.participant-list-update",t),this.participantsOnMeeting.length!==t.length&&this.publish("meeting.amount-of-participants-update",t.length),this.participantsOnMeeting=t)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video component @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.internalRemoveComponent()};this.onKickLocalParticipant=()=>{this.logger.log("video component @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.internalRemoveComponent()};this.onRoomInfoUpdated=t=>{this.logger.log("video component @ on room info updated",t);let{isGridModeEnable:r,followParticipantId:i,gather:a,drawing:u,transcript:l}=t;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",r),this.videoManager.publishMessageToFrame("realtime.drawing-change",u),this.videoManager.publishMessageToFrame("realtime.follow-participant",i),this.videoManager.publishMessageToFrame("realtime.transcript-change",l),this.realtime.hostClientId===this.localParticipant.id&&a&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video component @ on participants did change",t);let r=Object.values(t).map(i=>({timestamp:i.timestamp,connectionId:i.connectionId,participantId:i.clientId,color:this.realtime.getSlotColor(i.data.slotIndex).name,name:i.data.name,isHost:this.realtime.hostClientId===i.clientId,avatar:i.data.avatar,type:i.data.type}));(0,Dl.isEqual)(this.participantToFrameList,r)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",r),this.participantToFrameList=r};this.onHostParticipantDidChange=t=>{this.logger.log("video component @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t==null?void 0:t.newHostParticipantId)};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video component @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video component @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.params=Ve(fe({},t),{userType:(r=t==null?void 0:t.userType)!=null?r:"guest"}),this.name="videoConference",this.logger=new tt(`@superviz/sdk/${"videoConference"}`),this.browserService=new bo,this.connectionService=new ua,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){var t;this.logger.log("video component @ start"),this.publish("meeting.start"),this.params.userType!=="guest"&&(this.localParticipant.type=this.params.userType),this.realtime.setKickParticipantsOnHostLeave(!((t=this.params)!=null&&t.allowGuests)),this.suscribeToRealtimeEvents(),this.showWaterMarkType=Ie.get("waterMark"),this.startVideo()}destroy(){this.logger.log("video component @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}internalRemoveComponent(){this.logger.log("video component @ internal remove component");let{data:t}=this.realtime.participant,r=t.activeComponents.filter(i=>i!=="videoConference");this.realtime.updateMyProperties({activeComponents:r,type:"guest"}),this.realtime.setKickParticipantsOnHostLeave(!1),this.detach()}};U();var Co=class extends Cn{constructor(t){super();this.divWrapperReplacementInterval=null;this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.onMyParticipantMouseMove=t=>{let r=this.divWrapper.getBoundingClientRect();this.realtime.updatePresenceMouse(Ve(fe({},this.localParticipant),{mousePositionX:t.x-r.x,mousePositionY:t.y-r.y,originalWidth:r.width,originalHeight:r.height,containerId:this.containerId,visible:!0}))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.values(t).forEach(r=>{var u;let i=(r==null?void 0:r.mousePositionX)&&this.presenceMouseElement,a=(r==null?void 0:r.id)===((u=this.localParticipant)==null?void 0:u.id);if(!(r!=null&&r.visible)){this.presenceMouseElement.removePresenceMouseParticipant(r.id);return}!a&&i&&this.presenceMouseElement.updatePresenceMouseParticipant(r)})};this.onMyParticipantMouseOut=()=>{this.realtime.updatePresenceMouse(fe({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=t=>{this.presenceMouseElement.removePresenceMouseParticipant(t.id)};if(this.name="presence",this.logger=new tt(`@superviz/sdk/${"presence"}`),this.containerId=t,this.container=document.getElementById(t),!this.container){let r=`Container with id ${t} not found`;throw this.logger.log(r),new Error(r)}this.divWrapper=this.createDivWrapper()}start(){this.logger.log("presence-mouse component @ start"),this.presenceMouseElement=document.createElement("superviz-presence-mouse"),this.divWrapper.appendChild(this.presenceMouseElement),this.container.addEventListener("mousemove",this.onMyParticipantMouseMove),this.container.addEventListener("mouseout",this.onMyParticipantMouseOut),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),this.container.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.container.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.removeChild(this.presenceMouseElement),this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}createDivWrapper(){let t=this.container.getBoundingClientRect(),r=document.createElement("div");return this.container.parentElement.style.position="relative",r.style.position="fixed",r.style.top=`${t.top}px`,r.style.left=`${t.left}px`,r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,r.style.pointerEvents="none",this.container.parentElement.appendChild(r),this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let i=this.container.getBoundingClientRect();r.style.top=`${i.top}px`,r.style.left=`${i.left}px`,r.style.width=`${i.width}px`,r.style.height=`${i.height}px`},1)),r}};U();U();var pa=class{constructor(e){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("pubsub service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Ae),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("pubsub service @ publish",{event:e,data:t}),this.realtime.setSyncProperty(e,t)};this.publishEventToClient=(e,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(e=>e.destroy()),this.observers.clear()};this.onSyncPropertiesChange=e=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:e}),Object.entries(e).forEach(([t,r])=>{this.publishEventToClient(t,r)})};this.logger=new tt("@superviz/sdk/pubsub"),this.realtime=e,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(e){return this.realtime.fetchSyncClientProperty(e)}};U();var ma=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(ma||{}),ga=(e=>(e.REALTIME_STATE_CHANGED="realtime-component.state-changed",e))(ga||{});var So=class extends Cn{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=(t,r)=>{if(!this.pubsub){let i=`Realtime component is not started yet. You can't publish event ${t} before start`;this.logger.log(i);return}this.pubsub.publish(t,r)};this.subscribe=(t,r)=>{if(!this.pubsub){this.callbacksToSubscribeWhenJoined.push({event:t,callback:r});return}this.pubsub.subscribe(t,r)};this.unsubscribe=(t,r)=>{this.pubsub.unsubscribe(t,r)};this.name="realtime",this.logger=new tt("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new pa(this.realtime),this.callbacksToSubscribeWhenJoined.forEach(({event:t,callback:r})=>{this.pubsub.subscribe(t,r)}),this.changeState("STARTED")}fetchHistory(t){return this.pubsub.fetchHistory(t)}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.pubsub.publishEventToClient("realtime-component.state-changed",this.state)}};U();var zl=Un(Tl());U();function nO(s,e){return Me(this,null,function*(){try{return(yield vt.validateApiKey(s,e))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var Dp=nO;U();U();var Si=class{static getRemoteConfig(){return Me(this,arguments,function*(e="prod"){let{version:t}=yield Promise.resolve().then(()=>(Fp(),Np));if(e==="local"){let{remoteConfig:a}=yield Promise.resolve().then(()=>(Bp(),Up));return a}let r={version:t,environment:e},i=this.createUrl(r);return _t(i,"GET",null)})}static createUrl({version:e,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${e}?env=${t}`}};Si.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";U();var Gl=Un(oa());U();var To=class{constructor(){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("event bus service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Ae),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("event bus service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("event bus service @ publish",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.logger=new tt("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};U();var Oo=class{static checkComponentLimit(e){var i,a;let t=(i=Ml[e])!=null?i:e,r=Ie.get("limits");return(a=r==null?void 0:r[t])!=null?a:!1}};U();U();var Hl=Un(kp()),Tr=Un(Rl());U();var Fl=(f=>(f[f.DISCONNECTED=0]="DISCONNECTED",f[f.INITIALIZING=1]="INITIALIZING",f[f.READY_TO_JOIN=2]="READY_TO_JOIN",f[f.CONNECTING=3]="CONNECTING",f[f.CONNECTED=4]="CONNECTED",f[f.JOINED=5]="JOINED",f[f.FAILED=-1]="FAILED",f[f.RETRYING=-2]="RETRYING",f))(Fl||{});U();U();var Ul=(T=>(T[T.yellow=0]="yellow",T[T.turquoise=1]="turquoise",T[T.orange=2]="orange",T[T.blue=3]="blue",T[T.pink=4]="pink",T[T.purple=5]="purple",T[T.green=6]="green",T[T.red=7]="red",T[T.bluedark=8]="bluedark",T[T.pinklight=9]="pinklight",T[T.purplelight=10]="purplelight",T[T.greenlight=11]="greenlight",T[T.orangelight=12]="orangelight",T[T.bluelight=13]="bluelight",T[T.redlight=14]="redlight",T[T.brown=15]="brown",T[T.gray=16]="gray",T))(Ul||{}),Bl=(s=>(s[s["#FFEF33"]=0]="#FFEF33",s[s["#31E0B0"]=1]="#31E0B0",s[s["#FF5E10"]=2]="#FF5E10",s[s["#00ABF7"]=3]="#00ABF7",s[s["#FF00BB"]=4]="#FF00BB",s[s["#9C29FF"]=5]="#9C29FF",s[s["#6FDD00"]=6]="#6FDD00",s[s["#E30000"]=7]="#E30000",s[s["#304AFF"]=8]="#304AFF",s[s["#FF89C4"]=9]="#FF89C4",s[s["#D597FF"]=10]="#D597FF",s[s["#C6EC5C"]=11]="#C6EC5C",s[s["#FFA115"]=12]="#FFA115",s[s["#75DEFE"]=13]="#75DEFE",s[s["#FAA291"]=14]="#FAA291",s[s["#BB813F"]=15]="#BB813F",s[s["#878291"]=16]="#878291",s))(Bl||{});var ya=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new tt("@superviz/sdk/realtime-service"),this.participantsObserver=new Ae({logger:this.logger}),this.participantJoinedObserver=new Ae({logger:this.logger}),this.participantLeaveObserver=new Ae({logger:this.logger}),this.syncPropertiesObserver=new Ae({logger:this.logger}),this.reconnectObserver=new Ae({logger:this.logger}),this.roomInfoUpdatedObserver=new Ae({logger:this.logger}),this.roomListUpdatedObserver=new Ae({logger:this.logger}),this.hostObserver=new Ae({logger:this.logger}),this.hostAvailabilityObserver=new Ae({logger:this.logger}),this.realtimeStateObserver=new Ae({logger:this.logger}),this.kickAllParticipantsObserver=new Ae({logger:this.logger}),this.kickParticipantObserver=new Ae({logger:this.logger}),this.authenticationObserver=new Ae({logger:this.logger}),this.domainRefusedObserver=new Ae({logger:this.logger}),this.commentsObserver=new Ae({logger:this.logger}),this.presenceMouseObserver=new Ae({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Ae({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Ae({logger:this.logger}),this.presence3dObserver=new Ae({logger:this.logger}),this.presence3dLeaveObserver=new Ae({logger:this.logger}),this.presence3dJoinedObserver=new Ae({logger:this.logger})}subscribeToParticipantUpdate(e,t){this.participantObservers[e]||(this.participantObservers[e]=new Ae({logger:this.logger})),this.participantObservers[e].subscribe(t)}unsubscribeFromParticipantUpdate(e,t){this.participantObservers[e]&&this.participantObservers[e].unsubscribe(t)}subscribeToParticipant3DUpdate(e,t){this.participants3DObservers[e]||(this.participants3DObservers[e]=new Ae({logger:this.logger})),this.participants3DObservers[e].subscribe(t)}unsubscribeFromParticipant3DUpdate(e,t){this.participants3DObservers[e]&&this.participants3DObservers[e].unsubscribe(t)}getSlotColor(e){let t=e!=null?e:16;return{color:Bl[t],name:Ul[t]}}};var oO=1e3*60,$p=6e4,sO=1e4,kl=1e3,$l=null,Ti=class extends ya{constructor(t,r){super();this.participants={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=t=>{if(!t){this.updateRoomProperties({hostClientId:null});return}let r=this.participants[t];this.updateRoomProperties({hostClientId:r.clientId})};this.setKickParticipant=t=>{if(!t)return;let r=this.participants[t];this.updateRoomProperties({kickParticipant:r})};this.freezeSync=t=>{var r,i;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(r=this.broadcastChannel)==null||r.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t),this.updatePresence3D(this.myParticipant.data)};this.setKickParticipantsOnHostLeave=t=>{this.shouldKickParticipantsOnHostLeave=t};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{if(this.clientSyncPropertiesQueue[t]=this.clientSyncPropertiesQueue[t].sort((u,l)=>u.timestamp-l.timestamp),!this.clientSyncPropertiesQueue[t].length)return;let{data:r,lengthToBeSplitted:i}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[t]),a=r;this.clientSyncPropertiesQueue[t].splice(0,i),this.clientSyncChannel.publish(t,a,u=>{!u||this.logger.log("REALTIME","Error in publish client sync properties",u.message)})})};this.saveClientRoomState=(t,r)=>Me(this,null,function*(){let i=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},i,{[t]:r[r.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=t=>Me(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties);let r=Object.values(this.participants).some(i=>{var a,u;return((u=(a=i.data)==null?void 0:a.activeComponents)==null?void 0:u.includes("videoConference"))&&i.data.type==="host"});!t.hostClientId&&r?(this.hostParticipantId=null,this.hostPassingHandle()):!!(t!=null&&t.hostClientId)&&(t==null?void 0:t.hostClientId)!==this.hostParticipantId?this.updateHostInfo(t.hostClientId):!r&&!!(t!=null&&t.hostClientId)&&this.updateHostInfo(null),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Tr.default)((t={})=>{let r=t;this.isMessageTooBig(r)||this.left||!this.enableSync||this.isSyncFrozen||(r.avatar===void 0&&delete r.avatar,this.myParticipant.data=fe(fe({},this.myParticipant.data),r),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},kl);this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let r=fe(fe({},this.localRoomProperties),t);this.supervizChannel.publish("update",r)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((r,i)=>{i.forEach(a=>{t[a.clientId]=fe({},a)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=t=>{let r=[];if(this.supervizChannel.presence.get((a,u)=>{u.forEach(l=>{a||r.push({clientId:l.clientId,type:l.data.type})})}),!t||!r.some(a=>a.clientId===t&&a.type==="host")){this.hostPassingHandle();return}$l&&(clearTimeout($l),this.hostAvailabilityObserver.publish(!0));let i=this.hostParticipantId;this.hostParticipantId=t,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var r;let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((r=this.myParticipant)==null?void 0:r.data.type)==="host"&&(t.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(t)};this.hostPassingHandle=(0,Tr.default)(()=>Me(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((t,r)=>{let i=r.filter(u=>u.data.type==="host").map(u=>u.clientId);if(this.shouldKickParticipantsOnHostLeave&&!i.length){this.hostAvailabilityObserver.publish(!1),$l=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},oO),this.setHost(null);return}let a=i[0];(a===this.localParticipantId||!i.length)&&this.setHost(a)})}),1e3);this.findSlotIndex=t=>{let r=t,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((l,f)=>{if(l){i=[];return}f.forEach(m=>{m.connectionId===r.connectionId&&(r=m),m.connectionId!==r.connectionId&&m.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(m.data.slotIndex),1)})}),i.length===0)return;let a=i[0];this.myParticipant.data.slotIndex=a,this.updateMyProperties({slotIndex:a});let u=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(r)},u)};this.confirmSlot=(0,Tr.default)(t=>Me(this,null,function*(){let r=[],i=t;if(this.supervizChannel.presence.get((a,u)=>{u.forEach(l=>{l.connectionId===i.connectionId&&(i=l),l.connectionId!==i.connectionId&&l.data.slotIndex!==void 0&&r.push(l.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||r.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let a=yield this.fetchRoomProperties();this.updateRoomProperties(a)}}),1e3);this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties()};this.syncBroadcast=(0,Tr.default)(()=>{let t=btoa(this.ablyKey),r=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(r,{headers:{Authorization:`Basic ${t}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(t,r=$p)=>{let i=JSON.stringify(t);return new TextEncoder().encode(i).length>r?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterPresenceMouseChannel=t=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(t)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel=null,this.presenceMouseChannel.presence.leave())};this.updatePresenceMouse=(0,Tr.default)(t=>{let r=Object.assign({},this.participantsMouse[t.id]||{},t);this.presenceMouseChannel.presence.update(r)},kl);this.onPresenceMouseChannelEnter=t=>{this.presenceMouseParticipantJoinedObserver.publish(t.data)};this.onPresenceMouseChannelLeave=t=>{this.presenceMouseParticipantLeaveObserver.publish(t.data)};this.publishPresenceMouseUpdate=t=>{let r=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=Ve(fe({},t.data),{slotIndex:r,color:this.getSlotColor(r).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel=null,this.presence3DChannel.presence.leave())};this.updatePresence3D=(0,Tr.default)(t=>{var i,a,u;let r=Object.assign({},(a=(i=this.participantsOn3d[t.id])==null?void 0:i.data)!=null?a:{},t);this.participantsOn3d[t.id]=Ve(fe({},this.participants[r.id]),{data:fe(fe({},r),(u=this.participants[r.id])==null?void 0:u.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(r)},kl);this.onPresence3DChannelEnter=t=>{var i;t.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let r=this.getParticipantSlot(t.clientId);this.presence3dJoinedObserver.publish(Ve(fe({},t),{data:Ve(fe(fe({},t.data),(i=this.participants[t.clientId])==null?void 0:i.data),{slotIndex:r,color:this.getSlotColor(r).color})}))};this.onPresence3DChannelLeave=t=>{delete this.participantsOn3d[t.clientId],this.presence3dLeaveObserver.publish(t)};this.publish3DUpdate=t=>{var a;let r=this.getParticipantSlot(t.clientId),i=Ve(fe({},t),{data:Ve(fe(fe({},t.data),(a=this.participants[t.clientId])==null?void 0:a.data),{slotIndex:r,color:this.getSlotColor(r).color})});this.participantsOn3d[t.clientId]=i,this.participants3DObservers[t.clientId]&&this.participants3DObservers[t.clientId].publish(i),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=r,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,r;return(r=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?r:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:r,apiKey:i}){this.myParticipant={data:Ve(fe({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${r.toLowerCase()}-${i}`,this.apiKey=i,this.client||this.buildClient()}auth(t,r){if(!this.domainWhitelisted)return;let i=new Hl.default.Rest({key:this.ablyKey}),{origin:a}=window.location;i.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:a,apiKey:this.apiKey}},(u,l)=>{var f;u&&this.authenticationObserver.publish("realtime.authentication-failed"),(f=u==null?void 0:u.message)!=null&&f.includes("this domain don't have permission")&&(this.domainWhitelisted=!1,this.domainRefusedObserver.publish(this.domainWhitelisted)),r(u,l)})}join(t){let r=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(r),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{isGridModeEnable:t}))}setDrawing(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{drawing:t}))}setTranscript(t){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{transcript:t}))}setSyncProperty(t,r){let i=(a,u)=>({name:a,data:u,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(i(t,r),sO)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",t,r),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(i(t,r))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var r,i;if(t){let a=t.toString();if(this.participants&&this.participants[a])return(i=(r=this.participants[t])==null?void 0:r.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){var f,m,b,C,h;if(!this.isJoinedRoom)return;let{clientId:r}=t,i=Object.assign({},t,{participantId:t.clientId}),a=(b=(m=(f=this.participants[i.clientId])==null?void 0:f.data)==null?void 0:m.activeComponents)==null?void 0:b.includes("videoConference"),u=(h=(C=i.data)==null?void 0:C.activeComponents)==null?void 0:h.includes("videoConference"),l=a&&!u;this.publishParticipantUpdate(i),this.participants&&this.participants[r]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast(),l&&this.hostPassingHandle()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:r,data:i}=t,a={};a[r]=i,this.syncPropertiesObserver.publish(a),t.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(r,i)}onReceiveBroadcastSync(t){t.data.forEach(i=>{var u;let a=i.clientId;this.participants[a]=i,(u=i.data)!=null&&u.isAudience||(this.participants[a].data=JSON.parse(this.participants[a].data),this.publishParticipantUpdate(this.participants[a]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Hl.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${Fl[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,r)=>{this.supervizChannel.history((i,a)=>{var l;i&&r(i);let u=(l=a.items[0])==null?void 0:l.data;t(u||null)})})}fetchSyncClientProperty(t){return Me(this,null,function*(){try{let r=yield new Promise((i,a)=>{this.clientRoomStateChannel.history((u,l)=>{var m;u&&a(u);let f=(m=l==null?void 0:l.items[0])==null?void 0:m.data;i(f||null)})});if(t&&!r[t])throw new Error(`Event ${t} not found in the history`);return t?r[t]:r}catch(r){this.logger.log("REALTIME","Error in fetch client realtime data",r.message),this.throw(r.message)}})}onStateChange(){var b,C,h;let t=(b=this.supervizChannelState)==null?void 0:b.current,r=(C=this.connectionState)==null?void 0:C.current,i=r==="connected",a=["initialized","connecting"].includes(r),u=["closed","closing"].includes(r)||["detaching","detached"].includes(t),l={[0]:u,[1]:a,[2]:!t&&i,[3]:t==="attaching",[4]:t==="attached"&&i,[-1]:t==="failed"||r==="failed",[-2]:r==="suspended"||t==="suspended"},f=Object.entries(l).find(([E,w])=>w&&E)[0],m=Number(f);if(!!this.domainWhitelisted){if(m===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(h=this.connectionState)!=null&&h.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return Me(this,null,function*(){var r;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(t),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let i=this.myParticipant.data.type==="host";(r=this.localRoomProperties)!=null&&r.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):i&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;let r=t.data.participantId===this.hostParticipantId;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),r&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}spliceArrayBySize(t,r=$p){let i=f=>{let m=JSON.stringify(f);return new TextEncoder().encode(m).length},a=0,u=[],l=[];for(let f=0;f<t.length;f++){let m=i(t[f]);a+m<=r?(l.push(t[f]),a+=m):(u.push(l),l=[t[f]],a=m)}return l.length>0&&u.push(l),{data:u[0],lengthToBeSplitted:u[0].length}}enterPresence3DChannel(t){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(t)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(t)}};U();var Wl=class extends Sr{constructor({participant:t,group:r}){super();this.activeComponents=[];this.eventBus=new To;this.participants=[];this.addComponent=t=>{var r,i;!this.canAddComponent(t)||(t.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:Ie.configuration,eventBus:this.eventBus}),this.activeComponents.push(t.name),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),vt.sendActivity(this.participant.id,this.group.id,this.group.name,t.name),vt.createOrUpdateParticipant(Ie.get("apiKey"),{name:(r=this.participant)==null?void 0:r.name,participantId:(i=this.participant)==null?void 0:i.id}))};this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let r=`Component ${t.name} is not initialized yet.`;this.logger.log(r);return}t.detach(),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.canAddComponent=t=>{let r=this.realtime.isDomainWhitelisted,i=Oo.checkComponentLimit(t.name),a=this.activeComponents.includes(t.name),u=[{isValid:r,message:`Component ${t.name} can't be used because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dev-dashboard.superviz.com/developer`},{isValid:!a,message:`Component ${t.name} is already active. Please remove it first`},{isValid:i,message:`You reached the limit usage of ${t.name}`}];for(let l=0;l<u.length;l++){let{isValid:f,message:m}=u[l];if(!f)return this.logger.log(m),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:Ie.get("apiKey"),roomId:Ie.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=t=>{var a;this.logger.log("launcher service @ onParticipantListUpdate",t);let r=Object.values(t).map(u=>{var l,f,m,b,C,h;return{id:u.data.id,name:(l=u.data)==null?void 0:l.name,type:(f=u.data)==null?void 0:f.type,avatar:(m=u.data)==null?void 0:m.avatar,avatarConfig:(b=u.data)==null?void 0:b.avatarConfig,isHost:this.realtime.hostClientId===u.clientId,color:this.realtime.getSlotColor((C=u.data)==null?void 0:C.slotIndex).color,activeComponents:(h=u.data)==null?void 0:h.activeComponents}}),i=r.find(u=>{var l;return(u==null?void 0:u.id)===((l=this.participant)==null?void 0:l.id)});(0,Gl.isEqual)(this.participants,r)||(this.participants=r,this.publish("participant.list-updated",r),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",r)),i&&!(0,Gl.isEqual)(this.participant,i)&&(this.activeComponents=(a=i.activeComponents)!=null?a:[],this.participant=i,this.publish("participant.updated",i),this.logger.log("Publishing ParticipantEvent.UPDATED",i)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",r)};this.onParticipantJoined=t=>{this.logger.log("launcher service @ onParticipantJoined");let r=this.participants.find(i=>i.id===t.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",r)),this.logger.log("launcher service @ onParticipantJoined - participant joined",r),this.publish("participant.joined",r))};this.onParticipantLeave=t=>{this.logger.log("launcher service @ onParticipantLeave");let r=this.participants.find(i=>i.id===t.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",r)),this.logger.log("launcher service @ onParticipantLeave - participant left",r),this.publish("participant.left",r))};this.onHostParticipantDidChange=t=>{let r=this.participants.find(i=>i.id===(t==null?void 0:t.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",r),this.publish("realtime.host-change",r))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=Ve(fe({},t),{type:"guest"}),this.group=r,this.logger=new tt("@superviz/sdk/launcher"),this.realtime=new Ti(Ie.get("apiUrl"),Ie.get("ablyKey")),this.eventBus=new To,this.logger.log("launcher created"),this.startRealtime()}},Hp=s=>{let e=new Wl(s);return{subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}};var aO=({group:s,participant:e,roomId:t})=>{if(!s||!s.name||!s.id)throw new Error("Group fields is required");if(!e||!e.id||!e.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},uO=(s,e)=>Me(void 0,null,function*(){if(!(s&&s.trim()))throw new Error("API key is required");if(!e)throw new Error("Options is required");aO(e),e.debug?zl.debug.enable("*"):zl.debug.disable();let{apiUrl:r,conferenceLayerUrl:i}=yield Si.getRemoteConfig(e.environment);if(!(yield Dp(r,s)))throw new Error("Failed to validate API key");let u=yield vt.fetchConfig(r,s),l=yield vt.fetchLimits(r,s),f=yield vt.fetchWaterMark(r,s);if(!u||!u.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:m}=u;return Ie.setConfig({apiUrl:r,ablyKey:m,apiKey:s,conferenceLayerUrl:i,environment:u,roomId:e.roomId,debug:e.debug,limits:l,waterMark:f}),Hp(e)}),Vl=uO;U();U();U();U();U();var ba=globalThis,Aa=ba.ShadowRoot&&(ba.ShadyCSS===void 0||ba.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Wp=Symbol(),Gp=new WeakMap,Ea=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==Wp)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Aa&&e===void 0){let r=t!==void 0&&t.length===1;r&&(e=Gp.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&Gp.set(t,e))}return e}toString(){return this.cssText}},zp=s=>new Ea(typeof s=="string"?s:s+"",void 0,Wp);var jl=(s,e)=>{if(Aa)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let r=document.createElement("style"),i=ba.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,s.appendChild(r)}},Ca=Aa?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return zp(t)})(s):s;var{is:lO,defineProperty:cO,getOwnPropertyDescriptor:fO,getOwnPropertyNames:dO,getOwnPropertySymbols:hO,getPrototypeOf:pO}=Object,nr=globalThis,Vp=nr.trustedTypes,mO=Vp?Vp.emptyScript:"",Kl=nr.reactiveElementPolyfillSupport,wo=(s,e)=>s,Sa={toAttribute(s,e){switch(e){case Boolean:s=s?mO:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(r){t=null}}return t}},Jl=(s,e)=>!lO(s,e),jp={attribute:!0,type:String,converter:Sa,reflect:!1,hasChanged:Jl},Kp,Jp;(Kp=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Jp=nr.litPropertyMetadata)!=null||(nr.litPropertyMetadata=new WeakMap);var Or=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=jp){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&cO(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){var u;let{get:i,set:a}=(u=fO(this.prototype,e))!=null?u:{get(){return this[t]},set(l){this[t]=l}};return{get(){return i==null?void 0:i.call(this)},set(l){let f=i==null?void 0:i.call(this);a.call(this,l),this.requestUpdate(e,f,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:jp}static _$Ei(){if(this.hasOwnProperty(wo("elementProperties")))return;let e=pO(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(wo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(wo("properties"))){let t=this.properties,r=[...dO(t),...hO(t)];for(let i of r)this.createProperty(i,t[i])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[t,r]of this.elementProperties){let i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let r=new Set(e.flat(1/0).reverse());for(let i of r)t.unshift(Ca(i))}else e!==void 0&&t.push(Ca(e));return t}static _$Eu(e,t){let r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,r;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return jl(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$EO(e,t){var a;let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){let u=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:Sa).toAttribute(t,r.type);this._$Em=e,u==null?this.removeAttribute(i):this.setAttribute(i,u),this._$Em=null}}_$AK(e,t){var a;let r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){let u=r.getPropertyOptions(i),l=typeof u.converter=="function"?{fromAttribute:u.converter}:((a=u.converter)==null?void 0:a.fromAttribute)!==void 0?u.converter:Sa;this._$Em=i,this[i]=l.fromAttribute(t,u.type),this._$Em=null}}requestUpdate(e,t,r,i=!1,a){var u;if(e!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(e)),!((u=r.hasChanged)!=null?u:Jl)(i?a:this[e],t))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,r){var i;this._$AL.has(e)||this._$AL.set(e,t),r.reflect===!0&&this._$Em!==e&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(e)}_$EP(){return Me(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,u]of this._$Ep)this[a]=u;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,u]of i)u.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],u)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(t)):this._$ET()}catch(i){throw e=!1,this._$ET(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},qp;Or.elementStyles=[],Or.shadowRootOptions={mode:"open"},Or[wo("elementProperties")]=new Map,Or[wo("finalized")]=new Map,Kl==null||Kl({ReactiveElement:Or}),((qp=nr.reactiveElementVersions)!=null?qp:nr.reactiveElementVersions=[]).push("2.0.0");U();var Ro=globalThis,Ta=Ro.trustedTypes,Zp=Ta?Ta.createPolicy("lit-html",{createHTML:s=>s}):void 0,Yl="$lit$",Bn=`lit$${(Math.random()+"").slice(9)}$`,Ql="?"+Bn,gO=`<${Ql}>`,Rr=document,Oa=()=>Rr.createComment(""),xo=s=>s===null||typeof s!="object"&&typeof s!="function",rm=Array.isArray,im=s=>rm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",ql=`[ 	
\f\r]`,Io=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Yp=/-->/g,Qp=/>/g,wr=RegExp(`>|${ql}(?:([^\\s"'>=/]+)(${ql}*=${ql}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Xp=/'/g,em=/"/g,om=/^(?:script|style|textarea|title)$/i,sm=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),Ux=sm(1),Bx=sm(2),kn=Symbol.for("lit-noChange"),wt=Symbol.for("lit-nothing"),tm=new WeakMap,Ir=Rr.createTreeWalker(Rr,129);function am(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Zp!==void 0?Zp.createHTML(e):e}var um=(s,e)=>{let t=s.length-1,r=[],i,a=e===2?"<svg>":"",u=Io;for(let l=0;l<t;l++){let f=s[l],m,b,C=-1,h=0;for(;h<f.length&&(u.lastIndex=h,b=u.exec(f),b!==null);)h=u.lastIndex,u===Io?b[1]==="!--"?u=Yp:b[1]!==void 0?u=Qp:b[2]!==void 0?(om.test(b[2])&&(i=RegExp("</"+b[2],"g")),u=wr):b[3]!==void 0&&(u=wr):u===wr?b[0]===">"?(u=i!=null?i:Io,C=-1):b[1]===void 0?C=-2:(C=u.lastIndex-b[2].length,m=b[1],u=b[3]===void 0?wr:b[3]==='"'?em:Xp):u===em||u===Xp?u=wr:u===Yp||u===Qp?u=Io:(u=wr,i=void 0);let E=u===wr&&s[l+1].startsWith("/>")?" ":"";a+=u===Io?f+gO:C>=0?(r.push(m),f.slice(0,C)+Yl+f.slice(C)+Bn+E):f+Bn+(C===-2?l:E)}return[am(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),r]},xr=class{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let a=0,u=0,l=e.length-1,f=this.parts,[m,b]=um(e,t);if(this.el=xr.createElement(m,r),Ir.currentNode=this.el.content,t===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Ir.nextNode())!==null&&f.length<l;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(Yl)){let h=b[u++],E=i.getAttribute(C).split(Bn),w=/([.?@])?(.*)/.exec(h);f.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?Ia:w[1]==="?"?Ra:w[1]==="@"?xa:Pr}),i.removeAttribute(C)}else C.startsWith(Bn)&&(f.push({type:6,index:a}),i.removeAttribute(C));if(om.test(i.tagName)){let C=i.textContent.split(Bn),h=C.length-1;if(h>0){i.textContent=Ta?Ta.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],Oa()),Ir.nextNode(),f.push({type:2,index:++a});i.append(C[h],Oa())}}}else if(i.nodeType===8)if(i.data===Ql)f.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(Bn,C+1))!==-1;)f.push({type:7,index:a}),C+=Bn.length-1}a++}}static createElement(e,t){let r=Rr.createElement("template");return r.innerHTML=e,r}};function Mr(s,e,t=s,r){var u,l,f;if(e===kn)return e;let i=r!==void 0?(u=t._$Co)==null?void 0:u[r]:t._$Cl,a=xo(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((l=i==null?void 0:i._$AO)==null||l.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,t,r)),r!==void 0?((f=t._$Co)!=null?f:t._$Co=[])[r]=i:t._$Cl=i),i!==void 0&&(e=Mr(s,i._$AS(s,e.values),i,r)),e}var wa=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:r}=this._$AD,i=((m=e==null?void 0:e.creationScope)!=null?m:Rr).importNode(t,!0);Ir.currentNode=i;let a=Ir.nextNode(),u=0,l=0,f=r[0];for(;f!==void 0;){if(u===f.index){let b;f.type===2?b=new _r(a,a.nextSibling,this,e):f.type===1?b=new f.ctor(a,f.name,f.strings,this,e):f.type===6&&(b=new Ma(a,this,e)),this._$AV.push(b),f=r[++l]}u!==(f==null?void 0:f.index)&&(a=Ir.nextNode(),u++)}return Ir.currentNode=Rr,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},_r=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,r,i){var a;this.type=2,this._$AH=wt,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Mr(this,e,t),xo(e)?e===wt||e==null||e===""?(this._$AH!==wt&&this._$AR(),this._$AH=wt):e!==this._$AH&&e!==kn&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):im(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==wt&&xo(this._$AH)?this._$AA.nextSibling.data=e:this.$(Rr.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=xr.createElement(am(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(t);else{let u=new wa(i,this),l=u.u(this.options);u.p(t),this.$(l),this._$AH=u}}_$AC(e){let t=tm.get(e.strings);return t===void 0&&tm.set(e.strings,t=new xr(e)),t}T(e){rm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let a of e)i===t.length?t.push(r=new _r(this.k(Oa()),this.k(Oa()),this,this.options)):r=t[i],r._$AI(a),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e&&e!==this._$AB;){let i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Pr=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,a){this.type=1,this._$AH=wt,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=wt}_$AI(e,t=this,r,i){let a=this.strings,u=!1;if(a===void 0)e=Mr(this,e,t,0),u=!xo(e)||e!==this._$AH&&e!==kn,u&&(this._$AH=e);else{let l=e,f,m;for(e=a[0],f=0;f<a.length-1;f++)m=Mr(this,l[r+f],t,f),m===kn&&(m=this._$AH[f]),u||(u=!xo(m)||m!==this._$AH[f]),m===wt?e=wt:e!==wt&&(e+=(m!=null?m:"")+a[f+1]),this._$AH[f]=m}u&&!i&&this.j(e)}j(e){e===wt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},Ia=class extends Pr{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===wt?void 0:e}},Ra=class extends Pr{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==wt)}},xa=class extends Pr{constructor(e,t,r,i,a){super(e,t,r,i,a),this.type=5}_$AI(e,t=this){var u;if((e=(u=Mr(this,e,t,0))!=null?u:wt)===kn)return;let r=this._$AH,i=e===wt&&r!==wt||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==wt&&(r===wt||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;typeof this._$AH=="function"?this._$AH.call((r=(t=this.options)==null?void 0:t.host)!=null?r:this.element,e):this._$AH.handleEvent(e)}},Ma=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Mr(this,e)}},lm={S:Yl,A:Bn,P:Ql,C:1,M:um,L:wa,R:im,V:Mr,D:_r,I:Pr,H:Ra,N:xa,U:Ia,B:Ma},Zl=Ro.litHtmlPolyfillSupport,nm;Zl==null||Zl(xr,_r),((nm=Ro.litHtmlVersions)!=null?nm:Ro.litHtmlVersions=[]).push("3.0.0");U();U();U();var _a=globalThis,Pa=_a.ShadowRoot&&(_a.ShadyCSS===void 0||_a.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Xl=Symbol(),cm=new WeakMap,Mo=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==Xl)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Pa&&e===void 0){let r=t!==void 0&&t.length===1;r&&(e=cm.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&cm.set(t,e))}return e}toString(){return this.cssText}},fm=s=>new Mo(typeof s=="string"?s:s+"",void 0,Xl),_e=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((r,i,a)=>r+(u=>{if(u._$cssResult$===!0)return u.cssText;if(typeof u=="number")return u;throw Error("Value passed to 'css' function must be a 'css' function result: "+u+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[a+1],s[0]);return new Mo(t,s,Xl)},ec=(s,e)=>{if(Pa)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let r=document.createElement("style"),i=_a.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=t.cssText,s.appendChild(r)}},La=Pa?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return fm(t)})(s):s;var{is:vO,defineProperty:yO,getOwnPropertyDescriptor:bO,getOwnPropertyNames:EO,getOwnPropertySymbols:AO,getPrototypeOf:CO}=Object,rr=globalThis,dm=rr.trustedTypes,SO=dm?dm.emptyScript:"",tc=rr.reactiveElementPolyfillSupport,_o=(s,e)=>s,nc={toAttribute(s,e){switch(e){case Boolean:s=s?SO:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(r){t=null}}return t}},vm=(s,e)=>!vO(s,e),hm={attribute:!0,type:String,converter:nc,reflect:!1,hasChanged:vm},pm,mm;(pm=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(mm=rr.litPropertyMetadata)!=null||(rr.litPropertyMetadata=new WeakMap);var $n=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=hm){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);i!==void 0&&yO(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){var u;let{get:i,set:a}=(u=bO(this.prototype,e))!=null?u:{get(){return this[t]},set(l){this[t]=l}};return{get(){return i==null?void 0:i.call(this)},set(l){let f=i==null?void 0:i.call(this);a.call(this,l),this.requestUpdate(e,f,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:hm}static _$Ei(){if(this.hasOwnProperty(_o("elementProperties")))return;let e=CO(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(_o("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(_o("properties"))){let t=this.properties,r=[...EO(t),...AO(t)];for(let i of r)this.createProperty(i,t[i])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[r,i]of t)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[t,r]of this.elementProperties){let i=this._$Eu(t,r);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let r=new Set(e.flat(1/0).reverse());for(let i of r)t.unshift(La(i))}else e!==void 0&&t.push(La(e));return t}static _$Eu(e,t){let r=t.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,r;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return ec(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var r;return(r=t.hostDisconnected)==null?void 0:r.call(t)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$EO(e,t){var a;let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){let u=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:nc).toAttribute(t,r.type);this._$Em=e,u==null?this.removeAttribute(i):this.setAttribute(i,u),this._$Em=null}}_$AK(e,t){var a;let r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){let u=r.getPropertyOptions(i),l=typeof u.converter=="function"?{fromAttribute:u.converter}:((a=u.converter)==null?void 0:a.fromAttribute)!==void 0?u.converter:nc;this._$Em=i,this[i]=l.fromAttribute(t,u.type),this._$Em=null}}requestUpdate(e,t,r,i=!1,a){var u;if(e!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(e)),!((u=r.hasChanged)!=null?u:vm)(i?a:this[e],t))return;this.C(e,t,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,r){var i;this._$AL.has(e)||this._$AL.set(e,t),r.reflect===!0&&this._$Em!==e&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(e)}_$EP(){return Me(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,u]of this._$Ep)this[a]=u;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,u]of i)u.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],u)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(t)):this._$ET()}catch(i){throw e=!1,this._$ET(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},gm;$n.elementStyles=[],$n.shadowRootOptions={mode:"open"},$n[_o("elementProperties")]=new Map,$n[_o("finalized")]=new Map,tc==null||tc({ReactiveElement:$n}),((gm=rr.reactiveElementVersions)!=null?gm:rr.reactiveElementVersions=[]).push("2.0.0");U();var Lo=globalThis,Da=Lo.trustedTypes,ym=Da?Da.createPolicy("lit-html",{createHTML:s=>s}):void 0,Om="$lit$",ir=`lit$${(Math.random()+"").slice(9)}$`,wm="?"+ir,TO=`<${wm}>`,Nr=document,Do=()=>Nr.createComment(""),No=s=>s===null||typeof s!="object"&&typeof s!="function",Im=Array.isArray,OO=s=>Im(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",rc=`[ 	
\f\r]`,Po=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,bm=/-->/g,Em=/>/g,Lr=RegExp(`>|${rc}(?:([^\\s"'>=/]+)(${rc}*=${rc}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Am=/'/g,Cm=/"/g,Rm=/^(?:script|style|textarea|title)$/i,xm=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),Ee=xm(1),zx=xm(2),Fr=Symbol.for("lit-noChange"),It=Symbol.for("lit-nothing"),Sm=new WeakMap,Dr=Nr.createTreeWalker(Nr,129);function Mm(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return ym!==void 0?ym.createHTML(e):e}var wO=(s,e)=>{let t=s.length-1,r=[],i,a=e===2?"<svg>":"",u=Po;for(let l=0;l<t;l++){let f=s[l],m,b,C=-1,h=0;for(;h<f.length&&(u.lastIndex=h,b=u.exec(f),b!==null);)h=u.lastIndex,u===Po?b[1]==="!--"?u=bm:b[1]!==void 0?u=Em:b[2]!==void 0?(Rm.test(b[2])&&(i=RegExp("</"+b[2],"g")),u=Lr):b[3]!==void 0&&(u=Lr):u===Lr?b[0]===">"?(u=i!=null?i:Po,C=-1):b[1]===void 0?C=-2:(C=u.lastIndex-b[2].length,m=b[1],u=b[3]===void 0?Lr:b[3]==='"'?Cm:Am):u===Cm||u===Am?u=Lr:u===bm||u===Em?u=Po:(u=Lr,i=void 0);let E=u===Lr&&s[l+1].startsWith("/>")?" ":"";a+=u===Po?f+TO:C>=0?(r.push(m),f.slice(0,C)+Om+f.slice(C)+ir+E):f+ir+(C===-2?l:E)}return[Mm(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),r]},Ur=class{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let a=0,u=0,l=e.length-1,f=this.parts,[m,b]=wO(e,t);if(this.el=Ur.createElement(m,r),Dr.currentNode=this.el.content,t===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Dr.nextNode())!==null&&f.length<l;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(Om)){let h=b[u++],E=i.getAttribute(C).split(ir),w=/([.?@])?(.*)/.exec(h);f.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?sc:w[1]==="?"?ac:w[1]==="@"?uc:wi}),i.removeAttribute(C)}else C.startsWith(ir)&&(f.push({type:6,index:a}),i.removeAttribute(C));if(Rm.test(i.tagName)){let C=i.textContent.split(ir),h=C.length-1;if(h>0){i.textContent=Da?Da.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],Do()),Dr.nextNode(),f.push({type:2,index:++a});i.append(C[h],Do())}}}else if(i.nodeType===8)if(i.data===wm)f.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(ir,C+1))!==-1;)f.push({type:7,index:a}),C+=ir.length-1}a++}}static createElement(e,t){let r=Nr.createElement("template");return r.innerHTML=e,r}};function Oi(s,e,t=s,r){var u,l,f;if(e===Fr)return e;let i=r!==void 0?(u=t._$Co)==null?void 0:u[r]:t._$Cl,a=No(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((l=i==null?void 0:i._$AO)==null||l.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,t,r)),r!==void 0?((f=t._$Co)!=null?f:t._$Co=[])[r]=i:t._$Cl=i),i!==void 0&&(e=Oi(s,i._$AS(s,e.values),i,r)),e}var oc=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:r}=this._$AD,i=((m=e==null?void 0:e.creationScope)!=null?m:Nr).importNode(t,!0);Dr.currentNode=i;let a=Dr.nextNode(),u=0,l=0,f=r[0];for(;f!==void 0;){if(u===f.index){let b;f.type===2?b=new Br(a,a.nextSibling,this,e):f.type===1?b=new f.ctor(a,f.name,f.strings,this,e):f.type===6&&(b=new lc(a,this,e)),this._$AV.push(b),f=r[++l]}u!==(f==null?void 0:f.index)&&(a=Dr.nextNode(),u++)}return Dr.currentNode=Nr,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},Br=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,r,i){var a;this.type=2,this._$AH=It,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Oi(this,e,t),No(e)?e===It||e==null||e===""?(this._$AH!==It&&this._$AR(),this._$AH=It):e!==this._$AH&&e!==Fr&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):OO(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==It&&No(this._$AH)?this._$AA.nextSibling.data=e:this.$(Nr.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Ur.createElement(Mm(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(t);else{let u=new oc(i,this),l=u.u(this.options);u.p(t),this.$(l),this._$AH=u}}_$AC(e){let t=Sm.get(e.strings);return t===void 0&&Sm.set(e.strings,t=new Ur(e)),t}T(e){Im(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let a of e)i===t.length?t.push(r=new Br(this.k(Do()),this.k(Do()),this,this.options)):r=t[i],r._$AI(a),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,t);e&&e!==this._$AB;){let i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},wi=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,a){this.type=1,this._$AH=It,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=It}_$AI(e,t=this,r,i){let a=this.strings,u=!1;if(a===void 0)e=Oi(this,e,t,0),u=!No(e)||e!==this._$AH&&e!==Fr,u&&(this._$AH=e);else{let l=e,f,m;for(e=a[0],f=0;f<a.length-1;f++)m=Oi(this,l[r+f],t,f),m===Fr&&(m=this._$AH[f]),u||(u=!No(m)||m!==this._$AH[f]),m===It?e=It:e!==It&&(e+=(m!=null?m:"")+a[f+1]),this._$AH[f]=m}u&&!i&&this.j(e)}j(e){e===It?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},sc=class extends wi{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===It?void 0:e}},ac=class extends wi{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==It)}},uc=class extends wi{constructor(e,t,r,i,a){super(e,t,r,i,a),this.type=5}_$AI(e,t=this){var u;if((e=(u=Oi(this,e,t,0))!=null?u:It)===Fr)return;let r=this._$AH,i=e===It&&r!==It||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==It&&(r===It||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;typeof this._$AH=="function"?this._$AH.call((r=(t=this.options)==null?void 0:t.host)!=null?r:this.element,e):this._$AH.handleEvent(e)}},lc=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Oi(this,e)}};var ic=Lo.litHtmlPolyfillSupport,Tm;ic==null||ic(Ur,Br),((Tm=Lo.litHtmlVersions)!=null?Tm:Lo.litHtmlVersions=[]).push("3.0.0");var _m=(s,e,t)=>{var a,u;let r=(a=t==null?void 0:t.renderBefore)!=null?a:e,i=r._$litPart$;if(i===void 0){let l=(u=t==null?void 0:t.renderBefore)!=null?u:null;r._$litPart$=i=new Br(e.insertBefore(Do(),l),l,void 0,t!=null?t:{})}return i._$AI(s),i};var Pe=class extends $n{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,r;let e=super.createRenderRoot();return(r=(t=this.renderOptions).renderBefore)!=null||(t.renderBefore=e.firstChild),e}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=_m(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Fr}},Pm;Pe._$litElement$=!0,Pe["finalized"]=!0,(Pm=globalThis.litElementHydrateSupport)==null||Pm.call(globalThis,{LitElement:Pe});var cc=globalThis.litElementPolyfillSupport;cc==null||cc({LitElement:Pe});var Lm;((Lm=globalThis.litElementVersions)!=null?Lm:globalThis.litElementVersions=[]).push("4.0.0");U();U();U();var We=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};U();U();U();U();U();U();U();U();U();var kr=class extends Pe{render(){return Ee` <div>Hello from SuperViz, ${this.name}</div> `}};kr.properties={name:{type:String}},kr.styles=_e`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,kr=Ge([We("superviz-hello-world")],kr);U();U();U();U();var fc=_e`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;U();var dc=_e`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;U();var hc=_e`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;U();var pc=_e`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }

  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }
`;var je=s=>{var t;class e extends s{connectedCallback(){setTimeout(()=>{var u;let i=document.getElementById("superviz-style"),a=document.createElement("style");a.innerHTML=(i==null?void 0:i.innerHTML)||"",(u=this.shadowRoot)==null||u.appendChild(a)}),super.connectedCallback()}emitEvent(i,a,u={composed:!0,bubbles:!0}){let l=new CustomEvent(i,fe({detail:a},u));this.dispatchEvent(l)}}return e.styles=[fc,dc,hc,pc,(t=s.styles)!=null?t:[]],e};var Dm=je(Pe),IO=[Dm.styles],$r=class extends Dm{constructor(){super();this.name="",this.size="md"}render(){return Ee` <i class="sv-icon sv-icon-${this.name}_${this.size}"></i> `}};$r.properties={name:{type:String},size:{type:String}},$r.styles=[IO,_e`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }
    `],$r=Ge([We("superviz-icon")],$r);U();U();U();U();var Fa={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Ua=s=>(...e)=>({_$litDirective$:s,values:e}),Ii=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var yt=Ua(class extends Ii{constructor(s){var e;if(super(s),s.type!==Fa.ATTRIBUTE||s.name!=="class"||((e=s.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){var r,i;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(a=>a!=="")));for(let a in e)e[a]&&!((r=this.st)!=null&&r.has(a))&&this.it.add(a);return this.render(e)}let t=s.element.classList;for(let a of this.it)a in e||(t.remove(a),this.it.delete(a));for(let a in e){let u=!!e[a];u===this.it.has(a)||((i=this.st)==null?void 0:i.has(a))||(u?(t.add(a),this.it.add(a)):(t.remove(a),this.it.delete(a)))}return kn}});U();var Nm=_e`
  .dropdown {
    position: relative;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .menu {
    list-style: none;
    padding: 0;
    background: #fff;
    color: #9fa5b5;
    opacity: 0;
    display: none;
    transition: 0.2s;
    z-index: 1;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    top: -10px;
    border-radius: 3px;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    left: 100%;
    transform: translateX(-100%);
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    left: 26px;
    transform: translateX(-100%);
  }

  .menu li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .menu li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
  }
`;var Fm=je(Pe),RO=[Fm.styles,Nm],Hr=class extends Fm{constructor(){super(...arguments);this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let r=t.composedPath(),i=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),l=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],f=r.includes(i),m=r.includes(a),b=r.includes(l);f||m||b||(this.open=!1)};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let r=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",r,{bubbles:!1,composed:!1})}}updated(t){t.has("open")&&(this.open&&document.addEventListener("click",this.onClickOutDropdown),this.open||(document.removeEventListener("click",this.onClickOutDropdown),this.close()))}render(){let t={menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right"},r=this.options.map(a=>{let u={text:!0,"text-bold":!0,active:this.active===(a==null?void 0:a[this.returnTo])};return Ee`<li @click=${()=>this.callbackSelected(a)} class=${yt(u)}>${a[this.label]}</li>`}),i=()=>{this.open=!this.open};return Ee`
      <div class="dropdown">
        <div class="dropdown-content" @click=${()=>i()}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <ul class=${yt(t)}>
          ${r}
        </ul>
      </div>
    `}};Hr.styles=RO,Hr.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},position:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]}},Hr=Ge([We("superviz-dropdown")],Hr);U();U();var Um=_e`
#mouse-container {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

#mouse-sync {
  position: absolute;
}

.mouse-board {
  background: transparent;
  position: absolute;
  top: 0;
  cursor: none !important;
}

.mouse-follower {
  position: absolute;
  display: block;
  transition: all 0.4s;
}

.pointer-mouse {
  display: flex;
  height: 17px;
  width: 17px;
  background-image: url(https://production.cdn.superviz.com/static/pointers/0.svg);
}

.mouse-user-name {
  display: block;
  position: absolute;  
  border-radius: 30px;
  padding: 2px 8px;
  font-weight: 700;
  font-size: 14px;
  font-family: Roboto, sans-serif;
  line-height: 22px;
  margin-left: 10px;
  margin-top: -6px;
  background: yellow;
  white-space: nowrap;
}
`;var Ri=class extends Pe{constructor(){super();this.updatePresenceMouseParticipant=t=>{if(!this.shadowRoot.getElementById(`mouse-${t.id}`)){let l=this.shadowRoot.getElementById("mouse-sync"),f=document.createElement("div");f.setAttribute("id",`mouse-${t.id}`),f.setAttribute("class","mouse-follower");let m=document.createElement("div");m.setAttribute("class","pointer-mouse");let b=document.createElement("div");b.setAttribute("class","mouse-user-name"),b.innerHTML=t.name,f.appendChild(m),f.appendChild(b),l&&l.appendChild(f)}let i=this.shadowRoot.getElementById(`mouse-${t.id}`);if(!i)return;let a=this.shadowRoot.getElementById(`mouse-${t.id}`),u=this.shadowRoot.getElementById(`mouse-${t.id}`);if(a&&u){let l=a.getElementsByClassName("mouse-user-name")[0],f=u.getElementsByClassName("pointer-mouse")[0];f&&(f.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${t.slotIndex}.svg)`),l&&(l.style.color=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#000000",l.style.backgroundColor=t.color,l.innerHTML=t.name);let{containerId:m}=t,b=document.getElementById(m),C=t.mousePositionX,h=t.mousePositionY;if(m){let E=(b==null?void 0:b.clientWidth)||1,w=(b==null?void 0:b.clientHeight)||1;C=t.mousePositionX/t.originalWidth*E,h=t.mousePositionY/t.originalHeight*w}i.style.left=`${C}px`,i.style.top=`${h}px`}};this.textColorValues=[2,4,5,7,8,16]}removePresenceMouseParticipant(t){let r=this.shadowRoot.getElementById(`mouse-${t}`);r&&r.remove()}render(){return Ee`
      <div id="mouse-container" class="mouse-board">
        <div id="mouse-sync"></div>
      </div>
    `}};Ri.styles=[Um],Ri=Ge([We("superviz-presence-mouse")],Ri);U();U();U();var Ba=_e`  
  .modal--overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: rgba(var(--sv-gray-400), 0.8);
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: transparent;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var Bm=je(Pe),xO=[Bm.styles,Ba],xi=class extends Bm{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};xi.styles=xO,xi=Ge([We("superviz-modal")],xi);U();var km=je(Pe),MO=[km.styles,Ba],Mi=class extends km{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>Ee`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,r=()=>Ee`
        <div class="modal--body">
          <div class="modal--body-content">
            ${this.options.body}
          </div>
        </div>
      `,i=()=>{if(this.options.footer)return Ee`
          <div class="modal--footer">
            ${this.options.footer}
          </div>
        `;let a=this.options.confirmLabel||"OK",u=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?Ee`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>${u}</button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
          </div>
        `:Ee`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
        </div>
      `};return Ee`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">
          ${t()}

          ${r()}

          ${i()}
        </div>
      </div>
    `}};Mi.styles=MO,Mi=Ge([We("superviz-modal-container")],Mi);U();U();U();U();var mc=_e`
  .container {
    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    height: 100%;
  }

  .container-close {
    display: none;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }
`;U();var gc=_e`
  div.topbar {
    display: flex;
    justify-content: space-between;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  div.topbar span {
    margin: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .toggle-icon {
    cursor: pointer;
    transition: 0.15s;
    border-radius: 50%;
    aspect-ratio: 1;
  }

  .toggle-icon:hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
`;U();var vc=_e`
  .annotations {
    display: flex;
    flex-direction: column;
    background-color: rgb(var(--sv-gray-400));
    min-height: 10px;
    padding: 8px;
  }

  .annotations--add-comment-btn {
    color: rgb(var(--sv-white));
    text-align: center;
    padding: 8px;
  }

  .annotations--comments-input {
    width: 288px;
    padding: 8px;
  }

  .hidden {
    display: none;
  }
`;U();var yc=_e`
  .reply {
    padding-left: 24px !important;
  }

  .comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comment-item__user {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comment-item__actions superviz-dropdown,
  .comment-item__actions button {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comment-item__user-details {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comment-item__avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comment-item__content__body {
    color: rgb(var(--sv-gray-700));
  }

  .hidden {
    display: none;
  }
`;U();var bc=_e`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;U();var Ec=_e`
  .comment-input {
    display: flex;
    flex-direction: column;
    width: 100%;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
  }

  .comment-input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comment-input:focus-within > .sv-hr {
    background: rgb(var(--sv-gray-500))
  }

  #comment-input--textarea {
    all: unset;
    border: 0px;
    border-radius: 4px;
    outline: none;
    height: 13px;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    padding: 12px 11px !important;
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    resize: none;
    appearance: none;
    width: 90%;
  }

  #comment-input--textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
  }

  .comment-input--options {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
  }

  .mention {
    display: none;
  }

  .comment-input--send-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-primary));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgba(var(--sv-white), 1);
    border: 0px;
    cursor: pointer;
  }

  .align-send-btn > superviz-icon {
    margin-right: 2px;
    margin-top: 4px;
  }

  .comment-input--send-btn:disabled {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-gray-200));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgb(var(--sv-gray-400));
    border: 0px;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
  }
`;U();var Ac=_e`
  .annotation-item--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
  }

  .annotation-item:hover:not(.annotation-item--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    padding: 8px;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  div:last-child {
    margin-left: 8px;
  }

  .comments-container {
    display: flex;
    flex-direction: column;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    display: none;
  }

  .annotation-item {
    padding: 8px;
    cursor: pointer;
  }
`;U();var Cc=_e`
  .annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;U();var Sc=_e`
  .annotation-pin,
  .annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: white;
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid white;
    box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.25);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    cursor: pointer;
  }

  .annotation-pin:hover,
  .annotation-pin:focus,
  .annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: white;
  }

  .annotation-pin__avatar--add {
    font-size: 24px;
    color: rgb(var(--sv-gray-700));
    background-color: white;
  }

  .annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;

    object-fit: cover;
  }
`;U();var Tc=_e`
  .select {
    display: flex;
    width: 100%;
    justify-content: flex-end;
    align-items: center;
  }

  .select-container {
    text-wrap: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
`;U();var Oc=_e`
  button.float-button {
    position: fixed;

    border-radius: 50%;
    width: 38px;
    height: 38px;

    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    border: none;

    background-color: white;
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    transition: all 300ms;
    cursor: pointer;
  }

  button.float-button p {
    display: none;
  }

  .hide-button {
    display: none !important;
  }

  button.float-button:hover {
    width: 110px;
    border-radius: 30px;
  }

  button.float-button:hover p {
    display: block;
  }
`;U();var wc=_e`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;U();var Ic;function Rc(s){let e=s.querySelector("#superviz-comments");if(e&&!Ic){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};Ic=new MutationObserver(r=>{r.forEach(i=>{!i.removedNodes.length||i.removedNodes.forEach(a=>{a.id==="poweredby-footer"&&_O(s)})})}),Ic.observe(e,t)}}function _O(s){let e=document.createElement("div");e.id="poweredby-footer",e.className="footer";let t=document.createElement("div");t.className="powered-by powered-by--horizontal";let r=document.createElement("a");r.href="https://superviz.com/",r.target="_blank",r.className="link";let i=document.createElement("div");i.textContent="Powered by";let a=document.createElement("img");a.width=48,a.height=8.86,a.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",t.appendChild(r),r.appendChild(i),i.appendChild(a),e.appendChild(t);let u=s.getElementById("superviz-comments");u&&u.appendChild(e),Rc(s)}var $m=je(Pe),PO=[$m.styles,mc,wc],Gr=class extends $m{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1}updateAnnotations(t){this.annotations=t}toggle(){this.emitEvent("toggle",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:r}=t;this.annotationFilter=r}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".superviz-comments");!r||(this.waterMarkState&&Rc(this.shadowRoot),r.setAttribute("style",this.side))})}render(){let t=[this.open?"container":"container-close","superviz-comments"].join(" "),r=Ee` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`,i=this.waterMarkState?r:"";return Ee`
      <div id="superviz-comments" class=${t}>
        <div class="header">
          <superviz-comments-topbar @close=${this.toggle}></superviz-comments-topbar>
          <superviz-comments-annotations id="annotations" open=${this.open}>
          </superviz-comments-annotations>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          class="content"
        ></superviz-comments-content>
        ${i}
      </div>
    `}};Gr.styles=PO,Gr.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String}},Gr=Ge([We("superviz-comments")],Gr);U();U();var LO=je(Pe),DO=[LO.styles,gc],Wr=class extends je(Pe){constructor(){super();this.side="left"}close(){this.dispatchEvent(new CustomEvent("close"))}render(){return this.side==="left"?Ee`
        <div class="topbar">
          <span @click=${this.close} class="toggle-icon">
            <superviz-icon name="left" size="lg"></superviz-icon>
          </span>
          <span class="text text-bold">COMMENTS</span>
        </div>
      `:Ee`
      <div class="topbar">
        <span class="text text-bold">COMMENTS</span>
        <span @click=${this.close} class="toggle-icon">
          <superviz-icon name="right" size="lg"></superviz-icon>
        </span>
      </div>
    `}};Wr.styles=DO,Wr.properties={side:{type:String}},Wr=Ge([We("superviz-comments-topbar")],Wr);U();var Hm=je(Pe),NO=[Hm.styles,vc],zr=class extends Hm{constructor(){super(...arguments);this.prepareToCreateAnnotation=r=>Me(this,[r],function*({detail:t}){this.annotation=t,yield this.updateComplete,this.emitEvent("comment-input-focus",t)});this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{(t==null?void 0:t.key)==="Escape"&&(this.annotation=null)}}createComment({detail:t}){this.emitEvent("create-annotation",t),this.annotation=null}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)})}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)})}render(){let t={"annotations--comments-input":!0,hidden:!this.annotation};return Ee`
      <div class="annotations">
        <span class="text text-big text-bold annotations--add-comment-btn">
          Click anywhere to add a comment
        </span>
        <div class=${yt(t)}>
          <superviz-comments-comment-input
            @create-annotation=${this.createComment}
            eventType="create-annotation"
          >
          </superviz-comments-comment-input>
        </div>
      </div>
    `}};zr.styles=NO,zr.properties={annotation:{type:Object}},zr=Ge([We("superviz-comments-annotations")],zr);U();U();U();U();var{D:FO}=lm;var Gm=()=>document.createComment(""),_i=(s,e,t)=>{var a;let r=s._$AA.parentNode,i=e===void 0?s._$AB:e._$AA;if(t===void 0){let u=r.insertBefore(Gm(),i),l=r.insertBefore(Gm(),i);t=new FO(u,l,s,s.options)}else{let u=t._$AB.nextSibling,l=t._$AM,f=l!==s;if(f){let m;(a=t._$AQ)==null||a.call(t,s),t._$AM=s,t._$AP!==void 0&&(m=s._$AU)!==l._$AU&&t._$AP(m)}if(u!==i||f){let m=t._$AA;for(;m!==u;){let b=m.nextSibling;r.insertBefore(m,i),m=b}}}return t},or=(s,e,t=s)=>(s._$AI(e,t),s),UO={},Wm=(s,e=UO)=>s._$AH=e,zm=s=>s._$AH,$a=s=>{var r;(r=s._$AP)==null||r.call(s,!1,!0);let e=s._$AA,t=s._$AB.nextSibling;for(;e!==t;){let i=e.nextSibling;e.remove(),e=i}};var Vm=(s,e,t)=>{let r=new Map;for(let i=e;i<=t;i++)r.set(s[i],i);return r},jm=Ua(class extends Ii{constructor(s){if(super(s),s.type!==Fa.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let r;t===void 0?t=e:e!==void 0&&(r=e);let i=[],a=[],u=0;for(let l of s)i[u]=r?r(l,u):u,a[u]=t(l,u),u++;return{values:a,keys:i}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,r]){var I;let i=zm(s),{values:a,keys:u}=this.ht(e,t,r);if(!Array.isArray(i))return this.dt=u,a;let l=(I=this.dt)!=null?I:this.dt=[],f=[],m,b,C=0,h=i.length-1,E=0,w=a.length-1;for(;C<=h&&E<=w;)if(i[C]===null)C++;else if(i[h]===null)h--;else if(l[C]===u[E])f[E]=or(i[C],a[E]),C++,E++;else if(l[h]===u[w])f[w]=or(i[h],a[w]),h--,w--;else if(l[C]===u[w])f[w]=or(i[C],a[w]),_i(s,f[w+1],i[C]),C++,w--;else if(l[h]===u[E])f[E]=or(i[h],a[E]),_i(s,i[C],i[h]),h--,E++;else if(m===void 0&&(m=Vm(u,E,w),b=Vm(l,C,h)),m.has(l[C]))if(m.has(l[h])){let S=b.get(u[E]),T=S!==void 0?i[S]:null;if(T===null){let x=_i(s,i[C]);or(x,a[E]),f[E]=x}else f[E]=or(T,a[E]),_i(s,i[C],T),i[S]=null;E++}else $a(i[h]),h--;else $a(i[C]),C++;for(;E<=w;){let S=_i(s,f[w+1]);or(S,a[E]),f[E++]=S}for(;C<=h;){let S=i[C++];S!==null&&$a(S)}return this.dt=u,Wm(s,f),kn}});var Km=je(Pe),BO=[Km.styles,bc],Vr=class extends Km{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:t})=>{let{uuid:r}=t;if(this.selectedAnnotation===r){this.selectedAnnotation=null;return}this.selectedAnnotation=r};this.checkLastAnnotation=t=>{var a,u;let r=this.annotations.filter(l=>l.resolved),i=this.annotations.filter(l=>!l.resolved);return this.annotationFilter==="all"?t===((a=r[r.length-1])==null?void 0:a.uuid):t===((u=i[i.length-1])==null?void 0:u.uuid)};this.annotations=[]}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!r)return;let i=this.lastCommentId===this.selectedAnnotation,a=i?0:-150,u=r.getClientRects()[0];!u||(this.scrollBy(0,u.y+a),i&&setTimeout(()=>{this.scrollBy(0,u.y+a)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return Ee` ${jm(this.annotations.filter(t=>t.comments.length),t=>t.uuid,t=>Ee`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(t)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${t.uuid}
          isLastComment=${this.checkLastAnnotation(t.uuid)}
        >
        </superviz-comments-annotation-item>
      `)}`}};Vr.styles=BO,Vr.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String}},Vr=Ge([We("superviz-comments-content")],Vr);U();U();U();U();U();var Hn=class extends Error{},Ha=class extends Hn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},Ga=class extends Hn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},Wa=class extends Hn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},Gn=class extends Hn{},Pi=class extends Hn{constructor(e){super(`Invalid unit ${e}`)}},Rt=class extends Hn{},hn=class extends Hn{constructor(){super("Zone is an abstract class")}};U();U();U();var pe="numeric",pn="short",qt="long",sr={year:pe,month:pe,day:pe},Fo={year:pe,month:pn,day:pe},xc={year:pe,month:pn,day:pe,weekday:pn},Uo={year:pe,month:qt,day:pe},Bo={year:pe,month:qt,day:pe,weekday:qt},ko={hour:pe,minute:pe},$o={hour:pe,minute:pe,second:pe},Ho={hour:pe,minute:pe,second:pe,timeZoneName:pn},Go={hour:pe,minute:pe,second:pe,timeZoneName:qt},Wo={hour:pe,minute:pe,hourCycle:"h23"},zo={hour:pe,minute:pe,second:pe,hourCycle:"h23"},Vo={hour:pe,minute:pe,second:pe,hourCycle:"h23",timeZoneName:pn},jo={hour:pe,minute:pe,second:pe,hourCycle:"h23",timeZoneName:qt},Ko={year:pe,month:pe,day:pe,hour:pe,minute:pe},Jo={year:pe,month:pe,day:pe,hour:pe,minute:pe,second:pe},qo={year:pe,month:pn,day:pe,hour:pe,minute:pe},Zo={year:pe,month:pn,day:pe,hour:pe,minute:pe,second:pe},Mc={year:pe,month:pn,day:pe,weekday:pn,hour:pe,minute:pe},Yo={year:pe,month:qt,day:pe,hour:pe,minute:pe,timeZoneName:pn},Qo={year:pe,month:qt,day:pe,hour:pe,minute:pe,second:pe,timeZoneName:pn},Xo={year:pe,month:qt,day:pe,weekday:qt,hour:pe,minute:pe,timeZoneName:qt},es={year:pe,month:qt,day:pe,weekday:qt,hour:pe,minute:pe,second:pe,timeZoneName:qt};U();U();U();U();var Ht=class{get type(){throw new hn}get name(){throw new hn}get ianaName(){return this.name}get isUniversal(){throw new hn}offsetName(e,t){throw new hn}formatOffset(e,t){throw new hn}offset(e){throw new hn}equals(e){throw new hn}get isValid(){throw new hn}};var _c=null,Tn=class extends Ht{static get instance(){return _c===null&&(_c=new Tn),_c}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return Va(e,t,r)}formatOffset(e,t){return ar(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}};U();var Ka={};function kO(s){return Ka[s]||(Ka[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Ka[s]}var $O={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function HO(s,e){let t=s.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,i,a,u,l,f,m,b]=r;return[u,i,a,l,f,m,b]}function GO(s,e){let t=s.formatToParts(e),r=[];for(let i=0;i<t.length;i++){let{type:a,value:u}=t[i],l=$O[a];a==="era"?r[l]=u:De(l)||(r[l]=parseInt(u,10))}return r}var ja={},Ct=class extends Ht{static create(e){return ja[e]||(ja[e]=new Ct(e)),ja[e]}static resetCache(){ja={},Ka={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ct.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return Va(e,t,r,this.name)}formatOffset(e,t){return ar(this.offset(e),t)}offset(e){let t=new Date(e);if(isNaN(t))return NaN;let r=kO(this.name),[i,a,u,l,f,m,b]=r.formatToParts?GO(r,t):HO(r,t);l==="BC"&&(i=-Math.abs(i)+1);let h=Li({year:i,month:a,day:u,hour:f===24?0:f,minute:m,second:b,millisecond:0}),E=+t,w=E%1e3;return E-=w>=0?w:1e3+w,(h-E)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}};U();var Jm={};function WO(s,e={}){let t=JSON.stringify([s,e]),r=Jm[t];return r||(r=new Intl.ListFormat(s,e),Jm[t]=r),r}var Pc={};function Lc(s,e={}){let t=JSON.stringify([s,e]),r=Pc[t];return r||(r=new Intl.DateTimeFormat(s,e),Pc[t]=r),r}var Dc={};function zO(s,e={}){let t=JSON.stringify([s,e]),r=Dc[t];return r||(r=new Intl.NumberFormat(s,e),Dc[t]=r),r}var Nc={};function VO(s,e={}){let u=e,{base:t}=u,r=Al(u,["base"]),i=JSON.stringify([s,r]),a=Nc[i];return a||(a=new Intl.RelativeTimeFormat(s,e),Nc[i]=a),a}var ts=null;function jO(){return ts||(ts=new Intl.DateTimeFormat().resolvedOptions().locale,ts)}function KO(s){let e=s.indexOf("-x-");e!==-1&&(s=s.substring(0,e));let t=s.indexOf("-u-");if(t===-1)return[s];{let r,i;try{r=Lc(s).resolvedOptions(),i=s}catch(l){let f=s.substring(0,t);r=Lc(f).resolvedOptions(),i=f}let{numberingSystem:a,calendar:u}=r;return[i,a,u]}}function JO(s,e,t){return(t||e)&&(s.includes("-u-")||(s+="-u"),t&&(s+=`-ca-${t}`),e&&(s+=`-nu-${e}`)),s}function qO(s){let e=[];for(let t=1;t<=12;t++){let r=Ce.utc(2009,t,1);e.push(s(r))}return e}function ZO(s){let e=[];for(let t=1;t<=7;t++){let r=Ce.utc(2016,11,13+t);e.push(s(r))}return e}function Ja(s,e,t,r){let i=s.listingMode();return i==="error"?null:i==="en"?t(e):r(e)}function YO(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var Fc=class{constructor(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;let l=r,{padTo:i,floor:a}=l,u=Al(l,["padTo","floor"]);if(!t||Object.keys(u).length>0){let f=fe({useGrouping:!1},r);r.padTo>0&&(f.minimumIntegerDigits=r.padTo),this.inf=zO(e,f)}}format(e){if(this.inf){let t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{let t=this.floor?Math.floor(e):Di(e,3);return lt(t,this.padTo)}}},Uc=class{constructor(e,t,r){this.opts=r,this.originalZone=void 0;let i;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let u=-1*(e.offset/60),l=u>=0?`Etc/GMT+${u}`:`Etc/GMT${u}`;e.offset!==0&&Ct.create(l).valid?(i=l,this.dt=e):(i="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,i=e.zone.name):(i="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let a=fe({},this.opts);a.timeZone=a.timeZone||i,this.dtf=Lc(t,a)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){let r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return Ve(fe({},t),{value:r})}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},Bc=class{constructor(e,t,r){this.opts=fe({style:"long"},r),!t&&qa()&&(this.rtf=VO(e,r))}format(e,t){return this.rtf?this.rtf.format(e,t):qm(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}},Ke=class{static fromOpts(e){return Ke.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,r,i=!1){let a=e||Qe.defaultLocale,u=a||(i?"en-US":jO()),l=t||Qe.defaultNumberingSystem,f=r||Qe.defaultOutputCalendar;return new Ke(u,l,f,a)}static resetCache(){ts=null,Pc={},Dc={},Nc={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:r}={}){return Ke.create(e,t,r)}constructor(e,t,r,i){let[a,u,l]=KO(e);this.locale=a,this.numberingSystem=t||u||null,this.outputCalendar=r||l||null,this.intl=JO(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=YO(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Ke.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone(Ve(fe({},e),{defaultToEN:!0}))}redefaultToSystem(e={}){return this.clone(Ve(fe({},e),{defaultToEN:!1}))}months(e,t=!1){return Ja(this,e,kc,()=>{let r=t?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";return this.monthsCache[i][e]||(this.monthsCache[i][e]=qO(a=>this.extract(a,r,"month"))),this.monthsCache[i][e]})}weekdays(e,t=!1){return Ja(this,e,$c,()=>{let r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},i=t?"format":"standalone";return this.weekdaysCache[i][e]||(this.weekdaysCache[i][e]=ZO(a=>this.extract(a,r,"weekday"))),this.weekdaysCache[i][e]})}meridiems(){return Ja(this,void 0,()=>Hc,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ce.utc(2016,11,13,9),Ce.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return Ja(this,e,Gc,()=>{let t={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ce.utc(-40,1,1),Ce.utc(2017,1,1)].map(r=>this.extract(r,t,"era"))),this.eraCache[e]})}extract(e,t,r){let i=this.dtFormatter(e,t),a=i.formatToParts(),u=a.find(l=>l.type.toLowerCase()===r);return u?u.value:null}numberFormatter(e={}){return new Fc(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Uc(e,this.intl,t)}relFormatter(e={}){return new Bc(this.intl,this.isEnglish(),e)}listFormatter(e={}){return WO(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}};U();U();var zc=null,ct=class extends Ht{static get utcInstance(){return zc===null&&(zc=new ct(0)),zc}static instance(e){return e===0?ct.utcInstance:new ct(e)}static parseSpecifier(e){if(e){let t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new ct(jr(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${ar(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${ar(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return ar(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}};U();var Ni=class extends Ht{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function mn(s,e){let t;if(De(s)||s===null)return e;if(s instanceof Ht)return s;if(Zm(s)){let r=s.toLowerCase();return r==="default"?e:r==="local"||r==="system"?Tn.instance:r==="utc"||r==="gmt"?ct.utcInstance:ct.parseSpecifier(r)||Ct.create(s)}else return On(s)?ct.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new Ni(s)}var Ym=()=>Date.now(),Qm="system",Xm=null,eg=null,tg=null,ng=60,rg,Qe=class{static get now(){return Ym}static set now(e){Ym=e}static set defaultZone(e){Qm=e}static get defaultZone(){return mn(Qm,Tn.instance)}static get defaultLocale(){return Xm}static set defaultLocale(e){Xm=e}static get defaultNumberingSystem(){return eg}static set defaultNumberingSystem(e){eg=e}static get defaultOutputCalendar(){return tg}static set defaultOutputCalendar(e){tg=e}static get twoDigitCutoffYear(){return ng}static set twoDigitCutoffYear(e){ng=e%100}static get throwOnInvalid(){return rg}static set throwOnInvalid(e){rg=e}static resetCaches(){Ke.resetCache(),Ct.resetCache()}};function De(s){return typeof s=="undefined"}function On(s){return typeof s=="number"}function ns(s){return typeof s=="number"&&s%1===0}function Zm(s){return typeof s=="string"}function ig(s){return Object.prototype.toString.call(s)==="[object Date]"}function qa(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function og(s){return Array.isArray(s)?s:[s]}function Vc(s,e,t){if(s.length!==0)return s.reduce((r,i)=>{let a=[e(i),i];return r&&t(r[0],a[0])===r[0]?r:a},null)[1]}function sg(s,e){return e.reduce((t,r)=>(t[r]=s[r],t),{})}function ur(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function wn(s,e,t){return ns(s)&&s>=e&&s<=t}function QO(s,e){return s-e*Math.floor(s/e)}function lt(s,e=2){let t=s<0,r;return t?r="-"+(""+-s).padStart(e,"0"):r=(""+s).padStart(e,"0"),r}function Wn(s){if(!(De(s)||s===null||s===""))return parseInt(s,10)}function lr(s){if(!(De(s)||s===null||s===""))return parseFloat(s)}function rs(s){if(!(De(s)||s===null||s==="")){let e=parseFloat("0."+s)*1e3;return Math.floor(e)}}function Di(s,e,t=!1){let r=zh(10,e);return(t?Math.trunc:Math.round)(s*r)/r}function Kr(s){return s%4===0&&(s%100!==0||s%400===0)}function Jr(s){return Kr(s)?366:365}function Fi(s,e){let t=QO(e-1,12)+1,r=s+(e-t)/12;return t===2?Kr(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function Li(s){let e=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(e=new Date(e),e.setUTCFullYear(s.year,s.month-1,s.day)),+e}function Ui(s){let e=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,t=s-1,r=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||r===3?53:52}function is(s){return s>99?s:s>Qe.twoDigitCutoffYear?1900+s:2e3+s}function Va(s,e,t,r=null){let i=new Date(s),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(a.timeZone=r);let u=fe({timeZoneName:e},a),l=new Intl.DateTimeFormat(t,u).formatToParts(i).find(f=>f.type.toLowerCase()==="timezonename");return l?l.value:null}function jr(s,e){let t=parseInt(s,10);Number.isNaN(t)&&(t=0);let r=parseInt(e,10)||0,i=t<0||Object.is(t,-0)?-r:r;return t*60+i}function jc(s){let e=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(e))throw new Rt(`Invalid unit value ${s}`);return e}function Bi(s,e){let t={};for(let r in s)if(ur(s,r)){let i=s[r];if(i==null)continue;t[e(r)]=jc(i)}return t}function ar(s,e){let t=Math.trunc(Math.abs(s/60)),r=Math.trunc(Math.abs(s%60)),i=s>=0?"+":"-";switch(e){case"short":return`${i}${lt(t,2)}:${lt(r,2)}`;case"narrow":return`${i}${t}${r>0?`:${r}`:""}`;case"techie":return`${i}${lt(t,2)}${lt(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function os(s){return sg(s,["hour","minute","second","millisecond"])}var XO=["January","February","March","April","May","June","July","August","September","October","November","December"],Kc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e1=["J","F","M","A","M","J","J","A","S","O","N","D"];function kc(s){switch(s){case"narrow":return[...e1];case"short":return[...Kc];case"long":return[...XO];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var Jc=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],qc=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],t1=["M","T","W","T","F","S","S"];function $c(s){switch(s){case"narrow":return[...t1];case"short":return[...qc];case"long":return[...Jc];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Hc=["AM","PM"],n1=["Before Christ","Anno Domini"],r1=["BC","AD"],i1=["B","A"];function Gc(s){switch(s){case"narrow":return[...i1];case"short":return[...r1];case"long":return[...n1];default:return null}}function ag(s){return Hc[s.hour<12?0:1]}function ug(s,e){return $c(e)[s.weekday-1]}function lg(s,e){return kc(e)[s.month-1]}function cg(s,e){return Gc(e)[s.year<0?0:1]}function qm(s,e,t="always",r=!1){let i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(s)===-1;if(t==="auto"&&a){let C=s==="days";switch(e){case 1:return C?"tomorrow":`next ${i[s][0]}`;case-1:return C?"yesterday":`last ${i[s][0]}`;case 0:return C?"today":`this ${i[s][0]}`;default:}}let u=Object.is(e,-0)||e<0,l=Math.abs(e),f=l===1,m=i[s],b=r?f?m[1]:m[2]||m[1]:f?i[s][0]:s;return u?`${l} ${b} ago`:`in ${l} ${b}`}function fg(s,e){let t="";for(let r of s)r.literal?t+=r.val:t+=e(r.val);return t}var o1={D:sr,DD:Fo,DDD:Uo,DDDD:Bo,t:ko,tt:$o,ttt:Ho,tttt:Go,T:Wo,TT:zo,TTT:Vo,TTTT:jo,f:Ko,ff:qo,fff:Yo,ffff:Xo,F:Jo,FF:Zo,FFF:Qo,FFFF:es},ft=class{static create(e,t={}){return new ft(e,t)}static parseFormat(e){let t=null,r="",i=!1,a=[];for(let u=0;u<e.length;u++){let l=e.charAt(u);l==="'"?(r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),t=null,r="",i=!i):i||l===t?r+=l:(r.length>0&&a.push({literal:/^\s+$/.test(r),val:r}),r=l,t=l)}return r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),a}static macroTokenToFormatOpts(e){return o1[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,fe(fe({},this.opts),t)).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,fe(fe({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return lt(e,t);let r=fe({},this.opts);return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){let r=this.loc.listingMode()==="en",i=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(E,w)=>this.loc.extract(e,E,w),u=E=>e.isOffsetFixed&&e.offset===0&&E.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,E.format):"",l=()=>r?ag(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(E,w)=>r?lg(e,E):a(w?{month:E}:{month:E,day:"numeric"},"month"),m=(E,w)=>r?ug(e,E):a(w?{weekday:E}:{weekday:E,month:"long",day:"numeric"},"weekday"),b=E=>{let w=ft.macroTokenToFormatOpts(E);return w?this.formatWithSystemDefault(e,w):E},C=E=>r?cg(e,E):a({era:E},"era"),h=E=>{switch(E){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return u({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return u({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return u({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return l();case"d":return i?a({day:"numeric"},"day"):this.num(e.day);case"dd":return i?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return i?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return i?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return i?a({month:"numeric"},"month"):this.num(e.month);case"MM":return i?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return i?a({year:"numeric"},"year"):this.num(e.year);case"yy":return i?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return i?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return i?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return C("short");case"GG":return C("long");case"GGGGG":return C("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return b(E)}};return fg(ft.parseFormat(t),h)}formatDurationFromString(e,t){let r=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},i=f=>m=>{let b=r(m);return b?this.num(f.get(b),m.length):m},a=ft.parseFormat(t),u=a.reduce((f,{literal:m,val:b})=>m?f:f.concat(b),[]),l=e.shiftTo(...u.map(r).filter(f=>f));return fg(a,i(l))}};U();var xt=class{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};U();var hg=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function $i(...s){let e=s.reduce((t,r)=>t+r.source,"");return RegExp(`^${e}$`)}function Hi(...s){return e=>s.reduce(([t,r,i],a)=>{let[u,l,f]=a(e,i);return[fe(fe({},t),u),l||r,f]},[{},null,1]).slice(0,2)}function Gi(s,...e){if(s==null)return[null,null];for(let[t,r]of e){let i=t.exec(s);if(i)return r(i)}return[null,null]}function pg(...s){return(e,t)=>{let r={},i;for(i=0;i<s.length;i++)r[s[i]]=Wn(e[t+i]);return[r,null,t+i]}}var mg=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,s1=`(?:${mg.source}?(?:\\[(${hg.source})\\])?)?`,Zc=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,gg=RegExp(`${Zc.source}${s1}`),Yc=RegExp(`(?:T${gg.source})?`),a1=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,u1=/(\d{4})-?W(\d\d)(?:-?(\d))?/,l1=/(\d{4})-?(\d{3})/,c1=pg("weekYear","weekNumber","weekDay"),f1=pg("year","ordinal"),d1=/(\d{4})-(\d\d)-(\d\d)/,vg=RegExp(`${Zc.source} ?(?:${mg.source}|(${hg.source}))?`),h1=RegExp(`(?: ${vg.source})?`);function ki(s,e,t){let r=s[e];return De(r)?t:Wn(r)}function p1(s,e){return[{year:ki(s,e),month:ki(s,e+1,1),day:ki(s,e+2,1)},null,e+3]}function Wi(s,e){return[{hours:ki(s,e,0),minutes:ki(s,e+1,0),seconds:ki(s,e+2,0),milliseconds:rs(s[e+3])},null,e+4]}function ss(s,e){let t=!s[e]&&!s[e+1],r=jr(s[e+1],s[e+2]),i=t?null:ct.instance(r);return[{},i,e+3]}function as(s,e){let t=s[e]?Ct.create(s[e]):null;return[{},t,e+1]}var m1=RegExp(`^T?${Zc.source}$`),g1=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function v1(s){let[e,t,r,i,a,u,l,f,m]=s,b=e[0]==="-",C=f&&f[0]==="-",h=(E,w=!1)=>E!==void 0&&(w||E&&b)?-E:E;return[{years:h(lr(t)),months:h(lr(r)),weeks:h(lr(i)),days:h(lr(a)),hours:h(lr(u)),minutes:h(lr(l)),seconds:h(lr(f),f==="-0"),milliseconds:h(rs(m),C)}]}var y1={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Qc(s,e,t,r,i,a,u){let l={year:e.length===2?is(Wn(e)):Wn(e),month:Kc.indexOf(t)+1,day:Wn(r),hour:Wn(i),minute:Wn(a)};return u&&(l.second=Wn(u)),s&&(l.weekday=s.length>3?Jc.indexOf(s)+1:qc.indexOf(s)+1),l}var b1=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function E1(s){let[,e,t,r,i,a,u,l,f,m,b,C]=s,h=Qc(e,i,r,t,a,u,l),E;return f?E=y1[f]:m?E=0:E=jr(b,C),[h,new ct(E)]}function A1(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var C1=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,S1=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,T1=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function dg(s){let[,e,t,r,i,a,u,l]=s;return[Qc(e,i,r,t,a,u,l),ct.utcInstance]}function O1(s){let[,e,t,r,i,a,u,l]=s;return[Qc(e,l,t,r,i,a,u),ct.utcInstance]}var w1=$i(a1,Yc),I1=$i(u1,Yc),R1=$i(l1,Yc),x1=$i(gg),yg=Hi(p1,Wi,ss,as),M1=Hi(c1,Wi,ss,as),_1=Hi(f1,Wi,ss,as),P1=Hi(Wi,ss,as);function bg(s){return Gi(s,[w1,yg],[I1,M1],[R1,_1],[x1,P1])}function Eg(s){return Gi(A1(s),[b1,E1])}function Ag(s){return Gi(s,[C1,dg],[S1,dg],[T1,O1])}function Cg(s){return Gi(s,[g1,v1])}var L1=Hi(Wi);function Sg(s){return Gi(s,[m1,L1])}var D1=$i(d1,h1),N1=$i(vg),F1=Hi(Wi,ss,as);function Tg(s){return Gi(s,[D1,yg],[N1,F1])}var Og="Invalid Duration",Ig={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},U1=fe({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Ig),on=146097/400,zi=146097/4800,B1=fe({years:{quarters:4,months:12,weeks:on/7,days:on,hours:on*24,minutes:on*24*60,seconds:on*24*60*60,milliseconds:on*24*60*60*1e3},quarters:{months:3,weeks:on/28,days:on/4,hours:on*24/4,minutes:on*24*60/4,seconds:on*24*60*60/4,milliseconds:on*24*60*60*1e3/4},months:{weeks:zi/7,days:zi,hours:zi*24,minutes:zi*24*60,seconds:zi*24*60*60,milliseconds:zi*24*60*60*1e3}},Ig),qr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],k1=qr.slice(0).reverse();function cr(s,e,t=!1){let r={values:t?e.values:fe(fe({},s.values),e.values||{}),loc:s.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||s.conversionAccuracy,matrix:e.matrix||s.matrix};return new Ue(r)}function Rg(s,e){var r;let t=(r=e.milliseconds)!=null?r:0;for(let i of k1.slice(1))e[i]&&(t+=e[i]*s[i].milliseconds);return t}function wg(s,e){let t=Rg(s,e)<0?-1:1;qr.reduceRight((r,i)=>{if(De(e[i]))return r;if(r){let a=e[r]*t,u=s[i][r],l=Math.floor(a/u);e[i]+=l*t,e[r]-=l*u*t}return i},null),qr.reduce((r,i)=>{if(De(e[i]))return r;if(r){let a=e[r]%1;e[r]-=a,e[i]+=a*s[r][i]}return i},null)}function $1(s){let e={};for(let[t,r]of Object.entries(s))r!==0&&(e[t]=r);return e}var Ue=class{constructor(e){let t=e.conversionAccuracy==="longterm"||!1,r=t?B1:U1;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Ke.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,t){return Ue.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new Rt(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ue({values:Bi(e,Ue.normalizeUnit),loc:Ke.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(On(e))return Ue.fromMillis(e);if(Ue.isDuration(e))return e;if(typeof e=="object")return Ue.fromObject(e);throw new Rt(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){let[r]=Cg(e);return r?Ue.fromObject(r,t):Ue.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){let[r]=Sg(e);return r?Ue.fromObject(r,t):Ue.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Rt("need to specify a reason the Duration is invalid");let r=e instanceof xt?e:new xt(e,t);if(Qe.throwOnInvalid)throw new Wa(r);return new Ue({invalid:r})}static normalizeUnit(e){let t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new Pi(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){let r=Ve(fe({},t),{floor:t.round!==!1&&t.floor!==!1});return this.isValid?ft.create(this.loc,r).formatDurationFromString(this,e):Og}toHuman(e={}){if(!this.isValid)return Og;let t=qr.map(r=>{let i=this.values[r];return De(i)?null:this.loc.numberFormatter(Ve(fe({style:"unit",unitDisplay:"long"},e),{unit:r.slice(0,-1)})).format(i)}).filter(r=>r);return this.loc.listFormatter(fe({type:"conjunction",style:e.listStyle||"narrow"},e)).format(t)}toObject(){return this.isValid?fe({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Di(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let t=this.toMillis();return t<0||t>=864e5?null:(e=Ve(fe({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{includeOffset:!1}),Ce.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Rg(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e),r={};for(let i of qr)(ur(t.values,i)||ur(this.values,i))&&(r[i]=t.get(i)+this.get(i));return cr(this,{values:r},!0)}minus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;let t={};for(let r of Object.keys(this.values))t[r]=jc(e(this.values[r],r));return cr(this,{values:t},!0)}get(e){return this[Ue.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let t=fe(fe({},this.values),Bi(e,Ue.normalizeUnit));return cr(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:r,matrix:i}={}){let u={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:i,conversionAccuracy:r};return cr(this,u)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return wg(this.matrix,e),cr(this,{values:e},!0)}rescale(){if(!this.isValid)return this;let e=$1(this.normalize().shiftToAll().toObject());return cr(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(u=>Ue.normalizeUnit(u));let t={},r={},i=this.toObject(),a;for(let u of qr)if(e.indexOf(u)>=0){a=u;let l=0;for(let m in r)l+=this.matrix[m][u]*r[m],r[m]=0;On(i[u])&&(l+=i[u]);let f=Math.trunc(l);t[u]=f,r[u]=(l*1e3-f*1e3)/1e3}else On(i[u])&&(r[u]=i[u]);for(let u in r)r[u]!==0&&(t[a]+=u===a?r[u]:r[u]/this.matrix[a][u]);return wg(this.matrix,t),cr(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return cr(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(r,i){return r===void 0||r===0?i===void 0||i===0:r===i}for(let r of qr)if(!t(this.values[r],e.values[r]))return!1;return!0}};U();var Vi="Invalid Interval";function H1(s,e){return!s||!s.isValid?nt.invalid("missing or invalid start"):!e||!e.isValid?nt.invalid("missing or invalid end"):e<s?nt.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${e.toISO()}`):null}var nt=class{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Rt("need to specify a reason the Interval is invalid");let r=e instanceof xt?e:new xt(e,t);if(Qe.throwOnInvalid)throw new Ga(r);return new nt({invalid:r})}static fromDateTimes(e,t){let r=ji(e),i=ji(t),a=H1(r,i);return a==null?new nt({start:r,end:i}):a}static after(e,t){let r=Ue.fromDurationLike(t),i=ji(e);return nt.fromDateTimes(i,i.plus(r))}static before(e,t){let r=Ue.fromDurationLike(t),i=ji(e);return nt.fromDateTimes(i.minus(r),i)}static fromISO(e,t){let[r,i]=(e||"").split("/",2);if(r&&i){let a,u;try{a=Ce.fromISO(r,t),u=a.isValid}catch(m){u=!1}let l,f;try{l=Ce.fromISO(i,t),f=l.isValid}catch(m){f=!1}if(u&&f)return nt.fromDateTimes(a,l);if(u){let m=Ue.fromISO(i,t);if(m.isValid)return nt.after(a,m)}else if(f){let m=Ue.fromISO(r,t);if(m.isValid)return nt.before(l,m)}}return nt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let t=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(t,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?nt.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];let t=e.map(ji).filter(u=>this.contains(u)).sort(),r=[],{s:i}=this,a=0;for(;i<this.e;){let u=t[a]||this.e,l=+u>+this.e?this.e:u;r.push(nt.fromDateTimes(i,l)),i=l,a+=1}return r}splitBy(e){let t=Ue.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:r}=this,i=1,a,u=[];for(;r<this.e;){let l=this.start.plus(t.mapUnits(f=>f*i));a=+l>+this.e?this.e:l,u.push(nt.fromDateTimes(r,a)),r=a,i+=1}return u}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let t=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return t>=r?null:nt.fromDateTimes(t,r)}union(e){if(!this.isValid)return this;let t=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return nt.fromDateTimes(t,r)}static merge(e){let[t,r]=e.sort((i,a)=>i.s-a.s).reduce(([i,a],u)=>a?a.overlaps(u)||a.abutsStart(u)?[i,a.union(u)]:[i.concat([a]),u]:[i,u],[[],null]);return r&&t.push(r),t}static xor(e){let t=null,r=0,i=[],a=e.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),u=Array.prototype.concat(...a),l=u.sort((f,m)=>f.time-m.time);for(let f of l)r+=f.type==="s"?1:-1,r===1?t=f.time:(t&&+t!=+f.time&&i.push(nt.fromDateTimes(t,f.time)),t=null);return nt.merge(i)}difference(...e){return nt.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Vi}toLocaleString(e=sr,t={}){return this.isValid?ft.create(this.s.loc.clone(t),e).formatInterval(this):Vi}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Vi}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Vi}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Vi}toFormat(e,{separator:t=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Vi}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Ue.invalid(this.invalidReason)}mapEndpoints(e){return nt.fromDateTimes(e(this.s),e(this.e))}};U();var zn=class{static hasDST(e=Qe.defaultZone){let t=Ce.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Ct.isValidZone(e)}static normalizeZone(e){return mn(e,Qe.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Ke.create(t,r,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Ke.create(t,r,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Ke.create(t,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Ke.create(t,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Ke.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Ke.create(t,null,"gregory").eras(e)}static features(){return{relative:qa()}}};U();function xg(s,e){let t=i=>i.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=t(e)-t(s);return Math.floor(Ue.fromMillis(r).as("days"))}function G1(s,e,t){let r=[["years",(f,m)=>m.year-f.year],["quarters",(f,m)=>m.quarter-f.quarter+(m.year-f.year)*4],["months",(f,m)=>m.month-f.month+(m.year-f.year)*12],["weeks",(f,m)=>{let b=xg(f,m);return(b-b%7)/7}],["days",xg]],i={},a=s,u,l;for(let[f,m]of r)t.indexOf(f)>=0&&(u=f,i[f]=m(s,e),l=a.plus(i),l>e?(i[f]--,s=a.plus(i),s>e&&(l=s,i[f]--,s=a.plus(i))):s=l);return[s,i,l,u]}function Mg(s,e,t,r){let[i,a,u,l]=G1(s,e,t),f=e-i,m=t.filter(C=>["hours","minutes","seconds","milliseconds"].indexOf(C)>=0);m.length===0&&(u<e&&(u=i.plus({[l]:1})),u!==i&&(a[l]=(a[l]||0)+f/(u-i)));let b=Ue.fromObject(a,r);return m.length>0?Ue.fromMillis(f,r).shiftTo(...m).plus(b):b}U();U();var Xc={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},_g={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},W1=Xc.hanidec.replace(/[\[|\]]/g,"").split("");function Pg(s){let e=parseInt(s,10);if(isNaN(e)){e="";for(let t=0;t<s.length;t++){let r=s.charCodeAt(t);if(s[t].search(Xc.hanidec)!==-1)e+=W1.indexOf(s[t]);else for(let i in _g){let[a,u]=_g[i];r>=a&&r<=u&&(e+=r-a)}}return parseInt(e,10)}else return e}function sn({numberingSystem:s},e=""){return new RegExp(`${Xc[s||"latn"]}${e}`)}var z1="missing Intl.DateTimeFormat.formatToParts support";function qe(s,e=t=>t){return{regex:s,deser:([t])=>e(Pg(t))}}var V1=String.fromCharCode(160),Ng=`[ ${V1}]`,Fg=new RegExp(Ng,"g");function j1(s){return s.replace(/\./g,"\\.?").replace(Fg,Ng)}function Lg(s){return s.replace(/\./g,"").replace(Fg," ").toLowerCase()}function gn(s,e){return s===null?null:{regex:RegExp(s.map(j1).join("|")),deser:([t])=>s.findIndex(r=>Lg(t)===Lg(r))+e}}function Dg(s,e){return{regex:s,deser:([,t,r])=>jr(t,r),groups:e}}function Za(s){return{regex:s,deser:([e])=>e}}function K1(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function J1(s,e){let t=sn(e),r=sn(e,"{2}"),i=sn(e,"{3}"),a=sn(e,"{4}"),u=sn(e,"{6}"),l=sn(e,"{1,2}"),f=sn(e,"{1,3}"),m=sn(e,"{1,6}"),b=sn(e,"{1,9}"),C=sn(e,"{2,4}"),h=sn(e,"{4,6}"),E=S=>({regex:RegExp(K1(S.val)),deser:([T])=>T,literal:!0}),I=(S=>{if(s.literal)return E(S);switch(S.val){case"G":return gn(e.eras("short"),0);case"GG":return gn(e.eras("long"),0);case"y":return qe(m);case"yy":return qe(C,is);case"yyyy":return qe(a);case"yyyyy":return qe(h);case"yyyyyy":return qe(u);case"M":return qe(l);case"MM":return qe(r);case"MMM":return gn(e.months("short",!0),1);case"MMMM":return gn(e.months("long",!0),1);case"L":return qe(l);case"LL":return qe(r);case"LLL":return gn(e.months("short",!1),1);case"LLLL":return gn(e.months("long",!1),1);case"d":return qe(l);case"dd":return qe(r);case"o":return qe(f);case"ooo":return qe(i);case"HH":return qe(r);case"H":return qe(l);case"hh":return qe(r);case"h":return qe(l);case"mm":return qe(r);case"m":return qe(l);case"q":return qe(l);case"qq":return qe(r);case"s":return qe(l);case"ss":return qe(r);case"S":return qe(f);case"SSS":return qe(i);case"u":return Za(b);case"uu":return Za(l);case"uuu":return qe(t);case"a":return gn(e.meridiems(),0);case"kkkk":return qe(a);case"kk":return qe(C,is);case"W":return qe(l);case"WW":return qe(r);case"E":case"c":return qe(t);case"EEE":return gn(e.weekdays("short",!1),1);case"EEEE":return gn(e.weekdays("long",!1),1);case"ccc":return gn(e.weekdays("short",!0),1);case"cccc":return gn(e.weekdays("long",!0),1);case"Z":case"ZZ":return Dg(new RegExp(`([+-]${l.source})(?::(${r.source}))?`),2);case"ZZZ":return Dg(new RegExp(`([+-]${l.source})(${r.source})?`),2);case"z":return Za(/[a-z_+-/]{1,256}?/i);case" ":return Za(/[^\S\n\r]/);default:return E(S)}})(s)||{invalidReason:z1};return I.token=s,I}var q1={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Z1(s,e,t){let{type:r,value:i}=s;if(r==="literal"){let f=/^\s+$/.test(i);return{literal:!f,val:f?" ":i}}let a=e[r],u=r;r==="hour"&&(e.hour12!=null?u=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?u="hour12":u="hour24":u=t.hour12?"hour12":"hour24");let l=q1[u];if(typeof l=="object"&&(l=l[a]),l)return{literal:!1,val:l}}function Y1(s){return[`^${s.map(t=>t.regex).reduce((t,r)=>`${t}(${r.source})`,"")}$`,s]}function Q1(s,e,t){let r=s.match(e);if(r){let i={},a=1;for(let u in t)if(ur(t,u)){let l=t[u],f=l.groups?l.groups+1:1;!l.literal&&l.token&&(i[l.token.val[0]]=l.deser(r.slice(a,a+f))),a+=f}return[r,i]}else return[r,{}]}function X1(s){let e=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},t=null,r;return De(s.z)||(t=Ct.create(s.z)),De(s.Z)||(t||(t=new ct(s.Z)),r=s.Z),De(s.q)||(s.M=(s.q-1)*3+1),De(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),De(s.u)||(s.S=rs(s.u)),[Object.keys(s).reduce((a,u)=>{let l=e(u);return l&&(a[l]=s[u]),a},{}),t,r]}var ef=null;function ew(){return ef||(ef=Ce.fromMillis(1555555555555)),ef}function tw(s,e){if(s.literal)return s;let t=ft.macroTokenToFormatOpts(s.val),r=rf(t,e);return r==null||r.includes(void 0)?s:r}function tf(s,e){return Array.prototype.concat(...s.map(t=>tw(t,e)))}function nf(s,e,t){let r=tf(ft.parseFormat(t),s),i=r.map(u=>J1(u,s)),a=i.find(u=>u.invalidReason);if(a)return{input:e,tokens:r,invalidReason:a.invalidReason};{let[u,l]=Y1(i),f=RegExp(u,"i"),[m,b]=Q1(e,f,l),[C,h,E]=b?X1(b):[null,null,void 0];if(ur(b,"a")&&ur(b,"H"))throw new Gn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:f,rawMatches:m,matches:b,result:C,zone:h,specificOffset:E}}}function Ug(s,e,t){let{result:r,zone:i,specificOffset:a,invalidReason:u}=nf(s,e,t);return[r,i,a,u]}function rf(s,e){if(!s)return null;let r=ft.create(e,s).dtFormatter(ew()),i=r.formatToParts(),a=r.resolvedOptions();return i.map(u=>Z1(u,s,a))}U();var Bg=[0,31,59,90,120,151,181,212,243,273,304,334],kg=[0,31,60,91,121,152,182,213,244,274,305,335];function an(s,e){return new xt("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${s}, which is invalid`)}function $g(s,e,t){let r=new Date(Date.UTC(s,e-1,t));s<100&&s>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);let i=r.getUTCDay();return i===0?7:i}function Hg(s,e,t){return t+(Kr(s)?kg:Bg)[e-1]}function Gg(s,e){let t=Kr(s)?kg:Bg,r=t.findIndex(a=>a<e),i=e-t[r];return{month:r+1,day:i}}function Ya(s){let{year:e,month:t,day:r}=s,i=Hg(e,t,r),a=$g(e,t,r),u=Math.floor((i-a+10)/7),l;return u<1?(l=e-1,u=Ui(l)):u>Ui(e)?(l=e+1,u=1):l=e,fe({weekYear:l,weekNumber:u,weekday:a},os(s))}function of(s){let{weekYear:e,weekNumber:t,weekday:r}=s,i=$g(e,1,4),a=Jr(e),u=t*7+r-i-3,l;u<1?(l=e-1,u+=Jr(l)):u>a?(l=e+1,u-=Jr(e)):l=e;let{month:f,day:m}=Gg(l,u);return fe({year:l,month:f,day:m},os(s))}function Qa(s){let{year:e,month:t,day:r}=s,i=Hg(e,t,r);return fe({year:e,ordinal:i},os(s))}function sf(s){let{year:e,ordinal:t}=s,{month:r,day:i}=Gg(e,t);return fe({year:e,month:r,day:i},os(s))}function Wg(s){let e=ns(s.weekYear),t=wn(s.weekNumber,1,Ui(s.weekYear)),r=wn(s.weekday,1,7);return e?t?r?!1:an("weekday",s.weekday):an("week",s.week):an("weekYear",s.weekYear)}function zg(s){let e=ns(s.year),t=wn(s.ordinal,1,Jr(s.year));return e?t?!1:an("ordinal",s.ordinal):an("year",s.year)}function af(s){let e=ns(s.year),t=wn(s.month,1,12),r=wn(s.day,1,Fi(s.year,s.month));return e?t?r?!1:an("day",s.day):an("month",s.month):an("year",s.year)}function uf(s){let{hour:e,minute:t,second:r,millisecond:i}=s,a=wn(e,0,23)||e===24&&t===0&&r===0&&i===0,u=wn(t,0,59),l=wn(r,0,59),f=wn(i,0,999);return a?u?l?f?!1:an("millisecond",i):an("second",r):an("minute",t):an("hour",e)}var lf="Invalid DateTime",Vg=864e13;function Xa(s){return new xt("unsupported zone",`the zone "${s.name}" is not supported`)}function cf(s){return s.weekData===null&&(s.weekData=Ya(s.c)),s.weekData}function Zr(s,e){let t={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Ce(Ve(fe(fe({},t),e),{old:t}))}function Qg(s,e,t){let r=s-e*60*1e3,i=t.offset(r);if(e===i)return[r,e];r-=(i-e)*60*1e3;let a=t.offset(r);return i===a?[r,i]:[s-Math.min(i,a)*60*1e3,Math.max(i,a)]}function eu(s,e){s+=e*60*1e3;let t=new Date(s);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function nu(s,e,t){return Qg(Li(s),e,t)}function jg(s,e){let t=s.o,r=s.c.year+Math.trunc(e.years),i=s.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,a=Ve(fe({},s.c),{year:r,month:i,day:Math.min(s.c.day,Fi(r,i))+Math.trunc(e.days)+Math.trunc(e.weeks)*7}),u=Ue.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),l=Li(a),[f,m]=Qg(l,t,s.zone);return u!==0&&(f+=u,m=s.zone.offset(f)),{ts:f,o:m}}function us(s,e,t,r,i,a){let{setZone:u,zone:l}=t;if(s&&Object.keys(s).length!==0||e){let f=e||l,m=Ce.fromObject(s,Ve(fe({},t),{zone:f,specificOffset:a}));return u?m:m.setZone(l)}else return Ce.invalid(new xt("unparsable",`the input "${i}" can't be parsed as ${r}`))}function tu(s,e,t=!0){return s.isValid?ft.create(Ke.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(s,e):null}function ff(s,e){let t=s.c.year>9999||s.c.year<0,r="";return t&&s.c.year>=0&&(r+="+"),r+=lt(s.c.year,t?6:4),e?(r+="-",r+=lt(s.c.month),r+="-",r+=lt(s.c.day)):(r+=lt(s.c.month),r+=lt(s.c.day)),r}function Kg(s,e,t,r,i,a){let u=lt(s.c.hour);return e?(u+=":",u+=lt(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(u+=":")):u+=lt(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(u+=lt(s.c.second),(s.c.millisecond!==0||!r)&&(u+=".",u+=lt(s.c.millisecond,3))),i&&(s.isOffsetFixed&&s.offset===0&&!a?u+="Z":s.o<0?(u+="-",u+=lt(Math.trunc(-s.o/60)),u+=":",u+=lt(Math.trunc(-s.o%60))):(u+="+",u+=lt(Math.trunc(s.o/60)),u+=":",u+=lt(Math.trunc(s.o%60)))),a&&(u+="["+s.zone.ianaName+"]"),u}var Xg={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},nw={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},rw={ordinal:1,hour:0,minute:0,second:0,millisecond:0},ev=["year","month","day","hour","minute","second","millisecond"],iw=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ow=["year","ordinal","hour","minute","second","millisecond"];function Jg(s){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!e)throw new Pi(s);return e}function qg(s,e){let t=mn(e.zone,Qe.defaultZone),r=Ke.fromObject(e),i=Qe.now(),a,u;if(De(s.year))a=i;else{for(let m of ev)De(s[m])&&(s[m]=Xg[m]);let l=af(s)||uf(s);if(l)return Ce.invalid(l);let f=t.offset(i);[a,u]=nu(s,f,t)}return new Ce({ts:a,zone:t,loc:r,o:u})}function Zg(s,e,t){let r=De(t.round)?!0:t.round,i=(u,l)=>(u=Di(u,r||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(u,l)),a=u=>t.calendary?e.hasSame(s,u)?0:e.startOf(u).diff(s.startOf(u),u).get(u):e.diff(s,u).get(u);if(t.unit)return i(a(t.unit),t.unit);for(let u of t.units){let l=a(u);if(Math.abs(l)>=1)return i(l,u)}return i(s>e?-0:0,t.units[t.units.length-1])}function Yg(s){let e={},t;return s.length>0&&typeof s[s.length-1]=="object"?(e=s[s.length-1],t=Array.from(s).slice(0,s.length-1)):t=Array.from(s),[e,t]}var Ce=class{constructor(e){let t=e.zone||Qe.defaultZone,r=e.invalid||(Number.isNaN(e.ts)?new xt("invalid input"):null)||(t.isValid?null:Xa(t));this.ts=De(e.ts)?Qe.now():e.ts;let i=null,a=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[i,a]=[e.old.c,e.old.o];else{let l=t.offset(this.ts);i=eu(this.ts,l),r=Number.isNaN(i.year)?new xt("invalid input"):null,i=r?null:i,a=r?null:l}this._zone=t,this.loc=e.loc||Ke.create(),this.invalid=r,this.weekData=null,this.c=i,this.o=a,this.isLuxonDateTime=!0}static now(){return new Ce({})}static local(){let[e,t]=Yg(arguments),[r,i,a,u,l,f,m]=t;return qg({year:r,month:i,day:a,hour:u,minute:l,second:f,millisecond:m},e)}static utc(){let[e,t]=Yg(arguments),[r,i,a,u,l,f,m]=t;return e.zone=ct.utcInstance,qg({year:r,month:i,day:a,hour:u,minute:l,second:f,millisecond:m},e)}static fromJSDate(e,t={}){let r=ig(e)?e.valueOf():NaN;if(Number.isNaN(r))return Ce.invalid("invalid input");let i=mn(t.zone,Qe.defaultZone);return i.isValid?new Ce({ts:r,zone:i,loc:Ke.fromObject(t)}):Ce.invalid(Xa(i))}static fromMillis(e,t={}){if(On(e))return e<-Vg||e>Vg?Ce.invalid("Timestamp out of range"):new Ce({ts:e,zone:mn(t.zone,Qe.defaultZone),loc:Ke.fromObject(t)});throw new Rt(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(On(e))return new Ce({ts:e*1e3,zone:mn(t.zone,Qe.defaultZone),loc:Ke.fromObject(t)});throw new Rt("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};let r=mn(t.zone,Qe.defaultZone);if(!r.isValid)return Ce.invalid(Xa(r));let i=Qe.now(),a=De(t.specificOffset)?r.offset(i):t.specificOffset,u=Bi(e,Jg),l=!De(u.ordinal),f=!De(u.year),m=!De(u.month)||!De(u.day),b=f||m,C=u.weekYear||u.weekNumber,h=Ke.fromObject(t);if((b||l)&&C)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&l)throw new Gn("Can't mix ordinal dates with month/day");let E=C||u.weekday&&!b,w,I,S=eu(i,a);E?(w=iw,I=nw,S=Ya(S)):l?(w=ow,I=rw,S=Qa(S)):(w=ev,I=Xg);let T=!1;for(let v of w){let R=u[v];De(R)?T?u[v]=I[v]:u[v]=S[v]:T=!0}let x=E?Wg(u):l?zg(u):af(u),g=x||uf(u);if(g)return Ce.invalid(g);let y=E?of(u):l?sf(u):u,[d,p]=nu(y,a,r),O=new Ce({ts:d,zone:r,o:p,loc:h});return u.weekday&&b&&e.weekday!==O.weekday?Ce.invalid("mismatched weekday",`you can't specify both a weekday of ${u.weekday} and a date of ${O.toISO()}`):O}static fromISO(e,t={}){let[r,i]=bg(e);return us(r,i,t,"ISO 8601",e)}static fromRFC2822(e,t={}){let[r,i]=Eg(e);return us(r,i,t,"RFC 2822",e)}static fromHTTP(e,t={}){let[r,i]=Ag(e);return us(r,i,t,"HTTP",t)}static fromFormat(e,t,r={}){if(De(e)||De(t))throw new Rt("fromFormat requires an input string and a format");let{locale:i=null,numberingSystem:a=null}=r,u=Ke.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0}),[l,f,m,b]=Ug(u,e,t);return b?Ce.invalid(b):us(l,f,r,`format ${t}`,e,m)}static fromString(e,t,r={}){return Ce.fromFormat(e,t,r)}static fromSQL(e,t={}){let[r,i]=Tg(e);return us(r,i,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Rt("need to specify a reason the DateTime is invalid");let r=e instanceof xt?e:new xt(e,t);if(Qe.throwOnInvalid)throw new Ha(r);return new Ce({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){let r=rf(e,Ke.fromObject(t));return r?r.map(i=>i?i.val:null).join(""):null}static expandFormat(e,t={}){return tf(ft.parseFormat(e),Ke.fromObject(t)).map(i=>i.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?cf(this).weekYear:NaN}get weekNumber(){return this.isValid?cf(this).weekNumber:NaN}get weekday(){return this.isValid?cf(this).weekday:NaN}get ordinal(){return this.isValid?Qa(this.c).ordinal:NaN}get monthShort(){return this.isValid?zn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,t=6e4,r=Li(this.c),i=this.zone.offset(r-e),a=this.zone.offset(r+e),u=this.zone.offset(r-i*t),l=this.zone.offset(r-a*t);if(u===l)return[this];let f=r-u*t,m=r-l*t,b=eu(f,u),C=eu(m,l);return b.hour===C.hour&&b.minute===C.minute&&b.second===C.second&&b.millisecond===C.millisecond?[Zr(this,{ts:f}),Zr(this,{ts:m})]:[this]}get isInLeapYear(){return Kr(this.year)}get daysInMonth(){return Fi(this.year,this.month)}get daysInYear(){return this.isValid?Jr(this.year):NaN}get weeksInWeekYear(){return this.isValid?Ui(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:t,numberingSystem:r,calendar:i}=ft.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:r,outputCalendar:i}}toUTC(e=0,t={}){return this.setZone(ct.instance(e),t)}toLocal(){return this.setZone(Qe.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:r=!1}={}){if(e=mn(e,Qe.defaultZone),e.equals(this.zone))return this;if(e.isValid){let i=this.ts;if(t||r){let a=e.offset(this.ts),u=this.toObject();[i]=nu(u,a,e)}return Zr(this,{ts:i,zone:e})}else return Ce.invalid(Xa(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:r}={}){let i=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:r});return Zr(this,{loc:i})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let t=Bi(e,Jg),r=!De(t.weekYear)||!De(t.weekNumber)||!De(t.weekday),i=!De(t.ordinal),a=!De(t.year),u=!De(t.month)||!De(t.day),l=a||u,f=t.weekYear||t.weekNumber;if((l||i)&&f)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&i)throw new Gn("Can't mix ordinal dates with month/day");let m;r?m=of(fe(fe({},Ya(this.c)),t)):De(t.ordinal)?(m=fe(fe({},this.toObject()),t),De(t.day)&&(m.day=Math.min(Fi(m.year,m.month),m.day))):m=sf(fe(fe({},Qa(this.c)),t));let[b,C]=nu(m,this.o,this.zone);return Zr(this,{ts:b,o:C})}plus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e);return Zr(this,jg(this,t))}minus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e).negate();return Zr(this,jg(this,t))}startOf(e){if(!this.isValid)return this;let t={},r=Ue.normalizeUnit(e);switch(r){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break;case"milliseconds":break}if(r==="weeks"&&(t.weekday=1),r==="quarters"){let i=Math.ceil(this.month/3);t.month=(i-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?ft.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):lf}toLocaleString(e=sr,t={}){return this.isValid?ft.create(this.loc.clone(t),e).formatDateTime(this):lf}toLocaleParts(e={}){return this.isValid?ft.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:r=!1,includeOffset:i=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;let u=e==="extended",l=ff(this,u);return l+="T",l+=Kg(this,u,t,r,i,a),l}toISODate({format:e="extended"}={}){return this.isValid?ff(this,e==="extended"):null}toISOWeekDate(){return tu(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:r=!0,includePrefix:i=!1,extendedZone:a=!1,format:u="extended"}={}){return this.isValid?(i?"T":"")+Kg(this,u==="extended",t,e,r,a):null}toRFC2822(){return tu(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return tu(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ff(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:r=!0}={}){let i="HH:mm:ss.SSS";return(t||e)&&(r&&(i+=" "),t?i+="z":e&&(i+="ZZ")),tu(this,i,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():lf}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let t=fe({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ue.invalid("created by diffing an invalid DateTime");let i=fe({locale:this.locale,numberingSystem:this.numberingSystem},r),a=og(t).map(Ue.normalizeUnit),u=e.valueOf()>this.valueOf(),l=u?this:e,f=u?e:this,m=Mg(l,f,a,i);return u?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(Ce.now(),e,t)}until(e){return this.isValid?nt.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;let r=e.valueOf(),i=this.setZone(e.zone,{keepLocalTime:!0});return i.startOf(t)<=r&&r<=i.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let t=e.base||Ce.fromObject({},{zone:this.zone}),r=e.padding?this<t?-e.padding:e.padding:0,i=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(i=e.unit,a=void 0),Zg(t,this.plus(r),Ve(fe({},e),{numeric:"always",units:i,unit:a}))}toRelativeCalendar(e={}){return this.isValid?Zg(e.base||Ce.fromObject({},{zone:this.zone}),this,Ve(fe({},e),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...e){if(!e.every(Ce.isDateTime))throw new Rt("min requires all arguments be DateTimes");return Vc(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(Ce.isDateTime))throw new Rt("max requires all arguments be DateTimes");return Vc(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,r={}){let{locale:i=null,numberingSystem:a=null}=r,u=Ke.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0});return nf(u,e,t)}static fromStringExplain(e,t,r={}){return Ce.fromFormatExplain(e,t,r)}static get DATE_SHORT(){return sr}static get DATE_MED(){return Fo}static get DATE_MED_WITH_WEEKDAY(){return xc}static get DATE_FULL(){return Uo}static get DATE_HUGE(){return Bo}static get TIME_SIMPLE(){return ko}static get TIME_WITH_SECONDS(){return $o}static get TIME_WITH_SHORT_OFFSET(){return Ho}static get TIME_WITH_LONG_OFFSET(){return Go}static get TIME_24_SIMPLE(){return Wo}static get TIME_24_WITH_SECONDS(){return zo}static get TIME_24_WITH_SHORT_OFFSET(){return Vo}static get TIME_24_WITH_LONG_OFFSET(){return jo}static get DATETIME_SHORT(){return Ko}static get DATETIME_SHORT_WITH_SECONDS(){return Jo}static get DATETIME_MED(){return qo}static get DATETIME_MED_WITH_SECONDS(){return Zo}static get DATETIME_MED_WITH_WEEKDAY(){return Mc}static get DATETIME_FULL(){return Yo}static get DATETIME_FULL_WITH_SECONDS(){return Qo}static get DATETIME_HUGE(){return Xo}static get DATETIME_HUGE_WITH_SECONDS(){return es}};function ji(s){if(Ce.isDateTime(s))return s;if(s&&s.valueOf&&On(s.valueOf()))return Ce.fromJSDate(s);if(s&&typeof s=="object")return Ce.fromObject(s);throw new Rt(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var tv=je(Pe),sw=[tv.styles,yc],Yr=class extends tv{constructor(){super();this.updateComment=({detail:t})=>{let{text:r}=t;this.text=r,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,text:r})};this.resolveAnnotation=t=>{t.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly"};this.resolved=!1}render(){var E;let t=this.annotationFilter==="all"?"resolve":"undo",r=w=>Ce.fromISO(w).toFormat("yyyy-dd-MM"),i=this.resolvable?"comment-item__resolve":"hidden",a=[{label:"EDIT"},{label:"DELETE"}],u=({detail:w})=>{w==="EDIT"&&(this.mode="editable"),w==="DELETE"&&(this.deleteCommentModalOpen=!0)},l=()=>{this.text.length<120||(this.expandElipsis=!0)},f=()=>{if(this.mode==="editable")return Ee`
        <superviz-comments-comment-input
          class="comment-item--editable"
          editable
          @click=${w=>w.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{if(this.mode!=="editable")return Ee`
        <span
          id="comment-text"
          @click=${l}
          class="text text-big sv-gray-700 ${h}"
          >${this.text}</span
        >
      `},b=()=>{this.deleteCommentModalOpen=!1},C={"comment-item":!0,reply:!this.primaryComment},h=!this.expandElipsis&&this.text.length>120?"line-clamp":"";return Ee`
      <div class=${yt(C)}>
        <div class="comment-item__user">
          <div class="comment-item__user-details">
            <div class="comment-item__avatar">
              <p class="text text-bold">${((E=this.username[0])==null?void 0:E.toUpperCase())||"A"}</p>
            </div>
            <span class="text text-bold sv-gray-600">${this.username}</span>
            <span class="text text-small sv-gray-500">${r(this.createdAt)}</span>
          </div>
          <div class="comment-item__actions">
            <button
              @click=${this.resolveAnnotation}
              class="icon-button icon-button--clickable icon-button--xsmall ${i}"
            >
              <superviz-icon name=${t} size="md"></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(a)}
              label="label"
              returnTo="label"
              position="bottom-right"
              @selected=${u}
              @click=${w=>w.stopPropagation()}
            >
              <button slot="dropdown" class="icon-button icon-button--clickable icon-button--small">
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comment-item__content">
          <div class="comment-item__content__body">${f()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${b}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};Yr.styles=sw,Yr.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String}},Yr=Ge([We("superviz-comments-comment-item")],Yr);U();var nv=je(Pe),aw=[nv.styles,Ec],Qr=class extends nv{constructor(){super();this.pinCoordinates=null;this.getCommentInput=()=>this.shadowRoot.getElementById("comment-input--textarea");this.getCommentInputContainer=()=>this.shadowRoot.getElementById("comment-input--container");this.getSendBtn=()=>this.shadowRoot.querySelector(".comment-input--send-btn");this.commentInputFocus=({detail:t})=>{this.pinCoordinates=t,this.getCommentInput().focus()};this.sendEnter=t=>{if(t.key!=="Enter"||t.shiftKey)return;let r=this.getCommentInput(),i=r.value.trim();if(!i)return;let a=this.getSendBtn();this.emitEvent(this.eventType,{text:i,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",a.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1})};this.btnActive=!1,this.text=""}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&(window.document.body.addEventListener("comment-input-focus",this.commentInputFocus),this.addEventListener("keyup",this.sendEnter))}disconnectedCallback(){super.disconnectedCallback(),this.eventType==="create-annotation"&&window.document.body.removeEventListener("comment-input-focus",this.commentInputFocus)}updated(t){if(t.has("text")&&this.text.length>0){let r=this.getCommentInput();r.value=this.text,this.updateHeight()}if(t.has("btnActive")){let r=this.getSendBtn();r.disabled=!this.btnActive}}updateHeight(){let t=this.getCommentInput(),r=this.getCommentInputContainer();t.style.height="0px",r.style.height="0px";let i=t.scrollHeight+4,a=t.scrollHeight;t.style.height=`${i}px`,r.style.height=`${a}px`;let u=this.getSendBtn();u.disabled=!(t.value.length>0)}send(t){t.preventDefault();let r=this.getCommentInput(),i=this.getSendBtn(),a=r.value;this.emitEvent(this.eventType,{text:a,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",i.disabled=!0,this.updateHeight()}render(){let t=()=>{if(!!this.editable)return Ee`
        <button
          id="close"
          @click=${()=>this.closeEditMode()}
          class="icon-button icon-button--medium icon-button--clickable"
          @click=${this.send}
        >
          <superviz-icon name="close" size="md"></superviz-icon>
        </button>
        <button id="confirm" class="comment-input--send-btn" disabled @click=${this.send}>
          <superviz-icon name="check" size="md"></superviz-icon>
        </button>
      `},r=()=>{if(!this.editable)return Ee`
        <button class="comment-input--send-btn align-send-btn" disabled @click=${this.send}>
          <superviz-icon name="send" size="sm"></superviz-icon>
        </button>
      `};return Ee`
      <div class="comment-input">
        <div id="comment-input--container">
          <textarea
            id="comment-input--textarea"
            placeholder="Add comment..."
            @input=${this.updateHeight}
          ></textarea>
        </div>
        <div class="sv-hr"></div>
        <div class="comment-input--options">
          <div>
            <button class="icon-button mention">
              <superviz-icon name="mention" size="sm"></superviz-icon>
            </button>
          </div>
          <div class="comment-input-options">
            ${r()} ${t()}
          </div>
        </div>
      </div>
    `}};Qr.styles=aw,Qr.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean}},Qr=Ge([We("superviz-comments-comment-input")],Qr);U();var rv=je(Pe),uw=[rv.styles,Sc],Xr=class extends rv{constructor(){super();this.position={x:0,y:0}}get userInitial(){var r,i,a;return(((a=(i=(r=this.annotation)==null?void 0:r.comments[0])==null?void 0:i.participant)==null?void 0:a.name)||"Anonymous")[0].toUpperCase()}emitClick(){document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:this.annotation.uuid}}))}render(){var r,i;let t={"annotation-pin":!0,"annotation-pin--active":this.active};return this.type==="add"?Ee`
        <div
          class=${yt(t)}
          style=${`top: ${this.position.y}px; left: ${this.position.x}px;`}
        >
          <div class="annotation-pin__avatar annotation-pin__avatar--add">
            <superviz-icon name="add"></superviz-icon>
          </div>
        </div>
      `:Ee`
      <div
        @click=${this.emitClick}
        class=${yt(t)}
        style=${`top: ${(r=this.position)==null?void 0:r.y}px; left: ${(i=this.position)==null?void 0:i.x}px; pointer-events: auto;`}
      >
        <div class="annotation-pin__avatar">
          <p class="text text-bold text-big">${this.userInitial}</p>
          <!-- <img src="https://picsum.photos/200/300" alt="" /> -->
        </div>
      </div>
    `}};Xr.styles=uw,Xr.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean}},Xr=Ge([We("superviz-comments-annotation-pin")],Xr);U();var iv=je(Pe),lw=[iv.styles,Ac],ei=class extends iv{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))};this.resolveAnnotation=({detail:t})=>{let{uuid:r}=this.annotation,{resolved:i,type:a}=t,u=a==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=i,this.emitEvent("resolve-annotation",{uuid:r,resolved:i}),u&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpantedCommentesTemplate=(t,r)=>r===0?Ee``:Ee`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar="https://picsum.photos/200/300"
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
      ></superviz-comments-comment-item>
    `}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHiddenAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{"annotation-item":!0,"annotation-item--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,hidden:!(!this.expandComments&&this.replies>=1)}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,hidden:!(this.isSelected&&this.expandComments)}}firstUpdated(){this.resolved=this.annotation.resolved}updated(t){if(t.has("selected")){let r=this.selected===this.annotation.uuid;this.expandComments=r}}createComment({detail:t}){let{text:r}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,text:r})}generateAvatarCommentsTemplate(){var r,i;let t=[];for(let a=1;a<=this.repliesSize;a++)t.push(Ee`
        <div class="avatar">
          <p class="text text-bold">
            ${((i=(r=this.annotation.comments[a])==null?void 0:r.participant.name[0])==null?void 0:i.toUpperCase())||"A"}
          </p>
        </div>
      `);return Ee`
      ${t}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?Ee`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${yt({hidden:this.filterIsResolved})}
      >
      </superviz-comments-annotation-resolved>
    `:Ee``}render(){var t,r,i,a,u,l;return Ee`
      ${this.annotationResolvedTemplate()}

      <div class=${yt(this.shouldHiddenAnnotation)}>
        <div class=${yt(this.annotationClasses)} @click=${this.selectAnnotation}>
          <div>
            <superviz-comments-comment-item
              uuid=${(t=this.annotation.comments)==null?void 0:t[0].uuid}
              annotationId=${this.annotation.uuid}
              username=${((i=(r=this.annotation.comments)==null?void 0:r[0].participant)==null?void 0:i.name)||"Anonymous"}
              text=${(a=this.annotation.comments)==null?void 0:a[0].text}
              createdAt=${(u=this.annotation.comments)==null?void 0:u[0].createdAt}
              primaryComment
              resolvable
              ?resolved=${this.resolved}
              annotationFilter=${this.annotationFilter}
              @resolve-annotation=${this.resolveAnnotation}
            ></superviz-comments-comment-item>

            <div class=${yt(this.avatarCommentsClasses)}>
              <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
            </div>
          </div>

          <div class=${yt(this.commentsClasses)}>
            ${(l=this.annotation.comments)==null?void 0:l.map(this.generateExpantedCommentesTemplate)}
            <superviz-comments-comment-input
              @create-comment=${this.createComment}
              eventType="create-comment"
              @click=${f=>f.stopPropagation()}
            ></superviz-comments-comment-input>
          </div>
        </div>
        <div class=${yt(this.hrClasses)}></div>
      </div>
    `}};ei.styles=lw,ei.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String}},ei=Ge([We("superviz-comments-annotation-item")],ei);U();var ov=je(Pe),cw=[ov.styles],ti=class extends ov{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:Ee`<span class="text text-big sv-gray-600">Are you sure you want to delete this comment? <br /> This action cannot be undone</span>`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return Ee`<slot name="modal-handler" @click=${this.toggle}></slot>`},r=()=>{if(!!this.open)return Ee`
        <superviz-modal></superviz-modal>
      `};return Ee`
      ${t()}
      ${r()}
    `}};ti.styles=cw,ti.properties={open:{type:Boolean},useSlot:{type:Boolean}},ti=Ge([We("superviz-comments-delete-comments-modal")],ti);U();var sv=je(Pe),fw=[sv.styles,Cc],dw=10*1e3,ni=class extends sv{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=dw,this.isCanceled=!1}firstUpdated(){this.setTimer()}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?Ee``:this.isCanceled?Ee``:Ee`
      <div class="annotation-resolved">
        <span class="text text-big sv-gray-700">You resolved this comment</span>
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};ni.styles=fw,ni.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},ni=Ge([We("superviz-comments-annotation-resolved")],ni);U();var av=je(Pe),hw=[av.styles,Tc],ls=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],ri=class extends av{constructor(){super();this.caret="down"}render(){let t=this.filter==="all"?ls[0].label:ls[1].label,r=({detail:l})=>{this.emitEvent("select",{filter:l}),i()},i=()=>{this.caret=this.caret==="down"?"up":"down"},a=this.filter==="all"?ls[0].code:ls[1].code,u={text:!0,"text-bold":!0,"select-content":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return Ee`
      <div class="select">
        <div class="select-container">
          <superviz-dropdown 
            options=${JSON.stringify(ls)}
            active=${a}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${i}
            @selected=${r}
            @close=${i}
          >
            <div class="content" slot="dropdown">
              <span class=${yt(u)}>${t}</span>
              <superviz-icon name=${this.caret} size="md"></superviz-icon>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};ri.styles=hw,ri.properties={filter:{type:String},caret:{type:String}},ri=Ge([We("superviz-comments-annotation-filter")],ri);U();var uv=je(Pe),pw=[uv.styles,Oc],ii=class extends uv{constructor(){super();this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden})}updated(t){super.updated(t),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".float-button");if(!r)return;r.setAttribute("style",this.positionStyles);let i=window.document.body.getBoundingClientRect().width,a=r.getBoundingClientRect(),u=320;if(!this.commentsPosition||this.commentsPosition==="left"){this.shouldHide=a.x<u;return}this.shouldHide=i-a.right<u})}render(){let t={"float-button":!0,"hide-button":!this.isHidden&&this.shouldHide};return Ee` <button @click=${this.toggle} class="${yt(t)}">
      <superviz-icon name="comment"></superviz-icon>

      <p class="text text-big text-bold">Comments</p>
    </button>`}};ii.styles=pw,ii.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String}},ii=Ge([We("superviz-comments-button")],ii);U();U();function lv(s){if(typeof document!="undefined"){let e=document.createElement("style");e.id="superviz-style";let t=document.createTextNode(s);e.appendChild(t),document.head.appendChild(e)}}var cv=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}
`;lv(cv);U();U();U();window&&(window.SuperVizSdk={init:Vl,MeetingEvent:co,DeviceEvent:Sl,RealtimeEvent:Ar,MeetingState:ea,MeetingConnectionStatus:ho,MeetingControlsEvent:Xs,ParticipantEvent:ta,FrameEvent:fo,LayoutMode:da,VideoComponent:Ao,MousePointers:Co,Realtime:So,Comments:go,CanvasPin:vo,ParticipantType:yi,LayoutPosition:fa,CamerasPosition:ha,RealtimeComponentState:ma,RealtimeComponentEvent:ga});var YF=Vl;export{bo as BrowserService,ha as CamerasPosition,Sl as DeviceEvent,fo as FrameEvent,da as LayoutMode,fa as LayoutPosition,ho as MeetingConnectionStatus,Xs as MeetingControlsEvent,co as MeetingEvent,ea as MeetingState,Ae as Observer,ta as ParticipantEvent,yi as ParticipantType,aa as PinMode,ga as RealtimeComponentEvent,ma as RealtimeComponentState,Ar as RealtimeEvent,YF as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
