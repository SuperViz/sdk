var w0=Object.create;var gi=Object.defineProperty,x0=Object.defineProperties,L0=Object.getOwnPropertyDescriptor,D0=Object.getOwnPropertyDescriptors,N0=Object.getOwnPropertyNames,hc=Object.getOwnPropertySymbols,U0=Object.getPrototypeOf,gc=Object.prototype.hasOwnProperty,B0=Object.prototype.propertyIsEnumerable;var pc=(o,r,n)=>r in o?gi(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,Le=(o,r)=>{for(var n in r||(r={}))gc.call(r,n)&&pc(o,n,r[n]);if(hc)for(var n of hc(r))B0.call(r,n)&&pc(o,n,r[n]);return o},vi=(o,r)=>x0(o,D0(r));var co=(o,r)=>()=>(o&&(r=o(o=0)),r);var Kt=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports),vc=(o,r)=>{for(var n in r)gi(o,n,{get:r[n],enumerable:!0})},F0=(o,r,n,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of N0(r))!gc.call(o,a)&&a!==n&&gi(o,a,{get:()=>r[a],enumerable:!(s=L0(r,a))||s.enumerable});return o};var An=(o,r,n)=>(n=o!=null?w0(U0(o)):{},F0(r||!o||!o.__esModule?gi(n,"default",{value:o,enumerable:!0}):n,o));var ne=(o,r,n)=>new Promise((s,a)=>{var O=h=>{try{l(n.next(h))}catch(y){a(y)}},C=h=>{try{l(n.throw(h))}catch(y){a(y)}},l=h=>h.done?s(h.value):Promise.resolve(h.value).then(O,C);l((n=n.apply(o,r)).next())});var mt,at=co(()=>{mt={}});var yc=Kt((HA,mc)=>{at();var kn=1e3,zn=kn*60,jn=zn*60,Cn=jn*24,H0=Cn*7,W0=Cn*365.25;mc.exports=function(o,r){r=r||{};var n=typeof o;if(n==="string"&&o.length>0)return k0(o);if(n==="number"&&isFinite(o))return r.long?j0(o):z0(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))};function k0(o){if(o=String(o),!(o.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!!r){var n=parseFloat(r[1]),s=(r[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*W0;case"weeks":case"week":case"w":return n*H0;case"days":case"day":case"d":return n*Cn;case"hours":case"hour":case"hrs":case"hr":case"h":return n*jn;case"minutes":case"minute":case"mins":case"min":case"m":return n*zn;case"seconds":case"second":case"secs":case"sec":case"s":return n*kn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function z0(o){var r=Math.abs(o);return r>=Cn?Math.round(o/Cn)+"d":r>=jn?Math.round(o/jn)+"h":r>=zn?Math.round(o/zn)+"m":r>=kn?Math.round(o/kn)+"s":o+"ms"}function j0(o){var r=Math.abs(o);return r>=Cn?bi(o,r,Cn,"day"):r>=jn?bi(o,r,jn,"hour"):r>=zn?bi(o,r,zn,"minute"):r>=kn?bi(o,r,kn,"second"):o+" ms"}function bi(o,r,n,s){var a=r>=n*1.5;return Math.round(o/n)+" "+s+(a?"s":"")}});var Ac=Kt((WA,bc)=>{at();function V0(o){n.debug=n,n.default=n,n.coerce=h,n.disable=O,n.enable=a,n.enabled=C,n.humanize=yc(),n.destroy=y,Object.keys(o).forEach(T=>{n[T]=o[T]}),n.names=[],n.skips=[],n.formatters={};function r(T){let R=0;for(let u=0;u<T.length;u++)R=(R<<5)-R+T.charCodeAt(u),R|=0;return n.colors[Math.abs(R)%n.colors.length]}n.selectColor=r;function n(T){let R,u=null,S,I;function M(...A){if(!M.enabled)return;let m=M,E=Number(new Date),c=E-(R||E);m.diff=c,m.prev=R,m.curr=E,R=E,A[0]=n.coerce(A[0]),typeof A[0]!="string"&&A.unshift("%O");let v=0;A[0]=A[0].replace(/%([a-zA-Z%])/g,(p,f)=>{if(p==="%%")return"%";v++;let b=n.formatters[f];if(typeof b=="function"){let _=A[v];p=b.call(m,_),A.splice(v,1),v--}return p}),n.formatArgs.call(m,A),(m.log||n.log).apply(m,A)}return M.namespace=T,M.useColors=n.useColors(),M.color=n.selectColor(T),M.extend=s,M.destroy=n.destroy,Object.defineProperty(M,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(S!==n.namespaces&&(S=n.namespaces,I=n.enabled(T)),I),set:A=>{u=A}}),typeof n.init=="function"&&n.init(M),M}function s(T,R){let u=n(this.namespace+(typeof R=="undefined"?":":R)+T);return u.log=this.log,u}function a(T){n.save(T),n.namespaces=T,n.names=[],n.skips=[];let R,u=(typeof T=="string"?T:"").split(/[\s,]+/),S=u.length;for(R=0;R<S;R++)!u[R]||(T=u[R].replace(/\*/g,".*?"),T[0]==="-"?n.skips.push(new RegExp("^"+T.slice(1)+"$")):n.names.push(new RegExp("^"+T+"$")))}function O(){let T=[...n.names.map(l),...n.skips.map(l).map(R=>"-"+R)].join(",");return n.enable(""),T}function C(T){if(T[T.length-1]==="*")return!0;let R,u;for(R=0,u=n.skips.length;R<u;R++)if(n.skips[R].test(T))return!1;for(R=0,u=n.names.length;R<u;R++)if(n.names[R].test(T))return!0;return!1}function l(T){return T.toString().substring(2,T.toString().length-2).replace(/\.\*\?$/,"*")}function h(T){return T instanceof Error?T.stack||T.message:T}function y(){}return n.enable(n.load()),n}bc.exports=V0});var Oc=Kt((Ae,Ai)=>{at();Ae.formatArgs=J0;Ae.save=$0;Ae.load=q0;Ae.useColors=K0;Ae.storage=Q0();Ae.destroy=(()=>{let o=!1;return()=>{o||(o=!0)}})();Ae.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function K0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function J0(o){if(o[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+o[0]+(this.useColors?"%c ":" ")+"+"+Ai.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;o.splice(1,0,r,"color: inherit");let n=0,s=0;o[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(n++,a==="%c"&&(s=n))}),o.splice(s,0,r)}Ae.log=console.debug||console.log||(()=>{});function $0(o){try{o?Ae.storage.setItem("debug",o):Ae.storage.removeItem("debug")}catch(r){}}function q0(){let o;try{o=Ae.storage.getItem("debug")}catch(r){}return!o&&typeof process!="undefined"&&"env"in process&&(o=mt.DEBUG),o}function Q0(){try{return localStorage}catch(o){}}Ai.exports=Ac()(Ae);var{formatters:Y0}=Ai.exports;Y0.j=function(o){try{return JSON.stringify(o)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}});var Ci=Kt((zA,Cc)=>{at();function Z0(o){var r=typeof o;return o!=null&&(r=="object"||r=="function")}Cc.exports=Z0});var Tc=Kt((jA,Sc)=>{at();var X0=typeof global=="object"&&global&&global.Object===Object&&global;Sc.exports=X0});var ho=Kt((VA,Rc)=>{at();var ty=Tc(),ey=typeof self=="object"&&self&&self.Object===Object&&self,ny=ty||ey||Function("return this")();Rc.exports=ny});var Pc=Kt((KA,Ec)=>{at();var ry=ho(),iy=function(){return ry.Date.now()};Ec.exports=iy});var _c=Kt((JA,Ic)=>{at();var ay=/\s/;function oy(o){for(var r=o.length;r--&&ay.test(o.charAt(r)););return r}Ic.exports=oy});var wc=Kt(($A,Mc)=>{at();var sy=_c(),uy=/^\s+/;function cy(o){return o&&o.slice(0,sy(o)+1).replace(uy,"")}Mc.exports=cy});var po=Kt((qA,xc)=>{at();var ly=ho(),fy=ly.Symbol;xc.exports=fy});var Uc=Kt((QA,Nc)=>{at();var Lc=po(),Dc=Object.prototype,dy=Dc.hasOwnProperty,hy=Dc.toString,vr=Lc?Lc.toStringTag:void 0;function py(o){var r=dy.call(o,vr),n=o[vr];try{o[vr]=void 0;var s=!0}catch(O){}var a=hy.call(o);return s&&(r?o[vr]=n:delete o[vr]),a}Nc.exports=py});var Fc=Kt((YA,Bc)=>{at();var gy=Object.prototype,vy=gy.toString;function my(o){return vy.call(o)}Bc.exports=my});var kc=Kt((ZA,Wc)=>{at();var Gc=po(),yy=Uc(),by=Fc(),Ay="[object Null]",Oy="[object Undefined]",Hc=Gc?Gc.toStringTag:void 0;function Cy(o){return o==null?o===void 0?Oy:Ay:Hc&&Hc in Object(o)?yy(o):by(o)}Wc.exports=Cy});var jc=Kt((XA,zc)=>{at();function Sy(o){return o!=null&&typeof o=="object"}zc.exports=Sy});var Kc=Kt((tO,Vc)=>{at();var Ty=kc(),Ry=jc(),Ey="[object Symbol]";function Py(o){return typeof o=="symbol"||Ry(o)&&Ty(o)==Ey}Vc.exports=Py});var Qc=Kt((eO,qc)=>{at();var Iy=wc(),Jc=Ci(),_y=Kc(),$c=0/0,My=/^[-+]0x[0-9a-f]+$/i,wy=/^0b[01]+$/i,xy=/^0o[0-7]+$/i,Ly=parseInt;function Dy(o){if(typeof o=="number")return o;if(_y(o))return $c;if(Jc(o)){var r=typeof o.valueOf=="function"?o.valueOf():o;o=Jc(r)?r+"":r}if(typeof o!="string")return o===0?o:+o;o=Iy(o);var n=wy.test(o);return n||xy.test(o)?Ly(o.slice(2),n?2:8):My.test(o)?$c:+o}qc.exports=Dy});var Xc=Kt((nO,Zc)=>{at();var Ny=Ci(),go=Pc(),Yc=Qc(),Uy="Expected a function",By=Math.max,Fy=Math.min;function Gy(o,r,n){var s,a,O,C,l,h,y=0,T=!1,R=!1,u=!0;if(typeof o!="function")throw new TypeError(Uy);r=Yc(r)||0,Ny(n)&&(T=!!n.leading,R="maxWait"in n,O=R?By(Yc(n.maxWait)||0,r):O,u="trailing"in n?!!n.trailing:u);function S(p){var f=s,b=a;return s=a=void 0,y=p,C=o.apply(b,f),C}function I(p){return y=p,l=setTimeout(m,r),T?S(p):C}function M(p){var f=p-h,b=p-y,_=r-f;return R?Fy(_,O-b):_}function A(p){var f=p-h,b=p-y;return h===void 0||f>=r||f<0||R&&b>=O}function m(){var p=go();if(A(p))return E(p);l=setTimeout(m,M(p))}function E(p){return l=void 0,u&&s?S(p):(s=a=void 0,C)}function c(){l!==void 0&&clearTimeout(l),y=0,s=h=a=l=void 0}function v(){return l===void 0?C:E(go())}function d(){var p=go(),f=A(p);if(s=arguments,a=this,h=p,f){if(l===void 0)return I(h);if(R)return clearTimeout(l),l=setTimeout(m,r),S(h)}return l===void 0&&(l=setTimeout(m,r)),C}return d.cancel=c,d.flush=v,d}Zc.exports=Gy});var vo=Kt((rO,tl)=>{at();var Hy=Xc(),Wy=Ci(),ky="Expected a function";function zy(o,r,n){var s=!0,a=!0;if(typeof o!="function")throw new TypeError(ky);return Wy(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),Hy(o,r,{leading:s,maxWait:r,trailing:a})}tl.exports=zy});var rl=Kt((mr,mo)=>{at();(function(o,r){typeof mr=="object"&&typeof mo=="object"?mo.exports=r():typeof define=="function"&&define.amd?define([],r):typeof mr=="object"?mr.bowser=r():o.bowser=r()})(mr,function(){return function(o){var r={};function n(s){if(r[s])return r[s].exports;var a=r[s]={i:s,l:!1,exports:{}};return o[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=o,n.c=r,n.d=function(s,a,O){n.o(s,a)||Object.defineProperty(s,a,{enumerable:!0,get:O})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,a){if(1&a&&(s=n(s)),8&a||4&a&&typeof s=="object"&&s&&s.__esModule)return s;var O=Object.create(null);if(n.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:s}),2&a&&typeof s!="string")for(var C in s)n.d(O,C,function(l){return s[l]}.bind(null,C));return O},n.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(a,"a",a),a},n.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},n.p="",n(n.s=90)}({17:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=n(18),a=function(){function O(){}return O.getFirstMatch=function(C,l){var h=l.match(C);return h&&h.length>0&&h[1]||""},O.getSecondMatch=function(C,l){var h=l.match(C);return h&&h.length>1&&h[2]||""},O.matchAndReturnConst=function(C,l,h){if(C.test(l))return h},O.getWindowsVersionName=function(C){switch(C){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},O.getMacOSVersionName=function(C){var l=C.split(".").splice(0,2).map(function(h){return parseInt(h,10)||0});if(l.push(0),l[0]===10)switch(l[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},O.getAndroidVersionName=function(C){var l=C.split(".").splice(0,2).map(function(h){return parseInt(h,10)||0});if(l.push(0),!(l[0]===1&&l[1]<5))return l[0]===1&&l[1]<6?"Cupcake":l[0]===1&&l[1]>=6?"Donut":l[0]===2&&l[1]<2?"Eclair":l[0]===2&&l[1]===2?"Froyo":l[0]===2&&l[1]>2?"Gingerbread":l[0]===3?"Honeycomb":l[0]===4&&l[1]<1?"Ice Cream Sandwich":l[0]===4&&l[1]<4?"Jelly Bean":l[0]===4&&l[1]>=4?"KitKat":l[0]===5?"Lollipop":l[0]===6?"Marshmallow":l[0]===7?"Nougat":l[0]===8?"Oreo":l[0]===9?"Pie":void 0},O.getVersionPrecision=function(C){return C.split(".").length},O.compareVersions=function(C,l,h){h===void 0&&(h=!1);var y=O.getVersionPrecision(C),T=O.getVersionPrecision(l),R=Math.max(y,T),u=0,S=O.map([C,l],function(I){var M=R-O.getVersionPrecision(I),A=I+new Array(M+1).join(".0");return O.map(A.split("."),function(m){return new Array(20-m.length).join("0")+m}).reverse()});for(h&&(u=R-Math.min(y,T)),R-=1;R>=u;){if(S[0][R]>S[1][R])return 1;if(S[0][R]===S[1][R]){if(R===u)return 0;R-=1}else if(S[0][R]<S[1][R])return-1}},O.map=function(C,l){var h,y=[];if(Array.prototype.map)return Array.prototype.map.call(C,l);for(h=0;h<C.length;h+=1)y.push(l(C[h]));return y},O.find=function(C,l){var h,y;if(Array.prototype.find)return Array.prototype.find.call(C,l);for(h=0,y=C.length;h<y;h+=1){var T=C[h];if(l(T,h))return T}},O.assign=function(C){for(var l,h,y=C,T=arguments.length,R=new Array(T>1?T-1:0),u=1;u<T;u++)R[u-1]=arguments[u];if(Object.assign)return Object.assign.apply(Object,[C].concat(R));var S=function(){var I=R[l];typeof I=="object"&&I!==null&&Object.keys(I).forEach(function(M){y[M]=I[M]})};for(l=0,h=R.length;l<h;l+=1)S();return C},O.getBrowserAlias=function(C){return s.BROWSER_ALIASES_MAP[C]},O.getBrowserTypeByAlias=function(C){return s.BROWSER_MAP[C]||""},O}();r.default=a,o.exports=r.default},18:function(o,r,n){"use strict";r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,a=(s=n(91))&&s.__esModule?s:{default:s},O=n(18);function C(h,y){for(var T=0;T<y.length;T++){var R=y[T];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(h,R.key,R)}}var l=function(){function h(){}var y,T,R;return h.getParser=function(u,S){if(S===void 0&&(S=!1),typeof u!="string")throw new Error("UserAgent should be a string");return new a.default(u,S)},h.parse=function(u){return new a.default(u).getResult()},y=h,R=[{key:"BROWSER_MAP",get:function(){return O.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return O.ENGINE_MAP}},{key:"OS_MAP",get:function(){return O.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return O.PLATFORMS_MAP}}],(T=null)&&C(y.prototype,T),R&&C(y,R),h}();r.default=l,o.exports=r.default},91:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s=h(n(92)),a=h(n(93)),O=h(n(94)),C=h(n(95)),l=h(n(17));function h(T){return T&&T.__esModule?T:{default:T}}var y=function(){function T(u,S){if(S===void 0&&(S=!1),u==null||u==="")throw new Error("UserAgent parameter can't be empty");this._ua=u,this.parsedResult={},S!==!0&&this.parse()}var R=T.prototype;return R.getUA=function(){return this._ua},R.test=function(u){return u.test(this._ua)},R.parseBrowser=function(){var u=this;this.parsedResult.browser={};var S=l.default.find(s.default,function(I){if(typeof I.test=="function")return I.test(u);if(I.test instanceof Array)return I.test.some(function(M){return u.test(M)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.browser=S.describe(this.getUA())),this.parsedResult.browser},R.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},R.getBrowserName=function(u){return u?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},R.getBrowserVersion=function(){return this.getBrowser().version},R.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},R.parseOS=function(){var u=this;this.parsedResult.os={};var S=l.default.find(a.default,function(I){if(typeof I.test=="function")return I.test(u);if(I.test instanceof Array)return I.test.some(function(M){return u.test(M)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.os=S.describe(this.getUA())),this.parsedResult.os},R.getOSName=function(u){var S=this.getOS().name;return u?String(S).toLowerCase()||"":S||""},R.getOSVersion=function(){return this.getOS().version},R.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},R.getPlatformType=function(u){u===void 0&&(u=!1);var S=this.getPlatform().type;return u?String(S).toLowerCase()||"":S||""},R.parsePlatform=function(){var u=this;this.parsedResult.platform={};var S=l.default.find(O.default,function(I){if(typeof I.test=="function")return I.test(u);if(I.test instanceof Array)return I.test.some(function(M){return u.test(M)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.platform=S.describe(this.getUA())),this.parsedResult.platform},R.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},R.getEngineName=function(u){return u?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},R.parseEngine=function(){var u=this;this.parsedResult.engine={};var S=l.default.find(C.default,function(I){if(typeof I.test=="function")return I.test(u);if(I.test instanceof Array)return I.test.some(function(M){return u.test(M)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.engine=S.describe(this.getUA())),this.parsedResult.engine},R.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},R.getResult=function(){return l.default.assign({},this.parsedResult)},R.satisfies=function(u){var S=this,I={},M=0,A={},m=0;if(Object.keys(u).forEach(function(_){var L=u[_];typeof L=="string"?(A[_]=L,m+=1):typeof L=="object"&&(I[_]=L,M+=1)}),M>0){var E=Object.keys(I),c=l.default.find(E,function(_){return S.isOS(_)});if(c){var v=this.satisfies(I[c]);if(v!==void 0)return v}var d=l.default.find(E,function(_){return S.isPlatform(_)});if(d){var p=this.satisfies(I[d]);if(p!==void 0)return p}}if(m>0){var f=Object.keys(A),b=l.default.find(f,function(_){return S.isBrowser(_,!0)});if(b!==void 0)return this.compareVersion(A[b])}},R.isBrowser=function(u,S){S===void 0&&(S=!1);var I=this.getBrowserName().toLowerCase(),M=u.toLowerCase(),A=l.default.getBrowserTypeByAlias(M);return S&&A&&(M=A.toLowerCase()),M===I},R.compareVersion=function(u){var S=[0],I=u,M=!1,A=this.getBrowserVersion();if(typeof A=="string")return u[0]===">"||u[0]==="<"?(I=u.substr(1),u[1]==="="?(M=!0,I=u.substr(2)):S=[],u[0]===">"?S.push(1):S.push(-1)):u[0]==="="?I=u.substr(1):u[0]==="~"&&(M=!0,I=u.substr(1)),S.indexOf(l.default.compareVersions(A,I,M))>-1},R.isOS=function(u){return this.getOSName(!0)===String(u).toLowerCase()},R.isPlatform=function(u){return this.getPlatformType(!0)===String(u).toLowerCase()},R.isEngine=function(u){return this.getEngineName(!0)===String(u).toLowerCase()},R.is=function(u,S){return S===void 0&&(S=!1),this.isBrowser(u,S)||this.isOS(u)||this.isPlatform(u)},R.some=function(u){var S=this;return u===void 0&&(u=[]),u.some(function(I){return S.is(I)})},T}();r.default=y,o.exports=r.default},92:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,a=(s=n(17))&&s.__esModule?s:{default:s},O=/version\/(\d+(\.?_?\d+)+)/i,C=[{test:[/googlebot/i],describe:function(l){var h={name:"Googlebot"},y=a.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/opera/i],describe:function(l){var h={name:"Opera"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/opr\/|opios/i],describe:function(l){var h={name:"Opera"},y=a.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/SamsungBrowser/i],describe:function(l){var h={name:"Samsung Internet for Android"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/Whale/i],describe:function(l){var h={name:"NAVER Whale Browser"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/MZBrowser/i],describe:function(l){var h={name:"MZ Browser"},y=a.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/focus/i],describe:function(l){var h={name:"Focus"},y=a.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/swing/i],describe:function(l){var h={name:"Swing"},y=a.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/coast/i],describe:function(l){var h={name:"Opera Coast"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(l){var h={name:"Opera Touch"},y=a.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/yabrowser/i],describe:function(l){var h={name:"Yandex Browser"},y=a.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/ucbrowser/i],describe:function(l){var h={name:"UC Browser"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/Maxthon|mxios/i],describe:function(l){var h={name:"Maxthon"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/epiphany/i],describe:function(l){var h={name:"Epiphany"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/puffin/i],describe:function(l){var h={name:"Puffin"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/sleipnir/i],describe:function(l){var h={name:"Sleipnir"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/k-meleon/i],describe:function(l){var h={name:"K-Meleon"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/micromessenger/i],describe:function(l){var h={name:"WeChat"},y=a.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/qqbrowser/i],describe:function(l){var h={name:/qqbrowserlite/i.test(l)?"QQ Browser Lite":"QQ Browser"},y=a.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/msie|trident/i],describe:function(l){var h={name:"Internet Explorer"},y=a.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/\sedg\//i],describe:function(l){var h={name:"Microsoft Edge"},y=a.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/edg([ea]|ios)/i],describe:function(l){var h={name:"Microsoft Edge"},y=a.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/vivaldi/i],describe:function(l){var h={name:"Vivaldi"},y=a.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/seamonkey/i],describe:function(l){var h={name:"SeaMonkey"},y=a.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/sailfish/i],describe:function(l){var h={name:"Sailfish"},y=a.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,l);return y&&(h.version=y),h}},{test:[/silk/i],describe:function(l){var h={name:"Amazon Silk"},y=a.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/phantom/i],describe:function(l){var h={name:"PhantomJS"},y=a.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/slimerjs/i],describe:function(l){var h={name:"SlimerJS"},y=a.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var h={name:"BlackBerry"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var h={name:"WebOS Browser"},y=a.default.getFirstMatch(O,l)||a.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/bada/i],describe:function(l){var h={name:"Bada"},y=a.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/tizen/i],describe:function(l){var h={name:"Tizen"},y=a.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/qupzilla/i],describe:function(l){var h={name:"QupZilla"},y=a.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/firefox|iceweasel|fxios/i],describe:function(l){var h={name:"Firefox"},y=a.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/electron/i],describe:function(l){var h={name:"Electron"},y=a.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/MiuiBrowser/i],describe:function(l){var h={name:"Miui"},y=a.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/chromium/i],describe:function(l){var h={name:"Chromium"},y=a.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,l)||a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/chrome|crios|crmo/i],describe:function(l){var h={name:"Chrome"},y=a.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/GSA/i],describe:function(l){var h={name:"Google Search"},y=a.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:function(l){var h=!l.test(/like android/i),y=l.test(/android/i);return h&&y},describe:function(l){var h={name:"Android Browser"},y=a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/playstation 4/i],describe:function(l){var h={name:"PlayStation 4"},y=a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/safari|applewebkit/i],describe:function(l){var h={name:"Safari"},y=a.default.getFirstMatch(O,l);return y&&(h.version=y),h}},{test:[/.*/i],describe:function(l){var h=l.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:a.default.getFirstMatch(h,l),version:a.default.getSecondMatch(h,l)}}}];r.default=C,o.exports=r.default},93:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,a=(s=n(17))&&s.__esModule?s:{default:s},O=n(18),C=[{test:[/Roku\/DVP/],describe:function(l){var h=a.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,l);return{name:O.OS_MAP.Roku,version:h}}},{test:[/windows phone/i],describe:function(l){var h=a.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,l);return{name:O.OS_MAP.WindowsPhone,version:h}}},{test:[/windows /i],describe:function(l){var h=a.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,l),y=a.default.getWindowsVersionName(h);return{name:O.OS_MAP.Windows,version:h,versionName:y}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(l){var h={name:O.OS_MAP.iOS},y=a.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,l);return y&&(h.version=y),h}},{test:[/macintosh/i],describe:function(l){var h=a.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,l).replace(/[_\s]/g,"."),y=a.default.getMacOSVersionName(h),T={name:O.OS_MAP.MacOS,version:h};return y&&(T.versionName=y),T}},{test:[/(ipod|iphone|ipad)/i],describe:function(l){var h=a.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,l).replace(/[_\s]/g,".");return{name:O.OS_MAP.iOS,version:h}}},{test:function(l){var h=!l.test(/like android/i),y=l.test(/android/i);return h&&y},describe:function(l){var h=a.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,l),y=a.default.getAndroidVersionName(h),T={name:O.OS_MAP.Android,version:h};return y&&(T.versionName=y),T}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var h=a.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,l),y={name:O.OS_MAP.WebOS};return h&&h.length&&(y.version=h),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var h=a.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,l)||a.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,l)||a.default.getFirstMatch(/\bbb(\d+)/i,l);return{name:O.OS_MAP.BlackBerry,version:h}}},{test:[/bada/i],describe:function(l){var h=a.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,l);return{name:O.OS_MAP.Bada,version:h}}},{test:[/tizen/i],describe:function(l){var h=a.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,l);return{name:O.OS_MAP.Tizen,version:h}}},{test:[/linux/i],describe:function(){return{name:O.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:O.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(l){var h=a.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,l);return{name:O.OS_MAP.PlayStation4,version:h}}}];r.default=C,o.exports=r.default},94:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,a=(s=n(17))&&s.__esModule?s:{default:s},O=n(18),C=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(l){var h=a.default.getFirstMatch(/(can-l01)/i,l)&&"Nova",y={type:O.PLATFORMS_MAP.mobile,vendor:"Huawei"};return h&&(y.model=h),y}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet}}},{test:function(l){var h=l.test(/ipod|iphone/i),y=l.test(/like (ipod|iphone)/i);return h&&!y},describe:function(l){var h=a.default.getFirstMatch(/(ipod|iphone)/i,l);return{type:O.PLATFORMS_MAP.mobile,vendor:"Apple",model:h}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName(!0)==="blackberry"},describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(l){return l.getBrowserName(!0)==="bada"},describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName()==="windows phone"},describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(l){var h=Number(String(l.getOSVersion()).split(".")[0]);return l.getOSName(!0)==="android"&&h>=3},describe:function(){return{type:O.PLATFORMS_MAP.tablet}}},{test:function(l){return l.getOSName(!0)==="android"},describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getOSName(!0)==="macos"},describe:function(){return{type:O.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(l){return l.getOSName(!0)==="windows"},describe:function(){return{type:O.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="linux"},describe:function(){return{type:O.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="playstation 4"},describe:function(){return{type:O.PLATFORMS_MAP.tv}}},{test:function(l){return l.getOSName(!0)==="roku"},describe:function(){return{type:O.PLATFORMS_MAP.tv}}}];r.default=C,o.exports=r.default},95:function(o,r,n){"use strict";r.__esModule=!0,r.default=void 0;var s,a=(s=n(17))&&s.__esModule?s:{default:s},O=n(18),C=[{test:function(l){return l.getBrowserName(!0)==="microsoft edge"},describe:function(l){if(/\sedg\//i.test(l))return{name:O.ENGINE_MAP.Blink};var h=a.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,l);return{name:O.ENGINE_MAP.EdgeHTML,version:h}}},{test:[/trident/i],describe:function(l){var h={name:O.ENGINE_MAP.Trident},y=a.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:function(l){return l.test(/presto/i)},describe:function(l){var h={name:O.ENGINE_MAP.Presto},y=a.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:function(l){var h=l.test(/gecko/i),y=l.test(/like gecko/i);return h&&!y},describe:function(l){var h={name:O.ENGINE_MAP.Gecko},y=a.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:O.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(l){var h={name:O.ENGINE_MAP.WebKit},y=a.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,l);return y&&(h.version=y),h}}];r.default=C,o.exports=r.default}})})});var Fl=Kt((br,Kn)=>{at();var Vy=200,Io="__lodash_hash_undefined__",Mi=1,gl=2,vl=9007199254740991,Si="[object Arguments]",Oo="[object Array]",Ky="[object AsyncFunction]",ml="[object Boolean]",yl="[object Date]",bl="[object Error]",Al="[object Function]",Jy="[object GeneratorFunction]",Ti="[object Map]",Ol="[object Number]",$y="[object Null]",Vn="[object Object]",il="[object Promise]",qy="[object Proxy]",Cl="[object RegExp]",Ri="[object Set]",Sl="[object String]",Qy="[object Symbol]",Yy="[object Undefined]",Co="[object WeakMap]",Tl="[object ArrayBuffer]",Ei="[object DataView]",Zy="[object Float32Array]",Xy="[object Float64Array]",tb="[object Int8Array]",eb="[object Int16Array]",nb="[object Int32Array]",rb="[object Uint8Array]",ib="[object Uint8ClampedArray]",ab="[object Uint16Array]",ob="[object Uint32Array]",sb=/[\\^$.*+?()[\]{}|]/g,ub=/^\[object .+?Constructor\]$/,cb=/^(?:0|[1-9]\d*)$/,kt={};kt[Zy]=kt[Xy]=kt[tb]=kt[eb]=kt[nb]=kt[rb]=kt[ib]=kt[ab]=kt[ob]=!0;kt[Si]=kt[Oo]=kt[Tl]=kt[ml]=kt[Ei]=kt[yl]=kt[bl]=kt[Al]=kt[Ti]=kt[Ol]=kt[Vn]=kt[Cl]=kt[Ri]=kt[Sl]=kt[Co]=!1;var Rl=typeof global=="object"&&global&&global.Object===Object&&global,lb=typeof self=="object"&&self&&self.Object===Object&&self,$e=Rl||lb||Function("return this")(),El=typeof br=="object"&&br&&!br.nodeType&&br,al=El&&typeof Kn=="object"&&Kn&&!Kn.nodeType&&Kn,Pl=al&&al.exports===El,yo=Pl&&Rl.process,ol=function(){try{return yo&&yo.binding&&yo.binding("util")}catch(o){}}(),sl=ol&&ol.isTypedArray;function fb(o,r){for(var n=-1,s=o==null?0:o.length,a=0,O=[];++n<s;){var C=o[n];r(C,n,o)&&(O[a++]=C)}return O}function db(o,r){for(var n=-1,s=r.length,a=o.length;++n<s;)o[a+n]=r[n];return o}function hb(o,r){for(var n=-1,s=o==null?0:o.length;++n<s;)if(r(o[n],n,o))return!0;return!1}function pb(o,r){for(var n=-1,s=Array(o);++n<o;)s[n]=r(n);return s}function gb(o){return function(r){return o(r)}}function vb(o,r){return o.has(r)}function mb(o,r){return o==null?void 0:o[r]}function yb(o){var r=-1,n=Array(o.size);return o.forEach(function(s,a){n[++r]=[a,s]}),n}function bb(o,r){return function(n){return o(r(n))}}function Ab(o){var r=-1,n=Array(o.size);return o.forEach(function(s){n[++r]=s}),n}var Ob=Array.prototype,Cb=Function.prototype,wi=Object.prototype,bo=$e["__core-js_shared__"],Il=Cb.toString,Fe=wi.hasOwnProperty,ul=function(){var o=/[^.]+$/.exec(bo&&bo.keys&&bo.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),_l=wi.toString,Sb=RegExp("^"+Il.call(Fe).replace(sb,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cl=Pl?$e.Buffer:void 0,Pi=$e.Symbol,ll=$e.Uint8Array,Ml=wi.propertyIsEnumerable,Tb=Ob.splice,Sn=Pi?Pi.toStringTag:void 0,fl=Object.getOwnPropertySymbols,Rb=cl?cl.isBuffer:void 0,Eb=bb(Object.keys,Object),So=Jn($e,"DataView"),Ar=Jn($e,"Map"),To=Jn($e,"Promise"),Ro=Jn($e,"Set"),Eo=Jn($e,"WeakMap"),Or=Jn(Object,"create"),Pb=En(So),Ib=En(Ar),_b=En(To),Mb=En(Ro),wb=En(Eo),dl=Pi?Pi.prototype:void 0,Ao=dl?dl.valueOf:void 0;function Tn(o){var r=-1,n=o==null?0:o.length;for(this.clear();++r<n;){var s=o[r];this.set(s[0],s[1])}}function xb(){this.__data__=Or?Or(null):{},this.size=0}function Lb(o){var r=this.has(o)&&delete this.__data__[o];return this.size-=r?1:0,r}function Db(o){var r=this.__data__;if(Or){var n=r[o];return n===Io?void 0:n}return Fe.call(r,o)?r[o]:void 0}function Nb(o){var r=this.__data__;return Or?r[o]!==void 0:Fe.call(r,o)}function Ub(o,r){var n=this.__data__;return this.size+=this.has(o)?0:1,n[o]=Or&&r===void 0?Io:r,this}Tn.prototype.clear=xb;Tn.prototype.delete=Lb;Tn.prototype.get=Db;Tn.prototype.has=Nb;Tn.prototype.set=Ub;function qe(o){var r=-1,n=o==null?0:o.length;for(this.clear();++r<n;){var s=o[r];this.set(s[0],s[1])}}function Bb(){this.__data__=[],this.size=0}function Fb(o){var r=this.__data__,n=xi(r,o);if(n<0)return!1;var s=r.length-1;return n==s?r.pop():Tb.call(r,n,1),--this.size,!0}function Gb(o){var r=this.__data__,n=xi(r,o);return n<0?void 0:r[n][1]}function Hb(o){return xi(this.__data__,o)>-1}function Wb(o,r){var n=this.__data__,s=xi(n,o);return s<0?(++this.size,n.push([o,r])):n[s][1]=r,this}qe.prototype.clear=Bb;qe.prototype.delete=Fb;qe.prototype.get=Gb;qe.prototype.has=Hb;qe.prototype.set=Wb;function Rn(o){var r=-1,n=o==null?0:o.length;for(this.clear();++r<n;){var s=o[r];this.set(s[0],s[1])}}function kb(){this.size=0,this.__data__={hash:new Tn,map:new(Ar||qe),string:new Tn}}function zb(o){var r=Li(this,o).delete(o);return this.size-=r?1:0,r}function jb(o){return Li(this,o).get(o)}function Vb(o){return Li(this,o).has(o)}function Kb(o,r){var n=Li(this,o),s=n.size;return n.set(o,r),this.size+=n.size==s?0:1,this}Rn.prototype.clear=kb;Rn.prototype.delete=zb;Rn.prototype.get=jb;Rn.prototype.has=Vb;Rn.prototype.set=Kb;function Ii(o){var r=-1,n=o==null?0:o.length;for(this.__data__=new Rn;++r<n;)this.add(o[r])}function Jb(o){return this.__data__.set(o,Io),this}function $b(o){return this.__data__.has(o)}Ii.prototype.add=Ii.prototype.push=Jb;Ii.prototype.has=$b;function cn(o){var r=this.__data__=new qe(o);this.size=r.size}function qb(){this.__data__=new qe,this.size=0}function Qb(o){var r=this.__data__,n=r.delete(o);return this.size=r.size,n}function Yb(o){return this.__data__.get(o)}function Zb(o){return this.__data__.has(o)}function Xb(o,r){var n=this.__data__;if(n instanceof qe){var s=n.__data__;if(!Ar||s.length<Vy-1)return s.push([o,r]),this.size=++n.size,this;n=this.__data__=new Rn(s)}return n.set(o,r),this.size=n.size,this}cn.prototype.clear=qb;cn.prototype.delete=Qb;cn.prototype.get=Yb;cn.prototype.has=Zb;cn.prototype.set=Xb;function tA(o,r){var n=_i(o),s=!n&&gA(o),a=!n&&!s&&Po(o),O=!n&&!s&&!a&&Bl(o),C=n||s||a||O,l=C?pb(o.length,String):[],h=l.length;for(var y in o)(r||Fe.call(o,y))&&!(C&&(y=="length"||a&&(y=="offset"||y=="parent")||O&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||lA(y,h)))&&l.push(y);return l}function xi(o,r){for(var n=o.length;n--;)if(Ll(o[n][0],r))return n;return-1}function eA(o,r,n){var s=r(o);return _i(o)?s:db(s,n(o))}function Sr(o){return o==null?o===void 0?Yy:$y:Sn&&Sn in Object(o)?uA(o):pA(o)}function hl(o){return Cr(o)&&Sr(o)==Si}function wl(o,r,n,s,a){return o===r?!0:o==null||r==null||!Cr(o)&&!Cr(r)?o!==o&&r!==r:nA(o,r,n,s,wl,a)}function nA(o,r,n,s,a,O){var C=_i(o),l=_i(r),h=C?Oo:un(o),y=l?Oo:un(r);h=h==Si?Vn:h,y=y==Si?Vn:y;var T=h==Vn,R=y==Vn,u=h==y;if(u&&Po(o)){if(!Po(r))return!1;C=!0,T=!1}if(u&&!T)return O||(O=new cn),C||Bl(o)?xl(o,r,n,s,a,O):oA(o,r,h,n,s,a,O);if(!(n&Mi)){var S=T&&Fe.call(o,"__wrapped__"),I=R&&Fe.call(r,"__wrapped__");if(S||I){var M=S?o.value():o,A=I?r.value():r;return O||(O=new cn),a(M,A,n,s,O)}}return u?(O||(O=new cn),sA(o,r,n,s,a,O)):!1}function rA(o){if(!Ul(o)||dA(o))return!1;var r=Dl(o)?Sb:ub;return r.test(En(o))}function iA(o){return Cr(o)&&Nl(o.length)&&!!kt[Sr(o)]}function aA(o){if(!hA(o))return Eb(o);var r=[];for(var n in Object(o))Fe.call(o,n)&&n!="constructor"&&r.push(n);return r}function xl(o,r,n,s,a,O){var C=n&Mi,l=o.length,h=r.length;if(l!=h&&!(C&&h>l))return!1;var y=O.get(o);if(y&&O.get(r))return y==r;var T=-1,R=!0,u=n&gl?new Ii:void 0;for(O.set(o,r),O.set(r,o);++T<l;){var S=o[T],I=r[T];if(s)var M=C?s(I,S,T,r,o,O):s(S,I,T,o,r,O);if(M!==void 0){if(M)continue;R=!1;break}if(u){if(!hb(r,function(A,m){if(!vb(u,m)&&(S===A||a(S,A,n,s,O)))return u.push(m)})){R=!1;break}}else if(!(S===I||a(S,I,n,s,O))){R=!1;break}}return O.delete(o),O.delete(r),R}function oA(o,r,n,s,a,O,C){switch(n){case Ei:if(o.byteLength!=r.byteLength||o.byteOffset!=r.byteOffset)return!1;o=o.buffer,r=r.buffer;case Tl:return!(o.byteLength!=r.byteLength||!O(new ll(o),new ll(r)));case ml:case yl:case Ol:return Ll(+o,+r);case bl:return o.name==r.name&&o.message==r.message;case Cl:case Sl:return o==r+"";case Ti:var l=yb;case Ri:var h=s&Mi;if(l||(l=Ab),o.size!=r.size&&!h)return!1;var y=C.get(o);if(y)return y==r;s|=gl,C.set(o,r);var T=xl(l(o),l(r),s,a,O,C);return C.delete(o),T;case Qy:if(Ao)return Ao.call(o)==Ao.call(r)}return!1}function sA(o,r,n,s,a,O){var C=n&Mi,l=pl(o),h=l.length,y=pl(r),T=y.length;if(h!=T&&!C)return!1;for(var R=h;R--;){var u=l[R];if(!(C?u in r:Fe.call(r,u)))return!1}var S=O.get(o);if(S&&O.get(r))return S==r;var I=!0;O.set(o,r),O.set(r,o);for(var M=C;++R<h;){u=l[R];var A=o[u],m=r[u];if(s)var E=C?s(m,A,u,r,o,O):s(A,m,u,o,r,O);if(!(E===void 0?A===m||a(A,m,n,s,O):E)){I=!1;break}M||(M=u=="constructor")}if(I&&!M){var c=o.constructor,v=r.constructor;c!=v&&"constructor"in o&&"constructor"in r&&!(typeof c=="function"&&c instanceof c&&typeof v=="function"&&v instanceof v)&&(I=!1)}return O.delete(o),O.delete(r),I}function pl(o){return eA(o,yA,cA)}function Li(o,r){var n=o.__data__;return fA(r)?n[typeof r=="string"?"string":"hash"]:n.map}function Jn(o,r){var n=mb(o,r);return rA(n)?n:void 0}function uA(o){var r=Fe.call(o,Sn),n=o[Sn];try{o[Sn]=void 0;var s=!0}catch(O){}var a=_l.call(o);return s&&(r?o[Sn]=n:delete o[Sn]),a}var cA=fl?function(o){return o==null?[]:(o=Object(o),fb(fl(o),function(r){return Ml.call(o,r)}))}:bA,un=Sr;(So&&un(new So(new ArrayBuffer(1)))!=Ei||Ar&&un(new Ar)!=Ti||To&&un(To.resolve())!=il||Ro&&un(new Ro)!=Ri||Eo&&un(new Eo)!=Co)&&(un=function(o){var r=Sr(o),n=r==Vn?o.constructor:void 0,s=n?En(n):"";if(s)switch(s){case Pb:return Ei;case Ib:return Ti;case _b:return il;case Mb:return Ri;case wb:return Co}return r});function lA(o,r){return r=r==null?vl:r,!!r&&(typeof o=="number"||cb.test(o))&&o>-1&&o%1==0&&o<r}function fA(o){var r=typeof o;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?o!=="__proto__":o===null}function dA(o){return!!ul&&ul in o}function hA(o){var r=o&&o.constructor,n=typeof r=="function"&&r.prototype||wi;return o===n}function pA(o){return _l.call(o)}function En(o){if(o!=null){try{return Il.call(o)}catch(r){}try{return o+""}catch(r){}}return""}function Ll(o,r){return o===r||o!==o&&r!==r}var gA=hl(function(){return arguments}())?hl:function(o){return Cr(o)&&Fe.call(o,"callee")&&!Ml.call(o,"callee")},_i=Array.isArray;function vA(o){return o!=null&&Nl(o.length)&&!Dl(o)}var Po=Rb||AA;function mA(o,r){return wl(o,r)}function Dl(o){if(!Ul(o))return!1;var r=Sr(o);return r==Al||r==Jy||r==Ky||r==qy}function Nl(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=vl}function Ul(o){var r=typeof o;return o!=null&&(r=="object"||r=="function")}function Cr(o){return o!=null&&typeof o=="object"}var Bl=sl?gb(sl):iA;function yA(o){return vA(o)?tA(o):aA(o)}function bA(){return[]}function AA(){return!1}Kn.exports=mA});var Gl=Kt(($n,Tr)=>{at();(function(){var o,r="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",O="Invalid `variable` option passed into `_.template`",C="__lodash_hash_undefined__",l=500,h="__lodash_placeholder__",y=1,T=2,R=4,u=1,S=2,I=1,M=2,A=4,m=8,E=16,c=32,v=64,d=128,p=256,f=512,b=30,_="...",L=800,k=16,H=1,N=2,P=3,x=1/0,z=9007199254740991,W=17976931348623157e292,$=0/0,X=4294967295,Q=X-1,G=X>>>1,U=[["ary",d],["bind",I],["bindKey",M],["curry",m],["curryRight",E],["flip",f],["partial",c],["partialRight",v],["rearg",p]],B="[object Arguments]",K="[object Array]",V="[object AsyncFunction]",tt="[object Boolean]",ct="[object Date]",yt="[object DOMException]",vt="[object Error]",Rt="[object Function]",Dt="[object GeneratorFunction]",ft="[object Map]",Lt="[object Number]",Xt="[object Null]",Ft="[object Object]",zt="[object Promise]",ce="[object Proxy]",Z="[object RegExp]",rt="[object Set]",ut="[object String]",ht="[object Symbol]",Pt="[object Undefined]",Qt="[object WeakMap]",ln="[object WeakSet]",Yn="[object ArrayBuffer]",Pn="[object DataView]",ki="[object Float32Array]",zi="[object Float64Array]",ji="[object Int8Array]",Vi="[object Int16Array]",Ki="[object Int32Array]",Ji="[object Uint8Array]",$i="[object Uint8ClampedArray]",qi="[object Uint16Array]",Qi="[object Uint32Array]",Yl=/\b__p \+= '';/g,Zl=/\b(__p \+=) '' \+/g,Xl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Fo=/&(?:amp|lt|gt|quot|#39);/g,Go=/[&<>"']/g,tf=RegExp(Fo.source),ef=RegExp(Go.source),nf=/<%-([\s\S]+?)%>/g,rf=/<%([\s\S]+?)%>/g,Ho=/<%=([\s\S]+?)%>/g,af=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,of=/^\w*$/,sf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yi=/[\\^$.*+?()[\]{}|]/g,uf=RegExp(Yi.source),Zi=/^\s+/,cf=/\s/,lf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ff=/\{\n\/\* \[wrapped with (.+)\] \*/,df=/,? & /,hf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pf=/[()=,{}\[\]\/\s]/,gf=/\\(\\)?/g,vf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wo=/\w*$/,mf=/^[-+]0x[0-9a-f]+$/i,yf=/^0b[01]+$/i,bf=/^\[object .+?Constructor\]$/,Af=/^0o[0-7]+$/i,Of=/^(?:0|[1-9]\d*)$/,Cf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pr=/($^)/,Sf=/['\n\r\u2028\u2029\\]/g,Ir="\\ud800-\\udfff",Tf="\\u0300-\\u036f",Rf="\\ufe20-\\ufe2f",Ef="\\u20d0-\\u20ff",ko=Tf+Rf+Ef,zo="\\u2700-\\u27bf",jo="a-z\\xdf-\\xf6\\xf8-\\xff",Pf="\\xac\\xb1\\xd7\\xf7",If="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",_f="\\u2000-\\u206f",Mf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Vo="A-Z\\xc0-\\xd6\\xd8-\\xde",Ko="\\ufe0e\\ufe0f",Jo=Pf+If+_f+Mf,Xi="['\u2019]",wf="["+Ir+"]",$o="["+Jo+"]",_r="["+ko+"]",qo="\\d+",xf="["+zo+"]",Qo="["+jo+"]",Yo="[^"+Ir+Jo+qo+zo+jo+Vo+"]",ta="\\ud83c[\\udffb-\\udfff]",Lf="(?:"+_r+"|"+ta+")",Zo="[^"+Ir+"]",ea="(?:\\ud83c[\\udde6-\\uddff]){2}",na="[\\ud800-\\udbff][\\udc00-\\udfff]",In="["+Vo+"]",Xo="\\u200d",ts="(?:"+Qo+"|"+Yo+")",Df="(?:"+In+"|"+Yo+")",es="(?:"+Xi+"(?:d|ll|m|re|s|t|ve))?",ns="(?:"+Xi+"(?:D|LL|M|RE|S|T|VE))?",rs=Lf+"?",is="["+Ko+"]?",Nf="(?:"+Xo+"(?:"+[Zo,ea,na].join("|")+")"+is+rs+")*",Uf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Bf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",as=is+rs+Nf,Ff="(?:"+[xf,ea,na].join("|")+")"+as,Gf="(?:"+[Zo+_r+"?",_r,ea,na,wf].join("|")+")",Hf=RegExp(Xi,"g"),Wf=RegExp(_r,"g"),ra=RegExp(ta+"(?="+ta+")|"+Gf+as,"g"),kf=RegExp([In+"?"+Qo+"+"+es+"(?="+[$o,In,"$"].join("|")+")",Df+"+"+ns+"(?="+[$o,In+ts,"$"].join("|")+")",In+"?"+ts+"+"+es,In+"+"+ns,Bf,Uf,qo,Ff].join("|"),"g"),zf=RegExp("["+Xo+Ir+ko+Ko+"]"),jf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Vf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Kf=-1,Wt={};Wt[ki]=Wt[zi]=Wt[ji]=Wt[Vi]=Wt[Ki]=Wt[Ji]=Wt[$i]=Wt[qi]=Wt[Qi]=!0,Wt[B]=Wt[K]=Wt[Yn]=Wt[tt]=Wt[Pn]=Wt[ct]=Wt[vt]=Wt[Rt]=Wt[ft]=Wt[Lt]=Wt[Ft]=Wt[Z]=Wt[rt]=Wt[ut]=Wt[Qt]=!1;var Ht={};Ht[B]=Ht[K]=Ht[Yn]=Ht[Pn]=Ht[tt]=Ht[ct]=Ht[ki]=Ht[zi]=Ht[ji]=Ht[Vi]=Ht[Ki]=Ht[ft]=Ht[Lt]=Ht[Ft]=Ht[Z]=Ht[rt]=Ht[ut]=Ht[ht]=Ht[Ji]=Ht[$i]=Ht[qi]=Ht[Qi]=!0,Ht[vt]=Ht[Rt]=Ht[Qt]=!1;var Jf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},$f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},qf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Qf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yf=parseFloat,Zf=parseInt,os=typeof global=="object"&&global&&global.Object===Object&&global,Xf=typeof self=="object"&&self&&self.Object===Object&&self,te=os||Xf||Function("return this")(),ia=typeof $n=="object"&&$n&&!$n.nodeType&&$n,fn=ia&&typeof Tr=="object"&&Tr&&!Tr.nodeType&&Tr,ss=fn&&fn.exports===ia,aa=ss&&os.process,Oe=function(){try{var q=fn&&fn.require&&fn.require("util").types;return q||aa&&aa.binding&&aa.binding("util")}catch(nt){}}(),us=Oe&&Oe.isArrayBuffer,cs=Oe&&Oe.isDate,ls=Oe&&Oe.isMap,fs=Oe&&Oe.isRegExp,ds=Oe&&Oe.isSet,hs=Oe&&Oe.isTypedArray;function pe(q,nt,et){switch(et.length){case 0:return q.call(nt);case 1:return q.call(nt,et[0]);case 2:return q.call(nt,et[0],et[1]);case 3:return q.call(nt,et[0],et[1],et[2])}return q.apply(nt,et)}function td(q,nt,et,dt){for(var Ct=-1,Nt=q==null?0:q.length;++Ct<Nt;){var Yt=q[Ct];nt(dt,Yt,et(Yt),q)}return dt}function Ce(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt&&nt(q[et],et,q)!==!1;);return q}function ed(q,nt){for(var et=q==null?0:q.length;et--&&nt(q[et],et,q)!==!1;);return q}function ps(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt;)if(!nt(q[et],et,q))return!1;return!0}function Qe(q,nt){for(var et=-1,dt=q==null?0:q.length,Ct=0,Nt=[];++et<dt;){var Yt=q[et];nt(Yt,et,q)&&(Nt[Ct++]=Yt)}return Nt}function Mr(q,nt){var et=q==null?0:q.length;return!!et&&_n(q,nt,0)>-1}function oa(q,nt,et){for(var dt=-1,Ct=q==null?0:q.length;++dt<Ct;)if(et(nt,q[dt]))return!0;return!1}function jt(q,nt){for(var et=-1,dt=q==null?0:q.length,Ct=Array(dt);++et<dt;)Ct[et]=nt(q[et],et,q);return Ct}function Ye(q,nt){for(var et=-1,dt=nt.length,Ct=q.length;++et<dt;)q[Ct+et]=nt[et];return q}function sa(q,nt,et,dt){var Ct=-1,Nt=q==null?0:q.length;for(dt&&Nt&&(et=q[++Ct]);++Ct<Nt;)et=nt(et,q[Ct],Ct,q);return et}function nd(q,nt,et,dt){var Ct=q==null?0:q.length;for(dt&&Ct&&(et=q[--Ct]);Ct--;)et=nt(et,q[Ct],Ct,q);return et}function ua(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt;)if(nt(q[et],et,q))return!0;return!1}var rd=ca("length");function id(q){return q.split("")}function ad(q){return q.match(hf)||[]}function gs(q,nt,et){var dt;return et(q,function(Ct,Nt,Yt){if(nt(Ct,Nt,Yt))return dt=Nt,!1}),dt}function wr(q,nt,et,dt){for(var Ct=q.length,Nt=et+(dt?1:-1);dt?Nt--:++Nt<Ct;)if(nt(q[Nt],Nt,q))return Nt;return-1}function _n(q,nt,et){return nt===nt?md(q,nt,et):wr(q,vs,et)}function od(q,nt,et,dt){for(var Ct=et-1,Nt=q.length;++Ct<Nt;)if(dt(q[Ct],nt))return Ct;return-1}function vs(q){return q!==q}function ms(q,nt){var et=q==null?0:q.length;return et?fa(q,nt)/et:$}function ca(q){return function(nt){return nt==null?o:nt[q]}}function la(q){return function(nt){return q==null?o:q[nt]}}function ys(q,nt,et,dt,Ct){return Ct(q,function(Nt,Yt,Gt){et=dt?(dt=!1,Nt):nt(et,Nt,Yt,Gt)}),et}function sd(q,nt){var et=q.length;for(q.sort(nt);et--;)q[et]=q[et].value;return q}function fa(q,nt){for(var et,dt=-1,Ct=q.length;++dt<Ct;){var Nt=nt(q[dt]);Nt!==o&&(et=et===o?Nt:et+Nt)}return et}function da(q,nt){for(var et=-1,dt=Array(q);++et<q;)dt[et]=nt(et);return dt}function ud(q,nt){return jt(nt,function(et){return[et,q[et]]})}function bs(q){return q&&q.slice(0,Ss(q)+1).replace(Zi,"")}function ge(q){return function(nt){return q(nt)}}function ha(q,nt){return jt(nt,function(et){return q[et]})}function Zn(q,nt){return q.has(nt)}function As(q,nt){for(var et=-1,dt=q.length;++et<dt&&_n(nt,q[et],0)>-1;);return et}function Os(q,nt){for(var et=q.length;et--&&_n(nt,q[et],0)>-1;);return et}function cd(q,nt){for(var et=q.length,dt=0;et--;)q[et]===nt&&++dt;return dt}var ld=la(Jf),fd=la($f);function dd(q){return"\\"+Qf[q]}function hd(q,nt){return q==null?o:q[nt]}function Mn(q){return zf.test(q)}function pd(q){return jf.test(q)}function gd(q){for(var nt,et=[];!(nt=q.next()).done;)et.push(nt.value);return et}function pa(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt,Ct){et[++nt]=[Ct,dt]}),et}function Cs(q,nt){return function(et){return q(nt(et))}}function Ze(q,nt){for(var et=-1,dt=q.length,Ct=0,Nt=[];++et<dt;){var Yt=q[et];(Yt===nt||Yt===h)&&(q[et]=h,Nt[Ct++]=et)}return Nt}function xr(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt){et[++nt]=dt}),et}function vd(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt){et[++nt]=[dt,dt]}),et}function md(q,nt,et){for(var dt=et-1,Ct=q.length;++dt<Ct;)if(q[dt]===nt)return dt;return-1}function yd(q,nt,et){for(var dt=et+1;dt--;)if(q[dt]===nt)return dt;return dt}function wn(q){return Mn(q)?Ad(q):rd(q)}function _e(q){return Mn(q)?Od(q):id(q)}function Ss(q){for(var nt=q.length;nt--&&cf.test(q.charAt(nt)););return nt}var bd=la(qf);function Ad(q){for(var nt=ra.lastIndex=0;ra.test(q);)++nt;return nt}function Od(q){return q.match(ra)||[]}function Cd(q){return q.match(kf)||[]}var Sd=function q(nt){nt=nt==null?te:Xe.defaults(te.Object(),nt,Xe.pick(te,Vf));var et=nt.Array,dt=nt.Date,Ct=nt.Error,Nt=nt.Function,Yt=nt.Math,Gt=nt.Object,ga=nt.RegExp,Td=nt.String,Se=nt.TypeError,Lr=et.prototype,Rd=Nt.prototype,xn=Gt.prototype,Dr=nt["__core-js_shared__"],Nr=Rd.toString,Bt=xn.hasOwnProperty,Ed=0,Ts=function(){var t=/[^.]+$/.exec(Dr&&Dr.keys&&Dr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ur=xn.toString,Pd=Nr.call(Gt),Id=te._,_d=ga("^"+Nr.call(Bt).replace(Yi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Br=ss?nt.Buffer:o,tn=nt.Symbol,Fr=nt.Uint8Array,Rs=Br?Br.allocUnsafe:o,Gr=Cs(Gt.getPrototypeOf,Gt),Es=Gt.create,Ps=xn.propertyIsEnumerable,Hr=Lr.splice,Is=tn?tn.isConcatSpreadable:o,Xn=tn?tn.iterator:o,dn=tn?tn.toStringTag:o,Wr=function(){try{var t=mn(Gt,"defineProperty");return t({},"",{}),t}catch(e){}}(),Md=nt.clearTimeout!==te.clearTimeout&&nt.clearTimeout,wd=dt&&dt.now!==te.Date.now&&dt.now,xd=nt.setTimeout!==te.setTimeout&&nt.setTimeout,kr=Yt.ceil,zr=Yt.floor,va=Gt.getOwnPropertySymbols,Ld=Br?Br.isBuffer:o,_s=nt.isFinite,Dd=Lr.join,Nd=Cs(Gt.keys,Gt),Zt=Yt.max,ie=Yt.min,Ud=dt.now,Bd=nt.parseInt,Ms=Yt.random,Fd=Lr.reverse,ma=mn(nt,"DataView"),tr=mn(nt,"Map"),ya=mn(nt,"Promise"),Ln=mn(nt,"Set"),er=mn(nt,"WeakMap"),nr=mn(Gt,"create"),jr=er&&new er,Dn={},Gd=yn(ma),Hd=yn(tr),Wd=yn(ya),kd=yn(Ln),zd=yn(er),Vr=tn?tn.prototype:o,rr=Vr?Vr.valueOf:o,ws=Vr?Vr.toString:o;function D(t){if(Jt(t)&&!St(t)&&!(t instanceof wt)){if(t instanceof Te)return t;if(Bt.call(t,"__wrapped__"))return xu(t)}return new Te(t)}var Nn=function(){function t(){}return function(e){if(!Vt(e))return{};if(Es)return Es(e);t.prototype=e;var i=new t;return t.prototype=o,i}}();function Kr(){}function Te(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}D.templateSettings={escape:nf,evaluate:rf,interpolate:Ho,variable:"",imports:{_:D}},D.prototype=Kr.prototype,D.prototype.constructor=D,Te.prototype=Nn(Kr.prototype),Te.prototype.constructor=Te;function wt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function jd(){var t=new wt(this.__wrapped__);return t.__actions__=le(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=le(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=le(this.__views__),t}function Vd(){if(this.__filtered__){var t=new wt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Kd(){var t=this.__wrapped__.value(),e=this.__dir__,i=St(t),g=e<0,w=i?t.length:0,F=ip(0,w,this.__views__),j=F.start,J=F.end,Y=J-j,it=g?J:j-1,ot=this.__iteratees__,st=ot.length,lt=0,gt=ie(Y,this.__takeCount__);if(!i||!g&&w==Y&&gt==Y)return eu(t,this.__actions__);var At=[];t:for(;Y--&&lt<gt;){it+=e;for(var It=-1,Ot=t[it];++It<st;){var Mt=ot[It],xt=Mt.iteratee,ye=Mt.type,ue=xt(Ot);if(ye==N)Ot=ue;else if(!ue){if(ye==H)continue t;break t}}At[lt++]=Ot}return At}wt.prototype=Nn(Kr.prototype),wt.prototype.constructor=wt;function hn(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var g=t[e];this.set(g[0],g[1])}}function Jd(){this.__data__=nr?nr(null):{},this.size=0}function $d(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function qd(t){var e=this.__data__;if(nr){var i=e[t];return i===C?o:i}return Bt.call(e,t)?e[t]:o}function Qd(t){var e=this.__data__;return nr?e[t]!==o:Bt.call(e,t)}function Yd(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=nr&&e===o?C:e,this}hn.prototype.clear=Jd,hn.prototype.delete=$d,hn.prototype.get=qd,hn.prototype.has=Qd,hn.prototype.set=Yd;function Ge(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var g=t[e];this.set(g[0],g[1])}}function Zd(){this.__data__=[],this.size=0}function Xd(t){var e=this.__data__,i=Jr(e,t);if(i<0)return!1;var g=e.length-1;return i==g?e.pop():Hr.call(e,i,1),--this.size,!0}function th(t){var e=this.__data__,i=Jr(e,t);return i<0?o:e[i][1]}function eh(t){return Jr(this.__data__,t)>-1}function nh(t,e){var i=this.__data__,g=Jr(i,t);return g<0?(++this.size,i.push([t,e])):i[g][1]=e,this}Ge.prototype.clear=Zd,Ge.prototype.delete=Xd,Ge.prototype.get=th,Ge.prototype.has=eh,Ge.prototype.set=nh;function He(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var g=t[e];this.set(g[0],g[1])}}function rh(){this.size=0,this.__data__={hash:new hn,map:new(tr||Ge),string:new hn}}function ih(t){var e=ai(this,t).delete(t);return this.size-=e?1:0,e}function ah(t){return ai(this,t).get(t)}function oh(t){return ai(this,t).has(t)}function sh(t,e){var i=ai(this,t),g=i.size;return i.set(t,e),this.size+=i.size==g?0:1,this}He.prototype.clear=rh,He.prototype.delete=ih,He.prototype.get=ah,He.prototype.has=oh,He.prototype.set=sh;function pn(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new He;++e<i;)this.add(t[e])}function uh(t){return this.__data__.set(t,C),this}function ch(t){return this.__data__.has(t)}pn.prototype.add=pn.prototype.push=uh,pn.prototype.has=ch;function Me(t){var e=this.__data__=new Ge(t);this.size=e.size}function lh(){this.__data__=new Ge,this.size=0}function fh(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function dh(t){return this.__data__.get(t)}function hh(t){return this.__data__.has(t)}function ph(t,e){var i=this.__data__;if(i instanceof Ge){var g=i.__data__;if(!tr||g.length<n-1)return g.push([t,e]),this.size=++i.size,this;i=this.__data__=new He(g)}return i.set(t,e),this.size=i.size,this}Me.prototype.clear=lh,Me.prototype.delete=fh,Me.prototype.get=dh,Me.prototype.has=hh,Me.prototype.set=ph;function xs(t,e){var i=St(t),g=!i&&bn(t),w=!i&&!g&&on(t),F=!i&&!g&&!w&&Gn(t),j=i||g||w||F,J=j?da(t.length,Td):[],Y=J.length;for(var it in t)(e||Bt.call(t,it))&&!(j&&(it=="length"||w&&(it=="offset"||it=="parent")||F&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||je(it,Y)))&&J.push(it);return J}function Ls(t){var e=t.length;return e?t[_a(0,e-1)]:o}function gh(t,e){return oi(le(t),gn(e,0,t.length))}function vh(t){return oi(le(t))}function ba(t,e,i){(i!==o&&!we(t[e],i)||i===o&&!(e in t))&&We(t,e,i)}function ir(t,e,i){var g=t[e];(!(Bt.call(t,e)&&we(g,i))||i===o&&!(e in t))&&We(t,e,i)}function Jr(t,e){for(var i=t.length;i--;)if(we(t[i][0],e))return i;return-1}function mh(t,e,i,g){return en(t,function(w,F,j){e(g,w,i(w),j)}),g}function Ds(t,e){return t&&Ne(e,ee(e),t)}function yh(t,e){return t&&Ne(e,de(e),t)}function We(t,e,i){e=="__proto__"&&Wr?Wr(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Aa(t,e){for(var i=-1,g=e.length,w=et(g),F=t==null;++i<g;)w[i]=F?o:to(t,e[i]);return w}function gn(t,e,i){return t===t&&(i!==o&&(t=t<=i?t:i),e!==o&&(t=t>=e?t:e)),t}function Re(t,e,i,g,w,F){var j,J=e&y,Y=e&T,it=e&R;if(i&&(j=w?i(t,g,w,F):i(t)),j!==o)return j;if(!Vt(t))return t;var ot=St(t);if(ot){if(j=op(t),!J)return le(t,j)}else{var st=ae(t),lt=st==Rt||st==Dt;if(on(t))return iu(t,J);if(st==Ft||st==B||lt&&!w){if(j=Y||lt?{}:Su(t),!J)return Y?qh(t,yh(j,t)):$h(t,Ds(j,t))}else{if(!Ht[st])return w?t:{};j=sp(t,st,J)}}F||(F=new Me);var gt=F.get(t);if(gt)return gt;F.set(t,j),Zu(t)?t.forEach(function(Ot){j.add(Re(Ot,e,i,Ot,t,F))}):Qu(t)&&t.forEach(function(Ot,Mt){j.set(Mt,Re(Ot,e,i,Mt,t,F))});var At=it?Y?Ha:Ga:Y?de:ee,It=ot?o:At(t);return Ce(It||t,function(Ot,Mt){It&&(Mt=Ot,Ot=t[Mt]),ir(j,Mt,Re(Ot,e,i,Mt,t,F))}),j}function bh(t){var e=ee(t);return function(i){return Ns(i,t,e)}}function Ns(t,e,i){var g=i.length;if(t==null)return!g;for(t=Gt(t);g--;){var w=i[g],F=e[w],j=t[w];if(j===o&&!(w in t)||!F(j))return!1}return!0}function Us(t,e,i){if(typeof t!="function")throw new Se(a);return fr(function(){t.apply(o,i)},e)}function ar(t,e,i,g){var w=-1,F=Mr,j=!0,J=t.length,Y=[],it=e.length;if(!J)return Y;i&&(e=jt(e,ge(i))),g?(F=oa,j=!1):e.length>=n&&(F=Zn,j=!1,e=new pn(e));t:for(;++w<J;){var ot=t[w],st=i==null?ot:i(ot);if(ot=g||ot!==0?ot:0,j&&st===st){for(var lt=it;lt--;)if(e[lt]===st)continue t;Y.push(ot)}else F(e,st,g)||Y.push(ot)}return Y}var en=cu(De),Bs=cu(Ca,!0);function Ah(t,e){var i=!0;return en(t,function(g,w,F){return i=!!e(g,w,F),i}),i}function $r(t,e,i){for(var g=-1,w=t.length;++g<w;){var F=t[g],j=e(F);if(j!=null&&(J===o?j===j&&!me(j):i(j,J)))var J=j,Y=F}return Y}function Oh(t,e,i,g){var w=t.length;for(i=Et(i),i<0&&(i=-i>w?0:w+i),g=g===o||g>w?w:Et(g),g<0&&(g+=w),g=i>g?0:tc(g);i<g;)t[i++]=e;return t}function Fs(t,e){var i=[];return en(t,function(g,w,F){e(g,w,F)&&i.push(g)}),i}function re(t,e,i,g,w){var F=-1,j=t.length;for(i||(i=cp),w||(w=[]);++F<j;){var J=t[F];e>0&&i(J)?e>1?re(J,e-1,i,g,w):Ye(w,J):g||(w[w.length]=J)}return w}var Oa=lu(),Gs=lu(!0);function De(t,e){return t&&Oa(t,e,ee)}function Ca(t,e){return t&&Gs(t,e,ee)}function qr(t,e){return Qe(e,function(i){return Ve(t[i])})}function vn(t,e){e=rn(e,t);for(var i=0,g=e.length;t!=null&&i<g;)t=t[Ue(e[i++])];return i&&i==g?t:o}function Hs(t,e,i){var g=e(t);return St(t)?g:Ye(g,i(t))}function oe(t){return t==null?t===o?Pt:Xt:dn&&dn in Gt(t)?rp(t):vp(t)}function Sa(t,e){return t>e}function Ch(t,e){return t!=null&&Bt.call(t,e)}function Sh(t,e){return t!=null&&e in Gt(t)}function Th(t,e,i){return t>=ie(e,i)&&t<Zt(e,i)}function Ta(t,e,i){for(var g=i?oa:Mr,w=t[0].length,F=t.length,j=F,J=et(F),Y=1/0,it=[];j--;){var ot=t[j];j&&e&&(ot=jt(ot,ge(e))),Y=ie(ot.length,Y),J[j]=!i&&(e||w>=120&&ot.length>=120)?new pn(j&&ot):o}ot=t[0];var st=-1,lt=J[0];t:for(;++st<w&&it.length<Y;){var gt=ot[st],At=e?e(gt):gt;if(gt=i||gt!==0?gt:0,!(lt?Zn(lt,At):g(it,At,i))){for(j=F;--j;){var It=J[j];if(!(It?Zn(It,At):g(t[j],At,i)))continue t}lt&&lt.push(At),it.push(gt)}}return it}function Rh(t,e,i,g){return De(t,function(w,F,j){e(g,i(w),F,j)}),g}function or(t,e,i){e=rn(e,t),t=Pu(t,e);var g=t==null?t:t[Ue(Pe(e))];return g==null?o:pe(g,t,i)}function Ws(t){return Jt(t)&&oe(t)==B}function Eh(t){return Jt(t)&&oe(t)==Yn}function Ph(t){return Jt(t)&&oe(t)==ct}function sr(t,e,i,g,w){return t===e?!0:t==null||e==null||!Jt(t)&&!Jt(e)?t!==t&&e!==e:Ih(t,e,i,g,sr,w)}function Ih(t,e,i,g,w,F){var j=St(t),J=St(e),Y=j?K:ae(t),it=J?K:ae(e);Y=Y==B?Ft:Y,it=it==B?Ft:it;var ot=Y==Ft,st=it==Ft,lt=Y==it;if(lt&&on(t)){if(!on(e))return!1;j=!0,ot=!1}if(lt&&!ot)return F||(F=new Me),j||Gn(t)?Au(t,e,i,g,w,F):ep(t,e,Y,i,g,w,F);if(!(i&u)){var gt=ot&&Bt.call(t,"__wrapped__"),At=st&&Bt.call(e,"__wrapped__");if(gt||At){var It=gt?t.value():t,Ot=At?e.value():e;return F||(F=new Me),w(It,Ot,i,g,F)}}return lt?(F||(F=new Me),np(t,e,i,g,w,F)):!1}function _h(t){return Jt(t)&&ae(t)==ft}function Ra(t,e,i,g){var w=i.length,F=w,j=!g;if(t==null)return!F;for(t=Gt(t);w--;){var J=i[w];if(j&&J[2]?J[1]!==t[J[0]]:!(J[0]in t))return!1}for(;++w<F;){J=i[w];var Y=J[0],it=t[Y],ot=J[1];if(j&&J[2]){if(it===o&&!(Y in t))return!1}else{var st=new Me;if(g)var lt=g(it,ot,Y,t,e,st);if(!(lt===o?sr(ot,it,u|S,g,st):lt))return!1}}return!0}function ks(t){if(!Vt(t)||fp(t))return!1;var e=Ve(t)?_d:bf;return e.test(yn(t))}function Mh(t){return Jt(t)&&oe(t)==Z}function wh(t){return Jt(t)&&ae(t)==rt}function xh(t){return Jt(t)&&di(t.length)&&!!Wt[oe(t)]}function zs(t){return typeof t=="function"?t:t==null?he:typeof t=="object"?St(t)?Ks(t[0],t[1]):Vs(t):fc(t)}function Ea(t){if(!lr(t))return Nd(t);var e=[];for(var i in Gt(t))Bt.call(t,i)&&i!="constructor"&&e.push(i);return e}function Lh(t){if(!Vt(t))return gp(t);var e=lr(t),i=[];for(var g in t)g=="constructor"&&(e||!Bt.call(t,g))||i.push(g);return i}function Pa(t,e){return t<e}function js(t,e){var i=-1,g=fe(t)?et(t.length):[];return en(t,function(w,F,j){g[++i]=e(w,F,j)}),g}function Vs(t){var e=ka(t);return e.length==1&&e[0][2]?Ru(e[0][0],e[0][1]):function(i){return i===t||Ra(i,t,e)}}function Ks(t,e){return ja(t)&&Tu(e)?Ru(Ue(t),e):function(i){var g=to(i,t);return g===o&&g===e?eo(i,t):sr(e,g,u|S)}}function Qr(t,e,i,g,w){t!==e&&Oa(e,function(F,j){if(w||(w=new Me),Vt(F))Dh(t,e,j,i,Qr,g,w);else{var J=g?g(Ka(t,j),F,j+"",t,e,w):o;J===o&&(J=F),ba(t,j,J)}},de)}function Dh(t,e,i,g,w,F,j){var J=Ka(t,i),Y=Ka(e,i),it=j.get(Y);if(it){ba(t,i,it);return}var ot=F?F(J,Y,i+"",t,e,j):o,st=ot===o;if(st){var lt=St(Y),gt=!lt&&on(Y),At=!lt&&!gt&&Gn(Y);ot=Y,lt||gt||At?St(J)?ot=J:$t(J)?ot=le(J):gt?(st=!1,ot=iu(Y,!0)):At?(st=!1,ot=au(Y,!0)):ot=[]:dr(Y)||bn(Y)?(ot=J,bn(J)?ot=ec(J):(!Vt(J)||Ve(J))&&(ot=Su(Y))):st=!1}st&&(j.set(Y,ot),w(ot,Y,g,F,j),j.delete(Y)),ba(t,i,ot)}function Js(t,e){var i=t.length;if(!!i)return e+=e<0?i:0,je(e,i)?t[e]:o}function $s(t,e,i){e.length?e=jt(e,function(F){return St(F)?function(j){return vn(j,F.length===1?F[0]:F)}:F}):e=[he];var g=-1;e=jt(e,ge(bt()));var w=js(t,function(F,j,J){var Y=jt(e,function(it){return it(F)});return{criteria:Y,index:++g,value:F}});return sd(w,function(F,j){return Jh(F,j,i)})}function Nh(t,e){return qs(t,e,function(i,g){return eo(t,g)})}function qs(t,e,i){for(var g=-1,w=e.length,F={};++g<w;){var j=e[g],J=vn(t,j);i(J,j)&&ur(F,rn(j,t),J)}return F}function Uh(t){return function(e){return vn(e,t)}}function Ia(t,e,i,g){var w=g?od:_n,F=-1,j=e.length,J=t;for(t===e&&(e=le(e)),i&&(J=jt(t,ge(i)));++F<j;)for(var Y=0,it=e[F],ot=i?i(it):it;(Y=w(J,ot,Y,g))>-1;)J!==t&&Hr.call(J,Y,1),Hr.call(t,Y,1);return t}function Qs(t,e){for(var i=t?e.length:0,g=i-1;i--;){var w=e[i];if(i==g||w!==F){var F=w;je(w)?Hr.call(t,w,1):xa(t,w)}}return t}function _a(t,e){return t+zr(Ms()*(e-t+1))}function Bh(t,e,i,g){for(var w=-1,F=Zt(kr((e-t)/(i||1)),0),j=et(F);F--;)j[g?F:++w]=t,t+=i;return j}function Ma(t,e){var i="";if(!t||e<1||e>z)return i;do e%2&&(i+=t),e=zr(e/2),e&&(t+=t);while(e);return i}function _t(t,e){return Ja(Eu(t,e,he),t+"")}function Fh(t){return Ls(Hn(t))}function Gh(t,e){var i=Hn(t);return oi(i,gn(e,0,i.length))}function ur(t,e,i,g){if(!Vt(t))return t;e=rn(e,t);for(var w=-1,F=e.length,j=F-1,J=t;J!=null&&++w<F;){var Y=Ue(e[w]),it=i;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return t;if(w!=j){var ot=J[Y];it=g?g(ot,Y,J):o,it===o&&(it=Vt(ot)?ot:je(e[w+1])?[]:{})}ir(J,Y,it),J=J[Y]}return t}var Ys=jr?function(t,e){return jr.set(t,e),t}:he,Hh=Wr?function(t,e){return Wr(t,"toString",{configurable:!0,enumerable:!1,value:ro(e),writable:!0})}:he;function Wh(t){return oi(Hn(t))}function Ee(t,e,i){var g=-1,w=t.length;e<0&&(e=-e>w?0:w+e),i=i>w?w:i,i<0&&(i+=w),w=e>i?0:i-e>>>0,e>>>=0;for(var F=et(w);++g<w;)F[g]=t[g+e];return F}function kh(t,e){var i;return en(t,function(g,w,F){return i=e(g,w,F),!i}),!!i}function Yr(t,e,i){var g=0,w=t==null?g:t.length;if(typeof e=="number"&&e===e&&w<=G){for(;g<w;){var F=g+w>>>1,j=t[F];j!==null&&!me(j)&&(i?j<=e:j<e)?g=F+1:w=F}return w}return wa(t,e,he,i)}function wa(t,e,i,g){var w=0,F=t==null?0:t.length;if(F===0)return 0;e=i(e);for(var j=e!==e,J=e===null,Y=me(e),it=e===o;w<F;){var ot=zr((w+F)/2),st=i(t[ot]),lt=st!==o,gt=st===null,At=st===st,It=me(st);if(j)var Ot=g||At;else it?Ot=At&&(g||lt):J?Ot=At&&lt&&(g||!gt):Y?Ot=At&&lt&&!gt&&(g||!It):gt||It?Ot=!1:Ot=g?st<=e:st<e;Ot?w=ot+1:F=ot}return ie(F,Q)}function Zs(t,e){for(var i=-1,g=t.length,w=0,F=[];++i<g;){var j=t[i],J=e?e(j):j;if(!i||!we(J,Y)){var Y=J;F[w++]=j===0?0:j}}return F}function Xs(t){return typeof t=="number"?t:me(t)?$:+t}function ve(t){if(typeof t=="string")return t;if(St(t))return jt(t,ve)+"";if(me(t))return ws?ws.call(t):"";var e=t+"";return e=="0"&&1/t==-x?"-0":e}function nn(t,e,i){var g=-1,w=Mr,F=t.length,j=!0,J=[],Y=J;if(i)j=!1,w=oa;else if(F>=n){var it=e?null:Xh(t);if(it)return xr(it);j=!1,w=Zn,Y=new pn}else Y=e?[]:J;t:for(;++g<F;){var ot=t[g],st=e?e(ot):ot;if(ot=i||ot!==0?ot:0,j&&st===st){for(var lt=Y.length;lt--;)if(Y[lt]===st)continue t;e&&Y.push(st),J.push(ot)}else w(Y,st,i)||(Y!==J&&Y.push(st),J.push(ot))}return J}function xa(t,e){return e=rn(e,t),t=Pu(t,e),t==null||delete t[Ue(Pe(e))]}function tu(t,e,i,g){return ur(t,e,i(vn(t,e)),g)}function Zr(t,e,i,g){for(var w=t.length,F=g?w:-1;(g?F--:++F<w)&&e(t[F],F,t););return i?Ee(t,g?0:F,g?F+1:w):Ee(t,g?F+1:0,g?w:F)}function eu(t,e){var i=t;return i instanceof wt&&(i=i.value()),sa(e,function(g,w){return w.func.apply(w.thisArg,Ye([g],w.args))},i)}function La(t,e,i){var g=t.length;if(g<2)return g?nn(t[0]):[];for(var w=-1,F=et(g);++w<g;)for(var j=t[w],J=-1;++J<g;)J!=w&&(F[w]=ar(F[w]||j,t[J],e,i));return nn(re(F,1),e,i)}function nu(t,e,i){for(var g=-1,w=t.length,F=e.length,j={};++g<w;){var J=g<F?e[g]:o;i(j,t[g],J)}return j}function Da(t){return $t(t)?t:[]}function Na(t){return typeof t=="function"?t:he}function rn(t,e){return St(t)?t:ja(t,e)?[t]:wu(Ut(t))}var zh=_t;function an(t,e,i){var g=t.length;return i=i===o?g:i,!e&&i>=g?t:Ee(t,e,i)}var ru=Md||function(t){return te.clearTimeout(t)};function iu(t,e){if(e)return t.slice();var i=t.length,g=Rs?Rs(i):new t.constructor(i);return t.copy(g),g}function Ua(t){var e=new t.constructor(t.byteLength);return new Fr(e).set(new Fr(t)),e}function jh(t,e){var i=e?Ua(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function Vh(t){var e=new t.constructor(t.source,Wo.exec(t));return e.lastIndex=t.lastIndex,e}function Kh(t){return rr?Gt(rr.call(t)):{}}function au(t,e){var i=e?Ua(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function ou(t,e){if(t!==e){var i=t!==o,g=t===null,w=t===t,F=me(t),j=e!==o,J=e===null,Y=e===e,it=me(e);if(!J&&!it&&!F&&t>e||F&&j&&Y&&!J&&!it||g&&j&&Y||!i&&Y||!w)return 1;if(!g&&!F&&!it&&t<e||it&&i&&w&&!g&&!F||J&&i&&w||!j&&w||!Y)return-1}return 0}function Jh(t,e,i){for(var g=-1,w=t.criteria,F=e.criteria,j=w.length,J=i.length;++g<j;){var Y=ou(w[g],F[g]);if(Y){if(g>=J)return Y;var it=i[g];return Y*(it=="desc"?-1:1)}}return t.index-e.index}function su(t,e,i,g){for(var w=-1,F=t.length,j=i.length,J=-1,Y=e.length,it=Zt(F-j,0),ot=et(Y+it),st=!g;++J<Y;)ot[J]=e[J];for(;++w<j;)(st||w<F)&&(ot[i[w]]=t[w]);for(;it--;)ot[J++]=t[w++];return ot}function uu(t,e,i,g){for(var w=-1,F=t.length,j=-1,J=i.length,Y=-1,it=e.length,ot=Zt(F-J,0),st=et(ot+it),lt=!g;++w<ot;)st[w]=t[w];for(var gt=w;++Y<it;)st[gt+Y]=e[Y];for(;++j<J;)(lt||w<F)&&(st[gt+i[j]]=t[w++]);return st}function le(t,e){var i=-1,g=t.length;for(e||(e=et(g));++i<g;)e[i]=t[i];return e}function Ne(t,e,i,g){var w=!i;i||(i={});for(var F=-1,j=e.length;++F<j;){var J=e[F],Y=g?g(i[J],t[J],J,i,t):o;Y===o&&(Y=t[J]),w?We(i,J,Y):ir(i,J,Y)}return i}function $h(t,e){return Ne(t,za(t),e)}function qh(t,e){return Ne(t,Ou(t),e)}function Xr(t,e){return function(i,g){var w=St(i)?td:mh,F=e?e():{};return w(i,t,bt(g,2),F)}}function Un(t){return _t(function(e,i){var g=-1,w=i.length,F=w>1?i[w-1]:o,j=w>2?i[2]:o;for(F=t.length>3&&typeof F=="function"?(w--,F):o,j&&se(i[0],i[1],j)&&(F=w<3?o:F,w=1),e=Gt(e);++g<w;){var J=i[g];J&&t(e,J,g,F)}return e})}function cu(t,e){return function(i,g){if(i==null)return i;if(!fe(i))return t(i,g);for(var w=i.length,F=e?w:-1,j=Gt(i);(e?F--:++F<w)&&g(j[F],F,j)!==!1;);return i}}function lu(t){return function(e,i,g){for(var w=-1,F=Gt(e),j=g(e),J=j.length;J--;){var Y=j[t?J:++w];if(i(F[Y],Y,F)===!1)break}return e}}function Qh(t,e,i){var g=e&I,w=cr(t);function F(){var j=this&&this!==te&&this instanceof F?w:t;return j.apply(g?i:this,arguments)}return F}function fu(t){return function(e){e=Ut(e);var i=Mn(e)?_e(e):o,g=i?i[0]:e.charAt(0),w=i?an(i,1).join(""):e.slice(1);return g[t]()+w}}function Bn(t){return function(e){return sa(cc(uc(e).replace(Hf,"")),t,"")}}function cr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Nn(t.prototype),g=t.apply(i,e);return Vt(g)?g:i}}function Yh(t,e,i){var g=cr(t);function w(){for(var F=arguments.length,j=et(F),J=F,Y=Fn(w);J--;)j[J]=arguments[J];var it=F<3&&j[0]!==Y&&j[F-1]!==Y?[]:Ze(j,Y);if(F-=it.length,F<i)return vu(t,e,ti,w.placeholder,o,j,it,o,o,i-F);var ot=this&&this!==te&&this instanceof w?g:t;return pe(ot,this,j)}return w}function du(t){return function(e,i,g){var w=Gt(e);if(!fe(e)){var F=bt(i,3);e=ee(e),i=function(J){return F(w[J],J,w)}}var j=t(e,i,g);return j>-1?w[F?e[j]:j]:o}}function hu(t){return ze(function(e){var i=e.length,g=i,w=Te.prototype.thru;for(t&&e.reverse();g--;){var F=e[g];if(typeof F!="function")throw new Se(a);if(w&&!j&&ii(F)=="wrapper")var j=new Te([],!0)}for(g=j?g:i;++g<i;){F=e[g];var J=ii(F),Y=J=="wrapper"?Wa(F):o;Y&&Va(Y[0])&&Y[1]==(d|m|c|p)&&!Y[4].length&&Y[9]==1?j=j[ii(Y[0])].apply(j,Y[3]):j=F.length==1&&Va(F)?j[J]():j.thru(F)}return function(){var it=arguments,ot=it[0];if(j&&it.length==1&&St(ot))return j.plant(ot).value();for(var st=0,lt=i?e[st].apply(this,it):ot;++st<i;)lt=e[st].call(this,lt);return lt}})}function ti(t,e,i,g,w,F,j,J,Y,it){var ot=e&d,st=e&I,lt=e&M,gt=e&(m|E),At=e&f,It=lt?o:cr(t);function Ot(){for(var Mt=arguments.length,xt=et(Mt),ye=Mt;ye--;)xt[ye]=arguments[ye];if(gt)var ue=Fn(Ot),be=cd(xt,ue);if(g&&(xt=su(xt,g,w,gt)),F&&(xt=uu(xt,F,j,gt)),Mt-=be,gt&&Mt<it){var qt=Ze(xt,ue);return vu(t,e,ti,Ot.placeholder,i,xt,qt,J,Y,it-Mt)}var xe=st?i:this,Je=lt?xe[t]:t;return Mt=xt.length,J?xt=mp(xt,J):At&&Mt>1&&xt.reverse(),ot&&Y<Mt&&(xt.length=Y),this&&this!==te&&this instanceof Ot&&(Je=It||cr(Je)),Je.apply(xe,xt)}return Ot}function pu(t,e){return function(i,g){return Rh(i,t,e(g),{})}}function ei(t,e){return function(i,g){var w;if(i===o&&g===o)return e;if(i!==o&&(w=i),g!==o){if(w===o)return g;typeof i=="string"||typeof g=="string"?(i=ve(i),g=ve(g)):(i=Xs(i),g=Xs(g)),w=t(i,g)}return w}}function Ba(t){return ze(function(e){return e=jt(e,ge(bt())),_t(function(i){var g=this;return t(e,function(w){return pe(w,g,i)})})})}function ni(t,e){e=e===o?" ":ve(e);var i=e.length;if(i<2)return i?Ma(e,t):e;var g=Ma(e,kr(t/wn(e)));return Mn(e)?an(_e(g),0,t).join(""):g.slice(0,t)}function Zh(t,e,i,g){var w=e&I,F=cr(t);function j(){for(var J=-1,Y=arguments.length,it=-1,ot=g.length,st=et(ot+Y),lt=this&&this!==te&&this instanceof j?F:t;++it<ot;)st[it]=g[it];for(;Y--;)st[it++]=arguments[++J];return pe(lt,w?i:this,st)}return j}function gu(t){return function(e,i,g){return g&&typeof g!="number"&&se(e,i,g)&&(i=g=o),e=Ke(e),i===o?(i=e,e=0):i=Ke(i),g=g===o?e<i?1:-1:Ke(g),Bh(e,i,g,t)}}function ri(t){return function(e,i){return typeof e=="string"&&typeof i=="string"||(e=Ie(e),i=Ie(i)),t(e,i)}}function vu(t,e,i,g,w,F,j,J,Y,it){var ot=e&m,st=ot?j:o,lt=ot?o:j,gt=ot?F:o,At=ot?o:F;e|=ot?c:v,e&=~(ot?v:c),e&A||(e&=~(I|M));var It=[t,e,w,gt,st,At,lt,J,Y,it],Ot=i.apply(o,It);return Va(t)&&Iu(Ot,It),Ot.placeholder=g,_u(Ot,t,e)}function Fa(t){var e=Yt[t];return function(i,g){if(i=Ie(i),g=g==null?0:ie(Et(g),292),g&&_s(i)){var w=(Ut(i)+"e").split("e"),F=e(w[0]+"e"+(+w[1]+g));return w=(Ut(F)+"e").split("e"),+(w[0]+"e"+(+w[1]-g))}return e(i)}}var Xh=Ln&&1/xr(new Ln([,-0]))[1]==x?function(t){return new Ln(t)}:oo;function mu(t){return function(e){var i=ae(e);return i==ft?pa(e):i==rt?vd(e):ud(e,t(e))}}function ke(t,e,i,g,w,F,j,J){var Y=e&M;if(!Y&&typeof t!="function")throw new Se(a);var it=g?g.length:0;if(it||(e&=~(c|v),g=w=o),j=j===o?j:Zt(Et(j),0),J=J===o?J:Et(J),it-=w?w.length:0,e&v){var ot=g,st=w;g=w=o}var lt=Y?o:Wa(t),gt=[t,e,i,g,w,ot,st,F,j,J];if(lt&&pp(gt,lt),t=gt[0],e=gt[1],i=gt[2],g=gt[3],w=gt[4],J=gt[9]=gt[9]===o?Y?0:t.length:Zt(gt[9]-it,0),!J&&e&(m|E)&&(e&=~(m|E)),!e||e==I)var At=Qh(t,e,i);else e==m||e==E?At=Yh(t,e,J):(e==c||e==(I|c))&&!w.length?At=Zh(t,e,i,g):At=ti.apply(o,gt);var It=lt?Ys:Iu;return _u(It(At,gt),t,e)}function yu(t,e,i,g){return t===o||we(t,xn[i])&&!Bt.call(g,i)?e:t}function bu(t,e,i,g,w,F){return Vt(t)&&Vt(e)&&(F.set(e,t),Qr(t,e,o,bu,F),F.delete(e)),t}function tp(t){return dr(t)?o:t}function Au(t,e,i,g,w,F){var j=i&u,J=t.length,Y=e.length;if(J!=Y&&!(j&&Y>J))return!1;var it=F.get(t),ot=F.get(e);if(it&&ot)return it==e&&ot==t;var st=-1,lt=!0,gt=i&S?new pn:o;for(F.set(t,e),F.set(e,t);++st<J;){var At=t[st],It=e[st];if(g)var Ot=j?g(It,At,st,e,t,F):g(At,It,st,t,e,F);if(Ot!==o){if(Ot)continue;lt=!1;break}if(gt){if(!ua(e,function(Mt,xt){if(!Zn(gt,xt)&&(At===Mt||w(At,Mt,i,g,F)))return gt.push(xt)})){lt=!1;break}}else if(!(At===It||w(At,It,i,g,F))){lt=!1;break}}return F.delete(t),F.delete(e),lt}function ep(t,e,i,g,w,F,j){switch(i){case Pn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Yn:return!(t.byteLength!=e.byteLength||!F(new Fr(t),new Fr(e)));case tt:case ct:case Lt:return we(+t,+e);case vt:return t.name==e.name&&t.message==e.message;case Z:case ut:return t==e+"";case ft:var J=pa;case rt:var Y=g&u;if(J||(J=xr),t.size!=e.size&&!Y)return!1;var it=j.get(t);if(it)return it==e;g|=S,j.set(t,e);var ot=Au(J(t),J(e),g,w,F,j);return j.delete(t),ot;case ht:if(rr)return rr.call(t)==rr.call(e)}return!1}function np(t,e,i,g,w,F){var j=i&u,J=Ga(t),Y=J.length,it=Ga(e),ot=it.length;if(Y!=ot&&!j)return!1;for(var st=Y;st--;){var lt=J[st];if(!(j?lt in e:Bt.call(e,lt)))return!1}var gt=F.get(t),At=F.get(e);if(gt&&At)return gt==e&&At==t;var It=!0;F.set(t,e),F.set(e,t);for(var Ot=j;++st<Y;){lt=J[st];var Mt=t[lt],xt=e[lt];if(g)var ye=j?g(xt,Mt,lt,e,t,F):g(Mt,xt,lt,t,e,F);if(!(ye===o?Mt===xt||w(Mt,xt,i,g,F):ye)){It=!1;break}Ot||(Ot=lt=="constructor")}if(It&&!Ot){var ue=t.constructor,be=e.constructor;ue!=be&&"constructor"in t&&"constructor"in e&&!(typeof ue=="function"&&ue instanceof ue&&typeof be=="function"&&be instanceof be)&&(It=!1)}return F.delete(t),F.delete(e),It}function ze(t){return Ja(Eu(t,o,Nu),t+"")}function Ga(t){return Hs(t,ee,za)}function Ha(t){return Hs(t,de,Ou)}var Wa=jr?function(t){return jr.get(t)}:oo;function ii(t){for(var e=t.name+"",i=Dn[e],g=Bt.call(Dn,e)?i.length:0;g--;){var w=i[g],F=w.func;if(F==null||F==t)return w.name}return e}function Fn(t){var e=Bt.call(D,"placeholder")?D:t;return e.placeholder}function bt(){var t=D.iteratee||io;return t=t===io?zs:t,arguments.length?t(arguments[0],arguments[1]):t}function ai(t,e){var i=t.__data__;return lp(e)?i[typeof e=="string"?"string":"hash"]:i.map}function ka(t){for(var e=ee(t),i=e.length;i--;){var g=e[i],w=t[g];e[i]=[g,w,Tu(w)]}return e}function mn(t,e){var i=hd(t,e);return ks(i)?i:o}function rp(t){var e=Bt.call(t,dn),i=t[dn];try{t[dn]=o;var g=!0}catch(F){}var w=Ur.call(t);return g&&(e?t[dn]=i:delete t[dn]),w}var za=va?function(t){return t==null?[]:(t=Gt(t),Qe(va(t),function(e){return Ps.call(t,e)}))}:so,Ou=va?function(t){for(var e=[];t;)Ye(e,za(t)),t=Gr(t);return e}:so,ae=oe;(ma&&ae(new ma(new ArrayBuffer(1)))!=Pn||tr&&ae(new tr)!=ft||ya&&ae(ya.resolve())!=zt||Ln&&ae(new Ln)!=rt||er&&ae(new er)!=Qt)&&(ae=function(t){var e=oe(t),i=e==Ft?t.constructor:o,g=i?yn(i):"";if(g)switch(g){case Gd:return Pn;case Hd:return ft;case Wd:return zt;case kd:return rt;case zd:return Qt}return e});function ip(t,e,i){for(var g=-1,w=i.length;++g<w;){var F=i[g],j=F.size;switch(F.type){case"drop":t+=j;break;case"dropRight":e-=j;break;case"take":e=ie(e,t+j);break;case"takeRight":t=Zt(t,e-j);break}}return{start:t,end:e}}function ap(t){var e=t.match(ff);return e?e[1].split(df):[]}function Cu(t,e,i){e=rn(e,t);for(var g=-1,w=e.length,F=!1;++g<w;){var j=Ue(e[g]);if(!(F=t!=null&&i(t,j)))break;t=t[j]}return F||++g!=w?F:(w=t==null?0:t.length,!!w&&di(w)&&je(j,w)&&(St(t)||bn(t)))}function op(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&Bt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function Su(t){return typeof t.constructor=="function"&&!lr(t)?Nn(Gr(t)):{}}function sp(t,e,i){var g=t.constructor;switch(e){case Yn:return Ua(t);case tt:case ct:return new g(+t);case Pn:return jh(t,i);case ki:case zi:case ji:case Vi:case Ki:case Ji:case $i:case qi:case Qi:return au(t,i);case ft:return new g;case Lt:case ut:return new g(t);case Z:return Vh(t);case rt:return new g;case ht:return Kh(t)}}function up(t,e){var i=e.length;if(!i)return t;var g=i-1;return e[g]=(i>1?"& ":"")+e[g],e=e.join(i>2?", ":" "),t.replace(lf,`{
/* [wrapped with `+e+`] */
`)}function cp(t){return St(t)||bn(t)||!!(Is&&t&&t[Is])}function je(t,e){var i=typeof t;return e=e==null?z:e,!!e&&(i=="number"||i!="symbol"&&Of.test(t))&&t>-1&&t%1==0&&t<e}function se(t,e,i){if(!Vt(i))return!1;var g=typeof e;return(g=="number"?fe(i)&&je(e,i.length):g=="string"&&e in i)?we(i[e],t):!1}function ja(t,e){if(St(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||me(t)?!0:of.test(t)||!af.test(t)||e!=null&&t in Gt(e)}function lp(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Va(t){var e=ii(t),i=D[e];if(typeof i!="function"||!(e in wt.prototype))return!1;if(t===i)return!0;var g=Wa(i);return!!g&&t===g[0]}function fp(t){return!!Ts&&Ts in t}var dp=Dr?Ve:uo;function lr(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||xn;return t===i}function Tu(t){return t===t&&!Vt(t)}function Ru(t,e){return function(i){return i==null?!1:i[t]===e&&(e!==o||t in Gt(i))}}function hp(t){var e=li(t,function(g){return i.size===l&&i.clear(),g}),i=e.cache;return e}function pp(t,e){var i=t[1],g=e[1],w=i|g,F=w<(I|M|d),j=g==d&&i==m||g==d&&i==p&&t[7].length<=e[8]||g==(d|p)&&e[7].length<=e[8]&&i==m;if(!(F||j))return t;g&I&&(t[2]=e[2],w|=i&I?0:A);var J=e[3];if(J){var Y=t[3];t[3]=Y?su(Y,J,e[4]):J,t[4]=Y?Ze(t[3],h):e[4]}return J=e[5],J&&(Y=t[5],t[5]=Y?uu(Y,J,e[6]):J,t[6]=Y?Ze(t[5],h):e[6]),J=e[7],J&&(t[7]=J),g&d&&(t[8]=t[8]==null?e[8]:ie(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=w,t}function gp(t){var e=[];if(t!=null)for(var i in Gt(t))e.push(i);return e}function vp(t){return Ur.call(t)}function Eu(t,e,i){return e=Zt(e===o?t.length-1:e,0),function(){for(var g=arguments,w=-1,F=Zt(g.length-e,0),j=et(F);++w<F;)j[w]=g[e+w];w=-1;for(var J=et(e+1);++w<e;)J[w]=g[w];return J[e]=i(j),pe(t,this,J)}}function Pu(t,e){return e.length<2?t:vn(t,Ee(e,0,-1))}function mp(t,e){for(var i=t.length,g=ie(e.length,i),w=le(t);g--;){var F=e[g];t[g]=je(F,i)?w[F]:o}return t}function Ka(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Iu=Mu(Ys),fr=xd||function(t,e){return te.setTimeout(t,e)},Ja=Mu(Hh);function _u(t,e,i){var g=e+"";return Ja(t,up(g,yp(ap(g),i)))}function Mu(t){var e=0,i=0;return function(){var g=Ud(),w=k-(g-i);if(i=g,w>0){if(++e>=L)return arguments[0]}else e=0;return t.apply(o,arguments)}}function oi(t,e){var i=-1,g=t.length,w=g-1;for(e=e===o?g:e;++i<e;){var F=_a(i,w),j=t[F];t[F]=t[i],t[i]=j}return t.length=e,t}var wu=hp(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(sf,function(i,g,w,F){e.push(w?F.replace(gf,"$1"):g||i)}),e});function Ue(t){if(typeof t=="string"||me(t))return t;var e=t+"";return e=="0"&&1/t==-x?"-0":e}function yn(t){if(t!=null){try{return Nr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function yp(t,e){return Ce(U,function(i){var g="_."+i[0];e&i[1]&&!Mr(t,g)&&t.push(g)}),t.sort()}function xu(t){if(t instanceof wt)return t.clone();var e=new Te(t.__wrapped__,t.__chain__);return e.__actions__=le(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function bp(t,e,i){(i?se(t,e,i):e===o)?e=1:e=Zt(Et(e),0);var g=t==null?0:t.length;if(!g||e<1)return[];for(var w=0,F=0,j=et(kr(g/e));w<g;)j[F++]=Ee(t,w,w+=e);return j}function Ap(t){for(var e=-1,i=t==null?0:t.length,g=0,w=[];++e<i;){var F=t[e];F&&(w[g++]=F)}return w}function Op(){var t=arguments.length;if(!t)return[];for(var e=et(t-1),i=arguments[0],g=t;g--;)e[g-1]=arguments[g];return Ye(St(i)?le(i):[i],re(e,1))}var Cp=_t(function(t,e){return $t(t)?ar(t,re(e,1,$t,!0)):[]}),Sp=_t(function(t,e){var i=Pe(e);return $t(i)&&(i=o),$t(t)?ar(t,re(e,1,$t,!0),bt(i,2)):[]}),Tp=_t(function(t,e){var i=Pe(e);return $t(i)&&(i=o),$t(t)?ar(t,re(e,1,$t,!0),o,i):[]});function Rp(t,e,i){var g=t==null?0:t.length;return g?(e=i||e===o?1:Et(e),Ee(t,e<0?0:e,g)):[]}function Ep(t,e,i){var g=t==null?0:t.length;return g?(e=i||e===o?1:Et(e),e=g-e,Ee(t,0,e<0?0:e)):[]}function Pp(t,e){return t&&t.length?Zr(t,bt(e,3),!0,!0):[]}function Ip(t,e){return t&&t.length?Zr(t,bt(e,3),!0):[]}function _p(t,e,i,g){var w=t==null?0:t.length;return w?(i&&typeof i!="number"&&se(t,e,i)&&(i=0,g=w),Oh(t,e,i,g)):[]}function Lu(t,e,i){var g=t==null?0:t.length;if(!g)return-1;var w=i==null?0:Et(i);return w<0&&(w=Zt(g+w,0)),wr(t,bt(e,3),w)}function Du(t,e,i){var g=t==null?0:t.length;if(!g)return-1;var w=g-1;return i!==o&&(w=Et(i),w=i<0?Zt(g+w,0):ie(w,g-1)),wr(t,bt(e,3),w,!0)}function Nu(t){var e=t==null?0:t.length;return e?re(t,1):[]}function Mp(t){var e=t==null?0:t.length;return e?re(t,x):[]}function wp(t,e){var i=t==null?0:t.length;return i?(e=e===o?1:Et(e),re(t,e)):[]}function xp(t){for(var e=-1,i=t==null?0:t.length,g={};++e<i;){var w=t[e];g[w[0]]=w[1]}return g}function Uu(t){return t&&t.length?t[0]:o}function Lp(t,e,i){var g=t==null?0:t.length;if(!g)return-1;var w=i==null?0:Et(i);return w<0&&(w=Zt(g+w,0)),_n(t,e,w)}function Dp(t){var e=t==null?0:t.length;return e?Ee(t,0,-1):[]}var Np=_t(function(t){var e=jt(t,Da);return e.length&&e[0]===t[0]?Ta(e):[]}),Up=_t(function(t){var e=Pe(t),i=jt(t,Da);return e===Pe(i)?e=o:i.pop(),i.length&&i[0]===t[0]?Ta(i,bt(e,2)):[]}),Bp=_t(function(t){var e=Pe(t),i=jt(t,Da);return e=typeof e=="function"?e:o,e&&i.pop(),i.length&&i[0]===t[0]?Ta(i,o,e):[]});function Fp(t,e){return t==null?"":Dd.call(t,e)}function Pe(t){var e=t==null?0:t.length;return e?t[e-1]:o}function Gp(t,e,i){var g=t==null?0:t.length;if(!g)return-1;var w=g;return i!==o&&(w=Et(i),w=w<0?Zt(g+w,0):ie(w,g-1)),e===e?yd(t,e,w):wr(t,vs,w,!0)}function Hp(t,e){return t&&t.length?Js(t,Et(e)):o}var Wp=_t(Bu);function Bu(t,e){return t&&t.length&&e&&e.length?Ia(t,e):t}function kp(t,e,i){return t&&t.length&&e&&e.length?Ia(t,e,bt(i,2)):t}function zp(t,e,i){return t&&t.length&&e&&e.length?Ia(t,e,o,i):t}var jp=ze(function(t,e){var i=t==null?0:t.length,g=Aa(t,e);return Qs(t,jt(e,function(w){return je(w,i)?+w:w}).sort(ou)),g});function Vp(t,e){var i=[];if(!(t&&t.length))return i;var g=-1,w=[],F=t.length;for(e=bt(e,3);++g<F;){var j=t[g];e(j,g,t)&&(i.push(j),w.push(g))}return Qs(t,w),i}function $a(t){return t==null?t:Fd.call(t)}function Kp(t,e,i){var g=t==null?0:t.length;return g?(i&&typeof i!="number"&&se(t,e,i)?(e=0,i=g):(e=e==null?0:Et(e),i=i===o?g:Et(i)),Ee(t,e,i)):[]}function Jp(t,e){return Yr(t,e)}function $p(t,e,i){return wa(t,e,bt(i,2))}function qp(t,e){var i=t==null?0:t.length;if(i){var g=Yr(t,e);if(g<i&&we(t[g],e))return g}return-1}function Qp(t,e){return Yr(t,e,!0)}function Yp(t,e,i){return wa(t,e,bt(i,2),!0)}function Zp(t,e){var i=t==null?0:t.length;if(i){var g=Yr(t,e,!0)-1;if(we(t[g],e))return g}return-1}function Xp(t){return t&&t.length?Zs(t):[]}function tg(t,e){return t&&t.length?Zs(t,bt(e,2)):[]}function eg(t){var e=t==null?0:t.length;return e?Ee(t,1,e):[]}function ng(t,e,i){return t&&t.length?(e=i||e===o?1:Et(e),Ee(t,0,e<0?0:e)):[]}function rg(t,e,i){var g=t==null?0:t.length;return g?(e=i||e===o?1:Et(e),e=g-e,Ee(t,e<0?0:e,g)):[]}function ig(t,e){return t&&t.length?Zr(t,bt(e,3),!1,!0):[]}function ag(t,e){return t&&t.length?Zr(t,bt(e,3)):[]}var og=_t(function(t){return nn(re(t,1,$t,!0))}),sg=_t(function(t){var e=Pe(t);return $t(e)&&(e=o),nn(re(t,1,$t,!0),bt(e,2))}),ug=_t(function(t){var e=Pe(t);return e=typeof e=="function"?e:o,nn(re(t,1,$t,!0),o,e)});function cg(t){return t&&t.length?nn(t):[]}function lg(t,e){return t&&t.length?nn(t,bt(e,2)):[]}function fg(t,e){return e=typeof e=="function"?e:o,t&&t.length?nn(t,o,e):[]}function qa(t){if(!(t&&t.length))return[];var e=0;return t=Qe(t,function(i){if($t(i))return e=Zt(i.length,e),!0}),da(e,function(i){return jt(t,ca(i))})}function Fu(t,e){if(!(t&&t.length))return[];var i=qa(t);return e==null?i:jt(i,function(g){return pe(e,o,g)})}var dg=_t(function(t,e){return $t(t)?ar(t,e):[]}),hg=_t(function(t){return La(Qe(t,$t))}),pg=_t(function(t){var e=Pe(t);return $t(e)&&(e=o),La(Qe(t,$t),bt(e,2))}),gg=_t(function(t){var e=Pe(t);return e=typeof e=="function"?e:o,La(Qe(t,$t),o,e)}),vg=_t(qa);function mg(t,e){return nu(t||[],e||[],ir)}function yg(t,e){return nu(t||[],e||[],ur)}var bg=_t(function(t){var e=t.length,i=e>1?t[e-1]:o;return i=typeof i=="function"?(t.pop(),i):o,Fu(t,i)});function Gu(t){var e=D(t);return e.__chain__=!0,e}function Ag(t,e){return e(t),t}function si(t,e){return e(t)}var Og=ze(function(t){var e=t.length,i=e?t[0]:0,g=this.__wrapped__,w=function(F){return Aa(F,t)};return e>1||this.__actions__.length||!(g instanceof wt)||!je(i)?this.thru(w):(g=g.slice(i,+i+(e?1:0)),g.__actions__.push({func:si,args:[w],thisArg:o}),new Te(g,this.__chain__).thru(function(F){return e&&!F.length&&F.push(o),F}))});function Cg(){return Gu(this)}function Sg(){return new Te(this.value(),this.__chain__)}function Tg(){this.__values__===o&&(this.__values__=Xu(this.value()));var t=this.__index__>=this.__values__.length,e=t?o:this.__values__[this.__index__++];return{done:t,value:e}}function Rg(){return this}function Eg(t){for(var e,i=this;i instanceof Kr;){var g=xu(i);g.__index__=0,g.__values__=o,e?w.__wrapped__=g:e=g;var w=g;i=i.__wrapped__}return w.__wrapped__=t,e}function Pg(){var t=this.__wrapped__;if(t instanceof wt){var e=t;return this.__actions__.length&&(e=new wt(this)),e=e.reverse(),e.__actions__.push({func:si,args:[$a],thisArg:o}),new Te(e,this.__chain__)}return this.thru($a)}function Ig(){return eu(this.__wrapped__,this.__actions__)}var _g=Xr(function(t,e,i){Bt.call(t,i)?++t[i]:We(t,i,1)});function Mg(t,e,i){var g=St(t)?ps:Ah;return i&&se(t,e,i)&&(e=o),g(t,bt(e,3))}function wg(t,e){var i=St(t)?Qe:Fs;return i(t,bt(e,3))}var xg=du(Lu),Lg=du(Du);function Dg(t,e){return re(ui(t,e),1)}function Ng(t,e){return re(ui(t,e),x)}function Ug(t,e,i){return i=i===o?1:Et(i),re(ui(t,e),i)}function Hu(t,e){var i=St(t)?Ce:en;return i(t,bt(e,3))}function Wu(t,e){var i=St(t)?ed:Bs;return i(t,bt(e,3))}var Bg=Xr(function(t,e,i){Bt.call(t,i)?t[i].push(e):We(t,i,[e])});function Fg(t,e,i,g){t=fe(t)?t:Hn(t),i=i&&!g?Et(i):0;var w=t.length;return i<0&&(i=Zt(w+i,0)),hi(t)?i<=w&&t.indexOf(e,i)>-1:!!w&&_n(t,e,i)>-1}var Gg=_t(function(t,e,i){var g=-1,w=typeof e=="function",F=fe(t)?et(t.length):[];return en(t,function(j){F[++g]=w?pe(e,j,i):or(j,e,i)}),F}),Hg=Xr(function(t,e,i){We(t,i,e)});function ui(t,e){var i=St(t)?jt:js;return i(t,bt(e,3))}function Wg(t,e,i,g){return t==null?[]:(St(e)||(e=e==null?[]:[e]),i=g?o:i,St(i)||(i=i==null?[]:[i]),$s(t,e,i))}var kg=Xr(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]});function zg(t,e,i){var g=St(t)?sa:ys,w=arguments.length<3;return g(t,bt(e,4),i,w,en)}function jg(t,e,i){var g=St(t)?nd:ys,w=arguments.length<3;return g(t,bt(e,4),i,w,Bs)}function Vg(t,e){var i=St(t)?Qe:Fs;return i(t,fi(bt(e,3)))}function Kg(t){var e=St(t)?Ls:Fh;return e(t)}function Jg(t,e,i){(i?se(t,e,i):e===o)?e=1:e=Et(e);var g=St(t)?gh:Gh;return g(t,e)}function $g(t){var e=St(t)?vh:Wh;return e(t)}function qg(t){if(t==null)return 0;if(fe(t))return hi(t)?wn(t):t.length;var e=ae(t);return e==ft||e==rt?t.size:Ea(t).length}function Qg(t,e,i){var g=St(t)?ua:kh;return i&&se(t,e,i)&&(e=o),g(t,bt(e,3))}var Yg=_t(function(t,e){if(t==null)return[];var i=e.length;return i>1&&se(t,e[0],e[1])?e=[]:i>2&&se(e[0],e[1],e[2])&&(e=[e[0]]),$s(t,re(e,1),[])}),ci=wd||function(){return te.Date.now()};function Zg(t,e){if(typeof e!="function")throw new Se(a);return t=Et(t),function(){if(--t<1)return e.apply(this,arguments)}}function ku(t,e,i){return e=i?o:e,e=t&&e==null?t.length:e,ke(t,d,o,o,o,o,e)}function zu(t,e){var i;if(typeof e!="function")throw new Se(a);return t=Et(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=o),i}}var Qa=_t(function(t,e,i){var g=I;if(i.length){var w=Ze(i,Fn(Qa));g|=c}return ke(t,g,e,i,w)}),ju=_t(function(t,e,i){var g=I|M;if(i.length){var w=Ze(i,Fn(ju));g|=c}return ke(e,g,t,i,w)});function Vu(t,e,i){e=i?o:e;var g=ke(t,m,o,o,o,o,o,e);return g.placeholder=Vu.placeholder,g}function Ku(t,e,i){e=i?o:e;var g=ke(t,E,o,o,o,o,o,e);return g.placeholder=Ku.placeholder,g}function Ju(t,e,i){var g,w,F,j,J,Y,it=0,ot=!1,st=!1,lt=!0;if(typeof t!="function")throw new Se(a);e=Ie(e)||0,Vt(i)&&(ot=!!i.leading,st="maxWait"in i,F=st?Zt(Ie(i.maxWait)||0,e):F,lt="trailing"in i?!!i.trailing:lt);function gt(qt){var xe=g,Je=w;return g=w=o,it=qt,j=t.apply(Je,xe),j}function At(qt){return it=qt,J=fr(Mt,e),ot?gt(qt):j}function It(qt){var xe=qt-Y,Je=qt-it,dc=e-xe;return st?ie(dc,F-Je):dc}function Ot(qt){var xe=qt-Y,Je=qt-it;return Y===o||xe>=e||xe<0||st&&Je>=F}function Mt(){var qt=ci();if(Ot(qt))return xt(qt);J=fr(Mt,It(qt))}function xt(qt){return J=o,lt&&g?gt(qt):(g=w=o,j)}function ye(){J!==o&&ru(J),it=0,g=Y=w=J=o}function ue(){return J===o?j:xt(ci())}function be(){var qt=ci(),xe=Ot(qt);if(g=arguments,w=this,Y=qt,xe){if(J===o)return At(Y);if(st)return ru(J),J=fr(Mt,e),gt(Y)}return J===o&&(J=fr(Mt,e)),j}return be.cancel=ye,be.flush=ue,be}var Xg=_t(function(t,e){return Us(t,1,e)}),tv=_t(function(t,e,i){return Us(t,Ie(e)||0,i)});function ev(t){return ke(t,f)}function li(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Se(a);var i=function(){var g=arguments,w=e?e.apply(this,g):g[0],F=i.cache;if(F.has(w))return F.get(w);var j=t.apply(this,g);return i.cache=F.set(w,j)||F,j};return i.cache=new(li.Cache||He),i}li.Cache=He;function fi(t){if(typeof t!="function")throw new Se(a);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function nv(t){return zu(2,t)}var rv=zh(function(t,e){e=e.length==1&&St(e[0])?jt(e[0],ge(bt())):jt(re(e,1),ge(bt()));var i=e.length;return _t(function(g){for(var w=-1,F=ie(g.length,i);++w<F;)g[w]=e[w].call(this,g[w]);return pe(t,this,g)})}),Ya=_t(function(t,e){var i=Ze(e,Fn(Ya));return ke(t,c,o,e,i)}),$u=_t(function(t,e){var i=Ze(e,Fn($u));return ke(t,v,o,e,i)}),iv=ze(function(t,e){return ke(t,p,o,o,o,e)});function av(t,e){if(typeof t!="function")throw new Se(a);return e=e===o?e:Et(e),_t(t,e)}function ov(t,e){if(typeof t!="function")throw new Se(a);return e=e==null?0:Zt(Et(e),0),_t(function(i){var g=i[e],w=an(i,0,e);return g&&Ye(w,g),pe(t,this,w)})}function sv(t,e,i){var g=!0,w=!0;if(typeof t!="function")throw new Se(a);return Vt(i)&&(g="leading"in i?!!i.leading:g,w="trailing"in i?!!i.trailing:w),Ju(t,e,{leading:g,maxWait:e,trailing:w})}function uv(t){return ku(t,1)}function cv(t,e){return Ya(Na(e),t)}function lv(){if(!arguments.length)return[];var t=arguments[0];return St(t)?t:[t]}function fv(t){return Re(t,R)}function dv(t,e){return e=typeof e=="function"?e:o,Re(t,R,e)}function hv(t){return Re(t,y|R)}function pv(t,e){return e=typeof e=="function"?e:o,Re(t,y|R,e)}function gv(t,e){return e==null||Ns(t,e,ee(e))}function we(t,e){return t===e||t!==t&&e!==e}var vv=ri(Sa),mv=ri(function(t,e){return t>=e}),bn=Ws(function(){return arguments}())?Ws:function(t){return Jt(t)&&Bt.call(t,"callee")&&!Ps.call(t,"callee")},St=et.isArray,yv=us?ge(us):Eh;function fe(t){return t!=null&&di(t.length)&&!Ve(t)}function $t(t){return Jt(t)&&fe(t)}function bv(t){return t===!0||t===!1||Jt(t)&&oe(t)==tt}var on=Ld||uo,Av=cs?ge(cs):Ph;function Ov(t){return Jt(t)&&t.nodeType===1&&!dr(t)}function Cv(t){if(t==null)return!0;if(fe(t)&&(St(t)||typeof t=="string"||typeof t.splice=="function"||on(t)||Gn(t)||bn(t)))return!t.length;var e=ae(t);if(e==ft||e==rt)return!t.size;if(lr(t))return!Ea(t).length;for(var i in t)if(Bt.call(t,i))return!1;return!0}function Sv(t,e){return sr(t,e)}function Tv(t,e,i){i=typeof i=="function"?i:o;var g=i?i(t,e):o;return g===o?sr(t,e,o,i):!!g}function Za(t){if(!Jt(t))return!1;var e=oe(t);return e==vt||e==yt||typeof t.message=="string"&&typeof t.name=="string"&&!dr(t)}function Rv(t){return typeof t=="number"&&_s(t)}function Ve(t){if(!Vt(t))return!1;var e=oe(t);return e==Rt||e==Dt||e==V||e==ce}function qu(t){return typeof t=="number"&&t==Et(t)}function di(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=z}function Vt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Jt(t){return t!=null&&typeof t=="object"}var Qu=ls?ge(ls):_h;function Ev(t,e){return t===e||Ra(t,e,ka(e))}function Pv(t,e,i){return i=typeof i=="function"?i:o,Ra(t,e,ka(e),i)}function Iv(t){return Yu(t)&&t!=+t}function _v(t){if(dp(t))throw new Ct(s);return ks(t)}function Mv(t){return t===null}function wv(t){return t==null}function Yu(t){return typeof t=="number"||Jt(t)&&oe(t)==Lt}function dr(t){if(!Jt(t)||oe(t)!=Ft)return!1;var e=Gr(t);if(e===null)return!0;var i=Bt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&Nr.call(i)==Pd}var Xa=fs?ge(fs):Mh;function xv(t){return qu(t)&&t>=-z&&t<=z}var Zu=ds?ge(ds):wh;function hi(t){return typeof t=="string"||!St(t)&&Jt(t)&&oe(t)==ut}function me(t){return typeof t=="symbol"||Jt(t)&&oe(t)==ht}var Gn=hs?ge(hs):xh;function Lv(t){return t===o}function Dv(t){return Jt(t)&&ae(t)==Qt}function Nv(t){return Jt(t)&&oe(t)==ln}var Uv=ri(Pa),Bv=ri(function(t,e){return t<=e});function Xu(t){if(!t)return[];if(fe(t))return hi(t)?_e(t):le(t);if(Xn&&t[Xn])return gd(t[Xn]());var e=ae(t),i=e==ft?pa:e==rt?xr:Hn;return i(t)}function Ke(t){if(!t)return t===0?t:0;if(t=Ie(t),t===x||t===-x){var e=t<0?-1:1;return e*W}return t===t?t:0}function Et(t){var e=Ke(t),i=e%1;return e===e?i?e-i:e:0}function tc(t){return t?gn(Et(t),0,X):0}function Ie(t){if(typeof t=="number")return t;if(me(t))return $;if(Vt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Vt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=bs(t);var i=yf.test(t);return i||Af.test(t)?Zf(t.slice(2),i?2:8):mf.test(t)?$:+t}function ec(t){return Ne(t,de(t))}function Fv(t){return t?gn(Et(t),-z,z):t===0?t:0}function Ut(t){return t==null?"":ve(t)}var Gv=Un(function(t,e){if(lr(e)||fe(e)){Ne(e,ee(e),t);return}for(var i in e)Bt.call(e,i)&&ir(t,i,e[i])}),nc=Un(function(t,e){Ne(e,de(e),t)}),pi=Un(function(t,e,i,g){Ne(e,de(e),t,g)}),Hv=Un(function(t,e,i,g){Ne(e,ee(e),t,g)}),Wv=ze(Aa);function kv(t,e){var i=Nn(t);return e==null?i:Ds(i,e)}var zv=_t(function(t,e){t=Gt(t);var i=-1,g=e.length,w=g>2?e[2]:o;for(w&&se(e[0],e[1],w)&&(g=1);++i<g;)for(var F=e[i],j=de(F),J=-1,Y=j.length;++J<Y;){var it=j[J],ot=t[it];(ot===o||we(ot,xn[it])&&!Bt.call(t,it))&&(t[it]=F[it])}return t}),jv=_t(function(t){return t.push(o,bu),pe(rc,o,t)});function Vv(t,e){return gs(t,bt(e,3),De)}function Kv(t,e){return gs(t,bt(e,3),Ca)}function Jv(t,e){return t==null?t:Oa(t,bt(e,3),de)}function $v(t,e){return t==null?t:Gs(t,bt(e,3),de)}function qv(t,e){return t&&De(t,bt(e,3))}function Qv(t,e){return t&&Ca(t,bt(e,3))}function Yv(t){return t==null?[]:qr(t,ee(t))}function Zv(t){return t==null?[]:qr(t,de(t))}function to(t,e,i){var g=t==null?o:vn(t,e);return g===o?i:g}function Xv(t,e){return t!=null&&Cu(t,e,Ch)}function eo(t,e){return t!=null&&Cu(t,e,Sh)}var tm=pu(function(t,e,i){e!=null&&typeof e.toString!="function"&&(e=Ur.call(e)),t[e]=i},ro(he)),em=pu(function(t,e,i){e!=null&&typeof e.toString!="function"&&(e=Ur.call(e)),Bt.call(t,e)?t[e].push(i):t[e]=[i]},bt),nm=_t(or);function ee(t){return fe(t)?xs(t):Ea(t)}function de(t){return fe(t)?xs(t,!0):Lh(t)}function rm(t,e){var i={};return e=bt(e,3),De(t,function(g,w,F){We(i,e(g,w,F),g)}),i}function im(t,e){var i={};return e=bt(e,3),De(t,function(g,w,F){We(i,w,e(g,w,F))}),i}var am=Un(function(t,e,i){Qr(t,e,i)}),rc=Un(function(t,e,i,g){Qr(t,e,i,g)}),om=ze(function(t,e){var i={};if(t==null)return i;var g=!1;e=jt(e,function(F){return F=rn(F,t),g||(g=F.length>1),F}),Ne(t,Ha(t),i),g&&(i=Re(i,y|T|R,tp));for(var w=e.length;w--;)xa(i,e[w]);return i});function sm(t,e){return ic(t,fi(bt(e)))}var um=ze(function(t,e){return t==null?{}:Nh(t,e)});function ic(t,e){if(t==null)return{};var i=jt(Ha(t),function(g){return[g]});return e=bt(e),qs(t,i,function(g,w){return e(g,w[0])})}function cm(t,e,i){e=rn(e,t);var g=-1,w=e.length;for(w||(w=1,t=o);++g<w;){var F=t==null?o:t[Ue(e[g])];F===o&&(g=w,F=i),t=Ve(F)?F.call(t):F}return t}function lm(t,e,i){return t==null?t:ur(t,e,i)}function fm(t,e,i,g){return g=typeof g=="function"?g:o,t==null?t:ur(t,e,i,g)}var ac=mu(ee),oc=mu(de);function dm(t,e,i){var g=St(t),w=g||on(t)||Gn(t);if(e=bt(e,4),i==null){var F=t&&t.constructor;w?i=g?new F:[]:Vt(t)?i=Ve(F)?Nn(Gr(t)):{}:i={}}return(w?Ce:De)(t,function(j,J,Y){return e(i,j,J,Y)}),i}function hm(t,e){return t==null?!0:xa(t,e)}function pm(t,e,i){return t==null?t:tu(t,e,Na(i))}function gm(t,e,i,g){return g=typeof g=="function"?g:o,t==null?t:tu(t,e,Na(i),g)}function Hn(t){return t==null?[]:ha(t,ee(t))}function vm(t){return t==null?[]:ha(t,de(t))}function mm(t,e,i){return i===o&&(i=e,e=o),i!==o&&(i=Ie(i),i=i===i?i:0),e!==o&&(e=Ie(e),e=e===e?e:0),gn(Ie(t),e,i)}function ym(t,e,i){return e=Ke(e),i===o?(i=e,e=0):i=Ke(i),t=Ie(t),Th(t,e,i)}function bm(t,e,i){if(i&&typeof i!="boolean"&&se(t,e,i)&&(e=i=o),i===o&&(typeof e=="boolean"?(i=e,e=o):typeof t=="boolean"&&(i=t,t=o)),t===o&&e===o?(t=0,e=1):(t=Ke(t),e===o?(e=t,t=0):e=Ke(e)),t>e){var g=t;t=e,e=g}if(i||t%1||e%1){var w=Ms();return ie(t+w*(e-t+Yf("1e-"+((w+"").length-1))),e)}return _a(t,e)}var Am=Bn(function(t,e,i){return e=e.toLowerCase(),t+(i?sc(e):e)});function sc(t){return no(Ut(t).toLowerCase())}function uc(t){return t=Ut(t),t&&t.replace(Cf,ld).replace(Wf,"")}function Om(t,e,i){t=Ut(t),e=ve(e);var g=t.length;i=i===o?g:gn(Et(i),0,g);var w=i;return i-=e.length,i>=0&&t.slice(i,w)==e}function Cm(t){return t=Ut(t),t&&ef.test(t)?t.replace(Go,fd):t}function Sm(t){return t=Ut(t),t&&uf.test(t)?t.replace(Yi,"\\$&"):t}var Tm=Bn(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),Rm=Bn(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),Em=fu("toLowerCase");function Pm(t,e,i){t=Ut(t),e=Et(e);var g=e?wn(t):0;if(!e||g>=e)return t;var w=(e-g)/2;return ni(zr(w),i)+t+ni(kr(w),i)}function Im(t,e,i){t=Ut(t),e=Et(e);var g=e?wn(t):0;return e&&g<e?t+ni(e-g,i):t}function _m(t,e,i){t=Ut(t),e=Et(e);var g=e?wn(t):0;return e&&g<e?ni(e-g,i)+t:t}function Mm(t,e,i){return i||e==null?e=0:e&&(e=+e),Bd(Ut(t).replace(Zi,""),e||0)}function wm(t,e,i){return(i?se(t,e,i):e===o)?e=1:e=Et(e),Ma(Ut(t),e)}function xm(){var t=arguments,e=Ut(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var Lm=Bn(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()});function Dm(t,e,i){return i&&typeof i!="number"&&se(t,e,i)&&(e=i=o),i=i===o?X:i>>>0,i?(t=Ut(t),t&&(typeof e=="string"||e!=null&&!Xa(e))&&(e=ve(e),!e&&Mn(t))?an(_e(t),0,i):t.split(e,i)):[]}var Nm=Bn(function(t,e,i){return t+(i?" ":"")+no(e)});function Um(t,e,i){return t=Ut(t),i=i==null?0:gn(Et(i),0,t.length),e=ve(e),t.slice(i,i+e.length)==e}function Bm(t,e,i){var g=D.templateSettings;i&&se(t,e,i)&&(e=o),t=Ut(t),e=pi({},e,g,yu);var w=pi({},e.imports,g.imports,yu),F=ee(w),j=ha(w,F),J,Y,it=0,ot=e.interpolate||Pr,st="__p += '",lt=ga((e.escape||Pr).source+"|"+ot.source+"|"+(ot===Ho?vf:Pr).source+"|"+(e.evaluate||Pr).source+"|$","g"),gt="//# sourceURL="+(Bt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Kf+"]")+`
`;t.replace(lt,function(Ot,Mt,xt,ye,ue,be){return xt||(xt=ye),st+=t.slice(it,be).replace(Sf,dd),Mt&&(J=!0,st+=`' +
__e(`+Mt+`) +
'`),ue&&(Y=!0,st+=`';
`+ue+`;
__p += '`),xt&&(st+=`' +
((__t = (`+xt+`)) == null ? '' : __t) +
'`),it=be+Ot.length,Ot}),st+=`';
`;var At=Bt.call(e,"variable")&&e.variable;if(!At)st=`with (obj) {
`+st+`
}
`;else if(pf.test(At))throw new Ct(O);st=(Y?st.replace(Yl,""):st).replace(Zl,"$1").replace(Xl,"$1;"),st="function("+(At||"obj")+`) {
`+(At?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+st+`return __p
}`;var It=lc(function(){return Nt(F,gt+"return "+st).apply(o,j)});if(It.source=st,Za(It))throw It;return It}function Fm(t){return Ut(t).toLowerCase()}function Gm(t){return Ut(t).toUpperCase()}function Hm(t,e,i){if(t=Ut(t),t&&(i||e===o))return bs(t);if(!t||!(e=ve(e)))return t;var g=_e(t),w=_e(e),F=As(g,w),j=Os(g,w)+1;return an(g,F,j).join("")}function Wm(t,e,i){if(t=Ut(t),t&&(i||e===o))return t.slice(0,Ss(t)+1);if(!t||!(e=ve(e)))return t;var g=_e(t),w=Os(g,_e(e))+1;return an(g,0,w).join("")}function km(t,e,i){if(t=Ut(t),t&&(i||e===o))return t.replace(Zi,"");if(!t||!(e=ve(e)))return t;var g=_e(t),w=As(g,_e(e));return an(g,w).join("")}function zm(t,e){var i=b,g=_;if(Vt(e)){var w="separator"in e?e.separator:w;i="length"in e?Et(e.length):i,g="omission"in e?ve(e.omission):g}t=Ut(t);var F=t.length;if(Mn(t)){var j=_e(t);F=j.length}if(i>=F)return t;var J=i-wn(g);if(J<1)return g;var Y=j?an(j,0,J).join(""):t.slice(0,J);if(w===o)return Y+g;if(j&&(J+=Y.length-J),Xa(w)){if(t.slice(J).search(w)){var it,ot=Y;for(w.global||(w=ga(w.source,Ut(Wo.exec(w))+"g")),w.lastIndex=0;it=w.exec(ot);)var st=it.index;Y=Y.slice(0,st===o?J:st)}}else if(t.indexOf(ve(w),J)!=J){var lt=Y.lastIndexOf(w);lt>-1&&(Y=Y.slice(0,lt))}return Y+g}function jm(t){return t=Ut(t),t&&tf.test(t)?t.replace(Fo,bd):t}var Vm=Bn(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),no=fu("toUpperCase");function cc(t,e,i){return t=Ut(t),e=i?o:e,e===o?pd(t)?Cd(t):ad(t):t.match(e)||[]}var lc=_t(function(t,e){try{return pe(t,o,e)}catch(i){return Za(i)?i:new Ct(i)}}),Km=ze(function(t,e){return Ce(e,function(i){i=Ue(i),We(t,i,Qa(t[i],t))}),t});function Jm(t){var e=t==null?0:t.length,i=bt();return t=e?jt(t,function(g){if(typeof g[1]!="function")throw new Se(a);return[i(g[0]),g[1]]}):[],_t(function(g){for(var w=-1;++w<e;){var F=t[w];if(pe(F[0],this,g))return pe(F[1],this,g)}})}function $m(t){return bh(Re(t,y))}function ro(t){return function(){return t}}function qm(t,e){return t==null||t!==t?e:t}var Qm=hu(),Ym=hu(!0);function he(t){return t}function io(t){return zs(typeof t=="function"?t:Re(t,y))}function Zm(t){return Vs(Re(t,y))}function Xm(t,e){return Ks(t,Re(e,y))}var t0=_t(function(t,e){return function(i){return or(i,t,e)}}),e0=_t(function(t,e){return function(i){return or(t,i,e)}});function ao(t,e,i){var g=ee(e),w=qr(e,g);i==null&&!(Vt(e)&&(w.length||!g.length))&&(i=e,e=t,t=this,w=qr(e,ee(e)));var F=!(Vt(i)&&"chain"in i)||!!i.chain,j=Ve(t);return Ce(w,function(J){var Y=e[J];t[J]=Y,j&&(t.prototype[J]=function(){var it=this.__chain__;if(F||it){var ot=t(this.__wrapped__),st=ot.__actions__=le(this.__actions__);return st.push({func:Y,args:arguments,thisArg:t}),ot.__chain__=it,ot}return Y.apply(t,Ye([this.value()],arguments))})}),t}function n0(){return te._===this&&(te._=Id),this}function oo(){}function r0(t){return t=Et(t),_t(function(e){return Js(e,t)})}var i0=Ba(jt),a0=Ba(ps),o0=Ba(ua);function fc(t){return ja(t)?ca(Ue(t)):Uh(t)}function s0(t){return function(e){return t==null?o:vn(t,e)}}var u0=gu(),c0=gu(!0);function so(){return[]}function uo(){return!1}function l0(){return{}}function f0(){return""}function d0(){return!0}function h0(t,e){if(t=Et(t),t<1||t>z)return[];var i=X,g=ie(t,X);e=bt(e),t-=X;for(var w=da(g,e);++i<t;)e(i);return w}function p0(t){return St(t)?jt(t,Ue):me(t)?[t]:le(wu(Ut(t)))}function g0(t){var e=++Ed;return Ut(t)+e}var v0=ei(function(t,e){return t+e},0),m0=Fa("ceil"),y0=ei(function(t,e){return t/e},1),b0=Fa("floor");function A0(t){return t&&t.length?$r(t,he,Sa):o}function O0(t,e){return t&&t.length?$r(t,bt(e,2),Sa):o}function C0(t){return ms(t,he)}function S0(t,e){return ms(t,bt(e,2))}function T0(t){return t&&t.length?$r(t,he,Pa):o}function R0(t,e){return t&&t.length?$r(t,bt(e,2),Pa):o}var E0=ei(function(t,e){return t*e},1),P0=Fa("round"),I0=ei(function(t,e){return t-e},0);function _0(t){return t&&t.length?fa(t,he):0}function M0(t,e){return t&&t.length?fa(t,bt(e,2)):0}return D.after=Zg,D.ary=ku,D.assign=Gv,D.assignIn=nc,D.assignInWith=pi,D.assignWith=Hv,D.at=Wv,D.before=zu,D.bind=Qa,D.bindAll=Km,D.bindKey=ju,D.castArray=lv,D.chain=Gu,D.chunk=bp,D.compact=Ap,D.concat=Op,D.cond=Jm,D.conforms=$m,D.constant=ro,D.countBy=_g,D.create=kv,D.curry=Vu,D.curryRight=Ku,D.debounce=Ju,D.defaults=zv,D.defaultsDeep=jv,D.defer=Xg,D.delay=tv,D.difference=Cp,D.differenceBy=Sp,D.differenceWith=Tp,D.drop=Rp,D.dropRight=Ep,D.dropRightWhile=Pp,D.dropWhile=Ip,D.fill=_p,D.filter=wg,D.flatMap=Dg,D.flatMapDeep=Ng,D.flatMapDepth=Ug,D.flatten=Nu,D.flattenDeep=Mp,D.flattenDepth=wp,D.flip=ev,D.flow=Qm,D.flowRight=Ym,D.fromPairs=xp,D.functions=Yv,D.functionsIn=Zv,D.groupBy=Bg,D.initial=Dp,D.intersection=Np,D.intersectionBy=Up,D.intersectionWith=Bp,D.invert=tm,D.invertBy=em,D.invokeMap=Gg,D.iteratee=io,D.keyBy=Hg,D.keys=ee,D.keysIn=de,D.map=ui,D.mapKeys=rm,D.mapValues=im,D.matches=Zm,D.matchesProperty=Xm,D.memoize=li,D.merge=am,D.mergeWith=rc,D.method=t0,D.methodOf=e0,D.mixin=ao,D.negate=fi,D.nthArg=r0,D.omit=om,D.omitBy=sm,D.once=nv,D.orderBy=Wg,D.over=i0,D.overArgs=rv,D.overEvery=a0,D.overSome=o0,D.partial=Ya,D.partialRight=$u,D.partition=kg,D.pick=um,D.pickBy=ic,D.property=fc,D.propertyOf=s0,D.pull=Wp,D.pullAll=Bu,D.pullAllBy=kp,D.pullAllWith=zp,D.pullAt=jp,D.range=u0,D.rangeRight=c0,D.rearg=iv,D.reject=Vg,D.remove=Vp,D.rest=av,D.reverse=$a,D.sampleSize=Jg,D.set=lm,D.setWith=fm,D.shuffle=$g,D.slice=Kp,D.sortBy=Yg,D.sortedUniq=Xp,D.sortedUniqBy=tg,D.split=Dm,D.spread=ov,D.tail=eg,D.take=ng,D.takeRight=rg,D.takeRightWhile=ig,D.takeWhile=ag,D.tap=Ag,D.throttle=sv,D.thru=si,D.toArray=Xu,D.toPairs=ac,D.toPairsIn=oc,D.toPath=p0,D.toPlainObject=ec,D.transform=dm,D.unary=uv,D.union=og,D.unionBy=sg,D.unionWith=ug,D.uniq=cg,D.uniqBy=lg,D.uniqWith=fg,D.unset=hm,D.unzip=qa,D.unzipWith=Fu,D.update=pm,D.updateWith=gm,D.values=Hn,D.valuesIn=vm,D.without=dg,D.words=cc,D.wrap=cv,D.xor=hg,D.xorBy=pg,D.xorWith=gg,D.zip=vg,D.zipObject=mg,D.zipObjectDeep=yg,D.zipWith=bg,D.entries=ac,D.entriesIn=oc,D.extend=nc,D.extendWith=pi,ao(D,D),D.add=v0,D.attempt=lc,D.camelCase=Am,D.capitalize=sc,D.ceil=m0,D.clamp=mm,D.clone=fv,D.cloneDeep=hv,D.cloneDeepWith=pv,D.cloneWith=dv,D.conformsTo=gv,D.deburr=uc,D.defaultTo=qm,D.divide=y0,D.endsWith=Om,D.eq=we,D.escape=Cm,D.escapeRegExp=Sm,D.every=Mg,D.find=xg,D.findIndex=Lu,D.findKey=Vv,D.findLast=Lg,D.findLastIndex=Du,D.findLastKey=Kv,D.floor=b0,D.forEach=Hu,D.forEachRight=Wu,D.forIn=Jv,D.forInRight=$v,D.forOwn=qv,D.forOwnRight=Qv,D.get=to,D.gt=vv,D.gte=mv,D.has=Xv,D.hasIn=eo,D.head=Uu,D.identity=he,D.includes=Fg,D.indexOf=Lp,D.inRange=ym,D.invoke=nm,D.isArguments=bn,D.isArray=St,D.isArrayBuffer=yv,D.isArrayLike=fe,D.isArrayLikeObject=$t,D.isBoolean=bv,D.isBuffer=on,D.isDate=Av,D.isElement=Ov,D.isEmpty=Cv,D.isEqual=Sv,D.isEqualWith=Tv,D.isError=Za,D.isFinite=Rv,D.isFunction=Ve,D.isInteger=qu,D.isLength=di,D.isMap=Qu,D.isMatch=Ev,D.isMatchWith=Pv,D.isNaN=Iv,D.isNative=_v,D.isNil=wv,D.isNull=Mv,D.isNumber=Yu,D.isObject=Vt,D.isObjectLike=Jt,D.isPlainObject=dr,D.isRegExp=Xa,D.isSafeInteger=xv,D.isSet=Zu,D.isString=hi,D.isSymbol=me,D.isTypedArray=Gn,D.isUndefined=Lv,D.isWeakMap=Dv,D.isWeakSet=Nv,D.join=Fp,D.kebabCase=Tm,D.last=Pe,D.lastIndexOf=Gp,D.lowerCase=Rm,D.lowerFirst=Em,D.lt=Uv,D.lte=Bv,D.max=A0,D.maxBy=O0,D.mean=C0,D.meanBy=S0,D.min=T0,D.minBy=R0,D.stubArray=so,D.stubFalse=uo,D.stubObject=l0,D.stubString=f0,D.stubTrue=d0,D.multiply=E0,D.nth=Hp,D.noConflict=n0,D.noop=oo,D.now=ci,D.pad=Pm,D.padEnd=Im,D.padStart=_m,D.parseInt=Mm,D.random=bm,D.reduce=zg,D.reduceRight=jg,D.repeat=wm,D.replace=xm,D.result=cm,D.round=P0,D.runInContext=q,D.sample=Kg,D.size=qg,D.snakeCase=Lm,D.some=Qg,D.sortedIndex=Jp,D.sortedIndexBy=$p,D.sortedIndexOf=qp,D.sortedLastIndex=Qp,D.sortedLastIndexBy=Yp,D.sortedLastIndexOf=Zp,D.startCase=Nm,D.startsWith=Um,D.subtract=I0,D.sum=_0,D.sumBy=M0,D.template=Bm,D.times=h0,D.toFinite=Ke,D.toInteger=Et,D.toLength=tc,D.toLower=Fm,D.toNumber=Ie,D.toSafeInteger=Fv,D.toString=Ut,D.toUpper=Gm,D.trim=Hm,D.trimEnd=Wm,D.trimStart=km,D.truncate=zm,D.unescape=jm,D.uniqueId=g0,D.upperCase=Vm,D.upperFirst=no,D.each=Hu,D.eachRight=Wu,D.first=Uu,ao(D,function(){var t={};return De(D,function(e,i){Bt.call(D.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),D.VERSION=r,Ce(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){D[t].placeholder=D}),Ce(["drop","take"],function(t,e){wt.prototype[t]=function(i){i=i===o?1:Zt(Et(i),0);var g=this.__filtered__&&!e?new wt(this):this.clone();return g.__filtered__?g.__takeCount__=ie(i,g.__takeCount__):g.__views__.push({size:ie(i,X),type:t+(g.__dir__<0?"Right":"")}),g},wt.prototype[t+"Right"]=function(i){return this.reverse()[t](i).reverse()}}),Ce(["filter","map","takeWhile"],function(t,e){var i=e+1,g=i==H||i==P;wt.prototype[t]=function(w){var F=this.clone();return F.__iteratees__.push({iteratee:bt(w,3),type:i}),F.__filtered__=F.__filtered__||g,F}}),Ce(["head","last"],function(t,e){var i="take"+(e?"Right":"");wt.prototype[t]=function(){return this[i](1).value()[0]}}),Ce(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");wt.prototype[t]=function(){return this.__filtered__?new wt(this):this[i](1)}}),wt.prototype.compact=function(){return this.filter(he)},wt.prototype.find=function(t){return this.filter(t).head()},wt.prototype.findLast=function(t){return this.reverse().find(t)},wt.prototype.invokeMap=_t(function(t,e){return typeof t=="function"?new wt(this):this.map(function(i){return or(i,t,e)})}),wt.prototype.reject=function(t){return this.filter(fi(bt(t)))},wt.prototype.slice=function(t,e){t=Et(t);var i=this;return i.__filtered__&&(t>0||e<0)?new wt(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==o&&(e=Et(e),i=e<0?i.dropRight(-e):i.take(e-t)),i)},wt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},wt.prototype.toArray=function(){return this.take(X)},De(wt.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),g=/^(?:head|last)$/.test(e),w=D[g?"take"+(e=="last"?"Right":""):e],F=g||/^find/.test(e);!w||(D.prototype[e]=function(){var j=this.__wrapped__,J=g?[1]:arguments,Y=j instanceof wt,it=J[0],ot=Y||St(j),st=function(Mt){var xt=w.apply(D,Ye([Mt],J));return g&&lt?xt[0]:xt};ot&&i&&typeof it=="function"&&it.length!=1&&(Y=ot=!1);var lt=this.__chain__,gt=!!this.__actions__.length,At=F&&!lt,It=Y&&!gt;if(!F&&ot){j=It?j:new wt(this);var Ot=t.apply(j,J);return Ot.__actions__.push({func:si,args:[st],thisArg:o}),new Te(Ot,lt)}return At&&It?t.apply(this,J):(Ot=this.thru(st),At?g?Ot.value()[0]:Ot.value():Ot)})}),Ce(["pop","push","shift","sort","splice","unshift"],function(t){var e=Lr[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",g=/^(?:pop|shift)$/.test(t);D.prototype[t]=function(){var w=arguments;if(g&&!this.__chain__){var F=this.value();return e.apply(St(F)?F:[],w)}return this[i](function(j){return e.apply(St(j)?j:[],w)})}}),De(wt.prototype,function(t,e){var i=D[e];if(i){var g=i.name+"";Bt.call(Dn,g)||(Dn[g]=[]),Dn[g].push({name:e,func:i})}}),Dn[ti(o,M).name]=[{name:"wrapper",func:o}],wt.prototype.clone=jd,wt.prototype.reverse=Vd,wt.prototype.value=Kd,D.prototype.at=Og,D.prototype.chain=Cg,D.prototype.commit=Sg,D.prototype.next=Tg,D.prototype.plant=Eg,D.prototype.reverse=Pg,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=Ig,D.prototype.first=D.prototype.head,Xn&&(D.prototype[Xn]=Rg),D},Xe=Sd();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(te._=Xe,define(function(){return Xe})):fn?((fn.exports=Xe)._=Xe,ia._=Xe):te._=Xe}).call($n)});var Wl=Kt((Fi,_o)=>{at();(function(r,n){typeof Fi=="object"&&typeof _o=="object"?_o.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Fi=="object"?Fi.Ably=n():r.Ably=n()})(window,function(){return function(o){var r={};function n(s){if(r[s])return r[s].exports;var a=r[s]={i:s,l:!1,exports:{}};return o[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=o,n.c=r,n.d=function(s,a,O){n.o(s,a)||Object.defineProperty(s,a,{enumerable:!0,get:O})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,a){if(a&1&&(s=n(s)),a&8||a&4&&typeof s=="object"&&s&&s.__esModule)return s;var O=Object.create(null);if(n.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:s}),a&2&&typeof s!="string")for(var C in s)n.d(O,C,function(l){return s[l]}.bind(null,C));return O},n.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(a,"a",a),a},n.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},n.p="",n(n.s=41)}([function(o,r,n){"use strict";r.__esModule=!0;var s=function(){function a(){}return a}();r.default=s},function(o,r,n){"use strict";n.r(r),n.d(r,"__extends",function(){return a}),n.d(r,"__assign",function(){return O}),n.d(r,"__rest",function(){return C}),n.d(r,"__decorate",function(){return l}),n.d(r,"__param",function(){return h}),n.d(r,"__metadata",function(){return y}),n.d(r,"__awaiter",function(){return T}),n.d(r,"__generator",function(){return R}),n.d(r,"__createBinding",function(){return u}),n.d(r,"__exportStar",function(){return S}),n.d(r,"__values",function(){return I}),n.d(r,"__read",function(){return M}),n.d(r,"__spread",function(){return A}),n.d(r,"__spreadArrays",function(){return m}),n.d(r,"__spreadArray",function(){return E}),n.d(r,"__await",function(){return c}),n.d(r,"__asyncGenerator",function(){return v}),n.d(r,"__asyncDelegator",function(){return d}),n.d(r,"__asyncValues",function(){return p}),n.d(r,"__makeTemplateObject",function(){return f}),n.d(r,"__importStar",function(){return _}),n.d(r,"__importDefault",function(){return L}),n.d(r,"__classPrivateFieldGet",function(){return k}),n.d(r,"__classPrivateFieldSet",function(){return H});var s=function(N,P){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,z){x.__proto__=z}||function(x,z){for(var W in z)Object.prototype.hasOwnProperty.call(z,W)&&(x[W]=z[W])},s(N,P)};function a(N,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");s(N,P);function x(){this.constructor=N}N.prototype=P===null?Object.create(P):(x.prototype=P.prototype,new x)}var O=function(){return O=Object.assign||function(P){for(var x,z=1,W=arguments.length;z<W;z++){x=arguments[z];for(var $ in x)Object.prototype.hasOwnProperty.call(x,$)&&(P[$]=x[$])}return P},O.apply(this,arguments)};function C(N,P){var x={};for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&P.indexOf(z)<0&&(x[z]=N[z]);if(N!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,z=Object.getOwnPropertySymbols(N);W<z.length;W++)P.indexOf(z[W])<0&&Object.prototype.propertyIsEnumerable.call(N,z[W])&&(x[z[W]]=N[z[W]]);return x}function l(N,P,x,z){var W=arguments.length,$=W<3?P:z===null?z=Object.getOwnPropertyDescriptor(P,x):z,X;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(N,P,x,z);else for(var Q=N.length-1;Q>=0;Q--)(X=N[Q])&&($=(W<3?X($):W>3?X(P,x,$):X(P,x))||$);return W>3&&$&&Object.defineProperty(P,x,$),$}function h(N,P){return function(x,z){P(x,z,N)}}function y(N,P){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(N,P)}function T(N,P,x,z){function W($){return $ instanceof x?$:new x(function(X){X($)})}return new(x||(x=Promise))(function($,X){function Q(B){try{U(z.next(B))}catch(K){X(K)}}function G(B){try{U(z.throw(B))}catch(K){X(K)}}function U(B){B.done?$(B.value):W(B.value).then(Q,G)}U((z=z.apply(N,P||[])).next())})}function R(N,P){var x={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},z,W,$,X;return X={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(X[Symbol.iterator]=function(){return this}),X;function Q(U){return function(B){return G([U,B])}}function G(U){if(z)throw new TypeError("Generator is already executing.");for(;x;)try{if(z=1,W&&($=U[0]&2?W.return:U[0]?W.throw||(($=W.return)&&$.call(W),0):W.next)&&!($=$.call(W,U[1])).done)return $;switch(W=0,$&&(U=[U[0]&2,$.value]),U[0]){case 0:case 1:$=U;break;case 4:return x.label++,{value:U[1],done:!1};case 5:x.label++,W=U[1],U=[0];continue;case 7:U=x.ops.pop(),x.trys.pop();continue;default:if($=x.trys,!($=$.length>0&&$[$.length-1])&&(U[0]===6||U[0]===2)){x=0;continue}if(U[0]===3&&(!$||U[1]>$[0]&&U[1]<$[3])){x.label=U[1];break}if(U[0]===6&&x.label<$[1]){x.label=$[1],$=U;break}if($&&x.label<$[2]){x.label=$[2],x.ops.push(U);break}$[2]&&x.ops.pop(),x.trys.pop();continue}U=P.call(N,x)}catch(B){U=[6,B],W=0}finally{z=$=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}}var u=Object.create?function(N,P,x,z){z===void 0&&(z=x),Object.defineProperty(N,z,{enumerable:!0,get:function(){return P[x]}})}:function(N,P,x,z){z===void 0&&(z=x),N[z]=P[x]};function S(N,P){for(var x in N)x!=="default"&&!Object.prototype.hasOwnProperty.call(P,x)&&u(P,N,x)}function I(N){var P=typeof Symbol=="function"&&Symbol.iterator,x=P&&N[P],z=0;if(x)return x.call(N);if(N&&typeof N.length=="number")return{next:function(){return N&&z>=N.length&&(N=void 0),{value:N&&N[z++],done:!N}}};throw new TypeError(P?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(N,P){var x=typeof Symbol=="function"&&N[Symbol.iterator];if(!x)return N;var z=x.call(N),W,$=[],X;try{for(;(P===void 0||P-- >0)&&!(W=z.next()).done;)$.push(W.value)}catch(Q){X={error:Q}}finally{try{W&&!W.done&&(x=z.return)&&x.call(z)}finally{if(X)throw X.error}}return $}function A(){for(var N=[],P=0;P<arguments.length;P++)N=N.concat(M(arguments[P]));return N}function m(){for(var N=0,P=0,x=arguments.length;P<x;P++)N+=arguments[P].length;for(var z=Array(N),W=0,P=0;P<x;P++)for(var $=arguments[P],X=0,Q=$.length;X<Q;X++,W++)z[W]=$[X];return z}function E(N,P,x){if(x||arguments.length===2)for(var z=0,W=P.length,$;z<W;z++)($||!(z in P))&&($||($=Array.prototype.slice.call(P,0,z)),$[z]=P[z]);return N.concat($||Array.prototype.slice.call(P))}function c(N){return this instanceof c?(this.v=N,this):new c(N)}function v(N,P,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=x.apply(N,P||[]),W,$=[];return W={},X("next"),X("throw"),X("return"),W[Symbol.asyncIterator]=function(){return this},W;function X(V){z[V]&&(W[V]=function(tt){return new Promise(function(ct,yt){$.push([V,tt,ct,yt])>1||Q(V,tt)})})}function Q(V,tt){try{G(z[V](tt))}catch(ct){K($[0][3],ct)}}function G(V){V.value instanceof c?Promise.resolve(V.value.v).then(U,B):K($[0][2],V)}function U(V){Q("next",V)}function B(V){Q("throw",V)}function K(V,tt){V(tt),$.shift(),$.length&&Q($[0][0],$[0][1])}}function d(N){var P,x;return P={},z("next"),z("throw",function(W){throw W}),z("return"),P[Symbol.iterator]=function(){return this},P;function z(W,$){P[W]=N[W]?function(X){return(x=!x)?{value:c(N[W](X)),done:W==="return"}:$?$(X):X}:$}}function p(N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var P=N[Symbol.asyncIterator],x;return P?P.call(N):(N=typeof I=="function"?I(N):N[Symbol.iterator](),x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x);function z($){x[$]=N[$]&&function(X){return new Promise(function(Q,G){X=N[$](X),W(Q,G,X.done,X.value)})}}function W($,X,Q,G){Promise.resolve(G).then(function(U){$({value:U,done:Q})},X)}}function f(N,P){return Object.defineProperty?Object.defineProperty(N,"raw",{value:P}):N.raw=P,N}var b=Object.create?function(N,P){Object.defineProperty(N,"default",{enumerable:!0,value:P})}:function(N,P){N.default=P};function _(N){if(N&&N.__esModule)return N;var P={};if(N!=null)for(var x in N)x!=="default"&&Object.prototype.hasOwnProperty.call(N,x)&&u(P,N,x);return b(P,N),P}function L(N){return N&&N.__esModule?N:{default:N}}function k(N,P,x,z){if(x==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof P=="function"?N!==P||!z:!P.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?z:x==="a"?z.call(N):z?z.value:P.get(N)}function H(N,P,x,z,W){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof P=="function"?N!==P||!W:!P.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?W.call(N,x):W?W.value=x:P.set(N,x),x}},function(o,r,n){"use strict";(function(s){r.__esModule=!0,r.allToUpperCase=r.allToLowerCase=r.encodeBody=r.decodeBody=r.Format=r.promisify=r.trim=r.arrChooseN=r.randomHexString=r.randomString=r.cheapRandStr=r.dataSizeBytes=r.inspectBody=r.inspectError=r.isErrorInfo=r.now=r.parseQueryString=r.toQueryString=r.arrPopRandomElement=r.defaultPostHeaders=r.defaultGetHeaders=r.allSame=r.arrEvery=r.arrFilter=r.arrMap=r.safeArrForEach=r.arrForEach=r.forInOwnNonNullProperties=r.valuesArray=r.keysArray=r.arrWithoutValue=r.arrDeleteValue=r.arrIn=r.arrIndexOf=r.arrSubtract=r.arrIntersectOb=r.arrIntersect=r.intersect=r.containsValue=r.inherits=r.prototypicalClone=r.shallowClone=r.isEmptyArg=r.isOnlyPropIn=r.isEmpty=r.isObject=r.ensureArray=r.isArray=r.copy=r.mixin=void 0,r.getGlobalObject=r.getJitterCoefficient=r.getBackoffCoefficient=void 0;var a=n(1),O=a.__importDefault(n(0)),C=a.__importDefault(n(8));function l(Z){return Math.floor(Math.random()*Z.length)}function h(Z){for(var rt=[],ut=1;ut<arguments.length;ut++)rt[ut-1]=arguments[ut];for(var ht=0;ht<rt.length;ht++){var Pt=rt[ht];if(!Pt)break;var Qt=Object.prototype.hasOwnProperty;for(var ln in Pt)(!Qt||Qt.call(Pt,ln))&&(Z[ln]=Pt[ln])}return Z}r.mixin=h;function y(Z){return h({},Z)}r.copy=y,r.isArray=Array.isArray||function(Z){return Object.prototype.toString.call(Z)=="[object Array]"};function T(Z){return I(Z)?[]:r.isArray(Z)?Z:[Z]}r.ensureArray=T;function R(Z){return Object.prototype.toString.call(Z)=="[object Object]"}r.isObject=R;function u(Z){for(var rt in Z)return!1;return!0}r.isEmpty=u;function S(Z,rt){for(var ut in Z)if(ut!==rt)return!1;return!0}r.isOnlyPropIn=S;function I(Z){return Z==null}r.isEmptyArg=I;function M(Z){var rt=new Object;for(var ut in Z)rt[ut]=Z[ut];return rt}r.shallowClone=M;function A(Z,rt){var ut=function(){function Pt(){}return Pt}();ut.prototype=Z;var ht=new ut;return rt&&h(ht,rt),ht}r.prototypicalClone=A;var m=function(Z,rt){if(O.default.Config.inherits){O.default.Config.inherits(Z,rt);return}Z.super_=rt,Z.prototype=A(rt.prototype,{constructor:Z})};r.inherits=m;function E(Z,rt){for(var ut in Z)if(Z[ut]==rt)return!0;return!1}r.containsValue=E;function c(Z,rt){return r.isArray(rt)?v(Z,rt):d(Z,rt)}r.intersect=c;function v(Z,rt){for(var ut=[],ht=0;ht<Z.length;ht++){var Pt=Z[ht];r.arrIndexOf(rt,Pt)!=-1&&ut.push(Pt)}return ut}r.arrIntersect=v;function d(Z,rt){for(var ut=[],ht=0;ht<Z.length;ht++){var Pt=Z[ht];Pt in rt&&ut.push(Pt)}return ut}r.arrIntersectOb=d;function p(Z,rt){for(var ut=[],ht=0;ht<Z.length;ht++){var Pt=Z[ht];r.arrIndexOf(rt,Pt)==-1&&ut.push(Pt)}return ut}r.arrSubtract=p,r.arrIndexOf=Array.prototype.indexOf?function(Z,rt,ut){return Z.indexOf(rt,ut)}:function(Z,rt,ut){ut=ut||0;for(var ht=Z.length;ut<ht;ut++)if(Z[ut]===rt)return ut;return-1};function f(Z,rt){return r.arrIndexOf(Z,rt)!==-1}r.arrIn=f;function b(Z,rt){var ut=r.arrIndexOf(Z,rt),ht=ut!=-1;return ht&&Z.splice(ut,1),ht}r.arrDeleteValue=b;function _(Z,rt){var ut=Z.slice();return b(ut,rt),ut}r.arrWithoutValue=_;function L(Z,rt){var ut=[];for(var ht in Z)rt&&!Object.prototype.hasOwnProperty.call(Z,ht)||ut.push(ht);return ut}r.keysArray=L;function k(Z,rt){var ut=[];for(var ht in Z)rt&&!Object.prototype.hasOwnProperty.call(Z,ht)||ut.push(Z[ht]);return ut}r.valuesArray=k;function H(Z,rt){for(var ut in Z)Object.prototype.hasOwnProperty.call(Z,ut)&&Z[ut]&&rt(ut)}r.forInOwnNonNullProperties=H,r.arrForEach=Array.prototype.forEach?function(Z,rt){Z.forEach(rt)}:function(Z,rt){for(var ut=Z.length,ht=0;ht<ut;ht++)rt(Z[ht],ht,Z)};function N(Z,rt){return r.arrForEach(Z.slice(),rt)}r.safeArrForEach=N,r.arrMap=Array.prototype.map?function(Z,rt){return Z.map(rt)}:function(Z,rt){for(var ut=[],ht=Z.length,Pt=0;Pt<ht;Pt++)ut.push(rt(Z[Pt],Pt,Z));return ut},r.arrFilter=Array.prototype.filter?function(Z,rt){return Z.filter(rt)}:function(Z,rt){for(var ut=[],ht=Z.length,Pt=0;Pt<ht;Pt++)rt(Z[Pt])&&ut.push(Z[Pt]);return ut},r.arrEvery=Array.prototype.every?function(Z,rt){return Z.every(rt)}:function(Z,rt){for(var ut=Z.length,ht=0;ht<ut;ht++)if(!rt(Z[ht],ht,Z))return!1;return!0};function P(Z,rt){if(Z.length===0)return!0;var ut=Z[0][rt];return r.arrEvery(Z,function(ht){return ht[rt]===ut})}r.allSame=P;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(Z){var rt=x[Z||Rt.json];return{accept:rt,"X-Ably-Version":C.default.apiVersion,"Ably-Agent":C.default.agent}}r.defaultGetHeaders=z;function W(Z){var rt,ut=rt=x[Z||Rt.json];return{accept:ut,"content-type":rt,"X-Ably-Version":C.default.apiVersion,"Ably-Agent":C.default.agent}}r.defaultPostHeaders=W;function $(Z){return Z.splice(l(Z),1)[0]}r.arrPopRandomElement=$;function X(Z){var rt=[];if(Z)for(var ut in Z)rt.push(encodeURIComponent(ut)+"="+encodeURIComponent(Z[ut]));return rt.length?"?"+rt.join("&"):""}r.toQueryString=X;function Q(Z){for(var rt,ut=/([^?&=]+)=?([^&]*)/g,ht={};rt=ut.exec(Z);)ht[decodeURIComponent(rt[1])]=decodeURIComponent(rt[2]);return ht}r.parseQueryString=Q,r.now=Date.now||function(){return new Date().getTime()};function G(Z){return Z.constructor.name=="ErrorInfo"}r.isErrorInfo=G;function U(Z){var rt,ut;return Z instanceof Error||((ut=(rt=Z)===null||rt===void 0?void 0:rt.constructor)===null||ut===void 0?void 0:ut.name)==="ErrorInfo"?O.default.Config.inspect(Z):Z.toString()}r.inspectError=U;function B(Z){return O.default.BufferUtils.isBuffer(Z)?Z.toString():typeof Z=="string"?Z:O.default.Config.inspect(Z)}r.inspectBody=B;function K(Z){if(O.default.BufferUtils.isBuffer(Z))return O.default.BufferUtils.byteLength(Z);if(typeof Z=="string")return O.default.Config.stringByteSize(Z);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof Z)}r.dataSizeBytes=K;function V(){return String(Math.random()).substr(2)}r.cheapRandStr=V;var tt=function(Z){if(O.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(Z);return O.default.Config.getRandomValues(rt),O.default.BufferUtils.base64Encode(rt)}for(var ut=O.default.BufferUtils.base64CharSet,ht=Math.round(Z*4/3),Pt="",Qt=0;Qt<ht;Qt++)Pt+=ut[l(ut)];return Pt};r.randomString=tt;var ct=function(Z){if(O.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(Z);return O.default.Config.getRandomValues(rt),O.default.BufferUtils.hexEncode(rt)}for(var ut=O.default.BufferUtils.hexCharSet,ht=Z*2,Pt="",Qt=0;Qt<ht;Qt++)Pt+=ut[l(ut)];return Pt};r.randomHexString=ct;function yt(Z,rt){for(var ut=Math.min(rt,Z.length),ht=Z.slice(),Pt=[],Qt=0;Qt<ut;Qt++)Pt.push($(ht));return Pt}r.arrChooseN=yt,r.trim=String.prototype.trim?function(Z){return Z.trim()}:function(Z){return Z.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function vt(Z,rt,ut){return new Promise(function(ht,Pt){Z[rt].apply(Z,a.__spreadArray(a.__spreadArray([],ut),[function(Qt,ln){Qt?Pt(Qt):ht(ln)}]))})}r.promisify=vt;var Rt;(function(Z){Z.msgpack="msgpack",Z.json="json"})(Rt=r.Format||(r.Format={}));function Dt(Z,rt){return rt=="msgpack"?O.default.Config.msgpack.decode(Z):JSON.parse(String(Z))}r.decodeBody=Dt;function ft(Z,rt){return rt=="msgpack"?O.default.Config.msgpack.encode(Z,!0):JSON.stringify(Z)}r.encodeBody=ft;function Lt(Z){return Z.map(function(rt){return rt&&rt.toLowerCase()})}r.allToLowerCase=Lt;function Xt(Z){return Z.map(function(rt){return rt&&rt.toUpperCase()})}r.allToUpperCase=Xt;function Ft(Z){return Math.min((Z+2)/3,2)}r.getBackoffCoefficient=Ft;function zt(){return 1-Math.random()*.2}r.getJitterCoefficient=zt;function ce(){return s||(typeof window!="undefined"?window:self)}r.getGlobalObject=ce}).call(this,n(12))},function(o,r,n){"use strict";(function(s){r.__esModule=!0;var a=n(1),O=a.__importDefault(n(0)),C=s||(typeof window!="undefined"?window:self),l;(function(u){u[u.None=0]="None",u[u.Error=1]="Error",u[u.Major=2]="Major",u[u.Minor=3]="Minor",u[u.Micro=4]="Micro"})(l||(l={}));function h(u,S){return(""+u).padStart(S?3:2,"0")}function y(u){return O.default.Config.logTimestamps?function(S){var I=new Date;u(h(I.getHours())+":"+h(I.getMinutes())+":"+h(I.getSeconds())+"."+h(I.getMilliseconds(),1)+" "+S)}:u}var T=function(){var u,S,I,M;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((S=(u=C==null?void 0:C.console)===null||u===void 0?void 0:u.log)===null||S===void 0?void 0:S.apply)=="function"?(I=function(){for(var A=[],m=0;m<arguments.length;m++)A[m]=arguments[m]},M=console.warn?function(){for(var A=[],m=0;m<arguments.length;m++)A[m]=arguments[m]}:I):C!=null&&C.console.log?I=M=function(){Function.prototype.apply.call(console.log,console,arguments)}:I=M=function(){},[I,M].map(y)},R=function(){function u(){u.logLevel=u.LOG_DEFAULT}return u.initLogHandlers=function(){var S=T(),I=S[0],M=S[1];this.logHandler=I,this.logErrorHandler=M},u.logLevel=l.Error,u.LOG_NONE=l.None,u.LOG_ERROR=l.Error,u.LOG_MAJOR=l.Major,u.LOG_MINOR=l.Minor,u.LOG_MICRO=l.Micro,u.LOG_DEFAULT=l.Error,u.LOG_DEBUG=l.Micro,u.logAction=function(S,I,M){u.shouldLog(S)&&(S===l.Error?u.logErrorHandler:u.logHandler)("Ably: "+I+": "+M)},u.deprecated=function(S,I){u.deprecatedWithMsg(S,"Please use '"+I+"' instead.")},u.deprecatedWithMsg=function(S,I){u.shouldLog(l.Error)&&u.logErrorHandler("Ably: Deprecation warning - '"+S+"' is deprecated and will be removed from a future version. "+I)},u.shouldLog=function(S){return S<=u.logLevel},u.setLog=function(S,I){S!==void 0&&(u.logLevel=S),I!==void 0&&(u.logHandler=u.logErrorHandler=I)},u}();r.default=R}).call(this,n(12))},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var a=s,O=a.lib,C=O.WordArray,l=C.init,h=C.init=function(y){if(y instanceof ArrayBuffer&&(y=new Uint8Array(y)),(y instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&y instanceof Uint8ClampedArray||y instanceof Int16Array||y instanceof Uint16Array||y instanceof Int32Array||y instanceof Uint32Array||y instanceof Float32Array||y instanceof Float64Array)&&(y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),y instanceof Uint8Array){for(var T=y.byteLength,R=[],u=0;u<T;u++)R[u>>>2]|=y[u]<<24-u%4*8;l.call(this,R,T)}else l.apply(this,arguments)};h.prototype=C}}(),s.lib.WordArray})},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(0)),O=s.__importStar(n(2)),C=function(){function l(h,y,T,R){this.message=h,this.code=y,this.statusCode=T,this.cause=R}return l.prototype.toString=function(){var h="["+this.constructor.name;return this.message&&(h+=": "+this.message),this.statusCode&&(h+="; statusCode="+this.statusCode),this.code&&(h+="; code="+this.code),this.cause&&(h+="; cause="+O.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(h+="; see "+this.href+" "),h+="]",h},l.fromValues=function(h){var y=h,T=y.message,R=y.code,u=y.statusCode;if(typeof T!="string"||typeof R!="number"||typeof u!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+a.default.Config.inspect(h));var S=Object.assign(new l(T,R,u),h);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S},l}();r.default=C},function(o,r,n){(function(s){(function(a,O){o.exports=r=O()})(this,function(){var a=a||function(O,C){var l;if(typeof window!="undefined"&&window.crypto&&(l=window.crypto),!l&&typeof window!="undefined"&&window.msCrypto&&(l=window.msCrypto),!l&&typeof s!="undefined"&&s.crypto&&(l=s.crypto),!l)try{l=n(44)}catch(d){}var h=function(){if(l){if(typeof l.getRandomValues=="function")try{return l.getRandomValues(new Uint32Array(1))[0]}catch(d){}if(typeof l.randomBytes=="function")try{return l.randomBytes(4).readInt32LE()}catch(d){}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function d(){}return function(p){var f;return d.prototype=p,f=new d,d.prototype=null,f}}(),T={},R=T.lib={},u=R.Base=function(){return{extend:function(d){var p=y(this);return d&&p.mixIn(d),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var p in d)d.hasOwnProperty(p)&&(this[p]=d[p]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),S=R.WordArray=u.extend({init:function(d,p){d=this.words=d||[],p!=C?this.sigBytes=p:this.sigBytes=d.length*4},toString:function(d){return(d||M).stringify(this)},concat:function(d){var p=this.words,f=d.words,b=this.sigBytes,_=d.sigBytes;if(this.clamp(),b%4)for(var L=0;L<_;L++){var k=f[L>>>2]>>>24-L%4*8&255;p[b+L>>>2]|=k<<24-(b+L)%4*8}else for(var L=0;L<_;L+=4)p[b+L>>>2]=f[L>>>2];return this.sigBytes+=_,this},clamp:function(){var d=this.words,p=this.sigBytes;d[p>>>2]&=4294967295<<32-p%4*8,d.length=O.ceil(p/4)},clone:function(){var d=u.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var p=[],f=0;f<d;f+=4)p.push(h());return new S.init(p,d)}}),I=T.enc={},M=I.Hex={stringify:function(d){for(var p=d.words,f=d.sigBytes,b=[],_=0;_<f;_++){var L=p[_>>>2]>>>24-_%4*8&255;b.push((L>>>4).toString(16)),b.push((L&15).toString(16))}return b.join("")},parse:function(d){for(var p=d.length,f=[],b=0;b<p;b+=2)f[b>>>3]|=parseInt(d.substr(b,2),16)<<24-b%8*4;return new S.init(f,p/2)}},A=I.Latin1={stringify:function(d){for(var p=d.words,f=d.sigBytes,b=[],_=0;_<f;_++){var L=p[_>>>2]>>>24-_%4*8&255;b.push(String.fromCharCode(L))}return b.join("")},parse:function(d){for(var p=d.length,f=[],b=0;b<p;b++)f[b>>>2]|=(d.charCodeAt(b)&255)<<24-b%4*8;return new S.init(f,p)}},m=I.Utf8={stringify:function(d){try{return decodeURIComponent(escape(A.stringify(d)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(d){return A.parse(unescape(encodeURIComponent(d)))}},E=R.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=m.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var p,f=this._data,b=f.words,_=f.sigBytes,L=this.blockSize,k=L*4,H=_/k;d?H=O.ceil(H):H=O.max((H|0)-this._minBufferSize,0);var N=H*L,P=O.min(N*4,_);if(N){for(var x=0;x<N;x+=L)this._doProcessBlock(b,x);p=b.splice(0,N),f.sigBytes-=P}return new S.init(p,P)},clone:function(){var d=u.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0}),c=R.Hasher=E.extend({cfg:u.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){E.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(d){return function(p,f){return new d.init(f).finalize(p)}},_createHmacHelper:function(d){return function(p,f){return new v.HMAC.init(d,f).finalize(p)}}}),v=T.algo={};return T}(Math);return a})}).call(this,n(12))},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(3)),C=s.__importDefault(n(0));function l(T,R,u){try{R.apply(T,u)}catch(S){O.default.logAction(O.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+S+"; stack = "+(S&&S.stack))}}function h(T,R,u){for(var S,I,M,A=0;A<T.length;A++)if(S=T[A],u&&(S=S[u]),a.isArray(S)){for(;(I=a.arrIndexOf(S,R))!==-1;)S.splice(I,1);u&&S.length===0&&delete T[A][u]}else if(a.isObject(S))for(M in S)Object.prototype.hasOwnProperty.call(S,M)&&a.isArray(S[M])&&h([S],R,M)}var y=function(){function T(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return T.prototype.on=function(){for(var R=this,u=[],S=0;S<arguments.length;S++)u[S]=arguments[S];if(u.length===1){var I=u[0];if(typeof I=="function")this.any.push(I);else throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(u))}if(u.length===2){var M=u[0],A=u[1];if(typeof A!="function")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(u));if(a.isEmptyArg(M))this.any.push(A);else if(a.isArray(M))M.forEach(function(E){R.on(E,A)});else{if(typeof M!="string")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(u));var m=this.events[M]||(this.events[M]=[]);m.push(A)}}},T.prototype.off=function(){for(var R,u=this,S=[],I=0;I<arguments.length;I++)S[I]=arguments[I];if(S.length==0||a.isEmptyArg(S[0])&&a.isEmptyArg(S[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var M=S[0],A=S[1],m=null,E=null;if(S.length===1||!A)typeof M=="function"?m=M:E=M;else{if(typeof A!="function")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(S));R=[M,A],E=R[0],m=R[1]}if(m&&a.isEmptyArg(E)){h([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(a.isArray(E)){E.forEach(function(c){u.off(c,m)});return}if(typeof E!="string")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(S));m?h([this.events,this.eventsOnce],m,E):(delete this.events[E],delete this.eventsOnce[E])},T.prototype.listeners=function(R){if(R){var u=this.events[R]||[];return this.eventsOnce[R]&&Array.prototype.push.apply(u,this.eventsOnce[R]),u.length?u:null}return this.any.length?this.any:null},T.prototype.emit=function(R){for(var u=[],S=1;S<arguments.length;S++)u[S-1]=arguments[S];var I={event:R},M=[];this.anyOnce.length&&(Array.prototype.push.apply(M,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(M,this.any);var A=this.eventsOnce[R];A&&(Array.prototype.push.apply(M,A),delete this.eventsOnce[R]);var m=this.events[R];m&&Array.prototype.push.apply(M,m),a.arrForEach(M,function(E){l(I,E,u)})},T.prototype.once=function(){for(var R=this,u=[],S=0;S<arguments.length;S++)u[S]=arguments[S];var I=u.length;if((I===0||I===1&&typeof u[0]!="function")&&C.default.Config.Promise){var M=u[0];if(typeof M!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(u));return new C.default.Config.Promise(function(d){R.once(M,d)})}var A=u[0],m=u[1];if(u.length===1&&typeof A=="function")this.anyOnce.push(A);else if(a.isEmptyArg(A)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(u));this.anyOnce.push(m)}else if(a.isArray(A)){var E=this,c=function(){var d=Array.prototype.slice.call(arguments);if(a.arrForEach(A,function(p){E.off(p,c)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(u));m.apply(this,d)};a.arrForEach(A,function(d){E.on(d,c)})}else{if(typeof A!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(u));var v=this.eventsOnce[A]||(this.eventsOnce[A]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(u));v.push(m)}}},T.prototype.whenState=function(R,u,S){for(var I=this,M=[],A=3;A<arguments.length;A++)M[A-3]=arguments[A];var m={event:R};if(typeof R!="string"||typeof u!="string")throw"whenState requires a valid event String argument";if(typeof S!="function"&&C.default.Config.Promise)return new C.default.Config.Promise(function(E){T.prototype.whenState.apply(I,[R,u,E].concat(M))});R===u?l(m,S,M):this.once(R,S)},T}();r.default=y},function(o,r,n){"use strict";r.__esModule=!0,r.getDefaults=r.normaliseOptions=r.objectifyOptions=r.getHosts=r.getFallbackHosts=r.environmentFallbackHosts=r.getHttpScheme=r.getPort=r.getHost=void 0;var s=n(1),a=s.__importDefault(n(0)),O=s.__importStar(n(2)),C=s.__importDefault(n(3)),l=s.__importDefault(n(5)),h=n(42),y="ably-js/"+h.version,T={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:h.version,apiVersion:"1.2",agent:y,getHost:R,getPort:u,getHttpScheme:S,environmentFallbackHosts:I,getFallbackHosts:M,getHosts:A,checkHost:m,objectifyOptions:v,normaliseOptions:d};function R(f,b,_){return _?b=b==f.restHost&&f.realtimeHost||b||f.realtimeHost:b=b||f.restHost,b}r.getHost=R;function u(f,b){return b||f.tls?f.tlsPort:f.port}r.getPort=u;function S(f){return f.tls?"https://":"http://"}r.getHttpScheme=S;function I(f){return[f+"-a-fallback.ably-realtime.com",f+"-b-fallback.ably-realtime.com",f+"-c-fallback.ably-realtime.com",f+"-d-fallback.ably-realtime.com",f+"-e-fallback.ably-realtime.com"]}r.environmentFallbackHosts=I;function M(f){var b=f.fallbackHosts,_=typeof f.httpMaxRetryCount!="undefined"?f.httpMaxRetryCount:T.httpMaxRetryCount;return b?O.arrChooseN(b,_):[]}r.getFallbackHosts=M;function A(f){return[f.restHost].concat(M(f))}r.getHosts=A;function m(f){if(typeof f!="string")throw new l.default("host must be a string; was a "+typeof f,4e4,400);if(!f.length)throw new l.default("host must not be zero-length",4e4,400)}function E(f,b,_){return f.realtimeHost?f.realtimeHost:f.restHost?(C.default.logAction(C.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+f.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+f.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),f.restHost):b?T.REALTIME_HOST:_+"-"+T.REALTIME_HOST}function c(f){var b={};for(var _ in T.TIMEOUTS)b[_]=f[_]||T.TIMEOUTS[_];return b}function v(f){return typeof f=="string"?f.indexOf(":")==-1?{token:f}:{key:f}:f}r.objectifyOptions=v;function d(f){if(f.host&&(C.default.deprecated("host","restHost"),f.restHost=f.host),f.wsHost&&(C.default.deprecated("wsHost","realtimeHost"),f.realtimeHost=f.wsHost),f.queueEvents&&(C.default.deprecated("queueEvents","queueMessages"),f.queueMessages=f.queueEvents),f.fallbackHostsUseDefault){if(f.fallbackHosts){var b="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",b),new l.default(b,4e4,400)}if(f.port||f.tlsPort){var b="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",b),new l.default(b,4e4,400)}f.environment?C.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):C.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),f.fallbackHosts=T.FALLBACK_HOSTS}f.recover===!0&&(C.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),f.recover=function(z,W){W(!0)}),typeof f.recover=="function"&&f.closeOnUnload===!0&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),f.recover=void 0),"closeOnUnload"in f||(f.closeOnUnload=!f.recover),f.transports&&O.arrIn(f.transports,"xhr")&&(C.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),O.arrDeleteValue(f.transports,"xhr"),f.transports.push("xhr_streaming")),"queueMessages"in f||(f.queueMessages=!0);var _=f.environment&&String(f.environment).toLowerCase()||T.ENVIRONMENT,L=!_||_==="production";!f.fallbackHosts&&!f.restHost&&!f.realtimeHost&&!f.port&&!f.tlsPort&&(f.fallbackHosts=L?T.FALLBACK_HOSTS:I(_));var k=f.restHost||(L?T.REST_HOST:_+"-"+T.REST_HOST),H=E(f,L,_);O.arrForEach((f.fallbackHosts||[]).concat(k,H),m),f.port=f.port||T.PORT,f.tlsPort=f.tlsPort||T.TLS_PORT,"tls"in f||(f.tls=!0);var N=c(f);if("useBinaryProtocol"in f?f.useBinaryProtocol=a.default.Config.supportsBinary&&f.useBinaryProtocol:f.useBinaryProtocol=a.default.Config.preferBinary,f.clientId){var P=f.headers=f.headers||{};P["X-Ably-ClientId"]=a.default.BufferUtils.base64Encode(a.default.BufferUtils.utf8Encode(f.clientId))}if("idempotentRestPublishing"in f||(f.idempotentRestPublishing=!0),f.promises&&!a.default.Config.Promise&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),f.promises=!1),f.agents)for(var x in f.agents)T.agent+=" "+x+"/"+f.agents[x];return s.__assign(s.__assign({},f),{useBinaryProtocol:"useBinaryProtocol"in f?a.default.Config.supportsBinary&&f.useBinaryProtocol:a.default.Config.preferBinary,realtimeHost:H,restHost:k,maxMessageSize:f.maxMessageSize||T.maxMessageSize,timeouts:N})}r.normaliseOptions=d,r.default=T;function p(f){return Object.assign(T,f)}r.getDefaults=p},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(0)),O=s.__importDefault(n(3)),C=s.__importDefault(n(5)),l=s.__importStar(n(2));function h(u){return!u||!u.channelOptions?{channelOptions:u,plugins:{},baseEncodedPreviousPayload:void 0}:u}function y(u){if(u&&u.cipher&&!u.cipher.channelCipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var S=a.default.Crypto.getCipher(u.cipher);return{cipher:S.cipherParams,channelCipher:S.cipher}}return u}function T(u){var S=0;return u.name&&(S+=u.name.length),u.clientId&&(S+=u.clientId.length),u.extras&&(S+=JSON.stringify(u.extras).length),u.data&&(S+=l.dataSizeBytes(u.data)),S}var R=function(){function u(){}return u.prototype.toJSON=function(){var S=this.encoding,I=this.data;return I&&a.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(S=S?S+"/base64":"base64",I=a.default.BufferUtils.base64Encode(I)):I=a.default.BufferUtils.toBuffer(I)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:S,data:I}},u.prototype.toString=function(){var S="[Message";return this.name&&(S+="; name="+this.name),this.id&&(S+="; id="+this.id),this.timestamp&&(S+="; timestamp="+this.timestamp),this.clientId&&(S+="; clientId="+this.clientId),this.connectionId&&(S+="; connectionId="+this.connectionId),this.encoding&&(S+="; encoding="+this.encoding),this.extras&&(S+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?S+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?S+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):S+="; data (json)="+JSON.stringify(this.data)),this.extras&&(S+="; extras="+JSON.stringify(this.extras)),S+="]",S},u.encrypt=function(S,I,M){var A=S.data,m=S.encoding,E=I.channelCipher;m=m?m+"/":"",a.default.BufferUtils.isBuffer(A)||(A=a.default.BufferUtils.utf8Encode(String(A)),m=m+"utf-8/"),E.encrypt(A,function(c,v){if(c){M(c);return}S.data=v,S.encoding=m+"cipher+"+E.algorithm,M(null,S)})},u.encode=function(S,I,M){var A=S.data,m=typeof A=="string"||a.default.BufferUtils.isBuffer(A)||A===null||A===void 0;if(!m)if(l.isObject(A)||l.isArray(A))S.data=JSON.stringify(A),S.encoding=S.encoding?S.encoding+"/json":"json";else throw new C.default("Data type is unsupported",40013,400);I!=null&&I.cipher?u.encrypt(S,I,M):M(null,S)},u.encodeArray=function(S,I,M){for(var A=0,m=0;m<S.length;m++)u.encode(S[m],I,function(E){if(E){M(E);return}A++,A==S.length&&M(null,S)})},u.decode=function(S,I){var M=h(I),A=S.data,m=S.encoding;if(m){var E=m.split("/"),c=void 0,v=E.length,d=S.data,p="";try{for(;(c=v)>0;){var f=E[--v].match(/([-\w]+)(\+([\w-]+))?/);if(!f)break;switch(p=f[1],p){case"base64":d=a.default.BufferUtils.base64Decode(String(d)),c==E.length&&(A=d);continue;case"utf-8":d=a.default.BufferUtils.utf8Decode(d);continue;case"json":d=JSON.parse(d);continue;case"cipher":if(M.channelOptions!=null&&M.channelOptions.cipher&&M.channelOptions.channelCipher){var b=f[3],_=M.channelOptions.channelCipher;if(b!=_.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");d=_.decrypt(d);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!M.plugins||!M.plugins.vcdiff)throw new C.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new C.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=M.baseEncodedPreviousPayload;typeof L=="string"&&(L=a.default.BufferUtils.utf8Encode(L)),L=a.default.BufferUtils.toBuffer(L),d=a.default.BufferUtils.toBuffer(d),d=a.default.BufferUtils.typedArrayToBuffer(M.plugins.vcdiff.decode(d,L)),A=d}catch(H){throw new C.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var k=H;throw new C.default("Error processing the "+p+" encoding, decoder returned \u2018"+k.message+"\u2019",k.code||40013,400)}finally{S.encoding=c<=0?null:E.slice(0,c).join("/"),S.data=d}}M.baseEncodedPreviousPayload=A},u.fromResponseBody=function(S,I,M){M&&(S=l.decodeBody(S,M));for(var A=0;A<S.length;A++){var m=S[A]=u.fromValues(S[A]);try{u.decode(m,I)}catch(E){O.default.logAction(O.default.LOG_ERROR,"Message.fromResponseBody()",E.toString())}}return S},u.fromValues=function(S){return Object.assign(new u,S)},u.fromValuesArray=function(S){for(var I=S.length,M=new Array(I),A=0;A<I;A++)M[A]=u.fromValues(S[A]);return M},u.fromEncoded=function(S,I){var M=u.fromValues(S),A=y(I);try{u.decode(M,A)}catch(m){O.default.logAction(O.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return M},u.fromEncodedArray=function(S,I){return y(I),S.map(function(M){return u.fromEncoded(M,I)})},u.getMessagesSize=function(S){for(var I,M=0,A=0;A<S.length;A++)I=S[A],M+=I.size||(I.size=T(I));return M},u.serialize=l.encodeBody,u}();r.default=R},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(5)),C=s.__importDefault(n(9)),l=s.__importDefault(n(14)),h={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},y=[];Object.keys(h).forEach(function(M){y[h[M]]=M});var T={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},R=Object.keys(T);T.MODE_ALL=T.PRESENCE|T.PUBLISH|T.SUBSCRIBE|T.PRESENCE_SUBSCRIBE;function u(M){var A=[];if(M)for(var m=0;m<M.length;m++)A.push(M[m].toString());return"[ "+A.join(", ")+" ]"}var S="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),I=function(){function M(){var A=this;this.hasFlag=function(m){return(A.flags&T[m])>0}}return M.prototype.setFlag=function(A){return this.flags=this.flags|T[A]},M.prototype.getMode=function(){return this.flags&&this.flags&T.MODE_ALL},M.prototype.encodeModesToFlags=function(A){var m=this;A.forEach(function(E){return m.setFlag(E)})},M.prototype.decodeModesFromFlags=function(){var A=this,m=[];return M.channelModes.forEach(function(E){A.hasFlag(E)&&m.push(E)}),m.length>0?m:void 0},M.fromValues=function(A){return Object.assign(new M,A)},M.Action=h,M.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],M.ActionName=y,M.serialize=a.encodeBody,M.deserialize=function(A,m){var E=a.decodeBody(A,m);return M.fromDeserialized(E)},M.fromDeserialized=function(A){var m=A.error;m&&(A.error=O.default.fromValues(m));var E=A.messages;if(E)for(var c=0;c<E.length;c++)E[c]=C.default.fromValues(E[c]);var v=A.presence;if(v)for(var c=0;c<v.length;c++)v[c]=l.default.fromValues(v[c],!0);return Object.assign(new M,A)},M.stringify=function(A){var m="[ProtocolMessage";A.action!==void 0&&(m+="; action="+M.ActionName[A.action]||!1);for(var E,c=0;c<S.length;c++)E=S[c],A[E]!==void 0&&(m+="; "+E+"="+A[E]);if(A.messages&&(m+="; messages="+u(C.default.fromValuesArray(A.messages))),A.presence&&(m+="; presence="+u(l.default.fromValuesArray(A.presence))),A.error&&(m+="; error="+O.default.fromValues(A.error).toString()),A.auth&&A.auth.accessToken&&(m+="; token="+A.auth.accessToken),A.flags&&(m+="; flags="+R.filter(A.hasFlag).join(",")),A.params){var v="";a.forInOwnNonNullProperties(A.params,function(d){v.length>0&&(v+="; "),v+=d+"="+A.params[d]}),v.length>0&&(m+="; params=["+v+"]")}return m+="]",m},M.isDuplicate=function(A,m){if(A&&m&&(A.action===h.MESSAGE||A.action===h.PRESENCE)&&A.action===m.action&&A.channel===m.channel&&A.id===m.id){if(A.action===h.PRESENCE)return!0;if(A.messages.length===m.messages.length){for(var E=0;E<A.messages.length;E++){var c=A.messages[E],v=m.messages[E];if((c.extras&&c.extras.delta&&c.extras.delta.format)!==(v.extras&&v.extras.delta&&v.extras.delta.format))return!1}return!0}}return!1},M}();r.default=I},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(10)),C=s.__importDefault(n(26)),l=s.__importDefault(n(3)),h=s.__importDefault(n(8)),y=s.__importDefault(n(19)),T=s.__importDefault(n(16)),R=s.__importDefault(n(5)),u=s.__importDefault(n(20)),S=s.__importDefault(n(0));function I(m){var E=[80015,80017,80030];return m.code?T.default.isTokenErr(m)?!1:a.arrIn(E,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function M(m){return I(m)?[O.default.fromValues({action:O.default.Action.ERROR,error:m})]:[O.default.fromValues({action:O.default.Action.DISCONNECTED,error:m})]}var A=function(m){s.__extends(E,m);function E(c,v,d){var p=m.call(this,c,v,d,!0)||this;return p.onAuthUpdated=function(f){p.authParams={access_token:f.token}},p.stream="stream"in d?d.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return E.prototype.connect=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","starting"),C.default.prototype.connect.call(this);var v=this.params,d=v.options,p=h.default.getHost(d,v.host),f=h.default.getPort(d),b=d.tls?"https://":"http://";this.baseUri=b+p+":"+f+"/comet/";var _=this.baseUri+"connect";l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","uri: "+_),this.auth.getAuthParams(function(L,k){if(L){c.disconnect(L);return}if(!c.isDisposed){c.authParams=k;var H=c.params.getConnectParams(k);"stream"in H&&(c.stream=H.stream),l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+a.toQueryString(H));var N=!1,P=c.recvRequest=c.createRequest(_,null,H,null,c.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV);P.on("data",function(x){!c.recvRequest||(N||(N=!0,c.emit("preconnect")),c.onData(x))}),P.on("complete",function(x){if(c.recvRequest||(x=x||new R.default("Request cancelled",80003,400)),c.recvRequest=null,!N&&!x&&(N=!0,c.emit("preconnect")),c.onActivity(),x){x.code?c.onData(M(x)):c.disconnect(x);return}S.default.Config.nextTick(function(){c.recv()})}),P.exec()}})},E.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},E.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},E.prototype._requestCloseOrDisconnect=function(c){var v=this,d=c?this.closeUri:this.disconnectUri;if(d){var p=this.createRequest(d,null,this.authParams,null,u.default.REQ_SEND);p.on("complete",function(f){f&&(l.default.logAction(l.default.LOG_ERROR,"CometTransport.request"+(c?"Close()":"Disconnect()"),"request returned err = "+a.inspectError(f)),v.finish("disconnected",f))}),p.exec()}},E.prototype.dispose=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",y.default.disconnected),S.default.Config.nextTick(function(){c.emit("disposed")}))},E.prototype.onConnect=function(c){if(!this.isDisposed){var v=c.connectionKey;C.default.prototype.onConnect.call(this,c);var d=this.baseUri+v;l.default.logAction(l.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+d+"; connectionKey = "+c.connectionKey),this.sendUri=d+"/send",this.recvUri=d+"/recv",this.closeUri=d+"/close",this.disconnectUri=d+"/disconnect"}},E.prototype.send=function(c){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(c);return}var v=this.pendingItems||[];v.push(c),this.pendingItems=null,this.sendItems(v)},E.prototype.sendAnyPending=function(){var c=this.pendingItems;!c||(this.pendingItems=null,this.sendItems(c))},E.prototype.sendItems=function(c){var v=this,d=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(c),u.default.REQ_SEND);d.on("complete",function(p,f){if(p&&l.default.logAction(l.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+a.inspectError(p)),v.sendRequest=null,p){p.code?v.onData(M(p)):v.disconnect(p);return}f&&v.onData(f),v.pendingItems&&S.default.Config.nextTick(function(){v.sendRequest||v.sendAnyPending()})}),d.exec()},E.prototype.recv=function(){var c=this;if(!this.recvRequest&&!!this.isConnected){var v=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV_POLL);v.on("data",function(d){c.onData(d)}),v.on("complete",function(d){if(c.recvRequest=null,c.onActivity(),d){d.code?c.onData(M(d)):c.disconnect(d);return}S.default.Config.nextTick(function(){c.recv()})}),v.exec()}},E.prototype.onData=function(c){try{var v=this.decodeResponse(c);if(v&&v.length)for(var d=0;d<v.length;d++)this.onProtocolMessage(O.default.fromDeserialized(v[d]))}catch(p){l.default.logAction(l.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},E.prototype.encodeRequest=function(c){return JSON.stringify(c)},E.prototype.decodeResponse=function(c){return typeof c=="string"?JSON.parse(c):c},E}(C.default);r.default=A},function(o,r){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(s){typeof window=="object"&&(n=window)}o.exports=n},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(){var a=s,O=a.lib,C=O.WordArray,l=a.enc,h=l.Base64={stringify:function(T){var R=T.words,u=T.sigBytes,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";T.clamp();for(var I=[],M=0;M<u;M+=3)for(var A=R[M>>>2]>>>24-M%4*8&255,m=R[M+1>>>2]>>>24-(M+1)%4*8&255,E=R[M+2>>>2]>>>24-(M+2)%4*8&255,c=A<<16|m<<8|E,v=0;v<4&&M+v*.75<u;v++)I.push(S.charAt(c>>>6*(3-v)&63));var d=S.charAt(64);if(d)for(;I.length%4;)I.push(d);return I.join("")},parse:function(T){var R=T.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",S=this._reverseMap;if(!S){S=this._reverseMap=[];for(var I=0;I<u.length;I++)S[u.charCodeAt(I)]=I}var M=u.charAt(64);if(M){var A=T.indexOf(M);A!==-1&&(R=A)}return y(T,R,S)}};function y(T,R,u){for(var S=[],I=0,M=0;M<R;M++)if(M%4){var A=u[T.charCodeAt(M-1)]<<M%4*2,m=u[T.charCodeAt(M)]>>>6-M%4*2,E=A|m;S[I>>>2]|=E<<24-I%4*8,I++}return C.create(S,I)}}(),s.enc.Base64})},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(3)),O=s.__importDefault(n(0)),C=s.__importDefault(n(9)),l=s.__importStar(n(2));function h(T){return y.Actions.indexOf(T)}var y=function(){function T(){}return T.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},T.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var R=this.id.split(":");return{connectionId:R[0],msgSerial:parseInt(R[1],10),index:parseInt(R[2],10)}},T.prototype.toJSON=function(){var R=this.data,u=this.encoding;return R&&O.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(u=u?u+"/base64":"base64",R=O.default.BufferUtils.base64Encode(R)):R=O.default.BufferUtils.toBuffer(R)),{clientId:this.clientId,action:h(this.action),data:R,encoding:u}},T.prototype.toString=function(){var R="[PresenceMessage";return R+="; action="+this.action,this.id&&(R+="; id="+this.id),this.timestamp&&(R+="; timestamp="+this.timestamp),this.clientId&&(R+="; clientId="+this.clientId),this.connectionId&&(R+="; connectionId="+this.connectionId),this.encoding&&(R+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?R+="; data="+this.data:O.default.BufferUtils.isBuffer(this.data)?R+="; data (buffer)="+O.default.BufferUtils.base64Encode(this.data):R+="; data (json)="+JSON.stringify(this.data)),R+="]",R},T.fromResponseBody=function(R,u,S){var I=[];S&&(R=l.decodeBody(R,S));for(var M=0;M<R.length;M++){var A=I[M]=T.fromValues(R[M],!0);try{T.decode(A,u)}catch(m){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return I},T.fromValues=function(R,u){return u&&(R.action=T.Actions[R.action]),Object.assign(new T,R)},T.fromValuesArray=function(R){for(var u=R.length,S=new Array(u),I=0;I<u;I++)S[I]=T.fromValues(R[I]);return S},T.fromEncoded=function(R,u){var S=T.fromValues(R,!0);try{T.decode(S,u)}catch(I){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromEncoded()",I.toString())}return S},T.fromEncodedArray=function(R,u){return R.map(function(S){return T.fromEncoded(S,u)})},T.Actions=["absent","present","enter","leave","update"],T.encode=C.default.encode,T.decode=C.default.decode,T.getMessagesSize=C.default.getMessagesSize,T}();r.default=y},function(o,r,n){"use strict";(function(s){r.__esModule=!0;var a=n(1),O=a.__importStar(n(2)),C=a.__importDefault(n(7)),l=a.__importDefault(n(5)),h=a.__importDefault(n(3)),y=a.__importDefault(n(8)),T=a.__importDefault(n(20)),R=a.__importDefault(n(0));function u(b,_){return O.arrIn(O.allToLowerCase(O.keysArray(_)),"x-ably-errorcode")}function S(b,_){if(u(b,_))return b.error&&l.default.fromValues(b.error)}var I=function(){},M=0,A={},m=typeof s!="undefined"&&s.XDomainRequest;function E(){var b=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return b&&Number(b[1])}function c(){var b;return m&&(b=E())&&b===10}function v(b,_){return b.getResponseHeader&&b.getResponseHeader(_)}function d(b){return b.getResponseHeader&&(b.getResponseHeader("transfer-encoding")||!b.getResponseHeader("content-length"))}function p(b){for(var _=O.trim(b.getAllResponseHeaders()).split(`\r
`),L={},k=0;k<_.length;k++){var H=_[k].split(":").map(O.trim);L[H[0].toLowerCase()]=H[1]}return L}var f=function(b){a.__extends(_,b);function _(L,k,H,N,P,x,z){var W=b.call(this)||this;return H=H||{},H.rnd=O.cheapRandStr(),c()&&!H.envelope&&(H.envelope="json"),W.uri=L+O.toQueryString(H),W.headers=k||{},W.body=N,W.method=z?z.toUpperCase():O.isEmptyArg(N)?"GET":"POST",W.requestMode=P,W.timeouts=x,W.timedOut=!1,W.requestComplete=!1,W.id=String(++M),A[W.id]=W,W}return _.createRequest=function(L,k,H,N,P,x,z){var W=x||y.default.TIMEOUTS;return new _(L,k,O.copy(H),N,P,W,z)},_.prototype.complete=function(L,k,H,N,P){this.requestComplete||(this.requestComplete=!0,!L&&k&&this.emit("data",k),this.emit("complete",L,k,H,N,P),this.dispose())},_.prototype.abort=function(){this.dispose()},_.prototype.exec=function(){var L=this,k=this.headers,H=this.requestMode==T.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,N=this.timer=setTimeout(function(){L.timedOut=!0,x.abort()},H),P=this.method,x=this.xhr=new XMLHttpRequest,z=k.accept,W=this.body,$="text";if(z?z.indexOf("application/x-msgpack")===0&&($="arraybuffer"):k.accept="application/json",W){var X=k["content-type"]||(k["content-type"]="application/json");X.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}x.open(P,this.uri,!0),x.responseType=$,"authorization"in k&&(x.withCredentials=!0);for(var Q in k)x.setRequestHeader(Q,k[Q]);var G=function(ft,Lt,Xt,Ft){var zt,ce=Lt+" (event type: "+ft.type+")";!((zt=L==null?void 0:L.xhr)===null||zt===void 0)&&zt.statusText&&(ce+=", current statusText is "+L.xhr.statusText),h.default.logAction(h.default.LOG_ERROR,"Request.on"+ft.type+"()",ce),L.complete(new l.default(ce,Xt,Ft))};x.onerror=function(ft){G(ft,"XHR error occurred",null,400)},x.onabort=function(ft){L.timedOut?G(ft,"Request aborted due to request timeout expiring",null,408):G(ft,"Request cancelled",null,400)},x.ontimeout=function(ft){G(ft,"Request timed out",null,408)};var U,B,K,V=0,tt=!1,ct=function(){if(clearTimeout(N),K=B<400,B==204){L.complete(null,null,null,null,B);return}U=L.requestMode==T.default.REQ_RECV_STREAM&&K&&d(x)},yt=function(){var ft;try{var Lt=v(x,"content-type"),Xt=Lt?Lt.indexOf("application/json")>=0:x.responseType=="text";if(Xt){var Ft=x.responseType==="arraybuffer"?R.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Ft.length?ft=JSON.parse(Ft):ft=Ft,tt=!0}else ft=x.response;ft.response!==void 0?(B=ft.statusCode,K=B<400,k=ft.headers,ft=ft.response):k=p(x)}catch(ce){L.complete(new l.default("Malformed response body from server: "+ce.message,null,400));return}if(K||O.isArray(ft)){L.complete(null,ft,k,tt,B);return}var zt=S(ft,k);zt||(zt=new l.default("Error response received from server: "+B+" body was: "+R.default.Config.inspect(ft),null,B)),L.complete(zt,ft,k,tt,B)};function vt(){for(var ft=x.responseText,Lt=ft.length-1,Xt,Ft;V<Lt&&(Xt=ft.indexOf(`
`,V))>-1;)Ft=ft.slice(V,Xt),V=Xt+1,Rt(Ft)}var Rt=function(ft){try{ft=JSON.parse(ft)}catch(Lt){L.complete(new l.default("Malformed response body from server: "+Lt.message,null,400));return}L.emit("data",ft)},Dt=function(){vt(),L.streamComplete=!0,R.default.Config.nextTick(function(){L.complete()})};x.onreadystatechange=function(){var ft=x.readyState;ft<3||x.status!==0&&(B===void 0&&(B=x.status,B===1223&&(B=204),ct()),ft==3&&U?vt():ft==4&&(U?Dt():yt()))},x.send(W)},_.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=I,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||L.abort()}delete A[this.id]},_}(C.default);r.default=f}).call(this,n(12))},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(3)),O=s.__importStar(n(2)),C=s.__importDefault(n(22)),l=s.__importDefault(n(5)),h=s.__importDefault(n(43)),y=n(13),T=n(32),R=s.__importDefault(n(17)),u=s.__importDefault(n(0)),S=Math.pow(2,17);function I(){}function M(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function A(H){return!!H.connection}function m(H){return O.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new l.default(O.inspectError(H),H.code||40170,H.statusCode||401)}var E=function(H){return u.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):y.stringify(T.parse(H))},c=function(H,N){if(u.default.Config.createHmac){var P=u.default.Config.createHmac("SHA256",N);return P.update(H),P.digest("base64")}return y.stringify(h.default(H,N))};function v(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var N={},P=O.keysArray(H,!0);if(!P)return"";P.sort();for(var x=0;x<P.length;x++)N[P[x]]=H[P[x]].sort();return JSON.stringify(N)}function d(H){if(H.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var N="authOptions must include valid authentication parameters";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",N),new Error(N)}}function p(H){return"useTokenAuth"in H&&!H.useTokenAuth}function f(H){return H.useTokenAuth||!p(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function b(H){return!H.key&&!H.authCallback&&!H.authUrl}var _=0;function L(){return _++}var k=function(){function H(N,P){if(this.authOptions={},this.client=N,this.tokenParams=P.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,f(P)){if(P.key&&!c){var x="client-side token request signing not supported";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",x),new Error(x)}b(P)&&a.default.logAction(a.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(P.defaultTokenParams,P),d(this.authOptions)}else{if(!P.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",x),new l.default(x,40160,401)}a.default.logAction(a.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(P)}}return H.prototype.authorize=function(N,P,x){var z=this,W;if(typeof N=="function"&&!x?(x=N,W=N=null):typeof P=="function"&&!x?(x=P,W=null):W=P,!x&&this.client.options.promises)return O.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new l.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(a.default.logAction(a.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),O.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(N,W,function($,X){if($){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize($),x==null||x($);return}A(z.client)?z.client.connection.connectionManager.onAuthUpdated(X,x||I):x==null||x(null,X)})},H.prototype.authorise=function(N,P,x){a.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(N,P,x)},H.prototype._forceNewToken=function(N,P,x){var z=this;this.tokenDetails=null,this._saveTokenOptions(N,P),d(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,$){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,x(W,$)})},H.prototype.requestToken=function(N,P,x){var z=this;if(typeof N=="function"&&!x?(x=N,P=N=null):typeof P=="function"&&!x&&(x=P,P=null),!x&&this.client.options.promises)return O.promisify(this,"requestToken",arguments);P=P||this.authOptions,N=N||O.copy(this.tokenParams);var W=x||I,$,X=this.client;if(P.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),$=P.authCallback;else if(P.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),$=function(V,tt){var ct=O.mixin({accept:"application/json, text/plain"},P.authHeaders),yt=P.authMethod&&P.authMethod.toLowerCase()==="post",vt,Rt=P.authUrl.indexOf("?");Rt>-1&&(vt=O.parseQueryString(P.authUrl.slice(Rt)),P.authUrl=P.authUrl.slice(0,Rt),yt||(P.authParams=O.mixin(vt,P.authParams)));var Dt=O.mixin({},P.authParams||{},V),ft=function(Ft,zt,ce,Z){var rt;if(Ft?a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+O.inspectError(Ft)):(rt=ce["content-type"],a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+rt+"; body: "+O.inspectBody(zt))),Ft||Z)return tt(Ft,zt);if(u.default.BufferUtils.isBuffer(zt)&&(zt=zt.toString()),!rt){tt(new l.default("authUrl response is missing a content-type header",40170,401));return}var ut=rt.indexOf("application/json")>-1,ht=rt.indexOf("text/plain")>-1||rt.indexOf("application/jwt")>-1;if(!ut&&!ht){tt(new l.default("authUrl responded with unacceptable content-type "+rt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ut){if(zt.length>S){tt(new l.default("authUrl response exceeded max permitted length",40170,401));return}try{zt=JSON.parse(zt)}catch(Pt){tt(new l.default("Unexpected error processing authURL response; err = "+Pt.message,40170,401));return}}tt(null,zt,rt)};if(a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+P.authUrl+"; Params: "+JSON.stringify(Dt)+"; method: "+(yt?"POST":"GET")),yt){var Lt=ct||{};Lt["content-type"]="application/x-www-form-urlencoded";var Xt=O.toQueryString(Dt).slice(1);z.client.http.doUri(R.default.Post,X,P.authUrl,Lt,Xt,vt,ft)}else z.client.http.doUri(R.default.Get,X,P.authUrl,ct||{},null,Dt,ft)};else if(P.key)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),$=function(V,tt){z.createTokenRequest(V,P,tt)};else{var Q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";a.default.logAction(a.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new l.default(Q,40171,403));return}"capability"in N&&(N.capability=v(N.capability));var G=function(V,tt){var ct=V.keyName,yt="/keys/"+ct+"/requestToken",vt=function(Dt){return X.baseUri(Dt)+yt},Rt=O.defaultPostHeaders();P.requestHeaders&&O.mixin(Rt,P.requestHeaders),a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+yt+"; Token params: "+JSON.stringify(V)),z.client.http.do(R.default.Post,X,vt,Rt,JSON.stringify(V),null,tt)},U=!1,B=this.client.options.timeouts.realtimeRequestTimeout,K=setTimeout(function(){U=!0;var V="Token request callback timed out after "+B/1e3+" seconds";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",V),W(new l.default(V,40170,401))},B);$(N,function(V,tt,ct){if(!U){if(clearTimeout(K),V){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+O.inspectError(V)),W(m(V));return}if(typeof tt=="string"){tt.length===0?W(new l.default("Token string is empty",40170,401)):tt.length>S?W(new l.default("Token string exceeded max permitted length (was "+tt.length+" bytes)",40170,401)):tt==="undefined"||tt==="null"?W(new l.default("Token string was literal null/undefined",40170,401)):tt[0]==="{"&&!(ct&&ct.indexOf("application/jwt")>-1)?W(new l.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:tt});return}if(typeof tt!="object"){var yt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof tt;a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",yt),W(new l.default(yt,40170,401));return}var vt=JSON.stringify(tt).length;if(vt>S&&!P.suppressMaxLengthCheck){W(new l.default("Token request/details object exceeded max permitted stringified size (was "+vt+" bytes)",40170,401));return}if("issued"in tt){W(null,tt);return}if(!("keyName"in tt)){var yt="Expected token request callback to call back with a token string, token request object, or token details object";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",yt),W(new l.default(yt,40170,401));return}G(tt,function(Rt,Dt,ft,Lt){if(Rt){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+O.inspectError(Rt)),W(m(Rt));return}Lt||(Dt=JSON.parse(Dt)),a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,Dt)})}})},H.prototype.createTokenRequest=function(N,P,x){var z=this;if(typeof N=="function"&&!x?(x=N,P=N=null):typeof P=="function"&&!x&&(x=P,P=null),!x&&this.client.options.promises)return O.promisify(this,"createTokenRequest",arguments);P=P||this.authOptions,N=N||O.copy(this.tokenParams);var W=P.key;if(!W){x(new l.default("No key specified",40101,403));return}var $=W.split(":"),X=$[0],Q=$[1];if(!Q){x(new l.default("Invalid key specified",40101,403));return}if(N.clientId===""){x(new l.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in N&&(N.capability=v(N.capability));var G=O.mixin({keyName:X},N),U=N.clientId||"",B=N.ttl||"",K=N.capability||"";(function(V){if(G.timestamp){V();return}z.getTimestamp(P&&P.queryTime,function(tt,ct){if(tt){x(tt);return}G.timestamp=ct,V()})})(function(){var V=G.nonce||(G.nonce=M()),tt=G.timestamp,ct=G.keyName+`
`+B+`
`+K+`
`+U+`
`+tt+`
`+V+`
`;G.mac=G.mac||c(ct,Q),a.default.logAction(a.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(N){this.method=="basic"?N(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(P,x){if(P){N(P);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(N){this.method=="basic"?N(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(P,x){if(P){N(P);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{authorization:"Bearer "+E(x.token)})})},H.prototype.getTimestamp=function(N,P){!this.isTimeOffsetSet()&&(N||this.authOptions.queryTime)?this.client.time(P):P(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return O.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(N){this.method="basic",this.key=N.key,this.basicKey=E(N.key),this.authOptions=N||{},"clientId"in N&&this._userSetClientId(N.clientId)},H.prototype._saveTokenOptions=function(N,P){this.method="token",N&&(this.tokenParams=N),P&&(P.token&&(P.tokenDetails=typeof P.token=="string"?{token:P.token}:P.token),P.tokenDetails&&(this.tokenDetails=P.tokenDetails),"clientId"in P&&this._userSetClientId(P.clientId),this.authOptions=P)},H.prototype._ensureValidAuthCredentials=function(N,P){var x=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){P(new l.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),P(null,z);return}a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=C.default.create())).push(P),!(this.currentTokenRequestId!==null&&!N)){var W=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function($,X){if(x.currentTokenRequestId>W){a.default.logAction(a.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var Q=x.waitingForTokenRequest||I;if(x.waitingForTokenRequest=null,$){Q($);return}Q(null,x.tokenDetails=X)})}},H.prototype._userSetClientId=function(N){if(typeof N=="string"||N===null){if(N==="*")throw new l.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var P=this._uncheckedSetClientId(N);if(P)throw P}else throw new l.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(N){if(this._tokenClientIdMismatch(N)){var P="Unexpected clientId mismatch: client has "+this.clientId+", requested "+N,x=new l.default(P,40102,401);return a.default.logAction(a.default.LOG_ERROR,"Auth._uncheckedSetClientId()",P),x}else return this.clientId=this.tokenParams.clientId=N,null},H.prototype._tokenClientIdMismatch=function(N){return!!(this.clientId&&this.clientId!=="*"&&N&&N!=="*"&&this.clientId!==N)},H.isTokenErr=function(N){return N.code&&N.code>=40140&&N.code<40150},H}();r.default=k},function(o,r,n){"use strict";r.__esModule=!0;var s;(function(a){a.Get="get",a.Delete="delete",a.Post="post",a.Put="put",a.Patch="patch"})(s||(s={})),r.default=s},function(o,r,n){"use strict";r.__esModule=!0,r.HttpPaginatedResponse=r.PaginatedResult=void 0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(3)),C=s.__importDefault(n(24));function l(S){var I=S.match(/^\.\/(\w+)\?(.*)$/);return I&&I[2]&&a.parseQueryString(I[2])}function h(S){typeof S=="string"&&(S=S.split(","));for(var I={},M=0;M<S.length;M++){var A=S[M].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(A){var m=l(A[1]);m&&(I[A[2]]=m)}}return I}function y(S,I,M){return!(M&&(I||typeof S.code=="number"))}var T=function(){function S(I,M,A,m,E,c){this.rest=I,this.path=M,this.headers=A,this.envelope=m!=null?m:null,this.bodyHandler=E,this.useHttpPaginatedResponse=c||!1}return S.prototype.get=function(I,M){var A=this;C.default.get(this.rest,this.path,this.headers,I,this.envelope,function(m,E,c,v,d){A.handlePage(m,E,c,v,d,M)})},S.prototype.delete=function(I,M){var A=this;C.default.delete(this.rest,this.path,this.headers,I,this.envelope,function(m,E,c,v,d){A.handlePage(m,E,c,v,d,M)})},S.prototype.post=function(I,M,A){var m=this;C.default.post(this.rest,this.path,M,this.headers,I,this.envelope,function(E,c,v,d,p){A&&m.handlePage(E,c,v,d,p,A)})},S.prototype.put=function(I,M,A){var m=this;C.default.put(this.rest,this.path,M,this.headers,I,this.envelope,function(E,c,v,d,p){A&&m.handlePage(E,c,v,d,p,A)})},S.prototype.patch=function(I,M,A){var m=this;C.default.patch(this.rest,this.path,M,this.headers,I,this.envelope,function(E,c,v,d,p){A&&m.handlePage(E,c,v,d,p,A)})},S.prototype.handlePage=function(I,M,A,m,E,c){if(I&&y(I,M,this.useHttpPaginatedResponse)){O.default.logAction(O.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+a.inspectError(I)),c==null||c(I);return}var v,d,p;try{v=this.bodyHandler(M,A||{},m)}catch(f){c==null||c(I||f);return}A&&(d=A.Link||A.link)&&(p=h(d)),this.useHttpPaginatedResponse?c(null,new u(this,v,A||{},E,p,I)):c(null,new R(this,v,p))},S}(),R=function(){function S(I,M,A){var m=this;this.resource=I,this.items=M;var E=this;A&&("first"in A&&(this.first=function(c){if(!c&&E.resource.rest.options.promises)return a.promisify(E,"first",[]);E.get(A.first,c)}),"current"in A&&(this.current=function(c){if(!c&&E.resource.rest.options.promises)return a.promisify(E,"current",[]);E.get(A.current,c)}),this.next=function(c){if(!c&&E.resource.rest.options.promises)return a.promisify(E,"next",[]);"next"in A?E.get(A.next,c):c(null)},this.hasNext=function(){return"next"in A},this.isLast=function(){var c;return!(!((c=m.hasNext)===null||c===void 0)&&c.call(m))})}return S.prototype.get=function(I,M){var A=this.resource;C.default.get(A.rest,A.path,A.headers,I,A.envelope,function(m,E,c,v,d){A.handlePage(m,E,c,v,d,M)})},S}();r.PaginatedResult=R;var u=function(S){s.__extends(I,S);function I(M,A,m,E,c,v){var d=S.call(this,M,A,c)||this;return d.statusCode=E,d.success=E<300&&E>=200,d.headers=m,d.errorCode=v&&v.code,d.errorMessage=v&&v.message,d}return I.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},I}(R);r.HttpPaginatedResponse=u,r.default=T},function(o,r,n){"use strict";r.__esModule=!0,r.isRetriable=void 0;var s=n(1),a=s.__importDefault(n(5)),O={disconnected:a.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:a.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:a.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:a.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:a.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:a.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:a.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function C(l){if(!l.statusCode||!l.code||l.statusCode>=500)return!0;var h=!1;return Object.values(O).forEach(function(y){y.code&&y.code==l.code&&(h=!0)}),h}r.isRetriable=C,r.default=O},function(o,r,n){"use strict";r.__esModule=!0;var s;(function(a){a[a.REQ_SEND=0]="REQ_SEND",a[a.REQ_RECV=1]="REQ_RECV",a[a.REQ_RECV_POLL=2]="REQ_RECV_POLL",a[a.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),r.default=s},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(s){return s})},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(3)),O=function(){function C(l){this.members=l||[]}return C.prototype.call=function(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];for(var y=0,T=this.members;y<T.length;y++){var R=T[y];if(R)try{R.apply(void 0,l)}catch(u){a.default.logAction(a.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+u+"; stack = "+u.stack)}}},C.prototype.push=function(){for(var l,h=[],y=0;y<arguments.length;y++)h[y]=arguments[y];(l=this.members).push.apply(l,h)},C.create=function(l){var h=new C(l);return Object.assign(function(){for(var y=[],T=0;T<arguments.length;T++)y[T]=arguments[T];return h.call.apply(h,y)},{push:function(y){return h.push(y)}})},C}();r.default=O},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){(function(){var a=s,O=a.lib,C=O.Base,l=a.enc,h=l.Utf8,y=a.algo,T=y.HMAC=C.extend({init:function(R,u){R=this._hasher=new R.init,typeof u=="string"&&(u=h.parse(u));var S=R.blockSize,I=S*4;u.sigBytes>I&&(u=R.finalize(u)),u.clamp();for(var M=this._oKey=u.clone(),A=this._iKey=u.clone(),m=M.words,E=A.words,c=0;c<S;c++)m[c]^=1549556828,E[c]^=909522486;M.sigBytes=A.sigBytes=I,this.reset()},reset:function(){var R=this._hasher;R.reset(),R.update(this._iKey)},update:function(R){return this._hasher.update(R),this},finalize:function(R){var u=this._hasher,S=u.finalize(R);u.reset();var I=u.finalize(this._oKey.clone().concat(S));return I}})})()})},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(0)),O=s.__importStar(n(2)),C=s.__importDefault(n(3)),l=s.__importDefault(n(16)),h=s.__importDefault(n(17)),y=s.__importDefault(n(5));function T(A,m,E,c,v){A.http.supportsAuthHeaders?A.auth.getAuthHeaders(function(d,p){d?c(d):v(O.mixin(p,m),E)}):A.auth.getAuthParams(function(d,p){d?c(d):v(m,O.mixin(p,E))})}function R(A,m){return function(E,c,v,d,p){if(E&&!c){A(E);return}if(!d)try{c=O.decodeBody(c,m)}catch(H){A(H);return}if(!c){A(new y.default("unenvelope(): Response body is missing",null));return}var f=c,b=f.statusCode,_=f.response,L=f.headers;if(b===void 0){A(E,c,v,!0,p);return}if(b<200||b>=300){var k=_&&_.error||E;k||(k=new Error("Error in unenveloping "+c),k.statusCode=b),A(k,_,L,!0,b);return}A(E,_,L,!0,b)}}function u(A){var m=[];if(A)for(var E in A)m.push(E+"="+A[E]);return m.join("&")}function S(A,m){return A+(m?"?":"")+u(m)}function I(A,m,E,c){return function(v,d,p,f,b){v?C.default.logAction(C.default.LOG_MICRO,"Resource."+m+"()","Received Error; "+S(E,c)+"; Error: "+O.inspectError(v)):C.default.logAction(C.default.LOG_MICRO,"Resource."+m+"()","Received; "+S(E,c)+"; Headers: "+u(p)+"; StatusCode: "+b+"; Body: "+(a.default.BufferUtils.isBuffer(d)?d.toString():d)),A&&A(v,d,p,f,b)}}var M=function(){function A(){}return A.get=function(m,E,c,v,d,p){A.do(h.default.Get,m,E,null,c,v,d,p)},A.delete=function(m,E,c,v,d,p){A.do(h.default.Delete,m,E,null,c,v,d,p)},A.post=function(m,E,c,v,d,p,f){A.do(h.default.Post,m,E,c,v,d,p,f)},A.patch=function(m,E,c,v,d,p,f){A.do(h.default.Patch,m,E,c,v,d,p,f)},A.put=function(m,E,c,v,d,p,f){A.do(h.default.Put,m,E,c,v,d,p,f)},A.do=function(m,E,c,v,d,p,f,b){C.default.shouldLog(C.default.LOG_MICRO)&&(b=I(b,m,c,p)),f&&(b=b&&R(b,f),(p=p||{}).envelope=f);function _(L,k){var H;if(C.default.shouldLog(C.default.LOG_MICRO)&&C.default.logAction(C.default.LOG_MICRO,"Resource."+m+"()","Sending; "+S(c,k)),C.default.shouldLog(C.default.LOG_MICRO)){var N=v;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{N=a.default.Config.msgpack.decode(v)}catch(P){C.default.logAction(C.default.LOG_MICRO,"Resource."+m+"()","Sending MsgPack Decoding Error: "+O.inspectError(P))}C.default.logAction(C.default.LOG_MICRO,"Resource."+m+"()","Sending; "+S(c,k)+"; Body: "+N)}E.http.do(m,E,c,L,v,k,function(P,x,z,W,$){if(P&&l.default.isTokenErr(P)){E.auth.authorize(null,null,function(X){if(X){b(X);return}T(E,z,k,b,_)});return}b(P,x,z,W,$)})}T(E,d,p,b,_)},A}();r.default=M},function(o,r,n){"use strict";(function(s){r.__esModule=!0,r.TransportParams=void 0;var a=n(1),O=a.__importDefault(n(10)),C=a.__importStar(n(2)),l=a.__importStar(n(51)),h=a.__importDefault(n(8)),y=a.__importDefault(n(0)),T=a.__importDefault(n(7)),R=a.__importDefault(n(35)),u=a.__importDefault(n(3)),S=a.__importDefault(n(36)),I=a.__importStar(n(19)),M=a.__importDefault(n(5)),A=a.__importDefault(n(16)),m=a.__importDefault(n(9)),E=a.__importDefault(n(22)),c=a.__importDefault(n(52)),v=a.__importDefault(n(26)),d=a.__importDefault(n(53)),p=function(){var X;return typeof y.default.WebStorage!="undefined"&&((X=y.default.WebStorage)===null||X===void 0?void 0:X.localSupported)},f=function(){var X;return typeof y.default.WebStorage!="undefined"&&((X=y.default.WebStorage)===null||X===void 0?void 0:X.sessionSupported)},b=O.default.Action,_=function(){},L="ably-transport-preference",k="ably-connection-recovery";function H(){var X,Q;return f()&&((Q=(X=y.default.WebStorage)===null||X===void 0?void 0:X.getSession)===null||Q===void 0?void 0:Q.call(X,k))}function N(X){var Q,G;return f()&&((G=(Q=y.default.WebStorage)===null||Q===void 0?void 0:Q.setSession)===null||G===void 0?void 0:G.call(Q,k,X))}function P(){var X,Q;return f()&&((Q=(X=y.default.WebStorage)===null||X===void 0?void 0:X.removeSession)===null||Q===void 0?void 0:Q.call(X,k))}function x(X,Q){return C.arrIndexOf(y.default.Defaults.transportPreferenceOrder,X.shortName)>C.arrIndexOf(y.default.Defaults.transportPreferenceOrder,Q.shortName)}function z(X,Q,G){var U;if(X.channel!==Q.channel||(U=X.action)!==b.PRESENCE&&U!==b.MESSAGE||U!==Q.action)return!1;var B=U===b.PRESENCE?"presence":"messages",K=X[B].concat(Q[B]),V=m.default.getMessagesSize(K);return V>G||!C.allSame(K,"clientId")||!C.arrEvery(K,function(tt){return!tt.id})?!1:(X[B]=K,!0)}var W=function(){function X(Q,G,U,B){this.options=Q,this.host=G,this.mode=U,this.connectionKey=B,this.format=Q.useBinaryProtocol?C.Format.msgpack:C.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return X.prototype.getConnectParams=function(Q){var G=Q?C.copy(Q):{},U=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var B=U.recover.split(":");if(B){G.recover=B[0];var K=B[1];isNaN(Number(K))?G.timeSerial=K:G.connectionSerial=K}break}default:}return U.clientId!==void 0&&(G.clientId=U.clientId),U.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=h.default.apiVersion,G.agent=encodeURIComponent(h.default.agent),U.transportParams!==void 0&&C.mixin(G,U.transportParams),G},X.prototype.toString=function(){var Q="[mode="+this.mode;return this.host&&(Q+=",host="+this.host),this.connectionKey&&(Q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Q+=",timeSerial="+this.timeSerial),this.format&&(Q+=",format="+this.format),Q+="]",Q},X}();r.TransportParams=W;var $=function(X){a.__extends(Q,X);function Q(G,U){var B=X.call(this)||this;B.disconnectedRetryCount=0,Q.initTransports(),B.realtime=G,B.options=U;var K=U.timeouts,V=K.preferenceConnectTimeout+K.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:K.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new R.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.timeSerial=void 0,B.connectionSerial=void 0,B.connectionStateTtl=K.connectionStateTtl,B.maxIdleInterval=null,B.transports=C.intersect(U.transports||h.default.defaultTransports,Q.supportedTransports),B.baseTransport=C.intersect(h.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=C.intersect(B.transports,h.default.upgradeTransports),B.transportPreference=null,B.httpHosts=h.default.getHosts(U),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.mostRecentMsg=null,B.forceFallbackHost=!1,B.connectCounter=0,u.default.logAction(u.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(U.transports||h.default.defaultTransports)+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var tt="no requested transports available";throw u.default.logAction(u.default.LOG_ERROR,"realtime.ConnectionManager()",tt),new Error(tt)}var ct=y.default.Config.addEventListener;return ct&&(f()&&typeof U.recover=="function"&&ct("beforeunload",B.persistConnection.bind(B)),U.closeOnUnload===!0&&ct("beforeunload",function(){u.default.logAction(u.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),ct("online",function(){(B.state==B.states.disconnected||B.state==B.states.suspended)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),B.requestState({state:"connecting"}))}),ct("offline",function(){B.state==B.states.connected&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),B.disconnectAllTransports())})),B}return Q.initTransports=function(){c.default(Q),C.arrForEach(y.default.Transports,function(G){G(Q)})},Q.prototype.createTransportParams=function(G,U){var B=new W(this.options,G,U,this.connectionKey);return this.timeSerial?B.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(B.connectionSerial=this.connectionSerial),B},Q.prototype.getTransportParams=function(G){var U=this,B=function(K){if(U.connectionKey){K("resume");return}if(typeof U.options.recover=="string"){K("recover");return}var V=U.options.recover,tt=H();if(tt&&typeof V=="function"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(tt,function(ct){ct?(U.options.recover=tt.recoveryKey,K("recover")):K("clean")});return}K("clean")};B(function(K){var V=U.createTransportParams(null,K);if(K==="recover"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+U.options.recover);var tt=U.options.recover.split(":");tt&&tt[2]&&(U.msgSerial=Number(tt[2]))}else u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());G(V)})},Q.prototype.tryATransport=function(G,U,B){var K=this;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+U),v.default.tryConnect(Q.supportedTransports[U],this,this.realtime.auth,G,function(V,tt){var ct=K.state;if(ct==K.states.closing||ct==K.states.closed||ct==K.states.failed){tt&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ct.state+" while we were attempting the transport; closing "+tt),tt.close()),B(!0);return}if(V){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+U+" "+V.event+", err: "+V.error.toString()),A.default.isTokenErr(V.error)&&!(K.errorReason&&A.default.isTokenErr(K.errorReason))?(K.errorReason=V.error,K.realtime.auth._forceNewToken(null,null,function(yt){if(yt){K.actOnErrorFromAuthorize(yt);return}K.tryATransport(G,U,B)})):V.event==="failed"?(K.notifyState({state:"failed",error:V.error}),B(!0)):V.event==="disconnected"&&(I.isRetriable(V.error)?B(!1):(K.notifyState({state:K.states.connecting.failState,error:V.error}),B(!0)));return}u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+U+"; setting pending"),K.setTransportPending(tt,G),B(null,tt)})},Q.prototype.setTransportPending=function(G,U){var B=this,K=U.mode;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+K),C.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var V=y.default.Defaults.transportPreferenceOrder[y.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ct,yt,vt,Rt){K=="upgrade"?G.shortName!==V&&C.arrIn(B.getUpgradePossibilities(),V)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(ct,G,yt,vt,Rt)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(ct,G,yt,vt,Rt):(B.activateTransport(ct,G,yt,vt,Rt),y.default.Config.nextTick(function(){B.connectImpl(U)})),K==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var tt=this;G.on(["disconnected","closed","failed"],function(ct){tt.deactivateTransport(G,this.event,ct)}),this.emit("transport.pending",G)},Q.prototype.scheduleTransportActivation=function(G,U,B,K,V){var tt=this,ct=this.activeProtocol&&this.activeProtocol.getTransport(),yt=function(){U.disconnect(),C.arrDeleteValue(tt.pendingTransports,U)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),yt();return}if(ct&&!x(U,ct)){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+" is no better than current active transport "+ct.shortName+" - abandoning upgrade"),yt();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+U);var vt=function(Rt){var Dt;if(Rt){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+U+"; err = "+Rt);return}if(!U.isConnected){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+"is no longer connected; abandoning upgrade"),yt();return}if(tt.state===tt.states.connected)u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),tt.state=tt.states.synchronizing,Dt=tt.activeProtocol;else if(tt.state!==tt.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+tt.state.state+(tt.state===tt.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),yt();return}var ft=B!==tt.connectionId,Lt=ft?V:tt;ft&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(tt.timeSerial||tt.connectionSerial)+" to "+(Lt.timeSerial||Lt.connectionSerial)+"; upgrade error was "+G),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+U),tt.sync(U,Lt,function(Xt,Ft,zt){if(Xt){tt.state===tt.states.synchronizing&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+U+"; err = "+Xt),tt.disconnectAllTransports());return}var ce=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+U),tt.activateTransport(G,U,Ft,K,zt),tt.state===tt.states.synchronizing?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+U),tt.state=tt.states.connected):u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+tt.state.state+", so leaving unchanged"),tt.state.sendEvents&&tt.sendQueuedMessages()};Dt?Dt.onceIdle(ce):ce()})};ct?this.realtime.channels.onceNopending(vt):vt()},Q.prototype.activateTransport=function(G,U,B,K,V){var tt=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+U),G&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),B&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),K&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(K)),V&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(V.timeSerial||V.connectionSerial)),this.persistTransportPreference(U);var ct=this.state,yt=this.states.connected.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ct.state),ct.state==this.states.closing.state||ct.state==this.states.closed.state||ct.state==this.states.failed.state)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),U.disconnect(),!1;if(C.arrDeleteValue(this.pendingTransports,U),!U.isConnected)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+U+" since it appears to no longer be connected"),!1;var vt=this.activeProtocol;this.activeProtocol=new l.default(U),this.host=U.params.host;var Rt=K.connectionKey;if(Rt&&this.connectionKey!=Rt&&this.setConnection(B,K,V,!!G),this.onConnectionDetailsUpdate(K,U),y.default.Config.nextTick(function(){U.on("connected",function(ft,Lt,Xt){tt.onConnectionDetailsUpdate(Xt,U),tt.emit("update",new S.default(yt,yt,null,ft))})}),ct.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new S.default(yt,yt,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",U),vt)if(vt.messageQueue.count()>0&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+vt.transport.shortName+", new one is "+U.shortName+") finishing with "+vt.messageQueue.count()+" messages still pending"),vt.transport===U){var Dt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+U.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",Dt)}else vt.finish();return C.safeArrForEach(this.pendingTransports,function(ft){if(ft===U){var Lt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+U.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",Lt),C.arrDeleteValue(tt.pendingTransports,U)}else ft.disconnect()}),C.safeArrForEach(this.proposedTransports,function(ft){ft===U?(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+U.shortName+"; stack = "+new Error().stack),C.arrDeleteValue(tt.proposedTransports,U)):ft.dispose()}),!0},Q.prototype.deactivateTransport=function(G,U,B){var K=this.activeProtocol,V=K&&K.getTransport()===G,tt=C.arrDeleteValue(this.pendingTransports,G),ct=C.arrDeleteValue(this.proposedTransports,G),yt=this.noTransportsScheduledForActivation();if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+U+(V?"; was active":tt?"; was pending":ct?"; was proposed":"")+(yt?"":"; another transport is scheduled for activation")),B&&B.message&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),V&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(K.getPendingMessages()),y.default.Config.nextTick(function(){K.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),V&&yt||V&&U==="failed"||U==="closed"||K===null&&tt&&this.pendingTransports.length===0){if(U==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:U,error:B,retryImmediately:!0});return}var vt=U==="failed"&&A.default.isTokenErr(B)?"disconnected":U;this.notifyState({state:vt,error:B});return}V&&U==="disconnected"&&this.state!==this.states.synchronizing&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},Q.prototype.noTransportsScheduledForActivation=function(){return C.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Q.prototype.sync=function(G,U,B){var K=setTimeout(function(){G.off("sync"),B(new M.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),V=O.default.fromValues({action:b.SYNC,connectionKey:this.connectionKey});U.timeSerial?V.timeSerial=U.timeSerial:U.connectionSerial!==void 0&&(V.connectionSerial=U.connectionSerial),G.send(V),G.once("sync",function(tt,ct){clearTimeout(K),B(null,tt,ct)})},Q.prototype.setConnection=function(G,U,B,K){var V=this,tt=this.connectionId,ct=tt&&tt!==G,yt=!tt&&K;(ct||yt)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),y.default.Config.nextTick(function(){V.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){V.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=U.connectionKey;var vt=ct||!tt;this.setConnectionSerial(B,vt,!1)},Q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Q.prototype.setConnectionSerial=function(G,U,B){var K=G.timeSerial,V=G.connectionSerial;if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+V+"; timeSerial = "+K+"; force = "+U+"; previous = "+this.connectionSerial),K!==void 0){if(K<=this.timeSerial&&!U)return B&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+K+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=K,this.setRecoveryKey();return}if(V!==void 0){if(V<=this.connectionSerial&&!U)return B&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+V+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=V,this.setRecoveryKey()}},Q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=C.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Q.prototype.persistConnection=function(){if(f()){var G=this.realtime.connection.recoveryKey;G&&N({recoveryKey:G,disconnectedAt:C.now(),location:s.location,clientId:this.realtime.auth.clientId})}},Q.prototype.unpersistConnection=function(){P()},Q.prototype.getError=function(){return this.errorReason||this.getStateError()},Q.prototype.getStateError=function(){return I.default[this.state.state]},Q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Q.prototype.enactStateChange=function(G){var U=G.current==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(U,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var B=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Q.prototype.startTransitionTimer=function(G){var U=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){U.transitionTimer&&(U.transitionTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),U.notifyState({state:G.failState}))},G.retryDelay)},Q.prototype.cancelTransitionTimer=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Q.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Q.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Q.prototype.startRetryTimer=function(G){var U=this;this.retryTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),U.retryTimer=null,U.requestState({state:"connecting"})},G)},Q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Q.prototype.notifyState=function(G){var U=this,B=G.state,K=B==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&A.default.isTokenErr(G.error)&&!(this.errorReason&&A.default.isTokenErr(this.errorReason)));if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+B+(K?"; will retry connection immediately":"")),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(B==="suspended"||B==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var V=this.states[G.state],tt=V.retryDelay;V.state==="disconnected"&&(this.disconnectedRetryCount++,tt=V.retryDelay*C.getBackoffCoefficient(this.disconnectedRetryCount)*C.getJitterCoefficient());var ct=new S.default(this.state.state,V.state,tt,G.error||I.default[V.state]);if(K){var yt=function(){U.state===U.states.disconnected&&(U.lastAutoReconnectAttempt=C.now(),U.requestState({state:"connecting"}))},vt=this.lastAutoReconnectAttempt&&C.now()-this.lastAutoReconnectAttempt+1;vt&&vt<1e3?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+vt+"ms ago, waiting another "+(1e3-vt)+"ms before trying again"),setTimeout(yt,1e3-vt)):y.default.Config.nextTick(yt)}else(B==="disconnected"||B==="suspended")&&this.startRetryTimer(tt);(B==="disconnected"&&!K||B==="suspended"||V.terminal)&&y.default.Config.nextTick(function(){U.disconnectAllTransports()}),B=="connected"&&!this.activeProtocol&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ct),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(B,ct.reason),this.failQueuedMessages(ct.reason))}},Q.prototype.requestState=function(G){var U=this,B=G.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+B+"; current state: "+this.state.state),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(B),!(B=="connecting"&&this.state.state=="connected")&&!(B=="closing"&&this.state.state=="closed"))){var K=this.states[B],V=new S.default(this.state.state,K.state,null,G.error||I.default[K.state]);this.enactStateChange(V),B=="connecting"&&y.default.Config.nextTick(function(){U.startConnect()}),B=="closing"&&this.closeImpl()}},Q.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var U=this.realtime.auth,B=++this.connectCounter,K=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(tt){B===G.connectCounter&&G.connectImpl(tt,B)})};if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),U.method==="basic")K();else{var V=function(tt){B===G.connectCounter&&(tt?G.actOnErrorFromAuthorize(tt):K())};this.errorReason&&A.default.isTokenErr(this.errorReason)?U._forceNewToken(null,null,V):U._ensureValidAuthCredentials(!1,V)}},Q.prototype.connectImpl=function(G,U){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,U)},Q.prototype.connectPreference=function(G){var U=this,B=this.getTransportPreference(),K=!1;C.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(G)),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var V=setTimeout(function(){K=!0,U.state.state!==U.states.connected.state&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),U.disconnectAllTransports(),U.unpersistTransportPreference()),U.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,B,function(tt,ct){clearTimeout(V),K&&ct?(ct.off(),ct.disconnect(),C.arrDeleteValue(U.pendingTransports,ct)):!ct&&!tt&&(U.unpersistTransportPreference(),U.connectImpl(G))})},Q.prototype.connectBase=function(G,U){var B=this,K=function(vt){B.notifyState({state:B.states.connecting.failState,error:vt})},V=this.httpHosts.slice(),tt=function(vt,Rt){U===B.connectCounter&&!Rt&&!vt&&yt()};u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ct=V.shift();if(!ct){K(new M.default("Unable to connect (no available host)",80003,404));return}G.host=ct;var yt=function(){if(!V.length){K(new M.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){K(new M.default("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(vt,Rt){if(U===B.connectCounter){if(vt){K(vt);return}if(!Rt){K(new M.default("Unable to connect (network unreachable)",80003,404));return}G.host=C.arrPopRandomElement(V),B.tryATransport(G,B.baseTransport,tt)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,yt();return}this.tryATransport(G,this.baseTransport,tt)},Q.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,U=C.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(U+1)},Q.prototype.upgradeIfNeeded=function(G){var U=this,B=this.getUpgradePossibilities();u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+y.default.Config.inspect(B)),B.length&&C.arrForEach(B,function(K){var V=U.createTransportParams(G.host,"upgrade");U.tryATransport(V,K,_)})},Q.prototype.closeImpl=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),C.safeArrForEach(this.pendingTransports,function(G){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),C.safeArrForEach(this.proposedTransports,function(G){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Q.prototype.onAuthUpdated=function(G,U){var B=this,K;switch(this.state.state){case"connected":{if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;y.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(V)})}var tt=(K=this.activeProtocol)===null||K===void 0?void 0:K.getTransport();tt&&tt.onAuthUpdated&&tt.onAuthUpdated(G);var ct=O.default.fromValues({action:b.AUTH,auth:{accessToken:G.token}});this.send(ct);var yt=function(){B.off(vt),U(null,G)},vt=function(Dt){Dt.current==="failed"&&(B.off(yt),B.off(vt),U(Dt.reason||B.getStateError()))};this.once("connectiondetails",yt),this.on("connectionstate",vt);break}case"connecting":u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Rt=function(Dt){switch(Dt.current){case"connected":B.off(Rt),U(null,G);break;case"failed":case"closed":case"suspended":B.off(Rt),U(Dt.reason||B.getStateError());break;default:break}};this.on("connectionstate",Rt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Q.prototype.disconnectAllTransports=function(G){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,C.safeArrForEach(this.pendingTransports,function(U){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+U),U&&U.disconnect()}),this.pendingTransports=[],C.safeArrForEach(this.proposedTransports,function(U){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+U),U&&U.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Q.prototype.send=function(G,U,B){B=B||_;var K=this.state;if(K.sendEvents){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new l.PendingMessage(G,B));return}var V=U&&K.queueEvents||K.forceQueueEvents;if(!V){var tt="rejecting event, queueEvent was "+U+", state was "+K.state;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()",tt),B(this.errorReason||new M.default(tt,9e4,400));return}u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+O.default.stringify(G)),this.queue(G,B)},Q.prototype.sendImpl=function(G){var U=G.message;G.ackRequired&&!G.sendAttempted&&(U.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(B){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},Q.prototype.queue=function(G,U){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),K=this.options.maxMessageSize;B&&!B.sendAttempted&&z(B.message,G,K)?(B.merged||(B.callback=E.default.create([B.callback]),B.merged=!0),B.callback.push(U)):this.queuedMessages.push(new l.PendingMessage(G,U))},Q.prototype.sendQueuedMessages=function(){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Q.prototype.queuePendingMessages=function(G){G&&G.length&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Q.prototype.failQueuedMessages=function(G){var U=this.queuedMessages.count();U>0&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+U+" queued messages, err = "+C.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Q.prototype.onChannelMessage=function(G,U){var B=this.activeProtocol&&U===this.activeProtocol.getTransport(),K=C.arrIn(this.pendingTransports,U)&&this.state==this.states.synchronizing,V=G.action===b.MESSAGE||G.action===b.PRESENCE;if(B||K){if(V){var tt=this.setConnectionSerial(G,!1,!0);if(tt)return;if(O.default.isDuplicate(G,this.mostRecentMsg)){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else C.arrIndexOf([b.ACK,b.NACK,b.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Q.prototype.ping=function(G,U){var B=this;if(G){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var K=function(){G.off("heartbeat",ct),U(new M.default("Timeout waiting for heartbeat response",5e4,500))},V=C.now(),tt=C.cheapRandStr(),ct=function(ft){if(ft===tt){G.off("heartbeat",ct),clearTimeout(yt);var Lt=C.now()-V;U(null,Lt)}},yt=setTimeout(K,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ct),G.ping(tt);return}if(this.state.state!=="connected"){U(new M.default("Unable to ping service; not connected",4e4,400));return}var vt=!1,Rt=function(ft,Lt){B.off("transport.active",Dt),vt||(vt=!0,U(ft,Lt))},Dt=function(){vt||(vt=!0,y.default.Config.nextTick(function(){B.ping(null,U)}))};this.on("transport.active",Dt),this.ping(this.activeProtocol.getTransport(),Rt)},Q.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Q.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Q.prototype.getTransportPreference=function(){var G,U;return this.transportPreference||p()&&((U=(G=y.default.WebStorage)===null||G===void 0?void 0:G.get)===null||U===void 0?void 0:U.call(G,L))},Q.prototype.persistTransportPreference=function(G){var U,B;C.arrIn(h.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,p()&&((B=(U=y.default.WebStorage)===null||U===void 0?void 0:U.set)===null||B===void 0||B.call(U,L,G.shortName)))},Q.prototype.unpersistTransportPreference=function(){var G,U;this.transportPreference=null,p()&&((U=(G=y.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||U===void 0||U.call(G,L))},Q.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===d.default.Forbidden){var U="Client configured authentication provider returned 403; failing the connection";u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",U),this.notifyState({state:"failed",error:new M.default(U,80019,403,G)})}else{var U="Client configured authentication provider request failed";u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",U),this.notifyState({state:this.state.failState,error:new M.default(U,80019,401,G)})}},Q.prototype.onConnectionDetailsUpdate=function(G,U){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var B=G.clientId;if(B){var K=this.realtime.auth._uncheckedSetClientId(B);if(K){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",K.message),U.fail(K);return}}var V=G.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Q.supportedTransports={},Q}(T.default);r.default=$}).call(this,n(12))},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(10)),O=s.__importStar(n(2)),C=s.__importDefault(n(7)),l=s.__importDefault(n(3)),h=s.__importDefault(n(19)),y=s.__importDefault(n(5)),T=s.__importDefault(n(0)),R=a.default.Action,u=a.default.fromValues({action:R.CLOSE}),S=a.default.fromValues({action:R.DISCONNECT}),I=function(M){s.__extends(A,M);function A(m,E,c,v){var d=M.call(this)||this;return v&&(c.format=void 0,c.heartbeats=!0),d.connectionManager=m,m.registerProposedTransport(d),d.auth=E,d.params=c,d.timeouts=c.options.timeouts,d.format=c.format,d.isConnected=!1,d.isFinished=!1,d.isDisposed=!1,d.maxIdleInterval=null,d.idleTimer=null,d.lastActivity=null,d}return A.prototype.connect=function(){},A.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",h.default.closed)},A.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||h.default.disconnected)},A.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||h.default.failed)},A.prototype.finish=function(m,E){var c;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((c=this.idleTimer)!==null&&c!==void 0?c:void 0),this.idleTimer=null,this.emit(m,E),this.dispose())},A.prototype.onProtocolMessage=function(m){switch(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+a.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case R.HEARTBEAT:l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case R.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case R.CLOSED:this.onClose(m);break;case R.DISCONNECTED:this.onDisconnect(m);break;case R.ACK:this.emit("ack",m.msgSerial,m.count);break;case R.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case R.SYNC:if(m.connectionId!==void 0){this.emit("sync",m.connectionId,m);break}this.connectionManager.onChannelMessage(m,this);break;case R.AUTH:this.auth.authorize(function(E){E&&l.default.logAction(l.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+O.inspectError(E))});break;case R.ERROR:if(l.default.logAction(l.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+T.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},A.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var E=m.connectionDetails.maxIdleInterval;E&&(this.maxIdleInterval=E+this.timeouts.realtimeRequestTimeout,this.onActivity())},A.prototype.onDisconnect=function(m){var E=m&&m.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onDisconnect()","err = "+O.inspectError(E)),this.finish("disconnected",E)},A.prototype.onFatalError=function(m){var E=m&&m.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onFatalError()","err = "+O.inspectError(E)),this.finish("failed",E)},A.prototype.onClose=function(m){var E=m&&m.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onClose()","err = "+O.inspectError(E)),this.finish("closed",E)},A.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestClose()",""),this.send(u)},A.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(S)},A.prototype.ping=function(m){var E={action:a.default.Action.HEARTBEAT};m&&(E.id=m),this.send(a.default.fromValues(E))},A.prototype.dispose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},A.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=O.now(),this.setIdleTimer(this.maxIdleInterval+100))},A.prototype.setIdleTimer=function(m){var E=this;this.idleTimer||(this.idleTimer=setTimeout(function(){E.onIdleTimerExpire()},m))},A.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=O.now()-this.lastActivity,E=this.maxIdleInterval-m;if(E<=0){var c="No activity seen from realtime in "+m+"ms; assuming connection has dropped";l.default.logAction(l.default.LOG_ERROR,"Transport.onIdleTimerExpire()",c),this.disconnect(new y.default(c,80003,408))}else this.setIdleTimer(E+100)},A.tryConnect=function(m,E,c,v,d){var p=new m(E,c,v),f,b=function(L){clearTimeout(f),d({event:this.event,error:L})},_=E.options.timeouts.realtimeRequestTimeout;f=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),b.call({event:"disconnected"},new y.default("Timeout waiting for transport to indicate itself viable",5e4,500))},_),p.on(["failed","disconnected"],b),p.on("preconnect",function(){l.default.logAction(l.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(f),p.off(["failed","disconnected"],b),d(null,p)}),p.connect()},A}(C.default);r.default=I},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(39),n(23))})(this,function(s){return function(){var a=s,O=a.lib,C=O.Base,l=O.WordArray,h=a.algo,y=h.MD5,T=h.EvpKDF=C.extend({cfg:C.extend({keySize:128/32,hasher:y,iterations:1}),init:function(R){this.cfg=this.cfg.extend(R)},compute:function(R,u){for(var S,I=this.cfg,M=I.hasher.create(),A=l.create(),m=A.words,E=I.keySize,c=I.iterations;m.length<E;){S&&M.update(S),S=M.update(R).finalize(u),M.reset();for(var v=1;v<c;v++)S=M.finalize(S),M.reset();A.concat(S)}return A.sigBytes=E*4,A}});a.EvpKDF=function(R,u,S){return T.create(S).compute(R,u)}}(),s.EvpKDF})},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(27))})(this,function(s){s.lib.Cipher||function(a){var O=s,C=O.lib,l=C.Base,h=C.WordArray,y=C.BufferedBlockAlgorithm,T=O.enc,R=T.Utf8,u=T.Base64,S=O.algo,I=S.EvpKDF,M=C.Cipher=y.extend({cfg:l.extend(),createEncryptor:function(P,x){return this.create(this._ENC_XFORM_MODE,P,x)},createDecryptor:function(P,x){return this.create(this._DEC_XFORM_MODE,P,x)},init:function(P,x,z){this.cfg=this.cfg.extend(z),this._xformMode=P,this._key=x,this.reset()},reset:function(){y.reset.call(this),this._doReset()},process:function(P){return this._append(P),this._process()},finalize:function(P){P&&this._append(P);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function P(x){return typeof x=="string"?N:L}return function(x){return{encrypt:function(z,W,$){return P(W).encrypt(x,z,W,$)},decrypt:function(z,W,$){return P(W).decrypt(x,z,W,$)}}}}()}),A=C.StreamCipher=M.extend({_doFinalize:function(){var P=this._process(!0);return P},blockSize:1}),m=O.mode={},E=C.BlockCipherMode=l.extend({createEncryptor:function(P,x){return this.Encryptor.create(P,x)},createDecryptor:function(P,x){return this.Decryptor.create(P,x)},init:function(P,x){this._cipher=P,this._iv=x}}),c=m.CBC=function(){var P=E.extend();P.Encryptor=P.extend({processBlock:function(z,W){var $=this._cipher,X=$.blockSize;x.call(this,z,W,X),$.encryptBlock(z,W),this._prevBlock=z.slice(W,W+X)}}),P.Decryptor=P.extend({processBlock:function(z,W){var $=this._cipher,X=$.blockSize,Q=z.slice(W,W+X);$.decryptBlock(z,W),x.call(this,z,W,X),this._prevBlock=Q}});function x(z,W,$){var X,Q=this._iv;Q?(X=Q,this._iv=a):X=this._prevBlock;for(var G=0;G<$;G++)z[W+G]^=X[G]}return P}(),v=O.pad={},d=v.Pkcs7={pad:function(P,x){for(var z=x*4,W=z-P.sigBytes%z,$=W<<24|W<<16|W<<8|W,X=[],Q=0;Q<W;Q+=4)X.push($);var G=h.create(X,W);P.concat(G)},unpad:function(P){var x=P.words[P.sigBytes-1>>>2]&255;P.sigBytes-=x}},p=C.BlockCipher=M.extend({cfg:M.cfg.extend({mode:c,padding:d}),reset:function(){var P;M.reset.call(this);var x=this.cfg,z=x.iv,W=x.mode;this._xformMode==this._ENC_XFORM_MODE?P=W.createEncryptor:(P=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==P?this._mode.init(this,z&&z.words):(this._mode=P.call(W,this,z&&z.words),this._mode.__creator=P)},_doProcessBlock:function(P,x){this._mode.processBlock(P,x)},_doFinalize:function(){var P,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),P=this._process(!0)):(P=this._process(!0),x.unpad(P)),P},blockSize:128/32}),f=C.CipherParams=l.extend({init:function(P){this.mixIn(P)},toString:function(P){return(P||this.formatter).stringify(this)}}),b=O.format={},_=b.OpenSSL={stringify:function(P){var x,z=P.ciphertext,W=P.salt;return W?x=h.create([1398893684,1701076831]).concat(W).concat(z):x=z,x.toString(u)},parse:function(P){var x,z=u.parse(P),W=z.words;return W[0]==1398893684&&W[1]==1701076831&&(x=h.create(W.slice(2,4)),W.splice(0,4),z.sigBytes-=16),f.create({ciphertext:z,salt:x})}},L=C.SerializableCipher=l.extend({cfg:l.extend({format:_}),encrypt:function(P,x,z,W){W=this.cfg.extend(W);var $=P.createEncryptor(z,W),X=$.finalize(x),Q=$.cfg;return f.create({ciphertext:X,key:z,iv:Q.iv,algorithm:P,mode:Q.mode,padding:Q.padding,blockSize:P.blockSize,formatter:W.format})},decrypt:function(P,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var $=P.createDecryptor(z,W).finalize(x.ciphertext);return $},_parse:function(P,x){return typeof P=="string"?x.parse(P,this):P}}),k=O.kdf={},H=k.OpenSSL={execute:function(P,x,z,W){W||(W=h.random(64/8));var $=I.create({keySize:x+z}).compute(P,W),X=h.create($.words.slice(x),z*4);return $.sigBytes=x*4,f.create({key:$,iv:X,salt:W})}},N=C.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(P,x,z,W){W=this.cfg.extend(W);var $=W.kdf.execute(z,P.keySize,P.ivSize);W.iv=$.iv;var X=L.encrypt.call(this,P,x,$.key,W);return X.mixIn($),X},decrypt:function(P,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var $=W.kdf.execute(z,P.keySize,P.ivSize,x.salt);W.iv=$.iv;var X=L.decrypt.call(this,P,x,$.key,W);return X}})}()})},function(o,r,n){"use strict";r.__esModule=!0,r.Request=r.createRequest=void 0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(11)),C=s.__importDefault(n(0)),l=s.__importDefault(n(7)),h=s.__importDefault(n(5)),y=s.__importDefault(n(8)),T=s.__importDefault(n(3)),R=s.__importDefault(n(20)),u=a.getGlobalObject(),S=function(){},I=u._ablyjs_jsonp={};I._=function(d){return I["_"+d]||S};var M=1,A="jsonp";function m(d,p,f,b,_,L,k){return L=L||y.default.TIMEOUTS,new c(void 0,d,p,a.copy(f),b,_,L,k)}r.createRequest=m;var E=function(d){s.__extends(p,d);function p(f,b,_){var L=d.call(this,f,b,_)||this;return L.shortName=A,_.stream=!1,L}return p.isAvailable=function(){return C.default.Config.jsonpSupported&&C.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(f,b,_,L,k,H,N){return H=(this===null||this===void 0?void 0:this.timeouts)||H||y.default.TIMEOUTS,m(f,b,_,L,k,H,N)},p}(O.default),c=function(d){s.__extends(p,d);function p(f,b,_,L,k,H,N,P){var x=d.call(this)||this;return f===void 0&&(f=M++),x.id=f,x.uri=b,x.params=L||{},x.params.rnd=a.cheapRandStr(),_&&(_["X-Ably-Version"]&&(x.params.v=_["X-Ably-Version"]),_["X-Ably-Lib"]&&(x.params.lib=_["X-Ably-Lib"])),x.body=k,x.method=P,x.requestMode=H,x.timeouts=N,x.requestComplete=!1,x}return p.prototype.exec=function(){var f=this,b=this.id,_=this.body,L=this.method,k=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+b+")",H.envelope="jsonp",_&&(H.body=_),L&&L!=="get"&&(H.method=L);var N=this.script=document.createElement("script"),P=k+a.toQueryString(H);N.src=P,N.src.split("/").slice(-1)[0]!==P.split("/").slice(-1)[0]&&T.default.logAction(T.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),N.async=!0,N.type="text/javascript",N.charset="UTF-8",N.onerror=function(W){f.complete(new h.default("JSONP script error (event: "+C.default.Config.inspect(W)+")",null,400))},I["_"+b]=function(W){if(W.statusCode){var $=W.response;if(W.statusCode==204)f.complete(null,null,null,W.statusCode);else if(!$)f.complete(new h.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||a.isArray($))f.complete(null,$,W.headers,W.statusCode);else{var X=$.error||new h.default("Error response received from server",null,W.statusCode);f.complete(X)}}else f.complete(null,W)};var x=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var z=document.getElementsByTagName("head")[0];z.insertBefore(N,z.firstChild)},p.prototype.complete=function(f,b,_,L){if(_=_||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;b&&(k=typeof b=="string"?"text/plain":"application/json",_["content-type"]=k,this.emit("data",b)),this.emit("complete",f,b,_,!0,L),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var f=this.timer;f&&(clearTimeout(f),this.timer=null);var b=this.script;b.parentNode&&b.parentNode.removeChild(b),delete I[this.id],this.emit("disposed")},p}(l.default);r.Request=c;function v(d){return u.JSONPTransport=E,E.isAvailable()&&(d.supportedTransports[A]=E),E}r.default=v},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(3)),C=s.__importDefault(n(8)),l=s.__importDefault(n(16)),h=s.__importDefault(n(45)),y=s.__importDefault(n(18)),T=s.__importDefault(n(33)),R=s.__importDefault(n(5)),u=s.__importDefault(n(48)),S=s.__importDefault(n(17)),I=s.__importDefault(n(0)),M=function(){},A=function(){function E(c){if(!c){var v="no options provided";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",v),new Error(v)}var d=C.default.objectifyOptions(c);d.log&&O.default.setLog(d.log.level,d.log.handler),O.default.logAction(O.default.LOG_MICRO,"Rest()","initialized with clientOptions "+I.default.Config.inspect(c));var p=this.options=C.default.normaliseOptions(d);if(p.key){var f=p.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!f){var v="invalid key parameter";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",v),new R.default(v,40400,404)}p.keyName=f[1],p.keySecret=f[2]}if("clientId"in p)if(typeof p.clientId=="string"||p.clientId===null){if(p.clientId==="*")throw new R.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new R.default("clientId must be either a string or null",40012,400);O.default.logAction(O.default.LOG_MINOR,"Rest()","started; version = "+C.default.version),this.baseUri=this.authority=function(b){return C.default.getHttpScheme(p)+b+":"+C.default.getPort(p,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new I.default.Http,this.auth=new l.default(this,p),this.channels=new m(this),this.push=new h.default(this)}return E.prototype.stats=function(c,v){if(v===void 0)if(typeof c=="function")v=c,c=null;else{if(this.options.promises)return a.promisify(this,"stats",arguments);v=M}var d=a.defaultGetHeaders(),p=this.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,f=this.http.supportsLinkHeaders?void 0:p;this.options.headers&&a.mixin(d,this.options.headers),new y.default(this,"/stats",d,f,function(b,_,L){for(var k=L?b:JSON.parse(b),H=0;H<k.length;H++)k[H]=u.default.fromValues(k[H]);return k}).get(c,v)},E.prototype.time=function(c,v){var d=this;if(v===void 0){if(typeof c=="function")v=c,c=null;else if(this.options.promises)return a.promisify(this,"time",arguments)}var p=v||M,f=a.defaultGetHeaders();this.options.headers&&a.mixin(f,this.options.headers);var b=function(_){return d.authority(_)+"/time"};this.http.do(S.default.Get,this,b,f,null,c,function(_,L,k,H){if(_){p(_);return}H||(L=JSON.parse(L));var N=L[0];if(!N){p(new R.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=N-a.now(),p(null,N)})},E.prototype.request=function(c,v,d,p,f,b){var _=this.options.useBinaryProtocol,L=_?I.default.Config.msgpack.encode:JSON.stringify,k=_?I.default.Config.msgpack.decode:JSON.parse,H=_?a.Format.msgpack:a.Format.json,N=this.http.supportsLinkHeaders?void 0:H;d=d||{};var P=c.toLowerCase(),x=P=="get"?a.defaultGetHeaders(H):a.defaultPostHeaders(H);if(b===void 0){if(this.options.promises)return a.promisify(this,"request",arguments);b=M}typeof p!="string"&&(p=L(p)),this.options.headers&&a.mixin(x,this.options.headers),f&&a.mixin(x,f);var z=new y.default(this,v,x,N,function(W,$,X){return a.ensureArray(X?W:k(W))},!0);if(!a.arrIn(I.default.Http.methods,P))throw new R.default("Unsupported method "+P,40500,405);a.arrIn(I.default.Http.methodsWithBody,P)?z[P](d,p,b):z[P](d,b)},E.prototype.setLog=function(c){O.default.setLog(c.level,c.handler)},E.Promise=function(c){return c=C.default.objectifyOptions(c),c.promises=!0,new E(c)},E.Callbacks=E,E.Platform=I.default,E}(),m=function(){function E(c){this.rest=c,this.all={}}return E.prototype.get=function(c,v){c=String(c);var d=this.all[c];return d?v&&d.setOptions(v):this.all[c]=d=new T.default(this.rest,c,v),d},E.prototype.release=function(c){delete this.all[String(c)]},E}();r.default=A},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(a){var O=s,C=O.lib,l=C.WordArray,h=C.Hasher,y=O.algo,T=[],R=[];(function(){function I(E){for(var c=a.sqrt(E),v=2;v<=c;v++)if(!(E%v))return!1;return!0}function M(E){return(E-(E|0))*4294967296|0}for(var A=2,m=0;m<64;)I(A)&&(m<8&&(T[m]=M(a.pow(A,1/2))),R[m]=M(a.pow(A,1/3)),m++),A++})();var u=[],S=y.SHA256=h.extend({_doReset:function(){this._hash=new l.init(T.slice(0))},_doProcessBlock:function(I,M){for(var A=this._hash.words,m=A[0],E=A[1],c=A[2],v=A[3],d=A[4],p=A[5],f=A[6],b=A[7],_=0;_<64;_++){if(_<16)u[_]=I[M+_]|0;else{var L=u[_-15],k=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=u[_-2],N=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;u[_]=k+u[_-7]+N+u[_-16]}var P=d&p^~d&f,x=m&E^m&c^E&c,z=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),W=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),$=b+W+P+R[_]+u[_],X=z+x;b=f,f=p,p=d,d=v+$|0,v=c,c=E,E=m,m=$+X|0}A[0]=A[0]+m|0,A[1]=A[1]+E|0,A[2]=A[2]+c|0,A[3]=A[3]+v|0,A[4]=A[4]+d|0,A[5]=A[5]+p|0,A[6]=A[6]+f|0,A[7]=A[7]+b|0},_doFinalize:function(){var I=this._data,M=I.words,A=this._nDataBytes*8,m=I.sigBytes*8;return M[m>>>5]|=128<<24-m%32,M[(m+64>>>9<<4)+14]=a.floor(A/4294967296),M[(m+64>>>9<<4)+15]=A,I.sigBytes=M.length*4,this._process(),this._hash},clone:function(){var I=h.clone.call(this);return I._hash=this._hash.clone(),I}});O.SHA256=h._createHelper(S),O.HmacSHA256=h._createHmacHelper(S)}(Math),s.SHA256})},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return s.enc.Utf8})},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(7)),C=s.__importDefault(n(3)),l=s.__importDefault(n(34)),h=s.__importDefault(n(9)),y=s.__importDefault(n(5)),T=s.__importDefault(n(18)),R=s.__importDefault(n(24)),u=s.__importDefault(n(0));function S(){}var I=9;function M(E){return a.arrEvery(E,function(c){return!c.id})}function A(E){var c=E||{};if(c.cipher){if(!u.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var v=u.default.Crypto.getCipher(c.cipher);c.cipher=v.cipherParams,c.channelCipher=v.cipher}else"cipher"in c&&(c.cipher=void 0,c.channelCipher=null);return c}var m=function(E){s.__extends(c,E);function c(v,d,p){var f=E.call(this)||this;return C.default.logAction(C.default.LOG_MINOR,"Channel()","started; name = "+d),f.rest=v,f.name=d,f.basePath="/channels/"+encodeURIComponent(d),f.presence=new l.default(f),f.channelOptions=A(p),f}return c.prototype.setOptions=function(v){this.channelOptions=A(v)},c.prototype.history=function(v,d){if(C.default.logAction(C.default.LOG_MICRO,"Channel.history()","channel = "+this.name),d===void 0)if(typeof v=="function")d=v,v=null;else{if(this.rest.options.promises)return a.promisify(this,"history",arguments);d=S}this._history(v,d)},c.prototype._history=function(v,d){var p=this.rest,f=p.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,b=this.rest.http.supportsLinkHeaders?void 0:f,_=a.defaultGetHeaders(f);p.options.headers&&a.mixin(_,p.options.headers);var L=this.channelOptions;new T.default(p,this.basePath+"/messages",_,b,function(k,H,N){return h.default.fromResponseBody(k,L,N?void 0:f)}).get(v,d)},c.prototype.publish=function(){var v=this,d=arguments.length,p=arguments[0],f=arguments[1],b=arguments[d-1],_,L;if(typeof b!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);b=S}if(typeof p=="string"||p===null)_=[h.default.fromValues({name:p,data:f})],L=arguments[2];else if(a.isObject(p))_=[h.default.fromValues(p)],L=arguments[1];else if(a.isArray(p))_=h.default.fromValuesArray(p),L=arguments[1];else throw new y.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var k=this.rest,H=k.options,N=H.useBinaryProtocol?a.Format.msgpack:a.Format.json,P=k.options.idempotentRestPublishing,x=a.defaultPostHeaders(N);if(H.headers&&a.mixin(x,H.headers),P&&M(_)){var z=a.randomString(I);a.arrForEach(_,function(W,$){W.id=z+":"+$.toString()})}h.default.encodeArray(_,this.channelOptions,function(W){if(W){b(W);return}var $=h.default.getMessagesSize(_),X=H.maxMessageSize;if($>X){b(new y.default("Maximum size of messages that can be published at once exceeded ( was "+$+" bytes; limit is "+X+" bytes)",40009,400));return}v._publish(h.default.serialize(_,N),x,L,b)})},c.prototype._publish=function(v,d,p,f){R.default.post(this.rest,this.basePath+"/messages",v,d,p,null,f)},c.prototype.status=function(v){if(typeof v!="function"&&this.rest.options.promises)return a.promisify(this,"status",[]);var d=this.rest.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,p=a.defaultPostHeaders(d);R.default.get(this.rest,this.basePath,p,{},d,v||S)},c}(O.default);r.default=m},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(7)),C=s.__importDefault(n(3)),l=s.__importDefault(n(18)),h=s.__importDefault(n(14));function y(){}var T=function(R){s.__extends(u,R);function u(S){var I=R.call(this)||this;return I.channel=S,I.basePath=S.basePath+"/presence",I}return u.prototype.get=function(S,I){if(C.default.logAction(C.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),I===void 0)if(typeof S=="function")I=S,S=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"get",arguments);I=y}var M=this.channel.rest,A=M.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:A,E=a.defaultGetHeaders(A);M.options.headers&&a.mixin(E,M.options.headers);var c=this.channel.channelOptions;new l.default(M,this.basePath,E,m,function(v,d,p){return h.default.fromResponseBody(v,c,p?void 0:A)}).get(S,I)},u.prototype.history=function(S,I){C.default.logAction(C.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(S,I)},u.prototype._history=function(S,I){if(I===void 0)if(typeof S=="function")I=S,S=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"_history",arguments);I=y}var M=this.channel.rest,A=M.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:A,E=a.defaultGetHeaders(A);M.options.headers&&a.mixin(E,M.options.headers);var c=this.channel.channelOptions;new l.default(M,this.basePath+"/history",E,m,function(v,d,p){return h.default.fromResponseBody(v,c,p?void 0:A)}).get(S,I)},u}(O.default);r.default=T},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(7)),O=s.__importDefault(n(3)),C=function(l){s.__extends(h,l);function h(){var y=l.call(this)||this;return y.messages=[],y}return h.prototype.count=function(){return this.messages.length},h.prototype.push=function(y){this.messages.push(y)},h.prototype.shift=function(){return this.messages.shift()},h.prototype.last=function(){return this.messages[this.messages.length-1]},h.prototype.copyAll=function(){return this.messages.slice()},h.prototype.append=function(y){this.messages.push.apply(this.messages,y)},h.prototype.prepend=function(y){this.messages.unshift.apply(this.messages,y)},h.prototype.completeMessages=function(y,T,R){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+y+"; count = "+T),R=R||null;var u=this.messages;if(u.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var S=u[0];if(S){var I=S.message.msgSerial,M=y+T;if(M>I)for(var A=u.splice(0,M-I),m=0,E=A;m<E.length;m++){var c=E[m];c.callback(R)}u.length==0&&this.emit("idle")}},h.prototype.completeAllMessages=function(y){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,y)},h.prototype.clear=function(){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},h}(a.default);r.default=C},function(o,r,n){"use strict";r.__esModule=!0;var s=function(){function a(O,C,l,h){this.previous=O,this.current=C,l&&(this.retryIn=l),h&&(this.reason=h)}return a}();r.default=s},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(10)),O=s.__importDefault(n(7)),C=s.__importStar(n(2)),l=s.__importDefault(n(33)),h=s.__importDefault(n(3)),y=s.__importDefault(n(54)),T=s.__importDefault(n(9)),R=s.__importDefault(n(38)),u=s.__importDefault(n(5)),S=s.__importDefault(n(14)),I=s.__importDefault(n(19)),M=a.default.Action,A=function(){},m="statechange",E="sync";function c(d){if(d&&"params"in d&&!C.isObject(d.params))return new u.default("options.params must be an object",4e4,400);if(d&&"modes"in d){if(!C.isArray(d.modes))return new u.default("options.modes must be an array",4e4,400);for(var p=0;p<d.modes.length;p++){var f=d.modes[p];if(!f||typeof f!="string"||!C.arrIn(a.default.channelModes,String.prototype.toUpperCase.call(f)))return new u.default("Invalid channel mode: "+f,4e4,400)}}}var v=function(d){s.__extends(p,d);function p(f,b,_){var L=d.call(this,f,b,_)||this;return L.retryCount=0,L.history=function(k,H){if(h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof k=="function")H=k,k=null;else{if(this.rest.options.promises)return C.promisify(this,"history",arguments);H=A}if(k&&k.untilAttach){if(this.state!=="attached"){H(new u.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new u.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete k.untilAttach,k.from_serial=this.properties.attachSerial}l.default.prototype._history.call(this,k,H)},L.whenState=function(k,H){return O.default.prototype.whenState.call(L,k,L.state,H)},h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel()","started; name = "+b),L.realtime=f,L.presence=new y.default(L),L.connectionManager=f.connection.connectionManager,L.state="initialized",L.subscriptions=new O.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(_),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new O.default,L}return p.invalidStateError=function(f){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+f}},p.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},p.prototype.setOptions=function(f,b){if(!b&&this.rest.options.promises)return C.promisify(this,"setOptions",arguments);var _=b||function(k){k&&h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},L=c(f);if(L){_(L);return}l.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(function(k){switch(this.event){case"update":case"attached":_==null||_(null);return;default:_==null||_(k.reason);return}})):_()},p.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&(f.params||f.modes)},p.prototype.publish=function(){for(var f=this,b=[],_=0;_<arguments.length;_++)b[_]=arguments[_];var L=b[0],k=b.length,H=b[k-1];if(typeof H!="function"){if(this.realtime.options.promises)return C.promisify(this,"publish",arguments);H=A,++k}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(k==2)if(C.isObject(L))L=[T.default.fromValues(L)];else if(C.isArray(L))L=T.default.fromValuesArray(L);else throw new u.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[T.default.fromValues({name:b[0],data:b[1]})];var N=this.realtime.options.maxMessageSize;T.default.encodeArray(L,this.channelOptions,function(P){if(P){H(P);return}var x=T.default.getMessagesSize(L);if(x>N){H(new u.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+N+" bytes)",40009,400));return}f.__publish(L,H)})},p.prototype.__publish=function(f,b){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var _=this.state;switch(_){case"failed":case"suspended":b(u.default.fromValues(p.invalidStateError(_)));break;default:{h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+_);var L=new a.default;L.action=M.MESSAGE,L.channel=this.name,L.messages=f,this.sendMessage(L,b);break}}},p.prototype.onEvent=function(f){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var b=this.subscriptions,_=0;_<f.length;_++){var L=f[_];b.emit(L.name,L)}},p.prototype.attach=function(f,b){var _;if(typeof f=="function"?(b=f,_=null):_=f,!b){if(this.realtime.options.promises)return C.promisify(this,"attach",arguments);b=function(L){L&&h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(_)h.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=_;else if(this.state==="attached"){b();return}this._attach(!1,null,b)},p.prototype._attach=function(f,b,_){_||(_=function(k){k&&h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+k.toString())});var L=this.connectionManager;if(!L.activeState()){_(L.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",b),this.once(function(k){switch(this.event){case"attached":_==null||_();break;case"detached":case"suspended":case"failed":_==null||_(k.reason||L.getError()||new u.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":_==null||_(new u.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},p.prototype.attachImpl=function(){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(m,!0);var f=a.default.fromValues({action:M.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(C.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,A)},p.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return C.promisify(this,"detach",arguments);f=A}var b=this.connectionManager;if(!b.activeState()){f(b.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new u.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(_){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(_.reason||b.getError()||new u.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new u.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},p.prototype.detachImpl=function(f){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(m,!0);var b=a.default.fromValues({action:M.DETACH,channel:this.name});this.sendMessage(b,f||A)},p.prototype.subscribe=function(){for(var f=[],b=0;b<arguments.length;b++)f[b]=arguments[b];var _=p.processListenerArgs(f),L=_[0],k=_[1],H=_[2];if(!H&&this.realtime.options.promises)return C.promisify(this,"subscribe",[L,k]);if(this.state==="failed"){H==null||H(u.default.fromValues(p.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,k):this.subscriptions.on(L,k),this.attach(H||A)},p.prototype._subscribeFilter=function(f,b){var _=function(L){var k,H,N,P,x,z,W={name:L.name,refTimeserial:(H=(k=L.extras)===null||k===void 0?void 0:k.ref)===null||H===void 0?void 0:H.timeserial,refType:(P=(N=L.extras)===null||N===void 0?void 0:N.ref)===null||P===void 0?void 0:P.type,isRef:!!(!((z=(x=L.extras)===null||x===void 0?void 0:x.ref)===null||z===void 0)&&z.timeserial),clientId:L.clientId};Object.entries(f).find(function($){var X=$[0],Q=$[1];return Q!==void 0?W[X]!==Q:!1})||b(L)};this._addFilteredSubscription(f,b,_),this.subscriptions.on(_)},p.prototype._addFilteredSubscription=function(f,b,_){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(b)){var k=this.filteredSubscriptions.get(b);k.set(f,((L=k==null?void 0:k.get(f))===null||L===void 0?void 0:L.concat(_))||[_])}else this.filteredSubscriptions.set(b,new Map([[f,[_]]]))},p.prototype._getAndDeleteFilteredSubscriptions=function(f,b){var _=this;if(!this.filteredSubscriptions)return[];if(!b&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(N){var P,x=N[0],z=N[1],W=z.get(f);return z.delete(f),z.size===0&&((P=_.filteredSubscriptions)===null||P===void 0||P.delete(x)),W}).reduce(function(N,P){var x;return P?(x=N).concat.apply(x,P):N},[]);if(!b||!this.filteredSubscriptions.has(b))return[];var L=this.filteredSubscriptions.get(b);if(!f){var k=Array.from(L.values()).reduce(function(N,P){return N.concat.apply(N,P)},[]);return this.filteredSubscriptions.delete(b),k}var H=L.get(f);return L.delete(f),H||[]},p.prototype.unsubscribe=function(){for(var f=this,b,_=[],L=0;L<arguments.length;L++)_[L]=arguments[L];var k=p.processListenerArgs(_),H=k[0],N=k[1];if(typeof H=="object"&&!N||((b=this.filteredSubscriptions)===null||b===void 0?void 0:b.has(N))){this._getAndDeleteFilteredSubscriptions(H,N).forEach(function(P){return f.subscriptions.off(P)});return}this.subscriptions.off(H,N)},p.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new u.default("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var b=a.default.fromValues({action:M.SYNC,channel:this.name});this.syncChannelSerial&&(b.channelSerial=this.syncChannelSerial),f.send(b)},p.prototype.sendMessage=function(f,b){this.connectionManager.send(f,this.realtime.options.queueMessages,b)},p.prototype.sendPresence=function(f,b){var _=a.default.fromValues({action:M.PRESENCE,channel:this.name,presence:C.isArray(f)?S.default.fromValuesArray(f):[S.default.fromValues(f)]});this.sendMessage(_,b)},p.prototype.onMessage=function(f){var b,_=!1;switch(f.action){case M.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var L=f.decodeModesFromFlags();this.modes=L&&C.allToLowerCase(L)||void 0;var k=f.hasFlag("RESUMED"),H=f.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(m,!1),k||this.presence.onAttached(H);var N=new R.default(this.state,this.state,k,f.error);this._allChannelChanges.emit("update",N),(!k||this.channelOptions.updateOnAttached)&&this.emit("update",N)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,k,H);break}case M.DETACHED:{var P=f.error?u.default.fromValues(f.error):new u.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",P):this.state==="attaching"?this.notifyState("suspended",P):this.requestState("attaching",P);break}case M.SYNC:if(_=!0,b=this.syncChannelSerial=f.channelSerial,!f.presence)break;case M.PRESENCE:{for(var x=f.presence,z=f.id,W=f.connectionId,$=f.timestamp,X=this.channelOptions,Q=void 0,G=0;G<x.length;G++)try{Q=x[G],S.default.decode(Q,X),Q.connectionId||(Q.connectionId=W),Q.timestamp||(Q.timestamp=$),Q.id||(Q.id=z+":"+G)}catch(ct){h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",ct.toString())}this.presence.setPresence(x,_,b);break}case M.MESSAGE:{if(this.state!=="attached"){h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var U=f.messages,B=U[0],K=U[U.length-1],z=f.id,W=f.connectionId,$=f.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var V='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",V),this._startDecodeFailureRecovery(new u.default(V,40018,400));break}for(var G=0;G<U.length;G++){var V=U[G];try{T.default.decode(V,this._decodingContext)}catch(ft){switch(h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",ft.toString()),ft.code){case 40018:this._startDecodeFailureRecovery(ft);return;case 40019:case 40021:this.notifyState("failed",ft);return}}V.connectionId||(V.connectionId=W),V.timestamp||(V.timestamp=$),V.id||(V.id=z+":"+G)}this._lastPayload.messageId=K.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(U);break}case M.ERROR:{var tt=f.error;tt&&tt.code==80016?this.checkPendingState():this.notifyState("failed",u.default.fromValues(tt));break}default:h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(I.default.unknownChannelErr)}},p.prototype._startDecodeFailureRecovery=function(f){var b=this;this._lastPayload.decodeFailureRecoveryInProgress||(h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){b._lastPayload.decodeFailureRecoveryInProgress=!1}))},p.prototype.onAttached=function(){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},p.prototype.notifyState=function(f,b,_,L){if(h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),f!==this.state){this.presence.actOnChannelState(f,L,b),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),b&&(this.errorReason=b);var k=new R.default(this.state,f,_,b),H=f==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(H,'Channel state for channel "'+this.name+'"',f+(b?"; reason: "+b:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"?(this.onAttached(),this.setInProgress(E,L),this.setInProgress(m,!1)):(f==="detached"||f==="failed"||f==="suspended")&&(this.setInProgress(m,!1),this.setInProgress(E,!1)),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,k),this.emit(f,k)}},p.prototype.requestState=function(f,b){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,b),this.checkPendingState()},p.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},p.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new u.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new u.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},p.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},p.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},p.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var b=this.realtime.options.timeouts.channelRetryTimeout*C.getJitterCoefficient()*C.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},b)}},p.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},p.prototype.setInProgress=function(f,b){this.rest.channels.setInProgress(this,f,b)},p.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new u.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},p.progressOps={statechange:m,sync:E},p}(l.default);r.default=v},function(o,r,n){"use strict";r.__esModule=!0;var s=function(){function a(O,C,l,h){this.previous=O,this.current=C,C==="attached"&&(this.resumed=l),h&&(this.reason=h)}return a}();r.default=s},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(){var a=s,O=a.lib,C=O.WordArray,l=O.Hasher,h=a.algo,y=[],T=h.SHA1=l.extend({_doReset:function(){this._hash=new C.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,u){for(var S=this._hash.words,I=S[0],M=S[1],A=S[2],m=S[3],E=S[4],c=0;c<80;c++){if(c<16)y[c]=R[u+c]|0;else{var v=y[c-3]^y[c-8]^y[c-14]^y[c-16];y[c]=v<<1|v>>>31}var d=(I<<5|I>>>27)+E+y[c];c<20?d+=(M&A|~M&m)+1518500249:c<40?d+=(M^A^m)+1859775393:c<60?d+=(M&A|M&m|A&m)-1894007588:d+=(M^A^m)-899497514,E=m,m=A,A=M<<30|M>>>2,M=I,I=d}S[0]=S[0]+I|0,S[1]=S[1]+M|0,S[2]=S[2]+A|0,S[3]=S[3]+m|0,S[4]=S[4]+E|0},_doFinalize:function(){var R=this._data,u=R.words,S=this._nDataBytes*8,I=R.sigBytes*8;return u[I>>>5]|=128<<24-I%32,u[(I+64>>>9<<4)+14]=Math.floor(S/4294967296),u[(I+64>>>9<<4)+15]=S,R.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var R=l.clone.call(this);return R._hash=this._hash.clone(),R}});a.SHA1=l._createHelper(T),a.HmacSHA1=l._createHmacHelper(T)}(),s.SHA1})},function(o,r,n){"use strict";r.__esModule=!0;function s(c){if(c===void 0)return"undefined";var v,d;if(c instanceof ArrayBuffer?(d="ArrayBuffer",v=new DataView(c)):c instanceof DataView&&(d="DataView",v=c),!v)return JSON.stringify(c);for(var p=[],f=0;f<c.byteLength;f++){if(f>20){p.push("...");break}var b=v.getUint8(f).toString(16);b.length===1&&(b="0"+b),p.push(b)}return"<"+d+" "+p.join(" ")+">"}function a(c,v,d){for(var p=0,f=d.length;p<f;p++){var b=d.charCodeAt(p);if(b<128){c.setUint8(v++,b>>>0&127|0);continue}if(b<2048){c.setUint8(v++,b>>>6&31|192),c.setUint8(v++,b>>>0&63|128);continue}if(b<65536){c.setUint8(v++,b>>>12&15|224),c.setUint8(v++,b>>>6&63|128),c.setUint8(v++,b>>>0&63|128);continue}if(b<1114112){c.setUint8(v++,b>>>18&7|240),c.setUint8(v++,b>>>12&63|128),c.setUint8(v++,b>>>6&63|128),c.setUint8(v++,b>>>0&63|128);continue}throw new Error("bad codepoint "+b)}}function O(c,v,d){for(var p="",f=v,b=v+d;f<b;f++){var _=c.getUint8(f);if((_&128)===0){p+=String.fromCharCode(_);continue}if((_&224)===192){p+=String.fromCharCode((_&15)<<6|c.getUint8(++f)&63);continue}if((_&240)===224){p+=String.fromCharCode((_&15)<<12|(c.getUint8(++f)&63)<<6|(c.getUint8(++f)&63)<<0);continue}if((_&248)===240){p+=String.fromCharCode((_&7)<<18|(c.getUint8(++f)&63)<<12|(c.getUint8(++f)&63)<<6|(c.getUint8(++f)&63)<<0);continue}throw new Error("Invalid byte "+_.toString(16))}return p}function C(c){for(var v=0,d=0,p=c.length;d<p;d++){var f=c.charCodeAt(d);if(f<128){v+=1;continue}if(f<2048){v+=2;continue}if(f<65536){v+=3;continue}if(f<1114112){v+=4;continue}throw new Error("bad codepoint "+f)}return v}function l(c,v){var d=E(c,v);if(d!==0){var p=new ArrayBuffer(d),f=new DataView(p);return m(c,f,0,v),p}}var h=(1<<16)*(1<<16),y=1/h;function T(c,v){return v=v||0,c.getInt32(v)*h+c.getUint32(v+4)}function R(c,v){return v=v||0,c.getUint32(v)*h+c.getUint32(v+4)}function u(c,v,d){d<9223372036854776e3?(c.setInt32(v,Math.floor(d*y)),c.setInt32(v+4,d&-1)):(c.setUint32(v,2147483647),c.setUint32(v+4,2147483647))}function S(c,v,d){d<18446744073709552e3?(c.setUint32(v,Math.floor(d*y)),c.setInt32(v+4,d&-1)):(c.setUint32(v,4294967295),c.setUint32(v+4,4294967295))}var I=function(){function c(v,d){var p=this;this.map=function(f){for(var b={},_=0;_<f;_++){var L=p.parse();b[L]=p.parse()}return b},this.bin=function(f){var b=new ArrayBuffer(f);return new Uint8Array(b).set(new Uint8Array(p.view.buffer,p.offset,f),0),p.offset+=f,b},this.buf=this.bin,this.str=function(f){var b=O(p.view,p.offset,f);return p.offset+=f,b},this.array=function(f){for(var b=new Array(f),_=0;_<f;_++)b[_]=p.parse();return b},this.ext=function(f){return p.offset+=f,{type:p.view.getInt8(p.offset),data:p.buf(f)}},this.parse=function(){var f=p.view.getUint8(p.offset),b,_;if((f&128)===0)return p.offset++,f;if((f&240)===128)return _=f&15,p.offset++,p.map(_);if((f&240)===144)return _=f&15,p.offset++,p.array(_);if((f&224)===160)return _=f&31,p.offset++,p.str(_);if((f&224)===224)return b=p.view.getInt8(p.offset),p.offset++,b;switch(f){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(_);case 197:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(_);case 198:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(_);case 199:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(_);case 200:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(_);case 201:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(_);case 202:return b=p.view.getFloat32(p.offset+1),p.offset+=5,b;case 203:return b=p.view.getFloat64(p.offset+1),p.offset+=9,b;case 204:return b=p.view.getUint8(p.offset+1),p.offset+=2,b;case 205:return b=p.view.getUint16(p.offset+1),p.offset+=3,b;case 206:return b=p.view.getUint32(p.offset+1),p.offset+=5,b;case 207:return b=R(p.view,p.offset+1),p.offset+=9,b;case 208:return b=p.view.getInt8(p.offset+1),p.offset+=2,b;case 209:return b=p.view.getInt16(p.offset+1),p.offset+=3,b;case 210:return b=p.view.getInt32(p.offset+1),p.offset+=5,b;case 211:return b=T(p.view,p.offset+1),p.offset+=9,b;case 212:return _=1,p.offset++,p.ext(_);case 213:return _=2,p.offset++,p.ext(_);case 214:return _=4,p.offset++,p.ext(_);case 215:return _=8,p.offset++,p.ext(_);case 216:return _=16,p.offset++,p.ext(_);case 217:return _=p.view.getUint8(p.offset+1),p.offset+=2,p.str(_);case 218:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.str(_);case 219:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.str(_);case 220:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.array(_);case 221:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.array(_);case 222:return _=p.view.getUint16(p.offset+1),p.offset+=3,p.map(_);case 223:return _=p.view.getUint32(p.offset+1),p.offset+=5,p.map(_)}throw new Error("Unknown type 0x"+f.toString(16))},this.offset=d||0,this.view=v}return c}();function M(c){var v=new DataView(c),d=new I(v),p=d.parse();if(d.offset!==c.byteLength)throw new Error(c.byteLength-d.offset+" trailing bytes");return p}function A(c,v){return Object.keys(c).filter(function(d){var p=c[d],f=typeof p;return(!v||p!=null)&&(f!=="function"||!!p.toJSON)})}function m(c,v,d,p){var f=typeof c;if(typeof c=="string"){var b=C(c);if(b<32)return v.setUint8(d,b|160),a(v,d+1,c),1+b;if(b<256)return v.setUint8(d,217),v.setUint8(d+1,b),a(v,d+2,c),2+b;if(b<65536)return v.setUint8(d,218),v.setUint16(d+1,b),a(v,d+3,c),3+b;if(b<4294967296)return v.setUint8(d,219),v.setUint32(d+1,b),a(v,d+5,c),5+b}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var _=c.byteLength;if(_<256)return v.setUint8(d,196),v.setUint8(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(c),d+2),2+_;if(_<65536)return v.setUint8(d,197),v.setUint16(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(c),d+3),3+_;if(_<4294967296)return v.setUint8(d,198),v.setUint32(d+1,_),new Uint8Array(v.buffer).set(new Uint8Array(c),d+5),5+_}if(typeof c=="number"){if(Math.floor(c)!==c)return v.setUint8(d,203),v.setFloat64(d+1,c),9;if(c>=0){if(c<128)return v.setUint8(d,c),1;if(c<256)return v.setUint8(d,204),v.setUint8(d+1,c),2;if(c<65536)return v.setUint8(d,205),v.setUint16(d+1,c),3;if(c<4294967296)return v.setUint8(d,206),v.setUint32(d+1,c),5;if(c<18446744073709552e3)return v.setUint8(d,207),S(v,d+1,c),9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return v.setInt8(d,c),1;if(c>=-128)return v.setUint8(d,208),v.setInt8(d+1,c),2;if(c>=-32768)return v.setUint8(d,209),v.setInt16(d+1,c),3;if(c>=-2147483648)return v.setUint8(d,210),v.setInt32(d+1,c),5;if(c>=-9223372036854776e3)return v.setUint8(d,211),u(v,d+1,c),9;throw new Error("Number too small -0x"+(-c).toString(16).substr(1))}if(f==="undefined")return p?0:(v.setUint8(d,212),v.setUint8(d+1,0),v.setUint8(d+2,0),3);if(c===null)return p?0:(v.setUint8(d,192),1);if(f==="boolean")return v.setUint8(d,c?195:194),1;if(typeof c.toJSON=="function")return m(c.toJSON(),v,d,p);if(f==="object"){var L,k=0,H=void 0,N=Array.isArray(c);if(N?L=c.length:(H=A(c,p),L=H.length),L<16?(v.setUint8(d,L|(N?144:128)),k=1):L<65536?(v.setUint8(d,N?220:222),v.setUint16(d+1,L),k=3):L<4294967296&&(v.setUint8(d,N?221:223),v.setUint32(d+1,L),k=5),N)for(var P=0;P<L;P++)k+=m(c[P],v,d+k,p);else if(H)for(var P=0;P<L;P++){var x=H[P];k+=m(x,v,d+k),k+=m(c[x],v,d+k,p)}return k}if(f==="function")return 0;throw new Error("Unknown type "+f)}function E(c,v){var d=typeof c;if(d==="string"){var p=C(c);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var f=c.byteLength;if(f<256)return 2+f;if(f<65536)return 3+f;if(f<4294967296)return 5+f}if(typeof c=="number"){if(Math.floor(c)!==c)return 9;if(c>=0){if(c<128)return 1;if(c<256)return 2;if(c<65536)return 3;if(c<4294967296)return 5;if(c<18446744073709552e3)return 9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return 1;if(c>=-128)return 2;if(c>=-32768)return 3;if(c>=-2147483648)return 5;if(c>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+c.toString(16).substr(1))}if(d==="boolean")return 1;if(c===null)return v?0:1;if(c===void 0)return v?0:3;if(typeof c.toJSON=="function")return E(c.toJSON(),v);if(d==="object"){var b,_=0;if(Array.isArray(c)){b=c.length;for(var L=0;L<b;L++)_+=E(c[L],v)}else{var k=A(c,v);b=k.length;for(var L=0;L<b;L++){var H=k[L];_+=E(H)+E(c[H],v)}}if(b<16)return 1+_;if(b<65536)return 3+_;if(b<4294967296)return 5+_;throw new Error("Array or object too long 0x"+b.toString(16))}if(d==="function")return 0;throw new Error("Unknown type "+d)}r.default={encode:l,decode:M,inspect:s,utf8Write:a,utf8Read:O,utf8ByteCount:C}},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(30)),O=s.__importDefault(n(49)),C=s.__importDefault(n(0)),l=s.__importDefault(n(55)),h=s.__importDefault(n(57)),y=s.__importDefault(n(62)),T=s.__importDefault(n(63)),R=s.__importDefault(n(67)),u=s.__importDefault(n(3)),S=n(8),I=s.__importDefault(n(25)),M=s.__importDefault(n(64)),A=s.__importDefault(n(65)),m=s.__importDefault(n(40)),E=s.__importDefault(n(9)),c=s.__importDefault(n(14));C.default.Crypto=h.default,C.default.BufferUtils=l.default,C.default.Http=y.default,C.default.Config=T.default,C.default.Transports=R.default,C.default.WebStorage=M.default,a.default.Crypto=h.default,O.default.Crypto=h.default,a.default.Message=E.default,O.default.Message=E.default,a.default.PresenceMessage=c.default,O.default.PresenceMessage=c.default,O.default.ConnectionManager=I.default,u.default.initLogHandlers(),C.default.Defaults=S.getDefaults(A.default),C.default.Config.agent&&(C.default.Defaults.agent+=" "+C.default.Config.agent),C.default.Config.noUpgrade&&(C.default.Defaults.upgradeTransports=[]),r.default={Rest:a.default,Realtime:O.default,msgpack:m.default}},function(o){o.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(31),n(23))})(this,function(s){return s.HmacSHA256})},function(o,r){},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(46)),C=s.__importDefault(n(24)),l=s.__importDefault(n(18)),h=s.__importDefault(n(5)),y=s.__importDefault(n(47)),T=function(){},R=function(){function M(A){this.rest=A,this.admin=new u(A)}return M}(),u=function(){function M(A){this.rest=A,this.deviceRegistrations=new S(A),this.channelSubscriptions=new I(A)}return M.prototype.publish=function(A,m,E){var c=this.rest,v=c.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,d=a.defaultPostHeaders(v),p={},f=a.mixin({recipient:A},m);if(typeof E!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);E=T}c.options.headers&&a.mixin(d,c.options.headers),c.options.pushFullWait&&a.mixin(p,{fullWait:"true"});var b=a.encodeBody(f,v);C.default.post(c,"/push/publish",b,d,p,null,function(_){return E(_)})},M}(),S=function(){function M(A){this.rest=A}return M.prototype.save=function(A,m){var E=this.rest,c=O.default.fromValues(A),v=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,d=a.defaultPostHeaders(v),p={};if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);m=T}E.options.headers&&a.mixin(d,E.options.headers),E.options.pushFullWait&&a.mixin(p,{fullWait:"true"});var f=a.encodeBody(c,v);C.default.put(E,"/push/deviceRegistrations/"+encodeURIComponent(A.id),f,d,p,null,function(b,_,L,k){m(b,b?void 0:O.default.fromResponseBody(_,k?void 0:v))})},M.prototype.get=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=a.defaultGetHeaders(c),d=A.id||A;if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"get",arguments);m=T}if(typeof d!="string"||!d.length){m(new h.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}E.options.headers&&a.mixin(v,E.options.headers),C.default.get(E,"/push/deviceRegistrations/"+encodeURIComponent(d),v,{},null,function(p,f,b,_){m(p,p?void 0:O.default.fromResponseBody(f,_?void 0:c))})},M.prototype.list=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,d=a.defaultGetHeaders(c);if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);m=T}E.options.headers&&a.mixin(d,E.options.headers),new l.default(E,"/push/deviceRegistrations",d,v,function(p,f,b){return O.default.fromResponseBody(p,b?void 0:c)}).get(A,m)},M.prototype.remove=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=a.defaultGetHeaders(c),d={},p=A.id||A;if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"remove",arguments);m=T}if(typeof p!="string"||!p.length){m(new h.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}E.options.headers&&a.mixin(v,E.options.headers),E.options.pushFullWait&&a.mixin(d,{fullWait:"true"}),C.default.delete(E,"/push/deviceRegistrations/"+encodeURIComponent(p),v,d,null,function(f){return m(f)})},M.prototype.removeWhere=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=a.defaultGetHeaders(c);if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);m=T}E.options.headers&&a.mixin(v,E.options.headers),E.options.pushFullWait&&a.mixin(A,{fullWait:"true"}),C.default.delete(E,"/push/deviceRegistrations",v,A,null,function(d){return m(d)})},M}(),I=function(){function M(A){this.remove=M.prototype.removeWhere,this.rest=A}return M.prototype.save=function(A,m){var E=this.rest,c=y.default.fromValues(A),v=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,d=a.defaultPostHeaders(v),p={};if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);m=T}E.options.headers&&a.mixin(d,E.options.headers),E.options.pushFullWait&&a.mixin(p,{fullWait:"true"});var f=a.encodeBody(c,v);C.default.post(E,"/push/channelSubscriptions",f,d,p,null,function(b,_,L,k){m(b,!b&&y.default.fromResponseBody(_,k?void 0:v))})},M.prototype.list=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,d=a.defaultGetHeaders(c);if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);m=T}E.options.headers&&a.mixin(d,E.options.headers),new l.default(E,"/push/channelSubscriptions",d,v,function(p,f,b){return y.default.fromResponseBody(p,b?void 0:c)}).get(A,m)},M.prototype.removeWhere=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=a.defaultGetHeaders(c);if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);m=T}E.options.headers&&a.mixin(v,E.options.headers),E.options.pushFullWait&&a.mixin(A,{fullWait:"true"}),C.default.delete(E,"/push/channelSubscriptions",v,A,null,function(d){return m(d)})},M.prototype.listChannels=function(A,m){var E=this.rest,c=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,d=a.defaultGetHeaders(c);if(typeof m!="function"){if(this.rest.options.promises)return a.promisify(this,"listChannels",arguments);m=T}E.options.headers&&a.mixin(d,E.options.headers),E.options.pushFullWait&&a.mixin(A,{fullWait:"true"}),new l.default(E,"/push/channels",d,v,function(p,f,b){for(var _=!b&&c?a.decodeBody(p,c):p,L=0;L<_.length;L++)_[L]=String(_[L]);return _}).get(A,m)},M}();r.default=R},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(5)),C;(function(y){y.Phone="phone",y.Tablet="tablet",y.Desktop="desktop",y.TV="tv",y.Watch="watch",y.Car="car",y.Embedded="embedded",y.Other="other"})(C||(C={}));var l;(function(y){y.Android="android",y.IOS="ios",y.Browser="browser"})(l||(l={}));var h=function(){function y(){}return y.prototype.toJSON=function(){var T,R,u;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(T=this.push)===null||T===void 0?void 0:T.recipient,state:(R=this.push)===null||R===void 0?void 0:R.state,error:(u=this.push)===null||u===void 0?void 0:u.error}}},y.prototype.toString=function(){var T,R,u,S,I="[DeviceDetails";return this.id&&(I+="; id="+this.id),this.platform&&(I+="; platform="+this.platform),this.formFactor&&(I+="; formFactor="+this.formFactor),this.clientId&&(I+="; clientId="+this.clientId),this.metadata&&(I+="; metadata="+this.metadata),this.deviceIdentityToken&&(I+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((T=this.push)===null||T===void 0)&&T.recipient&&(I+="; push.recipient="+JSON.stringify(this.push.recipient)),!((R=this.push)===null||R===void 0)&&R.state&&(I+="; push.state="+this.push.state),!((u=this.push)===null||u===void 0)&&u.error&&(I+="; push.error="+JSON.stringify(this.push.error)),!((S=this.push)===null||S===void 0)&&S.metadata&&(I+="; push.metadata="+this.push.metadata),I+="]",I},y.fromResponseBody=function(T,R){return R&&(T=a.decodeBody(T,R)),a.isArray(T)?y.fromValuesArray(T):y.fromValues(T)},y.fromValues=function(T){return T.error=T.error&&O.default.fromValues(T.error),Object.assign(new y,T)},y.fromValuesArray=function(T){for(var R=T.length,u=new Array(R),S=0;S<R;S++)u[S]=y.fromValues(T[S]);return u},y.toRequestBody=a.encodeBody,y}();r.default=h},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=function(){function C(){}return C.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},C.prototype.toString=function(){var l="[PushChannelSubscription";return this.channel&&(l+="; channel="+this.channel),this.deviceId&&(l+="; deviceId="+this.deviceId),this.clientId&&(l+="; clientId="+this.clientId),l+="]",l},C.fromResponseBody=function(l,h){return h&&(l=a.decodeBody(l,h)),a.isArray(l)?C.fromValuesArray(l):C.fromValues(l)},C.fromValues=function(l){return Object.assign(new C,l)},C.fromValuesArray=function(l){for(var h=l.length,y=new Array(h),T=0;T<h;T++)y[T]=C.fromValues(l[T]);return y},C.toRequestBody=a.encodeBody,C}();r.default=O},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=function(){function E(c){this.count=c&&c.count||0,this.data=c&&c.data||0,this.uncompressedData=c&&c.uncompressedData||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return E}(),C=function(E){s.__extends(c,E);function c(v){var d=E.call(this,v)||this;return v&&v.category&&(d.category={},a.forInOwnNonNullProperties(v.category,function(p){d.category[p]=new O(v.category[p])})),d}return c}(O),l=function(){function E(c){this.peak=c&&c.peak||0,this.min=c&&c.min||0,this.mean=c&&c.mean||0,this.opened=c&&c.opened||0,this.refused=c&&c.refused||0}return E}(),h=function(){function E(c){this.succeeded=c&&c.succeeded||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return E}(),y=function(){function E(c){this.plain=new l(c&&c.plain),this.tls=new l(c&&c.tls),this.all=new l(c&&c.all)}return E}(),T=function(){function E(c){this.messages=new C(c&&c.messages),this.presence=new C(c&&c.presence),this.all=new C(c&&c.all)}return E}(),R=function(){function E(c){this.realtime=new T(c&&c.realtime),this.rest=new T(c&&c.rest),this.webhook=new T(c&&c.webhook),this.sharedQueue=new T(c&&c.sharedQueue),this.externalQueue=new T(c&&c.externalQueue),this.httpEvent=new T(c&&c.httpEvent),this.push=new T(c&&c.push),this.all=new T(c&&c.all)}return E}(),u=function(){function E(c){this.all=new T(c&&c.all),this.inbound=new R(c&&c.inbound),this.outbound=new R(c&&c.outbound)}return E}(),S=function(){function E(c){this.all=new T(c&&c.all),this.producerPaid=new u(c&&c.producerPaid),this.consumerPaid=new u(c&&c.consumerPaid)}return E}(),I=function(){function E(c){this.messages=c&&c.messages||0;var v=c&&c.notifications;this.notifications={invalid:v&&v.invalid||0,attempted:v&&v.attempted||0,successful:v&&v.successful||0,failed:v&&v.failed||0},this.directPublishes=c&&c.directPublishes||0}return E}(),M=function(){function E(c){this.succeeded=c&&c.succeeded||0,this.skipped=c&&c.skipped||0,this.failed=c&&c.failed||0}return E}(),A=function(){function E(c){var v=this;this.delta=void 0,c&&c.delta&&(this.delta={},a.forInOwnNonNullProperties(c.delta,function(d){v.delta[d]=new M(c.delta[d])}))}return E}(),m=function(E){s.__extends(c,E);function c(v){var d=E.call(this,v)||this;return d.persisted=new T(v&&v.persisted),d.connections=new y(v&&v.connections),d.channels=new l(v&&v.channels),d.apiRequests=new h(v&&v.apiRequests),d.tokenRequests=new h(v&&v.tokenRequests),d.xchgProducer=new S(v&&v.xchgProducer),d.xchgConsumer=new S(v&&v.xchgConsumer),d.push=new I(v&&v.pushStats),d.processed=new A(v&&v.processed),d.inProgress=v&&v.inProgress||void 0,d.unit=v&&v.unit||void 0,d.intervalId=v&&v.intervalId||void 0,d}return c.fromValues=function(v){return new c(v)},c}(u);r.default=m},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(30)),C=s.__importDefault(n(7)),l=s.__importDefault(n(3)),h=s.__importDefault(n(50)),y=s.__importDefault(n(37)),T=s.__importDefault(n(8)),R=s.__importDefault(n(5)),u=s.__importDefault(n(10)),S=s.__importDefault(n(25)),I=s.__importDefault(n(0)),M=s.__importDefault(n(9)),A=function(E){s.__extends(c,E);function c(v){var d=E.call(this,v)||this;return l.default.logAction(l.default.LOG_MINOR,"Realtime()",""),d.connection=new h.default(d,d.options),d.channels=new m(d),v.autoConnect!==!1&&d.connect(),d}return c.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},c.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},c.Promise=function(v){return v=T.default.objectifyOptions(v),v.promises=!0,new c(v)},c.Callbacks=c,c.Utils=a,c.ConnectionManager=S.default,c.Platform=I.default,c.ProtocolMessage=u.default,c.Message=M.default,c}(O.default),m=function(E){s.__extends(c,E);function c(v){var d=E.call(this)||this;return d.realtime=v,d.all={},d.inProgress={},v.connection.connectionManager.on("transport.active",function(){d.onTransportActive()}),d}return c.prototype.onChannelMessage=function(v){var d=v.channel;if(d===void 0){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+v.action);return}var p=this.all[d];if(!p){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+d);return}p.onMessage(v)},c.prototype.onTransportActive=function(){for(var v in this.all){var d=this.all[v];d.state==="attaching"||d.state==="detaching"?d.checkPendingState():d.state==="suspended"&&d.attach()}},c.prototype.reattach=function(v){for(var d in this.all){var p=this.all[d];p.state==="attached"&&p.requestState("attaching",v)}},c.prototype.resetAttachedMsgIndicators=function(){for(var v in this.all){var d=this.all[v];d.state==="attached"&&(d._attachedMsgIndicator=!1)}},c.prototype.checkAttachedMsgIndicators=function(v){for(var d in this.all){var p=this.all[d];if(p.state==="attached"&&p._attachedMsgIndicator===!1){var f="30s after a resume, found channel which has not received an attached; channelId = "+d+"; connectionId = "+v;l.default.logAction(l.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",f),p.requestState("attaching")}}},c.prototype.propogateConnectionInterruption=function(v,d){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},f=["attaching","attached","detaching","suspended"],b=p[v];for(var _ in this.all){var L=this.all[_];a.arrIn(f,L.state)&&L.notifyState(b,d)}},c.prototype.get=function(v,d){v=String(v);var p=this.all[v];if(!p)p=this.all[v]=new y.default(this.realtime,v,d);else if(d){if(p._shouldReattachToSetOptions(d))throw new R.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(d)}return p},c.prototype.release=function(v){v=String(v);var d=this.all[v];if(!!d){var p=d.getReleaseErr();if(p)throw p;delete this.all[v],delete this.inProgress[v]}},c.prototype.setInProgress=function(v,d,p){this.inProgress[v.name]=this.inProgress[v.name]||{},this.inProgress[v.name][d]=p,!p&&this.hasNopending()&&this.emit("nopending")},c.prototype.onceNopending=function(v){if(this.hasNopending()){v();return}this.once("nopending",v)},c.prototype.hasNopending=function(){return a.arrEvery(a.valuesArray(this.inProgress,!0),function(v){return!a.containsValue(v,!0)})},c}(C.default);r.default=A},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(7)),C=s.__importDefault(n(25)),l=s.__importDefault(n(3)),h=s.__importDefault(n(36)),y=s.__importDefault(n(0));function T(){}var R=function(u){s.__extends(S,u);function S(I,M){var A=u.call(this)||this;return A.whenState=function(m,E){return O.default.prototype.whenState.call(A,m,A.state,E,new h.default(void 0,m))},A.ably=I,A.connectionManager=new C.default(I,M),A.state=A.connectionManager.state.state,A.key=void 0,A.id=void 0,A.serial=void 0,A.timeSerial=void 0,A.recoveryKey=void 0,A.errorReason=null,A.connectionManager.on("connectionstate",function(m){var E=A.state=m.current;y.default.Config.nextTick(function(){A.emit(E,m)})}),A.connectionManager.on("update",function(m){y.default.Config.nextTick(function(){A.emit("update",m)})}),A}return S.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},S.prototype.ping=function(I){if(l.default.logAction(l.default.LOG_MINOR,"Connection.ping()",""),!I){if(this.ably.options.promises)return a.promisify(this,"ping",arguments);I=T}this.connectionManager.ping(null,I)},S.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},S}(O.default);r.default=R},function(o,r,n){"use strict";r.__esModule=!0,r.PendingMessage=void 0;var s=n(1),a=s.__importDefault(n(10)),O=s.__importStar(n(2)),C=s.__importDefault(n(7)),l=s.__importDefault(n(3)),h=s.__importDefault(n(35)),y=s.__importDefault(n(5)),T=a.default.Action,R=function(){function S(I,M){this.message=I,this.callback=M,this.merged=!1;var A=I.action;this.sendAttempted=!1,this.ackRequired=A==T.MESSAGE||A==T.PRESENCE}return S}();r.PendingMessage=R;var u=function(S){s.__extends(I,S);function I(M){var A=S.call(this)||this;return A.transport=M,A.messageQueue=new h.default,M.on("ack",function(m,E){A.onAck(m,E)}),M.on("nack",function(m,E,c){A.onNack(m,E,c)}),A}return I.prototype.onAck=function(M,A){l.default.logAction(l.default.LOG_MICRO,"Protocol.onAck()","serial = "+M+"; count = "+A),this.messageQueue.completeMessages(M,A)},I.prototype.onNack=function(M,A,m){l.default.logAction(l.default.LOG_ERROR,"Protocol.onNack()","serial = "+M+"; count = "+A+"; err = "+O.inspectError(m)),m||(m=new y.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(M,A,m)},I.prototype.onceIdle=function(M){var A=this.messageQueue;if(A.count()===0){M();return}A.once("idle",M)},I.prototype.send=function(M){M.ackRequired&&this.messageQueue.push(M),l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Protocol.send()","sending msg; "+a.default.stringify(M.message)),M.sendAttempted=!0,this.transport.send(M.message)},I.prototype.getTransport=function(){return this.transport},I.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},I.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},I.prototype.finish=function(){var M=this.transport;this.onceIdle(function(){M.disconnect()})},I}(C.default);r.default=u},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(0)),O=s.__importStar(n(2)),C=s.__importDefault(n(26)),l=s.__importDefault(n(8)),h=s.__importDefault(n(3)),y=s.__importDefault(n(10)),T=s.__importDefault(n(5)),R="web_socket";function u(M){return!!M.on}var S=function(M){s.__extends(A,M);function A(m,E,c){var v=M.call(this,m,E,c)||this;return v.shortName=R,c.heartbeats=a.default.Config.useProtocolHeartbeats,v.wsHost=l.default.getHost(c.options,c.host,!0),v}return A.isAvailable=function(){return!!a.default.Config.WebSocket},A.prototype.createWebSocket=function(m,E){var c=0;if(E)for(var v in E)m+=(c++?"&":"?")+v+"="+E[v];return this.uri=m,new a.default.Config.WebSocket(m)},A.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},A.prototype.connect=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),C.default.prototype.connect.call(this);var m=this,E=this.params,c=E.options,v=c.tls?"wss://":"ws://",d=v+this.wsHost+":"+l.default.getPort(c)+"/";h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+d),this.auth.getAuthParams(function(p,f){if(!m.isDisposed){var b="";for(var _ in f)b+=" "+_+": "+f[_]+";";if(h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+b+" err: "+p),p){m.disconnect(p);return}var L=E.getConnectParams(f);try{var k=m.wsConnection=m.createWebSocket(d,L);k.binaryType=a.default.Config.binaryType,k.onopen=function(){m.onWsOpen()},k.onclose=function(H){m.onWsClose(H)},k.onmessage=function(H){m.onWsData(H.data)},k.onerror=function(H){m.onWsError(H)},u(k)&&k.on("ping",function(){m.onActivity()})}catch(H){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),m.disconnect(H)}}})},A.prototype.send=function(m){var E=this.wsConnection;if(!E){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{E.send(y.default.serialize(m,this.params.format))}catch(v){var c="Exception from ws connection when trying to send: "+O.inspectError(v);h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.send()",c),this.finish("disconnected",new T.default(c,5e4,500))}},A.prototype.onWsData=function(m){h.default.logAction(h.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(y.default.deserialize(m,this.format))}catch(E){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+E.stack)}},A.prototype.onWsOpen=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},A.prototype.onWsClose=function(m){var E,c;if(typeof m=="object"?(c=m.code,E=m.wasClean||c===1e3):(c=m,E=c==1e3),delete this.wsConnection,E){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var v=new T.default("Websocket closed",80003,400);this.finish("disconnected",v)}else{var d="Unclean disconnection of WebSocket ; code = "+c,v=new T.default(d,80003,400);h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsClose()",d),this.finish("disconnected",v)}this.emit("disposed")},A.prototype.onWsError=function(m){var E=this;h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),a.default.Config.nextTick(function(){E.disconnect(Error(m.message))})},A.prototype.dispose=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,a.default.Config.nextTick(function(){if(h.default.logAction(h.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},A}(C.default);function I(M){return S.isAvailable()&&(M.supportedTransports[R]=S),S}r.default=I},function(o,r,n){"use strict";r.__esModule=!0,r.isSuccessCode=void 0;var s;(function(O){O[O.Success=200]="Success",O[O.NoContent=204]="NoContent",O[O.BadRequest=400]="BadRequest",O[O.Unauthorized=401]="Unauthorized",O[O.Forbidden=403]="Forbidden",O[O.RequestTimeout=408]="RequestTimeout",O[O.InternalServerError=500]="InternalServerError"})(s||(s={}));function a(O){return O>=s.Success&&O<s.BadRequest}r.isSuccessCode=a,r.default=s},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importStar(n(2)),O=s.__importDefault(n(34)),C=s.__importDefault(n(7)),l=s.__importDefault(n(3)),h=s.__importDefault(n(14)),y=s.__importDefault(n(5)),T=s.__importDefault(n(37)),R=s.__importDefault(n(22)),u=s.__importDefault(n(38)),S=function(){};function I(d){return d.clientId+":"+d.connectionId}function M(d){return d.channel.realtime.auth.clientId}function A(d){var p=d.channel.realtime,f=p.auth.clientId;return(!f||f==="*")&&p.connection.state==="connected"}function m(d,p,f){switch(d.state){case"attached":case"suspended":f();break;case"initialized":case"detached":case"detaching":case"attaching":d.attach(function(b){b?p(b):f()});break;default:p(y.default.fromValues(T.default.invalidStateError(d.state)))}}function E(d,p){if(d.isSynthesized()||p.isSynthesized())return d.timestamp>p.timestamp;var f=d.parseId(),b=p.parseId();return f.msgSerial===b.msgSerial?f.index>b.index:f.msgSerial>b.msgSerial}var c=function(d){s.__extends(p,d);function p(f){var b=d.call(this,f)||this;return b.channel=f,b.syncComplete=!1,b.members=new v(b),b._myMembers=new v(b),b.subscriptions=new C.default,b.pendingPresence=[],b}return p.prototype.enter=function(f,b){if(A(this))throw new y.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,f,"enter",b)},p.prototype.update=function(f,b){if(A(this))throw new y.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,f,"update",b)},p.prototype.enterClient=function(f,b,_){return this._enterOrUpdateClient(f,b,"enter",_)},p.prototype.updateClient=function(f,b,_){return this._enterOrUpdateClient(f,b,"update",_)},p.prototype._enterOrUpdateClient=function(f,b,_,L){var k=this;if(!L)if(typeof b=="function")L=b,b=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"_enterOrUpdateClient",[f,b,_]);L=S}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence."+_+"Client()","channel = "+H.name+", client = "+(f||"(implicit) "+M(this)));var N=h.default.fromValues({action:_,data:b});f&&(N.clientId=f),h.default.encode(N,H.channelOptions,function(P){if(P){L(P);return}switch(H.state){case"attached":H.sendPresence(N,L);break;case"initialized":case"detached":H.attach();case"attaching":k.pendingPresence.push({presence:N,callback:L});break;default:P=new y.default("Unable to "+_+" presence channel while in "+H.state+" state",90001),P.code=90001,L(P)}})},p.prototype.leave=function(f,b){if(A(this))throw new y.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,f,b)},p.prototype.leaveClient=function(f,b,_){if(!_)if(typeof b=="function")_=b,b=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"leaveClient",[f,b]);_=S}var L=this.channel;if(!L.connectionManager.activeState()){_==null||_(L.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+f);var k=h.default.fromValues({action:"leave",data:b});switch(f&&(k.clientId=f),L.state){case"attached":L.sendPresence(k,_);break;case"attaching":this.pendingPresence.push({presence:k,callback:_});break;case"initialized":case"failed":{var H=new y.default("Unable to leave presence channel (incompatible state)",90001);_==null||_(H);break}default:_==null||_(T.default.invalidStateError(L.state))}},p.prototype.get=function(f,b){var _=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),f=L[0],b=L[1];var k=!f||("waitForSync"in f?f.waitForSync:!0);if(!b){if(this.channel.realtime.options.promises)return a.promisify(this,"get",L);b=S}function H(N){b(null,f?N.list(f):N.values())}if(this.channel.state==="suspended"){k?b(y.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}m(this.channel,b,function(){var N=_.members;k?N.waitSync(function(){H(N)}):H(N)})},p.prototype.history=function(f,b){if(l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),b===void 0)if(typeof f=="function")b=f,f=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"history",arguments);b=S}f&&f.untilAttach&&(this.channel.state==="attached"?(delete f.untilAttach,f.from_serial=this.channel.properties.attachSerial):b(new y.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),O.default.prototype._history.call(this,f,b)},p.prototype.setPresence=function(f,b,_){l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+f.length+" participants; syncChannelSerial = "+_);var L,k,H=this.members,N=this._myMembers,P=[],x=this.channel.connectionManager.connectionId;b&&(this.members.startSync(),_&&(k=_.match(/^[\w-]+:(.*)$/))&&(L=k[1]));for(var z=0;z<f.length;z++){var W=h.default.fromValues(f[z]);switch(W.action){case"leave":H.remove(W)&&P.push(W),W.connectionId===x&&!W.isSynthesized()&&N.remove(W);break;case"enter":case"present":case"update":H.put(W)&&P.push(W),W.connectionId===x&&N.put(W);break}}b&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(T.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<P.length;z++){var W=P[z];this.subscriptions.emit(W.action,W)}},p.prototype.onAttached=function(f){l.default.logAction(l.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+f),f?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var b=this.pendingPresence,_=b.length;if(_){this.pendingPresence=[];var L=[],k=R.default.create();l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+_+" queued presence messages");for(var H=0;H<_;H++){var N=b[H];L.push(N.presence),k.push(N.callback)}this.channel.sendPresence(L,k)}},p.prototype.actOnChannelState=function(f,b,_){switch(f){case"attached":this.onAttached(b);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(_);break}},p.prototype.failPendingPresence=function(f){if(this.pendingPresence.length){l.default.logAction(l.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+a.inspectError(f));for(var b=0;b<this.pendingPresence.length;b++)try{this.pendingPresence[b].callback(f)}catch(_){}this.pendingPresence=[]}},p.prototype._clearMyMembers=function(){this._myMembers.clear()},p.prototype._ensureMyMembersPresent=function(){var f=this,b=this.members,_=this._myMembers,L=function(N){if(N){var P="Presence auto-re-enter failed: "+N.toString(),x=new y.default(P,91004,400);l.default.logAction(l.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",P);var z=new u.default(f.channel.state,f.channel.state,!0,x);f.channel.emit("update",z)}};for(var k in _.map)if(!(k in b.map)){var H=_.map[k];l.default.logAction(l.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete _.map[k]}},p.prototype._synthesizeLeaves=function(f){var b=this.subscriptions;a.arrForEach(f,function(_){var L=h.default.fromValues({action:"leave",connectionId:_.connectionId,clientId:_.clientId,data:_.data,encoding:_.encoding,timestamp:a.now()});b.emit("leave",L)})},p.prototype.on=function(){for(var f=[],b=0;b<arguments.length;b++)f[b]=arguments[b];l.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,f)},p.prototype.off=function(){for(var f=[],b=0;b<arguments.length;b++)f[b]=arguments[b];l.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,f)},p.prototype.subscribe=function(){for(var f=[],b=0;b<arguments.length;b++)f[b]=arguments[b];var _=T.default.processListenerArgs(f),L=_[0],k=_[1],H=_[2],N=this.channel;if(!H){if(this.channel.realtime.options.promises)return a.promisify(this,"subscribe",[L,k]);H=S}if(N.state==="failed"){H(y.default.fromValues(T.default.invalidStateError("failed")));return}this.subscriptions.on(L,k),N.attach(H)},p.prototype.unsubscribe=function(){for(var f=[],b=0;b<arguments.length;b++)f[b]=arguments[b];var _=T.default.processListenerArgs(f),L=_[0],k=_[1];this.subscriptions.off(L,k)},p}(O.default),v=function(d){s.__extends(p,d);function p(f){var b=d.call(this)||this;return b.presence=f,b.map={},b.syncInProgress=!1,b.residualMembers=null,b}return p.prototype.get=function(f){return this.map[f]},p.prototype.getClient=function(f){var b=this.map,_=[];for(var L in b){var k=b[L];k.clientId==f&&k.action!="absent"&&_.push(k)}return _},p.prototype.list=function(f){var b=this.map,_=f&&f.clientId,L=f&&f.connectionId,k=[];for(var H in b){var N=b[H];N.action!=="absent"&&(_&&_!=N.clientId||L&&L!=N.connectionId||k.push(N))}return k},p.prototype.put=function(f){(f.action==="enter"||f.action==="update")&&(f=h.default.fromValues(f),f.action="present");var b=this.map,_=I(f);this.residualMembers&&delete this.residualMembers[_];var L=b[_];return L&&!E(f,L)?!1:(b[_]=f,!0)},p.prototype.values=function(){var f=this.map,b=[];for(var _ in f){var L=f[_];L.action!="absent"&&b.push(L)}return b},p.prototype.remove=function(f){var b=this.map,_=I(f),L=b[_];return L&&!E(f,L)?!1:(this.syncInProgress?(f=h.default.fromValues(f),f.action="absent",b[_]=f):delete b[_],!0)},p.prototype.startSync=function(){var f=this.map,b=this.syncInProgress;l.default.logAction(l.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+b),this.syncInProgress||(this.residualMembers=a.copy(f),this.setInProgress(!0))},p.prototype.endSync=function(){var f=this.map,b=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+b),b){for(var _ in f){var L=f[_];L.action==="absent"&&delete f[_]}this.presence._synthesizeLeaves(a.valuesArray(this.residualMembers));for(var k in this.residualMembers)delete f[k];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},p.prototype.waitSync=function(f){var b=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+b),!b){f();return}this.once("sync",f)},p.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},p.prototype.setInProgress=function(f){l.default.logAction(l.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+f),this.syncInProgress=f,this.presence.syncComplete=!f},p}(C.default);r.default=c},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=n(56),O=n(32),C=n(13),l=s.__importDefault(n(4)),h=s.__importDefault(n(0)),y=function(){function T(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return T.prototype.isWordArray=function(R){return R!=null&&R.sigBytes!==void 0},T.prototype.isArrayBuffer=function(R){return R!=null&&R.constructor===ArrayBuffer},T.prototype.isTypedArray=function(R){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(R)},T.prototype.uint8ViewToBase64=function(R){for(var u="",S=this.base64CharSet,I=R.byteLength,M=I%3,A=I-M,m,E,c,v,d,p=0;p<A;p=p+3)d=R[p]<<16|R[p+1]<<8|R[p+2],m=(d&16515072)>>18,E=(d&258048)>>12,c=(d&4032)>>6,v=d&63,u+=S[m]+S[E]+S[c]+S[v];return M==1?(d=R[A],m=(d&252)>>2,E=(d&3)<<4,u+=S[m]+S[E]+"=="):M==2&&(d=R[A]<<8|R[A+1],m=(d&64512)>>10,E=(d&1008)>>4,c=(d&15)<<2,u+=S[m]+S[E]+S[c]+"="),u},T.prototype.base64ToArrayBuffer=function(R){for(var u=atob==null?void 0:atob(R),S=u.length,I=new Uint8Array(S),M=0;M<S;M++){var A=u.charCodeAt(M);I[M]=A}return I.buffer},T.prototype.isBuffer=function(R){return this.isArrayBuffer(R)||this.isWordArray(R)||this.isTypedArray(R)},T.prototype.toBuffer=function(R){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(R))return new Uint8Array(R);if(this.isTypedArray(R))return new Uint8Array(R.buffer);if(this.isWordArray(R)){for(var u=new ArrayBuffer(R.sigBytes),S=new Uint8Array(u),I=0;I<R.sigBytes;I++)S[I]=R.words[I>>>2]>>>24-I%4*8&255;return S}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},T.prototype.toArrayBuffer=function(R){return this.isArrayBuffer(R)?R:this.toBuffer(R).buffer},T.prototype.toWordArray=function(R){return this.isTypedArray(R)&&(R=R.buffer),this.isWordArray(R)?R:l.default.create(R)},T.prototype.base64Encode=function(R){return this.isWordArray(R)?C.stringify(R):this.uint8ViewToBase64(this.toBuffer(R))},T.prototype.base64Decode=function(R){return ArrayBuffer&&h.default.Config.atob?this.base64ToArrayBuffer(R):C.parse(R)},T.prototype.hexEncode=function(R){return a.stringify(this.toWordArray(R))},T.prototype.hexDecode=function(R){var u=a.parse(R);return ArrayBuffer?this.toArrayBuffer(u):u},T.prototype.utf8Encode=function(R){return TextEncoder?new TextEncoder().encode(R).buffer:O.parse(R)},T.prototype.utf8Decode=function(R){if(!this.isBuffer(R))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(R)?new TextDecoder().decode(R):(R=this.toWordArray(R),O.stringify(R))},T.prototype.bufferCompare=function(R,u){if(!R)return-1;if(!u)return 1;var S=this.toWordArray(R),I=this.toWordArray(u);S.clamp(),I.clamp();var M=S.sigBytes-I.sigBytes;if(M!=0)return M;for(var A=S.words,m=I.words,E=0;E<A.length;E++)if(M=A[E]-m[E],M!=0)return M;return 0},T.prototype.byteLength=function(R){return this.isArrayBuffer(R)||this.isTypedArray(R)?R.byteLength:this.isWordArray(R)?R.sigBytes:-1},T.prototype.typedArrayToBuffer=function(R){return R.buffer},T}();r.default=new y},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return s.enc.Hex})},function(o,r,n){"use strict";n.r(r);var s=n(4),a=n.n(s),O=n(13),C=n.n(O),l=n(21),h=n.n(l),y=n(0),T=n.n(y),R=n(3),u=n.n(R),S=function(){var I="aes",M=256,A="cbc",m=16,E=4,c=4294967296,v=2147483648,d;if(T.a.getRandomWordArray)d=T.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&T.a.getRandomValues){var p=new Uint32Array(E);d=function(P,x){var z=P/4,W=z==E?p:new Uint32Array(z);T.a.getRandomValues(W,function($){x($,T.a.BufferUtils.toWordArray(W))})}}else d=function(P,x){u.a.logAction(u.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=P/4,W=new Array(z),$=0;$<z;$++)W[$]=Math.floor(Math.random()*c)-v;x(null,a.a.create(W))};function f(P){return P+m&-m}function b(P){if(P.algorithm==="aes"&&P.mode==="cbc"){if(P.keyLength===128||P.keyLength===256)return;throw new Error("Unsupported key length "+P.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function _(P){return P.replace("_","/").replace("-","+")}var L=[a.a.create([269488144,269488144,269488144,269488144],16),a.a.create([16777216],1),a.a.create([33685504],2),a.a.create([50529024],3),a.a.create([67372036],4),a.a.create([84215045,83886080],5),a.a.create([101058054,101056512],6),a.a.create([117901063,117901056],7),a.a.create([134744072,134744072],8),a.a.create([151587081,151587081,150994944],9),a.a.create([168430090,168430090,168427520],10),a.a.create([185273099,185273099,185273088],11),a.a.create([202116108,202116108,202116108],12),a.a.create([218959117,218959117,218959117,218103808],13),a.a.create([235802126,235802126,235802126,235798528],14),a.a.create([252645135,252645135,252645135,252645135],15),a.a.create([269488144,269488144,269488144,269488144],16)];function k(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}k.CipherParams=H,k.getDefaultParams=function(P){var x;if(typeof P=="function"||typeof P=="string"){if(u.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof P=="function")k.generateRandomKey(function(W){P(null,k.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,k.getDefaultParams({key:P}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!P.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof P.key=="string"?x=Object(O.parse)(_(P.key)):x=T.a.BufferUtils.toWordArray(P.key);var z=new H;if(z.key=x,z.algorithm=P.algorithm||I,z.keyLength=x.words.length*(4*8),z.mode=P.mode||A,P.keyLength&&P.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+P.keyLength+" was specified, but the key actually has length "+z.keyLength);return b(z),z},k.generateRandomKey=function(P,x){arguments.length==1&&typeof P=="function"&&(x=P,P=void 0),d((P||M)/8,x)},k.getCipher=function(P){var x=P instanceof H?P:k.getDefaultParams(P);return{cipherParams:x,cipher:new N(x,E,P.iv)}};function N(P,x,z){this.algorithm=P.algorithm+"-"+String(P.keyLength)+"-"+P.mode,this.cjsAlgorithm=P.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=T.a.BufferUtils.toWordArray(P.key),z&&(this.iv=T.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=x}return N.prototype.encrypt=function(P,x){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.encrypt()",""),P=T.a.BufferUtils.toWordArray(P);var z=P.sigBytes,W=f(z),$=this,X=function(){$.getIv(function(Q,G){if(Q){x(Q);return}var U=$.encryptCipher.process(P.concat(L[W-z])),B=G.concat(U);x(null,B)})};this.encryptCipher?X():this.iv?(this.encryptCipher=h.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):d(m,function(Q,G){if(Q){x(Q);return}$.encryptCipher=h.a.algo[$.cjsAlgorithm].createEncryptor($.key,{iv:G}),$.iv=G,X()})},N.prototype.decrypt=function(P){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.decrypt()",""),P=T.a.BufferUtils.toWordArray(P);var x=this.blockLengthWords,z=P.words,W=a.a.create(z.slice(0,x)),$=a.a.create(z.slice(x)),X=h.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),Q=X.process($),G=X.finalize();return X.reset(),G&&G.sigBytes&&Q.concat(G),Q},N.prototype.getIv=function(P){if(this.iv){var x=this.iv;this.iv=null,P(null,x);return}var z=this;d(m,function(W,$){if(W){P(W);return}P(null,z.encryptCipher.process($))})},k}();r.default=S},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(){var a=s,O=a.lib,C=O.WordArray,l=a.enc,h=l.Utf16=l.Utf16BE={stringify:function(T){for(var R=T.words,u=T.sigBytes,S=[],I=0;I<u;I+=2){var M=R[I>>>2]>>>16-I%4*8&65535;S.push(String.fromCharCode(M))}return S.join("")},parse:function(T){for(var R=T.length,u=[],S=0;S<R;S++)u[S>>>1]|=T.charCodeAt(S)<<16-S%2*16;return C.create(u,R*2)}};l.Utf16LE={stringify:function(T){for(var R=T.words,u=T.sigBytes,S=[],I=0;I<u;I+=2){var M=y(R[I>>>2]>>>16-I%4*8&65535);S.push(String.fromCharCode(M))}return S.join("")},parse:function(T){for(var R=T.length,u=[],S=0;S<R;S++)u[S>>>1]|=y(T.charCodeAt(S)<<16-S%2*16);return C.create(u,R*2)}};function y(T){return T<<8&4278255360|T>>>8&16711935}}(),s.enc.Utf16})},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(28))})(this,function(s){return function(a){var O=s,C=O.lib,l=C.CipherParams,h=O.enc,y=h.Hex,T=O.format,R=T.Hex={stringify:function(u){return u.ciphertext.toString(y)},parse:function(u){var S=y.parse(u);return l.create({ciphertext:S})}}}(),s.format.Hex})},function(o,r,n){(function(s,a){o.exports=r=a(n(6),n(13),n(61),n(27),n(28))})(this,function(s){return function(){var a=s,O=a.lib,C=O.BlockCipher,l=a.algo,h=[],y=[],T=[],R=[],u=[],S=[],I=[],M=[],A=[],m=[];(function(){for(var v=[],d=0;d<256;d++)d<128?v[d]=d<<1:v[d]=d<<1^283;for(var p=0,f=0,d=0;d<256;d++){var b=f^f<<1^f<<2^f<<3^f<<4;b=b>>>8^b&255^99,h[p]=b,y[b]=p;var _=v[p],L=v[_],k=v[L],H=v[b]*257^b*16843008;T[p]=H<<24|H>>>8,R[p]=H<<16|H>>>16,u[p]=H<<8|H>>>24,S[p]=H;var H=k*16843009^L*65537^_*257^p*16843008;I[b]=H<<24|H>>>8,M[b]=H<<16|H>>>16,A[b]=H<<8|H>>>24,m[b]=H,p?(p=_^v[v[v[k^_]]],f^=v[v[f]]):p=f=1}})();var E=[0,1,2,4,8,16,32,64,128,27,54],c=l.AES=C.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var d=this._keyPriorReset=this._key,p=d.words,f=d.sigBytes/4,b=this._nRounds=f+6,_=(b+1)*4,L=this._keySchedule=[],k=0;k<_;k++)k<f?L[k]=p[k]:(v=L[k-1],k%f?f>6&&k%f==4&&(v=h[v>>>24]<<24|h[v>>>16&255]<<16|h[v>>>8&255]<<8|h[v&255]):(v=v<<8|v>>>24,v=h[v>>>24]<<24|h[v>>>16&255]<<16|h[v>>>8&255]<<8|h[v&255],v^=E[k/f|0]<<24),L[k]=L[k-f]^v);for(var H=this._invKeySchedule=[],N=0;N<_;N++){var k=_-N;if(N%4)var v=L[k];else var v=L[k-4];N<4||k<=4?H[N]=v:H[N]=I[h[v>>>24]]^M[h[v>>>16&255]]^A[h[v>>>8&255]]^m[h[v&255]]}}},encryptBlock:function(v,d){this._doCryptBlock(v,d,this._keySchedule,T,R,u,S,h)},decryptBlock:function(v,d){var p=v[d+1];v[d+1]=v[d+3],v[d+3]=p,this._doCryptBlock(v,d,this._invKeySchedule,I,M,A,m,y);var p=v[d+1];v[d+1]=v[d+3],v[d+3]=p},_doCryptBlock:function(v,d,p,f,b,_,L,k){for(var H=this._nRounds,N=v[d]^p[0],P=v[d+1]^p[1],x=v[d+2]^p[2],z=v[d+3]^p[3],W=4,$=1;$<H;$++){var X=f[N>>>24]^b[P>>>16&255]^_[x>>>8&255]^L[z&255]^p[W++],Q=f[P>>>24]^b[x>>>16&255]^_[z>>>8&255]^L[N&255]^p[W++],G=f[x>>>24]^b[z>>>16&255]^_[N>>>8&255]^L[P&255]^p[W++],U=f[z>>>24]^b[N>>>16&255]^_[P>>>8&255]^L[x&255]^p[W++];N=X,P=Q,x=G,z=U}var X=(k[N>>>24]<<24|k[P>>>16&255]<<16|k[x>>>8&255]<<8|k[z&255])^p[W++],Q=(k[P>>>24]<<24|k[x>>>16&255]<<16|k[z>>>8&255]<<8|k[N&255])^p[W++],G=(k[x>>>24]<<24|k[z>>>16&255]<<16|k[N>>>8&255]<<8|k[P&255])^p[W++],U=(k[z>>>24]<<24|k[N>>>16&255]<<16|k[P>>>8&255]<<8|k[x&255])^p[W++];v[d]=X,v[d+1]=Q,v[d+2]=G,v[d+3]=U},keySize:256/32});a.AES=C._createHelper(c)}(),s.AES})},function(o,r,n){(function(s,a){o.exports=r=a(n(6))})(this,function(s){return function(a){var O=s,C=O.lib,l=C.WordArray,h=C.Hasher,y=O.algo,T=[];(function(){for(var A=0;A<64;A++)T[A]=a.abs(a.sin(A+1))*4294967296|0})();var R=y.MD5=h.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(A,m){for(var E=0;E<16;E++){var c=m+E,v=A[c];A[c]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var d=this._hash.words,p=A[m+0],f=A[m+1],b=A[m+2],_=A[m+3],L=A[m+4],k=A[m+5],H=A[m+6],N=A[m+7],P=A[m+8],x=A[m+9],z=A[m+10],W=A[m+11],$=A[m+12],X=A[m+13],Q=A[m+14],G=A[m+15],U=d[0],B=d[1],K=d[2],V=d[3];U=u(U,B,K,V,p,7,T[0]),V=u(V,U,B,K,f,12,T[1]),K=u(K,V,U,B,b,17,T[2]),B=u(B,K,V,U,_,22,T[3]),U=u(U,B,K,V,L,7,T[4]),V=u(V,U,B,K,k,12,T[5]),K=u(K,V,U,B,H,17,T[6]),B=u(B,K,V,U,N,22,T[7]),U=u(U,B,K,V,P,7,T[8]),V=u(V,U,B,K,x,12,T[9]),K=u(K,V,U,B,z,17,T[10]),B=u(B,K,V,U,W,22,T[11]),U=u(U,B,K,V,$,7,T[12]),V=u(V,U,B,K,X,12,T[13]),K=u(K,V,U,B,Q,17,T[14]),B=u(B,K,V,U,G,22,T[15]),U=S(U,B,K,V,f,5,T[16]),V=S(V,U,B,K,H,9,T[17]),K=S(K,V,U,B,W,14,T[18]),B=S(B,K,V,U,p,20,T[19]),U=S(U,B,K,V,k,5,T[20]),V=S(V,U,B,K,z,9,T[21]),K=S(K,V,U,B,G,14,T[22]),B=S(B,K,V,U,L,20,T[23]),U=S(U,B,K,V,x,5,T[24]),V=S(V,U,B,K,Q,9,T[25]),K=S(K,V,U,B,_,14,T[26]),B=S(B,K,V,U,P,20,T[27]),U=S(U,B,K,V,X,5,T[28]),V=S(V,U,B,K,b,9,T[29]),K=S(K,V,U,B,N,14,T[30]),B=S(B,K,V,U,$,20,T[31]),U=I(U,B,K,V,k,4,T[32]),V=I(V,U,B,K,P,11,T[33]),K=I(K,V,U,B,W,16,T[34]),B=I(B,K,V,U,Q,23,T[35]),U=I(U,B,K,V,f,4,T[36]),V=I(V,U,B,K,L,11,T[37]),K=I(K,V,U,B,N,16,T[38]),B=I(B,K,V,U,z,23,T[39]),U=I(U,B,K,V,X,4,T[40]),V=I(V,U,B,K,p,11,T[41]),K=I(K,V,U,B,_,16,T[42]),B=I(B,K,V,U,H,23,T[43]),U=I(U,B,K,V,x,4,T[44]),V=I(V,U,B,K,$,11,T[45]),K=I(K,V,U,B,G,16,T[46]),B=I(B,K,V,U,b,23,T[47]),U=M(U,B,K,V,p,6,T[48]),V=M(V,U,B,K,N,10,T[49]),K=M(K,V,U,B,Q,15,T[50]),B=M(B,K,V,U,k,21,T[51]),U=M(U,B,K,V,$,6,T[52]),V=M(V,U,B,K,_,10,T[53]),K=M(K,V,U,B,z,15,T[54]),B=M(B,K,V,U,f,21,T[55]),U=M(U,B,K,V,P,6,T[56]),V=M(V,U,B,K,G,10,T[57]),K=M(K,V,U,B,H,15,T[58]),B=M(B,K,V,U,X,21,T[59]),U=M(U,B,K,V,L,6,T[60]),V=M(V,U,B,K,W,10,T[61]),K=M(K,V,U,B,b,15,T[62]),B=M(B,K,V,U,x,21,T[63]),d[0]=d[0]+U|0,d[1]=d[1]+B|0,d[2]=d[2]+K|0,d[3]=d[3]+V|0},_doFinalize:function(){var A=this._data,m=A.words,E=this._nDataBytes*8,c=A.sigBytes*8;m[c>>>5]|=128<<24-c%32;var v=a.floor(E/4294967296),d=E;m[(c+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,m[(c+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,A.sigBytes=(m.length+1)*4,this._process();for(var p=this._hash,f=p.words,b=0;b<4;b++){var _=f[b];f[b]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return p},clone:function(){var A=h.clone.call(this);return A._hash=this._hash.clone(),A}});function u(A,m,E,c,v,d,p){var f=A+(m&E|~m&c)+v+p;return(f<<d|f>>>32-d)+m}function S(A,m,E,c,v,d,p){var f=A+(m&c|E&~c)+v+p;return(f<<d|f>>>32-d)+m}function I(A,m,E,c,v,d,p){var f=A+(m^E^c)+v+p;return(f<<d|f>>>32-d)+m}function M(A,m,E,c,v,d,p){var f=A+(E^(m|~c))+v+p;return(f<<d|f>>>32-d)+m}O.MD5=h._createHelper(R),O.HmacMD5=h._createHmacHelper(R)}(Math),s.MD5})},function(o,r,n){"use strict";var s;r.__esModule=!0;var a=n(1),O=a.__importDefault(n(0)),C=a.__importStar(n(2)),l=a.__importDefault(n(8)),h=a.__importDefault(n(5)),y=a.__importDefault(n(17)),T=a.__importDefault(n(15)),R=a.__importDefault(n(20)),u=a.__importDefault(n(3)),S=n(29);function I(m){var E=m.statusCode;return E===408&&!m.code||E===400&&!m.code||E>=500&&E<=504}function M(m){var E=m.connection,c=E&&E.connectionManager.host;return c?[c].concat(l.default.getFallbackHosts(m.options)):l.default.getHosts(m.options)}var A=(s=function(){function m(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=M,O.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(E,c,v,d,p,f,b){var _=T.default.createRequest(v,d,p,f,R.default.REQ_SEND,c&&c.options.timeouts,E);return _.once("complete",b),_.exec(),_},this.checkConnectivity=function(E){var c=l.default.internetUpUrl;u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+c),this.doUri(y.default.Get,null,c,null,null,null,function(v,d){var p,f=!v&&((p=d)===null||p===void 0?void 0:p.replace(/\n/,""))=="yes";u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+f),E(null,f)})}):O.default.Config.jsonpSupported&&(this.Request=function(E,c,v,d,p,f,b){var _=S.createRequest(v,d,p,f,R.default.REQ_SEND,c&&c.options.timeouts,E);return _.once("complete",b),O.default.Config.nextTick(function(){_.exec()}),_},this.checkConnectivity=function(E){var c=this,v=l.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(E);return}this.checksInProgress=[E],u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+v);var d=new S.Request("isTheInternetUp",v,null,null,null,R.default.REQ_SEND,l.default.TIMEOUTS);d.once("complete",function(p,f){var b=!p&&f;u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+b);for(var _=0;_<c.checksInProgress.length;_++)c.checksInProgress[_](null,b);c.checksInProgress=null}),O.default.Config.nextTick(function(){d.exec()})})}return m.prototype.do=function(E,c,v,d,p,f,b){var _=this,L=typeof v=="function"?v:function(P){return c.baseUri(P)+v},k=c._currentFallback;if(k)if(k.validUntil>C.now()){if(!this.Request){b==null||b(new h.default("Request invoked before assigned to",null,500));return}this.Request(E,c,L(k.host),d,f,p,function(P){for(var x=[],z=1;z<arguments.length;z++)x[z-1]=arguments[z];if(P&&I(P)){c._currentFallback=null,_.do(E,c,v,d,p,f,b);return}b==null||b.apply(void 0,a.__spreadArray([P],x))});return}else c._currentFallback=null;var H=M(c);if(H.length===1){this.doUri(E,c,L(H[0]),d,p,f,b);return}var N=function(P,x){var z=P.shift();_.doUri(E,c,L(z),d,p,f,function(W){for(var $=[],X=1;X<arguments.length;X++)$[X-1]=arguments[X];if(W&&I(W)&&P.length){N(P,!0);return}x&&(c._currentFallback={host:z,validUntil:C.now()+c.options.timeouts.fallbackRetryTimeout}),b==null||b.apply(void 0,a.__spreadArray([W],$))})};N(H)},m.prototype.doUri=function(E,c,v,d,p,f,b){if(!this.Request){b(new h.default("Request invoked before assigned to",null,500));return}this.Request(E,c,v,d,f,p,b)},m}(),s.methods=[y.default.Get,y.default.Delete,y.default.Post,y.default.Put,y.default.Patch],s.methodsWithoutBody=[y.default.Get,y.default.Delete],s.methodsWithBody=[y.default.Post,y.default.Put,y.default.Patch],s);r.default=A},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(40)),O=s.__importStar(n(2)),C=O.getGlobalObject();function l(){var R=C.location;return!C.WebSocket||!R||!R.origin||R.origin.indexOf("http")>-1}var h=C.navigator&&C.navigator.userAgent.toString(),y=C.location&&C.location.href,T={agent:"browser",logTimestamps:!0,userAgent:h,currentUrl:y,noUpgrade:h&&!!h.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:C.WebSocket,xhrSupported:C.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:l(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:a.default,supportsBinary:!!C.TextDecoder,preferBinary:!1,ArrayBuffer:C.ArrayBuffer,atob:C.atob,nextTick:typeof C.setImmediate!="undefined"?C.setImmediate.bind(C):function(R){setTimeout(R,0)},addEventListener:C.addEventListener,inspect:JSON.stringify,stringByteSize:function(R){return C.TextDecoder&&new C.TextEncoder().encode(R).length||R.length},TextEncoder:C.TextEncoder,TextDecoder:C.TextDecoder,Promise:C.Promise,getRandomValues:function(R){if(R!==void 0)return function(u,S){R.getRandomValues(u),S&&S(null)}}(C.crypto||msCrypto)};r.default=T},function(o,r,n){"use strict";(function(s){r.__esModule=!0;var a=n(1),O=a.__importStar(n(2)),C="ablyjs-storage-test",l=function(){function h(){try{s.sessionStorage.setItem(C,C),s.sessionStorage.removeItem(C),this.sessionSupported=!0}catch(y){this.sessionSupported=!1}try{s.localStorage.setItem(C,C),s.localStorage.removeItem(C),this.localSupported=!0}catch(y){this.localSupported=!1}}return h.prototype.get=function(y){return this._get(y,!1)},h.prototype.getSession=function(y){return this._get(y,!0)},h.prototype.remove=function(y){return this._remove(y,!1)},h.prototype.removeSession=function(y){return this._remove(y,!0)},h.prototype.set=function(y,T,R){return this._set(y,T,R,!1)},h.prototype.setSession=function(y,T,R){return this._set(y,T,R,!0)},h.prototype._set=function(y,T,R,u){var S={value:T};return R&&(S.expires=O.now()+R),this.storageInterface(u).setItem(y,JSON.stringify(S))},h.prototype._get=function(y,T){if(T&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!T&&!this.localSupported)throw new Error("Local Storage not supported");var R=this.storageInterface(T).getItem(y);if(!R)return null;var u=JSON.parse(R);return u.expires&&u.expires<O.now()?(this.storageInterface(T).removeItem(y),null):u.value},h.prototype._remove=function(y,T){return this.storageInterface(T).removeItem(y)},h.prototype.storageInterface=function(y){return y?s.sessionStorage:s.localStorage},h}();r.default=new l}).call(this,n(12))},function(o,r,n){"use strict";r.__esModule=!0;var s=n(1),a=s.__importDefault(n(66)),O={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],baseTransportOrder:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],transportPreferenceOrder:[a.default.JsonP,a.default.XhrPolling,a.default.XhrStreaming,a.default.WebSocket],upgradeTransports:[a.default.XhrStreaming,a.default.WebSocket]};r.default=O},function(o,r,n){"use strict";r.__esModule=!0;var s;(function(a){a.WebSocket="web_socket",a.Comet="comet",a.XhrStreaming="xhr_streaming",a.XhrPolling="xhr_polling",a.JsonP="jsonp"})(s||(s={})),r.default=s},function(o,r,n){"use strict";n.r(r);var s=n(29),a=n.n(s),O=n(2),C=n(0),l=n.n(C),h=n(11),y=n.n(h),T=n(15),R=n.n(T),u=function(m){var E="xhr_polling";function c(v,d,p){p.stream=!1,y.a.call(this,v,d,p),this.shortName=E}return O.inherits(c,y.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(v,d,p,f,b){return R.a.createRequest(v,d,p,f,b,this.timeouts)},typeof m!="undefined"&&c.isAvailable()&&(m.supportedTransports[E]=c),c},S=u,I=function(m){var E="xhr_streaming";function c(v,d,p){y.a.call(this,v,d,p),this.shortName=E}return O.inherits(c,y.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.streamingSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(v,d,p,f,b){return R.a.createRequest(v,d,p,f,b,this.timeouts)},typeof m!="undefined"&&c.isAvailable()&&(m.supportedTransports[E]=c),c},M=I,A=r.default=[a.a,S,M]}]).default})});var jl=Kt((hC,IA)=>{IA.exports={name:"@superviz/sdk",version:"0.0.0-development",description:"SuperViz SDK",main:"./dist/index.js",types:"./dist/index.d.ts",files:["src","dist"],scripts:{prepare:"husky install",build:"node ./.esbuild/build.js",postbuild:"tsc --emitDeclarationOnly --declaration",watch:'concurrently -n code,types "yarn watch:code" "yarn watch:types"',"watch:code":"node ./.esbuild/watch.js","watch:types":"tsc --watch","test:unit":"jest","test:unit:watch":"jest --watch","test:unit:coverage":"jest --coverage","test:unit:ci":"jest --ci","test:e2e":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright test ./e2e","test:e2e:pt-br":"E2E_LOCALE=pt-BR yarn test:e2e","test:e2e:en":"E2E_LOCALE=en yarn test:e2e","test:e2e:all":"yarn test:e2e:pt-br && yarn test:e2e:en","test:e2e:install":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright install","test:e2e:generate":"eval $(cat .env | xargs) && npx playwright codegen $E2E_BASE_URL","test:e2e:debug":"eval $(cat .env | xargs) && PWDEBUG=1 yarn test:e2e","test:e2e:headed":"eval $(cat .env | xargs) && yarn test:e2e --headed","semantic-release":"semantic-release",commit:"git-cz"},publishConfig:{access:"public",scope:"@superviz"},repository:{type:"git",url:"https://github.com/SuperViz/sdk.git"},author:"",license:"ISC",bugs:{url:"https://github.com/SuperViz/sdk/issues"},homepage:"https://github.com/SuperViz/sdk#readme",devDependencies:{"@commitlint/cli":"^17.4.2","@commitlint/config-conventional":"^17.4.2","@jest/globals":"^29.5.0","@playwright/test":"^1.28.1","@types/debug":"^4.1.8","@typescript-eslint/eslint-plugin":"^5.27.0","@typescript-eslint/parser":"^5.27.0",concurrently:"^7.2.2","cz-conventional-changelog":"^3.3.0",dotenv:"^16.0.1",esbuild:"^0.14.48",eslint:"^7.32.0 || ^8.2.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.25.2",husky:"^8.0.3",jest:"^28.1.2","jest-environment-jsdom":"^28.1.2","jest-fetch-mock":"^3.0.3","semantic-release":"19.0.5","ts-jest":"^28.0.5",tsc:"^2.0.4",typescript:"^4.7.4",yargs:"^17.5.1"},dependencies:{"@types/jest":"^28.1.3","@types/lodash.isequal":"^4.5.6","@types/node":"^18.7.15",ably:"^1.2.29",bowser:"^2.11.0","bowser-jr":"^1.0.4",debug:"^4.3.4",lodash:"^4.17.21","lodash.debounce":"^4.0.8","lodash.isequal":"^4.5.0","semantic-release-version-file":"^1.0.2"},config:{commitizen:{path:"./node_modules/cz-conventional-changelog"}},husky:{hooks:{"pre-commit":"lint-staged","commit-msg":"commitlint -E HUSKY_GIT_PARAMS"}}}});var Kl={};vc(Kl,{version:()=>MA});var MA,Jl=co(()=>{at();MA="beta"});var $l={};vc($l,{remoteConfig:()=>wA});var wA,ql=co(()=>{at();wA={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});at();at();var hr=(v=>(v.MEETING_START="meeting.start",v.MEETING_LEAVE="meeting.leave",v.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",v.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",v.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",v.MEETING_PARTICIPANT_LEFT="meeting.participant-left",v.MEETING_JOIN="meeting.join",v.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",v.MEETING_HOST_CHANGE="meeting.host-change",v.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",v.MEETING_DEVICES_CHANGE="meeting.devices-change",v.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",v.MEETING_STATE_UPDATE="meeting.state-update",v.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",v.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",v.MY_PARTICIPANT_UPDATED="my-participant.update",v.MY_PARTICIPANT_LEFT="my-participant.left",v.MY_PARTICIPANT_JOINED="my-participant.joined",v.MEETING_KICK_PARTICIPANT="meeting.kick-participant",v.DESTROY="destroy",v))(hr||{});var mi=(C=>(C.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",C.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",C.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",C.TOGGLE_CAM="meeting-controls.toggle-cam",C.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",C.HANG_UP="hang-up",C))(mi||{}),Wn=(I=>(I.REALTIME_JOIN="realtime.join",I.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",I.REALTIME_HOST_CHANGE="realtime.host-change",I.REALTIME_HOST_AVAILABLE="realtime.host-available",I.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",I.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",I.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",I.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",I.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",I.REALTIME_GATHER="realtime.gather",I.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",I.REALTIME_SET_AVATAR="realtime.set-avatar",I.REALTIME_DRAWING_CHANGE="realtime.drawing-change",I.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",I))(Wn||{});var yi=(T=>(T[T.MEETING_FAILED=-1]="MEETING_FAILED",T[T.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",T[T.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",T[T.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",T[T.MEETING_CONNECTING=3]="MEETING_CONNECTING",T[T.MEETING_CONNECTED=4]="MEETING_CONNECTED",T[T.MEETING_RECONNECT=5]="MEETING_RECONNECT",T[T.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",T[T.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",T[T.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",T))(yi||{}),pr=(l=>(l[l.NOT_AVAILABLE=0]="NOT_AVAILABLE",l[l.GOOD=1]="GOOD",l[l.BAD=2]="BAD",l[l.POOR=3]="POOR",l[l.DISCONNECTED=4]="DISCONNECTED",l[l.RECONNECTING=5]="RECONNECTING",l[l.LOST_CONNECTION=6]="LOST_CONNECTION",l))(pr||{}),lo=(C=>(C.NO_CAM="devices.no-cam",C.NO_DEVICES="devices.no-devices",C.DEVICES_BLOCKED="devices.blocked",C.DEVICES_CAM_BLOCKED="devices.cam-blocked",C.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",C.DEVICES_UNKNOWN_ERROR="devices.unknown-error",C))(lo||{});at();var fo=(s=>(s.HOST="host",s.GUEST="guest",s.AUDIENCE="audience",s))(fo||{});at();at();at();var On=(o,r,n)=>ne(void 0,null,function*(){let s=yield fetch(o,{method:r,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(!s.ok)throw s;return s.json()});at();var Oi=An(Oc()),gr=class{constructor(r){this.disable(),this.debug=(0,Oi.default)(r)}log(r,...n){this.debug(r,...n)}enable(r="*"){Oi.default.enable(r)}disable(){Oi.default.disable()}},pt=new gr("@superviz/sdk");at();var el=An(vo());var Tt=class{constructor(r={}){this.subscribe=r=>{this.callbacks.push(r)};this.unsubscribe=r=>{this.callbacks=this.callbacks.filter(n=>n!==r)};this.publish=(...r)=>{!this.callbacks||this.callbacks.forEach(n=>{this.callListener(n,r).catch(s=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${n}
            Event: ${JSON.stringify(r)}
            Error: ${s}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(r,n)=>new Promise((s,a)=>{try{let O=r(...n);s(O)}catch(O){a(O)}});let{logger:n,throttleTime:s}=r;this.logger=n!=null?n:new gr("@superviz/sdk/observer-helper"),this.throttle=s,this.callbacks=[],this.throttle&&(this.publish=(0,el.default)(this.publish,this.throttle))}};at();var sn=class{static createUrl(r,n){return`${r}${n}`}static validateApiKey(r,n){let s="/user/checkapikey",a=this.createUrl(r,s);return On(a,"POST",{apiKey:n})}static fetchConfig(r,n){let s="/immersive-config",a=this.createUrl(r,s);return On(a,"POST",{apiKey:n})}static fetchWaterMark(r,n){return ne(this,null,function*(){let s="/user/watermark",a=this.createUrl(r,s),{message:O}=yield On(a,"POST",{apiKey:n});return O})}};at();function jy(o,r){return ne(this,null,function*(){try{return(yield sn.validateApiKey(o,r))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}})}var nl=jy;at();var Be=An(rl()),yr=class{constructor(){this.browser=Be.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Be.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Be.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Be.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Be.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Be.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Be.default.PLATFORMS_MAP.mobile)||this.browser.is(Be.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Be.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};at();at();var Uo=An(Fl());at();var Di=class{constructor(){this.connectionStatusObserver=new Tt({logger:pt});this.updateMeetingConnectionStatus=r=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=r,this.connectionStatusObserver.publish(r),pt.log("CONNECTION STATUS CHANGE",r)};this.onUpdateBrowserOnlineStatus=r=>{let{type:n}=r;if(n==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.connectionStatus=0}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};at();var Hl=An(Gl());at();var Ni=class{constructor({isAvatarsEnabled:r,isMouseEnabled:n,isLaserEnabled:s,isNameEnabled:a,renderLocalAvatar:O,plugin:C,RealtimeService:l,localParticipant:h}){this.enableAvatars=()=>{this._isAvatarsEnabled=!0};this.disableAvatars=()=>{this._isAvatarsEnabled=!1};this.enableMouse=()=>{this._isMouseEnabled=!0};this.disableMouse=()=>{this._isMouseEnabled=!1};this.enableLaser=()=>{this._isLaserEnabled=!0};this.disableLaser=()=>{this._isLaserEnabled=!1};this.createAvatar=r=>ne(this,null,function*(){if(!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled)return;this.destroyAvatar(r);let s=yield this.plugin.createAvatar(r);this._isNameEnabled&&this.plugin.createName&&this.plugin.createName(r,s)});this.destroyAvatar=r=>{this.plugin.destroyAvatar(r)};this.createMouse=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isMouseEnabled||(this.destroyMouse(r),this.plugin.createMouse(r))};this.destroyMouse=r=>{this.plugin.destroyMouse(r)};this.createLaser=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled||!this._isLaserEnabled||(this.destroyLaser(r),this.plugin.createLaser(r))};this.destroyLaser=r=>{this.plugin.destroyLaser(r)};this.goToParticipant=r=>{this.plugin.goToParticipant(r)};this._isAvatarsEnabled=r,this._isMouseEnabled=n,this._isLaserEnabled=s,this._renderLocalAvatar=O,this._isNameEnabled=a,this.plugin=C,this._localParticipant=h,this.RealtimeService=l,this.plugin.init({subscribeToParticipantsObserver:y=>{l.participantsObserver.subscribe(y)},unsubscribeToParticipantsObserver:y=>{l.participantsObserver.unsubscribe(y)},subscribeToParticipantUpdate:(y,T)=>{l.subscribeToParticipantUpdate(y,T)},unsubscribeToParticipantUpdate:(y,T)=>{l.unsubscribeFromParticipantUpdate(y,T)},updateMyProperties:y=>{l.updateMyProperties(y)},subscribe:l.syncPropertiesObserver.subscribe,unsubscribe:l.syncPropertiesObserver.unsubscribe,getParticipantSlot:l.getParticipantSlot},h)}get isAvatarsEnabled(){return this._isAvatarsEnabled}get isMouseEnabled(){return this._isMouseEnabled}get isLaserEnabled(){return this._isLaserEnabled}};at();var Ui=class{constructor(){this.addParticipantToList=r=>{this._participants||(this._participants=[]),this._participants=[...this._participants,r]};this.setLocalParticipant=r=>{this._participant=r};this.createParticipantOn3D=({id:r,name:n,avatar:s,avatarConfig:a,isAudience:O})=>({id:r,name:n,avatar:s,isAudience:O,avatarConfig:a,position:{x:0,y:0,z:0},rotation:{x:0,y:0}});this.removeParticipant=r=>{this._participants=this._participants.filter(n=>n.id!==r.id)}}get participant(){return this._participant}get participants(){return this._participants}};var Bi=class extends Ni{constructor({isAvatarsEnabled:n,isMouseEnabled:s,isLaserEnabled:a,isNameEnabled:O,renderLocalAvatar:C,plugin:l,RealtimeService:h,avatarConfig:y,localParticipant:T,participantList:R}){let u=n!=null?n:!0,S=s!=null?s:!0,I=a!=null?a:!0;super({plugin:l,RealtimeService:h,isAvatarsEnabled:u,isMouseEnabled:S,isLaserEnabled:I,isNameEnabled:O,renderLocalAvatar:C,localParticipant:T,avatarConfig:y});this.followParticipantId=void 0;this.addParticipant=n=>{if(!n||!n.id||n.isAudience)return;let s=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(s),this.RealtimeService.subscribeToParticipantUpdate(s.id,this.onParticipantUpdated),this.createAvatar(s),this.createMouse(s),this.createLaser(s)};this.removeParticipant=(n,s)=>{this.IntegrationParticipantsService.removeParticipant(n),this.destroyAvatar(n),this.destroyMouse(n),this.destroyLaser(n),s&&this.RealtimeService.unsubscribeFromParticipantUpdate(n.id,this.onParticipantUpdated)};this.updateParticipant=n=>{var O,C;if(!this.participants||this.participants.length===0||!n||!n.id)return;let s=this.participants.find(l=>l.id===n.id);if(!s){this.addParticipant(n);return}let a=!1;if((((O=s.avatar)==null?void 0:O.model)!==((C=n.avatar)==null?void 0:C.model)||!(0,Hl.isEqual)(s.avatarConfig,n.avatarConfig))&&(a=!0),a){this.removeParticipant(n,!1);let l=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(l),this.createAvatar(l),this.createMouse(l),this.createLaser(l)}else{let l=this.IntegrationParticipantsService.participants.findIndex(h=>h.id===n.id);l!==-1&&(this.IntegrationParticipantsService.participants[l]=n)}};this.createLocalParticipant=n=>{let s=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.setLocalParticipant(s)};this.createParticipantList=n=>{n.map(a=>this.IntegrationParticipantsService.createParticipantOn3D(a)).forEach(a=>{this.addParticipant(a)})};this.onParticipantJoined=n=>{let{participantId:s,name:a,avatar:O,avatarConfig:C,isAudience:l}=n.data;this.addParticipant({id:s,name:a,avatar:O,avatarConfig:C,isAudience:l})};this.onParticipantLeave=n=>{var a;if(!((a=this.participants)!=null&&a.length))return;let s=this.participants.find(O=>O.id===n.clientId);!s||this.removeParticipant(s,!0)};this.onParticipantUpdated=n=>{let{participantId:s,name:a,avatar:O,avatarConfig:C,position:l,rotation:h}=n.data;this.updateParticipant({position:l,rotation:h,id:s,name:a,avatar:O,avatarConfig:C}),this.followParticipantId&&this.plugin.goToParticipant(this.followParticipantId)};this.onRoomInfoUpdate=n=>{if(!n)return;let{gather:s,hostClientId:a,followParticipantId:O}=n;this.followParticipantId=O,s&&this.plugin.goToParticipant(a)};this.IntegrationParticipantsService=new Ui,this.createLocalParticipant(T),this.createParticipantList(R),this.RealtimeService.participantJoinedObserver.subscribe(this.onParticipantJoined),this.RealtimeService.participantLeaveObserver.subscribe(this.onParticipantLeave),this.RealtimeService.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdate),this.onRoomInfoUpdate(this.RealtimeService.roomProperties)}get participants(){return this.IntegrationParticipantsService.participants}get getAvatars(){var n;return(n=this.plugin)==null?void 0:n.getAvatars()}get localParticipant(){return this.IntegrationParticipantsService.participant}};at();at();var Do=An(Wl()),Rr=An(vo());at();var Mo=(h=>(h[h.DISCONNECTED=0]="DISCONNECTED",h[h.INITIALIZING=1]="INITIALIZING",h[h.READY_TO_JOIN=2]="READY_TO_JOIN",h[h.CONNECTING=3]="CONNECTING",h[h.CONNECTED=4]="CONNECTED",h[h.JOINED=5]="JOINED",h[h.FAILED=-1]="FAILED",h[h.RETRYING=-2]="RETRYING",h))(Mo||{});at();at();var wo=(m=>(m[m.yellow=0]="yellow",m[m.turquoise=1]="turquoise",m[m.orange=2]="orange",m[m.blue=3]="blue",m[m.pink=4]="pink",m[m.purple=5]="purple",m[m.green=6]="green",m[m.red=7]="red",m[m.bluedark=8]="bluedark",m[m.pinklight=9]="pinklight",m[m.purplelight=10]="purplelight",m[m.greenlight=11]="greenlight",m[m.orangelight=12]="orangelight",m[m.bluelight=13]="bluelight",m[m.redlight=14]="redlight",m[m.brown=15]="brown",m[m.gray=16]="gray",m))(wo||{}),xo=(o=>(o[o["#FFEF33"]=0]="#FFEF33",o[o["#31E0B0"]=1]="#31E0B0",o[o["#FF5E10"]=2]="#FF5E10",o[o["#00ABF7"]=3]="#00ABF7",o[o["#FF00BB"]=4]="#FF00BB",o[o["#9C29FF"]=5]="#9C29FF",o[o["#6FDD00"]=6]="#6FDD00",o[o["#E30000"]=7]="#E30000",o[o["#304AFF"]=8]="#304AFF",o[o["#FF89C4"]=9]="#FF89C4",o[o["#D597FF"]=10]="#D597FF",o[o["#C6EC5C"]=11]="#C6EC5C",o[o["#FFA115"]=12]="#FFA115",o[o["#75DEFE"]=13]="#75DEFE",o[o["#FAA291"]=14]="#FAA291",o[o["#BB813F"]=15]="#BB813F",o[o["#878291"]=16]="#878291",o))(xo||{});var Gi=class{constructor(){this.participantObservers=[],this.participantsObserver=new Tt({logger:pt}),this.participantJoinedObserver=new Tt({logger:pt}),this.participantLeaveObserver=new Tt({logger:pt}),this.syncPropertiesObserver=new Tt({logger:pt}),this.reconnectObserver=new Tt({logger:pt}),this.roomInfoUpdatedObserver=new Tt({logger:pt}),this.roomListUpdatedObserver=new Tt({logger:pt}),this.hostObserver=new Tt({logger:pt}),this.hostAvailabilityObserver=new Tt({logger:pt}),this.realtimeStateObserver=new Tt({logger:pt}),this.kickAllParticipantsObserver=new Tt({logger:pt}),this.kickParticipantObserver=new Tt({logger:pt}),this.authenticationObserver=new Tt({logger:pt})}subscribeToParticipantUpdate(r,n){this.participantObservers[r]||(this.participantObservers[r]=new Tt({logger:pt})),this.participantObservers[r].subscribe(n)}unsubscribeFromParticipantUpdate(r,n){this.participantObservers[r]&&this.participantObservers[r].unsubscribe(n)}getSlotColor(r){let n=r!=null?r:16;return{color:xo[n],name:wo[n]}}};var OA=1e3*60,CA=6e4,SA=1e4,TA=1e3,Lo=null,qn=class extends Gi{constructor(n,s){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.localParticipantId=null;this.isBroadcast=!1;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({hostClientId:s.clientId})};this.setKickParticipant=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({kickParticipant:s})};this.freezeSync=n=>{var s,a;if(this.isSyncFrozen=n,n){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(s=this.broadcastChannel)==null||s.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(a=this.broadcastChannel)==null||a.unsubscribe();return}this.join(this.myParticipant.data)};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(n=>{let s=this.clientSyncPropertiesQueue[n];this.clientSyncPropertiesQueue[n]=[],s.length&&this.clientSyncChannel.publish(n,s)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(n,s)=>{this.clientRoomState[n]=s[s.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),pt.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=n=>ne(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?(n==null?void 0:n.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(n.hostClientId):(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),n.kickParticipant&&n.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,Rr.default)(n=>{let s=n;if(!(this.isMessageTooBig(n)||this.left||!this.enableSync||this.isSyncFrozen)&&(s.avatar===void 0&&delete s.avatar,this.myParticipant.data=Le(Le({},this.myParticipant.data),n),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},TA);this.updateRoomProperties=n=>{if(this.isMessageTooBig(n)||this.isSyncFrozen||this.left)return;let s=Le(Le({},this.localRoomProperties),n);this.supervizChannel.publish("update",s)};this.updateParticipants=()=>{let n={};this.supervizChannel.presence.get((s,a)=>{a.forEach(O=>{n[O.clientId]=Le({},O)}),this.participants=n,this.checkBroadcast(),this.participantsObserver.publish(this.participants)})};this.updateHostInfo=n=>{let s=[];if(this.supervizChannel.presence.get((O,C)=>{C.forEach(l=>{O||s.push(l.clientId)})}),!n||!s.includes(n)){this.hostPassingHandle();return}Lo&&(clearTimeout(Lo),this.hostAvailabilityObserver.publish(!0));let a=this.hostParticipantId;this.hostParticipantId=n,this.hostObserver.publish({oldHostParticipantId:a,newHostParticipantId:this.hostParticipantId}),pt.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var s;let n={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((s=this.myParticipant)==null?void 0:s.data.type)==="host"&&(n.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(n)};this.hostPassingHandle=(0,Rr.default)(()=>ne(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((n,s)=>{let a=s.filter(C=>C.data.type==="host").map(C=>C.clientId);if(this.shouldKickParticipantsOnHostLeave&&a.length===0){this.hostAvailabilityObserver.publish(!1),Lo=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},OA);return}let O=a[0];O===this.localParticipantId&&this.setHost(O)})}),1e3);this.findSlotIndex=n=>{let s=n,a=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((l,h)=>{if(l){a=[];return}h.forEach(y=>{y.connectionId===s.connectionId&&(s=y),y.connectionId!==s.connectionId&&y.data.hasOwnProperty("slotIndex")&&a.splice(a.indexOf(y.data.slotIndex),1)})}),a.length===0)return;let O=a[0];this.myParticipant.data.slotIndex=O,this.updateMyProperties({slotIndex:O});let C=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(s)},C)};this.confirmSlot=(0,Rr.default)(n=>ne(this,null,function*(){let s=[],a=n;if(this.supervizChannel.presence.get((O,C)=>{C.forEach(l=>{l.connectionId===a.connectionId&&(a=l),l.connectionId!==a.connectionId&&l.data.slotIndex!==void 0&&s.push(l.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||s.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(a);else{let O=yield this.fetchRoomProperties();this.updateRoomProperties(O)}}),1e3);this.onParticipantJoin=n=>{this.updateParticipants(),this.participantJoinedObserver.publish(n),this.updateMyProperties({})};this.syncBroadcast=(0,Rr.default)(()=>{let n=btoa(this.ablyKey),s=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(s,{headers:{Authorization:`Basic ${n}`}}).then(a=>a.json()).then(a=>{this.broadcastChannel.publish("update",a)})},1e3);this.isMessageTooBig=(n,s=CA)=>{let a=JSON.stringify(n);return new TextEncoder().encode(a).length>s?(pt.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=s,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}start({initialParticipantData:n,roomId:s,apiKey:a,shouldKickParticipantsOnHostLeave:O,isBroadcast:C}){this.myParticipant={data:n,timestamp:null,action:null,clientId:n.participantId,connectionId:null,encoding:null,id:null},this.isBroadcast=C,this.enableSync=n.type!=="audience",this.roomId=`superviz:${s.toLowerCase()}-${a}`,this.localParticipantId=this.myParticipant.data.participantId,this.shouldKickParticipantsOnHostLeave=O,this.apiKey=a,this.client||this.buildClient()}auth(n,s){let a=new Do.default.Rest({key:this.ablyKey}),{origin:O}=window.location;a.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:O,apiKey:this.apiKey}},(C,l)=>{C&&this.authenticationObserver.publish("realtime.authentication-failed"),s(C,l)})}join(n){pt.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(n),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){pt.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{isGridModeEnable:n}))}setDrawing(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{drawing:n}))}setTranscript(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{transcript:n}))}setSyncProperty(n,s){var C;let a=(C=this.clientSyncPropertiesQueue[n])!=null?C:[],O=(l,h)=>({name:l,data:h,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(O(n,s),SA)&&(pt.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(a)&&(pt.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),pt.log("adding to queue",n,s),this.clientSyncPropertiesQueue[n]||(this.clientSyncPropertiesQueue[n]=[]),this.clientSyncPropertiesQueue[n].push(O(n,s)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var s,a;if(n){let O=n.toString();if(this.participants&&this.participants[O])return(a=(s=this.participants[n])==null?void 0:s.data)==null?void 0:a.slotIndex}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:s}=n,a=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(a),this.participants&&this.participants[s]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onClientSyncChannelUpdate(n){let{name:s,data:a}=n,O={};O[s]=a,this.syncPropertiesObserver.publish(O),this.isLocalParticipantHost&&this.saveClientRoomState(s,a)}onReceiveBroadcastSync(n){n.data.forEach(a=>{var C;let O=a.clientId;this.participants[O]=a,(C=a.data)!=null&&C.isAudience||(this.participants[O].data=JSON.parse(this.participants[O].data),this.publishParticipantUpdate(this.participants[O]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Do.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}checkBroadcast(){this.isBroadcast=Object.values(this.participants).some(n=>n.data.type==="audience")}forceReconnect(){if(pt.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){pt.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join(this.myParticipant.data);return}pt.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw pt.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,pt.log("REALTIME",`Realtime state did change. New state: ${Mo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,s)=>{this.supervizChannel.history((a,O)=>{var l;a&&s(a);let C=(l=O.items[0])==null?void 0:l.data;n(C||null)})})}fetchSyncClientProperty(n){return ne(this,null,function*(){try{let s=yield new Promise((a,O)=>{this.clientRoomStateChannel.history((C,l)=>{var y;C&&O(C);let h=(y=l==null?void 0:l.items[0])==null?void 0:y.data;a(h||null)})});if(n&&!s[n])throw new Error(`Event ${n} not found in the history`);return n?s[n]:s}catch(s){pt.log("REALTIME","Error in fetch client realtime data",s.message),this.throw(s.message)}})}onStateChange(){var T,R,u;let n=(T=this.supervizChannelState)==null?void 0:T.current,s=(R=this.connectionState)==null?void 0:R.current,a=s==="connected",O=["initialized","connecting"].includes(s),C=["closed","closing"].includes(s)||["detaching","detached"].includes(n),l={[0]:C,[1]:O,[2]:!n&&a,[3]:n==="attaching",[4]:n==="attached"&&a,[-1]:n==="failed"||s==="failed",[-2]:s==="suspended"||n==="suspended"},h=Object.entries(l).find(([S,I])=>I&&S)[0],y=Number(h);if(y===2&&(this.currentReconnectAttempt=0),a&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(y===-2||y===-1)&&this.forceReconnect(),(u=this.connectionState)!=null&&u.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(y)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.supervizChannelState=n,this.onStateChange()}onJoinRoom(n){return ne(this,null,function*(){var s;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(n),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let a=this.myParticipant.data.type==="host";(s=this.localRoomProperties)!=null&&s.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):a&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(n),pt.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let s=n.data.participantId===this.hostParticipantId;n.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(n),s&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};at();at();at();var RA=`
  html, body { 
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #sv-video-wrapper iframe {
    position: fixed;
    
    border: none;

    margin: 0; 
    padding: 0; 
    overflow: hidden;
    z-index: 5;
  }

  #sv-video-wrapper iframe.sv-video-frame--right { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
  }

  #sv-video-wrapper iframe.sv-video-frame--left { 
    top: var(--superviz-offset-top);
    left: var(--superviz-offset-left);
  }

  #sv-video-wrapper iframe.sv-video-frame--bottom { 
    bottom: var(--superviz-offset-bottom);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--top { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--no-overlay { 
    display: none;
  }
`,kl=RA;at();var Hi=class{build(r,n,s,a={},O={}){let C=document.querySelector(`#${r}`),l=new URL(n);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(a).forEach(([h,y])=>{l.searchParams.set(h,y)}),Object.entries(O).forEach(([h,y])=>{this.element.setAttribute(h,y)}),this.element.src=l.toString(),this.element.id=s,C.appendChild(this.element),this.wrapperId=r}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let r=document.querySelector(`#${this.wrapperId}`);!!r&&!!r.querySelector(`#${this.element.id}`)&&r.removeChild(this.element),this.wrapperId=null,this.element=null}};at();var Wi=class{constructor(r){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(r,n={})=>{this.logger.log("MessageBridge","Posting message to frame",r,n),this.contentWindow.postMessage({type:r,data:n},this.allowedOrigins)};this.listen=(r,n)=>{this.observers[r]||(this.observers[r]=new Tt({logger:this.logger})),this.observers[r].subscribe(n)};this.onReceiveMessage=r=>{let{type:n,data:s,source:a}=r.data;if(this.sourceBlockList.includes(a)||this.originBlockList.includes(r.origin))return;let O=!!n,C=!this.domains.length||this.domains.includes(r.origin),l=this.observers.hasOwnProperty(n);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${r.type}
        ORIGIN: ${r.origin}
        DATA: ${JSON.stringify(r.data)} `),!O||!C||!l){this.logger.log("MessageBridge","Message discarded");return}this.observers[n].publish(s)};let{contentWindow:n,domains:s=[],allowedOrigins:a="*",sourceBlockList:O=[],logger:C}=r;if(this.logger=C,this.domains=s,this.allowedOrigins=a,this.sourceBlockList.push(...O),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=n,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([r,n])=>{n.reset(),delete this.observers[r]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};at();var No=(m=>(m.svPrimary="sv-primary",m.svPrimary900="sv-primary-900",m.svPrimary200="sv-primary-200",m.svSecondary="sv-secondary",m.svGray="sv-gray",m.svSuccess="sv-success",m.svDanger="sv-danger",m.svBlack="sv-black",m.svWhite="sv-white",m.svGray100="sv-gray-100",m.svGray200="sv-gray-200",m.svGray300="sv-gray-300",m.svGray400="sv-gray-400",m.svGray500="sv-gray-500",m.svGray600="sv-gray-600",m.svGray700="sv-gray-700",m.svGray800="sv-gray-800",m))(No||{});var zl="sv-video-frame",Er=class{constructor(r){this.frameStateObserver=new Tt({logger:pt});this.frameSizeObserver=new Tt({logger:pt});this.realtimeObserver=new Tt({logger:pt});this.hostChangeObserver=new Tt({logger:pt});this.kickParticipantObserver=new Tt({logger:pt});this.gridModeChangeObserver=new Tt({logger:pt});this.drawingChangeObserver=new Tt({logger:pt});this.transcriptChangeObserver=new Tt({logger:pt});this.followParticipantObserver=new Tt({logger:pt});this.goToParticipantObserver=new Tt({logger:pt});this.gatherParticipantsObserver=new Tt({logger:pt});this.waitingForHostObserver=new Tt({logger:pt});this.sameAccountErrorObserver=new Tt({logger:pt});this.devicesObserver=new Tt({logger:pt});this.meetingStateObserver=new Tt({logger:pt});this.meetingConnectionObserver=new Tt({logger:pt});this.participantJoinedObserver=new Tt({logger:pt});this.participantLeftObserver=new Tt({logger:pt});this.frameState=0;this.layoutModalsAndCamerasConfig=(r,n)=>{let s=r,a=n,O=["left","right","bottom","top"].includes(a),C=["left","right","center"].includes(s);return O||(a="right"),C||(s="right"),this.browserService.isMobileDevice?(a="bottom",{layoutPosition:s,camerasPosition:a}):(s==="left"&&a==="right"&&(s="right"),s==="right"&&a==="left"&&(s="left"),{layoutPosition:s,camerasPosition:a})};this.onFrameLoad=()=>{this.messageBridge=new Wi({logger:pt,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=r=>{let n=r!=null?r:{};["top","bottom","left","right"].forEach(s=>{Object.keys(n).includes(s)||(n[s]=0)}),this.frameOffset=n};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=r=>{let n=document.createElement("style"),{bottom:s,left:a,right:O,top:C}=this.frameOffset;if(n.innerHTML=`
    :root {
      --superviz-offset-top: ${C}px;
      --superviz-offset-right: ${O}px;
      --superviz-offset-left: ${a}px;
      --superviz-offset-bottom: ${s}px;
    } 
    ${kl}    
    `,document.head.appendChild(n),this.frameConfig.disableCameraOverlay){this.bricklayer.element.classList.add("sv-video-frame--no-overlay");return}if(this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${r}`)};this.onFrameDimensionsUpdate=({width:r,height:n})=>{let s=document.getElementById(zl),{bottom:a,right:O,left:C,top:l}=this.frameOffset,h=this.isWaterMarkEnabled?40:0,y=`${r}px`,T=`${n+h}px`;(r>=window.innerWidth||this.isHorizontalCameraEnabled)&&(y=`calc(100% - ${O}px - ${C}px)`),n>=window.innerHeight&&(T=`calc(100% - ${l}px - ${a}px)`),s.style.width=y,s.style.height=T,this.frameSizeObserver.publish({width:y,height:T})};this.onWindowResize=()=>{let{top:r,bottom:n,right:s,left:a}=this.frameOffset,{innerHeight:O,innerWidth:C}=window,l=O-r-n,h=C-s-a;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:l,width:h})};this.updateFrameLocale=()=>{var O,C;if(!this.frameLocale||!((O=this.frameLocale)!=null&&O.language)&&((C=this.frameLocale)==null?void 0:C.locales))return;let{language:r,locales:n}=this.frameLocale,s=n.map(l=>l==null?void 0:l.language),a=["en",...s];if(r&&!a.includes(r))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantLeft=r=>{this.participantLeftObserver.publish(r)};this.realtimeJoin=(r={})=>{this.realtimeObserver.publish(r)};this.onMeetingHostChange=r=>{this.hostChangeObserver.publish(r)};this.onMeetingKickParticipant=r=>{this.kickParticipantObserver.publish(r)};this.onFollowParticipantDidChange=r=>{this.followParticipantObserver.publish(r)};this.onGoToDidChange=r=>{this.goToParticipantObserver.publish(r)};this.onGather=()=>{this.gatherParticipantsObserver.publish()};this.onGridModeChange=r=>{this.gridModeChangeObserver.publish(r)};this.onDrawingChange=r=>{this.drawingChangeObserver.publish(r)};this.onTranscriptChange=r=>{this.transcriptChangeObserver.publish(r)};this.onSameAccountError=r=>{this.sameAccountErrorObserver.publish(r)};this.onDevicesChange=r=>{this.devicesObserver.publish(r)};this.meetingStateUpdate=r=>{this.meetingStateObserver.publish(r)};this.onConnectionStatusChange=r=>{this.meetingConnectionObserver.publish(r)};this.onWaitingForHostDidChange=r=>{this.waitingForHostObserver.publish(r)};var P,x,z,W;let{conferenceLayerUrl:n,ablyKey:s,apiKey:a,apiUrl:O,debug:C,language:l,roomId:h,canUseCams:y,canUseChat:T,canUseScreenshare:R,canUseDefaultAvatars:u,canUseFollow:S,canUseGoTo:I,canUseGather:M,browserService:A,offset:m,canUseDefaultToolbar:E,locales:c,avatars:v,customColors:d,waterMark:p,disableCameraOverlay:f,layoutPosition:b,camerasPosition:_}=r,{skipMeetingSettings:L,devices:k}=r;this.browserService=A;let H=this.layoutModalsAndCamerasConfig(b,_);f&&(L=!0,k={audioInput:!1,audioOutput:!1,videoInput:!1});let N=document.createElement("div");this.frameConfig={apiKey:a,apiUrl:O,ablyKey:s,debug:C,canUseFollow:S,canUseGoTo:I,canUseCams:y,canUseChat:T,canUseGather:M,canUseScreenshare:R,canUseDefaultAvatars:u,camerasPosition:(P=H.camerasPosition)!=null?P:"right",canUseDefaultToolbar:E,roomId:h,devices:{audioInput:(x=k==null?void 0:k.audioInput)!=null?x:!0,audioOutput:(z=k==null?void 0:k.audioOutput)!=null?z:!0,videoInput:(W=k==null?void 0:k.videoInput)!=null?W:!0},waterMark:p,skipMeetingSettings:L,disableCameraOverlay:f,layoutPosition:H.layoutPosition},this.customColors=d,N.classList.add("sv_video_wrapper"),N.id="sv-video-wrapper",document.body.appendChild(N),this.updateFrameState(1),this.bricklayer=new Hi,this.bricklayer.build(N.id,n,zl,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(m),this.setFrameStyle(H.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:l,locales:c},this.meetingAvatars=v,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:["all","powered-by"].includes(this.frameConfig.waterMark)}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.join",this.realtimeJoin),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(r){r!==this.frameState&&(this.frameState=r,this.frameStateObserver.publish(this.frameState));let n={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(n[r])}start(r){this.messageBridge.publish("meeting.start",vi(Le({},r),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var r,n;(r=this.messageBridge)==null||r.destroy(),(n=this.bricklayer)==null||n.destroy(),this.frameSizeObserver.destroy(),this.realtimeObserver.destroy(),this.hostChangeObserver.destroy(),this.kickParticipantObserver.destroy(),this.gridModeChangeObserver.destroy(),this.drawingChangeObserver.destroy(),this.transcriptChangeObserver.destroy(),this.followParticipantObserver.destroy(),this.goToParticipantObserver.destroy(),this.gatherParticipantsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(r,n){this.messageBridge.publish(r,n)}};var _A=jl(),Bo=class{constructor({conferenceLayerUrl:r,apiUrl:n,apiKey:s,debug:a=!1,language:O,roomId:C,ablyKey:l,group:h,participant:y,shouldKickParticipantsOnHostLeave:T,camsOff:R,screenshareOff:u,chatOff:S,defaultAvatars:I,offset:M,enableFollow:A,enableGoTo:m,enableGather:E,defaultToolbar:c,locales:v,avatars:d,devices:p,customColors:f,waterMark:b,camerasPosition:_,skipMeetingSettings:L=!1,disableCameraOverlay:k=!1,layoutPosition:H}){this.integrationManager=null;this.observers={};this.participantList=[];this.isBroadcast=!1;this.setSyncProperty=(r,n)=>{this.realtime.setSyncProperty(r,n)};this.subscribe=(r,n)=>{this.observers[r]||(this.observers[r]=new Tt({logger:pt})),this.observers[r].subscribe(n)};this.unsubscribe=r=>{this.observers[r]&&(this.observers[r].reset(),delete this.observers[r])};this.startVideo=r=>{this.videoManager=new Er(r),this.videoManager.frameStateObserver.subscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.subscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.subscribe(this.onHostDidChange),this.videoManager.kickParticipantObserver.subscribe(this.onKickParticipant),this.videoManager.followParticipantObserver.subscribe(this.onFollowParticipantDidChange),this.videoManager.goToParticipantObserver.subscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.subscribe(this.onGatherDidChange),this.videoManager.gridModeChangeObserver.subscribe(this.onGridModeDidChange),this.videoManager.drawingChangeObserver.subscribe(this.onDrawingDidChange),this.videoManager.transcriptChangeObserver.subscribe(this.onTranscriptDidChange),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.devicesObserver.subscribe(this.onDevicesChange),this.videoManager.participantLeftObserver.subscribe(this.onMyParticipantLeft),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus)};this.publish=(r,n)=>{r in this.observers&&this.observers[r].publish(n)};this.onSyncPropertiesDidChange=r=>{Object.entries(r).forEach(([n,s])=>{this.publish(n,s)})};this.onKickAllParticipantsDidChange=r=>{this.publish("meeting.kick-all-participants",r),this.destroy()};this.onRealtimeJoin=r=>{this.realtime.join(r)};this.onHostDidChange=r=>{this.realtime.setHost(r)};this.onKickParticipant=r=>{this.realtime.setKickParticipant(r)};this.onFollowParticipantDidChange=r=>{this.realtime.setFollowParticipant(r),this.setSyncProperty("realtime.follow-participant",r)};this.onGoToParticipantDidChange=r=>{var n;(n=this.integrationManager)==null||n.goToParticipant(r),this.setSyncProperty("realtime.go-to-participant",r)};this.onGatherDidChange=()=>{this.realtime.setGather(!0),this.setSyncProperty("realtime.gather")};this.onFrameStateDidChange=r=>{r===2&&this.start()};this.onFrameSizeDidChange=r=>{this.publish("frame.dimensions-update",r)};this.onWaitingForHost=r=>{this.publish("meeting.waiting-for-host",r)};this.onRoomInfoUpdated=r=>{let{isGridModeEnable:n,followParticipantId:s,gather:a,drawing:O,transcript:C}=r;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",n),this.videoManager.publishMessageToFrame("realtime.drawing-change",O),this.videoManager.publishMessageToFrame("realtime.transcript-change",C),this.videoManager.publishMessageToFrame("realtime.follow-participant",s),this.realtime.hostClientId===this.participant.id&&a&&this.realtime.setGather(!1)};this.onParticipantsDidChange=r=>{let n=Object.values(r).map(O=>({timestamp:O.timestamp,connectionId:O.connectionId,participantId:O.clientId,color:this.realtime.getSlotColor(O.data.slotIndex).name,name:O.data.name})),s=this.updateParticipantListFromAblyList(r),a=s.find(O=>{var C;return(O==null?void 0:O.id)===((C=this.participant)==null?void 0:C.id)});(0,Uo.default)(this.participantList,s)||(this.publish("meeting.participant-list-update",this.participantList),this.videoManager.publishMessageToFrame("realtime.participant-list-update",n)),this.participantList.length!==s.length&&this.publish("meeting.amount-of-participants-update",s.length),a&&!(0,Uo.default)(this.participant,a)&&(this.participant=a,this.publish("my-participant.update",this.participant)),this.participantList=s};this.onHostParticipantDidChange=r=>{let n=this.participantList.find(s=>s.id===(r==null?void 0:r.newHostParticipantId));this.videoManager.publishMessageToFrame("realtime.host-change",r==null?void 0:r.newHostParticipantId),this.realtime.isLocalParticipantHost&&this.setSyncProperty("meeting.host-change",n)};this.onHostAvailabilityDidChange=r=>{if(r){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.onGridModeDidChange=r=>{this.realtime.setGridMode(r)};this.onDrawingDidChange=r=>{this.realtime.setDrawing(r)};this.onTranscriptDidChange=r=>{this.realtime.setTranscript(r)};this.updateParticipantListFromAblyList=r=>Object.values(r).map(s=>{var a;return{id:s.clientId,color:this.realtime.getSlotColor((a=s.data)==null?void 0:a.slotIndex).color,avatarConfig:s.data.avatarConfig,avatar:s.data.avatar,type:s.data.type,name:s.data.name,isHost:this.realtime.hostClientId===s.clientId}});this.onSameAccountError=r=>{this.publish("meeting.same-participant-error",r),this.destroy()};this.onDevicesChange=r=>{this.publish("meeting.devices-change",r)};this.onParticipantJoined=r=>{this.checkBroadcastMode();let n=this.participantList.find(s=>s.id===r.data.id);!n||(n.id===this.participant.id&&this.publish("my-participant.joined",n),this.publish("meeting.participant-joined",n))};this.onParticipantLeft=r=>{let n=this.participantList.find(s=>s.id===r.data.id);this.publish("meeting.participant-left",n)};this.onMyParticipantLeft=()=>{this.publish("my-participant.left",this.participant),this.destroy()};this.onAuthenticationFailed=r=>{this.publish("realtime.authentication-failed",r),this.destroy()};this.onMeetingStateUpdate=r=>{pt.log("MEETING STATE",r),this.publish("meeting.state-update",r)};this.onConnectionStatusChange=r=>{let n=[2,4,3,6];n.includes(r)&&this.realtime.freezeSync(!0),n.includes(this.connectionService.oldConnectionStatus)&&!n.includes(r)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",r)};var G;this.roomId=C,this.group=h,this.participant=y,this.realtime=new qn(n,l),this.browserService=new yr;let N=!R,P=!u,x=!S,z=!!I&&!((G=y==null?void 0:y.avatar)!=null&&G.model),W=c!=null?c:!0,$=!!A,X=!!m,Q=!!E;(y==null?void 0:y.avatar)===void 0&&(this.participant=Object.assign({},this.participant,{avatar:{model:""}})),this.connectionService=new Di,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange),this.startVideo({conferenceLayerUrl:r,canUseChat:x,canUseCams:N,canUseScreenshare:P,canUseDefaultAvatars:z,canUseFollow:$,canUseGoTo:X,canUseGather:Q,canUseDefaultToolbar:W,devices:p,ablyKey:l,apiKey:s,apiUrl:n,debug:a,language:O,roomId:C,browserService:this.browserService,offset:M,locales:v!=null?v:[],avatars:d!=null?d:[],customColors:f,waterMark:b,camerasPosition:_,skipMeetingSettings:L,disableCameraOverlay:k,layoutPosition:H}),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onParticipantsDidChange),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeft),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onMyParticipantLeft),this.realtime.authenticationObserver.subscribe(this.onAuthenticationFailed),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityDidChange),this.realtime.start({initialParticipantData:Le({participantId:this.participant.id},this.participant),roomId:this.roomId,apiKey:s,shouldKickParticipantsOnHostLeave:T!=null?T:!0,isBroadcast:this.isBroadcast})}get isIntegrationManagerInitialized(){return!!this.integrationManager}checkBroadcastMode(){this.isBroadcast=this.participantList.some(r=>r.type==="audience")}start(){pt.log("SUPERVIZ SDK VERSION",_A.version),this.videoManager.start({roomId:this.roomId,participant:this.participant,group:this.group}),this.publish("meeting.start")}destroy(){this.publish("destroy",void 0),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.unsubscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.unsubscribe(this.onHostDidChange),this.videoManager.kickParticipantObserver.unsubscribe(this.onKickParticipant),this.videoManager.followParticipantObserver.unsubscribe(this.onFollowParticipantDidChange),this.videoManager.gridModeChangeObserver.unsubscribe(this.onGridModeDidChange),this.videoManager.drawingChangeObserver.unsubscribe(this.onDrawingDidChange),this.videoManager.transcriptChangeObserver.unsubscribe(this.onTranscriptDidChange),this.videoManager.goToParticipantObserver.unsubscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.unsubscribe(this.onGatherDidChange),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange),this.videoManager.participantLeftObserver.unsubscribe(this.onMyParticipantLeft),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.unsubscribe(this.onMyParticipantLeft),this.realtime.authenticationObserver.unsubscribe(this.onAuthenticationFailed),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeft),this.connectionService.connectionStatusObserver.unsubscribe(this.onConnectionStatusChange),Object.keys(this.observers).forEach(r=>this.unsubscribe(r)),this.videoManager.leave(),this.realtime.leave(),this.connectionService.removeListeners(),this.unloadPlugin()}publishMeetingControlEvent(r){this.videoManager.publishMessageToFrame(r)}fetchSyncClientProperty(r){return this.realtime.fetchSyncClientProperty(r)}follow(r){this.videoManager.publishMessageToFrame("realtime.follow-participant",r),this.realtime.setFollowParticipant(r)}gather(){this.realtime.setGather(!0)}goTo(r){this.integrationManager.goToParticipant(r)}loadPlugin(r,n){var a,O,C,l,h,y;if(this.isIntegrationManagerInitialized)throw new Error("the 3D plugin has already been started");n.avatarConfig&&this.realtime.setParticipantData({avatarConfig:n.avatarConfig}),this.participant.avatar&&this.participant.avatar.model&&this.realtime.setParticipantData({avatar:this.participant.avatar});let s=[];return this.realtime.getParticipants&&(s=Object.values(this.realtime.getParticipants)),this.integrationManager=new Bi(vi(Le({plugin:r},n),{localParticipant:{id:this.participant.id,name:this.participant.name,avatar:this.participant.avatar,avatarConfig:n.avatarConfig},participantList:s.map(T=>{let R=T.clientId,{name:u,avatar:S,avatarConfig:I,slotIndex:M,isAudience:A}=T.data;return{id:R,name:u,avatar:S,avatarConfig:I,slotIndex:M,isAudience:A}}),RealtimeService:this.realtime})),{enableAvatars:(a=this.integrationManager)==null?void 0:a.enableAvatars,disableAvatars:(O=this.integrationManager)==null?void 0:O.disableAvatars,enableMouse:(C=this.integrationManager)==null?void 0:C.enableMouse,disableMouse:(l=this.integrationManager)==null?void 0:l.disableMouse,enableLaser:(h=this.integrationManager)==null?void 0:h.enableLaser,disableLaser:(y=this.integrationManager)==null?void 0:y.disableLaser,getParticipantsOn3D:()=>{var T;return(T=this.integrationManager)!=null&&T.participants?this.integrationManager.participants:[]},getAvatars:()=>{var T;return(T=this.integrationManager)==null?void 0:T.getAvatars}}}unloadPlugin(){this.integrationManager&&(this.integrationManager.plugin.destroy(),this.integrationManager=null)}},Vl=o=>{let r=new Bo(o);return{setSyncProperty:(n,s)=>r.setSyncProperty(n,s),subscribe:(n,s)=>r.subscribe(n,s),unsubscribe:n=>r.unsubscribe(n),destroy:()=>r.destroy(),follow:n=>r.follow(n),fetchSyncProperty:n=>r.fetchSyncClientProperty(n),gather:()=>r.gather(),goTo:n=>r.goTo(n),toggleMeetingSetup:()=>r.publishMeetingControlEvent("meeting-controls.toggle-setup"),toggleMicrophone:()=>r.publishMeetingControlEvent("meeting-controls.toggle-microphone"),toggleCam:()=>r.publishMeetingControlEvent("meeting-controls.toggle-cam"),toggleScreenShare:()=>r.publishMeetingControlEvent("meeting-controls.toggle-screenshare"),hangUp:()=>r.publishMeetingControlEvent("hang-up"),toggleChat:()=>r.publishMeetingControlEvent("meeting-controls.toggle-chat"),loadPlugin:(n,s)=>r.loadPlugin(n,s),unloadPlugin:()=>r.unloadPlugin()}};at();at();at();at();at();var Qn=class{static getRemoteConfig(){return ne(this,arguments,function*(r="prod"){let{version:n}=yield Promise.resolve().then(()=>(Jl(),Kl));if(r==="local"){let{remoteConfig:O}=yield Promise.resolve().then(()=>(ql(),$l));return O}let s={version:n,environment:r},a=this.createUrl(s);return On(a,"GET",null)})}static createUrl({version:r,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${r}?env=${n}`}};Qn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";var xA=({group:o,participant:r,roomId:n,customColors:s,skipMeetingSettings:a})=>{if(s&&LA(s),!o||!o.name||!o.id)throw new Error("Group fields is required");if(!r||!r.id)throw new Error("Participants fields is required");if(!n)throw new Error("Room id is required");if(a&&!r.name)throw new Error("When skipMeetingSettings is true, participant name is required")},LA=o=>{Object.entries(o).forEach(([r,n])=>{if(!Object.values(No).includes(r))throw new Error(`Color ${r} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(n))throw new Error(`Color ${r} is not a valid color variable value. Please check the documentation for more information.`)})},Ql=(o,r)=>ne(void 0,null,function*(){if(!(o&&o.trim()))throw new Error("API key is required");if(!r)throw new Error("Options is required");xA(r),r.debug&&pt.enable("@superviz/*");let{apiUrl:s,conferenceLayerUrl:a}=yield Qn.getRemoteConfig(r.environment);if(!(yield nl(s,o)))throw new Error("Failed to validate API key");let C=yield sn.fetchConfig(s,o),l=yield sn.fetchWaterMark(s,o),{layoutPosition:h}=r;if(!C||!C.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:y}=C;return Vl(Object.assign({},r,{apiKey:o,ablyKey:y,conferenceLayerUrl:a,apiUrl:s,waterMark:l,layoutPosition:h}))});window&&(window.SuperVizSdk={init:Ql,MeetingEvent:hr,DeviceEvent:lo,RealtimeEvent:Wn,MeetingState:yi,MeetingConnectionStatus:pr,MeetingControlsEvent:mi});var lS={init:Ql};export{yr as BrowserService,lo as DeviceEvent,pr as MeetingConnectionStatus,mi as MeetingControlsEvent,hr as MeetingEvent,yi as MeetingState,fo as ParticipantType,Wn as RealtimeEvent,lS as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
