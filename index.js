var XS=Object.create;var mo=Object.defineProperty,eO=Object.defineProperties,qh=Object.getOwnPropertyDescriptor,tO=Object.getOwnPropertyDescriptors,nO=Object.getOwnPropertyNames,oa=Object.getOwnPropertySymbols,rO=Object.getPrototypeOf,wu=Object.prototype.hasOwnProperty,Zh=Object.prototype.propertyIsEnumerable;var Yh=Math.pow,Kh=(s,t,e)=>t in s?mo(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ce=(s,t)=>{for(var e in t||(t={}))wu.call(t,e)&&Kh(s,e,t[e]);if(oa)for(var e of oa(t))Zh.call(t,e)&&Kh(s,e,t[e]);return s},He=(s,t)=>eO(s,tO(t));var xu=(s,t)=>{var e={};for(var r in s)wu.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&oa)for(var r of oa(s))t.indexOf(r)<0&&Zh.call(s,r)&&(e[r]=s[r]);return e};var Iu=(s,t)=>()=>(s&&(t=s(s=0)),t);var vt=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),Qh=(s,t)=>{for(var e in t)mo(s,e,{get:t[e],enumerable:!0})},iO=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of nO(t))!wu.call(s,i)&&i!==e&&mo(s,i,{get:()=>t[i],enumerable:!(r=qh(t,i))||r.enumerable});return s};var Un=(s,t,e)=>(e=s!=null?XS(rO(s)):{},iO(t||!s||!s.__esModule?mo(e,"default",{value:s,enumerable:!0}):e,s));var Ue=(s,t,e,r)=>{for(var i=r>1?void 0:r?qh(t,e):t,a=s.length-1,l;a>=0;a--)(l=s[a])&&(i=(r?l(t,e,i):l(i))||i);return r&&i&&mo(t,e,i),i};var _e=(s,t,e)=>new Promise((r,i)=>{var a=f=>{try{u(e.next(f))}catch(m){i(m)}},l=f=>{try{u(e.throw(f))}catch(m){i(m)}},u=f=>f.done?r(f.value):Promise.resolve(f.value).then(a,l);u((e=e.apply(s,t)).next())});var Q,D=Iu(()=>{Q={}});var ep=vt((P1,Xh)=>{D();var Si=1e3,Oi=Si*60,Ti=Oi*60,Sr=Ti*24,sO=Sr*7,aO=Sr*365.25;Xh.exports=function(s,t){t=t||{};var e=typeof s;if(e==="string"&&s.length>0)return lO(s);if(e==="number"&&isFinite(s))return t.long?cO(s):uO(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function lO(s){if(s=String(s),!(s.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!t){var e=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return e*aO;case"weeks":case"week":case"w":return e*sO;case"days":case"day":case"d":return e*Sr;case"hours":case"hour":case"hrs":case"hr":case"h":return e*Ti;case"minutes":case"minute":case"mins":case"min":case"m":return e*Oi;case"seconds":case"second":case"secs":case"sec":case"s":return e*Si;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function uO(s){var t=Math.abs(s);return t>=Sr?Math.round(s/Sr)+"d":t>=Ti?Math.round(s/Ti)+"h":t>=Oi?Math.round(s/Oi)+"m":t>=Si?Math.round(s/Si)+"s":s+"ms"}function cO(s){var t=Math.abs(s);return t>=Sr?ua(s,t,Sr,"day"):t>=Ti?ua(s,t,Ti,"hour"):t>=Oi?ua(s,t,Oi,"minute"):t>=Si?ua(s,t,Si,"second"):s+" ms"}function ua(s,t,e,r){var i=t>=e*1.5;return Math.round(s/e)+" "+r+(i?"s":"")}});var np=vt((L1,tp)=>{D();function fO(s){e.debug=e,e.default=e,e.coerce=f,e.disable=a,e.enable=i,e.enabled=l,e.humanize=ep(),e.destroy=m,Object.keys(s).forEach(b=>{e[b]=s[b]}),e.names=[],e.skips=[],e.formatters={};function t(b){let C=0;for(let h=0;h<b.length;h++)C=(C<<5)-C+b.charCodeAt(h),C|=0;return e.colors[Math.abs(C)%e.colors.length]}e.selectColor=t;function e(b){let C,h=null,E,w;function x(...S){if(!x.enabled)return;let O=x,R=Number(new Date),g=R-(C||R);O.diff=g,O.prev=C,O.curr=R,C=R,S[0]=e.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let y=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(p,T)=>{if(p==="%%")return"%";y++;let v=e.formatters[T];if(typeof v=="function"){let I=S[y];p=v.call(O,I),S.splice(y,1),y--}return p}),e.formatArgs.call(O,S),(O.log||e.log).apply(O,S)}return x.namespace=b,x.useColors=e.useColors(),x.color=e.selectColor(b),x.extend=r,x.destroy=e.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(E!==e.namespaces&&(E=e.namespaces,w=e.enabled(b)),w),set:S=>{h=S}}),typeof e.init=="function"&&e.init(x),x}function r(b,C){let h=e(this.namespace+(typeof C=="undefined"?":":C)+b);return h.log=this.log,h}function i(b){e.save(b),e.namespaces=b,e.names=[],e.skips=[];let C,h=(typeof b=="string"?b:"").split(/[\s,]+/),E=h.length;for(C=0;C<E;C++)!h[C]||(b=h[C].replace(/\*/g,".*?"),b[0]==="-"?e.skips.push(new RegExp("^"+b.slice(1)+"$")):e.names.push(new RegExp("^"+b+"$")))}function a(){let b=[...e.names.map(u),...e.skips.map(u).map(C=>"-"+C)].join(",");return e.enable(""),b}function l(b){if(b[b.length-1]==="*")return!0;let C,h;for(C=0,h=e.skips.length;C<h;C++)if(e.skips[C].test(b))return!1;for(C=0,h=e.names.length;C<h;C++)if(e.names[C].test(b))return!0;return!1}function u(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}function f(b){return b instanceof Error?b.stack||b.message:b}function m(){}return e.enable(e.load()),e}tp.exports=fO});var _u=vt((Kt,ca)=>{D();Kt.formatArgs=hO;Kt.save=pO;Kt.load=mO;Kt.useColors=dO;Kt.storage=gO();Kt.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Kt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dO(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function hO(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+ca.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;s.splice(1,0,t,"color: inherit");let e=0,r=0;s[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(e++,i==="%c"&&(r=e))}),s.splice(r,0,t)}Kt.log=console.debug||console.log||(()=>{});function pO(s){try{s?Kt.storage.setItem("debug",s):Kt.storage.removeItem("debug")}catch(t){}}function mO(){let s;try{s=Kt.storage.getItem("debug")}catch(t){}return!s&&typeof process!="undefined"&&"env"in process&&(s=Q.DEBUG),s}function gO(){try{return localStorage}catch(s){}}ca.exports=np()(Kt);var{formatters:vO}=ca.exports;vO.j=function(s){try{return JSON.stringify(s)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var fa=vt((N1,ip)=>{D();function yO(s){var t=typeof s;return s!=null&&(t=="object"||t=="function")}ip.exports=yO});var sp=vt((F1,op)=>{D();var bO=typeof global=="object"&&global&&global.Object===Object&&global;op.exports=bO});var Mu=vt((U1,ap)=>{D();var EO=sp(),AO=typeof self=="object"&&self&&self.Object===Object&&self,CO=EO||AO||Function("return this")();ap.exports=CO});var up=vt((k1,lp)=>{D();var SO=Mu(),OO=function(){return SO.Date.now()};lp.exports=OO});var fp=vt((B1,cp)=>{D();var TO=/\s/;function wO(s){for(var t=s.length;t--&&TO.test(s.charAt(t)););return t}cp.exports=wO});var hp=vt(($1,dp)=>{D();var xO=fp(),IO=/^\s+/;function RO(s){return s&&s.slice(0,xO(s)+1).replace(IO,"")}dp.exports=RO});var Pu=vt((H1,pp)=>{D();var _O=Mu(),MO=_O.Symbol;pp.exports=MO});var yp=vt((G1,vp)=>{D();var mp=Pu(),gp=Object.prototype,PO=gp.hasOwnProperty,LO=gp.toString,bo=mp?mp.toStringTag:void 0;function DO(s){var t=PO.call(s,bo),e=s[bo];try{s[bo]=void 0;var r=!0}catch(a){}var i=LO.call(s);return r&&(t?s[bo]=e:delete s[bo]),i}vp.exports=DO});var Ep=vt((W1,bp)=>{D();var NO=Object.prototype,FO=NO.toString;function UO(s){return FO.call(s)}bp.exports=UO});var Op=vt((z1,Sp)=>{D();var Ap=Pu(),kO=yp(),BO=Ep(),$O="[object Null]",HO="[object Undefined]",Cp=Ap?Ap.toStringTag:void 0;function GO(s){return s==null?s===void 0?HO:$O:Cp&&Cp in Object(s)?kO(s):BO(s)}Sp.exports=GO});var wp=vt((V1,Tp)=>{D();function WO(s){return s!=null&&typeof s=="object"}Tp.exports=WO});var Ip=vt((j1,xp)=>{D();var zO=Op(),VO=wp(),jO="[object Symbol]";function JO(s){return typeof s=="symbol"||VO(s)&&zO(s)==jO}xp.exports=JO});var Pp=vt((J1,Mp)=>{D();var KO=hp(),Rp=fa(),qO=Ip(),_p=0/0,ZO=/^[-+]0x[0-9a-f]+$/i,YO=/^0b[01]+$/i,QO=/^0o[0-7]+$/i,XO=parseInt;function eT(s){if(typeof s=="number")return s;if(qO(s))return _p;if(Rp(s)){var t=typeof s.valueOf=="function"?s.valueOf():s;s=Rp(t)?t+"":t}if(typeof s!="string")return s===0?s:+s;s=KO(s);var e=YO.test(s);return e||QO.test(s)?XO(s.slice(2),e?2:8):ZO.test(s)?_p:+s}Mp.exports=eT});var Np=vt((K1,Dp)=>{D();var tT=fa(),Lu=up(),Lp=Pp(),nT="Expected a function",rT=Math.max,iT=Math.min;function oT(s,t,e){var r,i,a,l,u,f,m=0,b=!1,C=!1,h=!0;if(typeof s!="function")throw new TypeError(nT);t=Lp(t)||0,tT(e)&&(b=!!e.leading,C="maxWait"in e,a=C?rT(Lp(e.maxWait)||0,t):a,h="trailing"in e?!!e.trailing:h);function E(p){var T=r,v=i;return r=i=void 0,m=p,l=s.apply(v,T),l}function w(p){return m=p,u=setTimeout(O,t),b?E(p):l}function x(p){var T=p-f,v=p-m,I=t-T;return C?iT(I,a-v):I}function S(p){var T=p-f,v=p-m;return f===void 0||T>=t||T<0||C&&v>=a}function O(){var p=Lu();if(S(p))return R(p);u=setTimeout(O,x(p))}function R(p){return u=void 0,h&&r?E(p):(r=i=void 0,l)}function g(){u!==void 0&&clearTimeout(u),m=0,r=f=i=u=void 0}function y(){return u===void 0?l:R(Lu())}function d(){var p=Lu(),T=S(p);if(r=arguments,i=this,f=p,T){if(u===void 0)return w(f);if(C)return clearTimeout(u),u=setTimeout(O,t),E(f)}return u===void 0&&(u=setTimeout(O,t)),l}return d.cancel=g,d.flush=y,d}Dp.exports=oT});var Du=vt((q1,Fp)=>{D();var sT=Np(),aT=fa(),lT="Expected a function";function uT(s,t,e){var r=!0,i=!0;if(typeof s!="function")throw new TypeError(lT);return aT(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),sT(s,t,{leading:r,maxWait:t,trailing:i})}Fp.exports=uT});var da=vt((wi,Eo)=>{D();(function(){var s,t="4.17.21",e=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",u=500,f="__lodash_placeholder__",m=1,b=2,C=4,h=1,E=2,w=1,x=2,S=4,O=8,R=16,g=32,y=64,d=128,p=256,T=512,v=30,I="...",U=800,z=16,W=1,N=2,M=3,L=1/0,$=9007199254740991,G=17976931348623157e292,J=0/0,ee=4294967295,re=ee-1,X=ee>>>1,P=[["ary",d],["bind",w],["bindKey",x],["curry",O],["curryRight",R],["flip",T],["partial",g],["partialRight",y],["rearg",p]],k="[object Arguments]",H="[object Array]",j="[object AsyncFunction]",te="[object Boolean]",fe="[object Date]",me="[object DOMException]",Ee="[object Error]",Se="[object Function]",ze="[object GeneratorFunction]",de="[object Map]",Ze="[object Number]",bt="[object Null]",ot="[object Object]",ht="[object Promise]",un="[object Proxy]",yn="[object RegExp]",lt="[object Set]",bn="[object String]",Vn="[object Symbol]",Qi="[object Undefined]",dr="[object WeakMap]",ul="[object WeakSet]",q="[object ArrayBuffer]",oe="[object DataView]",ue="[object Float32Array]",ye="[object Float64Array]",Ne="[object Int8Array]",St="[object Int16Array]",xn="[object Int32Array]",cl="[object Uint8Array]",fl="[object Uint8ClampedArray]",dl="[object Uint16Array]",hl="[object Uint32Array]",Ev=/\b__p \+= '';/g,Av=/\b(__p \+=) '' \+/g,Cv=/(__e\(.*?\)|\b__t\)) \+\n'';/g,bf=/&(?:amp|lt|gt|quot|#39);/g,Ef=/[&<>"']/g,Sv=RegExp(bf.source),Ov=RegExp(Ef.source),Tv=/<%-([\s\S]+?)%>/g,wv=/<%([\s\S]+?)%>/g,Af=/<%=([\s\S]+?)%>/g,xv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Iv=/^\w*$/,Rv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pl=/[\\^$.*+?()[\]{}|]/g,_v=RegExp(pl.source),ml=/^\s+/,Mv=/\s/,Pv=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Lv=/\{\n\/\* \[wrapped with (.+)\] \*/,Dv=/,? & /,Nv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Fv=/[()=,{}\[\]\/\s]/,Uv=/\\(\\)?/g,kv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Cf=/\w*$/,Bv=/^[-+]0x[0-9a-f]+$/i,$v=/^0b[01]+$/i,Hv=/^\[object .+?Constructor\]$/,Gv=/^0o[0-7]+$/i,Wv=/^(?:0|[1-9]\d*)$/,zv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vs=/($^)/,Vv=/['\n\r\u2028\u2029\\]/g,ys="\\ud800-\\udfff",jv="\\u0300-\\u036f",Jv="\\ufe20-\\ufe2f",Kv="\\u20d0-\\u20ff",Sf=jv+Jv+Kv,Of="\\u2700-\\u27bf",Tf="a-z\\xdf-\\xf6\\xf8-\\xff",qv="\\xac\\xb1\\xd7\\xf7",Zv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Yv="\\u2000-\\u206f",Qv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wf="A-Z\\xc0-\\xd6\\xd8-\\xde",xf="\\ufe0e\\ufe0f",If=qv+Zv+Yv+Qv,gl="['\u2019]",Xv="["+ys+"]",Rf="["+If+"]",bs="["+Sf+"]",_f="\\d+",ey="["+Of+"]",Mf="["+Tf+"]",Pf="[^"+ys+If+_f+Of+Tf+wf+"]",vl="\\ud83c[\\udffb-\\udfff]",ty="(?:"+bs+"|"+vl+")",Lf="[^"+ys+"]",yl="(?:\\ud83c[\\udde6-\\uddff]){2}",bl="[\\ud800-\\udbff][\\udc00-\\udfff]",ui="["+wf+"]",Df="\\u200d",Nf="(?:"+Mf+"|"+Pf+")",ny="(?:"+ui+"|"+Pf+")",Ff="(?:"+gl+"(?:d|ll|m|re|s|t|ve))?",Uf="(?:"+gl+"(?:D|LL|M|RE|S|T|VE))?",kf=ty+"?",Bf="["+xf+"]?",ry="(?:"+Df+"(?:"+[Lf,yl,bl].join("|")+")"+Bf+kf+")*",iy="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",oy="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$f=Bf+kf+ry,sy="(?:"+[ey,yl,bl].join("|")+")"+$f,ay="(?:"+[Lf+bs+"?",bs,yl,bl,Xv].join("|")+")",ly=RegExp(gl,"g"),uy=RegExp(bs,"g"),El=RegExp(vl+"(?="+vl+")|"+ay+$f,"g"),cy=RegExp([ui+"?"+Mf+"+"+Ff+"(?="+[Rf,ui,"$"].join("|")+")",ny+"+"+Uf+"(?="+[Rf,ui+Nf,"$"].join("|")+")",ui+"?"+Nf+"+"+Ff,ui+"+"+Uf,oy,iy,_f,sy].join("|"),"g"),fy=RegExp("["+Df+ys+Sf+xf+"]"),dy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],py=-1,st={};st[ue]=st[ye]=st[Ne]=st[St]=st[xn]=st[cl]=st[fl]=st[dl]=st[hl]=!0,st[k]=st[H]=st[q]=st[te]=st[oe]=st[fe]=st[Ee]=st[Se]=st[de]=st[Ze]=st[ot]=st[yn]=st[lt]=st[bn]=st[dr]=!1;var rt={};rt[k]=rt[H]=rt[q]=rt[oe]=rt[te]=rt[fe]=rt[ue]=rt[ye]=rt[Ne]=rt[St]=rt[xn]=rt[de]=rt[Ze]=rt[ot]=rt[yn]=rt[lt]=rt[bn]=rt[Vn]=rt[cl]=rt[fl]=rt[dl]=rt[hl]=!0,rt[Ee]=rt[Se]=rt[dr]=!1;var my={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},gy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},vy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},yy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},by=parseFloat,Ey=parseInt,Hf=typeof global=="object"&&global&&global.Object===Object&&global,Ay=typeof self=="object"&&self&&self.Object===Object&&self,Ot=Hf||Ay||Function("return this")(),Al=typeof wi=="object"&&wi&&!wi.nodeType&&wi,hr=Al&&typeof Eo=="object"&&Eo&&!Eo.nodeType&&Eo,Gf=hr&&hr.exports===Al,Cl=Gf&&Hf.process,Zt=function(){try{var Z=hr&&hr.require&&hr.require("util").types;return Z||Cl&&Cl.binding&&Cl.binding("util")}catch(ie){}}(),Wf=Zt&&Zt.isArrayBuffer,zf=Zt&&Zt.isDate,Vf=Zt&&Zt.isMap,jf=Zt&&Zt.isRegExp,Jf=Zt&&Zt.isSet,Kf=Zt&&Zt.isTypedArray;function Gt(Z,ie,ne){switch(ne.length){case 0:return Z.call(ie);case 1:return Z.call(ie,ne[0]);case 2:return Z.call(ie,ne[0],ne[1]);case 3:return Z.call(ie,ne[0],ne[1],ne[2])}return Z.apply(ie,ne)}function Cy(Z,ie,ne,ve){for(var Me=-1,Ke=Z==null?0:Z.length;++Me<Ke;){var Et=Z[Me];ie(ve,Et,ne(Et),Z)}return ve}function Yt(Z,ie){for(var ne=-1,ve=Z==null?0:Z.length;++ne<ve&&ie(Z[ne],ne,Z)!==!1;);return Z}function Sy(Z,ie){for(var ne=Z==null?0:Z.length;ne--&&ie(Z[ne],ne,Z)!==!1;);return Z}function qf(Z,ie){for(var ne=-1,ve=Z==null?0:Z.length;++ne<ve;)if(!ie(Z[ne],ne,Z))return!1;return!0}function jn(Z,ie){for(var ne=-1,ve=Z==null?0:Z.length,Me=0,Ke=[];++ne<ve;){var Et=Z[ne];ie(Et,ne,Z)&&(Ke[Me++]=Et)}return Ke}function Es(Z,ie){var ne=Z==null?0:Z.length;return!!ne&&ci(Z,ie,0)>-1}function Sl(Z,ie,ne){for(var ve=-1,Me=Z==null?0:Z.length;++ve<Me;)if(ne(ie,Z[ve]))return!0;return!1}function at(Z,ie){for(var ne=-1,ve=Z==null?0:Z.length,Me=Array(ve);++ne<ve;)Me[ne]=ie(Z[ne],ne,Z);return Me}function Jn(Z,ie){for(var ne=-1,ve=ie.length,Me=Z.length;++ne<ve;)Z[Me+ne]=ie[ne];return Z}function Ol(Z,ie,ne,ve){var Me=-1,Ke=Z==null?0:Z.length;for(ve&&Ke&&(ne=Z[++Me]);++Me<Ke;)ne=ie(ne,Z[Me],Me,Z);return ne}function Oy(Z,ie,ne,ve){var Me=Z==null?0:Z.length;for(ve&&Me&&(ne=Z[--Me]);Me--;)ne=ie(ne,Z[Me],Me,Z);return ne}function Tl(Z,ie){for(var ne=-1,ve=Z==null?0:Z.length;++ne<ve;)if(ie(Z[ne],ne,Z))return!0;return!1}var Ty=wl("length");function wy(Z){return Z.split("")}function xy(Z){return Z.match(Nv)||[]}function Zf(Z,ie,ne){var ve;return ne(Z,function(Me,Ke,Et){if(ie(Me,Ke,Et))return ve=Ke,!1}),ve}function As(Z,ie,ne,ve){for(var Me=Z.length,Ke=ne+(ve?1:-1);ve?Ke--:++Ke<Me;)if(ie(Z[Ke],Ke,Z))return Ke;return-1}function ci(Z,ie,ne){return ie===ie?By(Z,ie,ne):As(Z,Yf,ne)}function Iy(Z,ie,ne,ve){for(var Me=ne-1,Ke=Z.length;++Me<Ke;)if(ve(Z[Me],ie))return Me;return-1}function Yf(Z){return Z!==Z}function Qf(Z,ie){var ne=Z==null?0:Z.length;return ne?Il(Z,ie)/ne:J}function wl(Z){return function(ie){return ie==null?s:ie[Z]}}function xl(Z){return function(ie){return Z==null?s:Z[ie]}}function Xf(Z,ie,ne,ve,Me){return Me(Z,function(Ke,Et,tt){ne=ve?(ve=!1,Ke):ie(ne,Ke,Et,tt)}),ne}function Ry(Z,ie){var ne=Z.length;for(Z.sort(ie);ne--;)Z[ne]=Z[ne].value;return Z}function Il(Z,ie){for(var ne,ve=-1,Me=Z.length;++ve<Me;){var Ke=ie(Z[ve]);Ke!==s&&(ne=ne===s?Ke:ne+Ke)}return ne}function Rl(Z,ie){for(var ne=-1,ve=Array(Z);++ne<Z;)ve[ne]=ie(ne);return ve}function _y(Z,ie){return at(ie,function(ne){return[ne,Z[ne]]})}function ed(Z){return Z&&Z.slice(0,id(Z)+1).replace(ml,"")}function Wt(Z){return function(ie){return Z(ie)}}function _l(Z,ie){return at(ie,function(ne){return Z[ne]})}function Xi(Z,ie){return Z.has(ie)}function td(Z,ie){for(var ne=-1,ve=Z.length;++ne<ve&&ci(ie,Z[ne],0)>-1;);return ne}function nd(Z,ie){for(var ne=Z.length;ne--&&ci(ie,Z[ne],0)>-1;);return ne}function My(Z,ie){for(var ne=Z.length,ve=0;ne--;)Z[ne]===ie&&++ve;return ve}var Py=xl(my),Ly=xl(gy);function Dy(Z){return"\\"+yy[Z]}function Ny(Z,ie){return Z==null?s:Z[ie]}function fi(Z){return fy.test(Z)}function Fy(Z){return dy.test(Z)}function Uy(Z){for(var ie,ne=[];!(ie=Z.next()).done;)ne.push(ie.value);return ne}function Ml(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ve,Me){ne[++ie]=[Me,ve]}),ne}function rd(Z,ie){return function(ne){return Z(ie(ne))}}function Kn(Z,ie){for(var ne=-1,ve=Z.length,Me=0,Ke=[];++ne<ve;){var Et=Z[ne];(Et===ie||Et===f)&&(Z[ne]=f,Ke[Me++]=ne)}return Ke}function Cs(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ve){ne[++ie]=ve}),ne}function ky(Z){var ie=-1,ne=Array(Z.size);return Z.forEach(function(ve){ne[++ie]=[ve,ve]}),ne}function By(Z,ie,ne){for(var ve=ne-1,Me=Z.length;++ve<Me;)if(Z[ve]===ie)return ve;return-1}function $y(Z,ie,ne){for(var ve=ne+1;ve--;)if(Z[ve]===ie)return ve;return ve}function di(Z){return fi(Z)?Gy(Z):Ty(Z)}function cn(Z){return fi(Z)?Wy(Z):wy(Z)}function id(Z){for(var ie=Z.length;ie--&&Mv.test(Z.charAt(ie)););return ie}var Hy=xl(vy);function Gy(Z){for(var ie=El.lastIndex=0;El.test(Z);)++ie;return ie}function Wy(Z){return Z.match(El)||[]}function zy(Z){return Z.match(cy)||[]}var Vy=function Z(ie){ie=ie==null?Ot:qn.defaults(Ot.Object(),ie,qn.pick(Ot,hy));var ne=ie.Array,ve=ie.Date,Me=ie.Error,Ke=ie.Function,Et=ie.Math,tt=ie.Object,Pl=ie.RegExp,jy=ie.String,Qt=ie.TypeError,Ss=ne.prototype,Jy=Ke.prototype,hi=tt.prototype,Os=ie["__core-js_shared__"],Ts=Jy.toString,Xe=hi.hasOwnProperty,Ky=0,od=function(){var n=/[^.]+$/.exec(Os&&Os.keys&&Os.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),ws=hi.toString,qy=Ts.call(tt),Zy=Ot._,Yy=Pl("^"+Ts.call(Xe).replace(pl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xs=Gf?ie.Buffer:s,Zn=ie.Symbol,Is=ie.Uint8Array,sd=xs?xs.allocUnsafe:s,Rs=rd(tt.getPrototypeOf,tt),ad=tt.create,ld=hi.propertyIsEnumerable,_s=Ss.splice,ud=Zn?Zn.isConcatSpreadable:s,eo=Zn?Zn.iterator:s,pr=Zn?Zn.toStringTag:s,Ms=function(){try{var n=br(tt,"defineProperty");return n({},"",{}),n}catch(o){}}(),Qy=ie.clearTimeout!==Ot.clearTimeout&&ie.clearTimeout,Xy=ve&&ve.now!==Ot.Date.now&&ve.now,e0=ie.setTimeout!==Ot.setTimeout&&ie.setTimeout,Ps=Et.ceil,Ls=Et.floor,Ll=tt.getOwnPropertySymbols,t0=xs?xs.isBuffer:s,cd=ie.isFinite,n0=Ss.join,r0=rd(tt.keys,tt),At=Et.max,Pt=Et.min,i0=ve.now,o0=ie.parseInt,fd=Et.random,s0=Ss.reverse,Dl=br(ie,"DataView"),to=br(ie,"Map"),Nl=br(ie,"Promise"),pi=br(ie,"Set"),no=br(ie,"WeakMap"),ro=br(tt,"create"),Ds=no&&new no,mi={},a0=Er(Dl),l0=Er(to),u0=Er(Nl),c0=Er(pi),f0=Er(no),Ns=Zn?Zn.prototype:s,io=Ns?Ns.valueOf:s,dd=Ns?Ns.toString:s;function F(n){if(pt(n)&&!Pe(n)&&!(n instanceof Ve)){if(n instanceof Xt)return n;if(Xe.call(n,"__wrapped__"))return hh(n)}return new Xt(n)}var gi=function(){function n(){}return function(o){if(!ut(o))return{};if(ad)return ad(o);n.prototype=o;var c=new n;return n.prototype=s,c}}();function Fs(){}function Xt(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=s}F.templateSettings={escape:Tv,evaluate:wv,interpolate:Af,variable:"",imports:{_:F}},F.prototype=Fs.prototype,F.prototype.constructor=F,Xt.prototype=gi(Fs.prototype),Xt.prototype.constructor=Xt;function Ve(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ee,this.__views__=[]}function d0(){var n=new Ve(this.__wrapped__);return n.__actions__=Ut(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ut(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ut(this.__views__),n}function h0(){if(this.__filtered__){var n=new Ve(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function p0(){var n=this.__wrapped__.value(),o=this.__dir__,c=Pe(n),A=o<0,_=c?n.length:0,B=wb(0,_,this.__views__),V=B.start,K=B.end,Y=K-V,se=A?K:V-1,ae=this.__iteratees__,le=ae.length,he=0,be=Pt(Y,this.__takeCount__);if(!c||!A&&_==Y&&be==Y)return Fd(n,this.__actions__);var Te=[];e:for(;Y--&&he<be;){se+=o;for(var Fe=-1,we=n[se];++Fe<le;){var Ge=ae[Fe],je=Ge.iteratee,jt=Ge.type,Ft=je(we);if(jt==N)we=Ft;else if(!Ft){if(jt==W)continue e;break e}}Te[he++]=we}return Te}Ve.prototype=gi(Fs.prototype),Ve.prototype.constructor=Ve;function mr(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function m0(){this.__data__=ro?ro(null):{},this.size=0}function g0(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function v0(n){var o=this.__data__;if(ro){var c=o[n];return c===l?s:c}return Xe.call(o,n)?o[n]:s}function y0(n){var o=this.__data__;return ro?o[n]!==s:Xe.call(o,n)}function b0(n,o){var c=this.__data__;return this.size+=this.has(n)?0:1,c[n]=ro&&o===s?l:o,this}mr.prototype.clear=m0,mr.prototype.delete=g0,mr.prototype.get=v0,mr.prototype.has=y0,mr.prototype.set=b0;function In(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function E0(){this.__data__=[],this.size=0}function A0(n){var o=this.__data__,c=Us(o,n);if(c<0)return!1;var A=o.length-1;return c==A?o.pop():_s.call(o,c,1),--this.size,!0}function C0(n){var o=this.__data__,c=Us(o,n);return c<0?s:o[c][1]}function S0(n){return Us(this.__data__,n)>-1}function O0(n,o){var c=this.__data__,A=Us(c,n);return A<0?(++this.size,c.push([n,o])):c[A][1]=o,this}In.prototype.clear=E0,In.prototype.delete=A0,In.prototype.get=C0,In.prototype.has=S0,In.prototype.set=O0;function Rn(n){var o=-1,c=n==null?0:n.length;for(this.clear();++o<c;){var A=n[o];this.set(A[0],A[1])}}function T0(){this.size=0,this.__data__={hash:new mr,map:new(to||In),string:new mr}}function w0(n){var o=qs(this,n).delete(n);return this.size-=o?1:0,o}function x0(n){return qs(this,n).get(n)}function I0(n){return qs(this,n).has(n)}function R0(n,o){var c=qs(this,n),A=c.size;return c.set(n,o),this.size+=c.size==A?0:1,this}Rn.prototype.clear=T0,Rn.prototype.delete=w0,Rn.prototype.get=x0,Rn.prototype.has=I0,Rn.prototype.set=R0;function gr(n){var o=-1,c=n==null?0:n.length;for(this.__data__=new Rn;++o<c;)this.add(n[o])}function _0(n){return this.__data__.set(n,l),this}function M0(n){return this.__data__.has(n)}gr.prototype.add=gr.prototype.push=_0,gr.prototype.has=M0;function fn(n){var o=this.__data__=new In(n);this.size=o.size}function P0(){this.__data__=new In,this.size=0}function L0(n){var o=this.__data__,c=o.delete(n);return this.size=o.size,c}function D0(n){return this.__data__.get(n)}function N0(n){return this.__data__.has(n)}function F0(n,o){var c=this.__data__;if(c instanceof In){var A=c.__data__;if(!to||A.length<e-1)return A.push([n,o]),this.size=++c.size,this;c=this.__data__=new Rn(A)}return c.set(n,o),this.size=c.size,this}fn.prototype.clear=P0,fn.prototype.delete=L0,fn.prototype.get=D0,fn.prototype.has=N0,fn.prototype.set=F0;function hd(n,o){var c=Pe(n),A=!c&&Ar(n),_=!c&&!A&&tr(n),B=!c&&!A&&!_&&Ei(n),V=c||A||_||B,K=V?Rl(n.length,jy):[],Y=K.length;for(var se in n)(o||Xe.call(n,se))&&!(V&&(se=="length"||_&&(se=="offset"||se=="parent")||B&&(se=="buffer"||se=="byteLength"||se=="byteOffset")||Ln(se,Y)))&&K.push(se);return K}function pd(n){var o=n.length;return o?n[jl(0,o-1)]:s}function U0(n,o){return Zs(Ut(n),vr(o,0,n.length))}function k0(n){return Zs(Ut(n))}function Fl(n,o,c){(c!==s&&!dn(n[o],c)||c===s&&!(o in n))&&_n(n,o,c)}function oo(n,o,c){var A=n[o];(!(Xe.call(n,o)&&dn(A,c))||c===s&&!(o in n))&&_n(n,o,c)}function Us(n,o){for(var c=n.length;c--;)if(dn(n[c][0],o))return c;return-1}function B0(n,o,c,A){return Yn(n,function(_,B,V){o(A,_,c(_),V)}),A}function md(n,o){return n&&An(o,Tt(o),n)}function $0(n,o){return n&&An(o,Bt(o),n)}function _n(n,o,c){o=="__proto__"&&Ms?Ms(n,o,{configurable:!0,enumerable:!0,value:c,writable:!0}):n[o]=c}function Ul(n,o){for(var c=-1,A=o.length,_=ne(A),B=n==null;++c<A;)_[c]=B?s:vu(n,o[c]);return _}function vr(n,o,c){return n===n&&(c!==s&&(n=n<=c?n:c),o!==s&&(n=n>=o?n:o)),n}function en(n,o,c,A,_,B){var V,K=o&m,Y=o&b,se=o&C;if(c&&(V=_?c(n,A,_,B):c(n)),V!==s)return V;if(!ut(n))return n;var ae=Pe(n);if(ae){if(V=Ib(n),!K)return Ut(n,V)}else{var le=Lt(n),he=le==Se||le==ze;if(tr(n))return Bd(n,K);if(le==ot||le==k||he&&!_){if(V=Y||he?{}:ih(n),!K)return Y?vb(n,$0(V,n)):gb(n,md(V,n))}else{if(!rt[le])return _?n:{};V=Rb(n,le,K)}}B||(B=new fn);var be=B.get(n);if(be)return be;B.set(n,V),Lh(n)?n.forEach(function(we){V.add(en(we,o,c,we,n,B))}):Mh(n)&&n.forEach(function(we,Ge){V.set(Ge,en(we,o,c,Ge,n,B))});var Te=se?Y?ru:nu:Y?Bt:Tt,Fe=ae?s:Te(n);return Yt(Fe||n,function(we,Ge){Fe&&(Ge=we,we=n[Ge]),oo(V,Ge,en(we,o,c,Ge,n,B))}),V}function H0(n){var o=Tt(n);return function(c){return gd(c,n,o)}}function gd(n,o,c){var A=c.length;if(n==null)return!A;for(n=tt(n);A--;){var _=c[A],B=o[_],V=n[_];if(V===s&&!(_ in n)||!B(V))return!1}return!0}function vd(n,o,c){if(typeof n!="function")throw new Qt(i);return ho(function(){n.apply(s,c)},o)}function so(n,o,c,A){var _=-1,B=Es,V=!0,K=n.length,Y=[],se=o.length;if(!K)return Y;c&&(o=at(o,Wt(c))),A?(B=Sl,V=!1):o.length>=e&&(B=Xi,V=!1,o=new gr(o));e:for(;++_<K;){var ae=n[_],le=c==null?ae:c(ae);if(ae=A||ae!==0?ae:0,V&&le===le){for(var he=se;he--;)if(o[he]===le)continue e;Y.push(ae)}else B(o,le,A)||Y.push(ae)}return Y}var Yn=zd(En),yd=zd(Bl,!0);function G0(n,o){var c=!0;return Yn(n,function(A,_,B){return c=!!o(A,_,B),c}),c}function ks(n,o,c){for(var A=-1,_=n.length;++A<_;){var B=n[A],V=o(B);if(V!=null&&(K===s?V===V&&!Vt(V):c(V,K)))var K=V,Y=B}return Y}function W0(n,o,c,A){var _=n.length;for(c=Le(c),c<0&&(c=-c>_?0:_+c),A=A===s||A>_?_:Le(A),A<0&&(A+=_),A=c>A?0:Nh(A);c<A;)n[c++]=o;return n}function bd(n,o){var c=[];return Yn(n,function(A,_,B){o(A,_,B)&&c.push(A)}),c}function _t(n,o,c,A,_){var B=-1,V=n.length;for(c||(c=Mb),_||(_=[]);++B<V;){var K=n[B];o>0&&c(K)?o>1?_t(K,o-1,c,A,_):Jn(_,K):A||(_[_.length]=K)}return _}var kl=Vd(),Ed=Vd(!0);function En(n,o){return n&&kl(n,o,Tt)}function Bl(n,o){return n&&Ed(n,o,Tt)}function Bs(n,o){return jn(o,function(c){return Dn(n[c])})}function yr(n,o){o=Xn(o,n);for(var c=0,A=o.length;n!=null&&c<A;)n=n[Cn(o[c++])];return c&&c==A?n:s}function Ad(n,o,c){var A=o(n);return Pe(n)?A:Jn(A,c(n))}function Dt(n){return n==null?n===s?Qi:bt:pr&&pr in tt(n)?Tb(n):kb(n)}function $l(n,o){return n>o}function z0(n,o){return n!=null&&Xe.call(n,o)}function V0(n,o){return n!=null&&o in tt(n)}function j0(n,o,c){return n>=Pt(o,c)&&n<At(o,c)}function Hl(n,o,c){for(var A=c?Sl:Es,_=n[0].length,B=n.length,V=B,K=ne(B),Y=1/0,se=[];V--;){var ae=n[V];V&&o&&(ae=at(ae,Wt(o))),Y=Pt(ae.length,Y),K[V]=!c&&(o||_>=120&&ae.length>=120)?new gr(V&&ae):s}ae=n[0];var le=-1,he=K[0];e:for(;++le<_&&se.length<Y;){var be=ae[le],Te=o?o(be):be;if(be=c||be!==0?be:0,!(he?Xi(he,Te):A(se,Te,c))){for(V=B;--V;){var Fe=K[V];if(!(Fe?Xi(Fe,Te):A(n[V],Te,c)))continue e}he&&he.push(Te),se.push(be)}}return se}function J0(n,o,c,A){return En(n,function(_,B,V){o(A,c(_),B,V)}),A}function ao(n,o,c){o=Xn(o,n),n=lh(n,o);var A=n==null?n:n[Cn(nn(o))];return A==null?s:Gt(A,n,c)}function Cd(n){return pt(n)&&Dt(n)==k}function K0(n){return pt(n)&&Dt(n)==q}function q0(n){return pt(n)&&Dt(n)==fe}function lo(n,o,c,A,_){return n===o?!0:n==null||o==null||!pt(n)&&!pt(o)?n!==n&&o!==o:Z0(n,o,c,A,lo,_)}function Z0(n,o,c,A,_,B){var V=Pe(n),K=Pe(o),Y=V?H:Lt(n),se=K?H:Lt(o);Y=Y==k?ot:Y,se=se==k?ot:se;var ae=Y==ot,le=se==ot,he=Y==se;if(he&&tr(n)){if(!tr(o))return!1;V=!0,ae=!1}if(he&&!ae)return B||(B=new fn),V||Ei(n)?th(n,o,c,A,_,B):Sb(n,o,Y,c,A,_,B);if(!(c&h)){var be=ae&&Xe.call(n,"__wrapped__"),Te=le&&Xe.call(o,"__wrapped__");if(be||Te){var Fe=be?n.value():n,we=Te?o.value():o;return B||(B=new fn),_(Fe,we,c,A,B)}}return he?(B||(B=new fn),Ob(n,o,c,A,_,B)):!1}function Y0(n){return pt(n)&&Lt(n)==de}function Gl(n,o,c,A){var _=c.length,B=_,V=!A;if(n==null)return!B;for(n=tt(n);_--;){var K=c[_];if(V&&K[2]?K[1]!==n[K[0]]:!(K[0]in n))return!1}for(;++_<B;){K=c[_];var Y=K[0],se=n[Y],ae=K[1];if(V&&K[2]){if(se===s&&!(Y in n))return!1}else{var le=new fn;if(A)var he=A(se,ae,Y,n,o,le);if(!(he===s?lo(ae,se,h|E,A,le):he))return!1}}return!0}function Sd(n){if(!ut(n)||Lb(n))return!1;var o=Dn(n)?Yy:Hv;return o.test(Er(n))}function Q0(n){return pt(n)&&Dt(n)==yn}function X0(n){return pt(n)&&Lt(n)==lt}function eb(n){return pt(n)&&na(n.length)&&!!st[Dt(n)]}function Od(n){return typeof n=="function"?n:n==null?$t:typeof n=="object"?Pe(n)?xd(n[0],n[1]):wd(n):jh(n)}function Wl(n){if(!fo(n))return r0(n);var o=[];for(var c in tt(n))Xe.call(n,c)&&c!="constructor"&&o.push(c);return o}function tb(n){if(!ut(n))return Ub(n);var o=fo(n),c=[];for(var A in n)A=="constructor"&&(o||!Xe.call(n,A))||c.push(A);return c}function zl(n,o){return n<o}function Td(n,o){var c=-1,A=kt(n)?ne(n.length):[];return Yn(n,function(_,B,V){A[++c]=o(_,B,V)}),A}function wd(n){var o=ou(n);return o.length==1&&o[0][2]?sh(o[0][0],o[0][1]):function(c){return c===n||Gl(c,n,o)}}function xd(n,o){return au(n)&&oh(o)?sh(Cn(n),o):function(c){var A=vu(c,n);return A===s&&A===o?yu(c,n):lo(o,A,h|E)}}function $s(n,o,c,A,_){n!==o&&kl(o,function(B,V){if(_||(_=new fn),ut(B))nb(n,o,V,c,$s,A,_);else{var K=A?A(uu(n,V),B,V+"",n,o,_):s;K===s&&(K=B),Fl(n,V,K)}},Bt)}function nb(n,o,c,A,_,B,V){var K=uu(n,c),Y=uu(o,c),se=V.get(Y);if(se){Fl(n,c,se);return}var ae=B?B(K,Y,c+"",n,o,V):s,le=ae===s;if(le){var he=Pe(Y),be=!he&&tr(Y),Te=!he&&!be&&Ei(Y);ae=Y,he||be||Te?Pe(K)?ae=K:mt(K)?ae=Ut(K):be?(le=!1,ae=Bd(Y,!0)):Te?(le=!1,ae=$d(Y,!0)):ae=[]:po(Y)||Ar(Y)?(ae=K,Ar(K)?ae=Fh(K):(!ut(K)||Dn(K))&&(ae=ih(Y))):le=!1}le&&(V.set(Y,ae),_(ae,Y,A,B,V),V.delete(Y)),Fl(n,c,ae)}function Id(n,o){var c=n.length;if(!!c)return o+=o<0?c:0,Ln(o,c)?n[o]:s}function Rd(n,o,c){o.length?o=at(o,function(B){return Pe(B)?function(V){return yr(V,B.length===1?B[0]:B)}:B}):o=[$t];var A=-1;o=at(o,Wt(Oe()));var _=Td(n,function(B,V,K){var Y=at(o,function(se){return se(B)});return{criteria:Y,index:++A,value:B}});return Ry(_,function(B,V){return mb(B,V,c)})}function rb(n,o){return _d(n,o,function(c,A){return yu(n,A)})}function _d(n,o,c){for(var A=-1,_=o.length,B={};++A<_;){var V=o[A],K=yr(n,V);c(K,V)&&uo(B,Xn(V,n),K)}return B}function ib(n){return function(o){return yr(o,n)}}function Vl(n,o,c,A){var _=A?Iy:ci,B=-1,V=o.length,K=n;for(n===o&&(o=Ut(o)),c&&(K=at(n,Wt(c)));++B<V;)for(var Y=0,se=o[B],ae=c?c(se):se;(Y=_(K,ae,Y,A))>-1;)K!==n&&_s.call(K,Y,1),_s.call(n,Y,1);return n}function Md(n,o){for(var c=n?o.length:0,A=c-1;c--;){var _=o[c];if(c==A||_!==B){var B=_;Ln(_)?_s.call(n,_,1):ql(n,_)}}return n}function jl(n,o){return n+Ls(fd()*(o-n+1))}function ob(n,o,c,A){for(var _=-1,B=At(Ps((o-n)/(c||1)),0),V=ne(B);B--;)V[A?B:++_]=n,n+=c;return V}function Jl(n,o){var c="";if(!n||o<1||o>$)return c;do o%2&&(c+=n),o=Ls(o/2),o&&(n+=n);while(o);return c}function $e(n,o){return cu(ah(n,o,$t),n+"")}function sb(n){return pd(Ai(n))}function ab(n,o){var c=Ai(n);return Zs(c,vr(o,0,c.length))}function uo(n,o,c,A){if(!ut(n))return n;o=Xn(o,n);for(var _=-1,B=o.length,V=B-1,K=n;K!=null&&++_<B;){var Y=Cn(o[_]),se=c;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return n;if(_!=V){var ae=K[Y];se=A?A(ae,Y,K):s,se===s&&(se=ut(ae)?ae:Ln(o[_+1])?[]:{})}oo(K,Y,se),K=K[Y]}return n}var Pd=Ds?function(n,o){return Ds.set(n,o),n}:$t,lb=Ms?function(n,o){return Ms(n,"toString",{configurable:!0,enumerable:!1,value:Eu(o),writable:!0})}:$t;function ub(n){return Zs(Ai(n))}function tn(n,o,c){var A=-1,_=n.length;o<0&&(o=-o>_?0:_+o),c=c>_?_:c,c<0&&(c+=_),_=o>c?0:c-o>>>0,o>>>=0;for(var B=ne(_);++A<_;)B[A]=n[A+o];return B}function cb(n,o){var c;return Yn(n,function(A,_,B){return c=o(A,_,B),!c}),!!c}function Hs(n,o,c){var A=0,_=n==null?A:n.length;if(typeof o=="number"&&o===o&&_<=X){for(;A<_;){var B=A+_>>>1,V=n[B];V!==null&&!Vt(V)&&(c?V<=o:V<o)?A=B+1:_=B}return _}return Kl(n,o,$t,c)}function Kl(n,o,c,A){var _=0,B=n==null?0:n.length;if(B===0)return 0;o=c(o);for(var V=o!==o,K=o===null,Y=Vt(o),se=o===s;_<B;){var ae=Ls((_+B)/2),le=c(n[ae]),he=le!==s,be=le===null,Te=le===le,Fe=Vt(le);if(V)var we=A||Te;else se?we=Te&&(A||he):K?we=Te&&he&&(A||!be):Y?we=Te&&he&&!be&&(A||!Fe):be||Fe?we=!1:we=A?le<=o:le<o;we?_=ae+1:B=ae}return Pt(B,re)}function Ld(n,o){for(var c=-1,A=n.length,_=0,B=[];++c<A;){var V=n[c],K=o?o(V):V;if(!c||!dn(K,Y)){var Y=K;B[_++]=V===0?0:V}}return B}function Dd(n){return typeof n=="number"?n:Vt(n)?J:+n}function zt(n){if(typeof n=="string")return n;if(Pe(n))return at(n,zt)+"";if(Vt(n))return dd?dd.call(n):"";var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Qn(n,o,c){var A=-1,_=Es,B=n.length,V=!0,K=[],Y=K;if(c)V=!1,_=Sl;else if(B>=e){var se=o?null:Ab(n);if(se)return Cs(se);V=!1,_=Xi,Y=new gr}else Y=o?[]:K;e:for(;++A<B;){var ae=n[A],le=o?o(ae):ae;if(ae=c||ae!==0?ae:0,V&&le===le){for(var he=Y.length;he--;)if(Y[he]===le)continue e;o&&Y.push(le),K.push(ae)}else _(Y,le,c)||(Y!==K&&Y.push(le),K.push(ae))}return K}function ql(n,o){return o=Xn(o,n),n=lh(n,o),n==null||delete n[Cn(nn(o))]}function Nd(n,o,c,A){return uo(n,o,c(yr(n,o)),A)}function Gs(n,o,c,A){for(var _=n.length,B=A?_:-1;(A?B--:++B<_)&&o(n[B],B,n););return c?tn(n,A?0:B,A?B+1:_):tn(n,A?B+1:0,A?_:B)}function Fd(n,o){var c=n;return c instanceof Ve&&(c=c.value()),Ol(o,function(A,_){return _.func.apply(_.thisArg,Jn([A],_.args))},c)}function Zl(n,o,c){var A=n.length;if(A<2)return A?Qn(n[0]):[];for(var _=-1,B=ne(A);++_<A;)for(var V=n[_],K=-1;++K<A;)K!=_&&(B[_]=so(B[_]||V,n[K],o,c));return Qn(_t(B,1),o,c)}function Ud(n,o,c){for(var A=-1,_=n.length,B=o.length,V={};++A<_;){var K=A<B?o[A]:s;c(V,n[A],K)}return V}function Yl(n){return mt(n)?n:[]}function Ql(n){return typeof n=="function"?n:$t}function Xn(n,o){return Pe(n)?n:au(n,o)?[n]:dh(Ye(n))}var fb=$e;function er(n,o,c){var A=n.length;return c=c===s?A:c,!o&&c>=A?n:tn(n,o,c)}var kd=Qy||function(n){return Ot.clearTimeout(n)};function Bd(n,o){if(o)return n.slice();var c=n.length,A=sd?sd(c):new n.constructor(c);return n.copy(A),A}function Xl(n){var o=new n.constructor(n.byteLength);return new Is(o).set(new Is(n)),o}function db(n,o){var c=o?Xl(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.byteLength)}function hb(n){var o=new n.constructor(n.source,Cf.exec(n));return o.lastIndex=n.lastIndex,o}function pb(n){return io?tt(io.call(n)):{}}function $d(n,o){var c=o?Xl(n.buffer):n.buffer;return new n.constructor(c,n.byteOffset,n.length)}function Hd(n,o){if(n!==o){var c=n!==s,A=n===null,_=n===n,B=Vt(n),V=o!==s,K=o===null,Y=o===o,se=Vt(o);if(!K&&!se&&!B&&n>o||B&&V&&Y&&!K&&!se||A&&V&&Y||!c&&Y||!_)return 1;if(!A&&!B&&!se&&n<o||se&&c&&_&&!A&&!B||K&&c&&_||!V&&_||!Y)return-1}return 0}function mb(n,o,c){for(var A=-1,_=n.criteria,B=o.criteria,V=_.length,K=c.length;++A<V;){var Y=Hd(_[A],B[A]);if(Y){if(A>=K)return Y;var se=c[A];return Y*(se=="desc"?-1:1)}}return n.index-o.index}function Gd(n,o,c,A){for(var _=-1,B=n.length,V=c.length,K=-1,Y=o.length,se=At(B-V,0),ae=ne(Y+se),le=!A;++K<Y;)ae[K]=o[K];for(;++_<V;)(le||_<B)&&(ae[c[_]]=n[_]);for(;se--;)ae[K++]=n[_++];return ae}function Wd(n,o,c,A){for(var _=-1,B=n.length,V=-1,K=c.length,Y=-1,se=o.length,ae=At(B-K,0),le=ne(ae+se),he=!A;++_<ae;)le[_]=n[_];for(var be=_;++Y<se;)le[be+Y]=o[Y];for(;++V<K;)(he||_<B)&&(le[be+c[V]]=n[_++]);return le}function Ut(n,o){var c=-1,A=n.length;for(o||(o=ne(A));++c<A;)o[c]=n[c];return o}function An(n,o,c,A){var _=!c;c||(c={});for(var B=-1,V=o.length;++B<V;){var K=o[B],Y=A?A(c[K],n[K],K,c,n):s;Y===s&&(Y=n[K]),_?_n(c,K,Y):oo(c,K,Y)}return c}function gb(n,o){return An(n,su(n),o)}function vb(n,o){return An(n,nh(n),o)}function Ws(n,o){return function(c,A){var _=Pe(c)?Cy:B0,B=o?o():{};return _(c,n,Oe(A,2),B)}}function vi(n){return $e(function(o,c){var A=-1,_=c.length,B=_>1?c[_-1]:s,V=_>2?c[2]:s;for(B=n.length>3&&typeof B=="function"?(_--,B):s,V&&Nt(c[0],c[1],V)&&(B=_<3?s:B,_=1),o=tt(o);++A<_;){var K=c[A];K&&n(o,K,A,B)}return o})}function zd(n,o){return function(c,A){if(c==null)return c;if(!kt(c))return n(c,A);for(var _=c.length,B=o?_:-1,V=tt(c);(o?B--:++B<_)&&A(V[B],B,V)!==!1;);return c}}function Vd(n){return function(o,c,A){for(var _=-1,B=tt(o),V=A(o),K=V.length;K--;){var Y=V[n?K:++_];if(c(B[Y],Y,B)===!1)break}return o}}function yb(n,o,c){var A=o&w,_=co(n);function B(){var V=this&&this!==Ot&&this instanceof B?_:n;return V.apply(A?c:this,arguments)}return B}function jd(n){return function(o){o=Ye(o);var c=fi(o)?cn(o):s,A=c?c[0]:o.charAt(0),_=c?er(c,1).join(""):o.slice(1);return A[n]()+_}}function yi(n){return function(o){return Ol(zh(Wh(o).replace(ly,"")),n,"")}}function co(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var c=gi(n.prototype),A=n.apply(c,o);return ut(A)?A:c}}function bb(n,o,c){var A=co(n);function _(){for(var B=arguments.length,V=ne(B),K=B,Y=bi(_);K--;)V[K]=arguments[K];var se=B<3&&V[0]!==Y&&V[B-1]!==Y?[]:Kn(V,Y);if(B-=se.length,B<c)return Yd(n,o,zs,_.placeholder,s,V,se,s,s,c-B);var ae=this&&this!==Ot&&this instanceof _?A:n;return Gt(ae,this,V)}return _}function Jd(n){return function(o,c,A){var _=tt(o);if(!kt(o)){var B=Oe(c,3);o=Tt(o),c=function(K){return B(_[K],K,_)}}var V=n(o,c,A);return V>-1?_[B?o[V]:V]:s}}function Kd(n){return Pn(function(o){var c=o.length,A=c,_=Xt.prototype.thru;for(n&&o.reverse();A--;){var B=o[A];if(typeof B!="function")throw new Qt(i);if(_&&!V&&Ks(B)=="wrapper")var V=new Xt([],!0)}for(A=V?A:c;++A<c;){B=o[A];var K=Ks(B),Y=K=="wrapper"?iu(B):s;Y&&lu(Y[0])&&Y[1]==(d|O|g|p)&&!Y[4].length&&Y[9]==1?V=V[Ks(Y[0])].apply(V,Y[3]):V=B.length==1&&lu(B)?V[K]():V.thru(B)}return function(){var se=arguments,ae=se[0];if(V&&se.length==1&&Pe(ae))return V.plant(ae).value();for(var le=0,he=c?o[le].apply(this,se):ae;++le<c;)he=o[le].call(this,he);return he}})}function zs(n,o,c,A,_,B,V,K,Y,se){var ae=o&d,le=o&w,he=o&x,be=o&(O|R),Te=o&T,Fe=he?s:co(n);function we(){for(var Ge=arguments.length,je=ne(Ge),jt=Ge;jt--;)je[jt]=arguments[jt];if(be)var Ft=bi(we),Jt=My(je,Ft);if(A&&(je=Gd(je,A,_,be)),B&&(je=Wd(je,B,V,be)),Ge-=Jt,be&&Ge<se){var gt=Kn(je,Ft);return Yd(n,o,zs,we.placeholder,c,je,gt,K,Y,se-Ge)}var hn=le?c:this,Fn=he?hn[n]:n;return Ge=je.length,K?je=Bb(je,K):Te&&Ge>1&&je.reverse(),ae&&Y<Ge&&(je.length=Y),this&&this!==Ot&&this instanceof we&&(Fn=Fe||co(Fn)),Fn.apply(hn,je)}return we}function qd(n,o){return function(c,A){return J0(c,n,o(A),{})}}function Vs(n,o){return function(c,A){var _;if(c===s&&A===s)return o;if(c!==s&&(_=c),A!==s){if(_===s)return A;typeof c=="string"||typeof A=="string"?(c=zt(c),A=zt(A)):(c=Dd(c),A=Dd(A)),_=n(c,A)}return _}}function eu(n){return Pn(function(o){return o=at(o,Wt(Oe())),$e(function(c){var A=this;return n(o,function(_){return Gt(_,A,c)})})})}function js(n,o){o=o===s?" ":zt(o);var c=o.length;if(c<2)return c?Jl(o,n):o;var A=Jl(o,Ps(n/di(o)));return fi(o)?er(cn(A),0,n).join(""):A.slice(0,n)}function Eb(n,o,c,A){var _=o&w,B=co(n);function V(){for(var K=-1,Y=arguments.length,se=-1,ae=A.length,le=ne(ae+Y),he=this&&this!==Ot&&this instanceof V?B:n;++se<ae;)le[se]=A[se];for(;Y--;)le[se++]=arguments[++K];return Gt(he,_?c:this,le)}return V}function Zd(n){return function(o,c,A){return A&&typeof A!="number"&&Nt(o,c,A)&&(c=A=s),o=Nn(o),c===s?(c=o,o=0):c=Nn(c),A=A===s?o<c?1:-1:Nn(A),ob(o,c,A,n)}}function Js(n){return function(o,c){return typeof o=="string"&&typeof c=="string"||(o=rn(o),c=rn(c)),n(o,c)}}function Yd(n,o,c,A,_,B,V,K,Y,se){var ae=o&O,le=ae?V:s,he=ae?s:V,be=ae?B:s,Te=ae?s:B;o|=ae?g:y,o&=~(ae?y:g),o&S||(o&=~(w|x));var Fe=[n,o,_,be,le,Te,he,K,Y,se],we=c.apply(s,Fe);return lu(n)&&uh(we,Fe),we.placeholder=A,ch(we,n,o)}function tu(n){var o=Et[n];return function(c,A){if(c=rn(c),A=A==null?0:Pt(Le(A),292),A&&cd(c)){var _=(Ye(c)+"e").split("e"),B=o(_[0]+"e"+(+_[1]+A));return _=(Ye(B)+"e").split("e"),+(_[0]+"e"+(+_[1]-A))}return o(c)}}var Ab=pi&&1/Cs(new pi([,-0]))[1]==L?function(n){return new pi(n)}:Su;function Qd(n){return function(o){var c=Lt(o);return c==de?Ml(o):c==lt?ky(o):_y(o,n(o))}}function Mn(n,o,c,A,_,B,V,K){var Y=o&x;if(!Y&&typeof n!="function")throw new Qt(i);var se=A?A.length:0;if(se||(o&=~(g|y),A=_=s),V=V===s?V:At(Le(V),0),K=K===s?K:Le(K),se-=_?_.length:0,o&y){var ae=A,le=_;A=_=s}var he=Y?s:iu(n),be=[n,o,c,A,_,ae,le,B,V,K];if(he&&Fb(be,he),n=be[0],o=be[1],c=be[2],A=be[3],_=be[4],K=be[9]=be[9]===s?Y?0:n.length:At(be[9]-se,0),!K&&o&(O|R)&&(o&=~(O|R)),!o||o==w)var Te=yb(n,o,c);else o==O||o==R?Te=bb(n,o,K):(o==g||o==(w|g))&&!_.length?Te=Eb(n,o,c,A):Te=zs.apply(s,be);var Fe=he?Pd:uh;return ch(Fe(Te,be),n,o)}function Xd(n,o,c,A){return n===s||dn(n,hi[c])&&!Xe.call(A,c)?o:n}function eh(n,o,c,A,_,B){return ut(n)&&ut(o)&&(B.set(o,n),$s(n,o,s,eh,B),B.delete(o)),n}function Cb(n){return po(n)?s:n}function th(n,o,c,A,_,B){var V=c&h,K=n.length,Y=o.length;if(K!=Y&&!(V&&Y>K))return!1;var se=B.get(n),ae=B.get(o);if(se&&ae)return se==o&&ae==n;var le=-1,he=!0,be=c&E?new gr:s;for(B.set(n,o),B.set(o,n);++le<K;){var Te=n[le],Fe=o[le];if(A)var we=V?A(Fe,Te,le,o,n,B):A(Te,Fe,le,n,o,B);if(we!==s){if(we)continue;he=!1;break}if(be){if(!Tl(o,function(Ge,je){if(!Xi(be,je)&&(Te===Ge||_(Te,Ge,c,A,B)))return be.push(je)})){he=!1;break}}else if(!(Te===Fe||_(Te,Fe,c,A,B))){he=!1;break}}return B.delete(n),B.delete(o),he}function Sb(n,o,c,A,_,B,V){switch(c){case oe:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case q:return!(n.byteLength!=o.byteLength||!B(new Is(n),new Is(o)));case te:case fe:case Ze:return dn(+n,+o);case Ee:return n.name==o.name&&n.message==o.message;case yn:case bn:return n==o+"";case de:var K=Ml;case lt:var Y=A&h;if(K||(K=Cs),n.size!=o.size&&!Y)return!1;var se=V.get(n);if(se)return se==o;A|=E,V.set(n,o);var ae=th(K(n),K(o),A,_,B,V);return V.delete(n),ae;case Vn:if(io)return io.call(n)==io.call(o)}return!1}function Ob(n,o,c,A,_,B){var V=c&h,K=nu(n),Y=K.length,se=nu(o),ae=se.length;if(Y!=ae&&!V)return!1;for(var le=Y;le--;){var he=K[le];if(!(V?he in o:Xe.call(o,he)))return!1}var be=B.get(n),Te=B.get(o);if(be&&Te)return be==o&&Te==n;var Fe=!0;B.set(n,o),B.set(o,n);for(var we=V;++le<Y;){he=K[le];var Ge=n[he],je=o[he];if(A)var jt=V?A(je,Ge,he,o,n,B):A(Ge,je,he,n,o,B);if(!(jt===s?Ge===je||_(Ge,je,c,A,B):jt)){Fe=!1;break}we||(we=he=="constructor")}if(Fe&&!we){var Ft=n.constructor,Jt=o.constructor;Ft!=Jt&&"constructor"in n&&"constructor"in o&&!(typeof Ft=="function"&&Ft instanceof Ft&&typeof Jt=="function"&&Jt instanceof Jt)&&(Fe=!1)}return B.delete(n),B.delete(o),Fe}function Pn(n){return cu(ah(n,s,gh),n+"")}function nu(n){return Ad(n,Tt,su)}function ru(n){return Ad(n,Bt,nh)}var iu=Ds?function(n){return Ds.get(n)}:Su;function Ks(n){for(var o=n.name+"",c=mi[o],A=Xe.call(mi,o)?c.length:0;A--;){var _=c[A],B=_.func;if(B==null||B==n)return _.name}return o}function bi(n){var o=Xe.call(F,"placeholder")?F:n;return o.placeholder}function Oe(){var n=F.iteratee||Au;return n=n===Au?Od:n,arguments.length?n(arguments[0],arguments[1]):n}function qs(n,o){var c=n.__data__;return Pb(o)?c[typeof o=="string"?"string":"hash"]:c.map}function ou(n){for(var o=Tt(n),c=o.length;c--;){var A=o[c],_=n[A];o[c]=[A,_,oh(_)]}return o}function br(n,o){var c=Ny(n,o);return Sd(c)?c:s}function Tb(n){var o=Xe.call(n,pr),c=n[pr];try{n[pr]=s;var A=!0}catch(B){}var _=ws.call(n);return A&&(o?n[pr]=c:delete n[pr]),_}var su=Ll?function(n){return n==null?[]:(n=tt(n),jn(Ll(n),function(o){return ld.call(n,o)}))}:Ou,nh=Ll?function(n){for(var o=[];n;)Jn(o,su(n)),n=Rs(n);return o}:Ou,Lt=Dt;(Dl&&Lt(new Dl(new ArrayBuffer(1)))!=oe||to&&Lt(new to)!=de||Nl&&Lt(Nl.resolve())!=ht||pi&&Lt(new pi)!=lt||no&&Lt(new no)!=dr)&&(Lt=function(n){var o=Dt(n),c=o==ot?n.constructor:s,A=c?Er(c):"";if(A)switch(A){case a0:return oe;case l0:return de;case u0:return ht;case c0:return lt;case f0:return dr}return o});function wb(n,o,c){for(var A=-1,_=c.length;++A<_;){var B=c[A],V=B.size;switch(B.type){case"drop":n+=V;break;case"dropRight":o-=V;break;case"take":o=Pt(o,n+V);break;case"takeRight":n=At(n,o-V);break}}return{start:n,end:o}}function xb(n){var o=n.match(Lv);return o?o[1].split(Dv):[]}function rh(n,o,c){o=Xn(o,n);for(var A=-1,_=o.length,B=!1;++A<_;){var V=Cn(o[A]);if(!(B=n!=null&&c(n,V)))break;n=n[V]}return B||++A!=_?B:(_=n==null?0:n.length,!!_&&na(_)&&Ln(V,_)&&(Pe(n)||Ar(n)))}function Ib(n){var o=n.length,c=new n.constructor(o);return o&&typeof n[0]=="string"&&Xe.call(n,"index")&&(c.index=n.index,c.input=n.input),c}function ih(n){return typeof n.constructor=="function"&&!fo(n)?gi(Rs(n)):{}}function Rb(n,o,c){var A=n.constructor;switch(o){case q:return Xl(n);case te:case fe:return new A(+n);case oe:return db(n,c);case ue:case ye:case Ne:case St:case xn:case cl:case fl:case dl:case hl:return $d(n,c);case de:return new A;case Ze:case bn:return new A(n);case yn:return hb(n);case lt:return new A;case Vn:return pb(n)}}function _b(n,o){var c=o.length;if(!c)return n;var A=c-1;return o[A]=(c>1?"& ":"")+o[A],o=o.join(c>2?", ":" "),n.replace(Pv,`{
/* [wrapped with `+o+`] */
`)}function Mb(n){return Pe(n)||Ar(n)||!!(ud&&n&&n[ud])}function Ln(n,o){var c=typeof n;return o=o==null?$:o,!!o&&(c=="number"||c!="symbol"&&Wv.test(n))&&n>-1&&n%1==0&&n<o}function Nt(n,o,c){if(!ut(c))return!1;var A=typeof o;return(A=="number"?kt(c)&&Ln(o,c.length):A=="string"&&o in c)?dn(c[o],n):!1}function au(n,o){if(Pe(n))return!1;var c=typeof n;return c=="number"||c=="symbol"||c=="boolean"||n==null||Vt(n)?!0:Iv.test(n)||!xv.test(n)||o!=null&&n in tt(o)}function Pb(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function lu(n){var o=Ks(n),c=F[o];if(typeof c!="function"||!(o in Ve.prototype))return!1;if(n===c)return!0;var A=iu(c);return!!A&&n===A[0]}function Lb(n){return!!od&&od in n}var Db=Os?Dn:Tu;function fo(n){var o=n&&n.constructor,c=typeof o=="function"&&o.prototype||hi;return n===c}function oh(n){return n===n&&!ut(n)}function sh(n,o){return function(c){return c==null?!1:c[n]===o&&(o!==s||n in tt(c))}}function Nb(n){var o=ea(n,function(A){return c.size===u&&c.clear(),A}),c=o.cache;return o}function Fb(n,o){var c=n[1],A=o[1],_=c|A,B=_<(w|x|d),V=A==d&&c==O||A==d&&c==p&&n[7].length<=o[8]||A==(d|p)&&o[7].length<=o[8]&&c==O;if(!(B||V))return n;A&w&&(n[2]=o[2],_|=c&w?0:S);var K=o[3];if(K){var Y=n[3];n[3]=Y?Gd(Y,K,o[4]):K,n[4]=Y?Kn(n[3],f):o[4]}return K=o[5],K&&(Y=n[5],n[5]=Y?Wd(Y,K,o[6]):K,n[6]=Y?Kn(n[5],f):o[6]),K=o[7],K&&(n[7]=K),A&d&&(n[8]=n[8]==null?o[8]:Pt(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=_,n}function Ub(n){var o=[];if(n!=null)for(var c in tt(n))o.push(c);return o}function kb(n){return ws.call(n)}function ah(n,o,c){return o=At(o===s?n.length-1:o,0),function(){for(var A=arguments,_=-1,B=At(A.length-o,0),V=ne(B);++_<B;)V[_]=A[o+_];_=-1;for(var K=ne(o+1);++_<o;)K[_]=A[_];return K[o]=c(V),Gt(n,this,K)}}function lh(n,o){return o.length<2?n:yr(n,tn(o,0,-1))}function Bb(n,o){for(var c=n.length,A=Pt(o.length,c),_=Ut(n);A--;){var B=o[A];n[A]=Ln(B,c)?_[B]:s}return n}function uu(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var uh=fh(Pd),ho=e0||function(n,o){return Ot.setTimeout(n,o)},cu=fh(lb);function ch(n,o,c){var A=o+"";return cu(n,_b(A,$b(xb(A),c)))}function fh(n){var o=0,c=0;return function(){var A=i0(),_=z-(A-c);if(c=A,_>0){if(++o>=U)return arguments[0]}else o=0;return n.apply(s,arguments)}}function Zs(n,o){var c=-1,A=n.length,_=A-1;for(o=o===s?A:o;++c<o;){var B=jl(c,_),V=n[B];n[B]=n[c],n[c]=V}return n.length=o,n}var dh=Nb(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(Rv,function(c,A,_,B){o.push(_?B.replace(Uv,"$1"):A||c)}),o});function Cn(n){if(typeof n=="string"||Vt(n))return n;var o=n+"";return o=="0"&&1/n==-L?"-0":o}function Er(n){if(n!=null){try{return Ts.call(n)}catch(o){}try{return n+""}catch(o){}}return""}function $b(n,o){return Yt(P,function(c){var A="_."+c[0];o&c[1]&&!Es(n,A)&&n.push(A)}),n.sort()}function hh(n){if(n instanceof Ve)return n.clone();var o=new Xt(n.__wrapped__,n.__chain__);return o.__actions__=Ut(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function Hb(n,o,c){(c?Nt(n,o,c):o===s)?o=1:o=At(Le(o),0);var A=n==null?0:n.length;if(!A||o<1)return[];for(var _=0,B=0,V=ne(Ps(A/o));_<A;)V[B++]=tn(n,_,_+=o);return V}function Gb(n){for(var o=-1,c=n==null?0:n.length,A=0,_=[];++o<c;){var B=n[o];B&&(_[A++]=B)}return _}function Wb(){var n=arguments.length;if(!n)return[];for(var o=ne(n-1),c=arguments[0],A=n;A--;)o[A-1]=arguments[A];return Jn(Pe(c)?Ut(c):[c],_t(o,1))}var zb=$e(function(n,o){return mt(n)?so(n,_t(o,1,mt,!0)):[]}),Vb=$e(function(n,o){var c=nn(o);return mt(c)&&(c=s),mt(n)?so(n,_t(o,1,mt,!0),Oe(c,2)):[]}),jb=$e(function(n,o){var c=nn(o);return mt(c)&&(c=s),mt(n)?so(n,_t(o,1,mt,!0),s,c):[]});function Jb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),tn(n,o<0?0:o,A)):[]}function Kb(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),o=A-o,tn(n,0,o<0?0:o)):[]}function qb(n,o){return n&&n.length?Gs(n,Oe(o,3),!0,!0):[]}function Zb(n,o){return n&&n.length?Gs(n,Oe(o,3),!0):[]}function Yb(n,o,c,A){var _=n==null?0:n.length;return _?(c&&typeof c!="number"&&Nt(n,o,c)&&(c=0,A=_),W0(n,o,c,A)):[]}function ph(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var _=c==null?0:Le(c);return _<0&&(_=At(A+_,0)),As(n,Oe(o,3),_)}function mh(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var _=A-1;return c!==s&&(_=Le(c),_=c<0?At(A+_,0):Pt(_,A-1)),As(n,Oe(o,3),_,!0)}function gh(n){var o=n==null?0:n.length;return o?_t(n,1):[]}function Qb(n){var o=n==null?0:n.length;return o?_t(n,L):[]}function Xb(n,o){var c=n==null?0:n.length;return c?(o=o===s?1:Le(o),_t(n,o)):[]}function eE(n){for(var o=-1,c=n==null?0:n.length,A={};++o<c;){var _=n[o];A[_[0]]=_[1]}return A}function vh(n){return n&&n.length?n[0]:s}function tE(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var _=c==null?0:Le(c);return _<0&&(_=At(A+_,0)),ci(n,o,_)}function nE(n){var o=n==null?0:n.length;return o?tn(n,0,-1):[]}var rE=$e(function(n){var o=at(n,Yl);return o.length&&o[0]===n[0]?Hl(o):[]}),iE=$e(function(n){var o=nn(n),c=at(n,Yl);return o===nn(c)?o=s:c.pop(),c.length&&c[0]===n[0]?Hl(c,Oe(o,2)):[]}),oE=$e(function(n){var o=nn(n),c=at(n,Yl);return o=typeof o=="function"?o:s,o&&c.pop(),c.length&&c[0]===n[0]?Hl(c,s,o):[]});function sE(n,o){return n==null?"":n0.call(n,o)}function nn(n){var o=n==null?0:n.length;return o?n[o-1]:s}function aE(n,o,c){var A=n==null?0:n.length;if(!A)return-1;var _=A;return c!==s&&(_=Le(c),_=_<0?At(A+_,0):Pt(_,A-1)),o===o?$y(n,o,_):As(n,Yf,_,!0)}function lE(n,o){return n&&n.length?Id(n,Le(o)):s}var uE=$e(yh);function yh(n,o){return n&&n.length&&o&&o.length?Vl(n,o):n}function cE(n,o,c){return n&&n.length&&o&&o.length?Vl(n,o,Oe(c,2)):n}function fE(n,o,c){return n&&n.length&&o&&o.length?Vl(n,o,s,c):n}var dE=Pn(function(n,o){var c=n==null?0:n.length,A=Ul(n,o);return Md(n,at(o,function(_){return Ln(_,c)?+_:_}).sort(Hd)),A});function hE(n,o){var c=[];if(!(n&&n.length))return c;var A=-1,_=[],B=n.length;for(o=Oe(o,3);++A<B;){var V=n[A];o(V,A,n)&&(c.push(V),_.push(A))}return Md(n,_),c}function fu(n){return n==null?n:s0.call(n)}function pE(n,o,c){var A=n==null?0:n.length;return A?(c&&typeof c!="number"&&Nt(n,o,c)?(o=0,c=A):(o=o==null?0:Le(o),c=c===s?A:Le(c)),tn(n,o,c)):[]}function mE(n,o){return Hs(n,o)}function gE(n,o,c){return Kl(n,o,Oe(c,2))}function vE(n,o){var c=n==null?0:n.length;if(c){var A=Hs(n,o);if(A<c&&dn(n[A],o))return A}return-1}function yE(n,o){return Hs(n,o,!0)}function bE(n,o,c){return Kl(n,o,Oe(c,2),!0)}function EE(n,o){var c=n==null?0:n.length;if(c){var A=Hs(n,o,!0)-1;if(dn(n[A],o))return A}return-1}function AE(n){return n&&n.length?Ld(n):[]}function CE(n,o){return n&&n.length?Ld(n,Oe(o,2)):[]}function SE(n){var o=n==null?0:n.length;return o?tn(n,1,o):[]}function OE(n,o,c){return n&&n.length?(o=c||o===s?1:Le(o),tn(n,0,o<0?0:o)):[]}function TE(n,o,c){var A=n==null?0:n.length;return A?(o=c||o===s?1:Le(o),o=A-o,tn(n,o<0?0:o,A)):[]}function wE(n,o){return n&&n.length?Gs(n,Oe(o,3),!1,!0):[]}function xE(n,o){return n&&n.length?Gs(n,Oe(o,3)):[]}var IE=$e(function(n){return Qn(_t(n,1,mt,!0))}),RE=$e(function(n){var o=nn(n);return mt(o)&&(o=s),Qn(_t(n,1,mt,!0),Oe(o,2))}),_E=$e(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Qn(_t(n,1,mt,!0),s,o)});function ME(n){return n&&n.length?Qn(n):[]}function PE(n,o){return n&&n.length?Qn(n,Oe(o,2)):[]}function LE(n,o){return o=typeof o=="function"?o:s,n&&n.length?Qn(n,s,o):[]}function du(n){if(!(n&&n.length))return[];var o=0;return n=jn(n,function(c){if(mt(c))return o=At(c.length,o),!0}),Rl(o,function(c){return at(n,wl(c))})}function bh(n,o){if(!(n&&n.length))return[];var c=du(n);return o==null?c:at(c,function(A){return Gt(o,s,A)})}var DE=$e(function(n,o){return mt(n)?so(n,o):[]}),NE=$e(function(n){return Zl(jn(n,mt))}),FE=$e(function(n){var o=nn(n);return mt(o)&&(o=s),Zl(jn(n,mt),Oe(o,2))}),UE=$e(function(n){var o=nn(n);return o=typeof o=="function"?o:s,Zl(jn(n,mt),s,o)}),kE=$e(du);function BE(n,o){return Ud(n||[],o||[],oo)}function $E(n,o){return Ud(n||[],o||[],uo)}var HE=$e(function(n){var o=n.length,c=o>1?n[o-1]:s;return c=typeof c=="function"?(n.pop(),c):s,bh(n,c)});function Eh(n){var o=F(n);return o.__chain__=!0,o}function GE(n,o){return o(n),n}function Ys(n,o){return o(n)}var WE=Pn(function(n){var o=n.length,c=o?n[0]:0,A=this.__wrapped__,_=function(B){return Ul(B,n)};return o>1||this.__actions__.length||!(A instanceof Ve)||!Ln(c)?this.thru(_):(A=A.slice(c,+c+(o?1:0)),A.__actions__.push({func:Ys,args:[_],thisArg:s}),new Xt(A,this.__chain__).thru(function(B){return o&&!B.length&&B.push(s),B}))});function zE(){return Eh(this)}function VE(){return new Xt(this.value(),this.__chain__)}function jE(){this.__values__===s&&(this.__values__=Dh(this.value()));var n=this.__index__>=this.__values__.length,o=n?s:this.__values__[this.__index__++];return{done:n,value:o}}function JE(){return this}function KE(n){for(var o,c=this;c instanceof Fs;){var A=hh(c);A.__index__=0,A.__values__=s,o?_.__wrapped__=A:o=A;var _=A;c=c.__wrapped__}return _.__wrapped__=n,o}function qE(){var n=this.__wrapped__;if(n instanceof Ve){var o=n;return this.__actions__.length&&(o=new Ve(this)),o=o.reverse(),o.__actions__.push({func:Ys,args:[fu],thisArg:s}),new Xt(o,this.__chain__)}return this.thru(fu)}function ZE(){return Fd(this.__wrapped__,this.__actions__)}var YE=Ws(function(n,o,c){Xe.call(n,c)?++n[c]:_n(n,c,1)});function QE(n,o,c){var A=Pe(n)?qf:G0;return c&&Nt(n,o,c)&&(o=s),A(n,Oe(o,3))}function XE(n,o){var c=Pe(n)?jn:bd;return c(n,Oe(o,3))}var eA=Jd(ph),tA=Jd(mh);function nA(n,o){return _t(Qs(n,o),1)}function rA(n,o){return _t(Qs(n,o),L)}function iA(n,o,c){return c=c===s?1:Le(c),_t(Qs(n,o),c)}function Ah(n,o){var c=Pe(n)?Yt:Yn;return c(n,Oe(o,3))}function Ch(n,o){var c=Pe(n)?Sy:yd;return c(n,Oe(o,3))}var oA=Ws(function(n,o,c){Xe.call(n,c)?n[c].push(o):_n(n,c,[o])});function sA(n,o,c,A){n=kt(n)?n:Ai(n),c=c&&!A?Le(c):0;var _=n.length;return c<0&&(c=At(_+c,0)),ra(n)?c<=_&&n.indexOf(o,c)>-1:!!_&&ci(n,o,c)>-1}var aA=$e(function(n,o,c){var A=-1,_=typeof o=="function",B=kt(n)?ne(n.length):[];return Yn(n,function(V){B[++A]=_?Gt(o,V,c):ao(V,o,c)}),B}),lA=Ws(function(n,o,c){_n(n,c,o)});function Qs(n,o){var c=Pe(n)?at:Td;return c(n,Oe(o,3))}function uA(n,o,c,A){return n==null?[]:(Pe(o)||(o=o==null?[]:[o]),c=A?s:c,Pe(c)||(c=c==null?[]:[c]),Rd(n,o,c))}var cA=Ws(function(n,o,c){n[c?0:1].push(o)},function(){return[[],[]]});function fA(n,o,c){var A=Pe(n)?Ol:Xf,_=arguments.length<3;return A(n,Oe(o,4),c,_,Yn)}function dA(n,o,c){var A=Pe(n)?Oy:Xf,_=arguments.length<3;return A(n,Oe(o,4),c,_,yd)}function hA(n,o){var c=Pe(n)?jn:bd;return c(n,ta(Oe(o,3)))}function pA(n){var o=Pe(n)?pd:sb;return o(n)}function mA(n,o,c){(c?Nt(n,o,c):o===s)?o=1:o=Le(o);var A=Pe(n)?U0:ab;return A(n,o)}function gA(n){var o=Pe(n)?k0:ub;return o(n)}function vA(n){if(n==null)return 0;if(kt(n))return ra(n)?di(n):n.length;var o=Lt(n);return o==de||o==lt?n.size:Wl(n).length}function yA(n,o,c){var A=Pe(n)?Tl:cb;return c&&Nt(n,o,c)&&(o=s),A(n,Oe(o,3))}var bA=$e(function(n,o){if(n==null)return[];var c=o.length;return c>1&&Nt(n,o[0],o[1])?o=[]:c>2&&Nt(o[0],o[1],o[2])&&(o=[o[0]]),Rd(n,_t(o,1),[])}),Xs=Xy||function(){return Ot.Date.now()};function EA(n,o){if(typeof o!="function")throw new Qt(i);return n=Le(n),function(){if(--n<1)return o.apply(this,arguments)}}function Sh(n,o,c){return o=c?s:o,o=n&&o==null?n.length:o,Mn(n,d,s,s,s,s,o)}function Oh(n,o){var c;if(typeof o!="function")throw new Qt(i);return n=Le(n),function(){return--n>0&&(c=o.apply(this,arguments)),n<=1&&(o=s),c}}var hu=$e(function(n,o,c){var A=w;if(c.length){var _=Kn(c,bi(hu));A|=g}return Mn(n,A,o,c,_)}),Th=$e(function(n,o,c){var A=w|x;if(c.length){var _=Kn(c,bi(Th));A|=g}return Mn(o,A,n,c,_)});function wh(n,o,c){o=c?s:o;var A=Mn(n,O,s,s,s,s,s,o);return A.placeholder=wh.placeholder,A}function xh(n,o,c){o=c?s:o;var A=Mn(n,R,s,s,s,s,s,o);return A.placeholder=xh.placeholder,A}function Ih(n,o,c){var A,_,B,V,K,Y,se=0,ae=!1,le=!1,he=!0;if(typeof n!="function")throw new Qt(i);o=rn(o)||0,ut(c)&&(ae=!!c.leading,le="maxWait"in c,B=le?At(rn(c.maxWait)||0,o):B,he="trailing"in c?!!c.trailing:he);function be(gt){var hn=A,Fn=_;return A=_=s,se=gt,V=n.apply(Fn,hn),V}function Te(gt){return se=gt,K=ho(Ge,o),ae?be(gt):V}function Fe(gt){var hn=gt-Y,Fn=gt-se,Jh=o-hn;return le?Pt(Jh,B-Fn):Jh}function we(gt){var hn=gt-Y,Fn=gt-se;return Y===s||hn>=o||hn<0||le&&Fn>=B}function Ge(){var gt=Xs();if(we(gt))return je(gt);K=ho(Ge,Fe(gt))}function je(gt){return K=s,he&&A?be(gt):(A=_=s,V)}function jt(){K!==s&&kd(K),se=0,A=Y=_=K=s}function Ft(){return K===s?V:je(Xs())}function Jt(){var gt=Xs(),hn=we(gt);if(A=arguments,_=this,Y=gt,hn){if(K===s)return Te(Y);if(le)return kd(K),K=ho(Ge,o),be(Y)}return K===s&&(K=ho(Ge,o)),V}return Jt.cancel=jt,Jt.flush=Ft,Jt}var AA=$e(function(n,o){return vd(n,1,o)}),CA=$e(function(n,o,c){return vd(n,rn(o)||0,c)});function SA(n){return Mn(n,T)}function ea(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Qt(i);var c=function(){var A=arguments,_=o?o.apply(this,A):A[0],B=c.cache;if(B.has(_))return B.get(_);var V=n.apply(this,A);return c.cache=B.set(_,V)||B,V};return c.cache=new(ea.Cache||Rn),c}ea.Cache=Rn;function ta(n){if(typeof n!="function")throw new Qt(i);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function OA(n){return Oh(2,n)}var TA=fb(function(n,o){o=o.length==1&&Pe(o[0])?at(o[0],Wt(Oe())):at(_t(o,1),Wt(Oe()));var c=o.length;return $e(function(A){for(var _=-1,B=Pt(A.length,c);++_<B;)A[_]=o[_].call(this,A[_]);return Gt(n,this,A)})}),pu=$e(function(n,o){var c=Kn(o,bi(pu));return Mn(n,g,s,o,c)}),Rh=$e(function(n,o){var c=Kn(o,bi(Rh));return Mn(n,y,s,o,c)}),wA=Pn(function(n,o){return Mn(n,p,s,s,s,o)});function xA(n,o){if(typeof n!="function")throw new Qt(i);return o=o===s?o:Le(o),$e(n,o)}function IA(n,o){if(typeof n!="function")throw new Qt(i);return o=o==null?0:At(Le(o),0),$e(function(c){var A=c[o],_=er(c,0,o);return A&&Jn(_,A),Gt(n,this,_)})}function RA(n,o,c){var A=!0,_=!0;if(typeof n!="function")throw new Qt(i);return ut(c)&&(A="leading"in c?!!c.leading:A,_="trailing"in c?!!c.trailing:_),Ih(n,o,{leading:A,maxWait:o,trailing:_})}function _A(n){return Sh(n,1)}function MA(n,o){return pu(Ql(o),n)}function PA(){if(!arguments.length)return[];var n=arguments[0];return Pe(n)?n:[n]}function LA(n){return en(n,C)}function DA(n,o){return o=typeof o=="function"?o:s,en(n,C,o)}function NA(n){return en(n,m|C)}function FA(n,o){return o=typeof o=="function"?o:s,en(n,m|C,o)}function UA(n,o){return o==null||gd(n,o,Tt(o))}function dn(n,o){return n===o||n!==n&&o!==o}var kA=Js($l),BA=Js(function(n,o){return n>=o}),Ar=Cd(function(){return arguments}())?Cd:function(n){return pt(n)&&Xe.call(n,"callee")&&!ld.call(n,"callee")},Pe=ne.isArray,$A=Wf?Wt(Wf):K0;function kt(n){return n!=null&&na(n.length)&&!Dn(n)}function mt(n){return pt(n)&&kt(n)}function HA(n){return n===!0||n===!1||pt(n)&&Dt(n)==te}var tr=t0||Tu,GA=zf?Wt(zf):q0;function WA(n){return pt(n)&&n.nodeType===1&&!po(n)}function zA(n){if(n==null)return!0;if(kt(n)&&(Pe(n)||typeof n=="string"||typeof n.splice=="function"||tr(n)||Ei(n)||Ar(n)))return!n.length;var o=Lt(n);if(o==de||o==lt)return!n.size;if(fo(n))return!Wl(n).length;for(var c in n)if(Xe.call(n,c))return!1;return!0}function VA(n,o){return lo(n,o)}function jA(n,o,c){c=typeof c=="function"?c:s;var A=c?c(n,o):s;return A===s?lo(n,o,s,c):!!A}function mu(n){if(!pt(n))return!1;var o=Dt(n);return o==Ee||o==me||typeof n.message=="string"&&typeof n.name=="string"&&!po(n)}function JA(n){return typeof n=="number"&&cd(n)}function Dn(n){if(!ut(n))return!1;var o=Dt(n);return o==Se||o==ze||o==j||o==un}function _h(n){return typeof n=="number"&&n==Le(n)}function na(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=$}function ut(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function pt(n){return n!=null&&typeof n=="object"}var Mh=Vf?Wt(Vf):Y0;function KA(n,o){return n===o||Gl(n,o,ou(o))}function qA(n,o,c){return c=typeof c=="function"?c:s,Gl(n,o,ou(o),c)}function ZA(n){return Ph(n)&&n!=+n}function YA(n){if(Db(n))throw new Me(r);return Sd(n)}function QA(n){return n===null}function XA(n){return n==null}function Ph(n){return typeof n=="number"||pt(n)&&Dt(n)==Ze}function po(n){if(!pt(n)||Dt(n)!=ot)return!1;var o=Rs(n);if(o===null)return!0;var c=Xe.call(o,"constructor")&&o.constructor;return typeof c=="function"&&c instanceof c&&Ts.call(c)==qy}var gu=jf?Wt(jf):Q0;function eC(n){return _h(n)&&n>=-$&&n<=$}var Lh=Jf?Wt(Jf):X0;function ra(n){return typeof n=="string"||!Pe(n)&&pt(n)&&Dt(n)==bn}function Vt(n){return typeof n=="symbol"||pt(n)&&Dt(n)==Vn}var Ei=Kf?Wt(Kf):eb;function tC(n){return n===s}function nC(n){return pt(n)&&Lt(n)==dr}function rC(n){return pt(n)&&Dt(n)==ul}var iC=Js(zl),oC=Js(function(n,o){return n<=o});function Dh(n){if(!n)return[];if(kt(n))return ra(n)?cn(n):Ut(n);if(eo&&n[eo])return Uy(n[eo]());var o=Lt(n),c=o==de?Ml:o==lt?Cs:Ai;return c(n)}function Nn(n){if(!n)return n===0?n:0;if(n=rn(n),n===L||n===-L){var o=n<0?-1:1;return o*G}return n===n?n:0}function Le(n){var o=Nn(n),c=o%1;return o===o?c?o-c:o:0}function Nh(n){return n?vr(Le(n),0,ee):0}function rn(n){if(typeof n=="number")return n;if(Vt(n))return J;if(ut(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=ut(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=ed(n);var c=$v.test(n);return c||Gv.test(n)?Ey(n.slice(2),c?2:8):Bv.test(n)?J:+n}function Fh(n){return An(n,Bt(n))}function sC(n){return n?vr(Le(n),-$,$):n===0?n:0}function Ye(n){return n==null?"":zt(n)}var aC=vi(function(n,o){if(fo(o)||kt(o)){An(o,Tt(o),n);return}for(var c in o)Xe.call(o,c)&&oo(n,c,o[c])}),Uh=vi(function(n,o){An(o,Bt(o),n)}),ia=vi(function(n,o,c,A){An(o,Bt(o),n,A)}),lC=vi(function(n,o,c,A){An(o,Tt(o),n,A)}),uC=Pn(Ul);function cC(n,o){var c=gi(n);return o==null?c:md(c,o)}var fC=$e(function(n,o){n=tt(n);var c=-1,A=o.length,_=A>2?o[2]:s;for(_&&Nt(o[0],o[1],_)&&(A=1);++c<A;)for(var B=o[c],V=Bt(B),K=-1,Y=V.length;++K<Y;){var se=V[K],ae=n[se];(ae===s||dn(ae,hi[se])&&!Xe.call(n,se))&&(n[se]=B[se])}return n}),dC=$e(function(n){return n.push(s,eh),Gt(kh,s,n)});function hC(n,o){return Zf(n,Oe(o,3),En)}function pC(n,o){return Zf(n,Oe(o,3),Bl)}function mC(n,o){return n==null?n:kl(n,Oe(o,3),Bt)}function gC(n,o){return n==null?n:Ed(n,Oe(o,3),Bt)}function vC(n,o){return n&&En(n,Oe(o,3))}function yC(n,o){return n&&Bl(n,Oe(o,3))}function bC(n){return n==null?[]:Bs(n,Tt(n))}function EC(n){return n==null?[]:Bs(n,Bt(n))}function vu(n,o,c){var A=n==null?s:yr(n,o);return A===s?c:A}function AC(n,o){return n!=null&&rh(n,o,z0)}function yu(n,o){return n!=null&&rh(n,o,V0)}var CC=qd(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=ws.call(o)),n[o]=c},Eu($t)),SC=qd(function(n,o,c){o!=null&&typeof o.toString!="function"&&(o=ws.call(o)),Xe.call(n,o)?n[o].push(c):n[o]=[c]},Oe),OC=$e(ao);function Tt(n){return kt(n)?hd(n):Wl(n)}function Bt(n){return kt(n)?hd(n,!0):tb(n)}function TC(n,o){var c={};return o=Oe(o,3),En(n,function(A,_,B){_n(c,o(A,_,B),A)}),c}function wC(n,o){var c={};return o=Oe(o,3),En(n,function(A,_,B){_n(c,_,o(A,_,B))}),c}var xC=vi(function(n,o,c){$s(n,o,c)}),kh=vi(function(n,o,c,A){$s(n,o,c,A)}),IC=Pn(function(n,o){var c={};if(n==null)return c;var A=!1;o=at(o,function(B){return B=Xn(B,n),A||(A=B.length>1),B}),An(n,ru(n),c),A&&(c=en(c,m|b|C,Cb));for(var _=o.length;_--;)ql(c,o[_]);return c});function RC(n,o){return Bh(n,ta(Oe(o)))}var _C=Pn(function(n,o){return n==null?{}:rb(n,o)});function Bh(n,o){if(n==null)return{};var c=at(ru(n),function(A){return[A]});return o=Oe(o),_d(n,c,function(A,_){return o(A,_[0])})}function MC(n,o,c){o=Xn(o,n);var A=-1,_=o.length;for(_||(_=1,n=s);++A<_;){var B=n==null?s:n[Cn(o[A])];B===s&&(A=_,B=c),n=Dn(B)?B.call(n):B}return n}function PC(n,o,c){return n==null?n:uo(n,o,c)}function LC(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:uo(n,o,c,A)}var $h=Qd(Tt),Hh=Qd(Bt);function DC(n,o,c){var A=Pe(n),_=A||tr(n)||Ei(n);if(o=Oe(o,4),c==null){var B=n&&n.constructor;_?c=A?new B:[]:ut(n)?c=Dn(B)?gi(Rs(n)):{}:c={}}return(_?Yt:En)(n,function(V,K,Y){return o(c,V,K,Y)}),c}function NC(n,o){return n==null?!0:ql(n,o)}function FC(n,o,c){return n==null?n:Nd(n,o,Ql(c))}function UC(n,o,c,A){return A=typeof A=="function"?A:s,n==null?n:Nd(n,o,Ql(c),A)}function Ai(n){return n==null?[]:_l(n,Tt(n))}function kC(n){return n==null?[]:_l(n,Bt(n))}function BC(n,o,c){return c===s&&(c=o,o=s),c!==s&&(c=rn(c),c=c===c?c:0),o!==s&&(o=rn(o),o=o===o?o:0),vr(rn(n),o,c)}function $C(n,o,c){return o=Nn(o),c===s?(c=o,o=0):c=Nn(c),n=rn(n),j0(n,o,c)}function HC(n,o,c){if(c&&typeof c!="boolean"&&Nt(n,o,c)&&(o=c=s),c===s&&(typeof o=="boolean"?(c=o,o=s):typeof n=="boolean"&&(c=n,n=s)),n===s&&o===s?(n=0,o=1):(n=Nn(n),o===s?(o=n,n=0):o=Nn(o)),n>o){var A=n;n=o,o=A}if(c||n%1||o%1){var _=fd();return Pt(n+_*(o-n+by("1e-"+((_+"").length-1))),o)}return jl(n,o)}var GC=yi(function(n,o,c){return o=o.toLowerCase(),n+(c?Gh(o):o)});function Gh(n){return bu(Ye(n).toLowerCase())}function Wh(n){return n=Ye(n),n&&n.replace(zv,Py).replace(uy,"")}function WC(n,o,c){n=Ye(n),o=zt(o);var A=n.length;c=c===s?A:vr(Le(c),0,A);var _=c;return c-=o.length,c>=0&&n.slice(c,_)==o}function zC(n){return n=Ye(n),n&&Ov.test(n)?n.replace(Ef,Ly):n}function VC(n){return n=Ye(n),n&&_v.test(n)?n.replace(pl,"\\$&"):n}var jC=yi(function(n,o,c){return n+(c?"-":"")+o.toLowerCase()}),JC=yi(function(n,o,c){return n+(c?" ":"")+o.toLowerCase()}),KC=jd("toLowerCase");function qC(n,o,c){n=Ye(n),o=Le(o);var A=o?di(n):0;if(!o||A>=o)return n;var _=(o-A)/2;return js(Ls(_),c)+n+js(Ps(_),c)}function ZC(n,o,c){n=Ye(n),o=Le(o);var A=o?di(n):0;return o&&A<o?n+js(o-A,c):n}function YC(n,o,c){n=Ye(n),o=Le(o);var A=o?di(n):0;return o&&A<o?js(o-A,c)+n:n}function QC(n,o,c){return c||o==null?o=0:o&&(o=+o),o0(Ye(n).replace(ml,""),o||0)}function XC(n,o,c){return(c?Nt(n,o,c):o===s)?o=1:o=Le(o),Jl(Ye(n),o)}function eS(){var n=arguments,o=Ye(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var tS=yi(function(n,o,c){return n+(c?"_":"")+o.toLowerCase()});function nS(n,o,c){return c&&typeof c!="number"&&Nt(n,o,c)&&(o=c=s),c=c===s?ee:c>>>0,c?(n=Ye(n),n&&(typeof o=="string"||o!=null&&!gu(o))&&(o=zt(o),!o&&fi(n))?er(cn(n),0,c):n.split(o,c)):[]}var rS=yi(function(n,o,c){return n+(c?" ":"")+bu(o)});function iS(n,o,c){return n=Ye(n),c=c==null?0:vr(Le(c),0,n.length),o=zt(o),n.slice(c,c+o.length)==o}function oS(n,o,c){var A=F.templateSettings;c&&Nt(n,o,c)&&(o=s),n=Ye(n),o=ia({},o,A,Xd);var _=ia({},o.imports,A.imports,Xd),B=Tt(_),V=_l(_,B),K,Y,se=0,ae=o.interpolate||vs,le="__p += '",he=Pl((o.escape||vs).source+"|"+ae.source+"|"+(ae===Af?kv:vs).source+"|"+(o.evaluate||vs).source+"|$","g"),be="//# sourceURL="+(Xe.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++py+"]")+`
`;n.replace(he,function(we,Ge,je,jt,Ft,Jt){return je||(je=jt),le+=n.slice(se,Jt).replace(Vv,Dy),Ge&&(K=!0,le+=`' +
__e(`+Ge+`) +
'`),Ft&&(Y=!0,le+=`';
`+Ft+`;
__p += '`),je&&(le+=`' +
((__t = (`+je+`)) == null ? '' : __t) +
'`),se=Jt+we.length,we}),le+=`';
`;var Te=Xe.call(o,"variable")&&o.variable;if(!Te)le=`with (obj) {
`+le+`
}
`;else if(Fv.test(Te))throw new Me(a);le=(Y?le.replace(Ev,""):le).replace(Av,"$1").replace(Cv,"$1;"),le="function("+(Te||"obj")+`) {
`+(Te?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+le+`return __p
}`;var Fe=Vh(function(){return Ke(B,be+"return "+le).apply(s,V)});if(Fe.source=le,mu(Fe))throw Fe;return Fe}function sS(n){return Ye(n).toLowerCase()}function aS(n){return Ye(n).toUpperCase()}function lS(n,o,c){if(n=Ye(n),n&&(c||o===s))return ed(n);if(!n||!(o=zt(o)))return n;var A=cn(n),_=cn(o),B=td(A,_),V=nd(A,_)+1;return er(A,B,V).join("")}function uS(n,o,c){if(n=Ye(n),n&&(c||o===s))return n.slice(0,id(n)+1);if(!n||!(o=zt(o)))return n;var A=cn(n),_=nd(A,cn(o))+1;return er(A,0,_).join("")}function cS(n,o,c){if(n=Ye(n),n&&(c||o===s))return n.replace(ml,"");if(!n||!(o=zt(o)))return n;var A=cn(n),_=td(A,cn(o));return er(A,_).join("")}function fS(n,o){var c=v,A=I;if(ut(o)){var _="separator"in o?o.separator:_;c="length"in o?Le(o.length):c,A="omission"in o?zt(o.omission):A}n=Ye(n);var B=n.length;if(fi(n)){var V=cn(n);B=V.length}if(c>=B)return n;var K=c-di(A);if(K<1)return A;var Y=V?er(V,0,K).join(""):n.slice(0,K);if(_===s)return Y+A;if(V&&(K+=Y.length-K),gu(_)){if(n.slice(K).search(_)){var se,ae=Y;for(_.global||(_=Pl(_.source,Ye(Cf.exec(_))+"g")),_.lastIndex=0;se=_.exec(ae);)var le=se.index;Y=Y.slice(0,le===s?K:le)}}else if(n.indexOf(zt(_),K)!=K){var he=Y.lastIndexOf(_);he>-1&&(Y=Y.slice(0,he))}return Y+A}function dS(n){return n=Ye(n),n&&Sv.test(n)?n.replace(bf,Hy):n}var hS=yi(function(n,o,c){return n+(c?" ":"")+o.toUpperCase()}),bu=jd("toUpperCase");function zh(n,o,c){return n=Ye(n),o=c?s:o,o===s?Fy(n)?zy(n):xy(n):n.match(o)||[]}var Vh=$e(function(n,o){try{return Gt(n,s,o)}catch(c){return mu(c)?c:new Me(c)}}),pS=Pn(function(n,o){return Yt(o,function(c){c=Cn(c),_n(n,c,hu(n[c],n))}),n});function mS(n){var o=n==null?0:n.length,c=Oe();return n=o?at(n,function(A){if(typeof A[1]!="function")throw new Qt(i);return[c(A[0]),A[1]]}):[],$e(function(A){for(var _=-1;++_<o;){var B=n[_];if(Gt(B[0],this,A))return Gt(B[1],this,A)}})}function gS(n){return H0(en(n,m))}function Eu(n){return function(){return n}}function vS(n,o){return n==null||n!==n?o:n}var yS=Kd(),bS=Kd(!0);function $t(n){return n}function Au(n){return Od(typeof n=="function"?n:en(n,m))}function ES(n){return wd(en(n,m))}function AS(n,o){return xd(n,en(o,m))}var CS=$e(function(n,o){return function(c){return ao(c,n,o)}}),SS=$e(function(n,o){return function(c){return ao(n,c,o)}});function Cu(n,o,c){var A=Tt(o),_=Bs(o,A);c==null&&!(ut(o)&&(_.length||!A.length))&&(c=o,o=n,n=this,_=Bs(o,Tt(o)));var B=!(ut(c)&&"chain"in c)||!!c.chain,V=Dn(n);return Yt(_,function(K){var Y=o[K];n[K]=Y,V&&(n.prototype[K]=function(){var se=this.__chain__;if(B||se){var ae=n(this.__wrapped__),le=ae.__actions__=Ut(this.__actions__);return le.push({func:Y,args:arguments,thisArg:n}),ae.__chain__=se,ae}return Y.apply(n,Jn([this.value()],arguments))})}),n}function OS(){return Ot._===this&&(Ot._=Zy),this}function Su(){}function TS(n){return n=Le(n),$e(function(o){return Id(o,n)})}var wS=eu(at),xS=eu(qf),IS=eu(Tl);function jh(n){return au(n)?wl(Cn(n)):ib(n)}function RS(n){return function(o){return n==null?s:yr(n,o)}}var _S=Zd(),MS=Zd(!0);function Ou(){return[]}function Tu(){return!1}function PS(){return{}}function LS(){return""}function DS(){return!0}function NS(n,o){if(n=Le(n),n<1||n>$)return[];var c=ee,A=Pt(n,ee);o=Oe(o),n-=ee;for(var _=Rl(A,o);++c<n;)o(c);return _}function FS(n){return Pe(n)?at(n,Cn):Vt(n)?[n]:Ut(dh(Ye(n)))}function US(n){var o=++Ky;return Ye(n)+o}var kS=Vs(function(n,o){return n+o},0),BS=tu("ceil"),$S=Vs(function(n,o){return n/o},1),HS=tu("floor");function GS(n){return n&&n.length?ks(n,$t,$l):s}function WS(n,o){return n&&n.length?ks(n,Oe(o,2),$l):s}function zS(n){return Qf(n,$t)}function VS(n,o){return Qf(n,Oe(o,2))}function jS(n){return n&&n.length?ks(n,$t,zl):s}function JS(n,o){return n&&n.length?ks(n,Oe(o,2),zl):s}var KS=Vs(function(n,o){return n*o},1),qS=tu("round"),ZS=Vs(function(n,o){return n-o},0);function YS(n){return n&&n.length?Il(n,$t):0}function QS(n,o){return n&&n.length?Il(n,Oe(o,2)):0}return F.after=EA,F.ary=Sh,F.assign=aC,F.assignIn=Uh,F.assignInWith=ia,F.assignWith=lC,F.at=uC,F.before=Oh,F.bind=hu,F.bindAll=pS,F.bindKey=Th,F.castArray=PA,F.chain=Eh,F.chunk=Hb,F.compact=Gb,F.concat=Wb,F.cond=mS,F.conforms=gS,F.constant=Eu,F.countBy=YE,F.create=cC,F.curry=wh,F.curryRight=xh,F.debounce=Ih,F.defaults=fC,F.defaultsDeep=dC,F.defer=AA,F.delay=CA,F.difference=zb,F.differenceBy=Vb,F.differenceWith=jb,F.drop=Jb,F.dropRight=Kb,F.dropRightWhile=qb,F.dropWhile=Zb,F.fill=Yb,F.filter=XE,F.flatMap=nA,F.flatMapDeep=rA,F.flatMapDepth=iA,F.flatten=gh,F.flattenDeep=Qb,F.flattenDepth=Xb,F.flip=SA,F.flow=yS,F.flowRight=bS,F.fromPairs=eE,F.functions=bC,F.functionsIn=EC,F.groupBy=oA,F.initial=nE,F.intersection=rE,F.intersectionBy=iE,F.intersectionWith=oE,F.invert=CC,F.invertBy=SC,F.invokeMap=aA,F.iteratee=Au,F.keyBy=lA,F.keys=Tt,F.keysIn=Bt,F.map=Qs,F.mapKeys=TC,F.mapValues=wC,F.matches=ES,F.matchesProperty=AS,F.memoize=ea,F.merge=xC,F.mergeWith=kh,F.method=CS,F.methodOf=SS,F.mixin=Cu,F.negate=ta,F.nthArg=TS,F.omit=IC,F.omitBy=RC,F.once=OA,F.orderBy=uA,F.over=wS,F.overArgs=TA,F.overEvery=xS,F.overSome=IS,F.partial=pu,F.partialRight=Rh,F.partition=cA,F.pick=_C,F.pickBy=Bh,F.property=jh,F.propertyOf=RS,F.pull=uE,F.pullAll=yh,F.pullAllBy=cE,F.pullAllWith=fE,F.pullAt=dE,F.range=_S,F.rangeRight=MS,F.rearg=wA,F.reject=hA,F.remove=hE,F.rest=xA,F.reverse=fu,F.sampleSize=mA,F.set=PC,F.setWith=LC,F.shuffle=gA,F.slice=pE,F.sortBy=bA,F.sortedUniq=AE,F.sortedUniqBy=CE,F.split=nS,F.spread=IA,F.tail=SE,F.take=OE,F.takeRight=TE,F.takeRightWhile=wE,F.takeWhile=xE,F.tap=GE,F.throttle=RA,F.thru=Ys,F.toArray=Dh,F.toPairs=$h,F.toPairsIn=Hh,F.toPath=FS,F.toPlainObject=Fh,F.transform=DC,F.unary=_A,F.union=IE,F.unionBy=RE,F.unionWith=_E,F.uniq=ME,F.uniqBy=PE,F.uniqWith=LE,F.unset=NC,F.unzip=du,F.unzipWith=bh,F.update=FC,F.updateWith=UC,F.values=Ai,F.valuesIn=kC,F.without=DE,F.words=zh,F.wrap=MA,F.xor=NE,F.xorBy=FE,F.xorWith=UE,F.zip=kE,F.zipObject=BE,F.zipObjectDeep=$E,F.zipWith=HE,F.entries=$h,F.entriesIn=Hh,F.extend=Uh,F.extendWith=ia,Cu(F,F),F.add=kS,F.attempt=Vh,F.camelCase=GC,F.capitalize=Gh,F.ceil=BS,F.clamp=BC,F.clone=LA,F.cloneDeep=NA,F.cloneDeepWith=FA,F.cloneWith=DA,F.conformsTo=UA,F.deburr=Wh,F.defaultTo=vS,F.divide=$S,F.endsWith=WC,F.eq=dn,F.escape=zC,F.escapeRegExp=VC,F.every=QE,F.find=eA,F.findIndex=ph,F.findKey=hC,F.findLast=tA,F.findLastIndex=mh,F.findLastKey=pC,F.floor=HS,F.forEach=Ah,F.forEachRight=Ch,F.forIn=mC,F.forInRight=gC,F.forOwn=vC,F.forOwnRight=yC,F.get=vu,F.gt=kA,F.gte=BA,F.has=AC,F.hasIn=yu,F.head=vh,F.identity=$t,F.includes=sA,F.indexOf=tE,F.inRange=$C,F.invoke=OC,F.isArguments=Ar,F.isArray=Pe,F.isArrayBuffer=$A,F.isArrayLike=kt,F.isArrayLikeObject=mt,F.isBoolean=HA,F.isBuffer=tr,F.isDate=GA,F.isElement=WA,F.isEmpty=zA,F.isEqual=VA,F.isEqualWith=jA,F.isError=mu,F.isFinite=JA,F.isFunction=Dn,F.isInteger=_h,F.isLength=na,F.isMap=Mh,F.isMatch=KA,F.isMatchWith=qA,F.isNaN=ZA,F.isNative=YA,F.isNil=XA,F.isNull=QA,F.isNumber=Ph,F.isObject=ut,F.isObjectLike=pt,F.isPlainObject=po,F.isRegExp=gu,F.isSafeInteger=eC,F.isSet=Lh,F.isString=ra,F.isSymbol=Vt,F.isTypedArray=Ei,F.isUndefined=tC,F.isWeakMap=nC,F.isWeakSet=rC,F.join=sE,F.kebabCase=jC,F.last=nn,F.lastIndexOf=aE,F.lowerCase=JC,F.lowerFirst=KC,F.lt=iC,F.lte=oC,F.max=GS,F.maxBy=WS,F.mean=zS,F.meanBy=VS,F.min=jS,F.minBy=JS,F.stubArray=Ou,F.stubFalse=Tu,F.stubObject=PS,F.stubString=LS,F.stubTrue=DS,F.multiply=KS,F.nth=lE,F.noConflict=OS,F.noop=Su,F.now=Xs,F.pad=qC,F.padEnd=ZC,F.padStart=YC,F.parseInt=QC,F.random=HC,F.reduce=fA,F.reduceRight=dA,F.repeat=XC,F.replace=eS,F.result=MC,F.round=qS,F.runInContext=Z,F.sample=pA,F.size=vA,F.snakeCase=tS,F.some=yA,F.sortedIndex=mE,F.sortedIndexBy=gE,F.sortedIndexOf=vE,F.sortedLastIndex=yE,F.sortedLastIndexBy=bE,F.sortedLastIndexOf=EE,F.startCase=rS,F.startsWith=iS,F.subtract=ZS,F.sum=YS,F.sumBy=QS,F.template=oS,F.times=NS,F.toFinite=Nn,F.toInteger=Le,F.toLength=Nh,F.toLower=sS,F.toNumber=rn,F.toSafeInteger=sC,F.toString=Ye,F.toUpper=aS,F.trim=lS,F.trimEnd=uS,F.trimStart=cS,F.truncate=fS,F.unescape=dS,F.uniqueId=US,F.upperCase=hS,F.upperFirst=bu,F.each=Ah,F.eachRight=Ch,F.first=vh,Cu(F,function(){var n={};return En(F,function(o,c){Xe.call(F.prototype,c)||(n[c]=o)}),n}(),{chain:!1}),F.VERSION=t,Yt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){F[n].placeholder=F}),Yt(["drop","take"],function(n,o){Ve.prototype[n]=function(c){c=c===s?1:At(Le(c),0);var A=this.__filtered__&&!o?new Ve(this):this.clone();return A.__filtered__?A.__takeCount__=Pt(c,A.__takeCount__):A.__views__.push({size:Pt(c,ee),type:n+(A.__dir__<0?"Right":"")}),A},Ve.prototype[n+"Right"]=function(c){return this.reverse()[n](c).reverse()}}),Yt(["filter","map","takeWhile"],function(n,o){var c=o+1,A=c==W||c==M;Ve.prototype[n]=function(_){var B=this.clone();return B.__iteratees__.push({iteratee:Oe(_,3),type:c}),B.__filtered__=B.__filtered__||A,B}}),Yt(["head","last"],function(n,o){var c="take"+(o?"Right":"");Ve.prototype[n]=function(){return this[c](1).value()[0]}}),Yt(["initial","tail"],function(n,o){var c="drop"+(o?"":"Right");Ve.prototype[n]=function(){return this.__filtered__?new Ve(this):this[c](1)}}),Ve.prototype.compact=function(){return this.filter($t)},Ve.prototype.find=function(n){return this.filter(n).head()},Ve.prototype.findLast=function(n){return this.reverse().find(n)},Ve.prototype.invokeMap=$e(function(n,o){return typeof n=="function"?new Ve(this):this.map(function(c){return ao(c,n,o)})}),Ve.prototype.reject=function(n){return this.filter(ta(Oe(n)))},Ve.prototype.slice=function(n,o){n=Le(n);var c=this;return c.__filtered__&&(n>0||o<0)?new Ve(c):(n<0?c=c.takeRight(-n):n&&(c=c.drop(n)),o!==s&&(o=Le(o),c=o<0?c.dropRight(-o):c.take(o-n)),c)},Ve.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},Ve.prototype.toArray=function(){return this.take(ee)},En(Ve.prototype,function(n,o){var c=/^(?:filter|find|map|reject)|While$/.test(o),A=/^(?:head|last)$/.test(o),_=F[A?"take"+(o=="last"?"Right":""):o],B=A||/^find/.test(o);!_||(F.prototype[o]=function(){var V=this.__wrapped__,K=A?[1]:arguments,Y=V instanceof Ve,se=K[0],ae=Y||Pe(V),le=function(Ge){var je=_.apply(F,Jn([Ge],K));return A&&he?je[0]:je};ae&&c&&typeof se=="function"&&se.length!=1&&(Y=ae=!1);var he=this.__chain__,be=!!this.__actions__.length,Te=B&&!he,Fe=Y&&!be;if(!B&&ae){V=Fe?V:new Ve(this);var we=n.apply(V,K);return we.__actions__.push({func:Ys,args:[le],thisArg:s}),new Xt(we,he)}return Te&&Fe?n.apply(this,K):(we=this.thru(le),Te?A?we.value()[0]:we.value():we)})}),Yt(["pop","push","shift","sort","splice","unshift"],function(n){var o=Ss[n],c=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",A=/^(?:pop|shift)$/.test(n);F.prototype[n]=function(){var _=arguments;if(A&&!this.__chain__){var B=this.value();return o.apply(Pe(B)?B:[],_)}return this[c](function(V){return o.apply(Pe(V)?V:[],_)})}}),En(Ve.prototype,function(n,o){var c=F[o];if(c){var A=c.name+"";Xe.call(mi,A)||(mi[A]=[]),mi[A].push({name:o,func:c})}}),mi[zs(s,x).name]=[{name:"wrapper",func:s}],Ve.prototype.clone=d0,Ve.prototype.reverse=h0,Ve.prototype.value=p0,F.prototype.at=WE,F.prototype.chain=zE,F.prototype.commit=VE,F.prototype.next=jE,F.prototype.plant=KE,F.prototype.reverse=qE,F.prototype.toJSON=F.prototype.valueOf=F.prototype.value=ZE,F.prototype.first=F.prototype.head,eo&&(F.prototype[eo]=JE),F},qn=Vy();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Ot._=qn,define(function(){return qn})):hr?((hr.exports=qn)._=qn,Al._=qn):Ot._=qn}).call(wi)});var Bp=vt((So,Bu)=>{D();(function(s,t){typeof So=="object"&&typeof Bu=="object"?Bu.exports=t():typeof define=="function"&&define.amd?define([],t):typeof So=="object"?So.bowser=t():s.bowser=t()})(So,function(){return function(s){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=s,e.c=t,e.d=function(r,i,a){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},e.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(1&i&&(r=e(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var l in r)e.d(a,l,function(u){return r[u]}.bind(null,l));return a},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=90)}({17:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r=e(18),i=function(){function a(){}return a.getFirstMatch=function(l,u){var f=u.match(l);return f&&f.length>0&&f[1]||""},a.getSecondMatch=function(l,u){var f=u.match(l);return f&&f.length>1&&f[2]||""},a.matchAndReturnConst=function(l,u,f){if(l.test(u))return f},a.getWindowsVersionName=function(l){switch(l){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},a.getMacOSVersionName=function(l){var u=l.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(u.push(0),u[0]===10)switch(u[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},a.getAndroidVersionName=function(l){var u=l.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(u.push(0),!(u[0]===1&&u[1]<5))return u[0]===1&&u[1]<6?"Cupcake":u[0]===1&&u[1]>=6?"Donut":u[0]===2&&u[1]<2?"Eclair":u[0]===2&&u[1]===2?"Froyo":u[0]===2&&u[1]>2?"Gingerbread":u[0]===3?"Honeycomb":u[0]===4&&u[1]<1?"Ice Cream Sandwich":u[0]===4&&u[1]<4?"Jelly Bean":u[0]===4&&u[1]>=4?"KitKat":u[0]===5?"Lollipop":u[0]===6?"Marshmallow":u[0]===7?"Nougat":u[0]===8?"Oreo":u[0]===9?"Pie":void 0},a.getVersionPrecision=function(l){return l.split(".").length},a.compareVersions=function(l,u,f){f===void 0&&(f=!1);var m=a.getVersionPrecision(l),b=a.getVersionPrecision(u),C=Math.max(m,b),h=0,E=a.map([l,u],function(w){var x=C-a.getVersionPrecision(w),S=w+new Array(x+1).join(".0");return a.map(S.split("."),function(O){return new Array(20-O.length).join("0")+O}).reverse()});for(f&&(h=C-Math.min(m,b)),C-=1;C>=h;){if(E[0][C]>E[1][C])return 1;if(E[0][C]===E[1][C]){if(C===h)return 0;C-=1}else if(E[0][C]<E[1][C])return-1}},a.map=function(l,u){var f,m=[];if(Array.prototype.map)return Array.prototype.map.call(l,u);for(f=0;f<l.length;f+=1)m.push(u(l[f]));return m},a.find=function(l,u){var f,m;if(Array.prototype.find)return Array.prototype.find.call(l,u);for(f=0,m=l.length;f<m;f+=1){var b=l[f];if(u(b,f))return b}},a.assign=function(l){for(var u,f,m=l,b=arguments.length,C=new Array(b>1?b-1:0),h=1;h<b;h++)C[h-1]=arguments[h];if(Object.assign)return Object.assign.apply(Object,[l].concat(C));var E=function(){var w=C[u];typeof w=="object"&&w!==null&&Object.keys(w).forEach(function(x){m[x]=w[x]})};for(u=0,f=C.length;u<f;u+=1)E();return l},a.getBrowserAlias=function(l){return r.BROWSER_ALIASES_MAP[l]},a.getBrowserTypeByAlias=function(l){return r.BROWSER_MAP[l]||""},a}();t.default=i,s.exports=t.default},18:function(s,t,e){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=e(91))&&r.__esModule?r:{default:r},a=e(18);function l(f,m){for(var b=0;b<m.length;b++){var C=m[b];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(f,C.key,C)}}var u=function(){function f(){}var m,b,C;return f.getParser=function(h,E){if(E===void 0&&(E=!1),typeof h!="string")throw new Error("UserAgent should be a string");return new i.default(h,E)},f.parse=function(h){return new i.default(h).getResult()},m=f,C=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(b=null)&&l(m.prototype,b),C&&l(m,C),f}();t.default=u,s.exports=t.default},91:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r=f(e(92)),i=f(e(93)),a=f(e(94)),l=f(e(95)),u=f(e(17));function f(b){return b&&b.__esModule?b:{default:b}}var m=function(){function b(h,E){if(E===void 0&&(E=!1),h==null||h==="")throw new Error("UserAgent parameter can't be empty");this._ua=h,this.parsedResult={},E!==!0&&this.parse()}var C=b.prototype;return C.getUA=function(){return this._ua},C.test=function(h){return h.test(this._ua)},C.parseBrowser=function(){var h=this;this.parsedResult.browser={};var E=u.default.find(r.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.browser=E.describe(this.getUA())),this.parsedResult.browser},C.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},C.getBrowserName=function(h){return h?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},C.getBrowserVersion=function(){return this.getBrowser().version},C.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},C.parseOS=function(){var h=this;this.parsedResult.os={};var E=u.default.find(i.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.os=E.describe(this.getUA())),this.parsedResult.os},C.getOSName=function(h){var E=this.getOS().name;return h?String(E).toLowerCase()||"":E||""},C.getOSVersion=function(){return this.getOS().version},C.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},C.getPlatformType=function(h){h===void 0&&(h=!1);var E=this.getPlatform().type;return h?String(E).toLowerCase()||"":E||""},C.parsePlatform=function(){var h=this;this.parsedResult.platform={};var E=u.default.find(a.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.platform=E.describe(this.getUA())),this.parsedResult.platform},C.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},C.getEngineName=function(h){return h?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},C.parseEngine=function(){var h=this;this.parsedResult.engine={};var E=u.default.find(l.default,function(w){if(typeof w.test=="function")return w.test(h);if(w.test instanceof Array)return w.test.some(function(x){return h.test(x)});throw new Error("Browser's test function is not valid")});return E&&(this.parsedResult.engine=E.describe(this.getUA())),this.parsedResult.engine},C.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},C.getResult=function(){return u.default.assign({},this.parsedResult)},C.satisfies=function(h){var E=this,w={},x=0,S={},O=0;if(Object.keys(h).forEach(function(I){var U=h[I];typeof U=="string"?(S[I]=U,O+=1):typeof U=="object"&&(w[I]=U,x+=1)}),x>0){var R=Object.keys(w),g=u.default.find(R,function(I){return E.isOS(I)});if(g){var y=this.satisfies(w[g]);if(y!==void 0)return y}var d=u.default.find(R,function(I){return E.isPlatform(I)});if(d){var p=this.satisfies(w[d]);if(p!==void 0)return p}}if(O>0){var T=Object.keys(S),v=u.default.find(T,function(I){return E.isBrowser(I,!0)});if(v!==void 0)return this.compareVersion(S[v])}},C.isBrowser=function(h,E){E===void 0&&(E=!1);var w=this.getBrowserName().toLowerCase(),x=h.toLowerCase(),S=u.default.getBrowserTypeByAlias(x);return E&&S&&(x=S.toLowerCase()),x===w},C.compareVersion=function(h){var E=[0],w=h,x=!1,S=this.getBrowserVersion();if(typeof S=="string")return h[0]===">"||h[0]==="<"?(w=h.substr(1),h[1]==="="?(x=!0,w=h.substr(2)):E=[],h[0]===">"?E.push(1):E.push(-1)):h[0]==="="?w=h.substr(1):h[0]==="~"&&(x=!0,w=h.substr(1)),E.indexOf(u.default.compareVersions(S,w,x))>-1},C.isOS=function(h){return this.getOSName(!0)===String(h).toLowerCase()},C.isPlatform=function(h){return this.getPlatformType(!0)===String(h).toLowerCase()},C.isEngine=function(h){return this.getEngineName(!0)===String(h).toLowerCase()},C.is=function(h,E){return E===void 0&&(E=!1),this.isBrowser(h,E)||this.isOS(h)||this.isPlatform(h)},C.some=function(h){var E=this;return h===void 0&&(h=[]),h.some(function(w){return E.is(w)})},b}();t.default=m,s.exports=t.default},92:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=e(17))&&r.__esModule?r:{default:r},a=/version\/(\d+(\.?_?\d+)+)/i,l=[{test:[/googlebot/i],describe:function(u){var f={name:"Googlebot"},m=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/opera/i],describe:function(u){var f={name:"Opera"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/opr\/|opios/i],describe:function(u){var f={name:"Opera"},m=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/SamsungBrowser/i],describe:function(u){var f={name:"Samsung Internet for Android"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/Whale/i],describe:function(u){var f={name:"NAVER Whale Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/MZBrowser/i],describe:function(u){var f={name:"MZ Browser"},m=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/focus/i],describe:function(u){var f={name:"Focus"},m=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/swing/i],describe:function(u){var f={name:"Swing"},m=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/coast/i],describe:function(u){var f={name:"Opera Coast"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(u){var f={name:"Opera Touch"},m=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/yabrowser/i],describe:function(u){var f={name:"Yandex Browser"},m=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/ucbrowser/i],describe:function(u){var f={name:"UC Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/Maxthon|mxios/i],describe:function(u){var f={name:"Maxthon"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/epiphany/i],describe:function(u){var f={name:"Epiphany"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/puffin/i],describe:function(u){var f={name:"Puffin"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/sleipnir/i],describe:function(u){var f={name:"Sleipnir"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/k-meleon/i],describe:function(u){var f={name:"K-Meleon"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/micromessenger/i],describe:function(u){var f={name:"WeChat"},m=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/qqbrowser/i],describe:function(u){var f={name:/qqbrowserlite/i.test(u)?"QQ Browser Lite":"QQ Browser"},m=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/msie|trident/i],describe:function(u){var f={name:"Internet Explorer"},m=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/\sedg\//i],describe:function(u){var f={name:"Microsoft Edge"},m=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/edg([ea]|ios)/i],describe:function(u){var f={name:"Microsoft Edge"},m=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/vivaldi/i],describe:function(u){var f={name:"Vivaldi"},m=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/seamonkey/i],describe:function(u){var f={name:"SeaMonkey"},m=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/sailfish/i],describe:function(u){var f={name:"Sailfish"},m=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,u);return m&&(f.version=m),f}},{test:[/silk/i],describe:function(u){var f={name:"Amazon Silk"},m=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/phantom/i],describe:function(u){var f={name:"PhantomJS"},m=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/slimerjs/i],describe:function(u){var f={name:"SlimerJS"},m=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var f={name:"BlackBerry"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var f={name:"WebOS Browser"},m=i.default.getFirstMatch(a,u)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/bada/i],describe:function(u){var f={name:"Bada"},m=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/tizen/i],describe:function(u){var f={name:"Tizen"},m=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/qupzilla/i],describe:function(u){var f={name:"QupZilla"},m=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(u){var f={name:"Firefox"},m=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/electron/i],describe:function(u){var f={name:"Electron"},m=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/MiuiBrowser/i],describe:function(u){var f={name:"Miui"},m=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/chromium/i],describe:function(u){var f={name:"Chromium"},m=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/chrome|crios|crmo/i],describe:function(u){var f={name:"Chrome"},m=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/GSA/i],describe:function(u){var f={name:"Google Search"},m=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){var f=!u.test(/like android/i),m=u.test(/android/i);return f&&m},describe:function(u){var f={name:"Android Browser"},m=i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/playstation 4/i],describe:function(u){var f={name:"PlayStation 4"},m=i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/safari|applewebkit/i],describe:function(u){var f={name:"Safari"},m=i.default.getFirstMatch(a,u);return m&&(f.version=m),f}},{test:[/.*/i],describe:function(u){var f=u.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(f,u),version:i.default.getSecondMatch(f,u)}}}];t.default=l,s.exports=t.default},93:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=e(17))&&r.__esModule?r:{default:r},a=e(18),l=[{test:[/Roku\/DVP/],describe:function(u){var f=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,u);return{name:a.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(u){var f=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(u){var f=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,u),m=i.default.getWindowsVersionName(f);return{name:a.OS_MAP.Windows,version:f,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(u){var f={name:a.OS_MAP.iOS},m=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,u);return m&&(f.version=m),f}},{test:[/macintosh/i],describe:function(u){var f=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,u).replace(/[_\s]/g,"."),m=i.default.getMacOSVersionName(f),b={name:a.OS_MAP.MacOS,version:f};return m&&(b.versionName=m),b}},{test:[/(ipod|iphone|ipad)/i],describe:function(u){var f=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,u).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:f}}},{test:function(u){var f=!u.test(/like android/i),m=u.test(/android/i);return f&&m},describe:function(u){var f=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,u),m=i.default.getAndroidVersionName(f),b={name:a.OS_MAP.Android,version:f};return m&&(b.versionName=m),b}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var f=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,u),m={name:a.OS_MAP.WebOS};return f&&f.length&&(m.version=f),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var f=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,u)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,u)||i.default.getFirstMatch(/\bbb(\d+)/i,u);return{name:a.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(u){var f=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(u){var f=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(u){var f=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,u);return{name:a.OS_MAP.PlayStation4,version:f}}}];t.default=l,s.exports=t.default},94:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=e(17))&&r.__esModule?r:{default:r},a=e(18),l=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(u){var f=i.default.getFirstMatch(/(can-l01)/i,u)&&"Nova",m={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(m.model=f),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){var f=u.test(/ipod|iphone/i),m=u.test(/like (ipod|iphone)/i);return f&&!m},describe:function(u){var f=i.default.getFirstMatch(/(ipod|iphone)/i,u);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName(!0)==="blackberry"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(u){return u.getBrowserName(!0)==="bada"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName()==="windows phone"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(u){var f=Number(String(u.getOSVersion()).split(".")[0]);return u.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(u){return u.getOSName(!0)==="android"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getOSName(!0)==="macos"},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(u){return u.getOSName(!0)==="windows"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="linux"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="playstation 4"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(u){return u.getOSName(!0)==="roku"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];t.default=l,s.exports=t.default},95:function(s,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=e(17))&&r.__esModule?r:{default:r},a=e(18),l=[{test:function(u){return u.getBrowserName(!0)==="microsoft edge"},describe:function(u){if(/\sedg\//i.test(u))return{name:a.ENGINE_MAP.Blink};var f=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,u);return{name:a.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(u){var f={name:a.ENGINE_MAP.Trident},m=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){return u.test(/presto/i)},describe:function(u){var f={name:a.ENGINE_MAP.Presto},m=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){var f=u.test(/gecko/i),m=u.test(/like gecko/i);return f&&!m},describe:function(u){var f={name:a.ENGINE_MAP.Gecko},m=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(u){var f={name:a.ENGINE_MAP.WebKit},m=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}}];t.default=l,s.exports=t.default}})})});var Gp={};Qh(Gp,{version:()=>dT});var dT,Wp=Iu(()=>{D();dT="lab"});var zp={};Qh(zp,{default:()=>hT});var hT,Vp=Iu(()=>{D();hT={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var jp=vt((Sa,Wu)=>{D();(function(t,e){typeof Sa=="object"&&typeof Wu=="object"?Wu.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Sa=="object"?Sa.Ably=e():t.Ably=e()})(window,function(){return function(s){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return s[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=s,e.c=t,e.d=function(r,i,a){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:a})},e.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(i&1&&(r=e(r)),i&8||i&4&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),i&2&&typeof r!="string")for(var l in r)e.d(a,l,function(u){return r[u]}.bind(null,l));return a},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=42)}([function(s,t,e){"use strict";e.r(t),e.d(t,"__extends",function(){return i}),e.d(t,"__assign",function(){return a}),e.d(t,"__rest",function(){return l}),e.d(t,"__decorate",function(){return u}),e.d(t,"__param",function(){return f}),e.d(t,"__metadata",function(){return m}),e.d(t,"__awaiter",function(){return b}),e.d(t,"__generator",function(){return C}),e.d(t,"__createBinding",function(){return h}),e.d(t,"__exportStar",function(){return E}),e.d(t,"__values",function(){return w}),e.d(t,"__read",function(){return x}),e.d(t,"__spread",function(){return S}),e.d(t,"__spreadArrays",function(){return O}),e.d(t,"__spreadArray",function(){return R}),e.d(t,"__await",function(){return g}),e.d(t,"__asyncGenerator",function(){return y}),e.d(t,"__asyncDelegator",function(){return d}),e.d(t,"__asyncValues",function(){return p}),e.d(t,"__makeTemplateObject",function(){return T}),e.d(t,"__importStar",function(){return I}),e.d(t,"__importDefault",function(){return U}),e.d(t,"__classPrivateFieldGet",function(){return z}),e.d(t,"__classPrivateFieldSet",function(){return W});var r=function(N,M){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,$){L.__proto__=$}||function(L,$){for(var G in $)Object.prototype.hasOwnProperty.call($,G)&&(L[G]=$[G])},r(N,M)};function i(N,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");r(N,M);function L(){this.constructor=N}N.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}var a=function(){return a=Object.assign||function(M){for(var L,$=1,G=arguments.length;$<G;$++){L=arguments[$];for(var J in L)Object.prototype.hasOwnProperty.call(L,J)&&(M[J]=L[J])}return M},a.apply(this,arguments)};function l(N,M){var L={};for(var $ in N)Object.prototype.hasOwnProperty.call(N,$)&&M.indexOf($)<0&&(L[$]=N[$]);if(N!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,$=Object.getOwnPropertySymbols(N);G<$.length;G++)M.indexOf($[G])<0&&Object.prototype.propertyIsEnumerable.call(N,$[G])&&(L[$[G]]=N[$[G]]);return L}function u(N,M,L,$){var G=arguments.length,J=G<3?M:$===null?$=Object.getOwnPropertyDescriptor(M,L):$,ee;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(N,M,L,$);else for(var re=N.length-1;re>=0;re--)(ee=N[re])&&(J=(G<3?ee(J):G>3?ee(M,L,J):ee(M,L))||J);return G>3&&J&&Object.defineProperty(M,L,J),J}function f(N,M){return function(L,$){M(L,$,N)}}function m(N,M){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(N,M)}function b(N,M,L,$){function G(J){return J instanceof L?J:new L(function(ee){ee(J)})}return new(L||(L=Promise))(function(J,ee){function re(k){try{P($.next(k))}catch(H){ee(H)}}function X(k){try{P($.throw(k))}catch(H){ee(H)}}function P(k){k.done?J(k.value):G(k.value).then(re,X)}P(($=$.apply(N,M||[])).next())})}function C(N,M){var L={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},$,G,J,ee;return ee={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function re(P){return function(k){return X([P,k])}}function X(P){if($)throw new TypeError("Generator is already executing.");for(;L;)try{if($=1,G&&(J=P[0]&2?G.return:P[0]?G.throw||((J=G.return)&&J.call(G),0):G.next)&&!(J=J.call(G,P[1])).done)return J;switch(G=0,J&&(P=[P[0]&2,J.value]),P[0]){case 0:case 1:J=P;break;case 4:return L.label++,{value:P[1],done:!1};case 5:L.label++,G=P[1],P=[0];continue;case 7:P=L.ops.pop(),L.trys.pop();continue;default:if(J=L.trys,!(J=J.length>0&&J[J.length-1])&&(P[0]===6||P[0]===2)){L=0;continue}if(P[0]===3&&(!J||P[1]>J[0]&&P[1]<J[3])){L.label=P[1];break}if(P[0]===6&&L.label<J[1]){L.label=J[1],J=P;break}if(J&&L.label<J[2]){L.label=J[2],L.ops.push(P);break}J[2]&&L.ops.pop(),L.trys.pop();continue}P=M.call(N,L)}catch(k){P=[6,k],G=0}finally{$=J=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}}var h=Object.create?function(N,M,L,$){$===void 0&&($=L),Object.defineProperty(N,$,{enumerable:!0,get:function(){return M[L]}})}:function(N,M,L,$){$===void 0&&($=L),N[$]=M[L]};function E(N,M){for(var L in N)L!=="default"&&!Object.prototype.hasOwnProperty.call(M,L)&&h(M,N,L)}function w(N){var M=typeof Symbol=="function"&&Symbol.iterator,L=M&&N[M],$=0;if(L)return L.call(N);if(N&&typeof N.length=="number")return{next:function(){return N&&$>=N.length&&(N=void 0),{value:N&&N[$++],done:!N}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(N,M){var L=typeof Symbol=="function"&&N[Symbol.iterator];if(!L)return N;var $=L.call(N),G,J=[],ee;try{for(;(M===void 0||M-- >0)&&!(G=$.next()).done;)J.push(G.value)}catch(re){ee={error:re}}finally{try{G&&!G.done&&(L=$.return)&&L.call($)}finally{if(ee)throw ee.error}}return J}function S(){for(var N=[],M=0;M<arguments.length;M++)N=N.concat(x(arguments[M]));return N}function O(){for(var N=0,M=0,L=arguments.length;M<L;M++)N+=arguments[M].length;for(var $=Array(N),G=0,M=0;M<L;M++)for(var J=arguments[M],ee=0,re=J.length;ee<re;ee++,G++)$[G]=J[ee];return $}function R(N,M,L){if(L||arguments.length===2)for(var $=0,G=M.length,J;$<G;$++)(J||!($ in M))&&(J||(J=Array.prototype.slice.call(M,0,$)),J[$]=M[$]);return N.concat(J||Array.prototype.slice.call(M))}function g(N){return this instanceof g?(this.v=N,this):new g(N)}function y(N,M,L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=L.apply(N,M||[]),G,J=[];return G={},ee("next"),ee("throw"),ee("return"),G[Symbol.asyncIterator]=function(){return this},G;function ee(j){$[j]&&(G[j]=function(te){return new Promise(function(fe,me){J.push([j,te,fe,me])>1||re(j,te)})})}function re(j,te){try{X($[j](te))}catch(fe){H(J[0][3],fe)}}function X(j){j.value instanceof g?Promise.resolve(j.value.v).then(P,k):H(J[0][2],j)}function P(j){re("next",j)}function k(j){re("throw",j)}function H(j,te){j(te),J.shift(),J.length&&re(J[0][0],J[0][1])}}function d(N){var M,L;return M={},$("next"),$("throw",function(G){throw G}),$("return"),M[Symbol.iterator]=function(){return this},M;function $(G,J){M[G]=N[G]?function(ee){return(L=!L)?{value:g(N[G](ee)),done:G==="return"}:J?J(ee):ee}:J}}function p(N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var M=N[Symbol.asyncIterator],L;return M?M.call(N):(N=typeof w=="function"?w(N):N[Symbol.iterator](),L={},$("next"),$("throw"),$("return"),L[Symbol.asyncIterator]=function(){return this},L);function $(J){L[J]=N[J]&&function(ee){return new Promise(function(re,X){ee=N[J](ee),G(re,X,ee.done,ee.value)})}}function G(J,ee,re,X){Promise.resolve(X).then(function(P){J({value:P,done:re})},ee)}}function T(N,M){return Object.defineProperty?Object.defineProperty(N,"raw",{value:M}):N.raw=M,N}var v=Object.create?function(N,M){Object.defineProperty(N,"default",{enumerable:!0,value:M})}:function(N,M){N.default=M};function I(N){if(N&&N.__esModule)return N;var M={};if(N!=null)for(var L in N)L!=="default"&&Object.prototype.hasOwnProperty.call(N,L)&&h(M,N,L);return v(M,N),M}function U(N){return N&&N.__esModule?N:{default:N}}function z(N,M,L,$){if(L==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof M=="function"?N!==M||!$:!M.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return L==="m"?$:L==="a"?$.call(N):$?$.value:M.get(N)}function W(N,M,L,$,G){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof M=="function"?N!==M||!G:!M.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?G.call(N,L):G?G.value=L:M.set(N,L),L}},function(s,t,e){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0}),t.allToUpperCase=t.allToLowerCase=t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfoOrPartialErrorInfo=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.toBase64=t.matchDerivedChannel=t.shallowEquals=t.getGlobalObject=t.getRetryTime=t.getJitterCoefficient=t.getBackoffCoefficient=void 0;var i=e(0),a=i.__importDefault(e(3)),l=i.__importStar(e(8)),u=i.__importDefault(e(4)),f=e(11),m=e(31);function b(q){return Math.floor(Math.random()*q.length)}function C(q){for(var oe=[],ue=1;ue<arguments.length;ue++)oe[ue-1]=arguments[ue];for(var ye=0;ye<oe.length;ye++){var Ne=oe[ye];if(!Ne)break;var St=Object.prototype.hasOwnProperty;for(var xn in Ne)(!St||St.call(Ne,xn))&&(q[xn]=Ne[xn])}return q}t.mixin=C;function h(q){return C({},q)}t.copy=h,t.isArray=Array.isArray||function(q){return Object.prototype.toString.call(q)=="[object Array]"};function E(q){return O(q)?[]:(0,t.isArray)(q)?q:[q]}t.ensureArray=E;function w(q){return Object.prototype.toString.call(q)=="[object Object]"}t.isObject=w;function x(q){for(var oe in q)return!1;return!0}t.isEmpty=x;function S(q,oe){for(var ue in q)if(ue!==oe)return!1;return!0}t.isOnlyPropIn=S;function O(q){return q==null}t.isEmptyArg=O;function R(q){var oe=new Object;for(var ue in q)oe[ue]=q[ue];return oe}t.shallowClone=R;function g(q,oe){var ue=function(){function Ne(){}return Ne}();ue.prototype=q;var ye=new ue;return oe&&C(ye,oe),ye}t.prototypicalClone=g;var y=function(q,oe){if(a.default.Config.inherits){a.default.Config.inherits(q,oe);return}q.super_=oe,q.prototype=g(oe.prototype,{constructor:q})};t.inherits=y;function d(q,oe){for(var ue in q)if(q[ue]==oe)return!0;return!1}t.containsValue=d;function p(q,oe){return(0,t.isArray)(oe)?T(q,oe):v(q,oe)}t.intersect=p;function T(q,oe){for(var ue=[],ye=0;ye<q.length;ye++){var Ne=q[ye];(0,t.arrIndexOf)(oe,Ne)!=-1&&ue.push(Ne)}return ue}t.arrIntersect=T;function v(q,oe){for(var ue=[],ye=0;ye<q.length;ye++){var Ne=q[ye];Ne in oe&&ue.push(Ne)}return ue}t.arrIntersectOb=v;function I(q,oe){for(var ue=[],ye=0;ye<q.length;ye++){var Ne=q[ye];(0,t.arrIndexOf)(oe,Ne)==-1&&ue.push(Ne)}return ue}t.arrSubtract=I,t.arrIndexOf=Array.prototype.indexOf?function(q,oe,ue){return q.indexOf(oe,ue)}:function(q,oe,ue){ue=ue||0;for(var ye=q.length;ue<ye;ue++)if(q[ue]===oe)return ue;return-1};function U(q,oe){return(0,t.arrIndexOf)(q,oe)!==-1}t.arrIn=U;function z(q,oe){var ue=(0,t.arrIndexOf)(q,oe),ye=ue!=-1;return ye&&q.splice(ue,1),ye}t.arrDeleteValue=z;function W(q,oe){var ue=q.slice();return z(ue,oe),ue}t.arrWithoutValue=W;function N(q,oe){var ue=[];for(var ye in q)oe&&!Object.prototype.hasOwnProperty.call(q,ye)||ue.push(ye);return ue}t.keysArray=N;function M(q,oe){var ue=[];for(var ye in q)oe&&!Object.prototype.hasOwnProperty.call(q,ye)||ue.push(q[ye]);return ue}t.valuesArray=M;function L(q,oe){for(var ue in q)Object.prototype.hasOwnProperty.call(q,ue)&&q[ue]&&oe(ue)}t.forInOwnNonNullProperties=L,t.arrForEach=Array.prototype.forEach?function(q,oe){q.forEach(oe)}:function(q,oe){for(var ue=q.length,ye=0;ye<ue;ye++)oe(q[ye],ye,q)};function $(q,oe){return(0,t.arrForEach)(q.slice(),oe)}t.safeArrForEach=$,t.arrMap=Array.prototype.map?function(q,oe){return q.map(oe)}:function(q,oe){for(var ue=[],ye=q.length,Ne=0;Ne<ye;Ne++)ue.push(oe(q[Ne],Ne,q));return ue},t.arrFilter=Array.prototype.filter?function(q,oe){return q.filter(oe)}:function(q,oe){for(var ue=[],ye=q.length,Ne=0;Ne<ye;Ne++)oe(q[Ne])&&ue.push(q[Ne]);return ue},t.arrEvery=Array.prototype.every?function(q,oe){return q.every(oe)}:function(q,oe){for(var ue=q.length,ye=0;ye<ue;ye++)if(!oe(q[ye],ye,q))return!1;return!0};function G(q,oe){if(q.length===0)return!0;var ue=q[0][oe];return(0,t.arrEvery)(q,function(ye){return ye[oe]===ue})}t.allSame=G;var J={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function ee(q,oe){var ue=J[oe||Ze.json];return{accept:ue,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}t.defaultGetHeaders=ee;function re(q,oe){var ue,ye=ue=J[oe||Ze.json];return{accept:ye,"content-type":ue,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}t.defaultPostHeaders=re;function X(q){return q.splice(b(q),1)[0]}t.arrPopRandomElement=X;function P(q){var oe=[];if(q)for(var ue in q)oe.push(encodeURIComponent(ue)+"="+encodeURIComponent(q[ue]));return oe.length?"?"+oe.join("&"):""}t.toQueryString=P;function k(q){for(var oe,ue=/([^?&=]+)=?([^&]*)/g,ye={};oe=ue.exec(q);)ye[decodeURIComponent(oe[1])]=decodeURIComponent(oe[2]);return ye}t.parseQueryString=k,t.now=Date.now||function(){return new Date().getTime()};function H(q){return typeof q=="object"&&q!==null&&(q.constructor.name=="ErrorInfo"||q.constructor.name=="PartialErrorInfo")}t.isErrorInfoOrPartialErrorInfo=H;function j(q){var oe,ue;return q instanceof Error||((oe=q==null?void 0:q.constructor)===null||oe===void 0?void 0:oe.name)==="ErrorInfo"||((ue=q==null?void 0:q.constructor)===null||ue===void 0?void 0:ue.name)==="PartialErrorInfo"?q.toString():a.default.Config.inspect(q)}t.inspectError=j;function te(q){return a.default.BufferUtils.isBuffer(q)?q.toString():typeof q=="string"?q:a.default.Config.inspect(q)}t.inspectBody=te;function fe(q){if(a.default.BufferUtils.isBuffer(q))return a.default.BufferUtils.byteLength(q);if(typeof q=="string")return a.default.Config.stringByteSize(q);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof q)}t.dataSizeBytes=fe;function me(){return String(Math.random()).substr(2)}t.cheapRandStr=me;var Ee=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(q);return a.default.Config.getRandomValues(oe),a.default.BufferUtils.base64Encode(oe)}for(var ue=a.default.BufferUtils.base64CharSet,ye=Math.round(q*4/3),Ne="",St=0;St<ye;St++)Ne+=ue[b(ue)];return Ne};t.randomString=Ee;var Se=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(q);return a.default.Config.getRandomValues(oe),a.default.BufferUtils.hexEncode(oe)}for(var ue=a.default.BufferUtils.hexCharSet,ye=q*2,Ne="",St=0;St<ye;St++)Ne+=ue[b(ue)];return Ne};t.randomHexString=Se;function ze(q,oe){for(var ue=Math.min(oe,q.length),ye=q.slice(),Ne=[],St=0;St<ue;St++)Ne.push(X(ye));return Ne}t.arrChooseN=ze,t.trim=String.prototype.trim?function(q){return q.trim()}:function(q){return q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function de(q,oe,ue){return new Promise(function(ye,Ne){q[oe].apply(q,i.__spreadArray(i.__spreadArray([],ue,!1),[function(St,xn){St?Ne(St):ye(xn)}],!1))})}t.promisify=de;var Ze;(function(q){q.msgpack="msgpack",q.json="json"})(Ze=t.Format||(t.Format={}));function bt(q,oe){return oe=="msgpack"?a.default.Config.msgpack.decode(q):JSON.parse(String(q))}t.decodeBody=bt;function ot(q,oe){return oe=="msgpack"?a.default.Config.msgpack.encode(q,!0):JSON.stringify(q)}t.encodeBody=ot;function ht(q){return q.map(function(oe){return oe&&oe.toLowerCase()})}t.allToLowerCase=ht;function un(q){return q.map(function(oe){return oe&&oe.toUpperCase()})}t.allToUpperCase=un;function yn(q){return Math.min((q+2)/3,2)}t.getBackoffCoefficient=yn;function lt(){return 1-Math.random()*.2}t.getJitterCoefficient=lt;function bn(q,oe){return q*yn(oe)*lt()}t.getRetryTime=bn;function Vn(){return r||(typeof window!="undefined"?window:self)}t.getGlobalObject=Vn;function Qi(q,oe){return Object.keys(q).every(function(ue){return q[ue]===oe[ue]})&&Object.keys(oe).every(function(ue){return oe[ue]===q[ue]})}t.shallowEquals=Qi;function dr(q){var oe=/^(\[([^?]*)(?:(.*))\])?(.+)$/,ue=q.match(oe);if(!ue||!ue.length||ue.length<5)throw new u.default("regex match failed",400,40010);if(ue[2])throw new u.default("cannot use a derived option with a ".concat(ue[2]," channel"),400,40010);return{qualifierParam:ue[3]||"",channelName:ue[4]}}t.matchDerivedChannel=dr;function ul(q){return a.default.Config.createHmac?Buffer.from(q,"ascii").toString("base64"):(0,f.stringify)((0,m.parse)(q))}t.toBase64=ul}).call(this,e(13))},function(s,t,e){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),a=i.__importDefault(e(3)),l=r||(typeof window!="undefined"?window:self),u;(function(h){h[h.None=0]="None",h[h.Error=1]="Error",h[h.Major=2]="Major",h[h.Minor=3]="Minor",h[h.Micro=4]="Micro"})(u||(u={}));function f(h,E){return"".concat(h).padStart(E?3:2,"0")}function m(h){return a.default.Config.logTimestamps?function(E){var w=new Date;h(f(w.getHours())+":"+f(w.getMinutes())+":"+f(w.getSeconds())+"."+f(w.getMilliseconds(),1)+" "+E)}:h}var b=function(){var h,E,w,x;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((E=(h=l==null?void 0:l.console)===null||h===void 0?void 0:h.log)===null||E===void 0?void 0:E.apply)=="function"?(w=function(){for(var S=[],O=0;O<arguments.length;O++)S[O]=arguments[O]},x=console.warn?function(){for(var S=[],O=0;O<arguments.length;O++)S[O]=arguments[O]}:w):l!=null&&l.console.log?w=x=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=x=function(){},[w,x].map(m)},C=function(){function h(){h.logLevel=h.LOG_DEFAULT}return h.initLogHandlers=function(){var E=b(),w=E[0],x=E[1];this.logHandler=w,this.logErrorHandler=x},h.logLevel=u.Error,h.LOG_NONE=u.None,h.LOG_ERROR=u.Error,h.LOG_MAJOR=u.Major,h.LOG_MINOR=u.Minor,h.LOG_MICRO=u.Micro,h.LOG_DEFAULT=u.Error,h.LOG_DEBUG=u.Micro,h.logAction=function(E,w,x){h.shouldLog(E)&&(E===u.Error?h.logErrorHandler:h.logHandler)("Ably: "+w+": "+x)},h.deprecated=function(E,w){h.deprecatedWithMsg(E,"Please use '"+w+"' instead.")},h.deprecatedWithMsg=function(E,w){h.shouldLog(u.Error)&&h.logErrorHandler("Ably: Deprecation warning - '"+E+"' is deprecated and will be removed from a future version. "+w)},h.shouldLog=function(E){return E<=h.logLevel},h.setLog=function(E,w){E!==void 0&&(h.logLevel=E),w!==void 0&&(h.logHandler=h.logErrorHandler=w)},h}();t.default=C}).call(this,e(13))},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){}return i}();t.default=r},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartialErrorInfo=void 0;var r=e(0),i=r.__importDefault(e(3)),a=r.__importStar(e(1));function l(m){var b="["+m.constructor.name;return m.message&&(b+=": "+m.message),m.statusCode&&(b+="; statusCode="+m.statusCode),m.code&&(b+="; code="+m.code),m.cause&&(b+="; cause="+a.inspectError(m.cause)),m.href&&!(m.message&&m.message.indexOf("help.ably.io")>-1)&&(b+="; see "+m.href+" "),b+="]",b}var u=function(m){r.__extends(b,m);function b(C,h,E,w){var x=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(x,b.prototype),x.code=h,x.statusCode=E,x.cause=w,x}return b.prototype.toString=function(){return l(this)},b.fromValues=function(C){var h=C,E=h.message,w=h.code,x=h.statusCode;if(typeof E!="string"||typeof w!="number"||typeof x!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(C));var S=Object.assign(new b(E,w,x),C);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S},b}(Error);t.default=u;var f=function(m){r.__extends(b,m);function b(C,h,E,w){var x=m.call(this,C)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(x,b.prototype),x.code=h,x.statusCode=E,x.cause=w,x}return b.prototype.toString=function(){return l(this)},b}(Error);t.PartialErrorInfo=f},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(){if(typeof ArrayBuffer=="function"){var i=r,a=i.lib,l=a.WordArray,u=l.init,f=l.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var b=m.byteLength,C=[],h=0;h<b;h++)C[h>>>2]|=m[h]<<24-h%4*8;u.call(this,C,b)}else u.apply(this,arguments)};f.prototype=l}}(),r.lib.WordArray})},function(s,t,e){(function(r){(function(i,a){s.exports=t=a()})(this,function(){var i=i||function(a,l){var u;if(typeof window!="undefined"&&window.crypto&&(u=window.crypto),!u&&typeof window!="undefined"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof r!="undefined"&&r.crypto&&(u=r.crypto),!u)try{u=e(44)}catch(d){}var f=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch(d){}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch(d){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function d(){}return function(p){var T;return d.prototype=p,T=new d,d.prototype=null,T}}(),b={},C=b.lib={},h=C.Base=function(){return{extend:function(d){var p=m(this);return d&&p.mixIn(d),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var p in d)d.hasOwnProperty(p)&&(this[p]=d[p]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=C.WordArray=h.extend({init:function(d,p){d=this.words=d||[],p!=l?this.sigBytes=p:this.sigBytes=d.length*4},toString:function(d){return(d||x).stringify(this)},concat:function(d){var p=this.words,T=d.words,v=this.sigBytes,I=d.sigBytes;if(this.clamp(),v%4)for(var U=0;U<I;U++){var z=T[U>>>2]>>>24-U%4*8&255;p[v+U>>>2]|=z<<24-(v+U)%4*8}else for(var U=0;U<I;U+=4)p[v+U>>>2]=T[U>>>2];return this.sigBytes+=I,this},clamp:function(){var d=this.words,p=this.sigBytes;d[p>>>2]&=4294967295<<32-p%4*8,d.length=a.ceil(p/4)},clone:function(){var d=h.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var p=[],T=0;T<d;T+=4)p.push(f());return new E.init(p,d)}}),w=b.enc={},x=w.Hex={stringify:function(d){for(var p=d.words,T=d.sigBytes,v=[],I=0;I<T;I++){var U=p[I>>>2]>>>24-I%4*8&255;v.push((U>>>4).toString(16)),v.push((U&15).toString(16))}return v.join("")},parse:function(d){for(var p=d.length,T=[],v=0;v<p;v+=2)T[v>>>3]|=parseInt(d.substr(v,2),16)<<24-v%8*4;return new E.init(T,p/2)}},S=w.Latin1={stringify:function(d){for(var p=d.words,T=d.sigBytes,v=[],I=0;I<T;I++){var U=p[I>>>2]>>>24-I%4*8&255;v.push(String.fromCharCode(U))}return v.join("")},parse:function(d){for(var p=d.length,T=[],v=0;v<p;v++)T[v>>>2]|=(d.charCodeAt(v)&255)<<24-v%4*8;return new E.init(T,p)}},O=w.Utf8={stringify:function(d){try{return decodeURIComponent(escape(S.stringify(d)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(d){return S.parse(unescape(encodeURIComponent(d)))}},R=C.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=O.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var p,T=this._data,v=T.words,I=T.sigBytes,U=this.blockSize,z=U*4,W=I/z;d?W=a.ceil(W):W=a.max((W|0)-this._minBufferSize,0);var N=W*U,M=a.min(N*4,I);if(N){for(var L=0;L<N;L+=U)this._doProcessBlock(v,L);p=v.splice(0,N),T.sigBytes-=M}return new E.init(p,M)},clone:function(){var d=h.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0}),g=C.Hasher=R.extend({cfg:h.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(d){return function(p,T){return new d.init(T).finalize(p)}},_createHmacHelper:function(d){return function(p,T){return new y.HMAC.init(d,T).finalize(p)}}}),y=b.algo={};return b}(Math);return i})}).call(this,e(13))},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(2)),l=r.__importDefault(e(3));function u(b,C,h){try{C.apply(b,h)}catch(E){a.default.logAction(a.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function f(b,C,h){for(var E,w,x,S=0;S<b.length;S++)if(E=b[S],h&&(E=E[h]),i.isArray(E)){for(;(w=i.arrIndexOf(E,C))!==-1;)E.splice(w,1);h&&E.length===0&&delete b[S][h]}else if(i.isObject(E))for(x in E)Object.prototype.hasOwnProperty.call(E,x)&&i.isArray(E[x])&&f([E],C,x)}var m=function(){function b(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return b.prototype.on=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];if(h.length===1){var w=h[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h))}if(h.length===2){var x=h[0],S=h[1];if(typeof S!="function")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));if(i.isEmptyArg(x))this.any.push(S);else if(i.isArray(x))x.forEach(function(R){C.on(R,S)});else{if(typeof x!="string")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));var O=this.events[x]||(this.events[x]=[]);O.push(S)}}},b.prototype.off=function(){for(var C,h=this,E=[],w=0;w<arguments.length;w++)E[w]=arguments[w];if(E.length==0||i.isEmptyArg(E[0])&&i.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var x=E[0],S=E[1],O=null,R=null;if(E.length===1||!S)typeof x=="function"?O=x:R=x;else{if(typeof S!="function")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(E));C=[x,S],R=C[0],O=C[1]}if(O&&i.isEmptyArg(R)){f([this.any,this.events,this.anyOnce,this.eventsOnce],O);return}if(i.isArray(R)){R.forEach(function(g){h.off(g,O)});return}if(typeof R!="string")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(E));O?f([this.events,this.eventsOnce],O,R):(delete this.events[R],delete this.eventsOnce[R])},b.prototype.listeners=function(C){if(C){var h=this.events[C]||[];return this.eventsOnce[C]&&Array.prototype.push.apply(h,this.eventsOnce[C]),h.length?h:null}return this.any.length?this.any:null},b.prototype.emit=function(C){for(var h=[],E=1;E<arguments.length;E++)h[E-1]=arguments[E];var w={event:C},x=[];this.anyOnce.length&&(Array.prototype.push.apply(x,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(x,this.any);var S=this.eventsOnce[C];S&&(Array.prototype.push.apply(x,S),delete this.eventsOnce[C]);var O=this.events[C];O&&Array.prototype.push.apply(x,O),i.arrForEach(x,function(R){u(w,R,h)})},b.prototype.once=function(){for(var C=this,h=[],E=0;E<arguments.length;E++)h[E]=arguments[E];var w=h.length;if((w===0||w===1&&typeof h[0]!="function")&&l.default.Config.Promise){var x=h[0];return new l.default.Config.Promise(function(d){C.once(x,d)})}var S=h[0],O=h[1];if(h.length===1&&typeof S=="function")this.anyOnce.push(S);else if(i.isEmptyArg(S)){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));this.anyOnce.push(O)}else if(i.isArray(S)){var R=this,g=function(){var d=Array.prototype.slice.call(arguments);if(i.arrForEach(S,function(p){R.off(p,g)}),typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));O.apply(this,d)};i.arrForEach(S,function(d){R.on(d,g)})}else{if(typeof S!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));var y=this.eventsOnce[S]||(this.eventsOnce[S]=[]);if(O){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));y.push(O)}}},b.prototype.whenState=function(C,h,E){for(var w=this,x=[],S=3;S<arguments.length;S++)x[S-3]=arguments[S];var O={event:C};if(typeof C!="string"||typeof h!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&l.default.Config.Promise)return new l.default.Config.Promise(function(R){b.prototype.whenState.apply(w,[C,h,R].concat(x))});C===h?u(O,E,x):this.once(C,E)},b}();t.default=m},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=t.normaliseOptions=t.objectifyOptions=t.getAgentString=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var r=e(0),i=r.__importDefault(e(3)),a=r.__importStar(e(1)),l=r.__importDefault(e(2)),u=r.__importDefault(e(4)),f=e(43),m="ably-js/"+f.version,b={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:f.version,protocolVersion:2,agent:m,getHost:C,getPort:h,getHttpScheme:E,environmentFallbackHosts:w,getFallbackHosts:x,getHosts:S,checkHost:O,objectifyOptions:d,normaliseOptions:p};function C(v,I,U){return U?I=I==v.restHost&&v.realtimeHost||I||v.realtimeHost:I=I||v.restHost,I}t.getHost=C;function h(v,I){return I||v.tls?v.tlsPort:v.port}t.getPort=h;function E(v){return v.tls?"https://":"http://"}t.getHttpScheme=E;function w(v){return[v+"-a-fallback.ably-realtime.com",v+"-b-fallback.ably-realtime.com",v+"-c-fallback.ably-realtime.com",v+"-d-fallback.ably-realtime.com",v+"-e-fallback.ably-realtime.com"]}t.environmentFallbackHosts=w;function x(v){var I=v.fallbackHosts,U=typeof v.httpMaxRetryCount!="undefined"?v.httpMaxRetryCount:b.httpMaxRetryCount;return I?a.arrChooseN(I,U):[]}t.getFallbackHosts=x;function S(v){return[v.restHost].concat(x(v))}t.getHosts=S;function O(v){if(typeof v!="string")throw new u.default("host must be a string; was a "+typeof v,4e4,400);if(!v.length)throw new u.default("host must not be zero-length",4e4,400)}function R(v,I,U){return v.realtimeHost?v.realtimeHost:v.restHost?(l.default.logAction(l.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+v.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+v.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),v.restHost):I?b.REALTIME_HOST:U+"-"+b.REALTIME_HOST}function g(v){var I={};for(var U in b.TIMEOUTS)I[U]=v[U]||b.TIMEOUTS[U];return I}function y(v){var I=b.agent;if(v.agents)for(var U in v.agents)I+=" "+U+"/"+v.agents[U];return I}t.getAgentString=y;function d(v){return typeof v=="string"?v.indexOf(":")==-1?{token:v}:{key:v}:v}t.objectifyOptions=d;function p(v){if(v.host&&(l.default.deprecated("host","restHost"),v.restHost=v.host),v.wsHost&&(l.default.deprecated("wsHost","realtimeHost"),v.realtimeHost=v.wsHost),v.queueEvents&&(l.default.deprecated("queueEvents","queueMessages"),v.queueMessages=v.queueEvents),v.fallbackHostsUseDefault){if(v.fallbackHosts){var I="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}if(v.port||v.tlsPort){var I="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",I),new u.default(I,4e4,400)}v.environment?l.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):l.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),v.fallbackHosts=b.FALLBACK_HOSTS}v.recover===!0&&(l.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),v.recover=function(X,P){P(!0)}),typeof v.recover=="function"&&v.closeOnUnload===!0&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),v.recover=void 0),"closeOnUnload"in v||(v.closeOnUnload=!v.recover),v.transports&&a.arrIn(v.transports,"xhr")&&(l.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),a.arrDeleteValue(v.transports,"xhr"),v.transports.push("xhr_streaming")),"queueMessages"in v||(v.queueMessages=!0);var U=v.environment&&String(v.environment).toLowerCase()||b.ENVIRONMENT,z=!U||U==="production";!v.fallbackHosts&&!v.restHost&&!v.realtimeHost&&!v.port&&!v.tlsPort&&(v.fallbackHosts=z?b.FALLBACK_HOSTS:w(U));var W=v.restHost||(z?b.REST_HOST:U+"-"+b.REST_HOST),N=R(v,z,U);a.arrForEach((v.fallbackHosts||[]).concat(W,N),O),v.port=v.port||b.PORT,v.tlsPort=v.tlsPort||b.TLS_PORT,"tls"in v||(v.tls=!0);var M=g(v);if("useBinaryProtocol"in v?v.useBinaryProtocol=i.default.Config.supportsBinary&&v.useBinaryProtocol:v.useBinaryProtocol=i.default.Config.preferBinary,v.clientId){var L=v.headers=v.headers||{};L["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(v.clientId))}"idempotentRestPublishing"in v||(v.idempotentRestPublishing=!0),v.promises&&!i.default.Config.Promise&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),v.promises=!1);var $=null,G=v.connectivityCheckUrl;if(v.connectivityCheckUrl){var J=v.connectivityCheckUrl.split("?"),ee=J[0],re=J[1];$=re?a.parseQueryString(re):{},ee.indexOf("://")===-1&&(ee="https://"+ee),G=ee}return r.__assign(r.__assign({},v),{useBinaryProtocol:"useBinaryProtocol"in v?i.default.Config.supportsBinary&&v.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:N,restHost:W,maxMessageSize:v.maxMessageSize||b.maxMessageSize,timeouts:M,connectivityCheckParams:$,connectivityCheckUrl:G})}t.normaliseOptions=p,t.default=b;function T(v){return Object.assign(b,v)}t.getDefaults=T},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(3)),a=r.__importDefault(e(2)),l=r.__importDefault(e(4)),u=r.__importStar(e(1));function f(h){return!h||!h.channelOptions?{channelOptions:h,plugins:{},baseEncodedPreviousPayload:void 0}:h}function m(h){if(h&&h.cipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=i.default.Crypto.getCipher(h.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return h!=null?h:{}}function b(h){var E=0;return h.name&&(E+=h.name.length),h.clientId&&(E+=h.clientId.length),h.extras&&(E+=JSON.stringify(h.extras).length),h.data&&(E+=u.dataSizeBytes(h.data)),E}var C=function(){function h(){}return h.prototype.toJSON=function(){var E=this.encoding,w=this.data;return w&&i.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(E=E?E+"/base64":"base64",w=i.default.BufferUtils.base64Encode(w)):w=i.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:w}},h.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},h.encrypt=function(E,w,x){var S=E.data,O=E.encoding,R=w.channelCipher;O=O?O+"/":"",i.default.BufferUtils.isBuffer(S)||(S=i.default.BufferUtils.utf8Encode(String(S)),O=O+"utf-8/"),R.encrypt(S,function(g,y){if(g){x(g);return}E.data=y,E.encoding=O+"cipher+"+R.algorithm,x(null,E)})},h.encode=function(E,w,x){var S=E.data,O=typeof S=="string"||i.default.BufferUtils.isBuffer(S)||S===null||S===void 0;if(!O)if(u.isObject(S)||u.isArray(S))E.data=JSON.stringify(S),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new l.default("Data type is unsupported",40013,400);w!=null&&w.cipher?h.encrypt(E,w,x):x(null,E)},h.encodeArray=function(E,w,x){for(var S=0,O=0;O<E.length;O++)h.encode(E[O],w,function(R){if(R){x(R);return}S++,S==E.length&&x(null,E)})},h.decode=function(E,w){var x=f(w),S=E.data,O=E.encoding;if(O){var R=O.split("/"),g=void 0,y=R.length,d=E.data,p="";try{for(;(g=y)>0;){var T=R[--y].match(/([-\w]+)(\+([\w-]+))?/);if(!T)break;switch(p=T[1],p){case"base64":d=i.default.BufferUtils.base64Decode(String(d)),g==R.length&&(S=d);continue;case"utf-8":d=i.default.BufferUtils.utf8Decode(d);continue;case"json":d=JSON.parse(d);continue;case"cipher":if(x.channelOptions!=null&&x.channelOptions.cipher&&x.channelOptions.channelCipher){var v=T[3],I=x.channelOptions.channelCipher;if(v!=I.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");d=I.decrypt(d);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!x.plugins||!x.plugins.vcdiff)throw new l.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new l.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var U=x.baseEncodedPreviousPayload;typeof U=="string"&&(U=i.default.BufferUtils.utf8Encode(U)),U=i.default.BufferUtils.toBuffer(U),d=i.default.BufferUtils.toBuffer(d),d=i.default.BufferUtils.typedArrayToBuffer(x.plugins.vcdiff.decode(d,U)),S=d}catch(W){throw new l.default("Vcdiff delta decode failed with "+W,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(W){var z=W;throw new l.default("Error processing the "+p+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{E.encoding=g<=0?null:R.slice(0,g).join("/"),E.data=d}}x.baseEncodedPreviousPayload=S},h.fromResponseBody=function(E,w,x){x&&(E=u.decodeBody(E,x));for(var S=0;S<E.length;S++){var O=E[S]=h.fromValues(E[S]);try{h.decode(O,w)}catch(R){a.default.logAction(a.default.LOG_ERROR,"Message.fromResponseBody()",R.toString())}}return E},h.fromValues=function(E){return Object.assign(new h,E)},h.fromValuesArray=function(E){for(var w=E.length,x=new Array(w),S=0;S<w;S++)x[S]=h.fromValues(E[S]);return x},h.fromEncoded=function(E,w){var x=h.fromValues(E),S=m(w!=null?w:null);try{h.decode(x,S)}catch(O){a.default.logAction(a.default.LOG_ERROR,"Message.fromEncoded()",O.toString())}return x},h.fromEncodedArray=function(E,w){return E.map(function(x){return h.fromEncoded(x,w)})},h.getMessagesSize=function(E){for(var w,x=0,S=0;S<E.length;S++)w=E[S],x+=w.size||(w.size=b(w));return x},h.serialize=u.encodeBody,h}();t.default=C},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(4)),l=r.__importDefault(e(9)),u=r.__importDefault(e(15)),f={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},m=[];Object.keys(f).forEach(function(x){m[f[x]]=x});var b={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},C=Object.keys(b);b.MODE_ALL=b.PRESENCE|b.PUBLISH|b.SUBSCRIBE|b.PRESENCE_SUBSCRIBE;function h(x){var S=[];if(x)for(var O=0;O<x.length;O++)S.push(x[O].toString());return"[ "+S.join(", ")+" ]"}var E="id channel channelSerial connectionId count msgSerial timestamp".split(" "),w=function(){function x(){var S=this;this.hasFlag=function(O){return(S.flags&b[O])>0}}return x.prototype.setFlag=function(S){return this.flags=this.flags|b[S]},x.prototype.getMode=function(){return this.flags&&this.flags&b.MODE_ALL},x.prototype.encodeModesToFlags=function(S){var O=this;S.forEach(function(R){return O.setFlag(R)})},x.prototype.decodeModesFromFlags=function(){var S=this,O=[];return x.channelModes.forEach(function(R){S.hasFlag(R)&&O.push(R)}),O.length>0?O:void 0},x.fromValues=function(S){return Object.assign(new x,S)},x.Action=f,x.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],x.ActionName=m,x.serialize=i.encodeBody,x.deserialize=function(S,O){var R=i.decodeBody(S,O);return x.fromDeserialized(R)},x.fromDeserialized=function(S){var O=S.error;O&&(S.error=a.default.fromValues(O));var R=S.messages;if(R)for(var g=0;g<R.length;g++)R[g]=l.default.fromValues(R[g]);var y=S.presence;if(y)for(var g=0;g<y.length;g++)y[g]=u.default.fromValues(y[g],!0);return Object.assign(new x,S)},x.stringify=function(S){var O="[ProtocolMessage";S.action!==void 0&&(O+="; action="+x.ActionName[S.action]||!1);for(var R,g=0;g<E.length;g++)R=E[g],S[R]!==void 0&&(O+="; "+R+"="+S[R]);if(S.messages&&(O+="; messages="+h(l.default.fromValuesArray(S.messages))),S.presence&&(O+="; presence="+h(u.default.fromValuesArray(S.presence))),S.error&&(O+="; error="+a.default.fromValues(S.error).toString()),S.auth&&S.auth.accessToken&&(O+="; token="+S.auth.accessToken),S.flags&&(O+="; flags="+C.filter(S.hasFlag).join(",")),S.params){var y="";i.forInOwnNonNullProperties(S.params,function(d){y.length>0&&(y+="; "),y+=d+"="+S.params[d]}),y.length>0&&(O+="; params=["+y+"]")}return O+="]",O},x}();t.default=w},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=i.enc,f=u.Base64={stringify:function(b){var C=b.words,h=b.sigBytes,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.clamp();for(var w=[],x=0;x<h;x+=3)for(var S=C[x>>>2]>>>24-x%4*8&255,O=C[x+1>>>2]>>>24-(x+1)%4*8&255,R=C[x+2>>>2]>>>24-(x+2)%4*8&255,g=S<<16|O<<8|R,y=0;y<4&&x+y*.75<h;y++)w.push(E.charAt(g>>>6*(3-y)&63));var d=E.charAt(64);if(d)for(;w.length%4;)w.push(d);return w.join("")},parse:function(b){var C=b.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var w=0;w<h.length;w++)E[h.charCodeAt(w)]=w}var x=h.charAt(64);if(x){var S=b.indexOf(x);S!==-1&&(C=S)}return m(b,C,E)}};function m(b,C,h){for(var E=[],w=0,x=0;x<C;x++)if(x%4){var S=h[b.charCodeAt(x-1)]<<x%4*2,O=h[b.charCodeAt(x)]>>>6-x%4*2,R=S|O;E[w>>>2]|=R<<24-w%4*8,w++}return l.create(E,w)}}(),r.enc.Base64})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(10)),l=r.__importDefault(e(26)),u=r.__importDefault(e(2)),f=r.__importDefault(e(8)),m=r.__importDefault(e(20)),b=r.__importDefault(e(17)),C=r.__importDefault(e(4)),h=r.__importDefault(e(21)),E=r.__importDefault(e(3));function w(O){var R=[80015,80017,80030];return O.code?b.default.isTokenErr(O)?!1:i.arrIn(R,O.code)?!0:O.code>=4e4&&O.code<5e4:!1}function x(O){return w(O)?[a.default.fromValues({action:a.default.Action.ERROR,error:O})]:[a.default.fromValues({action:a.default.Action.DISCONNECTED,error:O})]}var S=function(O){r.__extends(R,O);function R(g,y,d){var p=O.call(this,g,y,d,!0)||this;return p.onAuthUpdated=function(T){p.authParams={access_token:T.token}},p.stream="stream"in d?d.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return R.prototype.connect=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","starting"),l.default.prototype.connect.call(this);var y=this.params,d=y.options,p=f.default.getHost(d,y.host),T=f.default.getPort(d),v=d.tls?"https://":"http://";this.baseUri=v+p+":"+T+"/comet/";var I=this.baseUri+"connect";u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","uri: "+I),this.auth.getAuthParams(function(U,z){if(U){g.disconnect(U);return}if(!g.isDisposed){g.authParams=z;var W=g.params.getConnectParams(z);"stream"in W&&(g.stream=W.stream),u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(W));var N=!1,M=g.recvRequest=g.createRequest(I,null,W,null,g.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV);M.on("data",function(L){!g.recvRequest||(N||(N=!0,g.emit("preconnect")),g.onData(L))}),M.on("complete",function(L){if(g.recvRequest||(L=L||new C.default("Request cancelled",80003,400)),g.recvRequest=null,!N&&!L&&(N=!0,g.emit("preconnect")),g.onActivity(),L){L.code?g.onData(x(L)):g.disconnect(L);return}E.default.Config.nextTick(function(){g.recv()})}),M.exec()}})},R.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},R.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},R.prototype._requestCloseOrDisconnect=function(g){var y=this,d=g?this.closeUri:this.disconnectUri;if(d){var p=this.createRequest(d,null,this.authParams,null,h.default.REQ_SEND);p.on("complete",function(T){T&&(u.default.logAction(u.default.LOG_ERROR,"CometTransport.request"+(g?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(T)),y.finish("disconnected",T))}),p.exec()}},R.prototype.dispose=function(){var g=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected()),E.default.Config.nextTick(function(){g.emit("disposed")}))},R.prototype.onConnect=function(g){var y;if(!this.isDisposed){var d=(y=g.connectionDetails)===null||y===void 0?void 0:y.connectionKey;l.default.prototype.onConnect.call(this,g);var p=this.baseUri+d;u.default.logAction(u.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}},R.prototype.send=function(g){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(g);return}var y=this.pendingItems||[];y.push(g),this.pendingItems=null,this.sendItems(y)},R.prototype.sendAnyPending=function(){var g=this.pendingItems;!g||(this.pendingItems=null,this.sendItems(g))},R.prototype.sendItems=function(g){var y=this,d=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(g),h.default.REQ_SEND);d.on("complete",function(p,T){if(p&&u.default.logAction(u.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),y.sendRequest=null,p){p.code?y.onData(x(p)):y.disconnect(p);return}T&&y.onData(T),y.pendingItems&&E.default.Config.nextTick(function(){y.sendRequest||y.sendAnyPending()})}),d.exec()},R.prototype.recv=function(){var g=this;if(!this.recvRequest&&!!this.isConnected){var y=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV_POLL);y.on("data",function(d){g.onData(d)}),y.on("complete",function(d){if(g.recvRequest=null,g.onActivity(),d){d.code?g.onData(x(d)):g.disconnect(d);return}E.default.Config.nextTick(function(){g.recv()})}),y.exec()}},R.prototype.onData=function(g){try{var y=this.decodeResponse(g);if(y&&y.length)for(var d=0;d<y.length;d++)this.onProtocolMessage(a.default.fromDeserialized(y[d]))}catch(p){u.default.logAction(u.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},R.prototype.encodeRequest=function(g){return JSON.stringify(g)},R.prototype.decodeResponse=function(g){return typeof g=="string"?JSON.parse(g):g},R}(l.default);t.default=S},function(s,t){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(r){typeof window=="object"&&(e=window)}s.exports=e},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(3)),a=r.__importStar(e(1)),l=r.__importDefault(e(2)),u=r.__importDefault(e(17)),f=r.__importDefault(e(18)),m=e(4);function b(S,O,R,g,y){S.http.supportsAuthHeaders?S.auth.getAuthHeaders(function(d,p){d?g(d):y(a.mixin(p,O),R)}):S.auth.getAuthParams(function(d,p){d?g(d):y(O,a.mixin(p,R))})}function C(S,O){return function(R,g,y,d,p){if(R&&!g){S(R);return}if(!d)try{g=a.decodeBody(g,O)}catch(W){a.isErrorInfoOrPartialErrorInfo(W)?S(W):S(new m.PartialErrorInfo(a.inspectError(W),null));return}if(!g){S(new m.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var T=g,v=T.statusCode,I=T.response,U=T.headers;if(v===void 0){S(R,g,y,!0,p);return}if(v<200||v>=300){var z=I&&I.error||R;z||(z=new Error("Error in unenveloping "+g),z.statusCode=v),S(z,I,U,!0,v);return}S(R,I,U,!0,v)}}function h(S){var O=[];if(S)for(var R in S)O.push(R+"="+S[R]);return O.join("&")}function E(S,O){return S+(O?"?":"")+h(O)}function w(S,O,R,g){return function(y,d,p,T,v){y?l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received Error; "+E(R,g)+"; Error: "+a.inspectError(y)):l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Received; "+E(R,g)+"; Headers: "+h(p)+"; StatusCode: "+v+"; Body: "+(i.default.BufferUtils.isBuffer(d)?d.toString():d)),S&&S(y,d,p,T,v)}}var x=function(){function S(){}return S.get=function(O,R,g,y,d,p){S.do(f.default.Get,O,R,null,g,y,d,p)},S.delete=function(O,R,g,y,d,p){S.do(f.default.Delete,O,R,null,g,y,d,p)},S.post=function(O,R,g,y,d,p,T){S.do(f.default.Post,O,R,g,y,d,p,T)},S.patch=function(O,R,g,y,d,p,T){S.do(f.default.Patch,O,R,g,y,d,p,T)},S.put=function(O,R,g,y,d,p,T){S.do(f.default.Put,O,R,g,y,d,p,T)},S.do=function(O,R,g,y,d,p,T,v){l.default.shouldLog(l.default.LOG_MICRO)&&(v=w(v,O,g,p)),T&&(v=v&&C(v,T),(p=p||{}).envelope=T);function I(U,z){var W;if(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+E(g,z)),l.default.shouldLog(l.default.LOG_MICRO)){var N=y;if(((W=U["content-type"])===null||W===void 0?void 0:W.indexOf("msgpack"))>0)try{N=i.default.Config.msgpack.decode(y)}catch(M){l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending MsgPack Decoding Error: "+a.inspectError(M))}l.default.logAction(l.default.LOG_MICRO,"Resource."+O+"()","Sending; "+E(g,z)+"; Body: "+N)}R.http.do(O,R,g,U,y,z,function(M,L,$,G,J){if(M&&u.default.isTokenErr(M)){R.auth.authorize(null,null,function(ee){if(ee){v(ee);return}b(R,$,z,v,I)});return}v(M,L,$,G,J)})}b(R,d,p,v,I)},S}();t.default=x},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(2)),a=r.__importDefault(e(3)),l=r.__importDefault(e(9)),u=r.__importStar(e(1));function f(b){return m.Actions.indexOf(b)}var m=function(){function b(){}return b.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},b.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var C=this.id.split(":");return{connectionId:C[0],msgSerial:parseInt(C[1],10),index:parseInt(C[2],10)}},b.prototype.toJSON=function(){var C=this.data,h=this.encoding;return C&&a.default.BufferUtils.isBuffer(C)&&(arguments.length>0?(h=h?h+"/base64":"base64",C=a.default.BufferUtils.base64Encode(C)):C=a.default.BufferUtils.toBuffer(C)),{id:this.id,clientId:this.clientId,action:f(this.action),data:C,encoding:h,extras:this.extras}},b.prototype.toString=function(){var C="[PresenceMessage";return C+="; action="+this.action,this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?C+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),this.extras&&(C+="; extras="+JSON.stringify(this.extras)),C+="]",C},b.fromResponseBody=function(C,h,E){var w=[];E&&(C=u.decodeBody(C,E));for(var x=0;x<C.length;x++){var S=w[x]=b.fromValues(C[x],!0);try{b.decode(S,h)}catch(O){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",O.toString())}}return w},b.fromValues=function(C,h){return h&&(C.action=b.Actions[C.action]),Object.assign(new b,C)},b.fromValuesArray=function(C){for(var h=C.length,E=new Array(h),w=0;w<h;w++)E[w]=b.fromValues(C[w]);return E},b.fromEncoded=function(C,h){var E=b.fromValues(C,!0);try{b.decode(E,h!=null?h:{})}catch(w){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return E},b.fromEncodedArray=function(C,h){return C.map(function(E){return b.fromEncoded(E,h)})},b.fromData=function(C){return C instanceof b?C:b.fromValues({data:C})},b.Actions=["absent","present","enter","leave","update"],b.encode=l.default.encode,b.decode=l.default.decode,b.getMessagesSize=l.default.getMessagesSize,b}();t.default=m},function(s,t,e){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),a=i.__importStar(e(1)),l=i.__importDefault(e(7)),u=i.__importStar(e(4)),f=i.__importDefault(e(2)),m=i.__importDefault(e(8)),b=i.__importDefault(e(21)),C=i.__importDefault(e(3));function h(v,I){return a.arrIn(a.allToLowerCase(a.keysArray(I)),"x-ably-errorcode")}function E(v,I){if(h(v,I))return v.error&&u.default.fromValues(v.error)}var w=function(){},x=0,S={},O=typeof r!="undefined"&&r.XDomainRequest;function R(){var v=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return v&&Number(v[1])}function g(){var v;return O&&(v=R())&&v===10}function y(v,I){return v.getResponseHeader&&v.getResponseHeader(I)}function d(v){return v.getResponseHeader&&(v.getResponseHeader("transfer-encoding")||!v.getResponseHeader("content-length"))}function p(v){for(var I=a.trim(v.getAllResponseHeaders()).split(`\r
`),U={},z=0;z<I.length;z++){var W=I[z].split(":").map(a.trim);U[W[0].toLowerCase()]=W[1]}return U}var T=function(v){i.__extends(I,v);function I(U,z,W,N,M,L,$){var G=v.call(this)||this;return W=W||{},W.rnd=a.cheapRandStr(),g()&&!W.envelope&&(W.envelope="json"),G.uri=U+a.toQueryString(W),G.headers=z||{},G.body=N,G.method=$?$.toUpperCase():a.isEmptyArg(N)?"GET":"POST",G.requestMode=M,G.timeouts=L,G.timedOut=!1,G.requestComplete=!1,G.id=String(++x),S[G.id]=G,G}return I.createRequest=function(U,z,W,N,M,L,$){var G=L||m.default.TIMEOUTS;return new I(U,z,a.copy(W),N,M,G,$)},I.prototype.complete=function(U,z,W,N,M){this.requestComplete||(this.requestComplete=!0,!U&&z&&this.emit("data",z),this.emit("complete",U,z,W,N,M),this.dispose())},I.prototype.abort=function(){this.dispose()},I.prototype.exec=function(){var U=this,z=this.headers,W=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,N=this.timer=setTimeout(function(){U.timedOut=!0,L.abort()},W),M=this.method,L=this.xhr=new XMLHttpRequest,$=z.accept,G=this.body,J="text";if($?$.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):z.accept="application/json",G){var ee=z["content-type"]||(z["content-type"]="application/json");ee.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}L.open(M,this.uri,!0),L.responseType=J,"authorization"in z&&(L.withCredentials=!0);for(var re in z)L.setRequestHeader(re,z[re]);var X=function(de,Ze,bt,ot){var ht,un=Ze+" (event type: "+de.type+")";!((ht=U==null?void 0:U.xhr)===null||ht===void 0)&&ht.statusText&&(un+=", current statusText is "+U.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+de.type+"()",un),U.complete(new u.PartialErrorInfo(un,bt,ot))};L.onerror=function(de){X(de,"XHR error occurred",null,400)},L.onabort=function(de){U.timedOut?X(de,"Request aborted due to request timeout expiring",null,408):X(de,"Request cancelled",null,400)},L.ontimeout=function(de){X(de,"Request timed out",null,408)};var P,k,H,j=0,te=!1,fe=function(){if(clearTimeout(N),H=k<400,k==204){U.complete(null,null,null,null,k);return}P=U.requestMode==b.default.REQ_RECV_STREAM&&H&&d(L)},me=function(){var de;try{var Ze=y(L,"content-type"),bt=Ze?Ze.indexOf("application/json")>=0:L.responseType=="text";if(bt){var ot=L.responseType==="arraybuffer"?C.default.BufferUtils.utf8Decode(L.response):String(L.responseText);ot.length?de=JSON.parse(ot):de=ot,te=!0}else de=L.response;de.response!==void 0?(k=de.statusCode,H=k<400,z=de.headers,de=de.response):z=p(L)}catch(un){U.complete(new u.PartialErrorInfo("Malformed response body from server: "+un.message,null,400));return}if(H||a.isArray(de)){U.complete(null,de,z,te,k);return}var ht=E(de,z);ht||(ht=new u.PartialErrorInfo("Error response received from server: "+k+" body was: "+C.default.Config.inspect(de),null,k)),U.complete(ht,de,z,te,k)};function Ee(){for(var de=L.responseText,Ze=de.length-1,bt,ot;j<Ze&&(bt=de.indexOf(`
`,j))>-1;)ot=de.slice(j,bt),j=bt+1,Se(ot)}var Se=function(de){try{de=JSON.parse(de)}catch(Ze){U.complete(new u.PartialErrorInfo("Malformed response body from server: "+Ze.message,null,400));return}U.emit("data",de)},ze=function(){Ee(),U.streamComplete=!0,C.default.Config.nextTick(function(){U.complete()})};L.onreadystatechange=function(){var de=L.readyState;de<3||L.status!==0&&(k===void 0&&(k=L.status,k===1223&&(k=204),fe()),de==3&&P?Ee():de==4&&(P?ze():me()))},L.send(G)},I.prototype.dispose=function(){var U=this.xhr;if(U){U.onreadystatechange=U.onerror=U.onabort=U.ontimeout=w,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||U.abort()}delete S[this.id]},I}(l.default);t.default=T}).call(this,e(13))},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(2)),a=r.__importStar(e(1)),l=r.__importDefault(e(23)),u=r.__importDefault(e(4)),f=r.__importDefault(e(45)),m=e(11),b=r.__importDefault(e(18)),C=r.__importDefault(e(25)),h=r.__importDefault(e(3)),E=r.__importDefault(e(14)),w=Math.pow(2,17);function x(){}function S(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(W){return!!W.connection}function R(W){return a.isErrorInfoOrPartialErrorInfo(W)?(W.code||(W.statusCode===403?W.code=40300:(W.code=40170,W.statusCode=401)),W):new u.default(a.inspectError(W),W.code||40170,W.statusCode||401)}var g=function(W,N){if(h.default.Config.createHmac){var M=h.default.Config.createHmac("SHA256",N);return M.update(W),M.digest("base64")}return(0,m.stringify)((0,f.default)(W,N))};function y(W){if(!W)return"";typeof W=="string"&&(W=JSON.parse(W));var N=Object.create(null),M=a.keysArray(W,!0);if(!M)return"";M.sort();for(var L=0;L<M.length;L++)N[M[L]]=W[M[L]].sort();return JSON.stringify(N)}function d(W){if(W.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(W.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(W.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(W.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var N="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",N),new Error(N)}}function p(W){return"useTokenAuth"in W&&!W.useTokenAuth}function T(W){return W.useTokenAuth||!p(W)&&(W.authCallback||W.authUrl||W.token||W.tokenDetails)}function v(W){return!W.key&&!W.authCallback&&!W.authUrl}var I=0;function U(){return I++}var z=function(){function W(N,M){if(this.authOptions={},this.client=N,this.tokenParams=M.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,T(M)){if(M.key&&!g){var L="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new Error(L)}v(M)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(M.defaultTokenParams,M),d(this.authOptions)}else{if(!M.key){var L="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",L),new u.default(L,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(M)}}return W.prototype.authorize=function(N,M,L){var $=this,G;if(typeof N=="function"&&!L?(L=N,G=N=null):typeof M=="function"&&!L?(L=M,G=null):G=M,!L&&this.client.options.promises)return a.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new u.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),a.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(N,G,function(J,ee){if(J){$.client.connection&&J.statusCode===C.default.Forbidden&&$.client.connection.connectionManager.actOnErrorFromAuthorize(J),L==null||L(J);return}O($.client)?$.client.connection.connectionManager.onAuthUpdated(ee,L||x):L==null||L(null,ee)})},W.prototype.authorise=function(N,M,L){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(N,M,L)},W.prototype._forceNewToken=function(N,M,L){var $=this;this.tokenDetails=null,this._saveTokenOptions(N,M),d(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,J){delete $.tokenParams.timestamp,delete $.authOptions.queryTime,L(G,J)})},W.prototype.requestToken=function(N,M,L){var $=this;if(typeof N=="function"&&!L?(L=N,M=N=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return a.promisify(this,"requestToken",arguments);M=M||this.authOptions,N=N||a.copy(this.tokenParams);var G=L||x,J,ee=this.client;if(M.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=M.authCallback;else if(M.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,te){var fe=a.mixin({accept:"application/json, text/plain"},M.authHeaders),me=M.authMethod&&M.authMethod.toLowerCase()==="post",Ee,Se=M.authUrl.indexOf("?");Se>-1&&(Ee=a.parseQueryString(M.authUrl.slice(Se)),M.authUrl=M.authUrl.slice(0,Se),me||(M.authParams=a.mixin(Ee,M.authParams)));var ze=a.mixin({},M.authParams||{},j),de=function(ot,ht,un,yn){var lt;if(ot?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+a.inspectError(ot)):(lt=un["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+lt+"; body: "+a.inspectBody(ht))),ot||yn)return te(ot,ht);if(h.default.BufferUtils.isBuffer(ht)&&(ht=ht.toString()),!lt){te(new u.default("authUrl response is missing a content-type header",40170,401));return}var bn=lt.indexOf("application/json")>-1,Vn=lt.indexOf("text/plain")>-1||lt.indexOf("application/jwt")>-1;if(!bn&&!Vn){te(new u.default("authUrl responded with unacceptable content-type "+lt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(bn){if(ht.length>w){te(new u.default("authUrl response exceeded max permitted length",40170,401));return}try{ht=JSON.parse(ht)}catch(Qi){te(new u.default("Unexpected error processing authURL response; err = "+Qi.message,40170,401));return}}te(null,ht,lt)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+M.authUrl+"; Params: "+JSON.stringify(ze)+"; method: "+(me?"POST":"GET")),me){var Ze=fe||{};Ze["content-type"]="application/x-www-form-urlencoded";var bt=a.toQueryString(ze).slice(1);$.client.http.doUri(b.default.Post,ee,M.authUrl,Ze,bt,Ee,de)}else $.client.http.doUri(b.default.Get,ee,M.authUrl,fe||{},null,ze,de)};else if(M.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,te){$.createTokenRequest(j,M,te)};else{var re="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new u.default(re,40171,403));return}"capability"in N&&(N.capability=y(N.capability));var X=function(j,te){var fe=j.keyName,me="/keys/"+fe+"/requestToken",Ee=function(ze){return ee.baseUri(ze)+me},Se=a.defaultPostHeaders($.client.options);M.requestHeaders&&a.mixin(Se,M.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+me+"; Token params: "+JSON.stringify(j)),$.client.http.do(b.default.Post,ee,Ee,Se,JSON.stringify(j),null,te)},P=!1,k=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){P=!0;var j="Token request callback timed out after "+k/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",j),G(new u.default(j,40170,401))},k);J(N,function(j,te,fe){if(!P){if(clearTimeout(H),j){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+a.inspectError(j)),G(R(j));return}if(typeof te=="string"){te.length===0?G(new u.default("Token string is empty",40170,401)):te.length>w?G(new u.default("Token string exceeded max permitted length (was "+te.length+" bytes)",40170,401)):te==="undefined"||te==="null"?G(new u.default("Token string was literal null/undefined",40170,401)):te[0]==="{"&&!(fe&&fe.indexOf("application/jwt")>-1)?G(new u.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:te});return}if(typeof te!="object"){var me="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof te;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),G(new u.default(me,40170,401));return}var Ee=JSON.stringify(te).length;if(Ee>w&&!M.suppressMaxLengthCheck){G(new u.default("Token request/details object exceeded max permitted stringified size (was "+Ee+" bytes)",40170,401));return}if("issued"in te){G(null,te);return}if(!("keyName"in te)){var me="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",me),G(new u.default(me,40170,401));return}X(te,function(Se,ze,de,Ze){if(Se){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+a.inspectError(Se)),G(R(Se));return}Ze||(ze=JSON.parse(ze)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,ze)})}})},W.prototype.createTokenRequest=function(N,M,L){var $=this;if(typeof N=="function"&&!L?(L=N,M=N=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return a.promisify(this,"createTokenRequest",arguments);M=M||this.authOptions,N=N||a.copy(this.tokenParams);var G=M.key;if(!G){L(new u.default("No key specified",40101,403));return}var J=G.split(":"),ee=J[0],re=J[1];if(!re){L(new u.default("Invalid key specified",40101,403));return}if(N.clientId===""){L(new u.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in N&&(N.capability=y(N.capability));var X=a.mixin({keyName:ee},N),P=N.clientId||"",k=N.ttl||"",H=N.capability||"";(function(j){if(X.timestamp){j();return}$.getTimestamp(M&&M.queryTime,function(te,fe){if(te){L(te);return}X.timestamp=fe,j()})})(function(){var j=X.nonce||(X.nonce=S()),te=X.timestamp,fe=X.keyName+`
`+k+`
`+H+`
`+P+`
`+te+`
`+j+`
`;X.mac=X.mac||g(fe,re),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),L(null,X)})},W.prototype.getAuthParams=function(N){this.method=="basic"?N(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){N(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{access_token:L.token})})},W.prototype.getAuthHeaders=function(N){this.method=="basic"?N(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){N(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{authorization:"Bearer "+a.toBase64(L.token)})})},W.prototype.getTimestamp=function(N,M){!this.isTimeOffsetSet()&&(N||this.authOptions.queryTime)?this.client.time(M):M(null,this.getTimestampUsingOffset())},W.prototype.getTimestampUsingOffset=function(){return a.now()+(this.client.serverTimeOffset||0)},W.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},W.prototype._saveBasicOptions=function(N){this.method="basic",this.key=N.key,this.basicKey=a.toBase64(N.key),this.authOptions=N||{},"clientId"in N&&this._userSetClientId(N.clientId)},W.prototype._saveTokenOptions=function(N,M){this.method="token",N&&(this.tokenParams=N),M&&(M.token&&(M.tokenDetails=typeof M.token=="string"?{token:M.token}:M.token),M.tokenDetails&&(this.tokenDetails=M.tokenDetails),"clientId"in M&&this._userSetClientId(M.clientId),this.authOptions=M)},W.prototype._ensureValidAuthCredentials=function(N,M){var L=this,$=this.tokenDetails;if($){if(this._tokenClientIdMismatch($.clientId)){M(new u.default("Mismatch between clientId in token ("+$.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!$.expires||$.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+$.expires),M(null,$);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(M),!(this.currentTokenRequestId!==null&&!N)){var G=this.currentTokenRequestId=U();this.requestToken(this.tokenParams,this.authOptions,function(J,ee){if(L.currentTokenRequestId>G){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}L.currentTokenRequestId=null;var re=L.waitingForTokenRequest||x;if(L.waitingForTokenRequest=null,J){re(J);return}re(null,L.tokenDetails=ee)})}},W.prototype._userSetClientId=function(N){if(typeof N=="string"||N===null){if(N==="*")throw new u.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var M=this._uncheckedSetClientId(N);if(M)throw M}else throw new u.default("clientId must be either a string or null",40012,400)},W.prototype._uncheckedSetClientId=function(N){if(this._tokenClientIdMismatch(N)){var M="Unexpected clientId mismatch: client has "+this.clientId+", requested "+N,L=new u.default(M,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",M),L}else return this.clientId=this.tokenParams.clientId=N,null},W.prototype._tokenClientIdMismatch=function(N){return!!(this.clientId&&this.clientId!=="*"&&N&&N!=="*"&&this.clientId!==N)},W.isTokenErr=function(N){return N.code&&N.code>=40140&&N.code<40150},W.prototype.revokeTokens=function(N,M,L){if(T(this.client.options))throw new u.default("Cannot revoke tokens when using token auth",40162,401);var $=this.client.options.keyName,G;if(typeof M=="function"?(L=M,G={}):G=M!=null?M:{},L===void 0){if(this.client.options.promises)return a.promisify(this,"revokeTokens",[N,G]);L=x}var J=L,ee=r.__assign({targets:N.map(function(k){return"".concat(k.type,":").concat(k.value)})},G),re=this.client.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,X=a.defaultPostHeaders(this.client.options,re);this.client.options.headers&&a.mixin(X,this.client.options.headers);var P=a.encodeBody(ee,re);E.default.post(this.client,"/keys/".concat($,"/revokeTokens"),P,X,{newBatchResponse:"true"},null,function(k,H,j,te){if(k){J(k);return}var fe=te?H:a.decodeBody(H,re);J(null,fe)})},W}();t.default=z},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(r||(r={})),t.default=r},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPaginatedResponse=t.PaginatedResult=void 0;var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(2)),l=r.__importDefault(e(14));function u(E){var w=E.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&i.parseQueryString(w[2])}function f(E){typeof E=="string"&&(E=E.split(","));for(var w={},x=0;x<E.length;x++){var S=E[x].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(S){var O=u(S[1]);O&&(w[S[2]]=O)}}return w}function m(E,w,x){return!(x&&(w||typeof E.code=="number"))}var b=function(){function E(w,x,S,O,R,g){this.rest=w,this.path=x,this.headers=S,this.envelope=O!=null?O:null,this.bodyHandler=R,this.useHttpPaginatedResponse=g||!1}return E.prototype.get=function(w,x){var S=this;l.default.get(this.rest,this.path,this.headers,w,this.envelope,function(O,R,g,y,d){S.handlePage(O,R,g,y,d,x)})},E.prototype.delete=function(w,x){var S=this;l.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(O,R,g,y,d){S.handlePage(O,R,g,y,d,x)})},E.prototype.post=function(w,x,S){var O=this;l.default.post(this.rest,this.path,x,this.headers,w,this.envelope,function(R,g,y,d,p){S&&O.handlePage(R,g,y,d,p,S)})},E.prototype.put=function(w,x,S){var O=this;l.default.put(this.rest,this.path,x,this.headers,w,this.envelope,function(R,g,y,d,p){S&&O.handlePage(R,g,y,d,p,S)})},E.prototype.patch=function(w,x,S){var O=this;l.default.patch(this.rest,this.path,x,this.headers,w,this.envelope,function(R,g,y,d,p){S&&O.handlePage(R,g,y,d,p,S)})},E.prototype.handlePage=function(w,x,S,O,R,g){if(w&&m(w,x,this.useHttpPaginatedResponse)){a.default.logAction(a.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(w)),g==null||g(w);return}var y,d,p;try{y=this.bodyHandler(x,S||{},O)}catch(T){g==null||g(w||T);return}S&&(d=S.Link||S.link)&&(p=f(d)),this.useHttpPaginatedResponse?g(null,new h(this,y,S||{},R,p,w)):g(null,new C(this,y,p))},E}(),C=function(){function E(w,x,S){var O=this;this.resource=w,this.items=x;var R=this;S&&("first"in S&&(this.first=function(g){if(!g&&R.resource.rest.options.promises)return i.promisify(R,"first",[]);R.get(S.first,g)}),"current"in S&&(this.current=function(g){if(!g&&R.resource.rest.options.promises)return i.promisify(R,"current",[]);R.get(S.current,g)}),this.next=function(g){if(!g&&R.resource.rest.options.promises)return i.promisify(R,"next",[]);"next"in S?R.get(S.next,g):g(null)},this.hasNext=function(){return"next"in S},this.isLast=function(){var g;return!(!((g=O.hasNext)===null||g===void 0)&&g.call(O))})}return E.prototype.get=function(w,x){var S=this.resource;l.default.get(S.rest,S.path,S.headers,w,S.envelope,function(O,R,g,y,d){S.handlePage(O,R,g,y,d,x)})},E}();t.PaginatedResult=C;var h=function(E){r.__extends(w,E);function w(x,S,O,R,g,y){var d=E.call(this,x,S,g)||this;return d.statusCode=R,d.success=R<300&&R>=200,d.headers=O,d.errorCode=y&&y.code,d.errorMessage=y&&y.message,d}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(C);t.HttpPaginatedResponse=h,t.default=b},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriable=void 0;var r=e(0),i=r.__importDefault(e(4)),a={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},l={disconnected:function(){return i.default.fromValues({statusCode:400,code:a.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return i.default.fromValues({statusCode:400,code:a.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return i.default.fromValues({statusCode:400,code:a.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return i.default.fromValues({statusCode:400,code:a.CLOSING,message:"Connection closing"})},closed:function(){return i.default.fromValues({statusCode:400,code:a.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return i.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function u(f){return!f.statusCode||!f.code||f.statusCode>=500?!0:Object.values(a).includes(f.code)}t.isRetriable=u,t.default=l},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(r||(r={})),t.default=r},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(5),e(58),e(11),e(40),e(32),e(24),e(27),e(28),e(59),e(60))})(this,function(r){return r})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(2)),a=function(){function l(u){this.members=u||[]}return l.prototype.call=function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];for(var m=0,b=this.members;m<b.length;m++){var C=b[m];if(C)try{C.apply(void 0,u)}catch(h){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+h+"; stack = "+h.stack)}}},l.prototype.push=function(){for(var u,f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];(u=this.members).push.apply(u,f)},l.create=function(u){var f=new l(u);return Object.assign(function(){for(var m=[],b=0;b<arguments.length;b++)m[b]=arguments[b];return f.call.apply(f,m)},{push:function(m){return f.push(m)}})},l}();t.default=a},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){(function(){var i=r,a=i.lib,l=a.Base,u=i.enc,f=u.Utf8,m=i.algo,b=m.HMAC=l.extend({init:function(C,h){C=this._hasher=new C.init,typeof h=="string"&&(h=f.parse(h));var E=C.blockSize,w=E*4;h.sigBytes>w&&(h=C.finalize(h)),h.clamp();for(var x=this._oKey=h.clone(),S=this._iKey=h.clone(),O=x.words,R=S.words,g=0;g<E;g++)O[g]^=1549556828,R[g]^=909522486;x.sigBytes=S.sigBytes=w,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var h=this._hasher,E=h.finalize(C);h.reset();var w=h.finalize(this._oKey.clone().concat(E));return w}})})()})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSuccessCode=void 0;var r;(function(a){a[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError"})(r||(r={}));function i(a){return a>=r.Success&&a<r.BadRequest}t.isSuccessCode=i,t.default=r},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(10)),a=r.__importStar(e(1)),l=r.__importDefault(e(7)),u=r.__importDefault(e(2)),f=r.__importDefault(e(20)),m=r.__importDefault(e(4)),b=r.__importDefault(e(3)),C=i.default.Action,h=i.default.fromValues({action:C.CLOSE}),E=i.default.fromValues({action:C.DISCONNECT}),w=function(x){r.__extends(S,x);function S(O,R,g,y){var d=x.call(this)||this;return y&&(g.format=void 0,g.heartbeats=!0),d.connectionManager=O,O.registerProposedTransport(d),d.auth=R,d.params=g,d.timeouts=g.options.timeouts,d.format=g.format,d.isConnected=!1,d.isFinished=!1,d.isDisposed=!1,d.maxIdleInterval=null,d.idleTimer=null,d.lastActivity=null,d}return S.prototype.connect=function(){},S.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",f.default.closed())},S.prototype.disconnect=function(O){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",O||f.default.disconnected())},S.prototype.fail=function(O){this.isConnected&&this.requestDisconnect(),this.finish("failed",O||f.default.failed())},S.prototype.finish=function(O,R){var g;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((g=this.idleTimer)!==null&&g!==void 0?g:void 0),this.idleTimer=null,this.emit(O,R),this.dispose())},S.prototype.onProtocolMessage=function(O){switch(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(O)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),O.action){case C.HEARTBEAT:u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",O.id);break;case C.CONNECTED:this.onConnect(O),this.emit("connected",O.error,O.connectionId,O.connectionDetails,O);break;case C.CLOSED:this.onClose(O);break;case C.DISCONNECTED:this.onDisconnect(O);break;case C.ACK:this.emit("ack",O.msgSerial,O.count);break;case C.NACK:this.emit("nack",O.msgSerial,O.count,O.error);break;case C.SYNC:this.connectionManager.onChannelMessage(O,this);break;case C.ACTIVATE:break;case C.AUTH:this.auth.authorize(function(R){R&&u.default.logAction(u.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+a.inspectError(R))});break;case C.ERROR:if(u.default.logAction(u.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+b.default.Config.inspect(O.error)+(O.channel?", channel: "+O.channel:"")),O.channel===void 0){this.onFatalError(O);break}this.connectionManager.onChannelMessage(O,this);break;default:this.connectionManager.onChannelMessage(O,this)}},S.prototype.onConnect=function(O){if(this.isConnected=!0,!O.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var R=O.connectionDetails.maxIdleInterval;R&&(this.maxIdleInterval=R+this.timeouts.realtimeRequestTimeout,this.onActivity())},S.prototype.onDisconnect=function(O){var R=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onDisconnect()","err = "+a.inspectError(R)),this.finish("disconnected",R)},S.prototype.onFatalError=function(O){var R=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onFatalError()","err = "+a.inspectError(R)),this.finish("failed",R)},S.prototype.onClose=function(O){var R=O&&O.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onClose()","err = "+a.inspectError(R)),this.finish("closed",R)},S.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestClose()",""),this.send(h)},S.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},S.prototype.ping=function(O){var R={action:i.default.Action.HEARTBEAT};O&&(R.id=O),this.send(i.default.fromValues(R))},S.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},S.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=a.now(),this.setIdleTimer(this.maxIdleInterval+100))},S.prototype.setIdleTimer=function(O){var R=this;this.idleTimer||(this.idleTimer=setTimeout(function(){R.onIdleTimerExpire()},O))},S.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var O=a.now()-this.lastActivity,R=this.maxIdleInterval-O;if(R<=0){var g="No activity seen from realtime in "+O+"ms; assuming connection has dropped";u.default.logAction(u.default.LOG_ERROR,"Transport.onIdleTimerExpire()",g),this.disconnect(new m.default(g,80003,408))}else this.setIdleTimer(R+100)},S.tryConnect=function(O,R,g,y,d){var p=new O(R,g,y),T,v=function(U){clearTimeout(T),d({event:this.event,error:U})},I=R.options.timeouts.realtimeRequestTimeout;T=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),v.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},I),p.on(["failed","disconnected"],v),p.on("preconnect",function(){u.default.logAction(u.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(T),p.off(["failed","disconnected"],v),d(null,p)}),p.connect()},S}(l.default);t.default=w},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(40),e(24))})(this,function(r){return function(){var i=r,a=i.lib,l=a.Base,u=a.WordArray,f=i.algo,m=f.MD5,b=f.EvpKDF=l.extend({cfg:l.extend({keySize:128/32,hasher:m,iterations:1}),init:function(C){this.cfg=this.cfg.extend(C)},compute:function(C,h){for(var E,w=this.cfg,x=w.hasher.create(),S=u.create(),O=S.words,R=w.keySize,g=w.iterations;O.length<R;){E&&x.update(E),E=x.update(C).finalize(h),x.reset();for(var y=1;y<g;y++)E=x.finalize(E),x.reset();S.concat(E)}return S.sigBytes=R*4,S}});i.EvpKDF=function(C,h,E){return b.create(E).compute(C,h)}}(),r.EvpKDF})},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(27))})(this,function(r){r.lib.Cipher||function(i){var a=r,l=a.lib,u=l.Base,f=l.WordArray,m=l.BufferedBlockAlgorithm,b=a.enc,C=b.Utf8,h=b.Base64,E=a.algo,w=E.EvpKDF,x=l.Cipher=m.extend({cfg:u.extend(),createEncryptor:function(M,L){return this.create(this._ENC_XFORM_MODE,M,L)},createDecryptor:function(M,L){return this.create(this._DEC_XFORM_MODE,M,L)},init:function(M,L,$){this.cfg=this.cfg.extend($),this._xformMode=M,this._key=L,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(M){return this._append(M),this._process()},finalize:function(M){M&&this._append(M);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function M(L){return typeof L=="string"?N:U}return function(L){return{encrypt:function($,G,J){return M(G).encrypt(L,$,G,J)},decrypt:function($,G,J){return M(G).decrypt(L,$,G,J)}}}}()}),S=l.StreamCipher=x.extend({_doFinalize:function(){var M=this._process(!0);return M},blockSize:1}),O=a.mode={},R=l.BlockCipherMode=u.extend({createEncryptor:function(M,L){return this.Encryptor.create(M,L)},createDecryptor:function(M,L){return this.Decryptor.create(M,L)},init:function(M,L){this._cipher=M,this._iv=L}}),g=O.CBC=function(){var M=R.extend();M.Encryptor=M.extend({processBlock:function($,G){var J=this._cipher,ee=J.blockSize;L.call(this,$,G,ee),J.encryptBlock($,G),this._prevBlock=$.slice(G,G+ee)}}),M.Decryptor=M.extend({processBlock:function($,G){var J=this._cipher,ee=J.blockSize,re=$.slice(G,G+ee);J.decryptBlock($,G),L.call(this,$,G,ee),this._prevBlock=re}});function L($,G,J){var ee,re=this._iv;re?(ee=re,this._iv=i):ee=this._prevBlock;for(var X=0;X<J;X++)$[G+X]^=ee[X]}return M}(),y=a.pad={},d=y.Pkcs7={pad:function(M,L){for(var $=L*4,G=$-M.sigBytes%$,J=G<<24|G<<16|G<<8|G,ee=[],re=0;re<G;re+=4)ee.push(J);var X=f.create(ee,G);M.concat(X)},unpad:function(M){var L=M.words[M.sigBytes-1>>>2]&255;M.sigBytes-=L}},p=l.BlockCipher=x.extend({cfg:x.cfg.extend({mode:g,padding:d}),reset:function(){var M;x.reset.call(this);var L=this.cfg,$=L.iv,G=L.mode;this._xformMode==this._ENC_XFORM_MODE?M=G.createEncryptor:(M=G.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==M?this._mode.init(this,$&&$.words):(this._mode=M.call(G,this,$&&$.words),this._mode.__creator=M)},_doProcessBlock:function(M,L){this._mode.processBlock(M,L)},_doFinalize:function(){var M,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),M=this._process(!0)):(M=this._process(!0),L.unpad(M)),M},blockSize:128/32}),T=l.CipherParams=u.extend({init:function(M){this.mixIn(M)},toString:function(M){return(M||this.formatter).stringify(this)}}),v=a.format={},I=v.OpenSSL={stringify:function(M){var L,$=M.ciphertext,G=M.salt;return G?L=f.create([1398893684,1701076831]).concat(G).concat($):L=$,L.toString(h)},parse:function(M){var L,$=h.parse(M),G=$.words;return G[0]==1398893684&&G[1]==1701076831&&(L=f.create(G.slice(2,4)),G.splice(0,4),$.sigBytes-=16),T.create({ciphertext:$,salt:L})}},U=l.SerializableCipher=u.extend({cfg:u.extend({format:I}),encrypt:function(M,L,$,G){G=this.cfg.extend(G);var J=M.createEncryptor($,G),ee=J.finalize(L),re=J.cfg;return T.create({ciphertext:ee,key:$,iv:re.iv,algorithm:M,mode:re.mode,padding:re.padding,blockSize:M.blockSize,formatter:G.format})},decrypt:function(M,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=M.createDecryptor($,G).finalize(L.ciphertext);return J},_parse:function(M,L){return typeof M=="string"?L.parse(M,this):M}}),z=a.kdf={},W=z.OpenSSL={execute:function(M,L,$,G){G||(G=f.random(64/8));var J=w.create({keySize:L+$}).compute(M,G),ee=f.create(J.words.slice(L),$*4);return J.sigBytes=L*4,T.create({key:J,iv:ee,salt:G})}},N=l.PasswordBasedCipher=U.extend({cfg:U.cfg.extend({kdf:W}),encrypt:function(M,L,$,G){G=this.cfg.extend(G);var J=G.kdf.execute($,M.keySize,M.ivSize);G.iv=J.iv;var ee=U.encrypt.call(this,M,L,J.key,G);return ee.mixIn(J),ee},decrypt:function(M,L,$,G){G=this.cfg.extend(G),L=this._parse(L,G.format);var J=G.kdf.execute($,M.keySize,M.ivSize,L.salt);G.iv=J.iv;var ee=U.decrypt.call(this,M,L,J.key,G);return ee}})}()})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.createRequest=void 0;var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(12)),l=r.__importDefault(e(3)),u=r.__importDefault(e(7)),f=e(4),m=r.__importDefault(e(8)),b=r.__importDefault(e(2)),C=r.__importDefault(e(21)),h=i.getGlobalObject(),E=function(){},w=h._ablyjs_jsonp={};w._=function(d){return w["_"+d]||E};var x=1,S="jsonp";function O(d,p,T,v,I,U,z){return U=U||m.default.TIMEOUTS,new g(void 0,d,p,i.copy(T),v,I,U,z)}t.createRequest=O;var R=function(d){r.__extends(p,d);function p(T,v,I){var U=d.call(this,T,v,I)||this;return U.shortName=S,I.stream=!1,U}return p.isAvailable=function(){return l.default.Config.jsonpSupported&&l.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(T,v,I,U,z,W,N){return W=(this===null||this===void 0?void 0:this.timeouts)||W||m.default.TIMEOUTS,O(T,v,I,U,z,W,N)},p}(a.default),g=function(d){r.__extends(p,d);function p(T,v,I,U,z,W,N,M){var L=d.call(this)||this;return T===void 0&&(T=x++),L.id=T,L.uri=v,L.params=U||{},L.params.rnd=i.cheapRandStr(),I&&(I["X-Ably-Version"]&&(L.params.v=I["X-Ably-Version"]),I["X-Ably-Lib"]&&(L.params.lib=I["X-Ably-Lib"])),L.body=z,L.method=M,L.requestMode=W,L.timeouts=N,L.requestComplete=!1,L}return p.prototype.exec=function(){var T=this,v=this.id,I=this.body,U=this.method,z=this.uri,W=this.params;W.callback="_ablyjs_jsonp._("+v+")",W.envelope="jsonp",I&&(W.body=I),U&&U!=="get"&&(W.method=U);var N=this.script=document.createElement("script"),M=z+i.toQueryString(W);N.src=M,N.src.split("/").slice(-1)[0]!==M.split("/").slice(-1)[0]&&b.default.logAction(b.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),N.async=!0,N.type="text/javascript",N.charset="UTF-8",N.onerror=function(G){T.complete(new f.PartialErrorInfo("JSONP script error (event: "+l.default.Config.inspect(G)+")",null,400))},w["_"+v]=function(G){if(G.statusCode){var J=G.response;if(G.statusCode==204)T.complete(null,null,null,G.statusCode);else if(!J)T.complete(new f.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||i.isArray(J))T.complete(null,J,G.headers,G.statusCode);else{var ee=J.error||new f.PartialErrorInfo("Error response received from server",null,G.statusCode);T.complete(ee)}}else T.complete(null,G)};var L=this.requestMode==C.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),L);var $=document.getElementsByTagName("head")[0];$.insertBefore(N,$.firstChild)},p.prototype.complete=function(T,v,I,U){if(I=I||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;v&&(z=typeof v=="string"?"text/plain":"application/json",I["content-type"]=z,this.emit("data",v)),this.emit("complete",T,v,I,!0,U),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var T=this.timer;T&&(clearTimeout(T),this.timer=null);var v=this.script;v.parentNode&&v.parentNode.removeChild(v),delete w[this.id],this.emit("disposed")},p}(u.default);t.Request=g;function y(d){return h.JSONPTransport=R,R.isAvailable()&&(d.supportedTransports[S]=R),R}t.default=y},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(2)),l=r.__importDefault(e(8)),u=r.__importDefault(e(17)),f=r.__importDefault(e(46)),m=r.__importDefault(e(19)),b=r.__importDefault(e(33)),C=r.__importDefault(e(4)),h=r.__importDefault(e(49)),E=r.__importDefault(e(18)),w=r.__importDefault(e(3)),x=r.__importDefault(e(9)),S=r.__importDefault(e(15)),O=r.__importDefault(e(14)),R=function(){},g=function(){function d(p){if(!p){var T="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",T),new Error(T)}var v=l.default.objectifyOptions(p);v.log&&a.default.setLog(v.log.level,v.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(p));var I=this.options=l.default.normaliseOptions(v);if(I.key){var U=I.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!U){var T="invalid key parameter";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",T),new C.default(T,40400,404)}I.keyName=U[1],I.keySecret=U[2]}if("clientId"in I)if(typeof I.clientId=="string"||I.clientId===null){if(I.clientId==="*")throw new C.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new C.default("clientId must be either a string or null",40012,400);a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+l.default.version),this.baseUri=this.authority=function(z){return l.default.getHttpScheme(I)+z+":"+l.default.getPort(I,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http(I),this.auth=new u.default(this,I),this.channels=new y(this),this.push=new f.default(this)}return d.prototype.stats=function(p,T){if(T===void 0)if(typeof p=="function")T=p,p=null;else{if(this.options.promises)return i.promisify(this,"stats",[p]);T=R}var v=i.defaultGetHeaders(this.options),I=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:I;this.options.headers&&i.mixin(v,this.options.headers),new m.default(this,"/stats",v,U,function(z,W,N){for(var M=N?z:JSON.parse(z),L=0;L<M.length;L++)M[L]=h.default.fromValues(M[L]);return M}).get(p,T)},d.prototype.time=function(p,T){var v=this;if(T===void 0){if(typeof p=="function")T=p,p=null;else if(this.options.promises)return i.promisify(this,"time",[p])}var I=T||R,U=i.defaultGetHeaders(this.options);this.options.headers&&i.mixin(U,this.options.headers);var z=function(W){return v.authority(W)+"/time"};this.http.do(E.default.Get,this,z,U,null,p,function(W,N,M,L){if(W){I(W);return}L||(N=JSON.parse(N));var $=N[0];if(!$){I(new C.default("Internal error (unexpected result type from GET /time)",5e4,500));return}v.serverTimeOffset=$-i.now(),I(null,$)})},d.prototype.request=function(p,T,v,I,U,z){var W=this.options.useBinaryProtocol,N=W?w.default.Config.msgpack.encode:JSON.stringify,M=W?w.default.Config.msgpack.decode:JSON.parse,L=W?i.Format.msgpack:i.Format.json,$=this.http.supportsLinkHeaders?void 0:L;v=v||{};var G=p.toLowerCase(),J=G=="get"?i.defaultGetHeaders(this.options,L):i.defaultPostHeaders(this.options,L);if(z===void 0){if(this.options.promises)return i.promisify(this,"request",[p,T,v,I,U]);z=R}typeof I!="string"&&(I=N(I)),this.options.headers&&i.mixin(J,this.options.headers),U&&i.mixin(J,U);var ee=new m.default(this,T,J,$,function(re,X,P){return i.ensureArray(P?re:M(re))},!0);if(!i.arrIn(w.default.Http.methods,G))throw new C.default("Unsupported method "+G,40500,405);i.arrIn(w.default.Http.methodsWithBody,G)?ee[G](v,I,z):ee[G](v,z)},d.prototype.batchPublish=function(p,T){if(T===void 0){if(this.options.promises)return i.promisify(this,"batchPublish",[p]);T=R}var v=T,I,U;i.isArray(p)?(I=p,U=!1):(I=[p],U=!0);var z=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,W=i.defaultPostHeaders(this.options,z);this.options.headers&&i.mixin(W,this.options.headers);var N=i.encodeBody(I,z);O.default.post(this,"/messages",N,W,{newBatchResponse:"true"},null,function(M,L,$,G){if(M){v(M);return}var J=G?L:i.decodeBody(L,z);U?v(null,J[0]):v(null,J)})},d.prototype.batchPresence=function(p,T){if(T===void 0){if(this.options.promises)return i.promisify(this,"batchPresence",[p]);T=R}var v=T,I=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,U=i.defaultPostHeaders(this.options,I);this.options.headers&&i.mixin(U,this.options.headers);var z=p.join(",");O.default.get(this,"/presence",U,{newBatchResponse:"true",channels:z},null,function(W,N,M,L){if(W){v(W);return}var $=L?N:i.decodeBody(N,I);v(null,$)})},d.prototype.setLog=function(p){a.default.setLog(p.level,p.handler)},d.Promise=function(p){return p=l.default.objectifyOptions(p),p.promises=!0,new d(p)},d.Callbacks=d,d.Platform=w.default,d.Message=x.default,d.PresenceMessage=S.default,d}(),y=function(){function d(p){this.rest=p,this.all=Object.create(null)}return d.prototype.get=function(p,T){p=String(p);var v=this.all[p];return v?T&&v.setOptions(T):this.all[p]=v=new b.default(this.rest,p,T),v},d.prototype.release=function(p){delete this.all[String(p)]},d}();t.default=g},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return r.enc.Utf8})},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.WordArray,f=l.Hasher,m=a.algo,b=[],C=[];(function(){function w(R){for(var g=i.sqrt(R),y=2;y<=g;y++)if(!(R%y))return!1;return!0}function x(R){return(R-(R|0))*4294967296|0}for(var S=2,O=0;O<64;)w(S)&&(O<8&&(b[O]=x(i.pow(S,1/2))),C[O]=x(i.pow(S,1/3)),O++),S++})();var h=[],E=m.SHA256=f.extend({_doReset:function(){this._hash=new u.init(b.slice(0))},_doProcessBlock:function(w,x){for(var S=this._hash.words,O=S[0],R=S[1],g=S[2],y=S[3],d=S[4],p=S[5],T=S[6],v=S[7],I=0;I<64;I++){if(I<16)h[I]=w[x+I]|0;else{var U=h[I-15],z=(U<<25|U>>>7)^(U<<14|U>>>18)^U>>>3,W=h[I-2],N=(W<<15|W>>>17)^(W<<13|W>>>19)^W>>>10;h[I]=z+h[I-7]+N+h[I-16]}var M=d&p^~d&T,L=O&R^O&g^R&g,$=(O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22),G=(d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25),J=v+G+M+C[I]+h[I],ee=$+L;v=T,T=p,p=d,d=y+J|0,y=g,g=R,R=O,O=J+ee|0}S[0]=S[0]+O|0,S[1]=S[1]+R|0,S[2]=S[2]+g|0,S[3]=S[3]+y|0,S[4]=S[4]+d|0,S[5]=S[5]+p|0,S[6]=S[6]+T|0,S[7]=S[7]+v|0},_doFinalize:function(){var w=this._data,x=w.words,S=this._nDataBytes*8,O=w.sigBytes*8;return x[O>>>5]|=128<<24-O%32,x[(O+64>>>9<<4)+14]=i.floor(S/4294967296),x[(O+64>>>9<<4)+15]=S,w.sigBytes=x.length*4,this._process(),this._hash},clone:function(){var w=f.clone.call(this);return w._hash=this._hash.clone(),w}});a.SHA256=f._createHelper(E),a.HmacSHA256=f._createHmacHelper(E)}(Math),r.SHA256})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(7)),l=r.__importDefault(e(2)),u=r.__importDefault(e(34)),f=r.__importDefault(e(9)),m=r.__importDefault(e(4)),b=r.__importDefault(e(19)),C=r.__importDefault(e(14)),h=r.__importDefault(e(3));function E(){}var w=9;function x(R){return i.arrEvery(R,function(g){return!g.id})}function S(R){var g=R||{};if(g.cipher){if(!h.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var y=h.default.Crypto.getCipher(g.cipher);g.cipher=y.cipherParams,g.channelCipher=y.cipher}else"cipher"in g&&(g.cipher=void 0,g.channelCipher=null);return g}var O=function(R){r.__extends(g,R);function g(y,d,p){var T=R.call(this)||this;return l.default.logAction(l.default.LOG_MINOR,"Channel()","started; name = "+d),T.rest=y,T.name=d,T.basePath="/channels/"+encodeURIComponent(d),T.presence=new u.default(T),T.channelOptions=S(p),T}return g.prototype.setOptions=function(y){this.channelOptions=S(y)},g.prototype.history=function(y,d){if(l.default.logAction(l.default.LOG_MICRO,"Channel.history()","channel = "+this.name),d===void 0)if(typeof y=="function")d=y,y=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);d=E}this._history(y,d)},g.prototype._history=function(y,d){var p=this.rest,T=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:T,I=i.defaultGetHeaders(p.options,T);p.options.headers&&i.mixin(I,p.options.headers);var U=this.channelOptions;new b.default(p,this.basePath+"/messages",I,v,function(z,W,N){return f.default.fromResponseBody(z,U,N?void 0:T)}).get(y,d)},g.prototype.publish=function(){var y=this,d=arguments.length,p=arguments[0],T=arguments[1],v=arguments[d-1],I,U;if(typeof v!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);v=E}if(typeof p=="string"||p===null)I=[f.default.fromValues({name:p,data:T})],U=arguments[2];else if(i.isObject(p))I=[f.default.fromValues(p)],U=arguments[1];else if(i.isArray(p))I=f.default.fromValuesArray(p),U=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof U!="object"||!U)&&(U={});var z=this.rest,W=z.options,N=W.useBinaryProtocol?i.Format.msgpack:i.Format.json,M=z.options.idempotentRestPublishing,L=i.defaultPostHeaders(z.options,N);if(W.headers&&i.mixin(L,W.headers),M&&x(I)){var $=i.randomString(w);i.arrForEach(I,function(G,J){G.id=$+":"+J.toString()})}f.default.encodeArray(I,this.channelOptions,function(G){if(G){v(G);return}var J=f.default.getMessagesSize(I),ee=W.maxMessageSize;if(J>ee){v(new m.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+ee+" bytes)",40009,400));return}y._publish(f.default.serialize(I,N),L,U,v)})},g.prototype._publish=function(y,d,p,T){C.default.post(this.rest,this.basePath+"/messages",y,d,p,null,T)},g.prototype.status=function(y){if(typeof y!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var d=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(this.rest.options,d);C.default.get(this.rest,this.basePath,p,{},d,y||E)},g}(a.default);t.default=O},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(7)),l=r.__importDefault(e(2)),u=r.__importDefault(e(19)),f=r.__importDefault(e(15));function m(){}var b=function(C){r.__extends(h,C);function h(E){var w=C.call(this)||this;return w.channel=E,w.basePath=E.basePath+"/presence",w}return h.prototype.get=function(E,w){if(l.default.logAction(l.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);w=m}var x=this.channel.rest,S=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:S,R=i.defaultGetHeaders(x.options,S);x.options.headers&&i.mixin(R,x.options.headers);var g=this.channel.channelOptions;new u.default(x,this.basePath,R,O,function(y,d,p){return f.default.fromResponseBody(y,g,p?void 0:S)}).get(E,w)},h.prototype.history=function(E,w){return l.default.logAction(l.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,w)},h.prototype._history=function(E,w){if(w===void 0)if(typeof E=="function")w=E,E=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",[E]);w=m}var x=this.channel.rest,S=x.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:S,R=i.defaultGetHeaders(x.options,S);x.options.headers&&i.mixin(R,x.options.headers);var g=this.channel.channelOptions;new u.default(x,this.basePath+"/history",R,O,function(y,d,p){return f.default.fromResponseBody(y,g,p?void 0:S)}).get(E,w)},h}(a.default);t.default=b},function(s,t,e){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0}),t.TransportParams=void 0;var i=e(0),a=i.__importDefault(e(10)),l=i.__importStar(e(1)),u=i.__importStar(e(52)),f=i.__importStar(e(8)),m=i.__importDefault(e(3)),b=i.__importDefault(e(7)),C=i.__importDefault(e(36)),h=i.__importDefault(e(2)),E=i.__importDefault(e(37)),w=i.__importStar(e(20)),x=i.__importStar(e(4)),S=i.__importDefault(e(17)),O=i.__importDefault(e(9)),R=i.__importDefault(e(23)),g=i.__importDefault(e(53)),y=i.__importDefault(e(26)),d=i.__importDefault(e(25)),p=function(){var re;return typeof m.default.WebStorage!="undefined"&&((re=m.default.WebStorage)===null||re===void 0?void 0:re.localSupported)},T=function(){var re;return typeof m.default.WebStorage!="undefined"&&((re=m.default.WebStorage)===null||re===void 0?void 0:re.sessionSupported)},v=a.default.Action,I=function(){},U="ably-transport-preference",z="ably-connection-recovery";function W(){var re,X;return T()&&((X=(re=m.default.WebStorage)===null||re===void 0?void 0:re.getSession)===null||X===void 0?void 0:X.call(re,z))}function N(re){var X,P;return T()&&((P=(X=m.default.WebStorage)===null||X===void 0?void 0:X.setSession)===null||P===void 0?void 0:P.call(X,z,re))}function M(){var re,X;return T()&&((X=(re=m.default.WebStorage)===null||re===void 0?void 0:re.removeSession)===null||X===void 0?void 0:X.call(re,z))}function L(re,X){return l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,re.shortName)>l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,X.shortName)}function $(re,X,P){var k;if(re.channel!==X.channel||(k=re.action)!==v.PRESENCE&&k!==v.MESSAGE||k!==X.action)return!1;var H=k===v.PRESENCE?"presence":"messages",j=re[H].concat(X[H]),te=O.default.getMessagesSize(j);return te>P||!l.allSame(j,"clientId")||!l.arrEvery(j,function(fe){return!fe.id})?!1:(re[H]=j,!0)}function G(re){try{return JSON.parse(re)}catch(X){return null}}var J=function(){function re(X,P,k,H){this.options=X,this.host=P,this.mode=k,this.connectionKey=H,this.format=X.useBinaryProtocol?l.Format.msgpack:l.Format.json}return re.prototype.getConnectParams=function(X){var P=X?l.copy(X):{},k=this.options;switch(this.mode){case"upgrade":P.upgrade=this.connectionKey;break;case"resume":P.resume=this.connectionKey;break;case"recover":{var H=G(k.recover);H&&(P.recover=H.connectionKey);break}default:}return k.clientId!==void 0&&(P.clientId=k.clientId),k.echoMessages===!1&&(P.echo="false"),this.format!==void 0&&(P.format=this.format),this.stream!==void 0&&(P.stream=this.stream),this.heartbeats!==void 0&&(P.heartbeats=this.heartbeats),P.v=f.default.protocolVersion,P.agent=encodeURIComponent((0,f.getAgentString)(this.options)),k.transportParams!==void 0&&l.mixin(P,k.transportParams),P},re.prototype.toString=function(){var X="[mode="+this.mode;return this.host&&(X+=",host="+this.host),this.connectionKey&&(X+=",connectionKey="+this.connectionKey),this.format&&(X+=",format="+this.format),X+="]",X},re}();t.TransportParams=J;var ee=function(re){i.__extends(X,re);function X(P,k){var H=re.call(this)||this;H.disconnectedRetryCount=0,X.initTransports(),H.realtime=P,H.options=k;var j=k.timeouts,te=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:te,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new C.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=j.connectionStateTtl,H.maxIdleInterval=null,H.transports=l.intersect(k.transports||f.default.defaultTransports,X.supportedTransports),H.baseTransport=l.intersect(f.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=l.intersect(H.transports,f.default.upgradeTransports),H.transportPreference=null,H.httpHosts=f.default.getHosts(k),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,h.default.logAction(h.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(k.transports||f.default.defaultTransports)+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var fe="no requested transports available";throw h.default.logAction(h.default.LOG_ERROR,"realtime.ConnectionManager()",fe),new Error(fe)}var me=m.default.Config.addEventListener;return me&&(T()&&typeof k.recover=="function"&&me("beforeunload",H.persistConnection.bind(H)),k.closeOnUnload===!0&&me("beforeunload",function(){h.default.logAction(h.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),me("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(Ee){Ee.off()}),H.disconnectAllTransports(),H.startConnect())}),me("offline",function(){H.state==H.states.connected&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return X.initTransports=function(){(0,g.default)(X),l.arrForEach(m.default.Transports,function(P){P(X)})},X.prototype.createTransportParams=function(P,k){return new J(this.options,P,k,this.connectionKey)},X.prototype.getTransportParams=function(P){var k=this,H=function(j){if(k.connectionKey){j("resume");return}if(typeof k.options.recover=="string"){j("recover");return}var te=k.options.recover,fe=W();if(fe&&typeof te=="function"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),te(fe,function(me){me?(k.options.recover=fe.recoveryKey,j("recover")):j("clean")});return}j("clean")};H(function(j){var te=k.createTransportParams(null,j);if(j==="recover"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+k.options.recover);var fe=G(k.options.recover);fe&&(k.msgSerial=fe.msgSerial)}else h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+te.toString());P(te)})},X.prototype.tryATransport=function(P,k,H){var j=this;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+k),y.default.tryConnect(X.supportedTransports[k],this,this.realtime.auth,P,function(te,fe){var me=j.state;if(me==j.states.closing||me==j.states.closed||me==j.states.failed){fe&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+me.state+" while we were attempting the transport; closing "+fe),fe.close()),H(!0);return}if(te){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+k+" "+te.event+", err: "+te.error.toString()),S.default.isTokenErr(te.error)&&!(j.errorReason&&S.default.isTokenErr(j.errorReason))?(j.errorReason=te.error,j.realtime.auth._forceNewToken(null,null,function(Ee){if(Ee){j.actOnErrorFromAuthorize(Ee);return}j.tryATransport(P,k,H)})):te.event==="failed"?(j.notifyState({state:"failed",error:te.error}),H(!0)):te.event==="disconnected"&&((0,w.isRetriable)(te.error)?H(!1):(j.notifyState({state:j.states.connecting.failState,error:te.error}),H(!0)));return}h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+k+"; setting pending"),j.setTransportPending(fe,P),H(null,fe)})},X.prototype.setTransportPending=function(P,k){var H=this,j=k.mode;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+P+"; mode = "+j),l.arrDeleteValue(this.proposedTransports,P),this.pendingTransports.push(P);var te=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];P.once("connected",function(me,Ee,Se){j=="upgrade"&&H.activeProtocol?P.shortName!==te&&l.arrIn(H.getUpgradePossibilities(),te)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(me,P,Ee,Se)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(me,P,Ee,Se):(H.activateTransport(me,P,Ee,Se),m.default.Config.nextTick(function(){H.connectImpl(k)})),j==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var fe=this;P.on(["disconnected","closed","failed"],function(me){fe.deactivateTransport(P,this.event,me)}),this.emit("transport.pending",P)},X.prototype.scheduleTransportActivation=function(P,k,H,j){var te=this,fe=this.activeProtocol&&this.activeProtocol.getTransport(),me=function(){k.disconnect(),l.arrDeleteValue(te.pendingTransports,k)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+k.shortName),me();return}if(fe&&!L(k,fe)){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+k.shortName+" is no better than current active transport "+fe.shortName+" - abandoning upgrade"),me();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+k);var Ee=null;if(!k.isConnected){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+k.shortName+"is no longer connected; abandoning upgrade"),me();return}if(this.state===this.states.connected)h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Ee=this.activeProtocol;else if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+k.shortName),me();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+k);var Se=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+k),k.send(a.default.fromValues({action:v.ACTIVATE})),te.activateTransport(P,k,H,j),te.state===te.states.synchronizing?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+k),te.state=te.states.connected):h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+te.state.state+", so leaving unchanged"),te.state.sendEvents&&te.sendQueuedMessages()};Ee?Ee.onceIdle(Se):Se()},X.prototype.activateTransport=function(P,k,H,j){var te=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+k),P&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+P),H&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),j&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(k);var fe=this.state,me=this.states.connected.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+fe.state),fe.state==this.states.closing.state||fe.state==this.states.closed.state||fe.state==this.states.failed.state)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),k.disconnect(),!1;if(l.arrDeleteValue(this.pendingTransports,k),!k.isConnected)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+k+" since it appears to no longer be connected"),!1;var Ee=this.activeProtocol;this.activeProtocol=new u.default(k),this.host=k.params.host;var Se=j.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(H,j,!!P),this.onConnectionDetailsUpdate(j,k),m.default.Config.nextTick(function(){k.on("connected",function(de,Ze,bt){te.onConnectionDetailsUpdate(bt,k),te.emit("update",new E.default(me,me,null,de))})}),fe.state===this.states.connected.state?P&&(this.errorReason=this.realtime.connection.errorReason=P,this.emit("update",new E.default(me,me,null,P))):(this.notifyState({state:"connected",error:P}),this.errorReason=this.realtime.connection.errorReason=P||null),this.emit("transport.active",k),Ee)if(Ee.messageQueue.count()>0&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Ee.transport.shortName+", new one is "+k.shortName+") finishing with "+Ee.messageQueue.count()+" messages still pending"),Ee.transport===k){var ze="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+k.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",ze)}else Ee.finish();return l.safeArrForEach(this.pendingTransports,function(de){if(de===k){var Ze="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+k.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Ze),l.arrDeleteValue(te.pendingTransports,k)}else de.disconnect()}),l.safeArrForEach(this.proposedTransports,function(de){de===k?(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+k.shortName+"; stack = "+new Error().stack),l.arrDeleteValue(te.proposedTransports,k)):de.dispose()}),!0},X.prototype.deactivateTransport=function(P,k,H){var j=this.activeProtocol,te=j&&j.getTransport()===P,fe=l.arrDeleteValue(this.pendingTransports,P),me=l.arrDeleteValue(this.proposedTransports,P),Ee=this.noTransportsScheduledForActivation();if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+P),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+k+(te?"; was active":fe?"; was pending":me?"; was proposed":"")+(Ee?"":"; another transport is scheduled for activation")),H&&H.message&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),te&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),m.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",P),te&&Ee||te&&k==="failed"||k==="closed"||j===null&&fe&&this.pendingTransports.length===0){if(k==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:k,error:H,retryImmediately:!0});return}var Se=k==="failed"&&S.default.isTokenErr(H)?"disconnected":k;this.notifyState({state:Se,error:H});return}te&&k==="disconnected"&&this.state!==this.states.synchronizing&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},X.prototype.noTransportsScheduledForActivation=function(){return l.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(P){return!P.isConnected})},X.prototype.setConnection=function(P,k,H){var j=this.connectionId,te=j&&j!==P,fe=!j&&H;(te||fe)&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==P&&h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=P,this.realtime.connection.key=this.connectionKey=k.connectionKey},X.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},X.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},X.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var P=l.now()-this.lastActivity;P>this.connectionStateTtl+this.maxIdleInterval&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+P+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},X.prototype.persistConnection=function(){if(T()){var P=this.createRecoveryKey();P&&N({recoveryKey:P,disconnectedAt:l.now(),location:r.location,clientId:this.realtime.auth.clientId})}},X.prototype.unpersistConnection=function(){M()},X.prototype.getError=function(){return this.errorReason||this.getStateError()},X.prototype.getStateError=function(){var P,k;return(k=(P=w.default)[this.state.state])===null||k===void 0?void 0:k.call(P)},X.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},X.prototype.enactStateChange=function(P){var k=P.current==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(k,"Connection state",P.current+(P.reason?"; reason: "+P.reason:"")),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+P.current+"; reason = "+(P.reason&&P.reason.message));var H=this.state=this.states[P.current];P.reason&&(this.errorReason=P.reason,this.realtime.connection.errorReason=P.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",P)},X.prototype.startTransitionTimer=function(P){var k=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+P.state),this.transitionTimer&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){k.transitionTimer&&(k.transitionTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager "+P.state+" timer expired","requesting new state: "+P.failState),k.notifyState({state:P.failState}))},P.retryDelay)},X.prototype.cancelTransitionTimer=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},X.prototype.startSuspendTimer=function(){var P=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){P.suspendTimer&&(P.suspendTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),P.states.connecting.failState="suspended",P.notifyState({state:"suspended"}))},this.connectionStateTtl))},X.prototype.checkSuspendTimer=function(P){P!=="disconnected"&&P!=="suspended"&&P!=="connecting"&&this.cancelSuspendTimer()},X.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},X.prototype.startRetryTimer=function(P){var k=this;this.retryTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),k.retryTimer=null,k.requestState({state:"connecting"})},P)},X.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},X.prototype.notifyState=function(P){var k=this,H,j,te=P.state,fe=te==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||P.retryImmediately||this.state===this.states.connecting&&P.error&&S.default.isTokenErr(P.error)&&!(this.errorReason&&S.default.isTokenErr(this.errorReason)));if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+te+(fe?"; will retry connection immediately":"")),te!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(P.state),(te==="suspended"||te==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var me=this.states[P.state],Ee=me.retryDelay;me.state==="disconnected"&&(this.disconnectedRetryCount++,Ee=l.getRetryTime(me.retryDelay,this.disconnectedRetryCount));var Se=new E.default(this.state.state,me.state,Ee,P.error||((j=(H=w.default)[me.state])===null||j===void 0?void 0:j.call(H)));if(fe){var ze=function(){k.state===k.states.disconnected&&(k.lastAutoReconnectAttempt=l.now(),k.requestState({state:"connecting"}))},de=this.lastAutoReconnectAttempt&&l.now()-this.lastAutoReconnectAttempt+1;de&&de<1e3?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+de+"ms ago, waiting another "+(1e3-de)+"ms before trying again"),setTimeout(ze,1e3-de)):m.default.Config.nextTick(ze)}else(te==="disconnected"||te==="suspended")&&this.startRetryTimer(Ee);(te==="disconnected"&&!fe||te==="suspended"||me.terminal)&&m.default.Config.nextTick(function(){k.disconnectAllTransports()}),te=="connected"&&!this.activeProtocol&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(Se),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(te,Se.reason),this.failQueuedMessages(Se.reason))}},X.prototype.requestState=function(P){var k=this,H,j,te=P.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+te+"; current state: "+this.state.state),te!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(te),!(te=="connecting"&&this.state.state=="connected")&&!(te=="closing"&&this.state.state=="closed"))){var fe=this.states[te],me=new E.default(this.state.state,fe.state,null,P.error||((j=(H=w.default)[fe.state])===null||j===void 0?void 0:j.call(H)));this.enactStateChange(me),te=="connecting"&&m.default.Config.nextTick(function(){k.startConnect()}),te=="closing"&&this.closeImpl()}},X.prototype.startConnect=function(){var P=this;if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var k=this.realtime.auth,H=++this.connectCounter,j=function(){P.checkConnectionStateFreshness(),P.getTransportParams(function(fe){if(fe.mode==="recover"&&fe.options.recover){var me=G(fe.options.recover);me&&P.realtime.channels.recoverChannels(me.channelSerials)}H===P.connectCounter&&P.connectImpl(fe,H)})};if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),k.method==="basic")j();else{var te=function(fe){H===P.connectCounter&&(fe?P.actOnErrorFromAuthorize(fe):j())};this.errorReason&&S.default.isTokenErr(this.errorReason)?k._forceNewToken(null,null,te):k._ensureValidAuthCredentials(!1,te)}},X.prototype.connectImpl=function(P,k){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(P):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(P,k):this.connectBase(P,k)},X.prototype.connectPreference=function(P,k){var H=this,j=this.getTransportPreference(),te=!1;l.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(P,k)),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var fe=setTimeout(function(){te=!0,H.state.state!==H.states.connected.state&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(P,k)},this.options.timeouts.preferenceConnectTimeout);P.host=this.httpHosts[0],this.tryATransport(P,j,function(me,Ee){clearTimeout(fe),te&&Ee?(Ee.off(),Ee.disconnect(),l.arrDeleteValue(H.pendingTransports,Ee)):!Ee&&!me&&(H.unpersistTransportPreference(),H.connectImpl(P,k))})},X.prototype.connectBase=function(P,k){var H=this,j=function(Se){H.notifyState({state:H.states.connecting.failState,error:Se})},te=this.httpHosts.slice(),fe=function(Se,ze){k===H.connectCounter&&!ze&&!Se&&Ee()};h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var me=te.shift();if(!me){j(new x.default("Unable to connect (no available host)",80003,404));return}P.host=me;var Ee=function(){if(!te.length){j(new x.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){j(new x.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(Se,ze){if(k===H.connectCounter){if(Se){j(Se);return}if(!ze){j(new x.default("Unable to connect (network unreachable)",80003,404));return}P.host=l.arrPopRandomElement(te),H.tryATransport(P,H.baseTransport,fe)}})};if(this.forceFallbackHost&&te.length){this.forceFallbackHost=!1,Ee();return}this.tryATransport(P,this.baseTransport,fe)},X.prototype.getUpgradePossibilities=function(){var P=this.activeProtocol.getTransport().shortName,k=l.arrIndexOf(this.upgradeTransports,P);return this.upgradeTransports.slice(k+1)},X.prototype.upgradeIfNeeded=function(P){var k=this,H=this.getUpgradePossibilities();h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(H)),H.length&&l.arrForEach(H,function(j){var te=k.createTransportParams(P.host,"upgrade");k.tryATransport(te,j,I)})},X.prototype.closeImpl=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),l.safeArrForEach(this.pendingTransports,function(P){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+P),P&&P.close()}),l.safeArrForEach(this.proposedTransports,function(P){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+P),P&&P.dispose()}),this.activeProtocol&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},X.prototype.onAuthUpdated=function(P,k){var H=this,j;switch(this.state.state){case"connected":{if(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var te=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(te)})}var fe=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();fe&&fe.onAuthUpdated&&fe.onAuthUpdated(P);var me=a.default.fromValues({action:v.AUTH,auth:{accessToken:P.token}});this.send(me);var Ee=function(){H.off(Se),k(null,P)},Se=function(de){de.current==="failed"&&(H.off(Ee),H.off(Se),k(de.reason||H.getStateError()))};this.once("connectiondetails",Ee),this.on("connectionstate",Se);break}case"connecting":h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var ze=function(de){switch(de.current){case"connected":H.off(ze),k(null,P);break;case"failed":case"closed":case"suspended":H.off(ze),k(de.reason||H.getStateError());break;default:break}};this.on("connectionstate",ze),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},X.prototype.disconnectAllTransports=function(P){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(P?" except the active transport":"")),this.connectCounter++,l.safeArrForEach(this.pendingTransports,function(k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+k),k&&k.disconnect()}),this.pendingTransports=[],l.safeArrForEach(this.proposedTransports,function(k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+k),k&&k.dispose()}),this.proposedTransports=[],this.activeProtocol&&!P&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},X.prototype.send=function(P,k,H){H=H||I;var j=this.state;if(j.sendEvents){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new u.PendingMessage(P,H));return}var te=k&&j.queueEvents||j.forceQueueEvents;if(!te){var fe="rejecting event, queueEvent was "+k+", state was "+j.state;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()",fe),H(this.errorReason||new x.default(fe,9e4,400));return}h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(P)),this.queue(P,H)},X.prototype.sendImpl=function(P){var k=P.message;P.ackRequired&&!P.sendAttempted&&(k.msgSerial=this.msgSerial++);try{this.activeProtocol.send(P)}catch(H){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},X.prototype.queue=function(P,k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),j=this.options.maxMessageSize;H&&!H.sendAttempted&&$(H.message,P,j)?(H.merged||(H.callback=R.default.create([H.callback]),H.merged=!0),H.callback.push(k)):this.queuedMessages.push(new u.PendingMessage(P,k))},X.prototype.sendQueuedMessages=function(){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var P;P=this.queuedMessages.shift();)this.sendImpl(P)},X.prototype.queuePendingMessages=function(P){P&&P.length&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+P.length+" pending messages"),this.queuedMessages.prepend(P))},X.prototype.failQueuedMessages=function(P){var k=this.queuedMessages.count();k>0&&(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+k+" queued messages, err = "+l.inspectError(P)),this.queuedMessages.completeAllMessages(P))},X.prototype.onChannelMessage=function(P,k){var H=this.activeProtocol&&k===this.activeProtocol.getTransport(),j=l.arrIn(this.pendingTransports,k)&&this.state==this.states.synchronizing;H||j?this.realtime.channels.onChannelMessage(P):l.arrIndexOf([v.ACK,v.NACK,v.ERROR],P.action)>-1?this.realtime.channels.onChannelMessage(P):h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(P)+"on defunct transport; discarding")},X.prototype.ping=function(P,k){var H=this;if(P){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+P);var j=function(){P.off("heartbeat",me),k(new x.default("Timeout waiting for heartbeat response",5e4,500))},te=l.now(),fe=l.cheapRandStr(),me=function(Ze){if(Ze===fe){P.off("heartbeat",me),clearTimeout(Ee);var bt=l.now()-te;k(null,bt)}},Ee=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);P.on("heartbeat",me),P.ping(fe);return}if(this.state.state!=="connected"){k(new x.default("Unable to ping service; not connected",4e4,400));return}var Se=!1,ze=function(Ze,bt){H.off("transport.active",de),Se||(Se=!0,k(Ze,bt))},de=function(){Se||(Se=!0,m.default.Config.nextTick(function(){H.ping(null,k)}))};this.on("transport.active",de),this.ping(this.activeProtocol.getTransport(),ze)},X.prototype.abort=function(P){this.activeProtocol.getTransport().fail(P)},X.prototype.registerProposedTransport=function(P){this.proposedTransports.push(P)},X.prototype.getTransportPreference=function(){var P,k;return this.transportPreference||p()&&((k=(P=m.default.WebStorage)===null||P===void 0?void 0:P.get)===null||k===void 0?void 0:k.call(P,U))},X.prototype.persistTransportPreference=function(P){var k,H;l.arrIn(f.default.upgradeTransports,P.shortName)&&(this.transportPreference=P.shortName,p()&&((H=(k=m.default.WebStorage)===null||k===void 0?void 0:k.set)===null||H===void 0||H.call(k,U,P.shortName)))},X.prototype.unpersistTransportPreference=function(){var P,k;this.transportPreference=null,p()&&((k=(P=m.default.WebStorage)===null||P===void 0?void 0:P.remove)===null||k===void 0||k.call(P,U))},X.prototype.actOnErrorFromAuthorize=function(P){if(P.code===40171)this.notifyState({state:"failed",error:P});else if(P.code===40102)this.notifyState({state:"failed",error:P});else if(P.statusCode===d.default.Forbidden){var k="Client configured authentication provider returned 403; failing the connection";h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",k),this.notifyState({state:"failed",error:new x.default(k,80019,403,P)})}else{var k="Client configured authentication provider request failed";h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",k),this.notifyState({state:this.state.failState,error:new x.default(k,80019,401,P)})}},X.prototype.onConnectionDetailsUpdate=function(P,k){if(!!P){this.connectionDetails=P,P.maxMessageSize&&(this.options.maxMessageSize=P.maxMessageSize);var H=P.clientId;if(H){var j=this.realtime.auth._uncheckedSetClientId(H);if(j){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),k.fail(j);return}}var te=P.connectionStateTtl;te&&(this.connectionStateTtl=te),this.maxIdleInterval=P.maxIdleInterval,this.emit("connectiondetails",P)}},X.supportedTransports={},X}(b.default);t.default=ee}).call(this,e(13))},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(7)),a=r.__importDefault(e(2)),l=function(u){r.__extends(f,u);function f(){var m=u.call(this)||this;return m.messages=[],m}return f.prototype.count=function(){return this.messages.length},f.prototype.push=function(m){this.messages.push(m)},f.prototype.shift=function(){return this.messages.shift()},f.prototype.last=function(){return this.messages[this.messages.length-1]},f.prototype.copyAll=function(){return this.messages.slice()},f.prototype.append=function(m){this.messages.push.apply(this.messages,m)},f.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},f.prototype.completeMessages=function(m,b,C){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+b),C=C||null;var h=this.messages;if(h.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=h[0];if(E){var w=E.message.msgSerial,x=m+b;if(x>w)for(var S=h.splice(0,x-w),O=0,R=S;O<R.length;O++){var g=R[O];g.callback(C)}h.length==0&&this.emit("idle")}},f.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},f.prototype.resetSendAttempted=function(){for(var m=0,b=this.messages;m<b.length;m++){var C=b[m];C.sendAttempted=!1}},f.prototype.clear=function(){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},f}(i.default);t.default=l},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(a,l,u,f){this.previous=a,this.current=l,u&&(this.retryIn=u),f&&(this.reason=f)}return i}();t.default=r},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(10)),a=r.__importDefault(e(7)),l=r.__importStar(e(1)),u=r.__importDefault(e(33)),f=r.__importDefault(e(2)),m=r.__importDefault(e(54)),b=r.__importDefault(e(9)),C=r.__importDefault(e(39)),h=r.__importStar(e(4)),E=r.__importDefault(e(15)),w=r.__importDefault(e(20)),x=i.default.Action,S=function(){};function O(g){if(g&&"params"in g&&!l.isObject(g.params))return new h.default("options.params must be an object",4e4,400);if(g&&"modes"in g){if(!l.isArray(g.modes))return new h.default("options.modes must be an array",4e4,400);for(var y=0;y<g.modes.length;y++){var d=g.modes[y];if(!d||typeof d!="string"||!l.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(d)))return new h.default("Invalid channel mode: "+d,4e4,400)}}}var R=function(g){r.__extends(y,g);function y(d,p,T){var v=g.call(this,d,p,T)||this;return v.retryCount=0,v.history=function(I,U){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),U===void 0)if(typeof I=="function")U=I,I=null;else{if(this.rest.options.promises)return l.promisify(this,"history",arguments);U=S}if(I&&I.untilAttach){if(this.state!=="attached"){U(new h.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){U(new h.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete I.untilAttach,I.from_serial=this.properties.attachSerial}u.default.prototype._history.call(this,I,U)},v.whenState=function(I,U){return a.default.prototype.whenState.call(v,I,v.state,U)},f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),v.realtime=d,v.presence=new m.default(v),v.connectionManager=d.connection.connectionManager,v.state="initialized",v.subscriptions=new a.default,v.syncChannelSerial=void 0,v.properties={attachSerial:void 0,channelSerial:void 0},v.setOptions(T),v.errorReason=null,v._requestedFlags=null,v._mode=null,v._attachResume=!1,v._decodingContext={channelOptions:v.channelOptions,plugins:d.options.plugins||{},baseEncodedPreviousPayload:void 0},v._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},v._allChannelChanges=new a.default,v}return y.prototype.invalidStateError=function(){return new h.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},y.processListenerArgs=function(d){return d=Array.prototype.slice.call(d),typeof d[0]=="function"&&d.unshift(null),d[d.length-1]==null&&d.pop(),d},y.prototype.setOptions=function(d,p){if(!p&&this.rest.options.promises)return l.promisify(this,"setOptions",arguments);var T=p||function(I){I&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+I.toString())},v=O(d);if(v){T(v);return}u.default.prototype.setOptions.call(this,d),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(d)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(I){switch(this.event){case"update":case"attached":T==null||T(null);return;default:T==null||T(I.reason);return}})):T()},y.prototype._shouldReattachToSetOptions=function(d){return(this.state==="attached"||this.state==="attaching")&&((d==null?void 0:d.params)||(d==null?void 0:d.modes))},y.prototype.publish=function(){for(var d=this,p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=p[0],I=p.length,U=p[I-1];if(typeof U!="function"){if(this.realtime.options.promises)return l.promisify(this,"publish",arguments);U=S,++I}if(!this.connectionManager.activeState()){U(this.connectionManager.getError());return}if(I==2)if(l.isObject(v))v=[b.default.fromValues(v)];else if(l.isArray(v))v=b.default.fromValuesArray(v);else throw new h.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else v=[b.default.fromValues({name:p[0],data:p[1]})];var z=this.realtime.options.maxMessageSize;b.default.encodeArray(v,this.channelOptions,function(W){if(W){U(W);return}var N=b.default.getMessagesSize(v);if(N>z){U(new h.default("Maximum size of messages that can be published at once exceeded ( was "+N+" bytes; limit is "+z+" bytes)",40009,400));return}d.__publish(v,U)})},y.prototype.__publish=function(d,p){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+d.length);var T=this.state;switch(T){case"failed":case"suspended":p(h.default.fromValues(this.invalidStateError()));break;default:{f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+T);var v=new i.default;v.action=x.MESSAGE,v.channel=this.name,v.messages=d,this.sendMessage(v,p);break}}},y.prototype.onEvent=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,T=0;T<d.length;T++){var v=d[T];p.emit(v.name,v)}},y.prototype.attach=function(d,p){var T;if(typeof d=="function"?(p=d,T=null):T=d,!p){if(this.realtime.options.promises)return l.promisify(this,"attach",arguments);p=function(v){v&&f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+v.toString())}}if(T)f.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=T;else if(this.state==="attached"){p(null,null);return}this._attach(!1,null,p)},y.prototype._attach=function(d,p,T){T||(T=function(I){I&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+I.toString())});var v=this.connectionManager;if(!v.activeState()){T(v.getError());return}(this.state!=="attaching"||d)&&this.requestState("attaching",p),this.once(function(I){switch(this.event){case"attached":T==null||T(null,I);break;case"detached":case"suspended":case"failed":T==null||T(I.reason||v.getError()||new h.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":T==null||T(new h.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},y.prototype.attachImpl=function(){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var d=i.default.fromValues({action:x.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?d.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&d.encodeModesToFlags(l.allToUpperCase(this.channelOptions.modes)),this._attachResume&&d.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(d.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(d,S)},y.prototype.detach=function(d){if(!d){if(this.realtime.options.promises)return l.promisify(this,"detach",arguments);d=S}var p=this.connectionManager;if(!p.activeState()){d(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),d();break;case"detached":d();break;case"failed":d(new h.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(T){switch(this.event){case"detached":d();break;case"attached":case"suspended":case"failed":d(T.reason||p.getError()||new h.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":d(new h.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},y.prototype.detachImpl=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var p=i.default.fromValues({action:x.DETACH,channel:this.name});this.sendMessage(p,d||S)},y.prototype.subscribe=function(){for(var d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];var T=y.processListenerArgs(d),v=T[0],I=T[1],U=T[2];if(!U&&this.realtime.options.promises)return l.promisify(this,"subscribe",[v,I]);if(this.state==="failed"){U==null||U(h.default.fromValues(this.invalidStateError()));return}return v&&typeof v=="object"&&!Array.isArray(v)?this._subscribeFilter(v,I):this.subscriptions.on(v,I),this.attach(U||S)},y.prototype._subscribeFilter=function(d,p){var T=function(v){var I,U,z,W,N,M,L={name:v.name,refTimeserial:(U=(I=v.extras)===null||I===void 0?void 0:I.ref)===null||U===void 0?void 0:U.timeserial,refType:(W=(z=v.extras)===null||z===void 0?void 0:z.ref)===null||W===void 0?void 0:W.type,isRef:!!(!((M=(N=v.extras)===null||N===void 0?void 0:N.ref)===null||M===void 0)&&M.timeserial),clientId:v.clientId};Object.entries(d).find(function($){var G=$[0],J=$[1];return J!==void 0?L[G]!==J:!1})||p(v)};this._addFilteredSubscription(d,p,T),this.subscriptions.on(T)},y.prototype._addFilteredSubscription=function(d,p,T){var v;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var I=this.filteredSubscriptions.get(p);I.set(d,((v=I==null?void 0:I.get(d))===null||v===void 0?void 0:v.concat(T))||[T])}else this.filteredSubscriptions.set(p,new Map([[d,[T]]]))},y.prototype._getAndDeleteFilteredSubscriptions=function(d,p){var T=this;if(!this.filteredSubscriptions)return[];if(!p&&d)return Array.from(this.filteredSubscriptions.entries()).map(function(z){var W,N=z[0],M=z[1],L=M.get(d);return M.delete(d),M.size===0&&((W=T.filteredSubscriptions)===null||W===void 0||W.delete(N)),L}).reduce(function(z,W){var N;return W?(N=z).concat.apply(N,W):z},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var v=this.filteredSubscriptions.get(p);if(!d){var I=Array.from(v.values()).reduce(function(z,W){return z.concat.apply(z,W)},[]);return this.filteredSubscriptions.delete(p),I}var U=v.get(d);return v.delete(d),U||[]},y.prototype.unsubscribe=function(){for(var d=this,p,T=[],v=0;v<arguments.length;v++)T[v]=arguments[v];var I=y.processListenerArgs(T),U=I[0],z=I[1];if(typeof U=="object"&&!z||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(z))){this._getAndDeleteFilteredSubscriptions(U,z).forEach(function(W){return d.subscriptions.off(W)});return}this.subscriptions.off(U,z)},y.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new h.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var d=this.connectionManager;if(!d.activeState())throw d.getError();var p=i.default.fromValues({action:x.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),d.send(p)},y.prototype.sendMessage=function(d,p){this.connectionManager.send(d,this.realtime.options.queueMessages,p)},y.prototype.sendPresence=function(d,p){var T=i.default.fromValues({action:x.PRESENCE,channel:this.name,presence:l.isArray(d)?E.default.fromValuesArray(d):[E.default.fromValues(d)]});this.sendMessage(T,p)},y.prototype.onMessage=function(d){(d.action===x.ATTACHED||d.action===x.MESSAGE||d.action===x.PRESENCE)&&this.setChannelSerial(d.channelSerial);var p,T=!1;switch(d.action){case x.ATTACHED:{this.properties.attachSerial=d.channelSerial,this._mode=d.getMode(),this.params=d.params||{};var v=d.decodeModesFromFlags();this.modes=v&&l.allToLowerCase(v)||void 0;var I=d.hasFlag("RESUMED"),U=d.hasFlag("HAS_PRESENCE"),z=d.hasFlag("HAS_BACKLOG");if(this.state==="attached"){I||this.presence.onAttached(U);var W=new C.default(this.state,this.state,I,z,d.error);this._allChannelChanges.emit("update",W),(!I||this.channelOptions.updateOnAttached)&&this.emit("update",W)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",d.error,I,U,z);break}case x.DETACHED:{var N=d.error?h.default.fromValues(d.error):new h.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",N):this.state==="attaching"?this.notifyState("suspended",N):this.requestState("attaching",N);break}case x.SYNC:if(T=!0,p=this.syncChannelSerial=d.channelSerial,!d.presence)break;case x.PRESENCE:{for(var M=d.presence,L=d.id,$=d.connectionId,G=d.timestamp,J=this.channelOptions,ee=void 0,re=0;re<M.length;re++)try{ee=M[re],E.default.decode(ee,J),ee.connectionId||(ee.connectionId=$),ee.timestamp||(ee.timestamp=G),ee.id||(ee.id=L+":"+re)}catch(te){f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",te.toString())}this.presence.setPresence(M,T,p);break}case x.MESSAGE:{if(this.state!=="attached"){f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+d.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var X=d.messages,P=X[0],k=X[X.length-1],L=d.id,$=d.connectionId,G=d.timestamp;if(P.extras&&P.extras.delta&&P.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+d.id+'" on this channel "'+this.name+'".';f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new h.default(H,40018,400));break}for(var re=0;re<X.length;re++){var H=X[re];try{b.default.decode(H,this._decodingContext)}catch(ze){switch(f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",ze.toString()),ze.code){case 40018:this._startDecodeFailureRecovery(ze);return;case 40019:case 40021:this.notifyState("failed",ze);return}}H.connectionId||(H.connectionId=$),H.timestamp||(H.timestamp=G),H.id||(H.id=L+":"+re)}this._lastPayload.messageId=k.id,this._lastPayload.protocolMessageChannelSerial=d.channelSerial,this.onEvent(X);break}case x.ERROR:{var j=d.error;j&&j.code==80016?this.checkPendingState():this.notifyState("failed",h.default.fromValues(j));break}default:f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+d.action+")"),this.connectionManager.abort(w.default.unknownChannelErr())}},y.prototype._startDecodeFailureRecovery=function(d){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,d,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},y.prototype.onAttached=function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},y.prototype.notifyState=function(d,p,T,v,I){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+d),this.clearStateTimer(),l.arrIn(["detached","suspended","failed"],d)&&(this.properties.channelSerial=null),d!==this.state){this.presence.actOnChannelState(d,v,p),d==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var U=new C.default(this.state,d,T,I,p),z=d==="failed"?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(z,'Channel state for channel "'+this.name+'"',d+(p?"; reason: "+p:"")),d!=="attaching"&&d!=="suspended"&&(this.retryCount=0),d==="attached"&&this.onAttached(),d==="attached"?this._attachResume=!0:(d==="detaching"||d==="failed")&&(this._attachResume=!1),this.state=d,this._allChannelChanges.emit(d,U),this.emit(d,U)}},y.prototype.requestState=function(d,p){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+d),this.notifyState(d,p),this.checkPendingState()},y.prototype.checkPendingState=function(){var d=this.connectionManager.state;if(!(d.sendEvents||d.forceQueueEvents)){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},y.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var d=new h.default("Channel attach timed out",90007,408);this.notifyState("suspended",d);break}case"detaching":{var d=new h.default("Channel detach timed out",90007,408);this.notifyState("attached",d);break}default:this.checkPendingState();break}},y.prototype.startStateTimerIfNotRunning=function(){var d=this;this.stateTimer||(this.stateTimer=setTimeout(function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),d.stateTimer=null,d.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},y.prototype.clearStateTimer=function(){var d=this.stateTimer;d&&(clearTimeout(d),this.stateTimer=null)},y.prototype.startRetryTimer=function(){var d=this;if(!this.retryTimer){this.retryCount++;var p=l.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){d.state==="suspended"&&d.connectionManager.state.sendEvents&&(d.retryTimer=null,f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),d.requestState("attaching"))},p)}},y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},y.prototype.getReleaseErr=function(){var d=this.state;return d==="initialized"||d==="detached"||d==="failed"?null:new h.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+d,90001,400)},y.prototype.setChannelSerial=function(d){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+d+"; previous = "+this.properties.channelSerial),d&&(this.properties.channelSerial=d)},y}(u.default);t.default=R},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(a,l,u,f,m){this.previous=a,this.current=l,l==="attached"&&(this.resumed=u,this.hasBacklog=f),m&&(this.reason=m)}return i}();t.default=r},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=a.Hasher,f=i.algo,m=[],b=f.SHA1=u.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,h){for(var E=this._hash.words,w=E[0],x=E[1],S=E[2],O=E[3],R=E[4],g=0;g<80;g++){if(g<16)m[g]=C[h+g]|0;else{var y=m[g-3]^m[g-8]^m[g-14]^m[g-16];m[g]=y<<1|y>>>31}var d=(w<<5|w>>>27)+R+m[g];g<20?d+=(x&S|~x&O)+1518500249:g<40?d+=(x^S^O)+1859775393:g<60?d+=(x&S|x&O|S&O)-1894007588:d+=(x^S^O)-899497514,R=O,O=S,S=x<<30|x>>>2,x=w,w=d}E[0]=E[0]+w|0,E[1]=E[1]+x|0,E[2]=E[2]+S|0,E[3]=E[3]+O|0,E[4]=E[4]+R|0},_doFinalize:function(){var C=this._data,h=C.words,E=this._nDataBytes*8,w=C.sigBytes*8;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=Math.floor(E/4294967296),h[(w+64>>>9<<4)+15]=E,C.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var C=u.clone.call(this);return C._hash=this._hash.clone(),C}});i.SHA1=u._createHelper(b),i.HmacSHA1=u._createHmacHelper(b)}(),r.SHA1})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function r(g){if(g===void 0)return"undefined";var y,d;if(g instanceof ArrayBuffer?(d="ArrayBuffer",y=new DataView(g)):g instanceof DataView&&(d="DataView",y=g),!y)return JSON.stringify(g);for(var p=[],T=0;T<g.byteLength;T++){if(T>20){p.push("...");break}var v=y.getUint8(T).toString(16);v.length===1&&(v="0"+v),p.push(v)}return"<"+d+" "+p.join(" ")+">"}function i(g,y,d){for(var p=0,T=d.length;p<T;p++){var v=d.charCodeAt(p);if(v<128){g.setUint8(y++,v>>>0&127|0);continue}if(v<2048){g.setUint8(y++,v>>>6&31|192),g.setUint8(y++,v>>>0&63|128);continue}if(v<65536){g.setUint8(y++,v>>>12&15|224),g.setUint8(y++,v>>>6&63|128),g.setUint8(y++,v>>>0&63|128);continue}if(v<1114112){g.setUint8(y++,v>>>18&7|240),g.setUint8(y++,v>>>12&63|128),g.setUint8(y++,v>>>6&63|128),g.setUint8(y++,v>>>0&63|128);continue}throw new Error("bad codepoint "+v)}}function a(g,y,d){for(var p="",T=y,v=y+d;T<v;T++){var I=g.getUint8(T);if((I&128)===0){p+=String.fromCharCode(I);continue}if((I&224)===192){p+=String.fromCharCode((I&15)<<6|g.getUint8(++T)&63);continue}if((I&240)===224){p+=String.fromCharCode((I&15)<<12|(g.getUint8(++T)&63)<<6|(g.getUint8(++T)&63)<<0);continue}if((I&248)===240){p+=String.fromCharCode((I&7)<<18|(g.getUint8(++T)&63)<<12|(g.getUint8(++T)&63)<<6|(g.getUint8(++T)&63)<<0);continue}throw new Error("Invalid byte "+I.toString(16))}return p}function l(g){for(var y=0,d=0,p=g.length;d<p;d++){var T=g.charCodeAt(d);if(T<128){y+=1;continue}if(T<2048){y+=2;continue}if(T<65536){y+=3;continue}if(T<1114112){y+=4;continue}throw new Error("bad codepoint "+T)}return y}function u(g,y){var d=R(g,y);if(d!==0){var p=new ArrayBuffer(d),T=new DataView(p);return O(g,T,0,y),p}}var f=(1<<16)*(1<<16),m=1/f;function b(g,y){return y=y||0,g.getInt32(y)*f+g.getUint32(y+4)}function C(g,y){return y=y||0,g.getUint32(y)*f+g.getUint32(y+4)}function h(g,y,d){d<9223372036854776e3?(g.setInt32(y,Math.floor(d*m)),g.setInt32(y+4,d&-1)):(g.setUint32(y,2147483647),g.setUint32(y+4,2147483647))}function E(g,y,d){d<18446744073709552e3?(g.setUint32(y,Math.floor(d*m)),g.setInt32(y+4,d&-1)):(g.setUint32(y,4294967295),g.setUint32(y+4,4294967295))}var w=function(){function g(y,d){var p=this;this.map=function(T){for(var v={},I=0;I<T;I++){var U=p.parse();v[U]=p.parse()}return v},this.bin=function(T){var v=new ArrayBuffer(T);return new Uint8Array(v).set(new Uint8Array(p.view.buffer,p.offset,T),0),p.offset+=T,v},this.buf=this.bin,this.str=function(T){var v=a(p.view,p.offset,T);return p.offset+=T,v},this.array=function(T){for(var v=new Array(T),I=0;I<T;I++)v[I]=p.parse();return v},this.ext=function(T){return p.offset+=T,{type:p.view.getInt8(p.offset),data:p.buf(T)}},this.parse=function(){var T=p.view.getUint8(p.offset),v,I;if((T&128)===0)return p.offset++,T;if((T&240)===128)return I=T&15,p.offset++,p.map(I);if((T&240)===144)return I=T&15,p.offset++,p.array(I);if((T&224)===160)return I=T&31,p.offset++,p.str(I);if((T&224)===224)return v=p.view.getInt8(p.offset),p.offset++,v;switch(T){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(I);case 197:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(I);case 198:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(I);case 199:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(I);case 200:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(I);case 201:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(I);case 202:return v=p.view.getFloat32(p.offset+1),p.offset+=5,v;case 203:return v=p.view.getFloat64(p.offset+1),p.offset+=9,v;case 204:return v=p.view.getUint8(p.offset+1),p.offset+=2,v;case 205:return v=p.view.getUint16(p.offset+1),p.offset+=3,v;case 206:return v=p.view.getUint32(p.offset+1),p.offset+=5,v;case 207:return v=C(p.view,p.offset+1),p.offset+=9,v;case 208:return v=p.view.getInt8(p.offset+1),p.offset+=2,v;case 209:return v=p.view.getInt16(p.offset+1),p.offset+=3,v;case 210:return v=p.view.getInt32(p.offset+1),p.offset+=5,v;case 211:return v=b(p.view,p.offset+1),p.offset+=9,v;case 212:return I=1,p.offset++,p.ext(I);case 213:return I=2,p.offset++,p.ext(I);case 214:return I=4,p.offset++,p.ext(I);case 215:return I=8,p.offset++,p.ext(I);case 216:return I=16,p.offset++,p.ext(I);case 217:return I=p.view.getUint8(p.offset+1),p.offset+=2,p.str(I);case 218:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.str(I);case 219:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.str(I);case 220:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.array(I);case 221:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.array(I);case 222:return I=p.view.getUint16(p.offset+1),p.offset+=3,p.map(I);case 223:return I=p.view.getUint32(p.offset+1),p.offset+=5,p.map(I)}throw new Error("Unknown type 0x"+T.toString(16))},this.offset=d||0,this.view=y}return g}();function x(g){var y=new DataView(g),d=new w(y),p=d.parse();if(d.offset!==g.byteLength)throw new Error(g.byteLength-d.offset+" trailing bytes");return p}function S(g,y){return Object.keys(g).filter(function(d){var p=g[d],T=typeof p;return(!y||p!=null)&&(T!=="function"||!!p.toJSON)})}function O(g,y,d,p){var T=typeof g;if(typeof g=="string"){var v=l(g);if(v<32)return y.setUint8(d,v|160),i(y,d+1,g),1+v;if(v<256)return y.setUint8(d,217),y.setUint8(d+1,v),i(y,d+2,g),2+v;if(v<65536)return y.setUint8(d,218),y.setUint16(d+1,v),i(y,d+3,g),3+v;if(v<4294967296)return y.setUint8(d,219),y.setUint32(d+1,v),i(y,d+5,g),5+v}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var I=g.byteLength;if(I<256)return y.setUint8(d,196),y.setUint8(d+1,I),new Uint8Array(y.buffer).set(new Uint8Array(g),d+2),2+I;if(I<65536)return y.setUint8(d,197),y.setUint16(d+1,I),new Uint8Array(y.buffer).set(new Uint8Array(g),d+3),3+I;if(I<4294967296)return y.setUint8(d,198),y.setUint32(d+1,I),new Uint8Array(y.buffer).set(new Uint8Array(g),d+5),5+I}if(typeof g=="number"){if(Math.floor(g)!==g)return y.setUint8(d,203),y.setFloat64(d+1,g),9;if(g>=0){if(g<128)return y.setUint8(d,g),1;if(g<256)return y.setUint8(d,204),y.setUint8(d+1,g),2;if(g<65536)return y.setUint8(d,205),y.setUint16(d+1,g),3;if(g<4294967296)return y.setUint8(d,206),y.setUint32(d+1,g),5;if(g<18446744073709552e3)return y.setUint8(d,207),E(y,d+1,g),9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return y.setInt8(d,g),1;if(g>=-128)return y.setUint8(d,208),y.setInt8(d+1,g),2;if(g>=-32768)return y.setUint8(d,209),y.setInt16(d+1,g),3;if(g>=-2147483648)return y.setUint8(d,210),y.setInt32(d+1,g),5;if(g>=-9223372036854776e3)return y.setUint8(d,211),h(y,d+1,g),9;throw new Error("Number too small -0x"+(-g).toString(16).substr(1))}if(T==="undefined")return p?0:(y.setUint8(d,212),y.setUint8(d+1,0),y.setUint8(d+2,0),3);if(g===null)return p?0:(y.setUint8(d,192),1);if(T==="boolean")return y.setUint8(d,g?195:194),1;if(typeof g.toJSON=="function")return O(g.toJSON(),y,d,p);if(T==="object"){var U,z=0,W=void 0,N=Array.isArray(g);if(N?U=g.length:(W=S(g,p),U=W.length),U<16?(y.setUint8(d,U|(N?144:128)),z=1):U<65536?(y.setUint8(d,N?220:222),y.setUint16(d+1,U),z=3):U<4294967296&&(y.setUint8(d,N?221:223),y.setUint32(d+1,U),z=5),N)for(var M=0;M<U;M++)z+=O(g[M],y,d+z,p);else if(W)for(var M=0;M<U;M++){var L=W[M];z+=O(L,y,d+z),z+=O(g[L],y,d+z,p)}return z}if(T==="function")return 0;throw new Error("Unknown type "+T)}function R(g,y){var d=typeof g;if(d==="string"){var p=l(g);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(g)&&(g=g.buffer),g instanceof ArrayBuffer){var T=g.byteLength;if(T<256)return 2+T;if(T<65536)return 3+T;if(T<4294967296)return 5+T}if(typeof g=="number"){if(Math.floor(g)!==g)return 9;if(g>=0){if(g<128)return 1;if(g<256)return 2;if(g<65536)return 3;if(g<4294967296)return 5;if(g<18446744073709552e3)return 9;throw new Error("Number too big 0x"+g.toString(16))}if(g>=-32)return 1;if(g>=-128)return 2;if(g>=-32768)return 3;if(g>=-2147483648)return 5;if(g>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+g.toString(16).substr(1))}if(d==="boolean")return 1;if(g===null)return y?0:1;if(g===void 0)return y?0:3;if(typeof g.toJSON=="function")return R(g.toJSON(),y);if(d==="object"){var v,I=0;if(Array.isArray(g)){v=g.length;for(var U=0;U<v;U++)I+=R(g[U],y)}else{var z=S(g,y);v=z.length;for(var U=0;U<v;U++){var W=z[U];I+=R(W)+R(g[W],y)}}if(v<16)return 1+I;if(v<65536)return 3+I;if(v<4294967296)return 5+I;throw new Error("Array or object too long 0x"+v.toString(16))}if(d==="function")return 0;throw new Error("Unknown type "+d)}t.default={encode:u,decode:x,inspect:r,utf8Write:i,utf8Read:a,utf8ByteCount:l}},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(30)),a=r.__importDefault(e(50)),l=r.__importDefault(e(3)),u=r.__importDefault(e(4)),f=r.__importDefault(e(55)),m=r.__importDefault(e(57)),b=r.__importDefault(e(62)),C=r.__importDefault(e(64)),h=r.__importDefault(e(68)),E=r.__importDefault(e(2)),w=e(8),x=r.__importDefault(e(65)),S=r.__importDefault(e(66)),O=r.__importDefault(e(41)),R=(0,m.default)(C.default,f.default);l.default.Crypto=R,l.default.BufferUtils=f.default,l.default.Http=b.default,l.default.Config=C.default,l.default.Transports=h.default,l.default.WebStorage=x.default,i.default.Crypto=R,a.default.Crypto=R,E.default.initLogHandlers(),l.default.Defaults=(0,w.getDefaults)(S.default),l.default.Config.agent&&(l.default.Defaults.agent+=" "+l.default.Config.agent),l.default.Config.noUpgrade&&(l.default.Defaults.upgradeTransports=[]),t.default={ErrorInfo:u.default,Rest:i.default,Realtime:a.default,msgpack:O.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(s,t){},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(32),e(24))})(this,function(r){return r.HmacSHA256})},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(47)),l=r.__importDefault(e(14)),u=r.__importDefault(e(19)),f=r.__importDefault(e(4)),m=r.__importDefault(e(48)),b=function(){},C=function(){function x(S){this.rest=S,this.admin=new h(S)}return x}(),h=function(){function x(S){this.rest=S,this.deviceRegistrations=new E(S),this.channelSubscriptions=new w(S)}return x.prototype.publish=function(S,O,R){var g=this.rest,y=g.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(g.options,y),p={},T=i.mixin({recipient:S},O);if(typeof R!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);R=b}g.options.headers&&i.mixin(d,g.options.headers),g.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var v=i.encodeBody(T,y);l.default.post(g,"/push/publish",v,d,p,null,function(I){return R(I)})},x}(),E=function(){function x(S){this.rest=S}return x.prototype.save=function(S,O){var R=this.rest,g=a.default.fromValues(S),y=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(R.options,y),p={};if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);O=b}R.options.headers&&i.mixin(d,R.options.headers),R.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var T=i.encodeBody(g,y);l.default.put(R,"/push/deviceRegistrations/"+encodeURIComponent(S.id),T,d,p,null,function(v,I,U,z){O(v,v?void 0:a.default.fromResponseBody(I,z?void 0:y))})},x.prototype.get=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(R.options,g),d=S.id||S;if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);O=b}if(typeof d!="string"||!d.length){O(new f.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&i.mixin(y,R.options.headers),l.default.get(R,"/push/deviceRegistrations/"+encodeURIComponent(d),y,{},null,function(p,T,v,I){O(p,p?void 0:a.default.fromResponseBody(T,I?void 0:g))})},x.prototype.list=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(R.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);O=b}R.options.headers&&i.mixin(d,R.options.headers),new u.default(R,"/push/deviceRegistrations",d,y,function(p,T,v){return a.default.fromResponseBody(p,v?void 0:g)}).get(S,O)},x.prototype.remove=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(R.options,g),d={},p=S.id||S;if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);O=b}if(typeof p!="string"||!p.length){O(new f.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&i.mixin(y,R.options.headers),R.options.pushFullWait&&i.mixin(d,{fullWait:"true"}),l.default.delete(R,"/push/deviceRegistrations/"+encodeURIComponent(p),y,d,null,function(T){return O(T)})},x.prototype.removeWhere=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(R.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);O=b}R.options.headers&&i.mixin(y,R.options.headers),R.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),l.default.delete(R,"/push/deviceRegistrations",y,S,null,function(d){return O(d)})},x}(),w=function(){function x(S){this.remove=x.prototype.removeWhere,this.rest=S}return x.prototype.save=function(S,O){var R=this.rest,g=m.default.fromValues(S),y=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=i.defaultPostHeaders(R.options,y),p={};if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);O=b}R.options.headers&&i.mixin(d,R.options.headers),R.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var T=i.encodeBody(g,y);l.default.post(R,"/push/channelSubscriptions",T,d,p,null,function(v,I,U,z){O(v,!v&&m.default.fromResponseBody(I,z?void 0:y))})},x.prototype.list=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(R.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);O=b}R.options.headers&&i.mixin(d,R.options.headers),new u.default(R,"/push/channelSubscriptions",d,y,function(p,T,v){return m.default.fromResponseBody(p,v?void 0:g)}).get(S,O)},x.prototype.removeWhere=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=i.defaultGetHeaders(R.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);O=b}R.options.headers&&i.mixin(y,R.options.headers),R.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),l.default.delete(R,"/push/channelSubscriptions",y,S,null,function(d){return O(d)})},x.prototype.listChannels=function(S,O){var R=this.rest,g=R.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:g,d=i.defaultGetHeaders(R.options,g);if(typeof O!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);O=b}R.options.headers&&i.mixin(d,R.options.headers),R.options.pushFullWait&&i.mixin(S,{fullWait:"true"}),new u.default(R,"/push/channels",d,y,function(p,T,v){for(var I=!v&&g?i.decodeBody(p,g):p,U=0;U<I.length;U++)I[U]=String(I[U]);return I}).get(S,O)},x}();t.default=C},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(4)),l;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(l||(l={}));var u;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(u||(u={}));var f=function(){function m(){}return m.prototype.toJSON=function(){var b,C,h;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(b=this.push)===null||b===void 0?void 0:b.recipient,state:(C=this.push)===null||C===void 0?void 0:C.state,error:(h=this.push)===null||h===void 0?void 0:h.error}}},m.prototype.toString=function(){var b,C,h,E,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((b=this.push)===null||b===void 0)&&b.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((C=this.push)===null||C===void 0)&&C.state&&(w+="; push.state="+this.push.state),!((h=this.push)===null||h===void 0)&&h.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},m.fromResponseBody=function(b,C){return C&&(b=i.decodeBody(b,C)),i.isArray(b)?m.fromValuesArray(b):m.fromValues(b)},m.fromValues=function(b){return b.error=b.error&&a.default.fromValues(b.error),Object.assign(new m,b)},m.fromValuesArray=function(b){for(var C=b.length,h=new Array(C),E=0;E<C;E++)h[E]=m.fromValues(b[E]);return h},m.toRequestBody=i.encodeBody,m}();t.default=f},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=function(){function l(){}return l.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},l.prototype.toString=function(){var u="[PushChannelSubscription";return this.channel&&(u+="; channel="+this.channel),this.deviceId&&(u+="; deviceId="+this.deviceId),this.clientId&&(u+="; clientId="+this.clientId),u+="]",u},l.fromResponseBody=function(u,f){return f&&(u=i.decodeBody(u,f)),i.isArray(u)?l.fromValuesArray(u):l.fromValues(u)},l.fromValues=function(u){return Object.assign(new l,u)},l.fromValuesArray=function(u){for(var f=u.length,m=new Array(f),b=0;b<f;b++)m[b]=l.fromValues(u[b]);return m},l.toRequestBody=i.encodeBody,l}();t.default=a},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=function(){function R(g){this.count=g&&g.count||0,this.data=g&&g.data||0,this.uncompressedData=g&&g.uncompressedData||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return R}(),l=function(R){r.__extends(g,R);function g(y){var d=R.call(this,y)||this;return y&&y.category&&(d.category={},i.forInOwnNonNullProperties(y.category,function(p){d.category[p]=new a(y.category[p])})),d}return g}(a),u=function(){function R(g){this.peak=g&&g.peak||0,this.min=g&&g.min||0,this.mean=g&&g.mean||0,this.opened=g&&g.opened||0,this.refused=g&&g.refused||0}return R}(),f=function(){function R(g){this.succeeded=g&&g.succeeded||0,this.failed=g&&g.failed||0,this.refused=g&&g.refused||0}return R}(),m=function(){function R(g){this.plain=new u(g&&g.plain),this.tls=new u(g&&g.tls),this.all=new u(g&&g.all)}return R}(),b=function(){function R(g){this.messages=new l(g&&g.messages),this.presence=new l(g&&g.presence),this.all=new l(g&&g.all)}return R}(),C=function(){function R(g){this.realtime=new b(g&&g.realtime),this.rest=new b(g&&g.rest),this.webhook=new b(g&&g.webhook),this.sharedQueue=new b(g&&g.sharedQueue),this.externalQueue=new b(g&&g.externalQueue),this.httpEvent=new b(g&&g.httpEvent),this.push=new b(g&&g.push),this.all=new b(g&&g.all)}return R}(),h=function(){function R(g){this.all=new b(g&&g.all),this.inbound=new C(g&&g.inbound),this.outbound=new C(g&&g.outbound)}return R}(),E=function(){function R(g){this.all=new b(g&&g.all),this.producerPaid=new h(g&&g.producerPaid),this.consumerPaid=new h(g&&g.consumerPaid)}return R}(),w=function(){function R(g){this.messages=g&&g.messages||0;var y=g&&g.notifications;this.notifications={invalid:y&&y.invalid||0,attempted:y&&y.attempted||0,successful:y&&y.successful||0,failed:y&&y.failed||0},this.directPublishes=g&&g.directPublishes||0}return R}(),x=function(){function R(g){this.succeeded=g&&g.succeeded||0,this.skipped=g&&g.skipped||0,this.failed=g&&g.failed||0}return R}(),S=function(){function R(g){var y=this;this.delta=void 0,g&&g.delta&&(this.delta={},i.forInOwnNonNullProperties(g.delta,function(d){y.delta[d]=new x(g.delta[d])}))}return R}(),O=function(R){r.__extends(g,R);function g(y){var d=R.call(this,y)||this;return d.persisted=new b(y&&y.persisted),d.connections=new m(y&&y.connections),d.channels=new u(y&&y.channels),d.apiRequests=new f(y&&y.apiRequests),d.tokenRequests=new f(y&&y.tokenRequests),d.xchgProducer=new E(y&&y.xchgProducer),d.xchgConsumer=new E(y&&y.xchgConsumer),d.push=new w(y&&y.pushStats),d.processed=new S(y&&y.processed),d.inProgress=y&&y.inProgress||void 0,d.unit=y&&y.unit||void 0,d.intervalId=y&&y.intervalId||void 0,d}return g.fromValues=function(y){return new g(y)},g}(h);t.default=O},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(30)),l=r.__importDefault(e(7)),u=r.__importDefault(e(2)),f=r.__importDefault(e(51)),m=r.__importDefault(e(38)),b=r.__importDefault(e(8)),C=r.__importDefault(e(4)),h=r.__importDefault(e(10)),E=r.__importDefault(e(35)),w=r.__importDefault(e(3)),x=r.__importDefault(e(9)),S=function(R){r.__extends(g,R);function g(y){var d=R.call(this,y)||this;return u.default.logAction(u.default.LOG_MINOR,"Realtime()",""),d.connection=new f.default(d,d.options),d.channels=new O(d),y.autoConnect!==!1&&d.connect(),d}return g.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},g.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},g.Promise=function(y){return y=b.default.objectifyOptions(y),y.promises=!0,new g(y)},g.Callbacks=g,g.Utils=i,g.ConnectionManager=E.default,g.Platform=w.default,g.ProtocolMessage=h.default,g.Message=x.default,g}(a.default),O=function(R){r.__extends(g,R);function g(y){var d=R.call(this)||this;return d.realtime=y,d.all=Object.create(null),y.connection.connectionManager.on("transport.active",function(){d.onTransportActive()}),d}return g.prototype.channelSerials=function(){for(var y={},d=0,p=i.keysArray(this.all,!0);d<p.length;d++){var T=p[d],v=this.all[T];v.properties.channelSerial&&(y[T]=v.properties.channelSerial)}return y},g.prototype.recoverChannels=function(y){for(var d=0,p=i.keysArray(y,!0);d<p.length;d++){var T=p[d],v=this.get(T);v.properties.channelSerial=y[T]}},g.prototype.onChannelMessage=function(y){var d=y.channel;if(d===void 0){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+y.action);return}var p=this.all[d];if(!p){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+d);return}p.onMessage(y)},g.prototype.onTransportActive=function(){for(var y in this.all){var d=this.all[y];d.state==="attaching"||d.state==="detaching"?d.checkPendingState():d.state==="suspended"?d._attach(!1,null):d.state==="attached"&&d.requestState("attaching")}},g.prototype.propogateConnectionInterruption=function(y,d){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},T=["attaching","attached","detaching","suspended"],v=p[y];for(var I in this.all){var U=this.all[I];i.arrIn(T,U.state)&&U.notifyState(v,d)}},g.prototype.get=function(y,d){y=String(y);var p=this.all[y];if(!p)p=this.all[y]=new m.default(this.realtime,y,d);else if(d){if(p._shouldReattachToSetOptions(d))throw new C.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(d)}return p},g.prototype.getDerived=function(y,d,p){if(d.filter){var T=i.toBase64(d.filter),v=i.matchDerivedChannel(y);y="[filter=".concat(T).concat(v.qualifierParam,"]").concat(v.channelName)}return this.get(y,p)},g.prototype.release=function(y){y=String(y);var d=this.all[y];if(!!d){var p=d.getReleaseErr();if(p)throw p;delete this.all[y]}},g}(l.default);t.default=S},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(7)),l=r.__importDefault(e(35)),u=r.__importDefault(e(2)),f=r.__importDefault(e(37)),m=r.__importDefault(e(3));function b(){}var C=function(h){r.__extends(E,h);function E(w,x){var S=h.call(this)||this;return S.whenState=function(O,R){return a.default.prototype.whenState.call(S,O,S.state,R,new f.default(void 0,O))},S.ably=w,S.connectionManager=new l.default(w,x),S.state=S.connectionManager.state.state,S.key=void 0,S.id=void 0,S.errorReason=null,S.connectionManager.on("connectionstate",function(O){var R=S.state=O.current;m.default.Config.nextTick(function(){S.emit(R,O)})}),S.connectionManager.on("update",function(O){m.default.Config.nextTick(function(){S.emit("update",O)})}),S}return E.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(w){if(u.default.logAction(u.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);w=b}this.connectionManager.ping(null,w)},E.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(E.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),E.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},E}(a.default);t.default=C},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PendingMessage=void 0;var r=e(0),i=r.__importDefault(e(10)),a=r.__importStar(e(1)),l=r.__importDefault(e(7)),u=r.__importDefault(e(2)),f=r.__importDefault(e(36)),m=r.__importDefault(e(4)),b=i.default.Action,C=function(){function E(w,x){this.message=w,this.callback=x,this.merged=!1;var S=w.action;this.sendAttempted=!1,this.ackRequired=S==b.MESSAGE||S==b.PRESENCE}return E}();t.PendingMessage=C;var h=function(E){r.__extends(w,E);function w(x){var S=E.call(this)||this;return S.transport=x,S.messageQueue=new f.default,x.on("ack",function(O,R){S.onAck(O,R)}),x.on("nack",function(O,R,g){S.onNack(O,R,g)}),S}return w.prototype.onAck=function(x,S){u.default.logAction(u.default.LOG_MICRO,"Protocol.onAck()","serial = "+x+"; count = "+S),this.messageQueue.completeMessages(x,S)},w.prototype.onNack=function(x,S,O){u.default.logAction(u.default.LOG_ERROR,"Protocol.onNack()","serial = "+x+"; count = "+S+"; err = "+a.inspectError(O)),O||(O=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(x,S,O)},w.prototype.onceIdle=function(x){var S=this.messageQueue;if(S.count()===0){x();return}S.once("idle",x)},w.prototype.send=function(x){x.ackRequired&&this.messageQueue.push(x),u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(x.message)),x.sendAttempted=!0,this.transport.send(x.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var x=this.transport;this.onceIdle(function(){x.disconnect()})},w}(l.default);t.default=h},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(3)),a=r.__importStar(e(1)),l=r.__importDefault(e(26)),u=r.__importDefault(e(8)),f=r.__importDefault(e(2)),m=r.__importDefault(e(10)),b=r.__importDefault(e(4)),C="web_socket";function h(x){return!!x.on}var E=function(x){r.__extends(S,x);function S(O,R,g){var y=x.call(this,O,R,g)||this;return y.shortName=C,g.heartbeats=i.default.Config.useProtocolHeartbeats,y.wsHost=u.default.getHost(g.options,g.host,!0),y}return S.isAvailable=function(){return!!i.default.Config.WebSocket},S.prototype.createWebSocket=function(O,R){return this.uri=O+a.toQueryString(R),new i.default.Config.WebSocket(this.uri)},S.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},S.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),l.default.prototype.connect.call(this);var O=this,R=this.params,g=R.options,y=g.tls?"wss://":"ws://",d=y+this.wsHost+":"+u.default.getPort(g)+"/";f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+d),this.auth.getAuthParams(function(p,T){if(!O.isDisposed){var v="";for(var I in T)v+=" "+I+": "+T[I]+";";if(f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+v+" err: "+p),p){O.disconnect(p);return}var U=R.getConnectParams(T);try{var z=O.wsConnection=O.createWebSocket(d,U);z.binaryType=i.default.Config.binaryType,z.onopen=function(){O.onWsOpen()},z.onclose=function(W){O.onWsClose(W)},z.onmessage=function(W){O.onWsData(W.data)},z.onerror=function(W){O.onWsError(W)},h(z)&&z.on("ping",function(){O.onActivity()})}catch(W){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(W.stack||W.message)),O.disconnect(W)}}})},S.prototype.send=function(O){var R=this.wsConnection;if(!R){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{R.send(m.default.serialize(O,this.params.format))}catch(y){var g="Exception from ws connection when trying to send: "+a.inspectError(y);f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()",g),this.finish("disconnected",new b.default(g,5e4,500))}},S.prototype.onWsData=function(O){f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+O.length+"; type = "+typeof O);try{this.onProtocolMessage(m.default.deserialize(O,this.format))}catch(R){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+R.stack)}},S.prototype.onWsOpen=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},S.prototype.onWsClose=function(O){var R,g;if(typeof O=="object"?(g=O.code,R=O.wasClean||g===1e3):(g=O,R=g==1e3),delete this.wsConnection,R){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var y=new b.default("Websocket closed",80003,400);this.finish("disconnected",y)}else{var d="Unclean disconnection of WebSocket ; code = "+g,y=new b.default(d,80003,400);f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()",d),this.finish("disconnected",y)}this.emit("disposed")},S.prototype.onWsError=function(O){var R=this;f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+O.message),i.default.Config.nextTick(function(){R.disconnect(Error(O.message))})},S.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var O=this.wsConnection;O&&(O.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!O)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");O.close()}))},S}(l.default);function w(x){return E.isAvailable()&&(x.supportedTransports[C]=E),E}t.default=w},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(1)),a=r.__importDefault(e(34)),l=r.__importDefault(e(7)),u=r.__importDefault(e(2)),f=r.__importDefault(e(15)),m=r.__importStar(e(4)),b=r.__importDefault(e(38)),C=r.__importDefault(e(23)),h=r.__importDefault(e(39)),E=function(){};function w(y){return y.channel.realtime.auth.clientId}function x(y){var d=y.channel.realtime,p=d.auth.clientId;return(!p||p==="*")&&d.connection.state==="connected"}function S(y,d,p){switch(y.state){case"attached":case"suspended":p();break;case"initialized":case"detached":case"detaching":case"attaching":y.attach(function(T){T?d(T):p()});break;default:d(m.default.fromValues(y.invalidStateError()))}}function O(y,d){if(y.isSynthesized()||d.isSynthesized())return y.timestamp>=d.timestamp;var p=y.parseId(),T=d.parseId();return p.msgSerial===T.msgSerial?p.index>T.index:p.msgSerial>T.msgSerial}var R=function(y){r.__extends(d,y);function d(p){var T=y.call(this,p)||this;return T.channel=p,T.syncComplete=!1,T.members=new g(T,function(v){return v.clientId+":"+v.connectionId}),T._myMembers=new g(T,function(v){return v.clientId}),T.subscriptions=new l.default,T.pendingPresence=[],T}return d.prototype.enter=function(p,T){if(x(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"enter",T)},d.prototype.update=function(p,T){if(x(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"update",T)},d.prototype.enterClient=function(p,T,v){return this._enterOrUpdateClient(void 0,p,T,"enter",v)},d.prototype.updateClient=function(p,T,v){return this._enterOrUpdateClient(void 0,p,T,"update",v)},d.prototype._enterOrUpdateClient=function(p,T,v,I,U){var z=this;if(!U)if(typeof v=="function")U=v,v=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[p,T,v,I]);U=E}var W=this.channel;if(!W.connectionManager.activeState()){U(W.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence."+I+"Client()","channel = "+W.name+", id = "+p+", client = "+(T||"(implicit) "+w(this)));var N=f.default.fromData(v);N.action=I,p&&(N.id=p),T&&(N.clientId=T),f.default.encode(N,W.channelOptions,function(M){if(M){U(M);return}switch(W.state){case"attached":W.sendPresence(N,U);break;case"initialized":case"detached":W.attach();case"attaching":z.pendingPresence.push({presence:N,callback:U});break;default:M=new m.PartialErrorInfo("Unable to "+I+" presence channel while in "+W.state+" state",90001),M.code=90001,U(M)}})},d.prototype.leave=function(p,T){if(x(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,p,T)},d.prototype.leaveClient=function(p,T,v){if(!v)if(typeof T=="function")v=T,T=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[p,T]);v=E}var I=this.channel;if(!I.connectionManager.activeState()){v==null||v(I.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+p);var U=f.default.fromValues({action:"leave",data:T});switch(p&&(U.clientId=p),I.state){case"attached":I.sendPresence(U,v);break;case"attaching":this.pendingPresence.push({presence:U,callback:v});break;case"initialized":case"failed":{var z=new m.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);v==null||v(z);break}default:v==null||v(I.invalidStateError())}},d.prototype.get=function(p,T){var v=this,I=Array.prototype.slice.call(arguments);I.length==1&&typeof I[0]=="function"&&I.unshift(null),p=I[0],T=I[1];var U=!p||("waitForSync"in p?p.waitForSync:!0);if(!T){if(this.channel.realtime.options.promises)return i.promisify(this,"get",I);T=E}function z(W){T(null,p?W.list(p):W.values())}if(this.channel.state==="suspended"){U?T(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):z(this.members);return}S(this.channel,T,function(){var W=v.members;U?W.waitSync(function(){z(W)}):z(W)})},d.prototype.history=function(p,T){if(u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),T===void 0)if(typeof p=="function")T=p,p=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);T=E}p&&p.untilAttach&&(this.channel.state==="attached"?(delete p.untilAttach,p.from_serial=this.channel.properties.attachSerial):T(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),a.default.prototype._history.call(this,p,T)},d.prototype.setPresence=function(p,T,v){u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+p.length+" participants; syncChannelSerial = "+v);var I,U,z=this.members,W=this._myMembers,N=[],M=this.channel.connectionManager.connectionId;T&&(this.members.startSync(),v&&(U=v.match(/^[\w-]+:(.*)$/))&&(I=U[1]));for(var L=0;L<p.length;L++){var $=f.default.fromValues(p[L]);switch($.action){case"leave":z.remove($)&&N.push($),$.connectionId===M&&!$.isSynthesized()&&W.remove($);break;case"enter":case"present":case"update":z.put($)&&N.push($),$.connectionId===M&&W.put($);break}}T&&!I&&(z.endSync(),this.channel.syncChannelSerial=null);for(var L=0;L<N.length;L++){var $=N[L];this.subscriptions.emit($.action,$)}},d.prototype.onAttached=function(p){u.default.logAction(u.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+p),p?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var T=this.pendingPresence,v=T.length;if(v){this.pendingPresence=[];var I=[],U=C.default.create();u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+v+" queued presence messages");for(var z=0;z<v;z++){var W=T[z];I.push(W.presence),U.push(W.callback)}this.channel.sendPresence(I,U)}},d.prototype.actOnChannelState=function(p,T,v){switch(p){case"attached":this.onAttached(T);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(v);break}},d.prototype.failPendingPresence=function(p){if(this.pendingPresence.length){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(p));for(var T=0;T<this.pendingPresence.length;T++)try{this.pendingPresence[T].callback(p)}catch(v){}this.pendingPresence=[]}},d.prototype._clearMyMembers=function(){this._myMembers.clear()},d.prototype._ensureMyMembersPresent=function(){var p=this,T=this._myMembers,v=function(z){if(z){var W="Presence auto-re-enter failed: "+z.toString(),N=new m.default(W,91004,400);u.default.logAction(u.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",W);var M=new h.default(p.channel.state,p.channel.state,!0,!1,N);p.channel.emit("update",M)}};for(var I in T.map){var U=T.map[I];u.default.logAction(u.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+U.clientId+'" into the presence set'),this._enterOrUpdateClient(U.id,U.clientId,U.data,"enter",v)}},d.prototype._synthesizeLeaves=function(p){var T=this.subscriptions;i.arrForEach(p,function(v){var I=f.default.fromValues({action:"leave",connectionId:v.connectionId,clientId:v.clientId,data:v.data,encoding:v.encoding,timestamp:i.now()});T.emit("leave",I)})},d.prototype.on=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];u.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,p)},d.prototype.off=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];u.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,p)},d.prototype.subscribe=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=b.default.processListenerArgs(p),I=v[0],U=v[1],z=v[2],W=this.channel;if(!z){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[I,U]);z=E}if(W.state==="failed"){z(m.default.fromValues(W.invalidStateError()));return}this.subscriptions.on(I,U),W.attach(z)},d.prototype.unsubscribe=function(){for(var p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var v=b.default.processListenerArgs(p),I=v[0],U=v[1];this.subscriptions.off(I,U)},d}(a.default),g=function(y){r.__extends(d,y);function d(p,T){var v=y.call(this)||this;return v.presence=p,v.map=Object.create(null),v.syncInProgress=!1,v.residualMembers=null,v.memberKey=T,v}return d.prototype.get=function(p){return this.map[p]},d.prototype.getClient=function(p){var T=this.map,v=[];for(var I in T){var U=T[I];U.clientId==p&&U.action!="absent"&&v.push(U)}return v},d.prototype.list=function(p){var T=this.map,v=p&&p.clientId,I=p&&p.connectionId,U=[];for(var z in T){var W=T[z];W.action!=="absent"&&(v&&v!=W.clientId||I&&I!=W.connectionId||U.push(W))}return U},d.prototype.put=function(p){(p.action==="enter"||p.action==="update")&&(p=f.default.fromValues(p),p.action="present");var T=this.map,v=this.memberKey(p);this.residualMembers&&delete this.residualMembers[v];var I=T[v];return I&&!O(p,I)?!1:(T[v]=p,!0)},d.prototype.values=function(){var p=this.map,T=[];for(var v in p){var I=p[v];I.action!="absent"&&T.push(I)}return T},d.prototype.remove=function(p){var T=this.map,v=this.memberKey(p),I=T[v];return I&&!O(p,I)?!1:(this.syncInProgress?(p=f.default.fromValues(p),p.action="absent",T[v]=p):delete T[v],!0)},d.prototype.startSync=function(){var p=this.map,T=this.syncInProgress;u.default.logAction(u.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),this.syncInProgress||(this.residualMembers=i.copy(p),this.setInProgress(!0))},d.prototype.endSync=function(){var p=this.map,T=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),T){for(var v in p){var I=p[v];I.action==="absent"&&delete p[v]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var v in this.residualMembers)delete p[v];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},d.prototype.waitSync=function(p){var T=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+T),!T){p();return}this.once("sync",p)},d.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},d.prototype.setInProgress=function(p){u.default.logAction(u.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+p),this.syncInProgress=p,this.presence.syncComplete=!p},d}(l.default);t.default=R},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=e(56),a=e(31),l=e(11),u=r.__importDefault(e(5)),f=r.__importDefault(e(3)),m=function(){function b(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return b.prototype.isWordArray=function(C){return C!=null&&C.sigBytes!==void 0},b.prototype.isArrayBuffer=function(C){return C!=null&&C.constructor===ArrayBuffer},b.prototype.isTypedArray=function(C){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C)},b.prototype.uint8ViewToBase64=function(C){for(var h="",E=this.base64CharSet,w=C.byteLength,x=w%3,S=w-x,O,R,g,y,d,p=0;p<S;p=p+3)d=C[p]<<16|C[p+1]<<8|C[p+2],O=(d&16515072)>>18,R=(d&258048)>>12,g=(d&4032)>>6,y=d&63,h+=E[O]+E[R]+E[g]+E[y];return x==1?(d=C[S],O=(d&252)>>2,R=(d&3)<<4,h+=E[O]+E[R]+"=="):x==2&&(d=C[S]<<8|C[S+1],O=(d&64512)>>10,R=(d&1008)>>4,g=(d&15)<<2,h+=E[O]+E[R]+E[g]+"="),h},b.prototype.base64ToArrayBuffer=function(C){for(var h=atob==null?void 0:atob(C),E=h.length,w=new Uint8Array(E),x=0;x<E;x++){var S=h.charCodeAt(x);w[x]=S}return w.buffer},b.prototype.isBuffer=function(C){return this.isArrayBuffer(C)||this.isWordArray(C)||this.isTypedArray(C)},b.prototype.toBuffer=function(C){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(C))return new Uint8Array(C);if(this.isTypedArray(C))return new Uint8Array(C.buffer);if(this.isWordArray(C)){for(var h=new ArrayBuffer(C.sigBytes),E=new Uint8Array(h),w=0;w<C.sigBytes;w++)E[w]=C.words[w>>>2]>>>24-w%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},b.prototype.toArrayBuffer=function(C){return this.isArrayBuffer(C)?C:this.toBuffer(C).buffer},b.prototype.toWordArray=function(C){return this.isTypedArray(C)&&(C=C.buffer),this.isWordArray(C)?C:u.default.create(C)},b.prototype.base64Encode=function(C){return this.isWordArray(C)?(0,l.stringify)(C):this.uint8ViewToBase64(this.toBuffer(C))},b.prototype.base64Decode=function(C){return ArrayBuffer&&f.default.Config.atob?this.base64ToArrayBuffer(C):(0,l.parse)(C)},b.prototype.hexEncode=function(C){return(0,i.stringify)(this.toWordArray(C))},b.prototype.hexDecode=function(C){var h=(0,i.parse)(C);return ArrayBuffer?this.toArrayBuffer(h):h},b.prototype.utf8Encode=function(C){return f.default.Config.TextEncoder?new f.default.Config.TextEncoder().encode(C).buffer:(0,a.parse)(C)},b.prototype.utf8Decode=function(C){if(!this.isBuffer(C))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(C)?new TextDecoder().decode(C):(C=this.toWordArray(C),(0,a.stringify)(C))},b.prototype.bufferCompare=function(C,h){if(!C)return-1;if(!h)return 1;var E=this.toWordArray(C),w=this.toWordArray(h);E.clamp(),w.clamp();var x=E.sigBytes-w.sigBytes;if(x!=0)return x;for(var S=E.words,O=w.words,R=0;R<S.length;R++)if(x=S[R]-O[R],x!=0)return x;return 0},b.prototype.byteLength=function(C){return this.isArrayBuffer(C)||this.isTypedArray(C)?C.byteLength:this.isWordArray(C)?C.sigBytes:-1},b.prototype.typedArrayToBuffer=function(C){return C.buffer},b}();t.default=new m},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return r.enc.Hex})},function(s,t,e){"use strict";e.r(t);var r=e(5),i=e.n(r),a=e(11),l=e.n(a),u=e(22),f=e.n(u),m=e(2),b=e.n(m),C=e(4),h=e.n(C),E=function(w,x){var S="aes",O=256,R="cbc",g=16,y=4,d=4294967296,p=2147483648,T;if(w.getRandomWordArray)T=w.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&w.getRandomValues){var v=new Uint32Array(y);T=function($,G){var J=$/4,ee=J==y?v:new Uint32Array(J);w.getRandomValues(ee,function(re){typeof G!="undefined"&&G(re,x.toWordArray(ee))})}}else T=function($,G){b.a.logAction(b.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var J=$/4,ee=new Array(J),re=0;re<J;re++)ee[re]=Math.floor(Math.random()*d)-p;G(null,i.a.create(ee))};function I($){return $+g&-g}function U($){if($.algorithm==="aes"&&$.mode==="cbc"){if($.keyLength===128||$.keyLength===256)return;throw new Error("Unsupported key length "+$.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function z($){return $.replace("_","/").replace("-","+")}var W=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function N(){}function M(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}N.CipherParams=M,N.getDefaultParams=function($){var G;if(typeof $=="function"||typeof $=="string"){if(b.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof $=="function")N.generateRandomKey(function(ee){$(null,N.getDefaultParams({key:ee}))});else if(typeof arguments[1]=="function")arguments[1](null,N.getDefaultParams({key:$}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!$.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof $.key=="string"?G=Object(a.parse)(z($.key)):G=x.toWordArray($.key);var J=new M;if(J.key=G,J.algorithm=$.algorithm||S,J.keyLength=G.words.length*(4*8),J.mode=$.mode||R,$.keyLength&&$.keyLength!==J.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+$.keyLength+" was specified, but the key actually has length "+J.keyLength);return U(J),J},N.generateRandomKey=function($,G){arguments.length==1&&typeof $=="function"&&(G=$,$=void 0),T(($||O)/8,function(J,ee){G!==void 0&&G(J?h.a.fromValues(J):null,ee)})},N.getCipher=function($){var G=$ instanceof M?$:N.getDefaultParams($);return{cipherParams:G,cipher:new L(G,y,$.iv)}};function L($,G,J){this.algorithm=$.algorithm+"-"+String($.keyLength)+"-"+$.mode,this.cjsAlgorithm=$.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=x.toWordArray($.key),J&&(this.iv=x.toWordArray(J).clone()),this.blockLengthWords=G}return L.prototype.encrypt=function($,G){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.encrypt()",""),$=x.toWordArray($);var J=$.sigBytes,ee=I(J),re=this,X=function(){re.getIv(function(P,k){if(P){G(P);return}var H=re.encryptCipher.process($.concat(W[ee-J])),j=k.concat(H);G(null,j)})};this.encryptCipher?X():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):T(g,function(P,k){if(P){G(P);return}re.encryptCipher=f.a.algo[re.cjsAlgorithm].createEncryptor(re.key,{iv:k}),re.iv=k,X()})},L.prototype.decrypt=function($){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.decrypt()",""),$=x.toWordArray($);var G=this.blockLengthWords,J=$.words,ee=i.a.create(J.slice(0,G)),re=i.a.create(J.slice(G)),X=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:ee}),P=X.process(re),k=X.finalize();return X.reset(),k&&k.sigBytes&&P.concat(k),P},L.prototype.getIv=function($){if(this.iv){var G=this.iv;this.iv=null,$(null,G);return}var J=this;T(g,function(ee,re){if(ee){$(ee);return}$(null,J.encryptCipher.process(re))})},N};t.default=E},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(){var i=r,a=i.lib,l=a.WordArray,u=i.enc,f=u.Utf16=u.Utf16BE={stringify:function(b){for(var C=b.words,h=b.sigBytes,E=[],w=0;w<h;w+=2){var x=C[w>>>2]>>>16-w%4*8&65535;E.push(String.fromCharCode(x))}return E.join("")},parse:function(b){for(var C=b.length,h=[],E=0;E<C;E++)h[E>>>1]|=b.charCodeAt(E)<<16-E%2*16;return l.create(h,C*2)}};u.Utf16LE={stringify:function(b){for(var C=b.words,h=b.sigBytes,E=[],w=0;w<h;w+=2){var x=m(C[w>>>2]>>>16-w%4*8&65535);E.push(String.fromCharCode(x))}return E.join("")},parse:function(b){for(var C=b.length,h=[],E=0;E<C;E++)h[E>>>1]|=m(b.charCodeAt(E)<<16-E%2*16);return l.create(h,C*2)}};function m(b){return b<<8&4278255360|b>>>8&16711935}}(),r.enc.Utf16})},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(28))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.CipherParams,f=a.enc,m=f.Hex,b=a.format,C=b.Hex={stringify:function(h){return h.ciphertext.toString(m)},parse:function(h){var E=m.parse(h);return u.create({ciphertext:E})}}}(),r.format.Hex})},function(s,t,e){(function(r,i){s.exports=t=i(e(6),e(11),e(61),e(27),e(28))})(this,function(r){return function(){var i=r,a=i.lib,l=a.BlockCipher,u=i.algo,f=[],m=[],b=[],C=[],h=[],E=[],w=[],x=[],S=[],O=[];(function(){for(var y=[],d=0;d<256;d++)d<128?y[d]=d<<1:y[d]=d<<1^283;for(var p=0,T=0,d=0;d<256;d++){var v=T^T<<1^T<<2^T<<3^T<<4;v=v>>>8^v&255^99,f[p]=v,m[v]=p;var I=y[p],U=y[I],z=y[U],W=y[v]*257^v*16843008;b[p]=W<<24|W>>>8,C[p]=W<<16|W>>>16,h[p]=W<<8|W>>>24,E[p]=W;var W=z*16843009^U*65537^I*257^p*16843008;w[v]=W<<24|W>>>8,x[v]=W<<16|W>>>16,S[v]=W<<8|W>>>24,O[v]=W,p?(p=I^y[y[y[z^I]]],T^=y[y[T]]):p=T=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],g=u.AES=l.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var d=this._keyPriorReset=this._key,p=d.words,T=d.sigBytes/4,v=this._nRounds=T+6,I=(v+1)*4,U=this._keySchedule=[],z=0;z<I;z++)z<T?U[z]=p[z]:(y=U[z-1],z%T?T>6&&z%T==4&&(y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255]):(y=y<<8|y>>>24,y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255],y^=R[z/T|0]<<24),U[z]=U[z-T]^y);for(var W=this._invKeySchedule=[],N=0;N<I;N++){var z=I-N;if(N%4)var y=U[z];else var y=U[z-4];N<4||z<=4?W[N]=y:W[N]=w[f[y>>>24]]^x[f[y>>>16&255]]^S[f[y>>>8&255]]^O[f[y&255]]}}},encryptBlock:function(y,d){this._doCryptBlock(y,d,this._keySchedule,b,C,h,E,f)},decryptBlock:function(y,d){var p=y[d+1];y[d+1]=y[d+3],y[d+3]=p,this._doCryptBlock(y,d,this._invKeySchedule,w,x,S,O,m);var p=y[d+1];y[d+1]=y[d+3],y[d+3]=p},_doCryptBlock:function(y,d,p,T,v,I,U,z){for(var W=this._nRounds,N=y[d]^p[0],M=y[d+1]^p[1],L=y[d+2]^p[2],$=y[d+3]^p[3],G=4,J=1;J<W;J++){var ee=T[N>>>24]^v[M>>>16&255]^I[L>>>8&255]^U[$&255]^p[G++],re=T[M>>>24]^v[L>>>16&255]^I[$>>>8&255]^U[N&255]^p[G++],X=T[L>>>24]^v[$>>>16&255]^I[N>>>8&255]^U[M&255]^p[G++],P=T[$>>>24]^v[N>>>16&255]^I[M>>>8&255]^U[L&255]^p[G++];N=ee,M=re,L=X,$=P}var ee=(z[N>>>24]<<24|z[M>>>16&255]<<16|z[L>>>8&255]<<8|z[$&255])^p[G++],re=(z[M>>>24]<<24|z[L>>>16&255]<<16|z[$>>>8&255]<<8|z[N&255])^p[G++],X=(z[L>>>24]<<24|z[$>>>16&255]<<16|z[N>>>8&255]<<8|z[M&255])^p[G++],P=(z[$>>>24]<<24|z[N>>>16&255]<<16|z[M>>>8&255]<<8|z[L&255])^p[G++];y[d]=ee,y[d+1]=re,y[d+2]=X,y[d+3]=P},keySize:256/32});i.AES=l._createHelper(g)}(),r.AES})},function(s,t,e){(function(r,i){s.exports=t=i(e(6))})(this,function(r){return function(i){var a=r,l=a.lib,u=l.WordArray,f=l.Hasher,m=a.algo,b=[];(function(){for(var S=0;S<64;S++)b[S]=i.abs(i.sin(S+1))*4294967296|0})();var C=m.MD5=f.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,O){for(var R=0;R<16;R++){var g=O+R,y=S[g];S[g]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var d=this._hash.words,p=S[O+0],T=S[O+1],v=S[O+2],I=S[O+3],U=S[O+4],z=S[O+5],W=S[O+6],N=S[O+7],M=S[O+8],L=S[O+9],$=S[O+10],G=S[O+11],J=S[O+12],ee=S[O+13],re=S[O+14],X=S[O+15],P=d[0],k=d[1],H=d[2],j=d[3];P=h(P,k,H,j,p,7,b[0]),j=h(j,P,k,H,T,12,b[1]),H=h(H,j,P,k,v,17,b[2]),k=h(k,H,j,P,I,22,b[3]),P=h(P,k,H,j,U,7,b[4]),j=h(j,P,k,H,z,12,b[5]),H=h(H,j,P,k,W,17,b[6]),k=h(k,H,j,P,N,22,b[7]),P=h(P,k,H,j,M,7,b[8]),j=h(j,P,k,H,L,12,b[9]),H=h(H,j,P,k,$,17,b[10]),k=h(k,H,j,P,G,22,b[11]),P=h(P,k,H,j,J,7,b[12]),j=h(j,P,k,H,ee,12,b[13]),H=h(H,j,P,k,re,17,b[14]),k=h(k,H,j,P,X,22,b[15]),P=E(P,k,H,j,T,5,b[16]),j=E(j,P,k,H,W,9,b[17]),H=E(H,j,P,k,G,14,b[18]),k=E(k,H,j,P,p,20,b[19]),P=E(P,k,H,j,z,5,b[20]),j=E(j,P,k,H,$,9,b[21]),H=E(H,j,P,k,X,14,b[22]),k=E(k,H,j,P,U,20,b[23]),P=E(P,k,H,j,L,5,b[24]),j=E(j,P,k,H,re,9,b[25]),H=E(H,j,P,k,I,14,b[26]),k=E(k,H,j,P,M,20,b[27]),P=E(P,k,H,j,ee,5,b[28]),j=E(j,P,k,H,v,9,b[29]),H=E(H,j,P,k,N,14,b[30]),k=E(k,H,j,P,J,20,b[31]),P=w(P,k,H,j,z,4,b[32]),j=w(j,P,k,H,M,11,b[33]),H=w(H,j,P,k,G,16,b[34]),k=w(k,H,j,P,re,23,b[35]),P=w(P,k,H,j,T,4,b[36]),j=w(j,P,k,H,U,11,b[37]),H=w(H,j,P,k,N,16,b[38]),k=w(k,H,j,P,$,23,b[39]),P=w(P,k,H,j,ee,4,b[40]),j=w(j,P,k,H,p,11,b[41]),H=w(H,j,P,k,I,16,b[42]),k=w(k,H,j,P,W,23,b[43]),P=w(P,k,H,j,L,4,b[44]),j=w(j,P,k,H,J,11,b[45]),H=w(H,j,P,k,X,16,b[46]),k=w(k,H,j,P,v,23,b[47]),P=x(P,k,H,j,p,6,b[48]),j=x(j,P,k,H,N,10,b[49]),H=x(H,j,P,k,re,15,b[50]),k=x(k,H,j,P,z,21,b[51]),P=x(P,k,H,j,J,6,b[52]),j=x(j,P,k,H,I,10,b[53]),H=x(H,j,P,k,$,15,b[54]),k=x(k,H,j,P,T,21,b[55]),P=x(P,k,H,j,M,6,b[56]),j=x(j,P,k,H,X,10,b[57]),H=x(H,j,P,k,W,15,b[58]),k=x(k,H,j,P,ee,21,b[59]),P=x(P,k,H,j,U,6,b[60]),j=x(j,P,k,H,G,10,b[61]),H=x(H,j,P,k,v,15,b[62]),k=x(k,H,j,P,L,21,b[63]),d[0]=d[0]+P|0,d[1]=d[1]+k|0,d[2]=d[2]+H|0,d[3]=d[3]+j|0},_doFinalize:function(){var S=this._data,O=S.words,R=this._nDataBytes*8,g=S.sigBytes*8;O[g>>>5]|=128<<24-g%32;var y=i.floor(R/4294967296),d=R;O[(g+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,O[(g+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,S.sigBytes=(O.length+1)*4,this._process();for(var p=this._hash,T=p.words,v=0;v<4;v++){var I=T[v];T[v]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}return p},clone:function(){var S=f.clone.call(this);return S._hash=this._hash.clone(),S}});function h(S,O,R,g,y,d,p){var T=S+(O&R|~O&g)+y+p;return(T<<d|T>>>32-d)+O}function E(S,O,R,g,y,d,p){var T=S+(O&g|R&~g)+y+p;return(T<<d|T>>>32-d)+O}function w(S,O,R,g,y,d,p){var T=S+(O^R^g)+y+p;return(T<<d|T>>>32-d)+O}function x(S,O,R,g,y,d,p){var T=S+(R^(O|~g))+y+p;return(T<<d|T>>>32-d)+O}a.MD5=f._createHelper(C),a.HmacMD5=f._createHmacHelper(C)}(Math),r.MD5})},function(s,t,e){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),a=i.__importDefault(e(3)),l=i.__importStar(e(1)),u=i.__importDefault(e(8)),f=e(4),m=i.__importDefault(e(18)),b=i.__importDefault(e(16)),C=i.__importDefault(e(21)),h=i.__importDefault(e(2)),E=e(29),w=i.__importDefault(e(63)),x=e(25);function S(g){var y=g.statusCode;return y===408&&!g.code||y===400&&!g.code||y>=500&&y<=504}function O(g){var y=g.connection,d=y&&y.connectionManager.host;return d?[d].concat(u.default.getFallbackHosts(g.options)):u.default.getHosts(g.options)}var R=(r=function(){function g(y){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=O,this.options=y||{};var d=this.options.connectivityCheckUrl||u.default.connectivityCheckUrl,p=this.options.connectivityCheckParams,T=!this.options.connectivityCheckUrl;a.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(v,I,U,z,W,N,M){var L=b.default.createRequest(U,z,W,N,C.default.REQ_SEND,I&&I.options.timeouts,v);return L.once("complete",M),L.exec(),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+d),this.doUri(m.default.Get,null,d,null,null,p,function(I,U,z,W,N){var M=!1;T?M=!I&&(U==null?void 0:U.replace(/\n/,""))=="yes":M=!I&&(0,x.isSuccessCode)(N),h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+M),v(null,M)})}):a.default.Config.jsonpSupported?(this.Request=function(v,I,U,z,W,N,M){var L=(0,E.createRequest)(U,z,W,N,C.default.REQ_SEND,I&&I.options.timeouts,v);return L.once("complete",M),a.default.Config.nextTick(function(){L.exec()}),L},this.options.disableConnectivityCheck?this.checkConnectivity=function(v){v(null,!0)}:this.checkConnectivity=function(v){var I=this,U=u.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(v);return}this.checksInProgress=[v],h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+U);var z=new E.Request("isTheInternetUp",U,null,null,null,C.default.REQ_SEND,u.default.TIMEOUTS);z.once("complete",function(W,N){var M=!W&&N;h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+M);for(var L=0;L<I.checksInProgress.length;L++)I.checksInProgress[L](null,M);I.checksInProgress=null}),a.default.Config.nextTick(function(){z.exec()})}):a.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=w.default,this.checkConnectivity=function(v){h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+d),this.doUri(m.default.Get,null,d,null,null,null,function(I,U){var z=!I&&(U==null?void 0:U.replace(/\n/,""))=="yes";h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+z),v(null,z)})}):this.Request=function(v,I,U,z,W,N,M){M(new f.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return g.prototype.do=function(y,d,p,T,v,I,U){var z=this,W=typeof p=="function"?p:function($){return d.baseUri($)+p},N=d._currentFallback;if(N)if(N.validUntil>l.now()){if(!this.Request){U==null||U(new f.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(y,d,W(N.host),T,I,v,function($){for(var G=[],J=1;J<arguments.length;J++)G[J-1]=arguments[J];if($&&S($)){d._currentFallback=null,z.do(y,d,p,T,v,I,U);return}U==null||U.apply(void 0,i.__spreadArray([$],G,!1))});return}else d._currentFallback=null;var M=O(d);if(M.length===1){this.doUri(y,d,W(M[0]),T,v,I,U);return}var L=function($,G){var J=$.shift();z.doUri(y,d,W(J),T,v,I,function(ee){for(var re=[],X=1;X<arguments.length;X++)re[X-1]=arguments[X];if(ee&&S(ee)&&$.length){L($,!0);return}G&&(d._currentFallback={host:J,validUntil:l.now()+d.options.timeouts.fallbackRetryTimeout}),U==null||U.apply(void 0,i.__spreadArray([ee],re,!1))})};L(M)},g.prototype.doUri=function(y,d,p,T,v,I,U){if(!this.Request){U(new f.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(y,d,p,T,I,v,U)},g}(),r.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],r.methodsWithoutBody=[m.default.Get,m.default.Delete],r.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],r);t.default=R},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importStar(e(4)),a=r.__importDefault(e(3)),l=r.__importDefault(e(8)),u=r.__importStar(e(1)),f=e(1);function m(h,E){return!!E.get("x-ably-errorcode")}function b(h,E){if(m(h,E))return h.error&&i.default.fromValues(h.error)}function C(h,E,w,x,S,O,R){var g=new Headers(x||{}),y=h?h.toUpperCase():u.isEmptyArg(O)?"GET":"POST",d=new AbortController,p=setTimeout(function(){d.abort(),R(new i.PartialErrorInfo("Request timed out",null,408))},E?E.options.timeouts.httpRequestTimeout:l.default.TIMEOUTS.httpRequestTimeout),T={method:y,headers:g,body:O};a.default.Config.isWebworker||(T.credentials=g.has("authorization")?"include":"same-origin"),(0,f.getGlobalObject)().fetch(w+"?"+new URLSearchParams(S||{}),T).then(function(v){clearTimeout(p);var I=v.headers.get("Content-Type"),U;I&&I.indexOf("application/x-msgpack")>-1?U=v.arrayBuffer():I&&I.indexOf("application/json")>-1?U=v.json():U=v.text(),U.then(function(z){var W=!!I&&I.indexOf("application/x-msgpack")===-1;if(v.ok)R(null,z,v.headers,W,v.status);else{var N=b(z,v.headers)||new i.PartialErrorInfo("Error response received from server: "+v.status+" body was: "+a.default.Config.inspect(z),null,v.status);R(N,z,v.headers,W,v.status)}})}).catch(function(v){clearTimeout(p),R(v)})}t.default=C},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(41)),a=r.__importStar(e(1)),l=a.getGlobalObject();function u(){var C=l.location;return!l.WebSocket||!C||!C.origin||C.origin.indexOf("http")>-1}var f=l.navigator&&l.navigator.userAgent.toString(),m=l.location&&l.location.href,b={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:m,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:l.WebSocket,fetchSupported:!!l.fetch,xhrSupported:l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:u(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!l.TextDecoder,preferBinary:!1,ArrayBuffer:l.ArrayBuffer,atob:l.atob,nextTick:typeof l.setImmediate!="undefined"?l.setImmediate.bind(l):function(C){setTimeout(C,0)},addEventListener:l.addEventListener,inspect:JSON.stringify,stringByteSize:function(C){return l.TextDecoder&&new l.TextEncoder().encode(C).length||C.length},TextEncoder:l.TextEncoder,TextDecoder:l.TextDecoder,Promise:l.Promise,getRandomValues:function(C){if(C!==void 0)return function(h,E){C.getRandomValues(h),E&&E(null)}}(l.crypto||msCrypto)};t.default=b},function(s,t,e){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),a=i.__importStar(e(1)),l="ablyjs-storage-test",u=function(){function f(){try{r.sessionStorage.setItem(l,l),r.sessionStorage.removeItem(l),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{r.localStorage.setItem(l,l),r.localStorage.removeItem(l),this.localSupported=!0}catch(m){this.localSupported=!1}}return f.prototype.get=function(m){return this._get(m,!1)},f.prototype.getSession=function(m){return this._get(m,!0)},f.prototype.remove=function(m){return this._remove(m,!1)},f.prototype.removeSession=function(m){return this._remove(m,!0)},f.prototype.set=function(m,b,C){return this._set(m,b,C,!1)},f.prototype.setSession=function(m,b,C){return this._set(m,b,C,!0)},f.prototype._set=function(m,b,C,h){var E={value:b};return C&&(E.expires=a.now()+C),this.storageInterface(h).setItem(m,JSON.stringify(E))},f.prototype._get=function(m,b){if(b&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!b&&!this.localSupported)throw new Error("Local Storage not supported");var C=this.storageInterface(b).getItem(m);if(!C)return null;var h=JSON.parse(C);return h.expires&&h.expires<a.now()?(this.storageInterface(b).removeItem(m),null):h.value},f.prototype._remove=function(m,b){return this.storageInterface(b).removeItem(m)},f.prototype.storageInterface=function(m){return m?r.sessionStorage:r.localStorage},f}();t.default=new u}).call(this,e(13))},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e(0),i=r.__importDefault(e(67)),a={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};t.default=a},function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(r||(r={})),t.default=r},function(s,t,e){"use strict";e.r(t);var r=e(29),i=e.n(r),a=e(1),l=e(3),u=e.n(l),f=e(12),m=e.n(f),b=e(16),C=e.n(b),h=function(O){var R="xhr_polling";function g(y,d,p){p.stream=!1,m.a.call(this,y,d,p),this.shortName=R}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(y,d,p,T,v){return C.a.createRequest(y,d,p,T,v,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[R]=g),g},E=h,w=function(O){var R="xhr_streaming";function g(y,d,p){m.a.call(this,y,d,p),this.shortName=R}return a.inherits(g,m.a),g.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.streamingSupported&&u.a.Config.allowComet},g.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(y,d,p,T,v){return C.a.createRequest(y,d,p,T,v,this.timeouts)},typeof O!="undefined"&&g.isAvailable()&&(O.supportedTransports[R]=g),g},x=w,S=t.default=[i.a,E,x]}]).default})});D();D();var go=(y=>(y.MEETING_START="meeting.start",y.MEETING_LEAVE="meeting.leave",y.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",y.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",y.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",y.MEETING_PARTICIPANT_LEFT="meeting.participant-left",y.MEETING_JOIN="meeting.join",y.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",y.MEETING_HOST_CHANGE="meeting.host-change",y.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",y.MEETING_DEVICES_CHANGE="meeting.devices-change",y.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",y.MEETING_STATE_UPDATE="meeting.state-update",y.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",y.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",y.MY_PARTICIPANT_UPDATED="my-participant.update",y.MY_PARTICIPANT_LEFT="my-participant.left",y.MY_PARTICIPANT_JOINED="my-participant.joined",y.MEETING_KICK_PARTICIPANT="meeting.kick-participant",y.DESTROY="destroy",y))(go||{}),vo=(l=>(l.FRAME_LOAD="frame.load",l.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",l.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",l.FRAME_LOCALE_UPDATE="frame.locales-update",l.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",l.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",l))(vo||{}),sa=(u=>(u.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",u.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",u.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",u.TOGGLE_CAM="meeting-controls.toggle-cam",u.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",u.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",u.HANG_UP="hang-up",u))(sa||{}),Cr=(E=>(E.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",E.REALTIME_HOST_CHANGE="realtime.host-change",E.REALTIME_HOST_AVAILABLE="realtime.host-available",E.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",E.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",E.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",E.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",E.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",E.REALTIME_GATHER="realtime.gather",E.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",E.REALTIME_SET_AVATAR="realtime.set-avatar",E.REALTIME_DRAWING_CHANGE="realtime.drawing-change",E.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",E))(Cr||{});var aa=(b=>(b[b.MEETING_FAILED=-1]="MEETING_FAILED",b[b.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",b[b.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",b[b.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",b[b.MEETING_CONNECTING=3]="MEETING_CONNECTING",b[b.MEETING_CONNECTED=4]="MEETING_CONNECTED",b[b.MEETING_RECONNECT=5]="MEETING_RECONNECT",b[b.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",b[b.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",b[b.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",b))(aa||{}),la=(l=>(l.JOINED="participant.joined",l.LOCAL_JOINED="participant.local-joined",l.LEFT="participant.left",l.LOCAL_LEFT="participant.local-left",l.LOCAL_UPDATED="participant.updated",l.LIST_UPDATED="participant.list-updated",l))(la||{}),yo=(u=>(u[u.NOT_AVAILABLE=0]="NOT_AVAILABLE",u[u.GOOD=1]="GOOD",u[u.BAD=2]="BAD",u[u.POOR=3]="POOR",u[u.DISCONNECTED=4]="DISCONNECTED",u[u.RECONNECTING=5]="RECONNECTING",u[u.LOST_CONNECTION=6]="LOST_CONNECTION",u))(yo||{}),Ru=(l=>(l.NO_CAM="devices.no-cam",l.NO_DEVICES="devices.no-devices",l.DEVICES_BLOCKED="devices.blocked",l.DEVICES_CAM_BLOCKED="devices.cam-blocked",l.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",l.DEVICES_UNKNOWN_ERROR="devices.unknown-error",l))(Ru||{});D();var Ci=(r=>(r.HOST="host",r.GUEST="guest",r.AUDIENCE="audience",r))(Ci||{});D();D();D();D();var Mt=(i,a,l,...u)=>_e(void 0,[i,a,l,...u],function*(s,t,e,r={}){let f=yield fetch(s,{method:t,headers:ce({"Content-Type":"application/json"},r),body:e?JSON.stringify(e):null});if(!f.ok)throw f;try{return yield f.json()}catch(m){return f.ok}});D();var rp=Un(_u()),et=class{constructor(t){this.debug=(0,rp.default)(t)}log(t,...e){this.debug(t,...e)}};D();D();var Up=Un(Du());var Ae=class{constructor(t={}){this.subscribe=t=>{this.callbacks.push(t)};this.unsubscribe=t=>{this.callbacks=this.callbacks.filter(e=>e!==t)};this.publish=(...t)=>{!this.callbacks||this.callbacks.forEach(e=>{this.callListener(e,t).catch(r=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${e}
            Event: ${JSON.stringify(t)}
            Error: ${r}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(t,e)=>new Promise((r,i)=>{try{let a=t(...e);r(a)}catch(a){i(a)}});let{logger:e,throttleTime:r}=t;this.logger=e!=null?e:new et("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,Up.default)(this.publish,this.throttle))}};var Or=class{constructor(){this.observers={};this.subscribe=(t,e)=>{this.logger.log(`subscribed to ${t} event`),this.observers[t]||(this.observers[t]=new Ae({logger:this.logger})),this.observers[t].subscribe(e)};this.unsubscribe=(t,e)=>{this.logger.log(`unsubscribed from ${t} event`),this.observers[t]&&(this.observers[t].reset(),delete this.observers[t])};this.publish=(t,e)=>{t in this.observers&&this.observers[t].publish(e)}}};D();D();D();var kp=Un(da()),Nu=class{setConfig(t){this.configuration=t}get(t,e){if(!this.configuration)throw new Error("configs is not available");return(0,kp.get)(this.configuration,t,e)}},xe=new Nu;var yt=class{static createUrl(t,e,r={}){let i=new URL(e,t);return Object.keys(r).forEach(a=>i.searchParams.append(a,r[a])),i.toString()}static validateApiKey(t,e){let r="/user/checkapikey",i=this.createUrl(t,r);return Mt(i,"POST",{apiKey:e})}static fetchConfig(t,e){let r="/immersive-config",i=this.createUrl(t,r);return Mt(i,"POST",{apiKey:e})}static fetchLimits(t,e){return _e(this,null,function*(){let r="/user/check_limits",i=this.createUrl(t,r);return(yield Mt(i,"GET","",{apikey:e})).usage})}static fetchWaterMark(t,e){return _e(this,null,function*(){let r="/user/watermark",i=this.createUrl(t,r),{message:a}=yield Mt(i,"POST",{apiKey:e});return a})}static createAnnotations(t,e,r){return _e(this,null,function*(){let i="/annotations",a=this.createUrl(t,i);return Mt(a,"POST",ce({},r),{apikey:e})})}static updateComment(t,e,r,i){return _e(this,null,function*(){let a=`/comments/${r}`,l=this.createUrl(t,a);return Mt(l,"PUT",{text:i},{apikey:e})})}static createComment(t,e,r){return _e(this,null,function*(){let i="/comments",a=this.createUrl(t,i);return Mt(a,"POST",ce({},r),{apikey:e})})}static fetchAnnotation(t,e,r){return _e(this,null,function*(){let i="/annotations",a=this.createUrl(t,i,{roomId:r.roomId,url:r.url});return Mt(a,"GET",void 0,{apikey:e})})}static resolveAnnotation(t,e,r){return _e(this,null,function*(){let i=`/annotations/resolve/${r}`,a=this.createUrl(t,i);return Mt(a,"POST",{},{apikey:e})})}static deleteComment(t,e,r){return _e(this,null,function*(){let i=`/comments/${r}`,a=this.createUrl(t,i);return Mt(a,"DELETE",{},{apikey:e})})}static deleteAnnotation(t,e,r){return _e(this,null,function*(){let i=`/annotations/${r}`,a=this.createUrl(t,i);return Mt(a,"DELETE",{},{apikey:e})})}static createOrUpdateParticipant(t,e){return _e(this,null,function*(){let r=xe.get("apiUrl"),i="/participants",a=this.createUrl(r,i);return Mt(a,"POST",ce({},e),{apikey:t})})}static sendActivity(t,e,r,i){return _e(this,null,function*(){let a="/activity",l=xe.get("apiUrl"),u=xe.get("roomId"),f=xe.get("apiKey"),m=this.createUrl(l,a);return Mt(m,"POST",{groupId:e,groupName:r,meetingId:u,product:i,userId:t},{apikey:f})})}};D();var on=class extends Or{constructor(){super(...arguments);this.isAttached=!1;this.attach=e=>{if(Object.values(e).includes(null)||Object.values(e).includes(void 0)){let f=`${this.name} @ attach - params are required`;throw this.logger.log(f),new Error(f)}let{realtime:r,localParticipant:i,group:a,config:l,eventBus:u}=e;if(!r.isDomainWhitelisted){let f=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(f);return}if(xe.setConfig(l),this.realtime=r,this.localParticipant=i,this.group=a,this.eventBus=u,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(e)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1,Object.keys(this.observers).forEach(e=>this.unsubscribe(e))}}};D();var Fu=(a=>(a.presence3dMatterport="presence",a.presence3dAutodesk="presence",a.presence3dThreejs="presence",a.realtime="presence",a.whoIsOnline="presence",a))(Fu||{});D();var Uu=(e=>(e.LEFT="left",e.RIGHT="right",e))(Uu||{}),ku=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(ku||{});var Ao=class extends on{constructor(e,r){super();this.sidebarOpen=!1;this.onFixedPin=e=>{document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:ce({},e),composed:!0,bubbles:!0}))};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),this.pinAdapter.setActive(this.sidebarOpen),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=e=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var f,m;this.button=document.createElement("superviz-comments-button");let e=(f=this.layoutOptions)==null?void 0:f.buttonLocation,r=(m=this.layoutOptions)==null?void 0:m.position;if(!e){document.body.appendChild(this.button),this.button.commentsPosition=r;return}let i="",a=Object.values(ku),l=!1,u=!a.includes(e.toLocaleLowerCase());if(u){let b=window.document.body.querySelector(`#${e}`);b?(b.appendChild(this.button),i="position: relative"):(l=!0,e="top-left")}if(!u||l){document.body.appendChild(this.button);let[b,C]=e.split("-");i=`${b}: 20px; ${C}: 20px;`}this.button.positionStyles=i,this.button.commentsPosition=r};this.positionComments=()=>{var l;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left: 0;",document.body.appendChild(this.element);let e=(l=this.layoutOptions)==null?void 0:l.position;if(!e)return;let r=Object.values(Uu),i=e.toLocaleLowerCase();if(!r.includes(i))return;let a=e==="left"?"left: 0;":"right: 0;";this.element.side=a};this.createAnnotation=r=>_e(this,[r],function*({detail:e}){try{let{position:i,text:a}=e,{url:l}=this,u=yield yt.createAnnotations(xe.get("apiUrl"),xe.get("apiKey"),{roomId:xe.get("roomId"),position:JSON.stringify(i),url:l,userId:this.localParticipant.id}),f=yield this.createComment(u.uuid,a);this.addAnnotation(He(ce({},u),{comments:[f]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:u.uuid},composed:!0,bubbles:!0}))}catch(i){this.logger.log("error when creating annotation",i)}});this.deleteAnnotation=r=>_e(this,[r],function*({detail:e}){try{let{uuid:i}=e;yield yt.deleteAnnotation(xe.get("apiUrl"),xe.get("apiKey"),i);let a=this.annotations.filter(l=>l.uuid!==i);this.updateAnnotationList(a),this.pinAdapter.removeAnnotationPin(i),this.element.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when deleting annotation",i)}});this.updateComment=r=>_e(this,[r],function*({detail:e}){try{let{uuid:i,text:a}=e;yield yt.updateComment(xe.get("apiUrl"),xe.get("apiKey"),i,a);let l=this.annotations.map(u=>Object.assign({},u,{comments:u.comments.map(f=>f.uuid===i?Object.assign({},f,{text:a}):f)}));this.updateAnnotationList(l)}catch(i){this.logger.log("error when updating comment",i)}});this.resolveAnnotation=r=>_e(this,[r],function*({detail:e}){try{let{uuid:i}=e,{resolved:a}=yield yt.resolveAnnotation(xe.get("apiUrl"),xe.get("apiKey"),i),l=this.annotations.map(u=>u.uuid===i?Object.assign({},u,{resolved:a}):u);if(this.updateAnnotationList(l),a){this.pinAdapter.removeAnnotationPin(i);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(i){this.logger.log("error when resolve annotation",i)}});this.deleteComment=r=>_e(this,[r],function*({detail:e}){try{let{uuid:i,annotationId:a}=e;if(!i||!a)return;yield yt.deleteComment(xe.get("apiUrl"),xe.get("apiKey"),i);let l=this.annotations.find(f=>f.uuid===a);l.comments=l.comments.filter(f=>f.uuid!==i);let u=this.annotations.map(f=>f.uuid===a?l:f);this.element.updateAnnotations(u),this.updateAnnotationList(u)}catch(i){this.logger.log("error when deleting comment",i)}});this.onAnnotationListUpdate=e=>{let{data:r,clientId:i}=e;this.localParticipant.id!==i&&(this.annotations=r,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new et("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions=r!=null?r:{position:"left",buttonLocation:"top-left"},this.pinAdapter=e}get url(){let e=new URL(this.clientUrl);return e.search="",e.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){this.destroyListeners(),document.body.querySelector("superviz-comments").remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){this.button.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:e})=>{this.createComment(e.uuid,e.text,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onFixedPin)}destroyListeners(){this.button.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("create-annotation",this.createAnnotation),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:e})=>{this.createComment(e.uuid,e.text,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onFixedPin)}createComment(e,r,i=!1){return _e(this,null,function*(){try{let a=yield yt.createComment(xe.get("apiUrl"),xe.get("apiKey"),{annotationId:e,userId:this.localParticipant.id,text:r});return i&&this.addComment(e,a),a}catch(a){this.logger.log("error when creating comment",a)}})}addAnnotation(e){let r=[e,...this.annotations];this.element.updateAnnotations(r),this.pinAdapter.updateAnnotations(r),this.updateAnnotationList(r)}updateAnnotationList(e){this.annotations=e,this.realtime.updateComments(e)}addComment(e,r){let i=this.annotations.find(l=>l.uuid===e);i.comments.push(r);let a=this.annotations.map(l=>l.uuid===e?i:l);this.updateAnnotationList(a),this.element.updateAnnotations(a)}fetchAnnotations(){return _e(this,null,function*(){try{let e=yield yt.fetchAnnotation(xe.get("apiUrl"),xe.get("apiKey"),{roomId:xe.get("roomId"),url:this.url});this.annotations=e,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(e){this.logger.log("error when fetching annotations",e)}})}waterMarkState(){return _e(this,null,function*(){try{let e=yield yt.fetchWaterMark(xe.get("apiUrl"),xe.get("apiKey"));this.element.waterMarkStatus(e)}catch(e){this.logger.log("error when fetching waterMark",e)}})}};D();D();var ha=(e=>(e.ADD="add",e.SHOW="show",e))(ha||{});var Co=class{constructor(t){this.isPinsVisible=!0;this.divWrapperReplacementInterval=null;this.selectedPin=null;this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"))};this.annotationSelected=({detail:t})=>{var a,l;let{uuid:e}=t;if(!e)return;let r=JSON.parse((l=(a=this.selectedPin)==null?void 0:a.getAttribute("annotation"))!=null?l:"{}");if(this.resetPins(),(r==null?void 0:r.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let i=this.pins.get(e);!i||(i.setAttribute("active",""),this.selectedPin=i,this.scrollIntoView(i))};this.onClick=t=>{if(!this.isActive)return;let{x:e,y:r}=t,i=this.divWrapper.getBoundingClientRect(),a=e-i.x,l=r-i.y;this.onPinFixedObserver.publish({x:a,y:l,type:"canvas"}),this.resetSelectedPin(),this.createTemporaryPin({x:a,y:l,type:"canvas"}),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseMove=t=>{let{x:e,y:r}=t;this.mouseElement||(this.mouseElement=this.createMouseElement()),this.mouseElement.setAttribute("position",JSON.stringify({x:e,y:r}))};this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.canvas.style.cursor="default"};this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.pins.forEach(r=>{r.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};if(this.logger=new et("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvasId=t,this.canvas=document.getElementById(t),this.isActive=!1,this.pins=new Map,!this.canvas){let e=`Canvas with id ${t} not found`;throw this.logger.log(e),new Error(e)}document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.style.position="relative",this.onPinFixedObserver=new Ae({logger:this.logger}),this.divWrapper=this.createDivWrapper(),this.annotations=[]}destroy(){this.removeListeners(),this.mouseElement=null,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}setPinsVisibility(t){if(this.isPinsVisible=t,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(t){if(this.isActive=t,this.canvas.style.cursor=t?"none":"default",this.isActive){this.addListeners();return}this.removeListeners()}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,!(!this.isActive&&!this.isPinsVisible)&&this.renderAnnotationsPins()}removeAnnotationPin(t){let e=this.pins.get(t);!e||(e.remove(),this.pins.delete(t))}createTemporaryPin(t){let e=document.getElementById("superviz-temporary-pin");e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("annotation",JSON.stringify({})),e.setAttributeNode(document.createAttribute("active"))),e.setAttribute("position",JSON.stringify(t)),this.divWrapper.appendChild(e),this.pins.set("temporary-pin",e)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseout",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("select-annotation",this.annotationSelected)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseout",this.onMouseLeave),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("select-annotation",this.annotationSelected)}createMouseElement(){let t=document.createElement("superviz-comments-annotation-pin");return t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(t),this.canvas.style.cursor="none",t}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}createDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=document.createElement("div");return this.canvas.parentElement.style.position="relative",e.style.position="fixed",e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let r=this.canvas.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`},1)),this.canvas.parentElement.appendChild(e),e}renderAnnotationsPins(){if(!this.annotations||this.canvas.style.display==="none"){this.removeAnnotationsPins();return}this.annotations.forEach(t=>{let e=JSON.parse(t.position);if(t.resolved){this.removeAnnotationPin(t.uuid);return}if(e.type!=="canvas"||this.pins.has(t.uuid))return;let{x:r,y:i}=e,a=document.createElement("superviz-comments-annotation-pin");a.setAttribute("type","show"),a.setAttribute("annotation",JSON.stringify(t)),a.setAttribute("position",JSON.stringify({x:r,y:i})),this.divWrapper.appendChild(a),this.pins.set(t.uuid,a)})}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}scrollIntoView(t){if(!t||this.divWrapper.clientWidth<=this.divWrapper.parentElement.clientWidth&&this.divWrapper.clientHeight<=this.divWrapper.parentElement.clientHeight)return;let e,r=this.divWrapper;for(;!e;){let a=r==null?void 0:r.parentElement;if(this.isScrollable(a)){e=a;break}if(r=a,!r)break}let i=JSON.parse(t.getAttribute("position"));!e||e.scrollTo({top:i.y,left:i.x,behavior:"smooth"})}isScrollable(t){if(!t)return!1;let e=t.scrollHeight>t.clientHeight,r=window.getComputedStyle(t).overflowY,i=window.getComputedStyle(t).overflowX,a=r.indexOf("hidden")!==-1,l=i.indexOf("hidden")!==-1;return e&&!a&&!l}};D();var $u=Un(da());D();var Sn=Un(Bp()),Oo=class{constructor(){this.browser=Sn.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Sn.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Sn.default.PLATFORMS_MAP.mobile)||this.browser.is(Sn.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Sn.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};D();var pa=class{constructor(){this.updateMeetingConnectionStatus=t=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=t,this.connectionStatusObserver.publish(t),this.logger.log("CONNECTION STATUS CHANGE",t)};this.onUpdateBrowserOnlineStatus=t=>{let{type:e}=t;if(e==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new et("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new Ae({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};D();D();var ma=class{build(t,e,r,i={},a={}){let l=document.querySelector(`#${t}`),u=new URL(e);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(i).forEach(([f,m])=>{u.searchParams.set(f,m)}),Object.entries(a).forEach(([f,m])=>{this.element.setAttribute(f,m)}),this.element.src=u.toString(),this.element.id=r,l.appendChild(this.element),this.wrapperId=t}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let t=document.querySelector(`#${this.wrapperId}`);!!t&&!!t.querySelector(`#${this.element.id}`)&&t.removeChild(this.element),this.wrapperId=null,this.element=null}};D();var ga=class{constructor(t){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(t,e={})=>{this.logger.log("MessageBridge","Posting message to frame",t,e),this.contentWindow.postMessage({type:t,data:e},this.allowedOrigins)};this.listen=(t,e)=>{this.observers[t]||(this.observers[t]=new Ae({logger:this.logger})),this.observers[t].subscribe(e)};this.onReceiveMessage=t=>{let{type:e,data:r,source:i}=t.data;if(this.sourceBlockList.includes(i)||this.originBlockList.includes(t.origin))return;let a=!!e,l=!this.domains.length||this.domains.includes(t.origin),u=this.observers.hasOwnProperty(e);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${t.type}
        ORIGIN: ${t.origin}
        DATA: ${JSON.stringify(t.data)} `),!a||!l||!u){this.logger.log("MessageBridge","Message discarded");return}this.observers[e].publish(r)};let{contentWindow:e,domains:r=[],allowedOrigins:i="*",sourceBlockList:a=[],logger:l}=t;if(this.logger=l,this.domains=r,this.allowedOrigins=i,this.sourceBlockList.push(...a),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=e,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([t,e])=>{e.reset(),delete this.observers[t]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};D();var va=(r=>(r.RIGHT="right",r.CENTER="center",r.LEFT="left",r))(va||{}),ya=(e=>(e.GRID="grid",e.LIST="list",e))(ya||{}),ba=(i=>(i.RIGHT="right",i.LEFT="left",i.TOP="top",i.BOTTOM="bottom",i))(ba||{});var $p="sv-video-frame",To=class{constructor(t){this.logger=new et("@superviz/sdk/video-conference-manager");this.frameStateObserver=new Ae({logger:this.logger});this.frameSizeObserver=new Ae({logger:this.logger});this.waitingForHostObserver=new Ae({logger:this.logger});this.realtimeEventsObserver=new Ae({logger:this.logger});this.sameAccountErrorObserver=new Ae({logger:this.logger});this.devicesObserver=new Ae({logger:this.logger});this.meetingStateObserver=new Ae({logger:this.logger});this.meetingConnectionObserver=new Ae({logger:this.logger});this.participantJoinedObserver=new Ae({logger:this.logger});this.participantLeftObserver=new Ae({logger:this.logger});this.participantListObserver=new Ae({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(t,e)=>{let r=t,i=e,a=["left","right","bottom","top"].includes(i),l=["left","right","center"].includes(r);return a||(i="right"),l||(r="right"),this.browserService.isMobileDevice?(i="bottom",{layoutPosition:r,camerasPosition:i}):(r==="left"&&i==="right"&&(r="right"),r==="right"&&i==="left"&&(r="left"),{layoutPosition:r,camerasPosition:i})};this.onFrameLoad=()=>{this.messageBridge=new ga({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=t=>{let e=t!=null?t:{};["top","bottom","left","right"].forEach(r=>{Object.keys(e).includes(r)||(e[r]=0)}),this.frameOffset=e};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=t=>{let e=document.createElement("style"),{bottom:r,left:i,right:a,top:l}=this.frameOffset;if(e.innerHTML=`
      :root {
        --superviz-offset-top: ${l}px;
        --superviz-offset-right: ${a}px;
        --superviz-offset-left: ${i}px;
        --superviz-offset-bottom: ${r}px;
      }     
    `,document.head.appendChild(e),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${t}`)};this.onFrameDimensionsUpdate=({width:t,height:e})=>{let r=document.getElementById($p),{bottom:i,right:a,left:l,top:u}=this.frameOffset,f=this.isWaterMarkEnabled?40:0,m=`${t}px`,b=`${e+f}px`;(t>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${a}px - ${l}px)`),e>=window.innerHeight&&(b=`calc(100% - ${u}px - ${i}px)`),r.style.width=m,r.style.height=b,this.frameSizeObserver.publish({width:r.offsetWidth,height:r.offsetHeight})};this.onWindowResize=()=>{let{top:t,bottom:e,right:r,left:i}=this.frameOffset,{innerHeight:a,innerWidth:l}=window,u=a-t-e,f=l-r-i;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:u,width:f})};this.updateFrameLocale=()=>{var a,l;if(!this.frameLocale||!((a=this.frameLocale)!=null&&a.language)&&((l=this.frameLocale)==null?void 0:l.locales))return;let{language:t,locales:e}=this.frameLocale,r=e.map(u=>u==null?void 0:u.language),i=["en",...r];if(t&&!i.includes(t))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=t=>{this.participantJoinedObserver.publish(t)};this.onParticipantLeft=t=>{this.participantLeftObserver.publish(t)};this.onMeetingHostChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:t})};this.onMeetingKickParticipant=t=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:t})};this.onFollowParticipantDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:t})};this.onGoToDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:t})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:t})};this.onDrawingChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:t})};this.onTranscriptChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:t})};this.onSameAccountError=t=>{this.sameAccountErrorObserver.publish(t)};this.onDevicesChange=t=>{this.devicesObserver.publish(t)};this.meetingStateUpdate=t=>{this.meetingStateObserver.publish(t)};this.onConnectionStatusChange=t=>{this.meetingConnectionObserver.publish(t)};this.onWaitingForHostDidChange=t=>{this.waitingForHostObserver.publish(t)};this.onParticipantListUpdate=t=>{this.participantListObserver.publish(t)};var I,U,z,W;let{language:e,canUseCams:r,canUseChat:i,canUseScreenshare:a,canUseDefaultAvatars:l,canUseFollow:u,canUseGoTo:f,canUseGather:m,canUseDefaultToolbar:b,canUseTranscription:C,browserService:h,offset:E,locales:w,avatars:x,customColors:S,waterMark:O,layoutPosition:R,camerasPosition:g,skipMeetingSettings:y,devices:d,layoutMode:p}=t;this.browserService=h;let T=this.layoutModalsAndCamerasConfig(R,g),v=document.createElement("div");this.frameConfig={apiKey:xe.get("apiKey"),apiUrl:xe.get("apiUrl"),ablyKey:xe.get("ablyKey"),debug:xe.get("debug"),roomId:xe.get("roomId"),limits:xe.get("limits"),canUseFollow:u,canUseGoTo:f,canUseCams:r,canUseChat:i,canUseGather:m,canUseScreenshare:a,canUseDefaultAvatars:l,canUseTranscription:C,camerasPosition:(I=T.camerasPosition)!=null?I:"right",canUseDefaultToolbar:b,devices:{audioInput:(U=d==null?void 0:d.audioInput)!=null?U:!0,audioOutput:(z=d==null?void 0:d.audioOutput)!=null?z:!0,videoInput:(W=d==null?void 0:d.videoInput)!=null?W:!0},waterMark:O,layoutMode:p,skipMeetingSettings:y,layoutPosition:T.layoutPosition},this.customColors=S,v.classList.add("sv_video_wrapper"),v.id="sv-video-wrapper",document.body.appendChild(v),this.updateFrameState(1),this.bricklayer=new ma,this.bricklayer.build(v.id,xe.get("conferenceLayerUrl"),$p,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(E),this.setFrameStyle(T.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:e,locales:w},this.meetingAvatars=x,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(t){t!==this.frameState&&(this.frameState=t,this.frameStateObserver.publish(this.frameState));let e={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(e[t])}start(t){this.messageBridge.publish("meeting.start",He(ce({},t),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var t,e;(t=this.messageBridge)==null||t.destroy(),(e=this.bricklayer)==null||e.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(t,e){this.messageBridge.publish(t,e)}};var wo=class extends on{constructor(e){var r;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var e,r,i,a,l,u,f,m,b,C,h,E,w,x,S,O,R,g,y,d,p,T,v,I,U,z,W,N;this.videoConfig={language:(e=this.params)==null?void 0:e.language,canUseTranscription:((r=this.params)==null?void 0:r.transcriptOff)===!1,canUseChat:!((i=this.params)!=null&&i.chatOff),canUseCams:!((a=this.params)!=null&&a.camsOff),canUseScreenshare:!((l=this.params)!=null&&l.screenshareOff),canUseDefaultAvatars:!!((u=this.params)!=null&&u.defaultAvatars)&&!((m=(f=this.localParticipant)==null?void 0:f.avatar)!=null&&m.model3DUrl),canUseGather:!!((b=this.params)!=null&&b.enableGather),canUseFollow:!!((C=this.params)!=null&&C.enableFollow),canUseGoTo:!!((h=this.params)!=null&&h.enableGoTo),canUseDefaultToolbar:(w=(E=this.params)==null?void 0:E.defaultToolbar)!=null?w:!0,camerasPosition:(S=(x=this.params)==null?void 0:x.collaborationMode)==null?void 0:S.position,devices:(O=this.params)==null?void 0:O.devices,skipMeetingSettings:(R=this.params)==null?void 0:R.skipMeetingSettings,browserService:this.browserService,offset:(g=this.params)==null?void 0:g.offset,locales:(d=(y=this.params)==null?void 0:y.locales)!=null?d:[],avatars:(T=(p=this.params)==null?void 0:p.avatars)!=null?T:[],customColors:(v=this.params)==null?void 0:v.customColors,layoutPosition:(U=(I=this.params)==null?void 0:I.collaborationMode)==null?void 0:U.modalPosition,layoutMode:(N=(W=(z=this.params)==null?void 0:z.collaborationMode)==null?void 0:W.initialView)!=null?N:"list",waterMark:this.showWaterMarkType},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new To(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video conference @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=e=>{var r;return{id:e.clientId,color:this.realtime.getSlotColor((r=e.data)==null?void 0:r.slotIndex).color,avatar:e.data.avatar,type:e.data.type,name:e.data.name,isHost:this.realtime.hostClientId===e.clientId}};this.onFrameSizeDidChange=e=>{this.publish("frame.dimensions-update",e)};this.onWaitingForHost=e=>{this.publish("meeting.waiting-for-host",e)};this.onConnectionStatusChange=e=>{this.logger.log("video conference @ on connection status change",e);let r=[2,4,3,6];r.includes(e)&&this.realtime.freezeSync(!0),r.includes(this.connectionService.oldConnectionStatus)&&!r.includes(e)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",e)};this.onMeetingStateChange=e=>{this.logger.log("video conference @ on meeting state change",e),this.publish("meeting.state-update",e)};this.onSameAccountError=e=>{this.publish("meeting.same-participant-error",e),this.internalRemoveComponent()};this.onDevicesChange=e=>{this.publish("meeting.devices-change",e)};this.onFrameStateChange=e=>{this.logger.log("video conference @ on frame state change",e),e===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:xe.get("roomId")})};this.onRealtimeEventFromFrame=({event:e,data:r})=>{this.logger.log("video conference @ on realtime event from frame",e,r);let i={["realtime.host-change"]:a=>this.realtime.setHost(a),["realtime.gather"]:a=>this.realtime.setGather(a),["realtime.grid-mode-change"]:a=>this.realtime.setGridMode(a),["realtime.drawing-change"]:a=>{this.realtime.setDrawing(a)},["realtime.follow-participant"]:a=>{this.realtime.setFollowParticipant(a)},["meeting.kick-participant"]:a=>{this.realtime.setKickParticipant(a)},["realtime.transcript-change"]:a=>{this.realtime.setTranscript(a)},["realtime.go-to-participant"]:a=>{this.eventBus.publish("realtime.go-to-participant",a)}}[e](r);this.publish(e,r)};this.onParticipantJoined=e=>{if(this.logger.log("video conference @ on participant joined",e),this.localParticipant=e,this.publish("meeting.participant-joined",e),this.publish("my-participant.joined",e),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:e.avatar,name:e.name,type:e.type});return}this.realtime.updateMyProperties({name:e.name,type:e.type})};this.onParticipantLeft=e=>{this.logger.log("video conference @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.internalRemoveComponent()};this.onParticipantListUpdate=e=>{this.logger.log("video conference @ on participant list update",e),!(0,$u.isEqual)(this.participantsOnMeeting,e)&&(this.publish("meeting.participant-list-update",e),this.participantsOnMeeting.length!==e.length&&this.publish("meeting.amount-of-participants-update",e.length),this.participantsOnMeeting=e)};this.onKickAllParticipantsDidChange=e=>{this.logger.log("video conference @ on kick all participants did change",e),this.publish("meeting.kick-all-participants",e),this.internalRemoveComponent()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.internalRemoveComponent()};this.onRoomInfoUpdated=e=>{this.logger.log("video conference @ on room info updated",e);let{isGridModeEnable:r,followParticipantId:i,gather:a,drawing:l,transcript:u}=e;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",r),this.videoManager.publishMessageToFrame("realtime.drawing-change",l),this.videoManager.publishMessageToFrame("realtime.follow-participant",i),this.videoManager.publishMessageToFrame("realtime.transcript-change",u),this.realtime.hostClientId===this.localParticipant.id&&a&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=e=>{this.logger.log("video conference @ on participants did change",e);let r=Object.values(e).map(i=>({timestamp:i.timestamp,connectionId:i.connectionId,participantId:i.clientId,color:this.realtime.getSlotColor(i.data.slotIndex).name,name:i.data.name,isHost:this.realtime.hostClientId===i.clientId,avatar:i.data.avatar,type:i.data.type}));(0,$u.isEqual)(this.participantToFrameList,r)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",r),this.participantToFrameList=r};this.onHostParticipantDidChange=e=>{this.logger.log("video conference @ on host participant did change",e),this.videoManager.publishMessageToFrame("realtime.host-change",e==null?void 0:e.newHostParticipantId)};this.onParticipantJoinedOnRealtime=e=>{this.logger.log("video conference @ on participant joined on realtime",e),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(e))};this.onParticipantLeftOnRealtime=e=>{this.logger.log("video conference @ on participant left on realtime",e),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(e))};this.params=He(ce({},e),{userType:(r=e==null?void 0:e.userType)!=null?r:"guest"}),this.name="videoConference",this.logger=new et(`@superviz/sdk/${"videoConference"}`),this.browserService=new Oo,this.connectionService=new pa,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){var e;this.logger.log("video conference @ start"),this.publish("meeting.start"),this.params.userType!=="guest"&&(this.localParticipant.type=this.params.userType),this.realtime.setKickParticipantsOnHostLeave(!((e=this.params)!=null&&e.allowGuests)),this.suscribeToRealtimeEvents(),this.showWaterMarkType=xe.get("waterMark"),this.startVideo()}destroy(){this.logger.log("video conference @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}internalRemoveComponent(){this.logger.log("video conference @ internal remove component");let{data:e}=this.realtime.participant,r=e.activeComponents.filter(i=>i!=="videoConference");this.realtime.updateMyProperties({activeComponents:r,type:"guest"}),this.realtime.setKickParticipantsOnHostLeave(!1),this.detach()}};D();var xo=class extends on{constructor(e){super();this.divWrapperReplacementInterval=null;this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.onMyParticipantMouseMove=e=>{let r=this.divWrapper.getBoundingClientRect();this.realtime.updatePresenceMouse(He(ce({},this.localParticipant),{mousePositionX:e.x-r.x,mousePositionY:e.y-r.y,originalWidth:r.width,originalHeight:r.height,containerId:this.containerId,visible:!0}))};this.onParticipantsDidChange=e=>{this.logger.log("presence-mouse component @ on participants did change",e),Object.values(e).forEach(r=>{var l;let i=(r==null?void 0:r.mousePositionX)&&this.presenceMouseElement,a=(r==null?void 0:r.id)===((l=this.localParticipant)==null?void 0:l.id);if(!(r!=null&&r.visible)){this.presenceMouseElement.removePresenceMouseParticipant(r.id);return}!a&&i&&this.presenceMouseElement.updatePresenceMouseParticipant(r)})};this.onMyParticipantMouseOut=()=>{this.realtime.updatePresenceMouse(ce({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=e=>{this.presenceMouseElement.removePresenceMouseParticipant(e.id)};if(this.name="presence",this.logger=new et(`@superviz/sdk/${"presence"}`),this.containerId=e,this.container=document.getElementById(e),!this.container){let r=`Container with id ${e} not found`;throw this.logger.log(r),new Error(r)}this.divWrapper=this.createDivWrapper()}start(){this.logger.log("presence-mouse component @ start"),this.presenceMouseElement=document.createElement("superviz-presence-mouse"),this.divWrapper.appendChild(this.presenceMouseElement),this.container.addEventListener("mousemove",this.onMyParticipantMouseMove),this.container.addEventListener("mouseout",this.onMyParticipantMouseOut),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),this.container.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.container.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.removeChild(this.presenceMouseElement),this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}createDivWrapper(){let e=this.container.getBoundingClientRect(),r=document.createElement("div");return this.container.parentElement.style.position="relative",r.style.position="fixed",r.style.top=`${e.top}px`,r.style.left=`${e.left}px`,r.style.width=`${e.width}px`,r.style.height=`${e.height}px`,r.style.pointerEvents="none",this.container.parentElement.appendChild(r),this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let i=this.container.getBoundingClientRect();r.style.top=`${i.top}px`,r.style.left=`${i.left}px`,r.style.width=`${i.width}px`,r.style.height=`${i.height}px`},1)),r}};D();D();var Ea=class{constructor(t){this.observers=new Map;this.subscribe=(t,e)=>{this.logger.log("pubsub service @ subscribe",{event:t,callback:e}),this.observers.has(t)||this.observers.set(t,new Ae),this.observers.get(t).subscribe(e)};this.unsubscribe=(t,e)=>{this.logger.log("pubsub service @ unsubscribe",{event:t,callback:e}),this.observers.has(t)&&(this.observers.get(t).reset(),this.observers.delete(t))};this.publish=(t,e)=>{this.logger.log("pubsub service @ publish",{event:t,data:e}),this.realtime.setSyncProperty(t,e)};this.publishEventToClient=(t,e)=>{this.logger.log("pubsub service @ publishEventToClient",{event:t,data:e}),this.observers.has(t)&&this.observers.get(t).publish(e)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(t=>t.destroy()),this.observers.clear()};this.onSyncPropertiesChange=t=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:t}),Object.entries(t).forEach(([e,r])=>{this.publishEventToClient(e,r)})};this.logger=new et("@superviz/sdk/pubsub"),this.realtime=t,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(t){return this.realtime.fetchSyncClientProperty(t)}};D();var Aa=(e=>(e.STARTED="STARTED",e.STOPPED="STOPPED",e))(Aa||{}),Ca=(t=>(t.REALTIME_STATE_CHANGED="realtime-component.state-changed",t))(Ca||{});var Io=class extends on{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=(e,r)=>{if(!this.pubsub){let i=`Realtime component is not started yet. You can't publish event ${e} before start`;this.logger.log(i);return}this.pubsub.publish(e,r)};this.subscribe=(e,r)=>{if(!this.pubsub){this.callbacksToSubscribeWhenJoined.push({event:e,callback:r});return}this.pubsub.subscribe(e,r)};this.unsubscribe=(e,r)=>{this.pubsub.unsubscribe(e,r)};this.name="realtime",this.logger=new et("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new Ea(this.realtime),this.callbacksToSubscribeWhenJoined.forEach(({event:e,callback:r})=>{this.pubsub.subscribe(e,r)}),this.changeState("STARTED")}fetchHistory(e){return this.pubsub.fetchHistory(e)}changeState(e){this.logger.log("realtime component @ changeState - state changed",e),this.state=e,this.pubsub.publishEventToClient("realtime-component.state-changed",this.state)}};D();D();var Hu=(O=>(O[O.yellow=0]="yellow",O[O.turquoise=1]="turquoise",O[O.orange=2]="orange",O[O.blue=3]="blue",O[O.pink=4]="pink",O[O.purple=5]="purple",O[O.green=6]="green",O[O.red=7]="red",O[O.bluedark=8]="bluedark",O[O.pinklight=9]="pinklight",O[O.purplelight=10]="purplelight",O[O.greenlight=11]="greenlight",O[O.orangelight=12]="orangelight",O[O.bluelight=13]="bluelight",O[O.redlight=14]="redlight",O[O.brown=15]="brown",O[O.gray=16]="gray",O))(Hu||{}),nr=(s=>(s[s["#FFEF33"]=0]="#FFEF33",s[s["#31E0B0"]=1]="#31E0B0",s[s["#FF5E10"]=2]="#FF5E10",s[s["#00ABF7"]=3]="#00ABF7",s[s["#FF00BB"]=4]="#FF00BB",s[s["#9C29FF"]=5]="#9C29FF",s[s["#6FDD00"]=6]="#6FDD00",s[s["#E30000"]=7]="#E30000",s[s["#304AFF"]=8]="#304AFF",s[s["#FF89C4"]=9]="#FF89C4",s[s["#D597FF"]=10]="#D597FF",s[s["#C6EC5C"]=11]="#C6EC5C",s[s["#FFA115"]=12]="#FFA115",s[s["#75DEFE"]=13]="#75DEFE",s[s["#FAA291"]=14]="#FAA291",s[s["#BB813F"]=15]="#BB813F",s[s["#878291"]=16]="#878291",s))(nr||{});D();var Gu=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(Gu||{});var Ro=class extends on{constructor(e){super();this.participants=[];this.onParticipantListUpdate=e=>{let r=Object.values(e);if(r.length===this.participants.length&&this.compareParticipants())return;let i=this.participants.map(u=>u.id),l=r.filter(({data:{id:u}})=>!i.includes(u)).map(u=>{let{slotIndex:f}=u.data,m=nr[f!=null?f:16];return He(ce({},u.data),{color:m})});this.participants=[...this.participants,...l],this.element.participants=this.participants};this.onParticipantJoined=e=>{var l,u,f;let r=(l=this.realtime.getParticipants[e.id])==null?void 0:l.data,i=r?(u=this.participants)==null?void 0:u.some(m=>m.id===r.id):!1,a=nr[r==null?void 0:r.slotIndex];e.slotIndex=r==null?void 0:r.slotIndex,i?this.participants=this.participants.map(m=>m.id===e.id?He(ce(ce({},m),e),{color:a}):m):this.participants.push(He(ce(ce({},(f=this.realtime.getParticipants[e.id])==null?void 0:f.data),e),{color:a})),a||this.getColorAfterDelay(e.id),this.element.participants=this.participants};this.onParticipantLeave=({id:e})=>{this.participants=this.participants.filter(r=>r.id!==e),this.element.participants=this.participants};this.position=e!=null?e:"top-right",this.name="whoIsOnline",this.logger=new et("@superviz/sdk/who-is-online-component")}start(){this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.participants=Object.values(this.realtime.getParticipants).map(e=>{let{slotIndex:r}=e.data,i=nr[r];return He(ce({},e.data),{participantId:e.id,color:i,slotIndex:r})}),this.element.participants=this.participants}destroy(){this.unsubscribeToRealtimeEvents(),this.element.remove(),this.element=null,this.participants=null}subscribeToRealtimeEvents(){this.realtime.presenceMouseParticipantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)}unsubscribeToRealtimeEvents(){this.realtime.presenceMouseParticipantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeave),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate)}compareParticipants(){let e=this.realtime.getParticipants;return this.participants.every(r=>e[r.id])}getColorAfterDelay(e){return _e(this,null,function*(){var l,u;let r=(u=(l=this.realtime)==null?void 0:l.getParticipants[e])==null?void 0:u.data,i=nr[r==null?void 0:r.slotIndex],a={color:i,slotIndex:r==null?void 0:r.slotIndex};if(!i){setTimeout(()=>{this.getColorAfterDelay(e)},100);return}this.participants=this.participants.map(f=>f.id===e?ce(ce({},f),a):f),this.element.participants=this.participants})}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(Gu).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[i,a]=this.position.split("-");this.element.position=`${i}: 20px; ${a}: 40px;`;return}let r=document.getElementById(this.position);if(!r){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}r.appendChild(this.element),this.element.position="position: relative;"}};D();var qu=Un(_u());D();function fT(s,t){return _e(this,null,function*(){try{return(yield yt.validateApiKey(s,t))===!0}catch(e){if(e.status===404)return!1;throw new Error("Unable to validate API key")}})}var Hp=fT;D();D();var Ii=class{static getRemoteConfig(){return _e(this,arguments,function*(t="prod"){let{version:e}=yield Promise.resolve().then(()=>(Wp(),Gp));if(t==="local"){let{remoteConfig:a}=yield Promise.resolve().then(()=>(Vp(),zp));return a}let r={version:e,environment:t},i=this.createUrl(r);return Mt(i,"GET",null)})}static createUrl({version:t,environment:e}){return`${this.REMOTE_CONFIG_BASE_URL}/${t}?env=${e}`}};Ii.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";D();var Ju=Un(da());D();var _o=class{constructor(){this.observers=new Map;this.subscribe=(t,e)=>{this.logger.log("event bus service @ subscribe",{event:t,callback:e}),this.observers.has(t)||this.observers.set(t,new Ae),this.observers.get(t).subscribe(e)};this.unsubscribe=(t,e)=>{this.logger.log("event bus service @ unsubscribe",{event:t,callback:e}),this.observers.has(t)&&(this.observers.get(t).reset(),this.observers.delete(t))};this.publish=(t,e)=>{this.logger.log("event bus service @ publish",{event:t,data:e}),this.observers.has(t)&&this.observers.get(t).publish(e)};this.logger=new et("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};D();var Mo=class{static checkComponentLimit(t){var i,a;let e=(i=Fu[t])!=null?i:t,r=xe.get("limits");return(a=r==null?void 0:r[e])!=null?a:!1}};D();D();var ju=Un(jp()),wr=Un(Du());D();var zu=(f=>(f[f.DISCONNECTED=0]="DISCONNECTED",f[f.INITIALIZING=1]="INITIALIZING",f[f.READY_TO_JOIN=2]="READY_TO_JOIN",f[f.CONNECTING=3]="CONNECTING",f[f.CONNECTED=4]="CONNECTED",f[f.JOINED=5]="JOINED",f[f.FAILED=-1]="FAILED",f[f.RETRYING=-2]="RETRYING",f))(zu||{});D();var Oa=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new et("@superviz/sdk/realtime-service"),this.participantsObserver=new Ae({logger:this.logger}),this.participantJoinedObserver=new Ae({logger:this.logger}),this.participantLeaveObserver=new Ae({logger:this.logger}),this.syncPropertiesObserver=new Ae({logger:this.logger}),this.reconnectObserver=new Ae({logger:this.logger}),this.roomInfoUpdatedObserver=new Ae({logger:this.logger}),this.roomListUpdatedObserver=new Ae({logger:this.logger}),this.hostObserver=new Ae({logger:this.logger}),this.hostAvailabilityObserver=new Ae({logger:this.logger}),this.realtimeStateObserver=new Ae({logger:this.logger}),this.kickAllParticipantsObserver=new Ae({logger:this.logger}),this.kickParticipantObserver=new Ae({logger:this.logger}),this.authenticationObserver=new Ae({logger:this.logger}),this.domainRefusedObserver=new Ae({logger:this.logger}),this.commentsObserver=new Ae({logger:this.logger}),this.presenceMouseObserver=new Ae({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Ae({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Ae({logger:this.logger}),this.presenceSlotsInfosObserver=new Ae({logger:this.logger}),this.presence3dObserver=new Ae({logger:this.logger}),this.presence3dLeaveObserver=new Ae({logger:this.logger}),this.presence3dJoinedObserver=new Ae({logger:this.logger})}subscribeToParticipantUpdate(t,e){this.participantObservers[t]||(this.participantObservers[t]=new Ae({logger:this.logger})),this.participantObservers[t].subscribe(e)}unsubscribeFromParticipantUpdate(t,e){this.participantObservers[t]&&this.participantObservers[t].unsubscribe(e)}subscribeToParticipant3DUpdate(t,e){this.participants3DObservers[t]||(this.participants3DObservers[t]=new Ae({logger:this.logger})),this.participants3DObservers[t].subscribe(e)}unsubscribeFromParticipant3DUpdate(t,e){this.participants3DObservers[t]&&this.participants3DObservers[t].unsubscribe(e)}getSlotColor(t){let e=t!=null?t:16;return{color:nr[e],name:Hu[e]}}};var pT=1e3*60,Jp=6e4,mT=1e4,Vu=1e3,Tr=null,Ri=class extends Oa{constructor(e,r){super();this.participants={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=e=>{if(!e){this.updateRoomProperties({hostClientId:null});return}let r=this.participants[e];this.updateRoomProperties({hostClientId:r.clientId})};this.setKickParticipant=e=>{if(!e)return;let r=this.participants[e];this.updateRoomProperties({kickParticipant:r})};this.freezeSync=e=>{var r,i;if(this.isSyncFrozen=e,e){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(r=this.broadcastChannel)==null||r.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=e=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,e),this.updatePresence3D(this.myParticipant.data)};this.setKickParticipantsOnHostLeave=e=>{this.shouldKickParticipantsOnHostLeave=e};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(e=>{if(this.clientSyncPropertiesQueue[e]=this.clientSyncPropertiesQueue[e].sort((l,u)=>l.timestamp-u.timestamp),!this.clientSyncPropertiesQueue[e].length)return;let{data:r,lengthToBeSplitted:i}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[e]),a=r;this.clientSyncPropertiesQueue[e].splice(0,i),this.clientSyncChannel.publish(e,a,l=>{!l||this.logger.log("REALTIME","Error in publish client sync properties",l.message)})})};this.saveClientRoomState=(e,r)=>_e(this,null,function*(){let i=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},i,{[e]:r[r.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=e=>_e(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,e),this.roomInfoUpdatedObserver.publish(this.localRoomProperties);let r=Object.values(this.participants).some(i=>{var a,l;return((l=(a=i.data)==null?void 0:a.activeComponents)==null?void 0:l.includes("videoConference"))&&i.data.type==="host"});e.hostClientId&&r&&Tr&&(clearTimeout(Tr),Tr=null,this.hostAvailabilityObserver.publish(!0)),!e.hostClientId&&r?(this.hostParticipantId=null,this.hostPassingHandle()):!!(e!=null&&e.hostClientId)&&(e==null?void 0:e.hostClientId)!==this.hostParticipantId?this.updateHostInfo(e.hostClientId):!r&&!!(e!=null&&e.hostClientId)?this.updateHostInfo(null):!e.hostClientId&&!Tr&&!r&&this.hostParticipantId&&(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),e.kickParticipant&&e.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,wr.default)((e={})=>{let r=e;this.isMessageTooBig(r)||this.left||!this.enableSync||this.isSyncFrozen||(r.avatar===void 0&&delete r.avatar,this.myParticipant.data=ce(ce({},this.myParticipant.data),r),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},Vu);this.updateRoomProperties=e=>{if(this.isMessageTooBig(e)||this.isSyncFrozen||this.left)return;let r=ce(ce({},this.localRoomProperties),e);this.supervizChannel.publish("update",r)};this.updateParticipants=()=>{let e={};this.supervizChannel.presence.get((r,i)=>{i.forEach(a=>{e[a.clientId]=ce({},a)}),this.participants=e,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=e=>{let r=[];if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{a||r.push({clientId:u.clientId,type:u.data.type})})}),!e||!r.some(a=>a.clientId===e&&a.type==="host")){this.hostPassingHandle();return}Tr&&(clearTimeout(Tr),this.hostAvailabilityObserver.publish(!0));let i=this.hostParticipantId;this.hostParticipantId=e,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var r;let e={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((r=this.myParticipant)==null?void 0:r.data.type)==="host"&&(e.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(e)};this.hostPassingHandle=(0,wr.default)(()=>_e(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((e,r)=>{let i=r.filter(l=>l.data.type==="host").map(l=>l.clientId);if(this.shouldKickParticipantsOnHostLeave&&!i.length){this.hostAvailabilityObserver.publish(!1),Tr=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},pT),this.setHost(null);return}let a=i[0];(a===this.localParticipantId||!i.length)&&this.setHost(a)})}),1e3);this.findSlotIndex=e=>{let r=e,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((u,f)=>{if(u){i=[];return}f.forEach(m=>{m.connectionId===r.connectionId&&(r=m),m.connectionId!==r.connectionId&&m.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(m.data.slotIndex),1)})}),i.length===0)return;let a=i[0];this.myParticipant.data.slotIndex=a,this.updateMyProperties({slotIndex:a});let l=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(r)},l)};this.confirmSlot=(0,wr.default)(e=>_e(this,null,function*(){let r=[],i=e;if(this.supervizChannel.presence.get((a,l)=>{l.forEach(u=>{u.connectionId===i.connectionId&&(i=u),u.connectionId!==i.connectionId&&u.data.slotIndex!==void 0&&r.push(u.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||r.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let a=yield this.fetchRoomProperties();this.updateRoomProperties(a)}}),1e3);this.onParticipantJoin=e=>{this.updateParticipants(),this.participantJoinedObserver.publish(e),this.updateMyProperties()};this.syncBroadcast=(0,wr.default)(()=>{let e=btoa(this.ablyKey),r=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(r,{headers:{Authorization:`Basic ${e}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(e,r=Jp)=>{let i=JSON.stringify(e);return new TextEncoder().encode(i).length>r?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=e=>{this.logger.log("REALTIME","Comments channel update",e),this.commentsObserver.publish(e)};this.updateComments=e=>{this.commentsChannel.publish("update",e)};this.enterPresenceMouseChannel=e=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(e)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel.presence.leave(),this.presenceMouseChannel=null)};this.updatePresenceMouse=(0,wr.default)(e=>{let r=Object.assign({},this.participantsMouse[e.id]||{},e);this.presenceMouseChannel.presence.update(r)},Vu);this.onPresenceMouseChannelEnter=e=>{this.presenceMouseParticipantJoinedObserver.publish(e.data)};this.onPresenceMouseChannelLeave=e=>{this.presenceMouseParticipantLeaveObserver.publish(e.data)};this.publishPresenceMouseUpdate=e=>{let r=this.getParticipantSlot(e.clientId);this.participantsMouse[e.clientId]=He(ce({},e.data),{slotIndex:r,color:this.getSlotColor(r).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=(0,wr.default)(e=>{var i,a,l;let r=Object.assign({},(a=(i=this.participantsOn3d[e.id])==null?void 0:i.data)!=null?a:{},e);this.participantsOn3d[e.id]=He(ce({},this.participants[r.id]),{data:ce(ce({},r),(l=this.participants[r.id])==null?void 0:l.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(r)},Vu);this.onPresence3DChannelEnter=e=>{var i;e.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let r=this.getParticipantSlot(e.clientId);this.presence3dJoinedObserver.publish(He(ce({},e),{data:He(ce(ce({},e.data),(i=this.participants[e.clientId])==null?void 0:i.data),{slotIndex:r,color:this.getSlotColor(r).color})}))};this.onPresence3DChannelLeave=e=>{delete this.participantsOn3d[e.clientId],this.presence3dLeaveObserver.publish(e)};this.publish3DUpdate=e=>{var a;let r=this.getParticipantSlot(e.clientId),i=He(ce({},e),{data:He(ce(ce({},e.data),(a=this.participants[e.clientId])==null?void 0:a.data),{slotIndex:r,color:this.getSlotColor(r).color})});this.participantsOn3d[e.clientId]=i,this.participants3DObservers[e.clientId]&&this.participants3DObservers[e.clientId].publish(i),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=r,this.apiUrl=e,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var e;return(e=this.roomProperties)==null?void 0:e.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var e,r;return(r=(e=this.myParticipant.data)==null?void 0:e.participantId)!=null?r:null}get isBroadcast(){return Object.values(this.participants).some(e=>e.data.type==="audience")}start({participant:e,roomId:r,apiKey:i}){this.myParticipant={data:He(ce({},e),{participantId:e.id}),timestamp:null,action:null,clientId:e.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=e.type!=="audience",this.roomId=`superviz:${r.toLowerCase()}-${i}`,this.apiKey=i,this.client||this.buildClient()}auth(e,r){if(!this.domainWhitelisted)return;let i=new ju.default.Rest({key:this.ablyKey}),{origin:a}=window.location;i.auth.requestToken(e,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:a,apiKey:this.apiKey}},(l,u)=>{var f;l&&this.authenticationObserver.publish("realtime.authentication-failed"),(f=l==null?void 0:l.message)!=null&&f.includes("this domain don't have permission")&&(this.domainWhitelisted=!1,this.domainRefusedObserver.publish(this.domainWhitelisted)),r(l,u)})}join(e){let r=e?Object.assign({},e,{participantId:e.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(r),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(e){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{isGridModeEnable:e}))}setDrawing(e){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{drawing:e}))}setTranscript(e){let r=this.localRoomProperties;this.updateRoomProperties(Object.assign({},r,{transcript:e}))}setSyncProperty(e,r){let i=(a,l)=>({name:a,data:l,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(i(e,r),mT)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",e,r),this.clientSyncPropertiesQueue[e]||(this.clientSyncPropertiesQueue[e]=[]),this.clientSyncPropertiesQueue[e].push(i(e,r))}setFollowParticipant(e){this.updateRoomProperties({followParticipantId:e})}setGather(e){this.updateRoomProperties({gather:e})}getParticipantSlot(e){var r,i;if(e){let a=e.toString();if(this.participants&&this.participants[a])return(i=(r=this.participants[e])==null?void 0:r.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(e){e.clientId===this.myParticipant.data.participantId?this.onJoinRoom(e):this.onParticipantJoin(e)}onAblyPresenceUpdate(e){var f,m,b,C,h;if(!this.isJoinedRoom)return;let{clientId:r}=e,i=Object.assign({},e,{participantId:e.clientId}),a=(b=(m=(f=this.participants[i.clientId])==null?void 0:f.data)==null?void 0:m.activeComponents)==null?void 0:b.includes("videoConference"),l=(h=(C=i.data)==null?void 0:C.activeComponents)==null?void 0:h.includes("videoConference"),u=a&&!l;this.publishParticipantUpdate(i),this.participants&&this.participants[r]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast(),u&&this.hostPassingHandle()}onAblyPresenceLeave(e){this.onParticipantLeave(e)}onClientSyncChannelUpdate(e){let{name:r,data:i}=e,a={};a[r]=i,this.syncPropertiesObserver.publish(a),e.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(r,i)}onReceiveBroadcastSync(e){e.data.forEach(i=>{var l;let a=i.clientId;this.participants[a]=i,(l=i.data)!=null&&l.isAudience||(this.participants[a].data=JSON.parse(this.participants[a].data),this.publishParticipantUpdate(this.participants[a]))})}onAblyRoomUpdate(e){this.updateLocalRoomState(e.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let e={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new ju.default.Realtime(e),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(e){this.participants[e.clientId]=e,this.participantsObserver.publish(this.participants),this.participantObservers[e.clientId]&&this.participantObservers[e.clientId].publish(e)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(e){throw this.logger.log(e),new Error(e)}publishStateUpdate(e){this.state!==e&&(this.state=e,this.logger.log("REALTIME",`Realtime state did change. New state: ${zu[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((e,r)=>{this.supervizChannel.history((i,a)=>{var u;i&&r(i);let l=(u=a.items[0])==null?void 0:u.data;e(l||null)})})}fetchSyncClientProperty(e){return _e(this,null,function*(){try{let r=yield new Promise((i,a)=>{this.clientRoomStateChannel.history((l,u)=>{var m;l&&a(l);let f=(m=u==null?void 0:u.items[0])==null?void 0:m.data;i(f||null)})});if(e&&!r[e])throw new Error(`Event ${e} not found in the history`);return e?r[e]:r}catch(r){this.logger.log("REALTIME","Error in fetch client realtime data",r.message),this.throw(r.message)}})}onStateChange(){var b,C,h;let e=(b=this.supervizChannelState)==null?void 0:b.current,r=(C=this.connectionState)==null?void 0:C.current,i=r==="connected",a=["initialized","connecting"].includes(r),l=["closed","closing"].includes(r)||["detaching","detached"].includes(e),u={[0]:l,[1]:a,[2]:!e&&i,[3]:e==="attaching",[4]:e==="attached"&&i,[-1]:e==="failed"||r==="failed",[-2]:r==="suspended"||e==="suspended"},f=Object.entries(u).find(([E,w])=>w&&E)[0],m=Number(f);if(!!this.domainWhitelisted){if(m===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(h=this.connectionState)!=null&&h.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}}onAblyConnectionStateChange(e){this.connectionState=e,this.onStateChange()}onAblyChannelStateChange(e){this.supervizChannelState=e,this.onStateChange()}onJoinRoom(e){return _e(this,null,function*(){var r;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(e),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let i=this.myParticipant.data.type==="host";(r=this.localRoomProperties)!=null&&r.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):i&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(e),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(e){if(this.state===2)return;let r=e.data.participantId===this.hostParticipantId;e.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(e),r&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}spliceArrayBySize(e,r=Jp){let i=f=>{let m=JSON.stringify(f);return new TextEncoder().encode(m).length},a=0,l=[],u=[];for(let f=0;f<e.length;f++){let m=i(e[f]);a+m<=r?(u.push(e[f]),a+=m):(l.push(u),u=[e[f]],a=m)}return u.length>0&&l.push(u),{data:l[0],lengthToBeSplitted:l[0].length}}enterPresence3DChannel(e){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(e)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(e)}};D();var Ku=class extends Or{constructor({participant:e,group:r}){super();this.activeComponents=[];this.eventBus=new _o;this.participants=[];this.addComponent=e=>{var i,a;if(!this.canAddComponent(e))return;e.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:xe.configuration,eventBus:this.eventBus}),this.activeComponents.push(e.name),this.realtime.updateMyProperties({activeComponents:this.activeComponents});let r=e.name==="whoIsOnline"?"presence":e.name;yt.sendActivity(this.participant.id,this.group.id,this.group.name,r),yt.createOrUpdateParticipant(xe.get("apiKey"),{name:(i=this.participant)==null?void 0:i.name,participantId:(a=this.participant)==null?void 0:a.id})};this.removeComponent=e=>{if(!this.activeComponents.includes(e.name)){let r=`Component ${e.name} is not initialized yet.`;this.logger.log(r);return}e.detach(),this.activeComponents.splice(this.activeComponents.indexOf(e.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.canAddComponent=e=>{let r=this.realtime.isDomainWhitelisted,i=Mo.checkComponentLimit(e.name),a=this.activeComponents.includes(e.name),l=[{isValid:r,message:`Component ${e.name} can't be used because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dev-dashboard.superviz.com/developer`},{isValid:!a,message:`Component ${e.name} is already active. Please remove it first`},{isValid:i,message:`You reached the limit usage of ${e.name}`}];for(let u=0;u<l.length;u++){let{isValid:f,message:m}=l[u];if(!f)return this.logger.log(m),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:xe.get("apiKey"),roomId:xe.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=e=>{var a;this.logger.log("launcher service @ onParticipantListUpdate",e);let r=Object.values(e).map(l=>{var u,f,m,b,C,h;return{id:l.data.id,name:(u=l.data)==null?void 0:u.name,type:(f=l.data)==null?void 0:f.type,avatar:(m=l.data)==null?void 0:m.avatar,avatarConfig:(b=l.data)==null?void 0:b.avatarConfig,isHost:this.realtime.hostClientId===l.clientId,color:this.realtime.getSlotColor((C=l.data)==null?void 0:C.slotIndex).color,activeComponents:(h=l.data)==null?void 0:h.activeComponents}}),i=r.find(l=>{var u;return(l==null?void 0:l.id)===((u=this.participant)==null?void 0:u.id)});(0,Ju.isEqual)(this.participants,r)||(this.participants=r,this.publish("participant.list-updated",r),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",r)),i&&!(0,Ju.isEqual)(this.participant,i)&&(this.activeComponents=(a=i.activeComponents)!=null?a:[],this.participant=i,this.publish("participant.updated",i),this.logger.log("Publishing ParticipantEvent.UPDATED",i)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",r)};this.onParticipantJoined=e=>{this.logger.log("launcher service @ onParticipantJoined");let r=this.participants.find(i=>i.id===e.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",r)),this.logger.log("launcher service @ onParticipantJoined - participant joined",r),this.publish("participant.joined",r))};this.onParticipantLeave=e=>{this.logger.log("launcher service @ onParticipantLeave");let r=this.participants.find(i=>i.id===e.data.id);!r||(r.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",r)),this.logger.log("launcher service @ onParticipantLeave - participant left",r),this.publish("participant.left",r))};this.onHostParticipantDidChange=e=>{let r=this.participants.find(i=>i.id===(e==null?void 0:e.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",r),this.publish("realtime.host-change",r))};this.onHostAvailabilityChange=e=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),e){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=He(ce({},e),{type:"guest"}),this.group=r,this.logger=new et("@superviz/sdk/launcher"),this.realtime=new Ri(xe.get("apiUrl"),xe.get("ablyKey")),this.eventBus=new _o,this.logger.log("launcher created"),this.startRealtime()}},Kp=s=>{let t=new Ku(s);return{subscribe:t.subscribe,unsubscribe:t.unsubscribe,addComponent:t.addComponent,removeComponent:t.removeComponent}};var gT=({group:s,participant:t,roomId:e})=>{if(!s||!s.name||!s.id)throw new Error("Group fields is required");if(!t||!t.id||!t.name)throw new Error("Participant name and id is required");if(!e)throw new Error("Room id is required")},vT=(s,t)=>_e(void 0,null,function*(){if(!(s&&s.trim()))throw new Error("API key is required");if(!t)throw new Error("Options is required");gT(t),t.debug?qu.debug.enable("*"):qu.debug.disable();let{apiUrl:r,conferenceLayerUrl:i}=yield Ii.getRemoteConfig(t.environment);if(!(yield Hp(r,s)))throw new Error("Failed to validate API key");let l=yield yt.fetchConfig(r,s),u=yield yt.fetchLimits(r,s),f=yield yt.fetchWaterMark(r,s);if(!l||!l.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:m}=l;return xe.setConfig({apiUrl:r,ablyKey:m,apiKey:s,conferenceLayerUrl:i,environment:l,roomId:t.roomId,debug:t.debug,limits:u,waterMark:f}),Kp(t)}),Zu=vT;D();D();D();D();D();var Ta=globalThis,xa=Ta.ShadowRoot&&(Ta.ShadyCSS===void 0||Ta.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Zp=Symbol(),qp=new WeakMap,wa=class{constructor(t,e,r){if(this._$cssResult$=!0,r!==Zp)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o,e=this.t;if(xa&&t===void 0){let r=e!==void 0&&e.length===1;r&&(t=qp.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&qp.set(e,t))}return t}toString(){return this.cssText}},Yp=s=>new wa(typeof s=="string"?s:s+"",void 0,Zp);var Yu=(s,t)=>{if(xa)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let e of t){let r=document.createElement("style"),i=Ta.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=e.cssText,s.appendChild(r)}},Ia=xa?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(let r of t.cssRules)e+=r.cssText;return Yp(e)})(s):s;var{is:yT,defineProperty:bT,getOwnPropertyDescriptor:ET,getOwnPropertyNames:AT,getOwnPropertySymbols:CT,getPrototypeOf:ST}=Object,rr=globalThis,Qp=rr.trustedTypes,OT=Qp?Qp.emptyScript:"",Qu=rr.reactiveElementPolyfillSupport,Po=(s,t)=>s,Ra={toAttribute(s,t){switch(t){case Boolean:s=s?OT:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch(r){e=null}}return e}},Xu=(s,t)=>!yT(s,t),Xp={attribute:!0,type:String,converter:Ra,reflect:!1,hasChanged:Xu},em,tm;(em=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(tm=rr.litPropertyMetadata)!=null||(rr.litPropertyMetadata=new WeakMap);var xr=class extends HTMLElement{static addInitializer(t){var e;this._$Ei(),((e=this.l)!=null?e:this.l=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Xp){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(t,r,e);i!==void 0&&bT(this.prototype,t,i)}}static getPropertyDescriptor(t,e,r){var l;let{get:i,set:a}=(l=ET(this.prototype,t))!=null?l:{get(){return this[e]},set(u){this[e]=u}};return{get(){return i==null?void 0:i.call(this)},set(u){let f=i==null?void 0:i.call(this);a.call(this,u),this.requestUpdate(t,f,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){var e;return(e=this.elementProperties.get(t))!=null?e:Xp}static _$Ei(){if(this.hasOwnProperty(Po("elementProperties")))return;let t=ST(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Po("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Po("properties"))){let e=this.properties,r=[...AT(e),...CT(e)];for(let i of r)this.createProperty(i,e[i])}let t=this[Symbol.metadata];if(t!==null){let e=litPropertyMetadata.get(t);if(e!==void 0)for(let[r,i]of e)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[e,r]of this.elementProperties){let i=this._$Eu(e,r);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){let e=[];if(Array.isArray(t)){let r=new Set(t.flat(1/0).reverse());for(let i of r)e.unshift(Ia(i))}else t!==void 0&&e.push(Ia(t));return e}static _$Eu(t,e){let r=e.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e,r;((e=this._$ES)!=null?e:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((r=t.hostConnected)==null||r.call(t))}removeController(t){var e;(e=this._$ES)==null||e.splice(this._$ES.indexOf(t)>>>0,1)}_$E_(){let t=new Map,e=this.constructor.elementProperties;for(let r of e.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){var e;let t=(e=this.shadowRoot)!=null?e:this.attachShadow(this.constructor.shadowRootOptions);return Yu(t,this.constructor.elementStyles),t}connectedCallback(){var t,e;(t=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)==null||e.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)==null||t.forEach(e=>{var r;return(r=e.hostDisconnected)==null?void 0:r.call(e)})}attributeChangedCallback(t,e,r){this._$AK(t,r)}_$EO(t,e){var a;let r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){let l=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:Ra).toAttribute(e,r.type);this._$Em=t,l==null?this.removeAttribute(i):this.setAttribute(i,l),this._$Em=null}}_$AK(t,e){var a;let r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){let l=r.getPropertyOptions(i),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:Ra;this._$Em=i,this[i]=u.fromAttribute(e,l.type),this._$Em=null}}requestUpdate(t,e,r,i=!1,a){var l;if(t!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(t)),!((l=r.hasChanged)!=null?l:Xu)(i?a:this[t],e))return;this.C(t,e,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(t,e,r){var i;this._$AL.has(t)||this._$AL.set(t,e),r.reflect===!0&&this._$Em!==t&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(t)}_$EP(){return _e(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(e){Promise.reject(e)}let t=this.scheduleUpdate();return t!=null&&(yield t),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,l]of i)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let t=!1,e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(e)):this._$ET()}catch(i){throw t=!1,this._$ET(),i}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$ES)==null||e.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EO(e,this[e]))),this._$ET()}updated(t){}firstUpdated(t){}},nm;xr.elementStyles=[],xr.shadowRootOptions={mode:"open"},xr[Po("elementProperties")]=new Map,xr[Po("finalized")]=new Map,Qu==null||Qu({ReactiveElement:xr}),((nm=rr.reactiveElementVersions)!=null?nm:rr.reactiveElementVersions=[]).push("2.0.0");D();var Do=globalThis,_a=Do.trustedTypes,rm=_a?_a.createPolicy("lit-html",{createHTML:s=>s}):void 0,nc="$lit$",kn=`lit$${(Math.random()+"").slice(9)}$`,rc="?"+kn,TT=`<${rc}>`,_r=document,Ma=()=>_r.createComment(""),No=s=>s===null||typeof s!="object"&&typeof s!="function",cm=Array.isArray,fm=s=>cm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",ec=`[ 	
\f\r]`,Lo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,im=/-->/g,om=/>/g,Ir=RegExp(`>|${ec}(?:([^\\s"'>=/]+)(${ec}*=${ec}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),sm=/'/g,am=/"/g,dm=/^(?:script|style|textarea|title)$/i,hm=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),o_=hm(1),s_=hm(2),Bn=Symbol.for("lit-noChange"),wt=Symbol.for("lit-nothing"),lm=new WeakMap,Rr=_r.createTreeWalker(_r,129);function pm(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return rm!==void 0?rm.createHTML(t):t}var mm=(s,t)=>{let e=s.length-1,r=[],i,a=t===2?"<svg>":"",l=Lo;for(let u=0;u<e;u++){let f=s[u],m,b,C=-1,h=0;for(;h<f.length&&(l.lastIndex=h,b=l.exec(f),b!==null);)h=l.lastIndex,l===Lo?b[1]==="!--"?l=im:b[1]!==void 0?l=om:b[2]!==void 0?(dm.test(b[2])&&(i=RegExp("</"+b[2],"g")),l=Ir):b[3]!==void 0&&(l=Ir):l===Ir?b[0]===">"?(l=i!=null?i:Lo,C=-1):b[1]===void 0?C=-2:(C=l.lastIndex-b[2].length,m=b[1],l=b[3]===void 0?Ir:b[3]==='"'?am:sm):l===am||l===sm?l=Ir:l===im||l===om?l=Lo:(l=Ir,i=void 0);let E=l===Ir&&s[u+1].startsWith("/>")?" ":"";a+=l===Lo?f+TT:C>=0?(r.push(m),f.slice(0,C)+nc+f.slice(C)+kn+E):f+kn+(C===-2?u:E)}return[pm(s,a+(s[e]||"<?>")+(t===2?"</svg>":"")),r]},Mr=class{constructor({strings:t,_$litType$:e},r){let i;this.parts=[];let a=0,l=0,u=t.length-1,f=this.parts,[m,b]=mm(t,e);if(this.el=Mr.createElement(m,r),Rr.currentNode=this.el.content,e===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Rr.nextNode())!==null&&f.length<u;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(nc)){let h=b[l++],E=i.getAttribute(C).split(kn),w=/([.?@])?(.*)/.exec(h);f.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?La:w[1]==="?"?Da:w[1]==="@"?Na:Dr}),i.removeAttribute(C)}else C.startsWith(kn)&&(f.push({type:6,index:a}),i.removeAttribute(C));if(dm.test(i.tagName)){let C=i.textContent.split(kn),h=C.length-1;if(h>0){i.textContent=_a?_a.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],Ma()),Rr.nextNode(),f.push({type:2,index:++a});i.append(C[h],Ma())}}}else if(i.nodeType===8)if(i.data===rc)f.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(kn,C+1))!==-1;)f.push({type:7,index:a}),C+=kn.length-1}a++}}static createElement(t,e){let r=_r.createElement("template");return r.innerHTML=t,r}};function Pr(s,t,e=s,r){var l,u,f;if(t===Bn)return t;let i=r!==void 0?(l=e._$Co)==null?void 0:l[r]:e._$Cl,a=No(t)?void 0:t._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((u=i==null?void 0:i._$AO)==null||u.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,e,r)),r!==void 0?((f=e._$Co)!=null?f:e._$Co=[])[r]=i:e._$Cl=i),i!==void 0&&(t=Pr(s,i._$AS(s,t.values),i,r)),t}var Pa=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var m;let{el:{content:e},parts:r}=this._$AD,i=((m=t==null?void 0:t.creationScope)!=null?m:_r).importNode(e,!0);Rr.currentNode=i;let a=Rr.nextNode(),l=0,u=0,f=r[0];for(;f!==void 0;){if(l===f.index){let b;f.type===2?b=new Lr(a,a.nextSibling,this,t):f.type===1?b=new f.ctor(a,f.name,f.strings,this,t):f.type===6&&(b=new Fa(a,this,t)),this._$AV.push(b),f=r[++u]}l!==(f==null?void 0:f.index)&&(a=Rr.nextNode(),l++)}return Rr.currentNode=_r,i}p(t){let e=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,e),e+=r.strings.length-2):r._$AI(t[e])),e++}},Lr=class{get _$AU(){var t,e;return(e=(t=this._$AM)==null?void 0:t._$AU)!=null?e:this._$Cv}constructor(t,e,r,i){var a;this.type=2,this._$AH=wt,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let t=this._$AA.parentNode,e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Pr(this,t,e),No(t)?t===wt||t==null||t===""?(this._$AH!==wt&&this._$AR(),this._$AH=wt):t!==this._$AH&&t!==Bn&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):fm(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==wt&&No(this._$AH)?this._$AA.nextSibling.data=t:this.$(_r.createTextNode(t)),this._$AH=t}g(t){var a;let{values:e,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=Mr.createElement(pm(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(e);else{let l=new Pa(i,this),u=l.u(this.options);l.p(e),this.$(u),this._$AH=l}}_$AC(t){let e=lm.get(t.strings);return e===void 0&&lm.set(t.strings,e=new Mr(t)),e}T(t){cm(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,r,i=0;for(let a of t)i===e.length?e.push(r=new Lr(this.k(Ma()),this.k(Ma()),this,this.options)):r=e[i],r._$AI(a),i++;i<e.length&&(this._$AR(r&&r._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,e);t&&t!==this._$AB;){let i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}},Dr=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,r,i,a){this.type=1,this._$AH=wt,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=wt}_$AI(t,e=this,r,i){let a=this.strings,l=!1;if(a===void 0)t=Pr(this,t,e,0),l=!No(t)||t!==this._$AH&&t!==Bn,l&&(this._$AH=t);else{let u=t,f,m;for(t=a[0],f=0;f<a.length-1;f++)m=Pr(this,u[r+f],e,f),m===Bn&&(m=this._$AH[f]),l||(l=!No(m)||m!==this._$AH[f]),m===wt?t=wt:t!==wt&&(t+=(m!=null?m:"")+a[f+1]),this._$AH[f]=m}l&&!i&&this.j(t)}j(t){t===wt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}},La=class extends Dr{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===wt?void 0:t}},Da=class extends Dr{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==wt)}},Na=class extends Dr{constructor(t,e,r,i,a){super(t,e,r,i,a),this.type=5}_$AI(t,e=this){var l;if((t=(l=Pr(this,t,e,0))!=null?l:wt)===Bn)return;let r=this._$AH,i=t===wt&&r!==wt||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,a=t!==wt&&(r===wt||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,r;typeof this._$AH=="function"?this._$AH.call((r=(e=this.options)==null?void 0:e.host)!=null?r:this.element,t):this._$AH.handleEvent(t)}},Fa=class{constructor(t,e,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){Pr(this,t)}},gm={S:nc,A:kn,P:rc,C:1,M:mm,L:Pa,R:fm,V:Pr,D:Lr,I:Dr,H:Da,N:Na,U:La,B:Fa},tc=Do.litHtmlPolyfillSupport,um;tc==null||tc(Mr,Lr),((um=Do.litHtmlVersions)!=null?um:Do.litHtmlVersions=[]).push("3.0.0");D();D();D();var Ua=globalThis,ka=Ua.ShadowRoot&&(Ua.ShadyCSS===void 0||Ua.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ic=Symbol(),vm=new WeakMap,Fo=class{constructor(t,e,r){if(this._$cssResult$=!0,r!==ic)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o,e=this.t;if(ka&&t===void 0){let r=e!==void 0&&e.length===1;r&&(t=vm.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),r&&vm.set(e,t))}return t}toString(){return this.cssText}},ym=s=>new Fo(typeof s=="string"?s:s+"",void 0,ic),Ie=(s,...t)=>{let e=s.length===1?s[0]:t.reduce((r,i,a)=>r+(l=>{if(l._$cssResult$===!0)return l.cssText;if(typeof l=="number")return l;throw Error("Value passed to 'css' function must be a 'css' function result: "+l+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[a+1],s[0]);return new Fo(e,s,ic)},oc=(s,t)=>{if(ka)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let e of t){let r=document.createElement("style"),i=Ua.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=e.cssText,s.appendChild(r)}},Ba=ka?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(let r of t.cssRules)e+=r.cssText;return ym(e)})(s):s;var{is:wT,defineProperty:xT,getOwnPropertyDescriptor:IT,getOwnPropertyNames:RT,getOwnPropertySymbols:_T,getPrototypeOf:MT}=Object,ir=globalThis,bm=ir.trustedTypes,PT=bm?bm.emptyScript:"",sc=ir.reactiveElementPolyfillSupport,Uo=(s,t)=>s,ac={toAttribute(s,t){switch(t){case Boolean:s=s?PT:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch(r){e=null}}return e}},Om=(s,t)=>!wT(s,t),Em={attribute:!0,type:String,converter:ac,reflect:!1,hasChanged:Om},Am,Cm;(Am=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Cm=ir.litPropertyMetadata)!=null||(ir.litPropertyMetadata=new WeakMap);var $n=class extends HTMLElement{static addInitializer(t){var e;this._$Ei(),((e=this.l)!=null?e:this.l=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Em){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(t,r,e);i!==void 0&&xT(this.prototype,t,i)}}static getPropertyDescriptor(t,e,r){var l;let{get:i,set:a}=(l=IT(this.prototype,t))!=null?l:{get(){return this[e]},set(u){this[e]=u}};return{get(){return i==null?void 0:i.call(this)},set(u){let f=i==null?void 0:i.call(this);a.call(this,u),this.requestUpdate(t,f,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){var e;return(e=this.elementProperties.get(t))!=null?e:Em}static _$Ei(){if(this.hasOwnProperty(Uo("elementProperties")))return;let t=MT(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Uo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Uo("properties"))){let e=this.properties,r=[...RT(e),..._T(e)];for(let i of r)this.createProperty(i,e[i])}let t=this[Symbol.metadata];if(t!==null){let e=litPropertyMetadata.get(t);if(e!==void 0)for(let[r,i]of e)this.elementProperties.set(r,i)}this._$Eh=new Map;for(let[e,r]of this.elementProperties){let i=this._$Eu(e,r);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){let e=[];if(Array.isArray(t)){let r=new Set(t.flat(1/0).reverse());for(let i of r)e.unshift(Ba(i))}else t!==void 0&&e.push(Ba(t));return e}static _$Eu(t,e){let r=e.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e,r;((e=this._$ES)!=null?e:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((r=t.hostConnected)==null||r.call(t))}removeController(t){var e;(e=this._$ES)==null||e.splice(this._$ES.indexOf(t)>>>0,1)}_$E_(){let t=new Map,e=this.constructor.elementProperties;for(let r of e.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){var e;let t=(e=this.shadowRoot)!=null?e:this.attachShadow(this.constructor.shadowRootOptions);return oc(t,this.constructor.elementStyles),t}connectedCallback(){var t,e;(t=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)==null||e.forEach(r=>{var i;return(i=r.hostConnected)==null?void 0:i.call(r)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)==null||t.forEach(e=>{var r;return(r=e.hostDisconnected)==null?void 0:r.call(e)})}attributeChangedCallback(t,e,r){this._$AK(t,r)}_$EO(t,e){var a;let r=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,r);if(i!==void 0&&r.reflect===!0){let l=(((a=r.converter)==null?void 0:a.toAttribute)!==void 0?r.converter:ac).toAttribute(e,r.type);this._$Em=t,l==null?this.removeAttribute(i):this.setAttribute(i,l),this._$Em=null}}_$AK(t,e){var a;let r=this.constructor,i=r._$Eh.get(t);if(i!==void 0&&this._$Em!==i){let l=r.getPropertyOptions(i),u=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:ac;this._$Em=i,this[i]=u.fromAttribute(e,l.type),this._$Em=null}}requestUpdate(t,e,r,i=!1,a){var l;if(t!==void 0){if(r!=null||(r=this.constructor.getPropertyOptions(t)),!((l=r.hasChanged)!=null?l:Om)(i?a:this[t],e))return;this.C(t,e,r)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(t,e,r){var i;this._$AL.has(t)||this._$AL.set(t,e),r.reflect===!0&&this._$Em!==t&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(t)}_$EP(){return _e(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(e){Promise.reject(e)}let t=this.scheduleUpdate();return t!=null&&(yield t),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let i=this.constructor.elementProperties;if(i.size>0)for(let[a,l]of i)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let t=!1,e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(r=this._$ES)==null||r.forEach(i=>{var a;return(a=i.hostUpdate)==null?void 0:a.call(i)}),this.update(e)):this._$ET()}catch(i){throw t=!1,this._$ET(),i}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$ES)==null||e.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EO(e,this[e]))),this._$ET()}updated(t){}firstUpdated(t){}},Sm;$n.elementStyles=[],$n.shadowRootOptions={mode:"open"},$n[Uo("elementProperties")]=new Map,$n[Uo("finalized")]=new Map,sc==null||sc({ReactiveElement:$n}),((Sm=ir.reactiveElementVersions)!=null?Sm:ir.reactiveElementVersions=[]).push("2.0.0");D();var Bo=globalThis,$a=Bo.trustedTypes,Tm=$a?$a.createPolicy("lit-html",{createHTML:s=>s}):void 0,Pm="$lit$",or=`lit$${(Math.random()+"").slice(9)}$`,Lm="?"+or,LT=`<${Lm}>`,Ur=document,$o=()=>Ur.createComment(""),Ho=s=>s===null||typeof s!="object"&&typeof s!="function",Dm=Array.isArray,DT=s=>Dm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",lc=`[ 	
\f\r]`,ko=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,wm=/-->/g,xm=/>/g,Nr=RegExp(`>|${lc}(?:([^\\s"'>=/]+)(${lc}*=${lc}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Im=/'/g,Rm=/"/g,Nm=/^(?:script|style|textarea|title)$/i,Fm=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),ge=Fm(1),d_=Fm(2),kr=Symbol.for("lit-noChange"),xt=Symbol.for("lit-nothing"),_m=new WeakMap,Fr=Ur.createTreeWalker(Ur,129);function Um(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Tm!==void 0?Tm.createHTML(t):t}var NT=(s,t)=>{let e=s.length-1,r=[],i,a=t===2?"<svg>":"",l=ko;for(let u=0;u<e;u++){let f=s[u],m,b,C=-1,h=0;for(;h<f.length&&(l.lastIndex=h,b=l.exec(f),b!==null);)h=l.lastIndex,l===ko?b[1]==="!--"?l=wm:b[1]!==void 0?l=xm:b[2]!==void 0?(Nm.test(b[2])&&(i=RegExp("</"+b[2],"g")),l=Nr):b[3]!==void 0&&(l=Nr):l===Nr?b[0]===">"?(l=i!=null?i:ko,C=-1):b[1]===void 0?C=-2:(C=l.lastIndex-b[2].length,m=b[1],l=b[3]===void 0?Nr:b[3]==='"'?Rm:Im):l===Rm||l===Im?l=Nr:l===wm||l===xm?l=ko:(l=Nr,i=void 0);let E=l===Nr&&s[u+1].startsWith("/>")?" ":"";a+=l===ko?f+LT:C>=0?(r.push(m),f.slice(0,C)+Pm+f.slice(C)+or+E):f+or+(C===-2?u:E)}return[Um(s,a+(s[e]||"<?>")+(t===2?"</svg>":"")),r]},Br=class{constructor({strings:t,_$litType$:e},r){let i;this.parts=[];let a=0,l=0,u=t.length-1,f=this.parts,[m,b]=NT(t,e);if(this.el=Br.createElement(m,r),Fr.currentNode=this.el.content,e===2){let C=this.el.content.firstChild;C.replaceWith(...C.childNodes)}for(;(i=Fr.nextNode())!==null&&f.length<u;){if(i.nodeType===1){if(i.hasAttributes())for(let C of i.getAttributeNames())if(C.endsWith(Pm)){let h=b[l++],E=i.getAttribute(C).split(or),w=/([.?@])?(.*)/.exec(h);f.push({type:1,index:a,name:w[2],strings:E,ctor:w[1]==="."?fc:w[1]==="?"?dc:w[1]==="@"?hc:Mi}),i.removeAttribute(C)}else C.startsWith(or)&&(f.push({type:6,index:a}),i.removeAttribute(C));if(Nm.test(i.tagName)){let C=i.textContent.split(or),h=C.length-1;if(h>0){i.textContent=$a?$a.emptyScript:"";for(let E=0;E<h;E++)i.append(C[E],$o()),Fr.nextNode(),f.push({type:2,index:++a});i.append(C[h],$o())}}}else if(i.nodeType===8)if(i.data===Lm)f.push({type:2,index:a});else{let C=-1;for(;(C=i.data.indexOf(or,C+1))!==-1;)f.push({type:7,index:a}),C+=or.length-1}a++}}static createElement(t,e){let r=Ur.createElement("template");return r.innerHTML=t,r}};function _i(s,t,e=s,r){var l,u,f;if(t===kr)return t;let i=r!==void 0?(l=e._$Co)==null?void 0:l[r]:e._$Cl,a=Ho(t)?void 0:t._$litDirective$;return(i==null?void 0:i.constructor)!==a&&((u=i==null?void 0:i._$AO)==null||u.call(i,!1),a===void 0?i=void 0:(i=new a(s),i._$AT(s,e,r)),r!==void 0?((f=e._$Co)!=null?f:e._$Co=[])[r]=i:e._$Cl=i),i!==void 0&&(t=_i(s,i._$AS(s,t.values),i,r)),t}var cc=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var m;let{el:{content:e},parts:r}=this._$AD,i=((m=t==null?void 0:t.creationScope)!=null?m:Ur).importNode(e,!0);Fr.currentNode=i;let a=Fr.nextNode(),l=0,u=0,f=r[0];for(;f!==void 0;){if(l===f.index){let b;f.type===2?b=new $r(a,a.nextSibling,this,t):f.type===1?b=new f.ctor(a,f.name,f.strings,this,t):f.type===6&&(b=new pc(a,this,t)),this._$AV.push(b),f=r[++u]}l!==(f==null?void 0:f.index)&&(a=Fr.nextNode(),l++)}return Fr.currentNode=Ur,i}p(t){let e=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,e),e+=r.strings.length-2):r._$AI(t[e])),e++}},$r=class{get _$AU(){var t,e;return(e=(t=this._$AM)==null?void 0:t._$AU)!=null?e:this._$Cv}constructor(t,e,r,i){var a;this.type=2,this._$AH=xt,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=r,this.options=i,this._$Cv=(a=i==null?void 0:i.isConnected)!=null?a:!0}get parentNode(){let t=this._$AA.parentNode,e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=_i(this,t,e),Ho(t)?t===xt||t==null||t===""?(this._$AH!==xt&&this._$AR(),this._$AH=xt):t!==this._$AH&&t!==kr&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):DT(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==xt&&Ho(this._$AH)?this._$AA.nextSibling.data=t:this.$(Ur.createTextNode(t)),this._$AH=t}g(t){var a;let{values:e,_$litType$:r}=t,i=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=Br.createElement(Um(r.h,r.h[0]),this.options)),r);if(((a=this._$AH)==null?void 0:a._$AD)===i)this._$AH.p(e);else{let l=new cc(i,this),u=l.u(this.options);l.p(e),this.$(u),this._$AH=l}}_$AC(t){let e=_m.get(t.strings);return e===void 0&&_m.set(t.strings,e=new Br(t)),e}T(t){Dm(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,r,i=0;for(let a of t)i===e.length?e.push(r=new $r(this.k($o()),this.k($o()),this,this.options)):r=e[i],r._$AI(a),i++;i<e.length&&(this._$AR(r&&r._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,e);t&&t!==this._$AB;){let i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}},Mi=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,r,i,a){this.type=1,this._$AH=xt,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=a,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=xt}_$AI(t,e=this,r,i){let a=this.strings,l=!1;if(a===void 0)t=_i(this,t,e,0),l=!Ho(t)||t!==this._$AH&&t!==kr,l&&(this._$AH=t);else{let u=t,f,m;for(t=a[0],f=0;f<a.length-1;f++)m=_i(this,u[r+f],e,f),m===kr&&(m=this._$AH[f]),l||(l=!Ho(m)||m!==this._$AH[f]),m===xt?t=xt:t!==xt&&(t+=(m!=null?m:"")+a[f+1]),this._$AH[f]=m}l&&!i&&this.j(t)}j(t){t===xt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}},fc=class extends Mi{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===xt?void 0:t}},dc=class extends Mi{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==xt)}},hc=class extends Mi{constructor(t,e,r,i,a){super(t,e,r,i,a),this.type=5}_$AI(t,e=this){var l;if((t=(l=_i(this,t,e,0))!=null?l:xt)===kr)return;let r=this._$AH,i=t===xt&&r!==xt||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,a=t!==xt&&(r===xt||i);i&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,r;typeof this._$AH=="function"?this._$AH.call((r=(e=this.options)==null?void 0:e.host)!=null?r:this.element,t):this._$AH.handleEvent(t)}},pc=class{constructor(t,e,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){_i(this,t)}};var uc=Bo.litHtmlPolyfillSupport,Mm;uc==null||uc(Br,$r),((Mm=Bo.litHtmlVersions)!=null?Mm:Bo.litHtmlVersions=[]).push("3.0.0");var km=(s,t,e)=>{var a,l;let r=(a=e==null?void 0:e.renderBefore)!=null?a:t,i=r._$litPart$;if(i===void 0){let u=(l=e==null?void 0:e.renderBefore)!=null?l:null;r._$litPart$=i=new $r(t.insertBefore($o(),u),u,void 0,e!=null?e:{})}return i._$AI(s),i};var Re=class extends $n{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,r;let t=super.createRenderRoot();return(r=(e=this.renderOptions).renderBefore)!=null||(e.renderBefore=t.firstChild),t}update(t){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=km(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return kr}},Bm;Re._$litElement$=!0,Re["finalized"]=!0,(Bm=globalThis.litElementHydrateSupport)==null||Bm.call(globalThis,{LitElement:Re});var mc=globalThis.litElementPolyfillSupport;mc==null||mc({LitElement:Re});var $m;(($m=globalThis.litElementVersions)!=null?$m:globalThis.litElementVersions=[]).push("4.0.0");D();D();D();var ke=s=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(s,t)}):customElements.define(s,t)};D();D();D();D();D();D();D();D();D();var Hr=class extends Re{render(){return ge` <div>Hello from SuperViz, ${this.name}</div> `}};Hr.properties={name:{type:String}},Hr.styles=Ie`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,Hr=Ue([ke("superviz-hello-world")],Hr);D();D();D();D();var gc=Ie`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;D();var vc=Ie`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;D();var yc=Ie`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;D();var bc=Ie`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }

  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }
`;var We=s=>{var e;class t extends s{connectedCallback(){setTimeout(()=>{var l;let i=document.getElementById("superviz-style"),a=document.createElement("style");a.innerHTML=(i==null?void 0:i.innerHTML)||"",(l=this.shadowRoot)==null||l.appendChild(a)}),super.connectedCallback()}emitEvent(i,a,l={composed:!0,bubbles:!0}){let u=new CustomEvent(i,ce({detail:a},l));this.dispatchEvent(u)}}return t.styles=[gc,vc,yc,bc,(e=s.styles)!=null?e:[]],t};var Hm=We(Re),FT=[Hm.styles],Gr=class extends Hm{constructor(){super();this.name="",this.size="md"}render(){return ge` <i class="sv-icon sv-icon-${this.name}_${this.size}"></i> `}};Gr.properties={name:{type:String},size:{type:String}},Gr.styles=[FT,Ie`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }
    `],Gr=Ue([ke("superviz-icon")],Gr);D();D();D();D();var Ga={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Wa=s=>(...t)=>({_$litDirective$:s,values:t}),Pi=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,r){this._$Ct=t,this._$AM=e,this._$Ci=r}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};var it=Wa(class extends Pi{constructor(s){var t;if(super(s),s.type!==Ga.ATTRIBUTE||s.name!=="class"||((t=s.strings)==null?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(t=>s[t]).join(" ")+" "}update(s,[t]){var r,i;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(a=>a!=="")));for(let a in t)t[a]&&!((r=this.st)!=null&&r.has(a))&&this.it.add(a);return this.render(t)}let e=s.element.classList;for(let a of this.it)a in t||(e.remove(a),this.it.delete(a));for(let a in t){let l=!!t[a];l===this.it.has(a)||((i=this.st)==null?void 0:i.has(a))||(l?(e.add(a),this.it.add(a)):(e.remove(a),this.it.delete(a)))}return Bn}});D();var Gm=Ie`
  .dropdown {
    position: relative;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .header {
    display: flex;
    flex-direction: column;
    gap: 5px;
    padding: 5px 10px 0;
    font-size: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
    top: 7px;
  }

  .who-is-online-dropdown {
    top: 4px;
    padding: 4px;
  }

  .items {
    list-style: none;
    padding: 0;
    color: #9fa5b5;
    margin: 0;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    left: 0;
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .items li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 5px 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
  }

  .sv-icon {
    width: 40px;
    height: 40px;
    background-color: red;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .items li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .sv-hr {
    width: 100%;
    height: 0.8px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }
`;var Wm=We(Re),UT=[Wm.styles,Gm],Wr=class extends Wm{constructor(){super(...arguments);this.onClickOutDropdown=e=>{if(e.stopPropagation(),!this.open)return;let r=e.composedPath(),i=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],f=r.includes(i),m=r.includes(a),b=r.includes(u);f||m||b||(this.open=!1)};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=e=>{this.open=!1;let r=this.returnTo?e[this.returnTo]:e;this.emitEvent("selected",r,{bubbles:!1,composed:!1})}}updated(e){if(!!e.has("open")){if(this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown),this.close()}}render(){var u;let e={menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right","who-is-online-dropdown":this.name},r=()=>this.name?ge` <div class="header">
        <span class="text">${this.name}</span>
        <span class="sv-hr"></span>
      </div>`:ge``,i=(u=this.icons)==null?void 0:u.map(f=>ge`<superviz-icon name="${f}" size="sm"></superviz-icon>`),a=this.options.map((f,m)=>{let b={text:!0,"text-bold":!0,active:this.active===(f==null?void 0:f[this.returnTo])};return ge`<li @click=${()=>this.callbackSelected(f)} class=${it(b)}>
        ${i==null?void 0:i.at(m)} ${f[this.label]}
      </li>`}),l=()=>{this.open=!this.open};return ge`
      <div class="dropdown">
        <div class="dropdown-content" @click=${()=>l()}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <div class=${it(e)}>
          ${r()}
          <ul class="items">
            ${a}
          </ul>
        </div>
      </div>
    `}};Wr.styles=UT,Wr.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},position:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]},icons:{type:Array},name:{type:String}},Wr=Ue([ke("superviz-dropdown")],Wr);D();D();var zm=Ie`
#mouse-container {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

#mouse-sync {
  position: absolute;
}

.mouse-board {
  background: transparent;
  position: absolute;
  top: 0;
  cursor: none !important;
}

.mouse-follower {
  position: absolute;
  display: block;
  transition: all 0.4s;
}

.pointer-mouse {
  display: flex;
  height: 17px;
  width: 17px;
  background-image: url(https://production.cdn.superviz.com/static/pointers/0.svg);
}

.mouse-user-name {
  display: block;
  position: absolute;  
  border-radius: 30px;
  padding: 2px 8px;
  font-weight: 700;
  font-size: 14px;
  font-family: Roboto, sans-serif;
  line-height: 22px;
  margin-left: 10px;
  margin-top: -6px;
  background: yellow;
  white-space: nowrap;
}
`;var Li=class extends Re{constructor(){super();this.updatePresenceMouseParticipant=e=>{if(!this.shadowRoot.getElementById(`mouse-${e.id}`)){let u=this.shadowRoot.getElementById("mouse-sync"),f=document.createElement("div");f.setAttribute("id",`mouse-${e.id}`),f.setAttribute("class","mouse-follower");let m=document.createElement("div");m.setAttribute("class","pointer-mouse");let b=document.createElement("div");b.setAttribute("class","mouse-user-name"),b.innerHTML=e.name,f.appendChild(m),f.appendChild(b),u&&u.appendChild(f)}let i=this.shadowRoot.getElementById(`mouse-${e.id}`);if(!i)return;let a=this.shadowRoot.getElementById(`mouse-${e.id}`),l=this.shadowRoot.getElementById(`mouse-${e.id}`);if(a&&l){let u=a.getElementsByClassName("mouse-user-name")[0],f=l.getElementsByClassName("pointer-mouse")[0];f&&(f.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${e.slotIndex}.svg)`),u&&(u.style.color=this.textColorValues.includes(e.slotIndex)?"#FFFFFF":"#26242A",u.style.backgroundColor=e.color,u.innerHTML=e.name);let{containerId:m}=e,b=document.getElementById(m),C=e.mousePositionX,h=e.mousePositionY;if(m){let E=(b==null?void 0:b.clientWidth)||1,w=(b==null?void 0:b.clientHeight)||1;C=e.mousePositionX/e.originalWidth*E,h=e.mousePositionY/e.originalHeight*w}i.style.left=`${C}px`,i.style.top=`${h}px`}};this.textColorValues=[2,4,5,7,8,16]}removePresenceMouseParticipant(e){let r=this.shadowRoot.getElementById(`mouse-${e}`);r&&r.remove()}render(){return ge`
      <div id="mouse-container" class="mouse-board">
        <div id="mouse-sync"></div>
      </div>
    `}};Li.styles=[zm],Li=Ue([ke("superviz-presence-mouse")],Li);D();D();D();var za=Ie`  
  .modal--overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: rgba(var(--sv-gray-400), 0.8);
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: transparent;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var Vm=We(Re),kT=[Vm.styles,za],Di=class extends Vm{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=e=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(e)};this.createModal=({detail:e})=>{this.createContainer(e),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var e;this.modal=void 0,(e=this.getContainer())==null||e.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};Di.styles=kT,Di=Ue([ke("superviz-modal")],Di);D();var jm=We(Re),BT=[jm.styles,za],Ni=class extends jm{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(e){this.options=e}render(){let e=()=>ge`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,r=()=>ge`
        <div class="modal--body">
          <div class="modal--body-content">
            ${this.options.body}
          </div>
        </div>
      `,i=()=>{if(this.options.footer)return ge`
          <div class="modal--footer">
            ${this.options.footer}
          </div>
        `;let a=this.options.confirmLabel||"OK",l=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?ge`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>${l}</button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
          </div>
        `:ge`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${a}</button>
        </div>
      `};return ge`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">
          ${e()}

          ${r()}

          ${i()}
        </div>
      </div>
    `}};Ni.styles=BT,Ni=Ue([ke("superviz-modal-container")],Ni);D();D();D();D();var Ec=Ie`
  .container {
    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    height: 100%;
  }

  .container-close {
    display: none;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }
`;D();var Ac=Ie`
  div.topbar {
    display: flex;
    justify-content: space-between;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  div.topbar span {
    margin: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .toggle-icon {
    cursor: pointer;
    transition: 0.15s;
    border-radius: 50%;
    aspect-ratio: 1;
  }

  .toggle-icon:hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
`;D();var Cc=Ie`
  .annotations {
    display: flex;
    flex-direction: column;
    background-color: rgb(var(--sv-gray-400));
    min-height: 10px;
    padding: 8px;
  }

  .annotations--add-comment-btn {
    color: rgb(var(--sv-white));
    text-align: center;
    padding: 8px;
  }

  .annotations--comments-input {
    width: 288px;
    padding: 8px;
  }

  .hidden {
    display: none;
  }
`;D();var Sc=Ie`
  .reply {
    padding-left: 24px !important;
  }

  .comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comment-item__user {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comment-item__actions superviz-dropdown,
  .comment-item__actions button {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comment-item__user-details {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comment-item__avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comment-item__content__body {
    color: rgb(var(--sv-gray-700));
  }

  .hidden {
    display: none;
  }
`;D();var Oc=Ie`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;D();var Tc=Ie`
  .comment-input {
    display: flex;
    flex-direction: column;
    width: 100%;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
  }

  .comment-input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comment-input:focus-within > .sv-hr {
    background: rgb(var(--sv-gray-500))
  }

  #comment-input--textarea {
    all: unset;
    border: 0px;
    border-radius: 4px;
    outline: none;
    height: 13px;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    padding: 12px 11px !important;
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    resize: none;
    appearance: none;
    width: 90%;
  }

  #comment-input--textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
  }

  .comment-input--options {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
  }

  .mention {
    display: none;
  }

  .comment-input--send-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-primary));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgba(var(--sv-white), 1);
    border: 0px;
    cursor: pointer;
  }

  .align-send-btn > superviz-icon {
    margin-right: 2px;
    margin-top: 4px;
  }

  .comment-input--send-btn:disabled {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-gray-200));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgb(var(--sv-gray-400));
    border: 0px;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
  }
`;D();var wc=Ie`
  .annotation-item--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
  }

  .annotation-item:hover:not(.annotation-item--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    padding: 8px;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  div:last-child {
    margin-left: 8px;
  }

  .comments-container {
    display: flex;
    flex-direction: column;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    display: none;
  }

  .annotation-item {
    padding: 8px;
    cursor: pointer;
  }
`;D();var xc=Ie`
  .annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;D();var Ic=Ie`
  .annotation-pin,
  .annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: white;
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid white;
    box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.25);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    cursor: pointer;
  }

  .annotation-pin:hover,
  .annotation-pin:focus,
  .annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: white;
  }

  .annotation-pin__avatar--add {
    font-size: 24px;
    color: rgb(var(--sv-gray-700));
    background-color: white;
  }

  .annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;

    object-fit: cover;
  }
`;D();var Rc=Ie`
  .select {
    display: flex;
    width: 100%;
    justify-content: flex-end;
    align-items: center;
  }

  .select-container {
    text-wrap: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
`;D();var _c=Ie`
  button.float-button {
    position: fixed;

    border-radius: 50%;
    width: 38px;
    height: 38px;

    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    border: none;

    background-color: white;
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    transition: all 300ms;
    cursor: pointer;
  }

  button.float-button p {
    display: none;
  }

  .hide-button {
    display: none !important;
  }

  button.float-button:hover {
    width: 110px;
    border-radius: 30px;
  }

  button.float-button:hover p {
    display: block;
  }
`;D();var Mc=Ie`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;D();var Pc;function Lc(s){let t=s.querySelector("#superviz-comments");if(t&&!Pc){let e={childList:!0,attributes:!0,characterData:!0,subtree:!0};Pc=new MutationObserver(r=>{r.forEach(i=>{!i.removedNodes.length||i.removedNodes.forEach(a=>{a.id==="poweredby-footer"&&$T(s)})})}),Pc.observe(t,e)}}function $T(s){let t=document.createElement("div");t.id="poweredby-footer",t.className="footer";let e=document.createElement("div");e.className="powered-by powered-by--horizontal";let r=document.createElement("a");r.href="https://superviz.com/",r.target="_blank",r.className="link";let i=document.createElement("div");i.textContent="Powered by";let a=document.createElement("img");a.width=48,a.height=8.86,a.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",e.appendChild(r),r.appendChild(i),i.appendChild(a),t.appendChild(e);let l=s.getElementById("superviz-comments");l&&l.appendChild(t),Lc(s)}var Jm=We(Re),HT=[Jm.styles,Ec,Mc],zr=class extends Jm{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1}updateAnnotations(e){this.annotations=e}toggle(){this.emitEvent("toggle",{})}waterMarkStatus(e){this.waterMarkState=e}setFilter({detail:e}){let{filter:r}=e;this.annotationFilter=r}updated(e){super.updated(e),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".superviz-comments");!r||(this.waterMarkState&&Lc(this.shadowRoot),r.setAttribute("style",this.side))})}render(){let e=[this.open?"container":"container-close","superviz-comments"].join(" "),r=ge` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`,i=this.waterMarkState?r:"";return ge`
      <div id="superviz-comments" class=${e}>
        <div class="header">
          <superviz-comments-topbar @close=${this.toggle}></superviz-comments-topbar>
          <superviz-comments-annotations id="annotations" open=${this.open}>
          </superviz-comments-annotations>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          class="content"
        ></superviz-comments-content>
        ${i}
      </div>
    `}};zr.styles=HT,zr.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String}},zr=Ue([ke("superviz-comments")],zr);D();D();var GT=We(Re),WT=[GT.styles,Ac],Vr=class extends We(Re){constructor(){super();this.side="left"}close(){this.dispatchEvent(new CustomEvent("close"))}render(){return this.side==="left"?ge`
        <div class="topbar">
          <span @click=${this.close} class="toggle-icon">
            <superviz-icon name="left" size="lg"></superviz-icon>
          </span>
          <span class="text text-bold">COMMENTS</span>
        </div>
      `:ge`
      <div class="topbar">
        <span class="text text-bold">COMMENTS</span>
        <span @click=${this.close} class="toggle-icon">
          <superviz-icon name="right" size="lg"></superviz-icon>
        </span>
      </div>
    `}};Vr.styles=WT,Vr.properties={side:{type:String}},Vr=Ue([ke("superviz-comments-topbar")],Vr);D();var Km=We(Re),zT=[Km.styles,Cc],jr=class extends Km{constructor(){super(...arguments);this.prepareToCreateAnnotation=r=>_e(this,[r],function*({detail:e}){this.annotation=e,yield this.updateComplete,this.emitEvent("comment-input-focus",e)});this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=e=>{(e==null?void 0:e.key)==="Escape"&&(this.annotation=null)}}createComment({detail:e}){this.emitEvent("create-annotation",e),this.annotation=null}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",e=>{e.key==="Escape"&&this.cancelTemporaryAnnotationEsc(e)})}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation),window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",e=>{e.key==="Escape"&&this.cancelTemporaryAnnotationEsc(e)})}render(){let e={"annotations--comments-input":!0,hidden:!this.annotation};return ge`
      <div class="annotations">
        <span class="text text-big text-bold annotations--add-comment-btn">
          Click anywhere to add a comment
        </span>
        <div class=${it(e)}>
          <superviz-comments-comment-input
            @create-annotation=${this.createComment}
            eventType="create-annotation"
          >
          </superviz-comments-comment-input>
        </div>
      </div>
    `}};jr.styles=zT,jr.properties={annotation:{type:Object}},jr=Ue([ke("superviz-comments-annotations")],jr);D();D();D();D();var{D:VT}=gm;var qm=()=>document.createComment(""),Fi=(s,t,e)=>{var a;let r=s._$AA.parentNode,i=t===void 0?s._$AB:t._$AA;if(e===void 0){let l=r.insertBefore(qm(),i),u=r.insertBefore(qm(),i);e=new VT(l,u,s,s.options)}else{let l=e._$AB.nextSibling,u=e._$AM,f=u!==s;if(f){let m;(a=e._$AQ)==null||a.call(e,s),e._$AM=s,e._$AP!==void 0&&(m=s._$AU)!==u._$AU&&e._$AP(m)}if(l!==i||f){let m=e._$AA;for(;m!==l;){let b=m.nextSibling;r.insertBefore(m,i),m=b}}}return e},sr=(s,t,e=s)=>(s._$AI(t,e),s),jT={},Zm=(s,t=jT)=>s._$AH=t,Ym=s=>s._$AH,ja=s=>{var r;(r=s._$AP)==null||r.call(s,!1,!0);let t=s._$AA,e=s._$AB.nextSibling;for(;t!==e;){let i=t.nextSibling;t.remove(),t=i}};var Qm=(s,t,e)=>{let r=new Map;for(let i=t;i<=e;i++)r.set(s[i],i);return r},Xm=Wa(class extends Pi{constructor(s){if(super(s),s.type!==Ga.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,t,e){let r;e===void 0?e=t:t!==void 0&&(r=t);let i=[],a=[],l=0;for(let u of s)i[l]=r?r(u,l):l,a[l]=e(u,l),l++;return{values:a,keys:i}}render(s,t,e){return this.ht(s,t,e).values}update(s,[t,e,r]){var x;let i=Ym(s),{values:a,keys:l}=this.ht(t,e,r);if(!Array.isArray(i))return this.dt=l,a;let u=(x=this.dt)!=null?x:this.dt=[],f=[],m,b,C=0,h=i.length-1,E=0,w=a.length-1;for(;C<=h&&E<=w;)if(i[C]===null)C++;else if(i[h]===null)h--;else if(u[C]===l[E])f[E]=sr(i[C],a[E]),C++,E++;else if(u[h]===l[w])f[w]=sr(i[h],a[w]),h--,w--;else if(u[C]===l[w])f[w]=sr(i[C],a[w]),Fi(s,f[w+1],i[C]),C++,w--;else if(u[h]===l[E])f[E]=sr(i[h],a[E]),Fi(s,i[C],i[h]),h--,E++;else if(m===void 0&&(m=Qm(l,E,w),b=Qm(u,C,h)),m.has(u[C]))if(m.has(u[h])){let S=b.get(l[E]),O=S!==void 0?i[S]:null;if(O===null){let R=Fi(s,i[C]);sr(R,a[E]),f[E]=R}else f[E]=sr(O,a[E]),Fi(s,i[C],O),i[S]=null;E++}else ja(i[h]),h--;else ja(i[C]),C++;for(;E<=w;){let S=Fi(s,f[w+1]);sr(S,a[E]),f[E++]=S}for(;C<=h;){let S=i[C++];S!==null&&ja(S)}return this.dt=l,Zm(s,f),Bn}});var eg=We(Re),JT=[eg.styles,Oc],Jr=class extends eg{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:e})=>{let{uuid:r}=e;if(this.selectedAnnotation===r){this.selectedAnnotation=null;return}this.selectedAnnotation=r};this.checkLastAnnotation=e=>{var a,l;let r=this.annotations.filter(u=>u.resolved),i=this.annotations.filter(u=>!u.resolved);return this.annotationFilter==="all"?e===((a=r[r.length-1])==null?void 0:a.uuid):e===((l=i[i.length-1])==null?void 0:l.uuid)};this.annotations=[]}updated(e){super.updated(e),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!r)return;let i=this.lastCommentId===this.selectedAnnotation,a=i?0:-150,l=r.getClientRects()[0];!l||(this.scrollBy(0,l.y+a),i&&setTimeout(()=>{this.scrollBy(0,l.y+a)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return ge` ${Xm(this.annotations.filter(e=>e.comments.length),e=>e.uuid,e=>ge`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(e)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${e.uuid}
          isLastComment=${this.checkLastAnnotation(e.uuid)}
        >
        </superviz-comments-annotation-item>
      `)}`}};Jr.styles=JT,Jr.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String}},Jr=Ue([ke("superviz-comments-content")],Jr);D();D();D();D();D();var Hn=class extends Error{},Ja=class extends Hn{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}},Ka=class extends Hn{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}},qa=class extends Hn{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}},Gn=class extends Hn{},Ui=class extends Hn{constructor(t){super(`Invalid unit ${t}`)}},It=class extends Hn{},pn=class extends Hn{constructor(){super("Zone is an abstract class")}};D();D();D();var pe="numeric",mn="short",qt="long",ar={year:pe,month:pe,day:pe},Go={year:pe,month:mn,day:pe},Dc={year:pe,month:mn,day:pe,weekday:mn},Wo={year:pe,month:qt,day:pe},zo={year:pe,month:qt,day:pe,weekday:qt},Vo={hour:pe,minute:pe},jo={hour:pe,minute:pe,second:pe},Jo={hour:pe,minute:pe,second:pe,timeZoneName:mn},Ko={hour:pe,minute:pe,second:pe,timeZoneName:qt},qo={hour:pe,minute:pe,hourCycle:"h23"},Zo={hour:pe,minute:pe,second:pe,hourCycle:"h23"},Yo={hour:pe,minute:pe,second:pe,hourCycle:"h23",timeZoneName:mn},Qo={hour:pe,minute:pe,second:pe,hourCycle:"h23",timeZoneName:qt},Xo={year:pe,month:pe,day:pe,hour:pe,minute:pe},es={year:pe,month:pe,day:pe,hour:pe,minute:pe,second:pe},ts={year:pe,month:mn,day:pe,hour:pe,minute:pe},ns={year:pe,month:mn,day:pe,hour:pe,minute:pe,second:pe},Nc={year:pe,month:mn,day:pe,weekday:mn,hour:pe,minute:pe},rs={year:pe,month:qt,day:pe,hour:pe,minute:pe,timeZoneName:mn},is={year:pe,month:qt,day:pe,hour:pe,minute:pe,second:pe,timeZoneName:mn},os={year:pe,month:qt,day:pe,weekday:qt,hour:pe,minute:pe,timeZoneName:qt},ss={year:pe,month:qt,day:pe,weekday:qt,hour:pe,minute:pe,second:pe,timeZoneName:qt};D();D();D();D();var Ht=class{get type(){throw new pn}get name(){throw new pn}get ianaName(){return this.name}get isUniversal(){throw new pn}offsetName(t,e){throw new pn}formatOffset(t,e){throw new pn}offset(t){throw new pn}equals(t){throw new pn}get isValid(){throw new pn}};var Fc=null,On=class extends Ht{static get instance(){return Fc===null&&(Fc=new On),Fc}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:e,locale:r}){return Ya(t,e,r)}formatOffset(t,e){return lr(this.offset(t),e)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}};D();var Xa={};function KT(s){return Xa[s]||(Xa[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Xa[s]}var qT={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function ZT(s,t){let e=s.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(e),[,i,a,l,u,f,m,b]=r;return[l,i,a,u,f,m,b]}function YT(s,t){let e=s.formatToParts(t),r=[];for(let i=0;i<e.length;i++){let{type:a,value:l}=e[i],u=qT[a];a==="era"?r[u]=l:De(u)||(r[u]=parseInt(l,10))}return r}var Qa={},Ct=class extends Ht{static create(t){return Qa[t]||(Qa[t]=new Ct(t)),Qa[t]}static resetCache(){Qa={},Xa={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch(e){return!1}}constructor(t){super(),this.zoneName=t,this.valid=Ct.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:e,locale:r}){return Ya(t,e,r,this.name)}formatOffset(t,e){return lr(this.offset(t),e)}offset(t){let e=new Date(t);if(isNaN(e))return NaN;let r=KT(this.name),[i,a,l,u,f,m,b]=r.formatToParts?YT(r,e):ZT(r,e);u==="BC"&&(i=-Math.abs(i)+1);let h=ki({year:i,month:a,day:l,hour:f===24?0:f,minute:m,second:b,millisecond:0}),E=+e,w=E%1e3;return E-=w>=0?w:1e3+w,(h-E)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}};D();var tg={};function QT(s,t={}){let e=JSON.stringify([s,t]),r=tg[e];return r||(r=new Intl.ListFormat(s,t),tg[e]=r),r}var Uc={};function kc(s,t={}){let e=JSON.stringify([s,t]),r=Uc[e];return r||(r=new Intl.DateTimeFormat(s,t),Uc[e]=r),r}var Bc={};function XT(s,t={}){let e=JSON.stringify([s,t]),r=Bc[e];return r||(r=new Intl.NumberFormat(s,t),Bc[e]=r),r}var $c={};function ew(s,t={}){let l=t,{base:e}=l,r=xu(l,["base"]),i=JSON.stringify([s,r]),a=$c[i];return a||(a=new Intl.RelativeTimeFormat(s,t),$c[i]=a),a}var as=null;function tw(){return as||(as=new Intl.DateTimeFormat().resolvedOptions().locale,as)}function nw(s){let t=s.indexOf("-x-");t!==-1&&(s=s.substring(0,t));let e=s.indexOf("-u-");if(e===-1)return[s];{let r,i;try{r=kc(s).resolvedOptions(),i=s}catch(u){let f=s.substring(0,e);r=kc(f).resolvedOptions(),i=f}let{numberingSystem:a,calendar:l}=r;return[i,a,l]}}function rw(s,t,e){return(e||t)&&(s.includes("-u-")||(s+="-u"),e&&(s+=`-ca-${e}`),t&&(s+=`-nu-${t}`)),s}function iw(s){let t=[];for(let e=1;e<=12;e++){let r=Ce.utc(2009,e,1);t.push(s(r))}return t}function ow(s){let t=[];for(let e=1;e<=7;e++){let r=Ce.utc(2016,11,13+e);t.push(s(r))}return t}function el(s,t,e,r){let i=s.listingMode();return i==="error"?null:i==="en"?e(t):r(t)}function sw(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var Hc=class{constructor(t,e,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;let u=r,{padTo:i,floor:a}=u,l=xu(u,["padTo","floor"]);if(!e||Object.keys(l).length>0){let f=ce({useGrouping:!1},r);r.padTo>0&&(f.minimumIntegerDigits=r.padTo),this.inf=XT(t,f)}}format(t){if(this.inf){let e=this.floor?Math.floor(t):t;return this.inf.format(e)}else{let e=this.floor?Math.floor(t):Bi(t,3);return ct(e,this.padTo)}}},Gc=class{constructor(t,e,r){this.opts=r,this.originalZone=void 0;let i;if(this.opts.timeZone)this.dt=t;else if(t.zone.type==="fixed"){let l=-1*(t.offset/60),u=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;t.offset!==0&&Ct.create(u).valid?(i=u,this.dt=t):(i="UTC",this.dt=t.offset===0?t:t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone)}else t.zone.type==="system"?this.dt=t:t.zone.type==="iana"?(this.dt=t,i=t.zone.name):(i="UTC",this.dt=t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone);let a=ce({},this.opts);a.timeZone=a.timeZone||i,this.dtf=kc(e,a)}format(){return this.originalZone?this.formatToParts().map(({value:t})=>t).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map(e=>{if(e.type==="timeZoneName"){let r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return He(ce({},e),{value:r})}else return e}):t}resolvedOptions(){return this.dtf.resolvedOptions()}},Wc=class{constructor(t,e,r){this.opts=ce({style:"long"},r),!e&&tl()&&(this.rtf=ew(t,r))}format(t,e){return this.rtf?this.rtf.format(t,e):ng(e,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}},Je=class{static fromOpts(t){return Je.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,e,r,i=!1){let a=t||Qe.defaultLocale,l=a||(i?"en-US":tw()),u=e||Qe.defaultNumberingSystem,f=r||Qe.defaultOutputCalendar;return new Je(l,u,f,a)}static resetCache(){as=null,Uc={},Bc={},$c={}}static fromObject({locale:t,numberingSystem:e,outputCalendar:r}={}){return Je.create(t,e,r)}constructor(t,e,r,i){let[a,l,u]=nw(t);this.locale=a,this.numberingSystem=e||l||null,this.outputCalendar=r||u||null,this.intl=rw(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=sw(this)),this.fastNumbersCached}listingMode(){let t=this.isEnglish(),e=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&e?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Je.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(He(ce({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(He(ce({},t),{defaultToEN:!1}))}months(t,e=!1){return el(this,t,zc,()=>{let r=e?{month:t,day:"numeric"}:{month:t},i=e?"format":"standalone";return this.monthsCache[i][t]||(this.monthsCache[i][t]=iw(a=>this.extract(a,r,"month"))),this.monthsCache[i][t]})}weekdays(t,e=!1){return el(this,t,Vc,()=>{let r=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},i=e?"format":"standalone";return this.weekdaysCache[i][t]||(this.weekdaysCache[i][t]=ow(a=>this.extract(a,r,"weekday"))),this.weekdaysCache[i][t]})}meridiems(){return el(this,void 0,()=>jc,()=>{if(!this.meridiemCache){let t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ce.utc(2016,11,13,9),Ce.utc(2016,11,13,19)].map(e=>this.extract(e,t,"dayperiod"))}return this.meridiemCache})}eras(t){return el(this,t,Jc,()=>{let e={era:t};return this.eraCache[t]||(this.eraCache[t]=[Ce.utc(-40,1,1),Ce.utc(2017,1,1)].map(r=>this.extract(r,e,"era"))),this.eraCache[t]})}extract(t,e,r){let i=this.dtFormatter(t,e),a=i.formatToParts(),l=a.find(u=>u.type.toLowerCase()===r);return l?l.value:null}numberFormatter(t={}){return new Hc(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new Gc(t,this.intl,e)}relFormatter(t={}){return new Wc(this.intl,this.isEnglish(),t)}listFormatter(t={}){return QT(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}};D();D();var qc=null,ft=class extends Ht{static get utcInstance(){return qc===null&&(qc=new ft(0)),qc}static instance(t){return t===0?ft.utcInstance:new ft(t)}static parseSpecifier(t){if(t){let e=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(e)return new ft(Kr(e[1],e[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${lr(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${lr(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,e){return lr(this.fixed,e)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}};D();var $i=class extends Ht{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function gn(s,t){let e;if(De(s)||s===null)return t;if(s instanceof Ht)return s;if(rg(s)){let r=s.toLowerCase();return r==="default"?t:r==="local"||r==="system"?On.instance:r==="utc"||r==="gmt"?ft.utcInstance:ft.parseSpecifier(r)||Ct.create(s)}else return Tn(s)?ft.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new $i(s)}var ig=()=>Date.now(),og="system",sg=null,ag=null,lg=null,ug=60,cg,Qe=class{static get now(){return ig}static set now(t){ig=t}static set defaultZone(t){og=t}static get defaultZone(){return gn(og,On.instance)}static get defaultLocale(){return sg}static set defaultLocale(t){sg=t}static get defaultNumberingSystem(){return ag}static set defaultNumberingSystem(t){ag=t}static get defaultOutputCalendar(){return lg}static set defaultOutputCalendar(t){lg=t}static get twoDigitCutoffYear(){return ug}static set twoDigitCutoffYear(t){ug=t%100}static get throwOnInvalid(){return cg}static set throwOnInvalid(t){cg=t}static resetCaches(){Je.resetCache(),Ct.resetCache()}};function De(s){return typeof s=="undefined"}function Tn(s){return typeof s=="number"}function ls(s){return typeof s=="number"&&s%1===0}function rg(s){return typeof s=="string"}function fg(s){return Object.prototype.toString.call(s)==="[object Date]"}function tl(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function dg(s){return Array.isArray(s)?s:[s]}function Zc(s,t,e){if(s.length!==0)return s.reduce((r,i)=>{let a=[t(i),i];return r&&e(r[0],a[0])===r[0]?r:a},null)[1]}function hg(s,t){return t.reduce((e,r)=>(e[r]=s[r],e),{})}function ur(s,t){return Object.prototype.hasOwnProperty.call(s,t)}function wn(s,t,e){return ls(s)&&s>=t&&s<=e}function aw(s,t){return s-t*Math.floor(s/t)}function ct(s,t=2){let e=s<0,r;return e?r="-"+(""+-s).padStart(t,"0"):r=(""+s).padStart(t,"0"),r}function Wn(s){if(!(De(s)||s===null||s===""))return parseInt(s,10)}function cr(s){if(!(De(s)||s===null||s===""))return parseFloat(s)}function us(s){if(!(De(s)||s===null||s==="")){let t=parseFloat("0."+s)*1e3;return Math.floor(t)}}function Bi(s,t,e=!1){let r=Yh(10,t);return(e?Math.trunc:Math.round)(s*r)/r}function qr(s){return s%4===0&&(s%100!==0||s%400===0)}function Zr(s){return qr(s)?366:365}function Hi(s,t){let e=aw(t-1,12)+1,r=s+(t-e)/12;return e===2?qr(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][e-1]}function ki(s){let t=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(t=new Date(t),t.setUTCFullYear(s.year,s.month-1,s.day)),+t}function Gi(s){let t=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,e=s-1,r=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7;return t===4||r===3?53:52}function cs(s){return s>99?s:s>Qe.twoDigitCutoffYear?1900+s:2e3+s}function Ya(s,t,e,r=null){let i=new Date(s),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(a.timeZone=r);let l=ce({timeZoneName:t},a),u=new Intl.DateTimeFormat(e,l).formatToParts(i).find(f=>f.type.toLowerCase()==="timezonename");return u?u.value:null}function Kr(s,t){let e=parseInt(s,10);Number.isNaN(e)&&(e=0);let r=parseInt(t,10)||0,i=e<0||Object.is(e,-0)?-r:r;return e*60+i}function Yc(s){let t=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(t))throw new It(`Invalid unit value ${s}`);return t}function Wi(s,t){let e={};for(let r in s)if(ur(s,r)){let i=s[r];if(i==null)continue;e[t(r)]=Yc(i)}return e}function lr(s,t){let e=Math.trunc(Math.abs(s/60)),r=Math.trunc(Math.abs(s%60)),i=s>=0?"+":"-";switch(t){case"short":return`${i}${ct(e,2)}:${ct(r,2)}`;case"narrow":return`${i}${e}${r>0?`:${r}`:""}`;case"techie":return`${i}${ct(e,2)}${ct(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function fs(s){return hg(s,["hour","minute","second","millisecond"])}var lw=["January","February","March","April","May","June","July","August","September","October","November","December"],Qc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],uw=["J","F","M","A","M","J","J","A","S","O","N","D"];function zc(s){switch(s){case"narrow":return[...uw];case"short":return[...Qc];case"long":return[...lw];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var Xc=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ef=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],cw=["M","T","W","T","F","S","S"];function Vc(s){switch(s){case"narrow":return[...cw];case"short":return[...ef];case"long":return[...Xc];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var jc=["AM","PM"],fw=["Before Christ","Anno Domini"],dw=["BC","AD"],hw=["B","A"];function Jc(s){switch(s){case"narrow":return[...hw];case"short":return[...dw];case"long":return[...fw];default:return null}}function pg(s){return jc[s.hour<12?0:1]}function mg(s,t){return Vc(t)[s.weekday-1]}function gg(s,t){return zc(t)[s.month-1]}function vg(s,t){return Jc(t)[s.year<0?0:1]}function ng(s,t,e="always",r=!1){let i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(s)===-1;if(e==="auto"&&a){let C=s==="days";switch(t){case 1:return C?"tomorrow":`next ${i[s][0]}`;case-1:return C?"yesterday":`last ${i[s][0]}`;case 0:return C?"today":`this ${i[s][0]}`;default:}}let l=Object.is(t,-0)||t<0,u=Math.abs(t),f=u===1,m=i[s],b=r?f?m[1]:m[2]||m[1]:f?i[s][0]:s;return l?`${u} ${b} ago`:`in ${u} ${b}`}function yg(s,t){let e="";for(let r of s)r.literal?e+=r.val:e+=t(r.val);return e}var pw={D:ar,DD:Go,DDD:Wo,DDDD:zo,t:Vo,tt:jo,ttt:Jo,tttt:Ko,T:qo,TT:Zo,TTT:Yo,TTTT:Qo,f:Xo,ff:ts,fff:rs,ffff:os,F:es,FF:ns,FFF:is,FFFF:ss},dt=class{static create(t,e={}){return new dt(t,e)}static parseFormat(t){let e=null,r="",i=!1,a=[];for(let l=0;l<t.length;l++){let u=t.charAt(l);u==="'"?(r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),e=null,r="",i=!i):i||u===e?r+=u:(r.length>0&&a.push({literal:/^\s+$/.test(r),val:r}),r=u,e=u)}return r.length>0&&a.push({literal:i||/^\s+$/.test(r),val:r}),a}static macroTokenToFormatOpts(t){return pw[t]}constructor(t,e){this.opts=e,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,e){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,ce(ce({},this.opts),e)).format()}dtFormatter(t,e={}){return this.loc.dtFormatter(t,ce(ce({},this.opts),e))}formatDateTime(t,e){return this.dtFormatter(t,e).format()}formatDateTimeParts(t,e){return this.dtFormatter(t,e).formatToParts()}formatInterval(t,e){return this.dtFormatter(t.start,e).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,e){return this.dtFormatter(t,e).resolvedOptions()}num(t,e=0){if(this.opts.forceSimple)return ct(t,e);let r=ce({},this.opts);return e>0&&(r.padTo=e),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,e){let r=this.loc.listingMode()==="en",i=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(E,w)=>this.loc.extract(t,E,w),l=E=>t.isOffsetFixed&&t.offset===0&&E.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,E.format):"",u=()=>r?pg(t):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(E,w)=>r?gg(t,E):a(w?{month:E}:{month:E,day:"numeric"},"month"),m=(E,w)=>r?mg(t,E):a(w?{weekday:E}:{weekday:E,month:"long",day:"numeric"},"weekday"),b=E=>{let w=dt.macroTokenToFormatOpts(E);return w?this.formatWithSystemDefault(t,w):E},C=E=>r?vg(t,E):a({era:E},"era"),h=E=>{switch(E){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return u();case"d":return i?a({day:"numeric"},"day"):this.num(t.day);case"dd":return i?a({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return i?a({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return i?a({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return i?a({month:"numeric"},"month"):this.num(t.month);case"MM":return i?a({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return i?a({year:"numeric"},"year"):this.num(t.year);case"yy":return i?a({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return i?a({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return i?a({year:"numeric"},"year"):this.num(t.year,6);case"G":return C("short");case"GG":return C("long");case"GGGGG":return C("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return b(E)}};return yg(dt.parseFormat(e),h)}formatDurationFromString(t,e){let r=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},i=f=>m=>{let b=r(m);return b?this.num(f.get(b),m.length):m},a=dt.parseFormat(e),l=a.reduce((f,{literal:m,val:b})=>m?f:f.concat(b),[]),u=t.shiftTo(...l.map(r).filter(f=>f));return yg(a,i(u))}};D();var Rt=class{constructor(t,e){this.reason=t,this.explanation=e}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};D();var Eg=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Vi(...s){let t=s.reduce((e,r)=>e+r.source,"");return RegExp(`^${t}$`)}function ji(...s){return t=>s.reduce(([e,r,i],a)=>{let[l,u,f]=a(t,i);return[ce(ce({},e),l),u||r,f]},[{},null,1]).slice(0,2)}function Ji(s,...t){if(s==null)return[null,null];for(let[e,r]of t){let i=e.exec(s);if(i)return r(i)}return[null,null]}function Ag(...s){return(t,e)=>{let r={},i;for(i=0;i<s.length;i++)r[s[i]]=Wn(t[e+i]);return[r,null,e+i]}}var Cg=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,mw=`(?:${Cg.source}?(?:\\[(${Eg.source})\\])?)?`,tf=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Sg=RegExp(`${tf.source}${mw}`),nf=RegExp(`(?:T${Sg.source})?`),gw=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,vw=/(\d{4})-?W(\d\d)(?:-?(\d))?/,yw=/(\d{4})-?(\d{3})/,bw=Ag("weekYear","weekNumber","weekDay"),Ew=Ag("year","ordinal"),Aw=/(\d{4})-(\d\d)-(\d\d)/,Og=RegExp(`${tf.source} ?(?:${Cg.source}|(${Eg.source}))?`),Cw=RegExp(`(?: ${Og.source})?`);function zi(s,t,e){let r=s[t];return De(r)?e:Wn(r)}function Sw(s,t){return[{year:zi(s,t),month:zi(s,t+1,1),day:zi(s,t+2,1)},null,t+3]}function Ki(s,t){return[{hours:zi(s,t,0),minutes:zi(s,t+1,0),seconds:zi(s,t+2,0),milliseconds:us(s[t+3])},null,t+4]}function ds(s,t){let e=!s[t]&&!s[t+1],r=Kr(s[t+1],s[t+2]),i=e?null:ft.instance(r);return[{},i,t+3]}function hs(s,t){let e=s[t]?Ct.create(s[t]):null;return[{},e,t+1]}var Ow=RegExp(`^T?${tf.source}$`),Tw=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function ww(s){let[t,e,r,i,a,l,u,f,m]=s,b=t[0]==="-",C=f&&f[0]==="-",h=(E,w=!1)=>E!==void 0&&(w||E&&b)?-E:E;return[{years:h(cr(e)),months:h(cr(r)),weeks:h(cr(i)),days:h(cr(a)),hours:h(cr(l)),minutes:h(cr(u)),seconds:h(cr(f),f==="-0"),milliseconds:h(us(m),C)}]}var xw={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function rf(s,t,e,r,i,a,l){let u={year:t.length===2?cs(Wn(t)):Wn(t),month:Qc.indexOf(e)+1,day:Wn(r),hour:Wn(i),minute:Wn(a)};return l&&(u.second=Wn(l)),s&&(u.weekday=s.length>3?Xc.indexOf(s)+1:ef.indexOf(s)+1),u}var Iw=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Rw(s){let[,t,e,r,i,a,l,u,f,m,b,C]=s,h=rf(t,i,r,e,a,l,u),E;return f?E=xw[f]:m?E=0:E=Kr(b,C),[h,new ft(E)]}function _w(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var Mw=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Pw=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Lw=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function bg(s){let[,t,e,r,i,a,l,u]=s;return[rf(t,i,r,e,a,l,u),ft.utcInstance]}function Dw(s){let[,t,e,r,i,a,l,u]=s;return[rf(t,u,e,r,i,a,l),ft.utcInstance]}var Nw=Vi(gw,nf),Fw=Vi(vw,nf),Uw=Vi(yw,nf),kw=Vi(Sg),Tg=ji(Sw,Ki,ds,hs),Bw=ji(bw,Ki,ds,hs),$w=ji(Ew,Ki,ds,hs),Hw=ji(Ki,ds,hs);function wg(s){return Ji(s,[Nw,Tg],[Fw,Bw],[Uw,$w],[kw,Hw])}function xg(s){return Ji(_w(s),[Iw,Rw])}function Ig(s){return Ji(s,[Mw,bg],[Pw,bg],[Lw,Dw])}function Rg(s){return Ji(s,[Tw,ww])}var Gw=ji(Ki);function _g(s){return Ji(s,[Ow,Gw])}var Ww=Vi(Aw,Cw),zw=Vi(Og),Vw=ji(Ki,ds,hs);function Mg(s){return Ji(s,[Ww,Tg],[zw,Vw])}var Pg="Invalid Duration",Dg={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},jw=ce({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Dg),sn=146097/400,qi=146097/4800,Jw=ce({years:{quarters:4,months:12,weeks:sn/7,days:sn,hours:sn*24,minutes:sn*24*60,seconds:sn*24*60*60,milliseconds:sn*24*60*60*1e3},quarters:{months:3,weeks:sn/28,days:sn/4,hours:sn*24/4,minutes:sn*24*60/4,seconds:sn*24*60*60/4,milliseconds:sn*24*60*60*1e3/4},months:{weeks:qi/7,days:qi,hours:qi*24,minutes:qi*24*60,seconds:qi*24*60*60,milliseconds:qi*24*60*60*1e3}},Dg),Yr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Kw=Yr.slice(0).reverse();function fr(s,t,e=!1){let r={values:e?t.values:ce(ce({},s.values),t.values||{}),loc:s.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||s.conversionAccuracy,matrix:t.matrix||s.matrix};return new Be(r)}function Ng(s,t){var r;let e=(r=t.milliseconds)!=null?r:0;for(let i of Kw.slice(1))t[i]&&(e+=t[i]*s[i].milliseconds);return e}function Lg(s,t){let e=Ng(s,t)<0?-1:1;Yr.reduceRight((r,i)=>{if(De(t[i]))return r;if(r){let a=t[r]*e,l=s[i][r],u=Math.floor(a/l);t[i]+=u*e,t[r]-=u*l*e}return i},null),Yr.reduce((r,i)=>{if(De(t[i]))return r;if(r){let a=t[r]%1;t[r]-=a,t[i]+=a*s[r][i]}return i},null)}function qw(s){let t={};for(let[e,r]of Object.entries(s))r!==0&&(t[e]=r);return t}var Be=class{constructor(t){let e=t.conversionAccuracy==="longterm"||!1,r=e?Jw:jw;t.matrix&&(r=t.matrix),this.values=t.values,this.loc=t.loc||Je.create(),this.conversionAccuracy=e?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(t,e){return Be.fromObject({milliseconds:t},e)}static fromObject(t,e={}){if(t==null||typeof t!="object")throw new It(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Be({values:Wi(t,Be.normalizeUnit),loc:Je.fromObject(e),conversionAccuracy:e.conversionAccuracy,matrix:e.matrix})}static fromDurationLike(t){if(Tn(t))return Be.fromMillis(t);if(Be.isDuration(t))return t;if(typeof t=="object")return Be.fromObject(t);throw new It(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,e){let[r]=Rg(t);return r?Be.fromObject(r,e):Be.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,e){let[r]=_g(t);return r?Be.fromObject(r,e):Be.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,e=null){if(!t)throw new It("need to specify a reason the Duration is invalid");let r=t instanceof Rt?t:new Rt(t,e);if(Qe.throwOnInvalid)throw new qa(r);return new Be({invalid:r})}static normalizeUnit(t){let e={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!e)throw new Ui(t);return e}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,e={}){let r=He(ce({},e),{floor:e.round!==!1&&e.floor!==!1});return this.isValid?dt.create(this.loc,r).formatDurationFromString(this,t):Pg}toHuman(t={}){if(!this.isValid)return Pg;let e=Yr.map(r=>{let i=this.values[r];return De(i)?null:this.loc.numberFormatter(He(ce({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(i)}).filter(r=>r);return this.loc.listFormatter(ce({type:"conjunction",style:t.listStyle||"narrow"},t)).format(e)}toObject(){return this.isValid?ce({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=Bi(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;let e=this.toMillis();return e<0||e>=864e5?null:(t=He(ce({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t),{includeOffset:!1}),Ce.fromMillis(e,{zone:"UTC"}).toISOTime(t))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Ng(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;let e=Be.fromDurationLike(t),r={};for(let i of Yr)(ur(e.values,i)||ur(this.values,i))&&(r[i]=e.get(i)+this.get(i));return fr(this,{values:r},!0)}minus(t){if(!this.isValid)return this;let e=Be.fromDurationLike(t);return this.plus(e.negate())}mapUnits(t){if(!this.isValid)return this;let e={};for(let r of Object.keys(this.values))e[r]=Yc(t(this.values[r],r));return fr(this,{values:e},!0)}get(t){return this[Be.normalizeUnit(t)]}set(t){if(!this.isValid)return this;let e=ce(ce({},this.values),Wi(t,Be.normalizeUnit));return fr(this,{values:e})}reconfigure({locale:t,numberingSystem:e,conversionAccuracy:r,matrix:i}={}){let l={loc:this.loc.clone({locale:t,numberingSystem:e}),matrix:i,conversionAccuracy:r};return fr(this,l)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;let t=this.toObject();return Lg(this.matrix,t),fr(this,{values:t},!0)}rescale(){if(!this.isValid)return this;let t=qw(this.normalize().shiftToAll().toObject());return fr(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(l=>Be.normalizeUnit(l));let e={},r={},i=this.toObject(),a;for(let l of Yr)if(t.indexOf(l)>=0){a=l;let u=0;for(let m in r)u+=this.matrix[m][l]*r[m],r[m]=0;Tn(i[l])&&(u+=i[l]);let f=Math.trunc(u);e[l]=f,r[l]=(u*1e3-f*1e3)/1e3}else Tn(i[l])&&(r[l]=i[l]);for(let l in r)r[l]!==0&&(e[a]+=l===a?r[l]:r[l]/this.matrix[a][l]);return Lg(this.matrix,e),fr(this,{values:e},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let t={};for(let e of Object.keys(this.values))t[e]=this.values[e]===0?0:-this.values[e];return fr(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function e(r,i){return r===void 0||r===0?i===void 0||i===0:r===i}for(let r of Yr)if(!e(this.values[r],t.values[r]))return!1;return!0}};D();var Zi="Invalid Interval";function Zw(s,t){return!s||!s.isValid?nt.invalid("missing or invalid start"):!t||!t.isValid?nt.invalid("missing or invalid end"):t<s?nt.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${t.toISO()}`):null}var nt=class{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,e=null){if(!t)throw new It("need to specify a reason the Interval is invalid");let r=t instanceof Rt?t:new Rt(t,e);if(Qe.throwOnInvalid)throw new Ka(r);return new nt({invalid:r})}static fromDateTimes(t,e){let r=Yi(t),i=Yi(e),a=Zw(r,i);return a==null?new nt({start:r,end:i}):a}static after(t,e){let r=Be.fromDurationLike(e),i=Yi(t);return nt.fromDateTimes(i,i.plus(r))}static before(t,e){let r=Be.fromDurationLike(e),i=Yi(t);return nt.fromDateTimes(i.minus(r),i)}static fromISO(t,e){let[r,i]=(t||"").split("/",2);if(r&&i){let a,l;try{a=Ce.fromISO(r,e),l=a.isValid}catch(m){l=!1}let u,f;try{u=Ce.fromISO(i,e),f=u.isValid}catch(m){f=!1}if(l&&f)return nt.fromDateTimes(a,u);if(l){let m=Be.fromISO(i,e);if(m.isValid)return nt.after(a,m)}else if(f){let m=Be.fromISO(r,e);if(m.isValid)return nt.before(u,m)}}return nt.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;let e=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(e,t).get(t))+(r.valueOf()!==this.end.valueOf())}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:e}={}){return this.isValid?nt.fromDateTimes(t||this.s,e||this.e):this}splitAt(...t){if(!this.isValid)return[];let e=t.map(Yi).filter(l=>this.contains(l)).sort(),r=[],{s:i}=this,a=0;for(;i<this.e;){let l=e[a]||this.e,u=+l>+this.e?this.e:l;r.push(nt.fromDateTimes(i,u)),i=u,a+=1}return r}splitBy(t){let e=Be.fromDurationLike(t);if(!this.isValid||!e.isValid||e.as("milliseconds")===0)return[];let{s:r}=this,i=1,a,l=[];for(;r<this.e;){let u=this.start.plus(e.mapUnits(f=>f*i));a=+u>+this.e?this.e:u,l.push(nt.fromDateTimes(r,a)),r=a,i+=1}return l}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;let e=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return e>=r?null:nt.fromDateTimes(e,r)}union(t){if(!this.isValid)return this;let e=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return nt.fromDateTimes(e,r)}static merge(t){let[e,r]=t.sort((i,a)=>i.s-a.s).reduce(([i,a],l)=>a?a.overlaps(l)||a.abutsStart(l)?[i,a.union(l)]:[i.concat([a]),l]:[i,l],[[],null]);return r&&e.push(r),e}static xor(t){let e=null,r=0,i=[],a=t.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),l=Array.prototype.concat(...a),u=l.sort((f,m)=>f.time-m.time);for(let f of u)r+=f.type==="s"?1:-1,r===1?e=f.time:(e&&+e!=+f.time&&i.push(nt.fromDateTimes(e,f.time)),e=null);return nt.merge(i)}difference(...t){return nt.xor([this].concat(t)).map(e=>this.intersection(e)).filter(e=>e&&!e.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Zi}toLocaleString(t=ar,e={}){return this.isValid?dt.create(this.s.loc.clone(e),t).formatInterval(this):Zi}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:Zi}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Zi}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:Zi}toFormat(t,{separator:e=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${e}${this.e.toFormat(t)}`:Zi}toDuration(t,e){return this.isValid?this.e.diff(this.s,t,e):Be.invalid(this.invalidReason)}mapEndpoints(t){return nt.fromDateTimes(t(this.s),t(this.e))}};D();var zn=class{static hasDST(t=Qe.defaultZone){let e=Ce.now().setZone(t).set({month:12});return!t.isUniversal&&e.offset!==e.set({month:6}).offset}static isValidIANAZone(t){return Ct.isValidZone(t)}static normalizeZone(t){return gn(t,Qe.defaultZone)}static months(t="long",{locale:e=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Je.create(e,r,a)).months(t)}static monthsFormat(t="long",{locale:e=null,numberingSystem:r=null,locObj:i=null,outputCalendar:a="gregory"}={}){return(i||Je.create(e,r,a)).months(t,!0)}static weekdays(t="long",{locale:e=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Je.create(e,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:e=null,numberingSystem:r=null,locObj:i=null}={}){return(i||Je.create(e,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Je.create(t).meridiems()}static eras(t="short",{locale:e=null}={}){return Je.create(e,null,"gregory").eras(t)}static features(){return{relative:tl()}}};D();function Fg(s,t){let e=i=>i.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=e(t)-e(s);return Math.floor(Be.fromMillis(r).as("days"))}function Yw(s,t,e){let r=[["years",(f,m)=>m.year-f.year],["quarters",(f,m)=>m.quarter-f.quarter+(m.year-f.year)*4],["months",(f,m)=>m.month-f.month+(m.year-f.year)*12],["weeks",(f,m)=>{let b=Fg(f,m);return(b-b%7)/7}],["days",Fg]],i={},a=s,l,u;for(let[f,m]of r)e.indexOf(f)>=0&&(l=f,i[f]=m(s,t),u=a.plus(i),u>t?(i[f]--,s=a.plus(i),s>t&&(u=s,i[f]--,s=a.plus(i))):s=u);return[s,i,u,l]}function Ug(s,t,e,r){let[i,a,l,u]=Yw(s,t,e),f=t-i,m=e.filter(C=>["hours","minutes","seconds","milliseconds"].indexOf(C)>=0);m.length===0&&(l<t&&(l=i.plus({[u]:1})),l!==i&&(a[u]=(a[u]||0)+f/(l-i)));let b=Be.fromObject(a,r);return m.length>0?Be.fromMillis(f,r).shiftTo(...m).plus(b):b}D();D();var of={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},kg={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Qw=of.hanidec.replace(/[\[|\]]/g,"").split("");function Bg(s){let t=parseInt(s,10);if(isNaN(t)){t="";for(let e=0;e<s.length;e++){let r=s.charCodeAt(e);if(s[e].search(of.hanidec)!==-1)t+=Qw.indexOf(s[e]);else for(let i in kg){let[a,l]=kg[i];r>=a&&r<=l&&(t+=r-a)}}return parseInt(t,10)}else return t}function an({numberingSystem:s},t=""){return new RegExp(`${of[s||"latn"]}${t}`)}var Xw="missing Intl.DateTimeFormat.formatToParts support";function qe(s,t=e=>e){return{regex:s,deser:([e])=>t(Bg(e))}}var e1=String.fromCharCode(160),Gg=`[ ${e1}]`,Wg=new RegExp(Gg,"g");function t1(s){return s.replace(/\./g,"\\.?").replace(Wg,Gg)}function $g(s){return s.replace(/\./g,"").replace(Wg," ").toLowerCase()}function vn(s,t){return s===null?null:{regex:RegExp(s.map(t1).join("|")),deser:([e])=>s.findIndex(r=>$g(e)===$g(r))+t}}function Hg(s,t){return{regex:s,deser:([,e,r])=>Kr(e,r),groups:t}}function nl(s){return{regex:s,deser:([t])=>t}}function n1(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r1(s,t){let e=an(t),r=an(t,"{2}"),i=an(t,"{3}"),a=an(t,"{4}"),l=an(t,"{6}"),u=an(t,"{1,2}"),f=an(t,"{1,3}"),m=an(t,"{1,6}"),b=an(t,"{1,9}"),C=an(t,"{2,4}"),h=an(t,"{4,6}"),E=S=>({regex:RegExp(n1(S.val)),deser:([O])=>O,literal:!0}),x=(S=>{if(s.literal)return E(S);switch(S.val){case"G":return vn(t.eras("short"),0);case"GG":return vn(t.eras("long"),0);case"y":return qe(m);case"yy":return qe(C,cs);case"yyyy":return qe(a);case"yyyyy":return qe(h);case"yyyyyy":return qe(l);case"M":return qe(u);case"MM":return qe(r);case"MMM":return vn(t.months("short",!0),1);case"MMMM":return vn(t.months("long",!0),1);case"L":return qe(u);case"LL":return qe(r);case"LLL":return vn(t.months("short",!1),1);case"LLLL":return vn(t.months("long",!1),1);case"d":return qe(u);case"dd":return qe(r);case"o":return qe(f);case"ooo":return qe(i);case"HH":return qe(r);case"H":return qe(u);case"hh":return qe(r);case"h":return qe(u);case"mm":return qe(r);case"m":return qe(u);case"q":return qe(u);case"qq":return qe(r);case"s":return qe(u);case"ss":return qe(r);case"S":return qe(f);case"SSS":return qe(i);case"u":return nl(b);case"uu":return nl(u);case"uuu":return qe(e);case"a":return vn(t.meridiems(),0);case"kkkk":return qe(a);case"kk":return qe(C,cs);case"W":return qe(u);case"WW":return qe(r);case"E":case"c":return qe(e);case"EEE":return vn(t.weekdays("short",!1),1);case"EEEE":return vn(t.weekdays("long",!1),1);case"ccc":return vn(t.weekdays("short",!0),1);case"cccc":return vn(t.weekdays("long",!0),1);case"Z":case"ZZ":return Hg(new RegExp(`([+-]${u.source})(?::(${r.source}))?`),2);case"ZZZ":return Hg(new RegExp(`([+-]${u.source})(${r.source})?`),2);case"z":return nl(/[a-z_+-/]{1,256}?/i);case" ":return nl(/[^\S\n\r]/);default:return E(S)}})(s)||{invalidReason:Xw};return x.token=s,x}var i1={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function o1(s,t,e){let{type:r,value:i}=s;if(r==="literal"){let f=/^\s+$/.test(i);return{literal:!f,val:f?" ":i}}let a=t[r],l=r;r==="hour"&&(t.hour12!=null?l=t.hour12?"hour12":"hour24":t.hourCycle!=null?t.hourCycle==="h11"||t.hourCycle==="h12"?l="hour12":l="hour24":l=e.hour12?"hour12":"hour24");let u=i1[l];if(typeof u=="object"&&(u=u[a]),u)return{literal:!1,val:u}}function s1(s){return[`^${s.map(e=>e.regex).reduce((e,r)=>`${e}(${r.source})`,"")}$`,s]}function a1(s,t,e){let r=s.match(t);if(r){let i={},a=1;for(let l in e)if(ur(e,l)){let u=e[l],f=u.groups?u.groups+1:1;!u.literal&&u.token&&(i[u.token.val[0]]=u.deser(r.slice(a,a+f))),a+=f}return[r,i]}else return[r,{}]}function l1(s){let t=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},e=null,r;return De(s.z)||(e=Ct.create(s.z)),De(s.Z)||(e||(e=new ft(s.Z)),r=s.Z),De(s.q)||(s.M=(s.q-1)*3+1),De(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),De(s.u)||(s.S=us(s.u)),[Object.keys(s).reduce((a,l)=>{let u=t(l);return u&&(a[u]=s[l]),a},{}),e,r]}var sf=null;function u1(){return sf||(sf=Ce.fromMillis(1555555555555)),sf}function c1(s,t){if(s.literal)return s;let e=dt.macroTokenToFormatOpts(s.val),r=uf(e,t);return r==null||r.includes(void 0)?s:r}function af(s,t){return Array.prototype.concat(...s.map(e=>c1(e,t)))}function lf(s,t,e){let r=af(dt.parseFormat(e),s),i=r.map(l=>r1(l,s)),a=i.find(l=>l.invalidReason);if(a)return{input:t,tokens:r,invalidReason:a.invalidReason};{let[l,u]=s1(i),f=RegExp(l,"i"),[m,b]=a1(t,f,u),[C,h,E]=b?l1(b):[null,null,void 0];if(ur(b,"a")&&ur(b,"H"))throw new Gn("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:f,rawMatches:m,matches:b,result:C,zone:h,specificOffset:E}}}function zg(s,t,e){let{result:r,zone:i,specificOffset:a,invalidReason:l}=lf(s,t,e);return[r,i,a,l]}function uf(s,t){if(!s)return null;let r=dt.create(t,s).dtFormatter(u1()),i=r.formatToParts(),a=r.resolvedOptions();return i.map(l=>o1(l,s,a))}D();var Vg=[0,31,59,90,120,151,181,212,243,273,304,334],jg=[0,31,60,91,121,152,182,213,244,274,305,335];function ln(s,t){return new Rt("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${s}, which is invalid`)}function Jg(s,t,e){let r=new Date(Date.UTC(s,t-1,e));s<100&&s>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);let i=r.getUTCDay();return i===0?7:i}function Kg(s,t,e){return e+(qr(s)?jg:Vg)[t-1]}function qg(s,t){let e=qr(s)?jg:Vg,r=e.findIndex(a=>a<t),i=t-e[r];return{month:r+1,day:i}}function rl(s){let{year:t,month:e,day:r}=s,i=Kg(t,e,r),a=Jg(t,e,r),l=Math.floor((i-a+10)/7),u;return l<1?(u=t-1,l=Gi(u)):l>Gi(t)?(u=t+1,l=1):u=t,ce({weekYear:u,weekNumber:l,weekday:a},fs(s))}function cf(s){let{weekYear:t,weekNumber:e,weekday:r}=s,i=Jg(t,1,4),a=Zr(t),l=e*7+r-i-3,u;l<1?(u=t-1,l+=Zr(u)):l>a?(u=t+1,l-=Zr(t)):u=t;let{month:f,day:m}=qg(u,l);return ce({year:u,month:f,day:m},fs(s))}function il(s){let{year:t,month:e,day:r}=s,i=Kg(t,e,r);return ce({year:t,ordinal:i},fs(s))}function ff(s){let{year:t,ordinal:e}=s,{month:r,day:i}=qg(t,e);return ce({year:t,month:r,day:i},fs(s))}function Zg(s){let t=ls(s.weekYear),e=wn(s.weekNumber,1,Gi(s.weekYear)),r=wn(s.weekday,1,7);return t?e?r?!1:ln("weekday",s.weekday):ln("week",s.week):ln("weekYear",s.weekYear)}function Yg(s){let t=ls(s.year),e=wn(s.ordinal,1,Zr(s.year));return t?e?!1:ln("ordinal",s.ordinal):ln("year",s.year)}function df(s){let t=ls(s.year),e=wn(s.month,1,12),r=wn(s.day,1,Hi(s.year,s.month));return t?e?r?!1:ln("day",s.day):ln("month",s.month):ln("year",s.year)}function hf(s){let{hour:t,minute:e,second:r,millisecond:i}=s,a=wn(t,0,23)||t===24&&e===0&&r===0&&i===0,l=wn(e,0,59),u=wn(r,0,59),f=wn(i,0,999);return a?l?u?f?!1:ln("millisecond",i):ln("second",r):ln("minute",e):ln("hour",t)}var pf="Invalid DateTime",Qg=864e13;function ol(s){return new Rt("unsupported zone",`the zone "${s.name}" is not supported`)}function mf(s){return s.weekData===null&&(s.weekData=rl(s.c)),s.weekData}function Qr(s,t){let e={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Ce(He(ce(ce({},e),t),{old:e}))}function ov(s,t,e){let r=s-t*60*1e3,i=e.offset(r);if(t===i)return[r,t];r-=(i-t)*60*1e3;let a=e.offset(r);return i===a?[r,i]:[s-Math.min(i,a)*60*1e3,Math.max(i,a)]}function sl(s,t){s+=t*60*1e3;let e=new Date(s);return{year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate(),hour:e.getUTCHours(),minute:e.getUTCMinutes(),second:e.getUTCSeconds(),millisecond:e.getUTCMilliseconds()}}function ll(s,t,e){return ov(ki(s),t,e)}function Xg(s,t){let e=s.o,r=s.c.year+Math.trunc(t.years),i=s.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,a=He(ce({},s.c),{year:r,month:i,day:Math.min(s.c.day,Hi(r,i))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),l=Be.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),u=ki(a),[f,m]=ov(u,e,s.zone);return l!==0&&(f+=l,m=s.zone.offset(f)),{ts:f,o:m}}function ps(s,t,e,r,i,a){let{setZone:l,zone:u}=e;if(s&&Object.keys(s).length!==0||t){let f=t||u,m=Ce.fromObject(s,He(ce({},e),{zone:f,specificOffset:a}));return l?m:m.setZone(u)}else return Ce.invalid(new Rt("unparsable",`the input "${i}" can't be parsed as ${r}`))}function al(s,t,e=!0){return s.isValid?dt.create(Je.create("en-US"),{allowZ:e,forceSimple:!0}).formatDateTimeFromString(s,t):null}function gf(s,t){let e=s.c.year>9999||s.c.year<0,r="";return e&&s.c.year>=0&&(r+="+"),r+=ct(s.c.year,e?6:4),t?(r+="-",r+=ct(s.c.month),r+="-",r+=ct(s.c.day)):(r+=ct(s.c.month),r+=ct(s.c.day)),r}function ev(s,t,e,r,i,a){let l=ct(s.c.hour);return t?(l+=":",l+=ct(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!e)&&(l+=":")):l+=ct(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!e)&&(l+=ct(s.c.second),(s.c.millisecond!==0||!r)&&(l+=".",l+=ct(s.c.millisecond,3))),i&&(s.isOffsetFixed&&s.offset===0&&!a?l+="Z":s.o<0?(l+="-",l+=ct(Math.trunc(-s.o/60)),l+=":",l+=ct(Math.trunc(-s.o%60))):(l+="+",l+=ct(Math.trunc(s.o/60)),l+=":",l+=ct(Math.trunc(s.o%60)))),a&&(l+="["+s.zone.ianaName+"]"),l}var sv={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},f1={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},d1={ordinal:1,hour:0,minute:0,second:0,millisecond:0},av=["year","month","day","hour","minute","second","millisecond"],h1=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],p1=["year","ordinal","hour","minute","second","millisecond"];function tv(s){let t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!t)throw new Ui(s);return t}function nv(s,t){let e=gn(t.zone,Qe.defaultZone),r=Je.fromObject(t),i=Qe.now(),a,l;if(De(s.year))a=i;else{for(let m of av)De(s[m])&&(s[m]=sv[m]);let u=df(s)||hf(s);if(u)return Ce.invalid(u);let f=e.offset(i);[a,l]=ll(s,f,e)}return new Ce({ts:a,zone:e,loc:r,o:l})}function rv(s,t,e){let r=De(e.round)?!0:e.round,i=(l,u)=>(l=Bi(l,r||e.calendary?0:2,!0),t.loc.clone(e).relFormatter(e).format(l,u)),a=l=>e.calendary?t.hasSame(s,l)?0:t.startOf(l).diff(s.startOf(l),l).get(l):t.diff(s,l).get(l);if(e.unit)return i(a(e.unit),e.unit);for(let l of e.units){let u=a(l);if(Math.abs(u)>=1)return i(u,l)}return i(s>t?-0:0,e.units[e.units.length-1])}function iv(s){let t={},e;return s.length>0&&typeof s[s.length-1]=="object"?(t=s[s.length-1],e=Array.from(s).slice(0,s.length-1)):e=Array.from(s),[t,e]}var Ce=class{constructor(t){let e=t.zone||Qe.defaultZone,r=t.invalid||(Number.isNaN(t.ts)?new Rt("invalid input"):null)||(e.isValid?null:ol(e));this.ts=De(t.ts)?Qe.now():t.ts;let i=null,a=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e))[i,a]=[t.old.c,t.old.o];else{let u=e.offset(this.ts);i=sl(this.ts,u),r=Number.isNaN(i.year)?new Rt("invalid input"):null,i=r?null:i,a=r?null:u}this._zone=e,this.loc=t.loc||Je.create(),this.invalid=r,this.weekData=null,this.c=i,this.o=a,this.isLuxonDateTime=!0}static now(){return new Ce({})}static local(){let[t,e]=iv(arguments),[r,i,a,l,u,f,m]=e;return nv({year:r,month:i,day:a,hour:l,minute:u,second:f,millisecond:m},t)}static utc(){let[t,e]=iv(arguments),[r,i,a,l,u,f,m]=e;return t.zone=ft.utcInstance,nv({year:r,month:i,day:a,hour:l,minute:u,second:f,millisecond:m},t)}static fromJSDate(t,e={}){let r=fg(t)?t.valueOf():NaN;if(Number.isNaN(r))return Ce.invalid("invalid input");let i=gn(e.zone,Qe.defaultZone);return i.isValid?new Ce({ts:r,zone:i,loc:Je.fromObject(e)}):Ce.invalid(ol(i))}static fromMillis(t,e={}){if(Tn(t))return t<-Qg||t>Qg?Ce.invalid("Timestamp out of range"):new Ce({ts:t,zone:gn(e.zone,Qe.defaultZone),loc:Je.fromObject(e)});throw new It(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,e={}){if(Tn(t))return new Ce({ts:t*1e3,zone:gn(e.zone,Qe.defaultZone),loc:Je.fromObject(e)});throw new It("fromSeconds requires a numerical input")}static fromObject(t,e={}){t=t||{};let r=gn(e.zone,Qe.defaultZone);if(!r.isValid)return Ce.invalid(ol(r));let i=Qe.now(),a=De(e.specificOffset)?r.offset(i):e.specificOffset,l=Wi(t,tv),u=!De(l.ordinal),f=!De(l.year),m=!De(l.month)||!De(l.day),b=f||m,C=l.weekYear||l.weekNumber,h=Je.fromObject(e);if((b||u)&&C)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&u)throw new Gn("Can't mix ordinal dates with month/day");let E=C||l.weekday&&!b,w,x,S=sl(i,a);E?(w=h1,x=f1,S=rl(S)):u?(w=p1,x=d1,S=il(S)):(w=av,x=sv);let O=!1;for(let v of w){let I=l[v];De(I)?O?l[v]=x[v]:l[v]=S[v]:O=!0}let R=E?Zg(l):u?Yg(l):df(l),g=R||hf(l);if(g)return Ce.invalid(g);let y=E?cf(l):u?ff(l):l,[d,p]=ll(y,a,r),T=new Ce({ts:d,zone:r,o:p,loc:h});return l.weekday&&b&&t.weekday!==T.weekday?Ce.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${T.toISO()}`):T}static fromISO(t,e={}){let[r,i]=wg(t);return ps(r,i,e,"ISO 8601",t)}static fromRFC2822(t,e={}){let[r,i]=xg(t);return ps(r,i,e,"RFC 2822",t)}static fromHTTP(t,e={}){let[r,i]=Ig(t);return ps(r,i,e,"HTTP",e)}static fromFormat(t,e,r={}){if(De(t)||De(e))throw new It("fromFormat requires an input string and a format");let{locale:i=null,numberingSystem:a=null}=r,l=Je.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0}),[u,f,m,b]=zg(l,t,e);return b?Ce.invalid(b):ps(u,f,r,`format ${e}`,t,m)}static fromString(t,e,r={}){return Ce.fromFormat(t,e,r)}static fromSQL(t,e={}){let[r,i]=Mg(t);return ps(r,i,e,"SQL",t)}static invalid(t,e=null){if(!t)throw new It("need to specify a reason the DateTime is invalid");let r=t instanceof Rt?t:new Rt(t,e);if(Qe.throwOnInvalid)throw new Ja(r);return new Ce({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,e={}){let r=uf(t,Je.fromObject(e));return r?r.map(i=>i?i.val:null).join(""):null}static expandFormat(t,e={}){return af(dt.parseFormat(t),Je.fromObject(e)).map(i=>i.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?mf(this).weekYear:NaN}get weekNumber(){return this.isValid?mf(this).weekNumber:NaN}get weekday(){return this.isValid?mf(this).weekday:NaN}get ordinal(){return this.isValid?il(this.c).ordinal:NaN}get monthShort(){return this.isValid?zn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let t=864e5,e=6e4,r=ki(this.c),i=this.zone.offset(r-t),a=this.zone.offset(r+t),l=this.zone.offset(r-i*e),u=this.zone.offset(r-a*e);if(l===u)return[this];let f=r-l*e,m=r-u*e,b=sl(f,l),C=sl(m,u);return b.hour===C.hour&&b.minute===C.minute&&b.second===C.second&&b.millisecond===C.millisecond?[Qr(this,{ts:f}),Qr(this,{ts:m})]:[this]}get isInLeapYear(){return qr(this.year)}get daysInMonth(){return Hi(this.year,this.month)}get daysInYear(){return this.isValid?Zr(this.year):NaN}get weeksInWeekYear(){return this.isValid?Gi(this.weekYear):NaN}resolvedLocaleOptions(t={}){let{locale:e,numberingSystem:r,calendar:i}=dt.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e,numberingSystem:r,outputCalendar:i}}toUTC(t=0,e={}){return this.setZone(ft.instance(t),e)}toLocal(){return this.setZone(Qe.defaultZone)}setZone(t,{keepLocalTime:e=!1,keepCalendarTime:r=!1}={}){if(t=gn(t,Qe.defaultZone),t.equals(this.zone))return this;if(t.isValid){let i=this.ts;if(e||r){let a=t.offset(this.ts),l=this.toObject();[i]=ll(l,a,t)}return Qr(this,{ts:i,zone:t})}else return Ce.invalid(ol(t))}reconfigure({locale:t,numberingSystem:e,outputCalendar:r}={}){let i=this.loc.clone({locale:t,numberingSystem:e,outputCalendar:r});return Qr(this,{loc:i})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;let e=Wi(t,tv),r=!De(e.weekYear)||!De(e.weekNumber)||!De(e.weekday),i=!De(e.ordinal),a=!De(e.year),l=!De(e.month)||!De(e.day),u=a||l,f=e.weekYear||e.weekNumber;if((u||i)&&f)throw new Gn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&i)throw new Gn("Can't mix ordinal dates with month/day");let m;r?m=cf(ce(ce({},rl(this.c)),e)):De(e.ordinal)?(m=ce(ce({},this.toObject()),e),De(e.day)&&(m.day=Math.min(Hi(m.year,m.month),m.day))):m=ff(ce(ce({},il(this.c)),e));let[b,C]=ll(m,this.o,this.zone);return Qr(this,{ts:b,o:C})}plus(t){if(!this.isValid)return this;let e=Be.fromDurationLike(t);return Qr(this,Xg(this,e))}minus(t){if(!this.isValid)return this;let e=Be.fromDurationLike(t).negate();return Qr(this,Xg(this,e))}startOf(t){if(!this.isValid)return this;let e={},r=Be.normalizeUnit(t);switch(r){case"years":e.month=1;case"quarters":case"months":e.day=1;case"weeks":case"days":e.hour=0;case"hours":e.minute=0;case"minutes":e.second=0;case"seconds":e.millisecond=0;break;case"milliseconds":break}if(r==="weeks"&&(e.weekday=1),r==="quarters"){let i=Math.ceil(this.month/3);e.month=(i-1)*3+1}return this.set(e)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,e={}){return this.isValid?dt.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):pf}toLocaleString(t=ar,e={}){return this.isValid?dt.create(this.loc.clone(e),t).formatDateTime(this):pf}toLocaleParts(t={}){return this.isValid?dt.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:e=!1,suppressMilliseconds:r=!1,includeOffset:i=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;let l=t==="extended",u=gf(this,l);return u+="T",u+=ev(this,l,e,r,i,a),u}toISODate({format:t="extended"}={}){return this.isValid?gf(this,t==="extended"):null}toISOWeekDate(){return al(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:e=!1,includeOffset:r=!0,includePrefix:i=!1,extendedZone:a=!1,format:l="extended"}={}){return this.isValid?(i?"T":"")+ev(this,l==="extended",e,t,r,a):null}toRFC2822(){return al(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return al(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?gf(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:e=!1,includeOffsetSpace:r=!0}={}){let i="HH:mm:ss.SSS";return(e||t)&&(r&&(i+=" "),e?i+="z":t&&(i+="ZZ")),al(this,i,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():pf}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};let e=ce({},this.c);return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,e="milliseconds",r={}){if(!this.isValid||!t.isValid)return Be.invalid("created by diffing an invalid DateTime");let i=ce({locale:this.locale,numberingSystem:this.numberingSystem},r),a=dg(e).map(Be.normalizeUnit),l=t.valueOf()>this.valueOf(),u=l?this:t,f=l?t:this,m=Ug(u,f,a,i);return l?m.negate():m}diffNow(t="milliseconds",e={}){return this.diff(Ce.now(),t,e)}until(t){return this.isValid?nt.fromDateTimes(this,t):this}hasSame(t,e){if(!this.isValid)return!1;let r=t.valueOf(),i=this.setZone(t.zone,{keepLocalTime:!0});return i.startOf(e)<=r&&r<=i.endOf(e)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;let e=t.base||Ce.fromObject({},{zone:this.zone}),r=t.padding?this<e?-t.padding:t.padding:0,i=["years","months","days","hours","minutes","seconds"],a=t.unit;return Array.isArray(t.unit)&&(i=t.unit,a=void 0),rv(e,this.plus(r),He(ce({},t),{numeric:"always",units:i,unit:a}))}toRelativeCalendar(t={}){return this.isValid?rv(t.base||Ce.fromObject({},{zone:this.zone}),this,He(ce({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(Ce.isDateTime))throw new It("min requires all arguments be DateTimes");return Zc(t,e=>e.valueOf(),Math.min)}static max(...t){if(!t.every(Ce.isDateTime))throw new It("max requires all arguments be DateTimes");return Zc(t,e=>e.valueOf(),Math.max)}static fromFormatExplain(t,e,r={}){let{locale:i=null,numberingSystem:a=null}=r,l=Je.fromOpts({locale:i,numberingSystem:a,defaultToEN:!0});return lf(l,t,e)}static fromStringExplain(t,e,r={}){return Ce.fromFormatExplain(t,e,r)}static get DATE_SHORT(){return ar}static get DATE_MED(){return Go}static get DATE_MED_WITH_WEEKDAY(){return Dc}static get DATE_FULL(){return Wo}static get DATE_HUGE(){return zo}static get TIME_SIMPLE(){return Vo}static get TIME_WITH_SECONDS(){return jo}static get TIME_WITH_SHORT_OFFSET(){return Jo}static get TIME_WITH_LONG_OFFSET(){return Ko}static get TIME_24_SIMPLE(){return qo}static get TIME_24_WITH_SECONDS(){return Zo}static get TIME_24_WITH_SHORT_OFFSET(){return Yo}static get TIME_24_WITH_LONG_OFFSET(){return Qo}static get DATETIME_SHORT(){return Xo}static get DATETIME_SHORT_WITH_SECONDS(){return es}static get DATETIME_MED(){return ts}static get DATETIME_MED_WITH_SECONDS(){return ns}static get DATETIME_MED_WITH_WEEKDAY(){return Nc}static get DATETIME_FULL(){return rs}static get DATETIME_FULL_WITH_SECONDS(){return is}static get DATETIME_HUGE(){return os}static get DATETIME_HUGE_WITH_SECONDS(){return ss}};function Yi(s){if(Ce.isDateTime(s))return s;if(s&&s.valueOf&&Tn(s.valueOf()))return Ce.fromJSDate(s);if(s&&typeof s=="object")return Ce.fromObject(s);throw new It(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var lv=We(Re),m1=[lv.styles,Sc],Xr=class extends lv{constructor(){super();this.updateComment=({detail:e})=>{let{text:r}=e;this.text=r,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,text:r})};this.resolveAnnotation=e=>{e.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly"};this.resolved=!1}render(){var E;let e=this.annotationFilter==="all"?"resolve":"undo",r=w=>Ce.fromISO(w).toFormat("yyyy-dd-MM"),i=this.resolvable?"comment-item__resolve":"hidden",a=[{label:"EDIT"},{label:"DELETE"}],l=({detail:w})=>{w==="EDIT"&&(this.mode="editable"),w==="DELETE"&&(this.deleteCommentModalOpen=!0)},u=()=>{this.text.length<120||(this.expandElipsis=!0)},f=()=>{if(this.mode==="editable")return ge`
        <superviz-comments-comment-input
          class="comment-item--editable"
          editable
          @click=${w=>w.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{if(this.mode!=="editable")return ge`
        <span
          id="comment-text"
          @click=${u}
          class="text text-big sv-gray-700 ${h}"
          >${this.text}</span
        >
      `},b=()=>{this.deleteCommentModalOpen=!1},C={"comment-item":!0,reply:!this.primaryComment},h=!this.expandElipsis&&this.text.length>120?"line-clamp":"";return ge`
      <div class=${it(C)}>
        <div class="comment-item__user">
          <div class="comment-item__user-details">
            <div class="comment-item__avatar">
              <p class="text text-bold">${((E=this.username[0])==null?void 0:E.toUpperCase())||"A"}</p>
            </div>
            <span class="text text-bold sv-gray-600">${this.username}</span>
            <span class="text text-small sv-gray-500">${r(this.createdAt)}</span>
          </div>
          <div class="comment-item__actions">
            <button
              @click=${this.resolveAnnotation}
              class="icon-button icon-button--clickable icon-button--xsmall ${i}"
            >
              <superviz-icon name=${e} size="md"></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(a)}
              label="label"
              returnTo="label"
              position="bottom-right"
              @selected=${l}
              @click=${w=>w.stopPropagation()}
            >
              <button slot="dropdown" class="icon-button icon-button--clickable icon-button--small">
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comment-item__content">
          <div class="comment-item__content__body">${f()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${b}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};Xr.styles=m1,Xr.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String}},Xr=Ue([ke("superviz-comments-comment-item")],Xr);D();var uv=We(Re),g1=[uv.styles,Tc],ei=class extends uv{constructor(){super();this.pinCoordinates=null;this.getCommentInput=()=>this.shadowRoot.getElementById("comment-input--textarea");this.getCommentInputContainer=()=>this.shadowRoot.getElementById("comment-input--container");this.getSendBtn=()=>this.shadowRoot.querySelector(".comment-input--send-btn");this.commentInputFocus=({detail:e})=>{this.pinCoordinates=e,this.getCommentInput().focus()};this.sendEnter=e=>{if(e.key!=="Enter"||e.shiftKey)return;let r=this.getCommentInput(),i=r.value.trim();if(!i)return;let a=this.getSendBtn();this.emitEvent(this.eventType,{text:i,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",a.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1})};this.btnActive=!1,this.text=""}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&(window.document.body.addEventListener("comment-input-focus",this.commentInputFocus),this.addEventListener("keyup",this.sendEnter))}disconnectedCallback(){super.disconnectedCallback(),this.eventType==="create-annotation"&&window.document.body.removeEventListener("comment-input-focus",this.commentInputFocus)}updated(e){if(e.has("text")&&this.text.length>0){let r=this.getCommentInput();r.value=this.text,this.updateHeight()}if(e.has("btnActive")){let r=this.getSendBtn();r.disabled=!this.btnActive}}updateHeight(){let e=this.getCommentInput(),r=this.getCommentInputContainer();e.style.height="0px",r.style.height="0px";let i=e.scrollHeight+4,a=e.scrollHeight;e.style.height=`${i}px`,r.style.height=`${a}px`;let l=this.getSendBtn();l.disabled=!(e.value.length>0)}send(e){e.preventDefault();let r=this.getCommentInput(),i=this.getSendBtn(),a=r.value;this.emitEvent(this.eventType,{text:a,position:this.pinCoordinates},{composed:!1,bubbles:!1}),this.pinCoordinates=null,r.value="",i.disabled=!0,this.updateHeight()}render(){var i;let e=()=>{if(!!this.editable)return ge`
        <button
          id="close"
          @click=${()=>this.closeEditMode()}
          class="icon-button icon-button--medium icon-button--clickable"
          @click=${this.send}
        >
          <superviz-icon name="close" size="md"></superviz-icon>
        </button>
        <button id="confirm" class="comment-input--send-btn" disabled @click=${this.send}>
          <superviz-icon name="check" size="md"></superviz-icon>
        </button>
      `},r=()=>{if(!this.editable)return ge`
        <button class="comment-input--send-btn align-send-btn" disabled @click=${this.send}>
          <superviz-icon name="send" size="sm"></superviz-icon>
        </button>
      `};return ge`
      <div class="comment-input">
        <div id="comment-input--container">
          <textarea
            id="comment-input--textarea"
            placeholder=${(i=this.placeholder)!=null?i:"Add comment..."}
            @input=${this.updateHeight}
          ></textarea>
        </div>
        <div class="sv-hr"></div>
        <div class="comment-input--options">
          <div>
            <button class="icon-button mention">
              <superviz-icon name="mention" size="sm"></superviz-icon>
            </button>
          </div>
          <div class="comment-input-options">
            ${r()} ${e()}
          </div>
        </div>
      </div>
    `}};ei.styles=g1,ei.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean},placeholder:{type:String}},ei=Ue([ke("superviz-comments-comment-input")],ei);D();var cv=We(Re),v1=[cv.styles,Ic],ti=class extends cv{constructor(){super();this.position={x:0,y:0}}get userInitial(){var r,i,a;return(((a=(i=(r=this.annotation)==null?void 0:r.comments[0])==null?void 0:i.participant)==null?void 0:a.name)||"Anonymous")[0].toUpperCase()}emitClick(){document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:this.annotation.uuid}}))}render(){var r,i;let e={"annotation-pin":!0,"annotation-pin--active":this.active};return this.type==="add"?ge`
        <div
          class=${it(e)}
          style=${`top: ${this.position.y}px; left: ${this.position.x}px;`}
        >
          <div class="annotation-pin__avatar annotation-pin__avatar--add">
            <superviz-icon name="add"></superviz-icon>
          </div>
        </div>
      `:ge`
      <div
        @click=${this.emitClick}
        class=${it(e)}
        style=${`top: ${(r=this.position)==null?void 0:r.y}px; left: ${(i=this.position)==null?void 0:i.x}px; pointer-events: auto;`}
      >
        <div class="annotation-pin__avatar">
          <p class="text text-bold text-big">${this.userInitial}</p>
          <!-- <img src="https://picsum.photos/200/300" alt="" /> -->
        </div>
      </div>
    `}};ti.styles=v1,ti.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean}},ti=Ue([ke("superviz-comments-annotation-pin")],ti);D();var fv=We(Re),y1=[fv.styles,wc],ni=class extends fv{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:e}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:e}}))};this.resolveAnnotation=({detail:e})=>{let{uuid:r}=this.annotation,{resolved:i,type:a}=e,l=a==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=i,this.emitEvent("resolve-annotation",{uuid:r,resolved:i}),l&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpantedCommentesTemplate=(e,r)=>r===0?ge``:ge`
      <superviz-comments-comment-item
        uuid=${e.uuid}
        avatar="https://picsum.photos/200/300"
        username=${e.participant.name||"Anonymous"}
        text=${e.text}
        createdAt=${e.createdAt}
        annotationId=${this.annotation.uuid}
      ></superviz-comments-comment-item>
    `}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHiddenAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{"annotation-item":!0,"annotation-item--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,hidden:!(!this.expandComments&&this.replies>=1)}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,hidden:!(this.isSelected&&this.expandComments)}}firstUpdated(){this.resolved=this.annotation.resolved}updated(e){if(e.has("selected")){let r=this.selected===this.annotation.uuid;this.expandComments=r}}createComment({detail:e}){let{text:r}=e;this.emitEvent("create-comment",{uuid:this.annotation.uuid,text:r})}generateAvatarCommentsTemplate(){var r,i;let e=[];for(let a=1;a<=this.repliesSize;a++)e.push(ge`
        <div class="avatar">
          <p class="text text-bold">
            ${((i=(r=this.annotation.comments[a])==null?void 0:r.participant.name[0])==null?void 0:i.toUpperCase())||"A"}
          </p>
        </div>
      `);return ge`
      ${e}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?ge`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${it({hidden:this.filterIsResolved})}
      >
      </superviz-comments-annotation-resolved>
    `:ge``}render(){var e,r,i,a,l,u;return ge`
      ${this.annotationResolvedTemplate()}

      <div class=${it(this.shouldHiddenAnnotation)}>
        <div class=${it(this.annotationClasses)} @click=${this.selectAnnotation}>
          <div>
            <superviz-comments-comment-item
              uuid=${(e=this.annotation.comments)==null?void 0:e[0].uuid}
              annotationId=${this.annotation.uuid}
              username=${((i=(r=this.annotation.comments)==null?void 0:r[0].participant)==null?void 0:i.name)||"Anonymous"}
              text=${(a=this.annotation.comments)==null?void 0:a[0].text}
              createdAt=${(l=this.annotation.comments)==null?void 0:l[0].createdAt}
              primaryComment
              resolvable
              ?resolved=${this.resolved}
              annotationFilter=${this.annotationFilter}
              @resolve-annotation=${this.resolveAnnotation}
            ></superviz-comments-comment-item>

            <div class=${it(this.avatarCommentsClasses)}>
              <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
            </div>
          </div>

          <div class=${it(this.commentsClasses)}>
            ${(u=this.annotation.comments)==null?void 0:u.map(this.generateExpantedCommentesTemplate)}
            <superviz-comments-comment-input
              @create-comment=${this.createComment}
              eventType="create-comment"
              @click=${f=>f.stopPropagation()}
              placeholder="Reply"
            ></superviz-comments-comment-input>
          </div>
        </div>
        <div class=${it(this.hrClasses)}></div>
      </div>
    `}};ni.styles=y1,ni.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String}},ni=Ue([ke("superviz-comments-annotation-item")],ni);D();var dv=We(Re),b1=[dv.styles],ri=class extends dv{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:ge`<span class="text text-big sv-gray-600">Are you sure you want to delete this comment? <br /> This action cannot be undone</span>`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(e){e.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let e=()=>{if(!!this.useSlot)return ge`<slot name="modal-handler" @click=${this.toggle}></slot>`},r=()=>{if(!!this.open)return ge`
        <superviz-modal></superviz-modal>
      `};return ge`
      ${e()}
      ${r()}
    `}};ri.styles=b1,ri.properties={open:{type:Boolean},useSlot:{type:Boolean}},ri=Ue([ke("superviz-comments-delete-comments-modal")],ri);D();var hv=We(Re),E1=[hv.styles,xc],A1=10*1e3,ii=class extends hv{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=A1,this.isCanceled=!1}firstUpdated(){this.setTimer()}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?ge``:this.isCanceled?ge``:ge`
      <div class="annotation-resolved">
        <span class="text text-big sv-gray-700">You resolved this comment</span>
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};ii.styles=E1,ii.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},ii=Ue([ke("superviz-comments-annotation-resolved")],ii);D();var pv=We(Re),C1=[pv.styles,Rc],ms=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],oi=class extends pv{constructor(){super();this.caret="down"}render(){let e=this.filter==="all"?ms[0].label:ms[1].label,r=({detail:u})=>{this.emitEvent("select",{filter:u}),i()},i=()=>{this.caret=this.caret==="down"?"up":"down"},a=this.filter==="all"?ms[0].code:ms[1].code,l={text:!0,"text-bold":!0,"select-content":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return ge`
      <div class="select">
        <div class="select-container">
          <superviz-dropdown 
            options=${JSON.stringify(ms)}
            active=${a}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${i}
            @selected=${r}
            @close=${i}
          >
            <div class="content" slot="dropdown">
              <span class=${it(l)}>${e}</span>
              <superviz-icon name=${this.caret} size="md"></superviz-icon>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};oi.styles=C1,oi.properties={filter:{type:String},caret:{type:String}},oi=Ue([ke("superviz-comments-annotation-filter")],oi);D();var mv=We(Re),S1=[mv.styles,_c],si=class extends mv{constructor(){super();this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden})}updated(e){super.updated(e),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".float-button");if(!r)return;r.setAttribute("style",this.positionStyles);let i=window.document.body.getBoundingClientRect().width,a=r.getBoundingClientRect(),l=320;if(!this.commentsPosition||this.commentsPosition==="left"){this.shouldHide=a.x<l;return}this.shouldHide=i-a.right<l})}render(){let e={"float-button":!0,"hide-button":!this.isHidden&&this.shouldHide};return ge` <button @click=${this.toggle} class="${it(e)}">
      <superviz-icon name="comment"></superviz-icon>

      <p class="text text-big text-bold">Comments</p>
    </button>`}};si.styles=S1,si.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String}},si=Ue([ke("superviz-comments-button")],si);D();D();D();var gs=(e=>(e.GOTO="GO TO",e.FOLLOW="FOLLOW",e))(gs||{});D();D();var vf=Ie`
  .superviz-who-is-online {
    position: fixed;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .superviz-who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #aea9b8;
    cursor: pointer;
  }

  .superviz-who-is-online__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 18px;
    line-height: 18px;
    font-weight: bold;
    color: #26242a;
  }

  .superviz-who-is-online__excess {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Roboto;
    font-size: 16px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
    color: #26242a;
  }

  .excess_participants:hover,
  .excess_participants--open {
    background-color: #aea9b8 !important;
  }

  .excess_participants:hover > div,
  .excess_participants--open > div {
    color: #fff !important;
  }

  @media (max-width: 780px) {
    .superviz-who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .superviz-who-is-online__avatar {
      width: 24px;
      height: 24px;
    }

    .superviz-who-is-online {
      gap: 8px;
    }
  }
`;D();var yf=Ie`
  .dropdown {
    position: relative;
  }

  .who-is-online-dropdown__content {
    display: flex;
    user-select: none;
    align-items: center;
    justify-items: start;
    gap: 4px;
    width: 100%;
    padding: 10px;
    border-radius: 2px;
    position: relative;
  }

  .who-is-online-dropdown__content:hover,
  .who-is-online-dropdown__content--selected {
    background-color: rgb(var(--sv-gray-200));
  }

  .who-is-online-dropdown__participant {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 2px solid #878291;
    border-radius: 50%;
  }

  .who-is-online-dropdown__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 18px;
    line-height: 18px;
    font-weight: bold;
    color: #26242a;
  }

  .dropdown-list {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .dropdown-list > div {
    padding: 5px;
    min-width: 216px;
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
    top: 4px;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    left: 0px;
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .user-name {
    font-size: 14px;
    line-height: 20px;
    font-family: 'Open sans';
    color: rgb(var(--sv-gray-600));
  }

  .icon {
    flex: 1;
    justify-content: flex-end;
    display: flex;
  }

  @media (max-width: 780px) {
    .sv-icon,
    .who-is-online-dropdown__participant {
      width: 32px;
      height: 32px;
    }
  }
`;var gv=We(Re),O1=[gv.styles,vf],ai=class extends gv{constructor(){super();this.onClickOutDropdown=({detail:e})=>{this.open=e.open};this.dropdownOptionsHandler=({detail:e})=>{};this.position="top: 20px; right: 40px;",this.open=!1,this.textColorValues=[2,4,5,7,8,16]}updateParticipants(e){this.participants=e}toggleOpen(){this.open=!this.open}dropdownPosition(e){if(this.participants.length===1)return"bottom-center";if(e===0)return"bottom-left";let r=this.participants.length>4,i=e+1===this.participants.length;return r||!i?"bottom-center":"bottom-right"}renderExcessParticipants(){let e=this.participants.length-4;if(e<=0)return ge``;let r=this.participants.slice(4).map(({name:l,color:u,id:f,slotIndex:m})=>({name:l,color:u,id:f,slotIndex:m})),i={"superviz-who-is-online__participant":!0,excess_participants:!0,"excess_participants--open":this.open};return ge`
      <superviz-who-is-online-dropdown
        label="label"
        returnTo="label"
        position="bottom-right"
        @selected=${this.dropdownOptionsHandler}
        participants=${JSON.stringify(r)}
        @clickout=${this.onClickOutDropdown}
      >
        <div class=${it(i)} slot="dropdown" @click=${this.toggleOpen}>
          <div class="superviz-who-is-online__excess" style="color: #AEA9B8;">+${e}</div>
        </div>
      </superviz-who-is-online-dropdown>
    `}renderParticipants(){if(!this.participants)return ge``;let e=Object.values(gs).map(i=>({label:i})),r=["place","send"];return ge`${this.participants.slice(0,4).map((i,a)=>{var f;let l=this.textColorValues.includes(i.slotIndex)?"#FFFFFF":"#26242A",u=this.dropdownPosition(a);return ge`
        <superviz-dropdown
          options=${JSON.stringify(e)}
          label="label"
          returnTo="label"
          position="${u}"
          @selected=${this.dropdownOptionsHandler}
          icons="${JSON.stringify(r)}"
          name="${i.name}"
        >
          <div
            slot="dropdown"
            class="superviz-who-is-online__participant"
            style="border-color: ${i.color}"
          >
            <div
              class="superviz-who-is-online__avatar"
              style="background-color: ${i.color}; color: ${l}"
            >
              ${(f=i.name)==null?void 0:f.at(0)}
            </div>
          </div>
        </superviz-dropdown>
      `})}
    ${this.renderExcessParticipants()} `}updated(e){super.updated(e),this.updateComplete.then(()=>{let r=this.shadowRoot.querySelector(".superviz-who-is-online");!r||r.setAttribute("style",this.position)})}render(){return ge` <div class="superviz-who-is-online">${this.renderParticipants()}</div>`}};ai.styles=O1,ai.properties={position:{type:String},participants:{type:Object},open:{type:Boolean}},ai=Ue([ke("superviz-who-is-online")],ai);D();D();var vv=We(Re),T1=[vv.styles,yf],li=class extends vv{constructor(){super();this.onClickOutDropdown=e=>{if(e.stopPropagation(),!this.open)return;let r=e.composedPath(),i=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],f=r.includes(i),m=r.includes(a),b=r.includes(u);f||m||b||(this.open=!1,this.selected="",this.emitEvent("clickout",{detail:{open:this.open},bubbles:!1,composed:!1}))};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.dropdownOptionsHandler=({detail:e})=>{};this.selectParticipant=e=>()=>{this.selected=e};this.textColorValues=[2,4,5,7,8,16],this.selected=""}updated(e){e.has("open")&&(this.open?document.addEventListener("click",this.onClickOutDropdown):(document.removeEventListener("click",this.onClickOutDropdown),this.close()))}renderParticipants(){if(!this.participants)return;let e=Object.values(gs).map(i=>({label:i})),r=["place","send"];return this.participants.map(i=>{var u;let a=this.textColorValues.includes(i.slotIndex)?"#FFFFFF":"#26242A",l={"who-is-online-dropdown__content":!0,"who-is-online-dropdown__content--selected":this.selected===i.id};return ge`
        <superviz-dropdown
        options=${JSON.stringify(e)}
        label="label"
        returnTo="label"
        position="bottom-right"
        @selected=${this.dropdownOptionsHandler}
        icons="${JSON.stringify(r)}"
        >
        <div class=${it(l)} @click=${this.selectParticipant(i.id)} slot="dropdown">
          <div class="who-is-online-dropdown__participant" style="border-color: 
          ${i.color}">
              <div class="who-is-online-dropdown__avatar" style="background-color: ${i.color}; color: ${a}">
                ${(u=i.name)==null?void 0:u.at(0)}
              </div>
            </div>
            <span class="user-name">${i.name}</span>
            <superviz-icon class="icon" name="right" color="var(--sv-gray-600)"></superviz-icon>
          </div>
        </div>
      </superviz-dropdown>
      `})}toggleOpen(){this.open=!this.open,this.selected=""}get menuClasses(){return{menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right"}}render(){return ge`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggleOpen}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <div class=${it(this.menuClasses)}>${this.renderParticipants()}</div>
      </div>
    `}};li.styles=T1,li.properties={open:{type:Boolean},align:{type:String},position:{type:String},participants:{type:Array},selected:{type:String}},li=Ue([ke("superviz-who-is-online-dropdown")],li);D();D();function yv(s){if(typeof document!="undefined"){let t=document.createElement("style");t.id="superviz-style";let e=document.createTextNode(s);t.appendChild(e),document.head.appendChild(t)}}var bv=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}
`;yv(bv);D();D();D();window&&(window.SuperVizRoom={init:Zu,MeetingEvent:go,DeviceEvent:Ru,RealtimeEvent:Cr,MeetingState:aa,MeetingConnectionStatus:yo,MeetingControlsEvent:sa,ParticipantEvent:la,FrameEvent:vo,LayoutMode:ya,VideoConference:wo,MousePointers:xo,Realtime:Io,Comments:Ao,CanvasPin:Co,WhoIsOnline:Ro,ParticipantType:Ci,LayoutPosition:va,CamerasPosition:ba,RealtimeComponentState:Aa,RealtimeComponentEvent:Ca});var ZF=Zu;export{Oo as BrowserService,ba as CamerasPosition,Ru as DeviceEvent,vo as FrameEvent,ya as LayoutMode,va as LayoutPosition,yo as MeetingConnectionStatus,sa as MeetingControlsEvent,go as MeetingEvent,aa as MeetingState,Ae as Observer,la as ParticipantEvent,Ci as ParticipantType,ha as PinMode,Ca as RealtimeComponentEvent,Aa as RealtimeComponentState,Cr as RealtimeEvent,ZF as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
