var tm=Object.create;var Vr=Object.defineProperty,em=Object.defineProperties,nm=Object.getOwnPropertyDescriptor,rm=Object.getOwnPropertyDescriptors,im=Object.getOwnPropertyNames,Cu=Object.getOwnPropertySymbols,om=Object.getPrototypeOf,Ru=Object.prototype.hasOwnProperty,am=Object.prototype.propertyIsEnumerable;var Ou=(v,c,r)=>c in v?Vr(v,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[c]=r,dn=(v,c)=>{for(var r in c||(c={}))Ru.call(c,r)&&Ou(v,r,c[r]);if(Cu)for(var r of Cu(c))am.call(c,r)&&Ou(v,r,c[r]);return v},Su=(v,c)=>em(v,rm(c));var Oo=(v,c)=>()=>(v&&(c=v(v=0)),c);var Kt=(v,c)=>()=>(c||v((c={exports:{}}).exports,c),c.exports),Tu=(v,c)=>{for(var r in c)Vr(v,r,{get:c[r],enumerable:!0})},sm=(v,c,r,p)=>{if(c&&typeof c=="object"||typeof c=="function")for(let i of im(c))!Ru.call(v,i)&&i!==r&&Vr(v,i,{get:()=>c[i],enumerable:!(p=nm(c,i))||p.enumerable});return v};var hn=(v,c,r)=>(r=v!=null?tm(om(v)):{},sm(c||!v||!v.__esModule?Vr(r,"default",{value:v,enumerable:!0}):r,v));var re=(v,c,r)=>new Promise((p,i)=>{var E=d=>{try{u(r.next(d))}catch(A){i(A)}},T=d=>{try{u(r.throw(d))}catch(A){i(A)}},u=d=>d.done?p(d.value):Promise.resolve(d.value).then(E,T);u((r=r.apply(v,c)).next())});var yt,st=Oo(()=>{yt={}});var Iu=Kt((R0,Eu)=>{st();var wn=1e3,xn=wn*60,Ln=xn*60,pn=Ln*24,fm=pn*7,lm=pn*365.25;Eu.exports=function(v,c){c=c||{};var r=typeof v;if(r==="string"&&v.length>0)return cm(v);if(r==="number"&&isFinite(v))return c.long?hm(v):dm(v);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(v))};function cm(v){if(v=String(v),!(v.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!c){var r=parseFloat(c[1]),p=(c[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return r*lm;case"weeks":case"week":case"w":return r*fm;case"days":case"day":case"d":return r*pn;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Ln;case"minutes":case"minute":case"mins":case"min":case"m":return r*xn;case"seconds":case"second":case"secs":case"sec":case"s":return r*wn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function dm(v){var c=Math.abs(v);return c>=pn?Math.round(v/pn)+"d":c>=Ln?Math.round(v/Ln)+"h":c>=xn?Math.round(v/xn)+"m":c>=wn?Math.round(v/wn)+"s":v+"ms"}function hm(v){var c=Math.abs(v);return c>=pn?Kr(v,c,pn,"day"):c>=Ln?Kr(v,c,Ln,"hour"):c>=xn?Kr(v,c,xn,"minute"):c>=wn?Kr(v,c,wn,"second"):v+" ms"}function Kr(v,c,r,p){var i=c>=r*1.5;return Math.round(v/r)+" "+p+(i?"s":"")}});var Mu=Kt((S0,Pu)=>{st();function pm(v){r.debug=r,r.default=r,r.coerce=d,r.disable=E,r.enable=i,r.enabled=T,r.humanize=Iu(),r.destroy=A,Object.keys(v).forEach(R=>{r[R]=v[R]}),r.names=[],r.skips=[],r.formatters={};function c(R){let O=0;for(let a=0;a<R.length;a++)O=(O<<5)-O+R.charCodeAt(a),O|=0;return r.colors[Math.abs(O)%r.colors.length]}r.selectColor=c;function r(R){let O,a=null,C,w;function _(...b){if(!_.enabled)return;let m=_,S=Number(new Date),o=S-(O||S);m.diff=o,m.prev=O,m.curr=S,O=S,b[0]=r.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let g=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(l,s)=>{if(l==="%%")return"%";g++;let y=r.formatters[s];if(typeof y=="function"){let P=b[g];l=y.call(m,P),b.splice(g,1),g--}return l}),r.formatArgs.call(m,b),(m.log||r.log).apply(m,b)}return _.namespace=R,_.useColors=r.useColors(),_.color=r.selectColor(R),_.extend=p,_.destroy=r.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(C!==r.namespaces&&(C=r.namespaces,w=r.enabled(R)),w),set:b=>{a=b}}),typeof r.init=="function"&&r.init(_),_}function p(R,O){let a=r(this.namespace+(typeof O=="undefined"?":":O)+R);return a.log=this.log,a}function i(R){r.save(R),r.namespaces=R,r.names=[],r.skips=[];let O,a=(typeof R=="string"?R:"").split(/[\s,]+/),C=a.length;for(O=0;O<C;O++)!a[O]||(R=a[O].replace(/\*/g,".*?"),R[0]==="-"?r.skips.push(new RegExp("^"+R.slice(1)+"$")):r.names.push(new RegExp("^"+R+"$")))}function E(){let R=[...r.names.map(u),...r.skips.map(u).map(O=>"-"+O)].join(",");return r.enable(""),R}function T(R){if(R[R.length-1]==="*")return!0;let O,a;for(O=0,a=r.skips.length;O<a;O++)if(r.skips[O].test(R))return!1;for(O=0,a=r.names.length;O<a;O++)if(r.names[O].test(R))return!0;return!1}function u(R){return R.toString().substring(2,R.toString().length-2).replace(/\.\*\?$/,"*")}function d(R){return R instanceof Error?R.stack||R.message:R}function A(){}return r.enable(r.load()),r}Pu.exports=pm});var Ro=Kt((ye,Jr)=>{st();ye.formatArgs=vm;ye.save=mm;ye.load=ym;ye.useColors=gm;ye.storage=bm();ye.destroy=(()=>{let v=!1;return()=>{v||(v=!0)}})();ye.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function gm(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function vm(v){if(v[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+v[0]+(this.useColors?"%c ":" ")+"+"+Jr.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;v.splice(1,0,c,"color: inherit");let r=0,p=0;v[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(r++,i==="%c"&&(p=r))}),v.splice(p,0,c)}ye.log=console.debug||console.log||(()=>{});function mm(v){try{v?ye.storage.setItem("debug",v):ye.storage.removeItem("debug")}catch(c){}}function ym(){let v;try{v=ye.storage.getItem("debug")}catch(c){}return!v&&typeof process!="undefined"&&"env"in process&&(v=yt.DEBUG),v}function bm(){try{return localStorage}catch(v){}}Jr.exports=Mu()(ye);var{formatters:Am}=Jr.exports;Am.j=function(v){try{return JSON.stringify(v)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}});var _u=Kt((Dn,Zn)=>{st();(function(){var v,c="4.17.21",r=200,p="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",E="Invalid `variable` option passed into `_.template`",T="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",A=1,R=2,O=4,a=1,C=2,w=1,_=2,b=4,m=8,S=16,o=32,g=64,f=128,l=256,s=512,y=30,P="...",D=800,k=16,H=1,U=2,I=3,x=1/0,z=9007199254740991,W=17976931348623157e292,Q=0/0,Z=4294967295,$=Z-1,G=Z>>>1,N=[["ary",f],["bind",w],["bindKey",_],["curry",m],["curryRight",S],["flip",s],["partial",o],["partialRight",g],["rearg",l]],B="[object Arguments]",K="[object Array]",V="[object AsyncFunction]",tt="[object Boolean]",ft="[object Date]",vt="[object DOMException]",gt="[object Error]",Rt="[object Function]",xt="[object GeneratorFunction]",ct="[object Map]",wt="[object Number]",$t="[object Null]",Ut="[object Object]",Ht="[object Promise]",se="[object Proxy]",X="[object RegExp]",rt="[object Set]",ut="[object String]",ht="[object Symbol]",Tt="[object Undefined]",Jt="[object WeakMap]",en="[object WeakSet]",Bn="[object ArrayBuffer]",mn="[object DataView]",ti="[object Float32Array]",ei="[object Float64Array]",ni="[object Int8Array]",ri="[object Int16Array]",ii="[object Int32Array]",oi="[object Uint8Array]",ai="[object Uint8ClampedArray]",si="[object Uint16Array]",ui="[object Uint32Array]",Cf=/\b__p \+= '';/g,Of=/\b(__p \+=) '' \+/g,Rf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ko=/&(?:amp|lt|gt|quot|#39);/g,Jo=/[&<>"']/g,Sf=RegExp(Ko.source),Tf=RegExp(Jo.source),Ef=/<%-([\s\S]+?)%>/g,If=/<%([\s\S]+?)%>/g,Qo=/<%=([\s\S]+?)%>/g,Pf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mf=/^\w*$/,_f=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fi=/[\\^$.*+?()[\]{}|]/g,wf=RegExp(fi.source),li=/^\s+/,xf=/\s/,Lf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Df=/\{\n\/\* \[wrapped with (.+)\] \*/,Nf=/,? & /,Uf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Bf=/[()=,{}\[\]\/\s]/,Ff=/\\(\\)?/g,Gf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qo=/\w*$/,Hf=/^[-+]0x[0-9a-f]+$/i,Wf=/^0b[01]+$/i,kf=/^\[object .+?Constructor\]$/,zf=/^0o[0-7]+$/i,jf=/^(?:0|[1-9]\d*)$/,Vf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rr=/($^)/,Kf=/['\n\r\u2028\u2029\\]/g,ir="\\ud800-\\udfff",Jf="\\u0300-\\u036f",Qf="\\ufe20-\\ufe2f",qf="\\u20d0-\\u20ff",$o=Jf+Qf+qf,Yo="\\u2700-\\u27bf",Xo="a-z\\xdf-\\xf6\\xf8-\\xff",$f="\\xac\\xb1\\xd7\\xf7",Yf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Xf="\\u2000-\\u206f",Zf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Zo="A-Z\\xc0-\\xd6\\xd8-\\xde",ta="\\ufe0e\\ufe0f",ea=$f+Yf+Xf+Zf,ci="['\u2019]",tl="["+ir+"]",na="["+ea+"]",or="["+$o+"]",ra="\\d+",el="["+Yo+"]",ia="["+Xo+"]",oa="[^"+ir+ea+ra+Yo+Xo+Zo+"]",di="\\ud83c[\\udffb-\\udfff]",nl="(?:"+or+"|"+di+")",aa="[^"+ir+"]",hi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",yn="["+Zo+"]",sa="\\u200d",ua="(?:"+ia+"|"+oa+")",rl="(?:"+yn+"|"+oa+")",fa="(?:"+ci+"(?:d|ll|m|re|s|t|ve))?",la="(?:"+ci+"(?:D|LL|M|RE|S|T|VE))?",ca=nl+"?",da="["+ta+"]?",il="(?:"+sa+"(?:"+[aa,hi,pi].join("|")+")"+da+ca+")*",ol="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",al="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ha=da+ca+il,sl="(?:"+[el,hi,pi].join("|")+")"+ha,ul="(?:"+[aa+or+"?",or,hi,pi,tl].join("|")+")",fl=RegExp(ci,"g"),ll=RegExp(or,"g"),gi=RegExp(di+"(?="+di+")|"+ul+ha,"g"),cl=RegExp([yn+"?"+ia+"+"+fa+"(?="+[na,yn,"$"].join("|")+")",rl+"+"+la+"(?="+[na,yn+ua,"$"].join("|")+")",yn+"?"+ua+"+"+fa,yn+"+"+la,al,ol,ra,sl].join("|"),"g"),dl=RegExp("["+sa+ir+$o+ta+"]"),hl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],gl=-1,Gt={};Gt[ti]=Gt[ei]=Gt[ni]=Gt[ri]=Gt[ii]=Gt[oi]=Gt[ai]=Gt[si]=Gt[ui]=!0,Gt[B]=Gt[K]=Gt[Bn]=Gt[tt]=Gt[mn]=Gt[ft]=Gt[gt]=Gt[Rt]=Gt[ct]=Gt[wt]=Gt[Ut]=Gt[X]=Gt[rt]=Gt[ut]=Gt[Jt]=!1;var Ft={};Ft[B]=Ft[K]=Ft[Bn]=Ft[mn]=Ft[tt]=Ft[ft]=Ft[ti]=Ft[ei]=Ft[ni]=Ft[ri]=Ft[ii]=Ft[ct]=Ft[wt]=Ft[Ut]=Ft[X]=Ft[rt]=Ft[ut]=Ft[ht]=Ft[oi]=Ft[ai]=Ft[si]=Ft[ui]=!0,Ft[gt]=Ft[Rt]=Ft[Jt]=!1;var vl={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},ml={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},bl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Al=parseFloat,Cl=parseInt,pa=typeof global=="object"&&global&&global.Object===Object&&global,Ol=typeof self=="object"&&self&&self.Object===Object&&self,Yt=pa||Ol||Function("return this")(),vi=typeof Dn=="object"&&Dn&&!Dn.nodeType&&Dn,nn=vi&&typeof Zn=="object"&&Zn&&!Zn.nodeType&&Zn,ga=nn&&nn.exports===vi,mi=ga&&pa.process,be=function(){try{var q=nn&&nn.require&&nn.require("util").types;return q||mi&&mi.binding&&mi.binding("util")}catch(nt){}}(),va=be&&be.isArrayBuffer,ma=be&&be.isDate,ya=be&&be.isMap,ba=be&&be.isRegExp,Aa=be&&be.isSet,Ca=be&&be.isTypedArray;function de(q,nt,et){switch(et.length){case 0:return q.call(nt);case 1:return q.call(nt,et[0]);case 2:return q.call(nt,et[0],et[1]);case 3:return q.call(nt,et[0],et[1],et[2])}return q.apply(nt,et)}function Rl(q,nt,et,dt){for(var Ct=-1,Lt=q==null?0:q.length;++Ct<Lt;){var Qt=q[Ct];nt(dt,Qt,et(Qt),q)}return dt}function Ae(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt&&nt(q[et],et,q)!==!1;);return q}function Sl(q,nt){for(var et=q==null?0:q.length;et--&&nt(q[et],et,q)!==!1;);return q}function Oa(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt;)if(!nt(q[et],et,q))return!1;return!0}function Ve(q,nt){for(var et=-1,dt=q==null?0:q.length,Ct=0,Lt=[];++et<dt;){var Qt=q[et];nt(Qt,et,q)&&(Lt[Ct++]=Qt)}return Lt}function ar(q,nt){var et=q==null?0:q.length;return!!et&&bn(q,nt,0)>-1}function yi(q,nt,et){for(var dt=-1,Ct=q==null?0:q.length;++dt<Ct;)if(et(nt,q[dt]))return!0;return!1}function Wt(q,nt){for(var et=-1,dt=q==null?0:q.length,Ct=Array(dt);++et<dt;)Ct[et]=nt(q[et],et,q);return Ct}function Ke(q,nt){for(var et=-1,dt=nt.length,Ct=q.length;++et<dt;)q[Ct+et]=nt[et];return q}function bi(q,nt,et,dt){var Ct=-1,Lt=q==null?0:q.length;for(dt&&Lt&&(et=q[++Ct]);++Ct<Lt;)et=nt(et,q[Ct],Ct,q);return et}function Tl(q,nt,et,dt){var Ct=q==null?0:q.length;for(dt&&Ct&&(et=q[--Ct]);Ct--;)et=nt(et,q[Ct],Ct,q);return et}function Ai(q,nt){for(var et=-1,dt=q==null?0:q.length;++et<dt;)if(nt(q[et],et,q))return!0;return!1}var El=Ci("length");function Il(q){return q.split("")}function Pl(q){return q.match(Uf)||[]}function Ra(q,nt,et){var dt;return et(q,function(Ct,Lt,Qt){if(nt(Ct,Lt,Qt))return dt=Lt,!1}),dt}function sr(q,nt,et,dt){for(var Ct=q.length,Lt=et+(dt?1:-1);dt?Lt--:++Lt<Ct;)if(nt(q[Lt],Lt,q))return Lt;return-1}function bn(q,nt,et){return nt===nt?Hl(q,nt,et):sr(q,Sa,et)}function Ml(q,nt,et,dt){for(var Ct=et-1,Lt=q.length;++Ct<Lt;)if(dt(q[Ct],nt))return Ct;return-1}function Sa(q){return q!==q}function Ta(q,nt){var et=q==null?0:q.length;return et?Ri(q,nt)/et:Q}function Ci(q){return function(nt){return nt==null?v:nt[q]}}function Oi(q){return function(nt){return q==null?v:q[nt]}}function Ea(q,nt,et,dt,Ct){return Ct(q,function(Lt,Qt,Bt){et=dt?(dt=!1,Lt):nt(et,Lt,Qt,Bt)}),et}function _l(q,nt){var et=q.length;for(q.sort(nt);et--;)q[et]=q[et].value;return q}function Ri(q,nt){for(var et,dt=-1,Ct=q.length;++dt<Ct;){var Lt=nt(q[dt]);Lt!==v&&(et=et===v?Lt:et+Lt)}return et}function Si(q,nt){for(var et=-1,dt=Array(q);++et<q;)dt[et]=nt(et);return dt}function wl(q,nt){return Wt(nt,function(et){return[et,q[et]]})}function Ia(q){return q&&q.slice(0,wa(q)+1).replace(li,"")}function he(q){return function(nt){return q(nt)}}function Ti(q,nt){return Wt(nt,function(et){return q[et]})}function Fn(q,nt){return q.has(nt)}function Pa(q,nt){for(var et=-1,dt=q.length;++et<dt&&bn(nt,q[et],0)>-1;);return et}function Ma(q,nt){for(var et=q.length;et--&&bn(nt,q[et],0)>-1;);return et}function xl(q,nt){for(var et=q.length,dt=0;et--;)q[et]===nt&&++dt;return dt}var Ll=Oi(vl),Dl=Oi(ml);function Nl(q){return"\\"+bl[q]}function Ul(q,nt){return q==null?v:q[nt]}function An(q){return dl.test(q)}function Bl(q){return hl.test(q)}function Fl(q){for(var nt,et=[];!(nt=q.next()).done;)et.push(nt.value);return et}function Ei(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt,Ct){et[++nt]=[Ct,dt]}),et}function _a(q,nt){return function(et){return q(nt(et))}}function Je(q,nt){for(var et=-1,dt=q.length,Ct=0,Lt=[];++et<dt;){var Qt=q[et];(Qt===nt||Qt===d)&&(q[et]=d,Lt[Ct++]=et)}return Lt}function ur(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt){et[++nt]=dt}),et}function Gl(q){var nt=-1,et=Array(q.size);return q.forEach(function(dt){et[++nt]=[dt,dt]}),et}function Hl(q,nt,et){for(var dt=et-1,Ct=q.length;++dt<Ct;)if(q[dt]===nt)return dt;return-1}function Wl(q,nt,et){for(var dt=et+1;dt--;)if(q[dt]===nt)return dt;return dt}function Cn(q){return An(q)?zl(q):El(q)}function Ie(q){return An(q)?jl(q):Il(q)}function wa(q){for(var nt=q.length;nt--&&xf.test(q.charAt(nt)););return nt}var kl=Oi(yl);function zl(q){for(var nt=gi.lastIndex=0;gi.test(q);)++nt;return nt}function jl(q){return q.match(gi)||[]}function Vl(q){return q.match(cl)||[]}var Kl=function q(nt){nt=nt==null?Yt:Qe.defaults(Yt.Object(),nt,Qe.pick(Yt,pl));var et=nt.Array,dt=nt.Date,Ct=nt.Error,Lt=nt.Function,Qt=nt.Math,Bt=nt.Object,Ii=nt.RegExp,Jl=nt.String,Ce=nt.TypeError,fr=et.prototype,Ql=Lt.prototype,On=Bt.prototype,lr=nt["__core-js_shared__"],cr=Ql.toString,Nt=On.hasOwnProperty,ql=0,xa=function(){var t=/[^.]+$/.exec(lr&&lr.keys&&lr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),dr=On.toString,$l=cr.call(Bt),Yl=Yt._,Xl=Ii("^"+cr.call(Nt).replace(fi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hr=ga?nt.Buffer:v,qe=nt.Symbol,pr=nt.Uint8Array,La=hr?hr.allocUnsafe:v,gr=_a(Bt.getPrototypeOf,Bt),Da=Bt.create,Na=On.propertyIsEnumerable,vr=fr.splice,Ua=qe?qe.isConcatSpreadable:v,Gn=qe?qe.iterator:v,rn=qe?qe.toStringTag:v,mr=function(){try{var t=fn(Bt,"defineProperty");return t({},"",{}),t}catch(e){}}(),Zl=nt.clearTimeout!==Yt.clearTimeout&&nt.clearTimeout,tc=dt&&dt.now!==Yt.Date.now&&dt.now,ec=nt.setTimeout!==Yt.setTimeout&&nt.setTimeout,yr=Qt.ceil,br=Qt.floor,Pi=Bt.getOwnPropertySymbols,nc=hr?hr.isBuffer:v,Ba=nt.isFinite,rc=fr.join,ic=_a(Bt.keys,Bt),qt=Qt.max,ee=Qt.min,oc=dt.now,ac=nt.parseInt,Fa=Qt.random,sc=fr.reverse,Mi=fn(nt,"DataView"),Hn=fn(nt,"Map"),_i=fn(nt,"Promise"),Rn=fn(nt,"Set"),Wn=fn(nt,"WeakMap"),kn=fn(Bt,"create"),Ar=Wn&&new Wn,Sn={},uc=ln(Mi),fc=ln(Hn),lc=ln(_i),cc=ln(Rn),dc=ln(Wn),Cr=qe?qe.prototype:v,zn=Cr?Cr.valueOf:v,Ga=Cr?Cr.toString:v;function L(t){if(zt(t)&&!Ot(t)&&!(t instanceof Mt)){if(t instanceof Oe)return t;if(Nt.call(t,"__wrapped__"))return Hs(t)}return new Oe(t)}var Tn=function(){function t(){}return function(e){if(!kt(e))return{};if(Da)return Da(e);t.prototype=e;var n=new t;return t.prototype=v,n}}();function Or(){}function Oe(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=v}L.templateSettings={escape:Ef,evaluate:If,interpolate:Qo,variable:"",imports:{_:L}},L.prototype=Or.prototype,L.prototype.constructor=L,Oe.prototype=Tn(Or.prototype),Oe.prototype.constructor=Oe;function Mt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function hc(){var t=new Mt(this.__wrapped__);return t.__actions__=ue(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ue(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ue(this.__views__),t}function pc(){if(this.__filtered__){var t=new Mt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function gc(){var t=this.__wrapped__.value(),e=this.__dir__,n=Ot(t),h=e<0,M=n?t.length:0,F=Id(0,M,this.__views__),j=F.start,J=F.end,Y=J-j,it=h?J:j-1,ot=this.__iteratees__,at=ot.length,lt=0,pt=ee(Y,this.__takeCount__);if(!n||!h&&M==Y&&pt==Y)return fs(t,this.__actions__);var bt=[];t:for(;Y--&&lt<pt;){it+=e;for(var Et=-1,At=t[it];++Et<at;){var Pt=ot[Et],_t=Pt.iteratee,ve=Pt.type,ae=_t(At);if(ve==U)At=ae;else if(!ae){if(ve==H)continue t;break t}}bt[lt++]=At}return bt}Mt.prototype=Tn(Or.prototype),Mt.prototype.constructor=Mt;function on(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var h=t[e];this.set(h[0],h[1])}}function vc(){this.__data__=kn?kn(null):{},this.size=0}function mc(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function yc(t){var e=this.__data__;if(kn){var n=e[t];return n===T?v:n}return Nt.call(e,t)?e[t]:v}function bc(t){var e=this.__data__;return kn?e[t]!==v:Nt.call(e,t)}function Ac(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=kn&&e===v?T:e,this}on.prototype.clear=vc,on.prototype.delete=mc,on.prototype.get=yc,on.prototype.has=bc,on.prototype.set=Ac;function Ue(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var h=t[e];this.set(h[0],h[1])}}function Cc(){this.__data__=[],this.size=0}function Oc(t){var e=this.__data__,n=Rr(e,t);if(n<0)return!1;var h=e.length-1;return n==h?e.pop():vr.call(e,n,1),--this.size,!0}function Rc(t){var e=this.__data__,n=Rr(e,t);return n<0?v:e[n][1]}function Sc(t){return Rr(this.__data__,t)>-1}function Tc(t,e){var n=this.__data__,h=Rr(n,t);return h<0?(++this.size,n.push([t,e])):n[h][1]=e,this}Ue.prototype.clear=Cc,Ue.prototype.delete=Oc,Ue.prototype.get=Rc,Ue.prototype.has=Sc,Ue.prototype.set=Tc;function Be(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var h=t[e];this.set(h[0],h[1])}}function Ec(){this.size=0,this.__data__={hash:new on,map:new(Hn||Ue),string:new on}}function Ic(t){var e=Nr(this,t).delete(t);return this.size-=e?1:0,e}function Pc(t){return Nr(this,t).get(t)}function Mc(t){return Nr(this,t).has(t)}function _c(t,e){var n=Nr(this,t),h=n.size;return n.set(t,e),this.size+=n.size==h?0:1,this}Be.prototype.clear=Ec,Be.prototype.delete=Ic,Be.prototype.get=Pc,Be.prototype.has=Mc,Be.prototype.set=_c;function an(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Be;++e<n;)this.add(t[e])}function wc(t){return this.__data__.set(t,T),this}function xc(t){return this.__data__.has(t)}an.prototype.add=an.prototype.push=wc,an.prototype.has=xc;function Pe(t){var e=this.__data__=new Ue(t);this.size=e.size}function Lc(){this.__data__=new Ue,this.size=0}function Dc(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Nc(t){return this.__data__.get(t)}function Uc(t){return this.__data__.has(t)}function Bc(t,e){var n=this.__data__;if(n instanceof Ue){var h=n.__data__;if(!Hn||h.length<r-1)return h.push([t,e]),this.size=++n.size,this;n=this.__data__=new Be(h)}return n.set(t,e),this.size=n.size,this}Pe.prototype.clear=Lc,Pe.prototype.delete=Dc,Pe.prototype.get=Nc,Pe.prototype.has=Uc,Pe.prototype.set=Bc;function Ha(t,e){var n=Ot(t),h=!n&&cn(t),M=!n&&!h&&tn(t),F=!n&&!h&&!M&&Mn(t),j=n||h||M||F,J=j?Si(t.length,Jl):[],Y=J.length;for(var it in t)(e||Nt.call(t,it))&&!(j&&(it=="length"||M&&(it=="offset"||it=="parent")||F&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||We(it,Y)))&&J.push(it);return J}function Wa(t){var e=t.length;return e?t[Wi(0,e-1)]:v}function Fc(t,e){return Ur(ue(t),sn(e,0,t.length))}function Gc(t){return Ur(ue(t))}function wi(t,e,n){(n!==v&&!Me(t[e],n)||n===v&&!(e in t))&&Fe(t,e,n)}function jn(t,e,n){var h=t[e];(!(Nt.call(t,e)&&Me(h,n))||n===v&&!(e in t))&&Fe(t,e,n)}function Rr(t,e){for(var n=t.length;n--;)if(Me(t[n][0],e))return n;return-1}function Hc(t,e,n,h){return $e(t,function(M,F,j){e(h,M,n(M),j)}),h}function ka(t,e){return t&&Le(e,Xt(e),t)}function Wc(t,e){return t&&Le(e,le(e),t)}function Fe(t,e,n){e=="__proto__"&&mr?mr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function xi(t,e){for(var n=-1,h=e.length,M=et(h),F=t==null;++n<h;)M[n]=F?v:ho(t,e[n]);return M}function sn(t,e,n){return t===t&&(n!==v&&(t=t<=n?t:n),e!==v&&(t=t>=e?t:e)),t}function Re(t,e,n,h,M,F){var j,J=e&A,Y=e&R,it=e&O;if(n&&(j=M?n(t,h,M,F):n(t)),j!==v)return j;if(!kt(t))return t;var ot=Ot(t);if(ot){if(j=Md(t),!J)return ue(t,j)}else{var at=ne(t),lt=at==Rt||at==xt;if(tn(t))return ds(t,J);if(at==Ut||at==B||lt&&!M){if(j=Y||lt?{}:ws(t),!J)return Y?yd(t,Wc(j,t)):md(t,ka(j,t))}else{if(!Ft[at])return M?t:{};j=_d(t,at,J)}}F||(F=new Pe);var pt=F.get(t);if(pt)return pt;F.set(t,j),au(t)?t.forEach(function(At){j.add(Re(At,e,n,At,t,F))}):iu(t)&&t.forEach(function(At,Pt){j.set(Pt,Re(At,e,n,Pt,t,F))});var bt=it?Y?Xi:Yi:Y?le:Xt,Et=ot?v:bt(t);return Ae(Et||t,function(At,Pt){Et&&(Pt=At,At=t[Pt]),jn(j,Pt,Re(At,e,n,Pt,t,F))}),j}function kc(t){var e=Xt(t);return function(n){return za(n,t,e)}}function za(t,e,n){var h=n.length;if(t==null)return!h;for(t=Bt(t);h--;){var M=n[h],F=e[M],j=t[M];if(j===v&&!(M in t)||!F(j))return!1}return!0}function ja(t,e,n){if(typeof t!="function")throw new Ce(i);return Yn(function(){t.apply(v,n)},e)}function Vn(t,e,n,h){var M=-1,F=ar,j=!0,J=t.length,Y=[],it=e.length;if(!J)return Y;n&&(e=Wt(e,he(n))),h?(F=yi,j=!1):e.length>=r&&(F=Fn,j=!1,e=new an(e));t:for(;++M<J;){var ot=t[M],at=n==null?ot:n(ot);if(ot=h||ot!==0?ot:0,j&&at===at){for(var lt=it;lt--;)if(e[lt]===at)continue t;Y.push(ot)}else F(e,at,h)||Y.push(ot)}return Y}var $e=ms(xe),Va=ms(Di,!0);function zc(t,e){var n=!0;return $e(t,function(h,M,F){return n=!!e(h,M,F),n}),n}function Sr(t,e,n){for(var h=-1,M=t.length;++h<M;){var F=t[h],j=e(F);if(j!=null&&(J===v?j===j&&!ge(j):n(j,J)))var J=j,Y=F}return Y}function jc(t,e,n,h){var M=t.length;for(n=St(n),n<0&&(n=-n>M?0:M+n),h=h===v||h>M?M:St(h),h<0&&(h+=M),h=n>h?0:uu(h);n<h;)t[n++]=e;return t}function Ka(t,e){var n=[];return $e(t,function(h,M,F){e(h,M,F)&&n.push(h)}),n}function te(t,e,n,h,M){var F=-1,j=t.length;for(n||(n=xd),M||(M=[]);++F<j;){var J=t[F];e>0&&n(J)?e>1?te(J,e-1,n,h,M):Ke(M,J):h||(M[M.length]=J)}return M}var Li=ys(),Ja=ys(!0);function xe(t,e){return t&&Li(t,e,Xt)}function Di(t,e){return t&&Ja(t,e,Xt)}function Tr(t,e){return Ve(e,function(n){return ke(t[n])})}function un(t,e){e=Xe(e,t);for(var n=0,h=e.length;t!=null&&n<h;)t=t[De(e[n++])];return n&&n==h?t:v}function Qa(t,e,n){var h=e(t);return Ot(t)?h:Ke(h,n(t))}function ie(t){return t==null?t===v?Tt:$t:rn&&rn in Bt(t)?Ed(t):Gd(t)}function Ni(t,e){return t>e}function Vc(t,e){return t!=null&&Nt.call(t,e)}function Kc(t,e){return t!=null&&e in Bt(t)}function Jc(t,e,n){return t>=ee(e,n)&&t<qt(e,n)}function Ui(t,e,n){for(var h=n?yi:ar,M=t[0].length,F=t.length,j=F,J=et(F),Y=1/0,it=[];j--;){var ot=t[j];j&&e&&(ot=Wt(ot,he(e))),Y=ee(ot.length,Y),J[j]=!n&&(e||M>=120&&ot.length>=120)?new an(j&&ot):v}ot=t[0];var at=-1,lt=J[0];t:for(;++at<M&&it.length<Y;){var pt=ot[at],bt=e?e(pt):pt;if(pt=n||pt!==0?pt:0,!(lt?Fn(lt,bt):h(it,bt,n))){for(j=F;--j;){var Et=J[j];if(!(Et?Fn(Et,bt):h(t[j],bt,n)))continue t}lt&&lt.push(bt),it.push(pt)}}return it}function Qc(t,e,n,h){return xe(t,function(M,F,j){e(h,n(M),F,j)}),h}function Kn(t,e,n){e=Xe(e,t),t=Ns(t,e);var h=t==null?t:t[De(Te(e))];return h==null?v:de(h,t,n)}function qa(t){return zt(t)&&ie(t)==B}function qc(t){return zt(t)&&ie(t)==Bn}function $c(t){return zt(t)&&ie(t)==ft}function Jn(t,e,n,h,M){return t===e?!0:t==null||e==null||!zt(t)&&!zt(e)?t!==t&&e!==e:Yc(t,e,n,h,Jn,M)}function Yc(t,e,n,h,M,F){var j=Ot(t),J=Ot(e),Y=j?K:ne(t),it=J?K:ne(e);Y=Y==B?Ut:Y,it=it==B?Ut:it;var ot=Y==Ut,at=it==Ut,lt=Y==it;if(lt&&tn(t)){if(!tn(e))return!1;j=!0,ot=!1}if(lt&&!ot)return F||(F=new Pe),j||Mn(t)?Ps(t,e,n,h,M,F):Sd(t,e,Y,n,h,M,F);if(!(n&a)){var pt=ot&&Nt.call(t,"__wrapped__"),bt=at&&Nt.call(e,"__wrapped__");if(pt||bt){var Et=pt?t.value():t,At=bt?e.value():e;return F||(F=new Pe),M(Et,At,n,h,F)}}return lt?(F||(F=new Pe),Td(t,e,n,h,M,F)):!1}function Xc(t){return zt(t)&&ne(t)==ct}function Bi(t,e,n,h){var M=n.length,F=M,j=!h;if(t==null)return!F;for(t=Bt(t);M--;){var J=n[M];if(j&&J[2]?J[1]!==t[J[0]]:!(J[0]in t))return!1}for(;++M<F;){J=n[M];var Y=J[0],it=t[Y],ot=J[1];if(j&&J[2]){if(it===v&&!(Y in t))return!1}else{var at=new Pe;if(h)var lt=h(it,ot,Y,t,e,at);if(!(lt===v?Jn(ot,it,a|C,h,at):lt))return!1}}return!0}function $a(t){if(!kt(t)||Dd(t))return!1;var e=ke(t)?Xl:kf;return e.test(ln(t))}function Zc(t){return zt(t)&&ie(t)==X}function td(t){return zt(t)&&ne(t)==rt}function ed(t){return zt(t)&&kr(t.length)&&!!Gt[ie(t)]}function Ya(t){return typeof t=="function"?t:t==null?ce:typeof t=="object"?Ot(t)?ts(t[0],t[1]):Za(t):bu(t)}function Fi(t){if(!$n(t))return ic(t);var e=[];for(var n in Bt(t))Nt.call(t,n)&&n!="constructor"&&e.push(n);return e}function nd(t){if(!kt(t))return Fd(t);var e=$n(t),n=[];for(var h in t)h=="constructor"&&(e||!Nt.call(t,h))||n.push(h);return n}function Gi(t,e){return t<e}function Xa(t,e){var n=-1,h=fe(t)?et(t.length):[];return $e(t,function(M,F,j){h[++n]=e(M,F,j)}),h}function Za(t){var e=to(t);return e.length==1&&e[0][2]?Ls(e[0][0],e[0][1]):function(n){return n===t||Bi(n,t,e)}}function ts(t,e){return no(t)&&xs(e)?Ls(De(t),e):function(n){var h=ho(n,t);return h===v&&h===e?po(n,t):Jn(e,h,a|C)}}function Er(t,e,n,h,M){t!==e&&Li(e,function(F,j){if(M||(M=new Pe),kt(F))rd(t,e,j,n,Er,h,M);else{var J=h?h(io(t,j),F,j+"",t,e,M):v;J===v&&(J=F),wi(t,j,J)}},le)}function rd(t,e,n,h,M,F,j){var J=io(t,n),Y=io(e,n),it=j.get(Y);if(it){wi(t,n,it);return}var ot=F?F(J,Y,n+"",t,e,j):v,at=ot===v;if(at){var lt=Ot(Y),pt=!lt&&tn(Y),bt=!lt&&!pt&&Mn(Y);ot=Y,lt||pt||bt?Ot(J)?ot=J:jt(J)?ot=ue(J):pt?(at=!1,ot=ds(Y,!0)):bt?(at=!1,ot=hs(Y,!0)):ot=[]:Xn(Y)||cn(Y)?(ot=J,cn(J)?ot=fu(J):(!kt(J)||ke(J))&&(ot=ws(Y))):at=!1}at&&(j.set(Y,ot),M(ot,Y,h,F,j),j.delete(Y)),wi(t,n,ot)}function es(t,e){var n=t.length;if(!!n)return e+=e<0?n:0,We(e,n)?t[e]:v}function ns(t,e,n){e.length?e=Wt(e,function(F){return Ot(F)?function(j){return un(j,F.length===1?F[0]:F)}:F}):e=[ce];var h=-1;e=Wt(e,he(mt()));var M=Xa(t,function(F,j,J){var Y=Wt(e,function(it){return it(F)});return{criteria:Y,index:++h,value:F}});return _l(M,function(F,j){return vd(F,j,n)})}function id(t,e){return rs(t,e,function(n,h){return po(t,h)})}function rs(t,e,n){for(var h=-1,M=e.length,F={};++h<M;){var j=e[h],J=un(t,j);n(J,j)&&Qn(F,Xe(j,t),J)}return F}function od(t){return function(e){return un(e,t)}}function Hi(t,e,n,h){var M=h?Ml:bn,F=-1,j=e.length,J=t;for(t===e&&(e=ue(e)),n&&(J=Wt(t,he(n)));++F<j;)for(var Y=0,it=e[F],ot=n?n(it):it;(Y=M(J,ot,Y,h))>-1;)J!==t&&vr.call(J,Y,1),vr.call(t,Y,1);return t}function is(t,e){for(var n=t?e.length:0,h=n-1;n--;){var M=e[n];if(n==h||M!==F){var F=M;We(M)?vr.call(t,M,1):ji(t,M)}}return t}function Wi(t,e){return t+br(Fa()*(e-t+1))}function ad(t,e,n,h){for(var M=-1,F=qt(yr((e-t)/(n||1)),0),j=et(F);F--;)j[h?F:++M]=t,t+=n;return j}function ki(t,e){var n="";if(!t||e<1||e>z)return n;do e%2&&(n+=t),e=br(e/2),e&&(t+=t);while(e);return n}function It(t,e){return oo(Ds(t,e,ce),t+"")}function sd(t){return Wa(_n(t))}function ud(t,e){var n=_n(t);return Ur(n,sn(e,0,n.length))}function Qn(t,e,n,h){if(!kt(t))return t;e=Xe(e,t);for(var M=-1,F=e.length,j=F-1,J=t;J!=null&&++M<F;){var Y=De(e[M]),it=n;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return t;if(M!=j){var ot=J[Y];it=h?h(ot,Y,J):v,it===v&&(it=kt(ot)?ot:We(e[M+1])?[]:{})}jn(J,Y,it),J=J[Y]}return t}var os=Ar?function(t,e){return Ar.set(t,e),t}:ce,fd=mr?function(t,e){return mr(t,"toString",{configurable:!0,enumerable:!1,value:vo(e),writable:!0})}:ce;function ld(t){return Ur(_n(t))}function Se(t,e,n){var h=-1,M=t.length;e<0&&(e=-e>M?0:M+e),n=n>M?M:n,n<0&&(n+=M),M=e>n?0:n-e>>>0,e>>>=0;for(var F=et(M);++h<M;)F[h]=t[h+e];return F}function cd(t,e){var n;return $e(t,function(h,M,F){return n=e(h,M,F),!n}),!!n}function Ir(t,e,n){var h=0,M=t==null?h:t.length;if(typeof e=="number"&&e===e&&M<=G){for(;h<M;){var F=h+M>>>1,j=t[F];j!==null&&!ge(j)&&(n?j<=e:j<e)?h=F+1:M=F}return M}return zi(t,e,ce,n)}function zi(t,e,n,h){var M=0,F=t==null?0:t.length;if(F===0)return 0;e=n(e);for(var j=e!==e,J=e===null,Y=ge(e),it=e===v;M<F;){var ot=br((M+F)/2),at=n(t[ot]),lt=at!==v,pt=at===null,bt=at===at,Et=ge(at);if(j)var At=h||bt;else it?At=bt&&(h||lt):J?At=bt&&lt&&(h||!pt):Y?At=bt&&lt&&!pt&&(h||!Et):pt||Et?At=!1:At=h?at<=e:at<e;At?M=ot+1:F=ot}return ee(F,$)}function as(t,e){for(var n=-1,h=t.length,M=0,F=[];++n<h;){var j=t[n],J=e?e(j):j;if(!n||!Me(J,Y)){var Y=J;F[M++]=j===0?0:j}}return F}function ss(t){return typeof t=="number"?t:ge(t)?Q:+t}function pe(t){if(typeof t=="string")return t;if(Ot(t))return Wt(t,pe)+"";if(ge(t))return Ga?Ga.call(t):"";var e=t+"";return e=="0"&&1/t==-x?"-0":e}function Ye(t,e,n){var h=-1,M=ar,F=t.length,j=!0,J=[],Y=J;if(n)j=!1,M=yi;else if(F>=r){var it=e?null:Od(t);if(it)return ur(it);j=!1,M=Fn,Y=new an}else Y=e?[]:J;t:for(;++h<F;){var ot=t[h],at=e?e(ot):ot;if(ot=n||ot!==0?ot:0,j&&at===at){for(var lt=Y.length;lt--;)if(Y[lt]===at)continue t;e&&Y.push(at),J.push(ot)}else M(Y,at,n)||(Y!==J&&Y.push(at),J.push(ot))}return J}function ji(t,e){return e=Xe(e,t),t=Ns(t,e),t==null||delete t[De(Te(e))]}function us(t,e,n,h){return Qn(t,e,n(un(t,e)),h)}function Pr(t,e,n,h){for(var M=t.length,F=h?M:-1;(h?F--:++F<M)&&e(t[F],F,t););return n?Se(t,h?0:F,h?F+1:M):Se(t,h?F+1:0,h?M:F)}function fs(t,e){var n=t;return n instanceof Mt&&(n=n.value()),bi(e,function(h,M){return M.func.apply(M.thisArg,Ke([h],M.args))},n)}function Vi(t,e,n){var h=t.length;if(h<2)return h?Ye(t[0]):[];for(var M=-1,F=et(h);++M<h;)for(var j=t[M],J=-1;++J<h;)J!=M&&(F[M]=Vn(F[M]||j,t[J],e,n));return Ye(te(F,1),e,n)}function ls(t,e,n){for(var h=-1,M=t.length,F=e.length,j={};++h<M;){var J=h<F?e[h]:v;n(j,t[h],J)}return j}function Ki(t){return jt(t)?t:[]}function Ji(t){return typeof t=="function"?t:ce}function Xe(t,e){return Ot(t)?t:no(t,e)?[t]:Gs(Dt(t))}var dd=It;function Ze(t,e,n){var h=t.length;return n=n===v?h:n,!e&&n>=h?t:Se(t,e,n)}var cs=Zl||function(t){return Yt.clearTimeout(t)};function ds(t,e){if(e)return t.slice();var n=t.length,h=La?La(n):new t.constructor(n);return t.copy(h),h}function Qi(t){var e=new t.constructor(t.byteLength);return new pr(e).set(new pr(t)),e}function hd(t,e){var n=e?Qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function pd(t){var e=new t.constructor(t.source,qo.exec(t));return e.lastIndex=t.lastIndex,e}function gd(t){return zn?Bt(zn.call(t)):{}}function hs(t,e){var n=e?Qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ps(t,e){if(t!==e){var n=t!==v,h=t===null,M=t===t,F=ge(t),j=e!==v,J=e===null,Y=e===e,it=ge(e);if(!J&&!it&&!F&&t>e||F&&j&&Y&&!J&&!it||h&&j&&Y||!n&&Y||!M)return 1;if(!h&&!F&&!it&&t<e||it&&n&&M&&!h&&!F||J&&n&&M||!j&&M||!Y)return-1}return 0}function vd(t,e,n){for(var h=-1,M=t.criteria,F=e.criteria,j=M.length,J=n.length;++h<j;){var Y=ps(M[h],F[h]);if(Y){if(h>=J)return Y;var it=n[h];return Y*(it=="desc"?-1:1)}}return t.index-e.index}function gs(t,e,n,h){for(var M=-1,F=t.length,j=n.length,J=-1,Y=e.length,it=qt(F-j,0),ot=et(Y+it),at=!h;++J<Y;)ot[J]=e[J];for(;++M<j;)(at||M<F)&&(ot[n[M]]=t[M]);for(;it--;)ot[J++]=t[M++];return ot}function vs(t,e,n,h){for(var M=-1,F=t.length,j=-1,J=n.length,Y=-1,it=e.length,ot=qt(F-J,0),at=et(ot+it),lt=!h;++M<ot;)at[M]=t[M];for(var pt=M;++Y<it;)at[pt+Y]=e[Y];for(;++j<J;)(lt||M<F)&&(at[pt+n[j]]=t[M++]);return at}function ue(t,e){var n=-1,h=t.length;for(e||(e=et(h));++n<h;)e[n]=t[n];return e}function Le(t,e,n,h){var M=!n;n||(n={});for(var F=-1,j=e.length;++F<j;){var J=e[F],Y=h?h(n[J],t[J],J,n,t):v;Y===v&&(Y=t[J]),M?Fe(n,J,Y):jn(n,J,Y)}return n}function md(t,e){return Le(t,eo(t),e)}function yd(t,e){return Le(t,Ms(t),e)}function Mr(t,e){return function(n,h){var M=Ot(n)?Rl:Hc,F=e?e():{};return M(n,t,mt(h,2),F)}}function En(t){return It(function(e,n){var h=-1,M=n.length,F=M>1?n[M-1]:v,j=M>2?n[2]:v;for(F=t.length>3&&typeof F=="function"?(M--,F):v,j&&oe(n[0],n[1],j)&&(F=M<3?v:F,M=1),e=Bt(e);++h<M;){var J=n[h];J&&t(e,J,h,F)}return e})}function ms(t,e){return function(n,h){if(n==null)return n;if(!fe(n))return t(n,h);for(var M=n.length,F=e?M:-1,j=Bt(n);(e?F--:++F<M)&&h(j[F],F,j)!==!1;);return n}}function ys(t){return function(e,n,h){for(var M=-1,F=Bt(e),j=h(e),J=j.length;J--;){var Y=j[t?J:++M];if(n(F[Y],Y,F)===!1)break}return e}}function bd(t,e,n){var h=e&w,M=qn(t);function F(){var j=this&&this!==Yt&&this instanceof F?M:t;return j.apply(h?n:this,arguments)}return F}function bs(t){return function(e){e=Dt(e);var n=An(e)?Ie(e):v,h=n?n[0]:e.charAt(0),M=n?Ze(n,1).join(""):e.slice(1);return h[t]()+M}}function In(t){return function(e){return bi(mu(vu(e).replace(fl,"")),t,"")}}function qn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Tn(t.prototype),h=t.apply(n,e);return kt(h)?h:n}}function Ad(t,e,n){var h=qn(t);function M(){for(var F=arguments.length,j=et(F),J=F,Y=Pn(M);J--;)j[J]=arguments[J];var it=F<3&&j[0]!==Y&&j[F-1]!==Y?[]:Je(j,Y);if(F-=it.length,F<n)return Ss(t,e,_r,M.placeholder,v,j,it,v,v,n-F);var ot=this&&this!==Yt&&this instanceof M?h:t;return de(ot,this,j)}return M}function As(t){return function(e,n,h){var M=Bt(e);if(!fe(e)){var F=mt(n,3);e=Xt(e),n=function(J){return F(M[J],J,M)}}var j=t(e,n,h);return j>-1?M[F?e[j]:j]:v}}function Cs(t){return He(function(e){var n=e.length,h=n,M=Oe.prototype.thru;for(t&&e.reverse();h--;){var F=e[h];if(typeof F!="function")throw new Ce(i);if(M&&!j&&Dr(F)=="wrapper")var j=new Oe([],!0)}for(h=j?h:n;++h<n;){F=e[h];var J=Dr(F),Y=J=="wrapper"?Zi(F):v;Y&&ro(Y[0])&&Y[1]==(f|m|o|l)&&!Y[4].length&&Y[9]==1?j=j[Dr(Y[0])].apply(j,Y[3]):j=F.length==1&&ro(F)?j[J]():j.thru(F)}return function(){var it=arguments,ot=it[0];if(j&&it.length==1&&Ot(ot))return j.plant(ot).value();for(var at=0,lt=n?e[at].apply(this,it):ot;++at<n;)lt=e[at].call(this,lt);return lt}})}function _r(t,e,n,h,M,F,j,J,Y,it){var ot=e&f,at=e&w,lt=e&_,pt=e&(m|S),bt=e&s,Et=lt?v:qn(t);function At(){for(var Pt=arguments.length,_t=et(Pt),ve=Pt;ve--;)_t[ve]=arguments[ve];if(pt)var ae=Pn(At),me=xl(_t,ae);if(h&&(_t=gs(_t,h,M,pt)),F&&(_t=vs(_t,F,j,pt)),Pt-=me,pt&&Pt<it){var Vt=Je(_t,ae);return Ss(t,e,_r,At.placeholder,n,_t,Vt,J,Y,it-Pt)}var _e=at?n:this,je=lt?_e[t]:t;return Pt=_t.length,J?_t=Hd(_t,J):bt&&Pt>1&&_t.reverse(),ot&&Y<Pt&&(_t.length=Y),this&&this!==Yt&&this instanceof At&&(je=Et||qn(je)),je.apply(_e,_t)}return At}function Os(t,e){return function(n,h){return Qc(n,t,e(h),{})}}function wr(t,e){return function(n,h){var M;if(n===v&&h===v)return e;if(n!==v&&(M=n),h!==v){if(M===v)return h;typeof n=="string"||typeof h=="string"?(n=pe(n),h=pe(h)):(n=ss(n),h=ss(h)),M=t(n,h)}return M}}function qi(t){return He(function(e){return e=Wt(e,he(mt())),It(function(n){var h=this;return t(e,function(M){return de(M,h,n)})})})}function xr(t,e){e=e===v?" ":pe(e);var n=e.length;if(n<2)return n?ki(e,t):e;var h=ki(e,yr(t/Cn(e)));return An(e)?Ze(Ie(h),0,t).join(""):h.slice(0,t)}function Cd(t,e,n,h){var M=e&w,F=qn(t);function j(){for(var J=-1,Y=arguments.length,it=-1,ot=h.length,at=et(ot+Y),lt=this&&this!==Yt&&this instanceof j?F:t;++it<ot;)at[it]=h[it];for(;Y--;)at[it++]=arguments[++J];return de(lt,M?n:this,at)}return j}function Rs(t){return function(e,n,h){return h&&typeof h!="number"&&oe(e,n,h)&&(n=h=v),e=ze(e),n===v?(n=e,e=0):n=ze(n),h=h===v?e<n?1:-1:ze(h),ad(e,n,h,t)}}function Lr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Ee(e),n=Ee(n)),t(e,n)}}function Ss(t,e,n,h,M,F,j,J,Y,it){var ot=e&m,at=ot?j:v,lt=ot?v:j,pt=ot?F:v,bt=ot?v:F;e|=ot?o:g,e&=~(ot?g:o),e&b||(e&=~(w|_));var Et=[t,e,M,pt,at,bt,lt,J,Y,it],At=n.apply(v,Et);return ro(t)&&Us(At,Et),At.placeholder=h,Bs(At,t,e)}function $i(t){var e=Qt[t];return function(n,h){if(n=Ee(n),h=h==null?0:ee(St(h),292),h&&Ba(n)){var M=(Dt(n)+"e").split("e"),F=e(M[0]+"e"+(+M[1]+h));return M=(Dt(F)+"e").split("e"),+(M[0]+"e"+(+M[1]-h))}return e(n)}}var Od=Rn&&1/ur(new Rn([,-0]))[1]==x?function(t){return new Rn(t)}:bo;function Ts(t){return function(e){var n=ne(e);return n==ct?Ei(e):n==rt?Gl(e):wl(e,t(e))}}function Ge(t,e,n,h,M,F,j,J){var Y=e&_;if(!Y&&typeof t!="function")throw new Ce(i);var it=h?h.length:0;if(it||(e&=~(o|g),h=M=v),j=j===v?j:qt(St(j),0),J=J===v?J:St(J),it-=M?M.length:0,e&g){var ot=h,at=M;h=M=v}var lt=Y?v:Zi(t),pt=[t,e,n,h,M,ot,at,F,j,J];if(lt&&Bd(pt,lt),t=pt[0],e=pt[1],n=pt[2],h=pt[3],M=pt[4],J=pt[9]=pt[9]===v?Y?0:t.length:qt(pt[9]-it,0),!J&&e&(m|S)&&(e&=~(m|S)),!e||e==w)var bt=bd(t,e,n);else e==m||e==S?bt=Ad(t,e,J):(e==o||e==(w|o))&&!M.length?bt=Cd(t,e,n,h):bt=_r.apply(v,pt);var Et=lt?os:Us;return Bs(Et(bt,pt),t,e)}function Es(t,e,n,h){return t===v||Me(t,On[n])&&!Nt.call(h,n)?e:t}function Is(t,e,n,h,M,F){return kt(t)&&kt(e)&&(F.set(e,t),Er(t,e,v,Is,F),F.delete(e)),t}function Rd(t){return Xn(t)?v:t}function Ps(t,e,n,h,M,F){var j=n&a,J=t.length,Y=e.length;if(J!=Y&&!(j&&Y>J))return!1;var it=F.get(t),ot=F.get(e);if(it&&ot)return it==e&&ot==t;var at=-1,lt=!0,pt=n&C?new an:v;for(F.set(t,e),F.set(e,t);++at<J;){var bt=t[at],Et=e[at];if(h)var At=j?h(Et,bt,at,e,t,F):h(bt,Et,at,t,e,F);if(At!==v){if(At)continue;lt=!1;break}if(pt){if(!Ai(e,function(Pt,_t){if(!Fn(pt,_t)&&(bt===Pt||M(bt,Pt,n,h,F)))return pt.push(_t)})){lt=!1;break}}else if(!(bt===Et||M(bt,Et,n,h,F))){lt=!1;break}}return F.delete(t),F.delete(e),lt}function Sd(t,e,n,h,M,F,j){switch(n){case mn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Bn:return!(t.byteLength!=e.byteLength||!F(new pr(t),new pr(e)));case tt:case ft:case wt:return Me(+t,+e);case gt:return t.name==e.name&&t.message==e.message;case X:case ut:return t==e+"";case ct:var J=Ei;case rt:var Y=h&a;if(J||(J=ur),t.size!=e.size&&!Y)return!1;var it=j.get(t);if(it)return it==e;h|=C,j.set(t,e);var ot=Ps(J(t),J(e),h,M,F,j);return j.delete(t),ot;case ht:if(zn)return zn.call(t)==zn.call(e)}return!1}function Td(t,e,n,h,M,F){var j=n&a,J=Yi(t),Y=J.length,it=Yi(e),ot=it.length;if(Y!=ot&&!j)return!1;for(var at=Y;at--;){var lt=J[at];if(!(j?lt in e:Nt.call(e,lt)))return!1}var pt=F.get(t),bt=F.get(e);if(pt&&bt)return pt==e&&bt==t;var Et=!0;F.set(t,e),F.set(e,t);for(var At=j;++at<Y;){lt=J[at];var Pt=t[lt],_t=e[lt];if(h)var ve=j?h(_t,Pt,lt,e,t,F):h(Pt,_t,lt,t,e,F);if(!(ve===v?Pt===_t||M(Pt,_t,n,h,F):ve)){Et=!1;break}At||(At=lt=="constructor")}if(Et&&!At){var ae=t.constructor,me=e.constructor;ae!=me&&"constructor"in t&&"constructor"in e&&!(typeof ae=="function"&&ae instanceof ae&&typeof me=="function"&&me instanceof me)&&(Et=!1)}return F.delete(t),F.delete(e),Et}function He(t){return oo(Ds(t,v,zs),t+"")}function Yi(t){return Qa(t,Xt,eo)}function Xi(t){return Qa(t,le,Ms)}var Zi=Ar?function(t){return Ar.get(t)}:bo;function Dr(t){for(var e=t.name+"",n=Sn[e],h=Nt.call(Sn,e)?n.length:0;h--;){var M=n[h],F=M.func;if(F==null||F==t)return M.name}return e}function Pn(t){var e=Nt.call(L,"placeholder")?L:t;return e.placeholder}function mt(){var t=L.iteratee||mo;return t=t===mo?Ya:t,arguments.length?t(arguments[0],arguments[1]):t}function Nr(t,e){var n=t.__data__;return Ld(e)?n[typeof e=="string"?"string":"hash"]:n.map}function to(t){for(var e=Xt(t),n=e.length;n--;){var h=e[n],M=t[h];e[n]=[h,M,xs(M)]}return e}function fn(t,e){var n=Ul(t,e);return $a(n)?n:v}function Ed(t){var e=Nt.call(t,rn),n=t[rn];try{t[rn]=v;var h=!0}catch(F){}var M=dr.call(t);return h&&(e?t[rn]=n:delete t[rn]),M}var eo=Pi?function(t){return t==null?[]:(t=Bt(t),Ve(Pi(t),function(e){return Na.call(t,e)}))}:Ao,Ms=Pi?function(t){for(var e=[];t;)Ke(e,eo(t)),t=gr(t);return e}:Ao,ne=ie;(Mi&&ne(new Mi(new ArrayBuffer(1)))!=mn||Hn&&ne(new Hn)!=ct||_i&&ne(_i.resolve())!=Ht||Rn&&ne(new Rn)!=rt||Wn&&ne(new Wn)!=Jt)&&(ne=function(t){var e=ie(t),n=e==Ut?t.constructor:v,h=n?ln(n):"";if(h)switch(h){case uc:return mn;case fc:return ct;case lc:return Ht;case cc:return rt;case dc:return Jt}return e});function Id(t,e,n){for(var h=-1,M=n.length;++h<M;){var F=n[h],j=F.size;switch(F.type){case"drop":t+=j;break;case"dropRight":e-=j;break;case"take":e=ee(e,t+j);break;case"takeRight":t=qt(t,e-j);break}}return{start:t,end:e}}function Pd(t){var e=t.match(Df);return e?e[1].split(Nf):[]}function _s(t,e,n){e=Xe(e,t);for(var h=-1,M=e.length,F=!1;++h<M;){var j=De(e[h]);if(!(F=t!=null&&n(t,j)))break;t=t[j]}return F||++h!=M?F:(M=t==null?0:t.length,!!M&&kr(M)&&We(j,M)&&(Ot(t)||cn(t)))}function Md(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Nt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function ws(t){return typeof t.constructor=="function"&&!$n(t)?Tn(gr(t)):{}}function _d(t,e,n){var h=t.constructor;switch(e){case Bn:return Qi(t);case tt:case ft:return new h(+t);case mn:return hd(t,n);case ti:case ei:case ni:case ri:case ii:case oi:case ai:case si:case ui:return hs(t,n);case ct:return new h;case wt:case ut:return new h(t);case X:return pd(t);case rt:return new h;case ht:return gd(t)}}function wd(t,e){var n=e.length;if(!n)return t;var h=n-1;return e[h]=(n>1?"& ":"")+e[h],e=e.join(n>2?", ":" "),t.replace(Lf,`{
/* [wrapped with `+e+`] */
`)}function xd(t){return Ot(t)||cn(t)||!!(Ua&&t&&t[Ua])}function We(t,e){var n=typeof t;return e=e==null?z:e,!!e&&(n=="number"||n!="symbol"&&jf.test(t))&&t>-1&&t%1==0&&t<e}function oe(t,e,n){if(!kt(n))return!1;var h=typeof e;return(h=="number"?fe(n)&&We(e,n.length):h=="string"&&e in n)?Me(n[e],t):!1}function no(t,e){if(Ot(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ge(t)?!0:Mf.test(t)||!Pf.test(t)||e!=null&&t in Bt(e)}function Ld(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ro(t){var e=Dr(t),n=L[e];if(typeof n!="function"||!(e in Mt.prototype))return!1;if(t===n)return!0;var h=Zi(n);return!!h&&t===h[0]}function Dd(t){return!!xa&&xa in t}var Nd=lr?ke:Co;function $n(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||On;return t===n}function xs(t){return t===t&&!kt(t)}function Ls(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==v||t in Bt(n))}}function Ud(t){var e=Hr(t,function(h){return n.size===u&&n.clear(),h}),n=e.cache;return e}function Bd(t,e){var n=t[1],h=e[1],M=n|h,F=M<(w|_|f),j=h==f&&n==m||h==f&&n==l&&t[7].length<=e[8]||h==(f|l)&&e[7].length<=e[8]&&n==m;if(!(F||j))return t;h&w&&(t[2]=e[2],M|=n&w?0:b);var J=e[3];if(J){var Y=t[3];t[3]=Y?gs(Y,J,e[4]):J,t[4]=Y?Je(t[3],d):e[4]}return J=e[5],J&&(Y=t[5],t[5]=Y?vs(Y,J,e[6]):J,t[6]=Y?Je(t[5],d):e[6]),J=e[7],J&&(t[7]=J),h&f&&(t[8]=t[8]==null?e[8]:ee(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=M,t}function Fd(t){var e=[];if(t!=null)for(var n in Bt(t))e.push(n);return e}function Gd(t){return dr.call(t)}function Ds(t,e,n){return e=qt(e===v?t.length-1:e,0),function(){for(var h=arguments,M=-1,F=qt(h.length-e,0),j=et(F);++M<F;)j[M]=h[e+M];M=-1;for(var J=et(e+1);++M<e;)J[M]=h[M];return J[e]=n(j),de(t,this,J)}}function Ns(t,e){return e.length<2?t:un(t,Se(e,0,-1))}function Hd(t,e){for(var n=t.length,h=ee(e.length,n),M=ue(t);h--;){var F=e[h];t[h]=We(F,n)?M[F]:v}return t}function io(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Us=Fs(os),Yn=ec||function(t,e){return Yt.setTimeout(t,e)},oo=Fs(fd);function Bs(t,e,n){var h=e+"";return oo(t,wd(h,Wd(Pd(h),n)))}function Fs(t){var e=0,n=0;return function(){var h=oc(),M=k-(h-n);if(n=h,M>0){if(++e>=D)return arguments[0]}else e=0;return t.apply(v,arguments)}}function Ur(t,e){var n=-1,h=t.length,M=h-1;for(e=e===v?h:e;++n<e;){var F=Wi(n,M),j=t[F];t[F]=t[n],t[n]=j}return t.length=e,t}var Gs=Ud(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(_f,function(n,h,M,F){e.push(M?F.replace(Ff,"$1"):h||n)}),e});function De(t){if(typeof t=="string"||ge(t))return t;var e=t+"";return e=="0"&&1/t==-x?"-0":e}function ln(t){if(t!=null){try{return cr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Wd(t,e){return Ae(N,function(n){var h="_."+n[0];e&n[1]&&!ar(t,h)&&t.push(h)}),t.sort()}function Hs(t){if(t instanceof Mt)return t.clone();var e=new Oe(t.__wrapped__,t.__chain__);return e.__actions__=ue(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function kd(t,e,n){(n?oe(t,e,n):e===v)?e=1:e=qt(St(e),0);var h=t==null?0:t.length;if(!h||e<1)return[];for(var M=0,F=0,j=et(yr(h/e));M<h;)j[F++]=Se(t,M,M+=e);return j}function zd(t){for(var e=-1,n=t==null?0:t.length,h=0,M=[];++e<n;){var F=t[e];F&&(M[h++]=F)}return M}function jd(){var t=arguments.length;if(!t)return[];for(var e=et(t-1),n=arguments[0],h=t;h--;)e[h-1]=arguments[h];return Ke(Ot(n)?ue(n):[n],te(e,1))}var Vd=It(function(t,e){return jt(t)?Vn(t,te(e,1,jt,!0)):[]}),Kd=It(function(t,e){var n=Te(e);return jt(n)&&(n=v),jt(t)?Vn(t,te(e,1,jt,!0),mt(n,2)):[]}),Jd=It(function(t,e){var n=Te(e);return jt(n)&&(n=v),jt(t)?Vn(t,te(e,1,jt,!0),v,n):[]});function Qd(t,e,n){var h=t==null?0:t.length;return h?(e=n||e===v?1:St(e),Se(t,e<0?0:e,h)):[]}function qd(t,e,n){var h=t==null?0:t.length;return h?(e=n||e===v?1:St(e),e=h-e,Se(t,0,e<0?0:e)):[]}function $d(t,e){return t&&t.length?Pr(t,mt(e,3),!0,!0):[]}function Yd(t,e){return t&&t.length?Pr(t,mt(e,3),!0):[]}function Xd(t,e,n,h){var M=t==null?0:t.length;return M?(n&&typeof n!="number"&&oe(t,e,n)&&(n=0,h=M),jc(t,e,n,h)):[]}function Ws(t,e,n){var h=t==null?0:t.length;if(!h)return-1;var M=n==null?0:St(n);return M<0&&(M=qt(h+M,0)),sr(t,mt(e,3),M)}function ks(t,e,n){var h=t==null?0:t.length;if(!h)return-1;var M=h-1;return n!==v&&(M=St(n),M=n<0?qt(h+M,0):ee(M,h-1)),sr(t,mt(e,3),M,!0)}function zs(t){var e=t==null?0:t.length;return e?te(t,1):[]}function Zd(t){var e=t==null?0:t.length;return e?te(t,x):[]}function th(t,e){var n=t==null?0:t.length;return n?(e=e===v?1:St(e),te(t,e)):[]}function eh(t){for(var e=-1,n=t==null?0:t.length,h={};++e<n;){var M=t[e];h[M[0]]=M[1]}return h}function js(t){return t&&t.length?t[0]:v}function nh(t,e,n){var h=t==null?0:t.length;if(!h)return-1;var M=n==null?0:St(n);return M<0&&(M=qt(h+M,0)),bn(t,e,M)}function rh(t){var e=t==null?0:t.length;return e?Se(t,0,-1):[]}var ih=It(function(t){var e=Wt(t,Ki);return e.length&&e[0]===t[0]?Ui(e):[]}),oh=It(function(t){var e=Te(t),n=Wt(t,Ki);return e===Te(n)?e=v:n.pop(),n.length&&n[0]===t[0]?Ui(n,mt(e,2)):[]}),ah=It(function(t){var e=Te(t),n=Wt(t,Ki);return e=typeof e=="function"?e:v,e&&n.pop(),n.length&&n[0]===t[0]?Ui(n,v,e):[]});function sh(t,e){return t==null?"":rc.call(t,e)}function Te(t){var e=t==null?0:t.length;return e?t[e-1]:v}function uh(t,e,n){var h=t==null?0:t.length;if(!h)return-1;var M=h;return n!==v&&(M=St(n),M=M<0?qt(h+M,0):ee(M,h-1)),e===e?Wl(t,e,M):sr(t,Sa,M,!0)}function fh(t,e){return t&&t.length?es(t,St(e)):v}var lh=It(Vs);function Vs(t,e){return t&&t.length&&e&&e.length?Hi(t,e):t}function ch(t,e,n){return t&&t.length&&e&&e.length?Hi(t,e,mt(n,2)):t}function dh(t,e,n){return t&&t.length&&e&&e.length?Hi(t,e,v,n):t}var hh=He(function(t,e){var n=t==null?0:t.length,h=xi(t,e);return is(t,Wt(e,function(M){return We(M,n)?+M:M}).sort(ps)),h});function ph(t,e){var n=[];if(!(t&&t.length))return n;var h=-1,M=[],F=t.length;for(e=mt(e,3);++h<F;){var j=t[h];e(j,h,t)&&(n.push(j),M.push(h))}return is(t,M),n}function ao(t){return t==null?t:sc.call(t)}function gh(t,e,n){var h=t==null?0:t.length;return h?(n&&typeof n!="number"&&oe(t,e,n)?(e=0,n=h):(e=e==null?0:St(e),n=n===v?h:St(n)),Se(t,e,n)):[]}function vh(t,e){return Ir(t,e)}function mh(t,e,n){return zi(t,e,mt(n,2))}function yh(t,e){var n=t==null?0:t.length;if(n){var h=Ir(t,e);if(h<n&&Me(t[h],e))return h}return-1}function bh(t,e){return Ir(t,e,!0)}function Ah(t,e,n){return zi(t,e,mt(n,2),!0)}function Ch(t,e){var n=t==null?0:t.length;if(n){var h=Ir(t,e,!0)-1;if(Me(t[h],e))return h}return-1}function Oh(t){return t&&t.length?as(t):[]}function Rh(t,e){return t&&t.length?as(t,mt(e,2)):[]}function Sh(t){var e=t==null?0:t.length;return e?Se(t,1,e):[]}function Th(t,e,n){return t&&t.length?(e=n||e===v?1:St(e),Se(t,0,e<0?0:e)):[]}function Eh(t,e,n){var h=t==null?0:t.length;return h?(e=n||e===v?1:St(e),e=h-e,Se(t,e<0?0:e,h)):[]}function Ih(t,e){return t&&t.length?Pr(t,mt(e,3),!1,!0):[]}function Ph(t,e){return t&&t.length?Pr(t,mt(e,3)):[]}var Mh=It(function(t){return Ye(te(t,1,jt,!0))}),_h=It(function(t){var e=Te(t);return jt(e)&&(e=v),Ye(te(t,1,jt,!0),mt(e,2))}),wh=It(function(t){var e=Te(t);return e=typeof e=="function"?e:v,Ye(te(t,1,jt,!0),v,e)});function xh(t){return t&&t.length?Ye(t):[]}function Lh(t,e){return t&&t.length?Ye(t,mt(e,2)):[]}function Dh(t,e){return e=typeof e=="function"?e:v,t&&t.length?Ye(t,v,e):[]}function so(t){if(!(t&&t.length))return[];var e=0;return t=Ve(t,function(n){if(jt(n))return e=qt(n.length,e),!0}),Si(e,function(n){return Wt(t,Ci(n))})}function Ks(t,e){if(!(t&&t.length))return[];var n=so(t);return e==null?n:Wt(n,function(h){return de(e,v,h)})}var Nh=It(function(t,e){return jt(t)?Vn(t,e):[]}),Uh=It(function(t){return Vi(Ve(t,jt))}),Bh=It(function(t){var e=Te(t);return jt(e)&&(e=v),Vi(Ve(t,jt),mt(e,2))}),Fh=It(function(t){var e=Te(t);return e=typeof e=="function"?e:v,Vi(Ve(t,jt),v,e)}),Gh=It(so);function Hh(t,e){return ls(t||[],e||[],jn)}function Wh(t,e){return ls(t||[],e||[],Qn)}var kh=It(function(t){var e=t.length,n=e>1?t[e-1]:v;return n=typeof n=="function"?(t.pop(),n):v,Ks(t,n)});function Js(t){var e=L(t);return e.__chain__=!0,e}function zh(t,e){return e(t),t}function Br(t,e){return e(t)}var jh=He(function(t){var e=t.length,n=e?t[0]:0,h=this.__wrapped__,M=function(F){return xi(F,t)};return e>1||this.__actions__.length||!(h instanceof Mt)||!We(n)?this.thru(M):(h=h.slice(n,+n+(e?1:0)),h.__actions__.push({func:Br,args:[M],thisArg:v}),new Oe(h,this.__chain__).thru(function(F){return e&&!F.length&&F.push(v),F}))});function Vh(){return Js(this)}function Kh(){return new Oe(this.value(),this.__chain__)}function Jh(){this.__values__===v&&(this.__values__=su(this.value()));var t=this.__index__>=this.__values__.length,e=t?v:this.__values__[this.__index__++];return{done:t,value:e}}function Qh(){return this}function qh(t){for(var e,n=this;n instanceof Or;){var h=Hs(n);h.__index__=0,h.__values__=v,e?M.__wrapped__=h:e=h;var M=h;n=n.__wrapped__}return M.__wrapped__=t,e}function $h(){var t=this.__wrapped__;if(t instanceof Mt){var e=t;return this.__actions__.length&&(e=new Mt(this)),e=e.reverse(),e.__actions__.push({func:Br,args:[ao],thisArg:v}),new Oe(e,this.__chain__)}return this.thru(ao)}function Yh(){return fs(this.__wrapped__,this.__actions__)}var Xh=Mr(function(t,e,n){Nt.call(t,n)?++t[n]:Fe(t,n,1)});function Zh(t,e,n){var h=Ot(t)?Oa:zc;return n&&oe(t,e,n)&&(e=v),h(t,mt(e,3))}function tp(t,e){var n=Ot(t)?Ve:Ka;return n(t,mt(e,3))}var ep=As(Ws),np=As(ks);function rp(t,e){return te(Fr(t,e),1)}function ip(t,e){return te(Fr(t,e),x)}function op(t,e,n){return n=n===v?1:St(n),te(Fr(t,e),n)}function Qs(t,e){var n=Ot(t)?Ae:$e;return n(t,mt(e,3))}function qs(t,e){var n=Ot(t)?Sl:Va;return n(t,mt(e,3))}var ap=Mr(function(t,e,n){Nt.call(t,n)?t[n].push(e):Fe(t,n,[e])});function sp(t,e,n,h){t=fe(t)?t:_n(t),n=n&&!h?St(n):0;var M=t.length;return n<0&&(n=qt(M+n,0)),zr(t)?n<=M&&t.indexOf(e,n)>-1:!!M&&bn(t,e,n)>-1}var up=It(function(t,e,n){var h=-1,M=typeof e=="function",F=fe(t)?et(t.length):[];return $e(t,function(j){F[++h]=M?de(e,j,n):Kn(j,e,n)}),F}),fp=Mr(function(t,e,n){Fe(t,n,e)});function Fr(t,e){var n=Ot(t)?Wt:Xa;return n(t,mt(e,3))}function lp(t,e,n,h){return t==null?[]:(Ot(e)||(e=e==null?[]:[e]),n=h?v:n,Ot(n)||(n=n==null?[]:[n]),ns(t,e,n))}var cp=Mr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function dp(t,e,n){var h=Ot(t)?bi:Ea,M=arguments.length<3;return h(t,mt(e,4),n,M,$e)}function hp(t,e,n){var h=Ot(t)?Tl:Ea,M=arguments.length<3;return h(t,mt(e,4),n,M,Va)}function pp(t,e){var n=Ot(t)?Ve:Ka;return n(t,Wr(mt(e,3)))}function gp(t){var e=Ot(t)?Wa:sd;return e(t)}function vp(t,e,n){(n?oe(t,e,n):e===v)?e=1:e=St(e);var h=Ot(t)?Fc:ud;return h(t,e)}function mp(t){var e=Ot(t)?Gc:ld;return e(t)}function yp(t){if(t==null)return 0;if(fe(t))return zr(t)?Cn(t):t.length;var e=ne(t);return e==ct||e==rt?t.size:Fi(t).length}function bp(t,e,n){var h=Ot(t)?Ai:cd;return n&&oe(t,e,n)&&(e=v),h(t,mt(e,3))}var Ap=It(function(t,e){if(t==null)return[];var n=e.length;return n>1&&oe(t,e[0],e[1])?e=[]:n>2&&oe(e[0],e[1],e[2])&&(e=[e[0]]),ns(t,te(e,1),[])}),Gr=tc||function(){return Yt.Date.now()};function Cp(t,e){if(typeof e!="function")throw new Ce(i);return t=St(t),function(){if(--t<1)return e.apply(this,arguments)}}function $s(t,e,n){return e=n?v:e,e=t&&e==null?t.length:e,Ge(t,f,v,v,v,v,e)}function Ys(t,e){var n;if(typeof e!="function")throw new Ce(i);return t=St(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=v),n}}var uo=It(function(t,e,n){var h=w;if(n.length){var M=Je(n,Pn(uo));h|=o}return Ge(t,h,e,n,M)}),Xs=It(function(t,e,n){var h=w|_;if(n.length){var M=Je(n,Pn(Xs));h|=o}return Ge(e,h,t,n,M)});function Zs(t,e,n){e=n?v:e;var h=Ge(t,m,v,v,v,v,v,e);return h.placeholder=Zs.placeholder,h}function tu(t,e,n){e=n?v:e;var h=Ge(t,S,v,v,v,v,v,e);return h.placeholder=tu.placeholder,h}function eu(t,e,n){var h,M,F,j,J,Y,it=0,ot=!1,at=!1,lt=!0;if(typeof t!="function")throw new Ce(i);e=Ee(e)||0,kt(n)&&(ot=!!n.leading,at="maxWait"in n,F=at?qt(Ee(n.maxWait)||0,e):F,lt="trailing"in n?!!n.trailing:lt);function pt(Vt){var _e=h,je=M;return h=M=v,it=Vt,j=t.apply(je,_e),j}function bt(Vt){return it=Vt,J=Yn(Pt,e),ot?pt(Vt):j}function Et(Vt){var _e=Vt-Y,je=Vt-it,Au=e-_e;return at?ee(Au,F-je):Au}function At(Vt){var _e=Vt-Y,je=Vt-it;return Y===v||_e>=e||_e<0||at&&je>=F}function Pt(){var Vt=Gr();if(At(Vt))return _t(Vt);J=Yn(Pt,Et(Vt))}function _t(Vt){return J=v,lt&&h?pt(Vt):(h=M=v,j)}function ve(){J!==v&&cs(J),it=0,h=Y=M=J=v}function ae(){return J===v?j:_t(Gr())}function me(){var Vt=Gr(),_e=At(Vt);if(h=arguments,M=this,Y=Vt,_e){if(J===v)return bt(Y);if(at)return cs(J),J=Yn(Pt,e),pt(Y)}return J===v&&(J=Yn(Pt,e)),j}return me.cancel=ve,me.flush=ae,me}var Op=It(function(t,e){return ja(t,1,e)}),Rp=It(function(t,e,n){return ja(t,Ee(e)||0,n)});function Sp(t){return Ge(t,s)}function Hr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Ce(i);var n=function(){var h=arguments,M=e?e.apply(this,h):h[0],F=n.cache;if(F.has(M))return F.get(M);var j=t.apply(this,h);return n.cache=F.set(M,j)||F,j};return n.cache=new(Hr.Cache||Be),n}Hr.Cache=Be;function Wr(t){if(typeof t!="function")throw new Ce(i);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Tp(t){return Ys(2,t)}var Ep=dd(function(t,e){e=e.length==1&&Ot(e[0])?Wt(e[0],he(mt())):Wt(te(e,1),he(mt()));var n=e.length;return It(function(h){for(var M=-1,F=ee(h.length,n);++M<F;)h[M]=e[M].call(this,h[M]);return de(t,this,h)})}),fo=It(function(t,e){var n=Je(e,Pn(fo));return Ge(t,o,v,e,n)}),nu=It(function(t,e){var n=Je(e,Pn(nu));return Ge(t,g,v,e,n)}),Ip=He(function(t,e){return Ge(t,l,v,v,v,e)});function Pp(t,e){if(typeof t!="function")throw new Ce(i);return e=e===v?e:St(e),It(t,e)}function Mp(t,e){if(typeof t!="function")throw new Ce(i);return e=e==null?0:qt(St(e),0),It(function(n){var h=n[e],M=Ze(n,0,e);return h&&Ke(M,h),de(t,this,M)})}function _p(t,e,n){var h=!0,M=!0;if(typeof t!="function")throw new Ce(i);return kt(n)&&(h="leading"in n?!!n.leading:h,M="trailing"in n?!!n.trailing:M),eu(t,e,{leading:h,maxWait:e,trailing:M})}function wp(t){return $s(t,1)}function xp(t,e){return fo(Ji(e),t)}function Lp(){if(!arguments.length)return[];var t=arguments[0];return Ot(t)?t:[t]}function Dp(t){return Re(t,O)}function Np(t,e){return e=typeof e=="function"?e:v,Re(t,O,e)}function Up(t){return Re(t,A|O)}function Bp(t,e){return e=typeof e=="function"?e:v,Re(t,A|O,e)}function Fp(t,e){return e==null||za(t,e,Xt(e))}function Me(t,e){return t===e||t!==t&&e!==e}var Gp=Lr(Ni),Hp=Lr(function(t,e){return t>=e}),cn=qa(function(){return arguments}())?qa:function(t){return zt(t)&&Nt.call(t,"callee")&&!Na.call(t,"callee")},Ot=et.isArray,Wp=va?he(va):qc;function fe(t){return t!=null&&kr(t.length)&&!ke(t)}function jt(t){return zt(t)&&fe(t)}function kp(t){return t===!0||t===!1||zt(t)&&ie(t)==tt}var tn=nc||Co,zp=ma?he(ma):$c;function jp(t){return zt(t)&&t.nodeType===1&&!Xn(t)}function Vp(t){if(t==null)return!0;if(fe(t)&&(Ot(t)||typeof t=="string"||typeof t.splice=="function"||tn(t)||Mn(t)||cn(t)))return!t.length;var e=ne(t);if(e==ct||e==rt)return!t.size;if($n(t))return!Fi(t).length;for(var n in t)if(Nt.call(t,n))return!1;return!0}function Kp(t,e){return Jn(t,e)}function Jp(t,e,n){n=typeof n=="function"?n:v;var h=n?n(t,e):v;return h===v?Jn(t,e,v,n):!!h}function lo(t){if(!zt(t))return!1;var e=ie(t);return e==gt||e==vt||typeof t.message=="string"&&typeof t.name=="string"&&!Xn(t)}function Qp(t){return typeof t=="number"&&Ba(t)}function ke(t){if(!kt(t))return!1;var e=ie(t);return e==Rt||e==xt||e==V||e==se}function ru(t){return typeof t=="number"&&t==St(t)}function kr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=z}function kt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function zt(t){return t!=null&&typeof t=="object"}var iu=ya?he(ya):Xc;function qp(t,e){return t===e||Bi(t,e,to(e))}function $p(t,e,n){return n=typeof n=="function"?n:v,Bi(t,e,to(e),n)}function Yp(t){return ou(t)&&t!=+t}function Xp(t){if(Nd(t))throw new Ct(p);return $a(t)}function Zp(t){return t===null}function tg(t){return t==null}function ou(t){return typeof t=="number"||zt(t)&&ie(t)==wt}function Xn(t){if(!zt(t)||ie(t)!=Ut)return!1;var e=gr(t);if(e===null)return!0;var n=Nt.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&cr.call(n)==$l}var co=ba?he(ba):Zc;function eg(t){return ru(t)&&t>=-z&&t<=z}var au=Aa?he(Aa):td;function zr(t){return typeof t=="string"||!Ot(t)&&zt(t)&&ie(t)==ut}function ge(t){return typeof t=="symbol"||zt(t)&&ie(t)==ht}var Mn=Ca?he(Ca):ed;function ng(t){return t===v}function rg(t){return zt(t)&&ne(t)==Jt}function ig(t){return zt(t)&&ie(t)==en}var og=Lr(Gi),ag=Lr(function(t,e){return t<=e});function su(t){if(!t)return[];if(fe(t))return zr(t)?Ie(t):ue(t);if(Gn&&t[Gn])return Fl(t[Gn]());var e=ne(t),n=e==ct?Ei:e==rt?ur:_n;return n(t)}function ze(t){if(!t)return t===0?t:0;if(t=Ee(t),t===x||t===-x){var e=t<0?-1:1;return e*W}return t===t?t:0}function St(t){var e=ze(t),n=e%1;return e===e?n?e-n:e:0}function uu(t){return t?sn(St(t),0,Z):0}function Ee(t){if(typeof t=="number")return t;if(ge(t))return Q;if(kt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=kt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ia(t);var n=Wf.test(t);return n||zf.test(t)?Cl(t.slice(2),n?2:8):Hf.test(t)?Q:+t}function fu(t){return Le(t,le(t))}function sg(t){return t?sn(St(t),-z,z):t===0?t:0}function Dt(t){return t==null?"":pe(t)}var ug=En(function(t,e){if($n(e)||fe(e)){Le(e,Xt(e),t);return}for(var n in e)Nt.call(e,n)&&jn(t,n,e[n])}),lu=En(function(t,e){Le(e,le(e),t)}),jr=En(function(t,e,n,h){Le(e,le(e),t,h)}),fg=En(function(t,e,n,h){Le(e,Xt(e),t,h)}),lg=He(xi);function cg(t,e){var n=Tn(t);return e==null?n:ka(n,e)}var dg=It(function(t,e){t=Bt(t);var n=-1,h=e.length,M=h>2?e[2]:v;for(M&&oe(e[0],e[1],M)&&(h=1);++n<h;)for(var F=e[n],j=le(F),J=-1,Y=j.length;++J<Y;){var it=j[J],ot=t[it];(ot===v||Me(ot,On[it])&&!Nt.call(t,it))&&(t[it]=F[it])}return t}),hg=It(function(t){return t.push(v,Is),de(cu,v,t)});function pg(t,e){return Ra(t,mt(e,3),xe)}function gg(t,e){return Ra(t,mt(e,3),Di)}function vg(t,e){return t==null?t:Li(t,mt(e,3),le)}function mg(t,e){return t==null?t:Ja(t,mt(e,3),le)}function yg(t,e){return t&&xe(t,mt(e,3))}function bg(t,e){return t&&Di(t,mt(e,3))}function Ag(t){return t==null?[]:Tr(t,Xt(t))}function Cg(t){return t==null?[]:Tr(t,le(t))}function ho(t,e,n){var h=t==null?v:un(t,e);return h===v?n:h}function Og(t,e){return t!=null&&_s(t,e,Vc)}function po(t,e){return t!=null&&_s(t,e,Kc)}var Rg=Os(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=dr.call(e)),t[e]=n},vo(ce)),Sg=Os(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=dr.call(e)),Nt.call(t,e)?t[e].push(n):t[e]=[n]},mt),Tg=It(Kn);function Xt(t){return fe(t)?Ha(t):Fi(t)}function le(t){return fe(t)?Ha(t,!0):nd(t)}function Eg(t,e){var n={};return e=mt(e,3),xe(t,function(h,M,F){Fe(n,e(h,M,F),h)}),n}function Ig(t,e){var n={};return e=mt(e,3),xe(t,function(h,M,F){Fe(n,M,e(h,M,F))}),n}var Pg=En(function(t,e,n){Er(t,e,n)}),cu=En(function(t,e,n,h){Er(t,e,n,h)}),Mg=He(function(t,e){var n={};if(t==null)return n;var h=!1;e=Wt(e,function(F){return F=Xe(F,t),h||(h=F.length>1),F}),Le(t,Xi(t),n),h&&(n=Re(n,A|R|O,Rd));for(var M=e.length;M--;)ji(n,e[M]);return n});function _g(t,e){return du(t,Wr(mt(e)))}var wg=He(function(t,e){return t==null?{}:id(t,e)});function du(t,e){if(t==null)return{};var n=Wt(Xi(t),function(h){return[h]});return e=mt(e),rs(t,n,function(h,M){return e(h,M[0])})}function xg(t,e,n){e=Xe(e,t);var h=-1,M=e.length;for(M||(M=1,t=v);++h<M;){var F=t==null?v:t[De(e[h])];F===v&&(h=M,F=n),t=ke(F)?F.call(t):F}return t}function Lg(t,e,n){return t==null?t:Qn(t,e,n)}function Dg(t,e,n,h){return h=typeof h=="function"?h:v,t==null?t:Qn(t,e,n,h)}var hu=Ts(Xt),pu=Ts(le);function Ng(t,e,n){var h=Ot(t),M=h||tn(t)||Mn(t);if(e=mt(e,4),n==null){var F=t&&t.constructor;M?n=h?new F:[]:kt(t)?n=ke(F)?Tn(gr(t)):{}:n={}}return(M?Ae:xe)(t,function(j,J,Y){return e(n,j,J,Y)}),n}function Ug(t,e){return t==null?!0:ji(t,e)}function Bg(t,e,n){return t==null?t:us(t,e,Ji(n))}function Fg(t,e,n,h){return h=typeof h=="function"?h:v,t==null?t:us(t,e,Ji(n),h)}function _n(t){return t==null?[]:Ti(t,Xt(t))}function Gg(t){return t==null?[]:Ti(t,le(t))}function Hg(t,e,n){return n===v&&(n=e,e=v),n!==v&&(n=Ee(n),n=n===n?n:0),e!==v&&(e=Ee(e),e=e===e?e:0),sn(Ee(t),e,n)}function Wg(t,e,n){return e=ze(e),n===v?(n=e,e=0):n=ze(n),t=Ee(t),Jc(t,e,n)}function kg(t,e,n){if(n&&typeof n!="boolean"&&oe(t,e,n)&&(e=n=v),n===v&&(typeof e=="boolean"?(n=e,e=v):typeof t=="boolean"&&(n=t,t=v)),t===v&&e===v?(t=0,e=1):(t=ze(t),e===v?(e=t,t=0):e=ze(e)),t>e){var h=t;t=e,e=h}if(n||t%1||e%1){var M=Fa();return ee(t+M*(e-t+Al("1e-"+((M+"").length-1))),e)}return Wi(t,e)}var zg=In(function(t,e,n){return e=e.toLowerCase(),t+(n?gu(e):e)});function gu(t){return go(Dt(t).toLowerCase())}function vu(t){return t=Dt(t),t&&t.replace(Vf,Ll).replace(ll,"")}function jg(t,e,n){t=Dt(t),e=pe(e);var h=t.length;n=n===v?h:sn(St(n),0,h);var M=n;return n-=e.length,n>=0&&t.slice(n,M)==e}function Vg(t){return t=Dt(t),t&&Tf.test(t)?t.replace(Jo,Dl):t}function Kg(t){return t=Dt(t),t&&wf.test(t)?t.replace(fi,"\\$&"):t}var Jg=In(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Qg=In(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),qg=bs("toLowerCase");function $g(t,e,n){t=Dt(t),e=St(e);var h=e?Cn(t):0;if(!e||h>=e)return t;var M=(e-h)/2;return xr(br(M),n)+t+xr(yr(M),n)}function Yg(t,e,n){t=Dt(t),e=St(e);var h=e?Cn(t):0;return e&&h<e?t+xr(e-h,n):t}function Xg(t,e,n){t=Dt(t),e=St(e);var h=e?Cn(t):0;return e&&h<e?xr(e-h,n)+t:t}function Zg(t,e,n){return n||e==null?e=0:e&&(e=+e),ac(Dt(t).replace(li,""),e||0)}function tv(t,e,n){return(n?oe(t,e,n):e===v)?e=1:e=St(e),ki(Dt(t),e)}function ev(){var t=arguments,e=Dt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var nv=In(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function rv(t,e,n){return n&&typeof n!="number"&&oe(t,e,n)&&(e=n=v),n=n===v?Z:n>>>0,n?(t=Dt(t),t&&(typeof e=="string"||e!=null&&!co(e))&&(e=pe(e),!e&&An(t))?Ze(Ie(t),0,n):t.split(e,n)):[]}var iv=In(function(t,e,n){return t+(n?" ":"")+go(e)});function ov(t,e,n){return t=Dt(t),n=n==null?0:sn(St(n),0,t.length),e=pe(e),t.slice(n,n+e.length)==e}function av(t,e,n){var h=L.templateSettings;n&&oe(t,e,n)&&(e=v),t=Dt(t),e=jr({},e,h,Es);var M=jr({},e.imports,h.imports,Es),F=Xt(M),j=Ti(M,F),J,Y,it=0,ot=e.interpolate||rr,at="__p += '",lt=Ii((e.escape||rr).source+"|"+ot.source+"|"+(ot===Qo?Gf:rr).source+"|"+(e.evaluate||rr).source+"|$","g"),pt="//# sourceURL="+(Nt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++gl+"]")+`
`;t.replace(lt,function(At,Pt,_t,ve,ae,me){return _t||(_t=ve),at+=t.slice(it,me).replace(Kf,Nl),Pt&&(J=!0,at+=`' +
__e(`+Pt+`) +
'`),ae&&(Y=!0,at+=`';
`+ae+`;
__p += '`),_t&&(at+=`' +
((__t = (`+_t+`)) == null ? '' : __t) +
'`),it=me+At.length,At}),at+=`';
`;var bt=Nt.call(e,"variable")&&e.variable;if(!bt)at=`with (obj) {
`+at+`
}
`;else if(Bf.test(bt))throw new Ct(E);at=(Y?at.replace(Cf,""):at).replace(Of,"$1").replace(Rf,"$1;"),at="function("+(bt||"obj")+`) {
`+(bt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+at+`return __p
}`;var Et=yu(function(){return Lt(F,pt+"return "+at).apply(v,j)});if(Et.source=at,lo(Et))throw Et;return Et}function sv(t){return Dt(t).toLowerCase()}function uv(t){return Dt(t).toUpperCase()}function fv(t,e,n){if(t=Dt(t),t&&(n||e===v))return Ia(t);if(!t||!(e=pe(e)))return t;var h=Ie(t),M=Ie(e),F=Pa(h,M),j=Ma(h,M)+1;return Ze(h,F,j).join("")}function lv(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.slice(0,wa(t)+1);if(!t||!(e=pe(e)))return t;var h=Ie(t),M=Ma(h,Ie(e))+1;return Ze(h,0,M).join("")}function cv(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.replace(li,"");if(!t||!(e=pe(e)))return t;var h=Ie(t),M=Pa(h,Ie(e));return Ze(h,M).join("")}function dv(t,e){var n=y,h=P;if(kt(e)){var M="separator"in e?e.separator:M;n="length"in e?St(e.length):n,h="omission"in e?pe(e.omission):h}t=Dt(t);var F=t.length;if(An(t)){var j=Ie(t);F=j.length}if(n>=F)return t;var J=n-Cn(h);if(J<1)return h;var Y=j?Ze(j,0,J).join(""):t.slice(0,J);if(M===v)return Y+h;if(j&&(J+=Y.length-J),co(M)){if(t.slice(J).search(M)){var it,ot=Y;for(M.global||(M=Ii(M.source,Dt(qo.exec(M))+"g")),M.lastIndex=0;it=M.exec(ot);)var at=it.index;Y=Y.slice(0,at===v?J:at)}}else if(t.indexOf(pe(M),J)!=J){var lt=Y.lastIndexOf(M);lt>-1&&(Y=Y.slice(0,lt))}return Y+h}function hv(t){return t=Dt(t),t&&Sf.test(t)?t.replace(Ko,kl):t}var pv=In(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),go=bs("toUpperCase");function mu(t,e,n){return t=Dt(t),e=n?v:e,e===v?Bl(t)?Vl(t):Pl(t):t.match(e)||[]}var yu=It(function(t,e){try{return de(t,v,e)}catch(n){return lo(n)?n:new Ct(n)}}),gv=He(function(t,e){return Ae(e,function(n){n=De(n),Fe(t,n,uo(t[n],t))}),t});function vv(t){var e=t==null?0:t.length,n=mt();return t=e?Wt(t,function(h){if(typeof h[1]!="function")throw new Ce(i);return[n(h[0]),h[1]]}):[],It(function(h){for(var M=-1;++M<e;){var F=t[M];if(de(F[0],this,h))return de(F[1],this,h)}})}function mv(t){return kc(Re(t,A))}function vo(t){return function(){return t}}function yv(t,e){return t==null||t!==t?e:t}var bv=Cs(),Av=Cs(!0);function ce(t){return t}function mo(t){return Ya(typeof t=="function"?t:Re(t,A))}function Cv(t){return Za(Re(t,A))}function Ov(t,e){return ts(t,Re(e,A))}var Rv=It(function(t,e){return function(n){return Kn(n,t,e)}}),Sv=It(function(t,e){return function(n){return Kn(t,n,e)}});function yo(t,e,n){var h=Xt(e),M=Tr(e,h);n==null&&!(kt(e)&&(M.length||!h.length))&&(n=e,e=t,t=this,M=Tr(e,Xt(e)));var F=!(kt(n)&&"chain"in n)||!!n.chain,j=ke(t);return Ae(M,function(J){var Y=e[J];t[J]=Y,j&&(t.prototype[J]=function(){var it=this.__chain__;if(F||it){var ot=t(this.__wrapped__),at=ot.__actions__=ue(this.__actions__);return at.push({func:Y,args:arguments,thisArg:t}),ot.__chain__=it,ot}return Y.apply(t,Ke([this.value()],arguments))})}),t}function Tv(){return Yt._===this&&(Yt._=Yl),this}function bo(){}function Ev(t){return t=St(t),It(function(e){return es(e,t)})}var Iv=qi(Wt),Pv=qi(Oa),Mv=qi(Ai);function bu(t){return no(t)?Ci(De(t)):od(t)}function _v(t){return function(e){return t==null?v:un(t,e)}}var wv=Rs(),xv=Rs(!0);function Ao(){return[]}function Co(){return!1}function Lv(){return{}}function Dv(){return""}function Nv(){return!0}function Uv(t,e){if(t=St(t),t<1||t>z)return[];var n=Z,h=ee(t,Z);e=mt(e),t-=Z;for(var M=Si(h,e);++n<t;)e(n);return M}function Bv(t){return Ot(t)?Wt(t,De):ge(t)?[t]:ue(Gs(Dt(t)))}function Fv(t){var e=++ql;return Dt(t)+e}var Gv=wr(function(t,e){return t+e},0),Hv=$i("ceil"),Wv=wr(function(t,e){return t/e},1),kv=$i("floor");function zv(t){return t&&t.length?Sr(t,ce,Ni):v}function jv(t,e){return t&&t.length?Sr(t,mt(e,2),Ni):v}function Vv(t){return Ta(t,ce)}function Kv(t,e){return Ta(t,mt(e,2))}function Jv(t){return t&&t.length?Sr(t,ce,Gi):v}function Qv(t,e){return t&&t.length?Sr(t,mt(e,2),Gi):v}var qv=wr(function(t,e){return t*e},1),$v=$i("round"),Yv=wr(function(t,e){return t-e},0);function Xv(t){return t&&t.length?Ri(t,ce):0}function Zv(t,e){return t&&t.length?Ri(t,mt(e,2)):0}return L.after=Cp,L.ary=$s,L.assign=ug,L.assignIn=lu,L.assignInWith=jr,L.assignWith=fg,L.at=lg,L.before=Ys,L.bind=uo,L.bindAll=gv,L.bindKey=Xs,L.castArray=Lp,L.chain=Js,L.chunk=kd,L.compact=zd,L.concat=jd,L.cond=vv,L.conforms=mv,L.constant=vo,L.countBy=Xh,L.create=cg,L.curry=Zs,L.curryRight=tu,L.debounce=eu,L.defaults=dg,L.defaultsDeep=hg,L.defer=Op,L.delay=Rp,L.difference=Vd,L.differenceBy=Kd,L.differenceWith=Jd,L.drop=Qd,L.dropRight=qd,L.dropRightWhile=$d,L.dropWhile=Yd,L.fill=Xd,L.filter=tp,L.flatMap=rp,L.flatMapDeep=ip,L.flatMapDepth=op,L.flatten=zs,L.flattenDeep=Zd,L.flattenDepth=th,L.flip=Sp,L.flow=bv,L.flowRight=Av,L.fromPairs=eh,L.functions=Ag,L.functionsIn=Cg,L.groupBy=ap,L.initial=rh,L.intersection=ih,L.intersectionBy=oh,L.intersectionWith=ah,L.invert=Rg,L.invertBy=Sg,L.invokeMap=up,L.iteratee=mo,L.keyBy=fp,L.keys=Xt,L.keysIn=le,L.map=Fr,L.mapKeys=Eg,L.mapValues=Ig,L.matches=Cv,L.matchesProperty=Ov,L.memoize=Hr,L.merge=Pg,L.mergeWith=cu,L.method=Rv,L.methodOf=Sv,L.mixin=yo,L.negate=Wr,L.nthArg=Ev,L.omit=Mg,L.omitBy=_g,L.once=Tp,L.orderBy=lp,L.over=Iv,L.overArgs=Ep,L.overEvery=Pv,L.overSome=Mv,L.partial=fo,L.partialRight=nu,L.partition=cp,L.pick=wg,L.pickBy=du,L.property=bu,L.propertyOf=_v,L.pull=lh,L.pullAll=Vs,L.pullAllBy=ch,L.pullAllWith=dh,L.pullAt=hh,L.range=wv,L.rangeRight=xv,L.rearg=Ip,L.reject=pp,L.remove=ph,L.rest=Pp,L.reverse=ao,L.sampleSize=vp,L.set=Lg,L.setWith=Dg,L.shuffle=mp,L.slice=gh,L.sortBy=Ap,L.sortedUniq=Oh,L.sortedUniqBy=Rh,L.split=rv,L.spread=Mp,L.tail=Sh,L.take=Th,L.takeRight=Eh,L.takeRightWhile=Ih,L.takeWhile=Ph,L.tap=zh,L.throttle=_p,L.thru=Br,L.toArray=su,L.toPairs=hu,L.toPairsIn=pu,L.toPath=Bv,L.toPlainObject=fu,L.transform=Ng,L.unary=wp,L.union=Mh,L.unionBy=_h,L.unionWith=wh,L.uniq=xh,L.uniqBy=Lh,L.uniqWith=Dh,L.unset=Ug,L.unzip=so,L.unzipWith=Ks,L.update=Bg,L.updateWith=Fg,L.values=_n,L.valuesIn=Gg,L.without=Nh,L.words=mu,L.wrap=xp,L.xor=Uh,L.xorBy=Bh,L.xorWith=Fh,L.zip=Gh,L.zipObject=Hh,L.zipObjectDeep=Wh,L.zipWith=kh,L.entries=hu,L.entriesIn=pu,L.extend=lu,L.extendWith=jr,yo(L,L),L.add=Gv,L.attempt=yu,L.camelCase=zg,L.capitalize=gu,L.ceil=Hv,L.clamp=Hg,L.clone=Dp,L.cloneDeep=Up,L.cloneDeepWith=Bp,L.cloneWith=Np,L.conformsTo=Fp,L.deburr=vu,L.defaultTo=yv,L.divide=Wv,L.endsWith=jg,L.eq=Me,L.escape=Vg,L.escapeRegExp=Kg,L.every=Zh,L.find=ep,L.findIndex=Ws,L.findKey=pg,L.findLast=np,L.findLastIndex=ks,L.findLastKey=gg,L.floor=kv,L.forEach=Qs,L.forEachRight=qs,L.forIn=vg,L.forInRight=mg,L.forOwn=yg,L.forOwnRight=bg,L.get=ho,L.gt=Gp,L.gte=Hp,L.has=Og,L.hasIn=po,L.head=js,L.identity=ce,L.includes=sp,L.indexOf=nh,L.inRange=Wg,L.invoke=Tg,L.isArguments=cn,L.isArray=Ot,L.isArrayBuffer=Wp,L.isArrayLike=fe,L.isArrayLikeObject=jt,L.isBoolean=kp,L.isBuffer=tn,L.isDate=zp,L.isElement=jp,L.isEmpty=Vp,L.isEqual=Kp,L.isEqualWith=Jp,L.isError=lo,L.isFinite=Qp,L.isFunction=ke,L.isInteger=ru,L.isLength=kr,L.isMap=iu,L.isMatch=qp,L.isMatchWith=$p,L.isNaN=Yp,L.isNative=Xp,L.isNil=tg,L.isNull=Zp,L.isNumber=ou,L.isObject=kt,L.isObjectLike=zt,L.isPlainObject=Xn,L.isRegExp=co,L.isSafeInteger=eg,L.isSet=au,L.isString=zr,L.isSymbol=ge,L.isTypedArray=Mn,L.isUndefined=ng,L.isWeakMap=rg,L.isWeakSet=ig,L.join=sh,L.kebabCase=Jg,L.last=Te,L.lastIndexOf=uh,L.lowerCase=Qg,L.lowerFirst=qg,L.lt=og,L.lte=ag,L.max=zv,L.maxBy=jv,L.mean=Vv,L.meanBy=Kv,L.min=Jv,L.minBy=Qv,L.stubArray=Ao,L.stubFalse=Co,L.stubObject=Lv,L.stubString=Dv,L.stubTrue=Nv,L.multiply=qv,L.nth=fh,L.noConflict=Tv,L.noop=bo,L.now=Gr,L.pad=$g,L.padEnd=Yg,L.padStart=Xg,L.parseInt=Zg,L.random=kg,L.reduce=dp,L.reduceRight=hp,L.repeat=tv,L.replace=ev,L.result=xg,L.round=$v,L.runInContext=q,L.sample=gp,L.size=yp,L.snakeCase=nv,L.some=bp,L.sortedIndex=vh,L.sortedIndexBy=mh,L.sortedIndexOf=yh,L.sortedLastIndex=bh,L.sortedLastIndexBy=Ah,L.sortedLastIndexOf=Ch,L.startCase=iv,L.startsWith=ov,L.subtract=Yv,L.sum=Xv,L.sumBy=Zv,L.template=av,L.times=Uv,L.toFinite=ze,L.toInteger=St,L.toLength=uu,L.toLower=sv,L.toNumber=Ee,L.toSafeInteger=sg,L.toString=Dt,L.toUpper=uv,L.trim=fv,L.trimEnd=lv,L.trimStart=cv,L.truncate=dv,L.unescape=hv,L.uniqueId=Fv,L.upperCase=pv,L.upperFirst=go,L.each=Qs,L.eachRight=qs,L.first=js,yo(L,function(){var t={};return xe(L,function(e,n){Nt.call(L.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),L.VERSION=c,Ae(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){L[t].placeholder=L}),Ae(["drop","take"],function(t,e){Mt.prototype[t]=function(n){n=n===v?1:qt(St(n),0);var h=this.__filtered__&&!e?new Mt(this):this.clone();return h.__filtered__?h.__takeCount__=ee(n,h.__takeCount__):h.__views__.push({size:ee(n,Z),type:t+(h.__dir__<0?"Right":"")}),h},Mt.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),Ae(["filter","map","takeWhile"],function(t,e){var n=e+1,h=n==H||n==I;Mt.prototype[t]=function(M){var F=this.clone();return F.__iteratees__.push({iteratee:mt(M,3),type:n}),F.__filtered__=F.__filtered__||h,F}}),Ae(["head","last"],function(t,e){var n="take"+(e?"Right":"");Mt.prototype[t]=function(){return this[n](1).value()[0]}}),Ae(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Mt.prototype[t]=function(){return this.__filtered__?new Mt(this):this[n](1)}}),Mt.prototype.compact=function(){return this.filter(ce)},Mt.prototype.find=function(t){return this.filter(t).head()},Mt.prototype.findLast=function(t){return this.reverse().find(t)},Mt.prototype.invokeMap=It(function(t,e){return typeof t=="function"?new Mt(this):this.map(function(n){return Kn(n,t,e)})}),Mt.prototype.reject=function(t){return this.filter(Wr(mt(t)))},Mt.prototype.slice=function(t,e){t=St(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Mt(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==v&&(e=St(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},Mt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Mt.prototype.toArray=function(){return this.take(Z)},xe(Mt.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),h=/^(?:head|last)$/.test(e),M=L[h?"take"+(e=="last"?"Right":""):e],F=h||/^find/.test(e);!M||(L.prototype[e]=function(){var j=this.__wrapped__,J=h?[1]:arguments,Y=j instanceof Mt,it=J[0],ot=Y||Ot(j),at=function(Pt){var _t=M.apply(L,Ke([Pt],J));return h&&lt?_t[0]:_t};ot&&n&&typeof it=="function"&&it.length!=1&&(Y=ot=!1);var lt=this.__chain__,pt=!!this.__actions__.length,bt=F&&!lt,Et=Y&&!pt;if(!F&&ot){j=Et?j:new Mt(this);var At=t.apply(j,J);return At.__actions__.push({func:Br,args:[at],thisArg:v}),new Oe(At,lt)}return bt&&Et?t.apply(this,J):(At=this.thru(at),bt?h?At.value()[0]:At.value():At)})}),Ae(["pop","push","shift","sort","splice","unshift"],function(t){var e=fr[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",h=/^(?:pop|shift)$/.test(t);L.prototype[t]=function(){var M=arguments;if(h&&!this.__chain__){var F=this.value();return e.apply(Ot(F)?F:[],M)}return this[n](function(j){return e.apply(Ot(j)?j:[],M)})}}),xe(Mt.prototype,function(t,e){var n=L[e];if(n){var h=n.name+"";Nt.call(Sn,h)||(Sn[h]=[]),Sn[h].push({name:e,func:n})}}),Sn[_r(v,_).name]=[{name:"wrapper",func:v}],Mt.prototype.clone=hc,Mt.prototype.reverse=pc,Mt.prototype.value=gc,L.prototype.at=jh,L.prototype.chain=Vh,L.prototype.commit=Kh,L.prototype.next=Jh,L.prototype.plant=qh,L.prototype.reverse=$h,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=Yh,L.prototype.first=L.prototype.head,Gn&&(L.prototype[Gn]=Qh),L},Qe=Kl();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Yt._=Qe,define(function(){return Qe})):nn?((nn.exports=Qe)._=Qe,vi._=Qe):Yt._=Qe}).call(Dn)});var $r=Kt((_0,xu)=>{st();function Cm(v){var c=typeof v;return v!=null&&(c=="object"||c=="function")}xu.exports=Cm});var Du=Kt((w0,Lu)=>{st();var Om=typeof global=="object"&&global&&global.Object===Object&&global;Lu.exports=Om});var _o=Kt((x0,Nu)=>{st();var Rm=Du(),Sm=typeof self=="object"&&self&&self.Object===Object&&self,Tm=Rm||Sm||Function("return this")();Nu.exports=Tm});var Bu=Kt((L0,Uu)=>{st();var Em=_o(),Im=function(){return Em.Date.now()};Uu.exports=Im});var Gu=Kt((D0,Fu)=>{st();var Pm=/\s/;function Mm(v){for(var c=v.length;c--&&Pm.test(v.charAt(c)););return c}Fu.exports=Mm});var Wu=Kt((N0,Hu)=>{st();var _m=Gu(),wm=/^\s+/;function xm(v){return v&&v.slice(0,_m(v)+1).replace(wm,"")}Hu.exports=xm});var wo=Kt((U0,ku)=>{st();var Lm=_o(),Dm=Lm.Symbol;ku.exports=Dm});var Ku=Kt((B0,Vu)=>{st();var zu=wo(),ju=Object.prototype,Nm=ju.hasOwnProperty,Um=ju.toString,tr=zu?zu.toStringTag:void 0;function Bm(v){var c=Nm.call(v,tr),r=v[tr];try{v[tr]=void 0;var p=!0}catch(E){}var i=Um.call(v);return p&&(c?v[tr]=r:delete v[tr]),i}Vu.exports=Bm});var Qu=Kt((F0,Ju)=>{st();var Fm=Object.prototype,Gm=Fm.toString;function Hm(v){return Gm.call(v)}Ju.exports=Hm});var Xu=Kt((G0,Yu)=>{st();var qu=wo(),Wm=Ku(),km=Qu(),zm="[object Null]",jm="[object Undefined]",$u=qu?qu.toStringTag:void 0;function Vm(v){return v==null?v===void 0?jm:zm:$u&&$u in Object(v)?Wm(v):km(v)}Yu.exports=Vm});var tf=Kt((H0,Zu)=>{st();function Km(v){return v!=null&&typeof v=="object"}Zu.exports=Km});var nf=Kt((W0,ef)=>{st();var Jm=Xu(),Qm=tf(),qm="[object Symbol]";function $m(v){return typeof v=="symbol"||Qm(v)&&Jm(v)==qm}ef.exports=$m});var sf=Kt((k0,af)=>{st();var Ym=Wu(),rf=$r(),Xm=nf(),of=0/0,Zm=/^[-+]0x[0-9a-f]+$/i,t0=/^0b[01]+$/i,e0=/^0o[0-7]+$/i,n0=parseInt;function r0(v){if(typeof v=="number")return v;if(Xm(v))return of;if(rf(v)){var c=typeof v.valueOf=="function"?v.valueOf():v;v=rf(c)?c+"":c}if(typeof v!="string")return v===0?v:+v;v=Ym(v);var r=t0.test(v);return r||e0.test(v)?n0(v.slice(2),r?2:8):Zm.test(v)?of:+v}af.exports=r0});var lf=Kt((z0,ff)=>{st();var i0=$r(),xo=Bu(),uf=sf(),o0="Expected a function",a0=Math.max,s0=Math.min;function u0(v,c,r){var p,i,E,T,u,d,A=0,R=!1,O=!1,a=!0;if(typeof v!="function")throw new TypeError(o0);c=uf(c)||0,i0(r)&&(R=!!r.leading,O="maxWait"in r,E=O?a0(uf(r.maxWait)||0,c):E,a="trailing"in r?!!r.trailing:a);function C(l){var s=p,y=i;return p=i=void 0,A=l,T=v.apply(y,s),T}function w(l){return A=l,u=setTimeout(m,c),R?C(l):T}function _(l){var s=l-d,y=l-A,P=c-s;return O?s0(P,E-y):P}function b(l){var s=l-d,y=l-A;return d===void 0||s>=c||s<0||O&&y>=E}function m(){var l=xo();if(b(l))return S(l);u=setTimeout(m,_(l))}function S(l){return u=void 0,a&&p?C(l):(p=i=void 0,T)}function o(){u!==void 0&&clearTimeout(u),A=0,p=d=i=u=void 0}function g(){return u===void 0?T:S(xo())}function f(){var l=xo(),s=b(l);if(p=arguments,i=this,d=l,s){if(u===void 0)return w(d);if(O)return clearTimeout(u),u=setTimeout(m,c),C(d)}return u===void 0&&(u=setTimeout(m,c)),T}return f.cancel=o,f.flush=g,f}ff.exports=u0});var Lo=Kt((j0,cf)=>{st();var f0=lf(),l0=$r(),c0="Expected a function";function d0(v,c,r){var p=!0,i=!0;if(typeof v!="function")throw new TypeError(c0);return l0(r)&&(p="leading"in r?!!r.leading:p,i="trailing"in r?!!r.trailing:i),f0(v,c,{leading:p,maxWait:c,trailing:i})}cf.exports=d0});var hf=Kt((Xr,Do)=>{st();(function(c,r){typeof Xr=="object"&&typeof Do=="object"?Do.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Xr=="object"?Xr.Ably=r():c.Ably=r()})(window,function(){return function(v){var c={};function r(p){if(c[p])return c[p].exports;var i=c[p]={i:p,l:!1,exports:{}};return v[p].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=v,r.c=c,r.d=function(p,i,E){r.o(p,i)||Object.defineProperty(p,i,{enumerable:!0,get:E})},r.r=function(p){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},r.t=function(p,i){if(i&1&&(p=r(p)),i&8||i&4&&typeof p=="object"&&p&&p.__esModule)return p;var E=Object.create(null);if(r.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:p}),i&2&&typeof p!="string")for(var T in p)r.d(E,T,function(u){return p[u]}.bind(null,T));return E},r.n=function(p){var i=p&&p.__esModule?function(){return p.default}:function(){return p};return r.d(i,"a",i),i},r.o=function(p,i){return Object.prototype.hasOwnProperty.call(p,i)},r.p="",r(r.s=41)}([function(v,c,r){"use strict";c.__esModule=!0;var p=function(){function i(){}return i}();c.default=p},function(v,c,r){"use strict";r.r(c),r.d(c,"__extends",function(){return i}),r.d(c,"__assign",function(){return E}),r.d(c,"__rest",function(){return T}),r.d(c,"__decorate",function(){return u}),r.d(c,"__param",function(){return d}),r.d(c,"__metadata",function(){return A}),r.d(c,"__awaiter",function(){return R}),r.d(c,"__generator",function(){return O}),r.d(c,"__createBinding",function(){return a}),r.d(c,"__exportStar",function(){return C}),r.d(c,"__values",function(){return w}),r.d(c,"__read",function(){return _}),r.d(c,"__spread",function(){return b}),r.d(c,"__spreadArrays",function(){return m}),r.d(c,"__spreadArray",function(){return S}),r.d(c,"__await",function(){return o}),r.d(c,"__asyncGenerator",function(){return g}),r.d(c,"__asyncDelegator",function(){return f}),r.d(c,"__asyncValues",function(){return l}),r.d(c,"__makeTemplateObject",function(){return s}),r.d(c,"__importStar",function(){return P}),r.d(c,"__importDefault",function(){return D}),r.d(c,"__classPrivateFieldGet",function(){return k}),r.d(c,"__classPrivateFieldSet",function(){return H});var p=function(U,I){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,z){x.__proto__=z}||function(x,z){for(var W in z)Object.prototype.hasOwnProperty.call(z,W)&&(x[W]=z[W])},p(U,I)};function i(U,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");p(U,I);function x(){this.constructor=U}U.prototype=I===null?Object.create(I):(x.prototype=I.prototype,new x)}var E=function(){return E=Object.assign||function(I){for(var x,z=1,W=arguments.length;z<W;z++){x=arguments[z];for(var Q in x)Object.prototype.hasOwnProperty.call(x,Q)&&(I[Q]=x[Q])}return I},E.apply(this,arguments)};function T(U,I){var x={};for(var z in U)Object.prototype.hasOwnProperty.call(U,z)&&I.indexOf(z)<0&&(x[z]=U[z]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,z=Object.getOwnPropertySymbols(U);W<z.length;W++)I.indexOf(z[W])<0&&Object.prototype.propertyIsEnumerable.call(U,z[W])&&(x[z[W]]=U[z[W]]);return x}function u(U,I,x,z){var W=arguments.length,Q=W<3?I:z===null?z=Object.getOwnPropertyDescriptor(I,x):z,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(U,I,x,z);else for(var $=U.length-1;$>=0;$--)(Z=U[$])&&(Q=(W<3?Z(Q):W>3?Z(I,x,Q):Z(I,x))||Q);return W>3&&Q&&Object.defineProperty(I,x,Q),Q}function d(U,I){return function(x,z){I(x,z,U)}}function A(U,I){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(U,I)}function R(U,I,x,z){function W(Q){return Q instanceof x?Q:new x(function(Z){Z(Q)})}return new(x||(x=Promise))(function(Q,Z){function $(B){try{N(z.next(B))}catch(K){Z(K)}}function G(B){try{N(z.throw(B))}catch(K){Z(K)}}function N(B){B.done?Q(B.value):W(B.value).then($,G)}N((z=z.apply(U,I||[])).next())})}function O(U,I){var x={label:0,sent:function(){if(Q[0]&1)throw Q[1];return Q[1]},trys:[],ops:[]},z,W,Q,Z;return Z={next:$(0),throw:$(1),return:$(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function $(N){return function(B){return G([N,B])}}function G(N){if(z)throw new TypeError("Generator is already executing.");for(;x;)try{if(z=1,W&&(Q=N[0]&2?W.return:N[0]?W.throw||((Q=W.return)&&Q.call(W),0):W.next)&&!(Q=Q.call(W,N[1])).done)return Q;switch(W=0,Q&&(N=[N[0]&2,Q.value]),N[0]){case 0:case 1:Q=N;break;case 4:return x.label++,{value:N[1],done:!1};case 5:x.label++,W=N[1],N=[0];continue;case 7:N=x.ops.pop(),x.trys.pop();continue;default:if(Q=x.trys,!(Q=Q.length>0&&Q[Q.length-1])&&(N[0]===6||N[0]===2)){x=0;continue}if(N[0]===3&&(!Q||N[1]>Q[0]&&N[1]<Q[3])){x.label=N[1];break}if(N[0]===6&&x.label<Q[1]){x.label=Q[1],Q=N;break}if(Q&&x.label<Q[2]){x.label=Q[2],x.ops.push(N);break}Q[2]&&x.ops.pop(),x.trys.pop();continue}N=I.call(U,x)}catch(B){N=[6,B],W=0}finally{z=Q=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}var a=Object.create?function(U,I,x,z){z===void 0&&(z=x),Object.defineProperty(U,z,{enumerable:!0,get:function(){return I[x]}})}:function(U,I,x,z){z===void 0&&(z=x),U[z]=I[x]};function C(U,I){for(var x in U)x!=="default"&&!Object.prototype.hasOwnProperty.call(I,x)&&a(I,U,x)}function w(U){var I=typeof Symbol=="function"&&Symbol.iterator,x=I&&U[I],z=0;if(x)return x.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&z>=U.length&&(U=void 0),{value:U&&U[z++],done:!U}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(U,I){var x=typeof Symbol=="function"&&U[Symbol.iterator];if(!x)return U;var z=x.call(U),W,Q=[],Z;try{for(;(I===void 0||I-- >0)&&!(W=z.next()).done;)Q.push(W.value)}catch($){Z={error:$}}finally{try{W&&!W.done&&(x=z.return)&&x.call(z)}finally{if(Z)throw Z.error}}return Q}function b(){for(var U=[],I=0;I<arguments.length;I++)U=U.concat(_(arguments[I]));return U}function m(){for(var U=0,I=0,x=arguments.length;I<x;I++)U+=arguments[I].length;for(var z=Array(U),W=0,I=0;I<x;I++)for(var Q=arguments[I],Z=0,$=Q.length;Z<$;Z++,W++)z[W]=Q[Z];return z}function S(U,I,x){if(x||arguments.length===2)for(var z=0,W=I.length,Q;z<W;z++)(Q||!(z in I))&&(Q||(Q=Array.prototype.slice.call(I,0,z)),Q[z]=I[z]);return U.concat(Q||Array.prototype.slice.call(I))}function o(U){return this instanceof o?(this.v=U,this):new o(U)}function g(U,I,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=x.apply(U,I||[]),W,Q=[];return W={},Z("next"),Z("throw"),Z("return"),W[Symbol.asyncIterator]=function(){return this},W;function Z(V){z[V]&&(W[V]=function(tt){return new Promise(function(ft,vt){Q.push([V,tt,ft,vt])>1||$(V,tt)})})}function $(V,tt){try{G(z[V](tt))}catch(ft){K(Q[0][3],ft)}}function G(V){V.value instanceof o?Promise.resolve(V.value.v).then(N,B):K(Q[0][2],V)}function N(V){$("next",V)}function B(V){$("throw",V)}function K(V,tt){V(tt),Q.shift(),Q.length&&$(Q[0][0],Q[0][1])}}function f(U){var I,x;return I={},z("next"),z("throw",function(W){throw W}),z("return"),I[Symbol.iterator]=function(){return this},I;function z(W,Q){I[W]=U[W]?function(Z){return(x=!x)?{value:o(U[W](Z)),done:W==="return"}:Q?Q(Z):Z}:Q}}function l(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I=U[Symbol.asyncIterator],x;return I?I.call(U):(U=typeof w=="function"?w(U):U[Symbol.iterator](),x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x);function z(Q){x[Q]=U[Q]&&function(Z){return new Promise(function($,G){Z=U[Q](Z),W($,G,Z.done,Z.value)})}}function W(Q,Z,$,G){Promise.resolve(G).then(function(N){Q({value:N,done:$})},Z)}}function s(U,I){return Object.defineProperty?Object.defineProperty(U,"raw",{value:I}):U.raw=I,U}var y=Object.create?function(U,I){Object.defineProperty(U,"default",{enumerable:!0,value:I})}:function(U,I){U.default=I};function P(U){if(U&&U.__esModule)return U;var I={};if(U!=null)for(var x in U)x!=="default"&&Object.prototype.hasOwnProperty.call(U,x)&&a(I,U,x);return y(I,U),I}function D(U){return U&&U.__esModule?U:{default:U}}function k(U,I,x,z){if(x==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof I=="function"?U!==I||!z:!I.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?z:x==="a"?z.call(U):z?z.value:I.get(U)}function H(U,I,x,z,W){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof I=="function"?U!==I||!W:!I.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?W.call(U,x):W?W.value=x:I.set(U,x),x}},function(v,c,r){"use strict";(function(p){c.__esModule=!0,c.allToUpperCase=c.allToLowerCase=c.encodeBody=c.decodeBody=c.Format=c.promisify=c.trim=c.arrChooseN=c.randomHexString=c.randomString=c.cheapRandStr=c.dataSizeBytes=c.inspectBody=c.inspectError=c.isErrorInfo=c.now=c.parseQueryString=c.toQueryString=c.arrPopRandomElement=c.defaultPostHeaders=c.defaultGetHeaders=c.allSame=c.arrEvery=c.arrFilter=c.arrMap=c.safeArrForEach=c.arrForEach=c.forInOwnNonNullProperties=c.valuesArray=c.keysArray=c.arrWithoutValue=c.arrDeleteValue=c.arrIn=c.arrIndexOf=c.arrSubtract=c.arrIntersectOb=c.arrIntersect=c.intersect=c.containsValue=c.inherits=c.prototypicalClone=c.shallowClone=c.isEmptyArg=c.isOnlyPropIn=c.isEmpty=c.isObject=c.ensureArray=c.isArray=c.copy=c.mixin=void 0,c.getGlobalObject=c.getJitterCoefficient=c.getBackoffCoefficient=void 0;var i=r(1),E=i.__importDefault(r(0)),T=i.__importDefault(r(8));function u(X){return Math.floor(Math.random()*X.length)}function d(X){for(var rt=[],ut=1;ut<arguments.length;ut++)rt[ut-1]=arguments[ut];for(var ht=0;ht<rt.length;ht++){var Tt=rt[ht];if(!Tt)break;var Jt=Object.prototype.hasOwnProperty;for(var en in Tt)(!Jt||Jt.call(Tt,en))&&(X[en]=Tt[en])}return X}c.mixin=d;function A(X){return d({},X)}c.copy=A,c.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function R(X){return w(X)?[]:c.isArray(X)?X:[X]}c.ensureArray=R;function O(X){return Object.prototype.toString.call(X)=="[object Object]"}c.isObject=O;function a(X){for(var rt in X)return!1;return!0}c.isEmpty=a;function C(X,rt){for(var ut in X)if(ut!==rt)return!1;return!0}c.isOnlyPropIn=C;function w(X){return X==null}c.isEmptyArg=w;function _(X){var rt=new Object;for(var ut in X)rt[ut]=X[ut];return rt}c.shallowClone=_;function b(X,rt){var ut=function(){function Tt(){}return Tt}();ut.prototype=X;var ht=new ut;return rt&&d(ht,rt),ht}c.prototypicalClone=b;var m=function(X,rt){if(E.default.Config.inherits){E.default.Config.inherits(X,rt);return}X.super_=rt,X.prototype=b(rt.prototype,{constructor:X})};c.inherits=m;function S(X,rt){for(var ut in X)if(X[ut]==rt)return!0;return!1}c.containsValue=S;function o(X,rt){return c.isArray(rt)?g(X,rt):f(X,rt)}c.intersect=o;function g(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var Tt=X[ht];c.arrIndexOf(rt,Tt)!=-1&&ut.push(Tt)}return ut}c.arrIntersect=g;function f(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var Tt=X[ht];Tt in rt&&ut.push(Tt)}return ut}c.arrIntersectOb=f;function l(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var Tt=X[ht];c.arrIndexOf(rt,Tt)==-1&&ut.push(Tt)}return ut}c.arrSubtract=l,c.arrIndexOf=Array.prototype.indexOf?function(X,rt,ut){return X.indexOf(rt,ut)}:function(X,rt,ut){ut=ut||0;for(var ht=X.length;ut<ht;ut++)if(X[ut]===rt)return ut;return-1};function s(X,rt){return c.arrIndexOf(X,rt)!==-1}c.arrIn=s;function y(X,rt){var ut=c.arrIndexOf(X,rt),ht=ut!=-1;return ht&&X.splice(ut,1),ht}c.arrDeleteValue=y;function P(X,rt){var ut=X.slice();return y(ut,rt),ut}c.arrWithoutValue=P;function D(X,rt){var ut=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||ut.push(ht);return ut}c.keysArray=D;function k(X,rt){var ut=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||ut.push(X[ht]);return ut}c.valuesArray=k;function H(X,rt){for(var ut in X)Object.prototype.hasOwnProperty.call(X,ut)&&X[ut]&&rt(ut)}c.forInOwnNonNullProperties=H,c.arrForEach=Array.prototype.forEach?function(X,rt){X.forEach(rt)}:function(X,rt){for(var ut=X.length,ht=0;ht<ut;ht++)rt(X[ht],ht,X)};function U(X,rt){return c.arrForEach(X.slice(),rt)}c.safeArrForEach=U,c.arrMap=Array.prototype.map?function(X,rt){return X.map(rt)}:function(X,rt){for(var ut=[],ht=X.length,Tt=0;Tt<ht;Tt++)ut.push(rt(X[Tt],Tt,X));return ut},c.arrFilter=Array.prototype.filter?function(X,rt){return X.filter(rt)}:function(X,rt){for(var ut=[],ht=X.length,Tt=0;Tt<ht;Tt++)rt(X[Tt])&&ut.push(X[Tt]);return ut},c.arrEvery=Array.prototype.every?function(X,rt){return X.every(rt)}:function(X,rt){for(var ut=X.length,ht=0;ht<ut;ht++)if(!rt(X[ht],ht,X))return!1;return!0};function I(X,rt){if(X.length===0)return!0;var ut=X[0][rt];return c.arrEvery(X,function(ht){return ht[rt]===ut})}c.allSame=I;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(X){var rt=x[X||Rt.json];return{accept:rt,"X-Ably-Version":T.default.apiVersion,"Ably-Agent":T.default.agent}}c.defaultGetHeaders=z;function W(X){var rt,ut=rt=x[X||Rt.json];return{accept:ut,"content-type":rt,"X-Ably-Version":T.default.apiVersion,"Ably-Agent":T.default.agent}}c.defaultPostHeaders=W;function Q(X){return X.splice(u(X),1)[0]}c.arrPopRandomElement=Q;function Z(X){var rt=[];if(X)for(var ut in X)rt.push(encodeURIComponent(ut)+"="+encodeURIComponent(X[ut]));return rt.length?"?"+rt.join("&"):""}c.toQueryString=Z;function $(X){for(var rt,ut=/([^?&=]+)=?([^&]*)/g,ht={};rt=ut.exec(X);)ht[decodeURIComponent(rt[1])]=decodeURIComponent(rt[2]);return ht}c.parseQueryString=$,c.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}c.isErrorInfo=G;function N(X){var rt,ut;return X instanceof Error||((ut=(rt=X)===null||rt===void 0?void 0:rt.constructor)===null||ut===void 0?void 0:ut.name)==="ErrorInfo"?E.default.Config.inspect(X):X.toString()}c.inspectError=N;function B(X){return E.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:E.default.Config.inspect(X)}c.inspectBody=B;function K(X){if(E.default.BufferUtils.isBuffer(X))return E.default.BufferUtils.byteLength(X);if(typeof X=="string")return E.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}c.dataSizeBytes=K;function V(){return String(Math.random()).substr(2)}c.cheapRandStr=V;var tt=function(X){if(E.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return E.default.Config.getRandomValues(rt),E.default.BufferUtils.base64Encode(rt)}for(var ut=E.default.BufferUtils.base64CharSet,ht=Math.round(X*4/3),Tt="",Jt=0;Jt<ht;Jt++)Tt+=ut[u(ut)];return Tt};c.randomString=tt;var ft=function(X){if(E.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return E.default.Config.getRandomValues(rt),E.default.BufferUtils.hexEncode(rt)}for(var ut=E.default.BufferUtils.hexCharSet,ht=X*2,Tt="",Jt=0;Jt<ht;Jt++)Tt+=ut[u(ut)];return Tt};c.randomHexString=ft;function vt(X,rt){for(var ut=Math.min(rt,X.length),ht=X.slice(),Tt=[],Jt=0;Jt<ut;Jt++)Tt.push(Q(ht));return Tt}c.arrChooseN=vt,c.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function gt(X,rt,ut){return new Promise(function(ht,Tt){X[rt].apply(X,i.__spreadArray(i.__spreadArray([],ut),[function(Jt,en){Jt?Tt(Jt):ht(en)}]))})}c.promisify=gt;var Rt;(function(X){X.msgpack="msgpack",X.json="json"})(Rt=c.Format||(c.Format={}));function xt(X,rt){return rt=="msgpack"?E.default.Config.msgpack.decode(X):JSON.parse(String(X))}c.decodeBody=xt;function ct(X,rt){return rt=="msgpack"?E.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}c.encodeBody=ct;function wt(X){return X.map(function(rt){return rt&&rt.toLowerCase()})}c.allToLowerCase=wt;function $t(X){return X.map(function(rt){return rt&&rt.toUpperCase()})}c.allToUpperCase=$t;function Ut(X){return Math.min((X+2)/3,2)}c.getBackoffCoefficient=Ut;function Ht(){return 1-Math.random()*.2}c.getJitterCoefficient=Ht;function se(){return p||(typeof window!="undefined"?window:self)}c.getGlobalObject=se}).call(this,r(12))},function(v,c,r){"use strict";(function(p){c.__esModule=!0;var i=r(1),E=i.__importDefault(r(0)),T=p||(typeof window!="undefined"?window:self),u;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(u||(u={}));function d(a,C){return(""+a).padStart(C?3:2,"0")}function A(a){return E.default.Config.logTimestamps?function(C){var w=new Date;a(d(w.getHours())+":"+d(w.getMinutes())+":"+d(w.getSeconds())+"."+d(w.getMilliseconds(),1)+" "+C)}:a}var R=function(){var a,C,w,_;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((C=(a=T==null?void 0:T.console)===null||a===void 0?void 0:a.log)===null||C===void 0?void 0:C.apply)=="function"?(w=function(){for(var b=[],m=0;m<arguments.length;m++)b[m]=arguments[m]},_=console.warn?function(){for(var b=[],m=0;m<arguments.length;m++)b[m]=arguments[m]}:w):T!=null&&T.console.log?w=_=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=_=function(){},[w,_].map(A)},O=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var C=R(),w=C[0],_=C[1];this.logHandler=w,this.logErrorHandler=_},a.logLevel=u.Error,a.LOG_NONE=u.None,a.LOG_ERROR=u.Error,a.LOG_MAJOR=u.Major,a.LOG_MINOR=u.Minor,a.LOG_MICRO=u.Micro,a.LOG_DEFAULT=u.Error,a.LOG_DEBUG=u.Micro,a.logAction=function(C,w,_){a.shouldLog(C)&&(C===u.Error?a.logErrorHandler:a.logHandler)("Ably: "+w+": "+_)},a.deprecated=function(C,w){a.deprecatedWithMsg(C,"Please use '"+w+"' instead.")},a.deprecatedWithMsg=function(C,w){a.shouldLog(u.Error)&&a.logErrorHandler("Ably: Deprecation warning - '"+C+"' is deprecated and will be removed from a future version. "+w)},a.shouldLog=function(C){return C<=a.logLevel},a.setLog=function(C,w){C!==void 0&&(a.logLevel=C),w!==void 0&&(a.logHandler=a.logErrorHandler=w)},a}();c.default=O}).call(this,r(12))},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(){if(typeof ArrayBuffer=="function"){var i=p,E=i.lib,T=E.WordArray,u=T.init,d=T.init=function(A){if(A instanceof ArrayBuffer&&(A=new Uint8Array(A)),(A instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&A instanceof Uint8ClampedArray||A instanceof Int16Array||A instanceof Uint16Array||A instanceof Int32Array||A instanceof Uint32Array||A instanceof Float32Array||A instanceof Float64Array)&&(A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength)),A instanceof Uint8Array){for(var R=A.byteLength,O=[],a=0;a<R;a++)O[a>>>2]|=A[a]<<24-a%4*8;u.call(this,O,R)}else u.apply(this,arguments)};d.prototype=T}}(),p.lib.WordArray})},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(0)),E=p.__importStar(r(2)),T=function(){function u(d,A,R,O){this.message=d,this.code=A,this.statusCode=R,this.cause=O}return u.prototype.toString=function(){var d="["+this.constructor.name;return this.message&&(d+=": "+this.message),this.statusCode&&(d+="; statusCode="+this.statusCode),this.code&&(d+="; code="+this.code),this.cause&&(d+="; cause="+E.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(d+="; see "+this.href+" "),d+="]",d},u.fromValues=function(d){var A=d,R=A.message,O=A.code,a=A.statusCode;if(typeof R!="string"||typeof O!="number"||typeof a!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(d));var C=Object.assign(new u(R,O,a),d);return C.code&&!C.href&&(C.href="https://help.ably.io/error/"+C.code),C},u}();c.default=T},function(v,c,r){(function(p){(function(i,E){v.exports=c=E()})(this,function(){var i=i||function(E,T){var u;if(typeof window!="undefined"&&window.crypto&&(u=window.crypto),!u&&typeof window!="undefined"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof p!="undefined"&&p.crypto&&(u=p.crypto),!u)try{u=r(44)}catch(f){}var d=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch(f){}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},A=Object.create||function(){function f(){}return function(l){var s;return f.prototype=l,s=new f,f.prototype=null,s}}(),R={},O=R.lib={},a=O.Base=function(){return{extend:function(f){var l=A(this);return f&&l.mixIn(f),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var l in f)f.hasOwnProperty(l)&&(this[l]=f[l]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),C=O.WordArray=a.extend({init:function(f,l){f=this.words=f||[],l!=T?this.sigBytes=l:this.sigBytes=f.length*4},toString:function(f){return(f||_).stringify(this)},concat:function(f){var l=this.words,s=f.words,y=this.sigBytes,P=f.sigBytes;if(this.clamp(),y%4)for(var D=0;D<P;D++){var k=s[D>>>2]>>>24-D%4*8&255;l[y+D>>>2]|=k<<24-(y+D)%4*8}else for(var D=0;D<P;D+=4)l[y+D>>>2]=s[D>>>2];return this.sigBytes+=P,this},clamp:function(){var f=this.words,l=this.sigBytes;f[l>>>2]&=4294967295<<32-l%4*8,f.length=E.ceil(l/4)},clone:function(){var f=a.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var l=[],s=0;s<f;s+=4)l.push(d());return new C.init(l,f)}}),w=R.enc={},_=w.Hex={stringify:function(f){for(var l=f.words,s=f.sigBytes,y=[],P=0;P<s;P++){var D=l[P>>>2]>>>24-P%4*8&255;y.push((D>>>4).toString(16)),y.push((D&15).toString(16))}return y.join("")},parse:function(f){for(var l=f.length,s=[],y=0;y<l;y+=2)s[y>>>3]|=parseInt(f.substr(y,2),16)<<24-y%8*4;return new C.init(s,l/2)}},b=w.Latin1={stringify:function(f){for(var l=f.words,s=f.sigBytes,y=[],P=0;P<s;P++){var D=l[P>>>2]>>>24-P%4*8&255;y.push(String.fromCharCode(D))}return y.join("")},parse:function(f){for(var l=f.length,s=[],y=0;y<l;y++)s[y>>>2]|=(f.charCodeAt(y)&255)<<24-y%4*8;return new C.init(s,l)}},m=w.Utf8={stringify:function(f){try{return decodeURIComponent(escape(b.stringify(f)))}catch(l){throw new Error("Malformed UTF-8 data")}},parse:function(f){return b.parse(unescape(encodeURIComponent(f)))}},S=O.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new C.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=m.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var l,s=this._data,y=s.words,P=s.sigBytes,D=this.blockSize,k=D*4,H=P/k;f?H=E.ceil(H):H=E.max((H|0)-this._minBufferSize,0);var U=H*D,I=E.min(U*4,P);if(U){for(var x=0;x<U;x+=D)this._doProcessBlock(y,x);l=y.splice(0,U),s.sigBytes-=I}return new C.init(l,I)},clone:function(){var f=a.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),o=O.Hasher=S.extend({cfg:a.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){S.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var l=this._doFinalize();return l},blockSize:512/32,_createHelper:function(f){return function(l,s){return new f.init(s).finalize(l)}},_createHmacHelper:function(f){return function(l,s){return new g.HMAC.init(f,s).finalize(l)}}}),g=R.algo={};return R}(Math);return i})}).call(this,r(12))},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(3)),T=p.__importDefault(r(0));function u(R,O,a){try{O.apply(R,a)}catch(C){E.default.logAction(E.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+C+"; stack = "+(C&&C.stack))}}function d(R,O,a){for(var C,w,_,b=0;b<R.length;b++)if(C=R[b],a&&(C=C[a]),i.isArray(C)){for(;(w=i.arrIndexOf(C,O))!==-1;)C.splice(w,1);a&&C.length===0&&delete R[b][a]}else if(i.isObject(C))for(_ in C)Object.prototype.hasOwnProperty.call(C,_)&&i.isArray(C[_])&&d([C],O,_)}var A=function(){function R(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return R.prototype.on=function(){for(var O=this,a=[],C=0;C<arguments.length;C++)a[C]=arguments[C];if(a.length===1){var w=a[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+T.default.Config.inspect(a))}if(a.length===2){var _=a[0],b=a[1];if(typeof b!="function")throw new Error("EventListener.on(): Invalid arguments: "+T.default.Config.inspect(a));if(i.isEmptyArg(_))this.any.push(b);else if(i.isArray(_))_.forEach(function(S){O.on(S,b)});else{if(typeof _!="string")throw new Error("EventListener.on(): Invalid arguments: "+T.default.Config.inspect(a));var m=this.events[_]||(this.events[_]=[]);m.push(b)}}},R.prototype.off=function(){for(var O,a=this,C=[],w=0;w<arguments.length;w++)C[w]=arguments[w];if(C.length==0||i.isEmptyArg(C[0])&&i.isEmptyArg(C[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var _=C[0],b=C[1],m=null,S=null;if(C.length===1||!b)typeof _=="function"?m=_:S=_;else{if(typeof b!="function")throw new Error("EventEmitter.off(): invalid arguments:"+T.default.Config.inspect(C));O=[_,b],S=O[0],m=O[1]}if(m&&i.isEmptyArg(S)){d([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(i.isArray(S)){S.forEach(function(o){a.off(o,m)});return}if(typeof S!="string")throw new Error("EventEmitter.off(): invalid arguments:"+T.default.Config.inspect(C));m?d([this.events,this.eventsOnce],m,S):(delete this.events[S],delete this.eventsOnce[S])},R.prototype.listeners=function(O){if(O){var a=this.events[O]||[];return this.eventsOnce[O]&&Array.prototype.push.apply(a,this.eventsOnce[O]),a.length?a:null}return this.any.length?this.any:null},R.prototype.emit=function(O){for(var a=[],C=1;C<arguments.length;C++)a[C-1]=arguments[C];var w={event:O},_=[];this.anyOnce.length&&(Array.prototype.push.apply(_,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(_,this.any);var b=this.eventsOnce[O];b&&(Array.prototype.push.apply(_,b),delete this.eventsOnce[O]);var m=this.events[O];m&&Array.prototype.push.apply(_,m),i.arrForEach(_,function(S){u(w,S,a)})},R.prototype.once=function(){for(var O=this,a=[],C=0;C<arguments.length;C++)a[C]=arguments[C];var w=a.length;if((w===0||w===1&&typeof a[0]!="function")&&T.default.Config.Promise){var _=a[0];if(typeof _!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+T.default.Config.inspect(a));return new T.default.Config.Promise(function(f){O.once(_,f)})}var b=a[0],m=a[1];if(a.length===1&&typeof b=="function")this.anyOnce.push(b);else if(i.isEmptyArg(b)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+T.default.Config.inspect(a));this.anyOnce.push(m)}else if(i.isArray(b)){var S=this,o=function(){var f=Array.prototype.slice.call(arguments);if(i.arrForEach(b,function(l){S.off(l,o)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+T.default.Config.inspect(a));m.apply(this,f)};i.arrForEach(b,function(f){S.on(f,o)})}else{if(typeof b!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+T.default.Config.inspect(a));var g=this.eventsOnce[b]||(this.eventsOnce[b]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+T.default.Config.inspect(a));g.push(m)}}},R.prototype.whenState=function(O,a,C){for(var w=this,_=[],b=3;b<arguments.length;b++)_[b-3]=arguments[b];var m={event:O};if(typeof O!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof C!="function"&&T.default.Config.Promise)return new T.default.Config.Promise(function(S){R.prototype.whenState.apply(w,[O,a,S].concat(_))});O===a?u(m,C,_):this.once(O,C)},R}();c.default=A},function(v,c,r){"use strict";c.__esModule=!0,c.getDefaults=c.normaliseOptions=c.objectifyOptions=c.getHosts=c.getFallbackHosts=c.environmentFallbackHosts=c.getHttpScheme=c.getPort=c.getHost=void 0;var p=r(1),i=p.__importDefault(r(0)),E=p.__importStar(r(2)),T=p.__importDefault(r(3)),u=p.__importDefault(r(5)),d=r(42),A="ably-js/"+d.version,R={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:d.version,apiVersion:"1.2",agent:A,getHost:O,getPort:a,getHttpScheme:C,environmentFallbackHosts:w,getFallbackHosts:_,getHosts:b,checkHost:m,objectifyOptions:g,normaliseOptions:f};function O(s,y,P){return P?y=y==s.restHost&&s.realtimeHost||y||s.realtimeHost:y=y||s.restHost,y}c.getHost=O;function a(s,y){return y||s.tls?s.tlsPort:s.port}c.getPort=a;function C(s){return s.tls?"https://":"http://"}c.getHttpScheme=C;function w(s){return[s+"-a-fallback.ably-realtime.com",s+"-b-fallback.ably-realtime.com",s+"-c-fallback.ably-realtime.com",s+"-d-fallback.ably-realtime.com",s+"-e-fallback.ably-realtime.com"]}c.environmentFallbackHosts=w;function _(s){var y=s.fallbackHosts,P=typeof s.httpMaxRetryCount!="undefined"?s.httpMaxRetryCount:R.httpMaxRetryCount;return y?E.arrChooseN(y,P):[]}c.getFallbackHosts=_;function b(s){return[s.restHost].concat(_(s))}c.getHosts=b;function m(s){if(typeof s!="string")throw new u.default("host must be a string; was a "+typeof s,4e4,400);if(!s.length)throw new u.default("host must not be zero-length",4e4,400)}function S(s,y,P){return s.realtimeHost?s.realtimeHost:s.restHost?(T.default.logAction(T.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+s.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+s.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),s.restHost):y?R.REALTIME_HOST:P+"-"+R.REALTIME_HOST}function o(s){var y={};for(var P in R.TIMEOUTS)y[P]=s[P]||R.TIMEOUTS[P];return y}function g(s){return typeof s=="string"?s.indexOf(":")==-1?{token:s}:{key:s}:s}c.objectifyOptions=g;function f(s){if(s.host&&(T.default.deprecated("host","restHost"),s.restHost=s.host),s.wsHost&&(T.default.deprecated("wsHost","realtimeHost"),s.realtimeHost=s.wsHost),s.queueEvents&&(T.default.deprecated("queueEvents","queueMessages"),s.queueMessages=s.queueEvents),s.fallbackHostsUseDefault){if(s.fallbackHosts){var y="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw T.default.logAction(T.default.LOG_ERROR,"Defaults.normaliseOptions",y),new u.default(y,4e4,400)}if(s.port||s.tlsPort){var y="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw T.default.logAction(T.default.LOG_ERROR,"Defaults.normaliseOptions",y),new u.default(y,4e4,400)}s.environment?T.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):T.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),s.fallbackHosts=R.FALLBACK_HOSTS}s.recover===!0&&(T.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),s.recover=function(z,W){W(!0)}),typeof s.recover=="function"&&s.closeOnUnload===!0&&(T.default.logAction(T.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),s.recover=void 0),"closeOnUnload"in s||(s.closeOnUnload=!s.recover),s.transports&&E.arrIn(s.transports,"xhr")&&(T.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),E.arrDeleteValue(s.transports,"xhr"),s.transports.push("xhr_streaming")),"queueMessages"in s||(s.queueMessages=!0);var P=s.environment&&String(s.environment).toLowerCase()||R.ENVIRONMENT,D=!P||P==="production";!s.fallbackHosts&&!s.restHost&&!s.realtimeHost&&!s.port&&!s.tlsPort&&(s.fallbackHosts=D?R.FALLBACK_HOSTS:w(P));var k=s.restHost||(D?R.REST_HOST:P+"-"+R.REST_HOST),H=S(s,D,P);E.arrForEach((s.fallbackHosts||[]).concat(k,H),m),s.port=s.port||R.PORT,s.tlsPort=s.tlsPort||R.TLS_PORT,"tls"in s||(s.tls=!0);var U=o(s);if("useBinaryProtocol"in s?s.useBinaryProtocol=i.default.Config.supportsBinary&&s.useBinaryProtocol:s.useBinaryProtocol=i.default.Config.preferBinary,s.clientId){var I=s.headers=s.headers||{};I["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(s.clientId))}if("idempotentRestPublishing"in s||(s.idempotentRestPublishing=!0),s.promises&&!i.default.Config.Promise&&(T.default.logAction(T.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),s.promises=!1),s.agents)for(var x in s.agents)R.agent+=" "+x+"/"+s.agents[x];return p.__assign(p.__assign({},s),{useBinaryProtocol:"useBinaryProtocol"in s?i.default.Config.supportsBinary&&s.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:H,restHost:k,maxMessageSize:s.maxMessageSize||R.maxMessageSize,timeouts:U})}c.normaliseOptions=f,c.default=R;function l(s){return Object.assign(R,s)}c.getDefaults=l},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(0)),E=p.__importDefault(r(3)),T=p.__importDefault(r(5)),u=p.__importStar(r(2));function d(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function A(a){if(a&&a.cipher&&!a.cipher.channelCipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var C=i.default.Crypto.getCipher(a.cipher);return{cipher:C.cipherParams,channelCipher:C.cipher}}return a}function R(a){var C=0;return a.name&&(C+=a.name.length),a.clientId&&(C+=a.clientId.length),a.extras&&(C+=JSON.stringify(a.extras).length),a.data&&(C+=u.dataSizeBytes(a.data)),C}var O=function(){function a(){}return a.prototype.toJSON=function(){var C=this.encoding,w=this.data;return w&&i.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(C=C?C+"/base64":"base64",w=i.default.BufferUtils.base64Encode(w)):w=i.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:C,data:w}},a.prototype.toString=function(){var C="[Message";return this.name&&(C+="; name="+this.name),this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.extras&&(C+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?C+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),this.extras&&(C+="; extras="+JSON.stringify(this.extras)),C+="]",C},a.encrypt=function(C,w,_){var b=C.data,m=C.encoding,S=w.channelCipher;m=m?m+"/":"",i.default.BufferUtils.isBuffer(b)||(b=i.default.BufferUtils.utf8Encode(String(b)),m=m+"utf-8/"),S.encrypt(b,function(o,g){if(o){_(o);return}C.data=g,C.encoding=m+"cipher+"+S.algorithm,_(null,C)})},a.encode=function(C,w,_){var b=C.data,m=typeof b=="string"||i.default.BufferUtils.isBuffer(b)||b===null||b===void 0;if(!m)if(u.isObject(b)||u.isArray(b))C.data=JSON.stringify(b),C.encoding=C.encoding?C.encoding+"/json":"json";else throw new T.default("Data type is unsupported",40013,400);w!=null&&w.cipher?a.encrypt(C,w,_):_(null,C)},a.encodeArray=function(C,w,_){for(var b=0,m=0;m<C.length;m++)a.encode(C[m],w,function(S){if(S){_(S);return}b++,b==C.length&&_(null,C)})},a.decode=function(C,w){var _=d(w),b=C.data,m=C.encoding;if(m){var S=m.split("/"),o=void 0,g=S.length,f=C.data,l="";try{for(;(o=g)>0;){var s=S[--g].match(/([-\w]+)(\+([\w-]+))?/);if(!s)break;switch(l=s[1],l){case"base64":f=i.default.BufferUtils.base64Decode(String(f)),o==S.length&&(b=f);continue;case"utf-8":f=i.default.BufferUtils.utf8Decode(f);continue;case"json":f=JSON.parse(f);continue;case"cipher":if(_.channelOptions!=null&&_.channelOptions.cipher&&_.channelOptions.channelCipher){var y=s[3],P=_.channelOptions.channelCipher;if(y!=P.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");f=P.decrypt(f);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!_.plugins||!_.plugins.vcdiff)throw new T.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new T.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var D=_.baseEncodedPreviousPayload;typeof D=="string"&&(D=i.default.BufferUtils.utf8Encode(D)),D=i.default.BufferUtils.toBuffer(D),f=i.default.BufferUtils.toBuffer(f),f=i.default.BufferUtils.typedArrayToBuffer(_.plugins.vcdiff.decode(f,D)),b=f}catch(H){throw new T.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var k=H;throw new T.default("Error processing the "+l+" encoding, decoder returned \u2018"+k.message+"\u2019",k.code||40013,400)}finally{C.encoding=o<=0?null:S.slice(0,o).join("/"),C.data=f}}_.baseEncodedPreviousPayload=b},a.fromResponseBody=function(C,w,_){_&&(C=u.decodeBody(C,_));for(var b=0;b<C.length;b++){var m=C[b]=a.fromValues(C[b]);try{a.decode(m,w)}catch(S){E.default.logAction(E.default.LOG_ERROR,"Message.fromResponseBody()",S.toString())}}return C},a.fromValues=function(C){return Object.assign(new a,C)},a.fromValuesArray=function(C){for(var w=C.length,_=new Array(w),b=0;b<w;b++)_[b]=a.fromValues(C[b]);return _},a.fromEncoded=function(C,w){var _=a.fromValues(C),b=A(w);try{a.decode(_,b)}catch(m){E.default.logAction(E.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return _},a.fromEncodedArray=function(C,w){return A(w),C.map(function(_){return a.fromEncoded(_,w)})},a.getMessagesSize=function(C){for(var w,_=0,b=0;b<C.length;b++)w=C[b],_+=w.size||(w.size=R(w));return _},a.serialize=u.encodeBody,a}();c.default=O},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(5)),T=p.__importDefault(r(9)),u=p.__importDefault(r(14)),d={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},A=[];Object.keys(d).forEach(function(_){A[d[_]]=_});var R={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},O=Object.keys(R);R.MODE_ALL=R.PRESENCE|R.PUBLISH|R.SUBSCRIBE|R.PRESENCE_SUBSCRIBE;function a(_){var b=[];if(_)for(var m=0;m<_.length;m++)b.push(_[m].toString());return"[ "+b.join(", ")+" ]"}var C="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),w=function(){function _(){var b=this;this.hasFlag=function(m){return(b.flags&R[m])>0}}return _.prototype.setFlag=function(b){return this.flags=this.flags|R[b]},_.prototype.getMode=function(){return this.flags&&this.flags&R.MODE_ALL},_.prototype.encodeModesToFlags=function(b){var m=this;b.forEach(function(S){return m.setFlag(S)})},_.prototype.decodeModesFromFlags=function(){var b=this,m=[];return _.channelModes.forEach(function(S){b.hasFlag(S)&&m.push(S)}),m.length>0?m:void 0},_.fromValues=function(b){return Object.assign(new _,b)},_.Action=d,_.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],_.ActionName=A,_.serialize=i.encodeBody,_.deserialize=function(b,m){var S=i.decodeBody(b,m);return _.fromDeserialized(S)},_.fromDeserialized=function(b){var m=b.error;m&&(b.error=E.default.fromValues(m));var S=b.messages;if(S)for(var o=0;o<S.length;o++)S[o]=T.default.fromValues(S[o]);var g=b.presence;if(g)for(var o=0;o<g.length;o++)g[o]=u.default.fromValues(g[o],!0);return Object.assign(new _,b)},_.stringify=function(b){var m="[ProtocolMessage";b.action!==void 0&&(m+="; action="+_.ActionName[b.action]||!1);for(var S,o=0;o<C.length;o++)S=C[o],b[S]!==void 0&&(m+="; "+S+"="+b[S]);if(b.messages&&(m+="; messages="+a(T.default.fromValuesArray(b.messages))),b.presence&&(m+="; presence="+a(u.default.fromValuesArray(b.presence))),b.error&&(m+="; error="+E.default.fromValues(b.error).toString()),b.auth&&b.auth.accessToken&&(m+="; token="+b.auth.accessToken),b.flags&&(m+="; flags="+O.filter(b.hasFlag).join(",")),b.params){var g="";i.forInOwnNonNullProperties(b.params,function(f){g.length>0&&(g+="; "),g+=f+"="+b.params[f]}),g.length>0&&(m+="; params=["+g+"]")}return m+="]",m},_.isDuplicate=function(b,m){if(b&&m&&(b.action===d.MESSAGE||b.action===d.PRESENCE)&&b.action===m.action&&b.channel===m.channel&&b.id===m.id){if(b.action===d.PRESENCE)return!0;if(b.messages.length===m.messages.length){for(var S=0;S<b.messages.length;S++){var o=b.messages[S],g=m.messages[S];if((o.extras&&o.extras.delta&&o.extras.delta.format)!==(g.extras&&g.extras.delta&&g.extras.delta.format))return!1}return!0}}return!1},_}();c.default=w},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(10)),T=p.__importDefault(r(26)),u=p.__importDefault(r(3)),d=p.__importDefault(r(8)),A=p.__importDefault(r(19)),R=p.__importDefault(r(16)),O=p.__importDefault(r(5)),a=p.__importDefault(r(20)),C=p.__importDefault(r(0));function w(m){var S=[80015,80017,80030];return m.code?R.default.isTokenErr(m)?!1:i.arrIn(S,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function _(m){return w(m)?[E.default.fromValues({action:E.default.Action.ERROR,error:m})]:[E.default.fromValues({action:E.default.Action.DISCONNECTED,error:m})]}var b=function(m){p.__extends(S,m);function S(o,g,f){var l=m.call(this,o,g,f,!0)||this;return l.onAuthUpdated=function(s){l.authParams={access_token:s.token}},l.stream="stream"in f?f.stream:!0,l.sendRequest=null,l.recvRequest=null,l.pendingCallback=null,l.pendingItems=null,l}return S.prototype.connect=function(){var o=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","starting"),T.default.prototype.connect.call(this);var g=this.params,f=g.options,l=d.default.getHost(f,g.host),s=d.default.getPort(f),y=f.tls?"https://":"http://";this.baseUri=y+l+":"+s+"/comet/";var P=this.baseUri+"connect";u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","uri: "+P),this.auth.getAuthParams(function(D,k){if(D){o.disconnect(D);return}if(!o.isDisposed){o.authParams=k;var H=o.params.getConnectParams(k);"stream"in H&&(o.stream=H.stream),u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(H));var U=!1,I=o.recvRequest=o.createRequest(P,null,H,null,o.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);I.on("data",function(x){!o.recvRequest||(U||(U=!0,o.emit("preconnect")),o.onData(x))}),I.on("complete",function(x){if(o.recvRequest||(x=x||new O.default("Request cancelled",80003,400)),o.recvRequest=null,!U&&!x&&(U=!0,o.emit("preconnect")),o.onActivity(),x){x.code?o.onData(_(x)):o.disconnect(x);return}C.default.Config.nextTick(function(){o.recv()})}),I.exec()}})},S.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},S.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},S.prototype._requestCloseOrDisconnect=function(o){var g=this,f=o?this.closeUri:this.disconnectUri;if(f){var l=this.createRequest(f,null,this.authParams,null,a.default.REQ_SEND);l.on("complete",function(s){s&&(u.default.logAction(u.default.LOG_ERROR,"CometTransport.request"+(o?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(s)),g.finish("disconnected",s))}),l.exec()}},S.prototype.dispose=function(){var o=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",A.default.disconnected),C.default.Config.nextTick(function(){o.emit("disposed")}))},S.prototype.onConnect=function(o){if(!this.isDisposed){var g=o.connectionKey;T.default.prototype.onConnect.call(this,o);var f=this.baseUri+g;u.default.logAction(u.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+f+"; connectionKey = "+o.connectionKey),this.sendUri=f+"/send",this.recvUri=f+"/recv",this.closeUri=f+"/close",this.disconnectUri=f+"/disconnect"}},S.prototype.send=function(o){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(o);return}var g=this.pendingItems||[];g.push(o),this.pendingItems=null,this.sendItems(g)},S.prototype.sendAnyPending=function(){var o=this.pendingItems;!o||(this.pendingItems=null,this.sendItems(o))},S.prototype.sendItems=function(o){var g=this,f=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(o),a.default.REQ_SEND);f.on("complete",function(l,s){if(l&&u.default.logAction(u.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(l)),g.sendRequest=null,l){l.code?g.onData(_(l)):g.disconnect(l);return}s&&g.onData(s),g.pendingItems&&C.default.Config.nextTick(function(){g.sendRequest||g.sendAnyPending()})}),f.exec()},S.prototype.recv=function(){var o=this;if(!this.recvRequest&&!!this.isConnected){var g=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);g.on("data",function(f){o.onData(f)}),g.on("complete",function(f){if(o.recvRequest=null,o.onActivity(),f){f.code?o.onData(_(f)):o.disconnect(f);return}C.default.Config.nextTick(function(){o.recv()})}),g.exec()}},S.prototype.onData=function(o){try{var g=this.decodeResponse(o);if(g&&g.length)for(var f=0;f<g.length;f++)this.onProtocolMessage(E.default.fromDeserialized(g[f]))}catch(l){u.default.logAction(u.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+l.stack)}},S.prototype.encodeRequest=function(o){return JSON.stringify(o)},S.prototype.decodeResponse=function(o){return typeof o=="string"?JSON.parse(o):o},S}(T.default);c.default=b},function(v,c){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(p){typeof window=="object"&&(r=window)}v.exports=r},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(){var i=p,E=i.lib,T=E.WordArray,u=i.enc,d=u.Base64={stringify:function(R){var O=R.words,a=R.sigBytes,C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";R.clamp();for(var w=[],_=0;_<a;_+=3)for(var b=O[_>>>2]>>>24-_%4*8&255,m=O[_+1>>>2]>>>24-(_+1)%4*8&255,S=O[_+2>>>2]>>>24-(_+2)%4*8&255,o=b<<16|m<<8|S,g=0;g<4&&_+g*.75<a;g++)w.push(C.charAt(o>>>6*(3-g)&63));var f=C.charAt(64);if(f)for(;w.length%4;)w.push(f);return w.join("")},parse:function(R){var O=R.length,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",C=this._reverseMap;if(!C){C=this._reverseMap=[];for(var w=0;w<a.length;w++)C[a.charCodeAt(w)]=w}var _=a.charAt(64);if(_){var b=R.indexOf(_);b!==-1&&(O=b)}return A(R,O,C)}};function A(R,O,a){for(var C=[],w=0,_=0;_<O;_++)if(_%4){var b=a[R.charCodeAt(_-1)]<<_%4*2,m=a[R.charCodeAt(_)]>>>6-_%4*2,S=b|m;C[w>>>2]|=S<<24-w%4*8,w++}return T.create(C,w)}}(),p.enc.Base64})},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(3)),E=p.__importDefault(r(0)),T=p.__importDefault(r(9)),u=p.__importStar(r(2));function d(R){return A.Actions.indexOf(R)}var A=function(){function R(){}return R.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},R.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var O=this.id.split(":");return{connectionId:O[0],msgSerial:parseInt(O[1],10),index:parseInt(O[2],10)}},R.prototype.toJSON=function(){var O=this.data,a=this.encoding;return O&&E.default.BufferUtils.isBuffer(O)&&(arguments.length>0?(a=a?a+"/base64":"base64",O=E.default.BufferUtils.base64Encode(O)):O=E.default.BufferUtils.toBuffer(O)),{clientId:this.clientId,action:d(this.action),data:O,encoding:a}},R.prototype.toString=function(){var O="[PresenceMessage";return O+="; action="+this.action,this.id&&(O+="; id="+this.id),this.timestamp&&(O+="; timestamp="+this.timestamp),this.clientId&&(O+="; clientId="+this.clientId),this.connectionId&&(O+="; connectionId="+this.connectionId),this.encoding&&(O+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?O+="; data="+this.data:E.default.BufferUtils.isBuffer(this.data)?O+="; data (buffer)="+E.default.BufferUtils.base64Encode(this.data):O+="; data (json)="+JSON.stringify(this.data)),O+="]",O},R.fromResponseBody=function(O,a,C){var w=[];C&&(O=u.decodeBody(O,C));for(var _=0;_<O.length;_++){var b=w[_]=R.fromValues(O[_],!0);try{R.decode(b,a)}catch(m){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return w},R.fromValues=function(O,a){return a&&(O.action=R.Actions[O.action]),Object.assign(new R,O)},R.fromValuesArray=function(O){for(var a=O.length,C=new Array(a),w=0;w<a;w++)C[w]=R.fromValues(O[w]);return C},R.fromEncoded=function(O,a){var C=R.fromValues(O,!0);try{R.decode(C,a)}catch(w){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return C},R.fromEncodedArray=function(O,a){return O.map(function(C){return R.fromEncoded(C,a)})},R.Actions=["absent","present","enter","leave","update"],R.encode=T.default.encode,R.decode=T.default.decode,R.getMessagesSize=T.default.getMessagesSize,R}();c.default=A},function(v,c,r){"use strict";(function(p){c.__esModule=!0;var i=r(1),E=i.__importStar(r(2)),T=i.__importDefault(r(7)),u=i.__importDefault(r(5)),d=i.__importDefault(r(3)),A=i.__importDefault(r(8)),R=i.__importDefault(r(20)),O=i.__importDefault(r(0));function a(y,P){return E.arrIn(E.allToLowerCase(E.keysArray(P)),"x-ably-errorcode")}function C(y,P){if(a(y,P))return y.error&&u.default.fromValues(y.error)}var w=function(){},_=0,b={},m=typeof p!="undefined"&&p.XDomainRequest;function S(){var y=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return y&&Number(y[1])}function o(){var y;return m&&(y=S())&&y===10}function g(y,P){return y.getResponseHeader&&y.getResponseHeader(P)}function f(y){return y.getResponseHeader&&(y.getResponseHeader("transfer-encoding")||!y.getResponseHeader("content-length"))}function l(y){for(var P=E.trim(y.getAllResponseHeaders()).split(`\r
`),D={},k=0;k<P.length;k++){var H=P[k].split(":").map(E.trim);D[H[0].toLowerCase()]=H[1]}return D}var s=function(y){i.__extends(P,y);function P(D,k,H,U,I,x,z){var W=y.call(this)||this;return H=H||{},H.rnd=E.cheapRandStr(),o()&&!H.envelope&&(H.envelope="json"),W.uri=D+E.toQueryString(H),W.headers=k||{},W.body=U,W.method=z?z.toUpperCase():E.isEmptyArg(U)?"GET":"POST",W.requestMode=I,W.timeouts=x,W.timedOut=!1,W.requestComplete=!1,W.id=String(++_),b[W.id]=W,W}return P.createRequest=function(D,k,H,U,I,x,z){var W=x||A.default.TIMEOUTS;return new P(D,k,E.copy(H),U,I,W,z)},P.prototype.complete=function(D,k,H,U,I){this.requestComplete||(this.requestComplete=!0,!D&&k&&this.emit("data",k),this.emit("complete",D,k,H,U,I),this.dispose())},P.prototype.abort=function(){this.dispose()},P.prototype.exec=function(){var D=this,k=this.headers,H=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,U=this.timer=setTimeout(function(){D.timedOut=!0,x.abort()},H),I=this.method,x=this.xhr=new XMLHttpRequest,z=k.accept,W=this.body,Q="text";if(z?z.indexOf("application/x-msgpack")===0&&(Q="arraybuffer"):k.accept="application/json",W){var Z=k["content-type"]||(k["content-type"]="application/json");Z.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}x.open(I,this.uri,!0),x.responseType=Q,"authorization"in k&&(x.withCredentials=!0);for(var $ in k)x.setRequestHeader($,k[$]);var G=function(ct,wt,$t,Ut){var Ht,se=wt+" (event type: "+ct.type+")";!((Ht=D==null?void 0:D.xhr)===null||Ht===void 0)&&Ht.statusText&&(se+=", current statusText is "+D.xhr.statusText),d.default.logAction(d.default.LOG_ERROR,"Request.on"+ct.type+"()",se),D.complete(new u.default(se,$t,Ut))};x.onerror=function(ct){G(ct,"XHR error occurred",null,400)},x.onabort=function(ct){D.timedOut?G(ct,"Request aborted due to request timeout expiring",null,408):G(ct,"Request cancelled",null,400)},x.ontimeout=function(ct){G(ct,"Request timed out",null,408)};var N,B,K,V=0,tt=!1,ft=function(){if(clearTimeout(U),K=B<400,B==204){D.complete(null,null,null,null,B);return}N=D.requestMode==R.default.REQ_RECV_STREAM&&K&&f(x)},vt=function(){var ct;try{var wt=g(x,"content-type"),$t=wt?wt.indexOf("application/json")>=0:x.responseType=="text";if($t){var Ut=x.responseType==="arraybuffer"?O.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Ut.length?ct=JSON.parse(Ut):ct=Ut,tt=!0}else ct=x.response;ct.response!==void 0?(B=ct.statusCode,K=B<400,k=ct.headers,ct=ct.response):k=l(x)}catch(se){D.complete(new u.default("Malformed response body from server: "+se.message,null,400));return}if(K||E.isArray(ct)){D.complete(null,ct,k,tt,B);return}var Ht=C(ct,k);Ht||(Ht=new u.default("Error response received from server: "+B+" body was: "+O.default.Config.inspect(ct),null,B)),D.complete(Ht,ct,k,tt,B)};function gt(){for(var ct=x.responseText,wt=ct.length-1,$t,Ut;V<wt&&($t=ct.indexOf(`
`,V))>-1;)Ut=ct.slice(V,$t),V=$t+1,Rt(Ut)}var Rt=function(ct){try{ct=JSON.parse(ct)}catch(wt){D.complete(new u.default("Malformed response body from server: "+wt.message,null,400));return}D.emit("data",ct)},xt=function(){gt(),D.streamComplete=!0,O.default.Config.nextTick(function(){D.complete()})};x.onreadystatechange=function(){var ct=x.readyState;ct<3||x.status!==0&&(B===void 0&&(B=x.status,B===1223&&(B=204),ft()),ct==3&&N?gt():ct==4&&(N?xt():vt()))},x.send(W)},P.prototype.dispose=function(){var D=this.xhr;if(D){D.onreadystatechange=D.onerror=D.onabort=D.ontimeout=w,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||D.abort()}delete b[this.id]},P}(T.default);c.default=s}).call(this,r(12))},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(3)),E=p.__importStar(r(2)),T=p.__importDefault(r(22)),u=p.__importDefault(r(5)),d=p.__importDefault(r(43)),A=r(13),R=r(32),O=p.__importDefault(r(17)),a=p.__importDefault(r(0)),C=Math.pow(2,17);function w(){}function _(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function b(H){return!!H.connection}function m(H){return E.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new u.default(E.inspectError(H),H.code||40170,H.statusCode||401)}var S=function(H){return a.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):A.stringify(R.parse(H))},o=function(H,U){if(a.default.Config.createHmac){var I=a.default.Config.createHmac("SHA256",U);return I.update(H),I.digest("base64")}return A.stringify(d.default(H,U))};function g(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var U={},I=E.keysArray(H,!0);if(!I)return"";I.sort();for(var x=0;x<I.length;x++)U[I[x]]=H[I[x]].sort();return JSON.stringify(U)}function f(H){if(H.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var U="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",U),new Error(U)}}function l(H){return"useTokenAuth"in H&&!H.useTokenAuth}function s(H){return H.useTokenAuth||!l(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function y(H){return!H.key&&!H.authCallback&&!H.authUrl}var P=0;function D(){return P++}var k=function(){function H(U,I){if(this.authOptions={},this.client=U,this.tokenParams=I.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,s(I)){if(I.key&&!o){var x="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new Error(x)}y(I)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(I.defaultTokenParams,I),f(this.authOptions)}else{if(!I.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new u.default(x,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(I)}}return H.prototype.authorize=function(U,I,x){var z=this,W;if(typeof U=="function"&&!x?(x=U,W=U=null):typeof I=="function"&&!x?(x=I,W=null):W=I,!x&&this.client.options.promises)return E.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new u.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),E.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(U,W,function(Q,Z){if(Q){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize(Q),x==null||x(Q);return}b(z.client)?z.client.connection.connectionManager.onAuthUpdated(Z,x||w):x==null||x(null,Z)})},H.prototype.authorise=function(U,I,x){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(U,I,x)},H.prototype._forceNewToken=function(U,I,x){var z=this;this.tokenDetails=null,this._saveTokenOptions(U,I),f(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,Q){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,x(W,Q)})},H.prototype.requestToken=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return E.promisify(this,"requestToken",arguments);I=I||this.authOptions,U=U||E.copy(this.tokenParams);var W=x||w,Q,Z=this.client;if(I.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),Q=I.authCallback;else if(I.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),Q=function(V,tt){var ft=E.mixin({accept:"application/json, text/plain"},I.authHeaders),vt=I.authMethod&&I.authMethod.toLowerCase()==="post",gt,Rt=I.authUrl.indexOf("?");Rt>-1&&(gt=E.parseQueryString(I.authUrl.slice(Rt)),I.authUrl=I.authUrl.slice(0,Rt),vt||(I.authParams=E.mixin(gt,I.authParams)));var xt=E.mixin({},I.authParams||{},V),ct=function(Ut,Ht,se,X){var rt;if(Ut?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+E.inspectError(Ut)):(rt=se["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+rt+"; body: "+E.inspectBody(Ht))),Ut||X)return tt(Ut,Ht);if(a.default.BufferUtils.isBuffer(Ht)&&(Ht=Ht.toString()),!rt){tt(new u.default("authUrl response is missing a content-type header",40170,401));return}var ut=rt.indexOf("application/json")>-1,ht=rt.indexOf("text/plain")>-1||rt.indexOf("application/jwt")>-1;if(!ut&&!ht){tt(new u.default("authUrl responded with unacceptable content-type "+rt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ut){if(Ht.length>C){tt(new u.default("authUrl response exceeded max permitted length",40170,401));return}try{Ht=JSON.parse(Ht)}catch(Tt){tt(new u.default("Unexpected error processing authURL response; err = "+Tt.message,40170,401));return}}tt(null,Ht,rt)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+I.authUrl+"; Params: "+JSON.stringify(xt)+"; method: "+(vt?"POST":"GET")),vt){var wt=ft||{};wt["content-type"]="application/x-www-form-urlencoded";var $t=E.toQueryString(xt).slice(1);z.client.http.doUri(O.default.Post,Z,I.authUrl,wt,$t,gt,ct)}else z.client.http.doUri(O.default.Get,Z,I.authUrl,ft||{},null,xt,ct)};else if(I.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),Q=function(V,tt){z.createTokenRequest(V,I,tt)};else{var $="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new u.default($,40171,403));return}"capability"in U&&(U.capability=g(U.capability));var G=function(V,tt){var ft=V.keyName,vt="/keys/"+ft+"/requestToken",gt=function(xt){return Z.baseUri(xt)+vt},Rt=E.defaultPostHeaders();I.requestHeaders&&E.mixin(Rt,I.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+vt+"; Token params: "+JSON.stringify(V)),z.client.http.do(O.default.Post,Z,gt,Rt,JSON.stringify(V),null,tt)},N=!1,B=this.client.options.timeouts.realtimeRequestTimeout,K=setTimeout(function(){N=!0;var V="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",V),W(new u.default(V,40170,401))},B);Q(U,function(V,tt,ft){if(!N){if(clearTimeout(K),V){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+E.inspectError(V)),W(m(V));return}if(typeof tt=="string"){tt.length===0?W(new u.default("Token string is empty",40170,401)):tt.length>C?W(new u.default("Token string exceeded max permitted length (was "+tt.length+" bytes)",40170,401)):tt==="undefined"||tt==="null"?W(new u.default("Token string was literal null/undefined",40170,401)):tt[0]==="{"&&!(ft&&ft.indexOf("application/jwt")>-1)?W(new u.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:tt});return}if(typeof tt!="object"){var vt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof tt;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",vt),W(new u.default(vt,40170,401));return}var gt=JSON.stringify(tt).length;if(gt>C&&!I.suppressMaxLengthCheck){W(new u.default("Token request/details object exceeded max permitted stringified size (was "+gt+" bytes)",40170,401));return}if("issued"in tt){W(null,tt);return}if(!("keyName"in tt)){var vt="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",vt),W(new u.default(vt,40170,401));return}G(tt,function(Rt,xt,ct,wt){if(Rt){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+E.inspectError(Rt)),W(m(Rt));return}wt||(xt=JSON.parse(xt)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,xt)})}})},H.prototype.createTokenRequest=function(U,I,x){var z=this;if(typeof U=="function"&&!x?(x=U,I=U=null):typeof I=="function"&&!x&&(x=I,I=null),!x&&this.client.options.promises)return E.promisify(this,"createTokenRequest",arguments);I=I||this.authOptions,U=U||E.copy(this.tokenParams);var W=I.key;if(!W){x(new u.default("No key specified",40101,403));return}var Q=W.split(":"),Z=Q[0],$=Q[1];if(!$){x(new u.default("Invalid key specified",40101,403));return}if(U.clientId===""){x(new u.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in U&&(U.capability=g(U.capability));var G=E.mixin({keyName:Z},U),N=U.clientId||"",B=U.ttl||"",K=U.capability||"";(function(V){if(G.timestamp){V();return}z.getTimestamp(I&&I.queryTime,function(tt,ft){if(tt){x(tt);return}G.timestamp=ft,V()})})(function(){var V=G.nonce||(G.nonce=_()),tt=G.timestamp,ft=G.keyName+`
`+B+`
`+K+`
`+N+`
`+tt+`
`+V+`
`;G.mac=G.mac||o(ft,$),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(U){this.method=="basic"?U(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(U){this.method=="basic"?U(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(I,x){if(I){U(I);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{authorization:"Bearer "+S(x.token)})})},H.prototype.getTimestamp=function(U,I){!this.isTimeOffsetSet()&&(U||this.authOptions.queryTime)?this.client.time(I):I(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return E.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(U){this.method="basic",this.key=U.key,this.basicKey=S(U.key),this.authOptions=U||{},"clientId"in U&&this._userSetClientId(U.clientId)},H.prototype._saveTokenOptions=function(U,I){this.method="token",U&&(this.tokenParams=U),I&&(I.token&&(I.tokenDetails=typeof I.token=="string"?{token:I.token}:I.token),I.tokenDetails&&(this.tokenDetails=I.tokenDetails),"clientId"in I&&this._userSetClientId(I.clientId),this.authOptions=I)},H.prototype._ensureValidAuthCredentials=function(U,I){var x=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){I(new u.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),I(null,z);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=T.default.create())).push(I),!(this.currentTokenRequestId!==null&&!U)){var W=this.currentTokenRequestId=D();this.requestToken(this.tokenParams,this.authOptions,function(Q,Z){if(x.currentTokenRequestId>W){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var $=x.waitingForTokenRequest||w;if(x.waitingForTokenRequest=null,Q){$(Q);return}$(null,x.tokenDetails=Z)})}},H.prototype._userSetClientId=function(U){if(typeof U=="string"||U===null){if(U==="*")throw new u.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var I=this._uncheckedSetClientId(U);if(I)throw I}else throw new u.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(U){if(this._tokenClientIdMismatch(U)){var I="Unexpected clientId mismatch: client has "+this.clientId+", requested "+U,x=new u.default(I,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",I),x}else return this.clientId=this.tokenParams.clientId=U,null},H.prototype._tokenClientIdMismatch=function(U){return!!(this.clientId&&this.clientId!=="*"&&U&&U!=="*"&&this.clientId!==U)},H.isTokenErr=function(U){return U.code&&U.code>=40140&&U.code<40150},H}();c.default=k},function(v,c,r){"use strict";c.__esModule=!0;var p;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(p||(p={})),c.default=p},function(v,c,r){"use strict";c.__esModule=!0,c.HttpPaginatedResponse=c.PaginatedResult=void 0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(3)),T=p.__importDefault(r(24));function u(C){var w=C.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&i.parseQueryString(w[2])}function d(C){typeof C=="string"&&(C=C.split(","));for(var w={},_=0;_<C.length;_++){var b=C[_].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(b){var m=u(b[1]);m&&(w[b[2]]=m)}}return w}function A(C,w,_){return!(_&&(w||typeof C.code=="number"))}var R=function(){function C(w,_,b,m,S,o){this.rest=w,this.path=_,this.headers=b,this.envelope=m!=null?m:null,this.bodyHandler=S,this.useHttpPaginatedResponse=o||!1}return C.prototype.get=function(w,_){var b=this;T.default.get(this.rest,this.path,this.headers,w,this.envelope,function(m,S,o,g,f){b.handlePage(m,S,o,g,f,_)})},C.prototype.delete=function(w,_){var b=this;T.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(m,S,o,g,f){b.handlePage(m,S,o,g,f,_)})},C.prototype.post=function(w,_,b){var m=this;T.default.post(this.rest,this.path,_,this.headers,w,this.envelope,function(S,o,g,f,l){b&&m.handlePage(S,o,g,f,l,b)})},C.prototype.put=function(w,_,b){var m=this;T.default.put(this.rest,this.path,_,this.headers,w,this.envelope,function(S,o,g,f,l){b&&m.handlePage(S,o,g,f,l,b)})},C.prototype.patch=function(w,_,b){var m=this;T.default.patch(this.rest,this.path,_,this.headers,w,this.envelope,function(S,o,g,f,l){b&&m.handlePage(S,o,g,f,l,b)})},C.prototype.handlePage=function(w,_,b,m,S,o){if(w&&A(w,_,this.useHttpPaginatedResponse)){E.default.logAction(E.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(w)),o==null||o(w);return}var g,f,l;try{g=this.bodyHandler(_,b||{},m)}catch(s){o==null||o(w||s);return}b&&(f=b.Link||b.link)&&(l=d(f)),this.useHttpPaginatedResponse?o(null,new a(this,g,b||{},S,l,w)):o(null,new O(this,g,l))},C}(),O=function(){function C(w,_,b){var m=this;this.resource=w,this.items=_;var S=this;b&&("first"in b&&(this.first=function(o){if(!o&&S.resource.rest.options.promises)return i.promisify(S,"first",[]);S.get(b.first,o)}),"current"in b&&(this.current=function(o){if(!o&&S.resource.rest.options.promises)return i.promisify(S,"current",[]);S.get(b.current,o)}),this.next=function(o){if(!o&&S.resource.rest.options.promises)return i.promisify(S,"next",[]);"next"in b?S.get(b.next,o):o(null)},this.hasNext=function(){return"next"in b},this.isLast=function(){var o;return!(!((o=m.hasNext)===null||o===void 0)&&o.call(m))})}return C.prototype.get=function(w,_){var b=this.resource;T.default.get(b.rest,b.path,b.headers,w,b.envelope,function(m,S,o,g,f){b.handlePage(m,S,o,g,f,_)})},C}();c.PaginatedResult=O;var a=function(C){p.__extends(w,C);function w(_,b,m,S,o,g){var f=C.call(this,_,b,o)||this;return f.statusCode=S,f.success=S<300&&S>=200,f.headers=m,f.errorCode=g&&g.code,f.errorMessage=g&&g.message,f}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(O);c.HttpPaginatedResponse=a,c.default=R},function(v,c,r){"use strict";c.__esModule=!0,c.isRetriable=void 0;var p=r(1),i=p.__importDefault(r(5)),E={disconnected:i.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:i.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:i.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:i.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:i.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:i.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:i.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function T(u){if(!u.statusCode||!u.code||u.statusCode>=500)return!0;var d=!1;return Object.values(E).forEach(function(A){A.code&&A.code==u.code&&(d=!0)}),d}c.isRetriable=T,c.default=E},function(v,c,r){"use strict";c.__esModule=!0;var p;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(p||(p={})),c.default=p},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(4),r(58),r(13),r(39),r(31),r(23),r(27),r(28),r(59),r(60))})(this,function(p){return p})},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(3)),E=function(){function T(u){this.members=u||[]}return T.prototype.call=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];for(var A=0,R=this.members;A<R.length;A++){var O=R[A];if(O)try{O.apply(void 0,u)}catch(a){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},T.prototype.push=function(){for(var u,d=[],A=0;A<arguments.length;A++)d[A]=arguments[A];(u=this.members).push.apply(u,d)},T.create=function(u){var d=new T(u);return Object.assign(function(){for(var A=[],R=0;R<arguments.length;R++)A[R]=arguments[R];return d.call.apply(d,A)},{push:function(A){return d.push(A)}})},T}();c.default=E},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){(function(){var i=p,E=i.lib,T=E.Base,u=i.enc,d=u.Utf8,A=i.algo,R=A.HMAC=T.extend({init:function(O,a){O=this._hasher=new O.init,typeof a=="string"&&(a=d.parse(a));var C=O.blockSize,w=C*4;a.sigBytes>w&&(a=O.finalize(a)),a.clamp();for(var _=this._oKey=a.clone(),b=this._iKey=a.clone(),m=_.words,S=b.words,o=0;o<C;o++)m[o]^=1549556828,S[o]^=909522486;_.sigBytes=b.sigBytes=w,this.reset()},reset:function(){var O=this._hasher;O.reset(),O.update(this._iKey)},update:function(O){return this._hasher.update(O),this},finalize:function(O){var a=this._hasher,C=a.finalize(O);a.reset();var w=a.finalize(this._oKey.clone().concat(C));return w}})})()})},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(0)),E=p.__importStar(r(2)),T=p.__importDefault(r(3)),u=p.__importDefault(r(16)),d=p.__importDefault(r(17)),A=p.__importDefault(r(5));function R(b,m,S,o,g){b.http.supportsAuthHeaders?b.auth.getAuthHeaders(function(f,l){f?o(f):g(E.mixin(l,m),S)}):b.auth.getAuthParams(function(f,l){f?o(f):g(m,E.mixin(l,S))})}function O(b,m){return function(S,o,g,f,l){if(S&&!o){b(S);return}if(!f)try{o=E.decodeBody(o,m)}catch(H){b(H);return}if(!o){b(new A.default("unenvelope(): Response body is missing",null));return}var s=o,y=s.statusCode,P=s.response,D=s.headers;if(y===void 0){b(S,o,g,!0,l);return}if(y<200||y>=300){var k=P&&P.error||S;k||(k=new Error("Error in unenveloping "+o),k.statusCode=y),b(k,P,D,!0,y);return}b(S,P,D,!0,y)}}function a(b){var m=[];if(b)for(var S in b)m.push(S+"="+b[S]);return m.join("&")}function C(b,m){return b+(m?"?":"")+a(m)}function w(b,m,S,o){return function(g,f,l,s,y){g?T.default.logAction(T.default.LOG_MICRO,"Resource."+m+"()","Received Error; "+C(S,o)+"; Error: "+E.inspectError(g)):T.default.logAction(T.default.LOG_MICRO,"Resource."+m+"()","Received; "+C(S,o)+"; Headers: "+a(l)+"; StatusCode: "+y+"; Body: "+(i.default.BufferUtils.isBuffer(f)?f.toString():f)),b&&b(g,f,l,s,y)}}var _=function(){function b(){}return b.get=function(m,S,o,g,f,l){b.do(d.default.Get,m,S,null,o,g,f,l)},b.delete=function(m,S,o,g,f,l){b.do(d.default.Delete,m,S,null,o,g,f,l)},b.post=function(m,S,o,g,f,l,s){b.do(d.default.Post,m,S,o,g,f,l,s)},b.patch=function(m,S,o,g,f,l,s){b.do(d.default.Patch,m,S,o,g,f,l,s)},b.put=function(m,S,o,g,f,l,s){b.do(d.default.Put,m,S,o,g,f,l,s)},b.do=function(m,S,o,g,f,l,s,y){T.default.shouldLog(T.default.LOG_MICRO)&&(y=w(y,m,o,l)),s&&(y=y&&O(y,s),(l=l||{}).envelope=s);function P(D,k){var H;if(T.default.shouldLog(T.default.LOG_MICRO)&&T.default.logAction(T.default.LOG_MICRO,"Resource."+m+"()","Sending; "+C(o,k)),T.default.shouldLog(T.default.LOG_MICRO)){var U=g;if(((H=D["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{U=i.default.Config.msgpack.decode(g)}catch(I){T.default.logAction(T.default.LOG_MICRO,"Resource."+m+"()","Sending MsgPack Decoding Error: "+E.inspectError(I))}T.default.logAction(T.default.LOG_MICRO,"Resource."+m+"()","Sending; "+C(o,k)+"; Body: "+U)}S.http.do(m,S,o,D,g,k,function(I,x,z,W,Q){if(I&&u.default.isTokenErr(I)){S.auth.authorize(null,null,function(Z){if(Z){y(Z);return}R(S,z,k,y,P)});return}y(I,x,z,W,Q)})}R(S,f,l,y,P)},b}();c.default=_},function(v,c,r){"use strict";(function(p){c.__esModule=!0,c.TransportParams=void 0;var i=r(1),E=i.__importDefault(r(10)),T=i.__importStar(r(2)),u=i.__importStar(r(51)),d=i.__importDefault(r(8)),A=i.__importDefault(r(0)),R=i.__importDefault(r(7)),O=i.__importDefault(r(35)),a=i.__importDefault(r(3)),C=i.__importDefault(r(36)),w=i.__importStar(r(19)),_=i.__importDefault(r(5)),b=i.__importDefault(r(16)),m=i.__importDefault(r(9)),S=i.__importDefault(r(22)),o=i.__importDefault(r(52)),g=i.__importDefault(r(26)),f=i.__importDefault(r(53)),l=function(){var Z;return typeof A.default.WebStorage!="undefined"&&((Z=A.default.WebStorage)===null||Z===void 0?void 0:Z.localSupported)},s=function(){var Z;return typeof A.default.WebStorage!="undefined"&&((Z=A.default.WebStorage)===null||Z===void 0?void 0:Z.sessionSupported)},y=E.default.Action,P=function(){},D="ably-transport-preference",k="ably-connection-recovery";function H(){var Z,$;return s()&&(($=(Z=A.default.WebStorage)===null||Z===void 0?void 0:Z.getSession)===null||$===void 0?void 0:$.call(Z,k))}function U(Z){var $,G;return s()&&((G=($=A.default.WebStorage)===null||$===void 0?void 0:$.setSession)===null||G===void 0?void 0:G.call($,k,Z))}function I(){var Z,$;return s()&&(($=(Z=A.default.WebStorage)===null||Z===void 0?void 0:Z.removeSession)===null||$===void 0?void 0:$.call(Z,k))}function x(Z,$){return T.arrIndexOf(A.default.Defaults.transportPreferenceOrder,Z.shortName)>T.arrIndexOf(A.default.Defaults.transportPreferenceOrder,$.shortName)}function z(Z,$,G){var N;if(Z.channel!==$.channel||(N=Z.action)!==y.PRESENCE&&N!==y.MESSAGE||N!==$.action)return!1;var B=N===y.PRESENCE?"presence":"messages",K=Z[B].concat($[B]),V=m.default.getMessagesSize(K);return V>G||!T.allSame(K,"clientId")||!T.arrEvery(K,function(tt){return!tt.id})?!1:(Z[B]=K,!0)}var W=function(){function Z($,G,N,B){this.options=$,this.host=G,this.mode=N,this.connectionKey=B,this.format=$.useBinaryProtocol?T.Format.msgpack:T.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return Z.prototype.getConnectParams=function($){var G=$?T.copy($):{},N=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var B=N.recover.split(":");if(B){G.recover=B[0];var K=B[1];isNaN(Number(K))?G.timeSerial=K:G.connectionSerial=K}break}default:}return N.clientId!==void 0&&(G.clientId=N.clientId),N.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=d.default.apiVersion,G.agent=encodeURIComponent(d.default.agent),N.transportParams!==void 0&&T.mixin(G,N.transportParams),G},Z.prototype.toString=function(){var $="[mode="+this.mode;return this.host&&($+=",host="+this.host),this.connectionKey&&($+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&($+=",connectionSerial="+this.connectionSerial),this.timeSerial&&($+=",timeSerial="+this.timeSerial),this.format&&($+=",format="+this.format),$+="]",$},Z}();c.TransportParams=W;var Q=function(Z){i.__extends($,Z);function $(G,N){var B=Z.call(this)||this;B.disconnectedRetryCount=0,$.initTransports(),B.realtime=G,B.options=N;var K=N.timeouts,V=K.preferenceConnectTimeout+K.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:K.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new O.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.timeSerial=void 0,B.connectionSerial=void 0,B.connectionStateTtl=K.connectionStateTtl,B.maxIdleInterval=null,B.transports=T.intersect(N.transports||d.default.defaultTransports,$.supportedTransports),B.baseTransport=T.intersect(d.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=T.intersect(B.transports,d.default.upgradeTransports),B.transportPreference=null,B.httpHosts=d.default.getHosts(N),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.mostRecentMsg=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||d.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var tt="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",tt),new Error(tt)}var ft=A.default.Config.addEventListener;return ft&&(s()&&typeof N.recover=="function"&&ft("beforeunload",B.persistConnection.bind(B)),N.closeOnUnload===!0&&ft("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),ft("online",function(){(B.state==B.states.disconnected||B.state==B.states.suspended)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),B.requestState({state:"connecting"}))}),ft("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),B.disconnectAllTransports())})),B}return $.initTransports=function(){o.default($),T.arrForEach(A.default.Transports,function(G){G($)})},$.prototype.createTransportParams=function(G,N){var B=new W(this.options,G,N,this.connectionKey);return this.timeSerial?B.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(B.connectionSerial=this.connectionSerial),B},$.prototype.getTransportParams=function(G){var N=this,B=function(K){if(N.connectionKey){K("resume");return}if(typeof N.options.recover=="string"){K("recover");return}var V=N.options.recover,tt=H();if(tt&&typeof V=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(tt,function(ft){ft?(N.options.recover=tt.recoveryKey,K("recover")):K("clean")});return}K("clean")};B(function(K){var V=N.createTransportParams(null,K);if(K==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var tt=N.options.recover.split(":");tt&&tt[2]&&(N.msgSerial=Number(tt[2]))}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());G(V)})},$.prototype.tryATransport=function(G,N,B){var K=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),g.default.tryConnect($.supportedTransports[N],this,this.realtime.auth,G,function(V,tt){var ft=K.state;if(ft==K.states.closing||ft==K.states.closed||ft==K.states.failed){tt&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ft.state+" while we were attempting the transport; closing "+tt),tt.close()),B(!0);return}if(V){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+V.event+", err: "+V.error.toString()),b.default.isTokenErr(V.error)&&!(K.errorReason&&b.default.isTokenErr(K.errorReason))?(K.errorReason=V.error,K.realtime.auth._forceNewToken(null,null,function(vt){if(vt){K.actOnErrorFromAuthorize(vt);return}K.tryATransport(G,N,B)})):V.event==="failed"?(K.notifyState({state:"failed",error:V.error}),B(!0)):V.event==="disconnected"&&(w.isRetriable(V.error)?B(!1):(K.notifyState({state:K.states.connecting.failState,error:V.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),K.setTransportPending(tt,G),B(null,tt)})},$.prototype.setTransportPending=function(G,N){var B=this,K=N.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+K),T.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var V=A.default.Defaults.transportPreferenceOrder[A.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ft,vt,gt,Rt){K=="upgrade"?G.shortName!==V&&T.arrIn(B.getUpgradePossibilities(),V)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(ft,G,vt,gt,Rt)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(ft,G,vt,gt,Rt):(B.activateTransport(ft,G,vt,gt,Rt),A.default.Config.nextTick(function(){B.connectImpl(N)})),K==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var tt=this;G.on(["disconnected","closed","failed"],function(ft){tt.deactivateTransport(G,this.event,ft)}),this.emit("transport.pending",G)},$.prototype.scheduleTransportActivation=function(G,N,B,K,V){var tt=this,ft=this.activeProtocol&&this.activeProtocol.getTransport(),vt=function(){N.disconnect(),T.arrDeleteValue(tt.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),vt();return}if(ft&&!x(N,ft)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+ft.shortName+" - abandoning upgrade"),vt();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var gt=function(Rt){var xt;if(Rt){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+N+"; err = "+Rt);return}if(!N.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),vt();return}if(tt.state===tt.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),tt.state=tt.states.synchronizing,xt=tt.activeProtocol;else if(tt.state!==tt.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+tt.state.state+(tt.state===tt.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),vt();return}var ct=B!==tt.connectionId,wt=ct?V:tt;ct&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(tt.timeSerial||tt.connectionSerial)+" to "+(wt.timeSerial||wt.connectionSerial)+"; upgrade error was "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N),tt.sync(N,wt,function($t,Ut,Ht){if($t){tt.state===tt.states.synchronizing&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+N+"; err = "+$t),tt.disconnectAllTransports());return}var se=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),tt.activateTransport(G,N,Ut,K,Ht),tt.state===tt.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),tt.state=tt.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+tt.state.state+", so leaving unchanged"),tt.state.sendEvents&&tt.sendQueuedMessages()};xt?xt.onceIdle(se):se()})};ft?this.realtime.channels.onceNopending(gt):gt()},$.prototype.activateTransport=function(G,N,B,K,V){var tt=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),G&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),K&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(K)),V&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(V.timeSerial||V.connectionSerial)),this.persistTransportPreference(N);var ft=this.state,vt=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ft.state),ft.state==this.states.closing.state||ft.state==this.states.closed.state||ft.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(T.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var gt=this.activeProtocol;this.activeProtocol=new u.default(N),this.host=N.params.host;var Rt=K.connectionKey;if(Rt&&this.connectionKey!=Rt&&this.setConnection(B,K,V,!!G),this.onConnectionDetailsUpdate(K,N),A.default.Config.nextTick(function(){N.on("connected",function(ct,wt,$t){tt.onConnectionDetailsUpdate($t,N),tt.emit("update",new C.default(vt,vt,null,ct))})}),ft.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new C.default(vt,vt,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",N),gt)if(gt.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+gt.transport.shortName+", new one is "+N.shortName+") finishing with "+gt.messageQueue.count()+" messages still pending"),gt.transport===N){var xt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",xt)}else gt.finish();return T.safeArrForEach(this.pendingTransports,function(ct){if(ct===N){var wt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",wt),T.arrDeleteValue(tt.pendingTransports,N)}else ct.disconnect()}),T.safeArrForEach(this.proposedTransports,function(ct){ct===N?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),T.arrDeleteValue(tt.proposedTransports,N)):ct.dispose()}),!0},$.prototype.deactivateTransport=function(G,N,B){var K=this.activeProtocol,V=K&&K.getTransport()===G,tt=T.arrDeleteValue(this.pendingTransports,G),ft=T.arrDeleteValue(this.proposedTransports,G),vt=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(V?"; was active":tt?"; was pending":ft?"; was proposed":"")+(vt?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),V&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(K.getPendingMessages()),A.default.Config.nextTick(function(){K.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),V&&vt||V&&N==="failed"||N==="closed"||K===null&&tt&&this.pendingTransports.length===0){if(N==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:B,retryImmediately:!0});return}var gt=N==="failed"&&b.default.isTokenErr(B)?"disconnected":N;this.notifyState({state:gt,error:B});return}V&&N==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},$.prototype.noTransportsScheduledForActivation=function(){return T.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},$.prototype.sync=function(G,N,B){var K=setTimeout(function(){G.off("sync"),B(new _.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),V=E.default.fromValues({action:y.SYNC,connectionKey:this.connectionKey});N.timeSerial?V.timeSerial=N.timeSerial:N.connectionSerial!==void 0&&(V.connectionSerial=N.connectionSerial),G.send(V),G.once("sync",function(tt,ft){clearTimeout(K),B(null,tt,ft)})},$.prototype.setConnection=function(G,N,B,K){var V=this,tt=this.connectionId,ft=tt&&tt!==G,vt=!tt&&K;(ft||vt)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),A.default.Config.nextTick(function(){V.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){V.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=N.connectionKey;var gt=ft||!tt;this.setConnectionSerial(B,gt,!1)},$.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},$.prototype.setConnectionSerial=function(G,N,B){var K=G.timeSerial,V=G.connectionSerial;if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+V+"; timeSerial = "+K+"; force = "+N+"; previous = "+this.connectionSerial),K!==void 0){if(K<=this.timeSerial&&!N)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+K+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=K,this.setRecoveryKey();return}if(V!==void 0){if(V<=this.connectionSerial&&!N)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+V+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=V,this.setRecoveryKey()}},$.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},$.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},$.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},$.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=T.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},$.prototype.persistConnection=function(){if(s()){var G=this.realtime.connection.recoveryKey;G&&U({recoveryKey:G,disconnectedAt:T.now(),location:p.location,clientId:this.realtime.auth.clientId})}},$.prototype.unpersistConnection=function(){I()},$.prototype.getError=function(){return this.errorReason||this.getStateError()},$.prototype.getStateError=function(){return w.default[this.state.state]},$.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},$.prototype.enactStateChange=function(G){var N=G.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(N,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var B=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},$.prototype.startTransitionTimer=function(G){var N=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),N.notifyState({state:G.failState}))},G.retryDelay)},$.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},$.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},$.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},$.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},$.prototype.startRetryTimer=function(G){var N=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},G)},$.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},$.prototype.notifyState=function(G){var N=this,B=G.state,K=B==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&b.default.isTokenErr(G.error)&&!(this.errorReason&&b.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+B+(K?"; will retry connection immediately":"")),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(B==="suspended"||B==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var V=this.states[G.state],tt=V.retryDelay;V.state==="disconnected"&&(this.disconnectedRetryCount++,tt=V.retryDelay*T.getBackoffCoefficient(this.disconnectedRetryCount)*T.getJitterCoefficient());var ft=new C.default(this.state.state,V.state,tt,G.error||w.default[V.state]);if(K){var vt=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=T.now(),N.requestState({state:"connecting"}))},gt=this.lastAutoReconnectAttempt&&T.now()-this.lastAutoReconnectAttempt+1;gt&&gt<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+gt+"ms ago, waiting another "+(1e3-gt)+"ms before trying again"),setTimeout(vt,1e3-gt)):A.default.Config.nextTick(vt)}else(B==="disconnected"||B==="suspended")&&this.startRetryTimer(tt);(B==="disconnected"&&!K||B==="suspended"||V.terminal)&&A.default.Config.nextTick(function(){N.disconnectAllTransports()}),B=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ft),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(B,ft.reason),this.failQueuedMessages(ft.reason))}},$.prototype.requestState=function(G){var N=this,B=G.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+B+"; current state: "+this.state.state),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(B),!(B=="connecting"&&this.state.state=="connected")&&!(B=="closing"&&this.state.state=="closed"))){var K=this.states[B],V=new C.default(this.state.state,K.state,null,G.error||w.default[K.state]);this.enactStateChange(V),B=="connecting"&&A.default.Config.nextTick(function(){N.startConnect()}),B=="closing"&&this.closeImpl()}},$.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,B=++this.connectCounter,K=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(tt){B===G.connectCounter&&G.connectImpl(tt,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")K();else{var V=function(tt){B===G.connectCounter&&(tt?G.actOnErrorFromAuthorize(tt):K())};this.errorReason&&b.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,V):N._ensureValidAuthCredentials(!1,V)}},$.prototype.connectImpl=function(G,N){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,N)},$.prototype.connectPreference=function(G){var N=this,B=this.getTransportPreference(),K=!1;T.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(G)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var V=setTimeout(function(){K=!0,N.state.state!==N.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),N.disconnectAllTransports(),N.unpersistTransportPreference()),N.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,B,function(tt,ft){clearTimeout(V),K&&ft?(ft.off(),ft.disconnect(),T.arrDeleteValue(N.pendingTransports,ft)):!ft&&!tt&&(N.unpersistTransportPreference(),N.connectImpl(G))})},$.prototype.connectBase=function(G,N){var B=this,K=function(gt){B.notifyState({state:B.states.connecting.failState,error:gt})},V=this.httpHosts.slice(),tt=function(gt,Rt){N===B.connectCounter&&!Rt&&!gt&&vt()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ft=V.shift();if(!ft){K(new _.default("Unable to connect (no available host)",80003,404));return}G.host=ft;var vt=function(){if(!V.length){K(new _.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){K(new _.default("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(gt,Rt){if(N===B.connectCounter){if(gt){K(gt);return}if(!Rt){K(new _.default("Unable to connect (network unreachable)",80003,404));return}G.host=T.arrPopRandomElement(V),B.tryATransport(G,B.baseTransport,tt)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,vt();return}this.tryATransport(G,this.baseTransport,tt)},$.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,N=T.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(N+1)},$.prototype.upgradeIfNeeded=function(G){var N=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+A.default.Config.inspect(B)),B.length&&T.arrForEach(B,function(K){var V=N.createTransportParams(G.host,"upgrade");N.tryATransport(V,K,P)})},$.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),T.safeArrForEach(this.pendingTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),T.safeArrForEach(this.proposedTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},$.prototype.onAuthUpdated=function(G,N){var B=this,K;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;A.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(V)})}var tt=(K=this.activeProtocol)===null||K===void 0?void 0:K.getTransport();tt&&tt.onAuthUpdated&&tt.onAuthUpdated(G);var ft=E.default.fromValues({action:y.AUTH,auth:{accessToken:G.token}});this.send(ft);var vt=function(){B.off(gt),N(null,G)},gt=function(xt){xt.current==="failed"&&(B.off(vt),B.off(gt),N(xt.reason||B.getStateError()))};this.once("connectiondetails",vt),this.on("connectionstate",gt);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Rt=function(xt){switch(xt.current){case"connected":B.off(Rt),N(null,G);break;case"failed":case"closed":case"suspended":B.off(Rt),N(xt.reason||B.getStateError());break;default:break}};this.on("connectionstate",Rt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},$.prototype.disconnectAllTransports=function(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,T.safeArrForEach(this.pendingTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],T.safeArrForEach(this.proposedTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},$.prototype.send=function(G,N,B){B=B||P;var K=this.state;if(K.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new u.PendingMessage(G,B));return}var V=N&&K.queueEvents||K.forceQueueEvents;if(!V){var tt="rejecting event, queueEvent was "+N+", state was "+K.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",tt),B(this.errorReason||new _.default(tt,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+E.default.stringify(G)),this.queue(G,B)},$.prototype.sendImpl=function(G){var N=G.message;G.ackRequired&&!G.sendAttempted&&(N.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},$.prototype.queue=function(G,N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),K=this.options.maxMessageSize;B&&!B.sendAttempted&&z(B.message,G,K)?(B.merged||(B.callback=S.default.create([B.callback]),B.merged=!0),B.callback.push(N)):this.queuedMessages.push(new u.PendingMessage(G,N))},$.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},$.prototype.queuePendingMessages=function(G){G&&G.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},$.prototype.failQueuedMessages=function(G){var N=this.queuedMessages.count();N>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+T.inspectError(G)),this.queuedMessages.completeAllMessages(G))},$.prototype.onChannelMessage=function(G,N){var B=this.activeProtocol&&N===this.activeProtocol.getTransport(),K=T.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing,V=G.action===y.MESSAGE||G.action===y.PRESENCE;if(B||K){if(V){var tt=this.setConnectionSerial(G,!1,!0);if(tt)return;if(E.default.isDuplicate(G,this.mostRecentMsg)){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else T.arrIndexOf([y.ACK,y.NACK,y.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},$.prototype.ping=function(G,N){var B=this;if(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var K=function(){G.off("heartbeat",ft),N(new _.default("Timeout waiting for heartbeat response",5e4,500))},V=T.now(),tt=T.cheapRandStr(),ft=function(ct){if(ct===tt){G.off("heartbeat",ft),clearTimeout(vt);var wt=T.now()-V;N(null,wt)}},vt=setTimeout(K,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ft),G.ping(tt);return}if(this.state.state!=="connected"){N(new _.default("Unable to ping service; not connected",4e4,400));return}var gt=!1,Rt=function(ct,wt){B.off("transport.active",xt),gt||(gt=!0,N(ct,wt))},xt=function(){gt||(gt=!0,A.default.Config.nextTick(function(){B.ping(null,N)}))};this.on("transport.active",xt),this.ping(this.activeProtocol.getTransport(),Rt)},$.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},$.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},$.prototype.getTransportPreference=function(){var G,N;return this.transportPreference||l()&&((N=(G=A.default.WebStorage)===null||G===void 0?void 0:G.get)===null||N===void 0?void 0:N.call(G,D))},$.prototype.persistTransportPreference=function(G){var N,B;T.arrIn(d.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,l()&&((B=(N=A.default.WebStorage)===null||N===void 0?void 0:N.set)===null||B===void 0||B.call(N,D,G.shortName)))},$.prototype.unpersistTransportPreference=function(){var G,N;this.transportPreference=null,l()&&((N=(G=A.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||N===void 0||N.call(G,D))},$.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===f.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new _.default(N,80019,403,G)})}else{var N="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new _.default(N,80019,401,G)})}},$.prototype.onConnectionDetailsUpdate=function(G,N){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var B=G.clientId;if(B){var K=this.realtime.auth._uncheckedSetClientId(B);if(K){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",K.message),N.fail(K);return}}var V=G.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},$.supportedTransports={},$}(R.default);c.default=Q}).call(this,r(12))},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(10)),E=p.__importStar(r(2)),T=p.__importDefault(r(7)),u=p.__importDefault(r(3)),d=p.__importDefault(r(19)),A=p.__importDefault(r(5)),R=p.__importDefault(r(0)),O=i.default.Action,a=i.default.fromValues({action:O.CLOSE}),C=i.default.fromValues({action:O.DISCONNECT}),w=function(_){p.__extends(b,_);function b(m,S,o,g){var f=_.call(this)||this;return g&&(o.format=void 0,o.heartbeats=!0),f.connectionManager=m,m.registerProposedTransport(f),f.auth=S,f.params=o,f.timeouts=o.options.timeouts,f.format=o.format,f.isConnected=!1,f.isFinished=!1,f.isDisposed=!1,f.maxIdleInterval=null,f.idleTimer=null,f.lastActivity=null,f}return b.prototype.connect=function(){},b.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",d.default.closed)},b.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||d.default.disconnected)},b.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||d.default.failed)},b.prototype.finish=function(m,S){var o;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((o=this.idleTimer)!==null&&o!==void 0?o:void 0),this.idleTimer=null,this.emit(m,S),this.dispose())},b.prototype.onProtocolMessage=function(m){switch(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case O.HEARTBEAT:u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case O.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case O.CLOSED:this.onClose(m);break;case O.DISCONNECTED:this.onDisconnect(m);break;case O.ACK:this.emit("ack",m.msgSerial,m.count);break;case O.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case O.SYNC:if(m.connectionId!==void 0){this.emit("sync",m.connectionId,m);break}this.connectionManager.onChannelMessage(m,this);break;case O.AUTH:this.auth.authorize(function(S){S&&u.default.logAction(u.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+E.inspectError(S))});break;case O.ERROR:if(u.default.logAction(u.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+R.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},b.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var S=m.connectionDetails.maxIdleInterval;S&&(this.maxIdleInterval=S+this.timeouts.realtimeRequestTimeout,this.onActivity())},b.prototype.onDisconnect=function(m){var S=m&&m.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onDisconnect()","err = "+E.inspectError(S)),this.finish("disconnected",S)},b.prototype.onFatalError=function(m){var S=m&&m.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onFatalError()","err = "+E.inspectError(S)),this.finish("failed",S)},b.prototype.onClose=function(m){var S=m&&m.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onClose()","err = "+E.inspectError(S)),this.finish("closed",S)},b.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},b.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(C)},b.prototype.ping=function(m){var S={action:i.default.Action.HEARTBEAT};m&&(S.id=m),this.send(i.default.fromValues(S))},b.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},b.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=E.now(),this.setIdleTimer(this.maxIdleInterval+100))},b.prototype.setIdleTimer=function(m){var S=this;this.idleTimer||(this.idleTimer=setTimeout(function(){S.onIdleTimerExpire()},m))},b.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=E.now()-this.lastActivity,S=this.maxIdleInterval-m;if(S<=0){var o="No activity seen from realtime in "+m+"ms; assuming connection has dropped";u.default.logAction(u.default.LOG_ERROR,"Transport.onIdleTimerExpire()",o),this.disconnect(new A.default(o,80003,408))}else this.setIdleTimer(S+100)},b.tryConnect=function(m,S,o,g,f){var l=new m(S,o,g),s,y=function(D){clearTimeout(s),f({event:this.event,error:D})},P=S.options.timeouts.realtimeRequestTimeout;s=setTimeout(function(){l.off(["preconnect","disconnected","failed"]),l.dispose(),y.call({event:"disconnected"},new A.default("Timeout waiting for transport to indicate itself viable",5e4,500))},P),l.on(["failed","disconnected"],y),l.on("preconnect",function(){u.default.logAction(u.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+l),clearTimeout(s),l.off(["failed","disconnected"],y),f(null,l)}),l.connect()},b}(T.default);c.default=w},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(39),r(23))})(this,function(p){return function(){var i=p,E=i.lib,T=E.Base,u=E.WordArray,d=i.algo,A=d.MD5,R=d.EvpKDF=T.extend({cfg:T.extend({keySize:128/32,hasher:A,iterations:1}),init:function(O){this.cfg=this.cfg.extend(O)},compute:function(O,a){for(var C,w=this.cfg,_=w.hasher.create(),b=u.create(),m=b.words,S=w.keySize,o=w.iterations;m.length<S;){C&&_.update(C),C=_.update(O).finalize(a),_.reset();for(var g=1;g<o;g++)C=_.finalize(C),_.reset();b.concat(C)}return b.sigBytes=S*4,b}});i.EvpKDF=function(O,a,C){return R.create(C).compute(O,a)}}(),p.EvpKDF})},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(27))})(this,function(p){p.lib.Cipher||function(i){var E=p,T=E.lib,u=T.Base,d=T.WordArray,A=T.BufferedBlockAlgorithm,R=E.enc,O=R.Utf8,a=R.Base64,C=E.algo,w=C.EvpKDF,_=T.Cipher=A.extend({cfg:u.extend(),createEncryptor:function(I,x){return this.create(this._ENC_XFORM_MODE,I,x)},createDecryptor:function(I,x){return this.create(this._DEC_XFORM_MODE,I,x)},init:function(I,x,z){this.cfg=this.cfg.extend(z),this._xformMode=I,this._key=x,this.reset()},reset:function(){A.reset.call(this),this._doReset()},process:function(I){return this._append(I),this._process()},finalize:function(I){I&&this._append(I);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function I(x){return typeof x=="string"?U:D}return function(x){return{encrypt:function(z,W,Q){return I(W).encrypt(x,z,W,Q)},decrypt:function(z,W,Q){return I(W).decrypt(x,z,W,Q)}}}}()}),b=T.StreamCipher=_.extend({_doFinalize:function(){var I=this._process(!0);return I},blockSize:1}),m=E.mode={},S=T.BlockCipherMode=u.extend({createEncryptor:function(I,x){return this.Encryptor.create(I,x)},createDecryptor:function(I,x){return this.Decryptor.create(I,x)},init:function(I,x){this._cipher=I,this._iv=x}}),o=m.CBC=function(){var I=S.extend();I.Encryptor=I.extend({processBlock:function(z,W){var Q=this._cipher,Z=Q.blockSize;x.call(this,z,W,Z),Q.encryptBlock(z,W),this._prevBlock=z.slice(W,W+Z)}}),I.Decryptor=I.extend({processBlock:function(z,W){var Q=this._cipher,Z=Q.blockSize,$=z.slice(W,W+Z);Q.decryptBlock(z,W),x.call(this,z,W,Z),this._prevBlock=$}});function x(z,W,Q){var Z,$=this._iv;$?(Z=$,this._iv=i):Z=this._prevBlock;for(var G=0;G<Q;G++)z[W+G]^=Z[G]}return I}(),g=E.pad={},f=g.Pkcs7={pad:function(I,x){for(var z=x*4,W=z-I.sigBytes%z,Q=W<<24|W<<16|W<<8|W,Z=[],$=0;$<W;$+=4)Z.push(Q);var G=d.create(Z,W);I.concat(G)},unpad:function(I){var x=I.words[I.sigBytes-1>>>2]&255;I.sigBytes-=x}},l=T.BlockCipher=_.extend({cfg:_.cfg.extend({mode:o,padding:f}),reset:function(){var I;_.reset.call(this);var x=this.cfg,z=x.iv,W=x.mode;this._xformMode==this._ENC_XFORM_MODE?I=W.createEncryptor:(I=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==I?this._mode.init(this,z&&z.words):(this._mode=I.call(W,this,z&&z.words),this._mode.__creator=I)},_doProcessBlock:function(I,x){this._mode.processBlock(I,x)},_doFinalize:function(){var I,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),I=this._process(!0)):(I=this._process(!0),x.unpad(I)),I},blockSize:128/32}),s=T.CipherParams=u.extend({init:function(I){this.mixIn(I)},toString:function(I){return(I||this.formatter).stringify(this)}}),y=E.format={},P=y.OpenSSL={stringify:function(I){var x,z=I.ciphertext,W=I.salt;return W?x=d.create([1398893684,1701076831]).concat(W).concat(z):x=z,x.toString(a)},parse:function(I){var x,z=a.parse(I),W=z.words;return W[0]==1398893684&&W[1]==1701076831&&(x=d.create(W.slice(2,4)),W.splice(0,4),z.sigBytes-=16),s.create({ciphertext:z,salt:x})}},D=T.SerializableCipher=u.extend({cfg:u.extend({format:P}),encrypt:function(I,x,z,W){W=this.cfg.extend(W);var Q=I.createEncryptor(z,W),Z=Q.finalize(x),$=Q.cfg;return s.create({ciphertext:Z,key:z,iv:$.iv,algorithm:I,mode:$.mode,padding:$.padding,blockSize:I.blockSize,formatter:W.format})},decrypt:function(I,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var Q=I.createDecryptor(z,W).finalize(x.ciphertext);return Q},_parse:function(I,x){return typeof I=="string"?x.parse(I,this):I}}),k=E.kdf={},H=k.OpenSSL={execute:function(I,x,z,W){W||(W=d.random(64/8));var Q=w.create({keySize:x+z}).compute(I,W),Z=d.create(Q.words.slice(x),z*4);return Q.sigBytes=x*4,s.create({key:Q,iv:Z,salt:W})}},U=T.PasswordBasedCipher=D.extend({cfg:D.cfg.extend({kdf:H}),encrypt:function(I,x,z,W){W=this.cfg.extend(W);var Q=W.kdf.execute(z,I.keySize,I.ivSize);W.iv=Q.iv;var Z=D.encrypt.call(this,I,x,Q.key,W);return Z.mixIn(Q),Z},decrypt:function(I,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var Q=W.kdf.execute(z,I.keySize,I.ivSize,x.salt);W.iv=Q.iv;var Z=D.decrypt.call(this,I,x,Q.key,W);return Z}})}()})},function(v,c,r){"use strict";c.__esModule=!0,c.Request=c.createRequest=void 0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(11)),T=p.__importDefault(r(0)),u=p.__importDefault(r(7)),d=p.__importDefault(r(5)),A=p.__importDefault(r(8)),R=p.__importDefault(r(3)),O=p.__importDefault(r(20)),a=i.getGlobalObject(),C=function(){},w=a._ablyjs_jsonp={};w._=function(f){return w["_"+f]||C};var _=1,b="jsonp";function m(f,l,s,y,P,D,k){return D=D||A.default.TIMEOUTS,new o(void 0,f,l,i.copy(s),y,P,D,k)}c.createRequest=m;var S=function(f){p.__extends(l,f);function l(s,y,P){var D=f.call(this,s,y,P)||this;return D.shortName=b,P.stream=!1,D}return l.isAvailable=function(){return T.default.Config.jsonpSupported&&T.default.Config.allowComet},l.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(s,y,P,D,k,H,U){return H=(this===null||this===void 0?void 0:this.timeouts)||H||A.default.TIMEOUTS,m(s,y,P,D,k,H,U)},l}(E.default),o=function(f){p.__extends(l,f);function l(s,y,P,D,k,H,U,I){var x=f.call(this)||this;return s===void 0&&(s=_++),x.id=s,x.uri=y,x.params=D||{},x.params.rnd=i.cheapRandStr(),P&&(P["X-Ably-Version"]&&(x.params.v=P["X-Ably-Version"]),P["X-Ably-Lib"]&&(x.params.lib=P["X-Ably-Lib"])),x.body=k,x.method=I,x.requestMode=H,x.timeouts=U,x.requestComplete=!1,x}return l.prototype.exec=function(){var s=this,y=this.id,P=this.body,D=this.method,k=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+y+")",H.envelope="jsonp",P&&(H.body=P),D&&D!=="get"&&(H.method=D);var U=this.script=document.createElement("script"),I=k+i.toQueryString(H);U.src=I,U.src.split("/").slice(-1)[0]!==I.split("/").slice(-1)[0]&&R.default.logAction(R.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),U.async=!0,U.type="text/javascript",U.charset="UTF-8",U.onerror=function(W){s.complete(new d.default("JSONP script error (event: "+T.default.Config.inspect(W)+")",null,400))},w["_"+y]=function(W){if(W.statusCode){var Q=W.response;if(W.statusCode==204)s.complete(null,null,null,W.statusCode);else if(!Q)s.complete(new d.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||i.isArray(Q))s.complete(null,Q,W.headers,W.statusCode);else{var Z=Q.error||new d.default("Error response received from server",null,W.statusCode);s.complete(Z)}}else s.complete(null,W)};var x=this.requestMode==O.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var z=document.getElementsByTagName("head")[0];z.insertBefore(U,z.firstChild)},l.prototype.complete=function(s,y,P,D){if(P=P||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;y&&(k=typeof y=="string"?"text/plain":"application/json",P["content-type"]=k,this.emit("data",y)),this.emit("complete",s,y,P,!0,D),this.dispose()}},l.prototype.abort=function(){this.dispose()},l.prototype.dispose=function(){var s=this.timer;s&&(clearTimeout(s),this.timer=null);var y=this.script;y.parentNode&&y.parentNode.removeChild(y),delete w[this.id],this.emit("disposed")},l}(u.default);c.Request=o;function g(f){return a.JSONPTransport=S,S.isAvailable()&&(f.supportedTransports[b]=S),S}c.default=g},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(3)),T=p.__importDefault(r(8)),u=p.__importDefault(r(16)),d=p.__importDefault(r(45)),A=p.__importDefault(r(18)),R=p.__importDefault(r(33)),O=p.__importDefault(r(5)),a=p.__importDefault(r(48)),C=p.__importDefault(r(17)),w=p.__importDefault(r(0)),_=function(){},b=function(){function S(o){if(!o){var g="no options provided";throw E.default.logAction(E.default.LOG_ERROR,"Rest()",g),new Error(g)}var f=T.default.objectifyOptions(o);f.log&&E.default.setLog(f.log.level,f.log.handler),E.default.logAction(E.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(o));var l=this.options=T.default.normaliseOptions(f);if(l.key){var s=l.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!s){var g="invalid key parameter";throw E.default.logAction(E.default.LOG_ERROR,"Rest()",g),new O.default(g,40400,404)}l.keyName=s[1],l.keySecret=s[2]}if("clientId"in l)if(typeof l.clientId=="string"||l.clientId===null){if(l.clientId==="*")throw new O.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new O.default("clientId must be either a string or null",40012,400);E.default.logAction(E.default.LOG_MINOR,"Rest()","started; version = "+T.default.version),this.baseUri=this.authority=function(y){return T.default.getHttpScheme(l)+y+":"+T.default.getPort(l,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http,this.auth=new u.default(this,l),this.channels=new m(this),this.push=new d.default(this)}return S.prototype.stats=function(o,g){if(g===void 0)if(typeof o=="function")g=o,o=null;else{if(this.options.promises)return i.promisify(this,"stats",arguments);g=_}var f=i.defaultGetHeaders(),l=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,s=this.http.supportsLinkHeaders?void 0:l;this.options.headers&&i.mixin(f,this.options.headers),new A.default(this,"/stats",f,s,function(y,P,D){for(var k=D?y:JSON.parse(y),H=0;H<k.length;H++)k[H]=a.default.fromValues(k[H]);return k}).get(o,g)},S.prototype.time=function(o,g){var f=this;if(g===void 0){if(typeof o=="function")g=o,o=null;else if(this.options.promises)return i.promisify(this,"time",arguments)}var l=g||_,s=i.defaultGetHeaders();this.options.headers&&i.mixin(s,this.options.headers);var y=function(P){return f.authority(P)+"/time"};this.http.do(C.default.Get,this,y,s,null,o,function(P,D,k,H){if(P){l(P);return}H||(D=JSON.parse(D));var U=D[0];if(!U){l(new O.default("Internal error (unexpected result type from GET /time)",5e4,500));return}f.serverTimeOffset=U-i.now(),l(null,U)})},S.prototype.request=function(o,g,f,l,s,y){var P=this.options.useBinaryProtocol,D=P?w.default.Config.msgpack.encode:JSON.stringify,k=P?w.default.Config.msgpack.decode:JSON.parse,H=P?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:H;f=f||{};var I=o.toLowerCase(),x=I=="get"?i.defaultGetHeaders(H):i.defaultPostHeaders(H);if(y===void 0){if(this.options.promises)return i.promisify(this,"request",arguments);y=_}typeof l!="string"&&(l=D(l)),this.options.headers&&i.mixin(x,this.options.headers),s&&i.mixin(x,s);var z=new A.default(this,g,x,U,function(W,Q,Z){return i.ensureArray(Z?W:k(W))},!0);if(!i.arrIn(w.default.Http.methods,I))throw new O.default("Unsupported method "+I,40500,405);i.arrIn(w.default.Http.methodsWithBody,I)?z[I](f,l,y):z[I](f,y)},S.prototype.setLog=function(o){E.default.setLog(o.level,o.handler)},S.Promise=function(o){return o=T.default.objectifyOptions(o),o.promises=!0,new S(o)},S.Callbacks=S,S.Platform=w.default,S}(),m=function(){function S(o){this.rest=o,this.all={}}return S.prototype.get=function(o,g){o=String(o);var f=this.all[o];return f?g&&f.setOptions(g):this.all[o]=f=new R.default(this.rest,o,g),f},S.prototype.release=function(o){delete this.all[String(o)]},S}();c.default=b},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(i){var E=p,T=E.lib,u=T.WordArray,d=T.Hasher,A=E.algo,R=[],O=[];(function(){function w(S){for(var o=i.sqrt(S),g=2;g<=o;g++)if(!(S%g))return!1;return!0}function _(S){return(S-(S|0))*4294967296|0}for(var b=2,m=0;m<64;)w(b)&&(m<8&&(R[m]=_(i.pow(b,1/2))),O[m]=_(i.pow(b,1/3)),m++),b++})();var a=[],C=A.SHA256=d.extend({_doReset:function(){this._hash=new u.init(R.slice(0))},_doProcessBlock:function(w,_){for(var b=this._hash.words,m=b[0],S=b[1],o=b[2],g=b[3],f=b[4],l=b[5],s=b[6],y=b[7],P=0;P<64;P++){if(P<16)a[P]=w[_+P]|0;else{var D=a[P-15],k=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,H=a[P-2],U=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;a[P]=k+a[P-7]+U+a[P-16]}var I=f&l^~f&s,x=m&S^m&o^S&o,z=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),W=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),Q=y+W+I+O[P]+a[P],Z=z+x;y=s,s=l,l=f,f=g+Q|0,g=o,o=S,S=m,m=Q+Z|0}b[0]=b[0]+m|0,b[1]=b[1]+S|0,b[2]=b[2]+o|0,b[3]=b[3]+g|0,b[4]=b[4]+f|0,b[5]=b[5]+l|0,b[6]=b[6]+s|0,b[7]=b[7]+y|0},_doFinalize:function(){var w=this._data,_=w.words,b=this._nDataBytes*8,m=w.sigBytes*8;return _[m>>>5]|=128<<24-m%32,_[(m+64>>>9<<4)+14]=i.floor(b/4294967296),_[(m+64>>>9<<4)+15]=b,w.sigBytes=_.length*4,this._process(),this._hash},clone:function(){var w=d.clone.call(this);return w._hash=this._hash.clone(),w}});E.SHA256=d._createHelper(C),E.HmacSHA256=d._createHmacHelper(C)}(Math),p.SHA256})},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return p.enc.Utf8})},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(7)),T=p.__importDefault(r(3)),u=p.__importDefault(r(34)),d=p.__importDefault(r(9)),A=p.__importDefault(r(5)),R=p.__importDefault(r(18)),O=p.__importDefault(r(24)),a=p.__importDefault(r(0));function C(){}var w=9;function _(S){return i.arrEvery(S,function(o){return!o.id})}function b(S){var o=S||{};if(o.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var g=a.default.Crypto.getCipher(o.cipher);o.cipher=g.cipherParams,o.channelCipher=g.cipher}else"cipher"in o&&(o.cipher=void 0,o.channelCipher=null);return o}var m=function(S){p.__extends(o,S);function o(g,f,l){var s=S.call(this)||this;return T.default.logAction(T.default.LOG_MINOR,"Channel()","started; name = "+f),s.rest=g,s.name=f,s.basePath="/channels/"+encodeURIComponent(f),s.presence=new u.default(s),s.channelOptions=b(l),s}return o.prototype.setOptions=function(g){this.channelOptions=b(g)},o.prototype.history=function(g,f){if(T.default.logAction(T.default.LOG_MICRO,"Channel.history()","channel = "+this.name),f===void 0)if(typeof g=="function")f=g,g=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);f=C}this._history(g,f)},o.prototype._history=function(g,f){var l=this.rest,s=l.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:s,P=i.defaultGetHeaders(s);l.options.headers&&i.mixin(P,l.options.headers);var D=this.channelOptions;new R.default(l,this.basePath+"/messages",P,y,function(k,H,U){return d.default.fromResponseBody(k,D,U?void 0:s)}).get(g,f)},o.prototype.publish=function(){var g=this,f=arguments.length,l=arguments[0],s=arguments[1],y=arguments[f-1],P,D;if(typeof y!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);y=C}if(typeof l=="string"||l===null)P=[d.default.fromValues({name:l,data:s})],D=arguments[2];else if(i.isObject(l))P=[d.default.fromValues(l)],D=arguments[1];else if(i.isArray(l))P=d.default.fromValuesArray(l),D=arguments[1];else throw new A.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof D!="object"||!D)&&(D={});var k=this.rest,H=k.options,U=H.useBinaryProtocol?i.Format.msgpack:i.Format.json,I=k.options.idempotentRestPublishing,x=i.defaultPostHeaders(U);if(H.headers&&i.mixin(x,H.headers),I&&_(P)){var z=i.randomString(w);i.arrForEach(P,function(W,Q){W.id=z+":"+Q.toString()})}d.default.encodeArray(P,this.channelOptions,function(W){if(W){y(W);return}var Q=d.default.getMessagesSize(P),Z=H.maxMessageSize;if(Q>Z){y(new A.default("Maximum size of messages that can be published at once exceeded ( was "+Q+" bytes; limit is "+Z+" bytes)",40009,400));return}g._publish(d.default.serialize(P,U),x,D,y)})},o.prototype._publish=function(g,f,l,s){O.default.post(this.rest,this.basePath+"/messages",g,f,l,null,s)},o.prototype.status=function(g){if(typeof g!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var f=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,l=i.defaultPostHeaders(f);O.default.get(this.rest,this.basePath,l,{},f,g||C)},o}(E.default);c.default=m},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(7)),T=p.__importDefault(r(3)),u=p.__importDefault(r(18)),d=p.__importDefault(r(14));function A(){}var R=function(O){p.__extends(a,O);function a(C){var w=O.call(this)||this;return w.channel=C,w.basePath=C.basePath+"/presence",w}return a.prototype.get=function(C,w){if(T.default.logAction(T.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof C=="function")w=C,C=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);w=A}var _=this.channel.rest,b=_.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:b,S=i.defaultGetHeaders(b);_.options.headers&&i.mixin(S,_.options.headers);var o=this.channel.channelOptions;new u.default(_,this.basePath,S,m,function(g,f,l){return d.default.fromResponseBody(g,o,l?void 0:b)}).get(C,w)},a.prototype.history=function(C,w){T.default.logAction(T.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(C,w)},a.prototype._history=function(C,w){if(w===void 0)if(typeof C=="function")w=C,C=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",arguments);w=A}var _=this.channel.rest,b=_.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:b,S=i.defaultGetHeaders(b);_.options.headers&&i.mixin(S,_.options.headers);var o=this.channel.channelOptions;new u.default(_,this.basePath+"/history",S,m,function(g,f,l){return d.default.fromResponseBody(g,o,l?void 0:b)}).get(C,w)},a}(E.default);c.default=R},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(7)),E=p.__importDefault(r(3)),T=function(u){p.__extends(d,u);function d(){var A=u.call(this)||this;return A.messages=[],A}return d.prototype.count=function(){return this.messages.length},d.prototype.push=function(A){this.messages.push(A)},d.prototype.shift=function(){return this.messages.shift()},d.prototype.last=function(){return this.messages[this.messages.length-1]},d.prototype.copyAll=function(){return this.messages.slice()},d.prototype.append=function(A){this.messages.push.apply(this.messages,A)},d.prototype.prepend=function(A){this.messages.unshift.apply(this.messages,A)},d.prototype.completeMessages=function(A,R,O){E.default.logAction(E.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+A+"; count = "+R),O=O||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var C=a[0];if(C){var w=C.message.msgSerial,_=A+R;if(_>w)for(var b=a.splice(0,_-w),m=0,S=b;m<S.length;m++){var o=S[m];o.callback(O)}a.length==0&&this.emit("idle")}},d.prototype.completeAllMessages=function(A){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,A)},d.prototype.clear=function(){E.default.logAction(E.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},d}(i.default);c.default=T},function(v,c,r){"use strict";c.__esModule=!0;var p=function(){function i(E,T,u,d){this.previous=E,this.current=T,u&&(this.retryIn=u),d&&(this.reason=d)}return i}();c.default=p},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(10)),E=p.__importDefault(r(7)),T=p.__importStar(r(2)),u=p.__importDefault(r(33)),d=p.__importDefault(r(3)),A=p.__importDefault(r(54)),R=p.__importDefault(r(9)),O=p.__importDefault(r(38)),a=p.__importDefault(r(5)),C=p.__importDefault(r(14)),w=p.__importDefault(r(19)),_=i.default.Action,b=function(){},m="statechange",S="sync";function o(f){if(f&&"params"in f&&!T.isObject(f.params))return new a.default("options.params must be an object",4e4,400);if(f&&"modes"in f){if(!T.isArray(f.modes))return new a.default("options.modes must be an array",4e4,400);for(var l=0;l<f.modes.length;l++){var s=f.modes[l];if(!s||typeof s!="string"||!T.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(s)))return new a.default("Invalid channel mode: "+s,4e4,400)}}}var g=function(f){p.__extends(l,f);function l(s,y,P){var D=f.call(this,s,y,P)||this;return D.retryCount=0,D.history=function(k,H){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof k=="function")H=k,k=null;else{if(this.rest.options.promises)return T.promisify(this,"history",arguments);H=b}if(k&&k.untilAttach){if(this.state!=="attached"){H(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete k.untilAttach,k.from_serial=this.properties.attachSerial}u.default.prototype._history.call(this,k,H)},D.whenState=function(k,H){return E.default.prototype.whenState.call(D,k,D.state,H)},d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel()","started; name = "+y),D.realtime=s,D.presence=new A.default(D),D.connectionManager=s.connection.connectionManager,D.state="initialized",D.subscriptions=new E.default,D.syncChannelSerial=void 0,D.properties={attachSerial:void 0},D.setOptions(P),D.errorReason=null,D._requestedFlags=null,D._mode=null,D._attachedMsgIndicator=!1,D._attachResume=!1,D._decodingContext={channelOptions:D.channelOptions,plugins:s.options.plugins||{},baseEncodedPreviousPayload:void 0},D._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},D._allChannelChanges=new E.default,D}return l.invalidStateError=function(s){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+s}},l.processListenerArgs=function(s){return s=Array.prototype.slice.call(s),typeof s[0]=="function"&&s.unshift(null),s[s.length-1]==null&&s.pop(),s},l.prototype.setOptions=function(s,y){if(!y&&this.rest.options.promises)return T.promisify(this,"setOptions",arguments);var P=y||function(k){k&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},D=o(s);if(D){P(D);return}u.default.prototype.setOptions.call(this,s),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(s)?(this.attachImpl(),this._allChannelChanges.once(function(k){switch(this.event){case"update":case"attached":P==null||P(null);return;default:P==null||P(k.reason);return}})):P()},l.prototype._shouldReattachToSetOptions=function(s){return(this.state==="attached"||this.state==="attaching")&&(s.params||s.modes)},l.prototype.publish=function(){for(var s=this,y=[],P=0;P<arguments.length;P++)y[P]=arguments[P];var D=y[0],k=y.length,H=y[k-1];if(typeof H!="function"){if(this.realtime.options.promises)return T.promisify(this,"publish",arguments);H=b,++k}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(k==2)if(T.isObject(D))D=[R.default.fromValues(D)];else if(T.isArray(D))D=R.default.fromValuesArray(D);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else D=[R.default.fromValues({name:y[0],data:y[1]})];var U=this.realtime.options.maxMessageSize;R.default.encodeArray(D,this.channelOptions,function(I){if(I){H(I);return}var x=R.default.getMessagesSize(D);if(x>U){H(new a.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+U+" bytes)",40009,400));return}s.__publish(D,H)})},l.prototype.__publish=function(s,y){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+s.length);var P=this.state;switch(P){case"failed":case"suspended":y(a.default.fromValues(l.invalidStateError(P)));break;default:{d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+P);var D=new i.default;D.action=_.MESSAGE,D.channel=this.name,D.messages=s,this.sendMessage(D,y);break}}},l.prototype.onEvent=function(s){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var y=this.subscriptions,P=0;P<s.length;P++){var D=s[P];y.emit(D.name,D)}},l.prototype.attach=function(s,y){var P;if(typeof s=="function"?(y=s,P=null):P=s,!y){if(this.realtime.options.promises)return T.promisify(this,"attach",arguments);y=function(D){D&&d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+D.toString())}}if(P)d.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=P;else if(this.state==="attached"){y();return}this._attach(!1,null,y)},l.prototype._attach=function(s,y,P){P||(P=function(k){k&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+k.toString())});var D=this.connectionManager;if(!D.activeState()){P(D.getError());return}(this.state!=="attaching"||s)&&this.requestState("attaching",y),this.once(function(k){switch(this.event){case"attached":P==null||P();break;case"detached":case"suspended":case"failed":P==null||P(k.reason||D.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":P==null||P(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},l.prototype.attachImpl=function(){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(m,!0);var s=i.default.fromValues({action:_.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?s.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&s.encodeModesToFlags(T.allToUpperCase(this.channelOptions.modes)),this._attachResume&&s.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(s.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(s,b)},l.prototype.detach=function(s){if(!s){if(this.realtime.options.promises)return T.promisify(this,"detach",arguments);s=b}var y=this.connectionManager;if(!y.activeState()){s(y.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),s();break;case"detached":s();break;case"failed":s(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(P){switch(this.event){case"detached":s();break;case"attached":case"suspended":case"failed":s(P.reason||y.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":s(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},l.prototype.detachImpl=function(s){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(m,!0);var y=i.default.fromValues({action:_.DETACH,channel:this.name});this.sendMessage(y,s||b)},l.prototype.subscribe=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];var P=l.processListenerArgs(s),D=P[0],k=P[1],H=P[2];if(!H&&this.realtime.options.promises)return T.promisify(this,"subscribe",[D,k]);if(this.state==="failed"){H==null||H(a.default.fromValues(l.invalidStateError("failed")));return}return D&&typeof D=="object"&&!Array.isArray(D)?this._subscribeFilter(D,k):this.subscriptions.on(D,k),this.attach(H||b)},l.prototype._subscribeFilter=function(s,y){var P=function(D){var k,H,U,I,x,z,W={name:D.name,refTimeserial:(H=(k=D.extras)===null||k===void 0?void 0:k.ref)===null||H===void 0?void 0:H.timeserial,refType:(I=(U=D.extras)===null||U===void 0?void 0:U.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((z=(x=D.extras)===null||x===void 0?void 0:x.ref)===null||z===void 0)&&z.timeserial),clientId:D.clientId};Object.entries(s).find(function(Q){var Z=Q[0],$=Q[1];return $!==void 0?W[Z]!==$:!1})||y(D)};this._addFilteredSubscription(s,y,P),this.subscriptions.on(P)},l.prototype._addFilteredSubscription=function(s,y,P){var D;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(y)){var k=this.filteredSubscriptions.get(y);k.set(s,((D=k==null?void 0:k.get(s))===null||D===void 0?void 0:D.concat(P))||[P])}else this.filteredSubscriptions.set(y,new Map([[s,[P]]]))},l.prototype._getAndDeleteFilteredSubscriptions=function(s,y){var P=this;if(!this.filteredSubscriptions)return[];if(!y&&s)return Array.from(this.filteredSubscriptions.entries()).map(function(U){var I,x=U[0],z=U[1],W=z.get(s);return z.delete(s),z.size===0&&((I=P.filteredSubscriptions)===null||I===void 0||I.delete(x)),W}).reduce(function(U,I){var x;return I?(x=U).concat.apply(x,I):U},[]);if(!y||!this.filteredSubscriptions.has(y))return[];var D=this.filteredSubscriptions.get(y);if(!s){var k=Array.from(D.values()).reduce(function(U,I){return U.concat.apply(U,I)},[]);return this.filteredSubscriptions.delete(y),k}var H=D.get(s);return D.delete(s),H||[]},l.prototype.unsubscribe=function(){for(var s=this,y,P=[],D=0;D<arguments.length;D++)P[D]=arguments[D];var k=l.processListenerArgs(P),H=k[0],U=k[1];if(typeof H=="object"&&!U||((y=this.filteredSubscriptions)===null||y===void 0?void 0:y.has(U))){this._getAndDeleteFilteredSubscriptions(H,U).forEach(function(I){return s.subscriptions.off(I)});return}this.subscriptions.off(H,U)},l.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.default("Unable to sync to channel; not attached",4e4);default:}var s=this.connectionManager;if(!s.activeState())throw s.getError();var y=i.default.fromValues({action:_.SYNC,channel:this.name});this.syncChannelSerial&&(y.channelSerial=this.syncChannelSerial),s.send(y)},l.prototype.sendMessage=function(s,y){this.connectionManager.send(s,this.realtime.options.queueMessages,y)},l.prototype.sendPresence=function(s,y){var P=i.default.fromValues({action:_.PRESENCE,channel:this.name,presence:T.isArray(s)?C.default.fromValuesArray(s):[C.default.fromValues(s)]});this.sendMessage(P,y)},l.prototype.onMessage=function(s){var y,P=!1;switch(s.action){case _.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=s.channelSerial,this._mode=s.getMode(),this.params=s.params||{};var D=s.decodeModesFromFlags();this.modes=D&&T.allToLowerCase(D)||void 0;var k=s.hasFlag("RESUMED"),H=s.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(m,!1),k||this.presence.onAttached(H);var U=new O.default(this.state,this.state,k,s.error);this._allChannelChanges.emit("update",U),(!k||this.channelOptions.updateOnAttached)&&this.emit("update",U)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",s.error,k,H);break}case _.DETACHED:{var I=s.error?a.default.fromValues(s.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",I):this.state==="attaching"?this.notifyState("suspended",I):this.requestState("attaching",I);break}case _.SYNC:if(P=!0,y=this.syncChannelSerial=s.channelSerial,!s.presence)break;case _.PRESENCE:{for(var x=s.presence,z=s.id,W=s.connectionId,Q=s.timestamp,Z=this.channelOptions,$=void 0,G=0;G<x.length;G++)try{$=x[G],C.default.decode($,Z),$.connectionId||($.connectionId=W),$.timestamp||($.timestamp=Q),$.id||($.id=z+":"+G)}catch(ft){d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",ft.toString())}this.presence.setPresence(x,P,y);break}case _.MESSAGE:{if(this.state!=="attached"){d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+s.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var N=s.messages,B=N[0],K=N[N.length-1],z=s.id,W=s.connectionId,Q=s.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var V='Delta message decode failure - previous message not available for message "'+s.id+'" on this channel "'+this.name+'".';d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",V),this._startDecodeFailureRecovery(new a.default(V,40018,400));break}for(var G=0;G<N.length;G++){var V=N[G];try{R.default.decode(V,this._decodingContext)}catch(ct){switch(d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",ct.toString()),ct.code){case 40018:this._startDecodeFailureRecovery(ct);return;case 40019:case 40021:this.notifyState("failed",ct);return}}V.connectionId||(V.connectionId=W),V.timestamp||(V.timestamp=Q),V.id||(V.id=z+":"+G)}this._lastPayload.messageId=K.id,this._lastPayload.protocolMessageChannelSerial=s.channelSerial,this.onEvent(N);break}case _.ERROR:{var tt=s.error;tt&&tt.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(tt));break}default:d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+s.action+")"),this.connectionManager.abort(w.default.unknownChannelErr)}},l.prototype._startDecodeFailureRecovery=function(s){var y=this;this._lastPayload.decodeFailureRecoveryInProgress||(d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,s,function(){y._lastPayload.decodeFailureRecoveryInProgress=!1}))},l.prototype.onAttached=function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},l.prototype.notifyState=function(s,y,P,D){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+s),this.clearStateTimer(),s!==this.state){this.presence.actOnChannelState(s,D,y),s==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),y&&(this.errorReason=y);var k=new O.default(this.state,s,P,y),H=s==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(H,'Channel state for channel "'+this.name+'"',s+(y?"; reason: "+y:"")),s!=="attaching"&&s!=="suspended"&&(this.retryCount=0),s==="attached"?(this.onAttached(),this.setInProgress(S,D),this.setInProgress(m,!1)):(s==="detached"||s==="failed"||s==="suspended")&&(this.setInProgress(m,!1),this.setInProgress(S,!1)),s==="attached"?this._attachResume=!0:(s==="detaching"||s==="failed")&&(this._attachResume=!1),this.state=s,this._allChannelChanges.emit(s,k),this.emit(s,k)}},l.prototype.requestState=function(s,y){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+s),this.notifyState(s,y),this.checkPendingState()},l.prototype.checkPendingState=function(){var s=this.connectionManager.state;if(!(s.sendEvents||s.forceQueueEvents)){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},l.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var s=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",s);break}case"detaching":{var s=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",s);break}default:this.checkPendingState();break}},l.prototype.startStateTimerIfNotRunning=function(){var s=this;this.stateTimer||(this.stateTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),s.stateTimer=null,s.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},l.prototype.clearStateTimer=function(){var s=this.stateTimer;s&&(clearTimeout(s),this.stateTimer=null)},l.prototype.startRetryTimer=function(){var s=this;if(!this.retryTimer){this.retryCount++;var y=this.realtime.options.timeouts.channelRetryTimeout*T.getJitterCoefficient()*T.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){s.state==="suspended"&&s.connectionManager.state.sendEvents&&(s.retryTimer=null,d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),s.requestState("attaching"))},y)}},l.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},l.prototype.setInProgress=function(s,y){this.rest.channels.setInProgress(this,s,y)},l.prototype.getReleaseErr=function(){var s=this.state;return s==="initialized"||s==="detached"||s==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+s,90001,400)},l.progressOps={statechange:m,sync:S},l}(u.default);c.default=g},function(v,c,r){"use strict";c.__esModule=!0;var p=function(){function i(E,T,u,d){this.previous=E,this.current=T,T==="attached"&&(this.resumed=u),d&&(this.reason=d)}return i}();c.default=p},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(){var i=p,E=i.lib,T=E.WordArray,u=E.Hasher,d=i.algo,A=[],R=d.SHA1=u.extend({_doReset:function(){this._hash=new T.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(O,a){for(var C=this._hash.words,w=C[0],_=C[1],b=C[2],m=C[3],S=C[4],o=0;o<80;o++){if(o<16)A[o]=O[a+o]|0;else{var g=A[o-3]^A[o-8]^A[o-14]^A[o-16];A[o]=g<<1|g>>>31}var f=(w<<5|w>>>27)+S+A[o];o<20?f+=(_&b|~_&m)+1518500249:o<40?f+=(_^b^m)+1859775393:o<60?f+=(_&b|_&m|b&m)-1894007588:f+=(_^b^m)-899497514,S=m,m=b,b=_<<30|_>>>2,_=w,w=f}C[0]=C[0]+w|0,C[1]=C[1]+_|0,C[2]=C[2]+b|0,C[3]=C[3]+m|0,C[4]=C[4]+S|0},_doFinalize:function(){var O=this._data,a=O.words,C=this._nDataBytes*8,w=O.sigBytes*8;return a[w>>>5]|=128<<24-w%32,a[(w+64>>>9<<4)+14]=Math.floor(C/4294967296),a[(w+64>>>9<<4)+15]=C,O.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var O=u.clone.call(this);return O._hash=this._hash.clone(),O}});i.SHA1=u._createHelper(R),i.HmacSHA1=u._createHmacHelper(R)}(),p.SHA1})},function(v,c,r){"use strict";c.__esModule=!0;function p(o){if(o===void 0)return"undefined";var g,f;if(o instanceof ArrayBuffer?(f="ArrayBuffer",g=new DataView(o)):o instanceof DataView&&(f="DataView",g=o),!g)return JSON.stringify(o);for(var l=[],s=0;s<o.byteLength;s++){if(s>20){l.push("...");break}var y=g.getUint8(s).toString(16);y.length===1&&(y="0"+y),l.push(y)}return"<"+f+" "+l.join(" ")+">"}function i(o,g,f){for(var l=0,s=f.length;l<s;l++){var y=f.charCodeAt(l);if(y<128){o.setUint8(g++,y>>>0&127|0);continue}if(y<2048){o.setUint8(g++,y>>>6&31|192),o.setUint8(g++,y>>>0&63|128);continue}if(y<65536){o.setUint8(g++,y>>>12&15|224),o.setUint8(g++,y>>>6&63|128),o.setUint8(g++,y>>>0&63|128);continue}if(y<1114112){o.setUint8(g++,y>>>18&7|240),o.setUint8(g++,y>>>12&63|128),o.setUint8(g++,y>>>6&63|128),o.setUint8(g++,y>>>0&63|128);continue}throw new Error("bad codepoint "+y)}}function E(o,g,f){for(var l="",s=g,y=g+f;s<y;s++){var P=o.getUint8(s);if((P&128)===0){l+=String.fromCharCode(P);continue}if((P&224)===192){l+=String.fromCharCode((P&15)<<6|o.getUint8(++s)&63);continue}if((P&240)===224){l+=String.fromCharCode((P&15)<<12|(o.getUint8(++s)&63)<<6|(o.getUint8(++s)&63)<<0);continue}if((P&248)===240){l+=String.fromCharCode((P&7)<<18|(o.getUint8(++s)&63)<<12|(o.getUint8(++s)&63)<<6|(o.getUint8(++s)&63)<<0);continue}throw new Error("Invalid byte "+P.toString(16))}return l}function T(o){for(var g=0,f=0,l=o.length;f<l;f++){var s=o.charCodeAt(f);if(s<128){g+=1;continue}if(s<2048){g+=2;continue}if(s<65536){g+=3;continue}if(s<1114112){g+=4;continue}throw new Error("bad codepoint "+s)}return g}function u(o,g){var f=S(o,g);if(f!==0){var l=new ArrayBuffer(f),s=new DataView(l);return m(o,s,0,g),l}}var d=(1<<16)*(1<<16),A=1/d;function R(o,g){return g=g||0,o.getInt32(g)*d+o.getUint32(g+4)}function O(o,g){return g=g||0,o.getUint32(g)*d+o.getUint32(g+4)}function a(o,g,f){f<9223372036854776e3?(o.setInt32(g,Math.floor(f*A)),o.setInt32(g+4,f&-1)):(o.setUint32(g,2147483647),o.setUint32(g+4,2147483647))}function C(o,g,f){f<18446744073709552e3?(o.setUint32(g,Math.floor(f*A)),o.setInt32(g+4,f&-1)):(o.setUint32(g,4294967295),o.setUint32(g+4,4294967295))}var w=function(){function o(g,f){var l=this;this.map=function(s){for(var y={},P=0;P<s;P++){var D=l.parse();y[D]=l.parse()}return y},this.bin=function(s){var y=new ArrayBuffer(s);return new Uint8Array(y).set(new Uint8Array(l.view.buffer,l.offset,s),0),l.offset+=s,y},this.buf=this.bin,this.str=function(s){var y=E(l.view,l.offset,s);return l.offset+=s,y},this.array=function(s){for(var y=new Array(s),P=0;P<s;P++)y[P]=l.parse();return y},this.ext=function(s){return l.offset+=s,{type:l.view.getInt8(l.offset),data:l.buf(s)}},this.parse=function(){var s=l.view.getUint8(l.offset),y,P;if((s&128)===0)return l.offset++,s;if((s&240)===128)return P=s&15,l.offset++,l.map(P);if((s&240)===144)return P=s&15,l.offset++,l.array(P);if((s&224)===160)return P=s&31,l.offset++,l.str(P);if((s&224)===224)return y=l.view.getInt8(l.offset),l.offset++,y;switch(s){case 192:return l.offset++,null;case 193:l.offset++;return;case 194:return l.offset++,!1;case 195:return l.offset++,!0;case 196:return P=l.view.getUint8(l.offset+1),l.offset+=2,l.bin(P);case 197:return P=l.view.getUint16(l.offset+1),l.offset+=3,l.bin(P);case 198:return P=l.view.getUint32(l.offset+1),l.offset+=5,l.bin(P);case 199:return P=l.view.getUint8(l.offset+1),l.offset+=2,l.ext(P);case 200:return P=l.view.getUint16(l.offset+1),l.offset+=3,l.ext(P);case 201:return P=l.view.getUint32(l.offset+1),l.offset+=5,l.ext(P);case 202:return y=l.view.getFloat32(l.offset+1),l.offset+=5,y;case 203:return y=l.view.getFloat64(l.offset+1),l.offset+=9,y;case 204:return y=l.view.getUint8(l.offset+1),l.offset+=2,y;case 205:return y=l.view.getUint16(l.offset+1),l.offset+=3,y;case 206:return y=l.view.getUint32(l.offset+1),l.offset+=5,y;case 207:return y=O(l.view,l.offset+1),l.offset+=9,y;case 208:return y=l.view.getInt8(l.offset+1),l.offset+=2,y;case 209:return y=l.view.getInt16(l.offset+1),l.offset+=3,y;case 210:return y=l.view.getInt32(l.offset+1),l.offset+=5,y;case 211:return y=R(l.view,l.offset+1),l.offset+=9,y;case 212:return P=1,l.offset++,l.ext(P);case 213:return P=2,l.offset++,l.ext(P);case 214:return P=4,l.offset++,l.ext(P);case 215:return P=8,l.offset++,l.ext(P);case 216:return P=16,l.offset++,l.ext(P);case 217:return P=l.view.getUint8(l.offset+1),l.offset+=2,l.str(P);case 218:return P=l.view.getUint16(l.offset+1),l.offset+=3,l.str(P);case 219:return P=l.view.getUint32(l.offset+1),l.offset+=5,l.str(P);case 220:return P=l.view.getUint16(l.offset+1),l.offset+=3,l.array(P);case 221:return P=l.view.getUint32(l.offset+1),l.offset+=5,l.array(P);case 222:return P=l.view.getUint16(l.offset+1),l.offset+=3,l.map(P);case 223:return P=l.view.getUint32(l.offset+1),l.offset+=5,l.map(P)}throw new Error("Unknown type 0x"+s.toString(16))},this.offset=f||0,this.view=g}return o}();function _(o){var g=new DataView(o),f=new w(g),l=f.parse();if(f.offset!==o.byteLength)throw new Error(o.byteLength-f.offset+" trailing bytes");return l}function b(o,g){return Object.keys(o).filter(function(f){var l=o[f],s=typeof l;return(!g||l!=null)&&(s!=="function"||!!l.toJSON)})}function m(o,g,f,l){var s=typeof o;if(typeof o=="string"){var y=T(o);if(y<32)return g.setUint8(f,y|160),i(g,f+1,o),1+y;if(y<256)return g.setUint8(f,217),g.setUint8(f+1,y),i(g,f+2,o),2+y;if(y<65536)return g.setUint8(f,218),g.setUint16(f+1,y),i(g,f+3,o),3+y;if(y<4294967296)return g.setUint8(f,219),g.setUint32(f+1,y),i(g,f+5,o),5+y}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var P=o.byteLength;if(P<256)return g.setUint8(f,196),g.setUint8(f+1,P),new Uint8Array(g.buffer).set(new Uint8Array(o),f+2),2+P;if(P<65536)return g.setUint8(f,197),g.setUint16(f+1,P),new Uint8Array(g.buffer).set(new Uint8Array(o),f+3),3+P;if(P<4294967296)return g.setUint8(f,198),g.setUint32(f+1,P),new Uint8Array(g.buffer).set(new Uint8Array(o),f+5),5+P}if(typeof o=="number"){if(Math.floor(o)!==o)return g.setUint8(f,203),g.setFloat64(f+1,o),9;if(o>=0){if(o<128)return g.setUint8(f,o),1;if(o<256)return g.setUint8(f,204),g.setUint8(f+1,o),2;if(o<65536)return g.setUint8(f,205),g.setUint16(f+1,o),3;if(o<4294967296)return g.setUint8(f,206),g.setUint32(f+1,o),5;if(o<18446744073709552e3)return g.setUint8(f,207),C(g,f+1,o),9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return g.setInt8(f,o),1;if(o>=-128)return g.setUint8(f,208),g.setInt8(f+1,o),2;if(o>=-32768)return g.setUint8(f,209),g.setInt16(f+1,o),3;if(o>=-2147483648)return g.setUint8(f,210),g.setInt32(f+1,o),5;if(o>=-9223372036854776e3)return g.setUint8(f,211),a(g,f+1,o),9;throw new Error("Number too small -0x"+(-o).toString(16).substr(1))}if(s==="undefined")return l?0:(g.setUint8(f,212),g.setUint8(f+1,0),g.setUint8(f+2,0),3);if(o===null)return l?0:(g.setUint8(f,192),1);if(s==="boolean")return g.setUint8(f,o?195:194),1;if(typeof o.toJSON=="function")return m(o.toJSON(),g,f,l);if(s==="object"){var D,k=0,H=void 0,U=Array.isArray(o);if(U?D=o.length:(H=b(o,l),D=H.length),D<16?(g.setUint8(f,D|(U?144:128)),k=1):D<65536?(g.setUint8(f,U?220:222),g.setUint16(f+1,D),k=3):D<4294967296&&(g.setUint8(f,U?221:223),g.setUint32(f+1,D),k=5),U)for(var I=0;I<D;I++)k+=m(o[I],g,f+k,l);else if(H)for(var I=0;I<D;I++){var x=H[I];k+=m(x,g,f+k),k+=m(o[x],g,f+k,l)}return k}if(s==="function")return 0;throw new Error("Unknown type "+s)}function S(o,g){var f=typeof o;if(f==="string"){var l=T(o);if(l<32)return 1+l;if(l<256)return 2+l;if(l<65536)return 3+l;if(l<4294967296)return 5+l}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var s=o.byteLength;if(s<256)return 2+s;if(s<65536)return 3+s;if(s<4294967296)return 5+s}if(typeof o=="number"){if(Math.floor(o)!==o)return 9;if(o>=0){if(o<128)return 1;if(o<256)return 2;if(o<65536)return 3;if(o<4294967296)return 5;if(o<18446744073709552e3)return 9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return 1;if(o>=-128)return 2;if(o>=-32768)return 3;if(o>=-2147483648)return 5;if(o>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+o.toString(16).substr(1))}if(f==="boolean")return 1;if(o===null)return g?0:1;if(o===void 0)return g?0:3;if(typeof o.toJSON=="function")return S(o.toJSON(),g);if(f==="object"){var y,P=0;if(Array.isArray(o)){y=o.length;for(var D=0;D<y;D++)P+=S(o[D],g)}else{var k=b(o,g);y=k.length;for(var D=0;D<y;D++){var H=k[D];P+=S(H)+S(o[H],g)}}if(y<16)return 1+P;if(y<65536)return 3+P;if(y<4294967296)return 5+P;throw new Error("Array or object too long 0x"+y.toString(16))}if(f==="function")return 0;throw new Error("Unknown type "+f)}c.default={encode:u,decode:_,inspect:p,utf8Write:i,utf8Read:E,utf8ByteCount:T}},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(30)),E=p.__importDefault(r(49)),T=p.__importDefault(r(0)),u=p.__importDefault(r(55)),d=p.__importDefault(r(57)),A=p.__importDefault(r(62)),R=p.__importDefault(r(63)),O=p.__importDefault(r(67)),a=p.__importDefault(r(3)),C=r(8),w=p.__importDefault(r(25)),_=p.__importDefault(r(64)),b=p.__importDefault(r(65)),m=p.__importDefault(r(40)),S=p.__importDefault(r(9)),o=p.__importDefault(r(14));T.default.Crypto=d.default,T.default.BufferUtils=u.default,T.default.Http=A.default,T.default.Config=R.default,T.default.Transports=O.default,T.default.WebStorage=_.default,i.default.Crypto=d.default,E.default.Crypto=d.default,i.default.Message=S.default,E.default.Message=S.default,i.default.PresenceMessage=o.default,E.default.PresenceMessage=o.default,E.default.ConnectionManager=w.default,a.default.initLogHandlers(),T.default.Defaults=C.getDefaults(b.default),T.default.Config.agent&&(T.default.Defaults.agent+=" "+T.default.Config.agent),T.default.Config.noUpgrade&&(T.default.Defaults.upgradeTransports=[]),c.default={Rest:i.default,Realtime:E.default,msgpack:m.default}},function(v){v.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(31),r(23))})(this,function(p){return p.HmacSHA256})},function(v,c){},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(46)),T=p.__importDefault(r(24)),u=p.__importDefault(r(18)),d=p.__importDefault(r(5)),A=p.__importDefault(r(47)),R=function(){},O=function(){function _(b){this.rest=b,this.admin=new a(b)}return _}(),a=function(){function _(b){this.rest=b,this.deviceRegistrations=new C(b),this.channelSubscriptions=new w(b)}return _.prototype.publish=function(b,m,S){var o=this.rest,g=o.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(g),l={},s=i.mixin({recipient:b},m);if(typeof S!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);S=R}o.options.headers&&i.mixin(f,o.options.headers),o.options.pushFullWait&&i.mixin(l,{fullWait:"true"});var y=i.encodeBody(s,g);T.default.post(o,"/push/publish",y,f,l,null,function(P){return S(P)})},_}(),C=function(){function _(b){this.rest=b}return _.prototype.save=function(b,m){var S=this.rest,o=E.default.fromValues(b),g=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(g),l={};if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);m=R}S.options.headers&&i.mixin(f,S.options.headers),S.options.pushFullWait&&i.mixin(l,{fullWait:"true"});var s=i.encodeBody(o,g);T.default.put(S,"/push/deviceRegistrations/"+encodeURIComponent(b.id),s,f,l,null,function(y,P,D,k){m(y,y?void 0:E.default.fromResponseBody(P,k?void 0:g))})},_.prototype.get=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(o),f=b.id||b;if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);m=R}if(typeof f!="string"||!f.length){m(new d.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}S.options.headers&&i.mixin(g,S.options.headers),T.default.get(S,"/push/deviceRegistrations/"+encodeURIComponent(f),g,{},null,function(l,s,y,P){m(l,l?void 0:E.default.fromResponseBody(s,P?void 0:o))})},_.prototype.list=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:o,f=i.defaultGetHeaders(o);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);m=R}S.options.headers&&i.mixin(f,S.options.headers),new u.default(S,"/push/deviceRegistrations",f,g,function(l,s,y){return E.default.fromResponseBody(l,y?void 0:o)}).get(b,m)},_.prototype.remove=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(o),f={},l=b.id||b;if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);m=R}if(typeof l!="string"||!l.length){m(new d.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}S.options.headers&&i.mixin(g,S.options.headers),S.options.pushFullWait&&i.mixin(f,{fullWait:"true"}),T.default.delete(S,"/push/deviceRegistrations/"+encodeURIComponent(l),g,f,null,function(s){return m(s)})},_.prototype.removeWhere=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(o);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);m=R}S.options.headers&&i.mixin(g,S.options.headers),S.options.pushFullWait&&i.mixin(b,{fullWait:"true"}),T.default.delete(S,"/push/deviceRegistrations",g,b,null,function(f){return m(f)})},_}(),w=function(){function _(b){this.remove=_.prototype.removeWhere,this.rest=b}return _.prototype.save=function(b,m){var S=this.rest,o=A.default.fromValues(b),g=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(g),l={};if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);m=R}S.options.headers&&i.mixin(f,S.options.headers),S.options.pushFullWait&&i.mixin(l,{fullWait:"true"});var s=i.encodeBody(o,g);T.default.post(S,"/push/channelSubscriptions",s,f,l,null,function(y,P,D,k){m(y,!y&&A.default.fromResponseBody(P,k?void 0:g))})},_.prototype.list=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:o,f=i.defaultGetHeaders(o);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);m=R}S.options.headers&&i.mixin(f,S.options.headers),new u.default(S,"/push/channelSubscriptions",f,g,function(l,s,y){return A.default.fromResponseBody(l,y?void 0:o)}).get(b,m)},_.prototype.removeWhere=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=i.defaultGetHeaders(o);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);m=R}S.options.headers&&i.mixin(g,S.options.headers),S.options.pushFullWait&&i.mixin(b,{fullWait:"true"}),T.default.delete(S,"/push/channelSubscriptions",g,b,null,function(f){return m(f)})},_.prototype.listChannels=function(b,m){var S=this.rest,o=S.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:o,f=i.defaultGetHeaders(o);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);m=R}S.options.headers&&i.mixin(f,S.options.headers),S.options.pushFullWait&&i.mixin(b,{fullWait:"true"}),new u.default(S,"/push/channels",f,g,function(l,s,y){for(var P=!y&&o?i.decodeBody(l,o):l,D=0;D<P.length;D++)P[D]=String(P[D]);return P}).get(b,m)},_}();c.default=O},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(5)),T;(function(A){A.Phone="phone",A.Tablet="tablet",A.Desktop="desktop",A.TV="tv",A.Watch="watch",A.Car="car",A.Embedded="embedded",A.Other="other"})(T||(T={}));var u;(function(A){A.Android="android",A.IOS="ios",A.Browser="browser"})(u||(u={}));var d=function(){function A(){}return A.prototype.toJSON=function(){var R,O,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(R=this.push)===null||R===void 0?void 0:R.recipient,state:(O=this.push)===null||O===void 0?void 0:O.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},A.prototype.toString=function(){var R,O,a,C,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((R=this.push)===null||R===void 0)&&R.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((O=this.push)===null||O===void 0)&&O.state&&(w+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((C=this.push)===null||C===void 0)&&C.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},A.fromResponseBody=function(R,O){return O&&(R=i.decodeBody(R,O)),i.isArray(R)?A.fromValuesArray(R):A.fromValues(R)},A.fromValues=function(R){return R.error=R.error&&E.default.fromValues(R.error),Object.assign(new A,R)},A.fromValuesArray=function(R){for(var O=R.length,a=new Array(O),C=0;C<O;C++)a[C]=A.fromValues(R[C]);return a},A.toRequestBody=i.encodeBody,A}();c.default=d},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=function(){function T(){}return T.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},T.prototype.toString=function(){var u="[PushChannelSubscription";return this.channel&&(u+="; channel="+this.channel),this.deviceId&&(u+="; deviceId="+this.deviceId),this.clientId&&(u+="; clientId="+this.clientId),u+="]",u},T.fromResponseBody=function(u,d){return d&&(u=i.decodeBody(u,d)),i.isArray(u)?T.fromValuesArray(u):T.fromValues(u)},T.fromValues=function(u){return Object.assign(new T,u)},T.fromValuesArray=function(u){for(var d=u.length,A=new Array(d),R=0;R<d;R++)A[R]=T.fromValues(u[R]);return A},T.toRequestBody=i.encodeBody,T}();c.default=E},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=function(){function S(o){this.count=o&&o.count||0,this.data=o&&o.data||0,this.uncompressedData=o&&o.uncompressedData||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return S}(),T=function(S){p.__extends(o,S);function o(g){var f=S.call(this,g)||this;return g&&g.category&&(f.category={},i.forInOwnNonNullProperties(g.category,function(l){f.category[l]=new E(g.category[l])})),f}return o}(E),u=function(){function S(o){this.peak=o&&o.peak||0,this.min=o&&o.min||0,this.mean=o&&o.mean||0,this.opened=o&&o.opened||0,this.refused=o&&o.refused||0}return S}(),d=function(){function S(o){this.succeeded=o&&o.succeeded||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return S}(),A=function(){function S(o){this.plain=new u(o&&o.plain),this.tls=new u(o&&o.tls),this.all=new u(o&&o.all)}return S}(),R=function(){function S(o){this.messages=new T(o&&o.messages),this.presence=new T(o&&o.presence),this.all=new T(o&&o.all)}return S}(),O=function(){function S(o){this.realtime=new R(o&&o.realtime),this.rest=new R(o&&o.rest),this.webhook=new R(o&&o.webhook),this.sharedQueue=new R(o&&o.sharedQueue),this.externalQueue=new R(o&&o.externalQueue),this.httpEvent=new R(o&&o.httpEvent),this.push=new R(o&&o.push),this.all=new R(o&&o.all)}return S}(),a=function(){function S(o){this.all=new R(o&&o.all),this.inbound=new O(o&&o.inbound),this.outbound=new O(o&&o.outbound)}return S}(),C=function(){function S(o){this.all=new R(o&&o.all),this.producerPaid=new a(o&&o.producerPaid),this.consumerPaid=new a(o&&o.consumerPaid)}return S}(),w=function(){function S(o){this.messages=o&&o.messages||0;var g=o&&o.notifications;this.notifications={invalid:g&&g.invalid||0,attempted:g&&g.attempted||0,successful:g&&g.successful||0,failed:g&&g.failed||0},this.directPublishes=o&&o.directPublishes||0}return S}(),_=function(){function S(o){this.succeeded=o&&o.succeeded||0,this.skipped=o&&o.skipped||0,this.failed=o&&o.failed||0}return S}(),b=function(){function S(o){var g=this;this.delta=void 0,o&&o.delta&&(this.delta={},i.forInOwnNonNullProperties(o.delta,function(f){g.delta[f]=new _(o.delta[f])}))}return S}(),m=function(S){p.__extends(o,S);function o(g){var f=S.call(this,g)||this;return f.persisted=new R(g&&g.persisted),f.connections=new A(g&&g.connections),f.channels=new u(g&&g.channels),f.apiRequests=new d(g&&g.apiRequests),f.tokenRequests=new d(g&&g.tokenRequests),f.xchgProducer=new C(g&&g.xchgProducer),f.xchgConsumer=new C(g&&g.xchgConsumer),f.push=new w(g&&g.pushStats),f.processed=new b(g&&g.processed),f.inProgress=g&&g.inProgress||void 0,f.unit=g&&g.unit||void 0,f.intervalId=g&&g.intervalId||void 0,f}return o.fromValues=function(g){return new o(g)},o}(a);c.default=m},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(30)),T=p.__importDefault(r(7)),u=p.__importDefault(r(3)),d=p.__importDefault(r(50)),A=p.__importDefault(r(37)),R=p.__importDefault(r(8)),O=p.__importDefault(r(5)),a=p.__importDefault(r(10)),C=p.__importDefault(r(25)),w=p.__importDefault(r(0)),_=p.__importDefault(r(9)),b=function(S){p.__extends(o,S);function o(g){var f=S.call(this,g)||this;return u.default.logAction(u.default.LOG_MINOR,"Realtime()",""),f.connection=new d.default(f,f.options),f.channels=new m(f),g.autoConnect!==!1&&f.connect(),f}return o.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},o.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},o.Promise=function(g){return g=R.default.objectifyOptions(g),g.promises=!0,new o(g)},o.Callbacks=o,o.Utils=i,o.ConnectionManager=C.default,o.Platform=w.default,o.ProtocolMessage=a.default,o.Message=_.default,o}(E.default),m=function(S){p.__extends(o,S);function o(g){var f=S.call(this)||this;return f.realtime=g,f.all={},f.inProgress={},g.connection.connectionManager.on("transport.active",function(){f.onTransportActive()}),f}return o.prototype.onChannelMessage=function(g){var f=g.channel;if(f===void 0){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+g.action);return}var l=this.all[f];if(!l){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+f);return}l.onMessage(g)},o.prototype.onTransportActive=function(){for(var g in this.all){var f=this.all[g];f.state==="attaching"||f.state==="detaching"?f.checkPendingState():f.state==="suspended"&&f.attach()}},o.prototype.reattach=function(g){for(var f in this.all){var l=this.all[f];l.state==="attached"&&l.requestState("attaching",g)}},o.prototype.resetAttachedMsgIndicators=function(){for(var g in this.all){var f=this.all[g];f.state==="attached"&&(f._attachedMsgIndicator=!1)}},o.prototype.checkAttachedMsgIndicators=function(g){for(var f in this.all){var l=this.all[f];if(l.state==="attached"&&l._attachedMsgIndicator===!1){var s="30s after a resume, found channel which has not received an attached; channelId = "+f+"; connectionId = "+g;u.default.logAction(u.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",s),l.requestState("attaching")}}},o.prototype.propogateConnectionInterruption=function(g,f){var l={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},s=["attaching","attached","detaching","suspended"],y=l[g];for(var P in this.all){var D=this.all[P];i.arrIn(s,D.state)&&D.notifyState(y,f)}},o.prototype.get=function(g,f){g=String(g);var l=this.all[g];if(!l)l=this.all[g]=new A.default(this.realtime,g,f);else if(f){if(l._shouldReattachToSetOptions(f))throw new O.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);l.setOptions(f)}return l},o.prototype.release=function(g){g=String(g);var f=this.all[g];if(!!f){var l=f.getReleaseErr();if(l)throw l;delete this.all[g],delete this.inProgress[g]}},o.prototype.setInProgress=function(g,f,l){this.inProgress[g.name]=this.inProgress[g.name]||{},this.inProgress[g.name][f]=l,!l&&this.hasNopending()&&this.emit("nopending")},o.prototype.onceNopending=function(g){if(this.hasNopending()){g();return}this.once("nopending",g)},o.prototype.hasNopending=function(){return i.arrEvery(i.valuesArray(this.inProgress,!0),function(g){return!i.containsValue(g,!0)})},o}(T.default);c.default=b},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(7)),T=p.__importDefault(r(25)),u=p.__importDefault(r(3)),d=p.__importDefault(r(36)),A=p.__importDefault(r(0));function R(){}var O=function(a){p.__extends(C,a);function C(w,_){var b=a.call(this)||this;return b.whenState=function(m,S){return E.default.prototype.whenState.call(b,m,b.state,S,new d.default(void 0,m))},b.ably=w,b.connectionManager=new T.default(w,_),b.state=b.connectionManager.state.state,b.key=void 0,b.id=void 0,b.serial=void 0,b.timeSerial=void 0,b.recoveryKey=void 0,b.errorReason=null,b.connectionManager.on("connectionstate",function(m){var S=b.state=m.current;A.default.Config.nextTick(function(){b.emit(S,m)})}),b.connectionManager.on("update",function(m){A.default.Config.nextTick(function(){b.emit("update",m)})}),b}return C.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},C.prototype.ping=function(w){if(u.default.logAction(u.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);w=R}this.connectionManager.ping(null,w)},C.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},C}(E.default);c.default=O},function(v,c,r){"use strict";c.__esModule=!0,c.PendingMessage=void 0;var p=r(1),i=p.__importDefault(r(10)),E=p.__importStar(r(2)),T=p.__importDefault(r(7)),u=p.__importDefault(r(3)),d=p.__importDefault(r(35)),A=p.__importDefault(r(5)),R=i.default.Action,O=function(){function C(w,_){this.message=w,this.callback=_,this.merged=!1;var b=w.action;this.sendAttempted=!1,this.ackRequired=b==R.MESSAGE||b==R.PRESENCE}return C}();c.PendingMessage=O;var a=function(C){p.__extends(w,C);function w(_){var b=C.call(this)||this;return b.transport=_,b.messageQueue=new d.default,_.on("ack",function(m,S){b.onAck(m,S)}),_.on("nack",function(m,S,o){b.onNack(m,S,o)}),b}return w.prototype.onAck=function(_,b){u.default.logAction(u.default.LOG_MICRO,"Protocol.onAck()","serial = "+_+"; count = "+b),this.messageQueue.completeMessages(_,b)},w.prototype.onNack=function(_,b,m){u.default.logAction(u.default.LOG_ERROR,"Protocol.onNack()","serial = "+_+"; count = "+b+"; err = "+E.inspectError(m)),m||(m=new A.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(_,b,m)},w.prototype.onceIdle=function(_){var b=this.messageQueue;if(b.count()===0){_();return}b.once("idle",_)},w.prototype.send=function(_){_.ackRequired&&this.messageQueue.push(_),u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(_.message)),_.sendAttempted=!0,this.transport.send(_.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var _=this.transport;this.onceIdle(function(){_.disconnect()})},w}(T.default);c.default=a},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(0)),E=p.__importStar(r(2)),T=p.__importDefault(r(26)),u=p.__importDefault(r(8)),d=p.__importDefault(r(3)),A=p.__importDefault(r(10)),R=p.__importDefault(r(5)),O="web_socket";function a(_){return!!_.on}var C=function(_){p.__extends(b,_);function b(m,S,o){var g=_.call(this,m,S,o)||this;return g.shortName=O,o.heartbeats=i.default.Config.useProtocolHeartbeats,g.wsHost=u.default.getHost(o.options,o.host,!0),g}return b.isAvailable=function(){return!!i.default.Config.WebSocket},b.prototype.createWebSocket=function(m,S){var o=0;if(S)for(var g in S)m+=(o++?"&":"?")+g+"="+S[g];return this.uri=m,new i.default.Config.WebSocket(m)},b.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},b.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),T.default.prototype.connect.call(this);var m=this,S=this.params,o=S.options,g=o.tls?"wss://":"ws://",f=g+this.wsHost+":"+u.default.getPort(o)+"/";d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+f),this.auth.getAuthParams(function(l,s){if(!m.isDisposed){var y="";for(var P in s)y+=" "+P+": "+s[P]+";";if(d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+y+" err: "+l),l){m.disconnect(l);return}var D=S.getConnectParams(s);try{var k=m.wsConnection=m.createWebSocket(f,D);k.binaryType=i.default.Config.binaryType,k.onopen=function(){m.onWsOpen()},k.onclose=function(H){m.onWsClose(H)},k.onmessage=function(H){m.onWsData(H.data)},k.onerror=function(H){m.onWsError(H)},a(k)&&k.on("ping",function(){m.onActivity()})}catch(H){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),m.disconnect(H)}}})},b.prototype.send=function(m){var S=this.wsConnection;if(!S){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{S.send(A.default.serialize(m,this.params.format))}catch(g){var o="Exception from ws connection when trying to send: "+E.inspectError(g);d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()",o),this.finish("disconnected",new R.default(o,5e4,500))}},b.prototype.onWsData=function(m){d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(A.default.deserialize(m,this.format))}catch(S){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+S.stack)}},b.prototype.onWsOpen=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},b.prototype.onWsClose=function(m){var S,o;if(typeof m=="object"?(o=m.code,S=m.wasClean||o===1e3):(o=m,S=o==1e3),delete this.wsConnection,S){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var g=new R.default("Websocket closed",80003,400);this.finish("disconnected",g)}else{var f="Unclean disconnection of WebSocket ; code = "+o,g=new R.default(f,80003,400);d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()",f),this.finish("disconnected",g)}this.emit("disposed")},b.prototype.onWsError=function(m){var S=this;d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),i.default.Config.nextTick(function(){S.disconnect(Error(m.message))})},b.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},b}(T.default);function w(_){return C.isAvailable()&&(_.supportedTransports[O]=C),C}c.default=w},function(v,c,r){"use strict";c.__esModule=!0,c.isSuccessCode=void 0;var p;(function(E){E[E.Success=200]="Success",E[E.NoContent=204]="NoContent",E[E.BadRequest=400]="BadRequest",E[E.Unauthorized=401]="Unauthorized",E[E.Forbidden=403]="Forbidden",E[E.RequestTimeout=408]="RequestTimeout",E[E.InternalServerError=500]="InternalServerError"})(p||(p={}));function i(E){return E>=p.Success&&E<p.BadRequest}c.isSuccessCode=i,c.default=p},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importStar(r(2)),E=p.__importDefault(r(34)),T=p.__importDefault(r(7)),u=p.__importDefault(r(3)),d=p.__importDefault(r(14)),A=p.__importDefault(r(5)),R=p.__importDefault(r(37)),O=p.__importDefault(r(22)),a=p.__importDefault(r(38)),C=function(){};function w(f){return f.clientId+":"+f.connectionId}function _(f){return f.channel.realtime.auth.clientId}function b(f){var l=f.channel.realtime,s=l.auth.clientId;return(!s||s==="*")&&l.connection.state==="connected"}function m(f,l,s){switch(f.state){case"attached":case"suspended":s();break;case"initialized":case"detached":case"detaching":case"attaching":f.attach(function(y){y?l(y):s()});break;default:l(A.default.fromValues(R.default.invalidStateError(f.state)))}}function S(f,l){if(f.isSynthesized()||l.isSynthesized())return f.timestamp>l.timestamp;var s=f.parseId(),y=l.parseId();return s.msgSerial===y.msgSerial?s.index>y.index:s.msgSerial>y.msgSerial}var o=function(f){p.__extends(l,f);function l(s){var y=f.call(this,s)||this;return y.channel=s,y.syncComplete=!1,y.members=new g(y),y._myMembers=new g(y),y.subscriptions=new T.default,y.pendingPresence=[],y}return l.prototype.enter=function(s,y){if(b(this))throw new A.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,s,"enter",y)},l.prototype.update=function(s,y){if(b(this))throw new A.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,s,"update",y)},l.prototype.enterClient=function(s,y,P){return this._enterOrUpdateClient(s,y,"enter",P)},l.prototype.updateClient=function(s,y,P){return this._enterOrUpdateClient(s,y,"update",P)},l.prototype._enterOrUpdateClient=function(s,y,P,D){var k=this;if(!D)if(typeof y=="function")D=y,y=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[s,y,P]);D=C}var H=this.channel;if(!H.connectionManager.activeState()){D(H.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence."+P+"Client()","channel = "+H.name+", client = "+(s||"(implicit) "+_(this)));var U=d.default.fromValues({action:P,data:y});s&&(U.clientId=s),d.default.encode(U,H.channelOptions,function(I){if(I){D(I);return}switch(H.state){case"attached":H.sendPresence(U,D);break;case"initialized":case"detached":H.attach();case"attaching":k.pendingPresence.push({presence:U,callback:D});break;default:I=new A.default("Unable to "+P+" presence channel while in "+H.state+" state",90001),I.code=90001,D(I)}})},l.prototype.leave=function(s,y){if(b(this))throw new A.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,s,y)},l.prototype.leaveClient=function(s,y,P){if(!P)if(typeof y=="function")P=y,y=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[s,y]);P=C}var D=this.channel;if(!D.connectionManager.activeState()){P==null||P(D.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+s);var k=d.default.fromValues({action:"leave",data:y});switch(s&&(k.clientId=s),D.state){case"attached":D.sendPresence(k,P);break;case"attaching":this.pendingPresence.push({presence:k,callback:P});break;case"initialized":case"failed":{var H=new A.default("Unable to leave presence channel (incompatible state)",90001);P==null||P(H);break}default:P==null||P(R.default.invalidStateError(D.state))}},l.prototype.get=function(s,y){var P=this,D=Array.prototype.slice.call(arguments);D.length==1&&typeof D[0]=="function"&&D.unshift(null),s=D[0],y=D[1];var k=!s||("waitForSync"in s?s.waitForSync:!0);if(!y){if(this.channel.realtime.options.promises)return i.promisify(this,"get",D);y=C}function H(U){y(null,s?U.list(s):U.values())}if(this.channel.state==="suspended"){k?y(A.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}m(this.channel,y,function(){var U=P.members;k?U.waitSync(function(){H(U)}):H(U)})},l.prototype.history=function(s,y){if(u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),y===void 0)if(typeof s=="function")y=s,s=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);y=C}s&&s.untilAttach&&(this.channel.state==="attached"?(delete s.untilAttach,s.from_serial=this.channel.properties.attachSerial):y(new A.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),E.default.prototype._history.call(this,s,y)},l.prototype.setPresence=function(s,y,P){u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+s.length+" participants; syncChannelSerial = "+P);var D,k,H=this.members,U=this._myMembers,I=[],x=this.channel.connectionManager.connectionId;y&&(this.members.startSync(),P&&(k=P.match(/^[\w-]+:(.*)$/))&&(D=k[1]));for(var z=0;z<s.length;z++){var W=d.default.fromValues(s[z]);switch(W.action){case"leave":H.remove(W)&&I.push(W),W.connectionId===x&&!W.isSynthesized()&&U.remove(W);break;case"enter":case"present":case"update":H.put(W)&&I.push(W),W.connectionId===x&&U.put(W);break}}y&&!D&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(R.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<I.length;z++){var W=I[z];this.subscriptions.emit(W.action,W)}},l.prototype.onAttached=function(s){u.default.logAction(u.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+s),s?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var y=this.pendingPresence,P=y.length;if(P){this.pendingPresence=[];var D=[],k=O.default.create();u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+P+" queued presence messages");for(var H=0;H<P;H++){var U=y[H];D.push(U.presence),k.push(U.callback)}this.channel.sendPresence(D,k)}},l.prototype.actOnChannelState=function(s,y,P){switch(s){case"attached":this.onAttached(y);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(P);break}},l.prototype.failPendingPresence=function(s){if(this.pendingPresence.length){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(s));for(var y=0;y<this.pendingPresence.length;y++)try{this.pendingPresence[y].callback(s)}catch(P){}this.pendingPresence=[]}},l.prototype._clearMyMembers=function(){this._myMembers.clear()},l.prototype._ensureMyMembersPresent=function(){var s=this,y=this.members,P=this._myMembers,D=function(U){if(U){var I="Presence auto-re-enter failed: "+U.toString(),x=new A.default(I,91004,400);u.default.logAction(u.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",I);var z=new a.default(s.channel.state,s.channel.state,!0,x);s.channel.emit("update",z)}};for(var k in P.map)if(!(k in y.map)){var H=P.map[k];u.default.logAction(u.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",D),delete P.map[k]}},l.prototype._synthesizeLeaves=function(s){var y=this.subscriptions;i.arrForEach(s,function(P){var D=d.default.fromValues({action:"leave",connectionId:P.connectionId,clientId:P.clientId,data:P.data,encoding:P.encoding,timestamp:i.now()});y.emit("leave",D)})},l.prototype.on=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];u.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,s)},l.prototype.off=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];u.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,s)},l.prototype.subscribe=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];var P=R.default.processListenerArgs(s),D=P[0],k=P[1],H=P[2],U=this.channel;if(!H){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[D,k]);H=C}if(U.state==="failed"){H(A.default.fromValues(R.default.invalidStateError("failed")));return}this.subscriptions.on(D,k),U.attach(H)},l.prototype.unsubscribe=function(){for(var s=[],y=0;y<arguments.length;y++)s[y]=arguments[y];var P=R.default.processListenerArgs(s),D=P[0],k=P[1];this.subscriptions.off(D,k)},l}(E.default),g=function(f){p.__extends(l,f);function l(s){var y=f.call(this)||this;return y.presence=s,y.map={},y.syncInProgress=!1,y.residualMembers=null,y}return l.prototype.get=function(s){return this.map[s]},l.prototype.getClient=function(s){var y=this.map,P=[];for(var D in y){var k=y[D];k.clientId==s&&k.action!="absent"&&P.push(k)}return P},l.prototype.list=function(s){var y=this.map,P=s&&s.clientId,D=s&&s.connectionId,k=[];for(var H in y){var U=y[H];U.action!=="absent"&&(P&&P!=U.clientId||D&&D!=U.connectionId||k.push(U))}return k},l.prototype.put=function(s){(s.action==="enter"||s.action==="update")&&(s=d.default.fromValues(s),s.action="present");var y=this.map,P=w(s);this.residualMembers&&delete this.residualMembers[P];var D=y[P];return D&&!S(s,D)?!1:(y[P]=s,!0)},l.prototype.values=function(){var s=this.map,y=[];for(var P in s){var D=s[P];D.action!="absent"&&y.push(D)}return y},l.prototype.remove=function(s){var y=this.map,P=w(s),D=y[P];return D&&!S(s,D)?!1:(this.syncInProgress?(s=d.default.fromValues(s),s.action="absent",y[P]=s):delete y[P],!0)},l.prototype.startSync=function(){var s=this.map,y=this.syncInProgress;u.default.logAction(u.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),this.syncInProgress||(this.residualMembers=i.copy(s),this.setInProgress(!0))},l.prototype.endSync=function(){var s=this.map,y=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),y){for(var P in s){var D=s[P];D.action==="absent"&&delete s[P]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var k in this.residualMembers)delete s[k];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},l.prototype.waitSync=function(s){var y=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),!y){s();return}this.once("sync",s)},l.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},l.prototype.setInProgress=function(s){u.default.logAction(u.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+s),this.syncInProgress=s,this.presence.syncComplete=!s},l}(T.default);c.default=o},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=r(56),E=r(32),T=r(13),u=p.__importDefault(r(4)),d=p.__importDefault(r(0)),A=function(){function R(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return R.prototype.isWordArray=function(O){return O!=null&&O.sigBytes!==void 0},R.prototype.isArrayBuffer=function(O){return O!=null&&O.constructor===ArrayBuffer},R.prototype.isTypedArray=function(O){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(O)},R.prototype.uint8ViewToBase64=function(O){for(var a="",C=this.base64CharSet,w=O.byteLength,_=w%3,b=w-_,m,S,o,g,f,l=0;l<b;l=l+3)f=O[l]<<16|O[l+1]<<8|O[l+2],m=(f&16515072)>>18,S=(f&258048)>>12,o=(f&4032)>>6,g=f&63,a+=C[m]+C[S]+C[o]+C[g];return _==1?(f=O[b],m=(f&252)>>2,S=(f&3)<<4,a+=C[m]+C[S]+"=="):_==2&&(f=O[b]<<8|O[b+1],m=(f&64512)>>10,S=(f&1008)>>4,o=(f&15)<<2,a+=C[m]+C[S]+C[o]+"="),a},R.prototype.base64ToArrayBuffer=function(O){for(var a=atob==null?void 0:atob(O),C=a.length,w=new Uint8Array(C),_=0;_<C;_++){var b=a.charCodeAt(_);w[_]=b}return w.buffer},R.prototype.isBuffer=function(O){return this.isArrayBuffer(O)||this.isWordArray(O)||this.isTypedArray(O)},R.prototype.toBuffer=function(O){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(O))return new Uint8Array(O);if(this.isTypedArray(O))return new Uint8Array(O.buffer);if(this.isWordArray(O)){for(var a=new ArrayBuffer(O.sigBytes),C=new Uint8Array(a),w=0;w<O.sigBytes;w++)C[w]=O.words[w>>>2]>>>24-w%4*8&255;return C}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},R.prototype.toArrayBuffer=function(O){return this.isArrayBuffer(O)?O:this.toBuffer(O).buffer},R.prototype.toWordArray=function(O){return this.isTypedArray(O)&&(O=O.buffer),this.isWordArray(O)?O:u.default.create(O)},R.prototype.base64Encode=function(O){return this.isWordArray(O)?T.stringify(O):this.uint8ViewToBase64(this.toBuffer(O))},R.prototype.base64Decode=function(O){return ArrayBuffer&&d.default.Config.atob?this.base64ToArrayBuffer(O):T.parse(O)},R.prototype.hexEncode=function(O){return i.stringify(this.toWordArray(O))},R.prototype.hexDecode=function(O){var a=i.parse(O);return ArrayBuffer?this.toArrayBuffer(a):a},R.prototype.utf8Encode=function(O){return TextEncoder?new TextEncoder().encode(O).buffer:E.parse(O)},R.prototype.utf8Decode=function(O){if(!this.isBuffer(O))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(O)?new TextDecoder().decode(O):(O=this.toWordArray(O),E.stringify(O))},R.prototype.bufferCompare=function(O,a){if(!O)return-1;if(!a)return 1;var C=this.toWordArray(O),w=this.toWordArray(a);C.clamp(),w.clamp();var _=C.sigBytes-w.sigBytes;if(_!=0)return _;for(var b=C.words,m=w.words,S=0;S<b.length;S++)if(_=b[S]-m[S],_!=0)return _;return 0},R.prototype.byteLength=function(O){return this.isArrayBuffer(O)||this.isTypedArray(O)?O.byteLength:this.isWordArray(O)?O.sigBytes:-1},R.prototype.typedArrayToBuffer=function(O){return O.buffer},R}();c.default=new A},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return p.enc.Hex})},function(v,c,r){"use strict";r.r(c);var p=r(4),i=r.n(p),E=r(13),T=r.n(E),u=r(21),d=r.n(u),A=r(0),R=r.n(A),O=r(3),a=r.n(O),C=function(){var w="aes",_=256,b="cbc",m=16,S=4,o=4294967296,g=2147483648,f;if(R.a.getRandomWordArray)f=R.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&R.a.getRandomValues){var l=new Uint32Array(S);f=function(I,x){var z=I/4,W=z==S?l:new Uint32Array(z);R.a.getRandomValues(W,function(Q){x(Q,R.a.BufferUtils.toWordArray(W))})}}else f=function(I,x){a.a.logAction(a.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=I/4,W=new Array(z),Q=0;Q<z;Q++)W[Q]=Math.floor(Math.random()*o)-g;x(null,i.a.create(W))};function s(I){return I+m&-m}function y(I){if(I.algorithm==="aes"&&I.mode==="cbc"){if(I.keyLength===128||I.keyLength===256)return;throw new Error("Unsupported key length "+I.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function P(I){return I.replace("_","/").replace("-","+")}var D=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function k(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}k.CipherParams=H,k.getDefaultParams=function(I){var x;if(typeof I=="function"||typeof I=="string"){if(a.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof I=="function")k.generateRandomKey(function(W){I(null,k.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,k.getDefaultParams({key:I}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!I.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof I.key=="string"?x=Object(E.parse)(P(I.key)):x=R.a.BufferUtils.toWordArray(I.key);var z=new H;if(z.key=x,z.algorithm=I.algorithm||w,z.keyLength=x.words.length*(4*8),z.mode=I.mode||b,I.keyLength&&I.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+I.keyLength+" was specified, but the key actually has length "+z.keyLength);return y(z),z},k.generateRandomKey=function(I,x){arguments.length==1&&typeof I=="function"&&(x=I,I=void 0),f((I||_)/8,x)},k.getCipher=function(I){var x=I instanceof H?I:k.getDefaultParams(I);return{cipherParams:x,cipher:new U(x,S,I.iv)}};function U(I,x,z){this.algorithm=I.algorithm+"-"+String(I.keyLength)+"-"+I.mode,this.cjsAlgorithm=I.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.a.BufferUtils.toWordArray(I.key),z&&(this.iv=R.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=x}return U.prototype.encrypt=function(I,x){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.encrypt()",""),I=R.a.BufferUtils.toWordArray(I);var z=I.sigBytes,W=s(z),Q=this,Z=function(){Q.getIv(function($,G){if($){x($);return}var N=Q.encryptCipher.process(I.concat(D[W-z])),B=G.concat(N);x(null,B)})};this.encryptCipher?Z():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),Z()):f(m,function($,G){if($){x($);return}Q.encryptCipher=d.a.algo[Q.cjsAlgorithm].createEncryptor(Q.key,{iv:G}),Q.iv=G,Z()})},U.prototype.decrypt=function(I){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.decrypt()",""),I=R.a.BufferUtils.toWordArray(I);var x=this.blockLengthWords,z=I.words,W=i.a.create(z.slice(0,x)),Q=i.a.create(z.slice(x)),Z=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),$=Z.process(Q),G=Z.finalize();return Z.reset(),G&&G.sigBytes&&$.concat(G),$},U.prototype.getIv=function(I){if(this.iv){var x=this.iv;this.iv=null,I(null,x);return}var z=this;f(m,function(W,Q){if(W){I(W);return}I(null,z.encryptCipher.process(Q))})},k}();c.default=C},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(){var i=p,E=i.lib,T=E.WordArray,u=i.enc,d=u.Utf16=u.Utf16BE={stringify:function(R){for(var O=R.words,a=R.sigBytes,C=[],w=0;w<a;w+=2){var _=O[w>>>2]>>>16-w%4*8&65535;C.push(String.fromCharCode(_))}return C.join("")},parse:function(R){for(var O=R.length,a=[],C=0;C<O;C++)a[C>>>1]|=R.charCodeAt(C)<<16-C%2*16;return T.create(a,O*2)}};u.Utf16LE={stringify:function(R){for(var O=R.words,a=R.sigBytes,C=[],w=0;w<a;w+=2){var _=A(O[w>>>2]>>>16-w%4*8&65535);C.push(String.fromCharCode(_))}return C.join("")},parse:function(R){for(var O=R.length,a=[],C=0;C<O;C++)a[C>>>1]|=A(R.charCodeAt(C)<<16-C%2*16);return T.create(a,O*2)}};function A(R){return R<<8&4278255360|R>>>8&16711935}}(),p.enc.Utf16})},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(28))})(this,function(p){return function(i){var E=p,T=E.lib,u=T.CipherParams,d=E.enc,A=d.Hex,R=E.format,O=R.Hex={stringify:function(a){return a.ciphertext.toString(A)},parse:function(a){var C=A.parse(a);return u.create({ciphertext:C})}}}(),p.format.Hex})},function(v,c,r){(function(p,i){v.exports=c=i(r(6),r(13),r(61),r(27),r(28))})(this,function(p){return function(){var i=p,E=i.lib,T=E.BlockCipher,u=i.algo,d=[],A=[],R=[],O=[],a=[],C=[],w=[],_=[],b=[],m=[];(function(){for(var g=[],f=0;f<256;f++)f<128?g[f]=f<<1:g[f]=f<<1^283;for(var l=0,s=0,f=0;f<256;f++){var y=s^s<<1^s<<2^s<<3^s<<4;y=y>>>8^y&255^99,d[l]=y,A[y]=l;var P=g[l],D=g[P],k=g[D],H=g[y]*257^y*16843008;R[l]=H<<24|H>>>8,O[l]=H<<16|H>>>16,a[l]=H<<8|H>>>24,C[l]=H;var H=k*16843009^D*65537^P*257^l*16843008;w[y]=H<<24|H>>>8,_[y]=H<<16|H>>>16,b[y]=H<<8|H>>>24,m[y]=H,l?(l=P^g[g[g[k^P]]],s^=g[g[s]]):l=s=1}})();var S=[0,1,2,4,8,16,32,64,128,27,54],o=u.AES=T.extend({_doReset:function(){var g;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var f=this._keyPriorReset=this._key,l=f.words,s=f.sigBytes/4,y=this._nRounds=s+6,P=(y+1)*4,D=this._keySchedule=[],k=0;k<P;k++)k<s?D[k]=l[k]:(g=D[k-1],k%s?s>6&&k%s==4&&(g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[g&255]):(g=g<<8|g>>>24,g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[g&255],g^=S[k/s|0]<<24),D[k]=D[k-s]^g);for(var H=this._invKeySchedule=[],U=0;U<P;U++){var k=P-U;if(U%4)var g=D[k];else var g=D[k-4];U<4||k<=4?H[U]=g:H[U]=w[d[g>>>24]]^_[d[g>>>16&255]]^b[d[g>>>8&255]]^m[d[g&255]]}}},encryptBlock:function(g,f){this._doCryptBlock(g,f,this._keySchedule,R,O,a,C,d)},decryptBlock:function(g,f){var l=g[f+1];g[f+1]=g[f+3],g[f+3]=l,this._doCryptBlock(g,f,this._invKeySchedule,w,_,b,m,A);var l=g[f+1];g[f+1]=g[f+3],g[f+3]=l},_doCryptBlock:function(g,f,l,s,y,P,D,k){for(var H=this._nRounds,U=g[f]^l[0],I=g[f+1]^l[1],x=g[f+2]^l[2],z=g[f+3]^l[3],W=4,Q=1;Q<H;Q++){var Z=s[U>>>24]^y[I>>>16&255]^P[x>>>8&255]^D[z&255]^l[W++],$=s[I>>>24]^y[x>>>16&255]^P[z>>>8&255]^D[U&255]^l[W++],G=s[x>>>24]^y[z>>>16&255]^P[U>>>8&255]^D[I&255]^l[W++],N=s[z>>>24]^y[U>>>16&255]^P[I>>>8&255]^D[x&255]^l[W++];U=Z,I=$,x=G,z=N}var Z=(k[U>>>24]<<24|k[I>>>16&255]<<16|k[x>>>8&255]<<8|k[z&255])^l[W++],$=(k[I>>>24]<<24|k[x>>>16&255]<<16|k[z>>>8&255]<<8|k[U&255])^l[W++],G=(k[x>>>24]<<24|k[z>>>16&255]<<16|k[U>>>8&255]<<8|k[I&255])^l[W++],N=(k[z>>>24]<<24|k[U>>>16&255]<<16|k[I>>>8&255]<<8|k[x&255])^l[W++];g[f]=Z,g[f+1]=$,g[f+2]=G,g[f+3]=N},keySize:256/32});i.AES=T._createHelper(o)}(),p.AES})},function(v,c,r){(function(p,i){v.exports=c=i(r(6))})(this,function(p){return function(i){var E=p,T=E.lib,u=T.WordArray,d=T.Hasher,A=E.algo,R=[];(function(){for(var b=0;b<64;b++)R[b]=i.abs(i.sin(b+1))*4294967296|0})();var O=A.MD5=d.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(b,m){for(var S=0;S<16;S++){var o=m+S,g=b[o];b[o]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}var f=this._hash.words,l=b[m+0],s=b[m+1],y=b[m+2],P=b[m+3],D=b[m+4],k=b[m+5],H=b[m+6],U=b[m+7],I=b[m+8],x=b[m+9],z=b[m+10],W=b[m+11],Q=b[m+12],Z=b[m+13],$=b[m+14],G=b[m+15],N=f[0],B=f[1],K=f[2],V=f[3];N=a(N,B,K,V,l,7,R[0]),V=a(V,N,B,K,s,12,R[1]),K=a(K,V,N,B,y,17,R[2]),B=a(B,K,V,N,P,22,R[3]),N=a(N,B,K,V,D,7,R[4]),V=a(V,N,B,K,k,12,R[5]),K=a(K,V,N,B,H,17,R[6]),B=a(B,K,V,N,U,22,R[7]),N=a(N,B,K,V,I,7,R[8]),V=a(V,N,B,K,x,12,R[9]),K=a(K,V,N,B,z,17,R[10]),B=a(B,K,V,N,W,22,R[11]),N=a(N,B,K,V,Q,7,R[12]),V=a(V,N,B,K,Z,12,R[13]),K=a(K,V,N,B,$,17,R[14]),B=a(B,K,V,N,G,22,R[15]),N=C(N,B,K,V,s,5,R[16]),V=C(V,N,B,K,H,9,R[17]),K=C(K,V,N,B,W,14,R[18]),B=C(B,K,V,N,l,20,R[19]),N=C(N,B,K,V,k,5,R[20]),V=C(V,N,B,K,z,9,R[21]),K=C(K,V,N,B,G,14,R[22]),B=C(B,K,V,N,D,20,R[23]),N=C(N,B,K,V,x,5,R[24]),V=C(V,N,B,K,$,9,R[25]),K=C(K,V,N,B,P,14,R[26]),B=C(B,K,V,N,I,20,R[27]),N=C(N,B,K,V,Z,5,R[28]),V=C(V,N,B,K,y,9,R[29]),K=C(K,V,N,B,U,14,R[30]),B=C(B,K,V,N,Q,20,R[31]),N=w(N,B,K,V,k,4,R[32]),V=w(V,N,B,K,I,11,R[33]),K=w(K,V,N,B,W,16,R[34]),B=w(B,K,V,N,$,23,R[35]),N=w(N,B,K,V,s,4,R[36]),V=w(V,N,B,K,D,11,R[37]),K=w(K,V,N,B,U,16,R[38]),B=w(B,K,V,N,z,23,R[39]),N=w(N,B,K,V,Z,4,R[40]),V=w(V,N,B,K,l,11,R[41]),K=w(K,V,N,B,P,16,R[42]),B=w(B,K,V,N,H,23,R[43]),N=w(N,B,K,V,x,4,R[44]),V=w(V,N,B,K,Q,11,R[45]),K=w(K,V,N,B,G,16,R[46]),B=w(B,K,V,N,y,23,R[47]),N=_(N,B,K,V,l,6,R[48]),V=_(V,N,B,K,U,10,R[49]),K=_(K,V,N,B,$,15,R[50]),B=_(B,K,V,N,k,21,R[51]),N=_(N,B,K,V,Q,6,R[52]),V=_(V,N,B,K,P,10,R[53]),K=_(K,V,N,B,z,15,R[54]),B=_(B,K,V,N,s,21,R[55]),N=_(N,B,K,V,I,6,R[56]),V=_(V,N,B,K,G,10,R[57]),K=_(K,V,N,B,H,15,R[58]),B=_(B,K,V,N,Z,21,R[59]),N=_(N,B,K,V,D,6,R[60]),V=_(V,N,B,K,W,10,R[61]),K=_(K,V,N,B,y,15,R[62]),B=_(B,K,V,N,x,21,R[63]),f[0]=f[0]+N|0,f[1]=f[1]+B|0,f[2]=f[2]+K|0,f[3]=f[3]+V|0},_doFinalize:function(){var b=this._data,m=b.words,S=this._nDataBytes*8,o=b.sigBytes*8;m[o>>>5]|=128<<24-o%32;var g=i.floor(S/4294967296),f=S;m[(o+64>>>9<<4)+15]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,m[(o+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,b.sigBytes=(m.length+1)*4,this._process();for(var l=this._hash,s=l.words,y=0;y<4;y++){var P=s[y];s[y]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return l},clone:function(){var b=d.clone.call(this);return b._hash=this._hash.clone(),b}});function a(b,m,S,o,g,f,l){var s=b+(m&S|~m&o)+g+l;return(s<<f|s>>>32-f)+m}function C(b,m,S,o,g,f,l){var s=b+(m&o|S&~o)+g+l;return(s<<f|s>>>32-f)+m}function w(b,m,S,o,g,f,l){var s=b+(m^S^o)+g+l;return(s<<f|s>>>32-f)+m}function _(b,m,S,o,g,f,l){var s=b+(S^(m|~o))+g+l;return(s<<f|s>>>32-f)+m}E.MD5=d._createHelper(O),E.HmacMD5=d._createHmacHelper(O)}(Math),p.MD5})},function(v,c,r){"use strict";var p;c.__esModule=!0;var i=r(1),E=i.__importDefault(r(0)),T=i.__importStar(r(2)),u=i.__importDefault(r(8)),d=i.__importDefault(r(5)),A=i.__importDefault(r(17)),R=i.__importDefault(r(15)),O=i.__importDefault(r(20)),a=i.__importDefault(r(3)),C=r(29);function w(m){var S=m.statusCode;return S===408&&!m.code||S===400&&!m.code||S>=500&&S<=504}function _(m){var S=m.connection,o=S&&S.connectionManager.host;return o?[o].concat(u.default.getFallbackHosts(m.options)):u.default.getHosts(m.options)}var b=(p=function(){function m(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=_,E.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(S,o,g,f,l,s,y){var P=R.default.createRequest(g,f,l,s,O.default.REQ_SEND,o&&o.options.timeouts,S);return P.once("complete",y),P.exec(),P},this.checkConnectivity=function(S){var o=u.default.internetUpUrl;a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+o),this.doUri(A.default.Get,null,o,null,null,null,function(g,f){var l,s=!g&&((l=f)===null||l===void 0?void 0:l.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+s),S(null,s)})}):E.default.Config.jsonpSupported&&(this.Request=function(S,o,g,f,l,s,y){var P=C.createRequest(g,f,l,s,O.default.REQ_SEND,o&&o.options.timeouts,S);return P.once("complete",y),E.default.Config.nextTick(function(){P.exec()}),P},this.checkConnectivity=function(S){var o=this,g=u.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(S);return}this.checksInProgress=[S],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+g);var f=new C.Request("isTheInternetUp",g,null,null,null,O.default.REQ_SEND,u.default.TIMEOUTS);f.once("complete",function(l,s){var y=!l&&s;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+y);for(var P=0;P<o.checksInProgress.length;P++)o.checksInProgress[P](null,y);o.checksInProgress=null}),E.default.Config.nextTick(function(){f.exec()})})}return m.prototype.do=function(S,o,g,f,l,s,y){var P=this,D=typeof g=="function"?g:function(I){return o.baseUri(I)+g},k=o._currentFallback;if(k)if(k.validUntil>T.now()){if(!this.Request){y==null||y(new d.default("Request invoked before assigned to",null,500));return}this.Request(S,o,D(k.host),f,s,l,function(I){for(var x=[],z=1;z<arguments.length;z++)x[z-1]=arguments[z];if(I&&w(I)){o._currentFallback=null,P.do(S,o,g,f,l,s,y);return}y==null||y.apply(void 0,i.__spreadArray([I],x))});return}else o._currentFallback=null;var H=_(o);if(H.length===1){this.doUri(S,o,D(H[0]),f,l,s,y);return}var U=function(I,x){var z=I.shift();P.doUri(S,o,D(z),f,l,s,function(W){for(var Q=[],Z=1;Z<arguments.length;Z++)Q[Z-1]=arguments[Z];if(W&&w(W)&&I.length){U(I,!0);return}x&&(o._currentFallback={host:z,validUntil:T.now()+o.options.timeouts.fallbackRetryTimeout}),y==null||y.apply(void 0,i.__spreadArray([W],Q))})};U(H)},m.prototype.doUri=function(S,o,g,f,l,s,y){if(!this.Request){y(new d.default("Request invoked before assigned to",null,500));return}this.Request(S,o,g,f,s,l,y)},m}(),p.methods=[A.default.Get,A.default.Delete,A.default.Post,A.default.Put,A.default.Patch],p.methodsWithoutBody=[A.default.Get,A.default.Delete],p.methodsWithBody=[A.default.Post,A.default.Put,A.default.Patch],p);c.default=b},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(40)),E=p.__importStar(r(2)),T=E.getGlobalObject();function u(){var O=T.location;return!T.WebSocket||!O||!O.origin||O.origin.indexOf("http")>-1}var d=T.navigator&&T.navigator.userAgent.toString(),A=T.location&&T.location.href,R={agent:"browser",logTimestamps:!0,userAgent:d,currentUrl:A,noUpgrade:d&&!!d.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:T.WebSocket,xhrSupported:T.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:u(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!T.TextDecoder,preferBinary:!1,ArrayBuffer:T.ArrayBuffer,atob:T.atob,nextTick:typeof T.setImmediate!="undefined"?T.setImmediate.bind(T):function(O){setTimeout(O,0)},addEventListener:T.addEventListener,inspect:JSON.stringify,stringByteSize:function(O){return T.TextDecoder&&new T.TextEncoder().encode(O).length||O.length},TextEncoder:T.TextEncoder,TextDecoder:T.TextDecoder,Promise:T.Promise,getRandomValues:function(O){if(O!==void 0)return function(a,C){O.getRandomValues(a),C&&C(null)}}(T.crypto||msCrypto)};c.default=R},function(v,c,r){"use strict";(function(p){c.__esModule=!0;var i=r(1),E=i.__importStar(r(2)),T="ablyjs-storage-test",u=function(){function d(){try{p.sessionStorage.setItem(T,T),p.sessionStorage.removeItem(T),this.sessionSupported=!0}catch(A){this.sessionSupported=!1}try{p.localStorage.setItem(T,T),p.localStorage.removeItem(T),this.localSupported=!0}catch(A){this.localSupported=!1}}return d.prototype.get=function(A){return this._get(A,!1)},d.prototype.getSession=function(A){return this._get(A,!0)},d.prototype.remove=function(A){return this._remove(A,!1)},d.prototype.removeSession=function(A){return this._remove(A,!0)},d.prototype.set=function(A,R,O){return this._set(A,R,O,!1)},d.prototype.setSession=function(A,R,O){return this._set(A,R,O,!0)},d.prototype._set=function(A,R,O,a){var C={value:R};return O&&(C.expires=E.now()+O),this.storageInterface(a).setItem(A,JSON.stringify(C))},d.prototype._get=function(A,R){if(R&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!R&&!this.localSupported)throw new Error("Local Storage not supported");var O=this.storageInterface(R).getItem(A);if(!O)return null;var a=JSON.parse(O);return a.expires&&a.expires<E.now()?(this.storageInterface(R).removeItem(A),null):a.value},d.prototype._remove=function(A,R){return this.storageInterface(R).removeItem(A)},d.prototype.storageInterface=function(A){return A?p.sessionStorage:p.localStorage},d}();c.default=new u}).call(this,r(12))},function(v,c,r){"use strict";c.__esModule=!0;var p=r(1),i=p.__importDefault(r(66)),E={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};c.default=E},function(v,c,r){"use strict";c.__esModule=!0;var p;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(p||(p={})),c.default=p},function(v,c,r){"use strict";r.r(c);var p=r(29),i=r.n(p),E=r(2),T=r(0),u=r.n(T),d=r(11),A=r.n(d),R=r(15),O=r.n(R),a=function(m){var S="xhr_polling";function o(g,f,l){l.stream=!1,A.a.call(this,g,f,l),this.shortName=S}return E.inherits(o,A.a),o.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.allowComet},o.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(g,f,l,s,y){return O.a.createRequest(g,f,l,s,y,this.timeouts)},typeof m!="undefined"&&o.isAvailable()&&(m.supportedTransports[S]=o),o},C=a,w=function(m){var S="xhr_streaming";function o(g,f,l){A.a.call(this,g,f,l),this.shortName=S}return E.inherits(o,A.a),o.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.streamingSupported&&u.a.Config.allowComet},o.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(g,f,l,s,y){return O.a.createRequest(g,f,l,s,y,this.timeouts)},typeof m!="undefined"&&o.isAvailable()&&(m.supportedTransports[S]=o),o},_=w,b=c.default=[i.a,C,_]}]).default})});var gf=Kt((nr,zo)=>{st();(function(v,c){typeof nr=="object"&&typeof zo=="object"?zo.exports=c():typeof define=="function"&&define.amd?define([],c):typeof nr=="object"?nr.bowser=c():v.bowser=c()})(nr,function(){return function(v){var c={};function r(p){if(c[p])return c[p].exports;var i=c[p]={i:p,l:!1,exports:{}};return v[p].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=v,r.c=c,r.d=function(p,i,E){r.o(p,i)||Object.defineProperty(p,i,{enumerable:!0,get:E})},r.r=function(p){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},r.t=function(p,i){if(1&i&&(p=r(p)),8&i||4&i&&typeof p=="object"&&p&&p.__esModule)return p;var E=Object.create(null);if(r.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:p}),2&i&&typeof p!="string")for(var T in p)r.d(E,T,function(u){return p[u]}.bind(null,T));return E},r.n=function(p){var i=p&&p.__esModule?function(){return p.default}:function(){return p};return r.d(i,"a",i),i},r.o=function(p,i){return Object.prototype.hasOwnProperty.call(p,i)},r.p="",r(r.s=90)}({17:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p=r(18),i=function(){function E(){}return E.getFirstMatch=function(T,u){var d=u.match(T);return d&&d.length>0&&d[1]||""},E.getSecondMatch=function(T,u){var d=u.match(T);return d&&d.length>1&&d[2]||""},E.matchAndReturnConst=function(T,u,d){if(T.test(u))return d},E.getWindowsVersionName=function(T){switch(T){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},E.getMacOSVersionName=function(T){var u=T.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(u.push(0),u[0]===10)switch(u[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},E.getAndroidVersionName=function(T){var u=T.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(u.push(0),!(u[0]===1&&u[1]<5))return u[0]===1&&u[1]<6?"Cupcake":u[0]===1&&u[1]>=6?"Donut":u[0]===2&&u[1]<2?"Eclair":u[0]===2&&u[1]===2?"Froyo":u[0]===2&&u[1]>2?"Gingerbread":u[0]===3?"Honeycomb":u[0]===4&&u[1]<1?"Ice Cream Sandwich":u[0]===4&&u[1]<4?"Jelly Bean":u[0]===4&&u[1]>=4?"KitKat":u[0]===5?"Lollipop":u[0]===6?"Marshmallow":u[0]===7?"Nougat":u[0]===8?"Oreo":u[0]===9?"Pie":void 0},E.getVersionPrecision=function(T){return T.split(".").length},E.compareVersions=function(T,u,d){d===void 0&&(d=!1);var A=E.getVersionPrecision(T),R=E.getVersionPrecision(u),O=Math.max(A,R),a=0,C=E.map([T,u],function(w){var _=O-E.getVersionPrecision(w),b=w+new Array(_+1).join(".0");return E.map(b.split("."),function(m){return new Array(20-m.length).join("0")+m}).reverse()});for(d&&(a=O-Math.min(A,R)),O-=1;O>=a;){if(C[0][O]>C[1][O])return 1;if(C[0][O]===C[1][O]){if(O===a)return 0;O-=1}else if(C[0][O]<C[1][O])return-1}},E.map=function(T,u){var d,A=[];if(Array.prototype.map)return Array.prototype.map.call(T,u);for(d=0;d<T.length;d+=1)A.push(u(T[d]));return A},E.find=function(T,u){var d,A;if(Array.prototype.find)return Array.prototype.find.call(T,u);for(d=0,A=T.length;d<A;d+=1){var R=T[d];if(u(R,d))return R}},E.assign=function(T){for(var u,d,A=T,R=arguments.length,O=new Array(R>1?R-1:0),a=1;a<R;a++)O[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[T].concat(O));var C=function(){var w=O[u];typeof w=="object"&&w!==null&&Object.keys(w).forEach(function(_){A[_]=w[_]})};for(u=0,d=O.length;u<d;u+=1)C();return T},E.getBrowserAlias=function(T){return p.BROWSER_ALIASES_MAP[T]},E.getBrowserTypeByAlias=function(T){return p.BROWSER_MAP[T]||""},E}();c.default=i,v.exports=c.default},18:function(v,c,r){"use strict";c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p,i=(p=r(91))&&p.__esModule?p:{default:p},E=r(18);function T(d,A){for(var R=0;R<A.length;R++){var O=A[R];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(d,O.key,O)}}var u=function(){function d(){}var A,R,O;return d.getParser=function(a,C){if(C===void 0&&(C=!1),typeof a!="string")throw new Error("UserAgent should be a string");return new i.default(a,C)},d.parse=function(a){return new i.default(a).getResult()},A=d,O=[{key:"BROWSER_MAP",get:function(){return E.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return E.ENGINE_MAP}},{key:"OS_MAP",get:function(){return E.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return E.PLATFORMS_MAP}}],(R=null)&&T(A.prototype,R),O&&T(A,O),d}();c.default=u,v.exports=c.default},91:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p=d(r(92)),i=d(r(93)),E=d(r(94)),T=d(r(95)),u=d(r(17));function d(R){return R&&R.__esModule?R:{default:R}}var A=function(){function R(a,C){if(C===void 0&&(C=!1),a==null||a==="")throw new Error("UserAgent parameter can't be empty");this._ua=a,this.parsedResult={},C!==!0&&this.parse()}var O=R.prototype;return O.getUA=function(){return this._ua},O.test=function(a){return a.test(this._ua)},O.parseBrowser=function(){var a=this;this.parsedResult.browser={};var C=u.default.find(p.default,function(w){if(typeof w.test=="function")return w.test(a);if(w.test instanceof Array)return w.test.some(function(_){return a.test(_)});throw new Error("Browser's test function is not valid")});return C&&(this.parsedResult.browser=C.describe(this.getUA())),this.parsedResult.browser},O.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},O.getBrowserName=function(a){return a?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},O.getBrowserVersion=function(){return this.getBrowser().version},O.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},O.parseOS=function(){var a=this;this.parsedResult.os={};var C=u.default.find(i.default,function(w){if(typeof w.test=="function")return w.test(a);if(w.test instanceof Array)return w.test.some(function(_){return a.test(_)});throw new Error("Browser's test function is not valid")});return C&&(this.parsedResult.os=C.describe(this.getUA())),this.parsedResult.os},O.getOSName=function(a){var C=this.getOS().name;return a?String(C).toLowerCase()||"":C||""},O.getOSVersion=function(){return this.getOS().version},O.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},O.getPlatformType=function(a){a===void 0&&(a=!1);var C=this.getPlatform().type;return a?String(C).toLowerCase()||"":C||""},O.parsePlatform=function(){var a=this;this.parsedResult.platform={};var C=u.default.find(E.default,function(w){if(typeof w.test=="function")return w.test(a);if(w.test instanceof Array)return w.test.some(function(_){return a.test(_)});throw new Error("Browser's test function is not valid")});return C&&(this.parsedResult.platform=C.describe(this.getUA())),this.parsedResult.platform},O.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},O.getEngineName=function(a){return a?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},O.parseEngine=function(){var a=this;this.parsedResult.engine={};var C=u.default.find(T.default,function(w){if(typeof w.test=="function")return w.test(a);if(w.test instanceof Array)return w.test.some(function(_){return a.test(_)});throw new Error("Browser's test function is not valid")});return C&&(this.parsedResult.engine=C.describe(this.getUA())),this.parsedResult.engine},O.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},O.getResult=function(){return u.default.assign({},this.parsedResult)},O.satisfies=function(a){var C=this,w={},_=0,b={},m=0;if(Object.keys(a).forEach(function(P){var D=a[P];typeof D=="string"?(b[P]=D,m+=1):typeof D=="object"&&(w[P]=D,_+=1)}),_>0){var S=Object.keys(w),o=u.default.find(S,function(P){return C.isOS(P)});if(o){var g=this.satisfies(w[o]);if(g!==void 0)return g}var f=u.default.find(S,function(P){return C.isPlatform(P)});if(f){var l=this.satisfies(w[f]);if(l!==void 0)return l}}if(m>0){var s=Object.keys(b),y=u.default.find(s,function(P){return C.isBrowser(P,!0)});if(y!==void 0)return this.compareVersion(b[y])}},O.isBrowser=function(a,C){C===void 0&&(C=!1);var w=this.getBrowserName().toLowerCase(),_=a.toLowerCase(),b=u.default.getBrowserTypeByAlias(_);return C&&b&&(_=b.toLowerCase()),_===w},O.compareVersion=function(a){var C=[0],w=a,_=!1,b=this.getBrowserVersion();if(typeof b=="string")return a[0]===">"||a[0]==="<"?(w=a.substr(1),a[1]==="="?(_=!0,w=a.substr(2)):C=[],a[0]===">"?C.push(1):C.push(-1)):a[0]==="="?w=a.substr(1):a[0]==="~"&&(_=!0,w=a.substr(1)),C.indexOf(u.default.compareVersions(b,w,_))>-1},O.isOS=function(a){return this.getOSName(!0)===String(a).toLowerCase()},O.isPlatform=function(a){return this.getPlatformType(!0)===String(a).toLowerCase()},O.isEngine=function(a){return this.getEngineName(!0)===String(a).toLowerCase()},O.is=function(a,C){return C===void 0&&(C=!1),this.isBrowser(a,C)||this.isOS(a)||this.isPlatform(a)},O.some=function(a){var C=this;return a===void 0&&(a=[]),a.some(function(w){return C.is(w)})},R}();c.default=A,v.exports=c.default},92:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p,i=(p=r(17))&&p.__esModule?p:{default:p},E=/version\/(\d+(\.?_?\d+)+)/i,T=[{test:[/googlebot/i],describe:function(u){var d={name:"Googlebot"},A=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/opera/i],describe:function(u){var d={name:"Opera"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/opr\/|opios/i],describe:function(u){var d={name:"Opera"},A=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/SamsungBrowser/i],describe:function(u){var d={name:"Samsung Internet for Android"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/Whale/i],describe:function(u){var d={name:"NAVER Whale Browser"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/MZBrowser/i],describe:function(u){var d={name:"MZ Browser"},A=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/focus/i],describe:function(u){var d={name:"Focus"},A=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/swing/i],describe:function(u){var d={name:"Swing"},A=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/coast/i],describe:function(u){var d={name:"Opera Coast"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(u){var d={name:"Opera Touch"},A=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/yabrowser/i],describe:function(u){var d={name:"Yandex Browser"},A=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/ucbrowser/i],describe:function(u){var d={name:"UC Browser"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/Maxthon|mxios/i],describe:function(u){var d={name:"Maxthon"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/epiphany/i],describe:function(u){var d={name:"Epiphany"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/puffin/i],describe:function(u){var d={name:"Puffin"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/sleipnir/i],describe:function(u){var d={name:"Sleipnir"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/k-meleon/i],describe:function(u){var d={name:"K-Meleon"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/micromessenger/i],describe:function(u){var d={name:"WeChat"},A=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/qqbrowser/i],describe:function(u){var d={name:/qqbrowserlite/i.test(u)?"QQ Browser Lite":"QQ Browser"},A=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/msie|trident/i],describe:function(u){var d={name:"Internet Explorer"},A=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/\sedg\//i],describe:function(u){var d={name:"Microsoft Edge"},A=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/edg([ea]|ios)/i],describe:function(u){var d={name:"Microsoft Edge"},A=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/vivaldi/i],describe:function(u){var d={name:"Vivaldi"},A=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/seamonkey/i],describe:function(u){var d={name:"SeaMonkey"},A=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/sailfish/i],describe:function(u){var d={name:"Sailfish"},A=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,u);return A&&(d.version=A),d}},{test:[/silk/i],describe:function(u){var d={name:"Amazon Silk"},A=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/phantom/i],describe:function(u){var d={name:"PhantomJS"},A=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/slimerjs/i],describe:function(u){var d={name:"SlimerJS"},A=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var d={name:"BlackBerry"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var d={name:"WebOS Browser"},A=i.default.getFirstMatch(E,u)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/bada/i],describe:function(u){var d={name:"Bada"},A=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/tizen/i],describe:function(u){var d={name:"Tizen"},A=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/qupzilla/i],describe:function(u){var d={name:"QupZilla"},A=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(u){var d={name:"Firefox"},A=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/electron/i],describe:function(u){var d={name:"Electron"},A=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/MiuiBrowser/i],describe:function(u){var d={name:"Miui"},A=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/chromium/i],describe:function(u){var d={name:"Chromium"},A=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,u)||i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/chrome|crios|crmo/i],describe:function(u){var d={name:"Chrome"},A=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/GSA/i],describe:function(u){var d={name:"Google Search"},A=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:function(u){var d=!u.test(/like android/i),A=u.test(/android/i);return d&&A},describe:function(u){var d={name:"Android Browser"},A=i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/playstation 4/i],describe:function(u){var d={name:"PlayStation 4"},A=i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/safari|applewebkit/i],describe:function(u){var d={name:"Safari"},A=i.default.getFirstMatch(E,u);return A&&(d.version=A),d}},{test:[/.*/i],describe:function(u){var d=u.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(d,u),version:i.default.getSecondMatch(d,u)}}}];c.default=T,v.exports=c.default},93:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p,i=(p=r(17))&&p.__esModule?p:{default:p},E=r(18),T=[{test:[/Roku\/DVP/],describe:function(u){var d=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,u);return{name:E.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(u){var d=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,u);return{name:E.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(u){var d=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,u),A=i.default.getWindowsVersionName(d);return{name:E.OS_MAP.Windows,version:d,versionName:A}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(u){var d={name:E.OS_MAP.iOS},A=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,u);return A&&(d.version=A),d}},{test:[/macintosh/i],describe:function(u){var d=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,u).replace(/[_\s]/g,"."),A=i.default.getMacOSVersionName(d),R={name:E.OS_MAP.MacOS,version:d};return A&&(R.versionName=A),R}},{test:[/(ipod|iphone|ipad)/i],describe:function(u){var d=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,u).replace(/[_\s]/g,".");return{name:E.OS_MAP.iOS,version:d}}},{test:function(u){var d=!u.test(/like android/i),A=u.test(/android/i);return d&&A},describe:function(u){var d=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,u),A=i.default.getAndroidVersionName(d),R={name:E.OS_MAP.Android,version:d};return A&&(R.versionName=A),R}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var d=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,u),A={name:E.OS_MAP.WebOS};return d&&d.length&&(A.version=d),A}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var d=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,u)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,u)||i.default.getFirstMatch(/\bbb(\d+)/i,u);return{name:E.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(u){var d=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,u);return{name:E.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(u){var d=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,u);return{name:E.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:E.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:E.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(u){var d=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,u);return{name:E.OS_MAP.PlayStation4,version:d}}}];c.default=T,v.exports=c.default},94:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p,i=(p=r(17))&&p.__esModule?p:{default:p},E=r(18),T=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(u){var d=i.default.getFirstMatch(/(can-l01)/i,u)&&"Nova",A={type:E.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(A.model=d),A}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet}}},{test:function(u){var d=u.test(/ipod|iphone/i),A=u.test(/like (ipod|iphone)/i);return d&&!A},describe:function(u){var d=i.default.getFirstMatch(/(ipod|iphone)/i,u);return{type:E.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName(!0)==="blackberry"},describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(u){return u.getBrowserName(!0)==="bada"},describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName()==="windows phone"},describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(u){var d=Number(String(u.getOSVersion()).split(".")[0]);return u.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:E.PLATFORMS_MAP.tablet}}},{test:function(u){return u.getOSName(!0)==="android"},describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getOSName(!0)==="macos"},describe:function(){return{type:E.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(u){return u.getOSName(!0)==="windows"},describe:function(){return{type:E.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="linux"},describe:function(){return{type:E.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="playstation 4"},describe:function(){return{type:E.PLATFORMS_MAP.tv}}},{test:function(u){return u.getOSName(!0)==="roku"},describe:function(){return{type:E.PLATFORMS_MAP.tv}}}];c.default=T,v.exports=c.default},95:function(v,c,r){"use strict";c.__esModule=!0,c.default=void 0;var p,i=(p=r(17))&&p.__esModule?p:{default:p},E=r(18),T=[{test:function(u){return u.getBrowserName(!0)==="microsoft edge"},describe:function(u){if(/\sedg\//i.test(u))return{name:E.ENGINE_MAP.Blink};var d=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,u);return{name:E.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(u){var d={name:E.ENGINE_MAP.Trident},A=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:function(u){return u.test(/presto/i)},describe:function(u){var d={name:E.ENGINE_MAP.Presto},A=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:function(u){var d=u.test(/gecko/i),A=u.test(/like gecko/i);return d&&!A},describe:function(u){var d={name:E.ENGINE_MAP.Gecko},A=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:E.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(u){var d={name:E.ENGINE_MAP.WebKit},A=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,u);return A&&(d.version=A),d}}];c.default=T,v.exports=c.default}})})});var vf={};Tu(vf,{version:()=>y0});var y0,mf=Oo(()=>{st();y0="beta"});var yf={};Tu(yf,{remoteConfig:()=>b0});var b0,bf=Oo(()=>{st();b0={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});st();var Vo=hn(Ro());st();var So=(o=>(o.MEETING_START="meeting.start",o.MEETING_LEAVE="meeting.leave",o.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",o.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",o.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",o.MEETING_PARTICIPANT_LEFT="meeting.participant-left",o.MEETING_JOIN="meeting.join",o.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",o.MEETING_HOST_CHANGE="meeting.host-change",o.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",o.MEETING_DEVICES_CHANGE="meeting.devices-change",o.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",o.MEETING_STATE_UPDATE="meeting.state-update",o.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",o.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",o.MY_PARTICIPANT_UPDATED="my-participant.update",o.MY_PARTICIPANT_LEFT="my-participant.left",o.MY_PARTICIPANT_JOINED="my-participant.joined",o.DESTROY="destroy",o))(So||{});var To=(T=>(T.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",T.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",T.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",T.TOGGLE_CAM="meeting-controls.toggle-cam",T.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",T.HANG_UP="hang-up",T))(To||{}),Qr=(O=>(O.REALTIME_JOIN="realtime.join",O.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",O.REALTIME_HOST_CHANGE="realtime.host-change",O.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",O.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",O.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",O.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",O.REALTIME_GATHER="realtime.gather",O.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",O.REALTIME_SET_AVATAR="realtime.set-avatar",O.REALTIME_DRAWING_CHANGE="realtime.drawing-change",O))(Qr||{});var Eo=(R=>(R[R.MEETING_FAILED=-1]="MEETING_FAILED",R[R.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",R[R.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",R[R.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",R[R.MEETING_CONNECTING=3]="MEETING_CONNECTING",R[R.MEETING_CONNECTED=4]="MEETING_CONNECTED",R[R.MEETING_RECONNECT=5]="MEETING_RECONNECT",R[R.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",R[R.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",R[R.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",R))(Eo||{}),qr=(T=>(T.JOINED="participant.joined",T.LOCAL_JOINED="participant.local-joined",T.LEFT="participant.left",T.LOCAL_LEFT="participant.local-left",T.LOCAL_UPDATED="participant.updated",T.LIST_UPDATED="participant.list-updated",T))(qr||{}),Io=(u=>(u[u.NOT_AVAILABLE=0]="NOT_AVAILABLE",u[u.GOOD=1]="GOOD",u[u.BAD=2]="BAD",u[u.POOR=3]="POOR",u[u.DISCONNECTED=4]="DISCONNECTED",u[u.RECONNECTING=5]="RECONNECTING",u[u.LOST_CONNECTION=6]="LOST_CONNECTION",u))(Io||{}),Po=(T=>(T.NO_CAM="devices.no-cam",T.NO_DEVICES="devices.no-devices",T.DEVICES_BLOCKED="devices.blocked",T.DEVICES_CAM_BLOCKED="devices.cam-blocked",T.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",T.DEVICES_UNKNOWN_ERROR="devices.unknown-error",T))(Po||{});st();var Mo=(p=>(p.HOST="host",p.GUEST="guest",p.AUDIENCE="audience",p))(Mo||{});st();st();st();var Ho=hn(_u());st();var wu=hn(Ro()),we=class{constructor(c){this.debug=(0,wu.default)(c)}log(c,...r){this.debug(c,...r)}};st();st();st();var gn=(v,c,r)=>re(void 0,null,function*(){let p=yield fetch(v,{method:c,headers:{"Content-Type":"application/json"},body:r?JSON.stringify(r):null});if(!p.ok)throw p;return p.json()});st();var df=hn(Lo());var Zt=class{constructor(c={}){this.subscribe=c=>{this.callbacks.push(c)};this.unsubscribe=c=>{this.callbacks=this.callbacks.filter(r=>r!==c)};this.publish=(...c)=>{!this.callbacks||this.callbacks.forEach(r=>{this.callListener(r,c).catch(p=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(c)}
            Error: ${p}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(c,r)=>new Promise((p,i)=>{try{let E=c(...r);p(E)}catch(E){i(E)}});let{logger:r,throttleTime:p}=c;this.logger=r!=null?r:new we("@superviz/sdk/observer-helper"),this.throttle=p,this.callbacks=[],this.throttle&&(this.publish=(0,df.default)(this.publish,this.throttle))}};var Yr=class{constructor(c){this.observers=new Map;this.subscribe=(c,r)=>{this.logger.log("pubsub service @ subscribe",{event:c,callback:r}),this.observers.has(c)||this.observers.set(c,new Zt),this.observers.get(c).subscribe(r)};this.unsubscribe=(c,r)=>{this.logger.log("pubsub service @ unsubscribe",{event:c,callback:r}),this.observers.has(c)&&(this.observers.get(c).reset(),this.observers.delete(c))};this.publish=(c,r)=>{this.logger.log("pubsub service @ publish",{event:c,data:r}),this.realtime.setSyncProperty(c,r)};this.publishEventToClient=(c,r)=>{this.logger.log("pubsub service @ publishEventToClient",{event:c,data:r}),this.observers.has(c)&&this.observers.get(c).publish(r)};this.onSyncPropertiesChange=c=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:c}),Object.entries(c).forEach(([r,p])=>{this.publishEventToClient(r,p)})};this.logger=new we("@superviz/sdk/pubsub"),this.realtime=c,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(c){return this.realtime.fetchSyncClientProperty(c)}};st();st();var Go=hn(hf()),er=hn(Lo());st();var No=(d=>(d[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d))(No||{});st();st();var Uo=(m=>(m[m.yellow=0]="yellow",m[m.turquoise=1]="turquoise",m[m.orange=2]="orange",m[m.blue=3]="blue",m[m.pink=4]="pink",m[m.purple=5]="purple",m[m.green=6]="green",m[m.red=7]="red",m[m.bluedark=8]="bluedark",m[m.pinklight=9]="pinklight",m[m.purplelight=10]="purplelight",m[m.greenlight=11]="greenlight",m[m.orangelight=12]="orangelight",m[m.bluelight=13]="bluelight",m[m.redlight=14]="redlight",m[m.brown=15]="brown",m[m.gray=16]="gray",m))(Uo||{}),Bo=(v=>(v[v["#FFEF33"]=0]="#FFEF33",v[v["#31E0B0"]=1]="#31E0B0",v[v["#FF5E10"]=2]="#FF5E10",v[v["#00ABF7"]=3]="#00ABF7",v[v["#FF00BB"]=4]="#FF00BB",v[v["#9C29FF"]=5]="#9C29FF",v[v["#6FDD00"]=6]="#6FDD00",v[v["#E30000"]=7]="#E30000",v[v["#304AFF"]=8]="#304AFF",v[v["#FF89C4"]=9]="#FF89C4",v[v["#D597FF"]=10]="#D597FF",v[v["#C6EC5C"]=11]="#C6EC5C",v[v["#FFA115"]=12]="#FFA115",v[v["#75DEFE"]=13]="#75DEFE",v[v["#FAA291"]=14]="#FAA291",v[v["#BB813F"]=15]="#BB813F",v[v["#878291"]=16]="#878291",v))(Bo||{});var Zr=class{constructor(){this.participantObservers=[],this.logger=new we("@superviz/sdk/realtime-service"),this.participantsObserver=new Zt({logger:this.logger}),this.participantJoinedObserver=new Zt({logger:this.logger}),this.participantLeaveObserver=new Zt({logger:this.logger}),this.syncPropertiesObserver=new Zt({logger:this.logger}),this.reconnectObserver=new Zt({logger:this.logger}),this.roomInfoUpdatedObserver=new Zt({logger:this.logger}),this.roomListUpdatedObserver=new Zt({logger:this.logger}),this.hostObserver=new Zt({logger:this.logger}),this.realtimeStateObserver=new Zt({logger:this.logger}),this.kickAllParticipantsObserver=new Zt({logger:this.logger}),this.authenticationObserver=new Zt({logger:this.logger})}subscribeToParticipantUpdate(c,r){this.participantObservers[c]||(this.participantObservers[c]=new Zt({logger:this.logger})),this.participantObservers[c].subscribe(r)}unsubscribeFromParticipantUpdate(c,r){this.participantObservers[c]&&this.participantObservers[c].unsubscribe(r)}getSlotColor(c){let r=c!=null?c:16;return{color:Bo[r],name:Uo[r]}}};var h0=1e3*60,p0=6e4,g0=1e4,v0=1e3,Fo=null,Nn=class extends Zr{constructor(r,p){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=r=>{if(!r)return;let p=this.participants[r];this.updateRoomProperties({hostClientId:p.clientId})};this.freezeSync=r=>{var p,i;if(this.isSyncFrozen=r,r){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(p=this.broadcastChannel)==null||p.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=r=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,r)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(r=>{let p=this.clientSyncPropertiesQueue[r];this.clientSyncPropertiesQueue[r]=[],p.length&&this.clientSyncChannel.publish(r,p)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(r,p)=>{this.clientRoomState[r]=p[p.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=r=>re(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,r),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),r.hostClientId?(r==null?void 0:r.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(r.hostClientId):this.hostPassingHandle(),this.updateParticipants()});this.updateMyProperties=(0,er.default)(r=>{let p=r;if(!(this.isMessageTooBig(r)||this.left||!this.enableSync||this.isSyncFrozen)&&(p.avatar===void 0&&delete p.avatar,this.myParticipant.data=dn(dn({},this.myParticipant.data),r),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},v0);this.updateRoomProperties=r=>{if(this.isMessageTooBig(r)||this.isSyncFrozen||this.left)return;let p=dn(dn({},this.localRoomProperties),r);this.supervizChannel.publish("update",p)};this.updateParticipants=()=>{let r={};this.supervizChannel.presence.get((p,i)=>{i.forEach(E=>{r[E.clientId]=dn({},E)}),this.participants=r,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=r=>{let p=[];if(this.supervizChannel.presence.get((E,T)=>{T.forEach(u=>{E||p.push(u.clientId)})}),!r||!p.includes(r)){this.hostPassingHandle();return}Fo&&clearTimeout(Fo);let i=this.hostParticipantId;this.hostParticipantId=r,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var p;let r={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((p=this.myParticipant)==null?void 0:p.data.type)==="host"&&(r.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(r)};this.hostPassingHandle=(0,er.default)(()=>re(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((r,p)=>{let i=p.filter(T=>T.data.type==="host").map(T=>T.clientId);if(this.shouldKickParticipantsOnHostLeave&&i.length===0){Fo=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},h0);return}let E=i[0];E===this.localParticipantId&&this.setHost(E)})}),1e3);this.findSlotIndex=r=>{let p=r,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((u,d)=>{if(u){i=[];return}d.forEach(A=>{A.connectionId===p.connectionId&&(p=A),A.connectionId!==p.connectionId&&A.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(A.data.slotIndex),1)})}),i.length===0)return;let E=i[0];this.myParticipant.data.slotIndex=E,this.updateMyProperties({slotIndex:E});let T=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(p)},T)};this.confirmSlot=(0,er.default)(r=>re(this,null,function*(){let p=[],i=r;if(this.supervizChannel.presence.get((E,T)=>{T.forEach(u=>{u.connectionId===i.connectionId&&(i=u),u.connectionId!==i.connectionId&&u.data.slotIndex!==void 0&&p.push(u.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||p.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let E=yield this.fetchRoomProperties();this.updateRoomProperties(E)}}),1e3);this.onParticipantJoin=r=>{this.updateParticipants(),this.participantJoinedObserver.publish(r),this.updateMyProperties({})};this.syncBroadcast=(0,er.default)(()=>{let r=btoa(this.ablyKey),p=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(p,{headers:{Authorization:`Basic ${r}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(r,p=p0)=>{let i=JSON.stringify(r);return new TextEncoder().encode(i).length>p?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=p,this.apiUrl=r,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var r;return(r=this.roomProperties)==null?void 0:r.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var r,p;return(p=(r=this.myParticipant.data)==null?void 0:r.participantId)!=null?p:null}get isBroadcast(){return Object.values(this.participants).some(r=>r.data.type==="audience")}start({participant:r,roomId:p,apiKey:i,shouldKickParticipantsOnHostLeave:E}){this.myParticipant={data:Su(dn({},r),{participantId:r.id}),timestamp:null,action:null,clientId:r.id,connectionId:null,encoding:null,id:null},this.enableSync=r.type!=="audience",this.roomId=`superviz:${p.toLowerCase()}-${i}`,this.shouldKickParticipantsOnHostLeave=E,this.apiKey=i,this.client||this.buildClient()}auth(r,p){let i=new Go.default.Rest({key:this.ablyKey}),{origin:E}=window.location;i.auth.requestToken(r,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:E,apiKey:this.apiKey}},(T,u)=>{T&&this.authenticationObserver.publish("realtime.authentication-failed"),p(T,u)})}join(r){let p=r?Object.assign({},r,{participantId:r.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(p),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(r){let p=this.localRoomProperties;this.updateRoomProperties(Object.assign({},p,{isGridModeEnable:r}))}setDrawing(r){let p=this.localRoomProperties;this.updateRoomProperties(Object.assign({},p,{drawing:r}))}setSyncProperty(r,p){var T;let i=(T=this.clientSyncPropertiesQueue[r])!=null?T:[],E=(u,d)=>({name:u,data:d,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(E(r,p),g0)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(i)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",r,p),this.clientSyncPropertiesQueue[r]||(this.clientSyncPropertiesQueue[r]=[]),this.clientSyncPropertiesQueue[r].push(E(r,p)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(r){this.updateRoomProperties({followParticipantId:r})}setGather(r){this.updateRoomProperties({gather:r})}getParticipantSlot(r){var p,i;if(r){let E=r.toString();if(this.participants&&this.participants[E])return(i=(p=this.participants[r])==null?void 0:p.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(r){r.clientId===this.myParticipant.data.participantId?this.onJoinRoom(r):this.onParticipantJoin(r)}onAblyPresenceUpdate(r){if(!this.isJoinedRoom)return;let{clientId:p}=r,i=Object.assign({},r,{participantId:r.clientId});this.publishParticipantUpdate(i),this.participants&&this.participants[p]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(r){this.onParticipantLeave(r)}onClientSyncChannelUpdate(r){let{name:p,data:i}=r,E={};E[p]=i,this.syncPropertiesObserver.publish(E),this.isLocalParticipantHost&&this.saveClientRoomState(p,i)}onReceiveBroadcastSync(r){r.data.forEach(i=>{var T;let E=i.clientId;this.participants[E]=i,(T=i.data)!=null&&T.isAudience||(this.participants[E].data=JSON.parse(this.participants[E].data),this.publishParticipantUpdate(this.participants[E]))})}onAblyRoomUpdate(r){this.updateLocalRoomState(r.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let r={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Go.default.Realtime(r),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(r){this.participants[r.clientId]=r,this.participantsObserver.publish(this.participants),this.participantObservers[r.clientId]&&this.participantObservers[r.clientId].publish(r)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(r){throw this.logger.log(r),new Error(r)}publishStateUpdate(r){this.state!==r&&(this.state=r,this.logger.log("REALTIME",`Realtime state did change. New state: ${No[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((r,p)=>{this.supervizChannel.history((i,E)=>{var u;i&&p(i);let T=(u=E.items[0])==null?void 0:u.data;r(T||null)})})}fetchSyncClientProperty(r){return re(this,null,function*(){try{let p=yield new Promise((i,E)=>{this.clientRoomStateChannel.history((T,u)=>{var A;T&&E(T);let d=(A=u==null?void 0:u.items[0])==null?void 0:A.data;i(d||null)})});if(r&&!p[r])throw new Error(`Event ${r} not found in the history`);return r?p[r]:p}catch(p){this.logger.log("REALTIME","Error in fetch client realtime data",p.message),this.throw(p.message)}})}onStateChange(){var R,O,a;let r=(R=this.supervizChannelState)==null?void 0:R.current,p=(O=this.connectionState)==null?void 0:O.current,i=p==="connected",E=["initialized","connecting"].includes(p),T=["closed","closing"].includes(p)||["detaching","detached"].includes(r),u={[0]:T,[1]:E,[2]:!r&&i,[3]:r==="attaching",[4]:r==="attached"&&i,[-1]:r==="failed"||p==="failed",[-2]:p==="suspended"||r==="suspended"},d=Object.entries(u).find(([C,w])=>w&&C)[0],A=Number(d);if(A===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(A===-2||A===-1)&&this.forceReconnect(),(a=this.connectionState)!=null&&a.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(A)}onAblyConnectionStateChange(r){this.connectionState=r,this.onStateChange()}onAblyChannelStateChange(r){this.supervizChannelState=r,this.onStateChange()}onJoinRoom(r){return re(this,null,function*(){var p;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(r),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((p=this.localRoomProperties)==null?void 0:p.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(r),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(r){if(this.state===2)return;let p=r.data.participantId===this.hostParticipantId;r.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(r),p&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};st();var Wo=class{constructor({ablyKey:c,apiUrl:r,apiKey:p,conferenceLayerUrl:i,participant:E,group:T,roomId:u,shouldKickParticipantsOnHostLeave:d}){this.components=[];this.participants=[];this.addComponent=c=>{c.attach({localParticipant:this.participant,realtime:this.realtime})};this.removeComponent=c=>{c.detach()};this.subscribeToPubSubEvent=(c,r)=>{this.logger.log("laucher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(c,r)};this.unsubscribeFromPubSubEvent=(c,r)=>{this.logger.log("laucher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(c,r)};this.publishToPubSubEvent=(c,r)=>{this.logger.log("laucher service @ publishToPubSubEvent"),this.pubsub.publish(c,r)};this.fetchPubSubHistory=c=>this.pubsub.fetchHistory(c);this.startRealtime=()=>{this.logger.log("laucher service @ startRealtime"),this.realtime.start({apiKey:this.apiKey,participant:this.participant,roomId:this.roomId,shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)};this.onParticipantListUpdate=c=>{this.logger.log("laucher service @ onParticipantListUpdate");let r=Object.values(c).map(i=>{var E,T,u,d,A;return{id:i.data.id,name:(E=i.data)==null?void 0:E.name,type:(T=i.data)==null?void 0:T.type,avatar:(u=i.data)==null?void 0:u.avatar,avatarConfig:(d=i.data)==null?void 0:d.avatarConfig,isHost:this.realtime.hostClientId===i.clientId,color:this.realtime.getSlotColor((A=i.data)==null?void 0:A.slotIndex).color}}),p=r.find(i=>{var E;return(i==null?void 0:i.id)===((E=this.participant)==null?void 0:E.id)});(0,Ho.isEqual)(this.participants,r)||(this.participants=r,this.pubsub.publishEventToClient("participant.list-updated",r),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",r)),p&&!(0,Ho.isEqual)(this.participant,p)&&(this.participant=p,this.pubsub.publishEventToClient("participant.updated",p),this.logger.log("Publishing ParticipantEvent.UPDATED",p))};this.onParticipantJoined=c=>{this.logger.log("laucher service @ onParticipantJoined");let r=this.participants.find(p=>p.id===c.data.id);!r||(r.id===this.participant.id&&(this.logger.log("laucher service @ onParticipantJoined - local participant joined"),this.pubsub.publishEventToClient("participant.local-joined",r)),this.logger.log("laucher service @ onParticipantJoined - participant joined",r),this.pubsub.publishEventToClient("participant.joined",r))};this.onParticipantLeave=c=>{this.logger.log("laucher service @ onParticipantLeave");let r=this.participants.find(p=>p.id===c.data.id);!r||(r.id===this.participant.id&&(this.logger.log("laucher service @ onParticipantLeave - local participant left"),this.pubsub.publishEventToClient("participant.local-left",r)),this.logger.log("laucher service @ onParticipantLeave - participant left",r),this.pubsub.publishEventToClient("participant.left",r))};this.apiUrl=r,this.apiKey=p,this.ablyKey=c,this.conferenceLayerUrl=i,this.shouldKickParticipantsOnHostLeave=d!=null?d:!0,this.participant=E,this.roomId=u,this.group=T,this.logger=new we("@superviz/sdk/laucher"),this.realtime=new Nn(this.apiUrl,this.ablyKey),this.pubsub=new Yr(this.realtime),this.logger.log("laucher created"),this.startRealtime()}},ko=v=>{let c=new Wo(v);return{subscribe:c.subscribeToPubSubEvent,unsubscribe:c.unsubscribeFromPubSubEvent,publish:c.publishToPubSubEvent,fetchHistory:c.fetchPubSubHistory,addComponent:c.addComponent,removeComponent:c.removeComponent}};st();var vn=class{static createUrl(c,r){return`${c}${r}`}static validateApiKey(c,r){let p="/user/checkapikey",i=this.createUrl(c,p);return gn(i,"POST",{apiKey:r})}static fetchConfig(c,r){let p="/immersive-config",i=this.createUrl(c,p);return gn(i,"POST",{apiKey:r})}static fetchWaterMark(c,r){return re(this,null,function*(){let p="/user/watermark",i=this.createUrl(c,p),{message:E}=yield gn(i,"POST",{apiKey:r});return E})}};st();function m0(v,c){return re(this,null,function*(){try{return(yield vn.validateApiKey(v,c))===!0}catch(r){if(r.status===404)return!1;throw new Error("Unable to validate API key")}})}var pf=m0;st();var Ne=hn(gf()),jo=class{constructor(){this.browser=Ne.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Ne.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Ne.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Ne.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Ne.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Ne.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Ne.default.PLATFORMS_MAP.mobile)||this.browser.is(Ne.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Ne.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};st();st();st();st();st();st();var Un=class{static getRemoteConfig(){return re(this,arguments,function*(c="prod"){let{version:r}=yield Promise.resolve().then(()=>(mf(),vf));if(c==="local"){let{remoteConfig:E}=yield Promise.resolve().then(()=>(bf(),yf));return E}let p={version:r,environment:c},i=this.createUrl(p);return gn(i,"GET",null)})}static createUrl({version:c,environment:r}){return`${this.REMOTE_CONFIG_BASE_URL}/${c}?env=${r}`}};Un.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";st();var A0=({group:v,participant:c,roomId:r})=>{if(!v||!v.name||!v.id)throw new Error("Group fields is required");if(!c||!c.id)throw new Error("Participants fields is required");if(!r)throw new Error("Room id is required")},Af=(v,c)=>re(void 0,null,function*(){if(!(v&&v.trim()))throw new Error("API key is required");if(!c)throw new Error("Options is required");A0(c),c.debug?Vo.debug.enable("*"):Vo.debug.disable();let{apiUrl:p,conferenceLayerUrl:i}=yield Un.getRemoteConfig(c.environment);if(!(yield pf(p,v)))throw new Error("Failed to validate API key");let T=yield vn.fetchConfig(p,v);if(!T||!T.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:u}=T;return ko(Object.assign({},c,{apiKey:v,ablyKey:u,conferenceLayerUrl:i,apiUrl:p}))});window&&(window.SuperVizSdk={init:Af,MeetingEvent:So,DeviceEvent:Po,RealtimeEvent:Qr,MeetingState:Eo,MeetingConnectionStatus:Io,MeetingControlsEvent:To,ParticipantEvent:qr});var ob=Af;export{jo as BrowserService,Po as DeviceEvent,Io as MeetingConnectionStatus,To as MeetingControlsEvent,So as MeetingEvent,Eo as MeetingState,qr as ParticipantEvent,Mo as ParticipantType,Qr as RealtimeEvent,ob as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
