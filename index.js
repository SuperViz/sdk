var rn=Object.create;var It=Object.defineProperty,on=Object.defineProperties,an=Object.getOwnPropertyDescriptor,sn=Object.getOwnPropertyDescriptors,un=Object.getOwnPropertyNames,oe=Object.getOwnPropertySymbols,cn=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable;var ae=(x,u,t)=>u in x?It(x,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):x[u]=t,pt=(x,u)=>{for(var t in u||(u={}))se.call(u,t)&&ae(x,t,u[t]);if(oe)for(var t of oe(u))ln.call(u,t)&&ae(x,t,u[t]);return x},ue=(x,u)=>on(x,sn(u));var Bt=(x,u)=>()=>(x&&(u=x(x=0)),u);var it=(x,u)=>()=>(u||x((u={exports:{}}).exports,u),u.exports),ce=(x,u)=>{for(var t in u)It(x,t,{get:u[t],enumerable:!0})},fn=(x,u,t,l)=>{if(u&&typeof u=="object"||typeof u=="function")for(let e of un(u))!se.call(x,e)&&e!==t&&It(x,e,{get:()=>u[e],enumerable:!(l=an(u,e))||l.enumerable});return x};var yt=(x,u,t)=>(t=x!=null?rn(cn(x)):{},fn(u||!x||!x.__esModule?It(t,"default",{value:x,enumerable:!0}):t,x));var ut=(x,u,t)=>new Promise((l,e)=>{var O=c=>{try{o(t.next(c))}catch(m){e(m)}},C=c=>{try{o(t.throw(c))}catch(m){e(m)}},o=c=>c.done?l(c.value):Promise.resolve(c.value).then(O,C);o((t=t.apply(x,u)).next())});var X,V=Bt(()=>{X={}});var fe=it((Pr,le)=>{V();var bt=1e3,Ct=bt*60,Ot=Ct*60,gt=Ot*24,hn=gt*7,pn=gt*365.25;le.exports=function(x,u){u=u||{};var t=typeof x;if(t==="string"&&x.length>0)return gn(x);if(t==="number"&&isFinite(x))return u.long?vn(x):mn(x);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(x))};function gn(x){if(x=String(x),!(x.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(x);if(!!u){var t=parseFloat(u[1]),l=(u[2]||"ms").toLowerCase();switch(l){case"years":case"year":case"yrs":case"yr":case"y":return t*pn;case"weeks":case"week":case"w":return t*hn;case"days":case"day":case"d":return t*gt;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ot;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ct;case"seconds":case"second":case"secs":case"sec":case"s":return t*bt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function mn(x){var u=Math.abs(x);return u>=gt?Math.round(x/gt)+"d":u>=Ot?Math.round(x/Ot)+"h":u>=Ct?Math.round(x/Ct)+"m":u>=bt?Math.round(x/bt)+"s":x+"ms"}function vn(x){var u=Math.abs(x);return u>=gt?Mt(x,u,gt,"day"):u>=Ot?Mt(x,u,Ot,"hour"):u>=Ct?Mt(x,u,Ct,"minute"):u>=bt?Mt(x,u,bt,"second"):x+" ms"}function Mt(x,u,t,l){var e=u>=t*1.5;return Math.round(x/t)+" "+l+(e?"s":"")}});var he=it((Ir,de)=>{V();function yn(x){t.debug=t,t.default=t,t.coerce=c,t.disable=O,t.enable=e,t.enabled=C,t.humanize=fe(),t.destroy=m,Object.keys(x).forEach(v=>{t[v]=x[v]}),t.names=[],t.skips=[],t.formatters={};function u(v){let y=0;for(let i=0;i<v.length;i++)y=(y<<5)-y+v.charCodeAt(i),y|=0;return t.colors[Math.abs(y)%t.colors.length]}t.selectColor=u;function t(v){let y,i=null,g,T;function S(...p){if(!S.enabled)return;let d=S,b=Number(new Date),n=b-(y||b);d.diff=n,d.prev=y,d.curr=b,y=b,p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let f=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if(s==="%%")return"%";f++;let h=t.formatters[r];if(typeof h=="function"){let R=p[f];s=h.call(d,R),p.splice(f,1),f--}return s}),t.formatArgs.call(d,p),(d.log||t.log).apply(d,p)}return S.namespace=v,S.useColors=t.useColors(),S.color=t.selectColor(v),S.extend=l,S.destroy=t.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>i!==null?i:(g!==t.namespaces&&(g=t.namespaces,T=t.enabled(v)),T),set:p=>{i=p}}),typeof t.init=="function"&&t.init(S),S}function l(v,y){let i=t(this.namespace+(typeof y=="undefined"?":":y)+v);return i.log=this.log,i}function e(v){t.save(v),t.namespaces=v,t.names=[],t.skips=[];let y,i=(typeof v=="string"?v:"").split(/[\s,]+/),g=i.length;for(y=0;y<g;y++)!i[y]||(v=i[y].replace(/\*/g,".*?"),v[0]==="-"?t.skips.push(new RegExp("^"+v.slice(1)+"$")):t.names.push(new RegExp("^"+v+"$")))}function O(){let v=[...t.names.map(o),...t.skips.map(o).map(y=>"-"+y)].join(",");return t.enable(""),v}function C(v){if(v[v.length-1]==="*")return!0;let y,i;for(y=0,i=t.skips.length;y<i;y++)if(t.skips[y].test(v))return!1;for(y=0,i=t.names.length;y<i;y++)if(t.names[y].test(v))return!0;return!1}function o(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}function c(v){return v instanceof Error?v.stack||v.message:v}function m(){}return t.enable(t.load()),t}de.exports=yn});var Ft=it((lt,wt)=>{V();lt.formatArgs=Cn;lt.save=On;lt.load=An;lt.useColors=bn;lt.storage=Rn();lt.destroy=(()=>{let x=!1;return()=>{x||(x=!0)}})();lt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function bn(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Cn(x){if(x[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+x[0]+(this.useColors?"%c ":" ")+"+"+wt.exports.humanize(this.diff),!this.useColors)return;let u="color: "+this.color;x.splice(1,0,u,"color: inherit");let t=0,l=0;x[0].replace(/%[a-zA-Z%]/g,e=>{e!=="%%"&&(t++,e==="%c"&&(l=t))}),x.splice(l,0,u)}lt.log=console.debug||console.log||(()=>{});function On(x){try{x?lt.storage.setItem("debug",x):lt.storage.removeItem("debug")}catch(u){}}function An(){let x;try{x=lt.storage.getItem("debug")}catch(u){}return!x&&typeof process!="undefined"&&"env"in process&&(x=X.DEBUG),x}function Rn(){try{return localStorage}catch(x){}}wt.exports=he()(lt);var{formatters:Sn}=wt.exports;Sn.j=function(x){try{return JSON.stringify(x)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}});var Lt=it((Nr,ge)=>{V();function Tn(x){var u=typeof x;return x!=null&&(u=="object"||u=="function")}ge.exports=Tn});var ve=it((Ur,me)=>{V();var En=typeof global=="object"&&global&&global.Object===Object&&global;me.exports=En});var zt=it((Br,ye)=>{V();var Pn=ve(),In=typeof self=="object"&&self&&self.Object===Object&&self,Mn=Pn||In||Function("return this")();ye.exports=Mn});var Ce=it((Fr,be)=>{V();var wn=zt(),xn=function(){return wn.Date.now()};be.exports=xn});var Ae=it((_r,Oe)=>{V();var Ln=/\s/;function Dn(x){for(var u=x.length;u--&&Ln.test(x.charAt(u)););return u}Oe.exports=Dn});var Se=it((Gr,Re)=>{V();var Nn=Ae(),Un=/^\s+/;function Bn(x){return x&&x.slice(0,Nn(x)+1).replace(Un,"")}Re.exports=Bn});var Vt=it((kr,Te)=>{V();var Fn=zt(),_n=Fn.Symbol;Te.exports=_n});var Me=it((jr,Ie)=>{V();var Ee=Vt(),Pe=Object.prototype,Gn=Pe.hasOwnProperty,kn=Pe.toString,Tt=Ee?Ee.toStringTag:void 0;function jn(x){var u=Gn.call(x,Tt),t=x[Tt];try{x[Tt]=void 0;var l=!0}catch(O){}var e=kn.call(x);return l&&(u?x[Tt]=t:delete x[Tt]),e}Ie.exports=jn});var xe=it((Hr,we)=>{V();var Hn=Object.prototype,Wn=Hn.toString;function zn(x){return Wn.call(x)}we.exports=zn});var Ue=it((Wr,Ne)=>{V();var Le=Vt(),Vn=Me(),Kn=xe(),Jn="[object Null]",Qn="[object Undefined]",De=Le?Le.toStringTag:void 0;function qn(x){return x==null?x===void 0?Qn:Jn:De&&De in Object(x)?Vn(x):Kn(x)}Ne.exports=qn});var Fe=it((zr,Be)=>{V();function $n(x){return x!=null&&typeof x=="object"}Be.exports=$n});var Ge=it((Vr,_e)=>{V();var Yn=Ue(),Xn=Fe(),Zn="[object Symbol]";function tr(x){return typeof x=="symbol"||Xn(x)&&Yn(x)==Zn}_e.exports=tr});var We=it((Kr,He)=>{V();var er=Se(),ke=Lt(),nr=Ge(),je=0/0,rr=/^[-+]0x[0-9a-f]+$/i,ir=/^0b[01]+$/i,or=/^0o[0-7]+$/i,ar=parseInt;function sr(x){if(typeof x=="number")return x;if(nr(x))return je;if(ke(x)){var u=typeof x.valueOf=="function"?x.valueOf():x;x=ke(u)?u+"":u}if(typeof x!="string")return x===0?x:+x;x=er(x);var t=ir.test(x);return t||or.test(x)?ar(x.slice(2),t?2:8):rr.test(x)?je:+x}He.exports=sr});var Ke=it((Jr,Ve)=>{V();var ur=Lt(),Kt=Ce(),ze=We(),cr="Expected a function",lr=Math.max,fr=Math.min;function dr(x,u,t){var l,e,O,C,o,c,m=0,v=!1,y=!1,i=!0;if(typeof x!="function")throw new TypeError(cr);u=ze(u)||0,ur(t)&&(v=!!t.leading,y="maxWait"in t,O=y?lr(ze(t.maxWait)||0,u):O,i="trailing"in t?!!t.trailing:i);function g(s){var r=l,h=e;return l=e=void 0,m=s,C=x.apply(h,r),C}function T(s){return m=s,o=setTimeout(d,u),v?g(s):C}function S(s){var r=s-c,h=s-m,R=u-r;return y?fr(R,O-h):R}function p(s){var r=s-c,h=s-m;return c===void 0||r>=u||r<0||y&&h>=O}function d(){var s=Kt();if(p(s))return b(s);o=setTimeout(d,S(s))}function b(s){return o=void 0,i&&l?g(s):(l=e=void 0,C)}function n(){o!==void 0&&clearTimeout(o),m=0,l=c=e=o=void 0}function f(){return o===void 0?C:b(Kt())}function a(){var s=Kt(),r=p(s);if(l=arguments,e=this,c=s,r){if(o===void 0)return T(c);if(y)return clearTimeout(o),o=setTimeout(d,u),g(c)}return o===void 0&&(o=setTimeout(d,u)),C}return a.cancel=n,a.flush=f,a}Ve.exports=dr});var Jt=it((Qr,Je)=>{V();var hr=Ke(),pr=Lt(),gr="Expected a function";function mr(x,u,t){var l=!0,e=!0;if(typeof x!="function")throw new TypeError(gr);return pr(t)&&(l="leading"in t?!!t.leading:l,e="trailing"in t?!!t.trailing:e),hr(x,u,{leading:l,maxWait:u,trailing:e})}Je.exports=mr});var qe=it((Nt,Qt)=>{V();(function(u,t){typeof Nt=="object"&&typeof Qt=="object"?Qt.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Nt=="object"?Nt.Ably=t():u.Ably=t()})(window,function(){return function(x){var u={};function t(l){if(u[l])return u[l].exports;var e=u[l]={i:l,l:!1,exports:{}};return x[l].call(e.exports,e,e.exports,t),e.l=!0,e.exports}return t.m=x,t.c=u,t.d=function(l,e,O){t.o(l,e)||Object.defineProperty(l,e,{enumerable:!0,get:O})},t.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},t.t=function(l,e){if(e&1&&(l=t(l)),e&8||e&4&&typeof l=="object"&&l&&l.__esModule)return l;var O=Object.create(null);if(t.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:l}),e&2&&typeof l!="string")for(var C in l)t.d(O,C,function(o){return l[o]}.bind(null,C));return O},t.n=function(l){var e=l&&l.__esModule?function(){return l.default}:function(){return l};return t.d(e,"a",e),e},t.o=function(l,e){return Object.prototype.hasOwnProperty.call(l,e)},t.p="",t(t.s=41)}([function(x,u,t){"use strict";u.__esModule=!0;var l=function(){function e(){}return e}();u.default=l},function(x,u,t){"use strict";t.r(u),t.d(u,"__extends",function(){return e}),t.d(u,"__assign",function(){return O}),t.d(u,"__rest",function(){return C}),t.d(u,"__decorate",function(){return o}),t.d(u,"__param",function(){return c}),t.d(u,"__metadata",function(){return m}),t.d(u,"__awaiter",function(){return v}),t.d(u,"__generator",function(){return y}),t.d(u,"__createBinding",function(){return i}),t.d(u,"__exportStar",function(){return g}),t.d(u,"__values",function(){return T}),t.d(u,"__read",function(){return S}),t.d(u,"__spread",function(){return p}),t.d(u,"__spreadArrays",function(){return d}),t.d(u,"__spreadArray",function(){return b}),t.d(u,"__await",function(){return n}),t.d(u,"__asyncGenerator",function(){return f}),t.d(u,"__asyncDelegator",function(){return a}),t.d(u,"__asyncValues",function(){return s}),t.d(u,"__makeTemplateObject",function(){return r}),t.d(u,"__importStar",function(){return R}),t.d(u,"__importDefault",function(){return P}),t.d(u,"__classPrivateFieldGet",function(){return U}),t.d(u,"__classPrivateFieldSet",function(){return D});var l=function(M,A){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,B){E.__proto__=B}||function(E,B){for(var N in B)Object.prototype.hasOwnProperty.call(B,N)&&(E[N]=B[N])},l(M,A)};function e(M,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");l(M,A);function E(){this.constructor=M}M.prototype=A===null?Object.create(A):(E.prototype=A.prototype,new E)}var O=function(){return O=Object.assign||function(A){for(var E,B=1,N=arguments.length;B<N;B++){E=arguments[B];for(var G in E)Object.prototype.hasOwnProperty.call(E,G)&&(A[G]=E[G])}return A},O.apply(this,arguments)};function C(M,A){var E={};for(var B in M)Object.prototype.hasOwnProperty.call(M,B)&&A.indexOf(B)<0&&(E[B]=M[B]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,B=Object.getOwnPropertySymbols(M);N<B.length;N++)A.indexOf(B[N])<0&&Object.prototype.propertyIsEnumerable.call(M,B[N])&&(E[B[N]]=M[B[N]]);return E}function o(M,A,E,B){var N=arguments.length,G=N<3?A:B===null?B=Object.getOwnPropertyDescriptor(A,E):B,H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(M,A,E,B);else for(var k=M.length-1;k>=0;k--)(H=M[k])&&(G=(N<3?H(G):N>3?H(A,E,G):H(A,E))||G);return N>3&&G&&Object.defineProperty(A,E,G),G}function c(M,A){return function(E,B){A(E,B,M)}}function m(M,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(M,A)}function v(M,A,E,B){function N(G){return G instanceof E?G:new E(function(H){H(G)})}return new(E||(E=Promise))(function(G,H){function k(w){try{I(B.next(w))}catch(_){H(_)}}function L(w){try{I(B.throw(w))}catch(_){H(_)}}function I(w){w.done?G(w.value):N(w.value).then(k,L)}I((B=B.apply(M,A||[])).next())})}function y(M,A){var E={label:0,sent:function(){if(G[0]&1)throw G[1];return G[1]},trys:[],ops:[]},B,N,G,H;return H={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H;function k(I){return function(w){return L([I,w])}}function L(I){if(B)throw new TypeError("Generator is already executing.");for(;E;)try{if(B=1,N&&(G=I[0]&2?N.return:I[0]?N.throw||((G=N.return)&&G.call(N),0):N.next)&&!(G=G.call(N,I[1])).done)return G;switch(N=0,G&&(I=[I[0]&2,G.value]),I[0]){case 0:case 1:G=I;break;case 4:return E.label++,{value:I[1],done:!1};case 5:E.label++,N=I[1],I=[0];continue;case 7:I=E.ops.pop(),E.trys.pop();continue;default:if(G=E.trys,!(G=G.length>0&&G[G.length-1])&&(I[0]===6||I[0]===2)){E=0;continue}if(I[0]===3&&(!G||I[1]>G[0]&&I[1]<G[3])){E.label=I[1];break}if(I[0]===6&&E.label<G[1]){E.label=G[1],G=I;break}if(G&&E.label<G[2]){E.label=G[2],E.ops.push(I);break}G[2]&&E.ops.pop(),E.trys.pop();continue}I=A.call(M,E)}catch(w){I=[6,w],N=0}finally{B=G=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}var i=Object.create?function(M,A,E,B){B===void 0&&(B=E),Object.defineProperty(M,B,{enumerable:!0,get:function(){return A[E]}})}:function(M,A,E,B){B===void 0&&(B=E),M[B]=A[E]};function g(M,A){for(var E in M)E!=="default"&&!Object.prototype.hasOwnProperty.call(A,E)&&i(A,M,E)}function T(M){var A=typeof Symbol=="function"&&Symbol.iterator,E=A&&M[A],B=0;if(E)return E.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&B>=M.length&&(M=void 0),{value:M&&M[B++],done:!M}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function S(M,A){var E=typeof Symbol=="function"&&M[Symbol.iterator];if(!E)return M;var B=E.call(M),N,G=[],H;try{for(;(A===void 0||A-- >0)&&!(N=B.next()).done;)G.push(N.value)}catch(k){H={error:k}}finally{try{N&&!N.done&&(E=B.return)&&E.call(B)}finally{if(H)throw H.error}}return G}function p(){for(var M=[],A=0;A<arguments.length;A++)M=M.concat(S(arguments[A]));return M}function d(){for(var M=0,A=0,E=arguments.length;A<E;A++)M+=arguments[A].length;for(var B=Array(M),N=0,A=0;A<E;A++)for(var G=arguments[A],H=0,k=G.length;H<k;H++,N++)B[N]=G[H];return B}function b(M,A,E){if(E||arguments.length===2)for(var B=0,N=A.length,G;B<N;B++)(G||!(B in A))&&(G||(G=Array.prototype.slice.call(A,0,B)),G[B]=A[B]);return M.concat(G||Array.prototype.slice.call(A))}function n(M){return this instanceof n?(this.v=M,this):new n(M)}function f(M,A,E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var B=E.apply(M,A||[]),N,G=[];return N={},H("next"),H("throw"),H("return"),N[Symbol.asyncIterator]=function(){return this},N;function H(F){B[F]&&(N[F]=function(W){return new Promise(function(J,Y){G.push([F,W,J,Y])>1||k(F,W)})})}function k(F,W){try{L(B[F](W))}catch(J){_(G[0][3],J)}}function L(F){F.value instanceof n?Promise.resolve(F.value.v).then(I,w):_(G[0][2],F)}function I(F){k("next",F)}function w(F){k("throw",F)}function _(F,W){F(W),G.shift(),G.length&&k(G[0][0],G[0][1])}}function a(M){var A,E;return A={},B("next"),B("throw",function(N){throw N}),B("return"),A[Symbol.iterator]=function(){return this},A;function B(N,G){A[N]=M[N]?function(H){return(E=!E)?{value:n(M[N](H)),done:N==="return"}:G?G(H):H}:G}}function s(M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=M[Symbol.asyncIterator],E;return A?A.call(M):(M=typeof T=="function"?T(M):M[Symbol.iterator](),E={},B("next"),B("throw"),B("return"),E[Symbol.asyncIterator]=function(){return this},E);function B(G){E[G]=M[G]&&function(H){return new Promise(function(k,L){H=M[G](H),N(k,L,H.done,H.value)})}}function N(G,H,k,L){Promise.resolve(L).then(function(I){G({value:I,done:k})},H)}}function r(M,A){return Object.defineProperty?Object.defineProperty(M,"raw",{value:A}):M.raw=A,M}var h=Object.create?function(M,A){Object.defineProperty(M,"default",{enumerable:!0,value:A})}:function(M,A){M.default=A};function R(M){if(M&&M.__esModule)return M;var A={};if(M!=null)for(var E in M)E!=="default"&&Object.prototype.hasOwnProperty.call(M,E)&&i(A,M,E);return h(A,M),A}function P(M){return M&&M.__esModule?M:{default:M}}function U(M,A,E,B){if(E==="a"&&!B)throw new TypeError("Private accessor was defined without a getter");if(typeof A=="function"?M!==A||!B:!A.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?B:E==="a"?B.call(M):B?B.value:A.get(M)}function D(M,A,E,B,N){if(B==="m")throw new TypeError("Private method is not writable");if(B==="a"&&!N)throw new TypeError("Private accessor was defined without a setter");if(typeof A=="function"?M!==A||!N:!A.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return B==="a"?N.call(M,E):N?N.value=E:A.set(M,E),E}},function(x,u,t){"use strict";(function(l){u.__esModule=!0,u.allToUpperCase=u.allToLowerCase=u.encodeBody=u.decodeBody=u.Format=u.promisify=u.trim=u.arrChooseN=u.randomHexString=u.randomString=u.cheapRandStr=u.dataSizeBytes=u.inspectBody=u.inspectError=u.isErrorInfo=u.now=u.parseQueryString=u.toQueryString=u.arrPopRandomElement=u.defaultPostHeaders=u.defaultGetHeaders=u.allSame=u.arrEvery=u.arrFilter=u.arrMap=u.safeArrForEach=u.arrForEach=u.forInOwnNonNullProperties=u.valuesArray=u.keysArray=u.arrWithoutValue=u.arrDeleteValue=u.arrIn=u.arrIndexOf=u.arrSubtract=u.arrIntersectOb=u.arrIntersect=u.intersect=u.containsValue=u.inherits=u.prototypicalClone=u.shallowClone=u.isEmptyArg=u.isOnlyPropIn=u.isEmpty=u.isObject=u.ensureArray=u.isArray=u.copy=u.mixin=void 0,u.getGlobalObject=u.getJitterCoefficient=u.getBackoffCoefficient=void 0;var e=t(1),O=e.__importDefault(t(0)),C=e.__importDefault(t(8));function o(j){return Math.floor(Math.random()*j.length)}function c(j){for(var z=[],K=1;K<arguments.length;K++)z[K-1]=arguments[K];for(var q=0;q<z.length;q++){var Z=z[q];if(!Z)break;var ct=Object.prototype.hasOwnProperty;for(var St in Z)(!ct||ct.call(Z,St))&&(j[St]=Z[St])}return j}u.mixin=c;function m(j){return c({},j)}u.copy=m,u.isArray=Array.isArray||function(j){return Object.prototype.toString.call(j)=="[object Array]"};function v(j){return T(j)?[]:u.isArray(j)?j:[j]}u.ensureArray=v;function y(j){return Object.prototype.toString.call(j)=="[object Object]"}u.isObject=y;function i(j){for(var z in j)return!1;return!0}u.isEmpty=i;function g(j,z){for(var K in j)if(K!==z)return!1;return!0}u.isOnlyPropIn=g;function T(j){return j==null}u.isEmptyArg=T;function S(j){var z=new Object;for(var K in j)z[K]=j[K];return z}u.shallowClone=S;function p(j,z){var K=function(){function Z(){}return Z}();K.prototype=j;var q=new K;return z&&c(q,z),q}u.prototypicalClone=p;var d=function(j,z){if(O.default.Config.inherits){O.default.Config.inherits(j,z);return}j.super_=z,j.prototype=p(z.prototype,{constructor:j})};u.inherits=d;function b(j,z){for(var K in j)if(j[K]==z)return!0;return!1}u.containsValue=b;function n(j,z){return u.isArray(z)?f(j,z):a(j,z)}u.intersect=n;function f(j,z){for(var K=[],q=0;q<j.length;q++){var Z=j[q];u.arrIndexOf(z,Z)!=-1&&K.push(Z)}return K}u.arrIntersect=f;function a(j,z){for(var K=[],q=0;q<j.length;q++){var Z=j[q];Z in z&&K.push(Z)}return K}u.arrIntersectOb=a;function s(j,z){for(var K=[],q=0;q<j.length;q++){var Z=j[q];u.arrIndexOf(z,Z)==-1&&K.push(Z)}return K}u.arrSubtract=s,u.arrIndexOf=Array.prototype.indexOf?function(j,z,K){return j.indexOf(z,K)}:function(j,z,K){K=K||0;for(var q=j.length;K<q;K++)if(j[K]===z)return K;return-1};function r(j,z){return u.arrIndexOf(j,z)!==-1}u.arrIn=r;function h(j,z){var K=u.arrIndexOf(j,z),q=K!=-1;return q&&j.splice(K,1),q}u.arrDeleteValue=h;function R(j,z){var K=j.slice();return h(K,z),K}u.arrWithoutValue=R;function P(j,z){var K=[];for(var q in j)z&&!Object.prototype.hasOwnProperty.call(j,q)||K.push(q);return K}u.keysArray=P;function U(j,z){var K=[];for(var q in j)z&&!Object.prototype.hasOwnProperty.call(j,q)||K.push(j[q]);return K}u.valuesArray=U;function D(j,z){for(var K in j)Object.prototype.hasOwnProperty.call(j,K)&&j[K]&&z(K)}u.forInOwnNonNullProperties=D,u.arrForEach=Array.prototype.forEach?function(j,z){j.forEach(z)}:function(j,z){for(var K=j.length,q=0;q<K;q++)z(j[q],q,j)};function M(j,z){return u.arrForEach(j.slice(),z)}u.safeArrForEach=M,u.arrMap=Array.prototype.map?function(j,z){return j.map(z)}:function(j,z){for(var K=[],q=j.length,Z=0;Z<q;Z++)K.push(z(j[Z],Z,j));return K},u.arrFilter=Array.prototype.filter?function(j,z){return j.filter(z)}:function(j,z){for(var K=[],q=j.length,Z=0;Z<q;Z++)z(j[Z])&&K.push(j[Z]);return K},u.arrEvery=Array.prototype.every?function(j,z){return j.every(z)}:function(j,z){for(var K=j.length,q=0;q<K;q++)if(!z(j[q],q,j))return!1;return!0};function A(j,z){if(j.length===0)return!0;var K=j[0][z];return u.arrEvery(j,function(q){return q[z]===K})}u.allSame=A;var E={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function B(j){var z=E[j||tt.json];return{accept:z,"X-Ably-Version":C.default.apiVersion,"Ably-Agent":C.default.agent}}u.defaultGetHeaders=B;function N(j){var z,K=z=E[j||tt.json];return{accept:K,"content-type":z,"X-Ably-Version":C.default.apiVersion,"Ably-Agent":C.default.agent}}u.defaultPostHeaders=N;function G(j){return j.splice(o(j),1)[0]}u.arrPopRandomElement=G;function H(j){var z=[];if(j)for(var K in j)z.push(encodeURIComponent(K)+"="+encodeURIComponent(j[K]));return z.length?"?"+z.join("&"):""}u.toQueryString=H;function k(j){for(var z,K=/([^?&=]+)=?([^&]*)/g,q={};z=K.exec(j);)q[decodeURIComponent(z[1])]=decodeURIComponent(z[2]);return q}u.parseQueryString=k,u.now=Date.now||function(){return new Date().getTime()};function L(j){return j.constructor.name=="ErrorInfo"}u.isErrorInfo=L;function I(j){var z,K;return j instanceof Error||((K=(z=j)===null||z===void 0?void 0:z.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"?O.default.Config.inspect(j):j.toString()}u.inspectError=I;function w(j){return O.default.BufferUtils.isBuffer(j)?j.toString():typeof j=="string"?j:O.default.Config.inspect(j)}u.inspectBody=w;function _(j){if(O.default.BufferUtils.isBuffer(j))return O.default.BufferUtils.byteLength(j);if(typeof j=="string")return O.default.Config.stringByteSize(j);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof j)}u.dataSizeBytes=_;function F(){return String(Math.random()).substr(2)}u.cheapRandStr=F;var W=function(j){if(O.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var z=new Uint8Array(j);return O.default.Config.getRandomValues(z),O.default.BufferUtils.base64Encode(z)}for(var K=O.default.BufferUtils.base64CharSet,q=Math.round(j*4/3),Z="",ct=0;ct<q;ct++)Z+=K[o(K)];return Z};u.randomString=W;var J=function(j){if(O.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var z=new Uint8Array(j);return O.default.Config.getRandomValues(z),O.default.BufferUtils.hexEncode(z)}for(var K=O.default.BufferUtils.hexCharSet,q=j*2,Z="",ct=0;ct<q;ct++)Z+=K[o(K)];return Z};u.randomHexString=J;function Y(j,z){for(var K=Math.min(z,j.length),q=j.slice(),Z=[],ct=0;ct<K;ct++)Z.push(G(q));return Z}u.arrChooseN=Y,u.trim=String.prototype.trim?function(j){return j.trim()}:function(j){return j.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function $(j,z,K){return new Promise(function(q,Z){j[z].apply(j,e.__spreadArray(e.__spreadArray([],K),[function(ct,St){ct?Z(ct):q(St)}]))})}u.promisify=$;var tt;(function(j){j.msgpack="msgpack",j.json="json"})(tt=u.Format||(u.Format={}));function et(j,z){return z=="msgpack"?O.default.Config.msgpack.decode(j):JSON.parse(String(j))}u.decodeBody=et;function Q(j,z){return z=="msgpack"?O.default.Config.msgpack.encode(j,!0):JSON.stringify(j)}u.encodeBody=Q;function nt(j){return j.map(function(z){return z&&z.toLowerCase()})}u.allToLowerCase=nt;function st(j){return j.map(function(z){return z&&z.toUpperCase()})}u.allToUpperCase=st;function at(j){return Math.min((j+2)/3,2)}u.getBackoffCoefficient=at;function rt(){return 1-Math.random()*.2}u.getJitterCoefficient=rt;function ft(){return l||(typeof window!="undefined"?window:self)}u.getGlobalObject=ft}).call(this,t(12))},function(x,u,t){"use strict";(function(l){u.__esModule=!0;var e=t(1),O=e.__importDefault(t(0)),C=l||(typeof window!="undefined"?window:self),o;(function(i){i[i.None=0]="None",i[i.Error=1]="Error",i[i.Major=2]="Major",i[i.Minor=3]="Minor",i[i.Micro=4]="Micro"})(o||(o={}));function c(i,g){return(""+i).padStart(g?3:2,"0")}function m(i){return O.default.Config.logTimestamps?function(g){var T=new Date;i(c(T.getHours())+":"+c(T.getMinutes())+":"+c(T.getSeconds())+"."+c(T.getMilliseconds(),1)+" "+g)}:i}var v=function(){var i,g,T,S;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((g=(i=C==null?void 0:C.console)===null||i===void 0?void 0:i.log)===null||g===void 0?void 0:g.apply)=="function"?(T=function(){for(var p=[],d=0;d<arguments.length;d++)p[d]=arguments[d]},S=console.warn?function(){for(var p=[],d=0;d<arguments.length;d++)p[d]=arguments[d]}:T):C!=null&&C.console.log?T=S=function(){Function.prototype.apply.call(console.log,console,arguments)}:T=S=function(){},[T,S].map(m)},y=function(){function i(){i.logLevel=i.LOG_DEFAULT}return i.initLogHandlers=function(){var g=v(),T=g[0],S=g[1];this.logHandler=T,this.logErrorHandler=S},i.logLevel=o.Error,i.LOG_NONE=o.None,i.LOG_ERROR=o.Error,i.LOG_MAJOR=o.Major,i.LOG_MINOR=o.Minor,i.LOG_MICRO=o.Micro,i.LOG_DEFAULT=o.Error,i.LOG_DEBUG=o.Micro,i.logAction=function(g,T,S){i.shouldLog(g)&&(g===o.Error?i.logErrorHandler:i.logHandler)("Ably: "+T+": "+S)},i.deprecated=function(g,T){i.deprecatedWithMsg(g,"Please use '"+T+"' instead.")},i.deprecatedWithMsg=function(g,T){i.shouldLog(o.Error)&&i.logErrorHandler("Ably: Deprecation warning - '"+g+"' is deprecated and will be removed from a future version. "+T)},i.shouldLog=function(g){return g<=i.logLevel},i.setLog=function(g,T){g!==void 0&&(i.logLevel=g),T!==void 0&&(i.logHandler=i.logErrorHandler=T)},i}();u.default=y}).call(this,t(12))},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(){if(typeof ArrayBuffer=="function"){var e=l,O=e.lib,C=O.WordArray,o=C.init,c=C.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var v=m.byteLength,y=[],i=0;i<v;i++)y[i>>>2]|=m[i]<<24-i%4*8;o.call(this,y,v)}else o.apply(this,arguments)};c.prototype=C}}(),l.lib.WordArray})},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(0)),O=l.__importStar(t(2)),C=function(){function o(c,m,v,y){this.message=c,this.code=m,this.statusCode=v,this.cause=y}return o.prototype.toString=function(){var c="["+this.constructor.name;return this.message&&(c+=": "+this.message),this.statusCode&&(c+="; statusCode="+this.statusCode),this.code&&(c+="; code="+this.code),this.cause&&(c+="; cause="+O.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(c+="; see "+this.href+" "),c+="]",c},o.fromValues=function(c){var m=c,v=m.message,y=m.code,i=m.statusCode;if(typeof v!="string"||typeof y!="number"||typeof i!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+e.default.Config.inspect(c));var g=Object.assign(new o(v,y,i),c);return g.code&&!g.href&&(g.href="https://help.ably.io/error/"+g.code),g},o}();u.default=C},function(x,u,t){(function(l){(function(e,O){x.exports=u=O()})(this,function(){var e=e||function(O,C){var o;if(typeof window!="undefined"&&window.crypto&&(o=window.crypto),!o&&typeof window!="undefined"&&window.msCrypto&&(o=window.msCrypto),!o&&typeof l!="undefined"&&l.crypto&&(o=l.crypto),!o)try{o=t(44)}catch(a){}var c=function(){if(o){if(typeof o.getRandomValues=="function")try{return o.getRandomValues(new Uint32Array(1))[0]}catch(a){}if(typeof o.randomBytes=="function")try{return o.randomBytes(4).readInt32LE()}catch(a){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function a(){}return function(s){var r;return a.prototype=s,r=new a,a.prototype=null,r}}(),v={},y=v.lib={},i=y.Base=function(){return{extend:function(a){var s=m(this);return a&&s.mixIn(a),(!s.hasOwnProperty("init")||this.init===s.init)&&(s.init=function(){s.$super.init.apply(this,arguments)}),s.init.prototype=s,s.$super=this,s},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var s in a)a.hasOwnProperty(s)&&(this[s]=a[s]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=y.WordArray=i.extend({init:function(a,s){a=this.words=a||[],s!=C?this.sigBytes=s:this.sigBytes=a.length*4},toString:function(a){return(a||S).stringify(this)},concat:function(a){var s=this.words,r=a.words,h=this.sigBytes,R=a.sigBytes;if(this.clamp(),h%4)for(var P=0;P<R;P++){var U=r[P>>>2]>>>24-P%4*8&255;s[h+P>>>2]|=U<<24-(h+P)%4*8}else for(var P=0;P<R;P+=4)s[h+P>>>2]=r[P>>>2];return this.sigBytes+=R,this},clamp:function(){var a=this.words,s=this.sigBytes;a[s>>>2]&=4294967295<<32-s%4*8,a.length=O.ceil(s/4)},clone:function(){var a=i.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var s=[],r=0;r<a;r+=4)s.push(c());return new g.init(s,a)}}),T=v.enc={},S=T.Hex={stringify:function(a){for(var s=a.words,r=a.sigBytes,h=[],R=0;R<r;R++){var P=s[R>>>2]>>>24-R%4*8&255;h.push((P>>>4).toString(16)),h.push((P&15).toString(16))}return h.join("")},parse:function(a){for(var s=a.length,r=[],h=0;h<s;h+=2)r[h>>>3]|=parseInt(a.substr(h,2),16)<<24-h%8*4;return new g.init(r,s/2)}},p=T.Latin1={stringify:function(a){for(var s=a.words,r=a.sigBytes,h=[],R=0;R<r;R++){var P=s[R>>>2]>>>24-R%4*8&255;h.push(String.fromCharCode(P))}return h.join("")},parse:function(a){for(var s=a.length,r=[],h=0;h<s;h++)r[h>>>2]|=(a.charCodeAt(h)&255)<<24-h%4*8;return new g.init(r,s)}},d=T.Utf8={stringify:function(a){try{return decodeURIComponent(escape(p.stringify(a)))}catch(s){throw new Error("Malformed UTF-8 data")}},parse:function(a){return p.parse(unescape(encodeURIComponent(a)))}},b=y.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){typeof a=="string"&&(a=d.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var s,r=this._data,h=r.words,R=r.sigBytes,P=this.blockSize,U=P*4,D=R/U;a?D=O.ceil(D):D=O.max((D|0)-this._minBufferSize,0);var M=D*P,A=O.min(M*4,R);if(M){for(var E=0;E<M;E+=P)this._doProcessBlock(h,E);s=h.splice(0,M),r.sigBytes-=A}return new g.init(s,A)},clone:function(){var a=i.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),n=y.Hasher=b.extend({cfg:i.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){b.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var s=this._doFinalize();return s},blockSize:512/32,_createHelper:function(a){return function(s,r){return new a.init(r).finalize(s)}},_createHmacHelper:function(a){return function(s,r){return new f.HMAC.init(a,r).finalize(s)}}}),f=v.algo={};return v}(Math);return e})}).call(this,t(12))},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(3)),C=l.__importDefault(t(0));function o(v,y,i){try{y.apply(v,i)}catch(g){O.default.logAction(O.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+g+"; stack = "+(g&&g.stack))}}function c(v,y,i){for(var g,T,S,p=0;p<v.length;p++)if(g=v[p],i&&(g=g[i]),e.isArray(g)){for(;(T=e.arrIndexOf(g,y))!==-1;)g.splice(T,1);i&&g.length===0&&delete v[p][i]}else if(e.isObject(g))for(S in g)Object.prototype.hasOwnProperty.call(g,S)&&e.isArray(g[S])&&c([g],y,S)}var m=function(){function v(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return v.prototype.on=function(){for(var y=this,i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];if(i.length===1){var T=i[0];if(typeof T=="function")this.any.push(T);else throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(i))}if(i.length===2){var S=i[0],p=i[1];if(typeof p!="function")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(i));if(e.isEmptyArg(S))this.any.push(p);else if(e.isArray(S))S.forEach(function(b){y.on(b,p)});else{if(typeof S!="string")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(i));var d=this.events[S]||(this.events[S]=[]);d.push(p)}}},v.prototype.off=function(){for(var y,i=this,g=[],T=0;T<arguments.length;T++)g[T]=arguments[T];if(g.length==0||e.isEmptyArg(g[0])&&e.isEmptyArg(g[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var S=g[0],p=g[1],d=null,b=null;if(g.length===1||!p)typeof S=="function"?d=S:b=S;else{if(typeof p!="function")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(g));y=[S,p],b=y[0],d=y[1]}if(d&&e.isEmptyArg(b)){c([this.any,this.events,this.anyOnce,this.eventsOnce],d);return}if(e.isArray(b)){b.forEach(function(n){i.off(n,d)});return}if(typeof b!="string")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(g));d?c([this.events,this.eventsOnce],d,b):(delete this.events[b],delete this.eventsOnce[b])},v.prototype.listeners=function(y){if(y){var i=this.events[y]||[];return this.eventsOnce[y]&&Array.prototype.push.apply(i,this.eventsOnce[y]),i.length?i:null}return this.any.length?this.any:null},v.prototype.emit=function(y){for(var i=[],g=1;g<arguments.length;g++)i[g-1]=arguments[g];var T={event:y},S=[];this.anyOnce.length&&(Array.prototype.push.apply(S,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(S,this.any);var p=this.eventsOnce[y];p&&(Array.prototype.push.apply(S,p),delete this.eventsOnce[y]);var d=this.events[y];d&&Array.prototype.push.apply(S,d),e.arrForEach(S,function(b){o(T,b,i)})},v.prototype.once=function(){for(var y=this,i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];var T=i.length;if((T===0||T===1&&typeof i[0]!="function")&&C.default.Config.Promise){var S=i[0];if(typeof S!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(i));return new C.default.Config.Promise(function(a){y.once(S,a)})}var p=i[0],d=i[1];if(i.length===1&&typeof p=="function")this.anyOnce.push(p);else if(e.isEmptyArg(p)){if(typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(i));this.anyOnce.push(d)}else if(e.isArray(p)){var b=this,n=function(){var a=Array.prototype.slice.call(arguments);if(e.arrForEach(p,function(s){b.off(s,n)}),typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(i));d.apply(this,a)};e.arrForEach(p,function(a){b.on(a,n)})}else{if(typeof p!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(i));var f=this.eventsOnce[p]||(this.eventsOnce[p]=[]);if(d){if(typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(i));f.push(d)}}},v.prototype.whenState=function(y,i,g){for(var T=this,S=[],p=3;p<arguments.length;p++)S[p-3]=arguments[p];var d={event:y};if(typeof y!="string"||typeof i!="string")throw"whenState requires a valid event String argument";if(typeof g!="function"&&C.default.Config.Promise)return new C.default.Config.Promise(function(b){v.prototype.whenState.apply(T,[y,i,b].concat(S))});y===i?o(d,g,S):this.once(y,g)},v}();u.default=m},function(x,u,t){"use strict";u.__esModule=!0,u.getDefaults=u.normaliseOptions=u.objectifyOptions=u.getHosts=u.getFallbackHosts=u.environmentFallbackHosts=u.getHttpScheme=u.getPort=u.getHost=void 0;var l=t(1),e=l.__importDefault(t(0)),O=l.__importStar(t(2)),C=l.__importDefault(t(3)),o=l.__importDefault(t(5)),c=t(42),m="ably-js/"+c.version,v={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:c.version,apiVersion:"1.2",agent:m,getHost:y,getPort:i,getHttpScheme:g,environmentFallbackHosts:T,getFallbackHosts:S,getHosts:p,checkHost:d,objectifyOptions:f,normaliseOptions:a};function y(r,h,R){return R?h=h==r.restHost&&r.realtimeHost||h||r.realtimeHost:h=h||r.restHost,h}u.getHost=y;function i(r,h){return h||r.tls?r.tlsPort:r.port}u.getPort=i;function g(r){return r.tls?"https://":"http://"}u.getHttpScheme=g;function T(r){return[r+"-a-fallback.ably-realtime.com",r+"-b-fallback.ably-realtime.com",r+"-c-fallback.ably-realtime.com",r+"-d-fallback.ably-realtime.com",r+"-e-fallback.ably-realtime.com"]}u.environmentFallbackHosts=T;function S(r){var h=r.fallbackHosts,R=typeof r.httpMaxRetryCount!="undefined"?r.httpMaxRetryCount:v.httpMaxRetryCount;return h?O.arrChooseN(h,R):[]}u.getFallbackHosts=S;function p(r){return[r.restHost].concat(S(r))}u.getHosts=p;function d(r){if(typeof r!="string")throw new o.default("host must be a string; was a "+typeof r,4e4,400);if(!r.length)throw new o.default("host must not be zero-length",4e4,400)}function b(r,h,R){return r.realtimeHost?r.realtimeHost:r.restHost?(C.default.logAction(C.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+r.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+r.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),r.restHost):h?v.REALTIME_HOST:R+"-"+v.REALTIME_HOST}function n(r){var h={};for(var R in v.TIMEOUTS)h[R]=r[R]||v.TIMEOUTS[R];return h}function f(r){return typeof r=="string"?r.indexOf(":")==-1?{token:r}:{key:r}:r}u.objectifyOptions=f;function a(r){if(r.host&&(C.default.deprecated("host","restHost"),r.restHost=r.host),r.wsHost&&(C.default.deprecated("wsHost","realtimeHost"),r.realtimeHost=r.wsHost),r.queueEvents&&(C.default.deprecated("queueEvents","queueMessages"),r.queueMessages=r.queueEvents),r.fallbackHostsUseDefault){if(r.fallbackHosts){var h="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",h),new o.default(h,4e4,400)}if(r.port||r.tlsPort){var h="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",h),new o.default(h,4e4,400)}r.environment?C.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):C.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),r.fallbackHosts=v.FALLBACK_HOSTS}r.recover===!0&&(C.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),r.recover=function(B,N){N(!0)}),typeof r.recover=="function"&&r.closeOnUnload===!0&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),r.recover=void 0),"closeOnUnload"in r||(r.closeOnUnload=!r.recover),r.transports&&O.arrIn(r.transports,"xhr")&&(C.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),O.arrDeleteValue(r.transports,"xhr"),r.transports.push("xhr_streaming")),"queueMessages"in r||(r.queueMessages=!0);var R=r.environment&&String(r.environment).toLowerCase()||v.ENVIRONMENT,P=!R||R==="production";!r.fallbackHosts&&!r.restHost&&!r.realtimeHost&&!r.port&&!r.tlsPort&&(r.fallbackHosts=P?v.FALLBACK_HOSTS:T(R));var U=r.restHost||(P?v.REST_HOST:R+"-"+v.REST_HOST),D=b(r,P,R);O.arrForEach((r.fallbackHosts||[]).concat(U,D),d),r.port=r.port||v.PORT,r.tlsPort=r.tlsPort||v.TLS_PORT,"tls"in r||(r.tls=!0);var M=n(r);if("useBinaryProtocol"in r?r.useBinaryProtocol=e.default.Config.supportsBinary&&r.useBinaryProtocol:r.useBinaryProtocol=e.default.Config.preferBinary,r.clientId){var A=r.headers=r.headers||{};A["X-Ably-ClientId"]=e.default.BufferUtils.base64Encode(e.default.BufferUtils.utf8Encode(r.clientId))}if("idempotentRestPublishing"in r||(r.idempotentRestPublishing=!0),r.promises&&!e.default.Config.Promise&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),r.promises=!1),r.agents)for(var E in r.agents)v.agent+=" "+E+"/"+r.agents[E];return l.__assign(l.__assign({},r),{useBinaryProtocol:"useBinaryProtocol"in r?e.default.Config.supportsBinary&&r.useBinaryProtocol:e.default.Config.preferBinary,realtimeHost:D,restHost:U,maxMessageSize:r.maxMessageSize||v.maxMessageSize,timeouts:M})}u.normaliseOptions=a,u.default=v;function s(r){return Object.assign(v,r)}u.getDefaults=s},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(0)),O=l.__importDefault(t(3)),C=l.__importDefault(t(5)),o=l.__importStar(t(2));function c(i){return!i||!i.channelOptions?{channelOptions:i,plugins:{},baseEncodedPreviousPayload:void 0}:i}function m(i){if(i&&i.cipher&&!i.cipher.channelCipher){if(!e.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var g=e.default.Crypto.getCipher(i.cipher);return{cipher:g.cipherParams,channelCipher:g.cipher}}return i}function v(i){var g=0;return i.name&&(g+=i.name.length),i.clientId&&(g+=i.clientId.length),i.extras&&(g+=JSON.stringify(i.extras).length),i.data&&(g+=o.dataSizeBytes(i.data)),g}var y=function(){function i(){}return i.prototype.toJSON=function(){var g=this.encoding,T=this.data;return T&&e.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(g=g?g+"/base64":"base64",T=e.default.BufferUtils.base64Encode(T)):T=e.default.BufferUtils.toBuffer(T)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:g,data:T}},i.prototype.toString=function(){var g="[Message";return this.name&&(g+="; name="+this.name),this.id&&(g+="; id="+this.id),this.timestamp&&(g+="; timestamp="+this.timestamp),this.clientId&&(g+="; clientId="+this.clientId),this.connectionId&&(g+="; connectionId="+this.connectionId),this.encoding&&(g+="; encoding="+this.encoding),this.extras&&(g+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?g+="; data="+this.data:e.default.BufferUtils.isBuffer(this.data)?g+="; data (buffer)="+e.default.BufferUtils.base64Encode(this.data):g+="; data (json)="+JSON.stringify(this.data)),this.extras&&(g+="; extras="+JSON.stringify(this.extras)),g+="]",g},i.encrypt=function(g,T,S){var p=g.data,d=g.encoding,b=T.channelCipher;d=d?d+"/":"",e.default.BufferUtils.isBuffer(p)||(p=e.default.BufferUtils.utf8Encode(String(p)),d=d+"utf-8/"),b.encrypt(p,function(n,f){if(n){S(n);return}g.data=f,g.encoding=d+"cipher+"+b.algorithm,S(null,g)})},i.encode=function(g,T,S){var p=g.data,d=typeof p=="string"||e.default.BufferUtils.isBuffer(p)||p===null||p===void 0;if(!d)if(o.isObject(p)||o.isArray(p))g.data=JSON.stringify(p),g.encoding=g.encoding?g.encoding+"/json":"json";else throw new C.default("Data type is unsupported",40013,400);T!=null&&T.cipher?i.encrypt(g,T,S):S(null,g)},i.encodeArray=function(g,T,S){for(var p=0,d=0;d<g.length;d++)i.encode(g[d],T,function(b){if(b){S(b);return}p++,p==g.length&&S(null,g)})},i.decode=function(g,T){var S=c(T),p=g.data,d=g.encoding;if(d){var b=d.split("/"),n=void 0,f=b.length,a=g.data,s="";try{for(;(n=f)>0;){var r=b[--f].match(/([-\w]+)(\+([\w-]+))?/);if(!r)break;switch(s=r[1],s){case"base64":a=e.default.BufferUtils.base64Decode(String(a)),n==b.length&&(p=a);continue;case"utf-8":a=e.default.BufferUtils.utf8Decode(a);continue;case"json":a=JSON.parse(a);continue;case"cipher":if(S.channelOptions!=null&&S.channelOptions.cipher&&S.channelOptions.channelCipher){var h=r[3],R=S.channelOptions.channelCipher;if(h!=R.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");a=R.decrypt(a);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!S.plugins||!S.plugins.vcdiff)throw new C.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new C.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var P=S.baseEncodedPreviousPayload;typeof P=="string"&&(P=e.default.BufferUtils.utf8Encode(P)),P=e.default.BufferUtils.toBuffer(P),a=e.default.BufferUtils.toBuffer(a),a=e.default.BufferUtils.typedArrayToBuffer(S.plugins.vcdiff.decode(a,P)),p=a}catch(D){throw new C.default("Vcdiff delta decode failed with "+D,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(D){var U=D;throw new C.default("Error processing the "+s+" encoding, decoder returned \u2018"+U.message+"\u2019",U.code||40013,400)}finally{g.encoding=n<=0?null:b.slice(0,n).join("/"),g.data=a}}S.baseEncodedPreviousPayload=p},i.fromResponseBody=function(g,T,S){S&&(g=o.decodeBody(g,S));for(var p=0;p<g.length;p++){var d=g[p]=i.fromValues(g[p]);try{i.decode(d,T)}catch(b){O.default.logAction(O.default.LOG_ERROR,"Message.fromResponseBody()",b.toString())}}return g},i.fromValues=function(g){return Object.assign(new i,g)},i.fromValuesArray=function(g){for(var T=g.length,S=new Array(T),p=0;p<T;p++)S[p]=i.fromValues(g[p]);return S},i.fromEncoded=function(g,T){var S=i.fromValues(g),p=m(T);try{i.decode(S,p)}catch(d){O.default.logAction(O.default.LOG_ERROR,"Message.fromEncoded()",d.toString())}return S},i.fromEncodedArray=function(g,T){return m(T),g.map(function(S){return i.fromEncoded(S,T)})},i.getMessagesSize=function(g){for(var T,S=0,p=0;p<g.length;p++)T=g[p],S+=T.size||(T.size=v(T));return S},i.serialize=o.encodeBody,i}();u.default=y},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(5)),C=l.__importDefault(t(9)),o=l.__importDefault(t(14)),c={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},m=[];Object.keys(c).forEach(function(S){m[c[S]]=S});var v={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},y=Object.keys(v);v.MODE_ALL=v.PRESENCE|v.PUBLISH|v.SUBSCRIBE|v.PRESENCE_SUBSCRIBE;function i(S){var p=[];if(S)for(var d=0;d<S.length;d++)p.push(S[d].toString());return"[ "+p.join(", ")+" ]"}var g="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),T=function(){function S(){var p=this;this.hasFlag=function(d){return(p.flags&v[d])>0}}return S.prototype.setFlag=function(p){return this.flags=this.flags|v[p]},S.prototype.getMode=function(){return this.flags&&this.flags&v.MODE_ALL},S.prototype.encodeModesToFlags=function(p){var d=this;p.forEach(function(b){return d.setFlag(b)})},S.prototype.decodeModesFromFlags=function(){var p=this,d=[];return S.channelModes.forEach(function(b){p.hasFlag(b)&&d.push(b)}),d.length>0?d:void 0},S.fromValues=function(p){return Object.assign(new S,p)},S.Action=c,S.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],S.ActionName=m,S.serialize=e.encodeBody,S.deserialize=function(p,d){var b=e.decodeBody(p,d);return S.fromDeserialized(b)},S.fromDeserialized=function(p){var d=p.error;d&&(p.error=O.default.fromValues(d));var b=p.messages;if(b)for(var n=0;n<b.length;n++)b[n]=C.default.fromValues(b[n]);var f=p.presence;if(f)for(var n=0;n<f.length;n++)f[n]=o.default.fromValues(f[n],!0);return Object.assign(new S,p)},S.stringify=function(p){var d="[ProtocolMessage";p.action!==void 0&&(d+="; action="+S.ActionName[p.action]||!1);for(var b,n=0;n<g.length;n++)b=g[n],p[b]!==void 0&&(d+="; "+b+"="+p[b]);if(p.messages&&(d+="; messages="+i(C.default.fromValuesArray(p.messages))),p.presence&&(d+="; presence="+i(o.default.fromValuesArray(p.presence))),p.error&&(d+="; error="+O.default.fromValues(p.error).toString()),p.auth&&p.auth.accessToken&&(d+="; token="+p.auth.accessToken),p.flags&&(d+="; flags="+y.filter(p.hasFlag).join(",")),p.params){var f="";e.forInOwnNonNullProperties(p.params,function(a){f.length>0&&(f+="; "),f+=a+"="+p.params[a]}),f.length>0&&(d+="; params=["+f+"]")}return d+="]",d},S.isDuplicate=function(p,d){if(p&&d&&(p.action===c.MESSAGE||p.action===c.PRESENCE)&&p.action===d.action&&p.channel===d.channel&&p.id===d.id){if(p.action===c.PRESENCE)return!0;if(p.messages.length===d.messages.length){for(var b=0;b<p.messages.length;b++){var n=p.messages[b],f=d.messages[b];if((n.extras&&n.extras.delta&&n.extras.delta.format)!==(f.extras&&f.extras.delta&&f.extras.delta.format))return!1}return!0}}return!1},S}();u.default=T},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(10)),C=l.__importDefault(t(26)),o=l.__importDefault(t(3)),c=l.__importDefault(t(8)),m=l.__importDefault(t(19)),v=l.__importDefault(t(16)),y=l.__importDefault(t(5)),i=l.__importDefault(t(20)),g=l.__importDefault(t(0));function T(d){var b=[80015,80017,80030];return d.code?v.default.isTokenErr(d)?!1:e.arrIn(b,d.code)?!0:d.code>=4e4&&d.code<5e4:!1}function S(d){return T(d)?[O.default.fromValues({action:O.default.Action.ERROR,error:d})]:[O.default.fromValues({action:O.default.Action.DISCONNECTED,error:d})]}var p=function(d){l.__extends(b,d);function b(n,f,a){var s=d.call(this,n,f,a,!0)||this;return s.onAuthUpdated=function(r){s.authParams={access_token:r.token}},s.stream="stream"in a?a.stream:!0,s.sendRequest=null,s.recvRequest=null,s.pendingCallback=null,s.pendingItems=null,s}return b.prototype.connect=function(){var n=this;o.default.logAction(o.default.LOG_MINOR,"CometTransport.connect()","starting"),C.default.prototype.connect.call(this);var f=this.params,a=f.options,s=c.default.getHost(a,f.host),r=c.default.getPort(a),h=a.tls?"https://":"http://";this.baseUri=h+s+":"+r+"/comet/";var R=this.baseUri+"connect";o.default.logAction(o.default.LOG_MINOR,"CometTransport.connect()","uri: "+R),this.auth.getAuthParams(function(P,U){if(P){n.disconnect(P);return}if(!n.isDisposed){n.authParams=U;var D=n.params.getConnectParams(U);"stream"in D&&(n.stream=D.stream),o.default.logAction(o.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+e.toQueryString(D));var M=!1,A=n.recvRequest=n.createRequest(R,null,D,null,n.stream?i.default.REQ_RECV_STREAM:i.default.REQ_RECV);A.on("data",function(E){!n.recvRequest||(M||(M=!0,n.emit("preconnect")),n.onData(E))}),A.on("complete",function(E){if(n.recvRequest||(E=E||new y.default("Request cancelled",80003,400)),n.recvRequest=null,!M&&!E&&(M=!0,n.emit("preconnect")),n.onActivity(),E){E.code?n.onData(S(E)):n.disconnect(E);return}g.default.Config.nextTick(function(){n.recv()})}),A.exec()}})},b.prototype.requestClose=function(){o.default.logAction(o.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},b.prototype.requestDisconnect=function(){o.default.logAction(o.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},b.prototype._requestCloseOrDisconnect=function(n){var f=this,a=n?this.closeUri:this.disconnectUri;if(a){var s=this.createRequest(a,null,this.authParams,null,i.default.REQ_SEND);s.on("complete",function(r){r&&(o.default.logAction(o.default.LOG_ERROR,"CometTransport.request"+(n?"Close()":"Disconnect()"),"request returned err = "+e.inspectError(r)),f.finish("disconnected",r))}),s.exec()}},b.prototype.dispose=function(){var n=this;o.default.logAction(o.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(o.default.logAction(o.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected),g.default.Config.nextTick(function(){n.emit("disposed")}))},b.prototype.onConnect=function(n){if(!this.isDisposed){var f=n.connectionKey;C.default.prototype.onConnect.call(this,n);var a=this.baseUri+f;o.default.logAction(o.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a+"; connectionKey = "+n.connectionKey),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},b.prototype.send=function(n){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(n);return}var f=this.pendingItems||[];f.push(n),this.pendingItems=null,this.sendItems(f)},b.prototype.sendAnyPending=function(){var n=this.pendingItems;!n||(this.pendingItems=null,this.sendItems(n))},b.prototype.sendItems=function(n){var f=this,a=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(n),i.default.REQ_SEND);a.on("complete",function(s,r){if(s&&o.default.logAction(o.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+e.inspectError(s)),f.sendRequest=null,s){s.code?f.onData(S(s)):f.disconnect(s);return}r&&f.onData(r),f.pendingItems&&g.default.Config.nextTick(function(){f.sendRequest||f.sendAnyPending()})}),a.exec()},b.prototype.recv=function(){var n=this;if(!this.recvRequest&&!!this.isConnected){var f=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?i.default.REQ_RECV_STREAM:i.default.REQ_RECV_POLL);f.on("data",function(a){n.onData(a)}),f.on("complete",function(a){if(n.recvRequest=null,n.onActivity(),a){a.code?n.onData(S(a)):n.disconnect(a);return}g.default.Config.nextTick(function(){n.recv()})}),f.exec()}},b.prototype.onData=function(n){try{var f=this.decodeResponse(n);if(f&&f.length)for(var a=0;a<f.length;a++)this.onProtocolMessage(O.default.fromDeserialized(f[a]))}catch(s){o.default.logAction(o.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+s.stack)}},b.prototype.encodeRequest=function(n){return JSON.stringify(n)},b.prototype.decodeResponse=function(n){return typeof n=="string"?JSON.parse(n):n},b}(C.default);u.default=p},function(x,u){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(l){typeof window=="object"&&(t=window)}x.exports=t},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(){var e=l,O=e.lib,C=O.WordArray,o=e.enc,c=o.Base64={stringify:function(v){var y=v.words,i=v.sigBytes,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";v.clamp();for(var T=[],S=0;S<i;S+=3)for(var p=y[S>>>2]>>>24-S%4*8&255,d=y[S+1>>>2]>>>24-(S+1)%4*8&255,b=y[S+2>>>2]>>>24-(S+2)%4*8&255,n=p<<16|d<<8|b,f=0;f<4&&S+f*.75<i;f++)T.push(g.charAt(n>>>6*(3-f)&63));var a=g.charAt(64);if(a)for(;T.length%4;)T.push(a);return T.join("")},parse:function(v){var y=v.length,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g=this._reverseMap;if(!g){g=this._reverseMap=[];for(var T=0;T<i.length;T++)g[i.charCodeAt(T)]=T}var S=i.charAt(64);if(S){var p=v.indexOf(S);p!==-1&&(y=p)}return m(v,y,g)}};function m(v,y,i){for(var g=[],T=0,S=0;S<y;S++)if(S%4){var p=i[v.charCodeAt(S-1)]<<S%4*2,d=i[v.charCodeAt(S)]>>>6-S%4*2,b=p|d;g[T>>>2]|=b<<24-T%4*8,T++}return C.create(g,T)}}(),l.enc.Base64})},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(3)),O=l.__importDefault(t(0)),C=l.__importDefault(t(9)),o=l.__importStar(t(2));function c(v){return m.Actions.indexOf(v)}var m=function(){function v(){}return v.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},v.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var y=this.id.split(":");return{connectionId:y[0],msgSerial:parseInt(y[1],10),index:parseInt(y[2],10)}},v.prototype.toJSON=function(){var y=this.data,i=this.encoding;return y&&O.default.BufferUtils.isBuffer(y)&&(arguments.length>0?(i=i?i+"/base64":"base64",y=O.default.BufferUtils.base64Encode(y)):y=O.default.BufferUtils.toBuffer(y)),{clientId:this.clientId,action:c(this.action),data:y,encoding:i}},v.prototype.toString=function(){var y="[PresenceMessage";return y+="; action="+this.action,this.id&&(y+="; id="+this.id),this.timestamp&&(y+="; timestamp="+this.timestamp),this.clientId&&(y+="; clientId="+this.clientId),this.connectionId&&(y+="; connectionId="+this.connectionId),this.encoding&&(y+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?y+="; data="+this.data:O.default.BufferUtils.isBuffer(this.data)?y+="; data (buffer)="+O.default.BufferUtils.base64Encode(this.data):y+="; data (json)="+JSON.stringify(this.data)),y+="]",y},v.fromResponseBody=function(y,i,g){var T=[];g&&(y=o.decodeBody(y,g));for(var S=0;S<y.length;S++){var p=T[S]=v.fromValues(y[S],!0);try{v.decode(p,i)}catch(d){e.default.logAction(e.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",d.toString())}}return T},v.fromValues=function(y,i){return i&&(y.action=v.Actions[y.action]),Object.assign(new v,y)},v.fromValuesArray=function(y){for(var i=y.length,g=new Array(i),T=0;T<i;T++)g[T]=v.fromValues(y[T]);return g},v.fromEncoded=function(y,i){var g=v.fromValues(y,!0);try{v.decode(g,i)}catch(T){e.default.logAction(e.default.LOG_ERROR,"PresenceMessage.fromEncoded()",T.toString())}return g},v.fromEncodedArray=function(y,i){return y.map(function(g){return v.fromEncoded(g,i)})},v.Actions=["absent","present","enter","leave","update"],v.encode=C.default.encode,v.decode=C.default.decode,v.getMessagesSize=C.default.getMessagesSize,v}();u.default=m},function(x,u,t){"use strict";(function(l){u.__esModule=!0;var e=t(1),O=e.__importStar(t(2)),C=e.__importDefault(t(7)),o=e.__importDefault(t(5)),c=e.__importDefault(t(3)),m=e.__importDefault(t(8)),v=e.__importDefault(t(20)),y=e.__importDefault(t(0));function i(h,R){return O.arrIn(O.allToLowerCase(O.keysArray(R)),"x-ably-errorcode")}function g(h,R){if(i(h,R))return h.error&&o.default.fromValues(h.error)}var T=function(){},S=0,p={},d=typeof l!="undefined"&&l.XDomainRequest;function b(){var h=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return h&&Number(h[1])}function n(){var h;return d&&(h=b())&&h===10}function f(h,R){return h.getResponseHeader&&h.getResponseHeader(R)}function a(h){return h.getResponseHeader&&(h.getResponseHeader("transfer-encoding")||!h.getResponseHeader("content-length"))}function s(h){for(var R=O.trim(h.getAllResponseHeaders()).split(`\r
`),P={},U=0;U<R.length;U++){var D=R[U].split(":").map(O.trim);P[D[0].toLowerCase()]=D[1]}return P}var r=function(h){e.__extends(R,h);function R(P,U,D,M,A,E,B){var N=h.call(this)||this;return D=D||{},D.rnd=O.cheapRandStr(),n()&&!D.envelope&&(D.envelope="json"),N.uri=P+O.toQueryString(D),N.headers=U||{},N.body=M,N.method=B?B.toUpperCase():O.isEmptyArg(M)?"GET":"POST",N.requestMode=A,N.timeouts=E,N.timedOut=!1,N.requestComplete=!1,N.id=String(++S),p[N.id]=N,N}return R.createRequest=function(P,U,D,M,A,E,B){var N=E||m.default.TIMEOUTS;return new R(P,U,O.copy(D),M,A,N,B)},R.prototype.complete=function(P,U,D,M,A){this.requestComplete||(this.requestComplete=!0,!P&&U&&this.emit("data",U),this.emit("complete",P,U,D,M,A),this.dispose())},R.prototype.abort=function(){this.dispose()},R.prototype.exec=function(){var P=this,U=this.headers,D=this.requestMode==v.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,M=this.timer=setTimeout(function(){P.timedOut=!0,E.abort()},D),A=this.method,E=this.xhr=new XMLHttpRequest,B=U.accept,N=this.body,G="text";if(B?B.indexOf("application/x-msgpack")===0&&(G="arraybuffer"):U.accept="application/json",N){var H=U["content-type"]||(U["content-type"]="application/json");H.indexOf("application/json")>-1&&typeof N!="string"&&(N=JSON.stringify(N))}E.open(A,this.uri,!0),E.responseType=G,"authorization"in U&&(E.withCredentials=!0);for(var k in U)E.setRequestHeader(k,U[k]);var L=function(Q,nt,st,at){var rt,ft=nt+" (event type: "+Q.type+")";!((rt=P==null?void 0:P.xhr)===null||rt===void 0)&&rt.statusText&&(ft+=", current statusText is "+P.xhr.statusText),c.default.logAction(c.default.LOG_ERROR,"Request.on"+Q.type+"()",ft),P.complete(new o.default(ft,st,at))};E.onerror=function(Q){L(Q,"XHR error occurred",null,400)},E.onabort=function(Q){P.timedOut?L(Q,"Request aborted due to request timeout expiring",null,408):L(Q,"Request cancelled",null,400)},E.ontimeout=function(Q){L(Q,"Request timed out",null,408)};var I,w,_,F=0,W=!1,J=function(){if(clearTimeout(M),_=w<400,w==204){P.complete(null,null,null,null,w);return}I=P.requestMode==v.default.REQ_RECV_STREAM&&_&&a(E)},Y=function(){var Q;try{var nt=f(E,"content-type"),st=nt?nt.indexOf("application/json")>=0:E.responseType=="text";if(st){var at=E.responseType==="arraybuffer"?y.default.BufferUtils.utf8Decode(E.response):String(E.responseText);at.length?Q=JSON.parse(at):Q=at,W=!0}else Q=E.response;Q.response!==void 0?(w=Q.statusCode,_=w<400,U=Q.headers,Q=Q.response):U=s(E)}catch(ft){P.complete(new o.default("Malformed response body from server: "+ft.message,null,400));return}if(_||O.isArray(Q)){P.complete(null,Q,U,W,w);return}var rt=g(Q,U);rt||(rt=new o.default("Error response received from server: "+w+" body was: "+y.default.Config.inspect(Q),null,w)),P.complete(rt,Q,U,W,w)};function $(){for(var Q=E.responseText,nt=Q.length-1,st,at;F<nt&&(st=Q.indexOf(`
`,F))>-1;)at=Q.slice(F,st),F=st+1,tt(at)}var tt=function(Q){try{Q=JSON.parse(Q)}catch(nt){P.complete(new o.default("Malformed response body from server: "+nt.message,null,400));return}P.emit("data",Q)},et=function(){$(),P.streamComplete=!0,y.default.Config.nextTick(function(){P.complete()})};E.onreadystatechange=function(){var Q=E.readyState;Q<3||E.status!==0&&(w===void 0&&(w=E.status,w===1223&&(w=204),J()),Q==3&&I?$():Q==4&&(I?et():Y()))},E.send(N)},R.prototype.dispose=function(){var P=this.xhr;if(P){P.onreadystatechange=P.onerror=P.onabort=P.ontimeout=T,this.xhr=null;var U=this.timer;U&&(clearTimeout(U),this.timer=null),this.requestComplete||P.abort()}delete p[this.id]},R}(C.default);u.default=r}).call(this,t(12))},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(3)),O=l.__importStar(t(2)),C=l.__importDefault(t(22)),o=l.__importDefault(t(5)),c=l.__importDefault(t(43)),m=t(13),v=t(32),y=l.__importDefault(t(17)),i=l.__importDefault(t(0)),g=Math.pow(2,17);function T(){}function S(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function p(D){return!!D.connection}function d(D){return O.isErrorInfo(D)?(D.code||(D.statusCode===403?D.code=40300:(D.code=40170,D.statusCode=401)),D):new o.default(O.inspectError(D),D.code||40170,D.statusCode||401)}var b=function(D){return i.default.Config.createHmac?Buffer.from(D,"ascii").toString("base64"):m.stringify(v.parse(D))},n=function(D,M){if(i.default.Config.createHmac){var A=i.default.Config.createHmac("SHA256",M);return A.update(D),A.digest("base64")}return m.stringify(c.default(D,M))};function f(D){if(!D)return"";typeof D=="string"&&(D=JSON.parse(D));var M={},A=O.keysArray(D,!0);if(!A)return"";A.sort();for(var E=0;E<A.length;E++)M[A[E]]=D[A[E]].sort();return JSON.stringify(M)}function a(D){if(D.authCallback)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(D.authUrl)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(D.key)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(D.tokenDetails)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var M="authOptions must include valid authentication parameters";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",M),new Error(M)}}function s(D){return"useTokenAuth"in D&&!D.useTokenAuth}function r(D){return D.useTokenAuth||!s(D)&&(D.authCallback||D.authUrl||D.token||D.tokenDetails)}function h(D){return!D.key&&!D.authCallback&&!D.authUrl}var R=0;function P(){return R++}var U=function(){function D(M,A){if(this.authOptions={},this.client=M,this.tokenParams=A.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,r(A)){if(A.key&&!n){var E="client-side token request signing not supported";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",E),new Error(E)}h(A)&&e.default.logAction(e.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(A.defaultTokenParams,A),a(this.authOptions)}else{if(!A.key){var E="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",E),new o.default(E,40160,401)}e.default.logAction(e.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(A)}}return D.prototype.authorize=function(M,A,E){var B=this,N;if(typeof M=="function"&&!E?(E=M,N=M=null):typeof A=="function"&&!E?(E=A,N=null):N=A,!E&&this.client.options.promises)return O.promisify(this,"authorize",arguments);if(N&&N.key&&this.authOptions.key!==N.key)throw new o.default("Unable to update auth options with incompatible key",40102,401);N&&"force"in N&&(e.default.logAction(e.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),O.isOnlyPropIn(N,"force")&&(N=null)),this._forceNewToken(M,N,function(G,H){if(G){B.client.connection&&B.client.connection.connectionManager.actOnErrorFromAuthorize(G),E==null||E(G);return}p(B.client)?B.client.connection.connectionManager.onAuthUpdated(H,E||T):E==null||E(null,H)})},D.prototype.authorise=function(M,A,E){e.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(M,A,E)},D.prototype._forceNewToken=function(M,A,E){var B=this;this.tokenDetails=null,this._saveTokenOptions(M,A),a(this.authOptions),this._ensureValidAuthCredentials(!0,function(N,G){delete B.tokenParams.timestamp,delete B.authOptions.queryTime,E(N,G)})},D.prototype.requestToken=function(M,A,E){var B=this;if(typeof M=="function"&&!E?(E=M,A=M=null):typeof A=="function"&&!E&&(E=A,A=null),!E&&this.client.options.promises)return O.promisify(this,"requestToken",arguments);A=A||this.authOptions,M=M||O.copy(this.tokenParams);var N=E||T,G,H=this.client;if(A.authCallback)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),G=A.authCallback;else if(A.authUrl)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),G=function(F,W){var J=O.mixin({accept:"application/json, text/plain"},A.authHeaders),Y=A.authMethod&&A.authMethod.toLowerCase()==="post",$,tt=A.authUrl.indexOf("?");tt>-1&&($=O.parseQueryString(A.authUrl.slice(tt)),A.authUrl=A.authUrl.slice(0,tt),Y||(A.authParams=O.mixin($,A.authParams)));var et=O.mixin({},A.authParams||{},F),Q=function(at,rt,ft,j){var z;if(at?e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+O.inspectError(at)):(z=ft["content-type"],e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+z+"; body: "+O.inspectBody(rt))),at||j)return W(at,rt);if(i.default.BufferUtils.isBuffer(rt)&&(rt=rt.toString()),!z){W(new o.default("authUrl response is missing a content-type header",40170,401));return}var K=z.indexOf("application/json")>-1,q=z.indexOf("text/plain")>-1||z.indexOf("application/jwt")>-1;if(!K&&!q){W(new o.default("authUrl responded with unacceptable content-type "+z+", should be either text/plain, application/jwt or application/json",40170,401));return}if(K){if(rt.length>g){W(new o.default("authUrl response exceeded max permitted length",40170,401));return}try{rt=JSON.parse(rt)}catch(Z){W(new o.default("Unexpected error processing authURL response; err = "+Z.message,40170,401));return}}W(null,rt,z)};if(e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+A.authUrl+"; Params: "+JSON.stringify(et)+"; method: "+(Y?"POST":"GET")),Y){var nt=J||{};nt["content-type"]="application/x-www-form-urlencoded";var st=O.toQueryString(et).slice(1);B.client.http.doUri(y.default.Post,H,A.authUrl,nt,st,$,Q)}else B.client.http.doUri(y.default.Get,H,A.authUrl,J||{},null,et,Q)};else if(A.key)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),G=function(F,W){B.createTokenRequest(F,A,W)};else{var k="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";e.default.logAction(e.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),N(new o.default(k,40171,403));return}"capability"in M&&(M.capability=f(M.capability));var L=function(F,W){var J=F.keyName,Y="/keys/"+J+"/requestToken",$=function(et){return H.baseUri(et)+Y},tt=O.defaultPostHeaders();A.requestHeaders&&O.mixin(tt,A.requestHeaders),e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Y+"; Token params: "+JSON.stringify(F)),B.client.http.do(y.default.Post,H,$,tt,JSON.stringify(F),null,W)},I=!1,w=this.client.options.timeouts.realtimeRequestTimeout,_=setTimeout(function(){I=!0;var F="Token request callback timed out after "+w/1e3+" seconds";e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",F),N(new o.default(F,40170,401))},w);G(M,function(F,W,J){if(!I){if(clearTimeout(_),F){e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+O.inspectError(F)),N(d(F));return}if(typeof W=="string"){W.length===0?N(new o.default("Token string is empty",40170,401)):W.length>g?N(new o.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?N(new o.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?N(new o.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):N(null,{token:W});return}if(typeof W!="object"){var Y="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",Y),N(new o.default(Y,40170,401));return}var $=JSON.stringify(W).length;if($>g&&!A.suppressMaxLengthCheck){N(new o.default("Token request/details object exceeded max permitted stringified size (was "+$+" bytes)",40170,401));return}if("issued"in W){N(null,W);return}if(!("keyName"in W)){var Y="Expected token request callback to call back with a token string, token request object, or token details object";e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",Y),N(new o.default(Y,40170,401));return}L(W,function(tt,et,Q,nt){if(tt){e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+O.inspectError(tt)),N(d(tt));return}nt||(et=JSON.parse(et)),e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","token received"),N(null,et)})}})},D.prototype.createTokenRequest=function(M,A,E){var B=this;if(typeof M=="function"&&!E?(E=M,A=M=null):typeof A=="function"&&!E&&(E=A,A=null),!E&&this.client.options.promises)return O.promisify(this,"createTokenRequest",arguments);A=A||this.authOptions,M=M||O.copy(this.tokenParams);var N=A.key;if(!N){E(new o.default("No key specified",40101,403));return}var G=N.split(":"),H=G[0],k=G[1];if(!k){E(new o.default("Invalid key specified",40101,403));return}if(M.clientId===""){E(new o.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in M&&(M.capability=f(M.capability));var L=O.mixin({keyName:H},M),I=M.clientId||"",w=M.ttl||"",_=M.capability||"";(function(F){if(L.timestamp){F();return}B.getTimestamp(A&&A.queryTime,function(W,J){if(W){E(W);return}L.timestamp=J,F()})})(function(){var F=L.nonce||(L.nonce=S()),W=L.timestamp,J=L.keyName+`
`+w+`
`+_+`
`+I+`
`+W+`
`+F+`
`;L.mac=L.mac||n(J,k),e.default.logAction(e.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),E(null,L)})},D.prototype.getAuthParams=function(M){this.method=="basic"?M(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(A,E){if(A){M(A);return}if(!E)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");M(null,{access_token:E.token})})},D.prototype.getAuthHeaders=function(M){this.method=="basic"?M(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(A,E){if(A){M(A);return}if(!E)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");M(null,{authorization:"Bearer "+b(E.token)})})},D.prototype.getTimestamp=function(M,A){!this.isTimeOffsetSet()&&(M||this.authOptions.queryTime)?this.client.time(A):A(null,this.getTimestampUsingOffset())},D.prototype.getTimestampUsingOffset=function(){return O.now()+(this.client.serverTimeOffset||0)},D.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},D.prototype._saveBasicOptions=function(M){this.method="basic",this.key=M.key,this.basicKey=b(M.key),this.authOptions=M||{},"clientId"in M&&this._userSetClientId(M.clientId)},D.prototype._saveTokenOptions=function(M,A){this.method="token",M&&(this.tokenParams=M),A&&(A.token&&(A.tokenDetails=typeof A.token=="string"?{token:A.token}:A.token),A.tokenDetails&&(this.tokenDetails=A.tokenDetails),"clientId"in A&&this._userSetClientId(A.clientId),this.authOptions=A)},D.prototype._ensureValidAuthCredentials=function(M,A){var E=this,B=this.tokenDetails;if(B){if(this._tokenClientIdMismatch(B.clientId)){A(new o.default("Mismatch between clientId in token ("+B.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!B.expires||B.expires>=this.getTimestampUsingOffset()){e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+B.expires),A(null,B);return}e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=C.default.create())).push(A),!(this.currentTokenRequestId!==null&&!M)){var N=this.currentTokenRequestId=P();this.requestToken(this.tokenParams,this.authOptions,function(G,H){if(E.currentTokenRequestId>N){e.default.logAction(e.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}E.currentTokenRequestId=null;var k=E.waitingForTokenRequest||T;if(E.waitingForTokenRequest=null,G){k(G);return}k(null,E.tokenDetails=H)})}},D.prototype._userSetClientId=function(M){if(typeof M=="string"||M===null){if(M==="*")throw new o.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var A=this._uncheckedSetClientId(M);if(A)throw A}else throw new o.default("clientId must be either a string or null",40012,400)},D.prototype._uncheckedSetClientId=function(M){if(this._tokenClientIdMismatch(M)){var A="Unexpected clientId mismatch: client has "+this.clientId+", requested "+M,E=new o.default(A,40102,401);return e.default.logAction(e.default.LOG_ERROR,"Auth._uncheckedSetClientId()",A),E}else return this.clientId=this.tokenParams.clientId=M,null},D.prototype._tokenClientIdMismatch=function(M){return!!(this.clientId&&this.clientId!=="*"&&M&&M!=="*"&&this.clientId!==M)},D.isTokenErr=function(M){return M.code&&M.code>=40140&&M.code<40150},D}();u.default=U},function(x,u,t){"use strict";u.__esModule=!0;var l;(function(e){e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch"})(l||(l={})),u.default=l},function(x,u,t){"use strict";u.__esModule=!0,u.HttpPaginatedResponse=u.PaginatedResult=void 0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(3)),C=l.__importDefault(t(24));function o(g){var T=g.match(/^\.\/(\w+)\?(.*)$/);return T&&T[2]&&e.parseQueryString(T[2])}function c(g){typeof g=="string"&&(g=g.split(","));for(var T={},S=0;S<g.length;S++){var p=g[S].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){var d=o(p[1]);d&&(T[p[2]]=d)}}return T}function m(g,T,S){return!(S&&(T||typeof g.code=="number"))}var v=function(){function g(T,S,p,d,b,n){this.rest=T,this.path=S,this.headers=p,this.envelope=d!=null?d:null,this.bodyHandler=b,this.useHttpPaginatedResponse=n||!1}return g.prototype.get=function(T,S){var p=this;C.default.get(this.rest,this.path,this.headers,T,this.envelope,function(d,b,n,f,a){p.handlePage(d,b,n,f,a,S)})},g.prototype.delete=function(T,S){var p=this;C.default.delete(this.rest,this.path,this.headers,T,this.envelope,function(d,b,n,f,a){p.handlePage(d,b,n,f,a,S)})},g.prototype.post=function(T,S,p){var d=this;C.default.post(this.rest,this.path,S,this.headers,T,this.envelope,function(b,n,f,a,s){p&&d.handlePage(b,n,f,a,s,p)})},g.prototype.put=function(T,S,p){var d=this;C.default.put(this.rest,this.path,S,this.headers,T,this.envelope,function(b,n,f,a,s){p&&d.handlePage(b,n,f,a,s,p)})},g.prototype.patch=function(T,S,p){var d=this;C.default.patch(this.rest,this.path,S,this.headers,T,this.envelope,function(b,n,f,a,s){p&&d.handlePage(b,n,f,a,s,p)})},g.prototype.handlePage=function(T,S,p,d,b,n){if(T&&m(T,S,this.useHttpPaginatedResponse)){O.default.logAction(O.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+e.inspectError(T)),n==null||n(T);return}var f,a,s;try{f=this.bodyHandler(S,p||{},d)}catch(r){n==null||n(T||r);return}p&&(a=p.Link||p.link)&&(s=c(a)),this.useHttpPaginatedResponse?n(null,new i(this,f,p||{},b,s,T)):n(null,new y(this,f,s))},g}(),y=function(){function g(T,S,p){var d=this;this.resource=T,this.items=S;var b=this;p&&("first"in p&&(this.first=function(n){if(!n&&b.resource.rest.options.promises)return e.promisify(b,"first",[]);b.get(p.first,n)}),"current"in p&&(this.current=function(n){if(!n&&b.resource.rest.options.promises)return e.promisify(b,"current",[]);b.get(p.current,n)}),this.next=function(n){if(!n&&b.resource.rest.options.promises)return e.promisify(b,"next",[]);"next"in p?b.get(p.next,n):n(null)},this.hasNext=function(){return"next"in p},this.isLast=function(){var n;return!(!((n=d.hasNext)===null||n===void 0)&&n.call(d))})}return g.prototype.get=function(T,S){var p=this.resource;C.default.get(p.rest,p.path,p.headers,T,p.envelope,function(d,b,n,f,a){p.handlePage(d,b,n,f,a,S)})},g}();u.PaginatedResult=y;var i=function(g){l.__extends(T,g);function T(S,p,d,b,n,f){var a=g.call(this,S,p,n)||this;return a.statusCode=b,a.success=b<300&&b>=200,a.headers=d,a.errorCode=f&&f.code,a.errorMessage=f&&f.message,a}return T.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},T}(y);u.HttpPaginatedResponse=i,u.default=v},function(x,u,t){"use strict";u.__esModule=!0,u.isRetriable=void 0;var l=t(1),e=l.__importDefault(t(5)),O={disconnected:e.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:e.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:e.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:e.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:e.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:e.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:e.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function C(o){if(!o.statusCode||!o.code||o.statusCode>=500)return!0;var c=!1;return Object.values(O).forEach(function(m){m.code&&m.code==o.code&&(c=!0)}),c}u.isRetriable=C,u.default=O},function(x,u,t){"use strict";u.__esModule=!0;var l;(function(e){e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(l||(l={})),u.default=l},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(4),t(58),t(13),t(39),t(31),t(23),t(27),t(28),t(59),t(60))})(this,function(l){return l})},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(3)),O=function(){function C(o){this.members=o||[]}return C.prototype.call=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];for(var m=0,v=this.members;m<v.length;m++){var y=v[m];if(y)try{y.apply(void 0,o)}catch(i){e.default.logAction(e.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+i+"; stack = "+i.stack)}}},C.prototype.push=function(){for(var o,c=[],m=0;m<arguments.length;m++)c[m]=arguments[m];(o=this.members).push.apply(o,c)},C.create=function(o){var c=new C(o);return Object.assign(function(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];return c.call.apply(c,m)},{push:function(m){return c.push(m)}})},C}();u.default=O},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){(function(){var e=l,O=e.lib,C=O.Base,o=e.enc,c=o.Utf8,m=e.algo,v=m.HMAC=C.extend({init:function(y,i){y=this._hasher=new y.init,typeof i=="string"&&(i=c.parse(i));var g=y.blockSize,T=g*4;i.sigBytes>T&&(i=y.finalize(i)),i.clamp();for(var S=this._oKey=i.clone(),p=this._iKey=i.clone(),d=S.words,b=p.words,n=0;n<g;n++)d[n]^=1549556828,b[n]^=909522486;S.sigBytes=p.sigBytes=T,this.reset()},reset:function(){var y=this._hasher;y.reset(),y.update(this._iKey)},update:function(y){return this._hasher.update(y),this},finalize:function(y){var i=this._hasher,g=i.finalize(y);i.reset();var T=i.finalize(this._oKey.clone().concat(g));return T}})})()})},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(0)),O=l.__importStar(t(2)),C=l.__importDefault(t(3)),o=l.__importDefault(t(16)),c=l.__importDefault(t(17)),m=l.__importDefault(t(5));function v(p,d,b,n,f){p.http.supportsAuthHeaders?p.auth.getAuthHeaders(function(a,s){a?n(a):f(O.mixin(s,d),b)}):p.auth.getAuthParams(function(a,s){a?n(a):f(d,O.mixin(s,b))})}function y(p,d){return function(b,n,f,a,s){if(b&&!n){p(b);return}if(!a)try{n=O.decodeBody(n,d)}catch(D){p(D);return}if(!n){p(new m.default("unenvelope(): Response body is missing",null));return}var r=n,h=r.statusCode,R=r.response,P=r.headers;if(h===void 0){p(b,n,f,!0,s);return}if(h<200||h>=300){var U=R&&R.error||b;U||(U=new Error("Error in unenveloping "+n),U.statusCode=h),p(U,R,P,!0,h);return}p(b,R,P,!0,h)}}function i(p){var d=[];if(p)for(var b in p)d.push(b+"="+p[b]);return d.join("&")}function g(p,d){return p+(d?"?":"")+i(d)}function T(p,d,b,n){return function(f,a,s,r,h){f?C.default.logAction(C.default.LOG_MICRO,"Resource."+d+"()","Received Error; "+g(b,n)+"; Error: "+O.inspectError(f)):C.default.logAction(C.default.LOG_MICRO,"Resource."+d+"()","Received; "+g(b,n)+"; Headers: "+i(s)+"; StatusCode: "+h+"; Body: "+(e.default.BufferUtils.isBuffer(a)?a.toString():a)),p&&p(f,a,s,r,h)}}var S=function(){function p(){}return p.get=function(d,b,n,f,a,s){p.do(c.default.Get,d,b,null,n,f,a,s)},p.delete=function(d,b,n,f,a,s){p.do(c.default.Delete,d,b,null,n,f,a,s)},p.post=function(d,b,n,f,a,s,r){p.do(c.default.Post,d,b,n,f,a,s,r)},p.patch=function(d,b,n,f,a,s,r){p.do(c.default.Patch,d,b,n,f,a,s,r)},p.put=function(d,b,n,f,a,s,r){p.do(c.default.Put,d,b,n,f,a,s,r)},p.do=function(d,b,n,f,a,s,r,h){C.default.shouldLog(C.default.LOG_MICRO)&&(h=T(h,d,n,s)),r&&(h=h&&y(h,r),(s=s||{}).envelope=r);function R(P,U){var D;if(C.default.shouldLog(C.default.LOG_MICRO)&&C.default.logAction(C.default.LOG_MICRO,"Resource."+d+"()","Sending; "+g(n,U)),C.default.shouldLog(C.default.LOG_MICRO)){var M=f;if(((D=P["content-type"])===null||D===void 0?void 0:D.indexOf("msgpack"))>0)try{M=e.default.Config.msgpack.decode(f)}catch(A){C.default.logAction(C.default.LOG_MICRO,"Resource."+d+"()","Sending MsgPack Decoding Error: "+O.inspectError(A))}C.default.logAction(C.default.LOG_MICRO,"Resource."+d+"()","Sending; "+g(n,U)+"; Body: "+M)}b.http.do(d,b,n,P,f,U,function(A,E,B,N,G){if(A&&o.default.isTokenErr(A)){b.auth.authorize(null,null,function(H){if(H){h(H);return}v(b,B,U,h,R)});return}h(A,E,B,N,G)})}v(b,a,s,h,R)},p}();u.default=S},function(x,u,t){"use strict";(function(l){u.__esModule=!0,u.TransportParams=void 0;var e=t(1),O=e.__importDefault(t(10)),C=e.__importStar(t(2)),o=e.__importStar(t(51)),c=e.__importDefault(t(8)),m=e.__importDefault(t(0)),v=e.__importDefault(t(7)),y=e.__importDefault(t(35)),i=e.__importDefault(t(3)),g=e.__importDefault(t(36)),T=e.__importStar(t(19)),S=e.__importDefault(t(5)),p=e.__importDefault(t(16)),d=e.__importDefault(t(9)),b=e.__importDefault(t(22)),n=e.__importDefault(t(52)),f=e.__importDefault(t(26)),a=e.__importDefault(t(53)),s=function(){var H;return typeof m.default.WebStorage!="undefined"&&((H=m.default.WebStorage)===null||H===void 0?void 0:H.localSupported)},r=function(){var H;return typeof m.default.WebStorage!="undefined"&&((H=m.default.WebStorage)===null||H===void 0?void 0:H.sessionSupported)},h=O.default.Action,R=function(){},P="ably-transport-preference",U="ably-connection-recovery";function D(){var H,k;return r()&&((k=(H=m.default.WebStorage)===null||H===void 0?void 0:H.getSession)===null||k===void 0?void 0:k.call(H,U))}function M(H){var k,L;return r()&&((L=(k=m.default.WebStorage)===null||k===void 0?void 0:k.setSession)===null||L===void 0?void 0:L.call(k,U,H))}function A(){var H,k;return r()&&((k=(H=m.default.WebStorage)===null||H===void 0?void 0:H.removeSession)===null||k===void 0?void 0:k.call(H,U))}function E(H,k){return C.arrIndexOf(m.default.Defaults.transportPreferenceOrder,H.shortName)>C.arrIndexOf(m.default.Defaults.transportPreferenceOrder,k.shortName)}function B(H,k,L){var I;if(H.channel!==k.channel||(I=H.action)!==h.PRESENCE&&I!==h.MESSAGE||I!==k.action)return!1;var w=I===h.PRESENCE?"presence":"messages",_=H[w].concat(k[w]),F=d.default.getMessagesSize(_);return F>L||!C.allSame(_,"clientId")||!C.arrEvery(_,function(W){return!W.id})?!1:(H[w]=_,!0)}var N=function(){function H(k,L,I,w){this.options=k,this.host=L,this.mode=I,this.connectionKey=w,this.format=k.useBinaryProtocol?C.Format.msgpack:C.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return H.prototype.getConnectParams=function(k){var L=k?C.copy(k):{},I=this.options;switch(this.mode){case"upgrade":L.upgrade=this.connectionKey;break;case"resume":L.resume=this.connectionKey,this.timeSerial!==void 0?L.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(L.connectionSerial=this.connectionSerial);break;case"recover":{var w=I.recover.split(":");if(w){L.recover=w[0];var _=w[1];isNaN(Number(_))?L.timeSerial=_:L.connectionSerial=_}break}default:}return I.clientId!==void 0&&(L.clientId=I.clientId),I.echoMessages===!1&&(L.echo="false"),this.format!==void 0&&(L.format=this.format),this.stream!==void 0&&(L.stream=this.stream),this.heartbeats!==void 0&&(L.heartbeats=this.heartbeats),L.v=c.default.apiVersion,L.agent=encodeURIComponent(c.default.agent),I.transportParams!==void 0&&C.mixin(L,I.transportParams),L},H.prototype.toString=function(){var k="[mode="+this.mode;return this.host&&(k+=",host="+this.host),this.connectionKey&&(k+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(k+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(k+=",timeSerial="+this.timeSerial),this.format&&(k+=",format="+this.format),k+="]",k},H}();u.TransportParams=N;var G=function(H){e.__extends(k,H);function k(L,I){var w=H.call(this)||this;w.disconnectedRetryCount=0,k.initTransports(),w.realtime=L,w.options=I;var _=I.timeouts,F=_.preferenceConnectTimeout+_.realtimeRequestTimeout;if(w.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:F,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:_.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:_.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:_.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},w.state=w.states.initialized,w.errorReason=null,w.queuedMessages=new y.default,w.msgSerial=0,w.connectionDetails=void 0,w.connectionId=void 0,w.connectionKey=void 0,w.timeSerial=void 0,w.connectionSerial=void 0,w.connectionStateTtl=_.connectionStateTtl,w.maxIdleInterval=null,w.transports=C.intersect(I.transports||c.default.defaultTransports,k.supportedTransports),w.baseTransport=C.intersect(c.default.baseTransportOrder,w.transports)[0],w.upgradeTransports=C.intersect(w.transports,c.default.upgradeTransports),w.transportPreference=null,w.httpHosts=c.default.getHosts(I),w.activeProtocol=null,w.proposedTransports=[],w.pendingTransports=[],w.host=null,w.lastAutoReconnectAttempt=null,w.lastActivity=null,w.mostRecentMsg=null,w.forceFallbackHost=!1,w.connectCounter=0,i.default.logAction(i.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),i.default.logAction(i.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(I.transports||c.default.defaultTransports)+"]"),i.default.logAction(i.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+w.transports+"]"),i.default.logAction(i.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+w.httpHosts+"]"),!w.transports.length){var W="no requested transports available";throw i.default.logAction(i.default.LOG_ERROR,"realtime.ConnectionManager()",W),new Error(W)}var J=m.default.Config.addEventListener;return J&&(r()&&typeof I.recover=="function"&&J("beforeunload",w.persistConnection.bind(w)),I.closeOnUnload===!0&&J("beforeunload",function(){i.default.logAction(i.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),w.requestState({state:"closing"})}),J("online",function(){(w.state==w.states.disconnected||w.state==w.states.suspended)&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),w.requestState({state:"connecting"}))}),J("offline",function(){w.state==w.states.connected&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),w.disconnectAllTransports())})),w}return k.initTransports=function(){n.default(k),C.arrForEach(m.default.Transports,function(L){L(k)})},k.prototype.createTransportParams=function(L,I){var w=new N(this.options,L,I,this.connectionKey);return this.timeSerial?w.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(w.connectionSerial=this.connectionSerial),w},k.prototype.getTransportParams=function(L){var I=this,w=function(_){if(I.connectionKey){_("resume");return}if(typeof I.options.recover=="string"){_("recover");return}var F=I.options.recover,W=D();if(W&&typeof F=="function"){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),F(W,function(J){J?(I.options.recover=W.recoveryKey,_("recover")):_("clean")});return}_("clean")};w(function(_){var F=I.createTransportParams(null,_);if(_==="recover"){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+I.options.recover);var W=I.options.recover.split(":");W&&W[2]&&(I.msgSerial=Number(W[2]))}else i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+F.toString());L(F)})},k.prototype.tryATransport=function(L,I,w){var _=this;i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+I),f.default.tryConnect(k.supportedTransports[I],this,this.realtime.auth,L,function(F,W){var J=_.state;if(J==_.states.closing||J==_.states.closed||J==_.states.failed){W&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+J.state+" while we were attempting the transport; closing "+W),W.close()),w(!0);return}if(F){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+I+" "+F.event+", err: "+F.error.toString()),p.default.isTokenErr(F.error)&&!(_.errorReason&&p.default.isTokenErr(_.errorReason))?(_.errorReason=F.error,_.realtime.auth._forceNewToken(null,null,function(Y){if(Y){_.actOnErrorFromAuthorize(Y);return}_.tryATransport(L,I,w)})):F.event==="failed"?(_.notifyState({state:"failed",error:F.error}),w(!0)):F.event==="disconnected"&&(T.isRetriable(F.error)?w(!1):(_.notifyState({state:_.states.connecting.failState,error:F.error}),w(!0)));return}i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+I+"; setting pending"),_.setTransportPending(W,L),w(null,W)})},k.prototype.setTransportPending=function(L,I){var w=this,_=I.mode;i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+L+"; mode = "+_),C.arrDeleteValue(this.proposedTransports,L),this.pendingTransports.push(L);var F=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];L.once("connected",function(J,Y,$,tt){_=="upgrade"?L.shortName!==F&&C.arrIn(w.getUpgradePossibilities(),F)&&w.activeProtocol?setTimeout(function(){w.scheduleTransportActivation(J,L,Y,$,tt)},w.options.timeouts.parallelUpgradeDelay):w.scheduleTransportActivation(J,L,Y,$,tt):(w.activateTransport(J,L,Y,$,tt),m.default.Config.nextTick(function(){w.connectImpl(I)})),_==="recover"&&w.options.recover&&(w.options.recover=null,w.unpersistConnection())});var W=this;L.on(["disconnected","closed","failed"],function(J){W.deactivateTransport(L,this.event,J)}),this.emit("transport.pending",L)},k.prototype.scheduleTransportActivation=function(L,I,w,_,F){var W=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Y=function(){I.disconnect(),C.arrDeleteValue(W.pendingTransports,I)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+I.shortName),Y();return}if(J&&!E(I,J)){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+I.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Y();return}i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+I);var $=function(tt){var et;if(tt){i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+I+"; err = "+tt);return}if(!I.isConnected){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+I.shortName+"is no longer connected; abandoning upgrade"),Y();return}if(W.state===W.states.connected)i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),W.state=W.states.synchronizing,et=W.activeProtocol;else if(W.state!==W.states.connecting){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+W.state.state+(W.state===W.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+I.shortName),Y();return}var Q=w!==W.connectionId,nt=Q?F:W;Q&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(W.timeSerial||W.connectionSerial)+" to "+(nt.timeSerial||nt.connectionSerial)+"; upgrade error was "+L),i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+I),W.sync(I,nt,function(st,at,rt){if(st){W.state===W.states.synchronizing&&(i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+I+"; err = "+st),W.disconnectAllTransports());return}var ft=function(){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+I),W.activateTransport(L,I,at,_,rt),W.state===W.states.synchronizing?(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+I),W.state=W.states.connected):i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};et?et.onceIdle(ft):ft()})};J?this.realtime.channels.onceNopending($):$()},k.prototype.activateTransport=function(L,I,w,_,F){var W=this;i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+I),L&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+L),w&&i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+w),_&&i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(_)),F&&i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(F.timeSerial||F.connectionSerial)),this.persistTransportPreference(I);var J=this.state,Y=this.states.connected.state;if(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),I.disconnect(),!1;if(C.arrDeleteValue(this.pendingTransports,I),!I.isConnected)return i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+I+" since it appears to no longer be connected"),!1;var $=this.activeProtocol;this.activeProtocol=new o.default(I),this.host=I.params.host;var tt=_.connectionKey;if(tt&&this.connectionKey!=tt&&this.setConnection(w,_,F,!!L),this.onConnectionDetailsUpdate(_,I),m.default.Config.nextTick(function(){I.on("connected",function(Q,nt,st){W.onConnectionDetailsUpdate(st,I),W.emit("update",new g.default(Y,Y,null,Q))})}),J.state===this.states.connected.state?L&&(this.errorReason=this.realtime.connection.errorReason=L,this.emit("update",new g.default(Y,Y,null,L))):(this.notifyState({state:"connected",error:L}),this.errorReason=this.realtime.connection.errorReason=L||null),this.emit("transport.active",I),$)if($.messageQueue.count()>0&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+$.transport.shortName+", new one is "+I.shortName+") finishing with "+$.messageQueue.count()+" messages still pending"),$.transport===I){var et="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+I.shortName+"; stack = "+new Error().stack;i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.activateTransport()",et)}else $.finish();return C.safeArrForEach(this.pendingTransports,function(Q){if(Q===I){var nt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+I.shortName+"; stack = "+new Error().stack;i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.activateTransport()",nt),C.arrDeleteValue(W.pendingTransports,I)}else Q.disconnect()}),C.safeArrForEach(this.proposedTransports,function(Q){Q===I?(i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+I.shortName+"; stack = "+new Error().stack),C.arrDeleteValue(W.proposedTransports,I)):Q.dispose()}),!0},k.prototype.deactivateTransport=function(L,I,w){var _=this.activeProtocol,F=_&&_.getTransport()===L,W=C.arrDeleteValue(this.pendingTransports,L),J=C.arrDeleteValue(this.proposedTransports,L),Y=this.noTransportsScheduledForActivation();if(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+L),i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+I+(F?"; was active":W?"; was pending":J?"; was proposed":"")+(Y?"":"; another transport is scheduled for activation")),w&&w.message&&i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+w.message),F&&(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(_.getPendingMessages()),m.default.Config.nextTick(function(){_.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",L),F&&Y||F&&I==="failed"||I==="closed"||_===null&&W&&this.pendingTransports.length===0){if(I==="disconnected"&&w&&w.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:I,error:w,retryImmediately:!0});return}var $=I==="failed"&&p.default.isTokenErr(w)?"disconnected":I;this.notifyState({state:$,error:w});return}F&&I==="disconnected"&&this.state!==this.states.synchronizing&&(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:w}))},k.prototype.noTransportsScheduledForActivation=function(){return C.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(L){return!L.isConnected})},k.prototype.sync=function(L,I,w){var _=setTimeout(function(){L.off("sync"),w(new S.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),F=O.default.fromValues({action:h.SYNC,connectionKey:this.connectionKey});I.timeSerial?F.timeSerial=I.timeSerial:I.connectionSerial!==void 0&&(F.connectionSerial=I.connectionSerial),L.send(F),L.once("sync",function(W,J){clearTimeout(_),w(null,W,J)})},k.prototype.setConnection=function(L,I,w,_){var F=this,W=this.connectionId,J=W&&W!==L,Y=!W&&_;(J||Y)&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==L?(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),m.default.Config.nextTick(function(){F.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){F.realtime.channels.checkAttachedMsgIndicators(L)},3e4)),this.realtime.connection.id=this.connectionId=L,this.realtime.connection.key=this.connectionKey=I.connectionKey;var $=J||!W;this.setConnectionSerial(w,$,!1)},k.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},k.prototype.setConnectionSerial=function(L,I,w){var _=L.timeSerial,F=L.connectionSerial;if(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+F+"; timeSerial = "+_+"; force = "+I+"; previous = "+this.connectionSerial),_!==void 0){if(_<=this.timeSerial&&!I)return w&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+_+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=_,this.setRecoveryKey();return}if(F!==void 0){if(F<=this.connectionSerial&&!I)return w&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+F+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=F,this.setRecoveryKey()}},k.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},k.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},k.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},k.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var L=C.now()-this.lastActivity;L>this.connectionStateTtl+this.maxIdleInterval&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+L+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},k.prototype.persistConnection=function(){if(r()){var L=this.realtime.connection.recoveryKey;L&&M({recoveryKey:L,disconnectedAt:C.now(),location:l.location,clientId:this.realtime.auth.clientId})}},k.prototype.unpersistConnection=function(){A()},k.prototype.getError=function(){return this.errorReason||this.getStateError()},k.prototype.getStateError=function(){return T.default[this.state.state]},k.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},k.prototype.enactStateChange=function(L){var I=L.current==="failed"?i.default.LOG_ERROR:i.default.LOG_MAJOR;i.default.logAction(I,"Connection state",L.current+(L.reason?"; reason: "+L.reason:"")),i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+L.current+"; reason = "+(L.reason&&L.reason.message));var w=this.state=this.states[L.current];L.reason&&(this.errorReason=L.reason,this.realtime.connection.errorReason=L.reason),(w.terminal||w.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",L)},k.prototype.startTransitionTimer=function(L){var I=this;i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+L.state),this.transitionTimer&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){I.transitionTimer&&(I.transitionTimer=null,i.default.logAction(i.default.LOG_MINOR,"ConnectionManager "+L.state+" timer expired","requesting new state: "+L.failState),I.notifyState({state:L.failState}))},L.retryDelay)},k.prototype.cancelTransitionTimer=function(){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},k.prototype.startSuspendTimer=function(){var L=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){L.suspendTimer&&(L.suspendTimer=null,i.default.logAction(i.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),L.states.connecting.failState="suspended",L.notifyState({state:"suspended"}))},this.connectionStateTtl))},k.prototype.checkSuspendTimer=function(L){L!=="disconnected"&&L!=="suspended"&&L!=="connecting"&&this.cancelSuspendTimer()},k.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},k.prototype.startRetryTimer=function(L){var I=this;this.retryTimer=setTimeout(function(){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),I.retryTimer=null,I.requestState({state:"connecting"})},L)},k.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},k.prototype.notifyState=function(L){var I=this,w=L.state,_=w==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||L.retryImmediately||this.state===this.states.connecting&&L.error&&p.default.isTokenErr(L.error)&&!(this.errorReason&&p.default.isTokenErr(this.errorReason)));if(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+w+(_?"; will retry connection immediately":"")),w!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(L.state),(w==="suspended"||w==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var F=this.states[L.state],W=F.retryDelay;F.state==="disconnected"&&(this.disconnectedRetryCount++,W=F.retryDelay*C.getBackoffCoefficient(this.disconnectedRetryCount)*C.getJitterCoefficient());var J=new g.default(this.state.state,F.state,W,L.error||T.default[F.state]);if(_){var Y=function(){I.state===I.states.disconnected&&(I.lastAutoReconnectAttempt=C.now(),I.requestState({state:"connecting"}))},$=this.lastAutoReconnectAttempt&&C.now()-this.lastAutoReconnectAttempt+1;$&&$<1e3?(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+$+"ms ago, waiting another "+(1e3-$)+"ms before trying again"),setTimeout(Y,1e3-$)):m.default.Config.nextTick(Y)}else(w==="disconnected"||w==="suspended")&&this.startRetryTimer(W);(w==="disconnected"&&!_||w==="suspended"||F.terminal)&&m.default.Config.nextTick(function(){I.disconnectAllTransports()}),w=="connected"&&!this.activeProtocol&&i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(J),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(w,J.reason),this.failQueuedMessages(J.reason))}},k.prototype.requestState=function(L){var I=this,w=L.state;if(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+w+"; current state: "+this.state.state),w!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(w),!(w=="connecting"&&this.state.state=="connected")&&!(w=="closing"&&this.state.state=="closed"))){var _=this.states[w],F=new g.default(this.state.state,_.state,null,L.error||T.default[_.state]);this.enactStateChange(F),w=="connecting"&&m.default.Config.nextTick(function(){I.startConnect()}),w=="closing"&&this.closeImpl()}},k.prototype.startConnect=function(){var L=this;if(this.state!==this.states.connecting){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var I=this.realtime.auth,w=++this.connectCounter,_=function(){L.checkConnectionStateFreshness(),L.getTransportParams(function(W){w===L.connectCounter&&L.connectImpl(W,w)})};if(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),I.method==="basic")_();else{var F=function(W){w===L.connectCounter&&(W?L.actOnErrorFromAuthorize(W):_())};this.errorReason&&p.default.isTokenErr(this.errorReason)?I._forceNewToken(null,null,F):I._ensureValidAuthCredentials(!1,F)}},k.prototype.connectImpl=function(L,I){var w=this.state.state;w!==this.states.connecting.state&&w!==this.states.connected.state?i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+w):this.pendingTransports.length?i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):w==this.states.connected.state?this.upgradeIfNeeded(L):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(L):this.connectBase(L,I)},k.prototype.connectPreference=function(L){var I=this,w=this.getTransportPreference(),_=!1;C.arrIn(this.transports,w)||(this.unpersistTransportPreference(),this.connectImpl(L)),i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+w);var F=setTimeout(function(){_=!0,I.state.state!==I.states.connected.state&&(i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+w+" failed; clearing preference and trying from scratch"),I.disconnectAllTransports(),I.unpersistTransportPreference()),I.connectImpl(L)},this.options.timeouts.preferenceConnectTimeout);L.host=this.httpHosts[0],this.tryATransport(L,w,function(W,J){clearTimeout(F),_&&J?(J.off(),J.disconnect(),C.arrDeleteValue(I.pendingTransports,J)):!J&&!W&&(I.unpersistTransportPreference(),I.connectImpl(L))})},k.prototype.connectBase=function(L,I){var w=this,_=function($){w.notifyState({state:w.states.connecting.failState,error:$})},F=this.httpHosts.slice(),W=function($,tt){I===w.connectCounter&&!tt&&!$&&Y()};i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var J=F.shift();if(!J){_(new S.default("Unable to connect (no available host)",80003,404));return}L.host=J;var Y=function(){if(!F.length){_(new S.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!w.realtime.http.checkConnectivity){_(new S.default("Internal error: Http.checkConnectivity not set",null,500));return}w.realtime.http.checkConnectivity(function($,tt){if(I===w.connectCounter){if($){_($);return}if(!tt){_(new S.default("Unable to connect (network unreachable)",80003,404));return}L.host=C.arrPopRandomElement(F),w.tryATransport(L,w.baseTransport,W)}})};if(this.forceFallbackHost&&F.length){this.forceFallbackHost=!1,Y();return}this.tryATransport(L,this.baseTransport,W)},k.prototype.getUpgradePossibilities=function(){var L=this.activeProtocol.getTransport().shortName,I=C.arrIndexOf(this.upgradeTransports,L);return this.upgradeTransports.slice(I+1)},k.prototype.upgradeIfNeeded=function(L){var I=this,w=this.getUpgradePossibilities();i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(w)),w.length&&C.arrForEach(w,function(_){var F=I.createTransportParams(L.host,"upgrade");I.tryATransport(F,_,R)})},k.prototype.closeImpl=function(){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),C.safeArrForEach(this.pendingTransports,function(L){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+L),L&&L.close()}),C.safeArrForEach(this.proposedTransports,function(L){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+L),L&&L.dispose()}),this.activeProtocol&&(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},k.prototype.onAuthUpdated=function(L,I){var w=this,_;switch(this.state.state){case"connected":{if(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var F=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){w.state.state==="connected"&&w.upgradeIfNeeded(F)})}var W=(_=this.activeProtocol)===null||_===void 0?void 0:_.getTransport();W&&W.onAuthUpdated&&W.onAuthUpdated(L);var J=O.default.fromValues({action:h.AUTH,auth:{accessToken:L.token}});this.send(J);var Y=function(){w.off($),I(null,L)},$=function(et){et.current==="failed"&&(w.off(Y),w.off($),I(et.reason||w.getStateError()))};this.once("connectiondetails",Y),this.on("connectionstate",$);break}case"connecting":i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var tt=function(et){switch(et.current){case"connected":w.off(tt),I(null,L);break;case"failed":case"closed":case"suspended":w.off(tt),I(et.reason||w.getStateError());break;default:break}};this.on("connectionstate",tt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},k.prototype.disconnectAllTransports=function(L){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(L?" except the active transport":"")),this.connectCounter++,C.safeArrForEach(this.pendingTransports,function(I){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+I),I&&I.disconnect()}),this.pendingTransports=[],C.safeArrForEach(this.proposedTransports,function(I){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+I),I&&I.dispose()}),this.proposedTransports=[],this.activeProtocol&&!L&&(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},k.prototype.send=function(L,I,w){w=w||R;var _=this.state;if(_.sendEvents){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new o.PendingMessage(L,w));return}var F=I&&_.queueEvents||_.forceQueueEvents;if(!F){var W="rejecting event, queueEvent was "+I+", state was "+_.state;i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.send()",W),w(this.errorReason||new S.default(W,9e4,400));return}i.default.shouldLog(i.default.LOG_MICRO)&&i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+O.default.stringify(L)),this.queue(L,w)},k.prototype.sendImpl=function(L){var I=L.message;L.ackRequired&&!L.sendAttempted&&(I.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(L)}catch(w){i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+w.stack)}},k.prototype.queue=function(L,I){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var w=this.queuedMessages.last(),_=this.options.maxMessageSize;w&&!w.sendAttempted&&B(w.message,L,_)?(w.merged||(w.callback=b.default.create([w.callback]),w.merged=!0),w.callback.push(I)):this.queuedMessages.push(new o.PendingMessage(L,I))},k.prototype.sendQueuedMessages=function(){i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var L;L=this.queuedMessages.shift();)this.sendImpl(L)},k.prototype.queuePendingMessages=function(L){L&&L.length&&(i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+L.length+" pending messages"),this.queuedMessages.prepend(L))},k.prototype.failQueuedMessages=function(L){var I=this.queuedMessages.count();I>0&&(i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+I+" queued messages, err = "+C.inspectError(L)),this.queuedMessages.completeAllMessages(L))},k.prototype.onChannelMessage=function(L,I){var w=this.activeProtocol&&I===this.activeProtocol.getTransport(),_=C.arrIn(this.pendingTransports,I)&&this.state==this.states.synchronizing,F=L.action===h.MESSAGE||L.action===h.PRESENCE;if(w||_){if(F){var W=this.setConnectionSerial(L,!1,!0);if(W)return;if(O.default.isDuplicate(L,this.mostRecentMsg)){i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+L.id);return}this.mostRecentMsg=L}this.realtime.channels.onChannelMessage(L)}else C.arrIndexOf([h.ACK,h.NACK,h.ERROR],L.action)>-1?this.realtime.channels.onChannelMessage(L):i.default.logAction(i.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(L)+"on defunct transport; discarding")},k.prototype.ping=function(L,I){var w=this;if(L){i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+L);var _=function(){L.off("heartbeat",J),I(new S.default("Timeout waiting for heartbeat response",5e4,500))},F=C.now(),W=C.cheapRandStr(),J=function(Q){if(Q===W){L.off("heartbeat",J),clearTimeout(Y);var nt=C.now()-F;I(null,nt)}},Y=setTimeout(_,this.options.timeouts.realtimeRequestTimeout);L.on("heartbeat",J),L.ping(W);return}if(this.state.state!=="connected"){I(new S.default("Unable to ping service; not connected",4e4,400));return}var $=!1,tt=function(Q,nt){w.off("transport.active",et),$||($=!0,I(Q,nt))},et=function(){$||($=!0,m.default.Config.nextTick(function(){w.ping(null,I)}))};this.on("transport.active",et),this.ping(this.activeProtocol.getTransport(),tt)},k.prototype.abort=function(L){this.activeProtocol.getTransport().fail(L)},k.prototype.registerProposedTransport=function(L){this.proposedTransports.push(L)},k.prototype.getTransportPreference=function(){var L,I;return this.transportPreference||s()&&((I=(L=m.default.WebStorage)===null||L===void 0?void 0:L.get)===null||I===void 0?void 0:I.call(L,P))},k.prototype.persistTransportPreference=function(L){var I,w;C.arrIn(c.default.upgradeTransports,L.shortName)&&(this.transportPreference=L.shortName,s()&&((w=(I=m.default.WebStorage)===null||I===void 0?void 0:I.set)===null||w===void 0||w.call(I,P,L.shortName)))},k.prototype.unpersistTransportPreference=function(){var L,I;this.transportPreference=null,s()&&((I=(L=m.default.WebStorage)===null||L===void 0?void 0:L.remove)===null||I===void 0||I.call(L,P))},k.prototype.actOnErrorFromAuthorize=function(L){if(L.code===40171)this.notifyState({state:"failed",error:L});else if(L.statusCode===a.default.Forbidden){var I="Client configured authentication provider returned 403; failing the connection";i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",I),this.notifyState({state:"failed",error:new S.default(I,80019,403,L)})}else{var I="Client configured authentication provider request failed";i.default.logAction(i.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",I),this.notifyState({state:this.state.failState,error:new S.default(I,80019,401,L)})}},k.prototype.onConnectionDetailsUpdate=function(L,I){if(!!L){this.connectionDetails=L,L.maxMessageSize&&(this.options.maxMessageSize=L.maxMessageSize);var w=L.clientId;if(w){var _=this.realtime.auth._uncheckedSetClientId(w);if(_){i.default.logAction(i.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",_.message),I.fail(_);return}}var F=L.connectionStateTtl;F&&(this.connectionStateTtl=F),this.maxIdleInterval=L.maxIdleInterval,this.emit("connectiondetails",L)}},k.supportedTransports={},k}(v.default);u.default=G}).call(this,t(12))},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(10)),O=l.__importStar(t(2)),C=l.__importDefault(t(7)),o=l.__importDefault(t(3)),c=l.__importDefault(t(19)),m=l.__importDefault(t(5)),v=l.__importDefault(t(0)),y=e.default.Action,i=e.default.fromValues({action:y.CLOSE}),g=e.default.fromValues({action:y.DISCONNECT}),T=function(S){l.__extends(p,S);function p(d,b,n,f){var a=S.call(this)||this;return f&&(n.format=void 0,n.heartbeats=!0),a.connectionManager=d,d.registerProposedTransport(a),a.auth=b,a.params=n,a.timeouts=n.options.timeouts,a.format=n.format,a.isConnected=!1,a.isFinished=!1,a.isDisposed=!1,a.maxIdleInterval=null,a.idleTimer=null,a.lastActivity=null,a}return p.prototype.connect=function(){},p.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",c.default.closed)},p.prototype.disconnect=function(d){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",d||c.default.disconnected)},p.prototype.fail=function(d){this.isConnected&&this.requestDisconnect(),this.finish("failed",d||c.default.failed)},p.prototype.finish=function(d,b){var n;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((n=this.idleTimer)!==null&&n!==void 0?n:void 0),this.idleTimer=null,this.emit(d,b),this.dispose())},p.prototype.onProtocolMessage=function(d){switch(o.default.shouldLog(o.default.LOG_MICRO)&&o.default.logAction(o.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+e.default.stringify(d)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),d.action){case y.HEARTBEAT:o.default.logAction(o.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",d.id);break;case y.CONNECTED:this.onConnect(d),this.emit("connected",d.error,d.connectionId,d.connectionDetails,d);break;case y.CLOSED:this.onClose(d);break;case y.DISCONNECTED:this.onDisconnect(d);break;case y.ACK:this.emit("ack",d.msgSerial,d.count);break;case y.NACK:this.emit("nack",d.msgSerial,d.count,d.error);break;case y.SYNC:if(d.connectionId!==void 0){this.emit("sync",d.connectionId,d);break}this.connectionManager.onChannelMessage(d,this);break;case y.AUTH:this.auth.authorize(function(b){b&&o.default.logAction(o.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+O.inspectError(b))});break;case y.ERROR:if(o.default.logAction(o.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+v.default.Config.inspect(d.error)+(d.channel?", channel: "+d.channel:"")),d.channel===void 0){this.onFatalError(d);break}this.connectionManager.onChannelMessage(d,this);break;default:this.connectionManager.onChannelMessage(d,this)}},p.prototype.onConnect=function(d){if(this.isConnected=!0,!d.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var b=d.connectionDetails.maxIdleInterval;b&&(this.maxIdleInterval=b+this.timeouts.realtimeRequestTimeout,this.onActivity())},p.prototype.onDisconnect=function(d){var b=d&&d.error;o.default.logAction(o.default.LOG_MINOR,"Transport.onDisconnect()","err = "+O.inspectError(b)),this.finish("disconnected",b)},p.prototype.onFatalError=function(d){var b=d&&d.error;o.default.logAction(o.default.LOG_MINOR,"Transport.onFatalError()","err = "+O.inspectError(b)),this.finish("failed",b)},p.prototype.onClose=function(d){var b=d&&d.error;o.default.logAction(o.default.LOG_MINOR,"Transport.onClose()","err = "+O.inspectError(b)),this.finish("closed",b)},p.prototype.requestClose=function(){o.default.logAction(o.default.LOG_MINOR,"Transport.requestClose()",""),this.send(i)},p.prototype.requestDisconnect=function(){o.default.logAction(o.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(g)},p.prototype.ping=function(d){var b={action:e.default.Action.HEARTBEAT};d&&(b.id=d),this.send(e.default.fromValues(b))},p.prototype.dispose=function(){o.default.logAction(o.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},p.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=O.now(),this.setIdleTimer(this.maxIdleInterval+100))},p.prototype.setIdleTimer=function(d){var b=this;this.idleTimer||(this.idleTimer=setTimeout(function(){b.onIdleTimerExpire()},d))},p.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var d=O.now()-this.lastActivity,b=this.maxIdleInterval-d;if(b<=0){var n="No activity seen from realtime in "+d+"ms; assuming connection has dropped";o.default.logAction(o.default.LOG_ERROR,"Transport.onIdleTimerExpire()",n),this.disconnect(new m.default(n,80003,408))}else this.setIdleTimer(b+100)},p.tryConnect=function(d,b,n,f,a){var s=new d(b,n,f),r,h=function(P){clearTimeout(r),a({event:this.event,error:P})},R=b.options.timeouts.realtimeRequestTimeout;r=setTimeout(function(){s.off(["preconnect","disconnected","failed"]),s.dispose(),h.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},R),s.on(["failed","disconnected"],h),s.on("preconnect",function(){o.default.logAction(o.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+s),clearTimeout(r),s.off(["failed","disconnected"],h),a(null,s)}),s.connect()},p}(C.default);u.default=T},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(39),t(23))})(this,function(l){return function(){var e=l,O=e.lib,C=O.Base,o=O.WordArray,c=e.algo,m=c.MD5,v=c.EvpKDF=C.extend({cfg:C.extend({keySize:128/32,hasher:m,iterations:1}),init:function(y){this.cfg=this.cfg.extend(y)},compute:function(y,i){for(var g,T=this.cfg,S=T.hasher.create(),p=o.create(),d=p.words,b=T.keySize,n=T.iterations;d.length<b;){g&&S.update(g),g=S.update(y).finalize(i),S.reset();for(var f=1;f<n;f++)g=S.finalize(g),S.reset();p.concat(g)}return p.sigBytes=b*4,p}});e.EvpKDF=function(y,i,g){return v.create(g).compute(y,i)}}(),l.EvpKDF})},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(27))})(this,function(l){l.lib.Cipher||function(e){var O=l,C=O.lib,o=C.Base,c=C.WordArray,m=C.BufferedBlockAlgorithm,v=O.enc,y=v.Utf8,i=v.Base64,g=O.algo,T=g.EvpKDF,S=C.Cipher=m.extend({cfg:o.extend(),createEncryptor:function(A,E){return this.create(this._ENC_XFORM_MODE,A,E)},createDecryptor:function(A,E){return this.create(this._DEC_XFORM_MODE,A,E)},init:function(A,E,B){this.cfg=this.cfg.extend(B),this._xformMode=A,this._key=E,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(A){return this._append(A),this._process()},finalize:function(A){A&&this._append(A);var E=this._doFinalize();return E},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function A(E){return typeof E=="string"?M:P}return function(E){return{encrypt:function(B,N,G){return A(N).encrypt(E,B,N,G)},decrypt:function(B,N,G){return A(N).decrypt(E,B,N,G)}}}}()}),p=C.StreamCipher=S.extend({_doFinalize:function(){var A=this._process(!0);return A},blockSize:1}),d=O.mode={},b=C.BlockCipherMode=o.extend({createEncryptor:function(A,E){return this.Encryptor.create(A,E)},createDecryptor:function(A,E){return this.Decryptor.create(A,E)},init:function(A,E){this._cipher=A,this._iv=E}}),n=d.CBC=function(){var A=b.extend();A.Encryptor=A.extend({processBlock:function(B,N){var G=this._cipher,H=G.blockSize;E.call(this,B,N,H),G.encryptBlock(B,N),this._prevBlock=B.slice(N,N+H)}}),A.Decryptor=A.extend({processBlock:function(B,N){var G=this._cipher,H=G.blockSize,k=B.slice(N,N+H);G.decryptBlock(B,N),E.call(this,B,N,H),this._prevBlock=k}});function E(B,N,G){var H,k=this._iv;k?(H=k,this._iv=e):H=this._prevBlock;for(var L=0;L<G;L++)B[N+L]^=H[L]}return A}(),f=O.pad={},a=f.Pkcs7={pad:function(A,E){for(var B=E*4,N=B-A.sigBytes%B,G=N<<24|N<<16|N<<8|N,H=[],k=0;k<N;k+=4)H.push(G);var L=c.create(H,N);A.concat(L)},unpad:function(A){var E=A.words[A.sigBytes-1>>>2]&255;A.sigBytes-=E}},s=C.BlockCipher=S.extend({cfg:S.cfg.extend({mode:n,padding:a}),reset:function(){var A;S.reset.call(this);var E=this.cfg,B=E.iv,N=E.mode;this._xformMode==this._ENC_XFORM_MODE?A=N.createEncryptor:(A=N.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==A?this._mode.init(this,B&&B.words):(this._mode=A.call(N,this,B&&B.words),this._mode.__creator=A)},_doProcessBlock:function(A,E){this._mode.processBlock(A,E)},_doFinalize:function(){var A,E=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(E.pad(this._data,this.blockSize),A=this._process(!0)):(A=this._process(!0),E.unpad(A)),A},blockSize:128/32}),r=C.CipherParams=o.extend({init:function(A){this.mixIn(A)},toString:function(A){return(A||this.formatter).stringify(this)}}),h=O.format={},R=h.OpenSSL={stringify:function(A){var E,B=A.ciphertext,N=A.salt;return N?E=c.create([1398893684,1701076831]).concat(N).concat(B):E=B,E.toString(i)},parse:function(A){var E,B=i.parse(A),N=B.words;return N[0]==1398893684&&N[1]==1701076831&&(E=c.create(N.slice(2,4)),N.splice(0,4),B.sigBytes-=16),r.create({ciphertext:B,salt:E})}},P=C.SerializableCipher=o.extend({cfg:o.extend({format:R}),encrypt:function(A,E,B,N){N=this.cfg.extend(N);var G=A.createEncryptor(B,N),H=G.finalize(E),k=G.cfg;return r.create({ciphertext:H,key:B,iv:k.iv,algorithm:A,mode:k.mode,padding:k.padding,blockSize:A.blockSize,formatter:N.format})},decrypt:function(A,E,B,N){N=this.cfg.extend(N),E=this._parse(E,N.format);var G=A.createDecryptor(B,N).finalize(E.ciphertext);return G},_parse:function(A,E){return typeof A=="string"?E.parse(A,this):A}}),U=O.kdf={},D=U.OpenSSL={execute:function(A,E,B,N){N||(N=c.random(64/8));var G=T.create({keySize:E+B}).compute(A,N),H=c.create(G.words.slice(E),B*4);return G.sigBytes=E*4,r.create({key:G,iv:H,salt:N})}},M=C.PasswordBasedCipher=P.extend({cfg:P.cfg.extend({kdf:D}),encrypt:function(A,E,B,N){N=this.cfg.extend(N);var G=N.kdf.execute(B,A.keySize,A.ivSize);N.iv=G.iv;var H=P.encrypt.call(this,A,E,G.key,N);return H.mixIn(G),H},decrypt:function(A,E,B,N){N=this.cfg.extend(N),E=this._parse(E,N.format);var G=N.kdf.execute(B,A.keySize,A.ivSize,E.salt);N.iv=G.iv;var H=P.decrypt.call(this,A,E,G.key,N);return H}})}()})},function(x,u,t){"use strict";u.__esModule=!0,u.Request=u.createRequest=void 0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(11)),C=l.__importDefault(t(0)),o=l.__importDefault(t(7)),c=l.__importDefault(t(5)),m=l.__importDefault(t(8)),v=l.__importDefault(t(3)),y=l.__importDefault(t(20)),i=e.getGlobalObject(),g=function(){},T=i._ablyjs_jsonp={};T._=function(a){return T["_"+a]||g};var S=1,p="jsonp";function d(a,s,r,h,R,P,U){return P=P||m.default.TIMEOUTS,new n(void 0,a,s,e.copy(r),h,R,P,U)}u.createRequest=d;var b=function(a){l.__extends(s,a);function s(r,h,R){var P=a.call(this,r,h,R)||this;return P.shortName=p,R.stream=!1,P}return s.isAvailable=function(){return C.default.Config.jsonpSupported&&C.default.Config.allowComet},s.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},s.prototype.createRequest=function(r,h,R,P,U,D,M){return D=(this===null||this===void 0?void 0:this.timeouts)||D||m.default.TIMEOUTS,d(r,h,R,P,U,D,M)},s}(O.default),n=function(a){l.__extends(s,a);function s(r,h,R,P,U,D,M,A){var E=a.call(this)||this;return r===void 0&&(r=S++),E.id=r,E.uri=h,E.params=P||{},E.params.rnd=e.cheapRandStr(),R&&(R["X-Ably-Version"]&&(E.params.v=R["X-Ably-Version"]),R["X-Ably-Lib"]&&(E.params.lib=R["X-Ably-Lib"])),E.body=U,E.method=A,E.requestMode=D,E.timeouts=M,E.requestComplete=!1,E}return s.prototype.exec=function(){var r=this,h=this.id,R=this.body,P=this.method,U=this.uri,D=this.params;D.callback="_ablyjs_jsonp._("+h+")",D.envelope="jsonp",R&&(D.body=R),P&&P!=="get"&&(D.method=P);var M=this.script=document.createElement("script"),A=U+e.toQueryString(D);M.src=A,M.src.split("/").slice(-1)[0]!==A.split("/").slice(-1)[0]&&v.default.logAction(v.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),M.async=!0,M.type="text/javascript",M.charset="UTF-8",M.onerror=function(N){r.complete(new c.default("JSONP script error (event: "+C.default.Config.inspect(N)+")",null,400))},T["_"+h]=function(N){if(N.statusCode){var G=N.response;if(N.statusCode==204)r.complete(null,null,null,N.statusCode);else if(!G)r.complete(new c.default("Invalid server response: no envelope detected",null,500));else if(N.statusCode<400||e.isArray(G))r.complete(null,G,N.headers,N.statusCode);else{var H=G.error||new c.default("Error response received from server",null,N.statusCode);r.complete(H)}}else r.complete(null,N)};var E=this.requestMode==y.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),E);var B=document.getElementsByTagName("head")[0];B.insertBefore(M,B.firstChild)},s.prototype.complete=function(r,h,R,P){if(R=R||{},!this.requestComplete){this.requestComplete=!0;var U=void 0;h&&(U=typeof h=="string"?"text/plain":"application/json",R["content-type"]=U,this.emit("data",h)),this.emit("complete",r,h,R,!0,P),this.dispose()}},s.prototype.abort=function(){this.dispose()},s.prototype.dispose=function(){var r=this.timer;r&&(clearTimeout(r),this.timer=null);var h=this.script;h.parentNode&&h.parentNode.removeChild(h),delete T[this.id],this.emit("disposed")},s}(o.default);u.Request=n;function f(a){return i.JSONPTransport=b,b.isAvailable()&&(a.supportedTransports[p]=b),b}u.default=f},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(3)),C=l.__importDefault(t(8)),o=l.__importDefault(t(16)),c=l.__importDefault(t(45)),m=l.__importDefault(t(18)),v=l.__importDefault(t(33)),y=l.__importDefault(t(5)),i=l.__importDefault(t(48)),g=l.__importDefault(t(17)),T=l.__importDefault(t(0)),S=function(){},p=function(){function b(n){if(!n){var f="no options provided";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",f),new Error(f)}var a=C.default.objectifyOptions(n);a.log&&O.default.setLog(a.log.level,a.log.handler),O.default.logAction(O.default.LOG_MICRO,"Rest()","initialized with clientOptions "+T.default.Config.inspect(n));var s=this.options=C.default.normaliseOptions(a);if(s.key){var r=s.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!r){var f="invalid key parameter";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",f),new y.default(f,40400,404)}s.keyName=r[1],s.keySecret=r[2]}if("clientId"in s)if(typeof s.clientId=="string"||s.clientId===null){if(s.clientId==="*")throw new y.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new y.default("clientId must be either a string or null",40012,400);O.default.logAction(O.default.LOG_MINOR,"Rest()","started; version = "+C.default.version),this.baseUri=this.authority=function(h){return C.default.getHttpScheme(s)+h+":"+C.default.getPort(s,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new T.default.Http,this.auth=new o.default(this,s),this.channels=new d(this),this.push=new c.default(this)}return b.prototype.stats=function(n,f){if(f===void 0)if(typeof n=="function")f=n,n=null;else{if(this.options.promises)return e.promisify(this,"stats",arguments);f=S}var a=e.defaultGetHeaders(),s=this.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,r=this.http.supportsLinkHeaders?void 0:s;this.options.headers&&e.mixin(a,this.options.headers),new m.default(this,"/stats",a,r,function(h,R,P){for(var U=P?h:JSON.parse(h),D=0;D<U.length;D++)U[D]=i.default.fromValues(U[D]);return U}).get(n,f)},b.prototype.time=function(n,f){var a=this;if(f===void 0){if(typeof n=="function")f=n,n=null;else if(this.options.promises)return e.promisify(this,"time",arguments)}var s=f||S,r=e.defaultGetHeaders();this.options.headers&&e.mixin(r,this.options.headers);var h=function(R){return a.authority(R)+"/time"};this.http.do(g.default.Get,this,h,r,null,n,function(R,P,U,D){if(R){s(R);return}D||(P=JSON.parse(P));var M=P[0];if(!M){s(new y.default("Internal error (unexpected result type from GET /time)",5e4,500));return}a.serverTimeOffset=M-e.now(),s(null,M)})},b.prototype.request=function(n,f,a,s,r,h){var R=this.options.useBinaryProtocol,P=R?T.default.Config.msgpack.encode:JSON.stringify,U=R?T.default.Config.msgpack.decode:JSON.parse,D=R?e.Format.msgpack:e.Format.json,M=this.http.supportsLinkHeaders?void 0:D;a=a||{};var A=n.toLowerCase(),E=A=="get"?e.defaultGetHeaders(D):e.defaultPostHeaders(D);if(h===void 0){if(this.options.promises)return e.promisify(this,"request",arguments);h=S}typeof s!="string"&&(s=P(s)),this.options.headers&&e.mixin(E,this.options.headers),r&&e.mixin(E,r);var B=new m.default(this,f,E,M,function(N,G,H){return e.ensureArray(H?N:U(N))},!0);if(!e.arrIn(T.default.Http.methods,A))throw new y.default("Unsupported method "+A,40500,405);e.arrIn(T.default.Http.methodsWithBody,A)?B[A](a,s,h):B[A](a,h)},b.prototype.setLog=function(n){O.default.setLog(n.level,n.handler)},b.Promise=function(n){return n=C.default.objectifyOptions(n),n.promises=!0,new b(n)},b.Callbacks=b,b.Platform=T.default,b}(),d=function(){function b(n){this.rest=n,this.all={}}return b.prototype.get=function(n,f){n=String(n);var a=this.all[n];return a?f&&a.setOptions(f):this.all[n]=a=new v.default(this.rest,n,f),a},b.prototype.release=function(n){delete this.all[String(n)]},b}();u.default=p},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(e){var O=l,C=O.lib,o=C.WordArray,c=C.Hasher,m=O.algo,v=[],y=[];(function(){function T(b){for(var n=e.sqrt(b),f=2;f<=n;f++)if(!(b%f))return!1;return!0}function S(b){return(b-(b|0))*4294967296|0}for(var p=2,d=0;d<64;)T(p)&&(d<8&&(v[d]=S(e.pow(p,1/2))),y[d]=S(e.pow(p,1/3)),d++),p++})();var i=[],g=m.SHA256=c.extend({_doReset:function(){this._hash=new o.init(v.slice(0))},_doProcessBlock:function(T,S){for(var p=this._hash.words,d=p[0],b=p[1],n=p[2],f=p[3],a=p[4],s=p[5],r=p[6],h=p[7],R=0;R<64;R++){if(R<16)i[R]=T[S+R]|0;else{var P=i[R-15],U=(P<<25|P>>>7)^(P<<14|P>>>18)^P>>>3,D=i[R-2],M=(D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10;i[R]=U+i[R-7]+M+i[R-16]}var A=a&s^~a&r,E=d&b^d&n^b&n,B=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),N=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),G=h+N+A+y[R]+i[R],H=B+E;h=r,r=s,s=a,a=f+G|0,f=n,n=b,b=d,d=G+H|0}p[0]=p[0]+d|0,p[1]=p[1]+b|0,p[2]=p[2]+n|0,p[3]=p[3]+f|0,p[4]=p[4]+a|0,p[5]=p[5]+s|0,p[6]=p[6]+r|0,p[7]=p[7]+h|0},_doFinalize:function(){var T=this._data,S=T.words,p=this._nDataBytes*8,d=T.sigBytes*8;return S[d>>>5]|=128<<24-d%32,S[(d+64>>>9<<4)+14]=e.floor(p/4294967296),S[(d+64>>>9<<4)+15]=p,T.sigBytes=S.length*4,this._process(),this._hash},clone:function(){var T=c.clone.call(this);return T._hash=this._hash.clone(),T}});O.SHA256=c._createHelper(g),O.HmacSHA256=c._createHmacHelper(g)}(Math),l.SHA256})},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return l.enc.Utf8})},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(7)),C=l.__importDefault(t(3)),o=l.__importDefault(t(34)),c=l.__importDefault(t(9)),m=l.__importDefault(t(5)),v=l.__importDefault(t(18)),y=l.__importDefault(t(24)),i=l.__importDefault(t(0));function g(){}var T=9;function S(b){return e.arrEvery(b,function(n){return!n.id})}function p(b){var n=b||{};if(n.cipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var f=i.default.Crypto.getCipher(n.cipher);n.cipher=f.cipherParams,n.channelCipher=f.cipher}else"cipher"in n&&(n.cipher=void 0,n.channelCipher=null);return n}var d=function(b){l.__extends(n,b);function n(f,a,s){var r=b.call(this)||this;return C.default.logAction(C.default.LOG_MINOR,"Channel()","started; name = "+a),r.rest=f,r.name=a,r.basePath="/channels/"+encodeURIComponent(a),r.presence=new o.default(r),r.channelOptions=p(s),r}return n.prototype.setOptions=function(f){this.channelOptions=p(f)},n.prototype.history=function(f,a){if(C.default.logAction(C.default.LOG_MICRO,"Channel.history()","channel = "+this.name),a===void 0)if(typeof f=="function")a=f,f=null;else{if(this.rest.options.promises)return e.promisify(this,"history",arguments);a=g}this._history(f,a)},n.prototype._history=function(f,a){var s=this.rest,r=s.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:r,R=e.defaultGetHeaders(r);s.options.headers&&e.mixin(R,s.options.headers);var P=this.channelOptions;new v.default(s,this.basePath+"/messages",R,h,function(U,D,M){return c.default.fromResponseBody(U,P,M?void 0:r)}).get(f,a)},n.prototype.publish=function(){var f=this,a=arguments.length,s=arguments[0],r=arguments[1],h=arguments[a-1],R,P;if(typeof h!="function"){if(this.rest.options.promises)return e.promisify(this,"publish",arguments);h=g}if(typeof s=="string"||s===null)R=[c.default.fromValues({name:s,data:r})],P=arguments[2];else if(e.isObject(s))R=[c.default.fromValues(s)],P=arguments[1];else if(e.isArray(s))R=c.default.fromValuesArray(s),P=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof P!="object"||!P)&&(P={});var U=this.rest,D=U.options,M=D.useBinaryProtocol?e.Format.msgpack:e.Format.json,A=U.options.idempotentRestPublishing,E=e.defaultPostHeaders(M);if(D.headers&&e.mixin(E,D.headers),A&&S(R)){var B=e.randomString(T);e.arrForEach(R,function(N,G){N.id=B+":"+G.toString()})}c.default.encodeArray(R,this.channelOptions,function(N){if(N){h(N);return}var G=c.default.getMessagesSize(R),H=D.maxMessageSize;if(G>H){h(new m.default("Maximum size of messages that can be published at once exceeded ( was "+G+" bytes; limit is "+H+" bytes)",40009,400));return}f._publish(c.default.serialize(R,M),E,P,h)})},n.prototype._publish=function(f,a,s,r){y.default.post(this.rest,this.basePath+"/messages",f,a,s,null,r)},n.prototype.status=function(f){if(typeof f!="function"&&this.rest.options.promises)return e.promisify(this,"status",[]);var a=this.rest.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,s=e.defaultPostHeaders(a);y.default.get(this.rest,this.basePath,s,{},a,f||g)},n}(O.default);u.default=d},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(7)),C=l.__importDefault(t(3)),o=l.__importDefault(t(18)),c=l.__importDefault(t(14));function m(){}var v=function(y){l.__extends(i,y);function i(g){var T=y.call(this)||this;return T.channel=g,T.basePath=g.basePath+"/presence",T}return i.prototype.get=function(g,T){if(C.default.logAction(C.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),T===void 0)if(typeof g=="function")T=g,g=null;else{if(this.channel.rest.options.promises)return e.promisify(this,"get",arguments);T=m}var S=this.channel.rest,p=S.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,d=this.channel.rest.http.supportsLinkHeaders?void 0:p,b=e.defaultGetHeaders(p);S.options.headers&&e.mixin(b,S.options.headers);var n=this.channel.channelOptions;new o.default(S,this.basePath,b,d,function(f,a,s){return c.default.fromResponseBody(f,n,s?void 0:p)}).get(g,T)},i.prototype.history=function(g,T){C.default.logAction(C.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(g,T)},i.prototype._history=function(g,T){if(T===void 0)if(typeof g=="function")T=g,g=null;else{if(this.channel.rest.options.promises)return e.promisify(this,"_history",arguments);T=m}var S=this.channel.rest,p=S.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,d=this.channel.rest.http.supportsLinkHeaders?void 0:p,b=e.defaultGetHeaders(p);S.options.headers&&e.mixin(b,S.options.headers);var n=this.channel.channelOptions;new o.default(S,this.basePath+"/history",b,d,function(f,a,s){return c.default.fromResponseBody(f,n,s?void 0:p)}).get(g,T)},i}(O.default);u.default=v},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(7)),O=l.__importDefault(t(3)),C=function(o){l.__extends(c,o);function c(){var m=o.call(this)||this;return m.messages=[],m}return c.prototype.count=function(){return this.messages.length},c.prototype.push=function(m){this.messages.push(m)},c.prototype.shift=function(){return this.messages.shift()},c.prototype.last=function(){return this.messages[this.messages.length-1]},c.prototype.copyAll=function(){return this.messages.slice()},c.prototype.append=function(m){this.messages.push.apply(this.messages,m)},c.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},c.prototype.completeMessages=function(m,v,y){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+v),y=y||null;var i=this.messages;if(i.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var g=i[0];if(g){var T=g.message.msgSerial,S=m+v;if(S>T)for(var p=i.splice(0,S-T),d=0,b=p;d<b.length;d++){var n=b[d];n.callback(y)}i.length==0&&this.emit("idle")}},c.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},c.prototype.clear=function(){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},c}(e.default);u.default=C},function(x,u,t){"use strict";u.__esModule=!0;var l=function(){function e(O,C,o,c){this.previous=O,this.current=C,o&&(this.retryIn=o),c&&(this.reason=c)}return e}();u.default=l},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(10)),O=l.__importDefault(t(7)),C=l.__importStar(t(2)),o=l.__importDefault(t(33)),c=l.__importDefault(t(3)),m=l.__importDefault(t(54)),v=l.__importDefault(t(9)),y=l.__importDefault(t(38)),i=l.__importDefault(t(5)),g=l.__importDefault(t(14)),T=l.__importDefault(t(19)),S=e.default.Action,p=function(){},d="statechange",b="sync";function n(a){if(a&&"params"in a&&!C.isObject(a.params))return new i.default("options.params must be an object",4e4,400);if(a&&"modes"in a){if(!C.isArray(a.modes))return new i.default("options.modes must be an array",4e4,400);for(var s=0;s<a.modes.length;s++){var r=a.modes[s];if(!r||typeof r!="string"||!C.arrIn(e.default.channelModes,String.prototype.toUpperCase.call(r)))return new i.default("Invalid channel mode: "+r,4e4,400)}}}var f=function(a){l.__extends(s,a);function s(r,h,R){var P=a.call(this,r,h,R)||this;return P.retryCount=0,P.history=function(U,D){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),D===void 0)if(typeof U=="function")D=U,U=null;else{if(this.rest.options.promises)return C.promisify(this,"history",arguments);D=p}if(U&&U.untilAttach){if(this.state!=="attached"){D(new i.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){D(new i.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete U.untilAttach,U.from_serial=this.properties.attachSerial}o.default.prototype._history.call(this,U,D)},P.whenState=function(U,D){return O.default.prototype.whenState.call(P,U,P.state,D)},c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel()","started; name = "+h),P.realtime=r,P.presence=new m.default(P),P.connectionManager=r.connection.connectionManager,P.state="initialized",P.subscriptions=new O.default,P.syncChannelSerial=void 0,P.properties={attachSerial:void 0},P.setOptions(R),P.errorReason=null,P._requestedFlags=null,P._mode=null,P._attachedMsgIndicator=!1,P._attachResume=!1,P._decodingContext={channelOptions:P.channelOptions,plugins:r.options.plugins||{},baseEncodedPreviousPayload:void 0},P._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},P._allChannelChanges=new O.default,P}return s.invalidStateError=function(r){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+r}},s.processListenerArgs=function(r){return r=Array.prototype.slice.call(r),typeof r[0]=="function"&&r.unshift(null),r[r.length-1]==null&&r.pop(),r},s.prototype.setOptions=function(r,h){if(!h&&this.rest.options.promises)return C.promisify(this,"setOptions",arguments);var R=h||function(U){U&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+U.toString())},P=n(r);if(P){R(P);return}o.default.prototype.setOptions.call(this,r),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(r)?(this.attachImpl(),this._allChannelChanges.once(function(U){switch(this.event){case"update":case"attached":R==null||R(null);return;default:R==null||R(U.reason);return}})):R()},s.prototype._shouldReattachToSetOptions=function(r){return(this.state==="attached"||this.state==="attaching")&&(r.params||r.modes)},s.prototype.publish=function(){for(var r=this,h=[],R=0;R<arguments.length;R++)h[R]=arguments[R];var P=h[0],U=h.length,D=h[U-1];if(typeof D!="function"){if(this.realtime.options.promises)return C.promisify(this,"publish",arguments);D=p,++U}if(!this.connectionManager.activeState()){D(this.connectionManager.getError());return}if(U==2)if(C.isObject(P))P=[v.default.fromValues(P)];else if(C.isArray(P))P=v.default.fromValuesArray(P);else throw new i.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else P=[v.default.fromValues({name:h[0],data:h[1]})];var M=this.realtime.options.maxMessageSize;v.default.encodeArray(P,this.channelOptions,function(A){if(A){D(A);return}var E=v.default.getMessagesSize(P);if(E>M){D(new i.default("Maximum size of messages that can be published at once exceeded ( was "+E+" bytes; limit is "+M+" bytes)",40009,400));return}r.__publish(P,D)})},s.prototype.__publish=function(r,h){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+r.length);var R=this.state;switch(R){case"failed":case"suspended":h(i.default.fromValues(s.invalidStateError(R)));break;default:{c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+R);var P=new e.default;P.action=S.MESSAGE,P.channel=this.name,P.messages=r,this.sendMessage(P,h);break}}},s.prototype.onEvent=function(r){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var h=this.subscriptions,R=0;R<r.length;R++){var P=r[R];h.emit(P.name,P)}},s.prototype.attach=function(r,h){var R;if(typeof r=="function"?(h=r,R=null):R=r,!h){if(this.realtime.options.promises)return C.promisify(this,"attach",arguments);h=function(P){P&&c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+P.toString())}}if(R)c.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=R;else if(this.state==="attached"){h();return}this._attach(!1,null,h)},s.prototype._attach=function(r,h,R){R||(R=function(U){U&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+U.toString())});var P=this.connectionManager;if(!P.activeState()){R(P.getError());return}(this.state!=="attaching"||r)&&this.requestState("attaching",h),this.once(function(U){switch(this.event){case"attached":R==null||R();break;case"detached":case"suspended":case"failed":R==null||R(U.reason||P.getError()||new i.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":R==null||R(new i.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},s.prototype.attachImpl=function(){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(d,!0);var r=e.default.fromValues({action:S.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?r.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&r.encodeModesToFlags(C.allToUpperCase(this.channelOptions.modes)),this._attachResume&&r.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(r.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(r,p)},s.prototype.detach=function(r){if(!r){if(this.realtime.options.promises)return C.promisify(this,"detach",arguments);r=p}var h=this.connectionManager;if(!h.activeState()){r(h.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),r();break;case"detached":r();break;case"failed":r(new i.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(R){switch(this.event){case"detached":r();break;case"attached":case"suspended":case"failed":r(R.reason||h.getError()||new i.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":r(new i.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},s.prototype.detachImpl=function(r){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(d,!0);var h=e.default.fromValues({action:S.DETACH,channel:this.name});this.sendMessage(h,r||p)},s.prototype.subscribe=function(){for(var r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];var R=s.processListenerArgs(r),P=R[0],U=R[1],D=R[2];if(!D&&this.realtime.options.promises)return C.promisify(this,"subscribe",[P,U]);if(this.state==="failed"){D==null||D(i.default.fromValues(s.invalidStateError("failed")));return}return P&&typeof P=="object"&&!Array.isArray(P)?this._subscribeFilter(P,U):this.subscriptions.on(P,U),this.attach(D||p)},s.prototype._subscribeFilter=function(r,h){var R=function(P){var U,D,M,A,E,B,N={name:P.name,refTimeserial:(D=(U=P.extras)===null||U===void 0?void 0:U.ref)===null||D===void 0?void 0:D.timeserial,refType:(A=(M=P.extras)===null||M===void 0?void 0:M.ref)===null||A===void 0?void 0:A.type,isRef:!!(!((B=(E=P.extras)===null||E===void 0?void 0:E.ref)===null||B===void 0)&&B.timeserial),clientId:P.clientId};Object.entries(r).find(function(G){var H=G[0],k=G[1];return k!==void 0?N[H]!==k:!1})||h(P)};this._addFilteredSubscription(r,h,R),this.subscriptions.on(R)},s.prototype._addFilteredSubscription=function(r,h,R){var P;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(h)){var U=this.filteredSubscriptions.get(h);U.set(r,((P=U==null?void 0:U.get(r))===null||P===void 0?void 0:P.concat(R))||[R])}else this.filteredSubscriptions.set(h,new Map([[r,[R]]]))},s.prototype._getAndDeleteFilteredSubscriptions=function(r,h){var R=this;if(!this.filteredSubscriptions)return[];if(!h&&r)return Array.from(this.filteredSubscriptions.entries()).map(function(M){var A,E=M[0],B=M[1],N=B.get(r);return B.delete(r),B.size===0&&((A=R.filteredSubscriptions)===null||A===void 0||A.delete(E)),N}).reduce(function(M,A){var E;return A?(E=M).concat.apply(E,A):M},[]);if(!h||!this.filteredSubscriptions.has(h))return[];var P=this.filteredSubscriptions.get(h);if(!r){var U=Array.from(P.values()).reduce(function(M,A){return M.concat.apply(M,A)},[]);return this.filteredSubscriptions.delete(h),U}var D=P.get(r);return P.delete(r),D||[]},s.prototype.unsubscribe=function(){for(var r=this,h,R=[],P=0;P<arguments.length;P++)R[P]=arguments[P];var U=s.processListenerArgs(R),D=U[0],M=U[1];if(typeof D=="object"&&!M||((h=this.filteredSubscriptions)===null||h===void 0?void 0:h.has(M))){this._getAndDeleteFilteredSubscriptions(D,M).forEach(function(A){return r.subscriptions.off(A)});return}this.subscriptions.off(D,M)},s.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new i.default("Unable to sync to channel; not attached",4e4);default:}var r=this.connectionManager;if(!r.activeState())throw r.getError();var h=e.default.fromValues({action:S.SYNC,channel:this.name});this.syncChannelSerial&&(h.channelSerial=this.syncChannelSerial),r.send(h)},s.prototype.sendMessage=function(r,h){this.connectionManager.send(r,this.realtime.options.queueMessages,h)},s.prototype.sendPresence=function(r,h){var R=e.default.fromValues({action:S.PRESENCE,channel:this.name,presence:C.isArray(r)?g.default.fromValuesArray(r):[g.default.fromValues(r)]});this.sendMessage(R,h)},s.prototype.onMessage=function(r){var h,R=!1;switch(r.action){case S.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=r.channelSerial,this._mode=r.getMode(),this.params=r.params||{};var P=r.decodeModesFromFlags();this.modes=P&&C.allToLowerCase(P)||void 0;var U=r.hasFlag("RESUMED"),D=r.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(d,!1),U||this.presence.onAttached(D);var M=new y.default(this.state,this.state,U,r.error);this._allChannelChanges.emit("update",M),(!U||this.channelOptions.updateOnAttached)&&this.emit("update",M)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",r.error,U,D);break}case S.DETACHED:{var A=r.error?i.default.fromValues(r.error):new i.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",A):this.state==="attaching"?this.notifyState("suspended",A):this.requestState("attaching",A);break}case S.SYNC:if(R=!0,h=this.syncChannelSerial=r.channelSerial,!r.presence)break;case S.PRESENCE:{for(var E=r.presence,B=r.id,N=r.connectionId,G=r.timestamp,H=this.channelOptions,k=void 0,L=0;L<E.length;L++)try{k=E[L],g.default.decode(k,H),k.connectionId||(k.connectionId=N),k.timestamp||(k.timestamp=G),k.id||(k.id=B+":"+L)}catch(J){c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(E,R,h);break}case S.MESSAGE:{if(this.state!=="attached"){c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+r.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var I=r.messages,w=I[0],_=I[I.length-1],B=r.id,N=r.connectionId,G=r.timestamp;if(w.extras&&w.extras.delta&&w.extras.delta.from!==this._lastPayload.messageId){var F='Delta message decode failure - previous message not available for message "'+r.id+'" on this channel "'+this.name+'".';c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",F),this._startDecodeFailureRecovery(new i.default(F,40018,400));break}for(var L=0;L<I.length;L++){var F=I[L];try{v.default.decode(F,this._decodingContext)}catch(Q){switch(c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q.toString()),Q.code){case 40018:this._startDecodeFailureRecovery(Q);return;case 40019:case 40021:this.notifyState("failed",Q);return}}F.connectionId||(F.connectionId=N),F.timestamp||(F.timestamp=G),F.id||(F.id=B+":"+L)}this._lastPayload.messageId=_.id,this._lastPayload.protocolMessageChannelSerial=r.channelSerial,this.onEvent(I);break}case S.ERROR:{var W=r.error;W&&W.code==80016?this.checkPendingState():this.notifyState("failed",i.default.fromValues(W));break}default:c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+r.action+")"),this.connectionManager.abort(T.default.unknownChannelErr)}},s.prototype._startDecodeFailureRecovery=function(r){var h=this;this._lastPayload.decodeFailureRecoveryInProgress||(c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,r,function(){h._lastPayload.decodeFailureRecoveryInProgress=!1}))},s.prototype.onAttached=function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},s.prototype.notifyState=function(r,h,R,P){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+r),this.clearStateTimer(),r!==this.state){this.presence.actOnChannelState(r,P,h),r==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),h&&(this.errorReason=h);var U=new y.default(this.state,r,R,h),D=r==="failed"?c.default.LOG_ERROR:c.default.LOG_MAJOR;c.default.logAction(D,'Channel state for channel "'+this.name+'"',r+(h?"; reason: "+h:"")),r!=="attaching"&&r!=="suspended"&&(this.retryCount=0),r==="attached"?(this.onAttached(),this.setInProgress(b,P),this.setInProgress(d,!1)):(r==="detached"||r==="failed"||r==="suspended")&&(this.setInProgress(d,!1),this.setInProgress(b,!1)),r==="attached"?this._attachResume=!0:(r==="detaching"||r==="failed")&&(this._attachResume=!1),this.state=r,this._allChannelChanges.emit(r,U),this.emit(r,U)}},s.prototype.requestState=function(r,h){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+r),this.notifyState(r,h),this.checkPendingState()},s.prototype.checkPendingState=function(){var r=this.connectionManager.state;if(!(r.sendEvents||r.forceQueueEvents)){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},s.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var r=new i.default("Channel attach timed out",90007,408);this.notifyState("suspended",r);break}case"detaching":{var r=new i.default("Channel detach timed out",90007,408);this.notifyState("attached",r);break}default:this.checkPendingState();break}},s.prototype.startStateTimerIfNotRunning=function(){var r=this;this.stateTimer||(this.stateTimer=setTimeout(function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),r.stateTimer=null,r.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},s.prototype.clearStateTimer=function(){var r=this.stateTimer;r&&(clearTimeout(r),this.stateTimer=null)},s.prototype.startRetryTimer=function(){var r=this;if(!this.retryTimer){this.retryCount++;var h=this.realtime.options.timeouts.channelRetryTimeout*C.getJitterCoefficient()*C.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){r.state==="suspended"&&r.connectionManager.state.sendEvents&&(r.retryTimer=null,c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),r.requestState("attaching"))},h)}},s.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},s.prototype.setInProgress=function(r,h){this.rest.channels.setInProgress(this,r,h)},s.prototype.getReleaseErr=function(){var r=this.state;return r==="initialized"||r==="detached"||r==="failed"?null:new i.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+r,90001,400)},s.progressOps={statechange:d,sync:b},s}(o.default);u.default=f},function(x,u,t){"use strict";u.__esModule=!0;var l=function(){function e(O,C,o,c){this.previous=O,this.current=C,C==="attached"&&(this.resumed=o),c&&(this.reason=c)}return e}();u.default=l},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(){var e=l,O=e.lib,C=O.WordArray,o=O.Hasher,c=e.algo,m=[],v=c.SHA1=o.extend({_doReset:function(){this._hash=new C.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(y,i){for(var g=this._hash.words,T=g[0],S=g[1],p=g[2],d=g[3],b=g[4],n=0;n<80;n++){if(n<16)m[n]=y[i+n]|0;else{var f=m[n-3]^m[n-8]^m[n-14]^m[n-16];m[n]=f<<1|f>>>31}var a=(T<<5|T>>>27)+b+m[n];n<20?a+=(S&p|~S&d)+1518500249:n<40?a+=(S^p^d)+1859775393:n<60?a+=(S&p|S&d|p&d)-1894007588:a+=(S^p^d)-899497514,b=d,d=p,p=S<<30|S>>>2,S=T,T=a}g[0]=g[0]+T|0,g[1]=g[1]+S|0,g[2]=g[2]+p|0,g[3]=g[3]+d|0,g[4]=g[4]+b|0},_doFinalize:function(){var y=this._data,i=y.words,g=this._nDataBytes*8,T=y.sigBytes*8;return i[T>>>5]|=128<<24-T%32,i[(T+64>>>9<<4)+14]=Math.floor(g/4294967296),i[(T+64>>>9<<4)+15]=g,y.sigBytes=i.length*4,this._process(),this._hash},clone:function(){var y=o.clone.call(this);return y._hash=this._hash.clone(),y}});e.SHA1=o._createHelper(v),e.HmacSHA1=o._createHmacHelper(v)}(),l.SHA1})},function(x,u,t){"use strict";u.__esModule=!0;function l(n){if(n===void 0)return"undefined";var f,a;if(n instanceof ArrayBuffer?(a="ArrayBuffer",f=new DataView(n)):n instanceof DataView&&(a="DataView",f=n),!f)return JSON.stringify(n);for(var s=[],r=0;r<n.byteLength;r++){if(r>20){s.push("...");break}var h=f.getUint8(r).toString(16);h.length===1&&(h="0"+h),s.push(h)}return"<"+a+" "+s.join(" ")+">"}function e(n,f,a){for(var s=0,r=a.length;s<r;s++){var h=a.charCodeAt(s);if(h<128){n.setUint8(f++,h>>>0&127|0);continue}if(h<2048){n.setUint8(f++,h>>>6&31|192),n.setUint8(f++,h>>>0&63|128);continue}if(h<65536){n.setUint8(f++,h>>>12&15|224),n.setUint8(f++,h>>>6&63|128),n.setUint8(f++,h>>>0&63|128);continue}if(h<1114112){n.setUint8(f++,h>>>18&7|240),n.setUint8(f++,h>>>12&63|128),n.setUint8(f++,h>>>6&63|128),n.setUint8(f++,h>>>0&63|128);continue}throw new Error("bad codepoint "+h)}}function O(n,f,a){for(var s="",r=f,h=f+a;r<h;r++){var R=n.getUint8(r);if((R&128)===0){s+=String.fromCharCode(R);continue}if((R&224)===192){s+=String.fromCharCode((R&15)<<6|n.getUint8(++r)&63);continue}if((R&240)===224){s+=String.fromCharCode((R&15)<<12|(n.getUint8(++r)&63)<<6|(n.getUint8(++r)&63)<<0);continue}if((R&248)===240){s+=String.fromCharCode((R&7)<<18|(n.getUint8(++r)&63)<<12|(n.getUint8(++r)&63)<<6|(n.getUint8(++r)&63)<<0);continue}throw new Error("Invalid byte "+R.toString(16))}return s}function C(n){for(var f=0,a=0,s=n.length;a<s;a++){var r=n.charCodeAt(a);if(r<128){f+=1;continue}if(r<2048){f+=2;continue}if(r<65536){f+=3;continue}if(r<1114112){f+=4;continue}throw new Error("bad codepoint "+r)}return f}function o(n,f){var a=b(n,f);if(a!==0){var s=new ArrayBuffer(a),r=new DataView(s);return d(n,r,0,f),s}}var c=(1<<16)*(1<<16),m=1/c;function v(n,f){return f=f||0,n.getInt32(f)*c+n.getUint32(f+4)}function y(n,f){return f=f||0,n.getUint32(f)*c+n.getUint32(f+4)}function i(n,f,a){a<9223372036854776e3?(n.setInt32(f,Math.floor(a*m)),n.setInt32(f+4,a&-1)):(n.setUint32(f,2147483647),n.setUint32(f+4,2147483647))}function g(n,f,a){a<18446744073709552e3?(n.setUint32(f,Math.floor(a*m)),n.setInt32(f+4,a&-1)):(n.setUint32(f,4294967295),n.setUint32(f+4,4294967295))}var T=function(){function n(f,a){var s=this;this.map=function(r){for(var h={},R=0;R<r;R++){var P=s.parse();h[P]=s.parse()}return h},this.bin=function(r){var h=new ArrayBuffer(r);return new Uint8Array(h).set(new Uint8Array(s.view.buffer,s.offset,r),0),s.offset+=r,h},this.buf=this.bin,this.str=function(r){var h=O(s.view,s.offset,r);return s.offset+=r,h},this.array=function(r){for(var h=new Array(r),R=0;R<r;R++)h[R]=s.parse();return h},this.ext=function(r){return s.offset+=r,{type:s.view.getInt8(s.offset),data:s.buf(r)}},this.parse=function(){var r=s.view.getUint8(s.offset),h,R;if((r&128)===0)return s.offset++,r;if((r&240)===128)return R=r&15,s.offset++,s.map(R);if((r&240)===144)return R=r&15,s.offset++,s.array(R);if((r&224)===160)return R=r&31,s.offset++,s.str(R);if((r&224)===224)return h=s.view.getInt8(s.offset),s.offset++,h;switch(r){case 192:return s.offset++,null;case 193:s.offset++;return;case 194:return s.offset++,!1;case 195:return s.offset++,!0;case 196:return R=s.view.getUint8(s.offset+1),s.offset+=2,s.bin(R);case 197:return R=s.view.getUint16(s.offset+1),s.offset+=3,s.bin(R);case 198:return R=s.view.getUint32(s.offset+1),s.offset+=5,s.bin(R);case 199:return R=s.view.getUint8(s.offset+1),s.offset+=2,s.ext(R);case 200:return R=s.view.getUint16(s.offset+1),s.offset+=3,s.ext(R);case 201:return R=s.view.getUint32(s.offset+1),s.offset+=5,s.ext(R);case 202:return h=s.view.getFloat32(s.offset+1),s.offset+=5,h;case 203:return h=s.view.getFloat64(s.offset+1),s.offset+=9,h;case 204:return h=s.view.getUint8(s.offset+1),s.offset+=2,h;case 205:return h=s.view.getUint16(s.offset+1),s.offset+=3,h;case 206:return h=s.view.getUint32(s.offset+1),s.offset+=5,h;case 207:return h=y(s.view,s.offset+1),s.offset+=9,h;case 208:return h=s.view.getInt8(s.offset+1),s.offset+=2,h;case 209:return h=s.view.getInt16(s.offset+1),s.offset+=3,h;case 210:return h=s.view.getInt32(s.offset+1),s.offset+=5,h;case 211:return h=v(s.view,s.offset+1),s.offset+=9,h;case 212:return R=1,s.offset++,s.ext(R);case 213:return R=2,s.offset++,s.ext(R);case 214:return R=4,s.offset++,s.ext(R);case 215:return R=8,s.offset++,s.ext(R);case 216:return R=16,s.offset++,s.ext(R);case 217:return R=s.view.getUint8(s.offset+1),s.offset+=2,s.str(R);case 218:return R=s.view.getUint16(s.offset+1),s.offset+=3,s.str(R);case 219:return R=s.view.getUint32(s.offset+1),s.offset+=5,s.str(R);case 220:return R=s.view.getUint16(s.offset+1),s.offset+=3,s.array(R);case 221:return R=s.view.getUint32(s.offset+1),s.offset+=5,s.array(R);case 222:return R=s.view.getUint16(s.offset+1),s.offset+=3,s.map(R);case 223:return R=s.view.getUint32(s.offset+1),s.offset+=5,s.map(R)}throw new Error("Unknown type 0x"+r.toString(16))},this.offset=a||0,this.view=f}return n}();function S(n){var f=new DataView(n),a=new T(f),s=a.parse();if(a.offset!==n.byteLength)throw new Error(n.byteLength-a.offset+" trailing bytes");return s}function p(n,f){return Object.keys(n).filter(function(a){var s=n[a],r=typeof s;return(!f||s!=null)&&(r!=="function"||!!s.toJSON)})}function d(n,f,a,s){var r=typeof n;if(typeof n=="string"){var h=C(n);if(h<32)return f.setUint8(a,h|160),e(f,a+1,n),1+h;if(h<256)return f.setUint8(a,217),f.setUint8(a+1,h),e(f,a+2,n),2+h;if(h<65536)return f.setUint8(a,218),f.setUint16(a+1,h),e(f,a+3,n),3+h;if(h<4294967296)return f.setUint8(a,219),f.setUint32(a+1,h),e(f,a+5,n),5+h}if(ArrayBuffer.isView&&ArrayBuffer.isView(n)&&(n=n.buffer),n instanceof ArrayBuffer){var R=n.byteLength;if(R<256)return f.setUint8(a,196),f.setUint8(a+1,R),new Uint8Array(f.buffer).set(new Uint8Array(n),a+2),2+R;if(R<65536)return f.setUint8(a,197),f.setUint16(a+1,R),new Uint8Array(f.buffer).set(new Uint8Array(n),a+3),3+R;if(R<4294967296)return f.setUint8(a,198),f.setUint32(a+1,R),new Uint8Array(f.buffer).set(new Uint8Array(n),a+5),5+R}if(typeof n=="number"){if(Math.floor(n)!==n)return f.setUint8(a,203),f.setFloat64(a+1,n),9;if(n>=0){if(n<128)return f.setUint8(a,n),1;if(n<256)return f.setUint8(a,204),f.setUint8(a+1,n),2;if(n<65536)return f.setUint8(a,205),f.setUint16(a+1,n),3;if(n<4294967296)return f.setUint8(a,206),f.setUint32(a+1,n),5;if(n<18446744073709552e3)return f.setUint8(a,207),g(f,a+1,n),9;throw new Error("Number too big 0x"+n.toString(16))}if(n>=-32)return f.setInt8(a,n),1;if(n>=-128)return f.setUint8(a,208),f.setInt8(a+1,n),2;if(n>=-32768)return f.setUint8(a,209),f.setInt16(a+1,n),3;if(n>=-2147483648)return f.setUint8(a,210),f.setInt32(a+1,n),5;if(n>=-9223372036854776e3)return f.setUint8(a,211),i(f,a+1,n),9;throw new Error("Number too small -0x"+(-n).toString(16).substr(1))}if(r==="undefined")return s?0:(f.setUint8(a,212),f.setUint8(a+1,0),f.setUint8(a+2,0),3);if(n===null)return s?0:(f.setUint8(a,192),1);if(r==="boolean")return f.setUint8(a,n?195:194),1;if(typeof n.toJSON=="function")return d(n.toJSON(),f,a,s);if(r==="object"){var P,U=0,D=void 0,M=Array.isArray(n);if(M?P=n.length:(D=p(n,s),P=D.length),P<16?(f.setUint8(a,P|(M?144:128)),U=1):P<65536?(f.setUint8(a,M?220:222),f.setUint16(a+1,P),U=3):P<4294967296&&(f.setUint8(a,M?221:223),f.setUint32(a+1,P),U=5),M)for(var A=0;A<P;A++)U+=d(n[A],f,a+U,s);else if(D)for(var A=0;A<P;A++){var E=D[A];U+=d(E,f,a+U),U+=d(n[E],f,a+U,s)}return U}if(r==="function")return 0;throw new Error("Unknown type "+r)}function b(n,f){var a=typeof n;if(a==="string"){var s=C(n);if(s<32)return 1+s;if(s<256)return 2+s;if(s<65536)return 3+s;if(s<4294967296)return 5+s}if(ArrayBuffer.isView&&ArrayBuffer.isView(n)&&(n=n.buffer),n instanceof ArrayBuffer){var r=n.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(typeof n=="number"){if(Math.floor(n)!==n)return 9;if(n>=0){if(n<128)return 1;if(n<256)return 2;if(n<65536)return 3;if(n<4294967296)return 5;if(n<18446744073709552e3)return 9;throw new Error("Number too big 0x"+n.toString(16))}if(n>=-32)return 1;if(n>=-128)return 2;if(n>=-32768)return 3;if(n>=-2147483648)return 5;if(n>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+n.toString(16).substr(1))}if(a==="boolean")return 1;if(n===null)return f?0:1;if(n===void 0)return f?0:3;if(typeof n.toJSON=="function")return b(n.toJSON(),f);if(a==="object"){var h,R=0;if(Array.isArray(n)){h=n.length;for(var P=0;P<h;P++)R+=b(n[P],f)}else{var U=p(n,f);h=U.length;for(var P=0;P<h;P++){var D=U[P];R+=b(D)+b(n[D],f)}}if(h<16)return 1+R;if(h<65536)return 3+R;if(h<4294967296)return 5+R;throw new Error("Array or object too long 0x"+h.toString(16))}if(a==="function")return 0;throw new Error("Unknown type "+a)}u.default={encode:o,decode:S,inspect:l,utf8Write:e,utf8Read:O,utf8ByteCount:C}},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(30)),O=l.__importDefault(t(49)),C=l.__importDefault(t(0)),o=l.__importDefault(t(55)),c=l.__importDefault(t(57)),m=l.__importDefault(t(62)),v=l.__importDefault(t(63)),y=l.__importDefault(t(67)),i=l.__importDefault(t(3)),g=t(8),T=l.__importDefault(t(25)),S=l.__importDefault(t(64)),p=l.__importDefault(t(65)),d=l.__importDefault(t(40)),b=l.__importDefault(t(9)),n=l.__importDefault(t(14));C.default.Crypto=c.default,C.default.BufferUtils=o.default,C.default.Http=m.default,C.default.Config=v.default,C.default.Transports=y.default,C.default.WebStorage=S.default,e.default.Crypto=c.default,O.default.Crypto=c.default,e.default.Message=b.default,O.default.Message=b.default,e.default.PresenceMessage=n.default,O.default.PresenceMessage=n.default,O.default.ConnectionManager=T.default,i.default.initLogHandlers(),C.default.Defaults=g.getDefaults(p.default),C.default.Config.agent&&(C.default.Defaults.agent+=" "+C.default.Config.agent),C.default.Config.noUpgrade&&(C.default.Defaults.upgradeTransports=[]),u.default={Rest:e.default,Realtime:O.default,msgpack:d.default}},function(x){x.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(31),t(23))})(this,function(l){return l.HmacSHA256})},function(x,u){},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(46)),C=l.__importDefault(t(24)),o=l.__importDefault(t(18)),c=l.__importDefault(t(5)),m=l.__importDefault(t(47)),v=function(){},y=function(){function S(p){this.rest=p,this.admin=new i(p)}return S}(),i=function(){function S(p){this.rest=p,this.deviceRegistrations=new g(p),this.channelSubscriptions=new T(p)}return S.prototype.publish=function(p,d,b){var n=this.rest,f=n.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,a=e.defaultPostHeaders(f),s={},r=e.mixin({recipient:p},d);if(typeof b!="function"){if(this.rest.options.promises)return e.promisify(this,"publish",arguments);b=v}n.options.headers&&e.mixin(a,n.options.headers),n.options.pushFullWait&&e.mixin(s,{fullWait:"true"});var h=e.encodeBody(r,f);C.default.post(n,"/push/publish",h,a,s,null,function(R){return b(R)})},S}(),g=function(){function S(p){this.rest=p}return S.prototype.save=function(p,d){var b=this.rest,n=O.default.fromValues(p),f=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,a=e.defaultPostHeaders(f),s={};if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"save",arguments);d=v}b.options.headers&&e.mixin(a,b.options.headers),b.options.pushFullWait&&e.mixin(s,{fullWait:"true"});var r=e.encodeBody(n,f);C.default.put(b,"/push/deviceRegistrations/"+encodeURIComponent(p.id),r,a,s,null,function(h,R,P,U){d(h,h?void 0:O.default.fromResponseBody(R,U?void 0:f))})},S.prototype.get=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=e.defaultGetHeaders(n),a=p.id||p;if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"get",arguments);d=v}if(typeof a!="string"||!a.length){d(new c.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}b.options.headers&&e.mixin(f,b.options.headers),C.default.get(b,"/push/deviceRegistrations/"+encodeURIComponent(a),f,{},null,function(s,r,h,R){d(s,s?void 0:O.default.fromResponseBody(r,R?void 0:n))})},S.prototype.list=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:n,a=e.defaultGetHeaders(n);if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"list",arguments);d=v}b.options.headers&&e.mixin(a,b.options.headers),new o.default(b,"/push/deviceRegistrations",a,f,function(s,r,h){return O.default.fromResponseBody(s,h?void 0:n)}).get(p,d)},S.prototype.remove=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=e.defaultGetHeaders(n),a={},s=p.id||p;if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"remove",arguments);d=v}if(typeof s!="string"||!s.length){d(new c.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}b.options.headers&&e.mixin(f,b.options.headers),b.options.pushFullWait&&e.mixin(a,{fullWait:"true"}),C.default.delete(b,"/push/deviceRegistrations/"+encodeURIComponent(s),f,a,null,function(r){return d(r)})},S.prototype.removeWhere=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=e.defaultGetHeaders(n);if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"removeWhere",arguments);d=v}b.options.headers&&e.mixin(f,b.options.headers),b.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),C.default.delete(b,"/push/deviceRegistrations",f,p,null,function(a){return d(a)})},S}(),T=function(){function S(p){this.remove=S.prototype.removeWhere,this.rest=p}return S.prototype.save=function(p,d){var b=this.rest,n=m.default.fromValues(p),f=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,a=e.defaultPostHeaders(f),s={};if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"save",arguments);d=v}b.options.headers&&e.mixin(a,b.options.headers),b.options.pushFullWait&&e.mixin(s,{fullWait:"true"});var r=e.encodeBody(n,f);C.default.post(b,"/push/channelSubscriptions",r,a,s,null,function(h,R,P,U){d(h,!h&&m.default.fromResponseBody(R,U?void 0:f))})},S.prototype.list=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:n,a=e.defaultGetHeaders(n);if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"list",arguments);d=v}b.options.headers&&e.mixin(a,b.options.headers),new o.default(b,"/push/channelSubscriptions",a,f,function(s,r,h){return m.default.fromResponseBody(s,h?void 0:n)}).get(p,d)},S.prototype.removeWhere=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=e.defaultGetHeaders(n);if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"removeWhere",arguments);d=v}b.options.headers&&e.mixin(f,b.options.headers),b.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),C.default.delete(b,"/push/channelSubscriptions",f,p,null,function(a){return d(a)})},S.prototype.listChannels=function(p,d){var b=this.rest,n=b.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:n,a=e.defaultGetHeaders(n);if(typeof d!="function"){if(this.rest.options.promises)return e.promisify(this,"listChannels",arguments);d=v}b.options.headers&&e.mixin(a,b.options.headers),b.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),new o.default(b,"/push/channels",a,f,function(s,r,h){for(var R=!h&&n?e.decodeBody(s,n):s,P=0;P<R.length;P++)R[P]=String(R[P]);return R}).get(p,d)},S}();u.default=y},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(5)),C;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(C||(C={}));var o;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(o||(o={}));var c=function(){function m(){}return m.prototype.toJSON=function(){var v,y,i;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(v=this.push)===null||v===void 0?void 0:v.recipient,state:(y=this.push)===null||y===void 0?void 0:y.state,error:(i=this.push)===null||i===void 0?void 0:i.error}}},m.prototype.toString=function(){var v,y,i,g,T="[DeviceDetails";return this.id&&(T+="; id="+this.id),this.platform&&(T+="; platform="+this.platform),this.formFactor&&(T+="; formFactor="+this.formFactor),this.clientId&&(T+="; clientId="+this.clientId),this.metadata&&(T+="; metadata="+this.metadata),this.deviceIdentityToken&&(T+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((v=this.push)===null||v===void 0)&&v.recipient&&(T+="; push.recipient="+JSON.stringify(this.push.recipient)),!((y=this.push)===null||y===void 0)&&y.state&&(T+="; push.state="+this.push.state),!((i=this.push)===null||i===void 0)&&i.error&&(T+="; push.error="+JSON.stringify(this.push.error)),!((g=this.push)===null||g===void 0)&&g.metadata&&(T+="; push.metadata="+this.push.metadata),T+="]",T},m.fromResponseBody=function(v,y){return y&&(v=e.decodeBody(v,y)),e.isArray(v)?m.fromValuesArray(v):m.fromValues(v)},m.fromValues=function(v){return v.error=v.error&&O.default.fromValues(v.error),Object.assign(new m,v)},m.fromValuesArray=function(v){for(var y=v.length,i=new Array(y),g=0;g<y;g++)i[g]=m.fromValues(v[g]);return i},m.toRequestBody=e.encodeBody,m}();u.default=c},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=function(){function C(){}return C.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},C.prototype.toString=function(){var o="[PushChannelSubscription";return this.channel&&(o+="; channel="+this.channel),this.deviceId&&(o+="; deviceId="+this.deviceId),this.clientId&&(o+="; clientId="+this.clientId),o+="]",o},C.fromResponseBody=function(o,c){return c&&(o=e.decodeBody(o,c)),e.isArray(o)?C.fromValuesArray(o):C.fromValues(o)},C.fromValues=function(o){return Object.assign(new C,o)},C.fromValuesArray=function(o){for(var c=o.length,m=new Array(c),v=0;v<c;v++)m[v]=C.fromValues(o[v]);return m},C.toRequestBody=e.encodeBody,C}();u.default=O},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=function(){function b(n){this.count=n&&n.count||0,this.data=n&&n.data||0,this.uncompressedData=n&&n.uncompressedData||0,this.failed=n&&n.failed||0,this.refused=n&&n.refused||0}return b}(),C=function(b){l.__extends(n,b);function n(f){var a=b.call(this,f)||this;return f&&f.category&&(a.category={},e.forInOwnNonNullProperties(f.category,function(s){a.category[s]=new O(f.category[s])})),a}return n}(O),o=function(){function b(n){this.peak=n&&n.peak||0,this.min=n&&n.min||0,this.mean=n&&n.mean||0,this.opened=n&&n.opened||0,this.refused=n&&n.refused||0}return b}(),c=function(){function b(n){this.succeeded=n&&n.succeeded||0,this.failed=n&&n.failed||0,this.refused=n&&n.refused||0}return b}(),m=function(){function b(n){this.plain=new o(n&&n.plain),this.tls=new o(n&&n.tls),this.all=new o(n&&n.all)}return b}(),v=function(){function b(n){this.messages=new C(n&&n.messages),this.presence=new C(n&&n.presence),this.all=new C(n&&n.all)}return b}(),y=function(){function b(n){this.realtime=new v(n&&n.realtime),this.rest=new v(n&&n.rest),this.webhook=new v(n&&n.webhook),this.sharedQueue=new v(n&&n.sharedQueue),this.externalQueue=new v(n&&n.externalQueue),this.httpEvent=new v(n&&n.httpEvent),this.push=new v(n&&n.push),this.all=new v(n&&n.all)}return b}(),i=function(){function b(n){this.all=new v(n&&n.all),this.inbound=new y(n&&n.inbound),this.outbound=new y(n&&n.outbound)}return b}(),g=function(){function b(n){this.all=new v(n&&n.all),this.producerPaid=new i(n&&n.producerPaid),this.consumerPaid=new i(n&&n.consumerPaid)}return b}(),T=function(){function b(n){this.messages=n&&n.messages||0;var f=n&&n.notifications;this.notifications={invalid:f&&f.invalid||0,attempted:f&&f.attempted||0,successful:f&&f.successful||0,failed:f&&f.failed||0},this.directPublishes=n&&n.directPublishes||0}return b}(),S=function(){function b(n){this.succeeded=n&&n.succeeded||0,this.skipped=n&&n.skipped||0,this.failed=n&&n.failed||0}return b}(),p=function(){function b(n){var f=this;this.delta=void 0,n&&n.delta&&(this.delta={},e.forInOwnNonNullProperties(n.delta,function(a){f.delta[a]=new S(n.delta[a])}))}return b}(),d=function(b){l.__extends(n,b);function n(f){var a=b.call(this,f)||this;return a.persisted=new v(f&&f.persisted),a.connections=new m(f&&f.connections),a.channels=new o(f&&f.channels),a.apiRequests=new c(f&&f.apiRequests),a.tokenRequests=new c(f&&f.tokenRequests),a.xchgProducer=new g(f&&f.xchgProducer),a.xchgConsumer=new g(f&&f.xchgConsumer),a.push=new T(f&&f.pushStats),a.processed=new p(f&&f.processed),a.inProgress=f&&f.inProgress||void 0,a.unit=f&&f.unit||void 0,a.intervalId=f&&f.intervalId||void 0,a}return n.fromValues=function(f){return new n(f)},n}(i);u.default=d},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(30)),C=l.__importDefault(t(7)),o=l.__importDefault(t(3)),c=l.__importDefault(t(50)),m=l.__importDefault(t(37)),v=l.__importDefault(t(8)),y=l.__importDefault(t(5)),i=l.__importDefault(t(10)),g=l.__importDefault(t(25)),T=l.__importDefault(t(0)),S=l.__importDefault(t(9)),p=function(b){l.__extends(n,b);function n(f){var a=b.call(this,f)||this;return o.default.logAction(o.default.LOG_MINOR,"Realtime()",""),a.connection=new c.default(a,a.options),a.channels=new d(a),f.autoConnect!==!1&&a.connect(),a}return n.prototype.connect=function(){o.default.logAction(o.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},n.prototype.close=function(){o.default.logAction(o.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},n.Promise=function(f){return f=v.default.objectifyOptions(f),f.promises=!0,new n(f)},n.Callbacks=n,n.Utils=e,n.ConnectionManager=g.default,n.Platform=T.default,n.ProtocolMessage=i.default,n.Message=S.default,n}(O.default),d=function(b){l.__extends(n,b);function n(f){var a=b.call(this)||this;return a.realtime=f,a.all={},a.inProgress={},f.connection.connectionManager.on("transport.active",function(){a.onTransportActive()}),a}return n.prototype.onChannelMessage=function(f){var a=f.channel;if(a===void 0){o.default.logAction(o.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+f.action);return}var s=this.all[a];if(!s){o.default.logAction(o.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+a);return}s.onMessage(f)},n.prototype.onTransportActive=function(){for(var f in this.all){var a=this.all[f];a.state==="attaching"||a.state==="detaching"?a.checkPendingState():a.state==="suspended"&&a.attach()}},n.prototype.reattach=function(f){for(var a in this.all){var s=this.all[a];s.state==="attached"&&s.requestState("attaching",f)}},n.prototype.resetAttachedMsgIndicators=function(){for(var f in this.all){var a=this.all[f];a.state==="attached"&&(a._attachedMsgIndicator=!1)}},n.prototype.checkAttachedMsgIndicators=function(f){for(var a in this.all){var s=this.all[a];if(s.state==="attached"&&s._attachedMsgIndicator===!1){var r="30s after a resume, found channel which has not received an attached; channelId = "+a+"; connectionId = "+f;o.default.logAction(o.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",r),s.requestState("attaching")}}},n.prototype.propogateConnectionInterruption=function(f,a){var s={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},r=["attaching","attached","detaching","suspended"],h=s[f];for(var R in this.all){var P=this.all[R];e.arrIn(r,P.state)&&P.notifyState(h,a)}},n.prototype.get=function(f,a){f=String(f);var s=this.all[f];if(!s)s=this.all[f]=new m.default(this.realtime,f,a);else if(a){if(s._shouldReattachToSetOptions(a))throw new y.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);s.setOptions(a)}return s},n.prototype.release=function(f){f=String(f);var a=this.all[f];if(!!a){var s=a.getReleaseErr();if(s)throw s;delete this.all[f],delete this.inProgress[f]}},n.prototype.setInProgress=function(f,a,s){this.inProgress[f.name]=this.inProgress[f.name]||{},this.inProgress[f.name][a]=s,!s&&this.hasNopending()&&this.emit("nopending")},n.prototype.onceNopending=function(f){if(this.hasNopending()){f();return}this.once("nopending",f)},n.prototype.hasNopending=function(){return e.arrEvery(e.valuesArray(this.inProgress,!0),function(f){return!e.containsValue(f,!0)})},n}(C.default);u.default=p},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(7)),C=l.__importDefault(t(25)),o=l.__importDefault(t(3)),c=l.__importDefault(t(36)),m=l.__importDefault(t(0));function v(){}var y=function(i){l.__extends(g,i);function g(T,S){var p=i.call(this)||this;return p.whenState=function(d,b){return O.default.prototype.whenState.call(p,d,p.state,b,new c.default(void 0,d))},p.ably=T,p.connectionManager=new C.default(T,S),p.state=p.connectionManager.state.state,p.key=void 0,p.id=void 0,p.serial=void 0,p.timeSerial=void 0,p.recoveryKey=void 0,p.errorReason=null,p.connectionManager.on("connectionstate",function(d){var b=p.state=d.current;m.default.Config.nextTick(function(){p.emit(b,d)})}),p.connectionManager.on("update",function(d){m.default.Config.nextTick(function(){p.emit("update",d)})}),p}return g.prototype.connect=function(){o.default.logAction(o.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},g.prototype.ping=function(T){if(o.default.logAction(o.default.LOG_MINOR,"Connection.ping()",""),!T){if(this.ably.options.promises)return e.promisify(this,"ping",arguments);T=v}this.connectionManager.ping(null,T)},g.prototype.close=function(){o.default.logAction(o.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},g}(O.default);u.default=y},function(x,u,t){"use strict";u.__esModule=!0,u.PendingMessage=void 0;var l=t(1),e=l.__importDefault(t(10)),O=l.__importStar(t(2)),C=l.__importDefault(t(7)),o=l.__importDefault(t(3)),c=l.__importDefault(t(35)),m=l.__importDefault(t(5)),v=e.default.Action,y=function(){function g(T,S){this.message=T,this.callback=S,this.merged=!1;var p=T.action;this.sendAttempted=!1,this.ackRequired=p==v.MESSAGE||p==v.PRESENCE}return g}();u.PendingMessage=y;var i=function(g){l.__extends(T,g);function T(S){var p=g.call(this)||this;return p.transport=S,p.messageQueue=new c.default,S.on("ack",function(d,b){p.onAck(d,b)}),S.on("nack",function(d,b,n){p.onNack(d,b,n)}),p}return T.prototype.onAck=function(S,p){o.default.logAction(o.default.LOG_MICRO,"Protocol.onAck()","serial = "+S+"; count = "+p),this.messageQueue.completeMessages(S,p)},T.prototype.onNack=function(S,p,d){o.default.logAction(o.default.LOG_ERROR,"Protocol.onNack()","serial = "+S+"; count = "+p+"; err = "+O.inspectError(d)),d||(d=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(S,p,d)},T.prototype.onceIdle=function(S){var p=this.messageQueue;if(p.count()===0){S();return}p.once("idle",S)},T.prototype.send=function(S){S.ackRequired&&this.messageQueue.push(S),o.default.shouldLog(o.default.LOG_MICRO)&&o.default.logAction(o.default.LOG_MICRO,"Protocol.send()","sending msg; "+e.default.stringify(S.message)),S.sendAttempted=!0,this.transport.send(S.message)},T.prototype.getTransport=function(){return this.transport},T.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},T.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},T.prototype.finish=function(){var S=this.transport;this.onceIdle(function(){S.disconnect()})},T}(C.default);u.default=i},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(0)),O=l.__importStar(t(2)),C=l.__importDefault(t(26)),o=l.__importDefault(t(8)),c=l.__importDefault(t(3)),m=l.__importDefault(t(10)),v=l.__importDefault(t(5)),y="web_socket";function i(S){return!!S.on}var g=function(S){l.__extends(p,S);function p(d,b,n){var f=S.call(this,d,b,n)||this;return f.shortName=y,n.heartbeats=e.default.Config.useProtocolHeartbeats,f.wsHost=o.default.getHost(n.options,n.host,!0),f}return p.isAvailable=function(){return!!e.default.Config.WebSocket},p.prototype.createWebSocket=function(d,b){var n=0;if(b)for(var f in b)d+=(n++?"&":"?")+f+"="+b[f];return this.uri=d,new e.default.Config.WebSocket(d)},p.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},p.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),C.default.prototype.connect.call(this);var d=this,b=this.params,n=b.options,f=n.tls?"wss://":"ws://",a=f+this.wsHost+":"+o.default.getPort(n)+"/";c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+a),this.auth.getAuthParams(function(s,r){if(!d.isDisposed){var h="";for(var R in r)h+=" "+R+": "+r[R]+";";if(c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+h+" err: "+s),s){d.disconnect(s);return}var P=b.getConnectParams(r);try{var U=d.wsConnection=d.createWebSocket(a,P);U.binaryType=e.default.Config.binaryType,U.onopen=function(){d.onWsOpen()},U.onclose=function(D){d.onWsClose(D)},U.onmessage=function(D){d.onWsData(D.data)},U.onerror=function(D){d.onWsError(D)},i(U)&&U.on("ping",function(){d.onActivity()})}catch(D){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(D.stack||D.message)),d.disconnect(D)}}})},p.prototype.send=function(d){var b=this.wsConnection;if(!b){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{b.send(m.default.serialize(d,this.params.format))}catch(f){var n="Exception from ws connection when trying to send: "+O.inspectError(f);c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()",n),this.finish("disconnected",new v.default(n,5e4,500))}},p.prototype.onWsData=function(d){c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+d.length+"; type = "+typeof d);try{this.onProtocolMessage(m.default.deserialize(d,this.format))}catch(b){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+b.stack)}},p.prototype.onWsOpen=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},p.prototype.onWsClose=function(d){var b,n;if(typeof d=="object"?(n=d.code,b=d.wasClean||n===1e3):(n=d,b=n==1e3),delete this.wsConnection,b){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var f=new v.default("Websocket closed",80003,400);this.finish("disconnected",f)}else{var a="Unclean disconnection of WebSocket ; code = "+n,f=new v.default(a,80003,400);c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()",a),this.finish("disconnected",f)}this.emit("disposed")},p.prototype.onWsError=function(d){var b=this;c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+d.message),e.default.Config.nextTick(function(){b.disconnect(Error(d.message))})},p.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var d=this.wsConnection;d&&(d.onmessage=function(){},delete this.wsConnection,e.default.Config.nextTick(function(){if(c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!d)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");d.close()}))},p}(C.default);function T(S){return g.isAvailable()&&(S.supportedTransports[y]=g),g}u.default=T},function(x,u,t){"use strict";u.__esModule=!0,u.isSuccessCode=void 0;var l;(function(O){O[O.Success=200]="Success",O[O.NoContent=204]="NoContent",O[O.BadRequest=400]="BadRequest",O[O.Unauthorized=401]="Unauthorized",O[O.Forbidden=403]="Forbidden",O[O.RequestTimeout=408]="RequestTimeout",O[O.InternalServerError=500]="InternalServerError"})(l||(l={}));function e(O){return O>=l.Success&&O<l.BadRequest}u.isSuccessCode=e,u.default=l},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importStar(t(2)),O=l.__importDefault(t(34)),C=l.__importDefault(t(7)),o=l.__importDefault(t(3)),c=l.__importDefault(t(14)),m=l.__importDefault(t(5)),v=l.__importDefault(t(37)),y=l.__importDefault(t(22)),i=l.__importDefault(t(38)),g=function(){};function T(a){return a.clientId+":"+a.connectionId}function S(a){return a.channel.realtime.auth.clientId}function p(a){var s=a.channel.realtime,r=s.auth.clientId;return(!r||r==="*")&&s.connection.state==="connected"}function d(a,s,r){switch(a.state){case"attached":case"suspended":r();break;case"initialized":case"detached":case"detaching":case"attaching":a.attach(function(h){h?s(h):r()});break;default:s(m.default.fromValues(v.default.invalidStateError(a.state)))}}function b(a,s){if(a.isSynthesized()||s.isSynthesized())return a.timestamp>s.timestamp;var r=a.parseId(),h=s.parseId();return r.msgSerial===h.msgSerial?r.index>h.index:r.msgSerial>h.msgSerial}var n=function(a){l.__extends(s,a);function s(r){var h=a.call(this,r)||this;return h.channel=r,h.syncComplete=!1,h.members=new f(h),h._myMembers=new f(h),h.subscriptions=new C.default,h.pendingPresence=[],h}return s.prototype.enter=function(r,h){if(p(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,r,"enter",h)},s.prototype.update=function(r,h){if(p(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,r,"update",h)},s.prototype.enterClient=function(r,h,R){return this._enterOrUpdateClient(r,h,"enter",R)},s.prototype.updateClient=function(r,h,R){return this._enterOrUpdateClient(r,h,"update",R)},s.prototype._enterOrUpdateClient=function(r,h,R,P){var U=this;if(!P)if(typeof h=="function")P=h,h=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"_enterOrUpdateClient",[r,h,R]);P=g}var D=this.channel;if(!D.connectionManager.activeState()){P(D.connectionManager.getError());return}o.default.logAction(o.default.LOG_MICRO,"RealtimePresence."+R+"Client()","channel = "+D.name+", client = "+(r||"(implicit) "+S(this)));var M=c.default.fromValues({action:R,data:h});r&&(M.clientId=r),c.default.encode(M,D.channelOptions,function(A){if(A){P(A);return}switch(D.state){case"attached":D.sendPresence(M,P);break;case"initialized":case"detached":D.attach();case"attaching":U.pendingPresence.push({presence:M,callback:P});break;default:A=new m.default("Unable to "+R+" presence channel while in "+D.state+" state",90001),A.code=90001,P(A)}})},s.prototype.leave=function(r,h){if(p(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,r,h)},s.prototype.leaveClient=function(r,h,R){if(!R)if(typeof h=="function")R=h,h=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"leaveClient",[r,h]);R=g}var P=this.channel;if(!P.connectionManager.activeState()){R==null||R(P.connectionManager.getError());return}o.default.logAction(o.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+r);var U=c.default.fromValues({action:"leave",data:h});switch(r&&(U.clientId=r),P.state){case"attached":P.sendPresence(U,R);break;case"attaching":this.pendingPresence.push({presence:U,callback:R});break;case"initialized":case"failed":{var D=new m.default("Unable to leave presence channel (incompatible state)",90001);R==null||R(D);break}default:R==null||R(v.default.invalidStateError(P.state))}},s.prototype.get=function(r,h){var R=this,P=Array.prototype.slice.call(arguments);P.length==1&&typeof P[0]=="function"&&P.unshift(null),r=P[0],h=P[1];var U=!r||("waitForSync"in r?r.waitForSync:!0);if(!h){if(this.channel.realtime.options.promises)return e.promisify(this,"get",P);h=g}function D(M){h(null,r?M.list(r):M.values())}if(this.channel.state==="suspended"){U?h(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):D(this.members);return}d(this.channel,h,function(){var M=R.members;U?M.waitSync(function(){D(M)}):D(M)})},s.prototype.history=function(r,h){if(o.default.logAction(o.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),h===void 0)if(typeof r=="function")h=r,r=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"history",arguments);h=g}r&&r.untilAttach&&(this.channel.state==="attached"?(delete r.untilAttach,r.from_serial=this.channel.properties.attachSerial):h(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),O.default.prototype._history.call(this,r,h)},s.prototype.setPresence=function(r,h,R){o.default.logAction(o.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+r.length+" participants; syncChannelSerial = "+R);var P,U,D=this.members,M=this._myMembers,A=[],E=this.channel.connectionManager.connectionId;h&&(this.members.startSync(),R&&(U=R.match(/^[\w-]+:(.*)$/))&&(P=U[1]));for(var B=0;B<r.length;B++){var N=c.default.fromValues(r[B]);switch(N.action){case"leave":D.remove(N)&&A.push(N),N.connectionId===E&&!N.isSynthesized()&&M.remove(N);break;case"enter":case"present":case"update":D.put(N)&&A.push(N),N.connectionId===E&&M.put(N);break}}h&&!P&&(D.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(v.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var B=0;B<A.length;B++){var N=A[B];this.subscriptions.emit(N.action,N)}},s.prototype.onAttached=function(r){o.default.logAction(o.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+r),r?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var h=this.pendingPresence,R=h.length;if(R){this.pendingPresence=[];var P=[],U=y.default.create();o.default.logAction(o.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+R+" queued presence messages");for(var D=0;D<R;D++){var M=h[D];P.push(M.presence),U.push(M.callback)}this.channel.sendPresence(P,U)}},s.prototype.actOnChannelState=function(r,h,R){switch(r){case"attached":this.onAttached(h);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(R);break}},s.prototype.failPendingPresence=function(r){if(this.pendingPresence.length){o.default.logAction(o.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+e.inspectError(r));for(var h=0;h<this.pendingPresence.length;h++)try{this.pendingPresence[h].callback(r)}catch(R){}this.pendingPresence=[]}},s.prototype._clearMyMembers=function(){this._myMembers.clear()},s.prototype._ensureMyMembersPresent=function(){var r=this,h=this.members,R=this._myMembers,P=function(M){if(M){var A="Presence auto-re-enter failed: "+M.toString(),E=new m.default(A,91004,400);o.default.logAction(o.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",A);var B=new i.default(r.channel.state,r.channel.state,!0,E);r.channel.emit("update",B)}};for(var U in R.map)if(!(U in h.map)){var D=R.map[U];o.default.logAction(o.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+D.clientId+'" into the presence set'),this._enterOrUpdateClient(D.clientId,D.data,"enter",P),delete R.map[U]}},s.prototype._synthesizeLeaves=function(r){var h=this.subscriptions;e.arrForEach(r,function(R){var P=c.default.fromValues({action:"leave",connectionId:R.connectionId,clientId:R.clientId,data:R.data,encoding:R.encoding,timestamp:e.now()});h.emit("leave",P)})},s.prototype.on=function(){for(var r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];o.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,r)},s.prototype.off=function(){for(var r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];o.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,r)},s.prototype.subscribe=function(){for(var r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];var R=v.default.processListenerArgs(r),P=R[0],U=R[1],D=R[2],M=this.channel;if(!D){if(this.channel.realtime.options.promises)return e.promisify(this,"subscribe",[P,U]);D=g}if(M.state==="failed"){D(m.default.fromValues(v.default.invalidStateError("failed")));return}this.subscriptions.on(P,U),M.attach(D)},s.prototype.unsubscribe=function(){for(var r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];var R=v.default.processListenerArgs(r),P=R[0],U=R[1];this.subscriptions.off(P,U)},s}(O.default),f=function(a){l.__extends(s,a);function s(r){var h=a.call(this)||this;return h.presence=r,h.map={},h.syncInProgress=!1,h.residualMembers=null,h}return s.prototype.get=function(r){return this.map[r]},s.prototype.getClient=function(r){var h=this.map,R=[];for(var P in h){var U=h[P];U.clientId==r&&U.action!="absent"&&R.push(U)}return R},s.prototype.list=function(r){var h=this.map,R=r&&r.clientId,P=r&&r.connectionId,U=[];for(var D in h){var M=h[D];M.action!=="absent"&&(R&&R!=M.clientId||P&&P!=M.connectionId||U.push(M))}return U},s.prototype.put=function(r){(r.action==="enter"||r.action==="update")&&(r=c.default.fromValues(r),r.action="present");var h=this.map,R=T(r);this.residualMembers&&delete this.residualMembers[R];var P=h[R];return P&&!b(r,P)?!1:(h[R]=r,!0)},s.prototype.values=function(){var r=this.map,h=[];for(var R in r){var P=r[R];P.action!="absent"&&h.push(P)}return h},s.prototype.remove=function(r){var h=this.map,R=T(r),P=h[R];return P&&!b(r,P)?!1:(this.syncInProgress?(r=c.default.fromValues(r),r.action="absent",h[R]=r):delete h[R],!0)},s.prototype.startSync=function(){var r=this.map,h=this.syncInProgress;o.default.logAction(o.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),this.syncInProgress||(this.residualMembers=e.copy(r),this.setInProgress(!0))},s.prototype.endSync=function(){var r=this.map,h=this.syncInProgress;if(o.default.logAction(o.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),h){for(var R in r){var P=r[R];P.action==="absent"&&delete r[R]}this.presence._synthesizeLeaves(e.valuesArray(this.residualMembers));for(var U in this.residualMembers)delete r[U];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},s.prototype.waitSync=function(r){var h=this.syncInProgress;if(o.default.logAction(o.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),!h){r();return}this.once("sync",r)},s.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},s.prototype.setInProgress=function(r){o.default.logAction(o.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+r),this.syncInProgress=r,this.presence.syncComplete=!r},s}(C.default);u.default=n},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=t(56),O=t(32),C=t(13),o=l.__importDefault(t(4)),c=l.__importDefault(t(0)),m=function(){function v(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return v.prototype.isWordArray=function(y){return y!=null&&y.sigBytes!==void 0},v.prototype.isArrayBuffer=function(y){return y!=null&&y.constructor===ArrayBuffer},v.prototype.isTypedArray=function(y){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(y)},v.prototype.uint8ViewToBase64=function(y){for(var i="",g=this.base64CharSet,T=y.byteLength,S=T%3,p=T-S,d,b,n,f,a,s=0;s<p;s=s+3)a=y[s]<<16|y[s+1]<<8|y[s+2],d=(a&16515072)>>18,b=(a&258048)>>12,n=(a&4032)>>6,f=a&63,i+=g[d]+g[b]+g[n]+g[f];return S==1?(a=y[p],d=(a&252)>>2,b=(a&3)<<4,i+=g[d]+g[b]+"=="):S==2&&(a=y[p]<<8|y[p+1],d=(a&64512)>>10,b=(a&1008)>>4,n=(a&15)<<2,i+=g[d]+g[b]+g[n]+"="),i},v.prototype.base64ToArrayBuffer=function(y){for(var i=atob==null?void 0:atob(y),g=i.length,T=new Uint8Array(g),S=0;S<g;S++){var p=i.charCodeAt(S);T[S]=p}return T.buffer},v.prototype.isBuffer=function(y){return this.isArrayBuffer(y)||this.isWordArray(y)||this.isTypedArray(y)},v.prototype.toBuffer=function(y){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(y))return new Uint8Array(y);if(this.isTypedArray(y))return new Uint8Array(y.buffer);if(this.isWordArray(y)){for(var i=new ArrayBuffer(y.sigBytes),g=new Uint8Array(i),T=0;T<y.sigBytes;T++)g[T]=y.words[T>>>2]>>>24-T%4*8&255;return g}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},v.prototype.toArrayBuffer=function(y){return this.isArrayBuffer(y)?y:this.toBuffer(y).buffer},v.prototype.toWordArray=function(y){return this.isTypedArray(y)&&(y=y.buffer),this.isWordArray(y)?y:o.default.create(y)},v.prototype.base64Encode=function(y){return this.isWordArray(y)?C.stringify(y):this.uint8ViewToBase64(this.toBuffer(y))},v.prototype.base64Decode=function(y){return ArrayBuffer&&c.default.Config.atob?this.base64ToArrayBuffer(y):C.parse(y)},v.prototype.hexEncode=function(y){return e.stringify(this.toWordArray(y))},v.prototype.hexDecode=function(y){var i=e.parse(y);return ArrayBuffer?this.toArrayBuffer(i):i},v.prototype.utf8Encode=function(y){return TextEncoder?new TextEncoder().encode(y).buffer:O.parse(y)},v.prototype.utf8Decode=function(y){if(!this.isBuffer(y))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(y)?new TextDecoder().decode(y):(y=this.toWordArray(y),O.stringify(y))},v.prototype.bufferCompare=function(y,i){if(!y)return-1;if(!i)return 1;var g=this.toWordArray(y),T=this.toWordArray(i);g.clamp(),T.clamp();var S=g.sigBytes-T.sigBytes;if(S!=0)return S;for(var p=g.words,d=T.words,b=0;b<p.length;b++)if(S=p[b]-d[b],S!=0)return S;return 0},v.prototype.byteLength=function(y){return this.isArrayBuffer(y)||this.isTypedArray(y)?y.byteLength:this.isWordArray(y)?y.sigBytes:-1},v.prototype.typedArrayToBuffer=function(y){return y.buffer},v}();u.default=new m},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return l.enc.Hex})},function(x,u,t){"use strict";t.r(u);var l=t(4),e=t.n(l),O=t(13),C=t.n(O),o=t(21),c=t.n(o),m=t(0),v=t.n(m),y=t(3),i=t.n(y),g=function(){var T="aes",S=256,p="cbc",d=16,b=4,n=4294967296,f=2147483648,a;if(v.a.getRandomWordArray)a=v.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&v.a.getRandomValues){var s=new Uint32Array(b);a=function(A,E){var B=A/4,N=B==b?s:new Uint32Array(B);v.a.getRandomValues(N,function(G){E(G,v.a.BufferUtils.toWordArray(N))})}}else a=function(A,E){i.a.logAction(i.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var B=A/4,N=new Array(B),G=0;G<B;G++)N[G]=Math.floor(Math.random()*n)-f;E(null,e.a.create(N))};function r(A){return A+d&-d}function h(A){if(A.algorithm==="aes"&&A.mode==="cbc"){if(A.keyLength===128||A.keyLength===256)return;throw new Error("Unsupported key length "+A.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function R(A){return A.replace("_","/").replace("-","+")}var P=[e.a.create([269488144,269488144,269488144,269488144],16),e.a.create([16777216],1),e.a.create([33685504],2),e.a.create([50529024],3),e.a.create([67372036],4),e.a.create([84215045,83886080],5),e.a.create([101058054,101056512],6),e.a.create([117901063,117901056],7),e.a.create([134744072,134744072],8),e.a.create([151587081,151587081,150994944],9),e.a.create([168430090,168430090,168427520],10),e.a.create([185273099,185273099,185273088],11),e.a.create([202116108,202116108,202116108],12),e.a.create([218959117,218959117,218959117,218103808],13),e.a.create([235802126,235802126,235802126,235798528],14),e.a.create([252645135,252645135,252645135,252645135],15),e.a.create([269488144,269488144,269488144,269488144],16)];function U(){}function D(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}U.CipherParams=D,U.getDefaultParams=function(A){var E;if(typeof A=="function"||typeof A=="string"){if(i.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof A=="function")U.generateRandomKey(function(N){A(null,U.getDefaultParams({key:N}))});else if(typeof arguments[1]=="function")arguments[1](null,U.getDefaultParams({key:A}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!A.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof A.key=="string"?E=Object(O.parse)(R(A.key)):E=v.a.BufferUtils.toWordArray(A.key);var B=new D;if(B.key=E,B.algorithm=A.algorithm||T,B.keyLength=E.words.length*(4*8),B.mode=A.mode||p,A.keyLength&&A.keyLength!==B.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+A.keyLength+" was specified, but the key actually has length "+B.keyLength);return h(B),B},U.generateRandomKey=function(A,E){arguments.length==1&&typeof A=="function"&&(E=A,A=void 0),a((A||S)/8,E)},U.getCipher=function(A){var E=A instanceof D?A:U.getDefaultParams(A);return{cipherParams:E,cipher:new M(E,b,A.iv)}};function M(A,E,B){this.algorithm=A.algorithm+"-"+String(A.keyLength)+"-"+A.mode,this.cjsAlgorithm=A.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=v.a.BufferUtils.toWordArray(A.key),B&&(this.iv=v.a.BufferUtils.toWordArray(B).clone()),this.blockLengthWords=E}return M.prototype.encrypt=function(A,E){i.a.logAction(i.a.LOG_MICRO,"CBCCipher.encrypt()",""),A=v.a.BufferUtils.toWordArray(A);var B=A.sigBytes,N=r(B),G=this,H=function(){G.getIv(function(k,L){if(k){E(k);return}var I=G.encryptCipher.process(A.concat(P[N-B])),w=L.concat(I);E(null,w)})};this.encryptCipher?H():this.iv?(this.encryptCipher=c.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),H()):a(d,function(k,L){if(k){E(k);return}G.encryptCipher=c.a.algo[G.cjsAlgorithm].createEncryptor(G.key,{iv:L}),G.iv=L,H()})},M.prototype.decrypt=function(A){i.a.logAction(i.a.LOG_MICRO,"CBCCipher.decrypt()",""),A=v.a.BufferUtils.toWordArray(A);var E=this.blockLengthWords,B=A.words,N=e.a.create(B.slice(0,E)),G=e.a.create(B.slice(E)),H=c.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:N}),k=H.process(G),L=H.finalize();return H.reset(),L&&L.sigBytes&&k.concat(L),k},M.prototype.getIv=function(A){if(this.iv){var E=this.iv;this.iv=null,A(null,E);return}var B=this;a(d,function(N,G){if(N){A(N);return}A(null,B.encryptCipher.process(G))})},U}();u.default=g},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(){var e=l,O=e.lib,C=O.WordArray,o=e.enc,c=o.Utf16=o.Utf16BE={stringify:function(v){for(var y=v.words,i=v.sigBytes,g=[],T=0;T<i;T+=2){var S=y[T>>>2]>>>16-T%4*8&65535;g.push(String.fromCharCode(S))}return g.join("")},parse:function(v){for(var y=v.length,i=[],g=0;g<y;g++)i[g>>>1]|=v.charCodeAt(g)<<16-g%2*16;return C.create(i,y*2)}};o.Utf16LE={stringify:function(v){for(var y=v.words,i=v.sigBytes,g=[],T=0;T<i;T+=2){var S=m(y[T>>>2]>>>16-T%4*8&65535);g.push(String.fromCharCode(S))}return g.join("")},parse:function(v){for(var y=v.length,i=[],g=0;g<y;g++)i[g>>>1]|=m(v.charCodeAt(g)<<16-g%2*16);return C.create(i,y*2)}};function m(v){return v<<8&4278255360|v>>>8&16711935}}(),l.enc.Utf16})},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(28))})(this,function(l){return function(e){var O=l,C=O.lib,o=C.CipherParams,c=O.enc,m=c.Hex,v=O.format,y=v.Hex={stringify:function(i){return i.ciphertext.toString(m)},parse:function(i){var g=m.parse(i);return o.create({ciphertext:g})}}}(),l.format.Hex})},function(x,u,t){(function(l,e){x.exports=u=e(t(6),t(13),t(61),t(27),t(28))})(this,function(l){return function(){var e=l,O=e.lib,C=O.BlockCipher,o=e.algo,c=[],m=[],v=[],y=[],i=[],g=[],T=[],S=[],p=[],d=[];(function(){for(var f=[],a=0;a<256;a++)a<128?f[a]=a<<1:f[a]=a<<1^283;for(var s=0,r=0,a=0;a<256;a++){var h=r^r<<1^r<<2^r<<3^r<<4;h=h>>>8^h&255^99,c[s]=h,m[h]=s;var R=f[s],P=f[R],U=f[P],D=f[h]*257^h*16843008;v[s]=D<<24|D>>>8,y[s]=D<<16|D>>>16,i[s]=D<<8|D>>>24,g[s]=D;var D=U*16843009^P*65537^R*257^s*16843008;T[h]=D<<24|D>>>8,S[h]=D<<16|D>>>16,p[h]=D<<8|D>>>24,d[h]=D,s?(s=R^f[f[f[U^R]]],r^=f[f[r]]):s=r=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],n=o.AES=C.extend({_doReset:function(){var f;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var a=this._keyPriorReset=this._key,s=a.words,r=a.sigBytes/4,h=this._nRounds=r+6,R=(h+1)*4,P=this._keySchedule=[],U=0;U<R;U++)U<r?P[U]=s[U]:(f=P[U-1],U%r?r>6&&U%r==4&&(f=c[f>>>24]<<24|c[f>>>16&255]<<16|c[f>>>8&255]<<8|c[f&255]):(f=f<<8|f>>>24,f=c[f>>>24]<<24|c[f>>>16&255]<<16|c[f>>>8&255]<<8|c[f&255],f^=b[U/r|0]<<24),P[U]=P[U-r]^f);for(var D=this._invKeySchedule=[],M=0;M<R;M++){var U=R-M;if(M%4)var f=P[U];else var f=P[U-4];M<4||U<=4?D[M]=f:D[M]=T[c[f>>>24]]^S[c[f>>>16&255]]^p[c[f>>>8&255]]^d[c[f&255]]}}},encryptBlock:function(f,a){this._doCryptBlock(f,a,this._keySchedule,v,y,i,g,c)},decryptBlock:function(f,a){var s=f[a+1];f[a+1]=f[a+3],f[a+3]=s,this._doCryptBlock(f,a,this._invKeySchedule,T,S,p,d,m);var s=f[a+1];f[a+1]=f[a+3],f[a+3]=s},_doCryptBlock:function(f,a,s,r,h,R,P,U){for(var D=this._nRounds,M=f[a]^s[0],A=f[a+1]^s[1],E=f[a+2]^s[2],B=f[a+3]^s[3],N=4,G=1;G<D;G++){var H=r[M>>>24]^h[A>>>16&255]^R[E>>>8&255]^P[B&255]^s[N++],k=r[A>>>24]^h[E>>>16&255]^R[B>>>8&255]^P[M&255]^s[N++],L=r[E>>>24]^h[B>>>16&255]^R[M>>>8&255]^P[A&255]^s[N++],I=r[B>>>24]^h[M>>>16&255]^R[A>>>8&255]^P[E&255]^s[N++];M=H,A=k,E=L,B=I}var H=(U[M>>>24]<<24|U[A>>>16&255]<<16|U[E>>>8&255]<<8|U[B&255])^s[N++],k=(U[A>>>24]<<24|U[E>>>16&255]<<16|U[B>>>8&255]<<8|U[M&255])^s[N++],L=(U[E>>>24]<<24|U[B>>>16&255]<<16|U[M>>>8&255]<<8|U[A&255])^s[N++],I=(U[B>>>24]<<24|U[M>>>16&255]<<16|U[A>>>8&255]<<8|U[E&255])^s[N++];f[a]=H,f[a+1]=k,f[a+2]=L,f[a+3]=I},keySize:256/32});e.AES=C._createHelper(n)}(),l.AES})},function(x,u,t){(function(l,e){x.exports=u=e(t(6))})(this,function(l){return function(e){var O=l,C=O.lib,o=C.WordArray,c=C.Hasher,m=O.algo,v=[];(function(){for(var p=0;p<64;p++)v[p]=e.abs(e.sin(p+1))*4294967296|0})();var y=m.MD5=c.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,d){for(var b=0;b<16;b++){var n=d+b,f=p[n];p[n]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360}var a=this._hash.words,s=p[d+0],r=p[d+1],h=p[d+2],R=p[d+3],P=p[d+4],U=p[d+5],D=p[d+6],M=p[d+7],A=p[d+8],E=p[d+9],B=p[d+10],N=p[d+11],G=p[d+12],H=p[d+13],k=p[d+14],L=p[d+15],I=a[0],w=a[1],_=a[2],F=a[3];I=i(I,w,_,F,s,7,v[0]),F=i(F,I,w,_,r,12,v[1]),_=i(_,F,I,w,h,17,v[2]),w=i(w,_,F,I,R,22,v[3]),I=i(I,w,_,F,P,7,v[4]),F=i(F,I,w,_,U,12,v[5]),_=i(_,F,I,w,D,17,v[6]),w=i(w,_,F,I,M,22,v[7]),I=i(I,w,_,F,A,7,v[8]),F=i(F,I,w,_,E,12,v[9]),_=i(_,F,I,w,B,17,v[10]),w=i(w,_,F,I,N,22,v[11]),I=i(I,w,_,F,G,7,v[12]),F=i(F,I,w,_,H,12,v[13]),_=i(_,F,I,w,k,17,v[14]),w=i(w,_,F,I,L,22,v[15]),I=g(I,w,_,F,r,5,v[16]),F=g(F,I,w,_,D,9,v[17]),_=g(_,F,I,w,N,14,v[18]),w=g(w,_,F,I,s,20,v[19]),I=g(I,w,_,F,U,5,v[20]),F=g(F,I,w,_,B,9,v[21]),_=g(_,F,I,w,L,14,v[22]),w=g(w,_,F,I,P,20,v[23]),I=g(I,w,_,F,E,5,v[24]),F=g(F,I,w,_,k,9,v[25]),_=g(_,F,I,w,R,14,v[26]),w=g(w,_,F,I,A,20,v[27]),I=g(I,w,_,F,H,5,v[28]),F=g(F,I,w,_,h,9,v[29]),_=g(_,F,I,w,M,14,v[30]),w=g(w,_,F,I,G,20,v[31]),I=T(I,w,_,F,U,4,v[32]),F=T(F,I,w,_,A,11,v[33]),_=T(_,F,I,w,N,16,v[34]),w=T(w,_,F,I,k,23,v[35]),I=T(I,w,_,F,r,4,v[36]),F=T(F,I,w,_,P,11,v[37]),_=T(_,F,I,w,M,16,v[38]),w=T(w,_,F,I,B,23,v[39]),I=T(I,w,_,F,H,4,v[40]),F=T(F,I,w,_,s,11,v[41]),_=T(_,F,I,w,R,16,v[42]),w=T(w,_,F,I,D,23,v[43]),I=T(I,w,_,F,E,4,v[44]),F=T(F,I,w,_,G,11,v[45]),_=T(_,F,I,w,L,16,v[46]),w=T(w,_,F,I,h,23,v[47]),I=S(I,w,_,F,s,6,v[48]),F=S(F,I,w,_,M,10,v[49]),_=S(_,F,I,w,k,15,v[50]),w=S(w,_,F,I,U,21,v[51]),I=S(I,w,_,F,G,6,v[52]),F=S(F,I,w,_,R,10,v[53]),_=S(_,F,I,w,B,15,v[54]),w=S(w,_,F,I,r,21,v[55]),I=S(I,w,_,F,A,6,v[56]),F=S(F,I,w,_,L,10,v[57]),_=S(_,F,I,w,D,15,v[58]),w=S(w,_,F,I,H,21,v[59]),I=S(I,w,_,F,P,6,v[60]),F=S(F,I,w,_,N,10,v[61]),_=S(_,F,I,w,h,15,v[62]),w=S(w,_,F,I,E,21,v[63]),a[0]=a[0]+I|0,a[1]=a[1]+w|0,a[2]=a[2]+_|0,a[3]=a[3]+F|0},_doFinalize:function(){var p=this._data,d=p.words,b=this._nDataBytes*8,n=p.sigBytes*8;d[n>>>5]|=128<<24-n%32;var f=e.floor(b/4294967296),a=b;d[(n+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,d[(n+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360,p.sigBytes=(d.length+1)*4,this._process();for(var s=this._hash,r=s.words,h=0;h<4;h++){var R=r[h];r[h]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return s},clone:function(){var p=c.clone.call(this);return p._hash=this._hash.clone(),p}});function i(p,d,b,n,f,a,s){var r=p+(d&b|~d&n)+f+s;return(r<<a|r>>>32-a)+d}function g(p,d,b,n,f,a,s){var r=p+(d&n|b&~n)+f+s;return(r<<a|r>>>32-a)+d}function T(p,d,b,n,f,a,s){var r=p+(d^b^n)+f+s;return(r<<a|r>>>32-a)+d}function S(p,d,b,n,f,a,s){var r=p+(b^(d|~n))+f+s;return(r<<a|r>>>32-a)+d}O.MD5=c._createHelper(y),O.HmacMD5=c._createHmacHelper(y)}(Math),l.MD5})},function(x,u,t){"use strict";var l;u.__esModule=!0;var e=t(1),O=e.__importDefault(t(0)),C=e.__importStar(t(2)),o=e.__importDefault(t(8)),c=e.__importDefault(t(5)),m=e.__importDefault(t(17)),v=e.__importDefault(t(15)),y=e.__importDefault(t(20)),i=e.__importDefault(t(3)),g=t(29);function T(d){var b=d.statusCode;return b===408&&!d.code||b===400&&!d.code||b>=500&&b<=504}function S(d){var b=d.connection,n=b&&b.connectionManager.host;return n?[n].concat(o.default.getFallbackHosts(d.options)):o.default.getHosts(d.options)}var p=(l=function(){function d(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=S,O.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(b,n,f,a,s,r,h){var R=v.default.createRequest(f,a,s,r,y.default.REQ_SEND,n&&n.options.timeouts,b);return R.once("complete",h),R.exec(),R},this.checkConnectivity=function(b){var n=o.default.internetUpUrl;i.default.logAction(i.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+n),this.doUri(m.default.Get,null,n,null,null,null,function(f,a){var s,r=!f&&((s=a)===null||s===void 0?void 0:s.replace(/\n/,""))=="yes";i.default.logAction(i.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+r),b(null,r)})}):O.default.Config.jsonpSupported&&(this.Request=function(b,n,f,a,s,r,h){var R=g.createRequest(f,a,s,r,y.default.REQ_SEND,n&&n.options.timeouts,b);return R.once("complete",h),O.default.Config.nextTick(function(){R.exec()}),R},this.checkConnectivity=function(b){var n=this,f=o.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(b);return}this.checksInProgress=[b],i.default.logAction(i.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+f);var a=new g.Request("isTheInternetUp",f,null,null,null,y.default.REQ_SEND,o.default.TIMEOUTS);a.once("complete",function(s,r){var h=!s&&r;i.default.logAction(i.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+h);for(var R=0;R<n.checksInProgress.length;R++)n.checksInProgress[R](null,h);n.checksInProgress=null}),O.default.Config.nextTick(function(){a.exec()})})}return d.prototype.do=function(b,n,f,a,s,r,h){var R=this,P=typeof f=="function"?f:function(A){return n.baseUri(A)+f},U=n._currentFallback;if(U)if(U.validUntil>C.now()){if(!this.Request){h==null||h(new c.default("Request invoked before assigned to",null,500));return}this.Request(b,n,P(U.host),a,r,s,function(A){for(var E=[],B=1;B<arguments.length;B++)E[B-1]=arguments[B];if(A&&T(A)){n._currentFallback=null,R.do(b,n,f,a,s,r,h);return}h==null||h.apply(void 0,e.__spreadArray([A],E))});return}else n._currentFallback=null;var D=S(n);if(D.length===1){this.doUri(b,n,P(D[0]),a,s,r,h);return}var M=function(A,E){var B=A.shift();R.doUri(b,n,P(B),a,s,r,function(N){for(var G=[],H=1;H<arguments.length;H++)G[H-1]=arguments[H];if(N&&T(N)&&A.length){M(A,!0);return}E&&(n._currentFallback={host:B,validUntil:C.now()+n.options.timeouts.fallbackRetryTimeout}),h==null||h.apply(void 0,e.__spreadArray([N],G))})};M(D)},d.prototype.doUri=function(b,n,f,a,s,r,h){if(!this.Request){h(new c.default("Request invoked before assigned to",null,500));return}this.Request(b,n,f,a,r,s,h)},d}(),l.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],l.methodsWithoutBody=[m.default.Get,m.default.Delete],l.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],l);u.default=p},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(40)),O=l.__importStar(t(2)),C=O.getGlobalObject();function o(){var y=C.location;return!C.WebSocket||!y||!y.origin||y.origin.indexOf("http")>-1}var c=C.navigator&&C.navigator.userAgent.toString(),m=C.location&&C.location.href,v={agent:"browser",logTimestamps:!0,userAgent:c,currentUrl:m,noUpgrade:c&&!!c.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:C.WebSocket,xhrSupported:C.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:o(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:e.default,supportsBinary:!!C.TextDecoder,preferBinary:!1,ArrayBuffer:C.ArrayBuffer,atob:C.atob,nextTick:typeof C.setImmediate!="undefined"?C.setImmediate.bind(C):function(y){setTimeout(y,0)},addEventListener:C.addEventListener,inspect:JSON.stringify,stringByteSize:function(y){return C.TextDecoder&&new C.TextEncoder().encode(y).length||y.length},TextEncoder:C.TextEncoder,TextDecoder:C.TextDecoder,Promise:C.Promise,getRandomValues:function(y){if(y!==void 0)return function(i,g){y.getRandomValues(i),g&&g(null)}}(C.crypto||msCrypto)};u.default=v},function(x,u,t){"use strict";(function(l){u.__esModule=!0;var e=t(1),O=e.__importStar(t(2)),C="ablyjs-storage-test",o=function(){function c(){try{l.sessionStorage.setItem(C,C),l.sessionStorage.removeItem(C),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{l.localStorage.setItem(C,C),l.localStorage.removeItem(C),this.localSupported=!0}catch(m){this.localSupported=!1}}return c.prototype.get=function(m){return this._get(m,!1)},c.prototype.getSession=function(m){return this._get(m,!0)},c.prototype.remove=function(m){return this._remove(m,!1)},c.prototype.removeSession=function(m){return this._remove(m,!0)},c.prototype.set=function(m,v,y){return this._set(m,v,y,!1)},c.prototype.setSession=function(m,v,y){return this._set(m,v,y,!0)},c.prototype._set=function(m,v,y,i){var g={value:v};return y&&(g.expires=O.now()+y),this.storageInterface(i).setItem(m,JSON.stringify(g))},c.prototype._get=function(m,v){if(v&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!v&&!this.localSupported)throw new Error("Local Storage not supported");var y=this.storageInterface(v).getItem(m);if(!y)return null;var i=JSON.parse(y);return i.expires&&i.expires<O.now()?(this.storageInterface(v).removeItem(m),null):i.value},c.prototype._remove=function(m,v){return this.storageInterface(v).removeItem(m)},c.prototype.storageInterface=function(m){return m?l.sessionStorage:l.localStorage},c}();u.default=new o}).call(this,t(12))},function(x,u,t){"use strict";u.__esModule=!0;var l=t(1),e=l.__importDefault(t(66)),O={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[e.default.XhrPolling,e.default.XhrStreaming,e.default.JsonP,e.default.WebSocket],baseTransportOrder:[e.default.XhrPolling,e.default.XhrStreaming,e.default.JsonP,e.default.WebSocket],transportPreferenceOrder:[e.default.JsonP,e.default.XhrPolling,e.default.XhrStreaming,e.default.WebSocket],upgradeTransports:[e.default.XhrStreaming,e.default.WebSocket]};u.default=O},function(x,u,t){"use strict";u.__esModule=!0;var l;(function(e){e.WebSocket="web_socket",e.Comet="comet",e.XhrStreaming="xhr_streaming",e.XhrPolling="xhr_polling",e.JsonP="jsonp"})(l||(l={})),u.default=l},function(x,u,t){"use strict";t.r(u);var l=t(29),e=t.n(l),O=t(2),C=t(0),o=t.n(C),c=t(11),m=t.n(c),v=t(15),y=t.n(v),i=function(d){var b="xhr_polling";function n(f,a,s){s.stream=!1,m.a.call(this,f,a,s),this.shortName=b}return O.inherits(n,m.a),n.isAvailable=function(){return o.a.Config.xhrSupported&&o.a.Config.allowComet},n.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(f,a,s,r,h){return y.a.createRequest(f,a,s,r,h,this.timeouts)},typeof d!="undefined"&&n.isAvailable()&&(d.supportedTransports[b]=n),n},g=i,T=function(d){var b="xhr_streaming";function n(f,a,s){m.a.call(this,f,a,s),this.shortName=b}return O.inherits(n,m.a),n.isAvailable=function(){return o.a.Config.xhrSupported&&o.a.Config.streamingSupported&&o.a.Config.allowComet},n.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(f,a,s,r,h){return y.a.createRequest(f,a,s,r,h,this.timeouts)},typeof d!="undefined"&&n.isAvailable()&&(d.supportedTransports[b]=n),n},S=T,p=u.default=[e.a,g,S]}]).default})});var Ye=it((Pt,ne)=>{V();(function(x,u){typeof Pt=="object"&&typeof ne=="object"?ne.exports=u():typeof define=="function"&&define.amd?define([],u):typeof Pt=="object"?Pt.bowser=u():x.bowser=u()})(Pt,function(){return function(x){var u={};function t(l){if(u[l])return u[l].exports;var e=u[l]={i:l,l:!1,exports:{}};return x[l].call(e.exports,e,e.exports,t),e.l=!0,e.exports}return t.m=x,t.c=u,t.d=function(l,e,O){t.o(l,e)||Object.defineProperty(l,e,{enumerable:!0,get:O})},t.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},t.t=function(l,e){if(1&e&&(l=t(l)),8&e||4&e&&typeof l=="object"&&l&&l.__esModule)return l;var O=Object.create(null);if(t.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:l}),2&e&&typeof l!="string")for(var C in l)t.d(O,C,function(o){return l[o]}.bind(null,C));return O},t.n=function(l){var e=l&&l.__esModule?function(){return l.default}:function(){return l};return t.d(e,"a",e),e},t.o=function(l,e){return Object.prototype.hasOwnProperty.call(l,e)},t.p="",t(t.s=90)}({17:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l=t(18),e=function(){function O(){}return O.getFirstMatch=function(C,o){var c=o.match(C);return c&&c.length>0&&c[1]||""},O.getSecondMatch=function(C,o){var c=o.match(C);return c&&c.length>1&&c[2]||""},O.matchAndReturnConst=function(C,o,c){if(C.test(o))return c},O.getWindowsVersionName=function(C){switch(C){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},O.getMacOSVersionName=function(C){var o=C.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),o[0]===10)switch(o[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},O.getAndroidVersionName=function(C){var o=C.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),!(o[0]===1&&o[1]<5))return o[0]===1&&o[1]<6?"Cupcake":o[0]===1&&o[1]>=6?"Donut":o[0]===2&&o[1]<2?"Eclair":o[0]===2&&o[1]===2?"Froyo":o[0]===2&&o[1]>2?"Gingerbread":o[0]===3?"Honeycomb":o[0]===4&&o[1]<1?"Ice Cream Sandwich":o[0]===4&&o[1]<4?"Jelly Bean":o[0]===4&&o[1]>=4?"KitKat":o[0]===5?"Lollipop":o[0]===6?"Marshmallow":o[0]===7?"Nougat":o[0]===8?"Oreo":o[0]===9?"Pie":void 0},O.getVersionPrecision=function(C){return C.split(".").length},O.compareVersions=function(C,o,c){c===void 0&&(c=!1);var m=O.getVersionPrecision(C),v=O.getVersionPrecision(o),y=Math.max(m,v),i=0,g=O.map([C,o],function(T){var S=y-O.getVersionPrecision(T),p=T+new Array(S+1).join(".0");return O.map(p.split("."),function(d){return new Array(20-d.length).join("0")+d}).reverse()});for(c&&(i=y-Math.min(m,v)),y-=1;y>=i;){if(g[0][y]>g[1][y])return 1;if(g[0][y]===g[1][y]){if(y===i)return 0;y-=1}else if(g[0][y]<g[1][y])return-1}},O.map=function(C,o){var c,m=[];if(Array.prototype.map)return Array.prototype.map.call(C,o);for(c=0;c<C.length;c+=1)m.push(o(C[c]));return m},O.find=function(C,o){var c,m;if(Array.prototype.find)return Array.prototype.find.call(C,o);for(c=0,m=C.length;c<m;c+=1){var v=C[c];if(o(v,c))return v}},O.assign=function(C){for(var o,c,m=C,v=arguments.length,y=new Array(v>1?v-1:0),i=1;i<v;i++)y[i-1]=arguments[i];if(Object.assign)return Object.assign.apply(Object,[C].concat(y));var g=function(){var T=y[o];typeof T=="object"&&T!==null&&Object.keys(T).forEach(function(S){m[S]=T[S]})};for(o=0,c=y.length;o<c;o+=1)g();return C},O.getBrowserAlias=function(C){return l.BROWSER_ALIASES_MAP[C]},O.getBrowserTypeByAlias=function(C){return l.BROWSER_MAP[C]||""},O}();u.default=e,x.exports=u.default},18:function(x,u,t){"use strict";u.__esModule=!0,u.ENGINE_MAP=u.OS_MAP=u.PLATFORMS_MAP=u.BROWSER_MAP=u.BROWSER_ALIASES_MAP=void 0,u.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},u.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},u.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},u.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},u.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l,e=(l=t(91))&&l.__esModule?l:{default:l},O=t(18);function C(c,m){for(var v=0;v<m.length;v++){var y=m[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(c,y.key,y)}}var o=function(){function c(){}var m,v,y;return c.getParser=function(i,g){if(g===void 0&&(g=!1),typeof i!="string")throw new Error("UserAgent should be a string");return new e.default(i,g)},c.parse=function(i){return new e.default(i).getResult()},m=c,y=[{key:"BROWSER_MAP",get:function(){return O.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return O.ENGINE_MAP}},{key:"OS_MAP",get:function(){return O.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return O.PLATFORMS_MAP}}],(v=null)&&C(m.prototype,v),y&&C(m,y),c}();u.default=o,x.exports=u.default},91:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l=c(t(92)),e=c(t(93)),O=c(t(94)),C=c(t(95)),o=c(t(17));function c(v){return v&&v.__esModule?v:{default:v}}var m=function(){function v(i,g){if(g===void 0&&(g=!1),i==null||i==="")throw new Error("UserAgent parameter can't be empty");this._ua=i,this.parsedResult={},g!==!0&&this.parse()}var y=v.prototype;return y.getUA=function(){return this._ua},y.test=function(i){return i.test(this._ua)},y.parseBrowser=function(){var i=this;this.parsedResult.browser={};var g=o.default.find(l.default,function(T){if(typeof T.test=="function")return T.test(i);if(T.test instanceof Array)return T.test.some(function(S){return i.test(S)});throw new Error("Browser's test function is not valid")});return g&&(this.parsedResult.browser=g.describe(this.getUA())),this.parsedResult.browser},y.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},y.getBrowserName=function(i){return i?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},y.getBrowserVersion=function(){return this.getBrowser().version},y.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},y.parseOS=function(){var i=this;this.parsedResult.os={};var g=o.default.find(e.default,function(T){if(typeof T.test=="function")return T.test(i);if(T.test instanceof Array)return T.test.some(function(S){return i.test(S)});throw new Error("Browser's test function is not valid")});return g&&(this.parsedResult.os=g.describe(this.getUA())),this.parsedResult.os},y.getOSName=function(i){var g=this.getOS().name;return i?String(g).toLowerCase()||"":g||""},y.getOSVersion=function(){return this.getOS().version},y.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},y.getPlatformType=function(i){i===void 0&&(i=!1);var g=this.getPlatform().type;return i?String(g).toLowerCase()||"":g||""},y.parsePlatform=function(){var i=this;this.parsedResult.platform={};var g=o.default.find(O.default,function(T){if(typeof T.test=="function")return T.test(i);if(T.test instanceof Array)return T.test.some(function(S){return i.test(S)});throw new Error("Browser's test function is not valid")});return g&&(this.parsedResult.platform=g.describe(this.getUA())),this.parsedResult.platform},y.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},y.getEngineName=function(i){return i?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},y.parseEngine=function(){var i=this;this.parsedResult.engine={};var g=o.default.find(C.default,function(T){if(typeof T.test=="function")return T.test(i);if(T.test instanceof Array)return T.test.some(function(S){return i.test(S)});throw new Error("Browser's test function is not valid")});return g&&(this.parsedResult.engine=g.describe(this.getUA())),this.parsedResult.engine},y.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},y.getResult=function(){return o.default.assign({},this.parsedResult)},y.satisfies=function(i){var g=this,T={},S=0,p={},d=0;if(Object.keys(i).forEach(function(R){var P=i[R];typeof P=="string"?(p[R]=P,d+=1):typeof P=="object"&&(T[R]=P,S+=1)}),S>0){var b=Object.keys(T),n=o.default.find(b,function(R){return g.isOS(R)});if(n){var f=this.satisfies(T[n]);if(f!==void 0)return f}var a=o.default.find(b,function(R){return g.isPlatform(R)});if(a){var s=this.satisfies(T[a]);if(s!==void 0)return s}}if(d>0){var r=Object.keys(p),h=o.default.find(r,function(R){return g.isBrowser(R,!0)});if(h!==void 0)return this.compareVersion(p[h])}},y.isBrowser=function(i,g){g===void 0&&(g=!1);var T=this.getBrowserName().toLowerCase(),S=i.toLowerCase(),p=o.default.getBrowserTypeByAlias(S);return g&&p&&(S=p.toLowerCase()),S===T},y.compareVersion=function(i){var g=[0],T=i,S=!1,p=this.getBrowserVersion();if(typeof p=="string")return i[0]===">"||i[0]==="<"?(T=i.substr(1),i[1]==="="?(S=!0,T=i.substr(2)):g=[],i[0]===">"?g.push(1):g.push(-1)):i[0]==="="?T=i.substr(1):i[0]==="~"&&(S=!0,T=i.substr(1)),g.indexOf(o.default.compareVersions(p,T,S))>-1},y.isOS=function(i){return this.getOSName(!0)===String(i).toLowerCase()},y.isPlatform=function(i){return this.getPlatformType(!0)===String(i).toLowerCase()},y.isEngine=function(i){return this.getEngineName(!0)===String(i).toLowerCase()},y.is=function(i,g){return g===void 0&&(g=!1),this.isBrowser(i,g)||this.isOS(i)||this.isPlatform(i)},y.some=function(i){var g=this;return i===void 0&&(i=[]),i.some(function(T){return g.is(T)})},v}();u.default=m,x.exports=u.default},92:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l,e=(l=t(17))&&l.__esModule?l:{default:l},O=/version\/(\d+(\.?_?\d+)+)/i,C=[{test:[/googlebot/i],describe:function(o){var c={name:"Googlebot"},m=e.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/opera/i],describe:function(o){var c={name:"Opera"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/opr\/|opios/i],describe:function(o){var c={name:"Opera"},m=e.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/SamsungBrowser/i],describe:function(o){var c={name:"Samsung Internet for Android"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/Whale/i],describe:function(o){var c={name:"NAVER Whale Browser"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/MZBrowser/i],describe:function(o){var c={name:"MZ Browser"},m=e.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/focus/i],describe:function(o){var c={name:"Focus"},m=e.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/swing/i],describe:function(o){var c={name:"Swing"},m=e.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/coast/i],describe:function(o){var c={name:"Opera Coast"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(o){var c={name:"Opera Touch"},m=e.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/yabrowser/i],describe:function(o){var c={name:"Yandex Browser"},m=e.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/ucbrowser/i],describe:function(o){var c={name:"UC Browser"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/Maxthon|mxios/i],describe:function(o){var c={name:"Maxthon"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/epiphany/i],describe:function(o){var c={name:"Epiphany"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/puffin/i],describe:function(o){var c={name:"Puffin"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/sleipnir/i],describe:function(o){var c={name:"Sleipnir"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/k-meleon/i],describe:function(o){var c={name:"K-Meleon"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/micromessenger/i],describe:function(o){var c={name:"WeChat"},m=e.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/qqbrowser/i],describe:function(o){var c={name:/qqbrowserlite/i.test(o)?"QQ Browser Lite":"QQ Browser"},m=e.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/msie|trident/i],describe:function(o){var c={name:"Internet Explorer"},m=e.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/\sedg\//i],describe:function(o){var c={name:"Microsoft Edge"},m=e.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/edg([ea]|ios)/i],describe:function(o){var c={name:"Microsoft Edge"},m=e.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/vivaldi/i],describe:function(o){var c={name:"Vivaldi"},m=e.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/seamonkey/i],describe:function(o){var c={name:"SeaMonkey"},m=e.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/sailfish/i],describe:function(o){var c={name:"Sailfish"},m=e.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,o);return m&&(c.version=m),c}},{test:[/silk/i],describe:function(o){var c={name:"Amazon Silk"},m=e.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/phantom/i],describe:function(o){var c={name:"PhantomJS"},m=e.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/slimerjs/i],describe:function(o){var c={name:"SlimerJS"},m=e.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c={name:"BlackBerry"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c={name:"WebOS Browser"},m=e.default.getFirstMatch(O,o)||e.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/bada/i],describe:function(o){var c={name:"Bada"},m=e.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/tizen/i],describe:function(o){var c={name:"Tizen"},m=e.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/qupzilla/i],describe:function(o){var c={name:"QupZilla"},m=e.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/firefox|iceweasel|fxios/i],describe:function(o){var c={name:"Firefox"},m=e.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/electron/i],describe:function(o){var c={name:"Electron"},m=e.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/MiuiBrowser/i],describe:function(o){var c={name:"Miui"},m=e.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/chromium/i],describe:function(o){var c={name:"Chromium"},m=e.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,o)||e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/chrome|crios|crmo/i],describe:function(o){var c={name:"Chrome"},m=e.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/GSA/i],describe:function(o){var c={name:"Google Search"},m=e.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:function(o){var c=!o.test(/like android/i),m=o.test(/android/i);return c&&m},describe:function(o){var c={name:"Android Browser"},m=e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/playstation 4/i],describe:function(o){var c={name:"PlayStation 4"},m=e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/safari|applewebkit/i],describe:function(o){var c={name:"Safari"},m=e.default.getFirstMatch(O,o);return m&&(c.version=m),c}},{test:[/.*/i],describe:function(o){var c=o.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:e.default.getFirstMatch(c,o),version:e.default.getSecondMatch(c,o)}}}];u.default=C,x.exports=u.default},93:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l,e=(l=t(17))&&l.__esModule?l:{default:l},O=t(18),C=[{test:[/Roku\/DVP/],describe:function(o){var c=e.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,o);return{name:O.OS_MAP.Roku,version:c}}},{test:[/windows phone/i],describe:function(o){var c=e.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,o);return{name:O.OS_MAP.WindowsPhone,version:c}}},{test:[/windows /i],describe:function(o){var c=e.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,o),m=e.default.getWindowsVersionName(c);return{name:O.OS_MAP.Windows,version:c,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(o){var c={name:O.OS_MAP.iOS},m=e.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,o);return m&&(c.version=m),c}},{test:[/macintosh/i],describe:function(o){var c=e.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,o).replace(/[_\s]/g,"."),m=e.default.getMacOSVersionName(c),v={name:O.OS_MAP.MacOS,version:c};return m&&(v.versionName=m),v}},{test:[/(ipod|iphone|ipad)/i],describe:function(o){var c=e.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,o).replace(/[_\s]/g,".");return{name:O.OS_MAP.iOS,version:c}}},{test:function(o){var c=!o.test(/like android/i),m=o.test(/android/i);return c&&m},describe:function(o){var c=e.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,o),m=e.default.getAndroidVersionName(c),v={name:O.OS_MAP.Android,version:c};return m&&(v.versionName=m),v}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c=e.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,o),m={name:O.OS_MAP.WebOS};return c&&c.length&&(m.version=c),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c=e.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,o)||e.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,o)||e.default.getFirstMatch(/\bbb(\d+)/i,o);return{name:O.OS_MAP.BlackBerry,version:c}}},{test:[/bada/i],describe:function(o){var c=e.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,o);return{name:O.OS_MAP.Bada,version:c}}},{test:[/tizen/i],describe:function(o){var c=e.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,o);return{name:O.OS_MAP.Tizen,version:c}}},{test:[/linux/i],describe:function(){return{name:O.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:O.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(o){var c=e.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,o);return{name:O.OS_MAP.PlayStation4,version:c}}}];u.default=C,x.exports=u.default},94:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l,e=(l=t(17))&&l.__esModule?l:{default:l},O=t(18),C=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(o){var c=e.default.getFirstMatch(/(can-l01)/i,o)&&"Nova",m={type:O.PLATFORMS_MAP.mobile,vendor:"Huawei"};return c&&(m.model=c),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:O.PLATFORMS_MAP.tablet}}},{test:function(o){var c=o.test(/ipod|iphone/i),m=o.test(/like (ipod|iphone)/i);return c&&!m},describe:function(o){var c=e.default.getFirstMatch(/(ipod|iphone)/i,o);return{type:O.PLATFORMS_MAP.mobile,vendor:"Apple",model:c}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName(!0)==="blackberry"},describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(o){return o.getBrowserName(!0)==="bada"},describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName()==="windows phone"},describe:function(){return{type:O.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(o){var c=Number(String(o.getOSVersion()).split(".")[0]);return o.getOSName(!0)==="android"&&c>=3},describe:function(){return{type:O.PLATFORMS_MAP.tablet}}},{test:function(o){return o.getOSName(!0)==="android"},describe:function(){return{type:O.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getOSName(!0)==="macos"},describe:function(){return{type:O.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(o){return o.getOSName(!0)==="windows"},describe:function(){return{type:O.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="linux"},describe:function(){return{type:O.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="playstation 4"},describe:function(){return{type:O.PLATFORMS_MAP.tv}}},{test:function(o){return o.getOSName(!0)==="roku"},describe:function(){return{type:O.PLATFORMS_MAP.tv}}}];u.default=C,x.exports=u.default},95:function(x,u,t){"use strict";u.__esModule=!0,u.default=void 0;var l,e=(l=t(17))&&l.__esModule?l:{default:l},O=t(18),C=[{test:function(o){return o.getBrowserName(!0)==="microsoft edge"},describe:function(o){if(/\sedg\//i.test(o))return{name:O.ENGINE_MAP.Blink};var c=e.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,o);return{name:O.ENGINE_MAP.EdgeHTML,version:c}}},{test:[/trident/i],describe:function(o){var c={name:O.ENGINE_MAP.Trident},m=e.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:function(o){return o.test(/presto/i)},describe:function(o){var c={name:O.ENGINE_MAP.Presto},m=e.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:function(o){var c=o.test(/gecko/i),m=o.test(/like gecko/i);return c&&!m},describe:function(o){var c={name:O.ENGINE_MAP.Gecko},m=e.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:O.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(o){var c={name:O.ENGINE_MAP.WebKit},m=e.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,o);return m&&(c.version=m),c}}];u.default=C,x.exports=u.default}})})});var Xe={};ce(Xe,{version:()=>Ar});var Ar,Ze=Bt(()=>{V();Ar="beta"});var tn={};ce(tn,{remoteConfig:()=>Rr});var Rr,en=Bt(()=>{V();Rr={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});V();var ie=yt(Ft());V();var _t=(n=>(n.MEETING_START="meeting.start",n.MEETING_LEAVE="meeting.leave",n.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",n.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",n.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",n.MEETING_PARTICIPANT_LEFT="meeting.participant-left",n.MEETING_JOIN="meeting.join",n.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",n.MEETING_HOST_CHANGE="meeting.host-change",n.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",n.MEETING_DEVICES_CHANGE="meeting.devices-change",n.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",n.MEETING_STATE_UPDATE="meeting.state-update",n.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",n.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",n.MY_PARTICIPANT_UPDATED="my-participant.update",n.MY_PARTICIPANT_LEFT="my-participant.left",n.MY_PARTICIPANT_JOINED="my-participant.joined",n.DESTROY="destroy",n))(_t||{});var Gt=(C=>(C.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",C.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",C.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",C.TOGGLE_CAM="meeting-controls.toggle-cam",C.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",C.HANG_UP="hang-up",C))(Gt||{}),xt=(y=>(y.REALTIME_JOIN="realtime.join",y.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",y.REALTIME_HOST_CHANGE="realtime.host-change",y.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",y.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",y.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",y.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",y.REALTIME_GATHER="realtime.gather",y.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",y.REALTIME_SET_AVATAR="realtime.set-avatar",y.REALTIME_DRAWING_CHANGE="realtime.drawing-change",y))(xt||{});var kt=(v=>(v[v.MEETING_FAILED=-1]="MEETING_FAILED",v[v.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",v[v.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",v[v.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",v[v.MEETING_CONNECTING=3]="MEETING_CONNECTING",v[v.MEETING_CONNECTED=4]="MEETING_CONNECTED",v[v.MEETING_RECONNECT=5]="MEETING_RECONNECT",v[v.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",v[v.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",v[v.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",v))(kt||{}),jt=(o=>(o[o.NOT_AVAILABLE=0]="NOT_AVAILABLE",o[o.GOOD=1]="GOOD",o[o.BAD=2]="BAD",o[o.POOR=3]="POOR",o[o.DISCONNECTED=4]="DISCONNECTED",o[o.RECONNECTING=5]="RECONNECTING",o[o.LOST_CONNECTION=6]="LOST_CONNECTION",o))(jt||{}),Ht=(C=>(C.NO_CAM="devices.no-cam",C.NO_DEVICES="devices.no-devices",C.DEVICES_BLOCKED="devices.blocked",C.DEVICES_CAM_BLOCKED="devices.cam-blocked",C.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",C.DEVICES_UNKNOWN_ERROR="devices.unknown-error",C))(Ht||{});V();var Wt=(l=>(l.HOST="host",l.GUEST="guest",l.AUDIENCE="audience",l))(Wt||{});V();V();V();V();var pe=yt(Ft()),dt=class{constructor(u){this.debug=(0,pe.default)(u)}log(u,...t){this.debug(u,...t)}};V();V();V();var mt=(x,u,t)=>ut(void 0,null,function*(){let l=yield fetch(x,{method:u,headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):null});if(!l.ok)throw l;return l.json()});V();var Qe=yt(Jt());var ot=class{constructor(u={}){this.subscribe=u=>{this.callbacks.push(u)};this.unsubscribe=u=>{this.callbacks=this.callbacks.filter(t=>t!==u)};this.publish=(...u)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,u).catch(l=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(u)}
            Error: ${l}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(u,t)=>new Promise((l,e)=>{try{let O=u(...t);l(O)}catch(O){e(O)}});let{logger:t,throttleTime:l}=u;this.logger=t!=null?t:new dt("@superviz/sdk/observer-helper"),this.throttle=l,this.callbacks=[],this.throttle&&(this.publish=(0,Qe.default)(this.publish,this.throttle))}};var Dt=class{constructor(u){this.observers=new Map;this.subscribe=(u,t)=>{this.logger.log("pubsub service @ subscribe",{event:u,callback:t}),this.observers.has(u)||this.observers.set(u,new ot),this.observers.get(u).subscribe(t)};this.unsubscribe=(u,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:u,callback:t}),this.observers.has(u)&&(this.observers.get(u).reset(),this.observers.delete(u))};this.publish=(u,t)=>{this.logger.log("pubsub service @ publish",{event:u,data:t}),this.realtime.setSyncProperty(u,t)};this.publishEventToClient=(u,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:u,data:t}),this.observers.has(u)&&this.observers.get(u).publish(t)};this.onSyncPropertiesChange=u=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:u}),Object.entries(u).forEach(([t,l])=>{this.publishEventToClient(t,l)})};this.logger=new dt("@superviz/sdk/pubsub"),this.realtime=u,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(u){return this.realtime.fetchSyncClientProperty(u)}};V();V();var Zt=yt(qe()),Et=yt(Jt());V();var qt=(c=>(c[c.DISCONNECTED=0]="DISCONNECTED",c[c.INITIALIZING=1]="INITIALIZING",c[c.READY_TO_JOIN=2]="READY_TO_JOIN",c[c.CONNECTING=3]="CONNECTING",c[c.CONNECTED=4]="CONNECTED",c[c.JOINED=5]="JOINED",c[c.FAILED=-1]="FAILED",c[c.RETRYING=-2]="RETRYING",c))(qt||{});V();V();var $t=(d=>(d[d.yellow=0]="yellow",d[d.turquoise=1]="turquoise",d[d.orange=2]="orange",d[d.blue=3]="blue",d[d.pink=4]="pink",d[d.purple=5]="purple",d[d.green=6]="green",d[d.red=7]="red",d[d.bluedark=8]="bluedark",d[d.pinklight=9]="pinklight",d[d.purplelight=10]="purplelight",d[d.greenlight=11]="greenlight",d[d.orangelight=12]="orangelight",d[d.bluelight=13]="bluelight",d[d.redlight=14]="redlight",d[d.brown=15]="brown",d[d.gray=16]="gray",d))($t||{}),Yt=(x=>(x[x["#FFEF33"]=0]="#FFEF33",x[x["#31E0B0"]=1]="#31E0B0",x[x["#FF5E10"]=2]="#FF5E10",x[x["#00ABF7"]=3]="#00ABF7",x[x["#FF00BB"]=4]="#FF00BB",x[x["#9C29FF"]=5]="#9C29FF",x[x["#6FDD00"]=6]="#6FDD00",x[x["#E30000"]=7]="#E30000",x[x["#304AFF"]=8]="#304AFF",x[x["#FF89C4"]=9]="#FF89C4",x[x["#D597FF"]=10]="#D597FF",x[x["#C6EC5C"]=11]="#C6EC5C",x[x["#FFA115"]=12]="#FFA115",x[x["#75DEFE"]=13]="#75DEFE",x[x["#FAA291"]=14]="#FAA291",x[x["#BB813F"]=15]="#BB813F",x[x["#878291"]=16]="#878291",x))(Yt||{});var Ut=class{constructor(){this.participantObservers=[],this.logger=new dt("@superviz/sdk/realtime-service"),this.participantsObserver=new ot({logger:this.logger}),this.participantJoinedObserver=new ot({logger:this.logger}),this.participantLeaveObserver=new ot({logger:this.logger}),this.syncPropertiesObserver=new ot({logger:this.logger}),this.reconnectObserver=new ot({logger:this.logger}),this.roomInfoUpdatedObserver=new ot({logger:this.logger}),this.roomListUpdatedObserver=new ot({logger:this.logger}),this.hostObserver=new ot({logger:this.logger}),this.realtimeStateObserver=new ot({logger:this.logger}),this.kickAllParticipantsObserver=new ot({logger:this.logger}),this.authenticationObserver=new ot({logger:this.logger})}subscribeToParticipantUpdate(u,t){this.participantObservers[u]||(this.participantObservers[u]=new ot({logger:this.logger})),this.participantObservers[u].subscribe(t)}unsubscribeFromParticipantUpdate(u,t){this.participantObservers[u]&&this.participantObservers[u].unsubscribe(t)}getSlotColor(u){let t=u!=null?u:16;return{color:Yt[t],name:$t[t]}}};var vr=1e3*60,yr=6e4,br=1e4,Cr=1e3,Xt=null,At=class extends Ut{constructor(t,l){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=t=>{if(!t)return;let l=this.participants[t];this.updateRoomProperties({hostClientId:l.clientId})};this.freezeSync=t=>{var l,e;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(l=this.broadcastChannel)==null||l.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(e=this.broadcastChannel)==null||e.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{let l=this.clientSyncPropertiesQueue[t];this.clientSyncPropertiesQueue[t]=[],l.length&&this.clientSyncChannel.publish(t,l)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(t,l)=>{this.clientRoomState[t]=l[l.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=t=>ut(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),t.hostClientId?(t==null?void 0:t.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(t.hostClientId):this.hostPassingHandle(),this.updateParticipants()});this.updateMyProperties=(0,Et.default)(t=>{let l=t;if(!(this.isMessageTooBig(t)||this.left||!this.enableSync||this.isSyncFrozen)&&(l.avatar===void 0&&delete l.avatar,this.myParticipant.data=pt(pt({},this.myParticipant.data),t),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},Cr);this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let l=pt(pt({},this.localRoomProperties),t);this.supervizChannel.publish("update",l)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((l,e)=>{e.forEach(O=>{t[O.clientId]=pt({},O)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=t=>{let l=[];if(this.supervizChannel.presence.get((O,C)=>{C.forEach(o=>{O||l.push(o.clientId)})}),!t||!l.includes(t)){this.hostPassingHandle();return}Xt&&clearTimeout(Xt);let e=this.hostParticipantId;this.hostParticipantId=t,this.hostObserver.publish({oldHostParticipantId:e,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var l;let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((l=this.myParticipant)==null?void 0:l.data.type)==="host"&&(t.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(t)};this.hostPassingHandle=(0,Et.default)(()=>ut(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((t,l)=>{let e=l.filter(C=>C.data.type==="host").map(C=>C.clientId);if(this.shouldKickParticipantsOnHostLeave&&e.length===0){Xt=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},vr);return}let O=e[0];O===this.localParticipantId&&this.setHost(O)})}),1e3);this.findSlotIndex=t=>{let l=t,e=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((o,c)=>{if(o){e=[];return}c.forEach(m=>{m.connectionId===l.connectionId&&(l=m),m.connectionId!==l.connectionId&&m.data.hasOwnProperty("slotIndex")&&e.splice(e.indexOf(m.data.slotIndex),1)})}),e.length===0)return;let O=e[0];this.myParticipant.data.slotIndex=O,this.updateMyProperties({slotIndex:O});let C=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(l)},C)};this.confirmSlot=(0,Et.default)(t=>ut(this,null,function*(){let l=[],e=t;if(this.supervizChannel.presence.get((O,C)=>{C.forEach(o=>{o.connectionId===e.connectionId&&(e=o),o.connectionId!==e.connectionId&&o.data.slotIndex!==void 0&&l.push(o.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||l.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(e);else{let O=yield this.fetchRoomProperties();this.updateRoomProperties(O)}}),1e3);this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties({})};this.syncBroadcast=(0,Et.default)(()=>{let t=btoa(this.ablyKey),l=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(l,{headers:{Authorization:`Basic ${t}`}}).then(e=>e.json()).then(e=>{this.broadcastChannel.publish("update",e)})},1e3);this.isMessageTooBig=(t,l=yr)=>{let e=JSON.stringify(t);return new TextEncoder().encode(e).length>l?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=l,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,l;return(l=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?l:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:l,apiKey:e,shouldKickParticipantsOnHostLeave:O}){this.myParticipant={data:ue(pt({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${l.toLowerCase()}-${e}`,this.shouldKickParticipantsOnHostLeave=O,this.apiKey=e,this.client||this.buildClient()}auth(t,l){let e=new Zt.default.Rest({key:this.ablyKey}),{origin:O}=window.location;e.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:O,apiKey:this.apiKey}},(C,o)=>{C&&this.authenticationObserver.publish("realtime.authentication-failed"),l(C,o)})}join(t){let l=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(l),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let l=this.localRoomProperties;this.updateRoomProperties(Object.assign({},l,{isGridModeEnable:t}))}setDrawing(t){let l=this.localRoomProperties;this.updateRoomProperties(Object.assign({},l,{drawing:t}))}setSyncProperty(t,l){var C;let e=(C=this.clientSyncPropertiesQueue[t])!=null?C:[],O=(o,c)=>({name:o,data:c,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(O(t,l),br)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(e)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",t,l),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(O(t,l)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var l,e;if(t){let O=t.toString();if(this.participants&&this.participants[O])return(e=(l=this.participants[t])==null?void 0:l.data)==null?void 0:e.slotIndex}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){if(!this.isJoinedRoom)return;let{clientId:l}=t,e=Object.assign({},t,{participantId:t.clientId});this.publishParticipantUpdate(e),this.participants&&this.participants[l]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:l,data:e}=t,O={};O[l]=e,this.syncPropertiesObserver.publish(O),this.isLocalParticipantHost&&this.saveClientRoomState(l,e)}onReceiveBroadcastSync(t){t.data.forEach(e=>{var C;let O=e.clientId;this.participants[O]=e,(C=e.data)!=null&&C.isAudience||(this.participants[O].data=JSON.parse(this.participants[O].data),this.publishParticipantUpdate(this.participants[O]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Zt.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${qt[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,l)=>{this.supervizChannel.history((e,O)=>{var o;e&&l(e);let C=(o=O.items[0])==null?void 0:o.data;t(C||null)})})}fetchSyncClientProperty(t){return ut(this,null,function*(){try{let l=yield new Promise((e,O)=>{this.clientRoomStateChannel.history((C,o)=>{var m;C&&O(C);let c=(m=o==null?void 0:o.items[0])==null?void 0:m.data;e(c||null)})});if(t&&!l[t])throw new Error(`Event ${t} not found in the history`);return t?l[t]:l}catch(l){this.logger.log("REALTIME","Error in fetch client realtime data",l.message),this.throw(l.message)}})}onStateChange(){var v,y,i;let t=(v=this.supervizChannelState)==null?void 0:v.current,l=(y=this.connectionState)==null?void 0:y.current,e=l==="connected",O=["initialized","connecting"].includes(l),C=["closed","closing"].includes(l)||["detaching","detached"].includes(t),o={[0]:C,[1]:O,[2]:!t&&e,[3]:t==="attaching",[4]:t==="attached"&&e,[-1]:t==="failed"||l==="failed",[-2]:l==="suspended"||t==="suspended"},c=Object.entries(o).find(([g,T])=>T&&g)[0],m=Number(c);if(m===2&&(this.currentReconnectAttempt=0),e&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(m===-2||m===-1)&&this.forceReconnect(),(i=this.connectionState)!=null&&i.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return ut(this,null,function*(){var l;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(t),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((l=this.localRoomProperties)==null?void 0:l.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;let l=t.data.participantId===this.hostParticipantId;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),l&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};V();var te=class{constructor({ablyKey:u,apiUrl:t,apiKey:l,conferenceLayerUrl:e,participant:O,group:C,roomId:o,shouldKickParticipantsOnHostLeave:c}){this.addComponent=u=>{u.attach({localParticipant:this.participant,realtime:this.realtime})};this.removeComponent=u=>{u.detach()};this.subscribeToPubSubEvent=(u,t)=>{this.logger.log("laucher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(u,t)};this.unsubscribeFromPubSubEvent=(u,t)=>{this.logger.log("laucher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(u,t)};this.publishToPubSubEvent=(u,t)=>{this.logger.log("laucher service @ publishToPubSubEvent"),this.pubsub.publish(u,t)};this.fetchPubSubHistory=u=>this.pubsub.fetchHistory(u);this.startRealtime=()=>{this.logger.log("laucher service @ startRealtime"),this.realtime.start({apiKey:this.apiKey,participant:this.participant,roomId:this.roomId,shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join()};this.apiUrl=t,this.apiKey=l,this.ablyKey=u,this.conferenceLayerUrl=e,this.shouldKickParticipantsOnHostLeave=c!=null?c:!0,this.participant=O,this.roomId=o,this.group=C,this.logger=new dt("@superviz/sdk/laucher"),this.realtime=new At(this.apiUrl,this.ablyKey),this.pubsub=new Dt(this.realtime),this.logger.log("laucher created"),this.startRealtime()}},ee=x=>{let u=new te(x);return{subscribe:u.subscribeToPubSubEvent,unsubscribe:u.unsubscribeFromPubSubEvent,publish:u.publishToPubSubEvent,fetchHistory:u.fetchPubSubHistory,addComponent:u.addComponent,removeComponent:u.removeComponent}};V();var vt=class{static createUrl(u,t){return`${u}${t}`}static validateApiKey(u,t){let l="/user/checkapikey",e=this.createUrl(u,l);return mt(e,"POST",{apiKey:t})}static fetchConfig(u,t){let l="/immersive-config",e=this.createUrl(u,l);return mt(e,"POST",{apiKey:t})}static fetchWaterMark(u,t){return ut(this,null,function*(){let l="/user/watermark",e=this.createUrl(u,l),{message:O}=yield mt(e,"POST",{apiKey:t});return O})}};V();function Or(x,u){return ut(this,null,function*(){try{return(yield vt.validateApiKey(x,u))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var $e=Or;V();var ht=yt(Ye()),re=class{constructor(){this.browser=ht.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(ht.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(ht.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(ht.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(ht.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(ht.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(ht.default.PLATFORMS_MAP.mobile)||this.browser.is(ht.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(ht.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};V();V();V();V();V();V();var Rt=class{static getRemoteConfig(){return ut(this,arguments,function*(u="prod"){let{version:t}=yield Promise.resolve().then(()=>(Ze(),Xe));if(u==="local"){let{remoteConfig:O}=yield Promise.resolve().then(()=>(en(),tn));return O}let l={version:t,environment:u},e=this.createUrl(l);return mt(e,"GET",null)})}static createUrl({version:u,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${u}?env=${t}`}};Rt.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";V();var Sr=({group:x,participant:u,roomId:t})=>{if(!x||!x.name||!x.id)throw new Error("Group fields is required");if(!u||!u.id)throw new Error("Participants fields is required");if(!t)throw new Error("Room id is required")},nn=(x,u)=>ut(void 0,null,function*(){if(!(x&&x.trim()))throw new Error("API key is required");if(!u)throw new Error("Options is required");Sr(u),u.debug?ie.debug.enable("*"):ie.debug.disable();let{apiUrl:l,conferenceLayerUrl:e}=yield Rt.getRemoteConfig(u.environment);if(!(yield $e(l,x)))throw new Error("Failed to validate API key");let C=yield vt.fetchConfig(l,x);if(!C||!C.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:o}=C;return ee(Object.assign({},u,{apiKey:x,ablyKey:o,conferenceLayerUrl:e,apiUrl:l}))});window&&(window.SuperVizSdk={init:nn,MeetingEvent:_t,DeviceEvent:Ht,RealtimeEvent:xt,MeetingState:kt,MeetingConnectionStatus:jt,MeetingControlsEvent:Gt});var so=nn;export{re as BrowserService,Ht as DeviceEvent,jt as MeetingConnectionStatus,Gt as MeetingControlsEvent,_t as MeetingEvent,kt as MeetingState,Wt as ParticipantType,xt as RealtimeEvent,so as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
