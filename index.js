var o0=Object.create;var mi=Object.defineProperty,s0=Object.defineProperties,u0=Object.getOwnPropertyDescriptor,c0=Object.getOwnPropertyDescriptors,l0=Object.getOwnPropertyNames,yc=Object.getOwnPropertySymbols,f0=Object.getPrototypeOf,Cc=Object.prototype.hasOwnProperty,d0=Object.prototype.propertyIsEnumerable;var bc=(i,r,n)=>r in i?mi(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n,Lt=(i,r)=>{for(var n in r||(r={}))Cc.call(r,n)&&bc(i,n,r[n]);if(yc)for(var n of yc(r))d0.call(r,n)&&bc(i,n,r[n]);return i},yi=(i,r)=>s0(i,c0(r));var Oc=(i,r)=>()=>(i&&(r=i(i=0)),r);var We=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports),h0=(i,r)=>{for(var n in r)mi(i,n,{get:r[n],enumerable:!0})},A0=(i,r,n,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of l0(r))!Cc.call(i,o)&&o!==n&&mi(i,o,{get:()=>r[o],enumerable:!(u=u0(r,o))||u.enumerable});return i};var xt=(i,r,n)=>(n=i!=null?o0(f0(i)):{},A0(r||!i||!i.__esModule?mi(n,"default",{value:i,enumerable:!0}):n,i));var ke=(i,r,n)=>new Promise((u,o)=>{var v=d=>{try{c(n.next(d))}catch(y){o(y)}},E=d=>{try{c(n.throw(d))}catch(y){o(y)}},c=d=>d.done?u(d.value):Promise.resolve(d.value).then(v,E);c((n=n.apply(i,r)).next())});var ve,ae=Oc(()=>{ve={}});var Qn=We((zC,Fc)=>{ae();var g0=Object.create,Oi=Object.defineProperty,v0=Object.getOwnPropertyDescriptor,m0=Object.getOwnPropertyNames,y0=Object.getPrototypeOf,b0=Object.prototype.hasOwnProperty,C0=(i,r)=>()=>(i&&(r=i(i=0)),r),it=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports),O0=(i,r)=>{for(var n in r)Oi(i,n,{get:r[n],enumerable:!0})},Ec=(i,r,n,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of m0(r))!b0.call(i,o)&&o!==n&&Oi(i,o,{get:()=>r[o],enumerable:!(u=v0(r,o))||u.enumerable});return i},Sc=(i,r,n)=>(n=i!=null?g0(y0(i)):{},Ec(r||!i||!i.__esModule?Oi(n,"default",{value:i,enumerable:!0}):n,i)),E0=i=>Ec(Oi({},"__esModule",{value:!0}),i),Ic,Ne=C0(()=>{Ic={}}),S0=it((i,r)=>{Ne();var n=1e3,u=n*60,o=u*60,v=o*24,E=v*7,c=v*365.25;r.exports=function(s,b){b=b||{};var T=typeof s;if(T==="string"&&s.length>0)return d(s);if(T==="number"&&isFinite(s))return b.long?S(s):y(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function d(s){if(s=String(s),!(s.length>100)){var b=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(b){var T=parseFloat(b[1]),P=(b[2]||"ms").toLowerCase();switch(P){case"years":case"year":case"yrs":case"yr":case"y":return T*c;case"weeks":case"week":case"w":return T*E;case"days":case"day":case"d":return T*v;case"hours":case"hour":case"hrs":case"hr":case"h":return T*o;case"minutes":case"minute":case"mins":case"min":case"m":return T*u;case"seconds":case"second":case"secs":case"sec":case"s":return T*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return T;default:return}}}}function y(s){var b=Math.abs(s);return b>=v?Math.round(s/v)+"d":b>=o?Math.round(s/o)+"h":b>=u?Math.round(s/u)+"m":b>=n?Math.round(s/n)+"s":s+"ms"}function S(s){var b=Math.abs(s);return b>=v?I(s,b,v,"day"):b>=o?I(s,b,o,"hour"):b>=u?I(s,b,u,"minute"):b>=n?I(s,b,n,"second"):s+" ms"}function I(s,b,T,P){var C=b>=T*1.5;return Math.round(s/T)+" "+P+(C?"s":"")}}),I0=it((i,r)=>{Ne();function n(u){v.debug=v,v.default=v,v.coerce=I,v.disable=d,v.enable=c,v.enabled=y,v.humanize=S0(),v.destroy=s,Object.keys(u).forEach(b=>{v[b]=u[b]}),v.names=[],v.skips=[],v.formatters={};function o(b){let T=0;for(let P=0;P<b.length;P++)T=(T<<5)-T+b.charCodeAt(P),T|=0;return v.colors[Math.abs(T)%v.colors.length]}v.selectColor=o;function v(b){let T,P=null,C,m;function R(...l){if(!R.enabled)return;let p=R,h=Number(new Date),A=h-(T||h);p.diff=A,p.prev=T,p.curr=h,T=h,l[0]=v.coerce(l[0]),typeof l[0]!="string"&&l.unshift("%O");let f=0;l[0]=l[0].replace(/%([a-zA-Z%])/g,(O,w)=>{if(O==="%%")return"%";f++;let x=v.formatters[w];if(typeof x=="function"){let V=l[f];O=x.call(p,V),l.splice(f,1),f--}return O}),v.formatArgs.call(p,l),(p.log||v.log).apply(p,l)}return R.namespace=b,R.useColors=v.useColors(),R.color=v.selectColor(b),R.extend=E,R.destroy=v.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>P!==null?P:(C!==v.namespaces&&(C=v.namespaces,m=v.enabled(b)),m),set:l=>{P=l}}),typeof v.init=="function"&&v.init(R),R}function E(b,T){let P=v(this.namespace+(typeof T=="undefined"?":":T)+b);return P.log=this.log,P}function c(b){v.save(b),v.namespaces=b,v.names=[],v.skips=[];let T,P=(typeof b=="string"?b:"").split(/[\s,]+/),C=P.length;for(T=0;T<C;T++)!P[T]||(b=P[T].replace(/\*/g,".*?"),b[0]==="-"?v.skips.push(new RegExp("^"+b.slice(1)+"$")):v.names.push(new RegExp("^"+b+"$")))}function d(){let b=[...v.names.map(S),...v.skips.map(S).map(T=>"-"+T)].join(",");return v.enable(""),b}function y(b){if(b[b.length-1]==="*")return!0;let T,P;for(T=0,P=v.skips.length;T<P;T++)if(v.skips[T].test(b))return!1;for(T=0,P=v.names.length;T<P;T++)if(v.names[T].test(b))return!0;return!1}function S(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}function I(b){return b instanceof Error?b.stack||b.message:b}function s(){}return v.enable(v.load()),v}r.exports=n}),R0=it((i,r)=>{Ne(),i.formatArgs=u,i.save=o,i.load=v,i.useColors=n,i.storage=E(),i.destroy=(()=>{let d=!1;return()=>{d||(d=!0)}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function u(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;let y="color: "+this.color;d.splice(1,0,y,"color: inherit");let S=0,I=0;d[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(S++,s==="%c"&&(I=S))}),d.splice(I,0,y)}i.log=console.debug||console.log||(()=>{});function o(d){try{d?i.storage.setItem("debug",d):i.storage.removeItem("debug")}catch(y){}}function v(){let d;try{d=i.storage.getItem("debug")}catch(y){}return!d&&typeof process!="undefined"&&"env"in process&&(d=Ic.DEBUG),d}function E(){try{return localStorage}catch(d){}}r.exports=I0()(i);var{formatters:c}=r.exports;c.j=function(d){try{return JSON.stringify(d)}catch(y){return"[UnexpectedJSONParseError]: "+y.message}}}),po=it((i,r)=>{Ne();function n(u){var o=typeof u;return u!=null&&(o=="object"||o=="function")}r.exports=n}),T0=it((i,r)=>{Ne();var n=typeof global=="object"&&global&&global.Object===Object&&global;r.exports=n}),Rc=it((i,r)=>{Ne();var n=T0(),u=typeof self=="object"&&self&&self.Object===Object&&self,o=n||u||Function("return this")();r.exports=o}),P0=it((i,r)=>{Ne();var n=Rc(),u=function(){return n.Date.now()};r.exports=u}),M0=it((i,r)=>{Ne();var n=/\s/;function u(o){for(var v=o.length;v--&&n.test(o.charAt(v)););return v}r.exports=u}),w0=it((i,r)=>{Ne();var n=M0(),u=/^\s+/;function o(v){return v&&v.slice(0,n(v)+1).replace(u,"")}r.exports=o}),Tc=it((i,r)=>{Ne();var n=Rc(),u=n.Symbol;r.exports=u}),_0=it((i,r)=>{Ne();var n=Tc(),u=Object.prototype,o=u.hasOwnProperty,v=u.toString,E=n?n.toStringTag:void 0;function c(d){var y=o.call(d,E),S=d[E];try{d[E]=void 0;var I=!0}catch(b){}var s=v.call(d);return I&&(y?d[E]=S:delete d[E]),s}r.exports=c}),L0=it((i,r)=>{Ne();var n=Object.prototype,u=n.toString;function o(v){return u.call(v)}r.exports=o}),x0=it((i,r)=>{Ne();var n=Tc(),u=_0(),o=L0(),v="[object Null]",E="[object Undefined]",c=n?n.toStringTag:void 0;function d(y){return y==null?y===void 0?E:v:c&&c in Object(y)?u(y):o(y)}r.exports=d}),B0=it((i,r)=>{Ne();function n(u){return u!=null&&typeof u=="object"}r.exports=n}),D0=it((i,r)=>{Ne();var n=x0(),u=B0(),o="[object Symbol]";function v(E){return typeof E=="symbol"||u(E)&&n(E)==o}r.exports=v}),N0=it((i,r)=>{Ne();var n=w0(),u=po(),o=D0(),v=0/0,E=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,d=/^0o[0-7]+$/i,y=parseInt;function S(I){if(typeof I=="number")return I;if(o(I))return v;if(u(I)){var s=typeof I.valueOf=="function"?I.valueOf():I;I=u(s)?s+"":s}if(typeof I!="string")return I===0?I:+I;I=n(I);var b=c.test(I);return b||d.test(I)?y(I.slice(2),b?2:8):E.test(I)?v:+I}r.exports=S}),F0=it((i,r)=>{Ne();var n=po(),u=P0(),o=N0(),v="Expected a function",E=Math.max,c=Math.min;function d(y,S,I){var s,b,T,P,C,m,R=0,l=!1,p=!1,h=!0;if(typeof y!="function")throw new TypeError(v);S=o(S)||0,n(I)&&(l=!!I.leading,p="maxWait"in I,T=p?E(o(I.maxWait)||0,S):T,h="trailing"in I?!!I.trailing:h);function A(L){var k=s,W=b;return s=b=void 0,R=L,P=y.apply(W,k),P}function f(L){return R=L,C=setTimeout(x,S),l?A(L):P}function O(L){var k=L-m,W=L-R,K=S-k;return p?c(K,T-W):K}function w(L){var k=L-m,W=L-R;return m===void 0||k>=S||k<0||p&&W>=T}function x(){var L=u();if(w(L))return V(L);C=setTimeout(x,O(L))}function V(L){return C=void 0,h&&s?A(L):(s=b=void 0,P)}function H(){C!==void 0&&clearTimeout(C),R=0,s=m=b=C=void 0}function B(){return C===void 0?P:V(u())}function M(){var L=u(),k=w(L);if(s=arguments,b=this,m=L,k){if(C===void 0)return f(m);if(p)return clearTimeout(C),C=setTimeout(x,S),A(m)}return C===void 0&&(C=setTimeout(x,S)),P}return M.cancel=H,M.flush=B,M}r.exports=d}),U0=it((i,r)=>{Ne();var n=F0(),u=po(),o="Expected a function";function v(E,c,d){var y=!0,S=!0;if(typeof E!="function")throw new TypeError(o);return u(d)&&(y="leading"in d?!!d.leading:y,S="trailing"in d?!!d.trailing:S),n(E,c,{leading:y,maxWait:c,trailing:S})}r.exports=v}),Pc={};O0(Pc,{EnvironmentStateTypes:()=>Lc,FrameBricklayer:()=>H0,HeartBeat:()=>V0,LibraryStateReasonTypes:()=>Bc,LibraryStateTypes:()=>xc,Logger:()=>go,MessageBridge:()=>Nc,MessageTypes:()=>Mc,ObserverHelper:()=>Dc,RealtimeStateReasonTypes:()=>_c,RealtimeStateTypes:()=>wc});Fc.exports=E0(Pc);Ne();Ne();Ne();var Mc=(i=>(i.COMMUNICATOR_STATE_UPDATE="communicator.state-update",i.FRAME_LOAD="frame.load",i.GOTO_USER="environment.goto-user",i.FOLLOW_USER="environment.follow-user",i.GATHER_ALL="environment.gather-all",i.REALTIME_ENTER_ROOM="realtime.enter-room",i.REALTIME_LEAVE="realtime.leave",i.REALTIME_SET_HOST="realtime.set-host",i.REALTIME_SET_ROOM_PROPERTIES="realtime.set-room-properties",i.REALTIME_HOST_UPDATE="realtime.host-update",i.REALTIME_ROOM_PROPERTIES_UPDATE="realtime.room-properties-update",i.REALTIME_USER_AMOUNT_UPDATE="realtime.amount-of-users-update",i.REALTIME_USER_LIST_UPDATE="realtime.user-list-update",i.REALTIME_USER_JOINED="realtime.user-joined",i.REALTIME_USER_LEFT="realtime.user-left",i.HEARTBEAT="heartbeat",i))(Mc||{});Ne();var wc=(i=>(i[i.DISCONNECTED=0]="DISCONNECTED",i[i.INITIALIZING=1]="INITIALIZING",i[i.READY_TO_JOIN=2]="READY_TO_JOIN",i[i.CONNECTING=3]="CONNECTING",i[i.CONNECTED=4]="CONNECTED",i[i.FAILED=-1]="FAILED",i[i.RETRYING=-2]="RETRYING",i))(wc||{}),_c=(i=>(i[i.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",i[i.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",i[i.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",i[i.LOST_CONNECTION=4]="LOST_CONNECTION",i))(_c||{}),Lc=(i=>(i[i.UNKNOWN=1]="UNKNOWN",i[i.LOADING=2]="LOADING",i[i.LOADED=3]="LOADED",i[i.ERROR=-1]="ERROR",i))(Lc||{}),xc=(i=>(i[i.INITIALIZING=1]="INITIALIZING",i[i.READY_TO_START=2]="READY_TO_START",i[i.CONNECTING=3]="CONNECTING",i[i.LOADING_MODEL=4]="LOADING_MODEL",i[i.CONNECTED=5]="CONNECTED",i[i.ERROR=-1]="ERROR",i[i.RETRYING=-2]="RETRYING",i))(xc||{}),Bc=(i=>(i[i.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",i[i.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",i[i.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",i[i.LOST_CONNECTION=4]="LOST_CONNECTION",i[i.UNABLE_TO_LOAD_ROOM_INFO=5]="UNABLE_TO_LOAD_ROOM_INFO",i[i.UNABLE_TO_LOAD_FRAME=10]="UNABLE_TO_LOAD_FRAME",i[i.UNABLE_TO_LOAD_SCENE=11]="UNABLE_TO_LOAD_SCENE",i[i.SCENE_NOT_AVAILABLE_TO_USE=12]="SCENE_NOT_AVAILABLE_TO_USE",i[i.UNABLE_TO_LOAD_SCENE_RESOURCES=13]="UNABLE_TO_LOAD_SCENE_RESOURCES",i[i.FRAME_IS_UNRESPONSIVE=14]="FRAME_IS_UNRESPONSIVE",i[i.AUTHENTICATION_FAILED=20]="AUTHENTICATION_FAILED",i))(Bc||{});Ne();Ne();var Ao=Sc(R0()),go=class{constructor(i){this.disable(),this.logger=(0,Ao.default)(i)}log(i,...r){this.logger(i,...r)}enable(i="*"){Ao.default.enable(i)}disable(){Ao.default.disable()}};Ne();var G0=Sc(U0()),Dc=class{constructor(i={}){let{throttleTime:r,logger:n=new go("@immersive/core:ObserverHelper")}=i;this.logger=n,this.throttleTime=r,this.callbacks=[],this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.publish=this.publish.bind(this),this.reset=this.reset.bind(this),this.throttleTime&&(this.publish=(0,G0.default)(this.publish,this.throttleTime))}subscribe(i){if(!i)throw new Error("Tried to subscribe to event using an invalid callback");this.callbacks.push(i)}unsubscribe(i){this.callbacks=this.callbacks.filter(r=>r!==i)}publish(...i){this.callbacks.forEach(r=>{this.callListener(r,i).catch(n=>{this.logger.log("core:ObserverHelper",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(i)}
          `)})})}reset(){this.callbacks=[]}destroy(){delete this.logger,delete this.callbacks}callListener(i,r){return new Promise((n,u)=>{try{let o=i(...r);n(o)}catch(o){u(o)}})}};Ne();Ne();var H0=class{build(i,r,n,u={},o={}){let v=document.querySelector(`#${i}`),E=new URL(r);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(u).forEach(([c,d])=>{E.searchParams.set(c,d)}),Object.entries(o).forEach(([c,d])=>{this.element.setAttribute(c,d)}),this.element.src=E.toString(),this.element.id=n,v.appendChild(this.element),this.wrapperId=i}destroy(){let i=document.querySelector(`#${this.wrapperId}`);!!i&&!!i.querySelector(`#${this.element.id}`)&&i.removeChild(this.element),this.wrapperId=null,this.element=null}};Ne();Ne();Ne();var Nc=class{constructor(i){this.observerHelpers={},this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"],this.originBlockList=["https://sketchfab.com"],this.publish=(E,c={})=>{this.logger.log("MessageBridge","Posting message to frame",E,c),this.contentWindow.postMessage({type:E,data:c},this.allowedOrigins)},this.listen=(E,c)=>{this.observerHelpers[E]||(this.observerHelpers[E]=new Dc({logger:this.logger})),this.observerHelpers[E].subscribe(c)},this.onReceiveMessage=E=>{let{type:c,data:d,source:y}=E.data;if(this.sourceBlockList.includes(y)||this.originBlockList.includes(E.origin))return;let S=!!c,I=!this.domains.length||this.domains.includes(E.origin),s=this.observerHelpers.hasOwnProperty(c);if(this.logger.log("MessageBridge",`Message received - 
        TYPE: ${E.type} 
        ORIGIN: ${E.origin} 
        DATA: ${JSON.stringify(E.data)} `),!S||!I||!s){this.logger.log("MessageBridge","Message discarded");return}this.observerHelpers[c].publish(d)};let{contentWindow:r,domains:n=[],allowedOrigins:u="*",sourceBlockList:o=[],logger:v=new go("@immersive/core:MessageBridge")}=i;if(this.logger=v,this.domains=n,this.allowedOrigins=u,this.sourceBlockList.push(...o),typeof window!="undefined"){if(this.contentWindow)throw new Error("Tried to init PostMessageBridge more than one time");this.contentWindow=r,window.addEventListener("message",this.onReceiveMessage)}}destroy(){Object.entries(this.observerHelpers).forEach(([i,r])=>{r.reset(),delete this.observerHelpers[i]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observerHelpers,delete this.sourceBlockList}},W0=10*1e3,k0=class{constructor({context:i,interval:r,contentWindow:n}){this.emitter=()=>{this.MessageBridge.publish("heartbeat",{context:this.context,timestamp:Date.now(),timeInterval:this.interval,nextMessageTime:Date.now()+this.interval})},this.listen=u=>{this.MessageBridge.listen("heartbeat",u)},this.context=i,this.interval=r||W0,this.MessageBridge=new Nc({contentWindow:n}),this.start(),this.emitter()}start(){this.timer=setInterval(this.emitter,this.interval)}stop(){clearTimeout(this.timer)}destroy(){this.stop(),this.MessageBridge.destroy()}},V0=k0});var Gc=We((YC,Uc)=>{ae();var jn=1e3,Jn=jn*60,Kn=Jn*60,In=Kn*24,z0=In*7,Q0=In*365.25;Uc.exports=function(i,r){r=r||{};var n=typeof i;if(n==="string"&&i.length>0)return j0(i);if(n==="number"&&isFinite(i))return r.long?K0(i):J0(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function j0(i){if(i=String(i),!(i.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(!!r){var n=parseFloat(r[1]),u=(r[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return n*Q0;case"weeks":case"week":case"w":return n*z0;case"days":case"day":case"d":return n*In;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Kn;case"minutes":case"minute":case"mins":case"min":case"m":return n*Jn;case"seconds":case"second":case"secs":case"sec":case"s":return n*jn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function J0(i){var r=Math.abs(i);return r>=In?Math.round(i/In)+"d":r>=Kn?Math.round(i/Kn)+"h":r>=Jn?Math.round(i/Jn)+"m":r>=jn?Math.round(i/jn)+"s":i+"ms"}function K0(i){var r=Math.abs(i);return r>=In?Ei(i,r,In,"day"):r>=Kn?Ei(i,r,Kn,"hour"):r>=Jn?Ei(i,r,Jn,"minute"):r>=jn?Ei(i,r,jn,"second"):i+" ms"}function Ei(i,r,n,u){var o=r>=n*1.5;return Math.round(i/n)+" "+u+(o?"s":"")}});var Wc=We((qC,Hc)=>{ae();function Z0(i){n.debug=n,n.default=n,n.coerce=d,n.disable=v,n.enable=o,n.enabled=E,n.humanize=Gc(),n.destroy=y,Object.keys(i).forEach(S=>{n[S]=i[S]}),n.names=[],n.skips=[],n.formatters={};function r(S){let I=0;for(let s=0;s<S.length;s++)I=(I<<5)-I+S.charCodeAt(s),I|=0;return n.colors[Math.abs(I)%n.colors.length]}n.selectColor=r;function n(S){let I,s=null,b,T;function P(...C){if(!P.enabled)return;let m=P,R=Number(new Date),l=R-(I||R);m.diff=l,m.prev=I,m.curr=R,I=R,C[0]=n.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let p=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(A,f)=>{if(A==="%%")return"%";p++;let O=n.formatters[f];if(typeof O=="function"){let w=C[p];A=O.call(m,w),C.splice(p,1),p--}return A}),n.formatArgs.call(m,C),(m.log||n.log).apply(m,C)}return P.namespace=S,P.useColors=n.useColors(),P.color=n.selectColor(S),P.extend=u,P.destroy=n.destroy,Object.defineProperty(P,"enabled",{enumerable:!0,configurable:!1,get:()=>s!==null?s:(b!==n.namespaces&&(b=n.namespaces,T=n.enabled(S)),T),set:C=>{s=C}}),typeof n.init=="function"&&n.init(P),P}function u(S,I){let s=n(this.namespace+(typeof I=="undefined"?":":I)+S);return s.log=this.log,s}function o(S){n.save(S),n.namespaces=S,n.names=[],n.skips=[];let I,s=(typeof S=="string"?S:"").split(/[\s,]+/),b=s.length;for(I=0;I<b;I++)!s[I]||(S=s[I].replace(/\*/g,".*?"),S[0]==="-"?n.skips.push(new RegExp("^"+S.slice(1)+"$")):n.names.push(new RegExp("^"+S+"$")))}function v(){let S=[...n.names.map(c),...n.skips.map(c).map(I=>"-"+I)].join(",");return n.enable(""),S}function E(S){if(S[S.length-1]==="*")return!0;let I,s;for(I=0,s=n.skips.length;I<s;I++)if(n.skips[I].test(S))return!1;for(I=0,s=n.names.length;I<s;I++)if(n.names[I].test(S))return!0;return!1}function c(S){return S.toString().substring(2,S.toString().length-2).replace(/\.\*\?$/,"*")}function d(S){return S instanceof Error?S.stack||S.message:S}function y(){}return n.enable(n.load()),n}Hc.exports=Z0});var kc=We((Et,Si)=>{ae();Et.formatArgs=q0;Et.save=X0;Et.load=$0;Et.useColors=Y0;Et.storage=ey();Et.destroy=(()=>{let i=!1;return()=>{i||(i=!0)}})();Et.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Y0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function q0(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+Si.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;i.splice(1,0,r,"color: inherit");let n=0,u=0;i[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(u=n))}),i.splice(u,0,r)}Et.log=console.debug||console.log||(()=>{});function X0(i){try{i?Et.storage.setItem("debug",i):Et.storage.removeItem("debug")}catch(r){}}function $0(){let i;try{i=Et.storage.getItem("debug")}catch(r){}return!i&&typeof process!="undefined"&&"env"in process&&(i=ve.DEBUG),i}function ey(){try{return localStorage}catch(i){}}Si.exports=Wc()(Et);var{formatters:ty}=Si.exports;ty.j=function(i){try{return JSON.stringify(i)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}});var Qc=We((yr,mo)=>{ae();(function(i,r){typeof yr=="object"&&typeof mo=="object"?mo.exports=r():typeof define=="function"&&define.amd?define([],r):typeof yr=="object"?yr.bowser=r():i.bowser=r()})(yr,function(){return function(i){var r={};function n(u){if(r[u])return r[u].exports;var o=r[u]={i:u,l:!1,exports:{}};return i[u].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=i,n.c=r,n.d=function(u,o,v){n.o(u,o)||Object.defineProperty(u,o,{enumerable:!0,get:v})},n.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},n.t=function(u,o){if(1&o&&(u=n(u)),8&o||4&o&&typeof u=="object"&&u&&u.__esModule)return u;var v=Object.create(null);if(n.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:u}),2&o&&typeof u!="string")for(var E in u)n.d(v,E,function(c){return u[c]}.bind(null,E));return v},n.n=function(u){var o=u&&u.__esModule?function(){return u.default}:function(){return u};return n.d(o,"a",o),o},n.o=function(u,o){return Object.prototype.hasOwnProperty.call(u,o)},n.p="",n(n.s=90)}({17:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u=n(18),o=function(){function v(){}return v.getFirstMatch=function(E,c){var d=c.match(E);return d&&d.length>0&&d[1]||""},v.getSecondMatch=function(E,c){var d=c.match(E);return d&&d.length>1&&d[2]||""},v.matchAndReturnConst=function(E,c,d){if(E.test(c))return d},v.getWindowsVersionName=function(E){switch(E){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},v.getMacOSVersionName=function(E){var c=E.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(c.push(0),c[0]===10)switch(c[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},v.getAndroidVersionName=function(E){var c=E.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(c.push(0),!(c[0]===1&&c[1]<5))return c[0]===1&&c[1]<6?"Cupcake":c[0]===1&&c[1]>=6?"Donut":c[0]===2&&c[1]<2?"Eclair":c[0]===2&&c[1]===2?"Froyo":c[0]===2&&c[1]>2?"Gingerbread":c[0]===3?"Honeycomb":c[0]===4&&c[1]<1?"Ice Cream Sandwich":c[0]===4&&c[1]<4?"Jelly Bean":c[0]===4&&c[1]>=4?"KitKat":c[0]===5?"Lollipop":c[0]===6?"Marshmallow":c[0]===7?"Nougat":c[0]===8?"Oreo":c[0]===9?"Pie":void 0},v.getVersionPrecision=function(E){return E.split(".").length},v.compareVersions=function(E,c,d){d===void 0&&(d=!1);var y=v.getVersionPrecision(E),S=v.getVersionPrecision(c),I=Math.max(y,S),s=0,b=v.map([E,c],function(T){var P=I-v.getVersionPrecision(T),C=T+new Array(P+1).join(".0");return v.map(C.split("."),function(m){return new Array(20-m.length).join("0")+m}).reverse()});for(d&&(s=I-Math.min(y,S)),I-=1;I>=s;){if(b[0][I]>b[1][I])return 1;if(b[0][I]===b[1][I]){if(I===s)return 0;I-=1}else if(b[0][I]<b[1][I])return-1}},v.map=function(E,c){var d,y=[];if(Array.prototype.map)return Array.prototype.map.call(E,c);for(d=0;d<E.length;d+=1)y.push(c(E[d]));return y},v.find=function(E,c){var d,y;if(Array.prototype.find)return Array.prototype.find.call(E,c);for(d=0,y=E.length;d<y;d+=1){var S=E[d];if(c(S,d))return S}},v.assign=function(E){for(var c,d,y=E,S=arguments.length,I=new Array(S>1?S-1:0),s=1;s<S;s++)I[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[E].concat(I));var b=function(){var T=I[c];typeof T=="object"&&T!==null&&Object.keys(T).forEach(function(P){y[P]=T[P]})};for(c=0,d=I.length;c<d;c+=1)b();return E},v.getBrowserAlias=function(E){return u.BROWSER_ALIASES_MAP[E]},v.getBrowserTypeByAlias=function(E){return u.BROWSER_MAP[E]||""},v}();r.default=o,i.exports=r.default},18:function(i,r,n){"use strict";r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(91))&&u.__esModule?u:{default:u},v=n(18);function E(d,y){for(var S=0;S<y.length;S++){var I=y[S];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(d,I.key,I)}}var c=function(){function d(){}var y,S,I;return d.getParser=function(s,b){if(b===void 0&&(b=!1),typeof s!="string")throw new Error("UserAgent should be a string");return new o.default(s,b)},d.parse=function(s){return new o.default(s).getResult()},y=d,I=[{key:"BROWSER_MAP",get:function(){return v.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return v.ENGINE_MAP}},{key:"OS_MAP",get:function(){return v.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return v.PLATFORMS_MAP}}],(S=null)&&E(y.prototype,S),I&&E(y,I),d}();r.default=c,i.exports=r.default},91:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u=d(n(92)),o=d(n(93)),v=d(n(94)),E=d(n(95)),c=d(n(17));function d(S){return S&&S.__esModule?S:{default:S}}var y=function(){function S(s,b){if(b===void 0&&(b=!1),s==null||s==="")throw new Error("UserAgent parameter can't be empty");this._ua=s,this.parsedResult={},b!==!0&&this.parse()}var I=S.prototype;return I.getUA=function(){return this._ua},I.test=function(s){return s.test(this._ua)},I.parseBrowser=function(){var s=this;this.parsedResult.browser={};var b=c.default.find(u.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(P){return s.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.browser=b.describe(this.getUA())),this.parsedResult.browser},I.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},I.getBrowserName=function(s){return s?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},I.getBrowserVersion=function(){return this.getBrowser().version},I.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},I.parseOS=function(){var s=this;this.parsedResult.os={};var b=c.default.find(o.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(P){return s.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.os=b.describe(this.getUA())),this.parsedResult.os},I.getOSName=function(s){var b=this.getOS().name;return s?String(b).toLowerCase()||"":b||""},I.getOSVersion=function(){return this.getOS().version},I.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},I.getPlatformType=function(s){s===void 0&&(s=!1);var b=this.getPlatform().type;return s?String(b).toLowerCase()||"":b||""},I.parsePlatform=function(){var s=this;this.parsedResult.platform={};var b=c.default.find(v.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(P){return s.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.platform=b.describe(this.getUA())),this.parsedResult.platform},I.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},I.getEngineName=function(s){return s?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},I.parseEngine=function(){var s=this;this.parsedResult.engine={};var b=c.default.find(E.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(P){return s.test(P)});throw new Error("Browser's test function is not valid")});return b&&(this.parsedResult.engine=b.describe(this.getUA())),this.parsedResult.engine},I.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},I.getResult=function(){return c.default.assign({},this.parsedResult)},I.satisfies=function(s){var b=this,T={},P=0,C={},m=0;if(Object.keys(s).forEach(function(w){var x=s[w];typeof x=="string"?(C[w]=x,m+=1):typeof x=="object"&&(T[w]=x,P+=1)}),P>0){var R=Object.keys(T),l=c.default.find(R,function(w){return b.isOS(w)});if(l){var p=this.satisfies(T[l]);if(p!==void 0)return p}var h=c.default.find(R,function(w){return b.isPlatform(w)});if(h){var A=this.satisfies(T[h]);if(A!==void 0)return A}}if(m>0){var f=Object.keys(C),O=c.default.find(f,function(w){return b.isBrowser(w,!0)});if(O!==void 0)return this.compareVersion(C[O])}},I.isBrowser=function(s,b){b===void 0&&(b=!1);var T=this.getBrowserName().toLowerCase(),P=s.toLowerCase(),C=c.default.getBrowserTypeByAlias(P);return b&&C&&(P=C.toLowerCase()),P===T},I.compareVersion=function(s){var b=[0],T=s,P=!1,C=this.getBrowserVersion();if(typeof C=="string")return s[0]===">"||s[0]==="<"?(T=s.substr(1),s[1]==="="?(P=!0,T=s.substr(2)):b=[],s[0]===">"?b.push(1):b.push(-1)):s[0]==="="?T=s.substr(1):s[0]==="~"&&(P=!0,T=s.substr(1)),b.indexOf(c.default.compareVersions(C,T,P))>-1},I.isOS=function(s){return this.getOSName(!0)===String(s).toLowerCase()},I.isPlatform=function(s){return this.getPlatformType(!0)===String(s).toLowerCase()},I.isEngine=function(s){return this.getEngineName(!0)===String(s).toLowerCase()},I.is=function(s,b){return b===void 0&&(b=!1),this.isBrowser(s,b)||this.isOS(s)||this.isPlatform(s)},I.some=function(s){var b=this;return s===void 0&&(s=[]),s.some(function(T){return b.is(T)})},S}();r.default=y,i.exports=r.default},92:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},v=/version\/(\d+(\.?_?\d+)+)/i,E=[{test:[/googlebot/i],describe:function(c){var d={name:"Googlebot"},y=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/opera/i],describe:function(c){var d={name:"Opera"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/opr\/|opios/i],describe:function(c){var d={name:"Opera"},y=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/SamsungBrowser/i],describe:function(c){var d={name:"Samsung Internet for Android"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/Whale/i],describe:function(c){var d={name:"NAVER Whale Browser"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/MZBrowser/i],describe:function(c){var d={name:"MZ Browser"},y=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/focus/i],describe:function(c){var d={name:"Focus"},y=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/swing/i],describe:function(c){var d={name:"Swing"},y=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/coast/i],describe:function(c){var d={name:"Opera Coast"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(c){var d={name:"Opera Touch"},y=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/yabrowser/i],describe:function(c){var d={name:"Yandex Browser"},y=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/ucbrowser/i],describe:function(c){var d={name:"UC Browser"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/Maxthon|mxios/i],describe:function(c){var d={name:"Maxthon"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/epiphany/i],describe:function(c){var d={name:"Epiphany"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/puffin/i],describe:function(c){var d={name:"Puffin"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/sleipnir/i],describe:function(c){var d={name:"Sleipnir"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/k-meleon/i],describe:function(c){var d={name:"K-Meleon"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/micromessenger/i],describe:function(c){var d={name:"WeChat"},y=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/qqbrowser/i],describe:function(c){var d={name:/qqbrowserlite/i.test(c)?"QQ Browser Lite":"QQ Browser"},y=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/msie|trident/i],describe:function(c){var d={name:"Internet Explorer"},y=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/\sedg\//i],describe:function(c){var d={name:"Microsoft Edge"},y=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/edg([ea]|ios)/i],describe:function(c){var d={name:"Microsoft Edge"},y=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/vivaldi/i],describe:function(c){var d={name:"Vivaldi"},y=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/seamonkey/i],describe:function(c){var d={name:"SeaMonkey"},y=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/sailfish/i],describe:function(c){var d={name:"Sailfish"},y=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,c);return y&&(d.version=y),d}},{test:[/silk/i],describe:function(c){var d={name:"Amazon Silk"},y=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/phantom/i],describe:function(c){var d={name:"PhantomJS"},y=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/slimerjs/i],describe:function(c){var d={name:"SlimerJS"},y=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var d={name:"BlackBerry"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var d={name:"WebOS Browser"},y=o.default.getFirstMatch(v,c)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/bada/i],describe:function(c){var d={name:"Bada"},y=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/tizen/i],describe:function(c){var d={name:"Tizen"},y=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/qupzilla/i],describe:function(c){var d={name:"QupZilla"},y=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(c){var d={name:"Firefox"},y=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/electron/i],describe:function(c){var d={name:"Electron"},y=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/MiuiBrowser/i],describe:function(c){var d={name:"Miui"},y=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/chromium/i],describe:function(c){var d={name:"Chromium"},y=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,c)||o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/chrome|crios|crmo/i],describe:function(c){var d={name:"Chrome"},y=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/GSA/i],describe:function(c){var d={name:"Google Search"},y=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:function(c){var d=!c.test(/like android/i),y=c.test(/android/i);return d&&y},describe:function(c){var d={name:"Android Browser"},y=o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/playstation 4/i],describe:function(c){var d={name:"PlayStation 4"},y=o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/safari|applewebkit/i],describe:function(c){var d={name:"Safari"},y=o.default.getFirstMatch(v,c);return y&&(d.version=y),d}},{test:[/.*/i],describe:function(c){var d=c.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(d,c),version:o.default.getSecondMatch(d,c)}}}];r.default=E,i.exports=r.default},93:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},v=n(18),E=[{test:[/Roku\/DVP/],describe:function(c){var d=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,c);return{name:v.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(c){var d=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,c);return{name:v.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(c){var d=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,c),y=o.default.getWindowsVersionName(d);return{name:v.OS_MAP.Windows,version:d,versionName:y}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(c){var d={name:v.OS_MAP.iOS},y=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,c);return y&&(d.version=y),d}},{test:[/macintosh/i],describe:function(c){var d=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,c).replace(/[_\s]/g,"."),y=o.default.getMacOSVersionName(d),S={name:v.OS_MAP.MacOS,version:d};return y&&(S.versionName=y),S}},{test:[/(ipod|iphone|ipad)/i],describe:function(c){var d=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,c).replace(/[_\s]/g,".");return{name:v.OS_MAP.iOS,version:d}}},{test:function(c){var d=!c.test(/like android/i),y=c.test(/android/i);return d&&y},describe:function(c){var d=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,c),y=o.default.getAndroidVersionName(d),S={name:v.OS_MAP.Android,version:d};return y&&(S.versionName=y),S}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var d=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,c),y={name:v.OS_MAP.WebOS};return d&&d.length&&(y.version=d),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var d=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,c)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,c)||o.default.getFirstMatch(/\bbb(\d+)/i,c);return{name:v.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(c){var d=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,c);return{name:v.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(c){var d=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,c);return{name:v.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:v.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:v.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(c){var d=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,c);return{name:v.OS_MAP.PlayStation4,version:d}}}];r.default=E,i.exports=r.default},94:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},v=n(18),E=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(c){var d=o.default.getFirstMatch(/(can-l01)/i,c)&&"Nova",y={type:v.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(y.model=d),y}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:v.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:v.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:v.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:v.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:v.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:v.PLATFORMS_MAP.tablet}}},{test:function(c){var d=c.test(/ipod|iphone/i),y=c.test(/like (ipod|iphone)/i);return d&&!y},describe:function(c){var d=o.default.getFirstMatch(/(ipod|iphone)/i,c);return{type:v.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:v.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:v.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName(!0)==="blackberry"},describe:function(){return{type:v.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(c){return c.getBrowserName(!0)==="bada"},describe:function(){return{type:v.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName()==="windows phone"},describe:function(){return{type:v.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(c){var d=Number(String(c.getOSVersion()).split(".")[0]);return c.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:v.PLATFORMS_MAP.tablet}}},{test:function(c){return c.getOSName(!0)==="android"},describe:function(){return{type:v.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getOSName(!0)==="macos"},describe:function(){return{type:v.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(c){return c.getOSName(!0)==="windows"},describe:function(){return{type:v.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="linux"},describe:function(){return{type:v.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="playstation 4"},describe:function(){return{type:v.PLATFORMS_MAP.tv}}},{test:function(c){return c.getOSName(!0)==="roku"},describe:function(){return{type:v.PLATFORMS_MAP.tv}}}];r.default=E,i.exports=r.default},95:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},v=n(18),E=[{test:function(c){return c.getBrowserName(!0)==="microsoft edge"},describe:function(c){if(/\sedg\//i.test(c))return{name:v.ENGINE_MAP.Blink};var d=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,c);return{name:v.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(c){var d={name:v.ENGINE_MAP.Trident},y=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:function(c){return c.test(/presto/i)},describe:function(c){var d={name:v.ENGINE_MAP.Presto},y=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:function(c){var d=c.test(/gecko/i),y=c.test(/like gecko/i);return d&&!y},describe:function(c){var d={name:v.ENGINE_MAP.Gecko},y=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:v.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(c){var d={name:v.ENGINE_MAP.WebKit},y=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,c);return y&&(d.version=y),d}}];r.default=E,i.exports=r.default}})})});var Rl=We((Cr,Yn)=>{ae();var ny=200,Mo="__lodash_hash_undefined__",xi=1,rl=2,il=9007199254740991,Ri="[object Arguments]",Oo="[object Array]",ry="[object AsyncFunction]",al="[object Boolean]",ol="[object Date]",sl="[object Error]",ul="[object Function]",iy="[object GeneratorFunction]",Ti="[object Map]",cl="[object Number]",ay="[object Null]",Zn="[object Object]",jc="[object Promise]",oy="[object Proxy]",ll="[object RegExp]",Pi="[object Set]",fl="[object String]",sy="[object Symbol]",uy="[object Undefined]",Eo="[object WeakMap]",dl="[object ArrayBuffer]",Mi="[object DataView]",cy="[object Float32Array]",ly="[object Float64Array]",fy="[object Int8Array]",dy="[object Int16Array]",hy="[object Int32Array]",Ay="[object Uint8Array]",py="[object Uint8ClampedArray]",gy="[object Uint16Array]",vy="[object Uint32Array]",my=/[\\^$.*+?()[\]{}|]/g,yy=/^\[object .+?Constructor\]$/,by=/^(?:0|[1-9]\d*)$/,ze={};ze[cy]=ze[ly]=ze[fy]=ze[dy]=ze[hy]=ze[Ay]=ze[py]=ze[gy]=ze[vy]=!0;ze[Ri]=ze[Oo]=ze[dl]=ze[al]=ze[Mi]=ze[ol]=ze[sl]=ze[ul]=ze[Ti]=ze[cl]=ze[Zn]=ze[ll]=ze[Pi]=ze[fl]=ze[Eo]=!1;var hl=typeof global=="object"&&global&&global.Object===Object&&global,Cy=typeof self=="object"&&self&&self.Object===Object&&self,Xt=hl||Cy||Function("return this")(),Al=typeof Cr=="object"&&Cr&&!Cr.nodeType&&Cr,Jc=Al&&typeof Yn=="object"&&Yn&&!Yn.nodeType&&Yn,pl=Jc&&Jc.exports===Al,yo=pl&&hl.process,Kc=function(){try{return yo&&yo.binding&&yo.binding("util")}catch(i){}}(),Zc=Kc&&Kc.isTypedArray;function Oy(i,r){for(var n=-1,u=i==null?0:i.length,o=0,v=[];++n<u;){var E=i[n];r(E,n,i)&&(v[o++]=E)}return v}function Ey(i,r){for(var n=-1,u=r.length,o=i.length;++n<u;)i[o+n]=r[n];return i}function Sy(i,r){for(var n=-1,u=i==null?0:i.length;++n<u;)if(r(i[n],n,i))return!0;return!1}function Iy(i,r){for(var n=-1,u=Array(i);++n<i;)u[n]=r(n);return u}function Ry(i){return function(r){return i(r)}}function Ty(i,r){return i.has(r)}function Py(i,r){return i==null?void 0:i[r]}function My(i){var r=-1,n=Array(i.size);return i.forEach(function(u,o){n[++r]=[o,u]}),n}function wy(i,r){return function(n){return i(r(n))}}function _y(i){var r=-1,n=Array(i.size);return i.forEach(function(u){n[++r]=u}),n}var Ly=Array.prototype,xy=Function.prototype,Bi=Object.prototype,bo=Xt["__core-js_shared__"],gl=xy.toString,kt=Bi.hasOwnProperty,Yc=function(){var i=/[^.]+$/.exec(bo&&bo.keys&&bo.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),vl=Bi.toString,By=RegExp("^"+gl.call(kt).replace(my,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qc=pl?Xt.Buffer:void 0,wi=Xt.Symbol,Xc=Xt.Uint8Array,ml=Bi.propertyIsEnumerable,Dy=Ly.splice,Rn=wi?wi.toStringTag:void 0,$c=Object.getOwnPropertySymbols,Ny=qc?qc.isBuffer:void 0,Fy=wy(Object.keys,Object),So=qn(Xt,"DataView"),Or=qn(Xt,"Map"),Io=qn(Xt,"Promise"),Ro=qn(Xt,"Set"),To=qn(Xt,"WeakMap"),Er=qn(Object,"create"),Uy=Mn(So),Gy=Mn(Or),Hy=Mn(Io),Wy=Mn(Ro),ky=Mn(To),el=wi?wi.prototype:void 0,Co=el?el.valueOf:void 0;function Tn(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function Vy(){this.__data__=Er?Er(null):{},this.size=0}function zy(i){var r=this.has(i)&&delete this.__data__[i];return this.size-=r?1:0,r}function Qy(i){var r=this.__data__;if(Er){var n=r[i];return n===Mo?void 0:n}return kt.call(r,i)?r[i]:void 0}function jy(i){var r=this.__data__;return Er?r[i]!==void 0:kt.call(r,i)}function Jy(i,r){var n=this.__data__;return this.size+=this.has(i)?0:1,n[i]=Er&&r===void 0?Mo:r,this}Tn.prototype.clear=Vy;Tn.prototype.delete=zy;Tn.prototype.get=Qy;Tn.prototype.has=jy;Tn.prototype.set=Jy;function $t(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function Ky(){this.__data__=[],this.size=0}function Zy(i){var r=this.__data__,n=Di(r,i);if(n<0)return!1;var u=r.length-1;return n==u?r.pop():Dy.call(r,n,1),--this.size,!0}function Yy(i){var r=this.__data__,n=Di(r,i);return n<0?void 0:r[n][1]}function qy(i){return Di(this.__data__,i)>-1}function Xy(i,r){var n=this.__data__,u=Di(n,i);return u<0?(++this.size,n.push([i,r])):n[u][1]=r,this}$t.prototype.clear=Ky;$t.prototype.delete=Zy;$t.prototype.get=Yy;$t.prototype.has=qy;$t.prototype.set=Xy;function Pn(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function $y(){this.size=0,this.__data__={hash:new Tn,map:new(Or||$t),string:new Tn}}function eb(i){var r=Ni(this,i).delete(i);return this.size-=r?1:0,r}function tb(i){return Ni(this,i).get(i)}function nb(i){return Ni(this,i).has(i)}function rb(i,r){var n=Ni(this,i),u=n.size;return n.set(i,r),this.size+=n.size==u?0:1,this}Pn.prototype.clear=$y;Pn.prototype.delete=eb;Pn.prototype.get=tb;Pn.prototype.has=nb;Pn.prototype.set=rb;function _i(i){var r=-1,n=i==null?0:i.length;for(this.__data__=new Pn;++r<n;)this.add(i[r])}function ib(i){return this.__data__.set(i,Mo),this}function ab(i){return this.__data__.has(i)}_i.prototype.add=_i.prototype.push=ib;_i.prototype.has=ab;function hn(i){var r=this.__data__=new $t(i);this.size=r.size}function ob(){this.__data__=new $t,this.size=0}function sb(i){var r=this.__data__,n=r.delete(i);return this.size=r.size,n}function ub(i){return this.__data__.get(i)}function cb(i){return this.__data__.has(i)}function lb(i,r){var n=this.__data__;if(n instanceof $t){var u=n.__data__;if(!Or||u.length<ny-1)return u.push([i,r]),this.size=++n.size,this;n=this.__data__=new Pn(u)}return n.set(i,r),this.size=n.size,this}hn.prototype.clear=ob;hn.prototype.delete=sb;hn.prototype.get=ub;hn.prototype.has=cb;hn.prototype.set=lb;function fb(i,r){var n=Li(i),u=!n&&Rb(i),o=!n&&!u&&Po(i),v=!n&&!u&&!o&&Il(i),E=n||u||o||v,c=E?Iy(i.length,String):[],d=c.length;for(var y in i)(r||kt.call(i,y))&&!(E&&(y=="length"||o&&(y=="offset"||y=="parent")||v&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||Cb(y,d)))&&c.push(y);return c}function Di(i,r){for(var n=i.length;n--;)if(Cl(i[n][0],r))return n;return-1}function db(i,r,n){var u=r(i);return Li(i)?u:Ey(u,n(i))}function Ir(i){return i==null?i===void 0?uy:ay:Rn&&Rn in Object(i)?yb(i):Ib(i)}function tl(i){return Sr(i)&&Ir(i)==Ri}function yl(i,r,n,u,o){return i===r?!0:i==null||r==null||!Sr(i)&&!Sr(r)?i!==i&&r!==r:hb(i,r,n,u,yl,o)}function hb(i,r,n,u,o,v){var E=Li(i),c=Li(r),d=E?Oo:dn(i),y=c?Oo:dn(r);d=d==Ri?Zn:d,y=y==Ri?Zn:y;var S=d==Zn,I=y==Zn,s=d==y;if(s&&Po(i)){if(!Po(r))return!1;E=!0,S=!1}if(s&&!S)return v||(v=new hn),E||Il(i)?bl(i,r,n,u,o,v):vb(i,r,d,n,u,o,v);if(!(n&xi)){var b=S&&kt.call(i,"__wrapped__"),T=I&&kt.call(r,"__wrapped__");if(b||T){var P=b?i.value():i,C=T?r.value():r;return v||(v=new hn),o(P,C,n,u,v)}}return s?(v||(v=new hn),mb(i,r,n,u,o,v)):!1}function Ab(i){if(!Sl(i)||Eb(i))return!1;var r=Ol(i)?By:yy;return r.test(Mn(i))}function pb(i){return Sr(i)&&El(i.length)&&!!ze[Ir(i)]}function gb(i){if(!Sb(i))return Fy(i);var r=[];for(var n in Object(i))kt.call(i,n)&&n!="constructor"&&r.push(n);return r}function bl(i,r,n,u,o,v){var E=n&xi,c=i.length,d=r.length;if(c!=d&&!(E&&d>c))return!1;var y=v.get(i);if(y&&v.get(r))return y==r;var S=-1,I=!0,s=n&rl?new _i:void 0;for(v.set(i,r),v.set(r,i);++S<c;){var b=i[S],T=r[S];if(u)var P=E?u(T,b,S,r,i,v):u(b,T,S,i,r,v);if(P!==void 0){if(P)continue;I=!1;break}if(s){if(!Sy(r,function(C,m){if(!Ty(s,m)&&(b===C||o(b,C,n,u,v)))return s.push(m)})){I=!1;break}}else if(!(b===T||o(b,T,n,u,v))){I=!1;break}}return v.delete(i),v.delete(r),I}function vb(i,r,n,u,o,v,E){switch(n){case Mi:if(i.byteLength!=r.byteLength||i.byteOffset!=r.byteOffset)return!1;i=i.buffer,r=r.buffer;case dl:return!(i.byteLength!=r.byteLength||!v(new Xc(i),new Xc(r)));case al:case ol:case cl:return Cl(+i,+r);case sl:return i.name==r.name&&i.message==r.message;case ll:case fl:return i==r+"";case Ti:var c=My;case Pi:var d=u&xi;if(c||(c=_y),i.size!=r.size&&!d)return!1;var y=E.get(i);if(y)return y==r;u|=rl,E.set(i,r);var S=bl(c(i),c(r),u,o,v,E);return E.delete(i),S;case sy:if(Co)return Co.call(i)==Co.call(r)}return!1}function mb(i,r,n,u,o,v){var E=n&xi,c=nl(i),d=c.length,y=nl(r),S=y.length;if(d!=S&&!E)return!1;for(var I=d;I--;){var s=c[I];if(!(E?s in r:kt.call(r,s)))return!1}var b=v.get(i);if(b&&v.get(r))return b==r;var T=!0;v.set(i,r),v.set(r,i);for(var P=E;++I<d;){s=c[I];var C=i[s],m=r[s];if(u)var R=E?u(m,C,s,r,i,v):u(C,m,s,i,r,v);if(!(R===void 0?C===m||o(C,m,n,u,v):R)){T=!1;break}P||(P=s=="constructor")}if(T&&!P){var l=i.constructor,p=r.constructor;l!=p&&"constructor"in i&&"constructor"in r&&!(typeof l=="function"&&l instanceof l&&typeof p=="function"&&p instanceof p)&&(T=!1)}return v.delete(i),v.delete(r),T}function nl(i){return db(i,Mb,bb)}function Ni(i,r){var n=i.__data__;return Ob(r)?n[typeof r=="string"?"string":"hash"]:n.map}function qn(i,r){var n=Py(i,r);return Ab(n)?n:void 0}function yb(i){var r=kt.call(i,Rn),n=i[Rn];try{i[Rn]=void 0;var u=!0}catch(v){}var o=vl.call(i);return u&&(r?i[Rn]=n:delete i[Rn]),o}var bb=$c?function(i){return i==null?[]:(i=Object(i),Oy($c(i),function(r){return ml.call(i,r)}))}:wb,dn=Ir;(So&&dn(new So(new ArrayBuffer(1)))!=Mi||Or&&dn(new Or)!=Ti||Io&&dn(Io.resolve())!=jc||Ro&&dn(new Ro)!=Pi||To&&dn(new To)!=Eo)&&(dn=function(i){var r=Ir(i),n=r==Zn?i.constructor:void 0,u=n?Mn(n):"";if(u)switch(u){case Uy:return Mi;case Gy:return Ti;case Hy:return jc;case Wy:return Pi;case ky:return Eo}return r});function Cb(i,r){return r=r==null?il:r,!!r&&(typeof i=="number"||by.test(i))&&i>-1&&i%1==0&&i<r}function Ob(i){var r=typeof i;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?i!=="__proto__":i===null}function Eb(i){return!!Yc&&Yc in i}function Sb(i){var r=i&&i.constructor,n=typeof r=="function"&&r.prototype||Bi;return i===n}function Ib(i){return vl.call(i)}function Mn(i){if(i!=null){try{return gl.call(i)}catch(r){}try{return i+""}catch(r){}}return""}function Cl(i,r){return i===r||i!==i&&r!==r}var Rb=tl(function(){return arguments}())?tl:function(i){return Sr(i)&&kt.call(i,"callee")&&!ml.call(i,"callee")},Li=Array.isArray;function Tb(i){return i!=null&&El(i.length)&&!Ol(i)}var Po=Ny||_b;function Pb(i,r){return yl(i,r)}function Ol(i){if(!Sl(i))return!1;var r=Ir(i);return r==ul||r==iy||r==ry||r==oy}function El(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=il}function Sl(i){var r=typeof i;return i!=null&&(r=="object"||r=="function")}function Sr(i){return i!=null&&typeof i=="object"}var Il=Zc?Ry(Zc):pb;function Mb(i){return Tb(i)?fb(i):gb(i)}function wb(){return[]}function _b(){return!1}Yn.exports=Pb});var Pl=We((Xn,Rr)=>{ae();(function(){var i,r="4.17.21",n=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",v="Invalid `variable` option passed into `_.template`",E="__lodash_hash_undefined__",c=500,d="__lodash_placeholder__",y=1,S=2,I=4,s=1,b=2,T=1,P=2,C=4,m=8,R=16,l=32,p=64,h=128,A=256,f=512,O=30,w="...",x=800,V=16,H=1,B=2,M=3,L=1/0,k=9007199254740991,W=17976931348623157e292,K=0/0,$=4294967295,Y=$-1,G=$>>>1,D=[["ary",h],["bind",T],["bindKey",P],["curry",m],["curryRight",R],["flip",f],["partial",l],["partialRight",p],["rearg",A]],F="[object Arguments]",j="[object Array]",Q="[object AsyncFunction]",ee="[object Boolean]",ce="[object Date]",me="[object DOMException]",ge="[object Error]",Se="[object Function]",xe="[object GeneratorFunction]",fe="[object Map]",Le="[object Number]",tt="[object Null]",Ue="[object Object]",Qe="[object Promise]",ft="[object Proxy]",X="[object RegExp]",re="[object Set]",ue="[object String]",he="[object Symbol]",Re="[object Undefined]",Xe="[object WeakMap]",An="[object WeakSet]",tr="[object ArrayBuffer]",wn="[object DataView]",zi="[object Float32Array]",Qi="[object Float64Array]",ji="[object Int8Array]",Ji="[object Int16Array]",Ki="[object Int32Array]",Zi="[object Uint8Array]",Yi="[object Uint8ClampedArray]",qi="[object Uint16Array]",Xi="[object Uint32Array]",Tf=/\b__p \+= '';/g,Pf=/\b(__p \+=) '' \+/g,Mf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,zo=/&(?:amp|lt|gt|quot|#39);/g,Qo=/[&<>"']/g,wf=RegExp(zo.source),_f=RegExp(Qo.source),Lf=/<%-([\s\S]+?)%>/g,xf=/<%([\s\S]+?)%>/g,jo=/<%=([\s\S]+?)%>/g,Bf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Df=/^\w*$/,Nf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$i=/[\\^$.*+?()[\]{}|]/g,Ff=RegExp($i.source),ea=/^\s+/,Uf=/\s/,Gf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Hf=/\{\n\/\* \[wrapped with (.+)\] \*/,Wf=/,? & /,kf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Vf=/[()=,{}\[\]\/\s]/,zf=/\\(\\)?/g,Qf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Jo=/\w*$/,jf=/^[-+]0x[0-9a-f]+$/i,Jf=/^0b[01]+$/i,Kf=/^\[object .+?Constructor\]$/,Zf=/^0o[0-7]+$/i,Yf=/^(?:0|[1-9]\d*)$/,qf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wr=/($^)/,Xf=/['\n\r\u2028\u2029\\]/g,_r="\\ud800-\\udfff",$f="\\u0300-\\u036f",ed="\\ufe20-\\ufe2f",td="\\u20d0-\\u20ff",Ko=$f+ed+td,Zo="\\u2700-\\u27bf",Yo="a-z\\xdf-\\xf6\\xf8-\\xff",nd="\\xac\\xb1\\xd7\\xf7",rd="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",id="\\u2000-\\u206f",ad=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",qo="A-Z\\xc0-\\xd6\\xd8-\\xde",Xo="\\ufe0e\\ufe0f",$o=nd+rd+id+ad,ta="['\u2019]",od="["+_r+"]",es="["+$o+"]",Lr="["+Ko+"]",ts="\\d+",sd="["+Zo+"]",ns="["+Yo+"]",rs="[^"+_r+$o+ts+Zo+Yo+qo+"]",na="\\ud83c[\\udffb-\\udfff]",ud="(?:"+Lr+"|"+na+")",is="[^"+_r+"]",ra="(?:\\ud83c[\\udde6-\\uddff]){2}",ia="[\\ud800-\\udbff][\\udc00-\\udfff]",_n="["+qo+"]",as="\\u200d",os="(?:"+ns+"|"+rs+")",cd="(?:"+_n+"|"+rs+")",ss="(?:"+ta+"(?:d|ll|m|re|s|t|ve))?",us="(?:"+ta+"(?:D|LL|M|RE|S|T|VE))?",cs=ud+"?",ls="["+Xo+"]?",ld="(?:"+as+"(?:"+[is,ra,ia].join("|")+")"+ls+cs+")*",fd="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",dd="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",fs=ls+cs+ld,hd="(?:"+[sd,ra,ia].join("|")+")"+fs,Ad="(?:"+[is+Lr+"?",Lr,ra,ia,od].join("|")+")",pd=RegExp(ta,"g"),gd=RegExp(Lr,"g"),aa=RegExp(na+"(?="+na+")|"+Ad+fs,"g"),vd=RegExp([_n+"?"+ns+"+"+ss+"(?="+[es,_n,"$"].join("|")+")",cd+"+"+us+"(?="+[es,_n+os,"$"].join("|")+")",_n+"?"+os+"+"+ss,_n+"+"+us,dd,fd,ts,hd].join("|"),"g"),md=RegExp("["+as+_r+Ko+Xo+"]"),yd=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bd=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Cd=-1,Ve={};Ve[zi]=Ve[Qi]=Ve[ji]=Ve[Ji]=Ve[Ki]=Ve[Zi]=Ve[Yi]=Ve[qi]=Ve[Xi]=!0,Ve[F]=Ve[j]=Ve[tr]=Ve[ee]=Ve[wn]=Ve[ce]=Ve[ge]=Ve[Se]=Ve[fe]=Ve[Le]=Ve[Ue]=Ve[X]=Ve[re]=Ve[ue]=Ve[Xe]=!1;var He={};He[F]=He[j]=He[tr]=He[wn]=He[ee]=He[ce]=He[zi]=He[Qi]=He[ji]=He[Ji]=He[Ki]=He[fe]=He[Le]=He[Ue]=He[X]=He[re]=He[ue]=He[he]=He[Zi]=He[Yi]=He[qi]=He[Xi]=!0,He[ge]=He[Se]=He[Xe]=!1;var Od={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Ed={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Sd={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Id={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Rd=parseFloat,Td=parseInt,ds=typeof global=="object"&&global&&global.Object===Object&&global,Pd=typeof self=="object"&&self&&self.Object===Object&&self,nt=ds||Pd||Function("return this")(),oa=typeof Xn=="object"&&Xn&&!Xn.nodeType&&Xn,pn=oa&&typeof Rr=="object"&&Rr&&!Rr.nodeType&&Rr,hs=pn&&pn.exports===oa,sa=hs&&ds.process,St=function(){try{var Z=pn&&pn.require&&pn.require("util").types;return Z||sa&&sa.binding&&sa.binding("util")}catch(ne){}}(),As=St&&St.isArrayBuffer,ps=St&&St.isDate,gs=St&&St.isMap,vs=St&&St.isRegExp,ms=St&&St.isSet,ys=St&&St.isTypedArray;function vt(Z,ne,te){switch(te.length){case 0:return Z.call(ne);case 1:return Z.call(ne,te[0]);case 2:return Z.call(ne,te[0],te[1]);case 3:return Z.call(ne,te[0],te[1],te[2])}return Z.apply(ne,te)}function Md(Z,ne,te,de){for(var Oe=-1,Be=Z==null?0:Z.length;++Oe<Be;){var $e=Z[Oe];ne(de,$e,te($e),Z)}return de}function It(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de&&ne(Z[te],te,Z)!==!1;);return Z}function wd(Z,ne){for(var te=Z==null?0:Z.length;te--&&ne(Z[te],te,Z)!==!1;);return Z}function bs(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de;)if(!ne(Z[te],te,Z))return!1;return!0}function en(Z,ne){for(var te=-1,de=Z==null?0:Z.length,Oe=0,Be=[];++te<de;){var $e=Z[te];ne($e,te,Z)&&(Be[Oe++]=$e)}return Be}function xr(Z,ne){var te=Z==null?0:Z.length;return!!te&&Ln(Z,ne,0)>-1}function ua(Z,ne,te){for(var de=-1,Oe=Z==null?0:Z.length;++de<Oe;)if(te(ne,Z[de]))return!0;return!1}function je(Z,ne){for(var te=-1,de=Z==null?0:Z.length,Oe=Array(de);++te<de;)Oe[te]=ne(Z[te],te,Z);return Oe}function tn(Z,ne){for(var te=-1,de=ne.length,Oe=Z.length;++te<de;)Z[Oe+te]=ne[te];return Z}function ca(Z,ne,te,de){var Oe=-1,Be=Z==null?0:Z.length;for(de&&Be&&(te=Z[++Oe]);++Oe<Be;)te=ne(te,Z[Oe],Oe,Z);return te}function _d(Z,ne,te,de){var Oe=Z==null?0:Z.length;for(de&&Oe&&(te=Z[--Oe]);Oe--;)te=ne(te,Z[Oe],Oe,Z);return te}function la(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de;)if(ne(Z[te],te,Z))return!0;return!1}var Ld=fa("length");function xd(Z){return Z.split("")}function Bd(Z){return Z.match(kf)||[]}function Cs(Z,ne,te){var de;return te(Z,function(Oe,Be,$e){if(ne(Oe,Be,$e))return de=Be,!1}),de}function Br(Z,ne,te,de){for(var Oe=Z.length,Be=te+(de?1:-1);de?Be--:++Be<Oe;)if(ne(Z[Be],Be,Z))return Be;return-1}function Ln(Z,ne,te){return ne===ne?jd(Z,ne,te):Br(Z,Os,te)}function Dd(Z,ne,te,de){for(var Oe=te-1,Be=Z.length;++Oe<Be;)if(de(Z[Oe],ne))return Oe;return-1}function Os(Z){return Z!==Z}function Es(Z,ne){var te=Z==null?0:Z.length;return te?ha(Z,ne)/te:K}function fa(Z){return function(ne){return ne==null?i:ne[Z]}}function da(Z){return function(ne){return Z==null?i:Z[ne]}}function Ss(Z,ne,te,de,Oe){return Oe(Z,function(Be,$e,Ge){te=de?(de=!1,Be):ne(te,Be,$e,Ge)}),te}function Nd(Z,ne){var te=Z.length;for(Z.sort(ne);te--;)Z[te]=Z[te].value;return Z}function ha(Z,ne){for(var te,de=-1,Oe=Z.length;++de<Oe;){var Be=ne(Z[de]);Be!==i&&(te=te===i?Be:te+Be)}return te}function Aa(Z,ne){for(var te=-1,de=Array(Z);++te<Z;)de[te]=ne(te);return de}function Fd(Z,ne){return je(ne,function(te){return[te,Z[te]]})}function Is(Z){return Z&&Z.slice(0,Ms(Z)+1).replace(ea,"")}function mt(Z){return function(ne){return Z(ne)}}function pa(Z,ne){return je(ne,function(te){return Z[te]})}function nr(Z,ne){return Z.has(ne)}function Rs(Z,ne){for(var te=-1,de=Z.length;++te<de&&Ln(ne,Z[te],0)>-1;);return te}function Ts(Z,ne){for(var te=Z.length;te--&&Ln(ne,Z[te],0)>-1;);return te}function Ud(Z,ne){for(var te=Z.length,de=0;te--;)Z[te]===ne&&++de;return de}var Gd=da(Od),Hd=da(Ed);function Wd(Z){return"\\"+Id[Z]}function kd(Z,ne){return Z==null?i:Z[ne]}function xn(Z){return md.test(Z)}function Vd(Z){return yd.test(Z)}function zd(Z){for(var ne,te=[];!(ne=Z.next()).done;)te.push(ne.value);return te}function ga(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de,Oe){te[++ne]=[Oe,de]}),te}function Ps(Z,ne){return function(te){return Z(ne(te))}}function nn(Z,ne){for(var te=-1,de=Z.length,Oe=0,Be=[];++te<de;){var $e=Z[te];($e===ne||$e===d)&&(Z[te]=d,Be[Oe++]=te)}return Be}function Dr(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de){te[++ne]=de}),te}function Qd(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de){te[++ne]=[de,de]}),te}function jd(Z,ne,te){for(var de=te-1,Oe=Z.length;++de<Oe;)if(Z[de]===ne)return de;return-1}function Jd(Z,ne,te){for(var de=te+1;de--;)if(Z[de]===ne)return de;return de}function Bn(Z){return xn(Z)?Zd(Z):Ld(Z)}function Bt(Z){return xn(Z)?Yd(Z):xd(Z)}function Ms(Z){for(var ne=Z.length;ne--&&Uf.test(Z.charAt(ne)););return ne}var Kd=da(Sd);function Zd(Z){for(var ne=aa.lastIndex=0;aa.test(Z);)++ne;return ne}function Yd(Z){return Z.match(aa)||[]}function qd(Z){return Z.match(vd)||[]}var Xd=function Z(ne){ne=ne==null?nt:rn.defaults(nt.Object(),ne,rn.pick(nt,bd));var te=ne.Array,de=ne.Date,Oe=ne.Error,Be=ne.Function,$e=ne.Math,Ge=ne.Object,va=ne.RegExp,$d=ne.String,Rt=ne.TypeError,Nr=te.prototype,eh=Be.prototype,Dn=Ge.prototype,Fr=ne["__core-js_shared__"],Ur=eh.toString,Fe=Dn.hasOwnProperty,th=0,ws=function(){var e=/[^.]+$/.exec(Fr&&Fr.keys&&Fr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Gr=Dn.toString,nh=Ur.call(Ge),rh=nt._,ih=va("^"+Ur.call(Fe).replace($i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hr=hs?ne.Buffer:i,an=ne.Symbol,Wr=ne.Uint8Array,_s=Hr?Hr.allocUnsafe:i,kr=Ps(Ge.getPrototypeOf,Ge),Ls=Ge.create,xs=Dn.propertyIsEnumerable,Vr=Nr.splice,Bs=an?an.isConcatSpreadable:i,rr=an?an.iterator:i,gn=an?an.toStringTag:i,zr=function(){try{var e=Cn(Ge,"defineProperty");return e({},"",{}),e}catch(t){}}(),ah=ne.clearTimeout!==nt.clearTimeout&&ne.clearTimeout,oh=de&&de.now!==nt.Date.now&&de.now,sh=ne.setTimeout!==nt.setTimeout&&ne.setTimeout,Qr=$e.ceil,jr=$e.floor,ma=Ge.getOwnPropertySymbols,uh=Hr?Hr.isBuffer:i,Ds=ne.isFinite,ch=Nr.join,lh=Ps(Ge.keys,Ge),et=$e.max,ot=$e.min,fh=de.now,dh=ne.parseInt,Ns=$e.random,hh=Nr.reverse,ya=Cn(ne,"DataView"),ir=Cn(ne,"Map"),ba=Cn(ne,"Promise"),Nn=Cn(ne,"Set"),ar=Cn(ne,"WeakMap"),or=Cn(Ge,"create"),Jr=ar&&new ar,Fn={},Ah=On(ya),ph=On(ir),gh=On(ba),vh=On(Nn),mh=On(ar),Kr=an?an.prototype:i,sr=Kr?Kr.valueOf:i,Fs=Kr?Kr.toString:i;function N(e){if(Ke(e)&&!Ee(e)&&!(e instanceof we)){if(e instanceof Tt)return e;if(Fe.call(e,"__wrapped__"))return Uu(e)}return new Tt(e)}var Un=function(){function e(){}return function(t){if(!Je(t))return{};if(Ls)return Ls(t);e.prototype=t;var a=new e;return e.prototype=i,a}}();function Zr(){}function Tt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}N.templateSettings={escape:Lf,evaluate:xf,interpolate:jo,variable:"",imports:{_:N}},N.prototype=Zr.prototype,N.prototype.constructor=N,Tt.prototype=Un(Zr.prototype),Tt.prototype.constructor=Tt;function we(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$,this.__views__=[]}function yh(){var e=new we(this.__wrapped__);return e.__actions__=dt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=dt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=dt(this.__views__),e}function bh(){if(this.__filtered__){var e=new we(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ch(){var e=this.__wrapped__.value(),t=this.__dir__,a=Ee(e),g=t<0,_=a?e.length:0,U=xA(0,_,this.__views__),z=U.start,J=U.end,q=J-z,ie=g?J:z-1,oe=this.__iteratees__,se=oe.length,le=0,pe=ot(q,this.__takeCount__);if(!a||!g&&_==q&&pe==q)return su(e,this.__actions__);var be=[];e:for(;q--&&le<pe;){ie+=t;for(var Te=-1,Ce=e[ie];++Te<se;){var Me=oe[Te],_e=Me.iteratee,Ct=Me.type,lt=_e(Ce);if(Ct==B)Ce=lt;else if(!lt){if(Ct==H)continue e;break e}}be[le++]=Ce}return be}we.prototype=Un(Zr.prototype),we.prototype.constructor=we;function vn(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var g=e[t];this.set(g[0],g[1])}}function Oh(){this.__data__=or?or(null):{},this.size=0}function Eh(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Sh(e){var t=this.__data__;if(or){var a=t[e];return a===E?i:a}return Fe.call(t,e)?t[e]:i}function Ih(e){var t=this.__data__;return or?t[e]!==i:Fe.call(t,e)}function Rh(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=or&&t===i?E:t,this}vn.prototype.clear=Oh,vn.prototype.delete=Eh,vn.prototype.get=Sh,vn.prototype.has=Ih,vn.prototype.set=Rh;function Vt(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var g=e[t];this.set(g[0],g[1])}}function Th(){this.__data__=[],this.size=0}function Ph(e){var t=this.__data__,a=Yr(t,e);if(a<0)return!1;var g=t.length-1;return a==g?t.pop():Vr.call(t,a,1),--this.size,!0}function Mh(e){var t=this.__data__,a=Yr(t,e);return a<0?i:t[a][1]}function wh(e){return Yr(this.__data__,e)>-1}function _h(e,t){var a=this.__data__,g=Yr(a,e);return g<0?(++this.size,a.push([e,t])):a[g][1]=t,this}Vt.prototype.clear=Th,Vt.prototype.delete=Ph,Vt.prototype.get=Mh,Vt.prototype.has=wh,Vt.prototype.set=_h;function zt(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var g=e[t];this.set(g[0],g[1])}}function Lh(){this.size=0,this.__data__={hash:new vn,map:new(ir||Vt),string:new vn}}function xh(e){var t=ui(this,e).delete(e);return this.size-=t?1:0,t}function Bh(e){return ui(this,e).get(e)}function Dh(e){return ui(this,e).has(e)}function Nh(e,t){var a=ui(this,e),g=a.size;return a.set(e,t),this.size+=a.size==g?0:1,this}zt.prototype.clear=Lh,zt.prototype.delete=xh,zt.prototype.get=Bh,zt.prototype.has=Dh,zt.prototype.set=Nh;function mn(e){var t=-1,a=e==null?0:e.length;for(this.__data__=new zt;++t<a;)this.add(e[t])}function Fh(e){return this.__data__.set(e,E),this}function Uh(e){return this.__data__.has(e)}mn.prototype.add=mn.prototype.push=Fh,mn.prototype.has=Uh;function Dt(e){var t=this.__data__=new Vt(e);this.size=t.size}function Gh(){this.__data__=new Vt,this.size=0}function Hh(e){var t=this.__data__,a=t.delete(e);return this.size=t.size,a}function Wh(e){return this.__data__.get(e)}function kh(e){return this.__data__.has(e)}function Vh(e,t){var a=this.__data__;if(a instanceof Vt){var g=a.__data__;if(!ir||g.length<n-1)return g.push([e,t]),this.size=++a.size,this;a=this.__data__=new zt(g)}return a.set(e,t),this.size=a.size,this}Dt.prototype.clear=Gh,Dt.prototype.delete=Hh,Dt.prototype.get=Wh,Dt.prototype.has=kh,Dt.prototype.set=Vh;function Us(e,t){var a=Ee(e),g=!a&&En(e),_=!a&&!g&&ln(e),U=!a&&!g&&!_&&kn(e),z=a||g||_||U,J=z?Aa(e.length,$d):[],q=J.length;for(var ie in e)(t||Fe.call(e,ie))&&!(z&&(ie=="length"||_&&(ie=="offset"||ie=="parent")||U&&(ie=="buffer"||ie=="byteLength"||ie=="byteOffset")||Kt(ie,q)))&&J.push(ie);return J}function Gs(e){var t=e.length;return t?e[_a(0,t-1)]:i}function zh(e,t){return ci(dt(e),yn(t,0,e.length))}function Qh(e){return ci(dt(e))}function Ca(e,t,a){(a!==i&&!Nt(e[t],a)||a===i&&!(t in e))&&Qt(e,t,a)}function ur(e,t,a){var g=e[t];(!(Fe.call(e,t)&&Nt(g,a))||a===i&&!(t in e))&&Qt(e,t,a)}function Yr(e,t){for(var a=e.length;a--;)if(Nt(e[a][0],t))return a;return-1}function jh(e,t,a,g){return on(e,function(_,U,z){t(g,_,a(_),z)}),g}function Hs(e,t){return e&&Gt(t,rt(t),e)}function Jh(e,t){return e&&Gt(t,At(t),e)}function Qt(e,t,a){t=="__proto__"&&zr?zr(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function Oa(e,t){for(var a=-1,g=t.length,_=te(g),U=e==null;++a<g;)_[a]=U?i:no(e,t[a]);return _}function yn(e,t,a){return e===e&&(a!==i&&(e=e<=a?e:a),t!==i&&(e=e>=t?e:t)),e}function Pt(e,t,a,g,_,U){var z,J=t&y,q=t&S,ie=t&I;if(a&&(z=_?a(e,g,_,U):a(e)),z!==i)return z;if(!Je(e))return e;var oe=Ee(e);if(oe){if(z=DA(e),!J)return dt(e,z)}else{var se=st(e),le=se==Se||se==xe;if(ln(e))return lu(e,J);if(se==Ue||se==F||le&&!_){if(z=q||le?{}:Mu(e),!J)return q?SA(e,Jh(z,e)):EA(e,Hs(z,e))}else{if(!He[se])return _?e:{};z=NA(e,se,J)}}U||(U=new Dt);var pe=U.get(e);if(pe)return pe;U.set(e,z),ic(e)?e.forEach(function(Ce){z.add(Pt(Ce,t,a,Ce,e,U))}):nc(e)&&e.forEach(function(Ce,Me){z.set(Me,Pt(Ce,t,a,Me,e,U))});var be=ie?q?ka:Wa:q?At:rt,Te=oe?i:be(e);return It(Te||e,function(Ce,Me){Te&&(Me=Ce,Ce=e[Me]),ur(z,Me,Pt(Ce,t,a,Me,e,U))}),z}function Kh(e){var t=rt(e);return function(a){return Ws(a,e,t)}}function Ws(e,t,a){var g=a.length;if(e==null)return!g;for(e=Ge(e);g--;){var _=a[g],U=t[_],z=e[_];if(z===i&&!(_ in e)||!U(z))return!1}return!0}function ks(e,t,a){if(typeof e!="function")throw new Rt(o);return pr(function(){e.apply(i,a)},t)}function cr(e,t,a,g){var _=-1,U=xr,z=!0,J=e.length,q=[],ie=t.length;if(!J)return q;a&&(t=je(t,mt(a))),g?(U=ua,z=!1):t.length>=n&&(U=nr,z=!1,t=new mn(t));e:for(;++_<J;){var oe=e[_],se=a==null?oe:a(oe);if(oe=g||oe!==0?oe:0,z&&se===se){for(var le=ie;le--;)if(t[le]===se)continue e;q.push(oe)}else U(t,se,g)||q.push(oe)}return q}var on=pu(Ut),Vs=pu(Sa,!0);function Zh(e,t){var a=!0;return on(e,function(g,_,U){return a=!!t(g,_,U),a}),a}function qr(e,t,a){for(var g=-1,_=e.length;++g<_;){var U=e[g],z=t(U);if(z!=null&&(J===i?z===z&&!bt(z):a(z,J)))var J=z,q=U}return q}function Yh(e,t,a,g){var _=e.length;for(a=Ie(a),a<0&&(a=-a>_?0:_+a),g=g===i||g>_?_:Ie(g),g<0&&(g+=_),g=a>g?0:oc(g);a<g;)e[a++]=t;return e}function zs(e,t){var a=[];return on(e,function(g,_,U){t(g,_,U)&&a.push(g)}),a}function at(e,t,a,g,_){var U=-1,z=e.length;for(a||(a=UA),_||(_=[]);++U<z;){var J=e[U];t>0&&a(J)?t>1?at(J,t-1,a,g,_):tn(_,J):g||(_[_.length]=J)}return _}var Ea=gu(),Qs=gu(!0);function Ut(e,t){return e&&Ea(e,t,rt)}function Sa(e,t){return e&&Qs(e,t,rt)}function Xr(e,t){return en(t,function(a){return Zt(e[a])})}function bn(e,t){t=un(t,e);for(var a=0,g=t.length;e!=null&&a<g;)e=e[Ht(t[a++])];return a&&a==g?e:i}function js(e,t,a){var g=t(e);return Ee(e)?g:tn(g,a(e))}function ut(e){return e==null?e===i?Re:tt:gn&&gn in Ge(e)?LA(e):QA(e)}function Ia(e,t){return e>t}function qh(e,t){return e!=null&&Fe.call(e,t)}function Xh(e,t){return e!=null&&t in Ge(e)}function $h(e,t,a){return e>=ot(t,a)&&e<et(t,a)}function Ra(e,t,a){for(var g=a?ua:xr,_=e[0].length,U=e.length,z=U,J=te(U),q=1/0,ie=[];z--;){var oe=e[z];z&&t&&(oe=je(oe,mt(t))),q=ot(oe.length,q),J[z]=!a&&(t||_>=120&&oe.length>=120)?new mn(z&&oe):i}oe=e[0];var se=-1,le=J[0];e:for(;++se<_&&ie.length<q;){var pe=oe[se],be=t?t(pe):pe;if(pe=a||pe!==0?pe:0,!(le?nr(le,be):g(ie,be,a))){for(z=U;--z;){var Te=J[z];if(!(Te?nr(Te,be):g(e[z],be,a)))continue e}le&&le.push(be),ie.push(pe)}}return ie}function eA(e,t,a,g){return Ut(e,function(_,U,z){t(g,a(_),U,z)}),g}function lr(e,t,a){t=un(t,e),e=xu(e,t);var g=e==null?e:e[Ht(wt(t))];return g==null?i:vt(g,e,a)}function Js(e){return Ke(e)&&ut(e)==F}function tA(e){return Ke(e)&&ut(e)==tr}function nA(e){return Ke(e)&&ut(e)==ce}function fr(e,t,a,g,_){return e===t?!0:e==null||t==null||!Ke(e)&&!Ke(t)?e!==e&&t!==t:rA(e,t,a,g,fr,_)}function rA(e,t,a,g,_,U){var z=Ee(e),J=Ee(t),q=z?j:st(e),ie=J?j:st(t);q=q==F?Ue:q,ie=ie==F?Ue:ie;var oe=q==Ue,se=ie==Ue,le=q==ie;if(le&&ln(e)){if(!ln(t))return!1;z=!0,oe=!1}if(le&&!oe)return U||(U=new Dt),z||kn(e)?Ru(e,t,a,g,_,U):wA(e,t,q,a,g,_,U);if(!(a&s)){var pe=oe&&Fe.call(e,"__wrapped__"),be=se&&Fe.call(t,"__wrapped__");if(pe||be){var Te=pe?e.value():e,Ce=be?t.value():t;return U||(U=new Dt),_(Te,Ce,a,g,U)}}return le?(U||(U=new Dt),_A(e,t,a,g,_,U)):!1}function iA(e){return Ke(e)&&st(e)==fe}function Ta(e,t,a,g){var _=a.length,U=_,z=!g;if(e==null)return!U;for(e=Ge(e);_--;){var J=a[_];if(z&&J[2]?J[1]!==e[J[0]]:!(J[0]in e))return!1}for(;++_<U;){J=a[_];var q=J[0],ie=e[q],oe=J[1];if(z&&J[2]){if(ie===i&&!(q in e))return!1}else{var se=new Dt;if(g)var le=g(ie,oe,q,e,t,se);if(!(le===i?fr(oe,ie,s|b,g,se):le))return!1}}return!0}function Ks(e){if(!Je(e)||HA(e))return!1;var t=Zt(e)?ih:Kf;return t.test(On(e))}function aA(e){return Ke(e)&&ut(e)==X}function oA(e){return Ke(e)&&st(e)==re}function sA(e){return Ke(e)&&pi(e.length)&&!!Ve[ut(e)]}function Zs(e){return typeof e=="function"?e:e==null?pt:typeof e=="object"?Ee(e)?Xs(e[0],e[1]):qs(e):vc(e)}function Pa(e){if(!Ar(e))return lh(e);var t=[];for(var a in Ge(e))Fe.call(e,a)&&a!="constructor"&&t.push(a);return t}function uA(e){if(!Je(e))return zA(e);var t=Ar(e),a=[];for(var g in e)g=="constructor"&&(t||!Fe.call(e,g))||a.push(g);return a}function Ma(e,t){return e<t}function Ys(e,t){var a=-1,g=ht(e)?te(e.length):[];return on(e,function(_,U,z){g[++a]=t(_,U,z)}),g}function qs(e){var t=za(e);return t.length==1&&t[0][2]?_u(t[0][0],t[0][1]):function(a){return a===e||Ta(a,e,t)}}function Xs(e,t){return ja(e)&&wu(t)?_u(Ht(e),t):function(a){var g=no(a,e);return g===i&&g===t?ro(a,e):fr(t,g,s|b)}}function $r(e,t,a,g,_){e!==t&&Ea(t,function(U,z){if(_||(_=new Dt),Je(U))cA(e,t,z,a,$r,g,_);else{var J=g?g(Ka(e,z),U,z+"",e,t,_):i;J===i&&(J=U),Ca(e,z,J)}},At)}function cA(e,t,a,g,_,U,z){var J=Ka(e,a),q=Ka(t,a),ie=z.get(q);if(ie){Ca(e,a,ie);return}var oe=U?U(J,q,a+"",e,t,z):i,se=oe===i;if(se){var le=Ee(q),pe=!le&&ln(q),be=!le&&!pe&&kn(q);oe=q,le||pe||be?Ee(J)?oe=J:Ye(J)?oe=dt(J):pe?(se=!1,oe=lu(q,!0)):be?(se=!1,oe=fu(q,!0)):oe=[]:gr(q)||En(q)?(oe=J,En(J)?oe=sc(J):(!Je(J)||Zt(J))&&(oe=Mu(q))):se=!1}se&&(z.set(q,oe),_(oe,q,g,U,z),z.delete(q)),Ca(e,a,oe)}function $s(e,t){var a=e.length;if(!!a)return t+=t<0?a:0,Kt(t,a)?e[t]:i}function eu(e,t,a){t.length?t=je(t,function(U){return Ee(U)?function(z){return bn(z,U.length===1?U[0]:U)}:U}):t=[pt];var g=-1;t=je(t,mt(ye()));var _=Ys(e,function(U,z,J){var q=je(t,function(ie){return ie(U)});return{criteria:q,index:++g,value:U}});return Nd(_,function(U,z){return OA(U,z,a)})}function lA(e,t){return tu(e,t,function(a,g){return ro(e,g)})}function tu(e,t,a){for(var g=-1,_=t.length,U={};++g<_;){var z=t[g],J=bn(e,z);a(J,z)&&dr(U,un(z,e),J)}return U}function fA(e){return function(t){return bn(t,e)}}function wa(e,t,a,g){var _=g?Dd:Ln,U=-1,z=t.length,J=e;for(e===t&&(t=dt(t)),a&&(J=je(e,mt(a)));++U<z;)for(var q=0,ie=t[U],oe=a?a(ie):ie;(q=_(J,oe,q,g))>-1;)J!==e&&Vr.call(J,q,1),Vr.call(e,q,1);return e}function nu(e,t){for(var a=e?t.length:0,g=a-1;a--;){var _=t[a];if(a==g||_!==U){var U=_;Kt(_)?Vr.call(e,_,1):Ba(e,_)}}return e}function _a(e,t){return e+jr(Ns()*(t-e+1))}function dA(e,t,a,g){for(var _=-1,U=et(Qr((t-e)/(a||1)),0),z=te(U);U--;)z[g?U:++_]=e,e+=a;return z}function La(e,t){var a="";if(!e||t<1||t>k)return a;do t%2&&(a+=e),t=jr(t/2),t&&(e+=e);while(t);return a}function Pe(e,t){return Za(Lu(e,t,pt),e+"")}function hA(e){return Gs(Vn(e))}function AA(e,t){var a=Vn(e);return ci(a,yn(t,0,a.length))}function dr(e,t,a,g){if(!Je(e))return e;t=un(t,e);for(var _=-1,U=t.length,z=U-1,J=e;J!=null&&++_<U;){var q=Ht(t[_]),ie=a;if(q==="__proto__"||q==="constructor"||q==="prototype")return e;if(_!=z){var oe=J[q];ie=g?g(oe,q,J):i,ie===i&&(ie=Je(oe)?oe:Kt(t[_+1])?[]:{})}ur(J,q,ie),J=J[q]}return e}var ru=Jr?function(e,t){return Jr.set(e,t),e}:pt,pA=zr?function(e,t){return zr(e,"toString",{configurable:!0,enumerable:!1,value:ao(t),writable:!0})}:pt;function gA(e){return ci(Vn(e))}function Mt(e,t,a){var g=-1,_=e.length;t<0&&(t=-t>_?0:_+t),a=a>_?_:a,a<0&&(a+=_),_=t>a?0:a-t>>>0,t>>>=0;for(var U=te(_);++g<_;)U[g]=e[g+t];return U}function vA(e,t){var a;return on(e,function(g,_,U){return a=t(g,_,U),!a}),!!a}function ei(e,t,a){var g=0,_=e==null?g:e.length;if(typeof t=="number"&&t===t&&_<=G){for(;g<_;){var U=g+_>>>1,z=e[U];z!==null&&!bt(z)&&(a?z<=t:z<t)?g=U+1:_=U}return _}return xa(e,t,pt,a)}function xa(e,t,a,g){var _=0,U=e==null?0:e.length;if(U===0)return 0;t=a(t);for(var z=t!==t,J=t===null,q=bt(t),ie=t===i;_<U;){var oe=jr((_+U)/2),se=a(e[oe]),le=se!==i,pe=se===null,be=se===se,Te=bt(se);if(z)var Ce=g||be;else ie?Ce=be&&(g||le):J?Ce=be&&le&&(g||!pe):q?Ce=be&&le&&!pe&&(g||!Te):pe||Te?Ce=!1:Ce=g?se<=t:se<t;Ce?_=oe+1:U=oe}return ot(U,Y)}function iu(e,t){for(var a=-1,g=e.length,_=0,U=[];++a<g;){var z=e[a],J=t?t(z):z;if(!a||!Nt(J,q)){var q=J;U[_++]=z===0?0:z}}return U}function au(e){return typeof e=="number"?e:bt(e)?K:+e}function yt(e){if(typeof e=="string")return e;if(Ee(e))return je(e,yt)+"";if(bt(e))return Fs?Fs.call(e):"";var t=e+"";return t=="0"&&1/e==-L?"-0":t}function sn(e,t,a){var g=-1,_=xr,U=e.length,z=!0,J=[],q=J;if(a)z=!1,_=ua;else if(U>=n){var ie=t?null:PA(e);if(ie)return Dr(ie);z=!1,_=nr,q=new mn}else q=t?[]:J;e:for(;++g<U;){var oe=e[g],se=t?t(oe):oe;if(oe=a||oe!==0?oe:0,z&&se===se){for(var le=q.length;le--;)if(q[le]===se)continue e;t&&q.push(se),J.push(oe)}else _(q,se,a)||(q!==J&&q.push(se),J.push(oe))}return J}function Ba(e,t){return t=un(t,e),e=xu(e,t),e==null||delete e[Ht(wt(t))]}function ou(e,t,a,g){return dr(e,t,a(bn(e,t)),g)}function ti(e,t,a,g){for(var _=e.length,U=g?_:-1;(g?U--:++U<_)&&t(e[U],U,e););return a?Mt(e,g?0:U,g?U+1:_):Mt(e,g?U+1:0,g?_:U)}function su(e,t){var a=e;return a instanceof we&&(a=a.value()),ca(t,function(g,_){return _.func.apply(_.thisArg,tn([g],_.args))},a)}function Da(e,t,a){var g=e.length;if(g<2)return g?sn(e[0]):[];for(var _=-1,U=te(g);++_<g;)for(var z=e[_],J=-1;++J<g;)J!=_&&(U[_]=cr(U[_]||z,e[J],t,a));return sn(at(U,1),t,a)}function uu(e,t,a){for(var g=-1,_=e.length,U=t.length,z={};++g<_;){var J=g<U?t[g]:i;a(z,e[g],J)}return z}function Na(e){return Ye(e)?e:[]}function Fa(e){return typeof e=="function"?e:pt}function un(e,t){return Ee(e)?e:ja(e,t)?[e]:Fu(De(e))}var mA=Pe;function cn(e,t,a){var g=e.length;return a=a===i?g:a,!t&&a>=g?e:Mt(e,t,a)}var cu=ah||function(e){return nt.clearTimeout(e)};function lu(e,t){if(t)return e.slice();var a=e.length,g=_s?_s(a):new e.constructor(a);return e.copy(g),g}function Ua(e){var t=new e.constructor(e.byteLength);return new Wr(t).set(new Wr(e)),t}function yA(e,t){var a=t?Ua(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function bA(e){var t=new e.constructor(e.source,Jo.exec(e));return t.lastIndex=e.lastIndex,t}function CA(e){return sr?Ge(sr.call(e)):{}}function fu(e,t){var a=t?Ua(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function du(e,t){if(e!==t){var a=e!==i,g=e===null,_=e===e,U=bt(e),z=t!==i,J=t===null,q=t===t,ie=bt(t);if(!J&&!ie&&!U&&e>t||U&&z&&q&&!J&&!ie||g&&z&&q||!a&&q||!_)return 1;if(!g&&!U&&!ie&&e<t||ie&&a&&_&&!g&&!U||J&&a&&_||!z&&_||!q)return-1}return 0}function OA(e,t,a){for(var g=-1,_=e.criteria,U=t.criteria,z=_.length,J=a.length;++g<z;){var q=du(_[g],U[g]);if(q){if(g>=J)return q;var ie=a[g];return q*(ie=="desc"?-1:1)}}return e.index-t.index}function hu(e,t,a,g){for(var _=-1,U=e.length,z=a.length,J=-1,q=t.length,ie=et(U-z,0),oe=te(q+ie),se=!g;++J<q;)oe[J]=t[J];for(;++_<z;)(se||_<U)&&(oe[a[_]]=e[_]);for(;ie--;)oe[J++]=e[_++];return oe}function Au(e,t,a,g){for(var _=-1,U=e.length,z=-1,J=a.length,q=-1,ie=t.length,oe=et(U-J,0),se=te(oe+ie),le=!g;++_<oe;)se[_]=e[_];for(var pe=_;++q<ie;)se[pe+q]=t[q];for(;++z<J;)(le||_<U)&&(se[pe+a[z]]=e[_++]);return se}function dt(e,t){var a=-1,g=e.length;for(t||(t=te(g));++a<g;)t[a]=e[a];return t}function Gt(e,t,a,g){var _=!a;a||(a={});for(var U=-1,z=t.length;++U<z;){var J=t[U],q=g?g(a[J],e[J],J,a,e):i;q===i&&(q=e[J]),_?Qt(a,J,q):ur(a,J,q)}return a}function EA(e,t){return Gt(e,Qa(e),t)}function SA(e,t){return Gt(e,Tu(e),t)}function ni(e,t){return function(a,g){var _=Ee(a)?Md:jh,U=t?t():{};return _(a,e,ye(g,2),U)}}function Gn(e){return Pe(function(t,a){var g=-1,_=a.length,U=_>1?a[_-1]:i,z=_>2?a[2]:i;for(U=e.length>3&&typeof U=="function"?(_--,U):i,z&&ct(a[0],a[1],z)&&(U=_<3?i:U,_=1),t=Ge(t);++g<_;){var J=a[g];J&&e(t,J,g,U)}return t})}function pu(e,t){return function(a,g){if(a==null)return a;if(!ht(a))return e(a,g);for(var _=a.length,U=t?_:-1,z=Ge(a);(t?U--:++U<_)&&g(z[U],U,z)!==!1;);return a}}function gu(e){return function(t,a,g){for(var _=-1,U=Ge(t),z=g(t),J=z.length;J--;){var q=z[e?J:++_];if(a(U[q],q,U)===!1)break}return t}}function IA(e,t,a){var g=t&T,_=hr(e);function U(){var z=this&&this!==nt&&this instanceof U?_:e;return z.apply(g?a:this,arguments)}return U}function vu(e){return function(t){t=De(t);var a=xn(t)?Bt(t):i,g=a?a[0]:t.charAt(0),_=a?cn(a,1).join(""):t.slice(1);return g[e]()+_}}function Hn(e){return function(t){return ca(pc(Ac(t).replace(pd,"")),e,"")}}function hr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var a=Un(e.prototype),g=e.apply(a,t);return Je(g)?g:a}}function RA(e,t,a){var g=hr(e);function _(){for(var U=arguments.length,z=te(U),J=U,q=Wn(_);J--;)z[J]=arguments[J];var ie=U<3&&z[0]!==q&&z[U-1]!==q?[]:nn(z,q);if(U-=ie.length,U<a)return Ou(e,t,ri,_.placeholder,i,z,ie,i,i,a-U);var oe=this&&this!==nt&&this instanceof _?g:e;return vt(oe,this,z)}return _}function mu(e){return function(t,a,g){var _=Ge(t);if(!ht(t)){var U=ye(a,3);t=rt(t),a=function(J){return U(_[J],J,_)}}var z=e(t,a,g);return z>-1?_[U?t[z]:z]:i}}function yu(e){return Jt(function(t){var a=t.length,g=a,_=Tt.prototype.thru;for(e&&t.reverse();g--;){var U=t[g];if(typeof U!="function")throw new Rt(o);if(_&&!z&&si(U)=="wrapper")var z=new Tt([],!0)}for(g=z?g:a;++g<a;){U=t[g];var J=si(U),q=J=="wrapper"?Va(U):i;q&&Ja(q[0])&&q[1]==(h|m|l|A)&&!q[4].length&&q[9]==1?z=z[si(q[0])].apply(z,q[3]):z=U.length==1&&Ja(U)?z[J]():z.thru(U)}return function(){var ie=arguments,oe=ie[0];if(z&&ie.length==1&&Ee(oe))return z.plant(oe).value();for(var se=0,le=a?t[se].apply(this,ie):oe;++se<a;)le=t[se].call(this,le);return le}})}function ri(e,t,a,g,_,U,z,J,q,ie){var oe=t&h,se=t&T,le=t&P,pe=t&(m|R),be=t&f,Te=le?i:hr(e);function Ce(){for(var Me=arguments.length,_e=te(Me),Ct=Me;Ct--;)_e[Ct]=arguments[Ct];if(pe)var lt=Wn(Ce),Ot=Ud(_e,lt);if(g&&(_e=hu(_e,g,_,pe)),U&&(_e=Au(_e,U,z,pe)),Me-=Ot,pe&&Me<ie){var qe=nn(_e,lt);return Ou(e,t,ri,Ce.placeholder,a,_e,qe,J,q,ie-Me)}var Ft=se?a:this,qt=le?Ft[e]:e;return Me=_e.length,J?_e=jA(_e,J):be&&Me>1&&_e.reverse(),oe&&q<Me&&(_e.length=q),this&&this!==nt&&this instanceof Ce&&(qt=Te||hr(qt)),qt.apply(Ft,_e)}return Ce}function bu(e,t){return function(a,g){return eA(a,e,t(g),{})}}function ii(e,t){return function(a,g){var _;if(a===i&&g===i)return t;if(a!==i&&(_=a),g!==i){if(_===i)return g;typeof a=="string"||typeof g=="string"?(a=yt(a),g=yt(g)):(a=au(a),g=au(g)),_=e(a,g)}return _}}function Ga(e){return Jt(function(t){return t=je(t,mt(ye())),Pe(function(a){var g=this;return e(t,function(_){return vt(_,g,a)})})})}function ai(e,t){t=t===i?" ":yt(t);var a=t.length;if(a<2)return a?La(t,e):t;var g=La(t,Qr(e/Bn(t)));return xn(t)?cn(Bt(g),0,e).join(""):g.slice(0,e)}function TA(e,t,a,g){var _=t&T,U=hr(e);function z(){for(var J=-1,q=arguments.length,ie=-1,oe=g.length,se=te(oe+q),le=this&&this!==nt&&this instanceof z?U:e;++ie<oe;)se[ie]=g[ie];for(;q--;)se[ie++]=arguments[++J];return vt(le,_?a:this,se)}return z}function Cu(e){return function(t,a,g){return g&&typeof g!="number"&&ct(t,a,g)&&(a=g=i),t=Yt(t),a===i?(a=t,t=0):a=Yt(a),g=g===i?t<a?1:-1:Yt(g),dA(t,a,g,e)}}function oi(e){return function(t,a){return typeof t=="string"&&typeof a=="string"||(t=_t(t),a=_t(a)),e(t,a)}}function Ou(e,t,a,g,_,U,z,J,q,ie){var oe=t&m,se=oe?z:i,le=oe?i:z,pe=oe?U:i,be=oe?i:U;t|=oe?l:p,t&=~(oe?p:l),t&C||(t&=~(T|P));var Te=[e,t,_,pe,se,be,le,J,q,ie],Ce=a.apply(i,Te);return Ja(e)&&Bu(Ce,Te),Ce.placeholder=g,Du(Ce,e,t)}function Ha(e){var t=$e[e];return function(a,g){if(a=_t(a),g=g==null?0:ot(Ie(g),292),g&&Ds(a)){var _=(De(a)+"e").split("e"),U=t(_[0]+"e"+(+_[1]+g));return _=(De(U)+"e").split("e"),+(_[0]+"e"+(+_[1]-g))}return t(a)}}var PA=Nn&&1/Dr(new Nn([,-0]))[1]==L?function(e){return new Nn(e)}:uo;function Eu(e){return function(t){var a=st(t);return a==fe?ga(t):a==re?Qd(t):Fd(t,e(t))}}function jt(e,t,a,g,_,U,z,J){var q=t&P;if(!q&&typeof e!="function")throw new Rt(o);var ie=g?g.length:0;if(ie||(t&=~(l|p),g=_=i),z=z===i?z:et(Ie(z),0),J=J===i?J:Ie(J),ie-=_?_.length:0,t&p){var oe=g,se=_;g=_=i}var le=q?i:Va(e),pe=[e,t,a,g,_,oe,se,U,z,J];if(le&&VA(pe,le),e=pe[0],t=pe[1],a=pe[2],g=pe[3],_=pe[4],J=pe[9]=pe[9]===i?q?0:e.length:et(pe[9]-ie,0),!J&&t&(m|R)&&(t&=~(m|R)),!t||t==T)var be=IA(e,t,a);else t==m||t==R?be=RA(e,t,J):(t==l||t==(T|l))&&!_.length?be=TA(e,t,a,g):be=ri.apply(i,pe);var Te=le?ru:Bu;return Du(Te(be,pe),e,t)}function Su(e,t,a,g){return e===i||Nt(e,Dn[a])&&!Fe.call(g,a)?t:e}function Iu(e,t,a,g,_,U){return Je(e)&&Je(t)&&(U.set(t,e),$r(e,t,i,Iu,U),U.delete(t)),e}function MA(e){return gr(e)?i:e}function Ru(e,t,a,g,_,U){var z=a&s,J=e.length,q=t.length;if(J!=q&&!(z&&q>J))return!1;var ie=U.get(e),oe=U.get(t);if(ie&&oe)return ie==t&&oe==e;var se=-1,le=!0,pe=a&b?new mn:i;for(U.set(e,t),U.set(t,e);++se<J;){var be=e[se],Te=t[se];if(g)var Ce=z?g(Te,be,se,t,e,U):g(be,Te,se,e,t,U);if(Ce!==i){if(Ce)continue;le=!1;break}if(pe){if(!la(t,function(Me,_e){if(!nr(pe,_e)&&(be===Me||_(be,Me,a,g,U)))return pe.push(_e)})){le=!1;break}}else if(!(be===Te||_(be,Te,a,g,U))){le=!1;break}}return U.delete(e),U.delete(t),le}function wA(e,t,a,g,_,U,z){switch(a){case wn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case tr:return!(e.byteLength!=t.byteLength||!U(new Wr(e),new Wr(t)));case ee:case ce:case Le:return Nt(+e,+t);case ge:return e.name==t.name&&e.message==t.message;case X:case ue:return e==t+"";case fe:var J=ga;case re:var q=g&s;if(J||(J=Dr),e.size!=t.size&&!q)return!1;var ie=z.get(e);if(ie)return ie==t;g|=b,z.set(e,t);var oe=Ru(J(e),J(t),g,_,U,z);return z.delete(e),oe;case he:if(sr)return sr.call(e)==sr.call(t)}return!1}function _A(e,t,a,g,_,U){var z=a&s,J=Wa(e),q=J.length,ie=Wa(t),oe=ie.length;if(q!=oe&&!z)return!1;for(var se=q;se--;){var le=J[se];if(!(z?le in t:Fe.call(t,le)))return!1}var pe=U.get(e),be=U.get(t);if(pe&&be)return pe==t&&be==e;var Te=!0;U.set(e,t),U.set(t,e);for(var Ce=z;++se<q;){le=J[se];var Me=e[le],_e=t[le];if(g)var Ct=z?g(_e,Me,le,t,e,U):g(Me,_e,le,e,t,U);if(!(Ct===i?Me===_e||_(Me,_e,a,g,U):Ct)){Te=!1;break}Ce||(Ce=le=="constructor")}if(Te&&!Ce){var lt=e.constructor,Ot=t.constructor;lt!=Ot&&"constructor"in e&&"constructor"in t&&!(typeof lt=="function"&&lt instanceof lt&&typeof Ot=="function"&&Ot instanceof Ot)&&(Te=!1)}return U.delete(e),U.delete(t),Te}function Jt(e){return Za(Lu(e,i,Wu),e+"")}function Wa(e){return js(e,rt,Qa)}function ka(e){return js(e,At,Tu)}var Va=Jr?function(e){return Jr.get(e)}:uo;function si(e){for(var t=e.name+"",a=Fn[t],g=Fe.call(Fn,t)?a.length:0;g--;){var _=a[g],U=_.func;if(U==null||U==e)return _.name}return t}function Wn(e){var t=Fe.call(N,"placeholder")?N:e;return t.placeholder}function ye(){var e=N.iteratee||oo;return e=e===oo?Zs:e,arguments.length?e(arguments[0],arguments[1]):e}function ui(e,t){var a=e.__data__;return GA(t)?a[typeof t=="string"?"string":"hash"]:a.map}function za(e){for(var t=rt(e),a=t.length;a--;){var g=t[a],_=e[g];t[a]=[g,_,wu(_)]}return t}function Cn(e,t){var a=kd(e,t);return Ks(a)?a:i}function LA(e){var t=Fe.call(e,gn),a=e[gn];try{e[gn]=i;var g=!0}catch(U){}var _=Gr.call(e);return g&&(t?e[gn]=a:delete e[gn]),_}var Qa=ma?function(e){return e==null?[]:(e=Ge(e),en(ma(e),function(t){return xs.call(e,t)}))}:co,Tu=ma?function(e){for(var t=[];e;)tn(t,Qa(e)),e=kr(e);return t}:co,st=ut;(ya&&st(new ya(new ArrayBuffer(1)))!=wn||ir&&st(new ir)!=fe||ba&&st(ba.resolve())!=Qe||Nn&&st(new Nn)!=re||ar&&st(new ar)!=Xe)&&(st=function(e){var t=ut(e),a=t==Ue?e.constructor:i,g=a?On(a):"";if(g)switch(g){case Ah:return wn;case ph:return fe;case gh:return Qe;case vh:return re;case mh:return Xe}return t});function xA(e,t,a){for(var g=-1,_=a.length;++g<_;){var U=a[g],z=U.size;switch(U.type){case"drop":e+=z;break;case"dropRight":t-=z;break;case"take":t=ot(t,e+z);break;case"takeRight":e=et(e,t-z);break}}return{start:e,end:t}}function BA(e){var t=e.match(Hf);return t?t[1].split(Wf):[]}function Pu(e,t,a){t=un(t,e);for(var g=-1,_=t.length,U=!1;++g<_;){var z=Ht(t[g]);if(!(U=e!=null&&a(e,z)))break;e=e[z]}return U||++g!=_?U:(_=e==null?0:e.length,!!_&&pi(_)&&Kt(z,_)&&(Ee(e)||En(e)))}function DA(e){var t=e.length,a=new e.constructor(t);return t&&typeof e[0]=="string"&&Fe.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function Mu(e){return typeof e.constructor=="function"&&!Ar(e)?Un(kr(e)):{}}function NA(e,t,a){var g=e.constructor;switch(t){case tr:return Ua(e);case ee:case ce:return new g(+e);case wn:return yA(e,a);case zi:case Qi:case ji:case Ji:case Ki:case Zi:case Yi:case qi:case Xi:return fu(e,a);case fe:return new g;case Le:case ue:return new g(e);case X:return bA(e);case re:return new g;case he:return CA(e)}}function FA(e,t){var a=t.length;if(!a)return e;var g=a-1;return t[g]=(a>1?"& ":"")+t[g],t=t.join(a>2?", ":" "),e.replace(Gf,`{
/* [wrapped with `+t+`] */
`)}function UA(e){return Ee(e)||En(e)||!!(Bs&&e&&e[Bs])}function Kt(e,t){var a=typeof e;return t=t==null?k:t,!!t&&(a=="number"||a!="symbol"&&Yf.test(e))&&e>-1&&e%1==0&&e<t}function ct(e,t,a){if(!Je(a))return!1;var g=typeof t;return(g=="number"?ht(a)&&Kt(t,a.length):g=="string"&&t in a)?Nt(a[t],e):!1}function ja(e,t){if(Ee(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||bt(e)?!0:Df.test(e)||!Bf.test(e)||t!=null&&e in Ge(t)}function GA(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ja(e){var t=si(e),a=N[t];if(typeof a!="function"||!(t in we.prototype))return!1;if(e===a)return!0;var g=Va(a);return!!g&&e===g[0]}function HA(e){return!!ws&&ws in e}var WA=Fr?Zt:lo;function Ar(e){var t=e&&e.constructor,a=typeof t=="function"&&t.prototype||Dn;return e===a}function wu(e){return e===e&&!Je(e)}function _u(e,t){return function(a){return a==null?!1:a[e]===t&&(t!==i||e in Ge(a))}}function kA(e){var t=hi(e,function(g){return a.size===c&&a.clear(),g}),a=t.cache;return t}function VA(e,t){var a=e[1],g=t[1],_=a|g,U=_<(T|P|h),z=g==h&&a==m||g==h&&a==A&&e[7].length<=t[8]||g==(h|A)&&t[7].length<=t[8]&&a==m;if(!(U||z))return e;g&T&&(e[2]=t[2],_|=a&T?0:C);var J=t[3];if(J){var q=e[3];e[3]=q?hu(q,J,t[4]):J,e[4]=q?nn(e[3],d):t[4]}return J=t[5],J&&(q=e[5],e[5]=q?Au(q,J,t[6]):J,e[6]=q?nn(e[5],d):t[6]),J=t[7],J&&(e[7]=J),g&h&&(e[8]=e[8]==null?t[8]:ot(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=_,e}function zA(e){var t=[];if(e!=null)for(var a in Ge(e))t.push(a);return t}function QA(e){return Gr.call(e)}function Lu(e,t,a){return t=et(t===i?e.length-1:t,0),function(){for(var g=arguments,_=-1,U=et(g.length-t,0),z=te(U);++_<U;)z[_]=g[t+_];_=-1;for(var J=te(t+1);++_<t;)J[_]=g[_];return J[t]=a(z),vt(e,this,J)}}function xu(e,t){return t.length<2?e:bn(e,Mt(t,0,-1))}function jA(e,t){for(var a=e.length,g=ot(t.length,a),_=dt(e);g--;){var U=t[g];e[g]=Kt(U,a)?_[U]:i}return e}function Ka(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Bu=Nu(ru),pr=sh||function(e,t){return nt.setTimeout(e,t)},Za=Nu(pA);function Du(e,t,a){var g=t+"";return Za(e,FA(g,JA(BA(g),a)))}function Nu(e){var t=0,a=0;return function(){var g=fh(),_=V-(g-a);if(a=g,_>0){if(++t>=x)return arguments[0]}else t=0;return e.apply(i,arguments)}}function ci(e,t){var a=-1,g=e.length,_=g-1;for(t=t===i?g:t;++a<t;){var U=_a(a,_),z=e[U];e[U]=e[a],e[a]=z}return e.length=t,e}var Fu=kA(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Nf,function(a,g,_,U){t.push(_?U.replace(zf,"$1"):g||a)}),t});function Ht(e){if(typeof e=="string"||bt(e))return e;var t=e+"";return t=="0"&&1/e==-L?"-0":t}function On(e){if(e!=null){try{return Ur.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function JA(e,t){return It(D,function(a){var g="_."+a[0];t&a[1]&&!xr(e,g)&&e.push(g)}),e.sort()}function Uu(e){if(e instanceof we)return e.clone();var t=new Tt(e.__wrapped__,e.__chain__);return t.__actions__=dt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function KA(e,t,a){(a?ct(e,t,a):t===i)?t=1:t=et(Ie(t),0);var g=e==null?0:e.length;if(!g||t<1)return[];for(var _=0,U=0,z=te(Qr(g/t));_<g;)z[U++]=Mt(e,_,_+=t);return z}function ZA(e){for(var t=-1,a=e==null?0:e.length,g=0,_=[];++t<a;){var U=e[t];U&&(_[g++]=U)}return _}function YA(){var e=arguments.length;if(!e)return[];for(var t=te(e-1),a=arguments[0],g=e;g--;)t[g-1]=arguments[g];return tn(Ee(a)?dt(a):[a],at(t,1))}var qA=Pe(function(e,t){return Ye(e)?cr(e,at(t,1,Ye,!0)):[]}),XA=Pe(function(e,t){var a=wt(t);return Ye(a)&&(a=i),Ye(e)?cr(e,at(t,1,Ye,!0),ye(a,2)):[]}),$A=Pe(function(e,t){var a=wt(t);return Ye(a)&&(a=i),Ye(e)?cr(e,at(t,1,Ye,!0),i,a):[]});function ep(e,t,a){var g=e==null?0:e.length;return g?(t=a||t===i?1:Ie(t),Mt(e,t<0?0:t,g)):[]}function tp(e,t,a){var g=e==null?0:e.length;return g?(t=a||t===i?1:Ie(t),t=g-t,Mt(e,0,t<0?0:t)):[]}function np(e,t){return e&&e.length?ti(e,ye(t,3),!0,!0):[]}function rp(e,t){return e&&e.length?ti(e,ye(t,3),!0):[]}function ip(e,t,a,g){var _=e==null?0:e.length;return _?(a&&typeof a!="number"&&ct(e,t,a)&&(a=0,g=_),Yh(e,t,a,g)):[]}function Gu(e,t,a){var g=e==null?0:e.length;if(!g)return-1;var _=a==null?0:Ie(a);return _<0&&(_=et(g+_,0)),Br(e,ye(t,3),_)}function Hu(e,t,a){var g=e==null?0:e.length;if(!g)return-1;var _=g-1;return a!==i&&(_=Ie(a),_=a<0?et(g+_,0):ot(_,g-1)),Br(e,ye(t,3),_,!0)}function Wu(e){var t=e==null?0:e.length;return t?at(e,1):[]}function ap(e){var t=e==null?0:e.length;return t?at(e,L):[]}function op(e,t){var a=e==null?0:e.length;return a?(t=t===i?1:Ie(t),at(e,t)):[]}function sp(e){for(var t=-1,a=e==null?0:e.length,g={};++t<a;){var _=e[t];g[_[0]]=_[1]}return g}function ku(e){return e&&e.length?e[0]:i}function up(e,t,a){var g=e==null?0:e.length;if(!g)return-1;var _=a==null?0:Ie(a);return _<0&&(_=et(g+_,0)),Ln(e,t,_)}function cp(e){var t=e==null?0:e.length;return t?Mt(e,0,-1):[]}var lp=Pe(function(e){var t=je(e,Na);return t.length&&t[0]===e[0]?Ra(t):[]}),fp=Pe(function(e){var t=wt(e),a=je(e,Na);return t===wt(a)?t=i:a.pop(),a.length&&a[0]===e[0]?Ra(a,ye(t,2)):[]}),dp=Pe(function(e){var t=wt(e),a=je(e,Na);return t=typeof t=="function"?t:i,t&&a.pop(),a.length&&a[0]===e[0]?Ra(a,i,t):[]});function hp(e,t){return e==null?"":ch.call(e,t)}function wt(e){var t=e==null?0:e.length;return t?e[t-1]:i}function Ap(e,t,a){var g=e==null?0:e.length;if(!g)return-1;var _=g;return a!==i&&(_=Ie(a),_=_<0?et(g+_,0):ot(_,g-1)),t===t?Jd(e,t,_):Br(e,Os,_,!0)}function pp(e,t){return e&&e.length?$s(e,Ie(t)):i}var gp=Pe(Vu);function Vu(e,t){return e&&e.length&&t&&t.length?wa(e,t):e}function vp(e,t,a){return e&&e.length&&t&&t.length?wa(e,t,ye(a,2)):e}function mp(e,t,a){return e&&e.length&&t&&t.length?wa(e,t,i,a):e}var yp=Jt(function(e,t){var a=e==null?0:e.length,g=Oa(e,t);return nu(e,je(t,function(_){return Kt(_,a)?+_:_}).sort(du)),g});function bp(e,t){var a=[];if(!(e&&e.length))return a;var g=-1,_=[],U=e.length;for(t=ye(t,3);++g<U;){var z=e[g];t(z,g,e)&&(a.push(z),_.push(g))}return nu(e,_),a}function Ya(e){return e==null?e:hh.call(e)}function Cp(e,t,a){var g=e==null?0:e.length;return g?(a&&typeof a!="number"&&ct(e,t,a)?(t=0,a=g):(t=t==null?0:Ie(t),a=a===i?g:Ie(a)),Mt(e,t,a)):[]}function Op(e,t){return ei(e,t)}function Ep(e,t,a){return xa(e,t,ye(a,2))}function Sp(e,t){var a=e==null?0:e.length;if(a){var g=ei(e,t);if(g<a&&Nt(e[g],t))return g}return-1}function Ip(e,t){return ei(e,t,!0)}function Rp(e,t,a){return xa(e,t,ye(a,2),!0)}function Tp(e,t){var a=e==null?0:e.length;if(a){var g=ei(e,t,!0)-1;if(Nt(e[g],t))return g}return-1}function Pp(e){return e&&e.length?iu(e):[]}function Mp(e,t){return e&&e.length?iu(e,ye(t,2)):[]}function wp(e){var t=e==null?0:e.length;return t?Mt(e,1,t):[]}function _p(e,t,a){return e&&e.length?(t=a||t===i?1:Ie(t),Mt(e,0,t<0?0:t)):[]}function Lp(e,t,a){var g=e==null?0:e.length;return g?(t=a||t===i?1:Ie(t),t=g-t,Mt(e,t<0?0:t,g)):[]}function xp(e,t){return e&&e.length?ti(e,ye(t,3),!1,!0):[]}function Bp(e,t){return e&&e.length?ti(e,ye(t,3)):[]}var Dp=Pe(function(e){return sn(at(e,1,Ye,!0))}),Np=Pe(function(e){var t=wt(e);return Ye(t)&&(t=i),sn(at(e,1,Ye,!0),ye(t,2))}),Fp=Pe(function(e){var t=wt(e);return t=typeof t=="function"?t:i,sn(at(e,1,Ye,!0),i,t)});function Up(e){return e&&e.length?sn(e):[]}function Gp(e,t){return e&&e.length?sn(e,ye(t,2)):[]}function Hp(e,t){return t=typeof t=="function"?t:i,e&&e.length?sn(e,i,t):[]}function qa(e){if(!(e&&e.length))return[];var t=0;return e=en(e,function(a){if(Ye(a))return t=et(a.length,t),!0}),Aa(t,function(a){return je(e,fa(a))})}function zu(e,t){if(!(e&&e.length))return[];var a=qa(e);return t==null?a:je(a,function(g){return vt(t,i,g)})}var Wp=Pe(function(e,t){return Ye(e)?cr(e,t):[]}),kp=Pe(function(e){return Da(en(e,Ye))}),Vp=Pe(function(e){var t=wt(e);return Ye(t)&&(t=i),Da(en(e,Ye),ye(t,2))}),zp=Pe(function(e){var t=wt(e);return t=typeof t=="function"?t:i,Da(en(e,Ye),i,t)}),Qp=Pe(qa);function jp(e,t){return uu(e||[],t||[],ur)}function Jp(e,t){return uu(e||[],t||[],dr)}var Kp=Pe(function(e){var t=e.length,a=t>1?e[t-1]:i;return a=typeof a=="function"?(e.pop(),a):i,zu(e,a)});function Qu(e){var t=N(e);return t.__chain__=!0,t}function Zp(e,t){return t(e),e}function li(e,t){return t(e)}var Yp=Jt(function(e){var t=e.length,a=t?e[0]:0,g=this.__wrapped__,_=function(U){return Oa(U,e)};return t>1||this.__actions__.length||!(g instanceof we)||!Kt(a)?this.thru(_):(g=g.slice(a,+a+(t?1:0)),g.__actions__.push({func:li,args:[_],thisArg:i}),new Tt(g,this.__chain__).thru(function(U){return t&&!U.length&&U.push(i),U}))});function qp(){return Qu(this)}function Xp(){return new Tt(this.value(),this.__chain__)}function $p(){this.__values__===i&&(this.__values__=ac(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function eg(){return this}function tg(e){for(var t,a=this;a instanceof Zr;){var g=Uu(a);g.__index__=0,g.__values__=i,t?_.__wrapped__=g:t=g;var _=g;a=a.__wrapped__}return _.__wrapped__=e,t}function ng(){var e=this.__wrapped__;if(e instanceof we){var t=e;return this.__actions__.length&&(t=new we(this)),t=t.reverse(),t.__actions__.push({func:li,args:[Ya],thisArg:i}),new Tt(t,this.__chain__)}return this.thru(Ya)}function rg(){return su(this.__wrapped__,this.__actions__)}var ig=ni(function(e,t,a){Fe.call(e,a)?++e[a]:Qt(e,a,1)});function ag(e,t,a){var g=Ee(e)?bs:Zh;return a&&ct(e,t,a)&&(t=i),g(e,ye(t,3))}function og(e,t){var a=Ee(e)?en:zs;return a(e,ye(t,3))}var sg=mu(Gu),ug=mu(Hu);function cg(e,t){return at(fi(e,t),1)}function lg(e,t){return at(fi(e,t),L)}function fg(e,t,a){return a=a===i?1:Ie(a),at(fi(e,t),a)}function ju(e,t){var a=Ee(e)?It:on;return a(e,ye(t,3))}function Ju(e,t){var a=Ee(e)?wd:Vs;return a(e,ye(t,3))}var dg=ni(function(e,t,a){Fe.call(e,a)?e[a].push(t):Qt(e,a,[t])});function hg(e,t,a,g){e=ht(e)?e:Vn(e),a=a&&!g?Ie(a):0;var _=e.length;return a<0&&(a=et(_+a,0)),gi(e)?a<=_&&e.indexOf(t,a)>-1:!!_&&Ln(e,t,a)>-1}var Ag=Pe(function(e,t,a){var g=-1,_=typeof t=="function",U=ht(e)?te(e.length):[];return on(e,function(z){U[++g]=_?vt(t,z,a):lr(z,t,a)}),U}),pg=ni(function(e,t,a){Qt(e,a,t)});function fi(e,t){var a=Ee(e)?je:Ys;return a(e,ye(t,3))}function gg(e,t,a,g){return e==null?[]:(Ee(t)||(t=t==null?[]:[t]),a=g?i:a,Ee(a)||(a=a==null?[]:[a]),eu(e,t,a))}var vg=ni(function(e,t,a){e[a?0:1].push(t)},function(){return[[],[]]});function mg(e,t,a){var g=Ee(e)?ca:Ss,_=arguments.length<3;return g(e,ye(t,4),a,_,on)}function yg(e,t,a){var g=Ee(e)?_d:Ss,_=arguments.length<3;return g(e,ye(t,4),a,_,Vs)}function bg(e,t){var a=Ee(e)?en:zs;return a(e,Ai(ye(t,3)))}function Cg(e){var t=Ee(e)?Gs:hA;return t(e)}function Og(e,t,a){(a?ct(e,t,a):t===i)?t=1:t=Ie(t);var g=Ee(e)?zh:AA;return g(e,t)}function Eg(e){var t=Ee(e)?Qh:gA;return t(e)}function Sg(e){if(e==null)return 0;if(ht(e))return gi(e)?Bn(e):e.length;var t=st(e);return t==fe||t==re?e.size:Pa(e).length}function Ig(e,t,a){var g=Ee(e)?la:vA;return a&&ct(e,t,a)&&(t=i),g(e,ye(t,3))}var Rg=Pe(function(e,t){if(e==null)return[];var a=t.length;return a>1&&ct(e,t[0],t[1])?t=[]:a>2&&ct(t[0],t[1],t[2])&&(t=[t[0]]),eu(e,at(t,1),[])}),di=oh||function(){return nt.Date.now()};function Tg(e,t){if(typeof t!="function")throw new Rt(o);return e=Ie(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ku(e,t,a){return t=a?i:t,t=e&&t==null?e.length:t,jt(e,h,i,i,i,i,t)}function Zu(e,t){var a;if(typeof t!="function")throw new Rt(o);return e=Ie(e),function(){return--e>0&&(a=t.apply(this,arguments)),e<=1&&(t=i),a}}var Xa=Pe(function(e,t,a){var g=T;if(a.length){var _=nn(a,Wn(Xa));g|=l}return jt(e,g,t,a,_)}),Yu=Pe(function(e,t,a){var g=T|P;if(a.length){var _=nn(a,Wn(Yu));g|=l}return jt(t,g,e,a,_)});function qu(e,t,a){t=a?i:t;var g=jt(e,m,i,i,i,i,i,t);return g.placeholder=qu.placeholder,g}function Xu(e,t,a){t=a?i:t;var g=jt(e,R,i,i,i,i,i,t);return g.placeholder=Xu.placeholder,g}function $u(e,t,a){var g,_,U,z,J,q,ie=0,oe=!1,se=!1,le=!0;if(typeof e!="function")throw new Rt(o);t=_t(t)||0,Je(a)&&(oe=!!a.leading,se="maxWait"in a,U=se?et(_t(a.maxWait)||0,t):U,le="trailing"in a?!!a.trailing:le);function pe(qe){var Ft=g,qt=_;return g=_=i,ie=qe,z=e.apply(qt,Ft),z}function be(qe){return ie=qe,J=pr(Me,t),oe?pe(qe):z}function Te(qe){var Ft=qe-q,qt=qe-ie,mc=t-Ft;return se?ot(mc,U-qt):mc}function Ce(qe){var Ft=qe-q,qt=qe-ie;return q===i||Ft>=t||Ft<0||se&&qt>=U}function Me(){var qe=di();if(Ce(qe))return _e(qe);J=pr(Me,Te(qe))}function _e(qe){return J=i,le&&g?pe(qe):(g=_=i,z)}function Ct(){J!==i&&cu(J),ie=0,g=q=_=J=i}function lt(){return J===i?z:_e(di())}function Ot(){var qe=di(),Ft=Ce(qe);if(g=arguments,_=this,q=qe,Ft){if(J===i)return be(q);if(se)return cu(J),J=pr(Me,t),pe(q)}return J===i&&(J=pr(Me,t)),z}return Ot.cancel=Ct,Ot.flush=lt,Ot}var Pg=Pe(function(e,t){return ks(e,1,t)}),Mg=Pe(function(e,t,a){return ks(e,_t(t)||0,a)});function wg(e){return jt(e,f)}function hi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Rt(o);var a=function(){var g=arguments,_=t?t.apply(this,g):g[0],U=a.cache;if(U.has(_))return U.get(_);var z=e.apply(this,g);return a.cache=U.set(_,z)||U,z};return a.cache=new(hi.Cache||zt),a}hi.Cache=zt;function Ai(e){if(typeof e!="function")throw new Rt(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function _g(e){return Zu(2,e)}var Lg=mA(function(e,t){t=t.length==1&&Ee(t[0])?je(t[0],mt(ye())):je(at(t,1),mt(ye()));var a=t.length;return Pe(function(g){for(var _=-1,U=ot(g.length,a);++_<U;)g[_]=t[_].call(this,g[_]);return vt(e,this,g)})}),$a=Pe(function(e,t){var a=nn(t,Wn($a));return jt(e,l,i,t,a)}),ec=Pe(function(e,t){var a=nn(t,Wn(ec));return jt(e,p,i,t,a)}),xg=Jt(function(e,t){return jt(e,A,i,i,i,t)});function Bg(e,t){if(typeof e!="function")throw new Rt(o);return t=t===i?t:Ie(t),Pe(e,t)}function Dg(e,t){if(typeof e!="function")throw new Rt(o);return t=t==null?0:et(Ie(t),0),Pe(function(a){var g=a[t],_=cn(a,0,t);return g&&tn(_,g),vt(e,this,_)})}function Ng(e,t,a){var g=!0,_=!0;if(typeof e!="function")throw new Rt(o);return Je(a)&&(g="leading"in a?!!a.leading:g,_="trailing"in a?!!a.trailing:_),$u(e,t,{leading:g,maxWait:t,trailing:_})}function Fg(e){return Ku(e,1)}function Ug(e,t){return $a(Fa(t),e)}function Gg(){if(!arguments.length)return[];var e=arguments[0];return Ee(e)?e:[e]}function Hg(e){return Pt(e,I)}function Wg(e,t){return t=typeof t=="function"?t:i,Pt(e,I,t)}function kg(e){return Pt(e,y|I)}function Vg(e,t){return t=typeof t=="function"?t:i,Pt(e,y|I,t)}function zg(e,t){return t==null||Ws(e,t,rt(t))}function Nt(e,t){return e===t||e!==e&&t!==t}var Qg=oi(Ia),jg=oi(function(e,t){return e>=t}),En=Js(function(){return arguments}())?Js:function(e){return Ke(e)&&Fe.call(e,"callee")&&!xs.call(e,"callee")},Ee=te.isArray,Jg=As?mt(As):tA;function ht(e){return e!=null&&pi(e.length)&&!Zt(e)}function Ye(e){return Ke(e)&&ht(e)}function Kg(e){return e===!0||e===!1||Ke(e)&&ut(e)==ee}var ln=uh||lo,Zg=ps?mt(ps):nA;function Yg(e){return Ke(e)&&e.nodeType===1&&!gr(e)}function qg(e){if(e==null)return!0;if(ht(e)&&(Ee(e)||typeof e=="string"||typeof e.splice=="function"||ln(e)||kn(e)||En(e)))return!e.length;var t=st(e);if(t==fe||t==re)return!e.size;if(Ar(e))return!Pa(e).length;for(var a in e)if(Fe.call(e,a))return!1;return!0}function Xg(e,t){return fr(e,t)}function $g(e,t,a){a=typeof a=="function"?a:i;var g=a?a(e,t):i;return g===i?fr(e,t,i,a):!!g}function eo(e){if(!Ke(e))return!1;var t=ut(e);return t==ge||t==me||typeof e.message=="string"&&typeof e.name=="string"&&!gr(e)}function ev(e){return typeof e=="number"&&Ds(e)}function Zt(e){if(!Je(e))return!1;var t=ut(e);return t==Se||t==xe||t==Q||t==ft}function tc(e){return typeof e=="number"&&e==Ie(e)}function pi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=k}function Je(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ke(e){return e!=null&&typeof e=="object"}var nc=gs?mt(gs):iA;function tv(e,t){return e===t||Ta(e,t,za(t))}function nv(e,t,a){return a=typeof a=="function"?a:i,Ta(e,t,za(t),a)}function rv(e){return rc(e)&&e!=+e}function iv(e){if(WA(e))throw new Oe(u);return Ks(e)}function av(e){return e===null}function ov(e){return e==null}function rc(e){return typeof e=="number"||Ke(e)&&ut(e)==Le}function gr(e){if(!Ke(e)||ut(e)!=Ue)return!1;var t=kr(e);if(t===null)return!0;var a=Fe.call(t,"constructor")&&t.constructor;return typeof a=="function"&&a instanceof a&&Ur.call(a)==nh}var to=vs?mt(vs):aA;function sv(e){return tc(e)&&e>=-k&&e<=k}var ic=ms?mt(ms):oA;function gi(e){return typeof e=="string"||!Ee(e)&&Ke(e)&&ut(e)==ue}function bt(e){return typeof e=="symbol"||Ke(e)&&ut(e)==he}var kn=ys?mt(ys):sA;function uv(e){return e===i}function cv(e){return Ke(e)&&st(e)==Xe}function lv(e){return Ke(e)&&ut(e)==An}var fv=oi(Ma),dv=oi(function(e,t){return e<=t});function ac(e){if(!e)return[];if(ht(e))return gi(e)?Bt(e):dt(e);if(rr&&e[rr])return zd(e[rr]());var t=st(e),a=t==fe?ga:t==re?Dr:Vn;return a(e)}function Yt(e){if(!e)return e===0?e:0;if(e=_t(e),e===L||e===-L){var t=e<0?-1:1;return t*W}return e===e?e:0}function Ie(e){var t=Yt(e),a=t%1;return t===t?a?t-a:t:0}function oc(e){return e?yn(Ie(e),0,$):0}function _t(e){if(typeof e=="number")return e;if(bt(e))return K;if(Je(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Je(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Is(e);var a=Jf.test(e);return a||Zf.test(e)?Td(e.slice(2),a?2:8):jf.test(e)?K:+e}function sc(e){return Gt(e,At(e))}function hv(e){return e?yn(Ie(e),-k,k):e===0?e:0}function De(e){return e==null?"":yt(e)}var Av=Gn(function(e,t){if(Ar(t)||ht(t)){Gt(t,rt(t),e);return}for(var a in t)Fe.call(t,a)&&ur(e,a,t[a])}),uc=Gn(function(e,t){Gt(t,At(t),e)}),vi=Gn(function(e,t,a,g){Gt(t,At(t),e,g)}),pv=Gn(function(e,t,a,g){Gt(t,rt(t),e,g)}),gv=Jt(Oa);function vv(e,t){var a=Un(e);return t==null?a:Hs(a,t)}var mv=Pe(function(e,t){e=Ge(e);var a=-1,g=t.length,_=g>2?t[2]:i;for(_&&ct(t[0],t[1],_)&&(g=1);++a<g;)for(var U=t[a],z=At(U),J=-1,q=z.length;++J<q;){var ie=z[J],oe=e[ie];(oe===i||Nt(oe,Dn[ie])&&!Fe.call(e,ie))&&(e[ie]=U[ie])}return e}),yv=Pe(function(e){return e.push(i,Iu),vt(cc,i,e)});function bv(e,t){return Cs(e,ye(t,3),Ut)}function Cv(e,t){return Cs(e,ye(t,3),Sa)}function Ov(e,t){return e==null?e:Ea(e,ye(t,3),At)}function Ev(e,t){return e==null?e:Qs(e,ye(t,3),At)}function Sv(e,t){return e&&Ut(e,ye(t,3))}function Iv(e,t){return e&&Sa(e,ye(t,3))}function Rv(e){return e==null?[]:Xr(e,rt(e))}function Tv(e){return e==null?[]:Xr(e,At(e))}function no(e,t,a){var g=e==null?i:bn(e,t);return g===i?a:g}function Pv(e,t){return e!=null&&Pu(e,t,qh)}function ro(e,t){return e!=null&&Pu(e,t,Xh)}var Mv=bu(function(e,t,a){t!=null&&typeof t.toString!="function"&&(t=Gr.call(t)),e[t]=a},ao(pt)),wv=bu(function(e,t,a){t!=null&&typeof t.toString!="function"&&(t=Gr.call(t)),Fe.call(e,t)?e[t].push(a):e[t]=[a]},ye),_v=Pe(lr);function rt(e){return ht(e)?Us(e):Pa(e)}function At(e){return ht(e)?Us(e,!0):uA(e)}function Lv(e,t){var a={};return t=ye(t,3),Ut(e,function(g,_,U){Qt(a,t(g,_,U),g)}),a}function xv(e,t){var a={};return t=ye(t,3),Ut(e,function(g,_,U){Qt(a,_,t(g,_,U))}),a}var Bv=Gn(function(e,t,a){$r(e,t,a)}),cc=Gn(function(e,t,a,g){$r(e,t,a,g)}),Dv=Jt(function(e,t){var a={};if(e==null)return a;var g=!1;t=je(t,function(U){return U=un(U,e),g||(g=U.length>1),U}),Gt(e,ka(e),a),g&&(a=Pt(a,y|S|I,MA));for(var _=t.length;_--;)Ba(a,t[_]);return a});function Nv(e,t){return lc(e,Ai(ye(t)))}var Fv=Jt(function(e,t){return e==null?{}:lA(e,t)});function lc(e,t){if(e==null)return{};var a=je(ka(e),function(g){return[g]});return t=ye(t),tu(e,a,function(g,_){return t(g,_[0])})}function Uv(e,t,a){t=un(t,e);var g=-1,_=t.length;for(_||(_=1,e=i);++g<_;){var U=e==null?i:e[Ht(t[g])];U===i&&(g=_,U=a),e=Zt(U)?U.call(e):U}return e}function Gv(e,t,a){return e==null?e:dr(e,t,a)}function Hv(e,t,a,g){return g=typeof g=="function"?g:i,e==null?e:dr(e,t,a,g)}var fc=Eu(rt),dc=Eu(At);function Wv(e,t,a){var g=Ee(e),_=g||ln(e)||kn(e);if(t=ye(t,4),a==null){var U=e&&e.constructor;_?a=g?new U:[]:Je(e)?a=Zt(U)?Un(kr(e)):{}:a={}}return(_?It:Ut)(e,function(z,J,q){return t(a,z,J,q)}),a}function kv(e,t){return e==null?!0:Ba(e,t)}function Vv(e,t,a){return e==null?e:ou(e,t,Fa(a))}function zv(e,t,a,g){return g=typeof g=="function"?g:i,e==null?e:ou(e,t,Fa(a),g)}function Vn(e){return e==null?[]:pa(e,rt(e))}function Qv(e){return e==null?[]:pa(e,At(e))}function jv(e,t,a){return a===i&&(a=t,t=i),a!==i&&(a=_t(a),a=a===a?a:0),t!==i&&(t=_t(t),t=t===t?t:0),yn(_t(e),t,a)}function Jv(e,t,a){return t=Yt(t),a===i?(a=t,t=0):a=Yt(a),e=_t(e),$h(e,t,a)}function Kv(e,t,a){if(a&&typeof a!="boolean"&&ct(e,t,a)&&(t=a=i),a===i&&(typeof t=="boolean"?(a=t,t=i):typeof e=="boolean"&&(a=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Yt(e),t===i?(t=e,e=0):t=Yt(t)),e>t){var g=e;e=t,t=g}if(a||e%1||t%1){var _=Ns();return ot(e+_*(t-e+Rd("1e-"+((_+"").length-1))),t)}return _a(e,t)}var Zv=Hn(function(e,t,a){return t=t.toLowerCase(),e+(a?hc(t):t)});function hc(e){return io(De(e).toLowerCase())}function Ac(e){return e=De(e),e&&e.replace(qf,Gd).replace(gd,"")}function Yv(e,t,a){e=De(e),t=yt(t);var g=e.length;a=a===i?g:yn(Ie(a),0,g);var _=a;return a-=t.length,a>=0&&e.slice(a,_)==t}function qv(e){return e=De(e),e&&_f.test(e)?e.replace(Qo,Hd):e}function Xv(e){return e=De(e),e&&Ff.test(e)?e.replace($i,"\\$&"):e}var $v=Hn(function(e,t,a){return e+(a?"-":"")+t.toLowerCase()}),em=Hn(function(e,t,a){return e+(a?" ":"")+t.toLowerCase()}),tm=vu("toLowerCase");function nm(e,t,a){e=De(e),t=Ie(t);var g=t?Bn(e):0;if(!t||g>=t)return e;var _=(t-g)/2;return ai(jr(_),a)+e+ai(Qr(_),a)}function rm(e,t,a){e=De(e),t=Ie(t);var g=t?Bn(e):0;return t&&g<t?e+ai(t-g,a):e}function im(e,t,a){e=De(e),t=Ie(t);var g=t?Bn(e):0;return t&&g<t?ai(t-g,a)+e:e}function am(e,t,a){return a||t==null?t=0:t&&(t=+t),dh(De(e).replace(ea,""),t||0)}function om(e,t,a){return(a?ct(e,t,a):t===i)?t=1:t=Ie(t),La(De(e),t)}function sm(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var um=Hn(function(e,t,a){return e+(a?"_":"")+t.toLowerCase()});function cm(e,t,a){return a&&typeof a!="number"&&ct(e,t,a)&&(t=a=i),a=a===i?$:a>>>0,a?(e=De(e),e&&(typeof t=="string"||t!=null&&!to(t))&&(t=yt(t),!t&&xn(e))?cn(Bt(e),0,a):e.split(t,a)):[]}var lm=Hn(function(e,t,a){return e+(a?" ":"")+io(t)});function fm(e,t,a){return e=De(e),a=a==null?0:yn(Ie(a),0,e.length),t=yt(t),e.slice(a,a+t.length)==t}function dm(e,t,a){var g=N.templateSettings;a&&ct(e,t,a)&&(t=i),e=De(e),t=vi({},t,g,Su);var _=vi({},t.imports,g.imports,Su),U=rt(_),z=pa(_,U),J,q,ie=0,oe=t.interpolate||wr,se="__p += '",le=va((t.escape||wr).source+"|"+oe.source+"|"+(oe===jo?Qf:wr).source+"|"+(t.evaluate||wr).source+"|$","g"),pe="//# sourceURL="+(Fe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Cd+"]")+`
`;e.replace(le,function(Ce,Me,_e,Ct,lt,Ot){return _e||(_e=Ct),se+=e.slice(ie,Ot).replace(Xf,Wd),Me&&(J=!0,se+=`' +
__e(`+Me+`) +
'`),lt&&(q=!0,se+=`';
`+lt+`;
__p += '`),_e&&(se+=`' +
((__t = (`+_e+`)) == null ? '' : __t) +
'`),ie=Ot+Ce.length,Ce}),se+=`';
`;var be=Fe.call(t,"variable")&&t.variable;if(!be)se=`with (obj) {
`+se+`
}
`;else if(Vf.test(be))throw new Oe(v);se=(q?se.replace(Tf,""):se).replace(Pf,"$1").replace(Mf,"$1;"),se="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+se+`return __p
}`;var Te=gc(function(){return Be(U,pe+"return "+se).apply(i,z)});if(Te.source=se,eo(Te))throw Te;return Te}function hm(e){return De(e).toLowerCase()}function Am(e){return De(e).toUpperCase()}function pm(e,t,a){if(e=De(e),e&&(a||t===i))return Is(e);if(!e||!(t=yt(t)))return e;var g=Bt(e),_=Bt(t),U=Rs(g,_),z=Ts(g,_)+1;return cn(g,U,z).join("")}function gm(e,t,a){if(e=De(e),e&&(a||t===i))return e.slice(0,Ms(e)+1);if(!e||!(t=yt(t)))return e;var g=Bt(e),_=Ts(g,Bt(t))+1;return cn(g,0,_).join("")}function vm(e,t,a){if(e=De(e),e&&(a||t===i))return e.replace(ea,"");if(!e||!(t=yt(t)))return e;var g=Bt(e),_=Rs(g,Bt(t));return cn(g,_).join("")}function mm(e,t){var a=O,g=w;if(Je(t)){var _="separator"in t?t.separator:_;a="length"in t?Ie(t.length):a,g="omission"in t?yt(t.omission):g}e=De(e);var U=e.length;if(xn(e)){var z=Bt(e);U=z.length}if(a>=U)return e;var J=a-Bn(g);if(J<1)return g;var q=z?cn(z,0,J).join(""):e.slice(0,J);if(_===i)return q+g;if(z&&(J+=q.length-J),to(_)){if(e.slice(J).search(_)){var ie,oe=q;for(_.global||(_=va(_.source,De(Jo.exec(_))+"g")),_.lastIndex=0;ie=_.exec(oe);)var se=ie.index;q=q.slice(0,se===i?J:se)}}else if(e.indexOf(yt(_),J)!=J){var le=q.lastIndexOf(_);le>-1&&(q=q.slice(0,le))}return q+g}function ym(e){return e=De(e),e&&wf.test(e)?e.replace(zo,Kd):e}var bm=Hn(function(e,t,a){return e+(a?" ":"")+t.toUpperCase()}),io=vu("toUpperCase");function pc(e,t,a){return e=De(e),t=a?i:t,t===i?Vd(e)?qd(e):Bd(e):e.match(t)||[]}var gc=Pe(function(e,t){try{return vt(e,i,t)}catch(a){return eo(a)?a:new Oe(a)}}),Cm=Jt(function(e,t){return It(t,function(a){a=Ht(a),Qt(e,a,Xa(e[a],e))}),e});function Om(e){var t=e==null?0:e.length,a=ye();return e=t?je(e,function(g){if(typeof g[1]!="function")throw new Rt(o);return[a(g[0]),g[1]]}):[],Pe(function(g){for(var _=-1;++_<t;){var U=e[_];if(vt(U[0],this,g))return vt(U[1],this,g)}})}function Em(e){return Kh(Pt(e,y))}function ao(e){return function(){return e}}function Sm(e,t){return e==null||e!==e?t:e}var Im=yu(),Rm=yu(!0);function pt(e){return e}function oo(e){return Zs(typeof e=="function"?e:Pt(e,y))}function Tm(e){return qs(Pt(e,y))}function Pm(e,t){return Xs(e,Pt(t,y))}var Mm=Pe(function(e,t){return function(a){return lr(a,e,t)}}),wm=Pe(function(e,t){return function(a){return lr(e,a,t)}});function so(e,t,a){var g=rt(t),_=Xr(t,g);a==null&&!(Je(t)&&(_.length||!g.length))&&(a=t,t=e,e=this,_=Xr(t,rt(t)));var U=!(Je(a)&&"chain"in a)||!!a.chain,z=Zt(e);return It(_,function(J){var q=t[J];e[J]=q,z&&(e.prototype[J]=function(){var ie=this.__chain__;if(U||ie){var oe=e(this.__wrapped__),se=oe.__actions__=dt(this.__actions__);return se.push({func:q,args:arguments,thisArg:e}),oe.__chain__=ie,oe}return q.apply(e,tn([this.value()],arguments))})}),e}function _m(){return nt._===this&&(nt._=rh),this}function uo(){}function Lm(e){return e=Ie(e),Pe(function(t){return $s(t,e)})}var xm=Ga(je),Bm=Ga(bs),Dm=Ga(la);function vc(e){return ja(e)?fa(Ht(e)):fA(e)}function Nm(e){return function(t){return e==null?i:bn(e,t)}}var Fm=Cu(),Um=Cu(!0);function co(){return[]}function lo(){return!1}function Gm(){return{}}function Hm(){return""}function Wm(){return!0}function km(e,t){if(e=Ie(e),e<1||e>k)return[];var a=$,g=ot(e,$);t=ye(t),e-=$;for(var _=Aa(g,t);++a<e;)t(a);return _}function Vm(e){return Ee(e)?je(e,Ht):bt(e)?[e]:dt(Fu(De(e)))}function zm(e){var t=++th;return De(e)+t}var Qm=ii(function(e,t){return e+t},0),jm=Ha("ceil"),Jm=ii(function(e,t){return e/t},1),Km=Ha("floor");function Zm(e){return e&&e.length?qr(e,pt,Ia):i}function Ym(e,t){return e&&e.length?qr(e,ye(t,2),Ia):i}function qm(e){return Es(e,pt)}function Xm(e,t){return Es(e,ye(t,2))}function $m(e){return e&&e.length?qr(e,pt,Ma):i}function e0(e,t){return e&&e.length?qr(e,ye(t,2),Ma):i}var t0=ii(function(e,t){return e*t},1),n0=Ha("round"),r0=ii(function(e,t){return e-t},0);function i0(e){return e&&e.length?ha(e,pt):0}function a0(e,t){return e&&e.length?ha(e,ye(t,2)):0}return N.after=Tg,N.ary=Ku,N.assign=Av,N.assignIn=uc,N.assignInWith=vi,N.assignWith=pv,N.at=gv,N.before=Zu,N.bind=Xa,N.bindAll=Cm,N.bindKey=Yu,N.castArray=Gg,N.chain=Qu,N.chunk=KA,N.compact=ZA,N.concat=YA,N.cond=Om,N.conforms=Em,N.constant=ao,N.countBy=ig,N.create=vv,N.curry=qu,N.curryRight=Xu,N.debounce=$u,N.defaults=mv,N.defaultsDeep=yv,N.defer=Pg,N.delay=Mg,N.difference=qA,N.differenceBy=XA,N.differenceWith=$A,N.drop=ep,N.dropRight=tp,N.dropRightWhile=np,N.dropWhile=rp,N.fill=ip,N.filter=og,N.flatMap=cg,N.flatMapDeep=lg,N.flatMapDepth=fg,N.flatten=Wu,N.flattenDeep=ap,N.flattenDepth=op,N.flip=wg,N.flow=Im,N.flowRight=Rm,N.fromPairs=sp,N.functions=Rv,N.functionsIn=Tv,N.groupBy=dg,N.initial=cp,N.intersection=lp,N.intersectionBy=fp,N.intersectionWith=dp,N.invert=Mv,N.invertBy=wv,N.invokeMap=Ag,N.iteratee=oo,N.keyBy=pg,N.keys=rt,N.keysIn=At,N.map=fi,N.mapKeys=Lv,N.mapValues=xv,N.matches=Tm,N.matchesProperty=Pm,N.memoize=hi,N.merge=Bv,N.mergeWith=cc,N.method=Mm,N.methodOf=wm,N.mixin=so,N.negate=Ai,N.nthArg=Lm,N.omit=Dv,N.omitBy=Nv,N.once=_g,N.orderBy=gg,N.over=xm,N.overArgs=Lg,N.overEvery=Bm,N.overSome=Dm,N.partial=$a,N.partialRight=ec,N.partition=vg,N.pick=Fv,N.pickBy=lc,N.property=vc,N.propertyOf=Nm,N.pull=gp,N.pullAll=Vu,N.pullAllBy=vp,N.pullAllWith=mp,N.pullAt=yp,N.range=Fm,N.rangeRight=Um,N.rearg=xg,N.reject=bg,N.remove=bp,N.rest=Bg,N.reverse=Ya,N.sampleSize=Og,N.set=Gv,N.setWith=Hv,N.shuffle=Eg,N.slice=Cp,N.sortBy=Rg,N.sortedUniq=Pp,N.sortedUniqBy=Mp,N.split=cm,N.spread=Dg,N.tail=wp,N.take=_p,N.takeRight=Lp,N.takeRightWhile=xp,N.takeWhile=Bp,N.tap=Zp,N.throttle=Ng,N.thru=li,N.toArray=ac,N.toPairs=fc,N.toPairsIn=dc,N.toPath=Vm,N.toPlainObject=sc,N.transform=Wv,N.unary=Fg,N.union=Dp,N.unionBy=Np,N.unionWith=Fp,N.uniq=Up,N.uniqBy=Gp,N.uniqWith=Hp,N.unset=kv,N.unzip=qa,N.unzipWith=zu,N.update=Vv,N.updateWith=zv,N.values=Vn,N.valuesIn=Qv,N.without=Wp,N.words=pc,N.wrap=Ug,N.xor=kp,N.xorBy=Vp,N.xorWith=zp,N.zip=Qp,N.zipObject=jp,N.zipObjectDeep=Jp,N.zipWith=Kp,N.entries=fc,N.entriesIn=dc,N.extend=uc,N.extendWith=vi,so(N,N),N.add=Qm,N.attempt=gc,N.camelCase=Zv,N.capitalize=hc,N.ceil=jm,N.clamp=jv,N.clone=Hg,N.cloneDeep=kg,N.cloneDeepWith=Vg,N.cloneWith=Wg,N.conformsTo=zg,N.deburr=Ac,N.defaultTo=Sm,N.divide=Jm,N.endsWith=Yv,N.eq=Nt,N.escape=qv,N.escapeRegExp=Xv,N.every=ag,N.find=sg,N.findIndex=Gu,N.findKey=bv,N.findLast=ug,N.findLastIndex=Hu,N.findLastKey=Cv,N.floor=Km,N.forEach=ju,N.forEachRight=Ju,N.forIn=Ov,N.forInRight=Ev,N.forOwn=Sv,N.forOwnRight=Iv,N.get=no,N.gt=Qg,N.gte=jg,N.has=Pv,N.hasIn=ro,N.head=ku,N.identity=pt,N.includes=hg,N.indexOf=up,N.inRange=Jv,N.invoke=_v,N.isArguments=En,N.isArray=Ee,N.isArrayBuffer=Jg,N.isArrayLike=ht,N.isArrayLikeObject=Ye,N.isBoolean=Kg,N.isBuffer=ln,N.isDate=Zg,N.isElement=Yg,N.isEmpty=qg,N.isEqual=Xg,N.isEqualWith=$g,N.isError=eo,N.isFinite=ev,N.isFunction=Zt,N.isInteger=tc,N.isLength=pi,N.isMap=nc,N.isMatch=tv,N.isMatchWith=nv,N.isNaN=rv,N.isNative=iv,N.isNil=ov,N.isNull=av,N.isNumber=rc,N.isObject=Je,N.isObjectLike=Ke,N.isPlainObject=gr,N.isRegExp=to,N.isSafeInteger=sv,N.isSet=ic,N.isString=gi,N.isSymbol=bt,N.isTypedArray=kn,N.isUndefined=uv,N.isWeakMap=cv,N.isWeakSet=lv,N.join=hp,N.kebabCase=$v,N.last=wt,N.lastIndexOf=Ap,N.lowerCase=em,N.lowerFirst=tm,N.lt=fv,N.lte=dv,N.max=Zm,N.maxBy=Ym,N.mean=qm,N.meanBy=Xm,N.min=$m,N.minBy=e0,N.stubArray=co,N.stubFalse=lo,N.stubObject=Gm,N.stubString=Hm,N.stubTrue=Wm,N.multiply=t0,N.nth=pp,N.noConflict=_m,N.noop=uo,N.now=di,N.pad=nm,N.padEnd=rm,N.padStart=im,N.parseInt=am,N.random=Kv,N.reduce=mg,N.reduceRight=yg,N.repeat=om,N.replace=sm,N.result=Uv,N.round=n0,N.runInContext=Z,N.sample=Cg,N.size=Sg,N.snakeCase=um,N.some=Ig,N.sortedIndex=Op,N.sortedIndexBy=Ep,N.sortedIndexOf=Sp,N.sortedLastIndex=Ip,N.sortedLastIndexBy=Rp,N.sortedLastIndexOf=Tp,N.startCase=lm,N.startsWith=fm,N.subtract=r0,N.sum=i0,N.sumBy=a0,N.template=dm,N.times=km,N.toFinite=Yt,N.toInteger=Ie,N.toLength=oc,N.toLower=hm,N.toNumber=_t,N.toSafeInteger=hv,N.toString=De,N.toUpper=Am,N.trim=pm,N.trimEnd=gm,N.trimStart=vm,N.truncate=mm,N.unescape=ym,N.uniqueId=zm,N.upperCase=bm,N.upperFirst=io,N.each=ju,N.eachRight=Ju,N.first=ku,so(N,function(){var e={};return Ut(N,function(t,a){Fe.call(N.prototype,a)||(e[a]=t)}),e}(),{chain:!1}),N.VERSION=r,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){N[e].placeholder=N}),It(["drop","take"],function(e,t){we.prototype[e]=function(a){a=a===i?1:et(Ie(a),0);var g=this.__filtered__&&!t?new we(this):this.clone();return g.__filtered__?g.__takeCount__=ot(a,g.__takeCount__):g.__views__.push({size:ot(a,$),type:e+(g.__dir__<0?"Right":"")}),g},we.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),It(["filter","map","takeWhile"],function(e,t){var a=t+1,g=a==H||a==M;we.prototype[e]=function(_){var U=this.clone();return U.__iteratees__.push({iteratee:ye(_,3),type:a}),U.__filtered__=U.__filtered__||g,U}}),It(["head","last"],function(e,t){var a="take"+(t?"Right":"");we.prototype[e]=function(){return this[a](1).value()[0]}}),It(["initial","tail"],function(e,t){var a="drop"+(t?"":"Right");we.prototype[e]=function(){return this.__filtered__?new we(this):this[a](1)}}),we.prototype.compact=function(){return this.filter(pt)},we.prototype.find=function(e){return this.filter(e).head()},we.prototype.findLast=function(e){return this.reverse().find(e)},we.prototype.invokeMap=Pe(function(e,t){return typeof e=="function"?new we(this):this.map(function(a){return lr(a,e,t)})}),we.prototype.reject=function(e){return this.filter(Ai(ye(e)))},we.prototype.slice=function(e,t){e=Ie(e);var a=this;return a.__filtered__&&(e>0||t<0)?new we(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),t!==i&&(t=Ie(t),a=t<0?a.dropRight(-t):a.take(t-e)),a)},we.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},we.prototype.toArray=function(){return this.take($)},Ut(we.prototype,function(e,t){var a=/^(?:filter|find|map|reject)|While$/.test(t),g=/^(?:head|last)$/.test(t),_=N[g?"take"+(t=="last"?"Right":""):t],U=g||/^find/.test(t);!_||(N.prototype[t]=function(){var z=this.__wrapped__,J=g?[1]:arguments,q=z instanceof we,ie=J[0],oe=q||Ee(z),se=function(Me){var _e=_.apply(N,tn([Me],J));return g&&le?_e[0]:_e};oe&&a&&typeof ie=="function"&&ie.length!=1&&(q=oe=!1);var le=this.__chain__,pe=!!this.__actions__.length,be=U&&!le,Te=q&&!pe;if(!U&&oe){z=Te?z:new we(this);var Ce=e.apply(z,J);return Ce.__actions__.push({func:li,args:[se],thisArg:i}),new Tt(Ce,le)}return be&&Te?e.apply(this,J):(Ce=this.thru(se),be?g?Ce.value()[0]:Ce.value():Ce)})}),It(["pop","push","shift","sort","splice","unshift"],function(e){var t=Nr[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",g=/^(?:pop|shift)$/.test(e);N.prototype[e]=function(){var _=arguments;if(g&&!this.__chain__){var U=this.value();return t.apply(Ee(U)?U:[],_)}return this[a](function(z){return t.apply(Ee(z)?z:[],_)})}}),Ut(we.prototype,function(e,t){var a=N[t];if(a){var g=a.name+"";Fe.call(Fn,g)||(Fn[g]=[]),Fn[g].push({name:t,func:a})}}),Fn[ri(i,P).name]=[{name:"wrapper",func:i}],we.prototype.clone=yh,we.prototype.reverse=bh,we.prototype.value=Ch,N.prototype.at=Yp,N.prototype.chain=qp,N.prototype.commit=Xp,N.prototype.next=$p,N.prototype.plant=tg,N.prototype.reverse=ng,N.prototype.toJSON=N.prototype.valueOf=N.prototype.value=rg,N.prototype.first=N.prototype.head,rr&&(N.prototype[rr]=eg),N},rn=Xd();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(nt._=rn,define(function(){return rn})):pn?((pn.exports=rn)._=rn,oa._=rn):nt._=rn}).call(Xn)});var wl=We((Wi,wo)=>{ae();(function(r,n){typeof Wi=="object"&&typeof wo=="object"?wo.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Wi=="object"?Wi.Ably=n():r.Ably=n()})(window,function(){return function(i){var r={};function n(u){if(r[u])return r[u].exports;var o=r[u]={i:u,l:!1,exports:{}};return i[u].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=i,n.c=r,n.d=function(u,o,v){n.o(u,o)||Object.defineProperty(u,o,{enumerable:!0,get:v})},n.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},n.t=function(u,o){if(o&1&&(u=n(u)),o&8||o&4&&typeof u=="object"&&u&&u.__esModule)return u;var v=Object.create(null);if(n.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:u}),o&2&&typeof u!="string")for(var E in u)n.d(v,E,function(c){return u[c]}.bind(null,E));return v},n.n=function(u){var o=u&&u.__esModule?function(){return u.default}:function(){return u};return n.d(o,"a",o),o},n.o=function(u,o){return Object.prototype.hasOwnProperty.call(u,o)},n.p="",n(n.s=41)}([function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(){}return o}();r.default=u},function(i,r,n){"use strict";n.r(r),n.d(r,"__extends",function(){return o}),n.d(r,"__assign",function(){return v}),n.d(r,"__rest",function(){return E}),n.d(r,"__decorate",function(){return c}),n.d(r,"__param",function(){return d}),n.d(r,"__metadata",function(){return y}),n.d(r,"__awaiter",function(){return S}),n.d(r,"__generator",function(){return I}),n.d(r,"__createBinding",function(){return s}),n.d(r,"__exportStar",function(){return b}),n.d(r,"__values",function(){return T}),n.d(r,"__read",function(){return P}),n.d(r,"__spread",function(){return C}),n.d(r,"__spreadArrays",function(){return m}),n.d(r,"__spreadArray",function(){return R}),n.d(r,"__await",function(){return l}),n.d(r,"__asyncGenerator",function(){return p}),n.d(r,"__asyncDelegator",function(){return h}),n.d(r,"__asyncValues",function(){return A}),n.d(r,"__makeTemplateObject",function(){return f}),n.d(r,"__importStar",function(){return w}),n.d(r,"__importDefault",function(){return x}),n.d(r,"__classPrivateFieldGet",function(){return V}),n.d(r,"__classPrivateFieldSet",function(){return H});var u=function(B,M){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,k){L.__proto__=k}||function(L,k){for(var W in k)Object.prototype.hasOwnProperty.call(k,W)&&(L[W]=k[W])},u(B,M)};function o(B,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");u(B,M);function L(){this.constructor=B}B.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}var v=function(){return v=Object.assign||function(M){for(var L,k=1,W=arguments.length;k<W;k++){L=arguments[k];for(var K in L)Object.prototype.hasOwnProperty.call(L,K)&&(M[K]=L[K])}return M},v.apply(this,arguments)};function E(B,M){var L={};for(var k in B)Object.prototype.hasOwnProperty.call(B,k)&&M.indexOf(k)<0&&(L[k]=B[k]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,k=Object.getOwnPropertySymbols(B);W<k.length;W++)M.indexOf(k[W])<0&&Object.prototype.propertyIsEnumerable.call(B,k[W])&&(L[k[W]]=B[k[W]]);return L}function c(B,M,L,k){var W=arguments.length,K=W<3?M:k===null?k=Object.getOwnPropertyDescriptor(M,L):k,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(B,M,L,k);else for(var Y=B.length-1;Y>=0;Y--)($=B[Y])&&(K=(W<3?$(K):W>3?$(M,L,K):$(M,L))||K);return W>3&&K&&Object.defineProperty(M,L,K),K}function d(B,M){return function(L,k){M(L,k,B)}}function y(B,M){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(B,M)}function S(B,M,L,k){function W(K){return K instanceof L?K:new L(function($){$(K)})}return new(L||(L=Promise))(function(K,$){function Y(F){try{D(k.next(F))}catch(j){$(j)}}function G(F){try{D(k.throw(F))}catch(j){$(j)}}function D(F){F.done?K(F.value):W(F.value).then(Y,G)}D((k=k.apply(B,M||[])).next())})}function I(B,M){var L={label:0,sent:function(){if(K[0]&1)throw K[1];return K[1]},trys:[],ops:[]},k,W,K,$;return $={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function Y(D){return function(F){return G([D,F])}}function G(D){if(k)throw new TypeError("Generator is already executing.");for(;L;)try{if(k=1,W&&(K=D[0]&2?W.return:D[0]?W.throw||((K=W.return)&&K.call(W),0):W.next)&&!(K=K.call(W,D[1])).done)return K;switch(W=0,K&&(D=[D[0]&2,K.value]),D[0]){case 0:case 1:K=D;break;case 4:return L.label++,{value:D[1],done:!1};case 5:L.label++,W=D[1],D=[0];continue;case 7:D=L.ops.pop(),L.trys.pop();continue;default:if(K=L.trys,!(K=K.length>0&&K[K.length-1])&&(D[0]===6||D[0]===2)){L=0;continue}if(D[0]===3&&(!K||D[1]>K[0]&&D[1]<K[3])){L.label=D[1];break}if(D[0]===6&&L.label<K[1]){L.label=K[1],K=D;break}if(K&&L.label<K[2]){L.label=K[2],L.ops.push(D);break}K[2]&&L.ops.pop(),L.trys.pop();continue}D=M.call(B,L)}catch(F){D=[6,F],W=0}finally{k=K=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var s=Object.create?function(B,M,L,k){k===void 0&&(k=L),Object.defineProperty(B,k,{enumerable:!0,get:function(){return M[L]}})}:function(B,M,L,k){k===void 0&&(k=L),B[k]=M[L]};function b(B,M){for(var L in B)L!=="default"&&!Object.prototype.hasOwnProperty.call(M,L)&&s(M,B,L)}function T(B){var M=typeof Symbol=="function"&&Symbol.iterator,L=M&&B[M],k=0;if(L)return L.call(B);if(B&&typeof B.length=="number")return{next:function(){return B&&k>=B.length&&(B=void 0),{value:B&&B[k++],done:!B}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(B,M){var L=typeof Symbol=="function"&&B[Symbol.iterator];if(!L)return B;var k=L.call(B),W,K=[],$;try{for(;(M===void 0||M-- >0)&&!(W=k.next()).done;)K.push(W.value)}catch(Y){$={error:Y}}finally{try{W&&!W.done&&(L=k.return)&&L.call(k)}finally{if($)throw $.error}}return K}function C(){for(var B=[],M=0;M<arguments.length;M++)B=B.concat(P(arguments[M]));return B}function m(){for(var B=0,M=0,L=arguments.length;M<L;M++)B+=arguments[M].length;for(var k=Array(B),W=0,M=0;M<L;M++)for(var K=arguments[M],$=0,Y=K.length;$<Y;$++,W++)k[W]=K[$];return k}function R(B,M,L){if(L||arguments.length===2)for(var k=0,W=M.length,K;k<W;k++)(K||!(k in M))&&(K||(K=Array.prototype.slice.call(M,0,k)),K[k]=M[k]);return B.concat(K||Array.prototype.slice.call(M))}function l(B){return this instanceof l?(this.v=B,this):new l(B)}function p(B,M,L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=L.apply(B,M||[]),W,K=[];return W={},$("next"),$("throw"),$("return"),W[Symbol.asyncIterator]=function(){return this},W;function $(Q){k[Q]&&(W[Q]=function(ee){return new Promise(function(ce,me){K.push([Q,ee,ce,me])>1||Y(Q,ee)})})}function Y(Q,ee){try{G(k[Q](ee))}catch(ce){j(K[0][3],ce)}}function G(Q){Q.value instanceof l?Promise.resolve(Q.value.v).then(D,F):j(K[0][2],Q)}function D(Q){Y("next",Q)}function F(Q){Y("throw",Q)}function j(Q,ee){Q(ee),K.shift(),K.length&&Y(K[0][0],K[0][1])}}function h(B){var M,L;return M={},k("next"),k("throw",function(W){throw W}),k("return"),M[Symbol.iterator]=function(){return this},M;function k(W,K){M[W]=B[W]?function($){return(L=!L)?{value:l(B[W]($)),done:W==="return"}:K?K($):$}:K}}function A(B){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var M=B[Symbol.asyncIterator],L;return M?M.call(B):(B=typeof T=="function"?T(B):B[Symbol.iterator](),L={},k("next"),k("throw"),k("return"),L[Symbol.asyncIterator]=function(){return this},L);function k(K){L[K]=B[K]&&function($){return new Promise(function(Y,G){$=B[K]($),W(Y,G,$.done,$.value)})}}function W(K,$,Y,G){Promise.resolve(G).then(function(D){K({value:D,done:Y})},$)}}function f(B,M){return Object.defineProperty?Object.defineProperty(B,"raw",{value:M}):B.raw=M,B}var O=Object.create?function(B,M){Object.defineProperty(B,"default",{enumerable:!0,value:M})}:function(B,M){B.default=M};function w(B){if(B&&B.__esModule)return B;var M={};if(B!=null)for(var L in B)L!=="default"&&Object.prototype.hasOwnProperty.call(B,L)&&s(M,B,L);return O(M,B),M}function x(B){return B&&B.__esModule?B:{default:B}}function V(B,M,L,k){if(L==="a"&&!k)throw new TypeError("Private accessor was defined without a getter");if(typeof M=="function"?B!==M||!k:!M.has(B))throw new TypeError("Cannot read private member from an object whose class did not declare it");return L==="m"?k:L==="a"?k.call(B):k?k.value:M.get(B)}function H(B,M,L,k,W){if(k==="m")throw new TypeError("Private method is not writable");if(k==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof M=="function"?B!==M||!W:!M.has(B))throw new TypeError("Cannot write private member to an object whose class did not declare it");return k==="a"?W.call(B,L):W?W.value=L:M.set(B,L),L}},function(i,r,n){"use strict";(function(u){r.__esModule=!0,r.allToUpperCase=r.allToLowerCase=r.encodeBody=r.decodeBody=r.Format=r.promisify=r.trim=r.arrChooseN=r.randomHexString=r.randomString=r.cheapRandStr=r.dataSizeBytes=r.inspectBody=r.inspectError=r.isErrorInfo=r.now=r.parseQueryString=r.toQueryString=r.arrPopRandomElement=r.defaultPostHeaders=r.defaultGetHeaders=r.allSame=r.arrEvery=r.arrFilter=r.arrMap=r.safeArrForEach=r.arrForEach=r.forInOwnNonNullProperties=r.valuesArray=r.keysArray=r.arrWithoutValue=r.arrDeleteValue=r.arrIn=r.arrIndexOf=r.arrSubtract=r.arrIntersectOb=r.arrIntersect=r.intersect=r.containsValue=r.inherits=r.prototypicalClone=r.shallowClone=r.isEmptyArg=r.isOnlyPropIn=r.isEmpty=r.isObject=r.ensureArray=r.isArray=r.copy=r.mixin=void 0,r.getGlobalObject=r.getJitterCoefficient=r.getBackoffCoefficient=void 0;var o=n(1),v=o.__importDefault(n(0)),E=o.__importDefault(n(8));function c(X){return Math.floor(Math.random()*X.length)}function d(X){for(var re=[],ue=1;ue<arguments.length;ue++)re[ue-1]=arguments[ue];for(var he=0;he<re.length;he++){var Re=re[he];if(!Re)break;var Xe=Object.prototype.hasOwnProperty;for(var An in Re)(!Xe||Xe.call(Re,An))&&(X[An]=Re[An])}return X}r.mixin=d;function y(X){return d({},X)}r.copy=y,r.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function S(X){return T(X)?[]:r.isArray(X)?X:[X]}r.ensureArray=S;function I(X){return Object.prototype.toString.call(X)=="[object Object]"}r.isObject=I;function s(X){for(var re in X)return!1;return!0}r.isEmpty=s;function b(X,re){for(var ue in X)if(ue!==re)return!1;return!0}r.isOnlyPropIn=b;function T(X){return X==null}r.isEmptyArg=T;function P(X){var re=new Object;for(var ue in X)re[ue]=X[ue];return re}r.shallowClone=P;function C(X,re){var ue=function(){function Re(){}return Re}();ue.prototype=X;var he=new ue;return re&&d(he,re),he}r.prototypicalClone=C;var m=function(X,re){if(v.default.Config.inherits){v.default.Config.inherits(X,re);return}X.super_=re,X.prototype=C(re.prototype,{constructor:X})};r.inherits=m;function R(X,re){for(var ue in X)if(X[ue]==re)return!0;return!1}r.containsValue=R;function l(X,re){return r.isArray(re)?p(X,re):h(X,re)}r.intersect=l;function p(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];r.arrIndexOf(re,Re)!=-1&&ue.push(Re)}return ue}r.arrIntersect=p;function h(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];Re in re&&ue.push(Re)}return ue}r.arrIntersectOb=h;function A(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];r.arrIndexOf(re,Re)==-1&&ue.push(Re)}return ue}r.arrSubtract=A,r.arrIndexOf=Array.prototype.indexOf?function(X,re,ue){return X.indexOf(re,ue)}:function(X,re,ue){ue=ue||0;for(var he=X.length;ue<he;ue++)if(X[ue]===re)return ue;return-1};function f(X,re){return r.arrIndexOf(X,re)!==-1}r.arrIn=f;function O(X,re){var ue=r.arrIndexOf(X,re),he=ue!=-1;return he&&X.splice(ue,1),he}r.arrDeleteValue=O;function w(X,re){var ue=X.slice();return O(ue,re),ue}r.arrWithoutValue=w;function x(X,re){var ue=[];for(var he in X)re&&!Object.prototype.hasOwnProperty.call(X,he)||ue.push(he);return ue}r.keysArray=x;function V(X,re){var ue=[];for(var he in X)re&&!Object.prototype.hasOwnProperty.call(X,he)||ue.push(X[he]);return ue}r.valuesArray=V;function H(X,re){for(var ue in X)Object.prototype.hasOwnProperty.call(X,ue)&&X[ue]&&re(ue)}r.forInOwnNonNullProperties=H,r.arrForEach=Array.prototype.forEach?function(X,re){X.forEach(re)}:function(X,re){for(var ue=X.length,he=0;he<ue;he++)re(X[he],he,X)};function B(X,re){return r.arrForEach(X.slice(),re)}r.safeArrForEach=B,r.arrMap=Array.prototype.map?function(X,re){return X.map(re)}:function(X,re){for(var ue=[],he=X.length,Re=0;Re<he;Re++)ue.push(re(X[Re],Re,X));return ue},r.arrFilter=Array.prototype.filter?function(X,re){return X.filter(re)}:function(X,re){for(var ue=[],he=X.length,Re=0;Re<he;Re++)re(X[Re])&&ue.push(X[Re]);return ue},r.arrEvery=Array.prototype.every?function(X,re){return X.every(re)}:function(X,re){for(var ue=X.length,he=0;he<ue;he++)if(!re(X[he],he,X))return!1;return!0};function M(X,re){if(X.length===0)return!0;var ue=X[0][re];return r.arrEvery(X,function(he){return he[re]===ue})}r.allSame=M;var L={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function k(X){var re=L[X||Se.json];return{accept:re,"X-Ably-Version":E.default.apiVersion,"Ably-Agent":E.default.agent}}r.defaultGetHeaders=k;function W(X){var re,ue=re=L[X||Se.json];return{accept:ue,"content-type":re,"X-Ably-Version":E.default.apiVersion,"Ably-Agent":E.default.agent}}r.defaultPostHeaders=W;function K(X){return X.splice(c(X),1)[0]}r.arrPopRandomElement=K;function $(X){var re=[];if(X)for(var ue in X)re.push(encodeURIComponent(ue)+"="+encodeURIComponent(X[ue]));return re.length?"?"+re.join("&"):""}r.toQueryString=$;function Y(X){for(var re,ue=/([^?&=]+)=?([^&]*)/g,he={};re=ue.exec(X);)he[decodeURIComponent(re[1])]=decodeURIComponent(re[2]);return he}r.parseQueryString=Y,r.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}r.isErrorInfo=G;function D(X){var re,ue;return X instanceof Error||((ue=(re=X)===null||re===void 0?void 0:re.constructor)===null||ue===void 0?void 0:ue.name)==="ErrorInfo"?v.default.Config.inspect(X):X.toString()}r.inspectError=D;function F(X){return v.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:v.default.Config.inspect(X)}r.inspectBody=F;function j(X){if(v.default.BufferUtils.isBuffer(X))return v.default.BufferUtils.byteLength(X);if(typeof X=="string")return v.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}r.dataSizeBytes=j;function Q(){return String(Math.random()).substr(2)}r.cheapRandStr=Q;var ee=function(X){if(v.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var re=new Uint8Array(X);return v.default.Config.getRandomValues(re),v.default.BufferUtils.base64Encode(re)}for(var ue=v.default.BufferUtils.base64CharSet,he=Math.round(X*4/3),Re="",Xe=0;Xe<he;Xe++)Re+=ue[c(ue)];return Re};r.randomString=ee;var ce=function(X){if(v.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var re=new Uint8Array(X);return v.default.Config.getRandomValues(re),v.default.BufferUtils.hexEncode(re)}for(var ue=v.default.BufferUtils.hexCharSet,he=X*2,Re="",Xe=0;Xe<he;Xe++)Re+=ue[c(ue)];return Re};r.randomHexString=ce;function me(X,re){for(var ue=Math.min(re,X.length),he=X.slice(),Re=[],Xe=0;Xe<ue;Xe++)Re.push(K(he));return Re}r.arrChooseN=me,r.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ge(X,re,ue){return new Promise(function(he,Re){X[re].apply(X,o.__spreadArray(o.__spreadArray([],ue),[function(Xe,An){Xe?Re(Xe):he(An)}]))})}r.promisify=ge;var Se;(function(X){X.msgpack="msgpack",X.json="json"})(Se=r.Format||(r.Format={}));function xe(X,re){return re=="msgpack"?v.default.Config.msgpack.decode(X):JSON.parse(String(X))}r.decodeBody=xe;function fe(X,re){return re=="msgpack"?v.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}r.encodeBody=fe;function Le(X){return X.map(function(re){return re&&re.toLowerCase()})}r.allToLowerCase=Le;function tt(X){return X.map(function(re){return re&&re.toUpperCase()})}r.allToUpperCase=tt;function Ue(X){return Math.min((X+2)/3,2)}r.getBackoffCoefficient=Ue;function Qe(){return 1-Math.random()*.2}r.getJitterCoefficient=Qe;function ft(){return u||(typeof window!="undefined"?window:self)}r.getGlobalObject=ft}).call(this,n(12))},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),v=o.__importDefault(n(0)),E=u||(typeof window!="undefined"?window:self),c;(function(s){s[s.None=0]="None",s[s.Error=1]="Error",s[s.Major=2]="Major",s[s.Minor=3]="Minor",s[s.Micro=4]="Micro"})(c||(c={}));function d(s,b){return(""+s).padStart(b?3:2,"0")}function y(s){return v.default.Config.logTimestamps?function(b){var T=new Date;s(d(T.getHours())+":"+d(T.getMinutes())+":"+d(T.getSeconds())+"."+d(T.getMilliseconds(),1)+" "+b)}:s}var S=function(){var s,b,T,P;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((b=(s=E==null?void 0:E.console)===null||s===void 0?void 0:s.log)===null||b===void 0?void 0:b.apply)=="function"?(T=function(){for(var C=[],m=0;m<arguments.length;m++)C[m]=arguments[m]},P=console.warn?function(){for(var C=[],m=0;m<arguments.length;m++)C[m]=arguments[m]}:T):E!=null&&E.console.log?T=P=function(){Function.prototype.apply.call(console.log,console,arguments)}:T=P=function(){},[T,P].map(y)},I=function(){function s(){s.logLevel=s.LOG_DEFAULT}return s.initLogHandlers=function(){var b=S(),T=b[0],P=b[1];this.logHandler=T,this.logErrorHandler=P},s.logLevel=c.Error,s.LOG_NONE=c.None,s.LOG_ERROR=c.Error,s.LOG_MAJOR=c.Major,s.LOG_MINOR=c.Minor,s.LOG_MICRO=c.Micro,s.LOG_DEFAULT=c.Error,s.LOG_DEBUG=c.Micro,s.logAction=function(b,T,P){s.shouldLog(b)&&(b===c.Error?s.logErrorHandler:s.logHandler)("Ably: "+T+": "+P)},s.deprecated=function(b,T){s.deprecatedWithMsg(b,"Please use '"+T+"' instead.")},s.deprecatedWithMsg=function(b,T){s.shouldLog(c.Error)&&s.logErrorHandler("Ably: Deprecation warning - '"+b+"' is deprecated and will be removed from a future version. "+T)},s.shouldLog=function(b){return b<=s.logLevel},s.setLog=function(b,T){b!==void 0&&(s.logLevel=b),T!==void 0&&(s.logHandler=s.logErrorHandler=T)},s}();r.default=I}).call(this,n(12))},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){if(typeof ArrayBuffer=="function"){var o=u,v=o.lib,E=v.WordArray,c=E.init,d=E.init=function(y){if(y instanceof ArrayBuffer&&(y=new Uint8Array(y)),(y instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&y instanceof Uint8ClampedArray||y instanceof Int16Array||y instanceof Uint16Array||y instanceof Int32Array||y instanceof Uint32Array||y instanceof Float32Array||y instanceof Float64Array)&&(y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),y instanceof Uint8Array){for(var S=y.byteLength,I=[],s=0;s<S;s++)I[s>>>2]|=y[s]<<24-s%4*8;c.call(this,I,S)}else c.apply(this,arguments)};d.prototype=E}}(),u.lib.WordArray})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),v=u.__importStar(n(2)),E=function(){function c(d,y,S,I){this.message=d,this.code=y,this.statusCode=S,this.cause=I}return c.prototype.toString=function(){var d="["+this.constructor.name;return this.message&&(d+=": "+this.message),this.statusCode&&(d+="; statusCode="+this.statusCode),this.code&&(d+="; code="+this.code),this.cause&&(d+="; cause="+v.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(d+="; see "+this.href+" "),d+="]",d},c.fromValues=function(d){var y=d,S=y.message,I=y.code,s=y.statusCode;if(typeof S!="string"||typeof I!="number"||typeof s!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(d));var b=Object.assign(new c(S,I,s),d);return b.code&&!b.href&&(b.href="https://help.ably.io/error/"+b.code),b},c}();r.default=E},function(i,r,n){(function(u){(function(o,v){i.exports=r=v()})(this,function(){var o=o||function(v,E){var c;if(typeof window!="undefined"&&window.crypto&&(c=window.crypto),!c&&typeof window!="undefined"&&window.msCrypto&&(c=window.msCrypto),!c&&typeof u!="undefined"&&u.crypto&&(c=u.crypto),!c)try{c=n(44)}catch(h){}var d=function(){if(c){if(typeof c.getRandomValues=="function")try{return c.getRandomValues(new Uint32Array(1))[0]}catch(h){}if(typeof c.randomBytes=="function")try{return c.randomBytes(4).readInt32LE()}catch(h){}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function h(){}return function(A){var f;return h.prototype=A,f=new h,h.prototype=null,f}}(),S={},I=S.lib={},s=I.Base=function(){return{extend:function(h){var A=y(this);return h&&A.mixIn(h),(!A.hasOwnProperty("init")||this.init===A.init)&&(A.init=function(){A.$super.init.apply(this,arguments)}),A.init.prototype=A,A.$super=this,A},create:function(){var h=this.extend();return h.init.apply(h,arguments),h},init:function(){},mixIn:function(h){for(var A in h)h.hasOwnProperty(A)&&(this[A]=h[A]);h.hasOwnProperty("toString")&&(this.toString=h.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),b=I.WordArray=s.extend({init:function(h,A){h=this.words=h||[],A!=E?this.sigBytes=A:this.sigBytes=h.length*4},toString:function(h){return(h||P).stringify(this)},concat:function(h){var A=this.words,f=h.words,O=this.sigBytes,w=h.sigBytes;if(this.clamp(),O%4)for(var x=0;x<w;x++){var V=f[x>>>2]>>>24-x%4*8&255;A[O+x>>>2]|=V<<24-(O+x)%4*8}else for(var x=0;x<w;x+=4)A[O+x>>>2]=f[x>>>2];return this.sigBytes+=w,this},clamp:function(){var h=this.words,A=this.sigBytes;h[A>>>2]&=4294967295<<32-A%4*8,h.length=v.ceil(A/4)},clone:function(){var h=s.clone.call(this);return h.words=this.words.slice(0),h},random:function(h){for(var A=[],f=0;f<h;f+=4)A.push(d());return new b.init(A,h)}}),T=S.enc={},P=T.Hex={stringify:function(h){for(var A=h.words,f=h.sigBytes,O=[],w=0;w<f;w++){var x=A[w>>>2]>>>24-w%4*8&255;O.push((x>>>4).toString(16)),O.push((x&15).toString(16))}return O.join("")},parse:function(h){for(var A=h.length,f=[],O=0;O<A;O+=2)f[O>>>3]|=parseInt(h.substr(O,2),16)<<24-O%8*4;return new b.init(f,A/2)}},C=T.Latin1={stringify:function(h){for(var A=h.words,f=h.sigBytes,O=[],w=0;w<f;w++){var x=A[w>>>2]>>>24-w%4*8&255;O.push(String.fromCharCode(x))}return O.join("")},parse:function(h){for(var A=h.length,f=[],O=0;O<A;O++)f[O>>>2]|=(h.charCodeAt(O)&255)<<24-O%4*8;return new b.init(f,A)}},m=T.Utf8={stringify:function(h){try{return decodeURIComponent(escape(C.stringify(h)))}catch(A){throw new Error("Malformed UTF-8 data")}},parse:function(h){return C.parse(unescape(encodeURIComponent(h)))}},R=I.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new b.init,this._nDataBytes=0},_append:function(h){typeof h=="string"&&(h=m.parse(h)),this._data.concat(h),this._nDataBytes+=h.sigBytes},_process:function(h){var A,f=this._data,O=f.words,w=f.sigBytes,x=this.blockSize,V=x*4,H=w/V;h?H=v.ceil(H):H=v.max((H|0)-this._minBufferSize,0);var B=H*x,M=v.min(B*4,w);if(B){for(var L=0;L<B;L+=x)this._doProcessBlock(O,L);A=O.splice(0,B),f.sigBytes-=M}return new b.init(A,M)},clone:function(){var h=s.clone.call(this);return h._data=this._data.clone(),h},_minBufferSize:0}),l=I.Hasher=R.extend({cfg:s.extend(),init:function(h){this.cfg=this.cfg.extend(h),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(h){return this._append(h),this._process(),this},finalize:function(h){h&&this._append(h);var A=this._doFinalize();return A},blockSize:512/32,_createHelper:function(h){return function(A,f){return new h.init(f).finalize(A)}},_createHmacHelper:function(h){return function(A,f){return new p.HMAC.init(h,f).finalize(A)}}}),p=S.algo={};return S}(Math);return o})}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(3)),E=u.__importDefault(n(0));function c(S,I,s){try{I.apply(S,s)}catch(b){v.default.logAction(v.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+b+"; stack = "+(b&&b.stack))}}function d(S,I,s){for(var b,T,P,C=0;C<S.length;C++)if(b=S[C],s&&(b=b[s]),o.isArray(b)){for(;(T=o.arrIndexOf(b,I))!==-1;)b.splice(T,1);s&&b.length===0&&delete S[C][s]}else if(o.isObject(b))for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&o.isArray(b[P])&&d([b],I,P)}var y=function(){function S(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return S.prototype.on=function(){for(var I=this,s=[],b=0;b<arguments.length;b++)s[b]=arguments[b];if(s.length===1){var T=s[0];if(typeof T=="function")this.any.push(T);else throw new Error("EventListener.on(): Invalid arguments: "+E.default.Config.inspect(s))}if(s.length===2){var P=s[0],C=s[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+E.default.Config.inspect(s));if(o.isEmptyArg(P))this.any.push(C);else if(o.isArray(P))P.forEach(function(R){I.on(R,C)});else{if(typeof P!="string")throw new Error("EventListener.on(): Invalid arguments: "+E.default.Config.inspect(s));var m=this.events[P]||(this.events[P]=[]);m.push(C)}}},S.prototype.off=function(){for(var I,s=this,b=[],T=0;T<arguments.length;T++)b[T]=arguments[T];if(b.length==0||o.isEmptyArg(b[0])&&o.isEmptyArg(b[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var P=b[0],C=b[1],m=null,R=null;if(b.length===1||!C)typeof P=="function"?m=P:R=P;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+E.default.Config.inspect(b));I=[P,C],R=I[0],m=I[1]}if(m&&o.isEmptyArg(R)){d([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(o.isArray(R)){R.forEach(function(l){s.off(l,m)});return}if(typeof R!="string")throw new Error("EventEmitter.off(): invalid arguments:"+E.default.Config.inspect(b));m?d([this.events,this.eventsOnce],m,R):(delete this.events[R],delete this.eventsOnce[R])},S.prototype.listeners=function(I){if(I){var s=this.events[I]||[];return this.eventsOnce[I]&&Array.prototype.push.apply(s,this.eventsOnce[I]),s.length?s:null}return this.any.length?this.any:null},S.prototype.emit=function(I){for(var s=[],b=1;b<arguments.length;b++)s[b-1]=arguments[b];var T={event:I},P=[];this.anyOnce.length&&(Array.prototype.push.apply(P,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(P,this.any);var C=this.eventsOnce[I];C&&(Array.prototype.push.apply(P,C),delete this.eventsOnce[I]);var m=this.events[I];m&&Array.prototype.push.apply(P,m),o.arrForEach(P,function(R){c(T,R,s)})},S.prototype.once=function(){for(var I=this,s=[],b=0;b<arguments.length;b++)s[b]=arguments[b];var T=s.length;if((T===0||T===1&&typeof s[0]!="function")&&E.default.Config.Promise){var P=s[0];if(typeof P!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+E.default.Config.inspect(s));return new E.default.Config.Promise(function(h){I.once(P,h)})}var C=s[0],m=s[1];if(s.length===1&&typeof C=="function")this.anyOnce.push(C);else if(o.isEmptyArg(C)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+E.default.Config.inspect(s));this.anyOnce.push(m)}else if(o.isArray(C)){var R=this,l=function(){var h=Array.prototype.slice.call(arguments);if(o.arrForEach(C,function(A){R.off(A,l)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+E.default.Config.inspect(s));m.apply(this,h)};o.arrForEach(C,function(h){R.on(h,l)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+E.default.Config.inspect(s));var p=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+E.default.Config.inspect(s));p.push(m)}}},S.prototype.whenState=function(I,s,b){for(var T=this,P=[],C=3;C<arguments.length;C++)P[C-3]=arguments[C];var m={event:I};if(typeof I!="string"||typeof s!="string")throw"whenState requires a valid event String argument";if(typeof b!="function"&&E.default.Config.Promise)return new E.default.Config.Promise(function(R){S.prototype.whenState.apply(T,[I,s,R].concat(P))});I===s?c(m,b,P):this.once(I,b)},S}();r.default=y},function(i,r,n){"use strict";r.__esModule=!0,r.getDefaults=r.normaliseOptions=r.objectifyOptions=r.getHosts=r.getFallbackHosts=r.environmentFallbackHosts=r.getHttpScheme=r.getPort=r.getHost=void 0;var u=n(1),o=u.__importDefault(n(0)),v=u.__importStar(n(2)),E=u.__importDefault(n(3)),c=u.__importDefault(n(5)),d=n(42),y="ably-js/"+d.version,S={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:d.version,apiVersion:"1.2",agent:y,getHost:I,getPort:s,getHttpScheme:b,environmentFallbackHosts:T,getFallbackHosts:P,getHosts:C,checkHost:m,objectifyOptions:p,normaliseOptions:h};function I(f,O,w){return w?O=O==f.restHost&&f.realtimeHost||O||f.realtimeHost:O=O||f.restHost,O}r.getHost=I;function s(f,O){return O||f.tls?f.tlsPort:f.port}r.getPort=s;function b(f){return f.tls?"https://":"http://"}r.getHttpScheme=b;function T(f){return[f+"-a-fallback.ably-realtime.com",f+"-b-fallback.ably-realtime.com",f+"-c-fallback.ably-realtime.com",f+"-d-fallback.ably-realtime.com",f+"-e-fallback.ably-realtime.com"]}r.environmentFallbackHosts=T;function P(f){var O=f.fallbackHosts,w=typeof f.httpMaxRetryCount!="undefined"?f.httpMaxRetryCount:S.httpMaxRetryCount;return O?v.arrChooseN(O,w):[]}r.getFallbackHosts=P;function C(f){return[f.restHost].concat(P(f))}r.getHosts=C;function m(f){if(typeof f!="string")throw new c.default("host must be a string; was a "+typeof f,4e4,400);if(!f.length)throw new c.default("host must not be zero-length",4e4,400)}function R(f,O,w){return f.realtimeHost?f.realtimeHost:f.restHost?(E.default.logAction(E.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+f.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+f.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),f.restHost):O?S.REALTIME_HOST:w+"-"+S.REALTIME_HOST}function l(f){var O={};for(var w in S.TIMEOUTS)O[w]=f[w]||S.TIMEOUTS[w];return O}function p(f){return typeof f=="string"?f.indexOf(":")==-1?{token:f}:{key:f}:f}r.objectifyOptions=p;function h(f){if(f.host&&(E.default.deprecated("host","restHost"),f.restHost=f.host),f.wsHost&&(E.default.deprecated("wsHost","realtimeHost"),f.realtimeHost=f.wsHost),f.queueEvents&&(E.default.deprecated("queueEvents","queueMessages"),f.queueMessages=f.queueEvents),f.fallbackHostsUseDefault){if(f.fallbackHosts){var O="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw E.default.logAction(E.default.LOG_ERROR,"Defaults.normaliseOptions",O),new c.default(O,4e4,400)}if(f.port||f.tlsPort){var O="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw E.default.logAction(E.default.LOG_ERROR,"Defaults.normaliseOptions",O),new c.default(O,4e4,400)}f.environment?E.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):E.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),f.fallbackHosts=S.FALLBACK_HOSTS}f.recover===!0&&(E.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),f.recover=function(k,W){W(!0)}),typeof f.recover=="function"&&f.closeOnUnload===!0&&(E.default.logAction(E.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),f.recover=void 0),"closeOnUnload"in f||(f.closeOnUnload=!f.recover),f.transports&&v.arrIn(f.transports,"xhr")&&(E.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),v.arrDeleteValue(f.transports,"xhr"),f.transports.push("xhr_streaming")),"queueMessages"in f||(f.queueMessages=!0);var w=f.environment&&String(f.environment).toLowerCase()||S.ENVIRONMENT,x=!w||w==="production";!f.fallbackHosts&&!f.restHost&&!f.realtimeHost&&!f.port&&!f.tlsPort&&(f.fallbackHosts=x?S.FALLBACK_HOSTS:T(w));var V=f.restHost||(x?S.REST_HOST:w+"-"+S.REST_HOST),H=R(f,x,w);v.arrForEach((f.fallbackHosts||[]).concat(V,H),m),f.port=f.port||S.PORT,f.tlsPort=f.tlsPort||S.TLS_PORT,"tls"in f||(f.tls=!0);var B=l(f);if("useBinaryProtocol"in f?f.useBinaryProtocol=o.default.Config.supportsBinary&&f.useBinaryProtocol:f.useBinaryProtocol=o.default.Config.preferBinary,f.clientId){var M=f.headers=f.headers||{};M["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(f.clientId))}if("idempotentRestPublishing"in f||(f.idempotentRestPublishing=!0),f.promises&&!o.default.Config.Promise&&(E.default.logAction(E.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),f.promises=!1),f.agents)for(var L in f.agents)S.agent+=" "+L+"/"+f.agents[L];return u.__assign(u.__assign({},f),{useBinaryProtocol:"useBinaryProtocol"in f?o.default.Config.supportsBinary&&f.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:H,restHost:V,maxMessageSize:f.maxMessageSize||S.maxMessageSize,timeouts:B})}r.normaliseOptions=h,r.default=S;function A(f){return Object.assign(S,f)}r.getDefaults=A},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),v=u.__importDefault(n(3)),E=u.__importDefault(n(5)),c=u.__importStar(n(2));function d(s){return!s||!s.channelOptions?{channelOptions:s,plugins:{},baseEncodedPreviousPayload:void 0}:s}function y(s){if(s&&s.cipher&&!s.cipher.channelCipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var b=o.default.Crypto.getCipher(s.cipher);return{cipher:b.cipherParams,channelCipher:b.cipher}}return s}function S(s){var b=0;return s.name&&(b+=s.name.length),s.clientId&&(b+=s.clientId.length),s.extras&&(b+=JSON.stringify(s.extras).length),s.data&&(b+=c.dataSizeBytes(s.data)),b}var I=function(){function s(){}return s.prototype.toJSON=function(){var b=this.encoding,T=this.data;return T&&o.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(b=b?b+"/base64":"base64",T=o.default.BufferUtils.base64Encode(T)):T=o.default.BufferUtils.toBuffer(T)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:b,data:T}},s.prototype.toString=function(){var b="[Message";return this.name&&(b+="; name="+this.name),this.id&&(b+="; id="+this.id),this.timestamp&&(b+="; timestamp="+this.timestamp),this.clientId&&(b+="; clientId="+this.clientId),this.connectionId&&(b+="; connectionId="+this.connectionId),this.encoding&&(b+="; encoding="+this.encoding),this.extras&&(b+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?b+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?b+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):b+="; data (json)="+JSON.stringify(this.data)),this.extras&&(b+="; extras="+JSON.stringify(this.extras)),b+="]",b},s.encrypt=function(b,T,P){var C=b.data,m=b.encoding,R=T.channelCipher;m=m?m+"/":"",o.default.BufferUtils.isBuffer(C)||(C=o.default.BufferUtils.utf8Encode(String(C)),m=m+"utf-8/"),R.encrypt(C,function(l,p){if(l){P(l);return}b.data=p,b.encoding=m+"cipher+"+R.algorithm,P(null,b)})},s.encode=function(b,T,P){var C=b.data,m=typeof C=="string"||o.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!m)if(c.isObject(C)||c.isArray(C))b.data=JSON.stringify(C),b.encoding=b.encoding?b.encoding+"/json":"json";else throw new E.default("Data type is unsupported",40013,400);T!=null&&T.cipher?s.encrypt(b,T,P):P(null,b)},s.encodeArray=function(b,T,P){for(var C=0,m=0;m<b.length;m++)s.encode(b[m],T,function(R){if(R){P(R);return}C++,C==b.length&&P(null,b)})},s.decode=function(b,T){var P=d(T),C=b.data,m=b.encoding;if(m){var R=m.split("/"),l=void 0,p=R.length,h=b.data,A="";try{for(;(l=p)>0;){var f=R[--p].match(/([-\w]+)(\+([\w-]+))?/);if(!f)break;switch(A=f[1],A){case"base64":h=o.default.BufferUtils.base64Decode(String(h)),l==R.length&&(C=h);continue;case"utf-8":h=o.default.BufferUtils.utf8Decode(h);continue;case"json":h=JSON.parse(h);continue;case"cipher":if(P.channelOptions!=null&&P.channelOptions.cipher&&P.channelOptions.channelCipher){var O=f[3],w=P.channelOptions.channelCipher;if(O!=w.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");h=w.decrypt(h);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!P.plugins||!P.plugins.vcdiff)throw new E.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new E.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var x=P.baseEncodedPreviousPayload;typeof x=="string"&&(x=o.default.BufferUtils.utf8Encode(x)),x=o.default.BufferUtils.toBuffer(x),h=o.default.BufferUtils.toBuffer(h),h=o.default.BufferUtils.typedArrayToBuffer(P.plugins.vcdiff.decode(h,x)),C=h}catch(H){throw new E.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var V=H;throw new E.default("Error processing the "+A+" encoding, decoder returned \u2018"+V.message+"\u2019",V.code||40013,400)}finally{b.encoding=l<=0?null:R.slice(0,l).join("/"),b.data=h}}P.baseEncodedPreviousPayload=C},s.fromResponseBody=function(b,T,P){P&&(b=c.decodeBody(b,P));for(var C=0;C<b.length;C++){var m=b[C]=s.fromValues(b[C]);try{s.decode(m,T)}catch(R){v.default.logAction(v.default.LOG_ERROR,"Message.fromResponseBody()",R.toString())}}return b},s.fromValues=function(b){return Object.assign(new s,b)},s.fromValuesArray=function(b){for(var T=b.length,P=new Array(T),C=0;C<T;C++)P[C]=s.fromValues(b[C]);return P},s.fromEncoded=function(b,T){var P=s.fromValues(b),C=y(T);try{s.decode(P,C)}catch(m){v.default.logAction(v.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return P},s.fromEncodedArray=function(b,T){return y(T),b.map(function(P){return s.fromEncoded(P,T)})},s.getMessagesSize=function(b){for(var T,P=0,C=0;C<b.length;C++)T=b[C],P+=T.size||(T.size=S(T));return P},s.serialize=c.encodeBody,s}();r.default=I},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(5)),E=u.__importDefault(n(9)),c=u.__importDefault(n(14)),d={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},y=[];Object.keys(d).forEach(function(P){y[d[P]]=P});var S={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},I=Object.keys(S);S.MODE_ALL=S.PRESENCE|S.PUBLISH|S.SUBSCRIBE|S.PRESENCE_SUBSCRIBE;function s(P){var C=[];if(P)for(var m=0;m<P.length;m++)C.push(P[m].toString());return"[ "+C.join(", ")+" ]"}var b="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),T=function(){function P(){var C=this;this.hasFlag=function(m){return(C.flags&S[m])>0}}return P.prototype.setFlag=function(C){return this.flags=this.flags|S[C]},P.prototype.getMode=function(){return this.flags&&this.flags&S.MODE_ALL},P.prototype.encodeModesToFlags=function(C){var m=this;C.forEach(function(R){return m.setFlag(R)})},P.prototype.decodeModesFromFlags=function(){var C=this,m=[];return P.channelModes.forEach(function(R){C.hasFlag(R)&&m.push(R)}),m.length>0?m:void 0},P.fromValues=function(C){return Object.assign(new P,C)},P.Action=d,P.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],P.ActionName=y,P.serialize=o.encodeBody,P.deserialize=function(C,m){var R=o.decodeBody(C,m);return P.fromDeserialized(R)},P.fromDeserialized=function(C){var m=C.error;m&&(C.error=v.default.fromValues(m));var R=C.messages;if(R)for(var l=0;l<R.length;l++)R[l]=E.default.fromValues(R[l]);var p=C.presence;if(p)for(var l=0;l<p.length;l++)p[l]=c.default.fromValues(p[l],!0);return Object.assign(new P,C)},P.stringify=function(C){var m="[ProtocolMessage";C.action!==void 0&&(m+="; action="+P.ActionName[C.action]||!1);for(var R,l=0;l<b.length;l++)R=b[l],C[R]!==void 0&&(m+="; "+R+"="+C[R]);if(C.messages&&(m+="; messages="+s(E.default.fromValuesArray(C.messages))),C.presence&&(m+="; presence="+s(c.default.fromValuesArray(C.presence))),C.error&&(m+="; error="+v.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(m+="; token="+C.auth.accessToken),C.flags&&(m+="; flags="+I.filter(C.hasFlag).join(",")),C.params){var p="";o.forInOwnNonNullProperties(C.params,function(h){p.length>0&&(p+="; "),p+=h+"="+C.params[h]}),p.length>0&&(m+="; params=["+p+"]")}return m+="]",m},P.isDuplicate=function(C,m){if(C&&m&&(C.action===d.MESSAGE||C.action===d.PRESENCE)&&C.action===m.action&&C.channel===m.channel&&C.id===m.id){if(C.action===d.PRESENCE)return!0;if(C.messages.length===m.messages.length){for(var R=0;R<C.messages.length;R++){var l=C.messages[R],p=m.messages[R];if((l.extras&&l.extras.delta&&l.extras.delta.format)!==(p.extras&&p.extras.delta&&p.extras.delta.format))return!1}return!0}}return!1},P}();r.default=T},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(10)),E=u.__importDefault(n(26)),c=u.__importDefault(n(3)),d=u.__importDefault(n(8)),y=u.__importDefault(n(19)),S=u.__importDefault(n(16)),I=u.__importDefault(n(5)),s=u.__importDefault(n(20)),b=u.__importDefault(n(0));function T(m){var R=[80015,80017,80030];return m.code?S.default.isTokenErr(m)?!1:o.arrIn(R,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function P(m){return T(m)?[v.default.fromValues({action:v.default.Action.ERROR,error:m})]:[v.default.fromValues({action:v.default.Action.DISCONNECTED,error:m})]}var C=function(m){u.__extends(R,m);function R(l,p,h){var A=m.call(this,l,p,h,!0)||this;return A.onAuthUpdated=function(f){A.authParams={access_token:f.token}},A.stream="stream"in h?h.stream:!0,A.sendRequest=null,A.recvRequest=null,A.pendingCallback=null,A.pendingItems=null,A}return R.prototype.connect=function(){var l=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","starting"),E.default.prototype.connect.call(this);var p=this.params,h=p.options,A=d.default.getHost(h,p.host),f=d.default.getPort(h),O=h.tls?"https://":"http://";this.baseUri=O+A+":"+f+"/comet/";var w=this.baseUri+"connect";c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","uri: "+w),this.auth.getAuthParams(function(x,V){if(x){l.disconnect(x);return}if(!l.isDisposed){l.authParams=V;var H=l.params.getConnectParams(V);"stream"in H&&(l.stream=H.stream),c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(H));var B=!1,M=l.recvRequest=l.createRequest(w,null,H,null,l.stream?s.default.REQ_RECV_STREAM:s.default.REQ_RECV);M.on("data",function(L){!l.recvRequest||(B||(B=!0,l.emit("preconnect")),l.onData(L))}),M.on("complete",function(L){if(l.recvRequest||(L=L||new I.default("Request cancelled",80003,400)),l.recvRequest=null,!B&&!L&&(B=!0,l.emit("preconnect")),l.onActivity(),L){L.code?l.onData(P(L)):l.disconnect(L);return}b.default.Config.nextTick(function(){l.recv()})}),M.exec()}})},R.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},R.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},R.prototype._requestCloseOrDisconnect=function(l){var p=this,h=l?this.closeUri:this.disconnectUri;if(h){var A=this.createRequest(h,null,this.authParams,null,s.default.REQ_SEND);A.on("complete",function(f){f&&(c.default.logAction(c.default.LOG_ERROR,"CometTransport.request"+(l?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(f)),p.finish("disconnected",f))}),A.exec()}},R.prototype.dispose=function(){var l=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",y.default.disconnected),b.default.Config.nextTick(function(){l.emit("disposed")}))},R.prototype.onConnect=function(l){if(!this.isDisposed){var p=l.connectionKey;E.default.prototype.onConnect.call(this,l);var h=this.baseUri+p;c.default.logAction(c.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+h+"; connectionKey = "+l.connectionKey),this.sendUri=h+"/send",this.recvUri=h+"/recv",this.closeUri=h+"/close",this.disconnectUri=h+"/disconnect"}},R.prototype.send=function(l){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(l);return}var p=this.pendingItems||[];p.push(l),this.pendingItems=null,this.sendItems(p)},R.prototype.sendAnyPending=function(){var l=this.pendingItems;!l||(this.pendingItems=null,this.sendItems(l))},R.prototype.sendItems=function(l){var p=this,h=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(l),s.default.REQ_SEND);h.on("complete",function(A,f){if(A&&c.default.logAction(c.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(A)),p.sendRequest=null,A){A.code?p.onData(P(A)):p.disconnect(A);return}f&&p.onData(f),p.pendingItems&&b.default.Config.nextTick(function(){p.sendRequest||p.sendAnyPending()})}),h.exec()},R.prototype.recv=function(){var l=this;if(!this.recvRequest&&!!this.isConnected){var p=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?s.default.REQ_RECV_STREAM:s.default.REQ_RECV_POLL);p.on("data",function(h){l.onData(h)}),p.on("complete",function(h){if(l.recvRequest=null,l.onActivity(),h){h.code?l.onData(P(h)):l.disconnect(h);return}b.default.Config.nextTick(function(){l.recv()})}),p.exec()}},R.prototype.onData=function(l){try{var p=this.decodeResponse(l);if(p&&p.length)for(var h=0;h<p.length;h++)this.onProtocolMessage(v.default.fromDeserialized(p[h]))}catch(A){c.default.logAction(c.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+A.stack)}},R.prototype.encodeRequest=function(l){return JSON.stringify(l)},R.prototype.decodeResponse=function(l){return typeof l=="string"?JSON.parse(l):l},R}(E.default);r.default=C},function(i,r){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(u){typeof window=="object"&&(n=window)}i.exports=n},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,v=o.lib,E=v.WordArray,c=o.enc,d=c.Base64={stringify:function(S){var I=S.words,s=S.sigBytes,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.clamp();for(var T=[],P=0;P<s;P+=3)for(var C=I[P>>>2]>>>24-P%4*8&255,m=I[P+1>>>2]>>>24-(P+1)%4*8&255,R=I[P+2>>>2]>>>24-(P+2)%4*8&255,l=C<<16|m<<8|R,p=0;p<4&&P+p*.75<s;p++)T.push(b.charAt(l>>>6*(3-p)&63));var h=b.charAt(64);if(h)for(;T.length%4;)T.push(h);return T.join("")},parse:function(S){var I=S.length,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var T=0;T<s.length;T++)b[s.charCodeAt(T)]=T}var P=s.charAt(64);if(P){var C=S.indexOf(P);C!==-1&&(I=C)}return y(S,I,b)}};function y(S,I,s){for(var b=[],T=0,P=0;P<I;P++)if(P%4){var C=s[S.charCodeAt(P-1)]<<P%4*2,m=s[S.charCodeAt(P)]>>>6-P%4*2,R=C|m;b[T>>>2]|=R<<24-T%4*8,T++}return E.create(b,T)}}(),u.enc.Base64})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),v=u.__importDefault(n(0)),E=u.__importDefault(n(9)),c=u.__importStar(n(2));function d(S){return y.Actions.indexOf(S)}var y=function(){function S(){}return S.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},S.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var I=this.id.split(":");return{connectionId:I[0],msgSerial:parseInt(I[1],10),index:parseInt(I[2],10)}},S.prototype.toJSON=function(){var I=this.data,s=this.encoding;return I&&v.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(s=s?s+"/base64":"base64",I=v.default.BufferUtils.base64Encode(I)):I=v.default.BufferUtils.toBuffer(I)),{clientId:this.clientId,action:d(this.action),data:I,encoding:s}},S.prototype.toString=function(){var I="[PresenceMessage";return I+="; action="+this.action,this.id&&(I+="; id="+this.id),this.timestamp&&(I+="; timestamp="+this.timestamp),this.clientId&&(I+="; clientId="+this.clientId),this.connectionId&&(I+="; connectionId="+this.connectionId),this.encoding&&(I+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?I+="; data="+this.data:v.default.BufferUtils.isBuffer(this.data)?I+="; data (buffer)="+v.default.BufferUtils.base64Encode(this.data):I+="; data (json)="+JSON.stringify(this.data)),I+="]",I},S.fromResponseBody=function(I,s,b){var T=[];b&&(I=c.decodeBody(I,b));for(var P=0;P<I.length;P++){var C=T[P]=S.fromValues(I[P],!0);try{S.decode(C,s)}catch(m){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return T},S.fromValues=function(I,s){return s&&(I.action=S.Actions[I.action]),Object.assign(new S,I)},S.fromValuesArray=function(I){for(var s=I.length,b=new Array(s),T=0;T<s;T++)b[T]=S.fromValues(I[T]);return b},S.fromEncoded=function(I,s){var b=S.fromValues(I,!0);try{S.decode(b,s)}catch(T){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",T.toString())}return b},S.fromEncodedArray=function(I,s){return I.map(function(b){return S.fromEncoded(b,s)})},S.Actions=["absent","present","enter","leave","update"],S.encode=E.default.encode,S.decode=E.default.decode,S.getMessagesSize=E.default.getMessagesSize,S}();r.default=y},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),v=o.__importStar(n(2)),E=o.__importDefault(n(7)),c=o.__importDefault(n(5)),d=o.__importDefault(n(3)),y=o.__importDefault(n(8)),S=o.__importDefault(n(20)),I=o.__importDefault(n(0));function s(O,w){return v.arrIn(v.allToLowerCase(v.keysArray(w)),"x-ably-errorcode")}function b(O,w){if(s(O,w))return O.error&&c.default.fromValues(O.error)}var T=function(){},P=0,C={},m=typeof u!="undefined"&&u.XDomainRequest;function R(){var O=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return O&&Number(O[1])}function l(){var O;return m&&(O=R())&&O===10}function p(O,w){return O.getResponseHeader&&O.getResponseHeader(w)}function h(O){return O.getResponseHeader&&(O.getResponseHeader("transfer-encoding")||!O.getResponseHeader("content-length"))}function A(O){for(var w=v.trim(O.getAllResponseHeaders()).split(`\r
`),x={},V=0;V<w.length;V++){var H=w[V].split(":").map(v.trim);x[H[0].toLowerCase()]=H[1]}return x}var f=function(O){o.__extends(w,O);function w(x,V,H,B,M,L,k){var W=O.call(this)||this;return H=H||{},H.rnd=v.cheapRandStr(),l()&&!H.envelope&&(H.envelope="json"),W.uri=x+v.toQueryString(H),W.headers=V||{},W.body=B,W.method=k?k.toUpperCase():v.isEmptyArg(B)?"GET":"POST",W.requestMode=M,W.timeouts=L,W.timedOut=!1,W.requestComplete=!1,W.id=String(++P),C[W.id]=W,W}return w.createRequest=function(x,V,H,B,M,L,k){var W=L||y.default.TIMEOUTS;return new w(x,V,v.copy(H),B,M,W,k)},w.prototype.complete=function(x,V,H,B,M){this.requestComplete||(this.requestComplete=!0,!x&&V&&this.emit("data",V),this.emit("complete",x,V,H,B,M),this.dispose())},w.prototype.abort=function(){this.dispose()},w.prototype.exec=function(){var x=this,V=this.headers,H=this.requestMode==S.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,B=this.timer=setTimeout(function(){x.timedOut=!0,L.abort()},H),M=this.method,L=this.xhr=new XMLHttpRequest,k=V.accept,W=this.body,K="text";if(k?k.indexOf("application/x-msgpack")===0&&(K="arraybuffer"):V.accept="application/json",W){var $=V["content-type"]||(V["content-type"]="application/json");$.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}L.open(M,this.uri,!0),L.responseType=K,"authorization"in V&&(L.withCredentials=!0);for(var Y in V)L.setRequestHeader(Y,V[Y]);var G=function(fe,Le,tt,Ue){var Qe,ft=Le+" (event type: "+fe.type+")";!((Qe=x==null?void 0:x.xhr)===null||Qe===void 0)&&Qe.statusText&&(ft+=", current statusText is "+x.xhr.statusText),d.default.logAction(d.default.LOG_ERROR,"Request.on"+fe.type+"()",ft),x.complete(new c.default(ft,tt,Ue))};L.onerror=function(fe){G(fe,"XHR error occurred",null,400)},L.onabort=function(fe){x.timedOut?G(fe,"Request aborted due to request timeout expiring",null,408):G(fe,"Request cancelled",null,400)},L.ontimeout=function(fe){G(fe,"Request timed out",null,408)};var D,F,j,Q=0,ee=!1,ce=function(){if(clearTimeout(B),j=F<400,F==204){x.complete(null,null,null,null,F);return}D=x.requestMode==S.default.REQ_RECV_STREAM&&j&&h(L)},me=function(){var fe;try{var Le=p(L,"content-type"),tt=Le?Le.indexOf("application/json")>=0:L.responseType=="text";if(tt){var Ue=L.responseType==="arraybuffer"?I.default.BufferUtils.utf8Decode(L.response):String(L.responseText);Ue.length?fe=JSON.parse(Ue):fe=Ue,ee=!0}else fe=L.response;fe.response!==void 0?(F=fe.statusCode,j=F<400,V=fe.headers,fe=fe.response):V=A(L)}catch(ft){x.complete(new c.default("Malformed response body from server: "+ft.message,null,400));return}if(j||v.isArray(fe)){x.complete(null,fe,V,ee,F);return}var Qe=b(fe,V);Qe||(Qe=new c.default("Error response received from server: "+F+" body was: "+I.default.Config.inspect(fe),null,F)),x.complete(Qe,fe,V,ee,F)};function ge(){for(var fe=L.responseText,Le=fe.length-1,tt,Ue;Q<Le&&(tt=fe.indexOf(`
`,Q))>-1;)Ue=fe.slice(Q,tt),Q=tt+1,Se(Ue)}var Se=function(fe){try{fe=JSON.parse(fe)}catch(Le){x.complete(new c.default("Malformed response body from server: "+Le.message,null,400));return}x.emit("data",fe)},xe=function(){ge(),x.streamComplete=!0,I.default.Config.nextTick(function(){x.complete()})};L.onreadystatechange=function(){var fe=L.readyState;fe<3||L.status!==0&&(F===void 0&&(F=L.status,F===1223&&(F=204),ce()),fe==3&&D?ge():fe==4&&(D?xe():me()))},L.send(W)},w.prototype.dispose=function(){var x=this.xhr;if(x){x.onreadystatechange=x.onerror=x.onabort=x.ontimeout=T,this.xhr=null;var V=this.timer;V&&(clearTimeout(V),this.timer=null),this.requestComplete||x.abort()}delete C[this.id]},w}(E.default);r.default=f}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),v=u.__importStar(n(2)),E=u.__importDefault(n(22)),c=u.__importDefault(n(5)),d=u.__importDefault(n(43)),y=n(13),S=n(32),I=u.__importDefault(n(17)),s=u.__importDefault(n(0)),b=Math.pow(2,17);function T(){}function P(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function C(H){return!!H.connection}function m(H){return v.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new c.default(v.inspectError(H),H.code||40170,H.statusCode||401)}var R=function(H){return s.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):y.stringify(S.parse(H))},l=function(H,B){if(s.default.Config.createHmac){var M=s.default.Config.createHmac("SHA256",B);return M.update(H),M.digest("base64")}return y.stringify(d.default(H,B))};function p(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var B={},M=v.keysArray(H,!0);if(!M)return"";M.sort();for(var L=0;L<M.length;L++)B[M[L]]=H[M[L]].sort();return JSON.stringify(B)}function h(H){if(H.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var B="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",B),new Error(B)}}function A(H){return"useTokenAuth"in H&&!H.useTokenAuth}function f(H){return H.useTokenAuth||!A(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function O(H){return!H.key&&!H.authCallback&&!H.authUrl}var w=0;function x(){return w++}var V=function(){function H(B,M){if(this.authOptions={},this.client=B,this.tokenParams=M.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,f(M)){if(M.key&&!l){var L="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",L),new Error(L)}O(M)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(M.defaultTokenParams,M),h(this.authOptions)}else{if(!M.key){var L="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",L),new c.default(L,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(M)}}return H.prototype.authorize=function(B,M,L){var k=this,W;if(typeof B=="function"&&!L?(L=B,W=B=null):typeof M=="function"&&!L?(L=M,W=null):W=M,!L&&this.client.options.promises)return v.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new c.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(o.default.logAction(o.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),v.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(B,W,function(K,$){if(K){k.client.connection&&k.client.connection.connectionManager.actOnErrorFromAuthorize(K),L==null||L(K);return}C(k.client)?k.client.connection.connectionManager.onAuthUpdated($,L||T):L==null||L(null,$)})},H.prototype.authorise=function(B,M,L){o.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(B,M,L)},H.prototype._forceNewToken=function(B,M,L){var k=this;this.tokenDetails=null,this._saveTokenOptions(B,M),h(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,K){delete k.tokenParams.timestamp,delete k.authOptions.queryTime,L(W,K)})},H.prototype.requestToken=function(B,M,L){var k=this;if(typeof B=="function"&&!L?(L=B,M=B=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return v.promisify(this,"requestToken",arguments);M=M||this.authOptions,B=B||v.copy(this.tokenParams);var W=L||T,K,$=this.client;if(M.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),K=M.authCallback;else if(M.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),K=function(Q,ee){var ce=v.mixin({accept:"application/json, text/plain"},M.authHeaders),me=M.authMethod&&M.authMethod.toLowerCase()==="post",ge,Se=M.authUrl.indexOf("?");Se>-1&&(ge=v.parseQueryString(M.authUrl.slice(Se)),M.authUrl=M.authUrl.slice(0,Se),me||(M.authParams=v.mixin(ge,M.authParams)));var xe=v.mixin({},M.authParams||{},Q),fe=function(Ue,Qe,ft,X){var re;if(Ue?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+v.inspectError(Ue)):(re=ft["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+re+"; body: "+v.inspectBody(Qe))),Ue||X)return ee(Ue,Qe);if(s.default.BufferUtils.isBuffer(Qe)&&(Qe=Qe.toString()),!re){ee(new c.default("authUrl response is missing a content-type header",40170,401));return}var ue=re.indexOf("application/json")>-1,he=re.indexOf("text/plain")>-1||re.indexOf("application/jwt")>-1;if(!ue&&!he){ee(new c.default("authUrl responded with unacceptable content-type "+re+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ue){if(Qe.length>b){ee(new c.default("authUrl response exceeded max permitted length",40170,401));return}try{Qe=JSON.parse(Qe)}catch(Re){ee(new c.default("Unexpected error processing authURL response; err = "+Re.message,40170,401));return}}ee(null,Qe,re)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+M.authUrl+"; Params: "+JSON.stringify(xe)+"; method: "+(me?"POST":"GET")),me){var Le=ce||{};Le["content-type"]="application/x-www-form-urlencoded";var tt=v.toQueryString(xe).slice(1);k.client.http.doUri(I.default.Post,$,M.authUrl,Le,tt,ge,fe)}else k.client.http.doUri(I.default.Get,$,M.authUrl,ce||{},null,xe,fe)};else if(M.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),K=function(Q,ee){k.createTokenRequest(Q,M,ee)};else{var Y="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new c.default(Y,40171,403));return}"capability"in B&&(B.capability=p(B.capability));var G=function(Q,ee){var ce=Q.keyName,me="/keys/"+ce+"/requestToken",ge=function(xe){return $.baseUri(xe)+me},Se=v.defaultPostHeaders();M.requestHeaders&&v.mixin(Se,M.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+me+"; Token params: "+JSON.stringify(Q)),k.client.http.do(I.default.Post,$,ge,Se,JSON.stringify(Q),null,ee)},D=!1,F=this.client.options.timeouts.realtimeRequestTimeout,j=setTimeout(function(){D=!0;var Q="Token request callback timed out after "+F/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),W(new c.default(Q,40170,401))},F);K(B,function(Q,ee,ce){if(!D){if(clearTimeout(j),Q){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+v.inspectError(Q)),W(m(Q));return}if(typeof ee=="string"){ee.length===0?W(new c.default("Token string is empty",40170,401)):ee.length>b?W(new c.default("Token string exceeded max permitted length (was "+ee.length+" bytes)",40170,401)):ee==="undefined"||ee==="null"?W(new c.default("Token string was literal null/undefined",40170,401)):ee[0]==="{"&&!(ce&&ce.indexOf("application/jwt")>-1)?W(new c.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:ee});return}if(typeof ee!="object"){var me="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof ee;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",me),W(new c.default(me,40170,401));return}var ge=JSON.stringify(ee).length;if(ge>b&&!M.suppressMaxLengthCheck){W(new c.default("Token request/details object exceeded max permitted stringified size (was "+ge+" bytes)",40170,401));return}if("issued"in ee){W(null,ee);return}if(!("keyName"in ee)){var me="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",me),W(new c.default(me,40170,401));return}G(ee,function(Se,xe,fe,Le){if(Se){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+v.inspectError(Se)),W(m(Se));return}Le||(xe=JSON.parse(xe)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,xe)})}})},H.prototype.createTokenRequest=function(B,M,L){var k=this;if(typeof B=="function"&&!L?(L=B,M=B=null):typeof M=="function"&&!L&&(L=M,M=null),!L&&this.client.options.promises)return v.promisify(this,"createTokenRequest",arguments);M=M||this.authOptions,B=B||v.copy(this.tokenParams);var W=M.key;if(!W){L(new c.default("No key specified",40101,403));return}var K=W.split(":"),$=K[0],Y=K[1];if(!Y){L(new c.default("Invalid key specified",40101,403));return}if(B.clientId===""){L(new c.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in B&&(B.capability=p(B.capability));var G=v.mixin({keyName:$},B),D=B.clientId||"",F=B.ttl||"",j=B.capability||"";(function(Q){if(G.timestamp){Q();return}k.getTimestamp(M&&M.queryTime,function(ee,ce){if(ee){L(ee);return}G.timestamp=ce,Q()})})(function(){var Q=G.nonce||(G.nonce=P()),ee=G.timestamp,ce=G.keyName+`
`+F+`
`+j+`
`+D+`
`+ee+`
`+Q+`
`;G.mac=G.mac||l(ce,Y),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),L(null,G)})},H.prototype.getAuthParams=function(B){this.method=="basic"?B(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){B(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");B(null,{access_token:L.token})})},H.prototype.getAuthHeaders=function(B){this.method=="basic"?B(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(M,L){if(M){B(M);return}if(!L)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");B(null,{authorization:"Bearer "+R(L.token)})})},H.prototype.getTimestamp=function(B,M){!this.isTimeOffsetSet()&&(B||this.authOptions.queryTime)?this.client.time(M):M(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return v.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(B){this.method="basic",this.key=B.key,this.basicKey=R(B.key),this.authOptions=B||{},"clientId"in B&&this._userSetClientId(B.clientId)},H.prototype._saveTokenOptions=function(B,M){this.method="token",B&&(this.tokenParams=B),M&&(M.token&&(M.tokenDetails=typeof M.token=="string"?{token:M.token}:M.token),M.tokenDetails&&(this.tokenDetails=M.tokenDetails),"clientId"in M&&this._userSetClientId(M.clientId),this.authOptions=M)},H.prototype._ensureValidAuthCredentials=function(B,M){var L=this,k=this.tokenDetails;if(k){if(this._tokenClientIdMismatch(k.clientId)){M(new c.default("Mismatch between clientId in token ("+k.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!k.expires||k.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+k.expires),M(null,k);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=E.default.create())).push(M),!(this.currentTokenRequestId!==null&&!B)){var W=this.currentTokenRequestId=x();this.requestToken(this.tokenParams,this.authOptions,function(K,$){if(L.currentTokenRequestId>W){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}L.currentTokenRequestId=null;var Y=L.waitingForTokenRequest||T;if(L.waitingForTokenRequest=null,K){Y(K);return}Y(null,L.tokenDetails=$)})}},H.prototype._userSetClientId=function(B){if(typeof B=="string"||B===null){if(B==="*")throw new c.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var M=this._uncheckedSetClientId(B);if(M)throw M}else throw new c.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(B){if(this._tokenClientIdMismatch(B)){var M="Unexpected clientId mismatch: client has "+this.clientId+", requested "+B,L=new c.default(M,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",M),L}else return this.clientId=this.tokenParams.clientId=B,null},H.prototype._tokenClientIdMismatch=function(B){return!!(this.clientId&&this.clientId!=="*"&&B&&B!=="*"&&this.clientId!==B)},H.isTokenErr=function(B){return B.code&&B.code>=40140&&B.code<40150},H}();r.default=V},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(u||(u={})),r.default=u},function(i,r,n){"use strict";r.__esModule=!0,r.HttpPaginatedResponse=r.PaginatedResult=void 0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(3)),E=u.__importDefault(n(24));function c(b){var T=b.match(/^\.\/(\w+)\?(.*)$/);return T&&T[2]&&o.parseQueryString(T[2])}function d(b){typeof b=="string"&&(b=b.split(","));for(var T={},P=0;P<b.length;P++){var C=b[P].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(C){var m=c(C[1]);m&&(T[C[2]]=m)}}return T}function y(b,T,P){return!(P&&(T||typeof b.code=="number"))}var S=function(){function b(T,P,C,m,R,l){this.rest=T,this.path=P,this.headers=C,this.envelope=m!=null?m:null,this.bodyHandler=R,this.useHttpPaginatedResponse=l||!1}return b.prototype.get=function(T,P){var C=this;E.default.get(this.rest,this.path,this.headers,T,this.envelope,function(m,R,l,p,h){C.handlePage(m,R,l,p,h,P)})},b.prototype.delete=function(T,P){var C=this;E.default.delete(this.rest,this.path,this.headers,T,this.envelope,function(m,R,l,p,h){C.handlePage(m,R,l,p,h,P)})},b.prototype.post=function(T,P,C){var m=this;E.default.post(this.rest,this.path,P,this.headers,T,this.envelope,function(R,l,p,h,A){C&&m.handlePage(R,l,p,h,A,C)})},b.prototype.put=function(T,P,C){var m=this;E.default.put(this.rest,this.path,P,this.headers,T,this.envelope,function(R,l,p,h,A){C&&m.handlePage(R,l,p,h,A,C)})},b.prototype.patch=function(T,P,C){var m=this;E.default.patch(this.rest,this.path,P,this.headers,T,this.envelope,function(R,l,p,h,A){C&&m.handlePage(R,l,p,h,A,C)})},b.prototype.handlePage=function(T,P,C,m,R,l){if(T&&y(T,P,this.useHttpPaginatedResponse)){v.default.logAction(v.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(T)),l==null||l(T);return}var p,h,A;try{p=this.bodyHandler(P,C||{},m)}catch(f){l==null||l(T||f);return}C&&(h=C.Link||C.link)&&(A=d(h)),this.useHttpPaginatedResponse?l(null,new s(this,p,C||{},R,A,T)):l(null,new I(this,p,A))},b}(),I=function(){function b(T,P,C){var m=this;this.resource=T,this.items=P;var R=this;C&&("first"in C&&(this.first=function(l){if(!l&&R.resource.rest.options.promises)return o.promisify(R,"first",[]);R.get(C.first,l)}),"current"in C&&(this.current=function(l){if(!l&&R.resource.rest.options.promises)return o.promisify(R,"current",[]);R.get(C.current,l)}),this.next=function(l){if(!l&&R.resource.rest.options.promises)return o.promisify(R,"next",[]);"next"in C?R.get(C.next,l):l(null)},this.hasNext=function(){return"next"in C},this.isLast=function(){var l;return!(!((l=m.hasNext)===null||l===void 0)&&l.call(m))})}return b.prototype.get=function(T,P){var C=this.resource;E.default.get(C.rest,C.path,C.headers,T,C.envelope,function(m,R,l,p,h){C.handlePage(m,R,l,p,h,P)})},b}();r.PaginatedResult=I;var s=function(b){u.__extends(T,b);function T(P,C,m,R,l,p){var h=b.call(this,P,C,l)||this;return h.statusCode=R,h.success=R<300&&R>=200,h.headers=m,h.errorCode=p&&p.code,h.errorMessage=p&&p.message,h}return T.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},T}(I);r.HttpPaginatedResponse=s,r.default=S},function(i,r,n){"use strict";r.__esModule=!0,r.isRetriable=void 0;var u=n(1),o=u.__importDefault(n(5)),v={disconnected:o.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:o.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:o.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:o.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:o.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:o.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:o.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function E(c){if(!c.statusCode||!c.code||c.statusCode>=500)return!0;var d=!1;return Object.values(v).forEach(function(y){y.code&&y.code==c.code&&(d=!0)}),d}r.isRetriable=E,r.default=v},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(u||(u={})),r.default=u},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(u){return u})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),v=function(){function E(c){this.members=c||[]}return E.prototype.call=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];for(var y=0,S=this.members;y<S.length;y++){var I=S[y];if(I)try{I.apply(void 0,c)}catch(s){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+s+"; stack = "+s.stack)}}},E.prototype.push=function(){for(var c,d=[],y=0;y<arguments.length;y++)d[y]=arguments[y];(c=this.members).push.apply(c,d)},E.create=function(c){var d=new E(c);return Object.assign(function(){for(var y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];return d.call.apply(d,y)},{push:function(y){return d.push(y)}})},E}();r.default=v},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){(function(){var o=u,v=o.lib,E=v.Base,c=o.enc,d=c.Utf8,y=o.algo,S=y.HMAC=E.extend({init:function(I,s){I=this._hasher=new I.init,typeof s=="string"&&(s=d.parse(s));var b=I.blockSize,T=b*4;s.sigBytes>T&&(s=I.finalize(s)),s.clamp();for(var P=this._oKey=s.clone(),C=this._iKey=s.clone(),m=P.words,R=C.words,l=0;l<b;l++)m[l]^=1549556828,R[l]^=909522486;P.sigBytes=C.sigBytes=T,this.reset()},reset:function(){var I=this._hasher;I.reset(),I.update(this._iKey)},update:function(I){return this._hasher.update(I),this},finalize:function(I){var s=this._hasher,b=s.finalize(I);s.reset();var T=s.finalize(this._oKey.clone().concat(b));return T}})})()})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),v=u.__importStar(n(2)),E=u.__importDefault(n(3)),c=u.__importDefault(n(16)),d=u.__importDefault(n(17)),y=u.__importDefault(n(5));function S(C,m,R,l,p){C.http.supportsAuthHeaders?C.auth.getAuthHeaders(function(h,A){h?l(h):p(v.mixin(A,m),R)}):C.auth.getAuthParams(function(h,A){h?l(h):p(m,v.mixin(A,R))})}function I(C,m){return function(R,l,p,h,A){if(R&&!l){C(R);return}if(!h)try{l=v.decodeBody(l,m)}catch(H){C(H);return}if(!l){C(new y.default("unenvelope(): Response body is missing",null));return}var f=l,O=f.statusCode,w=f.response,x=f.headers;if(O===void 0){C(R,l,p,!0,A);return}if(O<200||O>=300){var V=w&&w.error||R;V||(V=new Error("Error in unenveloping "+l),V.statusCode=O),C(V,w,x,!0,O);return}C(R,w,x,!0,O)}}function s(C){var m=[];if(C)for(var R in C)m.push(R+"="+C[R]);return m.join("&")}function b(C,m){return C+(m?"?":"")+s(m)}function T(C,m,R,l){return function(p,h,A,f,O){p?E.default.logAction(E.default.LOG_MICRO,"Resource."+m+"()","Received Error; "+b(R,l)+"; Error: "+v.inspectError(p)):E.default.logAction(E.default.LOG_MICRO,"Resource."+m+"()","Received; "+b(R,l)+"; Headers: "+s(A)+"; StatusCode: "+O+"; Body: "+(o.default.BufferUtils.isBuffer(h)?h.toString():h)),C&&C(p,h,A,f,O)}}var P=function(){function C(){}return C.get=function(m,R,l,p,h,A){C.do(d.default.Get,m,R,null,l,p,h,A)},C.delete=function(m,R,l,p,h,A){C.do(d.default.Delete,m,R,null,l,p,h,A)},C.post=function(m,R,l,p,h,A,f){C.do(d.default.Post,m,R,l,p,h,A,f)},C.patch=function(m,R,l,p,h,A,f){C.do(d.default.Patch,m,R,l,p,h,A,f)},C.put=function(m,R,l,p,h,A,f){C.do(d.default.Put,m,R,l,p,h,A,f)},C.do=function(m,R,l,p,h,A,f,O){E.default.shouldLog(E.default.LOG_MICRO)&&(O=T(O,m,l,A)),f&&(O=O&&I(O,f),(A=A||{}).envelope=f);function w(x,V){var H;if(E.default.shouldLog(E.default.LOG_MICRO)&&E.default.logAction(E.default.LOG_MICRO,"Resource."+m+"()","Sending; "+b(l,V)),E.default.shouldLog(E.default.LOG_MICRO)){var B=p;if(((H=x["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{B=o.default.Config.msgpack.decode(p)}catch(M){E.default.logAction(E.default.LOG_MICRO,"Resource."+m+"()","Sending MsgPack Decoding Error: "+v.inspectError(M))}E.default.logAction(E.default.LOG_MICRO,"Resource."+m+"()","Sending; "+b(l,V)+"; Body: "+B)}R.http.do(m,R,l,x,p,V,function(M,L,k,W,K){if(M&&c.default.isTokenErr(M)){R.auth.authorize(null,null,function($){if($){O($);return}S(R,k,V,O,w)});return}O(M,L,k,W,K)})}S(R,h,A,O,w)},C}();r.default=P},function(i,r,n){"use strict";(function(u){r.__esModule=!0,r.TransportParams=void 0;var o=n(1),v=o.__importDefault(n(10)),E=o.__importStar(n(2)),c=o.__importStar(n(51)),d=o.__importDefault(n(8)),y=o.__importDefault(n(0)),S=o.__importDefault(n(7)),I=o.__importDefault(n(35)),s=o.__importDefault(n(3)),b=o.__importDefault(n(36)),T=o.__importStar(n(19)),P=o.__importDefault(n(5)),C=o.__importDefault(n(16)),m=o.__importDefault(n(9)),R=o.__importDefault(n(22)),l=o.__importDefault(n(52)),p=o.__importDefault(n(26)),h=o.__importDefault(n(53)),A=function(){var $;return typeof y.default.WebStorage!="undefined"&&(($=y.default.WebStorage)===null||$===void 0?void 0:$.localSupported)},f=function(){var $;return typeof y.default.WebStorage!="undefined"&&(($=y.default.WebStorage)===null||$===void 0?void 0:$.sessionSupported)},O=v.default.Action,w=function(){},x="ably-transport-preference",V="ably-connection-recovery";function H(){var $,Y;return f()&&((Y=($=y.default.WebStorage)===null||$===void 0?void 0:$.getSession)===null||Y===void 0?void 0:Y.call($,V))}function B($){var Y,G;return f()&&((G=(Y=y.default.WebStorage)===null||Y===void 0?void 0:Y.setSession)===null||G===void 0?void 0:G.call(Y,V,$))}function M(){var $,Y;return f()&&((Y=($=y.default.WebStorage)===null||$===void 0?void 0:$.removeSession)===null||Y===void 0?void 0:Y.call($,V))}function L($,Y){return E.arrIndexOf(y.default.Defaults.transportPreferenceOrder,$.shortName)>E.arrIndexOf(y.default.Defaults.transportPreferenceOrder,Y.shortName)}function k($,Y,G){var D;if($.channel!==Y.channel||(D=$.action)!==O.PRESENCE&&D!==O.MESSAGE||D!==Y.action)return!1;var F=D===O.PRESENCE?"presence":"messages",j=$[F].concat(Y[F]),Q=m.default.getMessagesSize(j);return Q>G||!E.allSame(j,"clientId")||!E.arrEvery(j,function(ee){return!ee.id})?!1:($[F]=j,!0)}var W=function(){function $(Y,G,D,F){this.options=Y,this.host=G,this.mode=D,this.connectionKey=F,this.format=Y.useBinaryProtocol?E.Format.msgpack:E.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return $.prototype.getConnectParams=function(Y){var G=Y?E.copy(Y):{},D=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var F=D.recover.split(":");if(F){G.recover=F[0];var j=F[1];isNaN(Number(j))?G.timeSerial=j:G.connectionSerial=j}break}default:}return D.clientId!==void 0&&(G.clientId=D.clientId),D.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=d.default.apiVersion,G.agent=encodeURIComponent(d.default.agent),D.transportParams!==void 0&&E.mixin(G,D.transportParams),G},$.prototype.toString=function(){var Y="[mode="+this.mode;return this.host&&(Y+=",host="+this.host),this.connectionKey&&(Y+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Y+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Y+=",timeSerial="+this.timeSerial),this.format&&(Y+=",format="+this.format),Y+="]",Y},$}();r.TransportParams=W;var K=function($){o.__extends(Y,$);function Y(G,D){var F=$.call(this)||this;F.disconnectedRetryCount=0,Y.initTransports(),F.realtime=G,F.options=D;var j=D.timeouts,Q=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(F.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:Q,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},F.state=F.states.initialized,F.errorReason=null,F.queuedMessages=new I.default,F.msgSerial=0,F.connectionDetails=void 0,F.connectionId=void 0,F.connectionKey=void 0,F.timeSerial=void 0,F.connectionSerial=void 0,F.connectionStateTtl=j.connectionStateTtl,F.maxIdleInterval=null,F.transports=E.intersect(D.transports||d.default.defaultTransports,Y.supportedTransports),F.baseTransport=E.intersect(d.default.baseTransportOrder,F.transports)[0],F.upgradeTransports=E.intersect(F.transports,d.default.upgradeTransports),F.transportPreference=null,F.httpHosts=d.default.getHosts(D),F.activeProtocol=null,F.proposedTransports=[],F.pendingTransports=[],F.host=null,F.lastAutoReconnectAttempt=null,F.lastActivity=null,F.mostRecentMsg=null,F.forceFallbackHost=!1,F.connectCounter=0,s.default.logAction(s.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(D.transports||d.default.defaultTransports)+"]"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+F.transports+"]"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+F.httpHosts+"]"),!F.transports.length){var ee="no requested transports available";throw s.default.logAction(s.default.LOG_ERROR,"realtime.ConnectionManager()",ee),new Error(ee)}var ce=y.default.Config.addEventListener;return ce&&(f()&&typeof D.recover=="function"&&ce("beforeunload",F.persistConnection.bind(F)),D.closeOnUnload===!0&&ce("beforeunload",function(){s.default.logAction(s.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),F.requestState({state:"closing"})}),ce("online",function(){(F.state==F.states.disconnected||F.state==F.states.suspended)&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),F.requestState({state:"connecting"}))}),ce("offline",function(){F.state==F.states.connected&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),F.disconnectAllTransports())})),F}return Y.initTransports=function(){l.default(Y),E.arrForEach(y.default.Transports,function(G){G(Y)})},Y.prototype.createTransportParams=function(G,D){var F=new W(this.options,G,D,this.connectionKey);return this.timeSerial?F.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(F.connectionSerial=this.connectionSerial),F},Y.prototype.getTransportParams=function(G){var D=this,F=function(j){if(D.connectionKey){j("resume");return}if(typeof D.options.recover=="string"){j("recover");return}var Q=D.options.recover,ee=H();if(ee&&typeof Q=="function"){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),Q(ee,function(ce){ce?(D.options.recover=ee.recoveryKey,j("recover")):j("clean")});return}j("clean")};F(function(j){var Q=D.createTransportParams(null,j);if(j==="recover"){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+D.options.recover);var ee=D.options.recover.split(":");ee&&ee[2]&&(D.msgSerial=Number(ee[2]))}else s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+Q.toString());G(Q)})},Y.prototype.tryATransport=function(G,D,F){var j=this;s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+D),p.default.tryConnect(Y.supportedTransports[D],this,this.realtime.auth,G,function(Q,ee){var ce=j.state;if(ce==j.states.closing||ce==j.states.closed||ce==j.states.failed){ee&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ce.state+" while we were attempting the transport; closing "+ee),ee.close()),F(!0);return}if(Q){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+D+" "+Q.event+", err: "+Q.error.toString()),C.default.isTokenErr(Q.error)&&!(j.errorReason&&C.default.isTokenErr(j.errorReason))?(j.errorReason=Q.error,j.realtime.auth._forceNewToken(null,null,function(me){if(me){j.actOnErrorFromAuthorize(me);return}j.tryATransport(G,D,F)})):Q.event==="failed"?(j.notifyState({state:"failed",error:Q.error}),F(!0)):Q.event==="disconnected"&&(T.isRetriable(Q.error)?F(!1):(j.notifyState({state:j.states.connecting.failState,error:Q.error}),F(!0)));return}s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+D+"; setting pending"),j.setTransportPending(ee,G),F(null,ee)})},Y.prototype.setTransportPending=function(G,D){var F=this,j=D.mode;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+j),E.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var Q=y.default.Defaults.transportPreferenceOrder[y.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ce,me,ge,Se){j=="upgrade"?G.shortName!==Q&&E.arrIn(F.getUpgradePossibilities(),Q)&&F.activeProtocol?setTimeout(function(){F.scheduleTransportActivation(ce,G,me,ge,Se)},F.options.timeouts.parallelUpgradeDelay):F.scheduleTransportActivation(ce,G,me,ge,Se):(F.activateTransport(ce,G,me,ge,Se),y.default.Config.nextTick(function(){F.connectImpl(D)})),j==="recover"&&F.options.recover&&(F.options.recover=null,F.unpersistConnection())});var ee=this;G.on(["disconnected","closed","failed"],function(ce){ee.deactivateTransport(G,this.event,ce)}),this.emit("transport.pending",G)},Y.prototype.scheduleTransportActivation=function(G,D,F,j,Q){var ee=this,ce=this.activeProtocol&&this.activeProtocol.getTransport(),me=function(){D.disconnect(),E.arrDeleteValue(ee.pendingTransports,D)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}if(ce&&!L(D,ce)){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+" is no better than current active transport "+ce.shortName+" - abandoning upgrade"),me();return}s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+D);var ge=function(Se){var xe;if(Se){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+D+"; err = "+Se);return}if(!D.isConnected){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+"is no longer connected; abandoning upgrade"),me();return}if(ee.state===ee.states.connected)s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),ee.state=ee.states.synchronizing,xe=ee.activeProtocol;else if(ee.state!==ee.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+ee.state.state+(ee.state===ee.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),me();return}var fe=F!==ee.connectionId,Le=fe?Q:ee;fe&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(ee.timeSerial||ee.connectionSerial)+" to "+(Le.timeSerial||Le.connectionSerial)+"; upgrade error was "+G),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+D),ee.sync(D,Le,function(tt,Ue,Qe){if(tt){ee.state===ee.states.synchronizing&&(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+D+"; err = "+tt),ee.disconnectAllTransports());return}var ft=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+D),ee.activateTransport(G,D,Ue,j,Qe),ee.state===ee.states.synchronizing?(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+D),ee.state=ee.states.connected):s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+ee.state.state+", so leaving unchanged"),ee.state.sendEvents&&ee.sendQueuedMessages()};xe?xe.onceIdle(ft):ft()})};ce?this.realtime.channels.onceNopending(ge):ge()},Y.prototype.activateTransport=function(G,D,F,j,Q){var ee=this;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+D),G&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),F&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+F),j&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),Q&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(Q.timeSerial||Q.connectionSerial)),this.persistTransportPreference(D);var ce=this.state,me=this.states.connected.state;if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ce.state),ce.state==this.states.closing.state||ce.state==this.states.closed.state||ce.state==this.states.failed.state)return s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),D.disconnect(),!1;if(E.arrDeleteValue(this.pendingTransports,D),!D.isConnected)return s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+D+" since it appears to no longer be connected"),!1;var ge=this.activeProtocol;this.activeProtocol=new c.default(D),this.host=D.params.host;var Se=j.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(F,j,Q,!!G),this.onConnectionDetailsUpdate(j,D),y.default.Config.nextTick(function(){D.on("connected",function(fe,Le,tt){ee.onConnectionDetailsUpdate(tt,D),ee.emit("update",new b.default(me,me,null,fe))})}),ce.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new b.default(me,me,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",D),ge)if(ge.messageQueue.count()>0&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+ge.transport.shortName+", new one is "+D.shortName+") finishing with "+ge.messageQueue.count()+" messages still pending"),ge.transport===D){var xe="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+D.shortName+"; stack = "+new Error().stack;s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()",xe)}else ge.finish();return E.safeArrForEach(this.pendingTransports,function(fe){if(fe===D){var Le="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+D.shortName+"; stack = "+new Error().stack;s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()",Le),E.arrDeleteValue(ee.pendingTransports,D)}else fe.disconnect()}),E.safeArrForEach(this.proposedTransports,function(fe){fe===D?(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+D.shortName+"; stack = "+new Error().stack),E.arrDeleteValue(ee.proposedTransports,D)):fe.dispose()}),!0},Y.prototype.deactivateTransport=function(G,D,F){var j=this.activeProtocol,Q=j&&j.getTransport()===G,ee=E.arrDeleteValue(this.pendingTransports,G),ce=E.arrDeleteValue(this.proposedTransports,G),me=this.noTransportsScheduledForActivation();if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+D+(Q?"; was active":ee?"; was pending":ce?"; was proposed":"")+(me?"":"; another transport is scheduled for activation")),F&&F.message&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+F.message),Q&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),y.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),Q&&me||Q&&D==="failed"||D==="closed"||j===null&&ee&&this.pendingTransports.length===0){if(D==="disconnected"&&F&&F.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:D,error:F,retryImmediately:!0});return}var ge=D==="failed"&&C.default.isTokenErr(F)?"disconnected":D;this.notifyState({state:ge,error:F});return}Q&&D==="disconnected"&&this.state!==this.states.synchronizing&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:F}))},Y.prototype.noTransportsScheduledForActivation=function(){return E.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Y.prototype.sync=function(G,D,F){var j=setTimeout(function(){G.off("sync"),F(new P.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),Q=v.default.fromValues({action:O.SYNC,connectionKey:this.connectionKey});D.timeSerial?Q.timeSerial=D.timeSerial:D.connectionSerial!==void 0&&(Q.connectionSerial=D.connectionSerial),G.send(Q),G.once("sync",function(ee,ce){clearTimeout(j),F(null,ee,ce)})},Y.prototype.setConnection=function(G,D,F,j){var Q=this,ee=this.connectionId,ce=ee&&ee!==G,me=!ee&&j;(ce||me)&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),y.default.Config.nextTick(function(){Q.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){Q.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=D.connectionKey;var ge=ce||!ee;this.setConnectionSerial(F,ge,!1)},Y.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Y.prototype.setConnectionSerial=function(G,D,F){var j=G.timeSerial,Q=G.connectionSerial;if(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+Q+"; timeSerial = "+j+"; force = "+D+"; previous = "+this.connectionSerial),j!==void 0){if(j<=this.timeSerial&&!D)return F&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+j+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=j,this.setRecoveryKey();return}if(Q!==void 0){if(Q<=this.connectionSerial&&!D)return F&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+Q+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=Q,this.setRecoveryKey()}},Y.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Y.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Y.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Y.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=E.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Y.prototype.persistConnection=function(){if(f()){var G=this.realtime.connection.recoveryKey;G&&B({recoveryKey:G,disconnectedAt:E.now(),location:u.location,clientId:this.realtime.auth.clientId})}},Y.prototype.unpersistConnection=function(){M()},Y.prototype.getError=function(){return this.errorReason||this.getStateError()},Y.prototype.getStateError=function(){return T.default[this.state.state]},Y.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Y.prototype.enactStateChange=function(G){var D=G.current==="failed"?s.default.LOG_ERROR:s.default.LOG_MAJOR;s.default.logAction(D,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var F=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(F.terminal||F.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Y.prototype.startTransitionTimer=function(G){var D=this;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){D.transitionTimer&&(D.transitionTimer=null,s.default.logAction(s.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),D.notifyState({state:G.failState}))},G.retryDelay)},Y.prototype.cancelTransitionTimer=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Y.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,s.default.logAction(s.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Y.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Y.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Y.prototype.startRetryTimer=function(G){var D=this;this.retryTimer=setTimeout(function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),D.retryTimer=null,D.requestState({state:"connecting"})},G)},Y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Y.prototype.notifyState=function(G){var D=this,F=G.state,j=F==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&C.default.isTokenErr(G.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+F+(j?"; will retry connection immediately":"")),F!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(F==="suspended"||F==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Q=this.states[G.state],ee=Q.retryDelay;Q.state==="disconnected"&&(this.disconnectedRetryCount++,ee=Q.retryDelay*E.getBackoffCoefficient(this.disconnectedRetryCount)*E.getJitterCoefficient());var ce=new b.default(this.state.state,Q.state,ee,G.error||T.default[Q.state]);if(j){var me=function(){D.state===D.states.disconnected&&(D.lastAutoReconnectAttempt=E.now(),D.requestState({state:"connecting"}))},ge=this.lastAutoReconnectAttempt&&E.now()-this.lastAutoReconnectAttempt+1;ge&&ge<1e3?(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ge+"ms ago, waiting another "+(1e3-ge)+"ms before trying again"),setTimeout(me,1e3-ge)):y.default.Config.nextTick(me)}else(F==="disconnected"||F==="suspended")&&this.startRetryTimer(ee);(F==="disconnected"&&!j||F==="suspended"||Q.terminal)&&y.default.Config.nextTick(function(){D.disconnectAllTransports()}),F=="connected"&&!this.activeProtocol&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ce),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(F,ce.reason),this.failQueuedMessages(ce.reason))}},Y.prototype.requestState=function(G){var D=this,F=G.state;if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+F+"; current state: "+this.state.state),F!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(F),!(F=="connecting"&&this.state.state=="connected")&&!(F=="closing"&&this.state.state=="closed"))){var j=this.states[F],Q=new b.default(this.state.state,j.state,null,G.error||T.default[j.state]);this.enactStateChange(Q),F=="connecting"&&y.default.Config.nextTick(function(){D.startConnect()}),F=="closing"&&this.closeImpl()}},Y.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var D=this.realtime.auth,F=++this.connectCounter,j=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(ee){F===G.connectCounter&&G.connectImpl(ee,F)})};if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),D.method==="basic")j();else{var Q=function(ee){F===G.connectCounter&&(ee?G.actOnErrorFromAuthorize(ee):j())};this.errorReason&&C.default.isTokenErr(this.errorReason)?D._forceNewToken(null,null,Q):D._ensureValidAuthCredentials(!1,Q)}},Y.prototype.connectImpl=function(G,D){var F=this.state.state;F!==this.states.connecting.state&&F!==this.states.connected.state?s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+F):this.pendingTransports.length?s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):F==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,D)},Y.prototype.connectPreference=function(G){var D=this,F=this.getTransportPreference(),j=!1;E.arrIn(this.transports,F)||(this.unpersistTransportPreference(),this.connectImpl(G)),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+F);var Q=setTimeout(function(){j=!0,D.state.state!==D.states.connected.state&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+F+" failed; clearing preference and trying from scratch"),D.disconnectAllTransports(),D.unpersistTransportPreference()),D.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,F,function(ee,ce){clearTimeout(Q),j&&ce?(ce.off(),ce.disconnect(),E.arrDeleteValue(D.pendingTransports,ce)):!ce&&!ee&&(D.unpersistTransportPreference(),D.connectImpl(G))})},Y.prototype.connectBase=function(G,D){var F=this,j=function(ge){F.notifyState({state:F.states.connecting.failState,error:ge})},Q=this.httpHosts.slice(),ee=function(ge,Se){D===F.connectCounter&&!Se&&!ge&&me()};s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ce=Q.shift();if(!ce){j(new P.default("Unable to connect (no available host)",80003,404));return}G.host=ce;var me=function(){if(!Q.length){j(new P.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!F.realtime.http.checkConnectivity){j(new P.default("Internal error: Http.checkConnectivity not set",null,500));return}F.realtime.http.checkConnectivity(function(ge,Se){if(D===F.connectCounter){if(ge){j(ge);return}if(!Se){j(new P.default("Unable to connect (network unreachable)",80003,404));return}G.host=E.arrPopRandomElement(Q),F.tryATransport(G,F.baseTransport,ee)}})};if(this.forceFallbackHost&&Q.length){this.forceFallbackHost=!1,me();return}this.tryATransport(G,this.baseTransport,ee)},Y.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,D=E.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(D+1)},Y.prototype.upgradeIfNeeded=function(G){var D=this,F=this.getUpgradePossibilities();s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+y.default.Config.inspect(F)),F.length&&E.arrForEach(F,function(j){var Q=D.createTransportParams(G.host,"upgrade");D.tryATransport(Q,j,w)})},Y.prototype.closeImpl=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),E.safeArrForEach(this.pendingTransports,function(G){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),E.safeArrForEach(this.proposedTransports,function(G){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Y.prototype.onAuthUpdated=function(G,D){var F=this,j;switch(this.state.state){case"connected":{if(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var Q=this.activeProtocol.getTransport().params;y.default.Config.nextTick(function(){F.state.state==="connected"&&F.upgradeIfNeeded(Q)})}var ee=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();ee&&ee.onAuthUpdated&&ee.onAuthUpdated(G);var ce=v.default.fromValues({action:O.AUTH,auth:{accessToken:G.token}});this.send(ce);var me=function(){F.off(ge),D(null,G)},ge=function(xe){xe.current==="failed"&&(F.off(me),F.off(ge),D(xe.reason||F.getStateError()))};this.once("connectiondetails",me),this.on("connectionstate",ge);break}case"connecting":s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Se=function(xe){switch(xe.current){case"connected":F.off(Se),D(null,G);break;case"failed":case"closed":case"suspended":F.off(Se),D(xe.reason||F.getStateError());break;default:break}};this.on("connectionstate",Se),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Y.prototype.disconnectAllTransports=function(G){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,E.safeArrForEach(this.pendingTransports,function(D){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+D),D&&D.disconnect()}),this.pendingTransports=[],E.safeArrForEach(this.proposedTransports,function(D){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+D),D&&D.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Y.prototype.send=function(G,D,F){F=F||w;var j=this.state;if(j.sendEvents){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new c.PendingMessage(G,F));return}var Q=D&&j.queueEvents||j.forceQueueEvents;if(!Q){var ee="rejecting event, queueEvent was "+D+", state was "+j.state;s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()",ee),F(this.errorReason||new P.default(ee,9e4,400));return}s.default.shouldLog(s.default.LOG_MICRO)&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+v.default.stringify(G)),this.queue(G,F)},Y.prototype.sendImpl=function(G){var D=G.message;G.ackRequired&&!G.sendAttempted&&(D.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(F){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+F.stack)}},Y.prototype.queue=function(G,D){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var F=this.queuedMessages.last(),j=this.options.maxMessageSize;F&&!F.sendAttempted&&k(F.message,G,j)?(F.merged||(F.callback=R.default.create([F.callback]),F.merged=!0),F.callback.push(D)):this.queuedMessages.push(new c.PendingMessage(G,D))},Y.prototype.sendQueuedMessages=function(){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Y.prototype.queuePendingMessages=function(G){G&&G.length&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Y.prototype.failQueuedMessages=function(G){var D=this.queuedMessages.count();D>0&&(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+D+" queued messages, err = "+E.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Y.prototype.onChannelMessage=function(G,D){var F=this.activeProtocol&&D===this.activeProtocol.getTransport(),j=E.arrIn(this.pendingTransports,D)&&this.state==this.states.synchronizing,Q=G.action===O.MESSAGE||G.action===O.PRESENCE;if(F||j){if(Q){var ee=this.setConnectionSerial(G,!1,!0);if(ee)return;if(v.default.isDuplicate(G,this.mostRecentMsg)){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else E.arrIndexOf([O.ACK,O.NACK,O.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Y.prototype.ping=function(G,D){var F=this;if(G){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var j=function(){G.off("heartbeat",ce),D(new P.default("Timeout waiting for heartbeat response",5e4,500))},Q=E.now(),ee=E.cheapRandStr(),ce=function(fe){if(fe===ee){G.off("heartbeat",ce),clearTimeout(me);var Le=E.now()-Q;D(null,Le)}},me=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ce),G.ping(ee);return}if(this.state.state!=="connected"){D(new P.default("Unable to ping service; not connected",4e4,400));return}var ge=!1,Se=function(fe,Le){F.off("transport.active",xe),ge||(ge=!0,D(fe,Le))},xe=function(){ge||(ge=!0,y.default.Config.nextTick(function(){F.ping(null,D)}))};this.on("transport.active",xe),this.ping(this.activeProtocol.getTransport(),Se)},Y.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Y.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Y.prototype.getTransportPreference=function(){var G,D;return this.transportPreference||A()&&((D=(G=y.default.WebStorage)===null||G===void 0?void 0:G.get)===null||D===void 0?void 0:D.call(G,x))},Y.prototype.persistTransportPreference=function(G){var D,F;E.arrIn(d.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,A()&&((F=(D=y.default.WebStorage)===null||D===void 0?void 0:D.set)===null||F===void 0||F.call(D,x,G.shortName)))},Y.prototype.unpersistTransportPreference=function(){var G,D;this.transportPreference=null,A()&&((D=(G=y.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||D===void 0||D.call(G,x))},Y.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===h.default.Forbidden){var D="Client configured authentication provider returned 403; failing the connection";s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",D),this.notifyState({state:"failed",error:new P.default(D,80019,403,G)})}else{var D="Client configured authentication provider request failed";s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",D),this.notifyState({state:this.state.failState,error:new P.default(D,80019,401,G)})}},Y.prototype.onConnectionDetailsUpdate=function(G,D){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var F=G.clientId;if(F){var j=this.realtime.auth._uncheckedSetClientId(F);if(j){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),D.fail(j);return}}var Q=G.connectionStateTtl;Q&&(this.connectionStateTtl=Q),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Y.supportedTransports={},Y}(S.default);r.default=K}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(10)),v=u.__importStar(n(2)),E=u.__importDefault(n(7)),c=u.__importDefault(n(3)),d=u.__importDefault(n(19)),y=u.__importDefault(n(5)),S=u.__importDefault(n(0)),I=o.default.Action,s=o.default.fromValues({action:I.CLOSE}),b=o.default.fromValues({action:I.DISCONNECT}),T=function(P){u.__extends(C,P);function C(m,R,l,p){var h=P.call(this)||this;return p&&(l.format=void 0,l.heartbeats=!0),h.connectionManager=m,m.registerProposedTransport(h),h.auth=R,h.params=l,h.timeouts=l.options.timeouts,h.format=l.format,h.isConnected=!1,h.isFinished=!1,h.isDisposed=!1,h.maxIdleInterval=null,h.idleTimer=null,h.lastActivity=null,h}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",d.default.closed)},C.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||d.default.disconnected)},C.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||d.default.failed)},C.prototype.finish=function(m,R){var l;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((l=this.idleTimer)!==null&&l!==void 0?l:void 0),this.idleTimer=null,this.emit(m,R),this.dispose())},C.prototype.onProtocolMessage=function(m){switch(c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case I.HEARTBEAT:c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case I.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case I.CLOSED:this.onClose(m);break;case I.DISCONNECTED:this.onDisconnect(m);break;case I.ACK:this.emit("ack",m.msgSerial,m.count);break;case I.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case I.SYNC:if(m.connectionId!==void 0){this.emit("sync",m.connectionId,m);break}this.connectionManager.onChannelMessage(m,this);break;case I.AUTH:this.auth.authorize(function(R){R&&c.default.logAction(c.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+v.inspectError(R))});break;case I.ERROR:if(c.default.logAction(c.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+S.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},C.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var R=m.connectionDetails.maxIdleInterval;R&&(this.maxIdleInterval=R+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(m){var R=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onDisconnect()","err = "+v.inspectError(R)),this.finish("disconnected",R)},C.prototype.onFatalError=function(m){var R=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onFatalError()","err = "+v.inspectError(R)),this.finish("failed",R)},C.prototype.onClose=function(m){var R=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onClose()","err = "+v.inspectError(R)),this.finish("closed",R)},C.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestClose()",""),this.send(s)},C.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(b)},C.prototype.ping=function(m){var R={action:o.default.Action.HEARTBEAT};m&&(R.id=m),this.send(o.default.fromValues(R))},C.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=v.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(m){var R=this;this.idleTimer||(this.idleTimer=setTimeout(function(){R.onIdleTimerExpire()},m))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=v.now()-this.lastActivity,R=this.maxIdleInterval-m;if(R<=0){var l="No activity seen from realtime in "+m+"ms; assuming connection has dropped";c.default.logAction(c.default.LOG_ERROR,"Transport.onIdleTimerExpire()",l),this.disconnect(new y.default(l,80003,408))}else this.setIdleTimer(R+100)},C.tryConnect=function(m,R,l,p,h){var A=new m(R,l,p),f,O=function(x){clearTimeout(f),h({event:this.event,error:x})},w=R.options.timeouts.realtimeRequestTimeout;f=setTimeout(function(){A.off(["preconnect","disconnected","failed"]),A.dispose(),O.call({event:"disconnected"},new y.default("Timeout waiting for transport to indicate itself viable",5e4,500))},w),A.on(["failed","disconnected"],O),A.on("preconnect",function(){c.default.logAction(c.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+A),clearTimeout(f),A.off(["failed","disconnected"],O),h(null,A)}),A.connect()},C}(E.default);r.default=T},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(39),n(23))})(this,function(u){return function(){var o=u,v=o.lib,E=v.Base,c=v.WordArray,d=o.algo,y=d.MD5,S=d.EvpKDF=E.extend({cfg:E.extend({keySize:128/32,hasher:y,iterations:1}),init:function(I){this.cfg=this.cfg.extend(I)},compute:function(I,s){for(var b,T=this.cfg,P=T.hasher.create(),C=c.create(),m=C.words,R=T.keySize,l=T.iterations;m.length<R;){b&&P.update(b),b=P.update(I).finalize(s),P.reset();for(var p=1;p<l;p++)b=P.finalize(b),P.reset();C.concat(b)}return C.sigBytes=R*4,C}});o.EvpKDF=function(I,s,b){return S.create(b).compute(I,s)}}(),u.EvpKDF})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(27))})(this,function(u){u.lib.Cipher||function(o){var v=u,E=v.lib,c=E.Base,d=E.WordArray,y=E.BufferedBlockAlgorithm,S=v.enc,I=S.Utf8,s=S.Base64,b=v.algo,T=b.EvpKDF,P=E.Cipher=y.extend({cfg:c.extend(),createEncryptor:function(M,L){return this.create(this._ENC_XFORM_MODE,M,L)},createDecryptor:function(M,L){return this.create(this._DEC_XFORM_MODE,M,L)},init:function(M,L,k){this.cfg=this.cfg.extend(k),this._xformMode=M,this._key=L,this.reset()},reset:function(){y.reset.call(this),this._doReset()},process:function(M){return this._append(M),this._process()},finalize:function(M){M&&this._append(M);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function M(L){return typeof L=="string"?B:x}return function(L){return{encrypt:function(k,W,K){return M(W).encrypt(L,k,W,K)},decrypt:function(k,W,K){return M(W).decrypt(L,k,W,K)}}}}()}),C=E.StreamCipher=P.extend({_doFinalize:function(){var M=this._process(!0);return M},blockSize:1}),m=v.mode={},R=E.BlockCipherMode=c.extend({createEncryptor:function(M,L){return this.Encryptor.create(M,L)},createDecryptor:function(M,L){return this.Decryptor.create(M,L)},init:function(M,L){this._cipher=M,this._iv=L}}),l=m.CBC=function(){var M=R.extend();M.Encryptor=M.extend({processBlock:function(k,W){var K=this._cipher,$=K.blockSize;L.call(this,k,W,$),K.encryptBlock(k,W),this._prevBlock=k.slice(W,W+$)}}),M.Decryptor=M.extend({processBlock:function(k,W){var K=this._cipher,$=K.blockSize,Y=k.slice(W,W+$);K.decryptBlock(k,W),L.call(this,k,W,$),this._prevBlock=Y}});function L(k,W,K){var $,Y=this._iv;Y?($=Y,this._iv=o):$=this._prevBlock;for(var G=0;G<K;G++)k[W+G]^=$[G]}return M}(),p=v.pad={},h=p.Pkcs7={pad:function(M,L){for(var k=L*4,W=k-M.sigBytes%k,K=W<<24|W<<16|W<<8|W,$=[],Y=0;Y<W;Y+=4)$.push(K);var G=d.create($,W);M.concat(G)},unpad:function(M){var L=M.words[M.sigBytes-1>>>2]&255;M.sigBytes-=L}},A=E.BlockCipher=P.extend({cfg:P.cfg.extend({mode:l,padding:h}),reset:function(){var M;P.reset.call(this);var L=this.cfg,k=L.iv,W=L.mode;this._xformMode==this._ENC_XFORM_MODE?M=W.createEncryptor:(M=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==M?this._mode.init(this,k&&k.words):(this._mode=M.call(W,this,k&&k.words),this._mode.__creator=M)},_doProcessBlock:function(M,L){this._mode.processBlock(M,L)},_doFinalize:function(){var M,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),M=this._process(!0)):(M=this._process(!0),L.unpad(M)),M},blockSize:128/32}),f=E.CipherParams=c.extend({init:function(M){this.mixIn(M)},toString:function(M){return(M||this.formatter).stringify(this)}}),O=v.format={},w=O.OpenSSL={stringify:function(M){var L,k=M.ciphertext,W=M.salt;return W?L=d.create([1398893684,1701076831]).concat(W).concat(k):L=k,L.toString(s)},parse:function(M){var L,k=s.parse(M),W=k.words;return W[0]==1398893684&&W[1]==1701076831&&(L=d.create(W.slice(2,4)),W.splice(0,4),k.sigBytes-=16),f.create({ciphertext:k,salt:L})}},x=E.SerializableCipher=c.extend({cfg:c.extend({format:w}),encrypt:function(M,L,k,W){W=this.cfg.extend(W);var K=M.createEncryptor(k,W),$=K.finalize(L),Y=K.cfg;return f.create({ciphertext:$,key:k,iv:Y.iv,algorithm:M,mode:Y.mode,padding:Y.padding,blockSize:M.blockSize,formatter:W.format})},decrypt:function(M,L,k,W){W=this.cfg.extend(W),L=this._parse(L,W.format);var K=M.createDecryptor(k,W).finalize(L.ciphertext);return K},_parse:function(M,L){return typeof M=="string"?L.parse(M,this):M}}),V=v.kdf={},H=V.OpenSSL={execute:function(M,L,k,W){W||(W=d.random(64/8));var K=T.create({keySize:L+k}).compute(M,W),$=d.create(K.words.slice(L),k*4);return K.sigBytes=L*4,f.create({key:K,iv:$,salt:W})}},B=E.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:H}),encrypt:function(M,L,k,W){W=this.cfg.extend(W);var K=W.kdf.execute(k,M.keySize,M.ivSize);W.iv=K.iv;var $=x.encrypt.call(this,M,L,K.key,W);return $.mixIn(K),$},decrypt:function(M,L,k,W){W=this.cfg.extend(W),L=this._parse(L,W.format);var K=W.kdf.execute(k,M.keySize,M.ivSize,L.salt);W.iv=K.iv;var $=x.decrypt.call(this,M,L,K.key,W);return $}})}()})},function(i,r,n){"use strict";r.__esModule=!0,r.Request=r.createRequest=void 0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(11)),E=u.__importDefault(n(0)),c=u.__importDefault(n(7)),d=u.__importDefault(n(5)),y=u.__importDefault(n(8)),S=u.__importDefault(n(3)),I=u.__importDefault(n(20)),s=o.getGlobalObject(),b=function(){},T=s._ablyjs_jsonp={};T._=function(h){return T["_"+h]||b};var P=1,C="jsonp";function m(h,A,f,O,w,x,V){return x=x||y.default.TIMEOUTS,new l(void 0,h,A,o.copy(f),O,w,x,V)}r.createRequest=m;var R=function(h){u.__extends(A,h);function A(f,O,w){var x=h.call(this,f,O,w)||this;return x.shortName=C,w.stream=!1,x}return A.isAvailable=function(){return E.default.Config.jsonpSupported&&E.default.Config.allowComet},A.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},A.prototype.createRequest=function(f,O,w,x,V,H,B){return H=(this===null||this===void 0?void 0:this.timeouts)||H||y.default.TIMEOUTS,m(f,O,w,x,V,H,B)},A}(v.default),l=function(h){u.__extends(A,h);function A(f,O,w,x,V,H,B,M){var L=h.call(this)||this;return f===void 0&&(f=P++),L.id=f,L.uri=O,L.params=x||{},L.params.rnd=o.cheapRandStr(),w&&(w["X-Ably-Version"]&&(L.params.v=w["X-Ably-Version"]),w["X-Ably-Lib"]&&(L.params.lib=w["X-Ably-Lib"])),L.body=V,L.method=M,L.requestMode=H,L.timeouts=B,L.requestComplete=!1,L}return A.prototype.exec=function(){var f=this,O=this.id,w=this.body,x=this.method,V=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+O+")",H.envelope="jsonp",w&&(H.body=w),x&&x!=="get"&&(H.method=x);var B=this.script=document.createElement("script"),M=V+o.toQueryString(H);B.src=M,B.src.split("/").slice(-1)[0]!==M.split("/").slice(-1)[0]&&S.default.logAction(S.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),B.async=!0,B.type="text/javascript",B.charset="UTF-8",B.onerror=function(W){f.complete(new d.default("JSONP script error (event: "+E.default.Config.inspect(W)+")",null,400))},T["_"+O]=function(W){if(W.statusCode){var K=W.response;if(W.statusCode==204)f.complete(null,null,null,W.statusCode);else if(!K)f.complete(new d.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||o.isArray(K))f.complete(null,K,W.headers,W.statusCode);else{var $=K.error||new d.default("Error response received from server",null,W.statusCode);f.complete($)}}else f.complete(null,W)};var L=this.requestMode==I.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),L);var k=document.getElementsByTagName("head")[0];k.insertBefore(B,k.firstChild)},A.prototype.complete=function(f,O,w,x){if(w=w||{},!this.requestComplete){this.requestComplete=!0;var V=void 0;O&&(V=typeof O=="string"?"text/plain":"application/json",w["content-type"]=V,this.emit("data",O)),this.emit("complete",f,O,w,!0,x),this.dispose()}},A.prototype.abort=function(){this.dispose()},A.prototype.dispose=function(){var f=this.timer;f&&(clearTimeout(f),this.timer=null);var O=this.script;O.parentNode&&O.parentNode.removeChild(O),delete T[this.id],this.emit("disposed")},A}(c.default);r.Request=l;function p(h){return s.JSONPTransport=R,R.isAvailable()&&(h.supportedTransports[C]=R),R}r.default=p},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(3)),E=u.__importDefault(n(8)),c=u.__importDefault(n(16)),d=u.__importDefault(n(45)),y=u.__importDefault(n(18)),S=u.__importDefault(n(33)),I=u.__importDefault(n(5)),s=u.__importDefault(n(48)),b=u.__importDefault(n(17)),T=u.__importDefault(n(0)),P=function(){},C=function(){function R(l){if(!l){var p="no options provided";throw v.default.logAction(v.default.LOG_ERROR,"Rest()",p),new Error(p)}var h=E.default.objectifyOptions(l);h.log&&v.default.setLog(h.log.level,h.log.handler),v.default.logAction(v.default.LOG_MICRO,"Rest()","initialized with clientOptions "+T.default.Config.inspect(l));var A=this.options=E.default.normaliseOptions(h);if(A.key){var f=A.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!f){var p="invalid key parameter";throw v.default.logAction(v.default.LOG_ERROR,"Rest()",p),new I.default(p,40400,404)}A.keyName=f[1],A.keySecret=f[2]}if("clientId"in A)if(typeof A.clientId=="string"||A.clientId===null){if(A.clientId==="*")throw new I.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new I.default("clientId must be either a string or null",40012,400);v.default.logAction(v.default.LOG_MINOR,"Rest()","started; version = "+E.default.version),this.baseUri=this.authority=function(O){return E.default.getHttpScheme(A)+O+":"+E.default.getPort(A,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new T.default.Http,this.auth=new c.default(this,A),this.channels=new m(this),this.push=new d.default(this)}return R.prototype.stats=function(l,p){if(p===void 0)if(typeof l=="function")p=l,l=null;else{if(this.options.promises)return o.promisify(this,"stats",arguments);p=P}var h=o.defaultGetHeaders(),A=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=this.http.supportsLinkHeaders?void 0:A;this.options.headers&&o.mixin(h,this.options.headers),new y.default(this,"/stats",h,f,function(O,w,x){for(var V=x?O:JSON.parse(O),H=0;H<V.length;H++)V[H]=s.default.fromValues(V[H]);return V}).get(l,p)},R.prototype.time=function(l,p){var h=this;if(p===void 0){if(typeof l=="function")p=l,l=null;else if(this.options.promises)return o.promisify(this,"time",arguments)}var A=p||P,f=o.defaultGetHeaders();this.options.headers&&o.mixin(f,this.options.headers);var O=function(w){return h.authority(w)+"/time"};this.http.do(b.default.Get,this,O,f,null,l,function(w,x,V,H){if(w){A(w);return}H||(x=JSON.parse(x));var B=x[0];if(!B){A(new I.default("Internal error (unexpected result type from GET /time)",5e4,500));return}h.serverTimeOffset=B-o.now(),A(null,B)})},R.prototype.request=function(l,p,h,A,f,O){var w=this.options.useBinaryProtocol,x=w?T.default.Config.msgpack.encode:JSON.stringify,V=w?T.default.Config.msgpack.decode:JSON.parse,H=w?o.Format.msgpack:o.Format.json,B=this.http.supportsLinkHeaders?void 0:H;h=h||{};var M=l.toLowerCase(),L=M=="get"?o.defaultGetHeaders(H):o.defaultPostHeaders(H);if(O===void 0){if(this.options.promises)return o.promisify(this,"request",arguments);O=P}typeof A!="string"&&(A=x(A)),this.options.headers&&o.mixin(L,this.options.headers),f&&o.mixin(L,f);var k=new y.default(this,p,L,B,function(W,K,$){return o.ensureArray($?W:V(W))},!0);if(!o.arrIn(T.default.Http.methods,M))throw new I.default("Unsupported method "+M,40500,405);o.arrIn(T.default.Http.methodsWithBody,M)?k[M](h,A,O):k[M](h,O)},R.prototype.setLog=function(l){v.default.setLog(l.level,l.handler)},R.Promise=function(l){return l=E.default.objectifyOptions(l),l.promises=!0,new R(l)},R.Callbacks=R,R.Platform=T.default,R}(),m=function(){function R(l){this.rest=l,this.all={}}return R.prototype.get=function(l,p){l=String(l);var h=this.all[l];return h?p&&h.setOptions(p):this.all[l]=h=new S.default(this.rest,l,p),h},R.prototype.release=function(l){delete this.all[String(l)]},R}();r.default=C},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(o){var v=u,E=v.lib,c=E.WordArray,d=E.Hasher,y=v.algo,S=[],I=[];(function(){function T(R){for(var l=o.sqrt(R),p=2;p<=l;p++)if(!(R%p))return!1;return!0}function P(R){return(R-(R|0))*4294967296|0}for(var C=2,m=0;m<64;)T(C)&&(m<8&&(S[m]=P(o.pow(C,1/2))),I[m]=P(o.pow(C,1/3)),m++),C++})();var s=[],b=y.SHA256=d.extend({_doReset:function(){this._hash=new c.init(S.slice(0))},_doProcessBlock:function(T,P){for(var C=this._hash.words,m=C[0],R=C[1],l=C[2],p=C[3],h=C[4],A=C[5],f=C[6],O=C[7],w=0;w<64;w++){if(w<16)s[w]=T[P+w]|0;else{var x=s[w-15],V=(x<<25|x>>>7)^(x<<14|x>>>18)^x>>>3,H=s[w-2],B=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;s[w]=V+s[w-7]+B+s[w-16]}var M=h&A^~h&f,L=m&R^m&l^R&l,k=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),W=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),K=O+W+M+I[w]+s[w],$=k+L;O=f,f=A,A=h,h=p+K|0,p=l,l=R,R=m,m=K+$|0}C[0]=C[0]+m|0,C[1]=C[1]+R|0,C[2]=C[2]+l|0,C[3]=C[3]+p|0,C[4]=C[4]+h|0,C[5]=C[5]+A|0,C[6]=C[6]+f|0,C[7]=C[7]+O|0},_doFinalize:function(){var T=this._data,P=T.words,C=this._nDataBytes*8,m=T.sigBytes*8;return P[m>>>5]|=128<<24-m%32,P[(m+64>>>9<<4)+14]=o.floor(C/4294967296),P[(m+64>>>9<<4)+15]=C,T.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var T=d.clone.call(this);return T._hash=this._hash.clone(),T}});v.SHA256=d._createHelper(b),v.HmacSHA256=d._createHmacHelper(b)}(Math),u.SHA256})},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return u.enc.Utf8})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(7)),E=u.__importDefault(n(3)),c=u.__importDefault(n(34)),d=u.__importDefault(n(9)),y=u.__importDefault(n(5)),S=u.__importDefault(n(18)),I=u.__importDefault(n(24)),s=u.__importDefault(n(0));function b(){}var T=9;function P(R){return o.arrEvery(R,function(l){return!l.id})}function C(R){var l=R||{};if(l.cipher){if(!s.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var p=s.default.Crypto.getCipher(l.cipher);l.cipher=p.cipherParams,l.channelCipher=p.cipher}else"cipher"in l&&(l.cipher=void 0,l.channelCipher=null);return l}var m=function(R){u.__extends(l,R);function l(p,h,A){var f=R.call(this)||this;return E.default.logAction(E.default.LOG_MINOR,"Channel()","started; name = "+h),f.rest=p,f.name=h,f.basePath="/channels/"+encodeURIComponent(h),f.presence=new c.default(f),f.channelOptions=C(A),f}return l.prototype.setOptions=function(p){this.channelOptions=C(p)},l.prototype.history=function(p,h){if(E.default.logAction(E.default.LOG_MICRO,"Channel.history()","channel = "+this.name),h===void 0)if(typeof p=="function")h=p,p=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);h=b}this._history(p,h)},l.prototype._history=function(p,h){var A=this.rest,f=A.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,O=this.rest.http.supportsLinkHeaders?void 0:f,w=o.defaultGetHeaders(f);A.options.headers&&o.mixin(w,A.options.headers);var x=this.channelOptions;new S.default(A,this.basePath+"/messages",w,O,function(V,H,B){return d.default.fromResponseBody(V,x,B?void 0:f)}).get(p,h)},l.prototype.publish=function(){var p=this,h=arguments.length,A=arguments[0],f=arguments[1],O=arguments[h-1],w,x;if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);O=b}if(typeof A=="string"||A===null)w=[d.default.fromValues({name:A,data:f})],x=arguments[2];else if(o.isObject(A))w=[d.default.fromValues(A)],x=arguments[1];else if(o.isArray(A))w=d.default.fromValuesArray(A),x=arguments[1];else throw new y.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof x!="object"||!x)&&(x={});var V=this.rest,H=V.options,B=H.useBinaryProtocol?o.Format.msgpack:o.Format.json,M=V.options.idempotentRestPublishing,L=o.defaultPostHeaders(B);if(H.headers&&o.mixin(L,H.headers),M&&P(w)){var k=o.randomString(T);o.arrForEach(w,function(W,K){W.id=k+":"+K.toString()})}d.default.encodeArray(w,this.channelOptions,function(W){if(W){O(W);return}var K=d.default.getMessagesSize(w),$=H.maxMessageSize;if(K>$){O(new y.default("Maximum size of messages that can be published at once exceeded ( was "+K+" bytes; limit is "+$+" bytes)",40009,400));return}p._publish(d.default.serialize(w,B),L,x,O)})},l.prototype._publish=function(p,h,A,f){I.default.post(this.rest,this.basePath+"/messages",p,h,A,null,f)},l.prototype.status=function(p){if(typeof p!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var h=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,A=o.defaultPostHeaders(h);I.default.get(this.rest,this.basePath,A,{},h,p||b)},l}(v.default);r.default=m},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(7)),E=u.__importDefault(n(3)),c=u.__importDefault(n(18)),d=u.__importDefault(n(14));function y(){}var S=function(I){u.__extends(s,I);function s(b){var T=I.call(this)||this;return T.channel=b,T.basePath=b.basePath+"/presence",T}return s.prototype.get=function(b,T){if(E.default.logAction(E.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),T===void 0)if(typeof b=="function")T=b,b=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);T=y}var P=this.channel.rest,C=P.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=o.defaultGetHeaders(C);P.options.headers&&o.mixin(R,P.options.headers);var l=this.channel.channelOptions;new c.default(P,this.basePath,R,m,function(p,h,A){return d.default.fromResponseBody(p,l,A?void 0:C)}).get(b,T)},s.prototype.history=function(b,T){E.default.logAction(E.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(b,T)},s.prototype._history=function(b,T){if(T===void 0)if(typeof b=="function")T=b,b=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",arguments);T=y}var P=this.channel.rest,C=P.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=o.defaultGetHeaders(C);P.options.headers&&o.mixin(R,P.options.headers);var l=this.channel.channelOptions;new c.default(P,this.basePath+"/history",R,m,function(p,h,A){return d.default.fromResponseBody(p,l,A?void 0:C)}).get(b,T)},s}(v.default);r.default=S},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(7)),v=u.__importDefault(n(3)),E=function(c){u.__extends(d,c);function d(){var y=c.call(this)||this;return y.messages=[],y}return d.prototype.count=function(){return this.messages.length},d.prototype.push=function(y){this.messages.push(y)},d.prototype.shift=function(){return this.messages.shift()},d.prototype.last=function(){return this.messages[this.messages.length-1]},d.prototype.copyAll=function(){return this.messages.slice()},d.prototype.append=function(y){this.messages.push.apply(this.messages,y)},d.prototype.prepend=function(y){this.messages.unshift.apply(this.messages,y)},d.prototype.completeMessages=function(y,S,I){v.default.logAction(v.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+y+"; count = "+S),I=I||null;var s=this.messages;if(s.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var b=s[0];if(b){var T=b.message.msgSerial,P=y+S;if(P>T)for(var C=s.splice(0,P-T),m=0,R=C;m<R.length;m++){var l=R[m];l.callback(I)}s.length==0&&this.emit("idle")}},d.prototype.completeAllMessages=function(y){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,y)},d.prototype.clear=function(){v.default.logAction(v.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},d}(o.default);r.default=E},function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(v,E,c,d){this.previous=v,this.current=E,c&&(this.retryIn=c),d&&(this.reason=d)}return o}();r.default=u},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(10)),v=u.__importDefault(n(7)),E=u.__importStar(n(2)),c=u.__importDefault(n(33)),d=u.__importDefault(n(3)),y=u.__importDefault(n(54)),S=u.__importDefault(n(9)),I=u.__importDefault(n(38)),s=u.__importDefault(n(5)),b=u.__importDefault(n(14)),T=u.__importDefault(n(19)),P=o.default.Action,C=function(){},m="statechange",R="sync";function l(h){if(h&&"params"in h&&!E.isObject(h.params))return new s.default("options.params must be an object",4e4,400);if(h&&"modes"in h){if(!E.isArray(h.modes))return new s.default("options.modes must be an array",4e4,400);for(var A=0;A<h.modes.length;A++){var f=h.modes[A];if(!f||typeof f!="string"||!E.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(f)))return new s.default("Invalid channel mode: "+f,4e4,400)}}}var p=function(h){u.__extends(A,h);function A(f,O,w){var x=h.call(this,f,O,w)||this;return x.retryCount=0,x.history=function(V,H){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof V=="function")H=V,V=null;else{if(this.rest.options.promises)return E.promisify(this,"history",arguments);H=C}if(V&&V.untilAttach){if(this.state!=="attached"){H(new s.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new s.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete V.untilAttach,V.from_serial=this.properties.attachSerial}c.default.prototype._history.call(this,V,H)},x.whenState=function(V,H){return v.default.prototype.whenState.call(x,V,x.state,H)},d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel()","started; name = "+O),x.realtime=f,x.presence=new y.default(x),x.connectionManager=f.connection.connectionManager,x.state="initialized",x.subscriptions=new v.default,x.syncChannelSerial=void 0,x.properties={attachSerial:void 0},x.setOptions(w),x.errorReason=null,x._requestedFlags=null,x._mode=null,x._attachedMsgIndicator=!1,x._attachResume=!1,x._decodingContext={channelOptions:x.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},x._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},x._allChannelChanges=new v.default,x}return A.invalidStateError=function(f){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+f}},A.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},A.prototype.setOptions=function(f,O){if(!O&&this.rest.options.promises)return E.promisify(this,"setOptions",arguments);var w=O||function(V){V&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+V.toString())},x=l(f);if(x){w(x);return}c.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(function(V){switch(this.event){case"update":case"attached":w==null||w(null);return;default:w==null||w(V.reason);return}})):w()},A.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&(f.params||f.modes)},A.prototype.publish=function(){for(var f=this,O=[],w=0;w<arguments.length;w++)O[w]=arguments[w];var x=O[0],V=O.length,H=O[V-1];if(typeof H!="function"){if(this.realtime.options.promises)return E.promisify(this,"publish",arguments);H=C,++V}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(V==2)if(E.isObject(x))x=[S.default.fromValues(x)];else if(E.isArray(x))x=S.default.fromValuesArray(x);else throw new s.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else x=[S.default.fromValues({name:O[0],data:O[1]})];var B=this.realtime.options.maxMessageSize;S.default.encodeArray(x,this.channelOptions,function(M){if(M){H(M);return}var L=S.default.getMessagesSize(x);if(L>B){H(new s.default("Maximum size of messages that can be published at once exceeded ( was "+L+" bytes; limit is "+B+" bytes)",40009,400));return}f.__publish(x,H)})},A.prototype.__publish=function(f,O){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var w=this.state;switch(w){case"failed":case"suspended":O(s.default.fromValues(A.invalidStateError(w)));break;default:{d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+w);var x=new o.default;x.action=P.MESSAGE,x.channel=this.name,x.messages=f,this.sendMessage(x,O);break}}},A.prototype.onEvent=function(f){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var O=this.subscriptions,w=0;w<f.length;w++){var x=f[w];O.emit(x.name,x)}},A.prototype.attach=function(f,O){var w;if(typeof f=="function"?(O=f,w=null):w=f,!O){if(this.realtime.options.promises)return E.promisify(this,"attach",arguments);O=function(x){x&&d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+x.toString())}}if(w)d.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=w;else if(this.state==="attached"){O();return}this._attach(!1,null,O)},A.prototype._attach=function(f,O,w){w||(w=function(V){V&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+V.toString())});var x=this.connectionManager;if(!x.activeState()){w(x.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",O),this.once(function(V){switch(this.event){case"attached":w==null||w();break;case"detached":case"suspended":case"failed":w==null||w(V.reason||x.getError()||new s.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":w==null||w(new s.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},A.prototype.attachImpl=function(){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(m,!0);var f=o.default.fromValues({action:P.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(E.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,C)},A.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return E.promisify(this,"detach",arguments);f=C}var O=this.connectionManager;if(!O.activeState()){f(O.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new s.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(w){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(w.reason||O.getError()||new s.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new s.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},A.prototype.detachImpl=function(f){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(m,!0);var O=o.default.fromValues({action:P.DETACH,channel:this.name});this.sendMessage(O,f||C)},A.prototype.subscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var w=A.processListenerArgs(f),x=w[0],V=w[1],H=w[2];if(!H&&this.realtime.options.promises)return E.promisify(this,"subscribe",[x,V]);if(this.state==="failed"){H==null||H(s.default.fromValues(A.invalidStateError("failed")));return}return x&&typeof x=="object"&&!Array.isArray(x)?this._subscribeFilter(x,V):this.subscriptions.on(x,V),this.attach(H||C)},A.prototype._subscribeFilter=function(f,O){var w=function(x){var V,H,B,M,L,k,W={name:x.name,refTimeserial:(H=(V=x.extras)===null||V===void 0?void 0:V.ref)===null||H===void 0?void 0:H.timeserial,refType:(M=(B=x.extras)===null||B===void 0?void 0:B.ref)===null||M===void 0?void 0:M.type,isRef:!!(!((k=(L=x.extras)===null||L===void 0?void 0:L.ref)===null||k===void 0)&&k.timeserial),clientId:x.clientId};Object.entries(f).find(function(K){var $=K[0],Y=K[1];return Y!==void 0?W[$]!==Y:!1})||O(x)};this._addFilteredSubscription(f,O,w),this.subscriptions.on(w)},A.prototype._addFilteredSubscription=function(f,O,w){var x;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(O)){var V=this.filteredSubscriptions.get(O);V.set(f,((x=V==null?void 0:V.get(f))===null||x===void 0?void 0:x.concat(w))||[w])}else this.filteredSubscriptions.set(O,new Map([[f,[w]]]))},A.prototype._getAndDeleteFilteredSubscriptions=function(f,O){var w=this;if(!this.filteredSubscriptions)return[];if(!O&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(B){var M,L=B[0],k=B[1],W=k.get(f);return k.delete(f),k.size===0&&((M=w.filteredSubscriptions)===null||M===void 0||M.delete(L)),W}).reduce(function(B,M){var L;return M?(L=B).concat.apply(L,M):B},[]);if(!O||!this.filteredSubscriptions.has(O))return[];var x=this.filteredSubscriptions.get(O);if(!f){var V=Array.from(x.values()).reduce(function(B,M){return B.concat.apply(B,M)},[]);return this.filteredSubscriptions.delete(O),V}var H=x.get(f);return x.delete(f),H||[]},A.prototype.unsubscribe=function(){for(var f=this,O,w=[],x=0;x<arguments.length;x++)w[x]=arguments[x];var V=A.processListenerArgs(w),H=V[0],B=V[1];if(typeof H=="object"&&!B||((O=this.filteredSubscriptions)===null||O===void 0?void 0:O.has(B))){this._getAndDeleteFilteredSubscriptions(H,B).forEach(function(M){return f.subscriptions.off(M)});return}this.subscriptions.off(H,B)},A.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new s.default("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var O=o.default.fromValues({action:P.SYNC,channel:this.name});this.syncChannelSerial&&(O.channelSerial=this.syncChannelSerial),f.send(O)},A.prototype.sendMessage=function(f,O){this.connectionManager.send(f,this.realtime.options.queueMessages,O)},A.prototype.sendPresence=function(f,O){var w=o.default.fromValues({action:P.PRESENCE,channel:this.name,presence:E.isArray(f)?b.default.fromValuesArray(f):[b.default.fromValues(f)]});this.sendMessage(w,O)},A.prototype.onMessage=function(f){var O,w=!1;switch(f.action){case P.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var x=f.decodeModesFromFlags();this.modes=x&&E.allToLowerCase(x)||void 0;var V=f.hasFlag("RESUMED"),H=f.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(m,!1),V||this.presence.onAttached(H);var B=new I.default(this.state,this.state,V,f.error);this._allChannelChanges.emit("update",B),(!V||this.channelOptions.updateOnAttached)&&this.emit("update",B)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,V,H);break}case P.DETACHED:{var M=f.error?s.default.fromValues(f.error):new s.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",M):this.state==="attaching"?this.notifyState("suspended",M):this.requestState("attaching",M);break}case P.SYNC:if(w=!0,O=this.syncChannelSerial=f.channelSerial,!f.presence)break;case P.PRESENCE:{for(var L=f.presence,k=f.id,W=f.connectionId,K=f.timestamp,$=this.channelOptions,Y=void 0,G=0;G<L.length;G++)try{Y=L[G],b.default.decode(Y,$),Y.connectionId||(Y.connectionId=W),Y.timestamp||(Y.timestamp=K),Y.id||(Y.id=k+":"+G)}catch(ce){d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",ce.toString())}this.presence.setPresence(L,w,O);break}case P.MESSAGE:{if(this.state!=="attached"){d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var D=f.messages,F=D[0],j=D[D.length-1],k=f.id,W=f.connectionId,K=f.timestamp;if(F.extras&&F.extras.delta&&F.extras.delta.from!==this._lastPayload.messageId){var Q='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q),this._startDecodeFailureRecovery(new s.default(Q,40018,400));break}for(var G=0;G<D.length;G++){var Q=D[G];try{S.default.decode(Q,this._decodingContext)}catch(fe){switch(d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",fe.toString()),fe.code){case 40018:this._startDecodeFailureRecovery(fe);return;case 40019:case 40021:this.notifyState("failed",fe);return}}Q.connectionId||(Q.connectionId=W),Q.timestamp||(Q.timestamp=K),Q.id||(Q.id=k+":"+G)}this._lastPayload.messageId=j.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(D);break}case P.ERROR:{var ee=f.error;ee&&ee.code==80016?this.checkPendingState():this.notifyState("failed",s.default.fromValues(ee));break}default:d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(T.default.unknownChannelErr)}},A.prototype._startDecodeFailureRecovery=function(f){var O=this;this._lastPayload.decodeFailureRecoveryInProgress||(d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){O._lastPayload.decodeFailureRecoveryInProgress=!1}))},A.prototype.onAttached=function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},A.prototype.notifyState=function(f,O,w,x){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),f!==this.state){this.presence.actOnChannelState(f,x,O),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),O&&(this.errorReason=O);var V=new I.default(this.state,f,w,O),H=f==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(H,'Channel state for channel "'+this.name+'"',f+(O?"; reason: "+O:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"?(this.onAttached(),this.setInProgress(R,x),this.setInProgress(m,!1)):(f==="detached"||f==="failed"||f==="suspended")&&(this.setInProgress(m,!1),this.setInProgress(R,!1)),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,V),this.emit(f,V)}},A.prototype.requestState=function(f,O){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,O),this.checkPendingState()},A.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},A.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new s.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new s.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},A.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},A.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},A.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var O=this.realtime.options.timeouts.channelRetryTimeout*E.getJitterCoefficient()*E.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},O)}},A.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},A.prototype.setInProgress=function(f,O){this.rest.channels.setInProgress(this,f,O)},A.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new s.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},A.progressOps={statechange:m,sync:R},A}(c.default);r.default=p},function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(v,E,c,d){this.previous=v,this.current=E,E==="attached"&&(this.resumed=c),d&&(this.reason=d)}return o}();r.default=u},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,v=o.lib,E=v.WordArray,c=v.Hasher,d=o.algo,y=[],S=d.SHA1=c.extend({_doReset:function(){this._hash=new E.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,s){for(var b=this._hash.words,T=b[0],P=b[1],C=b[2],m=b[3],R=b[4],l=0;l<80;l++){if(l<16)y[l]=I[s+l]|0;else{var p=y[l-3]^y[l-8]^y[l-14]^y[l-16];y[l]=p<<1|p>>>31}var h=(T<<5|T>>>27)+R+y[l];l<20?h+=(P&C|~P&m)+1518500249:l<40?h+=(P^C^m)+1859775393:l<60?h+=(P&C|P&m|C&m)-1894007588:h+=(P^C^m)-899497514,R=m,m=C,C=P<<30|P>>>2,P=T,T=h}b[0]=b[0]+T|0,b[1]=b[1]+P|0,b[2]=b[2]+C|0,b[3]=b[3]+m|0,b[4]=b[4]+R|0},_doFinalize:function(){var I=this._data,s=I.words,b=this._nDataBytes*8,T=I.sigBytes*8;return s[T>>>5]|=128<<24-T%32,s[(T+64>>>9<<4)+14]=Math.floor(b/4294967296),s[(T+64>>>9<<4)+15]=b,I.sigBytes=s.length*4,this._process(),this._hash},clone:function(){var I=c.clone.call(this);return I._hash=this._hash.clone(),I}});o.SHA1=c._createHelper(S),o.HmacSHA1=c._createHmacHelper(S)}(),u.SHA1})},function(i,r,n){"use strict";r.__esModule=!0;function u(l){if(l===void 0)return"undefined";var p,h;if(l instanceof ArrayBuffer?(h="ArrayBuffer",p=new DataView(l)):l instanceof DataView&&(h="DataView",p=l),!p)return JSON.stringify(l);for(var A=[],f=0;f<l.byteLength;f++){if(f>20){A.push("...");break}var O=p.getUint8(f).toString(16);O.length===1&&(O="0"+O),A.push(O)}return"<"+h+" "+A.join(" ")+">"}function o(l,p,h){for(var A=0,f=h.length;A<f;A++){var O=h.charCodeAt(A);if(O<128){l.setUint8(p++,O>>>0&127|0);continue}if(O<2048){l.setUint8(p++,O>>>6&31|192),l.setUint8(p++,O>>>0&63|128);continue}if(O<65536){l.setUint8(p++,O>>>12&15|224),l.setUint8(p++,O>>>6&63|128),l.setUint8(p++,O>>>0&63|128);continue}if(O<1114112){l.setUint8(p++,O>>>18&7|240),l.setUint8(p++,O>>>12&63|128),l.setUint8(p++,O>>>6&63|128),l.setUint8(p++,O>>>0&63|128);continue}throw new Error("bad codepoint "+O)}}function v(l,p,h){for(var A="",f=p,O=p+h;f<O;f++){var w=l.getUint8(f);if((w&128)===0){A+=String.fromCharCode(w);continue}if((w&224)===192){A+=String.fromCharCode((w&15)<<6|l.getUint8(++f)&63);continue}if((w&240)===224){A+=String.fromCharCode((w&15)<<12|(l.getUint8(++f)&63)<<6|(l.getUint8(++f)&63)<<0);continue}if((w&248)===240){A+=String.fromCharCode((w&7)<<18|(l.getUint8(++f)&63)<<12|(l.getUint8(++f)&63)<<6|(l.getUint8(++f)&63)<<0);continue}throw new Error("Invalid byte "+w.toString(16))}return A}function E(l){for(var p=0,h=0,A=l.length;h<A;h++){var f=l.charCodeAt(h);if(f<128){p+=1;continue}if(f<2048){p+=2;continue}if(f<65536){p+=3;continue}if(f<1114112){p+=4;continue}throw new Error("bad codepoint "+f)}return p}function c(l,p){var h=R(l,p);if(h!==0){var A=new ArrayBuffer(h),f=new DataView(A);return m(l,f,0,p),A}}var d=(1<<16)*(1<<16),y=1/d;function S(l,p){return p=p||0,l.getInt32(p)*d+l.getUint32(p+4)}function I(l,p){return p=p||0,l.getUint32(p)*d+l.getUint32(p+4)}function s(l,p,h){h<9223372036854776e3?(l.setInt32(p,Math.floor(h*y)),l.setInt32(p+4,h&-1)):(l.setUint32(p,2147483647),l.setUint32(p+4,2147483647))}function b(l,p,h){h<18446744073709552e3?(l.setUint32(p,Math.floor(h*y)),l.setInt32(p+4,h&-1)):(l.setUint32(p,4294967295),l.setUint32(p+4,4294967295))}var T=function(){function l(p,h){var A=this;this.map=function(f){for(var O={},w=0;w<f;w++){var x=A.parse();O[x]=A.parse()}return O},this.bin=function(f){var O=new ArrayBuffer(f);return new Uint8Array(O).set(new Uint8Array(A.view.buffer,A.offset,f),0),A.offset+=f,O},this.buf=this.bin,this.str=function(f){var O=v(A.view,A.offset,f);return A.offset+=f,O},this.array=function(f){for(var O=new Array(f),w=0;w<f;w++)O[w]=A.parse();return O},this.ext=function(f){return A.offset+=f,{type:A.view.getInt8(A.offset),data:A.buf(f)}},this.parse=function(){var f=A.view.getUint8(A.offset),O,w;if((f&128)===0)return A.offset++,f;if((f&240)===128)return w=f&15,A.offset++,A.map(w);if((f&240)===144)return w=f&15,A.offset++,A.array(w);if((f&224)===160)return w=f&31,A.offset++,A.str(w);if((f&224)===224)return O=A.view.getInt8(A.offset),A.offset++,O;switch(f){case 192:return A.offset++,null;case 193:A.offset++;return;case 194:return A.offset++,!1;case 195:return A.offset++,!0;case 196:return w=A.view.getUint8(A.offset+1),A.offset+=2,A.bin(w);case 197:return w=A.view.getUint16(A.offset+1),A.offset+=3,A.bin(w);case 198:return w=A.view.getUint32(A.offset+1),A.offset+=5,A.bin(w);case 199:return w=A.view.getUint8(A.offset+1),A.offset+=2,A.ext(w);case 200:return w=A.view.getUint16(A.offset+1),A.offset+=3,A.ext(w);case 201:return w=A.view.getUint32(A.offset+1),A.offset+=5,A.ext(w);case 202:return O=A.view.getFloat32(A.offset+1),A.offset+=5,O;case 203:return O=A.view.getFloat64(A.offset+1),A.offset+=9,O;case 204:return O=A.view.getUint8(A.offset+1),A.offset+=2,O;case 205:return O=A.view.getUint16(A.offset+1),A.offset+=3,O;case 206:return O=A.view.getUint32(A.offset+1),A.offset+=5,O;case 207:return O=I(A.view,A.offset+1),A.offset+=9,O;case 208:return O=A.view.getInt8(A.offset+1),A.offset+=2,O;case 209:return O=A.view.getInt16(A.offset+1),A.offset+=3,O;case 210:return O=A.view.getInt32(A.offset+1),A.offset+=5,O;case 211:return O=S(A.view,A.offset+1),A.offset+=9,O;case 212:return w=1,A.offset++,A.ext(w);case 213:return w=2,A.offset++,A.ext(w);case 214:return w=4,A.offset++,A.ext(w);case 215:return w=8,A.offset++,A.ext(w);case 216:return w=16,A.offset++,A.ext(w);case 217:return w=A.view.getUint8(A.offset+1),A.offset+=2,A.str(w);case 218:return w=A.view.getUint16(A.offset+1),A.offset+=3,A.str(w);case 219:return w=A.view.getUint32(A.offset+1),A.offset+=5,A.str(w);case 220:return w=A.view.getUint16(A.offset+1),A.offset+=3,A.array(w);case 221:return w=A.view.getUint32(A.offset+1),A.offset+=5,A.array(w);case 222:return w=A.view.getUint16(A.offset+1),A.offset+=3,A.map(w);case 223:return w=A.view.getUint32(A.offset+1),A.offset+=5,A.map(w)}throw new Error("Unknown type 0x"+f.toString(16))},this.offset=h||0,this.view=p}return l}();function P(l){var p=new DataView(l),h=new T(p),A=h.parse();if(h.offset!==l.byteLength)throw new Error(l.byteLength-h.offset+" trailing bytes");return A}function C(l,p){return Object.keys(l).filter(function(h){var A=l[h],f=typeof A;return(!p||A!=null)&&(f!=="function"||!!A.toJSON)})}function m(l,p,h,A){var f=typeof l;if(typeof l=="string"){var O=E(l);if(O<32)return p.setUint8(h,O|160),o(p,h+1,l),1+O;if(O<256)return p.setUint8(h,217),p.setUint8(h+1,O),o(p,h+2,l),2+O;if(O<65536)return p.setUint8(h,218),p.setUint16(h+1,O),o(p,h+3,l),3+O;if(O<4294967296)return p.setUint8(h,219),p.setUint32(h+1,O),o(p,h+5,l),5+O}if(ArrayBuffer.isView&&ArrayBuffer.isView(l)&&(l=l.buffer),l instanceof ArrayBuffer){var w=l.byteLength;if(w<256)return p.setUint8(h,196),p.setUint8(h+1,w),new Uint8Array(p.buffer).set(new Uint8Array(l),h+2),2+w;if(w<65536)return p.setUint8(h,197),p.setUint16(h+1,w),new Uint8Array(p.buffer).set(new Uint8Array(l),h+3),3+w;if(w<4294967296)return p.setUint8(h,198),p.setUint32(h+1,w),new Uint8Array(p.buffer).set(new Uint8Array(l),h+5),5+w}if(typeof l=="number"){if(Math.floor(l)!==l)return p.setUint8(h,203),p.setFloat64(h+1,l),9;if(l>=0){if(l<128)return p.setUint8(h,l),1;if(l<256)return p.setUint8(h,204),p.setUint8(h+1,l),2;if(l<65536)return p.setUint8(h,205),p.setUint16(h+1,l),3;if(l<4294967296)return p.setUint8(h,206),p.setUint32(h+1,l),5;if(l<18446744073709552e3)return p.setUint8(h,207),b(p,h+1,l),9;throw new Error("Number too big 0x"+l.toString(16))}if(l>=-32)return p.setInt8(h,l),1;if(l>=-128)return p.setUint8(h,208),p.setInt8(h+1,l),2;if(l>=-32768)return p.setUint8(h,209),p.setInt16(h+1,l),3;if(l>=-2147483648)return p.setUint8(h,210),p.setInt32(h+1,l),5;if(l>=-9223372036854776e3)return p.setUint8(h,211),s(p,h+1,l),9;throw new Error("Number too small -0x"+(-l).toString(16).substr(1))}if(f==="undefined")return A?0:(p.setUint8(h,212),p.setUint8(h+1,0),p.setUint8(h+2,0),3);if(l===null)return A?0:(p.setUint8(h,192),1);if(f==="boolean")return p.setUint8(h,l?195:194),1;if(typeof l.toJSON=="function")return m(l.toJSON(),p,h,A);if(f==="object"){var x,V=0,H=void 0,B=Array.isArray(l);if(B?x=l.length:(H=C(l,A),x=H.length),x<16?(p.setUint8(h,x|(B?144:128)),V=1):x<65536?(p.setUint8(h,B?220:222),p.setUint16(h+1,x),V=3):x<4294967296&&(p.setUint8(h,B?221:223),p.setUint32(h+1,x),V=5),B)for(var M=0;M<x;M++)V+=m(l[M],p,h+V,A);else if(H)for(var M=0;M<x;M++){var L=H[M];V+=m(L,p,h+V),V+=m(l[L],p,h+V,A)}return V}if(f==="function")return 0;throw new Error("Unknown type "+f)}function R(l,p){var h=typeof l;if(h==="string"){var A=E(l);if(A<32)return 1+A;if(A<256)return 2+A;if(A<65536)return 3+A;if(A<4294967296)return 5+A}if(ArrayBuffer.isView&&ArrayBuffer.isView(l)&&(l=l.buffer),l instanceof ArrayBuffer){var f=l.byteLength;if(f<256)return 2+f;if(f<65536)return 3+f;if(f<4294967296)return 5+f}if(typeof l=="number"){if(Math.floor(l)!==l)return 9;if(l>=0){if(l<128)return 1;if(l<256)return 2;if(l<65536)return 3;if(l<4294967296)return 5;if(l<18446744073709552e3)return 9;throw new Error("Number too big 0x"+l.toString(16))}if(l>=-32)return 1;if(l>=-128)return 2;if(l>=-32768)return 3;if(l>=-2147483648)return 5;if(l>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+l.toString(16).substr(1))}if(h==="boolean")return 1;if(l===null)return p?0:1;if(l===void 0)return p?0:3;if(typeof l.toJSON=="function")return R(l.toJSON(),p);if(h==="object"){var O,w=0;if(Array.isArray(l)){O=l.length;for(var x=0;x<O;x++)w+=R(l[x],p)}else{var V=C(l,p);O=V.length;for(var x=0;x<O;x++){var H=V[x];w+=R(H)+R(l[H],p)}}if(O<16)return 1+w;if(O<65536)return 3+w;if(O<4294967296)return 5+w;throw new Error("Array or object too long 0x"+O.toString(16))}if(h==="function")return 0;throw new Error("Unknown type "+h)}r.default={encode:c,decode:P,inspect:u,utf8Write:o,utf8Read:v,utf8ByteCount:E}},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(30)),v=u.__importDefault(n(49)),E=u.__importDefault(n(0)),c=u.__importDefault(n(55)),d=u.__importDefault(n(57)),y=u.__importDefault(n(62)),S=u.__importDefault(n(63)),I=u.__importDefault(n(67)),s=u.__importDefault(n(3)),b=n(8),T=u.__importDefault(n(25)),P=u.__importDefault(n(64)),C=u.__importDefault(n(65)),m=u.__importDefault(n(40)),R=u.__importDefault(n(9)),l=u.__importDefault(n(14));E.default.Crypto=d.default,E.default.BufferUtils=c.default,E.default.Http=y.default,E.default.Config=S.default,E.default.Transports=I.default,E.default.WebStorage=P.default,o.default.Crypto=d.default,v.default.Crypto=d.default,o.default.Message=R.default,v.default.Message=R.default,o.default.PresenceMessage=l.default,v.default.PresenceMessage=l.default,v.default.ConnectionManager=T.default,s.default.initLogHandlers(),E.default.Defaults=b.getDefaults(C.default),E.default.Config.agent&&(E.default.Defaults.agent+=" "+E.default.Config.agent),E.default.Config.noUpgrade&&(E.default.Defaults.upgradeTransports=[]),r.default={Rest:o.default,Realtime:v.default,msgpack:m.default}},function(i){i.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(31),n(23))})(this,function(u){return u.HmacSHA256})},function(i,r){},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(46)),E=u.__importDefault(n(24)),c=u.__importDefault(n(18)),d=u.__importDefault(n(5)),y=u.__importDefault(n(47)),S=function(){},I=function(){function P(C){this.rest=C,this.admin=new s(C)}return P}(),s=function(){function P(C){this.rest=C,this.deviceRegistrations=new b(C),this.channelSubscriptions=new T(C)}return P.prototype.publish=function(C,m,R){var l=this.rest,p=l.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(p),A={},f=o.mixin({recipient:C},m);if(typeof R!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);R=S}l.options.headers&&o.mixin(h,l.options.headers),l.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var O=o.encodeBody(f,p);E.default.post(l,"/push/publish",O,h,A,null,function(w){return R(w)})},P}(),b=function(){function P(C){this.rest=C}return P.prototype.save=function(C,m){var R=this.rest,l=v.default.fromValues(C),p=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(p),A={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=S}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var f=o.encodeBody(l,p);E.default.put(R,"/push/deviceRegistrations/"+encodeURIComponent(C.id),f,h,A,null,function(O,w,x,V){m(O,O?void 0:v.default.fromResponseBody(w,V?void 0:p))})},P.prototype.get=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=o.defaultGetHeaders(l),h=C.id||C;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);m=S}if(typeof h!="string"||!h.length){m(new d.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&o.mixin(p,R.options.headers),E.default.get(R,"/push/deviceRegistrations/"+encodeURIComponent(h),p,{},null,function(A,f,O,w){m(A,A?void 0:v.default.fromResponseBody(f,w?void 0:l))})},P.prototype.list=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=this.rest.http.supportsLinkHeaders?void 0:l,h=o.defaultGetHeaders(l);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=S}R.options.headers&&o.mixin(h,R.options.headers),new c.default(R,"/push/deviceRegistrations",h,p,function(A,f,O){return v.default.fromResponseBody(A,O?void 0:l)}).get(C,m)},P.prototype.remove=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=o.defaultGetHeaders(l),h={},A=C.id||C;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);m=S}if(typeof A!="string"||!A.length){m(new d.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&o.mixin(p,R.options.headers),R.options.pushFullWait&&o.mixin(h,{fullWait:"true"}),E.default.delete(R,"/push/deviceRegistrations/"+encodeURIComponent(A),p,h,null,function(f){return m(f)})},P.prototype.removeWhere=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=o.defaultGetHeaders(l);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=S}R.options.headers&&o.mixin(p,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),E.default.delete(R,"/push/deviceRegistrations",p,C,null,function(h){return m(h)})},P}(),T=function(){function P(C){this.remove=P.prototype.removeWhere,this.rest=C}return P.prototype.save=function(C,m){var R=this.rest,l=y.default.fromValues(C),p=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(p),A={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=S}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var f=o.encodeBody(l,p);E.default.post(R,"/push/channelSubscriptions",f,h,A,null,function(O,w,x,V){m(O,!O&&y.default.fromResponseBody(w,V?void 0:p))})},P.prototype.list=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=this.rest.http.supportsLinkHeaders?void 0:l,h=o.defaultGetHeaders(l);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=S}R.options.headers&&o.mixin(h,R.options.headers),new c.default(R,"/push/channelSubscriptions",h,p,function(A,f,O){return y.default.fromResponseBody(A,O?void 0:l)}).get(C,m)},P.prototype.removeWhere=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=o.defaultGetHeaders(l);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=S}R.options.headers&&o.mixin(p,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),E.default.delete(R,"/push/channelSubscriptions",p,C,null,function(h){return m(h)})},P.prototype.listChannels=function(C,m){var R=this.rest,l=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,p=this.rest.http.supportsLinkHeaders?void 0:l,h=o.defaultGetHeaders(l);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);m=S}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),new c.default(R,"/push/channels",h,p,function(A,f,O){for(var w=!O&&l?o.decodeBody(A,l):A,x=0;x<w.length;x++)w[x]=String(w[x]);return w}).get(C,m)},P}();r.default=I},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(5)),E;(function(y){y.Phone="phone",y.Tablet="tablet",y.Desktop="desktop",y.TV="tv",y.Watch="watch",y.Car="car",y.Embedded="embedded",y.Other="other"})(E||(E={}));var c;(function(y){y.Android="android",y.IOS="ios",y.Browser="browser"})(c||(c={}));var d=function(){function y(){}return y.prototype.toJSON=function(){var S,I,s;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(S=this.push)===null||S===void 0?void 0:S.recipient,state:(I=this.push)===null||I===void 0?void 0:I.state,error:(s=this.push)===null||s===void 0?void 0:s.error}}},y.prototype.toString=function(){var S,I,s,b,T="[DeviceDetails";return this.id&&(T+="; id="+this.id),this.platform&&(T+="; platform="+this.platform),this.formFactor&&(T+="; formFactor="+this.formFactor),this.clientId&&(T+="; clientId="+this.clientId),this.metadata&&(T+="; metadata="+this.metadata),this.deviceIdentityToken&&(T+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((S=this.push)===null||S===void 0)&&S.recipient&&(T+="; push.recipient="+JSON.stringify(this.push.recipient)),!((I=this.push)===null||I===void 0)&&I.state&&(T+="; push.state="+this.push.state),!((s=this.push)===null||s===void 0)&&s.error&&(T+="; push.error="+JSON.stringify(this.push.error)),!((b=this.push)===null||b===void 0)&&b.metadata&&(T+="; push.metadata="+this.push.metadata),T+="]",T},y.fromResponseBody=function(S,I){return I&&(S=o.decodeBody(S,I)),o.isArray(S)?y.fromValuesArray(S):y.fromValues(S)},y.fromValues=function(S){return S.error=S.error&&v.default.fromValues(S.error),Object.assign(new y,S)},y.fromValuesArray=function(S){for(var I=S.length,s=new Array(I),b=0;b<I;b++)s[b]=y.fromValues(S[b]);return s},y.toRequestBody=o.encodeBody,y}();r.default=d},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=function(){function E(){}return E.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},E.prototype.toString=function(){var c="[PushChannelSubscription";return this.channel&&(c+="; channel="+this.channel),this.deviceId&&(c+="; deviceId="+this.deviceId),this.clientId&&(c+="; clientId="+this.clientId),c+="]",c},E.fromResponseBody=function(c,d){return d&&(c=o.decodeBody(c,d)),o.isArray(c)?E.fromValuesArray(c):E.fromValues(c)},E.fromValues=function(c){return Object.assign(new E,c)},E.fromValuesArray=function(c){for(var d=c.length,y=new Array(d),S=0;S<d;S++)y[S]=E.fromValues(c[S]);return y},E.toRequestBody=o.encodeBody,E}();r.default=v},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=function(){function R(l){this.count=l&&l.count||0,this.data=l&&l.data||0,this.uncompressedData=l&&l.uncompressedData||0,this.failed=l&&l.failed||0,this.refused=l&&l.refused||0}return R}(),E=function(R){u.__extends(l,R);function l(p){var h=R.call(this,p)||this;return p&&p.category&&(h.category={},o.forInOwnNonNullProperties(p.category,function(A){h.category[A]=new v(p.category[A])})),h}return l}(v),c=function(){function R(l){this.peak=l&&l.peak||0,this.min=l&&l.min||0,this.mean=l&&l.mean||0,this.opened=l&&l.opened||0,this.refused=l&&l.refused||0}return R}(),d=function(){function R(l){this.succeeded=l&&l.succeeded||0,this.failed=l&&l.failed||0,this.refused=l&&l.refused||0}return R}(),y=function(){function R(l){this.plain=new c(l&&l.plain),this.tls=new c(l&&l.tls),this.all=new c(l&&l.all)}return R}(),S=function(){function R(l){this.messages=new E(l&&l.messages),this.presence=new E(l&&l.presence),this.all=new E(l&&l.all)}return R}(),I=function(){function R(l){this.realtime=new S(l&&l.realtime),this.rest=new S(l&&l.rest),this.webhook=new S(l&&l.webhook),this.sharedQueue=new S(l&&l.sharedQueue),this.externalQueue=new S(l&&l.externalQueue),this.httpEvent=new S(l&&l.httpEvent),this.push=new S(l&&l.push),this.all=new S(l&&l.all)}return R}(),s=function(){function R(l){this.all=new S(l&&l.all),this.inbound=new I(l&&l.inbound),this.outbound=new I(l&&l.outbound)}return R}(),b=function(){function R(l){this.all=new S(l&&l.all),this.producerPaid=new s(l&&l.producerPaid),this.consumerPaid=new s(l&&l.consumerPaid)}return R}(),T=function(){function R(l){this.messages=l&&l.messages||0;var p=l&&l.notifications;this.notifications={invalid:p&&p.invalid||0,attempted:p&&p.attempted||0,successful:p&&p.successful||0,failed:p&&p.failed||0},this.directPublishes=l&&l.directPublishes||0}return R}(),P=function(){function R(l){this.succeeded=l&&l.succeeded||0,this.skipped=l&&l.skipped||0,this.failed=l&&l.failed||0}return R}(),C=function(){function R(l){var p=this;this.delta=void 0,l&&l.delta&&(this.delta={},o.forInOwnNonNullProperties(l.delta,function(h){p.delta[h]=new P(l.delta[h])}))}return R}(),m=function(R){u.__extends(l,R);function l(p){var h=R.call(this,p)||this;return h.persisted=new S(p&&p.persisted),h.connections=new y(p&&p.connections),h.channels=new c(p&&p.channels),h.apiRequests=new d(p&&p.apiRequests),h.tokenRequests=new d(p&&p.tokenRequests),h.xchgProducer=new b(p&&p.xchgProducer),h.xchgConsumer=new b(p&&p.xchgConsumer),h.push=new T(p&&p.pushStats),h.processed=new C(p&&p.processed),h.inProgress=p&&p.inProgress||void 0,h.unit=p&&p.unit||void 0,h.intervalId=p&&p.intervalId||void 0,h}return l.fromValues=function(p){return new l(p)},l}(s);r.default=m},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(30)),E=u.__importDefault(n(7)),c=u.__importDefault(n(3)),d=u.__importDefault(n(50)),y=u.__importDefault(n(37)),S=u.__importDefault(n(8)),I=u.__importDefault(n(5)),s=u.__importDefault(n(10)),b=u.__importDefault(n(25)),T=u.__importDefault(n(0)),P=u.__importDefault(n(9)),C=function(R){u.__extends(l,R);function l(p){var h=R.call(this,p)||this;return c.default.logAction(c.default.LOG_MINOR,"Realtime()",""),h.connection=new d.default(h,h.options),h.channels=new m(h),p.autoConnect!==!1&&h.connect(),h}return l.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},l.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},l.Promise=function(p){return p=S.default.objectifyOptions(p),p.promises=!0,new l(p)},l.Callbacks=l,l.Utils=o,l.ConnectionManager=b.default,l.Platform=T.default,l.ProtocolMessage=s.default,l.Message=P.default,l}(v.default),m=function(R){u.__extends(l,R);function l(p){var h=R.call(this)||this;return h.realtime=p,h.all={},h.inProgress={},p.connection.connectionManager.on("transport.active",function(){h.onTransportActive()}),h}return l.prototype.onChannelMessage=function(p){var h=p.channel;if(h===void 0){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+p.action);return}var A=this.all[h];if(!A){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+h);return}A.onMessage(p)},l.prototype.onTransportActive=function(){for(var p in this.all){var h=this.all[p];h.state==="attaching"||h.state==="detaching"?h.checkPendingState():h.state==="suspended"&&h.attach()}},l.prototype.reattach=function(p){for(var h in this.all){var A=this.all[h];A.state==="attached"&&A.requestState("attaching",p)}},l.prototype.resetAttachedMsgIndicators=function(){for(var p in this.all){var h=this.all[p];h.state==="attached"&&(h._attachedMsgIndicator=!1)}},l.prototype.checkAttachedMsgIndicators=function(p){for(var h in this.all){var A=this.all[h];if(A.state==="attached"&&A._attachedMsgIndicator===!1){var f="30s after a resume, found channel which has not received an attached; channelId = "+h+"; connectionId = "+p;c.default.logAction(c.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",f),A.requestState("attaching")}}},l.prototype.propogateConnectionInterruption=function(p,h){var A={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},f=["attaching","attached","detaching","suspended"],O=A[p];for(var w in this.all){var x=this.all[w];o.arrIn(f,x.state)&&x.notifyState(O,h)}},l.prototype.get=function(p,h){p=String(p);var A=this.all[p];if(!A)A=this.all[p]=new y.default(this.realtime,p,h);else if(h){if(A._shouldReattachToSetOptions(h))throw new I.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);A.setOptions(h)}return A},l.prototype.release=function(p){p=String(p);var h=this.all[p];if(!!h){var A=h.getReleaseErr();if(A)throw A;delete this.all[p],delete this.inProgress[p]}},l.prototype.setInProgress=function(p,h,A){this.inProgress[p.name]=this.inProgress[p.name]||{},this.inProgress[p.name][h]=A,!A&&this.hasNopending()&&this.emit("nopending")},l.prototype.onceNopending=function(p){if(this.hasNopending()){p();return}this.once("nopending",p)},l.prototype.hasNopending=function(){return o.arrEvery(o.valuesArray(this.inProgress,!0),function(p){return!o.containsValue(p,!0)})},l}(E.default);r.default=C},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(7)),E=u.__importDefault(n(25)),c=u.__importDefault(n(3)),d=u.__importDefault(n(36)),y=u.__importDefault(n(0));function S(){}var I=function(s){u.__extends(b,s);function b(T,P){var C=s.call(this)||this;return C.whenState=function(m,R){return v.default.prototype.whenState.call(C,m,C.state,R,new d.default(void 0,m))},C.ably=T,C.connectionManager=new E.default(T,P),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.serial=void 0,C.timeSerial=void 0,C.recoveryKey=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(m){var R=C.state=m.current;y.default.Config.nextTick(function(){C.emit(R,m)})}),C.connectionManager.on("update",function(m){y.default.Config.nextTick(function(){C.emit("update",m)})}),C}return b.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},b.prototype.ping=function(T){if(c.default.logAction(c.default.LOG_MINOR,"Connection.ping()",""),!T){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);T=S}this.connectionManager.ping(null,T)},b.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},b}(v.default);r.default=I},function(i,r,n){"use strict";r.__esModule=!0,r.PendingMessage=void 0;var u=n(1),o=u.__importDefault(n(10)),v=u.__importStar(n(2)),E=u.__importDefault(n(7)),c=u.__importDefault(n(3)),d=u.__importDefault(n(35)),y=u.__importDefault(n(5)),S=o.default.Action,I=function(){function b(T,P){this.message=T,this.callback=P,this.merged=!1;var C=T.action;this.sendAttempted=!1,this.ackRequired=C==S.MESSAGE||C==S.PRESENCE}return b}();r.PendingMessage=I;var s=function(b){u.__extends(T,b);function T(P){var C=b.call(this)||this;return C.transport=P,C.messageQueue=new d.default,P.on("ack",function(m,R){C.onAck(m,R)}),P.on("nack",function(m,R,l){C.onNack(m,R,l)}),C}return T.prototype.onAck=function(P,C){c.default.logAction(c.default.LOG_MICRO,"Protocol.onAck()","serial = "+P+"; count = "+C),this.messageQueue.completeMessages(P,C)},T.prototype.onNack=function(P,C,m){c.default.logAction(c.default.LOG_ERROR,"Protocol.onNack()","serial = "+P+"; count = "+C+"; err = "+v.inspectError(m)),m||(m=new y.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(P,C,m)},T.prototype.onceIdle=function(P){var C=this.messageQueue;if(C.count()===0){P();return}C.once("idle",P)},T.prototype.send=function(P){P.ackRequired&&this.messageQueue.push(P),c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(P.message)),P.sendAttempted=!0,this.transport.send(P.message)},T.prototype.getTransport=function(){return this.transport},T.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},T.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},T.prototype.finish=function(){var P=this.transport;this.onceIdle(function(){P.disconnect()})},T}(E.default);r.default=s},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),v=u.__importStar(n(2)),E=u.__importDefault(n(26)),c=u.__importDefault(n(8)),d=u.__importDefault(n(3)),y=u.__importDefault(n(10)),S=u.__importDefault(n(5)),I="web_socket";function s(P){return!!P.on}var b=function(P){u.__extends(C,P);function C(m,R,l){var p=P.call(this,m,R,l)||this;return p.shortName=I,l.heartbeats=o.default.Config.useProtocolHeartbeats,p.wsHost=c.default.getHost(l.options,l.host,!0),p}return C.isAvailable=function(){return!!o.default.Config.WebSocket},C.prototype.createWebSocket=function(m,R){var l=0;if(R)for(var p in R)m+=(l++?"&":"?")+p+"="+R[p];return this.uri=m,new o.default.Config.WebSocket(m)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),E.default.prototype.connect.call(this);var m=this,R=this.params,l=R.options,p=l.tls?"wss://":"ws://",h=p+this.wsHost+":"+c.default.getPort(l)+"/";d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+h),this.auth.getAuthParams(function(A,f){if(!m.isDisposed){var O="";for(var w in f)O+=" "+w+": "+f[w]+";";if(d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+O+" err: "+A),A){m.disconnect(A);return}var x=R.getConnectParams(f);try{var V=m.wsConnection=m.createWebSocket(h,x);V.binaryType=o.default.Config.binaryType,V.onopen=function(){m.onWsOpen()},V.onclose=function(H){m.onWsClose(H)},V.onmessage=function(H){m.onWsData(H.data)},V.onerror=function(H){m.onWsError(H)},s(V)&&V.on("ping",function(){m.onActivity()})}catch(H){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),m.disconnect(H)}}})},C.prototype.send=function(m){var R=this.wsConnection;if(!R){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{R.send(y.default.serialize(m,this.params.format))}catch(p){var l="Exception from ws connection when trying to send: "+v.inspectError(p);d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()",l),this.finish("disconnected",new S.default(l,5e4,500))}},C.prototype.onWsData=function(m){d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(y.default.deserialize(m,this.format))}catch(R){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+R.stack)}},C.prototype.onWsOpen=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(m){var R,l;if(typeof m=="object"?(l=m.code,R=m.wasClean||l===1e3):(l=m,R=l==1e3),delete this.wsConnection,R){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var p=new S.default("Websocket closed",80003,400);this.finish("disconnected",p)}else{var h="Unclean disconnection of WebSocket ; code = "+l,p=new S.default(h,80003,400);d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()",h),this.finish("disconnected",p)}this.emit("disposed")},C.prototype.onWsError=function(m){var R=this;d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),o.default.Config.nextTick(function(){R.disconnect(Error(m.message))})},C.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},C}(E.default);function T(P){return b.isAvailable()&&(P.supportedTransports[I]=b),b}r.default=T},function(i,r,n){"use strict";r.__esModule=!0,r.isSuccessCode=void 0;var u;(function(v){v[v.Success=200]="Success",v[v.NoContent=204]="NoContent",v[v.BadRequest=400]="BadRequest",v[v.Unauthorized=401]="Unauthorized",v[v.Forbidden=403]="Forbidden",v[v.RequestTimeout=408]="RequestTimeout",v[v.InternalServerError=500]="InternalServerError"})(u||(u={}));function o(v){return v>=u.Success&&v<u.BadRequest}r.isSuccessCode=o,r.default=u},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),v=u.__importDefault(n(34)),E=u.__importDefault(n(7)),c=u.__importDefault(n(3)),d=u.__importDefault(n(14)),y=u.__importDefault(n(5)),S=u.__importDefault(n(37)),I=u.__importDefault(n(22)),s=u.__importDefault(n(38)),b=function(){};function T(h){return h.clientId+":"+h.connectionId}function P(h){return h.channel.realtime.auth.clientId}function C(h){var A=h.channel.realtime,f=A.auth.clientId;return(!f||f==="*")&&A.connection.state==="connected"}function m(h,A,f){switch(h.state){case"attached":case"suspended":f();break;case"initialized":case"detached":case"detaching":case"attaching":h.attach(function(O){O?A(O):f()});break;default:A(y.default.fromValues(S.default.invalidStateError(h.state)))}}function R(h,A){if(h.isSynthesized()||A.isSynthesized())return h.timestamp>A.timestamp;var f=h.parseId(),O=A.parseId();return f.msgSerial===O.msgSerial?f.index>O.index:f.msgSerial>O.msgSerial}var l=function(h){u.__extends(A,h);function A(f){var O=h.call(this,f)||this;return O.channel=f,O.syncComplete=!1,O.members=new p(O),O._myMembers=new p(O),O.subscriptions=new E.default,O.pendingPresence=[],O}return A.prototype.enter=function(f,O){if(C(this))throw new y.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,f,"enter",O)},A.prototype.update=function(f,O){if(C(this))throw new y.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,f,"update",O)},A.prototype.enterClient=function(f,O,w){return this._enterOrUpdateClient(f,O,"enter",w)},A.prototype.updateClient=function(f,O,w){return this._enterOrUpdateClient(f,O,"update",w)},A.prototype._enterOrUpdateClient=function(f,O,w,x){var V=this;if(!x)if(typeof O=="function")x=O,O=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[f,O,w]);x=b}var H=this.channel;if(!H.connectionManager.activeState()){x(H.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence."+w+"Client()","channel = "+H.name+", client = "+(f||"(implicit) "+P(this)));var B=d.default.fromValues({action:w,data:O});f&&(B.clientId=f),d.default.encode(B,H.channelOptions,function(M){if(M){x(M);return}switch(H.state){case"attached":H.sendPresence(B,x);break;case"initialized":case"detached":H.attach();case"attaching":V.pendingPresence.push({presence:B,callback:x});break;default:M=new y.default("Unable to "+w+" presence channel while in "+H.state+" state",90001),M.code=90001,x(M)}})},A.prototype.leave=function(f,O){if(C(this))throw new y.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,f,O)},A.prototype.leaveClient=function(f,O,w){if(!w)if(typeof O=="function")w=O,O=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[f,O]);w=b}var x=this.channel;if(!x.connectionManager.activeState()){w==null||w(x.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+f);var V=d.default.fromValues({action:"leave",data:O});switch(f&&(V.clientId=f),x.state){case"attached":x.sendPresence(V,w);break;case"attaching":this.pendingPresence.push({presence:V,callback:w});break;case"initialized":case"failed":{var H=new y.default("Unable to leave presence channel (incompatible state)",90001);w==null||w(H);break}default:w==null||w(S.default.invalidStateError(x.state))}},A.prototype.get=function(f,O){var w=this,x=Array.prototype.slice.call(arguments);x.length==1&&typeof x[0]=="function"&&x.unshift(null),f=x[0],O=x[1];var V=!f||("waitForSync"in f?f.waitForSync:!0);if(!O){if(this.channel.realtime.options.promises)return o.promisify(this,"get",x);O=b}function H(B){O(null,f?B.list(f):B.values())}if(this.channel.state==="suspended"){V?O(y.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}m(this.channel,O,function(){var B=w.members;V?B.waitSync(function(){H(B)}):H(B)})},A.prototype.history=function(f,O){if(c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),O===void 0)if(typeof f=="function")O=f,f=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);O=b}f&&f.untilAttach&&(this.channel.state==="attached"?(delete f.untilAttach,f.from_serial=this.channel.properties.attachSerial):O(new y.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),v.default.prototype._history.call(this,f,O)},A.prototype.setPresence=function(f,O,w){c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+f.length+" participants; syncChannelSerial = "+w);var x,V,H=this.members,B=this._myMembers,M=[],L=this.channel.connectionManager.connectionId;O&&(this.members.startSync(),w&&(V=w.match(/^[\w-]+:(.*)$/))&&(x=V[1]));for(var k=0;k<f.length;k++){var W=d.default.fromValues(f[k]);switch(W.action){case"leave":H.remove(W)&&M.push(W),W.connectionId===L&&!W.isSynthesized()&&B.remove(W);break;case"enter":case"present":case"update":H.put(W)&&M.push(W),W.connectionId===L&&B.put(W);break}}O&&!x&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(S.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var k=0;k<M.length;k++){var W=M[k];this.subscriptions.emit(W.action,W)}},A.prototype.onAttached=function(f){c.default.logAction(c.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+f),f?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var O=this.pendingPresence,w=O.length;if(w){this.pendingPresence=[];var x=[],V=I.default.create();c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+w+" queued presence messages");for(var H=0;H<w;H++){var B=O[H];x.push(B.presence),V.push(B.callback)}this.channel.sendPresence(x,V)}},A.prototype.actOnChannelState=function(f,O,w){switch(f){case"attached":this.onAttached(O);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(w);break}},A.prototype.failPendingPresence=function(f){if(this.pendingPresence.length){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(f));for(var O=0;O<this.pendingPresence.length;O++)try{this.pendingPresence[O].callback(f)}catch(w){}this.pendingPresence=[]}},A.prototype._clearMyMembers=function(){this._myMembers.clear()},A.prototype._ensureMyMembersPresent=function(){var f=this,O=this.members,w=this._myMembers,x=function(B){if(B){var M="Presence auto-re-enter failed: "+B.toString(),L=new y.default(M,91004,400);c.default.logAction(c.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",M);var k=new s.default(f.channel.state,f.channel.state,!0,L);f.channel.emit("update",k)}};for(var V in w.map)if(!(V in O.map)){var H=w.map[V];c.default.logAction(c.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",x),delete w.map[V]}},A.prototype._synthesizeLeaves=function(f){var O=this.subscriptions;o.arrForEach(f,function(w){var x=d.default.fromValues({action:"leave",connectionId:w.connectionId,clientId:w.clientId,data:w.data,encoding:w.encoding,timestamp:o.now()});O.emit("leave",x)})},A.prototype.on=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];c.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,f)},A.prototype.off=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];c.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,f)},A.prototype.subscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var w=S.default.processListenerArgs(f),x=w[0],V=w[1],H=w[2],B=this.channel;if(!H){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[x,V]);H=b}if(B.state==="failed"){H(y.default.fromValues(S.default.invalidStateError("failed")));return}this.subscriptions.on(x,V),B.attach(H)},A.prototype.unsubscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var w=S.default.processListenerArgs(f),x=w[0],V=w[1];this.subscriptions.off(x,V)},A}(v.default),p=function(h){u.__extends(A,h);function A(f){var O=h.call(this)||this;return O.presence=f,O.map={},O.syncInProgress=!1,O.residualMembers=null,O}return A.prototype.get=function(f){return this.map[f]},A.prototype.getClient=function(f){var O=this.map,w=[];for(var x in O){var V=O[x];V.clientId==f&&V.action!="absent"&&w.push(V)}return w},A.prototype.list=function(f){var O=this.map,w=f&&f.clientId,x=f&&f.connectionId,V=[];for(var H in O){var B=O[H];B.action!=="absent"&&(w&&w!=B.clientId||x&&x!=B.connectionId||V.push(B))}return V},A.prototype.put=function(f){(f.action==="enter"||f.action==="update")&&(f=d.default.fromValues(f),f.action="present");var O=this.map,w=T(f);this.residualMembers&&delete this.residualMembers[w];var x=O[w];return x&&!R(f,x)?!1:(O[w]=f,!0)},A.prototype.values=function(){var f=this.map,O=[];for(var w in f){var x=f[w];x.action!="absent"&&O.push(x)}return O},A.prototype.remove=function(f){var O=this.map,w=T(f),x=O[w];return x&&!R(f,x)?!1:(this.syncInProgress?(f=d.default.fromValues(f),f.action="absent",O[w]=f):delete O[w],!0)},A.prototype.startSync=function(){var f=this.map,O=this.syncInProgress;c.default.logAction(c.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),this.syncInProgress||(this.residualMembers=o.copy(f),this.setInProgress(!0))},A.prototype.endSync=function(){var f=this.map,O=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),O){for(var w in f){var x=f[w];x.action==="absent"&&delete f[w]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var V in this.residualMembers)delete f[V];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},A.prototype.waitSync=function(f){var O=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),!O){f();return}this.once("sync",f)},A.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},A.prototype.setInProgress=function(f){c.default.logAction(c.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+f),this.syncInProgress=f,this.presence.syncComplete=!f},A}(E.default);r.default=l},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=n(56),v=n(32),E=n(13),c=u.__importDefault(n(4)),d=u.__importDefault(n(0)),y=function(){function S(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return S.prototype.isWordArray=function(I){return I!=null&&I.sigBytes!==void 0},S.prototype.isArrayBuffer=function(I){return I!=null&&I.constructor===ArrayBuffer},S.prototype.isTypedArray=function(I){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(I)},S.prototype.uint8ViewToBase64=function(I){for(var s="",b=this.base64CharSet,T=I.byteLength,P=T%3,C=T-P,m,R,l,p,h,A=0;A<C;A=A+3)h=I[A]<<16|I[A+1]<<8|I[A+2],m=(h&16515072)>>18,R=(h&258048)>>12,l=(h&4032)>>6,p=h&63,s+=b[m]+b[R]+b[l]+b[p];return P==1?(h=I[C],m=(h&252)>>2,R=(h&3)<<4,s+=b[m]+b[R]+"=="):P==2&&(h=I[C]<<8|I[C+1],m=(h&64512)>>10,R=(h&1008)>>4,l=(h&15)<<2,s+=b[m]+b[R]+b[l]+"="),s},S.prototype.base64ToArrayBuffer=function(I){for(var s=atob==null?void 0:atob(I),b=s.length,T=new Uint8Array(b),P=0;P<b;P++){var C=s.charCodeAt(P);T[P]=C}return T.buffer},S.prototype.isBuffer=function(I){return this.isArrayBuffer(I)||this.isWordArray(I)||this.isTypedArray(I)},S.prototype.toBuffer=function(I){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(I))return new Uint8Array(I);if(this.isTypedArray(I))return new Uint8Array(I.buffer);if(this.isWordArray(I)){for(var s=new ArrayBuffer(I.sigBytes),b=new Uint8Array(s),T=0;T<I.sigBytes;T++)b[T]=I.words[T>>>2]>>>24-T%4*8&255;return b}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},S.prototype.toArrayBuffer=function(I){return this.isArrayBuffer(I)?I:this.toBuffer(I).buffer},S.prototype.toWordArray=function(I){return this.isTypedArray(I)&&(I=I.buffer),this.isWordArray(I)?I:c.default.create(I)},S.prototype.base64Encode=function(I){return this.isWordArray(I)?E.stringify(I):this.uint8ViewToBase64(this.toBuffer(I))},S.prototype.base64Decode=function(I){return ArrayBuffer&&d.default.Config.atob?this.base64ToArrayBuffer(I):E.parse(I)},S.prototype.hexEncode=function(I){return o.stringify(this.toWordArray(I))},S.prototype.hexDecode=function(I){var s=o.parse(I);return ArrayBuffer?this.toArrayBuffer(s):s},S.prototype.utf8Encode=function(I){return TextEncoder?new TextEncoder().encode(I).buffer:v.parse(I)},S.prototype.utf8Decode=function(I){if(!this.isBuffer(I))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(I)?new TextDecoder().decode(I):(I=this.toWordArray(I),v.stringify(I))},S.prototype.bufferCompare=function(I,s){if(!I)return-1;if(!s)return 1;var b=this.toWordArray(I),T=this.toWordArray(s);b.clamp(),T.clamp();var P=b.sigBytes-T.sigBytes;if(P!=0)return P;for(var C=b.words,m=T.words,R=0;R<C.length;R++)if(P=C[R]-m[R],P!=0)return P;return 0},S.prototype.byteLength=function(I){return this.isArrayBuffer(I)||this.isTypedArray(I)?I.byteLength:this.isWordArray(I)?I.sigBytes:-1},S.prototype.typedArrayToBuffer=function(I){return I.buffer},S}();r.default=new y},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return u.enc.Hex})},function(i,r,n){"use strict";n.r(r);var u=n(4),o=n.n(u),v=n(13),E=n.n(v),c=n(21),d=n.n(c),y=n(0),S=n.n(y),I=n(3),s=n.n(I),b=function(){var T="aes",P=256,C="cbc",m=16,R=4,l=4294967296,p=2147483648,h;if(S.a.getRandomWordArray)h=S.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&S.a.getRandomValues){var A=new Uint32Array(R);h=function(M,L){var k=M/4,W=k==R?A:new Uint32Array(k);S.a.getRandomValues(W,function(K){L(K,S.a.BufferUtils.toWordArray(W))})}}else h=function(M,L){s.a.logAction(s.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var k=M/4,W=new Array(k),K=0;K<k;K++)W[K]=Math.floor(Math.random()*l)-p;L(null,o.a.create(W))};function f(M){return M+m&-m}function O(M){if(M.algorithm==="aes"&&M.mode==="cbc"){if(M.keyLength===128||M.keyLength===256)return;throw new Error("Unsupported key length "+M.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function w(M){return M.replace("_","/").replace("-","+")}var x=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function V(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}V.CipherParams=H,V.getDefaultParams=function(M){var L;if(typeof M=="function"||typeof M=="string"){if(s.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof M=="function")V.generateRandomKey(function(W){M(null,V.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,V.getDefaultParams({key:M}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!M.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof M.key=="string"?L=Object(v.parse)(w(M.key)):L=S.a.BufferUtils.toWordArray(M.key);var k=new H;if(k.key=L,k.algorithm=M.algorithm||T,k.keyLength=L.words.length*(4*8),k.mode=M.mode||C,M.keyLength&&M.keyLength!==k.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+M.keyLength+" was specified, but the key actually has length "+k.keyLength);return O(k),k},V.generateRandomKey=function(M,L){arguments.length==1&&typeof M=="function"&&(L=M,M=void 0),h((M||P)/8,L)},V.getCipher=function(M){var L=M instanceof H?M:V.getDefaultParams(M);return{cipherParams:L,cipher:new B(L,R,M.iv)}};function B(M,L,k){this.algorithm=M.algorithm+"-"+String(M.keyLength)+"-"+M.mode,this.cjsAlgorithm=M.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=S.a.BufferUtils.toWordArray(M.key),k&&(this.iv=S.a.BufferUtils.toWordArray(k).clone()),this.blockLengthWords=L}return B.prototype.encrypt=function(M,L){s.a.logAction(s.a.LOG_MICRO,"CBCCipher.encrypt()",""),M=S.a.BufferUtils.toWordArray(M);var k=M.sigBytes,W=f(k),K=this,$=function(){K.getIv(function(Y,G){if(Y){L(Y);return}var D=K.encryptCipher.process(M.concat(x[W-k])),F=G.concat(D);L(null,F)})};this.encryptCipher?$():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),$()):h(m,function(Y,G){if(Y){L(Y);return}K.encryptCipher=d.a.algo[K.cjsAlgorithm].createEncryptor(K.key,{iv:G}),K.iv=G,$()})},B.prototype.decrypt=function(M){s.a.logAction(s.a.LOG_MICRO,"CBCCipher.decrypt()",""),M=S.a.BufferUtils.toWordArray(M);var L=this.blockLengthWords,k=M.words,W=o.a.create(k.slice(0,L)),K=o.a.create(k.slice(L)),$=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),Y=$.process(K),G=$.finalize();return $.reset(),G&&G.sigBytes&&Y.concat(G),Y},B.prototype.getIv=function(M){if(this.iv){var L=this.iv;this.iv=null,M(null,L);return}var k=this;h(m,function(W,K){if(W){M(W);return}M(null,k.encryptCipher.process(K))})},V}();r.default=b},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,v=o.lib,E=v.WordArray,c=o.enc,d=c.Utf16=c.Utf16BE={stringify:function(S){for(var I=S.words,s=S.sigBytes,b=[],T=0;T<s;T+=2){var P=I[T>>>2]>>>16-T%4*8&65535;b.push(String.fromCharCode(P))}return b.join("")},parse:function(S){for(var I=S.length,s=[],b=0;b<I;b++)s[b>>>1]|=S.charCodeAt(b)<<16-b%2*16;return E.create(s,I*2)}};c.Utf16LE={stringify:function(S){for(var I=S.words,s=S.sigBytes,b=[],T=0;T<s;T+=2){var P=y(I[T>>>2]>>>16-T%4*8&65535);b.push(String.fromCharCode(P))}return b.join("")},parse:function(S){for(var I=S.length,s=[],b=0;b<I;b++)s[b>>>1]|=y(S.charCodeAt(b)<<16-b%2*16);return E.create(s,I*2)}};function y(S){return S<<8&4278255360|S>>>8&16711935}}(),u.enc.Utf16})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(28))})(this,function(u){return function(o){var v=u,E=v.lib,c=E.CipherParams,d=v.enc,y=d.Hex,S=v.format,I=S.Hex={stringify:function(s){return s.ciphertext.toString(y)},parse:function(s){var b=y.parse(s);return c.create({ciphertext:b})}}}(),u.format.Hex})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(13),n(61),n(27),n(28))})(this,function(u){return function(){var o=u,v=o.lib,E=v.BlockCipher,c=o.algo,d=[],y=[],S=[],I=[],s=[],b=[],T=[],P=[],C=[],m=[];(function(){for(var p=[],h=0;h<256;h++)h<128?p[h]=h<<1:p[h]=h<<1^283;for(var A=0,f=0,h=0;h<256;h++){var O=f^f<<1^f<<2^f<<3^f<<4;O=O>>>8^O&255^99,d[A]=O,y[O]=A;var w=p[A],x=p[w],V=p[x],H=p[O]*257^O*16843008;S[A]=H<<24|H>>>8,I[A]=H<<16|H>>>16,s[A]=H<<8|H>>>24,b[A]=H;var H=V*16843009^x*65537^w*257^A*16843008;T[O]=H<<24|H>>>8,P[O]=H<<16|H>>>16,C[O]=H<<8|H>>>24,m[O]=H,A?(A=w^p[p[p[V^w]]],f^=p[p[f]]):A=f=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],l=c.AES=E.extend({_doReset:function(){var p;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var h=this._keyPriorReset=this._key,A=h.words,f=h.sigBytes/4,O=this._nRounds=f+6,w=(O+1)*4,x=this._keySchedule=[],V=0;V<w;V++)V<f?x[V]=A[V]:(p=x[V-1],V%f?f>6&&V%f==4&&(p=d[p>>>24]<<24|d[p>>>16&255]<<16|d[p>>>8&255]<<8|d[p&255]):(p=p<<8|p>>>24,p=d[p>>>24]<<24|d[p>>>16&255]<<16|d[p>>>8&255]<<8|d[p&255],p^=R[V/f|0]<<24),x[V]=x[V-f]^p);for(var H=this._invKeySchedule=[],B=0;B<w;B++){var V=w-B;if(B%4)var p=x[V];else var p=x[V-4];B<4||V<=4?H[B]=p:H[B]=T[d[p>>>24]]^P[d[p>>>16&255]]^C[d[p>>>8&255]]^m[d[p&255]]}}},encryptBlock:function(p,h){this._doCryptBlock(p,h,this._keySchedule,S,I,s,b,d)},decryptBlock:function(p,h){var A=p[h+1];p[h+1]=p[h+3],p[h+3]=A,this._doCryptBlock(p,h,this._invKeySchedule,T,P,C,m,y);var A=p[h+1];p[h+1]=p[h+3],p[h+3]=A},_doCryptBlock:function(p,h,A,f,O,w,x,V){for(var H=this._nRounds,B=p[h]^A[0],M=p[h+1]^A[1],L=p[h+2]^A[2],k=p[h+3]^A[3],W=4,K=1;K<H;K++){var $=f[B>>>24]^O[M>>>16&255]^w[L>>>8&255]^x[k&255]^A[W++],Y=f[M>>>24]^O[L>>>16&255]^w[k>>>8&255]^x[B&255]^A[W++],G=f[L>>>24]^O[k>>>16&255]^w[B>>>8&255]^x[M&255]^A[W++],D=f[k>>>24]^O[B>>>16&255]^w[M>>>8&255]^x[L&255]^A[W++];B=$,M=Y,L=G,k=D}var $=(V[B>>>24]<<24|V[M>>>16&255]<<16|V[L>>>8&255]<<8|V[k&255])^A[W++],Y=(V[M>>>24]<<24|V[L>>>16&255]<<16|V[k>>>8&255]<<8|V[B&255])^A[W++],G=(V[L>>>24]<<24|V[k>>>16&255]<<16|V[B>>>8&255]<<8|V[M&255])^A[W++],D=(V[k>>>24]<<24|V[B>>>16&255]<<16|V[M>>>8&255]<<8|V[L&255])^A[W++];p[h]=$,p[h+1]=Y,p[h+2]=G,p[h+3]=D},keySize:256/32});o.AES=E._createHelper(l)}(),u.AES})},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(o){var v=u,E=v.lib,c=E.WordArray,d=E.Hasher,y=v.algo,S=[];(function(){for(var C=0;C<64;C++)S[C]=o.abs(o.sin(C+1))*4294967296|0})();var I=y.MD5=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,m){for(var R=0;R<16;R++){var l=m+R,p=C[l];C[l]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}var h=this._hash.words,A=C[m+0],f=C[m+1],O=C[m+2],w=C[m+3],x=C[m+4],V=C[m+5],H=C[m+6],B=C[m+7],M=C[m+8],L=C[m+9],k=C[m+10],W=C[m+11],K=C[m+12],$=C[m+13],Y=C[m+14],G=C[m+15],D=h[0],F=h[1],j=h[2],Q=h[3];D=s(D,F,j,Q,A,7,S[0]),Q=s(Q,D,F,j,f,12,S[1]),j=s(j,Q,D,F,O,17,S[2]),F=s(F,j,Q,D,w,22,S[3]),D=s(D,F,j,Q,x,7,S[4]),Q=s(Q,D,F,j,V,12,S[5]),j=s(j,Q,D,F,H,17,S[6]),F=s(F,j,Q,D,B,22,S[7]),D=s(D,F,j,Q,M,7,S[8]),Q=s(Q,D,F,j,L,12,S[9]),j=s(j,Q,D,F,k,17,S[10]),F=s(F,j,Q,D,W,22,S[11]),D=s(D,F,j,Q,K,7,S[12]),Q=s(Q,D,F,j,$,12,S[13]),j=s(j,Q,D,F,Y,17,S[14]),F=s(F,j,Q,D,G,22,S[15]),D=b(D,F,j,Q,f,5,S[16]),Q=b(Q,D,F,j,H,9,S[17]),j=b(j,Q,D,F,W,14,S[18]),F=b(F,j,Q,D,A,20,S[19]),D=b(D,F,j,Q,V,5,S[20]),Q=b(Q,D,F,j,k,9,S[21]),j=b(j,Q,D,F,G,14,S[22]),F=b(F,j,Q,D,x,20,S[23]),D=b(D,F,j,Q,L,5,S[24]),Q=b(Q,D,F,j,Y,9,S[25]),j=b(j,Q,D,F,w,14,S[26]),F=b(F,j,Q,D,M,20,S[27]),D=b(D,F,j,Q,$,5,S[28]),Q=b(Q,D,F,j,O,9,S[29]),j=b(j,Q,D,F,B,14,S[30]),F=b(F,j,Q,D,K,20,S[31]),D=T(D,F,j,Q,V,4,S[32]),Q=T(Q,D,F,j,M,11,S[33]),j=T(j,Q,D,F,W,16,S[34]),F=T(F,j,Q,D,Y,23,S[35]),D=T(D,F,j,Q,f,4,S[36]),Q=T(Q,D,F,j,x,11,S[37]),j=T(j,Q,D,F,B,16,S[38]),F=T(F,j,Q,D,k,23,S[39]),D=T(D,F,j,Q,$,4,S[40]),Q=T(Q,D,F,j,A,11,S[41]),j=T(j,Q,D,F,w,16,S[42]),F=T(F,j,Q,D,H,23,S[43]),D=T(D,F,j,Q,L,4,S[44]),Q=T(Q,D,F,j,K,11,S[45]),j=T(j,Q,D,F,G,16,S[46]),F=T(F,j,Q,D,O,23,S[47]),D=P(D,F,j,Q,A,6,S[48]),Q=P(Q,D,F,j,B,10,S[49]),j=P(j,Q,D,F,Y,15,S[50]),F=P(F,j,Q,D,V,21,S[51]),D=P(D,F,j,Q,K,6,S[52]),Q=P(Q,D,F,j,w,10,S[53]),j=P(j,Q,D,F,k,15,S[54]),F=P(F,j,Q,D,f,21,S[55]),D=P(D,F,j,Q,M,6,S[56]),Q=P(Q,D,F,j,G,10,S[57]),j=P(j,Q,D,F,H,15,S[58]),F=P(F,j,Q,D,$,21,S[59]),D=P(D,F,j,Q,x,6,S[60]),Q=P(Q,D,F,j,W,10,S[61]),j=P(j,Q,D,F,O,15,S[62]),F=P(F,j,Q,D,L,21,S[63]),h[0]=h[0]+D|0,h[1]=h[1]+F|0,h[2]=h[2]+j|0,h[3]=h[3]+Q|0},_doFinalize:function(){var C=this._data,m=C.words,R=this._nDataBytes*8,l=C.sigBytes*8;m[l>>>5]|=128<<24-l%32;var p=o.floor(R/4294967296),h=R;m[(l+64>>>9<<4)+15]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,m[(l+64>>>9<<4)+14]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,C.sigBytes=(m.length+1)*4,this._process();for(var A=this._hash,f=A.words,O=0;O<4;O++){var w=f[O];f[O]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}return A},clone:function(){var C=d.clone.call(this);return C._hash=this._hash.clone(),C}});function s(C,m,R,l,p,h,A){var f=C+(m&R|~m&l)+p+A;return(f<<h|f>>>32-h)+m}function b(C,m,R,l,p,h,A){var f=C+(m&l|R&~l)+p+A;return(f<<h|f>>>32-h)+m}function T(C,m,R,l,p,h,A){var f=C+(m^R^l)+p+A;return(f<<h|f>>>32-h)+m}function P(C,m,R,l,p,h,A){var f=C+(R^(m|~l))+p+A;return(f<<h|f>>>32-h)+m}v.MD5=d._createHelper(I),v.HmacMD5=d._createHmacHelper(I)}(Math),u.MD5})},function(i,r,n){"use strict";var u;r.__esModule=!0;var o=n(1),v=o.__importDefault(n(0)),E=o.__importStar(n(2)),c=o.__importDefault(n(8)),d=o.__importDefault(n(5)),y=o.__importDefault(n(17)),S=o.__importDefault(n(15)),I=o.__importDefault(n(20)),s=o.__importDefault(n(3)),b=n(29);function T(m){var R=m.statusCode;return R===408&&!m.code||R===400&&!m.code||R>=500&&R<=504}function P(m){var R=m.connection,l=R&&R.connectionManager.host;return l?[l].concat(c.default.getFallbackHosts(m.options)):c.default.getHosts(m.options)}var C=(u=function(){function m(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=P,v.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(R,l,p,h,A,f,O){var w=S.default.createRequest(p,h,A,f,I.default.REQ_SEND,l&&l.options.timeouts,R);return w.once("complete",O),w.exec(),w},this.checkConnectivity=function(R){var l=c.default.internetUpUrl;s.default.logAction(s.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+l),this.doUri(y.default.Get,null,l,null,null,null,function(p,h){var A,f=!p&&((A=h)===null||A===void 0?void 0:A.replace(/\n/,""))=="yes";s.default.logAction(s.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+f),R(null,f)})}):v.default.Config.jsonpSupported&&(this.Request=function(R,l,p,h,A,f,O){var w=b.createRequest(p,h,A,f,I.default.REQ_SEND,l&&l.options.timeouts,R);return w.once("complete",O),v.default.Config.nextTick(function(){w.exec()}),w},this.checkConnectivity=function(R){var l=this,p=c.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(R);return}this.checksInProgress=[R],s.default.logAction(s.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+p);var h=new b.Request("isTheInternetUp",p,null,null,null,I.default.REQ_SEND,c.default.TIMEOUTS);h.once("complete",function(A,f){var O=!A&&f;s.default.logAction(s.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+O);for(var w=0;w<l.checksInProgress.length;w++)l.checksInProgress[w](null,O);l.checksInProgress=null}),v.default.Config.nextTick(function(){h.exec()})})}return m.prototype.do=function(R,l,p,h,A,f,O){var w=this,x=typeof p=="function"?p:function(M){return l.baseUri(M)+p},V=l._currentFallback;if(V)if(V.validUntil>E.now()){if(!this.Request){O==null||O(new d.default("Request invoked before assigned to",null,500));return}this.Request(R,l,x(V.host),h,f,A,function(M){for(var L=[],k=1;k<arguments.length;k++)L[k-1]=arguments[k];if(M&&T(M)){l._currentFallback=null,w.do(R,l,p,h,A,f,O);return}O==null||O.apply(void 0,o.__spreadArray([M],L))});return}else l._currentFallback=null;var H=P(l);if(H.length===1){this.doUri(R,l,x(H[0]),h,A,f,O);return}var B=function(M,L){var k=M.shift();w.doUri(R,l,x(k),h,A,f,function(W){for(var K=[],$=1;$<arguments.length;$++)K[$-1]=arguments[$];if(W&&T(W)&&M.length){B(M,!0);return}L&&(l._currentFallback={host:k,validUntil:E.now()+l.options.timeouts.fallbackRetryTimeout}),O==null||O.apply(void 0,o.__spreadArray([W],K))})};B(H)},m.prototype.doUri=function(R,l,p,h,A,f,O){if(!this.Request){O(new d.default("Request invoked before assigned to",null,500));return}this.Request(R,l,p,h,f,A,O)},m}(),u.methods=[y.default.Get,y.default.Delete,y.default.Post,y.default.Put,y.default.Patch],u.methodsWithoutBody=[y.default.Get,y.default.Delete],u.methodsWithBody=[y.default.Post,y.default.Put,y.default.Patch],u);r.default=C},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(40)),v=u.__importStar(n(2)),E=v.getGlobalObject();function c(){var I=E.location;return!E.WebSocket||!I||!I.origin||I.origin.indexOf("http")>-1}var d=E.navigator&&E.navigator.userAgent.toString(),y=E.location&&E.location.href,S={agent:"browser",logTimestamps:!0,userAgent:d,currentUrl:y,noUpgrade:d&&!!d.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:E.WebSocket,xhrSupported:E.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:c(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!E.TextDecoder,preferBinary:!1,ArrayBuffer:E.ArrayBuffer,atob:E.atob,nextTick:typeof E.setImmediate!="undefined"?E.setImmediate.bind(E):function(I){setTimeout(I,0)},addEventListener:E.addEventListener,inspect:JSON.stringify,stringByteSize:function(I){return E.TextDecoder&&new E.TextEncoder().encode(I).length||I.length},TextEncoder:E.TextEncoder,TextDecoder:E.TextDecoder,Promise:E.Promise,getRandomValues:function(I){if(I!==void 0)return function(s,b){I.getRandomValues(s),b&&b(null)}}(E.crypto||msCrypto)};r.default=S},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),v=o.__importStar(n(2)),E="ablyjs-storage-test",c=function(){function d(){try{u.sessionStorage.setItem(E,E),u.sessionStorage.removeItem(E),this.sessionSupported=!0}catch(y){this.sessionSupported=!1}try{u.localStorage.setItem(E,E),u.localStorage.removeItem(E),this.localSupported=!0}catch(y){this.localSupported=!1}}return d.prototype.get=function(y){return this._get(y,!1)},d.prototype.getSession=function(y){return this._get(y,!0)},d.prototype.remove=function(y){return this._remove(y,!1)},d.prototype.removeSession=function(y){return this._remove(y,!0)},d.prototype.set=function(y,S,I){return this._set(y,S,I,!1)},d.prototype.setSession=function(y,S,I){return this._set(y,S,I,!0)},d.prototype._set=function(y,S,I,s){var b={value:S};return I&&(b.expires=v.now()+I),this.storageInterface(s).setItem(y,JSON.stringify(b))},d.prototype._get=function(y,S){if(S&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!S&&!this.localSupported)throw new Error("Local Storage not supported");var I=this.storageInterface(S).getItem(y);if(!I)return null;var s=JSON.parse(I);return s.expires&&s.expires<v.now()?(this.storageInterface(S).removeItem(y),null):s.value},d.prototype._remove=function(y,S){return this.storageInterface(S).removeItem(y)},d.prototype.storageInterface=function(y){return y?u.sessionStorage:u.localStorage},d}();r.default=new c}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(66)),v={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};r.default=v},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(u||(u={})),r.default=u},function(i,r,n){"use strict";n.r(r);var u=n(29),o=n.n(u),v=n(2),E=n(0),c=n.n(E),d=n(11),y=n.n(d),S=n(15),I=n.n(S),s=function(m){var R="xhr_polling";function l(p,h,A){A.stream=!1,y.a.call(this,p,h,A),this.shortName=R}return v.inherits(l,y.a),l.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.allowComet},l.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(p,h,A,f,O){return I.a.createRequest(p,h,A,f,O,this.timeouts)},typeof m!="undefined"&&l.isAvailable()&&(m.supportedTransports[R]=l),l},b=s,T=function(m){var R="xhr_streaming";function l(p,h,A){y.a.call(this,p,h,A),this.shortName=R}return v.inherits(l,y.a),l.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.streamingSupported&&c.a.Config.allowComet},l.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(p,h,A,f,O){return I.a.createRequest(p,h,A,f,O,this.timeouts)},typeof m!="undefined"&&l.isAvailable()&&(m.supportedTransports[R]=l),l},P=T,C=r.default=[o.a,b,P]}]).default})});var ki=We((gO,_l)=>{ae();function Lb(i){var r=typeof i;return i!=null&&(r=="object"||r=="function")}_l.exports=Lb});var xl=We((vO,Ll)=>{ae();var xb=typeof global=="object"&&global&&global.Object===Object&&global;Ll.exports=xb});var _o=We((mO,Bl)=>{ae();var Bb=xl(),Db=typeof self=="object"&&self&&self.Object===Object&&self,Nb=Bb||Db||Function("return this")();Bl.exports=Nb});var Nl=We((yO,Dl)=>{ae();var Fb=_o(),Ub=function(){return Fb.Date.now()};Dl.exports=Ub});var Ul=We((bO,Fl)=>{ae();var Gb=/\s/;function Hb(i){for(var r=i.length;r--&&Gb.test(i.charAt(r)););return r}Fl.exports=Hb});var Hl=We((CO,Gl)=>{ae();var Wb=Ul(),kb=/^\s+/;function Vb(i){return i&&i.slice(0,Wb(i)+1).replace(kb,"")}Gl.exports=Vb});var Lo=We((OO,Wl)=>{ae();var zb=_o(),Qb=zb.Symbol;Wl.exports=Qb});var Ql=We((EO,zl)=>{ae();var kl=Lo(),Vl=Object.prototype,jb=Vl.hasOwnProperty,Jb=Vl.toString,Tr=kl?kl.toStringTag:void 0;function Kb(i){var r=jb.call(i,Tr),n=i[Tr];try{i[Tr]=void 0;var u=!0}catch(v){}var o=Jb.call(i);return u&&(r?i[Tr]=n:delete i[Tr]),o}zl.exports=Kb});var Jl=We((SO,jl)=>{ae();var Zb=Object.prototype,Yb=Zb.toString;function qb(i){return Yb.call(i)}jl.exports=qb});var ql=We((IO,Yl)=>{ae();var Kl=Lo(),Xb=Ql(),$b=Jl(),eC="[object Null]",tC="[object Undefined]",Zl=Kl?Kl.toStringTag:void 0;function nC(i){return i==null?i===void 0?tC:eC:Zl&&Zl in Object(i)?Xb(i):$b(i)}Yl.exports=nC});var $l=We((RO,Xl)=>{ae();function rC(i){return i!=null&&typeof i=="object"}Xl.exports=rC});var tf=We((TO,ef)=>{ae();var iC=ql(),aC=$l(),oC="[object Symbol]";function sC(i){return typeof i=="symbol"||aC(i)&&iC(i)==oC}ef.exports=sC});var of=We((PO,af)=>{ae();var uC=Hl(),nf=ki(),cC=tf(),rf=0/0,lC=/^[-+]0x[0-9a-f]+$/i,fC=/^0b[01]+$/i,dC=/^0o[0-7]+$/i,hC=parseInt;function AC(i){if(typeof i=="number")return i;if(cC(i))return rf;if(nf(i)){var r=typeof i.valueOf=="function"?i.valueOf():i;i=nf(r)?r+"":r}if(typeof i!="string")return i===0?i:+i;i=uC(i);var n=fC.test(i);return n||dC.test(i)?hC(i.slice(2),n?2:8):lC.test(i)?rf:+i}af.exports=AC});var cf=We((MO,uf)=>{ae();var pC=ki(),xo=Nl(),sf=of(),gC="Expected a function",vC=Math.max,mC=Math.min;function yC(i,r,n){var u,o,v,E,c,d,y=0,S=!1,I=!1,s=!0;if(typeof i!="function")throw new TypeError(gC);r=sf(r)||0,pC(n)&&(S=!!n.leading,I="maxWait"in n,v=I?vC(sf(n.maxWait)||0,r):v,s="trailing"in n?!!n.trailing:s);function b(A){var f=u,O=o;return u=o=void 0,y=A,E=i.apply(O,f),E}function T(A){return y=A,c=setTimeout(m,r),S?b(A):E}function P(A){var f=A-d,O=A-y,w=r-f;return I?mC(w,v-O):w}function C(A){var f=A-d,O=A-y;return d===void 0||f>=r||f<0||I&&O>=v}function m(){var A=xo();if(C(A))return R(A);c=setTimeout(m,P(A))}function R(A){return c=void 0,s&&u?b(A):(u=o=void 0,E)}function l(){c!==void 0&&clearTimeout(c),y=0,u=d=o=c=void 0}function p(){return c===void 0?E:R(xo())}function h(){var A=xo(),f=C(A);if(u=arguments,o=this,d=A,f){if(c===void 0)return T(d);if(I)return clearTimeout(c),c=setTimeout(m,r),b(d)}return c===void 0&&(c=setTimeout(m,r)),E}return h.cancel=l,h.flush=p,h}uf.exports=yC});var ff=We((wO,lf)=>{ae();var bC=cf(),CC=ki(),OC="Expected a function";function EC(i,r,n){var u=!0,o=!0;if(typeof i!="function")throw new TypeError(OC);return CC(n)&&(u="leading"in n?!!n.leading:u,o="trailing"in n?!!n.trailing:o),bC(i,r,{leading:u,maxWait:r,trailing:o})}lf.exports=EC});var hf=We((KO,df)=>{ae();df.exports={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}});var pf=We((ZO,Af)=>{ae();var{webm:PC,mp4:MC}=hf(),Go=()=>typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,Ho=()=>"wakeLock"in navigator,Wo=class{constructor(){if(this.enabled=!1,Ho()){this._wakeLock=null;let r=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",r),document.addEventListener("fullscreenchange",r)}else Go()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",PC),this._addSourceToVideo(this.noSleepVideo,"mp4",MC),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(r,n,u){var o=document.createElement("source");o.src=u,o.type=`video/${n}`,r.appendChild(o)}get isEnabled(){return this.enabled}enable(){return Ho()?navigator.wakeLock.request("screen").then(r=>{this._wakeLock=r,this.enabled=!0,this._wakeLock.addEventListener("release",()=>{})}).catch(r=>{throw this.enabled=!1,r}):Go()?(this.disable(),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(n=>(this.enabled=!0,n)).catch(n=>{throw this.enabled=!1,n})}disable(){Ho()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):Go()?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}};Af.exports=Wo});var yf=We((gE,xC)=>{xC.exports={name:"@superviz/sdk",version:"0.0.0-development",description:"SuperViz SDK",main:"./dist/index.js",types:"./dist/index.d.ts",files:["src","dist"],scripts:{prepare:"husky install",build:"node ./.esbuild/build.js",postbuild:"tsc --emitDeclarationOnly --declaration",watch:'concurrently -n code,types "yarn watch:code" "yarn watch:types"',"watch:code":"node ./.esbuild/watch.js","watch:types":"tsc --watch",test:"jest","test:e2e":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright test ./e2e","test:e2e:pt-br":"E2E_LOCALE=pt-BR yarn test:e2e","test:e2e:en":"E2E_LOCALE=en yarn test:e2e","test:e2e:all":"yarn test:e2e:pt-br && yarn test:e2e:en","test:e2e:install":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright install","test:e2e:generate":"eval $(cat .env | xargs) && npx playwright codegen $E2E_BASE_URL","test:e2e:debug":"eval $(cat .env | xargs) && PWDEBUG=1 yarn test:e2e","test:e2e:headed":"eval $(cat .env | xargs) && yarn test:e2e --headed","semantic-release":"semantic-release",commit:"git-cz"},publishConfig:{access:"public",scope:"@superviz"},repository:{type:"git",url:"https://github.com/SuperViz/sdk.git"},author:"",license:"ISC",bugs:{url:"https://github.com/SuperViz/sdk/issues"},homepage:"https://github.com/SuperViz/sdk#readme",devDependencies:{"@commitlint/cli":"^17.4.2","@commitlint/config-conventional":"^17.4.2","@playwright/test":"^1.28.1","@typescript-eslint/eslint-plugin":"^5.27.0","@typescript-eslint/parser":"^5.27.0",concurrently:"^7.2.2","cz-conventional-changelog":"^3.3.0",dotenv:"^16.0.1",esbuild:"^0.14.48",eslint:"^7.32.0 || ^8.2.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.25.2",husky:"^8.0.3",jest:"^28.1.2","jest-environment-jsdom":"^28.1.2","semantic-release":"19.0.5","ts-jest":"^28.0.5",tsc:"^2.0.4",typescript:"^4.7.4",yargs:"^17.5.1"},dependencies:{"@superviz/immersive-core":"^0.3.1","@types/jest":"^28.1.3","@types/lodash.isequal":"^4.5.6","@types/node":"^18.7.15",ably:"^1.2.29",bowser:"^2.11.0","bowser-jr":"^1.0.4",debug:"^4.3.4",lodash:"^4.17.21","lodash.debounce":"^4.0.8","lodash.isequal":"^4.5.0","nosleep.js":"^0.12.0","semantic-release-version-file":"^1.0.2"},config:{commitizen:{path:"./node_modules/cz-conventional-changelog"}},husky:{hooks:{"pre-commit":"lint-staged","commit-msg":"commitlint -E HUSKY_GIT_PARAMS"}}}});var Sf={};h0(Sf,{remoteConfig:()=>DC});var DC,If=Oc(()=>{ae();DC={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});ae();ae();var vr=(p=>(p.MEETING_START="meeting.start",p.MEETING_LEAVE="meeting.leave",p.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",p.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",p.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",p.MEETING_PARTICIPANT_LEFT="meeting.participant-left",p.MEETING_JOIN="meeting.join",p.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",p.MEETING_HOST_CHANGE="meeting.host-change",p.MEETING_GRID_MODE_CHANGE="meeting.grid-mode-change",p.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",p.MEETING_DEVICES_CHANGE="meeting.devices-change",p.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",p.MEETING_STATE_UPDATE="meeting.state-update",p.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",p.MY_PARTICIPANT_UPDATED="my-participant.update",p.MY_PARTICIPANT_LEFT="my-participant.left",p.MY_PARTICIPANT_JOINED="my-participant.joined",p.HEARTBEAT="heartbeat",p.DESTROY="destroy",p))(vr||{});var bi=(E=>(E.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",E.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",E.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",E.TOGGLE_CAM="meeting-controls.toggle-cam",E.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",E.HANG_UP="hang-up",E))(bi||{}),zn=(S=>(S.REALTIME_JOIN="realtime.join",S.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",S.REALTIME_HOST_CHANGE="realtime.host-change",S.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",S.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",S.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",S.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",S.REALTIME_GATHER="realtime.gather",S.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",S.REALTIME_SET_AVATAR="realtime.set-avatar",S))(zn||{});var Ci=(S=>(S[S.MEETING_FAILED=-1]="MEETING_FAILED",S[S.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",S[S.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",S[S.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",S[S.MEETING_CONNECTING=3]="MEETING_CONNECTING",S[S.MEETING_CONNECTED=4]="MEETING_CONNECTED",S[S.MEETING_RECONNECT=5]="MEETING_RECONNECT",S[S.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",S[S.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",S[S.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",S))(Ci||{}),mr=(c=>(c[c.NOT_AVAILABLE=0]="NOT_AVAILABLE",c[c.GOOD=1]="GOOD",c[c.BAD=2]="BAD",c[c.POOR=3]="POOR",c[c.DISCONNECTED=4]="DISCONNECTED",c[c.RECONNECTING=5]="RECONNECTING",c[c.LOST_CONNECTION=6]="LOST_CONNECTION",c))(mr||{}),fo=(E=>(E.NO_CAM="devices.no-cam",E.NO_DEVICES="devices.no-devices",E.DEVICES_BLOCKED="devices.blocked",E.DEVICES_CAM_BLOCKED="devices.cam-blocked",E.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",E.DEVICES_UNKNOWN_ERROR="devices.unknown-error",E))(fo||{});ae();var ho=(u=>(u.HOST="host",u.GUEST="guest",u.AUDIENCE="audience",u))(ho||{});ae();ae();ae();var Sn=(i,r,n)=>ke(void 0,null,function*(){let u=yield fetch(i,{method:r,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(!u.ok)throw u;return u.json()});ae();var Vc=xt(Qn()),Ii=xt(kc()),vo=class extends Vc.Logger{constructor(n){super(n);this.disable(),this.debug=(0,Ii.default)(n)}log(n,...u){this.debug(n,...u)}enable(n="*"){Ii.default.enable(n)}disable(){Ii.default.disable()}},Ae=new vo("@superviz/sdk");ae();var fn=class{static createUrl(r,n){return`${r}${n}`}static validateApiKey(r,n){let u="/user/checkapikey",o=this.createUrl(r,u);return Sn(o,"POST",{apiKey:n})}static fetchConfig(r,n){let u="/immersive-config",o=this.createUrl(r,u);return Sn(o,"POST",{apiKey:n})}static fetchWaterMark(r,n){return ke(this,null,function*(){let u="/user/watermark",o=this.createUrl(r,u),{message:v}=yield Sn(o,"POST",{apiKey:n});return v})}};ae();var zc=(i,r)=>ke(void 0,null,function*(){try{return(yield fn.validateApiKey(i,r))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}});ae();var Wt=xt(Qc()),br=class{constructor(){this.browser=Wt.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Wt.default.PLATFORMS_MAP.mobile)||this.browser.is(Wt.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Wt.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};ae();ae();var bf=xt(Qn()),Cf=xt(Rl());ae();var Tl=xt(Qn());var Fi=class{constructor(){this.connectionStatusObserver=new Tl.ObserverHelper({logger:Ae});this.updateMeetingConnectionStatus=r=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=r,this.connectionStatusObserver.publish(r),Ae.log("CONNECTION STATUS CHANGE",r)};this.onUpdateBrowserOnlineStatus=r=>{let{type:n}=r;if(n==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.connectionStatus=0}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};ae();var Ml=xt(Pl());ae();var Ui=class{constructor({isAvatarsEnabled:r,isMouseEnabled:n,isLaserEnabled:u,isNameEnabled:o,renderLocalAvatar:v,plugin:E,RealtimeService:c,localParticipant:d}){this.enableAvatars=()=>{this._isAvatarsEnabled=!0};this.disableAvatars=()=>{this._isAvatarsEnabled=!1};this.enableMouse=()=>{this._isMouseEnabled=!0};this.disableMouse=()=>{this._isMouseEnabled=!1};this.enableLaser=()=>{this._isLaserEnabled=!0};this.disableLaser=()=>{this._isLaserEnabled=!1};this.createAvatar=r=>ke(this,null,function*(){if(!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled)return;this.destroyAvatar(r);let u=yield this.plugin.createAvatar(r);this._isNameEnabled&&this.plugin.createName&&this.plugin.createName(r,u)});this.destroyAvatar=r=>{this.plugin.destroyAvatar(r)};this.createMouse=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isMouseEnabled||(this.destroyMouse(r),this.plugin.createMouse(r))};this.destroyMouse=r=>{this.plugin.destroyMouse(r)};this.createLaser=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled||!this._isLaserEnabled||(this.destroyLaser(r),this.plugin.createLaser(r))};this.destroyLaser=r=>{this.plugin.destroyLaser(r)};this.goToParticipant=r=>{this.plugin.goToParticipant(r)};this._isAvatarsEnabled=r,this._isMouseEnabled=n,this._isLaserEnabled=u,this._renderLocalAvatar=v,this._isNameEnabled=o,this.plugin=E,this._localParticipant=d,this.RealtimeService=c,this.plugin.init({subscribeToParticipantJoinedObserver:y=>{c.participantJoinedObserver.subscribe(y)},unsubscribeToParticipantJoinedObserver:y=>{c.participantJoinedObserver.unsubscribe(y)},subscribeToParticipantLeaveObserver:y=>{c.participantLeaveObserver.subscribe(y)},unsubscribeToParticipantLeaveObserver:y=>{c.participantLeaveObserver.unsubscribe(y)},subscribeToParticipantsObserver:y=>{c.participantsObserver.subscribe(y)},unsubscribeToParticipantsObserver:y=>{c.participantsObserver.unsubscribe(y)},subscribeToParticipantUpdate:(y,S)=>{c.subscribeToParticipantUpdate(y,S)},unsubscribeToParticipantUpdate:(y,S)=>{c.unsubscribeFromParticipantUpdate(y,S)},updateMyProperties:y=>{c.updateMyProperties(y)},subscribe:c.syncPropertiesObserver.subscribe,unsubscribe:c.syncPropertiesObserver.unsubscribe,getParticipantSlot:c.getParticipantSlot},d)}get isAvatarsEnabled(){return this._isAvatarsEnabled}get isMouseEnabled(){return this._isMouseEnabled}get isLaserEnabled(){return this._isLaserEnabled}};ae();var Gi=class{constructor(){this.addParticipantToList=r=>{this._participants||(this._participants=[]),this._participants=[...this._participants,r]};this.setLocalParticipant=r=>{this._participant=r};this.createParticipantOn3D=({id:r,name:n,avatar:u,avatarConfig:o,isAudience:v})=>({id:r,name:n,avatar:u,isAudience:v,avatarConfig:o,position:{x:0,y:0,z:0},rotation:{x:0,y:0}});this.removeParticipant=r=>{this._participants=this._participants.filter(n=>n.id!==r.id)}}get participant(){return this._participant}get participants(){return this._participants}};var Hi=class extends Ui{constructor({isAvatarsEnabled:n,isMouseEnabled:u,isLaserEnabled:o,isNameEnabled:v,renderLocalAvatar:E,plugin:c,RealtimeService:d,avatarConfig:y,localParticipant:S,participantList:I}){let s=n!=null?n:!0,b=u!=null?u:!0,T=o!=null?o:!0;super({plugin:c,RealtimeService:d,isAvatarsEnabled:s,isMouseEnabled:b,isLaserEnabled:T,isNameEnabled:v,renderLocalAvatar:E,localParticipant:S,avatarConfig:y});this.followParticipantId=void 0;this.addParticipant=n=>{if(!n||!n.id||n.isAudience)return;let u=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(u),this.RealtimeService.subscribeToParticipantUpdate(u.id,this.onParticipantUpdated),this.createAvatar(u),this.createMouse(u),this.createLaser(u)};this.removeParticipant=(n,u)=>{this.IntegrationParticipantsService.removeParticipant(n),this.destroyAvatar(n),this.destroyMouse(n),this.destroyLaser(n),u&&this.RealtimeService.unsubscribeFromParticipantUpdate(n.id,this.onParticipantUpdated)};this.updateParticipant=n=>{var v,E;if(!this.participants||this.participants.length===0||!n||!n.id)return;let u=this.participants.find(c=>c.id===n.id);if(!u){this.addParticipant(n);return}let o=!1;if((((v=u.avatar)==null?void 0:v.model)!==((E=n.avatar)==null?void 0:E.model)||!(0,Ml.isEqual)(u.avatarConfig,n.avatarConfig))&&(o=!0),o){this.removeParticipant(n,!1);let c=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(c),this.createAvatar(c),this.createMouse(c),this.createLaser(c)}else{let c=this.IntegrationParticipantsService.participants.findIndex(d=>d.id===n.id);c!==-1&&(this.IntegrationParticipantsService.participants[c]=n)}};this.createLocalParticipant=n=>{let u=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.setLocalParticipant(u)};this.createParticipantList=n=>{n.map(o=>this.IntegrationParticipantsService.createParticipantOn3D(o)).forEach(o=>{this.addParticipant(o)})};this.onParticipantJoined=n=>{let{participantId:u,name:o,avatar:v,avatarConfig:E,isAudience:c}=n.data;this.addParticipant({id:u,name:o,avatar:v,avatarConfig:E,isAudience:c})};this.onParticipantLeave=n=>{var o;if(!((o=this.participants)!=null&&o.length))return;let u=this.participants.find(v=>v.id===n.clientId);!u||this.removeParticipant(u,!0)};this.onParticipantUpdated=n=>{let{participantId:u,name:o,avatar:v,avatarConfig:E,position:c,rotation:d}=n.data;this.updateParticipant({position:c,rotation:d,id:u,name:o,avatar:v,avatarConfig:E}),this.followParticipantId&&this.plugin.goToParticipant(this.followParticipantId)};this.onRoomInfoUpdate=n=>{if(!n)return;let{gather:u,hostClientId:o,followParticipantId:v}=n;this.followParticipantId=v,u&&this.plugin.goToParticipant(o)};this.IntegrationParticipantsService=new Gi,this.createLocalParticipant(S),this.createParticipantList(I),this.RealtimeService.participantJoinedObserver.subscribe(this.onParticipantJoined),this.RealtimeService.participantLeaveObserver.subscribe(this.onParticipantLeave),this.RealtimeService.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdate),this.onRoomInfoUpdate(this.RealtimeService.roomProperties)}get participants(){return this.IntegrationParticipantsService.participants}get getAvatars(){var n;return(n=this.plugin)==null?void 0:n.getAvatars()}get localParticipant(){return this.IntegrationParticipantsService.participant}};ae();ae();var Uo=xt(wl()),Pr=xt(ff());ae();var Bo=(d=>(d[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d))(Bo||{});ae();var gt=xt(Qn());ae();var Do=(m=>(m[m.yellow=0]="yellow",m[m.turquoise=1]="turquoise",m[m.orange=2]="orange",m[m.blue=3]="blue",m[m.pink=4]="pink",m[m.purple=5]="purple",m[m.green=6]="green",m[m.red=7]="red",m[m.bluedark=8]="bluedark",m[m.pinklight=9]="pinklight",m[m.purplelight=10]="purplelight",m[m.greenlight=11]="greenlight",m[m.orangelight=12]="orangelight",m[m.bluelight=13]="bluelight",m[m.redlight=14]="redlight",m[m.brown=15]="brown",m[m.gray=16]="gray",m))(Do||{}),No=(i=>(i[i["#FFEF33"]=0]="#FFEF33",i[i["#31E0B0"]=1]="#31E0B0",i[i["#FF5E10"]=2]="#FF5E10",i[i["#00ABF7"]=3]="#00ABF7",i[i["#FF00BB"]=4]="#FF00BB",i[i["#9C29FF"]=5]="#9C29FF",i[i["#6FDD00"]=6]="#6FDD00",i[i["#E30000"]=7]="#E30000",i[i["#304AFF"]=8]="#304AFF",i[i["#FF89C4"]=9]="#FF89C4",i[i["#D597FF"]=10]="#D597FF",i[i["#C6EC5C"]=11]="#C6EC5C",i[i["#FFA115"]=12]="#FFA115",i[i["#75DEFE"]=13]="#75DEFE",i[i["#FAA291"]=14]="#FAA291",i[i["#BB813F"]=15]="#BB813F",i[i["#878291"]=16]="#878291",i))(No||{});var Vi=class{constructor(){this.participantObservers=[],this.participantsObserver=new gt.ObserverHelper({logger:Ae}),this.participantJoinedObserver=new gt.ObserverHelper({logger:Ae}),this.participantLeaveObserver=new gt.ObserverHelper({logger:Ae}),this.joinRoomObserver=new gt.ObserverHelper({logger:Ae}),this.syncPropertiesObserver=new gt.ObserverHelper({logger:Ae}),this.reconnectObserver=new gt.ObserverHelper({logger:Ae}),this.roomInfoUpdatedObserver=new gt.ObserverHelper({logger:Ae}),this.roomListUpdatedObserver=new gt.ObserverHelper({logger:Ae}),this.masterParticipantObserver=new gt.ObserverHelper({logger:Ae}),this.realtimeStateObserver=new gt.ObserverHelper({logger:Ae}),this.kickAllParticipantsObserver=new gt.ObserverHelper({logger:Ae}),this.authenticationObserver=new gt.ObserverHelper({logger:Ae})}subscribeToParticipantUpdate(r,n){this.participantObservers[r]||(this.participantObservers[r]=new gt.ObserverHelper({logger:Ae})),this.participantObservers[r].subscribe(n)}unsubscribeFromParticipantUpdate(r,n){this.participantObservers[r]&&this.participantObservers[r].unsubscribe(n)}getSlotColor(r){let n=r!=null?r:16;return{color:No[n],name:Do[n]}}};var SC=1e3*60,IC=6e4,RC=1e4,TC=1e3,Fo=null,$n=class extends Vi{constructor(n,u){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.localParticipantId=null;this.isBroadcast=!1;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=n=>ke(this,null,function*(){if(!n)return;let u=this.participants[n];yield this.updateRoomProperties({hostClientId:u.clientId})});this.freezeSync=n=>{var u,o;if(this.isSyncFrozen=n,n){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(u=this.broadcastChannel)==null||u.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(o=this.broadcastChannel)==null||o.unsubscribe();return}this.join(this.myParticipant.data)};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(n=>{let u=this.clientSyncPropertiesQueue[n];this.clientSyncPropertiesQueue[n]=[],u.length&&this.clientSyncChannel.publish(n,u,o=>{if(o){Ae.log(`publish failed with error ${o}`);return}Ae.log("events published",n,u)})}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(n,u)=>{this.clientRoomState[n]=u[u.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),Ae.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=n=>ke(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?(n==null?void 0:n.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(n.hostClientId):this.hostPassingHandle(),this.updateParticipants()});this.updateMyProperties=(0,Pr.default)(n=>{let u=n;if(!(this.isMessageTooBig(n)||this.left||!this.enableSync||this.isSyncFrozen)&&(u.avatar===void 0&&delete u.avatar,this.myParticipant.data=Lt(Lt({},this.myParticipant.data),n),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},TC);this.updateRoomProperties=n=>ke(this,null,function*(){if(this.isMessageTooBig(n)||this.isSyncFrozen||this.left)return;let u=Lt(Lt({},this.localRoomProperties),n);yield this.supervizChannel.publish("update",u)});this.updateParticipants=()=>ke(this,null,function*(){let n={};yield this.supervizChannel.presence.get((u,o)=>{o.forEach(v=>{n[v.clientId]=Lt({},v)}),this.participants=n,this.checkBroadcast(),this.participantsObserver.publish(this.participants)})});this.updateHostInfo=n=>ke(this,null,function*(){let u=[];if(yield this.supervizChannel.presence.get((v,E)=>{E.forEach(c=>{v||u.push(c.clientId)})}),!n||!u.includes(n)){this.hostPassingHandle();return}Fo&&clearTimeout(Fo);let o=this.hostParticipantId;this.hostParticipantId=n,this.masterParticipantObserver.publish({oldMasterParticipantParticipantId:o,newMasterParticipantParticipantId:this.hostParticipantId}),Ae.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)});this.initializeRoomProperties=(o,...v)=>ke(this,[o,...v],function*(n,u={}){var c;let E=Lt({isGridModeEnable:!1},u);(c=this.myParticipant)!=null&&c.data.type&&(E.hostClientId=this.myParticipant.data.participantId),yield this.updateParticipants(),yield this.updateRoomProperties(E)});this.hostPassingHandle=(0,Pr.default)(()=>ke(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((n,u)=>{let o=u.filter(E=>E.data.type==="host").map(E=>E.clientId);if(this.shouldKickParticipantsOnHostLeave&&o.length===0){Fo=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},SC);return}let v=o[0];v===this.localParticipantId&&this.setHost(v)})}),1e3);this.findSlotIndex=n=>ke(this,null,function*(){let u=n,o=Array.apply(null,{length:15}).map(Number.call,Number);if(yield this.supervizChannel.presence.get((c,d)=>{c||d.forEach(y=>{y.connectionId===u.connectionId&&(u=y),y.connectionId!==u.connectionId&&y.data.hasOwnProperty("slotIndex")&&o.splice(o.indexOf(y.data.slotIndex),1)})}),o.length===0)return;let v=o[0];this.myParticipant.data.slotIndex=v,yield this.updateMyProperties({slotIndex:o[0]});let E=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(u)},E)});this.confirmSlot=(0,Pr.default)(n=>ke(this,null,function*(){let u=[],o=n;if(yield this.supervizChannel.presence.get((v,E)=>{E.forEach(c=>{c.connectionId===o.connectionId&&(o=c),c.connectionId!==o.connectionId&&c.data.slotIndex!==void 0&&u.push(c.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||u.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(o);else{let v=yield this.fetchRoomProperties();this.updateRoomProperties(v)}}),1e3);this.onParticipantJoin=n=>ke(this,null,function*(){yield this.updateParticipants(),this.participantJoinedObserver.publish(n),this.updateMyProperties({})});this.syncBroadcast=(0,Pr.default)(()=>{let n=btoa(this.ablyKey),u=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(u,{headers:{Authorization:`Basic ${n}`}}).then(o=>o.json()).then(o=>{this.broadcastChannel.publish("update",o)})},1e3);this.isMessageTooBig=n=>{let u=JSON.stringify(n);return new TextEncoder().encode(u).length>IC?(Ae.log("Message too long, the message limit size is 60kb."),!0):!1};this.isClientMessageTooBig=n=>{let u=JSON.stringify(n);return new TextEncoder().encode(u).length>RC?(Ae.log("Message too long, the message limit size is 10kb."),!0):!1};this.ablyKey=u,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}start({initialParticipantData:n,roomId:u,apiKey:o,shouldKickParticipantsOnHostLeave:v,isBroadcast:E}){this.myParticipant={data:n,timestamp:null,action:null,clientId:n.participantId,connectionId:null,encoding:null,id:null},this.isBroadcast=E,this.enableSync=n.type!=="audience",this.roomId=`superviz:${u.toLowerCase()}-${o}`,this.localParticipantId=this.myParticipant.data.participantId,this.shouldKickParticipantsOnHostLeave=v,this.apiKey=o,this.client||this.buildClient()}auth(n,u){let o=new Uo.default.Rest({key:this.ablyKey}),{origin:v}=window.location;o.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:v,apiKey:this.apiKey}},(E,c)=>{E&&this.authenticationObserver.publish("realtime.authentication-failed"),u(E,c)})}join(n){Ae.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(n),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){Ae.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let u=this.localRoomProperties;this.updateRoomProperties(Object.assign({},u,{isGridModeEnable:n}))}setSyncProperty(n,u){return ke(this,null,function*(){var E;let o=(E=this.clientSyncPropertiesQueue[n])!=null?E:[],v=(c,d)=>({name:c,data:d,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isClientMessageTooBig(v(n,u))&&(Ae.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(o)&&(Ae.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),Ae.log("adding to queue",n,u),this.clientSyncPropertiesQueue[n]||(this.clientSyncPropertiesQueue[n]=[]),this.clientSyncPropertiesQueue[n].push(v(n,u)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))})}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var u,o;if(n){let v=n.toString();if(this.participants&&this.participants[v])return(o=(u=this.participants[n])==null?void 0:u.data)==null?void 0:o.slotIndex}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:u}=n,o=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(o),this.participants&&this.participants[u]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onClientSyncChannelUpdate(n){let{name:u,data:o}=n,v={};v[u]=o,this.syncPropertiesObserver.publish(v),this.isLocalParticipantHost&&this.saveClientRoomState(u,o)}onReceiveBroadcastSync(n){n.data.forEach(o=>{var E;let v=o.clientId;this.participants[v]=o,(E=o.data)!=null&&E.isAudience||(this.participants[v].data=JSON.parse(this.participants[v].data),this.publishParticipantUpdate(this.participants[v]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Uo.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}checkBroadcast(){this.isBroadcast=Object.values(this.participants).some(n=>n.data.type==="audience")}forceReconnect(){if(Ae.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){Ae.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join(this.myParticipant.data);return}Ae.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw Ae.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,Ae.log("REALTIME",`Realtime state did change. New state: ${Bo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,u)=>{this.supervizChannel.history((o,v)=>{var c;o&&u(o);let E=(c=v.items[0])==null?void 0:c.data;n(E||null)})})}fetchSyncClientProperty(n){return ke(this,null,function*(){try{let u=yield new Promise((o,v)=>{this.clientRoomStateChannel.history((E,c)=>{var y;E&&v(E);let d=(y=c.items[0])==null?void 0:y.data;o(d||null)})});if(n&&!u[n])throw new Error(`Event ${n} not found in the history`);return n?u[n]:u}catch(u){Ae.log("REALTIME","Error in fetch client realtime data",u.message)}})}onStateChange(){var S,I,s;let n=(S=this.supervizChannelState)==null?void 0:S.current,u=(I=this.connectionState)==null?void 0:I.current,o=u==="connected",v=["initialized","connecting"].includes(u),E=["closed","closing"].includes(u)||["detaching","detached"].includes(n),c={[0]:E,[1]:v,[2]:!n&&o,[3]:n==="attaching",[4]:n==="attached"&&o,[-1]:n==="failed"||u==="failed",[-2]:u==="suspended"||n==="suspended"},d=Object.entries(c).find(([b,T])=>T&&b)[0],y=Number(d);y===2&&(this.currentReconnectAttempt=0),o&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(y===-2||y===-1)&&this.forceReconnect(),(s=this.connectionState)!=null&&s.retryIn&&(this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt)),this.publishStateUpdate(y)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.supervizChannelState=n,this.onStateChange()}onJoinRoom(n){return ke(this,null,function*(){var o,v;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&(yield this.findSlotIndex(n)),!this.localRoomProperties?yield this.initializeRoomProperties(n):(yield this.updateParticipants(),(o=this.localRoomProperties)!=null&&o.hostClientId?yield this.updateHostInfo((v=this.localRoomProperties)==null?void 0:v.hostClientId):this.myParticipant.data.type==="host"&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)),this.isReconnecting=!1,this.joinRoomObserver.publish(this.supervizChannel),this.publishStateUpdate(4),this.participantJoinedObserver.publish(n),Ae.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let u=n.data.participantId===this.hostParticipantId;n.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(n),u&&this.onHostLeft(n),this.updateParticipants()}onHostLeft(n){this.updateRoomProperties({hostClientId:null})}};ae();ae();var Ze=xt(Qn()),mf=xt(pf());ae();var wC=`
  html, body { 
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #sv-video-wrapper iframe {
    position: fixed;
    
    border: none;

    margin: 0; 
    padding: 0; 
    overflow: hidden;
    z-index: 5;
  }

  #sv-video-wrapper iframe.sv-video-frame--right { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
  }

  #sv-video-wrapper iframe.sv-video-frame--left { 
    top: var(--superviz-offset-top);
    left: var(--superviz-offset-left);
  }

  #sv-video-wrapper iframe.sv-video-frame--bottom { 
    bottom: var(--superviz-offset-bottom);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--top { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--no-overlay { 
    display: none;
  }
`,gf=wC;ae();var ko=(m=>(m.svPrimary="sv-primary",m.svPrimary900="sv-primary-900",m.svPrimary200="sv-primary-200",m.svSecondary="sv-secondary",m.svGray="sv-gray",m.svSuccess="sv-success",m.svDanger="sv-danger",m.svBlack="sv-black",m.svWhite="sv-white",m.svGray100="sv-gray-100",m.svGray200="sv-gray-200",m.svGray300="sv-gray-300",m.svGray400="sv-gray-400",m.svGray500="sv-gray-500",m.svGray600="sv-gray-600",m.svGray700="sv-gray-700",m.svGray800="sv-gray-800",m))(ko||{});var vf="sv-video-frame",Mr=class{constructor(r){this.frameStateObserver=new Ze.ObserverHelper({logger:Ae});this.frameSizeObserver=new Ze.ObserverHelper({logger:Ae});this.realtimeObserver=new Ze.ObserverHelper({logger:Ae});this.hostChangeObserver=new Ze.ObserverHelper({logger:Ae});this.gridModeChangeObserver=new Ze.ObserverHelper({logger:Ae});this.followParticipantObserver=new Ze.ObserverHelper({logger:Ae});this.goToParticipantObserver=new Ze.ObserverHelper({logger:Ae});this.gatherParticipantsObserver=new Ze.ObserverHelper({logger:Ae});this.sameAccountErrorObserver=new Ze.ObserverHelper({logger:Ae});this.devicesObserver=new Ze.ObserverHelper({logger:Ae});this.meetingStateObserver=new Ze.ObserverHelper({logger:Ae});this.meetingConnectionObserver=new Ze.ObserverHelper({logger:Ae});this.participantAmountUpdateObserver=new Ze.ObserverHelper({logger:Ae});this.participantJoinedObserver=new Ze.ObserverHelper({logger:Ae});this.participantAvatarObserver=new Ze.ObserverHelper({logger:Ae});this.participantLeftObserver=new Ze.ObserverHelper({logger:Ae});this.participantListObserver=new Ze.ObserverHelper({logger:Ae});this.frameState=0;this.layoutModalsAndCamerasConfig=(r,n)=>{let u=r,o=n,v=["left","right","bottom","top"].includes(o),E=["left","right","center"].includes(u);return v||(o="right"),E||(u="right"),this.browserService.isMobileDevice?(o="bottom",{layoutPosition:u,camerasPosition:o}):(u==="left"&&o==="right"&&(u="right"),u==="right"&&o==="left"&&(u="left"),{layoutPosition:u,camerasPosition:o})};this.onFrameLoad=()=>{if(this.messageBridge=new Ze.MessageBridge({logger:Ae,contentWindow:this.bricklayer.element.contentWindow}),this.browserService.isMobileDevice){let r=new mf.default,n=()=>{r.enable(),this.bricklayer.element.removeEventListener("click",n,!1)};this.bricklayer.element.addEventListener("click",n,!1)}this.messageBridge.listen("meeting.amount-of-participants-update",this.onParticipantAmountUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.join",this.realtimeJoin),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.set-avatar",this.onParticipantAvatarChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=r=>{let n=r!=null?r:{};["top","bottom","left","right"].forEach(u=>{Object.keys(n).includes(u)||(n[u]=0)}),this.frameOffset=n};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=r=>{let n=document.createElement("style"),{bottom:u,left:o,right:v,top:E}=this.frameOffset;if(n.innerHTML=`
    :root {
      --superviz-offset-top: ${E}px;
      --superviz-offset-right: ${v}px;
      --superviz-offset-left: ${o}px;
      --superviz-offset-bottom: ${u}px;
    } 
    ${gf}    
    `,document.head.appendChild(n),this.frameConfig.disableCameraOverlay&&this.bricklayer.element.classList.add("sv-video-frame--no-overlay"),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${r}`)};this.onFrameDimensionsUpdate=({width:r,height:n})=>{let u=document.getElementById(vf),{bottom:o,right:v,left:E,top:c}=this.frameOffset,y=["all","powered-by"].includes(this.frameConfig.waterMark)&&!this.browserService.isMobileDevice?40:0,S=["top","bottom"].includes(this.frameConfig.camerasPosition)&&!this.browserService.isMobileDevice,I=`${r}px`,s=`${n+y}px`;(r>=window.innerWidth||S)&&(I=`calc(100% - ${v}px - ${E}px)`),n>=window.innerHeight&&(s=`calc(100% - ${c}px - ${o}px)`),u.style.width=I,u.style.height=s,this.frameSizeObserver.publish({width:I,height:s})};this.onWindowResize=()=>{let{innerHeight:r,innerWidth:n}=window;this.messageBridge.publish("frame.parent-window-size-update",{height:r,width:n})};this.updateFrameLocale=()=>{let{language:r,locales:n}=this.frameLocale,u=n.map(v=>v==null?void 0:v.language),o=["en",...u];if(r&&!o.includes(r))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantAmountUpdate=r=>{this.participantAmountUpdateObserver.publish(r)};this.onParticipantLeft=r=>{this.participantLeftObserver.publish(r)};this.onParticipantListUpdate=r=>{this.participantListObserver.publish(r)};this.onParticipantAvatarChange=r=>{this.participantAvatarObserver.publish(r)};this.realtimeJoin=(r={})=>{this.realtimeObserver.publish(r)};this.onMeetingHostChange=r=>{this.hostChangeObserver.publish(r)};this.onFollowParticipantDidChange=r=>{this.followParticipantObserver.publish(r)};this.onGoToDidChange=r=>{this.goToParticipantObserver.publish(r)};this.onGather=()=>{this.gatherParticipantsObserver.publish()};this.onGridModeChange=r=>{this.gridModeChangeObserver.publish(r)};this.onSameAccountError=r=>{this.sameAccountErrorObserver.publish(r)};this.onDevicesChange=r=>{this.devicesObserver.publish(r)};this.meetingStateUpdate=r=>{this.meetingStateObserver.publish(r)};this.onConnectionStatusChange=r=>{this.meetingConnectionObserver.publish(r)};this.waitForHostDidChange=r=>{this.messageBridge.publish("realtime.wait-for-host",r)};this.gridModeDidChange=r=>{this.messageBridge.publish("realtime.grid-mode-change",r)};this.participantsListDidChange=r=>{this.messageBridge.publish("realtime.participant-list-update",r)};this.onMasterParticipantDidChange=r=>{this.messageBridge.publish("realtime.host-change",r)};this.followParticipantDidChange=r=>{this.messageBridge.publish("realtime.follow-participant",r)};var M,L,k,W;let{conferenceLayerUrl:n,ablyKey:u,apiKey:o,apiUrl:v,debug:E,language:c,roomId:d,canUseCams:y,canUseChat:S,canUseScreenshare:I,canUseDefaultAvatars:s,canUseFollow:b,canUseGoTo:T,canUseGather:P,browserService:C,offset:m,canUseDefaultToolbar:R,locales:l,avatars:p,customColors:h,waterMark:A,disableCameraOverlay:f}=r,{skipMeetingSettings:O,devices:w}=r,{layoutPosition:x,camerasPosition:V}=r;this.browserService=C;let H=this.layoutModalsAndCamerasConfig(x,V);f&&(O=!0,w={audioInput:!1,audioOutput:!1,videoInput:!1});let B=document.createElement("div");this.frameConfig={apiKey:o,apiUrl:v,ablyKey:u,debug:E,canUseFollow:b,canUseGoTo:T,canUseCams:y,canUseChat:S,canUseGather:P,canUseScreenshare:I,canUseDefaultAvatars:s,camerasPosition:(M=H.camerasPosition)!=null?M:"right",canUseDefaultToolbar:R,roomId:d,devices:{audioInput:(L=w==null?void 0:w.audioInput)!=null?L:!0,audioOutput:(k=w==null?void 0:w.audioOutput)!=null?k:!0,videoInput:(W=w==null?void 0:w.videoInput)!=null?W:!0},waterMark:A,skipMeetingSettings:O,disableCameraOverlay:f,layoutPosition:H.layoutPosition},this.customColors=h,B.classList.add("sv_video_wrapper"),B.id="sv-video-wrapper",document.body.appendChild(B),this.updateFrameState(1),this.bricklayer=new Ze.FrameBricklayer,this.bricklayer.build(B.id,n,vf,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(m),this.setFrameStyle(H.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:c,locales:l},this.meetingAvatars=p,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}updateFrameState(r){r!==this.frameState&&(this.frameState=r,this.frameStateObserver.publish(this.frameState));let n={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(n[r])}start(r){this.messageBridge.publish("meeting.start",yi(Lt({},r),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave",{}),this.destroy()}destroy(){this.messageBridge.destroy(),this.bricklayer.destroy(),this.frameStateObserver.destroy(),this.realtimeObserver.destroy(),this.hostChangeObserver.destroy(),this.gridModeChangeObserver.destroy(),this.followParticipantObserver.destroy(),this.bricklayer=null,this.frameState=null}toggleChat(){this.messageBridge.publish("meeting-controls.toggle-chat")}toggleMeetingSetup(){this.messageBridge.publish("meeting-controls.toggle-setup")}toggleMicrophone(){this.messageBridge.publish("meeting-controls.toggle-microphone")}toggleScreenShare(){this.messageBridge.publish("meeting-controls.toggle-screenshare")}hangUp(){this.messageBridge.publish("hang-up")}toggleCam(){this.messageBridge.publish("meeting-controls.toggle-cam")}startTranscription(r){this.messageBridge.publish("transcription.start",r)}stopTranscription(){this.messageBridge.publish("transcription.stop")}};var BC=yf(),Vo=class{constructor({conferenceLayerUrl:r,apiUrl:n,apiKey:u,debug:o=!1,language:v,roomId:E,ablyKey:c,group:d,participant:y,shouldKickParticipantsOnHostLeave:S,camsOff:I,screenshareOff:s,chatOff:b,defaultAvatars:T,offset:P,enableFollow:C,enableGoTo:m,enableGather:R,defaultToolbar:l,locales:p,avatars:h,devices:A,customColors:f,waterMark:O,camerasPosition:w,skipMeetingSettings:x=!1,disableCameraOverlay:V=!1,layoutPosition:H}){this.integrationManager=null;this.observerHelpers={};this.hasJoined=!1;this.participantList=[];this.isBroadcast=!1;this.setSyncProperty=(r,n)=>{this.realtime.setSyncProperty(r,n)};this.subscribe=(r,n)=>{this.observerHelpers[r]||(this.observerHelpers[r]=new bf.ObserverHelper),this.observerHelpers[r].subscribe(n)};this.unsubscribe=r=>{this.observerHelpers[r]&&(this.observerHelpers[r].reset(),delete this.observerHelpers[r])};this.startVideo=r=>{this.videoManager=new Mr(r),this.videoManager.frameStateObserver.subscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.subscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.subscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.subscribe(this.onFollowParticipantDidChange),this.videoManager.goToParticipantObserver.subscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.subscribe(this.onGatherDidChange),this.videoManager.gridModeChangeObserver.subscribe(this.onGridModeDidChange),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.subscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.participantLeftObserver.subscribe(this.onMyParticipantLeft),this.videoManager.participantAvatarObserver.subscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus)};this.startTranscription=r=>{this.videoManager.startTranscription(r)};this.stopTranscription=()=>{this.videoManager.stopTranscription()};this.publish=(r,n)=>{r in this.observerHelpers&&this.observerHelpers[r].publish(n)};this.onSyncPropertiesDidChange=r=>{Object.entries(r).forEach(([n,u])=>{this.publish(n,u)})};this.onKickAllParticipantsDidChange=r=>{this.publish("meeting.kick-all-participants",r),this.destroy()};this.onRealtimeJoin=r=>{this.realtime.join(r)};this.onHostDidChange=r=>{let n=this.participantList.find(u=>u.id===r);this.realtime.setHost(r),this.setSyncProperty("meeting.host-change",n)};this.onFollowParticipantDidChange=r=>{this.realtime.setFollowParticipant(r),this.setSyncProperty("realtime.follow-participant",r)};this.onGoToParticipantDidChange=r=>{var n;(n=this.integrationManager)==null||n.goToParticipant(r),this.setSyncProperty("realtime.go-to-participant",r)};this.onGatherDidChange=()=>{this.realtime.setGather(!0),this.setSyncProperty("realtime.gather")};this.onFrameStateDidChange=r=>{r===2&&this.start()};this.onFrameSizeDidChange=r=>{this.publish("frame.dimensions-update",r)};this.onRoomInfoUpdated=r=>{let{isGridModeEnable:n,followParticipantId:u,gather:o}=r;this.videoManager.gridModeDidChange(n),this.videoManager.followParticipantDidChange(u),this.realtime.hostClientId===this.participant.id&&o&&this.realtime.setGather(!1)};this.onParticipantsDidChange=r=>{r[this.participant.id]&&!this.hasJoined&&(this.hasJoined=!0);let n=Object.values(r).map(u=>({timestamp:u.timestamp,connectionId:u.connectionId,participantId:u.clientId,color:this.realtime.getSlotColor(u.data.slotIndex).name,name:u.data.name}));this.participantList=this.updateParticipantListFromParticipants(r),this.publish("meeting.participant-list-update",this.participantList),this.videoManager.participantsListDidChange(n)};this.onMasterParticipantDidChange=r=>{this.videoManager.onMasterParticipantDidChange(r==null?void 0:r.newMasterParticipantParticipantId)};this.onGridModeDidChange=r=>{this.realtime.setGridMode(r)};this.updateParticipantListFromParticipants=r=>{let n=[];return Object.values(r).forEach(u=>{var o;n.push({id:u.clientId,color:this.realtime.getSlotColor((o=u.data)==null?void 0:o.slotIndex).color,avatarConfig:u.data.avatarConfig,avatar:u.data.avatar,type:u.data.type,name:u.data.name,isHost:this.realtime.hostClientId===u.clientId})}),n};this.onSameAccountError=r=>{this.publish("meeting.same-participant-error",r),this.destroy()};this.onDevicesChange=r=>{this.publish("meeting.devices-change",r)};this.onParticipantAmountUpdate=r=>{this.publish("meeting.amount-of-participants-update",r)};this.onParticipantJoined=r=>{this.checkBroadcastMode();let n=this.participantList.find(u=>u.id===r.data.id);!n||(n.id===this.participant.id&&this.publish("my-participant.joined",n),this.publish("meeting.participant-joined",n))};this.onParticipantLeft=r=>{let n=this.participantList.find(u=>u.id===r.data.id);this.publish("meeting.participant-left",n)};this.onMyParticipantLeft=r=>{this.publish("my-participant.left",r),this.destroy()};this.onParticipantAvatarUpdate=r=>{this.participant.avatar.model=r};this.onParticipantListUpdate=r=>{let n=r.find(u=>u.id===this.participant.id);(0,Cf.default)(n,this.participant)||(this.participant=Object.assign({},this.participant,n),this.publish("my-participant.update",this.participant))};this.onAuthenticationFailed=r=>{this.publish("realtime.authentication-failed",r),this.destroy()};this.onMeetingStateUpdate=r=>{Ae.log("MEETING STATE",r),this.publish("meeting.state-update",r)};this.onConnectionStatusChange=r=>{let n=[2,4,3,6];n.includes(r)&&this.realtime.freezeSync(!0),n.includes(this.connectionService.oldConnectionStatus)&&!n.includes(r)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",r)};var D;this.roomId=E,this.group=d,this.participant=y,this.realtime=new $n(n,c),this.browserService=new br;let B=!I,M=!s,L=!b,k=!!T&&!((D=y==null?void 0:y.avatar)!=null&&D.model),W=l!=null?l:!0,K=!!C,$=!!m,Y=!!R;(y==null?void 0:y.avatar)===void 0&&(this.participant=Object.assign({},this.participant,{avatar:{model:""}}));let G="right";this.connectionService=new Fi,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange),this.startVideo({conferenceLayerUrl:r,canUseChat:L,canUseCams:B,canUseScreenshare:M,canUseDefaultAvatars:k,canUseFollow:K,canUseGoTo:$,canUseGather:Y,canUseDefaultToolbar:W,devices:A,ablyKey:c,apiKey:u,apiUrl:n,debug:o,language:v,roomId:E,position:G,browserService:this.browserService,offset:P,locales:p!=null?p:[],avatars:h!=null?h:[],customColors:f,waterMark:O,camerasPosition:w,skipMeetingSettings:x,disableCameraOverlay:V,layoutPosition:H}),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onParticipantsDidChange),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeft),this.realtime.masterParticipantObserver.subscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.subscribe(this.onAuthenticationFailed),this.realtime.start({initialParticipantData:Lt({participantId:this.participant.id},this.participant),roomId:this.roomId,apiKey:u,shouldKickParticipantsOnHostLeave:S!=null?S:!0,isBroadcast:this.isBroadcast})}get isIntegrationManagerInitialized(){return!!this.integrationManager}checkBroadcastMode(){this.isBroadcast=this.participantList.some(r=>r.type==="audience")}start(){Ae.log("SUPERVIZ SDK VERSION",BC.version),this.videoManager.start({roomId:this.roomId,participant:this.participant,group:this.group})}destroy(){this.publish("destroy",void 0),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.unsubscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.unsubscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.unsubscribe(this.onFollowParticipantDidChange),this.videoManager.gridModeChangeObserver.unsubscribe(this.onGridModeDidChange),this.videoManager.goToParticipantObserver.unsubscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.unsubscribe(this.onGatherDidChange),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.unsubscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.participantLeftObserver.unsubscribe(this.onMyParticipantLeft),this.videoManager.participantAvatarObserver.unsubscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onParticipantsDidChange),this.realtime.masterParticipantObserver.unsubscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.unsubscribe(this.onAuthenticationFailed),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeft),this.connectionService.connectionStatusObserver.unsubscribe(this.onConnectionStatusChange),Object.keys(this.observerHelpers).forEach(r=>this.unsubscribe(r)),this.videoManager.leave(),this.realtime.leave(),this.connectionService.removeListeners(),this.hasJoined=!1,this.unloadPlugin()}toggleChat(){this.videoManager.toggleChat()}toggleMeetingSetup(){this.videoManager.toggleMeetingSetup()}toggleCam(){this.videoManager.toggleCam()}toggleMicrophone(){this.videoManager.toggleMicrophone()}toggleScreenShare(){this.videoManager.toggleScreenShare()}hangUp(){this.videoManager.hangUp()}follow(r){this.videoManager.followParticipantDidChange(r),this.realtime.setFollowParticipant(r)}fetchSyncClientProperty(r){return this.realtime.fetchSyncClientProperty(r)}gather(){this.realtime.setGather(!0)}goTo(r){this.integrationManager.goToParticipant(r)}loadPlugin(r,n){var o,v,E,c,d,y;if(this.isIntegrationManagerInitialized)throw new Error("the 3D plugin has already been started");n.avatarConfig&&this.realtime.setParticipantData({avatarConfig:n.avatarConfig}),this.participant.avatar&&this.participant.avatar.model&&this.realtime.setParticipantData({avatar:{model:this.participant.avatar.model}});let u=[];return this.realtime.getParticipants&&(u=Object.values(this.realtime.getParticipants)),this.integrationManager=new Hi(yi(Lt({plugin:r},n),{localParticipant:{id:this.participant.id,name:this.participant.name,avatar:this.participant.avatar,avatarConfig:n.avatarConfig},participantList:u.map(S=>{let I=S.clientId,{name:s,avatar:b,avatarConfig:T,slotIndex:P,isAudience:C}=S.data;return{id:I,name:s,avatar:b,avatarConfig:T,slotIndex:P,isAudience:C}}),RealtimeService:this.realtime})),{enableAvatars:(o=this.integrationManager)==null?void 0:o.enableAvatars,disableAvatars:(v=this.integrationManager)==null?void 0:v.disableAvatars,enableMouse:(E=this.integrationManager)==null?void 0:E.enableMouse,disableMouse:(c=this.integrationManager)==null?void 0:c.disableMouse,enableLaser:(d=this.integrationManager)==null?void 0:d.enableLaser,disableLaser:(y=this.integrationManager)==null?void 0:y.disableLaser,getParticipantsOn3D:()=>{var S;return(S=this.integrationManager)!=null&&S.participants?this.integrationManager.participants:[]},getAvatars:()=>{var S;return(S=this.integrationManager)==null?void 0:S.getAvatars}}}unloadPlugin(){this.integrationManager&&(this.integrationManager.plugin.destroy(),this.integrationManager=null)}},Of=i=>{let r=new Vo(i);return{setSyncProperty:(n,u)=>r.setSyncProperty(n,u),subscribe:(n,u)=>r.subscribe(n,u),unsubscribe:n=>r.unsubscribe(n),destroy:()=>r.destroy(),follow:n=>r.follow(n),fetchSyncProperty:n=>r.fetchSyncClientProperty(n),gather:()=>r.gather(),goTo:n=>r.goTo(n),toggleMeetingSetup:()=>r.toggleMeetingSetup(),toggleMicrophone:()=>r.toggleMicrophone(),toggleCam:()=>r.toggleCam(),toggleScreenShare:()=>r.toggleScreenShare(),hangUp:()=>r.hangUp(),toggleChat:()=>r.toggleChat(),startTranscription:n=>r.startTranscription(n),stopTranscription:()=>r.stopTranscription(),loadPlugin:(n,u)=>r.loadPlugin(n,u),unloadPlugin:()=>r.unloadPlugin()}};ae();ae();ae();ae();ae();ae();var Ef="beta";var er=class{static getRemoteConfig(){return ke(this,arguments,function*(r="prod"){if(r==="local"){let{remoteConfig:o}=yield Promise.resolve().then(()=>(If(),Sf));return o}let n={version:Ef,environment:r},u=this.createUrl(n);return Sn(u,"GET",null)})}static createUrl({version:r,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${r}?env=${n}`}};er.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";var NC=({group:i,participant:r,roomId:n,customColors:u,skipMeetingSettings:o})=>{if(u&&FC(u),!i||!i.name||!i.id)throw new Error("group fields is required");if(!r||!r.id)throw new Error("participant fields is required");if(!n)throw new Error("room id is required");if(o&&!r.name)throw new Error("When skipMeetingSettings is true, participant name is required")},FC=i=>{Object.entries(i).forEach(([r,n])=>{if(!Object.values(ko).includes(r))throw new Error(`Color ${r} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(n))throw new Error(`Color ${r} is not a valid color variable value. Please check the documentation for more information.`)})},Rf=(i,r)=>ke(void 0,null,function*(){NC(r),r.debug&&Ae.enable("@superviz/*");let{apiUrl:n,conferenceLayerUrl:u}=yield er.getRemoteConfig(r.environment);if(!(yield zc(n,i)))throw new Error("Failed to validate API key");let v=yield fn.fetchConfig(n,i),E=yield fn.fetchWaterMark(n,i),{layoutPosition:c}=r;if(!v||!v.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:d}=v;return Of(Object.assign({},r,{apiKey:i,ablyKey:d,conferenceLayerUrl:u,apiUrl:n,waterMark:E,layoutPosition:c}))});window&&(window.SuperVizSdk={init:Rf,MeetingEvent:vr,DeviceEvent:fo,RealtimeEvent:zn,MeetingState:Ci,MeetingConnectionStatus:mr,MeetingControlsEvent:bi});var AS={init:Rf};export{br as BrowserService,fo as DeviceEvent,mr as MeetingConnectionStatus,bi as MeetingControlsEvent,vr as MeetingEvent,Ci as MeetingState,ho as ParticipantType,zn as RealtimeEvent,AS as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
