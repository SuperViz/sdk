var p0=Object.create;var pr=Object.defineProperty,g0=Object.defineProperties,gl=Object.getOwnPropertyDescriptor,v0=Object.getOwnPropertyDescriptors,m0=Object.getOwnPropertyNames,hl=Object.getOwnPropertySymbols,y0=Object.getPrototypeOf,vl=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable;var pl=(h,o,n)=>o in h?pr(h,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[o]=n,Ue=(h,o)=>{for(var n in o||(o={}))vl.call(o,n)&&pl(h,n,o[n]);if(hl)for(var n of hl(o))A0.call(o,n)&&pl(h,n,o[n]);return h},gr=(h,o)=>g0(h,v0(o));var Jo=(h,o)=>()=>(h&&(o=h(h=0)),o);var Vt=(h,o)=>()=>(o||h((o={exports:{}}).exports,o),o.exports),ml=(h,o)=>{for(var n in o)pr(h,n,{get:o[n],enumerable:!0})},b0=(h,o,n,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of m0(o))!vl.call(h,i)&&i!==n&&pr(h,i,{get:()=>o[i],enumerable:!(s=gl(o,i))||s.enumerable});return h};var on=(h,o,n)=>(n=h!=null?p0(y0(h)):{},b0(o||!h||!h.__esModule?pr(n,"default",{value:h,enumerable:!0}):n,h));var yl=(h,o,n,s)=>{for(var i=s>1?void 0:s?gl(o,n):o,S=h.length-1,A;S>=0;S--)(A=h[S])&&(i=(s?A(o,n,i):A(i))||i);return s&&i&&pr(o,n,i),i};var Qt=(h,o,n)=>new Promise((s,i)=>{var S=d=>{try{c(n.next(d))}catch(b){i(b)}},A=d=>{try{c(n.throw(d))}catch(b){i(b)}},c=d=>d.done?s(d.value):Promise.resolve(d.value).then(S,A);c((n=n.apply(h,o)).next())});var dt,nt=Jo(()=>{dt={}});var bl=Vt(($y,Al)=>{nt();var zn=1e3,$n=zn*60,jn=$n*60,yn=jn*24,S0=yn*7,O0=yn*365.25;Al.exports=function(h,o){o=o||{};var n=typeof h;if(n==="string"&&h.length>0)return R0(h);if(n==="number"&&isFinite(h))return o.long?T0(h):E0(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function R0(h){if(h=String(h),!(h.length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(!!o){var n=parseFloat(o[1]),s=(o[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*O0;case"weeks":case"week":case"w":return n*S0;case"days":case"day":case"d":return n*yn;case"hours":case"hour":case"hrs":case"hr":case"h":return n*jn;case"minutes":case"minute":case"mins":case"min":case"m":return n*$n;case"seconds":case"second":case"secs":case"sec":case"s":return n*zn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function E0(h){var o=Math.abs(h);return o>=yn?Math.round(h/yn)+"d":o>=jn?Math.round(h/jn)+"h":o>=$n?Math.round(h/$n)+"m":o>=zn?Math.round(h/zn)+"s":h+"ms"}function T0(h){var o=Math.abs(h);return o>=yn?gi(h,o,yn,"day"):o>=jn?gi(h,o,jn,"hour"):o>=$n?gi(h,o,$n,"minute"):o>=zn?gi(h,o,zn,"second"):h+" ms"}function gi(h,o,n,s){var i=o>=n*1.5;return Math.round(h/n)+" "+s+(i?"s":"")}});var Sl=Vt((jy,Cl)=>{nt();function _0(h){n.debug=n,n.default=n,n.coerce=d,n.disable=S,n.enable=i,n.enabled=A,n.humanize=bl(),n.destroy=b,Object.keys(h).forEach(E=>{n[E]=h[E]}),n.names=[],n.skips=[],n.formatters={};function o(E){let R=0;for(let a=0;a<E.length;a++)R=(R<<5)-R+E.charCodeAt(a),R|=0;return n.colors[Math.abs(R)%n.colors.length]}n.selectColor=o;function n(E){let R,a=null,O,M;function w(...C){if(!w.enabled)return;let m=w,T=Number(new Date),u=T-(R||T);m.diff=u,m.prev=R,m.curr=T,R=T,C[0]=n.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let v=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(p,l)=>{if(p==="%%")return"%";v++;let y=n.formatters[l];if(typeof y=="function"){let P=C[v];p=y.call(m,P),C.splice(v,1),v--}return p}),n.formatArgs.call(m,C),(m.log||n.log).apply(m,C)}return w.namespace=E,w.useColors=n.useColors(),w.color=n.selectColor(E),w.extend=s,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(O!==n.namespaces&&(O=n.namespaces,M=n.enabled(E)),M),set:C=>{a=C}}),typeof n.init=="function"&&n.init(w),w}function s(E,R){let a=n(this.namespace+(typeof R=="undefined"?":":R)+E);return a.log=this.log,a}function i(E){n.save(E),n.namespaces=E,n.names=[],n.skips=[];let R,a=(typeof E=="string"?E:"").split(/[\s,]+/),O=a.length;for(R=0;R<O;R++)!a[R]||(E=a[R].replace(/\*/g,".*?"),E[0]==="-"?n.skips.push(new RegExp("^"+E.slice(1)+"$")):n.names.push(new RegExp("^"+E+"$")))}function S(){let E=[...n.names.map(c),...n.skips.map(c).map(R=>"-"+R)].join(",");return n.enable(""),E}function A(E){if(E[E.length-1]==="*")return!0;let R,a;for(R=0,a=n.skips.length;R<a;R++)if(n.skips[R].test(E))return!1;for(R=0,a=n.names.length;R<a;R++)if(n.names[R].test(E))return!0;return!1}function c(E){return E.toString().substring(2,E.toString().length-2).replace(/\.\*\?$/,"*")}function d(E){return E instanceof Error?E.stack||E.message:E}function b(){}return n.enable(n.load()),n}Cl.exports=_0});var ts=Vt((Ae,vi)=>{nt();Ae.formatArgs=I0;Ae.save=w0;Ae.load=M0;Ae.useColors=P0;Ae.storage=x0();Ae.destroy=(()=>{let h=!1;return()=>{h||(h=!0)}})();Ae.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function P0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function I0(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+vi.exports.humanize(this.diff),!this.useColors)return;let o="color: "+this.color;h.splice(1,0,o,"color: inherit");let n=0,s=0;h[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(n++,i==="%c"&&(s=n))}),h.splice(s,0,o)}Ae.log=console.debug||console.log||(()=>{});function w0(h){try{h?Ae.storage.setItem("debug",h):Ae.storage.removeItem("debug")}catch(o){}}function M0(){let h;try{h=Ae.storage.getItem("debug")}catch(o){}return!h&&typeof process!="undefined"&&"env"in process&&(h=dt.DEBUG),h}function x0(){try{return localStorage}catch(h){}}vi.exports=Sl()(Ae);var{formatters:L0}=vi.exports;L0.j=function(h){try{return JSON.stringify(h)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}}});var mi=Vt((Jy,Rl)=>{nt();function D0(h){var o=typeof h;return h!=null&&(o=="object"||o=="function")}Rl.exports=D0});var Tl=Vt((qy,El)=>{nt();var N0=typeof global=="object"&&global&&global.Object===Object&&global;El.exports=N0});var es=Vt((Qy,_l)=>{nt();var U0=Tl(),B0=typeof self=="object"&&self&&self.Object===Object&&self,F0=U0||B0||Function("return this")();_l.exports=F0});var Il=Vt((Yy,Pl)=>{nt();var G0=es(),H0=function(){return G0.Date.now()};Pl.exports=H0});var Ml=Vt((Xy,wl)=>{nt();var W0=/\s/;function k0(h){for(var o=h.length;o--&&W0.test(h.charAt(o)););return o}wl.exports=k0});var Ll=Vt((Zy,xl)=>{nt();var z0=Ml(),$0=/^\s+/;function j0(h){return h&&h.slice(0,z0(h)+1).replace($0,"")}xl.exports=j0});var ns=Vt((tA,Dl)=>{nt();var V0=es(),K0=V0.Symbol;Dl.exports=K0});var Fl=Vt((eA,Bl)=>{nt();var Nl=ns(),Ul=Object.prototype,J0=Ul.hasOwnProperty,q0=Ul.toString,mr=Nl?Nl.toStringTag:void 0;function Q0(h){var o=J0.call(h,mr),n=h[mr];try{h[mr]=void 0;var s=!0}catch(S){}var i=q0.call(h);return s&&(o?h[mr]=n:delete h[mr]),i}Bl.exports=Q0});var Hl=Vt((nA,Gl)=>{nt();var Y0=Object.prototype,X0=Y0.toString;function Z0(h){return X0.call(h)}Gl.exports=Z0});var $l=Vt((rA,zl)=>{nt();var Wl=ns(),ty=Fl(),ey=Hl(),ny="[object Null]",ry="[object Undefined]",kl=Wl?Wl.toStringTag:void 0;function iy(h){return h==null?h===void 0?ry:ny:kl&&kl in Object(h)?ty(h):ey(h)}zl.exports=iy});var Vl=Vt((iA,jl)=>{nt();function oy(h){return h!=null&&typeof h=="object"}jl.exports=oy});var Jl=Vt((oA,Kl)=>{nt();var sy=$l(),ay=Vl(),uy="[object Symbol]";function ly(h){return typeof h=="symbol"||ay(h)&&sy(h)==uy}Kl.exports=ly});var Xl=Vt((sA,Yl)=>{nt();var cy=Ll(),ql=mi(),fy=Jl(),Ql=0/0,dy=/^[-+]0x[0-9a-f]+$/i,hy=/^0b[01]+$/i,py=/^0o[0-7]+$/i,gy=parseInt;function vy(h){if(typeof h=="number")return h;if(fy(h))return Ql;if(ql(h)){var o=typeof h.valueOf=="function"?h.valueOf():h;h=ql(o)?o+"":o}if(typeof h!="string")return h===0?h:+h;h=cy(h);var n=hy.test(h);return n||py.test(h)?gy(h.slice(2),n?2:8):dy.test(h)?Ql:+h}Yl.exports=vy});var ec=Vt((aA,tc)=>{nt();var my=mi(),rs=Il(),Zl=Xl(),yy="Expected a function",Ay=Math.max,by=Math.min;function Cy(h,o,n){var s,i,S,A,c,d,b=0,E=!1,R=!1,a=!0;if(typeof h!="function")throw new TypeError(yy);o=Zl(o)||0,my(n)&&(E=!!n.leading,R="maxWait"in n,S=R?Ay(Zl(n.maxWait)||0,o):S,a="trailing"in n?!!n.trailing:a);function O(p){var l=s,y=i;return s=i=void 0,b=p,A=h.apply(y,l),A}function M(p){return b=p,c=setTimeout(m,o),E?O(p):A}function w(p){var l=p-d,y=p-b,P=o-l;return R?by(P,S-y):P}function C(p){var l=p-d,y=p-b;return d===void 0||l>=o||l<0||R&&y>=S}function m(){var p=rs();if(C(p))return T(p);c=setTimeout(m,w(p))}function T(p){return c=void 0,a&&s?O(p):(s=i=void 0,A)}function u(){c!==void 0&&clearTimeout(c),b=0,s=d=i=c=void 0}function v(){return c===void 0?A:T(rs())}function f(){var p=rs(),l=C(p);if(s=arguments,i=this,d=p,l){if(c===void 0)return M(d);if(R)return clearTimeout(c),c=setTimeout(m,o),O(d)}return c===void 0&&(c=setTimeout(m,o)),A}return f.cancel=u,f.flush=v,f}tc.exports=Cy});var is=Vt((uA,nc)=>{nt();var Sy=ec(),Oy=mi(),Ry="Expected a function";function Ey(h,o,n){var s=!0,i=!0;if(typeof h!="function")throw new TypeError(Ry);return Oy(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),Sy(h,o,{leading:s,maxWait:o,trailing:i})}nc.exports=Ey});var os=Vt((Vn,yr)=>{nt();(function(){var h,o="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",S="Invalid `variable` option passed into `_.template`",A="__lodash_hash_undefined__",c=500,d="__lodash_placeholder__",b=1,E=2,R=4,a=1,O=2,M=1,w=2,C=4,m=8,T=16,u=32,v=64,f=128,p=256,l=512,y=30,P="...",D=800,k=16,H=1,U=2,_=3,x=1/0,z=9007199254740991,W=17976931348623157e292,J=0/0,Z=4294967295,Q=Z-1,G=Z>>>1,N=[["ary",f],["bind",M],["bindKey",w],["curry",m],["curryRight",T],["flip",l],["partial",u],["partialRight",v],["rearg",p]],B="[object Arguments]",V="[object Array]",j="[object AsyncFunction]",tt="[object Boolean]",lt="[object Date]",mt="[object DOMException]",vt="[object Error]",Ot="[object Function]",xt="[object GeneratorFunction]",ft="[object Map]",Mt="[object Number]",Yt="[object Null]",Ut="[object Object]",Ht="[object Promise]",ue="[object Proxy]",X="[object RegExp]",it="[object Set]",ut="[object String]",pt="[object Symbol]",Et="[object Undefined]",Kt="[object WeakMap]",un="[object WeakSet]",Xn="[object ArrayBuffer]",In="[object DataView]",Ti="[object Float32Array]",_i="[object Float64Array]",Pi="[object Int8Array]",Ii="[object Int16Array]",wi="[object Int32Array]",Mi="[object Uint8Array]",xi="[object Uint8ClampedArray]",Li="[object Uint16Array]",Di="[object Uint32Array]",Dc=/\b__p \+= '';/g,Nc=/\b(__p \+=) '' \+/g,Uc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Fs=/&(?:amp|lt|gt|quot|#39);/g,Gs=/[&<>"']/g,Bc=RegExp(Fs.source),Fc=RegExp(Gs.source),Gc=/<%-([\s\S]+?)%>/g,Hc=/<%([\s\S]+?)%>/g,Hs=/<%=([\s\S]+?)%>/g,Wc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kc=/^\w*$/,zc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ni=/[\\^$.*+?()[\]{}|]/g,$c=RegExp(Ni.source),Ui=/^\s+/,jc=/\s/,Vc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Kc=/\{\n\/\* \[wrapped with (.+)\] \*/,Jc=/,? & /,qc=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Qc=/[()=,{}\[\]\/\s]/,Yc=/\\(\\)?/g,Xc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ws=/\w*$/,Zc=/^[-+]0x[0-9a-f]+$/i,tf=/^0b[01]+$/i,ef=/^\[object .+?Constructor\]$/,nf=/^0o[0-7]+$/i,rf=/^(?:0|[1-9]\d*)$/,of=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Tr=/($^)/,sf=/['\n\r\u2028\u2029\\]/g,_r="\\ud800-\\udfff",af="\\u0300-\\u036f",uf="\\ufe20-\\ufe2f",lf="\\u20d0-\\u20ff",ks=af+uf+lf,zs="\\u2700-\\u27bf",$s="a-z\\xdf-\\xf6\\xf8-\\xff",cf="\\xac\\xb1\\xd7\\xf7",ff="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",df="\\u2000-\\u206f",hf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",js="A-Z\\xc0-\\xd6\\xd8-\\xde",Vs="\\ufe0e\\ufe0f",Ks=cf+ff+df+hf,Bi="['\u2019]",pf="["+_r+"]",Js="["+Ks+"]",Pr="["+ks+"]",qs="\\d+",gf="["+zs+"]",Qs="["+$s+"]",Ys="[^"+_r+Ks+qs+zs+$s+js+"]",Fi="\\ud83c[\\udffb-\\udfff]",vf="(?:"+Pr+"|"+Fi+")",Xs="[^"+_r+"]",Gi="(?:\\ud83c[\\udde6-\\uddff]){2}",Hi="[\\ud800-\\udbff][\\udc00-\\udfff]",wn="["+js+"]",Zs="\\u200d",ta="(?:"+Qs+"|"+Ys+")",mf="(?:"+wn+"|"+Ys+")",ea="(?:"+Bi+"(?:d|ll|m|re|s|t|ve))?",na="(?:"+Bi+"(?:D|LL|M|RE|S|T|VE))?",ra=vf+"?",ia="["+Vs+"]?",yf="(?:"+Zs+"(?:"+[Xs,Gi,Hi].join("|")+")"+ia+ra+")*",Af="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",oa=ia+ra+yf,Cf="(?:"+[gf,Gi,Hi].join("|")+")"+oa,Sf="(?:"+[Xs+Pr+"?",Pr,Gi,Hi,pf].join("|")+")",Of=RegExp(Bi,"g"),Rf=RegExp(Pr,"g"),Wi=RegExp(Fi+"(?="+Fi+")|"+Sf+oa,"g"),Ef=RegExp([wn+"?"+Qs+"+"+ea+"(?="+[Js,wn,"$"].join("|")+")",mf+"+"+na+"(?="+[Js,wn+ta,"$"].join("|")+")",wn+"?"+ta+"+"+ea,wn+"+"+na,bf,Af,qs,Cf].join("|"),"g"),Tf=RegExp("["+Zs+_r+ks+Vs+"]"),_f=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Pf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],If=-1,Gt={};Gt[Ti]=Gt[_i]=Gt[Pi]=Gt[Ii]=Gt[wi]=Gt[Mi]=Gt[xi]=Gt[Li]=Gt[Di]=!0,Gt[B]=Gt[V]=Gt[Xn]=Gt[tt]=Gt[In]=Gt[lt]=Gt[vt]=Gt[Ot]=Gt[ft]=Gt[Mt]=Gt[Ut]=Gt[X]=Gt[it]=Gt[ut]=Gt[Kt]=!1;var Ft={};Ft[B]=Ft[V]=Ft[Xn]=Ft[In]=Ft[tt]=Ft[lt]=Ft[Ti]=Ft[_i]=Ft[Pi]=Ft[Ii]=Ft[wi]=Ft[ft]=Ft[Mt]=Ft[Ut]=Ft[X]=Ft[it]=Ft[ut]=Ft[pt]=Ft[Mi]=Ft[xi]=Ft[Li]=Ft[Di]=!0,Ft[vt]=Ft[Ot]=Ft[Kt]=!1;var wf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Mf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Lf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Df=parseFloat,Nf=parseInt,sa=typeof global=="object"&&global&&global.Object===Object&&global,Uf=typeof self=="object"&&self&&self.Object===Object&&self,Xt=sa||Uf||Function("return this")(),ki=typeof Vn=="object"&&Vn&&!Vn.nodeType&&Vn,ln=ki&&typeof yr=="object"&&yr&&!yr.nodeType&&yr,aa=ln&&ln.exports===ki,zi=aa&&sa.process,be=function(){try{var q=ln&&ln.require&&ln.require("util").types;return q||zi&&zi.binding&&zi.binding("util")}catch(rt){}}(),ua=be&&be.isArrayBuffer,la=be&&be.isDate,ca=be&&be.isMap,fa=be&&be.isRegExp,da=be&&be.isSet,ha=be&&be.isTypedArray;function he(q,rt,et){switch(et.length){case 0:return q.call(rt);case 1:return q.call(rt,et[0]);case 2:return q.call(rt,et[0],et[1]);case 3:return q.call(rt,et[0],et[1],et[2])}return q.apply(rt,et)}function Bf(q,rt,et,ht){for(var Ct=-1,Lt=q==null?0:q.length;++Ct<Lt;){var Jt=q[Ct];rt(ht,Jt,et(Jt),q)}return ht}function Ce(q,rt){for(var et=-1,ht=q==null?0:q.length;++et<ht&&rt(q[et],et,q)!==!1;);return q}function Ff(q,rt){for(var et=q==null?0:q.length;et--&&rt(q[et],et,q)!==!1;);return q}function pa(q,rt){for(var et=-1,ht=q==null?0:q.length;++et<ht;)if(!rt(q[et],et,q))return!1;return!0}function Je(q,rt){for(var et=-1,ht=q==null?0:q.length,Ct=0,Lt=[];++et<ht;){var Jt=q[et];rt(Jt,et,q)&&(Lt[Ct++]=Jt)}return Lt}function Ir(q,rt){var et=q==null?0:q.length;return!!et&&Mn(q,rt,0)>-1}function $i(q,rt,et){for(var ht=-1,Ct=q==null?0:q.length;++ht<Ct;)if(et(rt,q[ht]))return!0;return!1}function Wt(q,rt){for(var et=-1,ht=q==null?0:q.length,Ct=Array(ht);++et<ht;)Ct[et]=rt(q[et],et,q);return Ct}function qe(q,rt){for(var et=-1,ht=rt.length,Ct=q.length;++et<ht;)q[Ct+et]=rt[et];return q}function ji(q,rt,et,ht){var Ct=-1,Lt=q==null?0:q.length;for(ht&&Lt&&(et=q[++Ct]);++Ct<Lt;)et=rt(et,q[Ct],Ct,q);return et}function Gf(q,rt,et,ht){var Ct=q==null?0:q.length;for(ht&&Ct&&(et=q[--Ct]);Ct--;)et=rt(et,q[Ct],Ct,q);return et}function Vi(q,rt){for(var et=-1,ht=q==null?0:q.length;++et<ht;)if(rt(q[et],et,q))return!0;return!1}var Hf=Ki("length");function Wf(q){return q.split("")}function kf(q){return q.match(qc)||[]}function ga(q,rt,et){var ht;return et(q,function(Ct,Lt,Jt){if(rt(Ct,Lt,Jt))return ht=Lt,!1}),ht}function wr(q,rt,et,ht){for(var Ct=q.length,Lt=et+(ht?1:-1);ht?Lt--:++Lt<Ct;)if(rt(q[Lt],Lt,q))return Lt;return-1}function Mn(q,rt,et){return rt===rt?td(q,rt,et):wr(q,va,et)}function zf(q,rt,et,ht){for(var Ct=et-1,Lt=q.length;++Ct<Lt;)if(ht(q[Ct],rt))return Ct;return-1}function va(q){return q!==q}function ma(q,rt){var et=q==null?0:q.length;return et?qi(q,rt)/et:J}function Ki(q){return function(rt){return rt==null?h:rt[q]}}function Ji(q){return function(rt){return q==null?h:q[rt]}}function ya(q,rt,et,ht,Ct){return Ct(q,function(Lt,Jt,Bt){et=ht?(ht=!1,Lt):rt(et,Lt,Jt,Bt)}),et}function $f(q,rt){var et=q.length;for(q.sort(rt);et--;)q[et]=q[et].value;return q}function qi(q,rt){for(var et,ht=-1,Ct=q.length;++ht<Ct;){var Lt=rt(q[ht]);Lt!==h&&(et=et===h?Lt:et+Lt)}return et}function Qi(q,rt){for(var et=-1,ht=Array(q);++et<q;)ht[et]=rt(et);return ht}function jf(q,rt){return Wt(rt,function(et){return[et,q[et]]})}function Aa(q){return q&&q.slice(0,Oa(q)+1).replace(Ui,"")}function pe(q){return function(rt){return q(rt)}}function Yi(q,rt){return Wt(rt,function(et){return q[et]})}function Zn(q,rt){return q.has(rt)}function ba(q,rt){for(var et=-1,ht=q.length;++et<ht&&Mn(rt,q[et],0)>-1;);return et}function Ca(q,rt){for(var et=q.length;et--&&Mn(rt,q[et],0)>-1;);return et}function Vf(q,rt){for(var et=q.length,ht=0;et--;)q[et]===rt&&++ht;return ht}var Kf=Ji(wf),Jf=Ji(Mf);function qf(q){return"\\"+Lf[q]}function Qf(q,rt){return q==null?h:q[rt]}function xn(q){return Tf.test(q)}function Yf(q){return _f.test(q)}function Xf(q){for(var rt,et=[];!(rt=q.next()).done;)et.push(rt.value);return et}function Xi(q){var rt=-1,et=Array(q.size);return q.forEach(function(ht,Ct){et[++rt]=[Ct,ht]}),et}function Sa(q,rt){return function(et){return q(rt(et))}}function Qe(q,rt){for(var et=-1,ht=q.length,Ct=0,Lt=[];++et<ht;){var Jt=q[et];(Jt===rt||Jt===d)&&(q[et]=d,Lt[Ct++]=et)}return Lt}function Mr(q){var rt=-1,et=Array(q.size);return q.forEach(function(ht){et[++rt]=ht}),et}function Zf(q){var rt=-1,et=Array(q.size);return q.forEach(function(ht){et[++rt]=[ht,ht]}),et}function td(q,rt,et){for(var ht=et-1,Ct=q.length;++ht<Ct;)if(q[ht]===rt)return ht;return-1}function ed(q,rt,et){for(var ht=et+1;ht--;)if(q[ht]===rt)return ht;return ht}function Ln(q){return xn(q)?rd(q):Hf(q)}function Pe(q){return xn(q)?id(q):Wf(q)}function Oa(q){for(var rt=q.length;rt--&&jc.test(q.charAt(rt)););return rt}var nd=Ji(xf);function rd(q){for(var rt=Wi.lastIndex=0;Wi.test(q);)++rt;return rt}function id(q){return q.match(Wi)||[]}function od(q){return q.match(Ef)||[]}var sd=function q(rt){rt=rt==null?Xt:Ye.defaults(Xt.Object(),rt,Ye.pick(Xt,Pf));var et=rt.Array,ht=rt.Date,Ct=rt.Error,Lt=rt.Function,Jt=rt.Math,Bt=rt.Object,Zi=rt.RegExp,ad=rt.String,Se=rt.TypeError,xr=et.prototype,ud=Lt.prototype,Dn=Bt.prototype,Lr=rt["__core-js_shared__"],Dr=ud.toString,Nt=Dn.hasOwnProperty,ld=0,Ra=function(){var t=/[^.]+$/.exec(Lr&&Lr.keys&&Lr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Nr=Dn.toString,cd=Dr.call(Bt),fd=Xt._,dd=Zi("^"+Dr.call(Nt).replace(Ni,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ur=aa?rt.Buffer:h,Xe=rt.Symbol,Br=rt.Uint8Array,Ea=Ur?Ur.allocUnsafe:h,Fr=Sa(Bt.getPrototypeOf,Bt),Ta=Bt.create,_a=Dn.propertyIsEnumerable,Gr=xr.splice,Pa=Xe?Xe.isConcatSpreadable:h,tr=Xe?Xe.iterator:h,cn=Xe?Xe.toStringTag:h,Hr=function(){try{var t=gn(Bt,"defineProperty");return t({},"",{}),t}catch(e){}}(),hd=rt.clearTimeout!==Xt.clearTimeout&&rt.clearTimeout,pd=ht&&ht.now!==Xt.Date.now&&ht.now,gd=rt.setTimeout!==Xt.setTimeout&&rt.setTimeout,Wr=Jt.ceil,kr=Jt.floor,to=Bt.getOwnPropertySymbols,vd=Ur?Ur.isBuffer:h,Ia=rt.isFinite,md=xr.join,yd=Sa(Bt.keys,Bt),qt=Jt.max,re=Jt.min,Ad=ht.now,bd=rt.parseInt,wa=Jt.random,Cd=xr.reverse,eo=gn(rt,"DataView"),er=gn(rt,"Map"),no=gn(rt,"Promise"),Nn=gn(rt,"Set"),nr=gn(rt,"WeakMap"),rr=gn(Bt,"create"),zr=nr&&new nr,Un={},Sd=vn(eo),Od=vn(er),Rd=vn(no),Ed=vn(Nn),Td=vn(nr),$r=Xe?Xe.prototype:h,ir=$r?$r.valueOf:h,Ma=$r?$r.toString:h;function L(t){if(zt(t)&&!St(t)&&!(t instanceof It)){if(t instanceof Oe)return t;if(Nt.call(t,"__wrapped__"))return xu(t)}return new Oe(t)}var Bn=function(){function t(){}return function(e){if(!kt(e))return{};if(Ta)return Ta(e);t.prototype=e;var r=new t;return t.prototype=h,r}}();function jr(){}function Oe(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=h}L.templateSettings={escape:Gc,evaluate:Hc,interpolate:Hs,variable:"",imports:{_:L}},L.prototype=jr.prototype,L.prototype.constructor=L,Oe.prototype=Bn(jr.prototype),Oe.prototype.constructor=Oe;function It(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function _d(){var t=new It(this.__wrapped__);return t.__actions__=le(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=le(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=le(this.__views__),t}function Pd(){if(this.__filtered__){var t=new It(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Id(){var t=this.__wrapped__.value(),e=this.__dir__,r=St(t),g=e<0,I=r?t.length:0,F=Wh(0,I,this.__views__),$=F.start,K=F.end,Y=K-$,ot=g?K:$-1,st=this.__iteratees__,at=st.length,ct=0,gt=re(Y,this.__takeCount__);if(!r||!g&&I==Y&&gt==Y)return eu(t,this.__actions__);var At=[];t:for(;Y--&&ct<gt;){ot+=e;for(var Tt=-1,bt=t[ot];++Tt<at;){var Pt=st[Tt],wt=Pt.iteratee,me=Pt.type,ae=wt(bt);if(me==U)bt=ae;else if(!ae){if(me==H)continue t;break t}}At[ct++]=bt}return At}It.prototype=Bn(jr.prototype),It.prototype.constructor=It;function fn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var g=t[e];this.set(g[0],g[1])}}function wd(){this.__data__=rr?rr(null):{},this.size=0}function Md(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function xd(t){var e=this.__data__;if(rr){var r=e[t];return r===A?h:r}return Nt.call(e,t)?e[t]:h}function Ld(t){var e=this.__data__;return rr?e[t]!==h:Nt.call(e,t)}function Dd(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=rr&&e===h?A:e,this}fn.prototype.clear=wd,fn.prototype.delete=Md,fn.prototype.get=xd,fn.prototype.has=Ld,fn.prototype.set=Dd;function Fe(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var g=t[e];this.set(g[0],g[1])}}function Nd(){this.__data__=[],this.size=0}function Ud(t){var e=this.__data__,r=Vr(e,t);if(r<0)return!1;var g=e.length-1;return r==g?e.pop():Gr.call(e,r,1),--this.size,!0}function Bd(t){var e=this.__data__,r=Vr(e,t);return r<0?h:e[r][1]}function Fd(t){return Vr(this.__data__,t)>-1}function Gd(t,e){var r=this.__data__,g=Vr(r,t);return g<0?(++this.size,r.push([t,e])):r[g][1]=e,this}Fe.prototype.clear=Nd,Fe.prototype.delete=Ud,Fe.prototype.get=Bd,Fe.prototype.has=Fd,Fe.prototype.set=Gd;function Ge(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var g=t[e];this.set(g[0],g[1])}}function Hd(){this.size=0,this.__data__={hash:new fn,map:new(er||Fe),string:new fn}}function Wd(t){var e=ii(this,t).delete(t);return this.size-=e?1:0,e}function kd(t){return ii(this,t).get(t)}function zd(t){return ii(this,t).has(t)}function $d(t,e){var r=ii(this,t),g=r.size;return r.set(t,e),this.size+=r.size==g?0:1,this}Ge.prototype.clear=Hd,Ge.prototype.delete=Wd,Ge.prototype.get=kd,Ge.prototype.has=zd,Ge.prototype.set=$d;function dn(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Ge;++e<r;)this.add(t[e])}function jd(t){return this.__data__.set(t,A),this}function Vd(t){return this.__data__.has(t)}dn.prototype.add=dn.prototype.push=jd,dn.prototype.has=Vd;function Ie(t){var e=this.__data__=new Fe(t);this.size=e.size}function Kd(){this.__data__=new Fe,this.size=0}function Jd(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function qd(t){return this.__data__.get(t)}function Qd(t){return this.__data__.has(t)}function Yd(t,e){var r=this.__data__;if(r instanceof Fe){var g=r.__data__;if(!er||g.length<n-1)return g.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ge(g)}return r.set(t,e),this.size=r.size,this}Ie.prototype.clear=Kd,Ie.prototype.delete=Jd,Ie.prototype.get=qd,Ie.prototype.has=Qd,Ie.prototype.set=Yd;function xa(t,e){var r=St(t),g=!r&&mn(t),I=!r&&!g&&rn(t),F=!r&&!g&&!I&&Wn(t),$=r||g||I||F,K=$?Qi(t.length,ad):[],Y=K.length;for(var ot in t)(e||Nt.call(t,ot))&&!($&&(ot=="length"||I&&(ot=="offset"||ot=="parent")||F&&(ot=="buffer"||ot=="byteLength"||ot=="byteOffset")||ze(ot,Y)))&&K.push(ot);return K}function La(t){var e=t.length;return e?t[po(0,e-1)]:h}function Xd(t,e){return oi(le(t),hn(e,0,t.length))}function Zd(t){return oi(le(t))}function ro(t,e,r){(r!==h&&!we(t[e],r)||r===h&&!(e in t))&&He(t,e,r)}function or(t,e,r){var g=t[e];(!(Nt.call(t,e)&&we(g,r))||r===h&&!(e in t))&&He(t,e,r)}function Vr(t,e){for(var r=t.length;r--;)if(we(t[r][0],e))return r;return-1}function th(t,e,r,g){return Ze(t,function(I,F,$){e(g,I,r(I),$)}),g}function Da(t,e){return t&&De(e,Zt(e),t)}function eh(t,e){return t&&De(e,fe(e),t)}function He(t,e,r){e=="__proto__"&&Hr?Hr(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function io(t,e){for(var r=-1,g=e.length,I=et(g),F=t==null;++r<g;)I[r]=F?h:Go(t,e[r]);return I}function hn(t,e,r){return t===t&&(r!==h&&(t=t<=r?t:r),e!==h&&(t=t>=e?t:e)),t}function Re(t,e,r,g,I,F){var $,K=e&b,Y=e&E,ot=e&R;if(r&&($=I?r(t,g,I,F):r(t)),$!==h)return $;if(!kt(t))return t;var st=St(t);if(st){if($=zh(t),!K)return le(t,$)}else{var at=ie(t),ct=at==Ot||at==xt;if(rn(t))return iu(t,K);if(at==Ut||at==B||ct&&!I){if($=Y||ct?{}:Ou(t),!K)return Y?xh(t,eh($,t)):Mh(t,Da($,t))}else{if(!Ft[at])return I?t:{};$=$h(t,at,K)}}F||(F=new Ie);var gt=F.get(t);if(gt)return gt;F.set(t,$),Xu(t)?t.forEach(function(bt){$.add(Re(bt,e,r,bt,t,F))}):Qu(t)&&t.forEach(function(bt,Pt){$.set(Pt,Re(bt,e,r,Pt,t,F))});var At=ot?Y?Eo:Ro:Y?fe:Zt,Tt=st?h:At(t);return Ce(Tt||t,function(bt,Pt){Tt&&(Pt=bt,bt=t[Pt]),or($,Pt,Re(bt,e,r,Pt,t,F))}),$}function nh(t){var e=Zt(t);return function(r){return Na(r,t,e)}}function Na(t,e,r){var g=r.length;if(t==null)return!g;for(t=Bt(t);g--;){var I=r[g],F=e[I],$=t[I];if($===h&&!(I in t)||!F($))return!1}return!0}function Ua(t,e,r){if(typeof t!="function")throw new Se(i);return dr(function(){t.apply(h,r)},e)}function sr(t,e,r,g){var I=-1,F=Ir,$=!0,K=t.length,Y=[],ot=e.length;if(!K)return Y;r&&(e=Wt(e,pe(r))),g?(F=$i,$=!1):e.length>=n&&(F=Zn,$=!1,e=new dn(e));t:for(;++I<K;){var st=t[I],at=r==null?st:r(st);if(st=g||st!==0?st:0,$&&at===at){for(var ct=ot;ct--;)if(e[ct]===at)continue t;Y.push(st)}else F(e,at,g)||Y.push(st)}return Y}var Ze=lu(Le),Ba=lu(so,!0);function rh(t,e){var r=!0;return Ze(t,function(g,I,F){return r=!!e(g,I,F),r}),r}function Kr(t,e,r){for(var g=-1,I=t.length;++g<I;){var F=t[g],$=e(F);if($!=null&&(K===h?$===$&&!ve($):r($,K)))var K=$,Y=F}return Y}function ih(t,e,r,g){var I=t.length;for(r=Rt(r),r<0&&(r=-r>I?0:I+r),g=g===h||g>I?I:Rt(g),g<0&&(g+=I),g=r>g?0:tl(g);r<g;)t[r++]=e;return t}function Fa(t,e){var r=[];return Ze(t,function(g,I,F){e(g,I,F)&&r.push(g)}),r}function ne(t,e,r,g,I){var F=-1,$=t.length;for(r||(r=Vh),I||(I=[]);++F<$;){var K=t[F];e>0&&r(K)?e>1?ne(K,e-1,r,g,I):qe(I,K):g||(I[I.length]=K)}return I}var oo=cu(),Ga=cu(!0);function Le(t,e){return t&&oo(t,e,Zt)}function so(t,e){return t&&Ga(t,e,Zt)}function Jr(t,e){return Je(e,function(r){return $e(t[r])})}function pn(t,e){e=en(e,t);for(var r=0,g=e.length;t!=null&&r<g;)t=t[Ne(e[r++])];return r&&r==g?t:h}function Ha(t,e,r){var g=e(t);return St(t)?g:qe(g,r(t))}function oe(t){return t==null?t===h?Et:Yt:cn&&cn in Bt(t)?Hh(t):Zh(t)}function ao(t,e){return t>e}function oh(t,e){return t!=null&&Nt.call(t,e)}function sh(t,e){return t!=null&&e in Bt(t)}function ah(t,e,r){return t>=re(e,r)&&t<qt(e,r)}function uo(t,e,r){for(var g=r?$i:Ir,I=t[0].length,F=t.length,$=F,K=et(F),Y=1/0,ot=[];$--;){var st=t[$];$&&e&&(st=Wt(st,pe(e))),Y=re(st.length,Y),K[$]=!r&&(e||I>=120&&st.length>=120)?new dn($&&st):h}st=t[0];var at=-1,ct=K[0];t:for(;++at<I&&ot.length<Y;){var gt=st[at],At=e?e(gt):gt;if(gt=r||gt!==0?gt:0,!(ct?Zn(ct,At):g(ot,At,r))){for($=F;--$;){var Tt=K[$];if(!(Tt?Zn(Tt,At):g(t[$],At,r)))continue t}ct&&ct.push(At),ot.push(gt)}}return ot}function uh(t,e,r,g){return Le(t,function(I,F,$){e(g,r(I),F,$)}),g}function ar(t,e,r){e=en(e,t),t=_u(t,e);var g=t==null?t:t[Ne(Te(e))];return g==null?h:he(g,t,r)}function Wa(t){return zt(t)&&oe(t)==B}function lh(t){return zt(t)&&oe(t)==Xn}function ch(t){return zt(t)&&oe(t)==lt}function ur(t,e,r,g,I){return t===e?!0:t==null||e==null||!zt(t)&&!zt(e)?t!==t&&e!==e:fh(t,e,r,g,ur,I)}function fh(t,e,r,g,I,F){var $=St(t),K=St(e),Y=$?V:ie(t),ot=K?V:ie(e);Y=Y==B?Ut:Y,ot=ot==B?Ut:ot;var st=Y==Ut,at=ot==Ut,ct=Y==ot;if(ct&&rn(t)){if(!rn(e))return!1;$=!0,st=!1}if(ct&&!st)return F||(F=new Ie),$||Wn(t)?bu(t,e,r,g,I,F):Fh(t,e,Y,r,g,I,F);if(!(r&a)){var gt=st&&Nt.call(t,"__wrapped__"),At=at&&Nt.call(e,"__wrapped__");if(gt||At){var Tt=gt?t.value():t,bt=At?e.value():e;return F||(F=new Ie),I(Tt,bt,r,g,F)}}return ct?(F||(F=new Ie),Gh(t,e,r,g,I,F)):!1}function dh(t){return zt(t)&&ie(t)==ft}function lo(t,e,r,g){var I=r.length,F=I,$=!g;if(t==null)return!F;for(t=Bt(t);I--;){var K=r[I];if($&&K[2]?K[1]!==t[K[0]]:!(K[0]in t))return!1}for(;++I<F;){K=r[I];var Y=K[0],ot=t[Y],st=K[1];if($&&K[2]){if(ot===h&&!(Y in t))return!1}else{var at=new Ie;if(g)var ct=g(ot,st,Y,t,e,at);if(!(ct===h?ur(st,ot,a|O,g,at):ct))return!1}}return!0}function ka(t){if(!kt(t)||Jh(t))return!1;var e=$e(t)?dd:ef;return e.test(vn(t))}function hh(t){return zt(t)&&oe(t)==X}function ph(t){return zt(t)&&ie(t)==it}function gh(t){return zt(t)&&fi(t.length)&&!!Gt[oe(t)]}function za(t){return typeof t=="function"?t:t==null?de:typeof t=="object"?St(t)?Va(t[0],t[1]):ja(t):fl(t)}function co(t){if(!fr(t))return yd(t);var e=[];for(var r in Bt(t))Nt.call(t,r)&&r!="constructor"&&e.push(r);return e}function vh(t){if(!kt(t))return Xh(t);var e=fr(t),r=[];for(var g in t)g=="constructor"&&(e||!Nt.call(t,g))||r.push(g);return r}function fo(t,e){return t<e}function $a(t,e){var r=-1,g=ce(t)?et(t.length):[];return Ze(t,function(I,F,$){g[++r]=e(I,F,$)}),g}function ja(t){var e=_o(t);return e.length==1&&e[0][2]?Eu(e[0][0],e[0][1]):function(r){return r===t||lo(r,t,e)}}function Va(t,e){return Io(t)&&Ru(e)?Eu(Ne(t),e):function(r){var g=Go(r,t);return g===h&&g===e?Ho(r,t):ur(e,g,a|O)}}function qr(t,e,r,g,I){t!==e&&oo(e,function(F,$){if(I||(I=new Ie),kt(F))mh(t,e,$,r,qr,g,I);else{var K=g?g(Mo(t,$),F,$+"",t,e,I):h;K===h&&(K=F),ro(t,$,K)}},fe)}function mh(t,e,r,g,I,F,$){var K=Mo(t,r),Y=Mo(e,r),ot=$.get(Y);if(ot){ro(t,r,ot);return}var st=F?F(K,Y,r+"",t,e,$):h,at=st===h;if(at){var ct=St(Y),gt=!ct&&rn(Y),At=!ct&&!gt&&Wn(Y);st=Y,ct||gt||At?St(K)?st=K:$t(K)?st=le(K):gt?(at=!1,st=iu(Y,!0)):At?(at=!1,st=ou(Y,!0)):st=[]:hr(Y)||mn(Y)?(st=K,mn(K)?st=el(K):(!kt(K)||$e(K))&&(st=Ou(Y))):at=!1}at&&($.set(Y,st),I(st,Y,g,F,$),$.delete(Y)),ro(t,r,st)}function Ka(t,e){var r=t.length;if(!!r)return e+=e<0?r:0,ze(e,r)?t[e]:h}function Ja(t,e,r){e.length?e=Wt(e,function(F){return St(F)?function($){return pn($,F.length===1?F[0]:F)}:F}):e=[de];var g=-1;e=Wt(e,pe(yt()));var I=$a(t,function(F,$,K){var Y=Wt(e,function(ot){return ot(F)});return{criteria:Y,index:++g,value:F}});return $f(I,function(F,$){return wh(F,$,r)})}function yh(t,e){return qa(t,e,function(r,g){return Ho(t,g)})}function qa(t,e,r){for(var g=-1,I=e.length,F={};++g<I;){var $=e[g],K=pn(t,$);r(K,$)&&lr(F,en($,t),K)}return F}function Ah(t){return function(e){return pn(e,t)}}function ho(t,e,r,g){var I=g?zf:Mn,F=-1,$=e.length,K=t;for(t===e&&(e=le(e)),r&&(K=Wt(t,pe(r)));++F<$;)for(var Y=0,ot=e[F],st=r?r(ot):ot;(Y=I(K,st,Y,g))>-1;)K!==t&&Gr.call(K,Y,1),Gr.call(t,Y,1);return t}function Qa(t,e){for(var r=t?e.length:0,g=r-1;r--;){var I=e[r];if(r==g||I!==F){var F=I;ze(I)?Gr.call(t,I,1):mo(t,I)}}return t}function po(t,e){return t+kr(wa()*(e-t+1))}function bh(t,e,r,g){for(var I=-1,F=qt(Wr((e-t)/(r||1)),0),$=et(F);F--;)$[g?F:++I]=t,t+=r;return $}function go(t,e){var r="";if(!t||e<1||e>z)return r;do e%2&&(r+=t),e=kr(e/2),e&&(t+=t);while(e);return r}function _t(t,e){return xo(Tu(t,e,de),t+"")}function Ch(t){return La(kn(t))}function Sh(t,e){var r=kn(t);return oi(r,hn(e,0,r.length))}function lr(t,e,r,g){if(!kt(t))return t;e=en(e,t);for(var I=-1,F=e.length,$=F-1,K=t;K!=null&&++I<F;){var Y=Ne(e[I]),ot=r;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return t;if(I!=$){var st=K[Y];ot=g?g(st,Y,K):h,ot===h&&(ot=kt(st)?st:ze(e[I+1])?[]:{})}or(K,Y,ot),K=K[Y]}return t}var Ya=zr?function(t,e){return zr.set(t,e),t}:de,Oh=Hr?function(t,e){return Hr(t,"toString",{configurable:!0,enumerable:!1,value:ko(e),writable:!0})}:de;function Rh(t){return oi(kn(t))}function Ee(t,e,r){var g=-1,I=t.length;e<0&&(e=-e>I?0:I+e),r=r>I?I:r,r<0&&(r+=I),I=e>r?0:r-e>>>0,e>>>=0;for(var F=et(I);++g<I;)F[g]=t[g+e];return F}function Eh(t,e){var r;return Ze(t,function(g,I,F){return r=e(g,I,F),!r}),!!r}function Qr(t,e,r){var g=0,I=t==null?g:t.length;if(typeof e=="number"&&e===e&&I<=G){for(;g<I;){var F=g+I>>>1,$=t[F];$!==null&&!ve($)&&(r?$<=e:$<e)?g=F+1:I=F}return I}return vo(t,e,de,r)}function vo(t,e,r,g){var I=0,F=t==null?0:t.length;if(F===0)return 0;e=r(e);for(var $=e!==e,K=e===null,Y=ve(e),ot=e===h;I<F;){var st=kr((I+F)/2),at=r(t[st]),ct=at!==h,gt=at===null,At=at===at,Tt=ve(at);if($)var bt=g||At;else ot?bt=At&&(g||ct):K?bt=At&&ct&&(g||!gt):Y?bt=At&&ct&&!gt&&(g||!Tt):gt||Tt?bt=!1:bt=g?at<=e:at<e;bt?I=st+1:F=st}return re(F,Q)}function Xa(t,e){for(var r=-1,g=t.length,I=0,F=[];++r<g;){var $=t[r],K=e?e($):$;if(!r||!we(K,Y)){var Y=K;F[I++]=$===0?0:$}}return F}function Za(t){return typeof t=="number"?t:ve(t)?J:+t}function ge(t){if(typeof t=="string")return t;if(St(t))return Wt(t,ge)+"";if(ve(t))return Ma?Ma.call(t):"";var e=t+"";return e=="0"&&1/t==-x?"-0":e}function tn(t,e,r){var g=-1,I=Ir,F=t.length,$=!0,K=[],Y=K;if(r)$=!1,I=$i;else if(F>=n){var ot=e?null:Uh(t);if(ot)return Mr(ot);$=!1,I=Zn,Y=new dn}else Y=e?[]:K;t:for(;++g<F;){var st=t[g],at=e?e(st):st;if(st=r||st!==0?st:0,$&&at===at){for(var ct=Y.length;ct--;)if(Y[ct]===at)continue t;e&&Y.push(at),K.push(st)}else I(Y,at,r)||(Y!==K&&Y.push(at),K.push(st))}return K}function mo(t,e){return e=en(e,t),t=_u(t,e),t==null||delete t[Ne(Te(e))]}function tu(t,e,r,g){return lr(t,e,r(pn(t,e)),g)}function Yr(t,e,r,g){for(var I=t.length,F=g?I:-1;(g?F--:++F<I)&&e(t[F],F,t););return r?Ee(t,g?0:F,g?F+1:I):Ee(t,g?F+1:0,g?I:F)}function eu(t,e){var r=t;return r instanceof It&&(r=r.value()),ji(e,function(g,I){return I.func.apply(I.thisArg,qe([g],I.args))},r)}function yo(t,e,r){var g=t.length;if(g<2)return g?tn(t[0]):[];for(var I=-1,F=et(g);++I<g;)for(var $=t[I],K=-1;++K<g;)K!=I&&(F[I]=sr(F[I]||$,t[K],e,r));return tn(ne(F,1),e,r)}function nu(t,e,r){for(var g=-1,I=t.length,F=e.length,$={};++g<I;){var K=g<F?e[g]:h;r($,t[g],K)}return $}function Ao(t){return $t(t)?t:[]}function bo(t){return typeof t=="function"?t:de}function en(t,e){return St(t)?t:Io(t,e)?[t]:Mu(Dt(t))}var Th=_t;function nn(t,e,r){var g=t.length;return r=r===h?g:r,!e&&r>=g?t:Ee(t,e,r)}var ru=hd||function(t){return Xt.clearTimeout(t)};function iu(t,e){if(e)return t.slice();var r=t.length,g=Ea?Ea(r):new t.constructor(r);return t.copy(g),g}function Co(t){var e=new t.constructor(t.byteLength);return new Br(e).set(new Br(t)),e}function _h(t,e){var r=e?Co(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function Ph(t){var e=new t.constructor(t.source,Ws.exec(t));return e.lastIndex=t.lastIndex,e}function Ih(t){return ir?Bt(ir.call(t)):{}}function ou(t,e){var r=e?Co(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function su(t,e){if(t!==e){var r=t!==h,g=t===null,I=t===t,F=ve(t),$=e!==h,K=e===null,Y=e===e,ot=ve(e);if(!K&&!ot&&!F&&t>e||F&&$&&Y&&!K&&!ot||g&&$&&Y||!r&&Y||!I)return 1;if(!g&&!F&&!ot&&t<e||ot&&r&&I&&!g&&!F||K&&r&&I||!$&&I||!Y)return-1}return 0}function wh(t,e,r){for(var g=-1,I=t.criteria,F=e.criteria,$=I.length,K=r.length;++g<$;){var Y=su(I[g],F[g]);if(Y){if(g>=K)return Y;var ot=r[g];return Y*(ot=="desc"?-1:1)}}return t.index-e.index}function au(t,e,r,g){for(var I=-1,F=t.length,$=r.length,K=-1,Y=e.length,ot=qt(F-$,0),st=et(Y+ot),at=!g;++K<Y;)st[K]=e[K];for(;++I<$;)(at||I<F)&&(st[r[I]]=t[I]);for(;ot--;)st[K++]=t[I++];return st}function uu(t,e,r,g){for(var I=-1,F=t.length,$=-1,K=r.length,Y=-1,ot=e.length,st=qt(F-K,0),at=et(st+ot),ct=!g;++I<st;)at[I]=t[I];for(var gt=I;++Y<ot;)at[gt+Y]=e[Y];for(;++$<K;)(ct||I<F)&&(at[gt+r[$]]=t[I++]);return at}function le(t,e){var r=-1,g=t.length;for(e||(e=et(g));++r<g;)e[r]=t[r];return e}function De(t,e,r,g){var I=!r;r||(r={});for(var F=-1,$=e.length;++F<$;){var K=e[F],Y=g?g(r[K],t[K],K,r,t):h;Y===h&&(Y=t[K]),I?He(r,K,Y):or(r,K,Y)}return r}function Mh(t,e){return De(t,Po(t),e)}function xh(t,e){return De(t,Cu(t),e)}function Xr(t,e){return function(r,g){var I=St(r)?Bf:th,F=e?e():{};return I(r,t,yt(g,2),F)}}function Fn(t){return _t(function(e,r){var g=-1,I=r.length,F=I>1?r[I-1]:h,$=I>2?r[2]:h;for(F=t.length>3&&typeof F=="function"?(I--,F):h,$&&se(r[0],r[1],$)&&(F=I<3?h:F,I=1),e=Bt(e);++g<I;){var K=r[g];K&&t(e,K,g,F)}return e})}function lu(t,e){return function(r,g){if(r==null)return r;if(!ce(r))return t(r,g);for(var I=r.length,F=e?I:-1,$=Bt(r);(e?F--:++F<I)&&g($[F],F,$)!==!1;);return r}}function cu(t){return function(e,r,g){for(var I=-1,F=Bt(e),$=g(e),K=$.length;K--;){var Y=$[t?K:++I];if(r(F[Y],Y,F)===!1)break}return e}}function Lh(t,e,r){var g=e&M,I=cr(t);function F(){var $=this&&this!==Xt&&this instanceof F?I:t;return $.apply(g?r:this,arguments)}return F}function fu(t){return function(e){e=Dt(e);var r=xn(e)?Pe(e):h,g=r?r[0]:e.charAt(0),I=r?nn(r,1).join(""):e.slice(1);return g[t]()+I}}function Gn(t){return function(e){return ji(ll(ul(e).replace(Of,"")),t,"")}}function cr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=Bn(t.prototype),g=t.apply(r,e);return kt(g)?g:r}}function Dh(t,e,r){var g=cr(t);function I(){for(var F=arguments.length,$=et(F),K=F,Y=Hn(I);K--;)$[K]=arguments[K];var ot=F<3&&$[0]!==Y&&$[F-1]!==Y?[]:Qe($,Y);if(F-=ot.length,F<r)return vu(t,e,Zr,I.placeholder,h,$,ot,h,h,r-F);var st=this&&this!==Xt&&this instanceof I?g:t;return he(st,this,$)}return I}function du(t){return function(e,r,g){var I=Bt(e);if(!ce(e)){var F=yt(r,3);e=Zt(e),r=function(K){return F(I[K],K,I)}}var $=t(e,r,g);return $>-1?I[F?e[$]:$]:h}}function hu(t){return ke(function(e){var r=e.length,g=r,I=Oe.prototype.thru;for(t&&e.reverse();g--;){var F=e[g];if(typeof F!="function")throw new Se(i);if(I&&!$&&ri(F)=="wrapper")var $=new Oe([],!0)}for(g=$?g:r;++g<r;){F=e[g];var K=ri(F),Y=K=="wrapper"?To(F):h;Y&&wo(Y[0])&&Y[1]==(f|m|u|p)&&!Y[4].length&&Y[9]==1?$=$[ri(Y[0])].apply($,Y[3]):$=F.length==1&&wo(F)?$[K]():$.thru(F)}return function(){var ot=arguments,st=ot[0];if($&&ot.length==1&&St(st))return $.plant(st).value();for(var at=0,ct=r?e[at].apply(this,ot):st;++at<r;)ct=e[at].call(this,ct);return ct}})}function Zr(t,e,r,g,I,F,$,K,Y,ot){var st=e&f,at=e&M,ct=e&w,gt=e&(m|T),At=e&l,Tt=ct?h:cr(t);function bt(){for(var Pt=arguments.length,wt=et(Pt),me=Pt;me--;)wt[me]=arguments[me];if(gt)var ae=Hn(bt),ye=Vf(wt,ae);if(g&&(wt=au(wt,g,I,gt)),F&&(wt=uu(wt,F,$,gt)),Pt-=ye,gt&&Pt<ot){var jt=Qe(wt,ae);return vu(t,e,Zr,bt.placeholder,r,wt,jt,K,Y,ot-Pt)}var Me=at?r:this,Ve=ct?Me[t]:t;return Pt=wt.length,K?wt=tp(wt,K):At&&Pt>1&&wt.reverse(),st&&Y<Pt&&(wt.length=Y),this&&this!==Xt&&this instanceof bt&&(Ve=Tt||cr(Ve)),Ve.apply(Me,wt)}return bt}function pu(t,e){return function(r,g){return uh(r,t,e(g),{})}}function ti(t,e){return function(r,g){var I;if(r===h&&g===h)return e;if(r!==h&&(I=r),g!==h){if(I===h)return g;typeof r=="string"||typeof g=="string"?(r=ge(r),g=ge(g)):(r=Za(r),g=Za(g)),I=t(r,g)}return I}}function So(t){return ke(function(e){return e=Wt(e,pe(yt())),_t(function(r){var g=this;return t(e,function(I){return he(I,g,r)})})})}function ei(t,e){e=e===h?" ":ge(e);var r=e.length;if(r<2)return r?go(e,t):e;var g=go(e,Wr(t/Ln(e)));return xn(e)?nn(Pe(g),0,t).join(""):g.slice(0,t)}function Nh(t,e,r,g){var I=e&M,F=cr(t);function $(){for(var K=-1,Y=arguments.length,ot=-1,st=g.length,at=et(st+Y),ct=this&&this!==Xt&&this instanceof $?F:t;++ot<st;)at[ot]=g[ot];for(;Y--;)at[ot++]=arguments[++K];return he(ct,I?r:this,at)}return $}function gu(t){return function(e,r,g){return g&&typeof g!="number"&&se(e,r,g)&&(r=g=h),e=je(e),r===h?(r=e,e=0):r=je(r),g=g===h?e<r?1:-1:je(g),bh(e,r,g,t)}}function ni(t){return function(e,r){return typeof e=="string"&&typeof r=="string"||(e=_e(e),r=_e(r)),t(e,r)}}function vu(t,e,r,g,I,F,$,K,Y,ot){var st=e&m,at=st?$:h,ct=st?h:$,gt=st?F:h,At=st?h:F;e|=st?u:v,e&=~(st?v:u),e&C||(e&=~(M|w));var Tt=[t,e,I,gt,at,At,ct,K,Y,ot],bt=r.apply(h,Tt);return wo(t)&&Pu(bt,Tt),bt.placeholder=g,Iu(bt,t,e)}function Oo(t){var e=Jt[t];return function(r,g){if(r=_e(r),g=g==null?0:re(Rt(g),292),g&&Ia(r)){var I=(Dt(r)+"e").split("e"),F=e(I[0]+"e"+(+I[1]+g));return I=(Dt(F)+"e").split("e"),+(I[0]+"e"+(+I[1]-g))}return e(r)}}var Uh=Nn&&1/Mr(new Nn([,-0]))[1]==x?function(t){return new Nn(t)}:jo;function mu(t){return function(e){var r=ie(e);return r==ft?Xi(e):r==it?Zf(e):jf(e,t(e))}}function We(t,e,r,g,I,F,$,K){var Y=e&w;if(!Y&&typeof t!="function")throw new Se(i);var ot=g?g.length:0;if(ot||(e&=~(u|v),g=I=h),$=$===h?$:qt(Rt($),0),K=K===h?K:Rt(K),ot-=I?I.length:0,e&v){var st=g,at=I;g=I=h}var ct=Y?h:To(t),gt=[t,e,r,g,I,st,at,F,$,K];if(ct&&Yh(gt,ct),t=gt[0],e=gt[1],r=gt[2],g=gt[3],I=gt[4],K=gt[9]=gt[9]===h?Y?0:t.length:qt(gt[9]-ot,0),!K&&e&(m|T)&&(e&=~(m|T)),!e||e==M)var At=Lh(t,e,r);else e==m||e==T?At=Dh(t,e,K):(e==u||e==(M|u))&&!I.length?At=Nh(t,e,r,g):At=Zr.apply(h,gt);var Tt=ct?Ya:Pu;return Iu(Tt(At,gt),t,e)}function yu(t,e,r,g){return t===h||we(t,Dn[r])&&!Nt.call(g,r)?e:t}function Au(t,e,r,g,I,F){return kt(t)&&kt(e)&&(F.set(e,t),qr(t,e,h,Au,F),F.delete(e)),t}function Bh(t){return hr(t)?h:t}function bu(t,e,r,g,I,F){var $=r&a,K=t.length,Y=e.length;if(K!=Y&&!($&&Y>K))return!1;var ot=F.get(t),st=F.get(e);if(ot&&st)return ot==e&&st==t;var at=-1,ct=!0,gt=r&O?new dn:h;for(F.set(t,e),F.set(e,t);++at<K;){var At=t[at],Tt=e[at];if(g)var bt=$?g(Tt,At,at,e,t,F):g(At,Tt,at,t,e,F);if(bt!==h){if(bt)continue;ct=!1;break}if(gt){if(!Vi(e,function(Pt,wt){if(!Zn(gt,wt)&&(At===Pt||I(At,Pt,r,g,F)))return gt.push(wt)})){ct=!1;break}}else if(!(At===Tt||I(At,Tt,r,g,F))){ct=!1;break}}return F.delete(t),F.delete(e),ct}function Fh(t,e,r,g,I,F,$){switch(r){case In:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Xn:return!(t.byteLength!=e.byteLength||!F(new Br(t),new Br(e)));case tt:case lt:case Mt:return we(+t,+e);case vt:return t.name==e.name&&t.message==e.message;case X:case ut:return t==e+"";case ft:var K=Xi;case it:var Y=g&a;if(K||(K=Mr),t.size!=e.size&&!Y)return!1;var ot=$.get(t);if(ot)return ot==e;g|=O,$.set(t,e);var st=bu(K(t),K(e),g,I,F,$);return $.delete(t),st;case pt:if(ir)return ir.call(t)==ir.call(e)}return!1}function Gh(t,e,r,g,I,F){var $=r&a,K=Ro(t),Y=K.length,ot=Ro(e),st=ot.length;if(Y!=st&&!$)return!1;for(var at=Y;at--;){var ct=K[at];if(!($?ct in e:Nt.call(e,ct)))return!1}var gt=F.get(t),At=F.get(e);if(gt&&At)return gt==e&&At==t;var Tt=!0;F.set(t,e),F.set(e,t);for(var bt=$;++at<Y;){ct=K[at];var Pt=t[ct],wt=e[ct];if(g)var me=$?g(wt,Pt,ct,e,t,F):g(Pt,wt,ct,t,e,F);if(!(me===h?Pt===wt||I(Pt,wt,r,g,F):me)){Tt=!1;break}bt||(bt=ct=="constructor")}if(Tt&&!bt){var ae=t.constructor,ye=e.constructor;ae!=ye&&"constructor"in t&&"constructor"in e&&!(typeof ae=="function"&&ae instanceof ae&&typeof ye=="function"&&ye instanceof ye)&&(Tt=!1)}return F.delete(t),F.delete(e),Tt}function ke(t){return xo(Tu(t,h,Nu),t+"")}function Ro(t){return Ha(t,Zt,Po)}function Eo(t){return Ha(t,fe,Cu)}var To=zr?function(t){return zr.get(t)}:jo;function ri(t){for(var e=t.name+"",r=Un[e],g=Nt.call(Un,e)?r.length:0;g--;){var I=r[g],F=I.func;if(F==null||F==t)return I.name}return e}function Hn(t){var e=Nt.call(L,"placeholder")?L:t;return e.placeholder}function yt(){var t=L.iteratee||zo;return t=t===zo?za:t,arguments.length?t(arguments[0],arguments[1]):t}function ii(t,e){var r=t.__data__;return Kh(e)?r[typeof e=="string"?"string":"hash"]:r.map}function _o(t){for(var e=Zt(t),r=e.length;r--;){var g=e[r],I=t[g];e[r]=[g,I,Ru(I)]}return e}function gn(t,e){var r=Qf(t,e);return ka(r)?r:h}function Hh(t){var e=Nt.call(t,cn),r=t[cn];try{t[cn]=h;var g=!0}catch(F){}var I=Nr.call(t);return g&&(e?t[cn]=r:delete t[cn]),I}var Po=to?function(t){return t==null?[]:(t=Bt(t),Je(to(t),function(e){return _a.call(t,e)}))}:Vo,Cu=to?function(t){for(var e=[];t;)qe(e,Po(t)),t=Fr(t);return e}:Vo,ie=oe;(eo&&ie(new eo(new ArrayBuffer(1)))!=In||er&&ie(new er)!=ft||no&&ie(no.resolve())!=Ht||Nn&&ie(new Nn)!=it||nr&&ie(new nr)!=Kt)&&(ie=function(t){var e=oe(t),r=e==Ut?t.constructor:h,g=r?vn(r):"";if(g)switch(g){case Sd:return In;case Od:return ft;case Rd:return Ht;case Ed:return it;case Td:return Kt}return e});function Wh(t,e,r){for(var g=-1,I=r.length;++g<I;){var F=r[g],$=F.size;switch(F.type){case"drop":t+=$;break;case"dropRight":e-=$;break;case"take":e=re(e,t+$);break;case"takeRight":t=qt(t,e-$);break}}return{start:t,end:e}}function kh(t){var e=t.match(Kc);return e?e[1].split(Jc):[]}function Su(t,e,r){e=en(e,t);for(var g=-1,I=e.length,F=!1;++g<I;){var $=Ne(e[g]);if(!(F=t!=null&&r(t,$)))break;t=t[$]}return F||++g!=I?F:(I=t==null?0:t.length,!!I&&fi(I)&&ze($,I)&&(St(t)||mn(t)))}function zh(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&Nt.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function Ou(t){return typeof t.constructor=="function"&&!fr(t)?Bn(Fr(t)):{}}function $h(t,e,r){var g=t.constructor;switch(e){case Xn:return Co(t);case tt:case lt:return new g(+t);case In:return _h(t,r);case Ti:case _i:case Pi:case Ii:case wi:case Mi:case xi:case Li:case Di:return ou(t,r);case ft:return new g;case Mt:case ut:return new g(t);case X:return Ph(t);case it:return new g;case pt:return Ih(t)}}function jh(t,e){var r=e.length;if(!r)return t;var g=r-1;return e[g]=(r>1?"& ":"")+e[g],e=e.join(r>2?", ":" "),t.replace(Vc,`{
/* [wrapped with `+e+`] */
`)}function Vh(t){return St(t)||mn(t)||!!(Pa&&t&&t[Pa])}function ze(t,e){var r=typeof t;return e=e==null?z:e,!!e&&(r=="number"||r!="symbol"&&rf.test(t))&&t>-1&&t%1==0&&t<e}function se(t,e,r){if(!kt(r))return!1;var g=typeof e;return(g=="number"?ce(r)&&ze(e,r.length):g=="string"&&e in r)?we(r[e],t):!1}function Io(t,e){if(St(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||ve(t)?!0:kc.test(t)||!Wc.test(t)||e!=null&&t in Bt(e)}function Kh(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function wo(t){var e=ri(t),r=L[e];if(typeof r!="function"||!(e in It.prototype))return!1;if(t===r)return!0;var g=To(r);return!!g&&t===g[0]}function Jh(t){return!!Ra&&Ra in t}var qh=Lr?$e:Ko;function fr(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Dn;return t===r}function Ru(t){return t===t&&!kt(t)}function Eu(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==h||t in Bt(r))}}function Qh(t){var e=li(t,function(g){return r.size===c&&r.clear(),g}),r=e.cache;return e}function Yh(t,e){var r=t[1],g=e[1],I=r|g,F=I<(M|w|f),$=g==f&&r==m||g==f&&r==p&&t[7].length<=e[8]||g==(f|p)&&e[7].length<=e[8]&&r==m;if(!(F||$))return t;g&M&&(t[2]=e[2],I|=r&M?0:C);var K=e[3];if(K){var Y=t[3];t[3]=Y?au(Y,K,e[4]):K,t[4]=Y?Qe(t[3],d):e[4]}return K=e[5],K&&(Y=t[5],t[5]=Y?uu(Y,K,e[6]):K,t[6]=Y?Qe(t[5],d):e[6]),K=e[7],K&&(t[7]=K),g&f&&(t[8]=t[8]==null?e[8]:re(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=I,t}function Xh(t){var e=[];if(t!=null)for(var r in Bt(t))e.push(r);return e}function Zh(t){return Nr.call(t)}function Tu(t,e,r){return e=qt(e===h?t.length-1:e,0),function(){for(var g=arguments,I=-1,F=qt(g.length-e,0),$=et(F);++I<F;)$[I]=g[e+I];I=-1;for(var K=et(e+1);++I<e;)K[I]=g[I];return K[e]=r($),he(t,this,K)}}function _u(t,e){return e.length<2?t:pn(t,Ee(e,0,-1))}function tp(t,e){for(var r=t.length,g=re(e.length,r),I=le(t);g--;){var F=e[g];t[g]=ze(F,r)?I[F]:h}return t}function Mo(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Pu=wu(Ya),dr=gd||function(t,e){return Xt.setTimeout(t,e)},xo=wu(Oh);function Iu(t,e,r){var g=e+"";return xo(t,jh(g,ep(kh(g),r)))}function wu(t){var e=0,r=0;return function(){var g=Ad(),I=k-(g-r);if(r=g,I>0){if(++e>=D)return arguments[0]}else e=0;return t.apply(h,arguments)}}function oi(t,e){var r=-1,g=t.length,I=g-1;for(e=e===h?g:e;++r<e;){var F=po(r,I),$=t[F];t[F]=t[r],t[r]=$}return t.length=e,t}var Mu=Qh(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(zc,function(r,g,I,F){e.push(I?F.replace(Yc,"$1"):g||r)}),e});function Ne(t){if(typeof t=="string"||ve(t))return t;var e=t+"";return e=="0"&&1/t==-x?"-0":e}function vn(t){if(t!=null){try{return Dr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function ep(t,e){return Ce(N,function(r){var g="_."+r[0];e&r[1]&&!Ir(t,g)&&t.push(g)}),t.sort()}function xu(t){if(t instanceof It)return t.clone();var e=new Oe(t.__wrapped__,t.__chain__);return e.__actions__=le(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function np(t,e,r){(r?se(t,e,r):e===h)?e=1:e=qt(Rt(e),0);var g=t==null?0:t.length;if(!g||e<1)return[];for(var I=0,F=0,$=et(Wr(g/e));I<g;)$[F++]=Ee(t,I,I+=e);return $}function rp(t){for(var e=-1,r=t==null?0:t.length,g=0,I=[];++e<r;){var F=t[e];F&&(I[g++]=F)}return I}function ip(){var t=arguments.length;if(!t)return[];for(var e=et(t-1),r=arguments[0],g=t;g--;)e[g-1]=arguments[g];return qe(St(r)?le(r):[r],ne(e,1))}var op=_t(function(t,e){return $t(t)?sr(t,ne(e,1,$t,!0)):[]}),sp=_t(function(t,e){var r=Te(e);return $t(r)&&(r=h),$t(t)?sr(t,ne(e,1,$t,!0),yt(r,2)):[]}),ap=_t(function(t,e){var r=Te(e);return $t(r)&&(r=h),$t(t)?sr(t,ne(e,1,$t,!0),h,r):[]});function up(t,e,r){var g=t==null?0:t.length;return g?(e=r||e===h?1:Rt(e),Ee(t,e<0?0:e,g)):[]}function lp(t,e,r){var g=t==null?0:t.length;return g?(e=r||e===h?1:Rt(e),e=g-e,Ee(t,0,e<0?0:e)):[]}function cp(t,e){return t&&t.length?Yr(t,yt(e,3),!0,!0):[]}function fp(t,e){return t&&t.length?Yr(t,yt(e,3),!0):[]}function dp(t,e,r,g){var I=t==null?0:t.length;return I?(r&&typeof r!="number"&&se(t,e,r)&&(r=0,g=I),ih(t,e,r,g)):[]}function Lu(t,e,r){var g=t==null?0:t.length;if(!g)return-1;var I=r==null?0:Rt(r);return I<0&&(I=qt(g+I,0)),wr(t,yt(e,3),I)}function Du(t,e,r){var g=t==null?0:t.length;if(!g)return-1;var I=g-1;return r!==h&&(I=Rt(r),I=r<0?qt(g+I,0):re(I,g-1)),wr(t,yt(e,3),I,!0)}function Nu(t){var e=t==null?0:t.length;return e?ne(t,1):[]}function hp(t){var e=t==null?0:t.length;return e?ne(t,x):[]}function pp(t,e){var r=t==null?0:t.length;return r?(e=e===h?1:Rt(e),ne(t,e)):[]}function gp(t){for(var e=-1,r=t==null?0:t.length,g={};++e<r;){var I=t[e];g[I[0]]=I[1]}return g}function Uu(t){return t&&t.length?t[0]:h}function vp(t,e,r){var g=t==null?0:t.length;if(!g)return-1;var I=r==null?0:Rt(r);return I<0&&(I=qt(g+I,0)),Mn(t,e,I)}function mp(t){var e=t==null?0:t.length;return e?Ee(t,0,-1):[]}var yp=_t(function(t){var e=Wt(t,Ao);return e.length&&e[0]===t[0]?uo(e):[]}),Ap=_t(function(t){var e=Te(t),r=Wt(t,Ao);return e===Te(r)?e=h:r.pop(),r.length&&r[0]===t[0]?uo(r,yt(e,2)):[]}),bp=_t(function(t){var e=Te(t),r=Wt(t,Ao);return e=typeof e=="function"?e:h,e&&r.pop(),r.length&&r[0]===t[0]?uo(r,h,e):[]});function Cp(t,e){return t==null?"":md.call(t,e)}function Te(t){var e=t==null?0:t.length;return e?t[e-1]:h}function Sp(t,e,r){var g=t==null?0:t.length;if(!g)return-1;var I=g;return r!==h&&(I=Rt(r),I=I<0?qt(g+I,0):re(I,g-1)),e===e?ed(t,e,I):wr(t,va,I,!0)}function Op(t,e){return t&&t.length?Ka(t,Rt(e)):h}var Rp=_t(Bu);function Bu(t,e){return t&&t.length&&e&&e.length?ho(t,e):t}function Ep(t,e,r){return t&&t.length&&e&&e.length?ho(t,e,yt(r,2)):t}function Tp(t,e,r){return t&&t.length&&e&&e.length?ho(t,e,h,r):t}var _p=ke(function(t,e){var r=t==null?0:t.length,g=io(t,e);return Qa(t,Wt(e,function(I){return ze(I,r)?+I:I}).sort(su)),g});function Pp(t,e){var r=[];if(!(t&&t.length))return r;var g=-1,I=[],F=t.length;for(e=yt(e,3);++g<F;){var $=t[g];e($,g,t)&&(r.push($),I.push(g))}return Qa(t,I),r}function Lo(t){return t==null?t:Cd.call(t)}function Ip(t,e,r){var g=t==null?0:t.length;return g?(r&&typeof r!="number"&&se(t,e,r)?(e=0,r=g):(e=e==null?0:Rt(e),r=r===h?g:Rt(r)),Ee(t,e,r)):[]}function wp(t,e){return Qr(t,e)}function Mp(t,e,r){return vo(t,e,yt(r,2))}function xp(t,e){var r=t==null?0:t.length;if(r){var g=Qr(t,e);if(g<r&&we(t[g],e))return g}return-1}function Lp(t,e){return Qr(t,e,!0)}function Dp(t,e,r){return vo(t,e,yt(r,2),!0)}function Np(t,e){var r=t==null?0:t.length;if(r){var g=Qr(t,e,!0)-1;if(we(t[g],e))return g}return-1}function Up(t){return t&&t.length?Xa(t):[]}function Bp(t,e){return t&&t.length?Xa(t,yt(e,2)):[]}function Fp(t){var e=t==null?0:t.length;return e?Ee(t,1,e):[]}function Gp(t,e,r){return t&&t.length?(e=r||e===h?1:Rt(e),Ee(t,0,e<0?0:e)):[]}function Hp(t,e,r){var g=t==null?0:t.length;return g?(e=r||e===h?1:Rt(e),e=g-e,Ee(t,e<0?0:e,g)):[]}function Wp(t,e){return t&&t.length?Yr(t,yt(e,3),!1,!0):[]}function kp(t,e){return t&&t.length?Yr(t,yt(e,3)):[]}var zp=_t(function(t){return tn(ne(t,1,$t,!0))}),$p=_t(function(t){var e=Te(t);return $t(e)&&(e=h),tn(ne(t,1,$t,!0),yt(e,2))}),jp=_t(function(t){var e=Te(t);return e=typeof e=="function"?e:h,tn(ne(t,1,$t,!0),h,e)});function Vp(t){return t&&t.length?tn(t):[]}function Kp(t,e){return t&&t.length?tn(t,yt(e,2)):[]}function Jp(t,e){return e=typeof e=="function"?e:h,t&&t.length?tn(t,h,e):[]}function Do(t){if(!(t&&t.length))return[];var e=0;return t=Je(t,function(r){if($t(r))return e=qt(r.length,e),!0}),Qi(e,function(r){return Wt(t,Ki(r))})}function Fu(t,e){if(!(t&&t.length))return[];var r=Do(t);return e==null?r:Wt(r,function(g){return he(e,h,g)})}var qp=_t(function(t,e){return $t(t)?sr(t,e):[]}),Qp=_t(function(t){return yo(Je(t,$t))}),Yp=_t(function(t){var e=Te(t);return $t(e)&&(e=h),yo(Je(t,$t),yt(e,2))}),Xp=_t(function(t){var e=Te(t);return e=typeof e=="function"?e:h,yo(Je(t,$t),h,e)}),Zp=_t(Do);function tg(t,e){return nu(t||[],e||[],or)}function eg(t,e){return nu(t||[],e||[],lr)}var ng=_t(function(t){var e=t.length,r=e>1?t[e-1]:h;return r=typeof r=="function"?(t.pop(),r):h,Fu(t,r)});function Gu(t){var e=L(t);return e.__chain__=!0,e}function rg(t,e){return e(t),t}function si(t,e){return e(t)}var ig=ke(function(t){var e=t.length,r=e?t[0]:0,g=this.__wrapped__,I=function(F){return io(F,t)};return e>1||this.__actions__.length||!(g instanceof It)||!ze(r)?this.thru(I):(g=g.slice(r,+r+(e?1:0)),g.__actions__.push({func:si,args:[I],thisArg:h}),new Oe(g,this.__chain__).thru(function(F){return e&&!F.length&&F.push(h),F}))});function og(){return Gu(this)}function sg(){return new Oe(this.value(),this.__chain__)}function ag(){this.__values__===h&&(this.__values__=Zu(this.value()));var t=this.__index__>=this.__values__.length,e=t?h:this.__values__[this.__index__++];return{done:t,value:e}}function ug(){return this}function lg(t){for(var e,r=this;r instanceof jr;){var g=xu(r);g.__index__=0,g.__values__=h,e?I.__wrapped__=g:e=g;var I=g;r=r.__wrapped__}return I.__wrapped__=t,e}function cg(){var t=this.__wrapped__;if(t instanceof It){var e=t;return this.__actions__.length&&(e=new It(this)),e=e.reverse(),e.__actions__.push({func:si,args:[Lo],thisArg:h}),new Oe(e,this.__chain__)}return this.thru(Lo)}function fg(){return eu(this.__wrapped__,this.__actions__)}var dg=Xr(function(t,e,r){Nt.call(t,r)?++t[r]:He(t,r,1)});function hg(t,e,r){var g=St(t)?pa:rh;return r&&se(t,e,r)&&(e=h),g(t,yt(e,3))}function pg(t,e){var r=St(t)?Je:Fa;return r(t,yt(e,3))}var gg=du(Lu),vg=du(Du);function mg(t,e){return ne(ai(t,e),1)}function yg(t,e){return ne(ai(t,e),x)}function Ag(t,e,r){return r=r===h?1:Rt(r),ne(ai(t,e),r)}function Hu(t,e){var r=St(t)?Ce:Ze;return r(t,yt(e,3))}function Wu(t,e){var r=St(t)?Ff:Ba;return r(t,yt(e,3))}var bg=Xr(function(t,e,r){Nt.call(t,r)?t[r].push(e):He(t,r,[e])});function Cg(t,e,r,g){t=ce(t)?t:kn(t),r=r&&!g?Rt(r):0;var I=t.length;return r<0&&(r=qt(I+r,0)),di(t)?r<=I&&t.indexOf(e,r)>-1:!!I&&Mn(t,e,r)>-1}var Sg=_t(function(t,e,r){var g=-1,I=typeof e=="function",F=ce(t)?et(t.length):[];return Ze(t,function($){F[++g]=I?he(e,$,r):ar($,e,r)}),F}),Og=Xr(function(t,e,r){He(t,r,e)});function ai(t,e){var r=St(t)?Wt:$a;return r(t,yt(e,3))}function Rg(t,e,r,g){return t==null?[]:(St(e)||(e=e==null?[]:[e]),r=g?h:r,St(r)||(r=r==null?[]:[r]),Ja(t,e,r))}var Eg=Xr(function(t,e,r){t[r?0:1].push(e)},function(){return[[],[]]});function Tg(t,e,r){var g=St(t)?ji:ya,I=arguments.length<3;return g(t,yt(e,4),r,I,Ze)}function _g(t,e,r){var g=St(t)?Gf:ya,I=arguments.length<3;return g(t,yt(e,4),r,I,Ba)}function Pg(t,e){var r=St(t)?Je:Fa;return r(t,ci(yt(e,3)))}function Ig(t){var e=St(t)?La:Ch;return e(t)}function wg(t,e,r){(r?se(t,e,r):e===h)?e=1:e=Rt(e);var g=St(t)?Xd:Sh;return g(t,e)}function Mg(t){var e=St(t)?Zd:Rh;return e(t)}function xg(t){if(t==null)return 0;if(ce(t))return di(t)?Ln(t):t.length;var e=ie(t);return e==ft||e==it?t.size:co(t).length}function Lg(t,e,r){var g=St(t)?Vi:Eh;return r&&se(t,e,r)&&(e=h),g(t,yt(e,3))}var Dg=_t(function(t,e){if(t==null)return[];var r=e.length;return r>1&&se(t,e[0],e[1])?e=[]:r>2&&se(e[0],e[1],e[2])&&(e=[e[0]]),Ja(t,ne(e,1),[])}),ui=pd||function(){return Xt.Date.now()};function Ng(t,e){if(typeof e!="function")throw new Se(i);return t=Rt(t),function(){if(--t<1)return e.apply(this,arguments)}}function ku(t,e,r){return e=r?h:e,e=t&&e==null?t.length:e,We(t,f,h,h,h,h,e)}function zu(t,e){var r;if(typeof e!="function")throw new Se(i);return t=Rt(t),function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=h),r}}var No=_t(function(t,e,r){var g=M;if(r.length){var I=Qe(r,Hn(No));g|=u}return We(t,g,e,r,I)}),$u=_t(function(t,e,r){var g=M|w;if(r.length){var I=Qe(r,Hn($u));g|=u}return We(e,g,t,r,I)});function ju(t,e,r){e=r?h:e;var g=We(t,m,h,h,h,h,h,e);return g.placeholder=ju.placeholder,g}function Vu(t,e,r){e=r?h:e;var g=We(t,T,h,h,h,h,h,e);return g.placeholder=Vu.placeholder,g}function Ku(t,e,r){var g,I,F,$,K,Y,ot=0,st=!1,at=!1,ct=!0;if(typeof t!="function")throw new Se(i);e=_e(e)||0,kt(r)&&(st=!!r.leading,at="maxWait"in r,F=at?qt(_e(r.maxWait)||0,e):F,ct="trailing"in r?!!r.trailing:ct);function gt(jt){var Me=g,Ve=I;return g=I=h,ot=jt,$=t.apply(Ve,Me),$}function At(jt){return ot=jt,K=dr(Pt,e),st?gt(jt):$}function Tt(jt){var Me=jt-Y,Ve=jt-ot,dl=e-Me;return at?re(dl,F-Ve):dl}function bt(jt){var Me=jt-Y,Ve=jt-ot;return Y===h||Me>=e||Me<0||at&&Ve>=F}function Pt(){var jt=ui();if(bt(jt))return wt(jt);K=dr(Pt,Tt(jt))}function wt(jt){return K=h,ct&&g?gt(jt):(g=I=h,$)}function me(){K!==h&&ru(K),ot=0,g=Y=I=K=h}function ae(){return K===h?$:wt(ui())}function ye(){var jt=ui(),Me=bt(jt);if(g=arguments,I=this,Y=jt,Me){if(K===h)return At(Y);if(at)return ru(K),K=dr(Pt,e),gt(Y)}return K===h&&(K=dr(Pt,e)),$}return ye.cancel=me,ye.flush=ae,ye}var Ug=_t(function(t,e){return Ua(t,1,e)}),Bg=_t(function(t,e,r){return Ua(t,_e(e)||0,r)});function Fg(t){return We(t,l)}function li(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Se(i);var r=function(){var g=arguments,I=e?e.apply(this,g):g[0],F=r.cache;if(F.has(I))return F.get(I);var $=t.apply(this,g);return r.cache=F.set(I,$)||F,$};return r.cache=new(li.Cache||Ge),r}li.Cache=Ge;function ci(t){if(typeof t!="function")throw new Se(i);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Gg(t){return zu(2,t)}var Hg=Th(function(t,e){e=e.length==1&&St(e[0])?Wt(e[0],pe(yt())):Wt(ne(e,1),pe(yt()));var r=e.length;return _t(function(g){for(var I=-1,F=re(g.length,r);++I<F;)g[I]=e[I].call(this,g[I]);return he(t,this,g)})}),Uo=_t(function(t,e){var r=Qe(e,Hn(Uo));return We(t,u,h,e,r)}),Ju=_t(function(t,e){var r=Qe(e,Hn(Ju));return We(t,v,h,e,r)}),Wg=ke(function(t,e){return We(t,p,h,h,h,e)});function kg(t,e){if(typeof t!="function")throw new Se(i);return e=e===h?e:Rt(e),_t(t,e)}function zg(t,e){if(typeof t!="function")throw new Se(i);return e=e==null?0:qt(Rt(e),0),_t(function(r){var g=r[e],I=nn(r,0,e);return g&&qe(I,g),he(t,this,I)})}function $g(t,e,r){var g=!0,I=!0;if(typeof t!="function")throw new Se(i);return kt(r)&&(g="leading"in r?!!r.leading:g,I="trailing"in r?!!r.trailing:I),Ku(t,e,{leading:g,maxWait:e,trailing:I})}function jg(t){return ku(t,1)}function Vg(t,e){return Uo(bo(e),t)}function Kg(){if(!arguments.length)return[];var t=arguments[0];return St(t)?t:[t]}function Jg(t){return Re(t,R)}function qg(t,e){return e=typeof e=="function"?e:h,Re(t,R,e)}function Qg(t){return Re(t,b|R)}function Yg(t,e){return e=typeof e=="function"?e:h,Re(t,b|R,e)}function Xg(t,e){return e==null||Na(t,e,Zt(e))}function we(t,e){return t===e||t!==t&&e!==e}var Zg=ni(ao),tv=ni(function(t,e){return t>=e}),mn=Wa(function(){return arguments}())?Wa:function(t){return zt(t)&&Nt.call(t,"callee")&&!_a.call(t,"callee")},St=et.isArray,ev=ua?pe(ua):lh;function ce(t){return t!=null&&fi(t.length)&&!$e(t)}function $t(t){return zt(t)&&ce(t)}function nv(t){return t===!0||t===!1||zt(t)&&oe(t)==tt}var rn=vd||Ko,rv=la?pe(la):ch;function iv(t){return zt(t)&&t.nodeType===1&&!hr(t)}function ov(t){if(t==null)return!0;if(ce(t)&&(St(t)||typeof t=="string"||typeof t.splice=="function"||rn(t)||Wn(t)||mn(t)))return!t.length;var e=ie(t);if(e==ft||e==it)return!t.size;if(fr(t))return!co(t).length;for(var r in t)if(Nt.call(t,r))return!1;return!0}function sv(t,e){return ur(t,e)}function av(t,e,r){r=typeof r=="function"?r:h;var g=r?r(t,e):h;return g===h?ur(t,e,h,r):!!g}function Bo(t){if(!zt(t))return!1;var e=oe(t);return e==vt||e==mt||typeof t.message=="string"&&typeof t.name=="string"&&!hr(t)}function uv(t){return typeof t=="number"&&Ia(t)}function $e(t){if(!kt(t))return!1;var e=oe(t);return e==Ot||e==xt||e==j||e==ue}function qu(t){return typeof t=="number"&&t==Rt(t)}function fi(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=z}function kt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function zt(t){return t!=null&&typeof t=="object"}var Qu=ca?pe(ca):dh;function lv(t,e){return t===e||lo(t,e,_o(e))}function cv(t,e,r){return r=typeof r=="function"?r:h,lo(t,e,_o(e),r)}function fv(t){return Yu(t)&&t!=+t}function dv(t){if(qh(t))throw new Ct(s);return ka(t)}function hv(t){return t===null}function pv(t){return t==null}function Yu(t){return typeof t=="number"||zt(t)&&oe(t)==Mt}function hr(t){if(!zt(t)||oe(t)!=Ut)return!1;var e=Fr(t);if(e===null)return!0;var r=Nt.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Dr.call(r)==cd}var Fo=fa?pe(fa):hh;function gv(t){return qu(t)&&t>=-z&&t<=z}var Xu=da?pe(da):ph;function di(t){return typeof t=="string"||!St(t)&&zt(t)&&oe(t)==ut}function ve(t){return typeof t=="symbol"||zt(t)&&oe(t)==pt}var Wn=ha?pe(ha):gh;function vv(t){return t===h}function mv(t){return zt(t)&&ie(t)==Kt}function yv(t){return zt(t)&&oe(t)==un}var Av=ni(fo),bv=ni(function(t,e){return t<=e});function Zu(t){if(!t)return[];if(ce(t))return di(t)?Pe(t):le(t);if(tr&&t[tr])return Xf(t[tr]());var e=ie(t),r=e==ft?Xi:e==it?Mr:kn;return r(t)}function je(t){if(!t)return t===0?t:0;if(t=_e(t),t===x||t===-x){var e=t<0?-1:1;return e*W}return t===t?t:0}function Rt(t){var e=je(t),r=e%1;return e===e?r?e-r:e:0}function tl(t){return t?hn(Rt(t),0,Z):0}function _e(t){if(typeof t=="number")return t;if(ve(t))return J;if(kt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=kt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Aa(t);var r=tf.test(t);return r||nf.test(t)?Nf(t.slice(2),r?2:8):Zc.test(t)?J:+t}function el(t){return De(t,fe(t))}function Cv(t){return t?hn(Rt(t),-z,z):t===0?t:0}function Dt(t){return t==null?"":ge(t)}var Sv=Fn(function(t,e){if(fr(e)||ce(e)){De(e,Zt(e),t);return}for(var r in e)Nt.call(e,r)&&or(t,r,e[r])}),nl=Fn(function(t,e){De(e,fe(e),t)}),hi=Fn(function(t,e,r,g){De(e,fe(e),t,g)}),Ov=Fn(function(t,e,r,g){De(e,Zt(e),t,g)}),Rv=ke(io);function Ev(t,e){var r=Bn(t);return e==null?r:Da(r,e)}var Tv=_t(function(t,e){t=Bt(t);var r=-1,g=e.length,I=g>2?e[2]:h;for(I&&se(e[0],e[1],I)&&(g=1);++r<g;)for(var F=e[r],$=fe(F),K=-1,Y=$.length;++K<Y;){var ot=$[K],st=t[ot];(st===h||we(st,Dn[ot])&&!Nt.call(t,ot))&&(t[ot]=F[ot])}return t}),_v=_t(function(t){return t.push(h,Au),he(rl,h,t)});function Pv(t,e){return ga(t,yt(e,3),Le)}function Iv(t,e){return ga(t,yt(e,3),so)}function wv(t,e){return t==null?t:oo(t,yt(e,3),fe)}function Mv(t,e){return t==null?t:Ga(t,yt(e,3),fe)}function xv(t,e){return t&&Le(t,yt(e,3))}function Lv(t,e){return t&&so(t,yt(e,3))}function Dv(t){return t==null?[]:Jr(t,Zt(t))}function Nv(t){return t==null?[]:Jr(t,fe(t))}function Go(t,e,r){var g=t==null?h:pn(t,e);return g===h?r:g}function Uv(t,e){return t!=null&&Su(t,e,oh)}function Ho(t,e){return t!=null&&Su(t,e,sh)}var Bv=pu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=Nr.call(e)),t[e]=r},ko(de)),Fv=pu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=Nr.call(e)),Nt.call(t,e)?t[e].push(r):t[e]=[r]},yt),Gv=_t(ar);function Zt(t){return ce(t)?xa(t):co(t)}function fe(t){return ce(t)?xa(t,!0):vh(t)}function Hv(t,e){var r={};return e=yt(e,3),Le(t,function(g,I,F){He(r,e(g,I,F),g)}),r}function Wv(t,e){var r={};return e=yt(e,3),Le(t,function(g,I,F){He(r,I,e(g,I,F))}),r}var kv=Fn(function(t,e,r){qr(t,e,r)}),rl=Fn(function(t,e,r,g){qr(t,e,r,g)}),zv=ke(function(t,e){var r={};if(t==null)return r;var g=!1;e=Wt(e,function(F){return F=en(F,t),g||(g=F.length>1),F}),De(t,Eo(t),r),g&&(r=Re(r,b|E|R,Bh));for(var I=e.length;I--;)mo(r,e[I]);return r});function $v(t,e){return il(t,ci(yt(e)))}var jv=ke(function(t,e){return t==null?{}:yh(t,e)});function il(t,e){if(t==null)return{};var r=Wt(Eo(t),function(g){return[g]});return e=yt(e),qa(t,r,function(g,I){return e(g,I[0])})}function Vv(t,e,r){e=en(e,t);var g=-1,I=e.length;for(I||(I=1,t=h);++g<I;){var F=t==null?h:t[Ne(e[g])];F===h&&(g=I,F=r),t=$e(F)?F.call(t):F}return t}function Kv(t,e,r){return t==null?t:lr(t,e,r)}function Jv(t,e,r,g){return g=typeof g=="function"?g:h,t==null?t:lr(t,e,r,g)}var ol=mu(Zt),sl=mu(fe);function qv(t,e,r){var g=St(t),I=g||rn(t)||Wn(t);if(e=yt(e,4),r==null){var F=t&&t.constructor;I?r=g?new F:[]:kt(t)?r=$e(F)?Bn(Fr(t)):{}:r={}}return(I?Ce:Le)(t,function($,K,Y){return e(r,$,K,Y)}),r}function Qv(t,e){return t==null?!0:mo(t,e)}function Yv(t,e,r){return t==null?t:tu(t,e,bo(r))}function Xv(t,e,r,g){return g=typeof g=="function"?g:h,t==null?t:tu(t,e,bo(r),g)}function kn(t){return t==null?[]:Yi(t,Zt(t))}function Zv(t){return t==null?[]:Yi(t,fe(t))}function tm(t,e,r){return r===h&&(r=e,e=h),r!==h&&(r=_e(r),r=r===r?r:0),e!==h&&(e=_e(e),e=e===e?e:0),hn(_e(t),e,r)}function em(t,e,r){return e=je(e),r===h?(r=e,e=0):r=je(r),t=_e(t),ah(t,e,r)}function nm(t,e,r){if(r&&typeof r!="boolean"&&se(t,e,r)&&(e=r=h),r===h&&(typeof e=="boolean"?(r=e,e=h):typeof t=="boolean"&&(r=t,t=h)),t===h&&e===h?(t=0,e=1):(t=je(t),e===h?(e=t,t=0):e=je(e)),t>e){var g=t;t=e,e=g}if(r||t%1||e%1){var I=wa();return re(t+I*(e-t+Df("1e-"+((I+"").length-1))),e)}return po(t,e)}var rm=Gn(function(t,e,r){return e=e.toLowerCase(),t+(r?al(e):e)});function al(t){return Wo(Dt(t).toLowerCase())}function ul(t){return t=Dt(t),t&&t.replace(of,Kf).replace(Rf,"")}function im(t,e,r){t=Dt(t),e=ge(e);var g=t.length;r=r===h?g:hn(Rt(r),0,g);var I=r;return r-=e.length,r>=0&&t.slice(r,I)==e}function om(t){return t=Dt(t),t&&Fc.test(t)?t.replace(Gs,Jf):t}function sm(t){return t=Dt(t),t&&$c.test(t)?t.replace(Ni,"\\$&"):t}var am=Gn(function(t,e,r){return t+(r?"-":"")+e.toLowerCase()}),um=Gn(function(t,e,r){return t+(r?" ":"")+e.toLowerCase()}),lm=fu("toLowerCase");function cm(t,e,r){t=Dt(t),e=Rt(e);var g=e?Ln(t):0;if(!e||g>=e)return t;var I=(e-g)/2;return ei(kr(I),r)+t+ei(Wr(I),r)}function fm(t,e,r){t=Dt(t),e=Rt(e);var g=e?Ln(t):0;return e&&g<e?t+ei(e-g,r):t}function dm(t,e,r){t=Dt(t),e=Rt(e);var g=e?Ln(t):0;return e&&g<e?ei(e-g,r)+t:t}function hm(t,e,r){return r||e==null?e=0:e&&(e=+e),bd(Dt(t).replace(Ui,""),e||0)}function pm(t,e,r){return(r?se(t,e,r):e===h)?e=1:e=Rt(e),go(Dt(t),e)}function gm(){var t=arguments,e=Dt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var vm=Gn(function(t,e,r){return t+(r?"_":"")+e.toLowerCase()});function mm(t,e,r){return r&&typeof r!="number"&&se(t,e,r)&&(e=r=h),r=r===h?Z:r>>>0,r?(t=Dt(t),t&&(typeof e=="string"||e!=null&&!Fo(e))&&(e=ge(e),!e&&xn(t))?nn(Pe(t),0,r):t.split(e,r)):[]}var ym=Gn(function(t,e,r){return t+(r?" ":"")+Wo(e)});function Am(t,e,r){return t=Dt(t),r=r==null?0:hn(Rt(r),0,t.length),e=ge(e),t.slice(r,r+e.length)==e}function bm(t,e,r){var g=L.templateSettings;r&&se(t,e,r)&&(e=h),t=Dt(t),e=hi({},e,g,yu);var I=hi({},e.imports,g.imports,yu),F=Zt(I),$=Yi(I,F),K,Y,ot=0,st=e.interpolate||Tr,at="__p += '",ct=Zi((e.escape||Tr).source+"|"+st.source+"|"+(st===Hs?Xc:Tr).source+"|"+(e.evaluate||Tr).source+"|$","g"),gt="//# sourceURL="+(Nt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++If+"]")+`
`;t.replace(ct,function(bt,Pt,wt,me,ae,ye){return wt||(wt=me),at+=t.slice(ot,ye).replace(sf,qf),Pt&&(K=!0,at+=`' +
__e(`+Pt+`) +
'`),ae&&(Y=!0,at+=`';
`+ae+`;
__p += '`),wt&&(at+=`' +
((__t = (`+wt+`)) == null ? '' : __t) +
'`),ot=ye+bt.length,bt}),at+=`';
`;var At=Nt.call(e,"variable")&&e.variable;if(!At)at=`with (obj) {
`+at+`
}
`;else if(Qc.test(At))throw new Ct(S);at=(Y?at.replace(Dc,""):at).replace(Nc,"$1").replace(Uc,"$1;"),at="function("+(At||"obj")+`) {
`+(At?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+at+`return __p
}`;var Tt=cl(function(){return Lt(F,gt+"return "+at).apply(h,$)});if(Tt.source=at,Bo(Tt))throw Tt;return Tt}function Cm(t){return Dt(t).toLowerCase()}function Sm(t){return Dt(t).toUpperCase()}function Om(t,e,r){if(t=Dt(t),t&&(r||e===h))return Aa(t);if(!t||!(e=ge(e)))return t;var g=Pe(t),I=Pe(e),F=ba(g,I),$=Ca(g,I)+1;return nn(g,F,$).join("")}function Rm(t,e,r){if(t=Dt(t),t&&(r||e===h))return t.slice(0,Oa(t)+1);if(!t||!(e=ge(e)))return t;var g=Pe(t),I=Ca(g,Pe(e))+1;return nn(g,0,I).join("")}function Em(t,e,r){if(t=Dt(t),t&&(r||e===h))return t.replace(Ui,"");if(!t||!(e=ge(e)))return t;var g=Pe(t),I=ba(g,Pe(e));return nn(g,I).join("")}function Tm(t,e){var r=y,g=P;if(kt(e)){var I="separator"in e?e.separator:I;r="length"in e?Rt(e.length):r,g="omission"in e?ge(e.omission):g}t=Dt(t);var F=t.length;if(xn(t)){var $=Pe(t);F=$.length}if(r>=F)return t;var K=r-Ln(g);if(K<1)return g;var Y=$?nn($,0,K).join(""):t.slice(0,K);if(I===h)return Y+g;if($&&(K+=Y.length-K),Fo(I)){if(t.slice(K).search(I)){var ot,st=Y;for(I.global||(I=Zi(I.source,Dt(Ws.exec(I))+"g")),I.lastIndex=0;ot=I.exec(st);)var at=ot.index;Y=Y.slice(0,at===h?K:at)}}else if(t.indexOf(ge(I),K)!=K){var ct=Y.lastIndexOf(I);ct>-1&&(Y=Y.slice(0,ct))}return Y+g}function _m(t){return t=Dt(t),t&&Bc.test(t)?t.replace(Fs,nd):t}var Pm=Gn(function(t,e,r){return t+(r?" ":"")+e.toUpperCase()}),Wo=fu("toUpperCase");function ll(t,e,r){return t=Dt(t),e=r?h:e,e===h?Yf(t)?od(t):kf(t):t.match(e)||[]}var cl=_t(function(t,e){try{return he(t,h,e)}catch(r){return Bo(r)?r:new Ct(r)}}),Im=ke(function(t,e){return Ce(e,function(r){r=Ne(r),He(t,r,No(t[r],t))}),t});function wm(t){var e=t==null?0:t.length,r=yt();return t=e?Wt(t,function(g){if(typeof g[1]!="function")throw new Se(i);return[r(g[0]),g[1]]}):[],_t(function(g){for(var I=-1;++I<e;){var F=t[I];if(he(F[0],this,g))return he(F[1],this,g)}})}function Mm(t){return nh(Re(t,b))}function ko(t){return function(){return t}}function xm(t,e){return t==null||t!==t?e:t}var Lm=hu(),Dm=hu(!0);function de(t){return t}function zo(t){return za(typeof t=="function"?t:Re(t,b))}function Nm(t){return ja(Re(t,b))}function Um(t,e){return Va(t,Re(e,b))}var Bm=_t(function(t,e){return function(r){return ar(r,t,e)}}),Fm=_t(function(t,e){return function(r){return ar(t,r,e)}});function $o(t,e,r){var g=Zt(e),I=Jr(e,g);r==null&&!(kt(e)&&(I.length||!g.length))&&(r=e,e=t,t=this,I=Jr(e,Zt(e)));var F=!(kt(r)&&"chain"in r)||!!r.chain,$=$e(t);return Ce(I,function(K){var Y=e[K];t[K]=Y,$&&(t.prototype[K]=function(){var ot=this.__chain__;if(F||ot){var st=t(this.__wrapped__),at=st.__actions__=le(this.__actions__);return at.push({func:Y,args:arguments,thisArg:t}),st.__chain__=ot,st}return Y.apply(t,qe([this.value()],arguments))})}),t}function Gm(){return Xt._===this&&(Xt._=fd),this}function jo(){}function Hm(t){return t=Rt(t),_t(function(e){return Ka(e,t)})}var Wm=So(Wt),km=So(pa),zm=So(Vi);function fl(t){return Io(t)?Ki(Ne(t)):Ah(t)}function $m(t){return function(e){return t==null?h:pn(t,e)}}var jm=gu(),Vm=gu(!0);function Vo(){return[]}function Ko(){return!1}function Km(){return{}}function Jm(){return""}function qm(){return!0}function Qm(t,e){if(t=Rt(t),t<1||t>z)return[];var r=Z,g=re(t,Z);e=yt(e),t-=Z;for(var I=Qi(g,e);++r<t;)e(r);return I}function Ym(t){return St(t)?Wt(t,Ne):ve(t)?[t]:le(Mu(Dt(t)))}function Xm(t){var e=++ld;return Dt(t)+e}var Zm=ti(function(t,e){return t+e},0),t0=Oo("ceil"),e0=ti(function(t,e){return t/e},1),n0=Oo("floor");function r0(t){return t&&t.length?Kr(t,de,ao):h}function i0(t,e){return t&&t.length?Kr(t,yt(e,2),ao):h}function o0(t){return ma(t,de)}function s0(t,e){return ma(t,yt(e,2))}function a0(t){return t&&t.length?Kr(t,de,fo):h}function u0(t,e){return t&&t.length?Kr(t,yt(e,2),fo):h}var l0=ti(function(t,e){return t*e},1),c0=Oo("round"),f0=ti(function(t,e){return t-e},0);function d0(t){return t&&t.length?qi(t,de):0}function h0(t,e){return t&&t.length?qi(t,yt(e,2)):0}return L.after=Ng,L.ary=ku,L.assign=Sv,L.assignIn=nl,L.assignInWith=hi,L.assignWith=Ov,L.at=Rv,L.before=zu,L.bind=No,L.bindAll=Im,L.bindKey=$u,L.castArray=Kg,L.chain=Gu,L.chunk=np,L.compact=rp,L.concat=ip,L.cond=wm,L.conforms=Mm,L.constant=ko,L.countBy=dg,L.create=Ev,L.curry=ju,L.curryRight=Vu,L.debounce=Ku,L.defaults=Tv,L.defaultsDeep=_v,L.defer=Ug,L.delay=Bg,L.difference=op,L.differenceBy=sp,L.differenceWith=ap,L.drop=up,L.dropRight=lp,L.dropRightWhile=cp,L.dropWhile=fp,L.fill=dp,L.filter=pg,L.flatMap=mg,L.flatMapDeep=yg,L.flatMapDepth=Ag,L.flatten=Nu,L.flattenDeep=hp,L.flattenDepth=pp,L.flip=Fg,L.flow=Lm,L.flowRight=Dm,L.fromPairs=gp,L.functions=Dv,L.functionsIn=Nv,L.groupBy=bg,L.initial=mp,L.intersection=yp,L.intersectionBy=Ap,L.intersectionWith=bp,L.invert=Bv,L.invertBy=Fv,L.invokeMap=Sg,L.iteratee=zo,L.keyBy=Og,L.keys=Zt,L.keysIn=fe,L.map=ai,L.mapKeys=Hv,L.mapValues=Wv,L.matches=Nm,L.matchesProperty=Um,L.memoize=li,L.merge=kv,L.mergeWith=rl,L.method=Bm,L.methodOf=Fm,L.mixin=$o,L.negate=ci,L.nthArg=Hm,L.omit=zv,L.omitBy=$v,L.once=Gg,L.orderBy=Rg,L.over=Wm,L.overArgs=Hg,L.overEvery=km,L.overSome=zm,L.partial=Uo,L.partialRight=Ju,L.partition=Eg,L.pick=jv,L.pickBy=il,L.property=fl,L.propertyOf=$m,L.pull=Rp,L.pullAll=Bu,L.pullAllBy=Ep,L.pullAllWith=Tp,L.pullAt=_p,L.range=jm,L.rangeRight=Vm,L.rearg=Wg,L.reject=Pg,L.remove=Pp,L.rest=kg,L.reverse=Lo,L.sampleSize=wg,L.set=Kv,L.setWith=Jv,L.shuffle=Mg,L.slice=Ip,L.sortBy=Dg,L.sortedUniq=Up,L.sortedUniqBy=Bp,L.split=mm,L.spread=zg,L.tail=Fp,L.take=Gp,L.takeRight=Hp,L.takeRightWhile=Wp,L.takeWhile=kp,L.tap=rg,L.throttle=$g,L.thru=si,L.toArray=Zu,L.toPairs=ol,L.toPairsIn=sl,L.toPath=Ym,L.toPlainObject=el,L.transform=qv,L.unary=jg,L.union=zp,L.unionBy=$p,L.unionWith=jp,L.uniq=Vp,L.uniqBy=Kp,L.uniqWith=Jp,L.unset=Qv,L.unzip=Do,L.unzipWith=Fu,L.update=Yv,L.updateWith=Xv,L.values=kn,L.valuesIn=Zv,L.without=qp,L.words=ll,L.wrap=Vg,L.xor=Qp,L.xorBy=Yp,L.xorWith=Xp,L.zip=Zp,L.zipObject=tg,L.zipObjectDeep=eg,L.zipWith=ng,L.entries=ol,L.entriesIn=sl,L.extend=nl,L.extendWith=hi,$o(L,L),L.add=Zm,L.attempt=cl,L.camelCase=rm,L.capitalize=al,L.ceil=t0,L.clamp=tm,L.clone=Jg,L.cloneDeep=Qg,L.cloneDeepWith=Yg,L.cloneWith=qg,L.conformsTo=Xg,L.deburr=ul,L.defaultTo=xm,L.divide=e0,L.endsWith=im,L.eq=we,L.escape=om,L.escapeRegExp=sm,L.every=hg,L.find=gg,L.findIndex=Lu,L.findKey=Pv,L.findLast=vg,L.findLastIndex=Du,L.findLastKey=Iv,L.floor=n0,L.forEach=Hu,L.forEachRight=Wu,L.forIn=wv,L.forInRight=Mv,L.forOwn=xv,L.forOwnRight=Lv,L.get=Go,L.gt=Zg,L.gte=tv,L.has=Uv,L.hasIn=Ho,L.head=Uu,L.identity=de,L.includes=Cg,L.indexOf=vp,L.inRange=em,L.invoke=Gv,L.isArguments=mn,L.isArray=St,L.isArrayBuffer=ev,L.isArrayLike=ce,L.isArrayLikeObject=$t,L.isBoolean=nv,L.isBuffer=rn,L.isDate=rv,L.isElement=iv,L.isEmpty=ov,L.isEqual=sv,L.isEqualWith=av,L.isError=Bo,L.isFinite=uv,L.isFunction=$e,L.isInteger=qu,L.isLength=fi,L.isMap=Qu,L.isMatch=lv,L.isMatchWith=cv,L.isNaN=fv,L.isNative=dv,L.isNil=pv,L.isNull=hv,L.isNumber=Yu,L.isObject=kt,L.isObjectLike=zt,L.isPlainObject=hr,L.isRegExp=Fo,L.isSafeInteger=gv,L.isSet=Xu,L.isString=di,L.isSymbol=ve,L.isTypedArray=Wn,L.isUndefined=vv,L.isWeakMap=mv,L.isWeakSet=yv,L.join=Cp,L.kebabCase=am,L.last=Te,L.lastIndexOf=Sp,L.lowerCase=um,L.lowerFirst=lm,L.lt=Av,L.lte=bv,L.max=r0,L.maxBy=i0,L.mean=o0,L.meanBy=s0,L.min=a0,L.minBy=u0,L.stubArray=Vo,L.stubFalse=Ko,L.stubObject=Km,L.stubString=Jm,L.stubTrue=qm,L.multiply=l0,L.nth=Op,L.noConflict=Gm,L.noop=jo,L.now=ui,L.pad=cm,L.padEnd=fm,L.padStart=dm,L.parseInt=hm,L.random=nm,L.reduce=Tg,L.reduceRight=_g,L.repeat=pm,L.replace=gm,L.result=Vv,L.round=c0,L.runInContext=q,L.sample=Ig,L.size=xg,L.snakeCase=vm,L.some=Lg,L.sortedIndex=wp,L.sortedIndexBy=Mp,L.sortedIndexOf=xp,L.sortedLastIndex=Lp,L.sortedLastIndexBy=Dp,L.sortedLastIndexOf=Np,L.startCase=ym,L.startsWith=Am,L.subtract=f0,L.sum=d0,L.sumBy=h0,L.template=bm,L.times=Qm,L.toFinite=je,L.toInteger=Rt,L.toLength=tl,L.toLower=Cm,L.toNumber=_e,L.toSafeInteger=Cv,L.toString=Dt,L.toUpper=Sm,L.trim=Om,L.trimEnd=Rm,L.trimStart=Em,L.truncate=Tm,L.unescape=_m,L.uniqueId=Xm,L.upperCase=Pm,L.upperFirst=Wo,L.each=Hu,L.eachRight=Wu,L.first=Uu,$o(L,function(){var t={};return Le(L,function(e,r){Nt.call(L.prototype,r)||(t[r]=e)}),t}(),{chain:!1}),L.VERSION=o,Ce(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){L[t].placeholder=L}),Ce(["drop","take"],function(t,e){It.prototype[t]=function(r){r=r===h?1:qt(Rt(r),0);var g=this.__filtered__&&!e?new It(this):this.clone();return g.__filtered__?g.__takeCount__=re(r,g.__takeCount__):g.__views__.push({size:re(r,Z),type:t+(g.__dir__<0?"Right":"")}),g},It.prototype[t+"Right"]=function(r){return this.reverse()[t](r).reverse()}}),Ce(["filter","map","takeWhile"],function(t,e){var r=e+1,g=r==H||r==_;It.prototype[t]=function(I){var F=this.clone();return F.__iteratees__.push({iteratee:yt(I,3),type:r}),F.__filtered__=F.__filtered__||g,F}}),Ce(["head","last"],function(t,e){var r="take"+(e?"Right":"");It.prototype[t]=function(){return this[r](1).value()[0]}}),Ce(["initial","tail"],function(t,e){var r="drop"+(e?"":"Right");It.prototype[t]=function(){return this.__filtered__?new It(this):this[r](1)}}),It.prototype.compact=function(){return this.filter(de)},It.prototype.find=function(t){return this.filter(t).head()},It.prototype.findLast=function(t){return this.reverse().find(t)},It.prototype.invokeMap=_t(function(t,e){return typeof t=="function"?new It(this):this.map(function(r){return ar(r,t,e)})}),It.prototype.reject=function(t){return this.filter(ci(yt(t)))},It.prototype.slice=function(t,e){t=Rt(t);var r=this;return r.__filtered__&&(t>0||e<0)?new It(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==h&&(e=Rt(e),r=e<0?r.dropRight(-e):r.take(e-t)),r)},It.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},It.prototype.toArray=function(){return this.take(Z)},Le(It.prototype,function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),g=/^(?:head|last)$/.test(e),I=L[g?"take"+(e=="last"?"Right":""):e],F=g||/^find/.test(e);!I||(L.prototype[e]=function(){var $=this.__wrapped__,K=g?[1]:arguments,Y=$ instanceof It,ot=K[0],st=Y||St($),at=function(Pt){var wt=I.apply(L,qe([Pt],K));return g&&ct?wt[0]:wt};st&&r&&typeof ot=="function"&&ot.length!=1&&(Y=st=!1);var ct=this.__chain__,gt=!!this.__actions__.length,At=F&&!ct,Tt=Y&&!gt;if(!F&&st){$=Tt?$:new It(this);var bt=t.apply($,K);return bt.__actions__.push({func:si,args:[at],thisArg:h}),new Oe(bt,ct)}return At&&Tt?t.apply(this,K):(bt=this.thru(at),At?g?bt.value()[0]:bt.value():bt)})}),Ce(["pop","push","shift","sort","splice","unshift"],function(t){var e=xr[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",g=/^(?:pop|shift)$/.test(t);L.prototype[t]=function(){var I=arguments;if(g&&!this.__chain__){var F=this.value();return e.apply(St(F)?F:[],I)}return this[r](function($){return e.apply(St($)?$:[],I)})}}),Le(It.prototype,function(t,e){var r=L[e];if(r){var g=r.name+"";Nt.call(Un,g)||(Un[g]=[]),Un[g].push({name:e,func:r})}}),Un[Zr(h,w).name]=[{name:"wrapper",func:h}],It.prototype.clone=_d,It.prototype.reverse=Pd,It.prototype.value=Id,L.prototype.at=ig,L.prototype.chain=og,L.prototype.commit=sg,L.prototype.next=ag,L.prototype.plant=lg,L.prototype.reverse=cg,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=fg,L.prototype.first=L.prototype.head,tr&&(L.prototype[tr]=ug),L},Ye=sd();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Xt._=Ye,define(function(){return Ye})):ln?((ln.exports=Ye)._=Ye,ki._=Ye):Xt._=Ye}).call(Vn)});var sc={};ml(sc,{version:()=>Py});var Py,ac=Jo(()=>{nt();Py="beta"});var uc={};ml(uc,{remoteConfig:()=>Iy});var Iy,lc=Jo(()=>{nt();Iy={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});var cc=Vt((Ai,as)=>{nt();(function(o,n){typeof Ai=="object"&&typeof as=="object"?as.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Ai=="object"?Ai.Ably=n():o.Ably=n()})(window,function(){return function(h){var o={};function n(s){if(o[s])return o[s].exports;var i=o[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=o,n.d=function(s,i,S){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:S})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(i&1&&(s=n(s)),i&8||i&4&&typeof s=="object"&&s&&s.__esModule)return s;var S=Object.create(null);if(n.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:s}),i&2&&typeof s!="string")for(var A in s)n.d(S,A,function(c){return s[c]}.bind(null,A));return S},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=41)}([function(h,o,n){"use strict";o.__esModule=!0;var s=function(){function i(){}return i}();o.default=s},function(h,o,n){"use strict";n.r(o),n.d(o,"__extends",function(){return i}),n.d(o,"__assign",function(){return S}),n.d(o,"__rest",function(){return A}),n.d(o,"__decorate",function(){return c}),n.d(o,"__param",function(){return d}),n.d(o,"__metadata",function(){return b}),n.d(o,"__awaiter",function(){return E}),n.d(o,"__generator",function(){return R}),n.d(o,"__createBinding",function(){return a}),n.d(o,"__exportStar",function(){return O}),n.d(o,"__values",function(){return M}),n.d(o,"__read",function(){return w}),n.d(o,"__spread",function(){return C}),n.d(o,"__spreadArrays",function(){return m}),n.d(o,"__spreadArray",function(){return T}),n.d(o,"__await",function(){return u}),n.d(o,"__asyncGenerator",function(){return v}),n.d(o,"__asyncDelegator",function(){return f}),n.d(o,"__asyncValues",function(){return p}),n.d(o,"__makeTemplateObject",function(){return l}),n.d(o,"__importStar",function(){return P}),n.d(o,"__importDefault",function(){return D}),n.d(o,"__classPrivateFieldGet",function(){return k}),n.d(o,"__classPrivateFieldSet",function(){return H});var s=function(U,_){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,z){x.__proto__=z}||function(x,z){for(var W in z)Object.prototype.hasOwnProperty.call(z,W)&&(x[W]=z[W])},s(U,_)};function i(U,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");s(U,_);function x(){this.constructor=U}U.prototype=_===null?Object.create(_):(x.prototype=_.prototype,new x)}var S=function(){return S=Object.assign||function(_){for(var x,z=1,W=arguments.length;z<W;z++){x=arguments[z];for(var J in x)Object.prototype.hasOwnProperty.call(x,J)&&(_[J]=x[J])}return _},S.apply(this,arguments)};function A(U,_){var x={};for(var z in U)Object.prototype.hasOwnProperty.call(U,z)&&_.indexOf(z)<0&&(x[z]=U[z]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,z=Object.getOwnPropertySymbols(U);W<z.length;W++)_.indexOf(z[W])<0&&Object.prototype.propertyIsEnumerable.call(U,z[W])&&(x[z[W]]=U[z[W]]);return x}function c(U,_,x,z){var W=arguments.length,J=W<3?_:z===null?z=Object.getOwnPropertyDescriptor(_,x):z,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(U,_,x,z);else for(var Q=U.length-1;Q>=0;Q--)(Z=U[Q])&&(J=(W<3?Z(J):W>3?Z(_,x,J):Z(_,x))||J);return W>3&&J&&Object.defineProperty(_,x,J),J}function d(U,_){return function(x,z){_(x,z,U)}}function b(U,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(U,_)}function E(U,_,x,z){function W(J){return J instanceof x?J:new x(function(Z){Z(J)})}return new(x||(x=Promise))(function(J,Z){function Q(B){try{N(z.next(B))}catch(V){Z(V)}}function G(B){try{N(z.throw(B))}catch(V){Z(V)}}function N(B){B.done?J(B.value):W(B.value).then(Q,G)}N((z=z.apply(U,_||[])).next())})}function R(U,_){var x={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},z,W,J,Z;return Z={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function Q(N){return function(B){return G([N,B])}}function G(N){if(z)throw new TypeError("Generator is already executing.");for(;x;)try{if(z=1,W&&(J=N[0]&2?W.return:N[0]?W.throw||((J=W.return)&&J.call(W),0):W.next)&&!(J=J.call(W,N[1])).done)return J;switch(W=0,J&&(N=[N[0]&2,J.value]),N[0]){case 0:case 1:J=N;break;case 4:return x.label++,{value:N[1],done:!1};case 5:x.label++,W=N[1],N=[0];continue;case 7:N=x.ops.pop(),x.trys.pop();continue;default:if(J=x.trys,!(J=J.length>0&&J[J.length-1])&&(N[0]===6||N[0]===2)){x=0;continue}if(N[0]===3&&(!J||N[1]>J[0]&&N[1]<J[3])){x.label=N[1];break}if(N[0]===6&&x.label<J[1]){x.label=J[1],J=N;break}if(J&&x.label<J[2]){x.label=J[2],x.ops.push(N);break}J[2]&&x.ops.pop(),x.trys.pop();continue}N=_.call(U,x)}catch(B){N=[6,B],W=0}finally{z=J=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}var a=Object.create?function(U,_,x,z){z===void 0&&(z=x),Object.defineProperty(U,z,{enumerable:!0,get:function(){return _[x]}})}:function(U,_,x,z){z===void 0&&(z=x),U[z]=_[x]};function O(U,_){for(var x in U)x!=="default"&&!Object.prototype.hasOwnProperty.call(_,x)&&a(_,U,x)}function M(U){var _=typeof Symbol=="function"&&Symbol.iterator,x=_&&U[_],z=0;if(x)return x.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&z>=U.length&&(U=void 0),{value:U&&U[z++],done:!U}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(U,_){var x=typeof Symbol=="function"&&U[Symbol.iterator];if(!x)return U;var z=x.call(U),W,J=[],Z;try{for(;(_===void 0||_-- >0)&&!(W=z.next()).done;)J.push(W.value)}catch(Q){Z={error:Q}}finally{try{W&&!W.done&&(x=z.return)&&x.call(z)}finally{if(Z)throw Z.error}}return J}function C(){for(var U=[],_=0;_<arguments.length;_++)U=U.concat(w(arguments[_]));return U}function m(){for(var U=0,_=0,x=arguments.length;_<x;_++)U+=arguments[_].length;for(var z=Array(U),W=0,_=0;_<x;_++)for(var J=arguments[_],Z=0,Q=J.length;Z<Q;Z++,W++)z[W]=J[Z];return z}function T(U,_,x){if(x||arguments.length===2)for(var z=0,W=_.length,J;z<W;z++)(J||!(z in _))&&(J||(J=Array.prototype.slice.call(_,0,z)),J[z]=_[z]);return U.concat(J||Array.prototype.slice.call(_))}function u(U){return this instanceof u?(this.v=U,this):new u(U)}function v(U,_,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=x.apply(U,_||[]),W,J=[];return W={},Z("next"),Z("throw"),Z("return"),W[Symbol.asyncIterator]=function(){return this},W;function Z(j){z[j]&&(W[j]=function(tt){return new Promise(function(lt,mt){J.push([j,tt,lt,mt])>1||Q(j,tt)})})}function Q(j,tt){try{G(z[j](tt))}catch(lt){V(J[0][3],lt)}}function G(j){j.value instanceof u?Promise.resolve(j.value.v).then(N,B):V(J[0][2],j)}function N(j){Q("next",j)}function B(j){Q("throw",j)}function V(j,tt){j(tt),J.shift(),J.length&&Q(J[0][0],J[0][1])}}function f(U){var _,x;return _={},z("next"),z("throw",function(W){throw W}),z("return"),_[Symbol.iterator]=function(){return this},_;function z(W,J){_[W]=U[W]?function(Z){return(x=!x)?{value:u(U[W](Z)),done:W==="return"}:J?J(Z):Z}:J}}function p(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=U[Symbol.asyncIterator],x;return _?_.call(U):(U=typeof M=="function"?M(U):U[Symbol.iterator](),x={},z("next"),z("throw"),z("return"),x[Symbol.asyncIterator]=function(){return this},x);function z(J){x[J]=U[J]&&function(Z){return new Promise(function(Q,G){Z=U[J](Z),W(Q,G,Z.done,Z.value)})}}function W(J,Z,Q,G){Promise.resolve(G).then(function(N){J({value:N,done:Q})},Z)}}function l(U,_){return Object.defineProperty?Object.defineProperty(U,"raw",{value:_}):U.raw=_,U}var y=Object.create?function(U,_){Object.defineProperty(U,"default",{enumerable:!0,value:_})}:function(U,_){U.default=_};function P(U){if(U&&U.__esModule)return U;var _={};if(U!=null)for(var x in U)x!=="default"&&Object.prototype.hasOwnProperty.call(U,x)&&a(_,U,x);return y(_,U),_}function D(U){return U&&U.__esModule?U:{default:U}}function k(U,_,x,z){if(x==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?U!==_||!z:!_.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?z:x==="a"?z.call(U):z?z.value:_.get(U)}function H(U,_,x,z,W){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?U!==_||!W:!_.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?W.call(U,x):W?W.value=x:_.set(U,x),x}},function(h,o,n){"use strict";(function(s){o.__esModule=!0,o.allToUpperCase=o.allToLowerCase=o.encodeBody=o.decodeBody=o.Format=o.promisify=o.trim=o.arrChooseN=o.randomHexString=o.randomString=o.cheapRandStr=o.dataSizeBytes=o.inspectBody=o.inspectError=o.isErrorInfo=o.now=o.parseQueryString=o.toQueryString=o.arrPopRandomElement=o.defaultPostHeaders=o.defaultGetHeaders=o.allSame=o.arrEvery=o.arrFilter=o.arrMap=o.safeArrForEach=o.arrForEach=o.forInOwnNonNullProperties=o.valuesArray=o.keysArray=o.arrWithoutValue=o.arrDeleteValue=o.arrIn=o.arrIndexOf=o.arrSubtract=o.arrIntersectOb=o.arrIntersect=o.intersect=o.containsValue=o.inherits=o.prototypicalClone=o.shallowClone=o.isEmptyArg=o.isOnlyPropIn=o.isEmpty=o.isObject=o.ensureArray=o.isArray=o.copy=o.mixin=void 0,o.getGlobalObject=o.getJitterCoefficient=o.getBackoffCoefficient=void 0;var i=n(1),S=i.__importDefault(n(0)),A=i.__importDefault(n(8));function c(X){return Math.floor(Math.random()*X.length)}function d(X){for(var it=[],ut=1;ut<arguments.length;ut++)it[ut-1]=arguments[ut];for(var pt=0;pt<it.length;pt++){var Et=it[pt];if(!Et)break;var Kt=Object.prototype.hasOwnProperty;for(var un in Et)(!Kt||Kt.call(Et,un))&&(X[un]=Et[un])}return X}o.mixin=d;function b(X){return d({},X)}o.copy=b,o.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function E(X){return M(X)?[]:o.isArray(X)?X:[X]}o.ensureArray=E;function R(X){return Object.prototype.toString.call(X)=="[object Object]"}o.isObject=R;function a(X){for(var it in X)return!1;return!0}o.isEmpty=a;function O(X,it){for(var ut in X)if(ut!==it)return!1;return!0}o.isOnlyPropIn=O;function M(X){return X==null}o.isEmptyArg=M;function w(X){var it=new Object;for(var ut in X)it[ut]=X[ut];return it}o.shallowClone=w;function C(X,it){var ut=function(){function Et(){}return Et}();ut.prototype=X;var pt=new ut;return it&&d(pt,it),pt}o.prototypicalClone=C;var m=function(X,it){if(S.default.Config.inherits){S.default.Config.inherits(X,it);return}X.super_=it,X.prototype=C(it.prototype,{constructor:X})};o.inherits=m;function T(X,it){for(var ut in X)if(X[ut]==it)return!0;return!1}o.containsValue=T;function u(X,it){return o.isArray(it)?v(X,it):f(X,it)}o.intersect=u;function v(X,it){for(var ut=[],pt=0;pt<X.length;pt++){var Et=X[pt];o.arrIndexOf(it,Et)!=-1&&ut.push(Et)}return ut}o.arrIntersect=v;function f(X,it){for(var ut=[],pt=0;pt<X.length;pt++){var Et=X[pt];Et in it&&ut.push(Et)}return ut}o.arrIntersectOb=f;function p(X,it){for(var ut=[],pt=0;pt<X.length;pt++){var Et=X[pt];o.arrIndexOf(it,Et)==-1&&ut.push(Et)}return ut}o.arrSubtract=p,o.arrIndexOf=Array.prototype.indexOf?function(X,it,ut){return X.indexOf(it,ut)}:function(X,it,ut){ut=ut||0;for(var pt=X.length;ut<pt;ut++)if(X[ut]===it)return ut;return-1};function l(X,it){return o.arrIndexOf(X,it)!==-1}o.arrIn=l;function y(X,it){var ut=o.arrIndexOf(X,it),pt=ut!=-1;return pt&&X.splice(ut,1),pt}o.arrDeleteValue=y;function P(X,it){var ut=X.slice();return y(ut,it),ut}o.arrWithoutValue=P;function D(X,it){var ut=[];for(var pt in X)it&&!Object.prototype.hasOwnProperty.call(X,pt)||ut.push(pt);return ut}o.keysArray=D;function k(X,it){var ut=[];for(var pt in X)it&&!Object.prototype.hasOwnProperty.call(X,pt)||ut.push(X[pt]);return ut}o.valuesArray=k;function H(X,it){for(var ut in X)Object.prototype.hasOwnProperty.call(X,ut)&&X[ut]&&it(ut)}o.forInOwnNonNullProperties=H,o.arrForEach=Array.prototype.forEach?function(X,it){X.forEach(it)}:function(X,it){for(var ut=X.length,pt=0;pt<ut;pt++)it(X[pt],pt,X)};function U(X,it){return o.arrForEach(X.slice(),it)}o.safeArrForEach=U,o.arrMap=Array.prototype.map?function(X,it){return X.map(it)}:function(X,it){for(var ut=[],pt=X.length,Et=0;Et<pt;Et++)ut.push(it(X[Et],Et,X));return ut},o.arrFilter=Array.prototype.filter?function(X,it){return X.filter(it)}:function(X,it){for(var ut=[],pt=X.length,Et=0;Et<pt;Et++)it(X[Et])&&ut.push(X[Et]);return ut},o.arrEvery=Array.prototype.every?function(X,it){return X.every(it)}:function(X,it){for(var ut=X.length,pt=0;pt<ut;pt++)if(!it(X[pt],pt,X))return!1;return!0};function _(X,it){if(X.length===0)return!0;var ut=X[0][it];return o.arrEvery(X,function(pt){return pt[it]===ut})}o.allSame=_;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(X){var it=x[X||Ot.json];return{accept:it,"X-Ably-Version":A.default.apiVersion,"Ably-Agent":A.default.agent}}o.defaultGetHeaders=z;function W(X){var it,ut=it=x[X||Ot.json];return{accept:ut,"content-type":it,"X-Ably-Version":A.default.apiVersion,"Ably-Agent":A.default.agent}}o.defaultPostHeaders=W;function J(X){return X.splice(c(X),1)[0]}o.arrPopRandomElement=J;function Z(X){var it=[];if(X)for(var ut in X)it.push(encodeURIComponent(ut)+"="+encodeURIComponent(X[ut]));return it.length?"?"+it.join("&"):""}o.toQueryString=Z;function Q(X){for(var it,ut=/([^?&=]+)=?([^&]*)/g,pt={};it=ut.exec(X);)pt[decodeURIComponent(it[1])]=decodeURIComponent(it[2]);return pt}o.parseQueryString=Q,o.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}o.isErrorInfo=G;function N(X){var it,ut;return X instanceof Error||((ut=(it=X)===null||it===void 0?void 0:it.constructor)===null||ut===void 0?void 0:ut.name)==="ErrorInfo"?S.default.Config.inspect(X):X.toString()}o.inspectError=N;function B(X){return S.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:S.default.Config.inspect(X)}o.inspectBody=B;function V(X){if(S.default.BufferUtils.isBuffer(X))return S.default.BufferUtils.byteLength(X);if(typeof X=="string")return S.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}o.dataSizeBytes=V;function j(){return String(Math.random()).substr(2)}o.cheapRandStr=j;var tt=function(X){if(S.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var it=new Uint8Array(X);return S.default.Config.getRandomValues(it),S.default.BufferUtils.base64Encode(it)}for(var ut=S.default.BufferUtils.base64CharSet,pt=Math.round(X*4/3),Et="",Kt=0;Kt<pt;Kt++)Et+=ut[c(ut)];return Et};o.randomString=tt;var lt=function(X){if(S.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var it=new Uint8Array(X);return S.default.Config.getRandomValues(it),S.default.BufferUtils.hexEncode(it)}for(var ut=S.default.BufferUtils.hexCharSet,pt=X*2,Et="",Kt=0;Kt<pt;Kt++)Et+=ut[c(ut)];return Et};o.randomHexString=lt;function mt(X,it){for(var ut=Math.min(it,X.length),pt=X.slice(),Et=[],Kt=0;Kt<ut;Kt++)Et.push(J(pt));return Et}o.arrChooseN=mt,o.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function vt(X,it,ut){return new Promise(function(pt,Et){X[it].apply(X,i.__spreadArray(i.__spreadArray([],ut),[function(Kt,un){Kt?Et(Kt):pt(un)}]))})}o.promisify=vt;var Ot;(function(X){X.msgpack="msgpack",X.json="json"})(Ot=o.Format||(o.Format={}));function xt(X,it){return it=="msgpack"?S.default.Config.msgpack.decode(X):JSON.parse(String(X))}o.decodeBody=xt;function ft(X,it){return it=="msgpack"?S.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}o.encodeBody=ft;function Mt(X){return X.map(function(it){return it&&it.toLowerCase()})}o.allToLowerCase=Mt;function Yt(X){return X.map(function(it){return it&&it.toUpperCase()})}o.allToUpperCase=Yt;function Ut(X){return Math.min((X+2)/3,2)}o.getBackoffCoefficient=Ut;function Ht(){return 1-Math.random()*.2}o.getJitterCoefficient=Ht;function ue(){return s||(typeof window!="undefined"?window:self)}o.getGlobalObject=ue}).call(this,n(12))},function(h,o,n){"use strict";(function(s){o.__esModule=!0;var i=n(1),S=i.__importDefault(n(0)),A=s||(typeof window!="undefined"?window:self),c;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(c||(c={}));function d(a,O){return(""+a).padStart(O?3:2,"0")}function b(a){return S.default.Config.logTimestamps?function(O){var M=new Date;a(d(M.getHours())+":"+d(M.getMinutes())+":"+d(M.getSeconds())+"."+d(M.getMilliseconds(),1)+" "+O)}:a}var E=function(){var a,O,M,w;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((O=(a=A==null?void 0:A.console)===null||a===void 0?void 0:a.log)===null||O===void 0?void 0:O.apply)=="function"?(M=function(){for(var C=[],m=0;m<arguments.length;m++)C[m]=arguments[m]},w=console.warn?function(){for(var C=[],m=0;m<arguments.length;m++)C[m]=arguments[m]}:M):A!=null&&A.console.log?M=w=function(){Function.prototype.apply.call(console.log,console,arguments)}:M=w=function(){},[M,w].map(b)},R=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var O=E(),M=O[0],w=O[1];this.logHandler=M,this.logErrorHandler=w},a.logLevel=c.Error,a.LOG_NONE=c.None,a.LOG_ERROR=c.Error,a.LOG_MAJOR=c.Major,a.LOG_MINOR=c.Minor,a.LOG_MICRO=c.Micro,a.LOG_DEFAULT=c.Error,a.LOG_DEBUG=c.Micro,a.logAction=function(O,M,w){a.shouldLog(O)&&(O===c.Error?a.logErrorHandler:a.logHandler)("Ably: "+M+": "+w)},a.deprecated=function(O,M){a.deprecatedWithMsg(O,"Please use '"+M+"' instead.")},a.deprecatedWithMsg=function(O,M){a.shouldLog(c.Error)&&a.logErrorHandler("Ably: Deprecation warning - '"+O+"' is deprecated and will be removed from a future version. "+M)},a.shouldLog=function(O){return O<=a.logLevel},a.setLog=function(O,M){O!==void 0&&(a.logLevel=O),M!==void 0&&(a.logHandler=a.logErrorHandler=M)},a}();o.default=R}).call(this,n(12))},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var i=s,S=i.lib,A=S.WordArray,c=A.init,d=A.init=function(b){if(b instanceof ArrayBuffer&&(b=new Uint8Array(b)),(b instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&b instanceof Uint8ClampedArray||b instanceof Int16Array||b instanceof Uint16Array||b instanceof Int32Array||b instanceof Uint32Array||b instanceof Float32Array||b instanceof Float64Array)&&(b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),b instanceof Uint8Array){for(var E=b.byteLength,R=[],a=0;a<E;a++)R[a>>>2]|=b[a]<<24-a%4*8;c.call(this,R,E)}else c.apply(this,arguments)};d.prototype=A}}(),s.lib.WordArray})},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),S=s.__importStar(n(2)),A=function(){function c(d,b,E,R){this.message=d,this.code=b,this.statusCode=E,this.cause=R}return c.prototype.toString=function(){var d="["+this.constructor.name;return this.message&&(d+=": "+this.message),this.statusCode&&(d+="; statusCode="+this.statusCode),this.code&&(d+="; code="+this.code),this.cause&&(d+="; cause="+S.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(d+="; see "+this.href+" "),d+="]",d},c.fromValues=function(d){var b=d,E=b.message,R=b.code,a=b.statusCode;if(typeof E!="string"||typeof R!="number"||typeof a!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(d));var O=Object.assign(new c(E,R,a),d);return O.code&&!O.href&&(O.href="https://help.ably.io/error/"+O.code),O},c}();o.default=A},function(h,o,n){(function(s){(function(i,S){h.exports=o=S()})(this,function(){var i=i||function(S,A){var c;if(typeof window!="undefined"&&window.crypto&&(c=window.crypto),!c&&typeof window!="undefined"&&window.msCrypto&&(c=window.msCrypto),!c&&typeof s!="undefined"&&s.crypto&&(c=s.crypto),!c)try{c=n(44)}catch(f){}var d=function(){if(c){if(typeof c.getRandomValues=="function")try{return c.getRandomValues(new Uint32Array(1))[0]}catch(f){}if(typeof c.randomBytes=="function")try{return c.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},b=Object.create||function(){function f(){}return function(p){var l;return f.prototype=p,l=new f,f.prototype=null,l}}(),E={},R=E.lib={},a=R.Base=function(){return{extend:function(f){var p=b(this);return f&&p.mixIn(f),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var p in f)f.hasOwnProperty(p)&&(this[p]=f[p]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),O=R.WordArray=a.extend({init:function(f,p){f=this.words=f||[],p!=A?this.sigBytes=p:this.sigBytes=f.length*4},toString:function(f){return(f||w).stringify(this)},concat:function(f){var p=this.words,l=f.words,y=this.sigBytes,P=f.sigBytes;if(this.clamp(),y%4)for(var D=0;D<P;D++){var k=l[D>>>2]>>>24-D%4*8&255;p[y+D>>>2]|=k<<24-(y+D)%4*8}else for(var D=0;D<P;D+=4)p[y+D>>>2]=l[D>>>2];return this.sigBytes+=P,this},clamp:function(){var f=this.words,p=this.sigBytes;f[p>>>2]&=4294967295<<32-p%4*8,f.length=S.ceil(p/4)},clone:function(){var f=a.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var p=[],l=0;l<f;l+=4)p.push(d());return new O.init(p,f)}}),M=E.enc={},w=M.Hex={stringify:function(f){for(var p=f.words,l=f.sigBytes,y=[],P=0;P<l;P++){var D=p[P>>>2]>>>24-P%4*8&255;y.push((D>>>4).toString(16)),y.push((D&15).toString(16))}return y.join("")},parse:function(f){for(var p=f.length,l=[],y=0;y<p;y+=2)l[y>>>3]|=parseInt(f.substr(y,2),16)<<24-y%8*4;return new O.init(l,p/2)}},C=M.Latin1={stringify:function(f){for(var p=f.words,l=f.sigBytes,y=[],P=0;P<l;P++){var D=p[P>>>2]>>>24-P%4*8&255;y.push(String.fromCharCode(D))}return y.join("")},parse:function(f){for(var p=f.length,l=[],y=0;y<p;y++)l[y>>>2]|=(f.charCodeAt(y)&255)<<24-y%4*8;return new O.init(l,p)}},m=M.Utf8={stringify:function(f){try{return decodeURIComponent(escape(C.stringify(f)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(f){return C.parse(unescape(encodeURIComponent(f)))}},T=R.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new O.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=m.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var p,l=this._data,y=l.words,P=l.sigBytes,D=this.blockSize,k=D*4,H=P/k;f?H=S.ceil(H):H=S.max((H|0)-this._minBufferSize,0);var U=H*D,_=S.min(U*4,P);if(U){for(var x=0;x<U;x+=D)this._doProcessBlock(y,x);p=y.splice(0,U),l.sigBytes-=_}return new O.init(p,_)},clone:function(){var f=a.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),u=R.Hasher=T.extend({cfg:a.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(f){return function(p,l){return new f.init(l).finalize(p)}},_createHmacHelper:function(f){return function(p,l){return new v.HMAC.init(f,l).finalize(p)}}}),v=E.algo={};return E}(Math);return i})}).call(this,n(12))},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(3)),A=s.__importDefault(n(0));function c(E,R,a){try{R.apply(E,a)}catch(O){S.default.logAction(S.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+O+"; stack = "+(O&&O.stack))}}function d(E,R,a){for(var O,M,w,C=0;C<E.length;C++)if(O=E[C],a&&(O=O[a]),i.isArray(O)){for(;(M=i.arrIndexOf(O,R))!==-1;)O.splice(M,1);a&&O.length===0&&delete E[C][a]}else if(i.isObject(O))for(w in O)Object.prototype.hasOwnProperty.call(O,w)&&i.isArray(O[w])&&d([O],R,w)}var b=function(){function E(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return E.prototype.on=function(){for(var R=this,a=[],O=0;O<arguments.length;O++)a[O]=arguments[O];if(a.length===1){var M=a[0];if(typeof M=="function")this.any.push(M);else throw new Error("EventListener.on(): Invalid arguments: "+A.default.Config.inspect(a))}if(a.length===2){var w=a[0],C=a[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+A.default.Config.inspect(a));if(i.isEmptyArg(w))this.any.push(C);else if(i.isArray(w))w.forEach(function(T){R.on(T,C)});else{if(typeof w!="string")throw new Error("EventListener.on(): Invalid arguments: "+A.default.Config.inspect(a));var m=this.events[w]||(this.events[w]=[]);m.push(C)}}},E.prototype.off=function(){for(var R,a=this,O=[],M=0;M<arguments.length;M++)O[M]=arguments[M];if(O.length==0||i.isEmptyArg(O[0])&&i.isEmptyArg(O[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var w=O[0],C=O[1],m=null,T=null;if(O.length===1||!C)typeof w=="function"?m=w:T=w;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+A.default.Config.inspect(O));R=[w,C],T=R[0],m=R[1]}if(m&&i.isEmptyArg(T)){d([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(i.isArray(T)){T.forEach(function(u){a.off(u,m)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+A.default.Config.inspect(O));m?d([this.events,this.eventsOnce],m,T):(delete this.events[T],delete this.eventsOnce[T])},E.prototype.listeners=function(R){if(R){var a=this.events[R]||[];return this.eventsOnce[R]&&Array.prototype.push.apply(a,this.eventsOnce[R]),a.length?a:null}return this.any.length?this.any:null},E.prototype.emit=function(R){for(var a=[],O=1;O<arguments.length;O++)a[O-1]=arguments[O];var M={event:R},w=[];this.anyOnce.length&&(Array.prototype.push.apply(w,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(w,this.any);var C=this.eventsOnce[R];C&&(Array.prototype.push.apply(w,C),delete this.eventsOnce[R]);var m=this.events[R];m&&Array.prototype.push.apply(w,m),i.arrForEach(w,function(T){c(M,T,a)})},E.prototype.once=function(){for(var R=this,a=[],O=0;O<arguments.length;O++)a[O]=arguments[O];var M=a.length;if((M===0||M===1&&typeof a[0]!="function")&&A.default.Config.Promise){var w=a[0];if(typeof w!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+A.default.Config.inspect(a));return new A.default.Config.Promise(function(f){R.once(w,f)})}var C=a[0],m=a[1];if(a.length===1&&typeof C=="function")this.anyOnce.push(C);else if(i.isEmptyArg(C)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+A.default.Config.inspect(a));this.anyOnce.push(m)}else if(i.isArray(C)){var T=this,u=function(){var f=Array.prototype.slice.call(arguments);if(i.arrForEach(C,function(p){T.off(p,u)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+A.default.Config.inspect(a));m.apply(this,f)};i.arrForEach(C,function(f){T.on(f,u)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+A.default.Config.inspect(a));var v=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+A.default.Config.inspect(a));v.push(m)}}},E.prototype.whenState=function(R,a,O){for(var M=this,w=[],C=3;C<arguments.length;C++)w[C-3]=arguments[C];var m={event:R};if(typeof R!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof O!="function"&&A.default.Config.Promise)return new A.default.Config.Promise(function(T){E.prototype.whenState.apply(M,[R,a,T].concat(w))});R===a?c(m,O,w):this.once(R,O)},E}();o.default=b},function(h,o,n){"use strict";o.__esModule=!0,o.getDefaults=o.normaliseOptions=o.objectifyOptions=o.getHosts=o.getFallbackHosts=o.environmentFallbackHosts=o.getHttpScheme=o.getPort=o.getHost=void 0;var s=n(1),i=s.__importDefault(n(0)),S=s.__importStar(n(2)),A=s.__importDefault(n(3)),c=s.__importDefault(n(5)),d=n(42),b="ably-js/"+d.version,E={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:d.version,apiVersion:"1.2",agent:b,getHost:R,getPort:a,getHttpScheme:O,environmentFallbackHosts:M,getFallbackHosts:w,getHosts:C,checkHost:m,objectifyOptions:v,normaliseOptions:f};function R(l,y,P){return P?y=y==l.restHost&&l.realtimeHost||y||l.realtimeHost:y=y||l.restHost,y}o.getHost=R;function a(l,y){return y||l.tls?l.tlsPort:l.port}o.getPort=a;function O(l){return l.tls?"https://":"http://"}o.getHttpScheme=O;function M(l){return[l+"-a-fallback.ably-realtime.com",l+"-b-fallback.ably-realtime.com",l+"-c-fallback.ably-realtime.com",l+"-d-fallback.ably-realtime.com",l+"-e-fallback.ably-realtime.com"]}o.environmentFallbackHosts=M;function w(l){var y=l.fallbackHosts,P=typeof l.httpMaxRetryCount!="undefined"?l.httpMaxRetryCount:E.httpMaxRetryCount;return y?S.arrChooseN(y,P):[]}o.getFallbackHosts=w;function C(l){return[l.restHost].concat(w(l))}o.getHosts=C;function m(l){if(typeof l!="string")throw new c.default("host must be a string; was a "+typeof l,4e4,400);if(!l.length)throw new c.default("host must not be zero-length",4e4,400)}function T(l,y,P){return l.realtimeHost?l.realtimeHost:l.restHost?(A.default.logAction(A.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+l.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+l.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),l.restHost):y?E.REALTIME_HOST:P+"-"+E.REALTIME_HOST}function u(l){var y={};for(var P in E.TIMEOUTS)y[P]=l[P]||E.TIMEOUTS[P];return y}function v(l){return typeof l=="string"?l.indexOf(":")==-1?{token:l}:{key:l}:l}o.objectifyOptions=v;function f(l){if(l.host&&(A.default.deprecated("host","restHost"),l.restHost=l.host),l.wsHost&&(A.default.deprecated("wsHost","realtimeHost"),l.realtimeHost=l.wsHost),l.queueEvents&&(A.default.deprecated("queueEvents","queueMessages"),l.queueMessages=l.queueEvents),l.fallbackHostsUseDefault){if(l.fallbackHosts){var y="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw A.default.logAction(A.default.LOG_ERROR,"Defaults.normaliseOptions",y),new c.default(y,4e4,400)}if(l.port||l.tlsPort){var y="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw A.default.logAction(A.default.LOG_ERROR,"Defaults.normaliseOptions",y),new c.default(y,4e4,400)}l.environment?A.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):A.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),l.fallbackHosts=E.FALLBACK_HOSTS}l.recover===!0&&(A.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),l.recover=function(z,W){W(!0)}),typeof l.recover=="function"&&l.closeOnUnload===!0&&(A.default.logAction(A.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),l.recover=void 0),"closeOnUnload"in l||(l.closeOnUnload=!l.recover),l.transports&&S.arrIn(l.transports,"xhr")&&(A.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),S.arrDeleteValue(l.transports,"xhr"),l.transports.push("xhr_streaming")),"queueMessages"in l||(l.queueMessages=!0);var P=l.environment&&String(l.environment).toLowerCase()||E.ENVIRONMENT,D=!P||P==="production";!l.fallbackHosts&&!l.restHost&&!l.realtimeHost&&!l.port&&!l.tlsPort&&(l.fallbackHosts=D?E.FALLBACK_HOSTS:M(P));var k=l.restHost||(D?E.REST_HOST:P+"-"+E.REST_HOST),H=T(l,D,P);S.arrForEach((l.fallbackHosts||[]).concat(k,H),m),l.port=l.port||E.PORT,l.tlsPort=l.tlsPort||E.TLS_PORT,"tls"in l||(l.tls=!0);var U=u(l);if("useBinaryProtocol"in l?l.useBinaryProtocol=i.default.Config.supportsBinary&&l.useBinaryProtocol:l.useBinaryProtocol=i.default.Config.preferBinary,l.clientId){var _=l.headers=l.headers||{};_["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(l.clientId))}if("idempotentRestPublishing"in l||(l.idempotentRestPublishing=!0),l.promises&&!i.default.Config.Promise&&(A.default.logAction(A.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),l.promises=!1),l.agents)for(var x in l.agents)E.agent+=" "+x+"/"+l.agents[x];return s.__assign(s.__assign({},l),{useBinaryProtocol:"useBinaryProtocol"in l?i.default.Config.supportsBinary&&l.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:H,restHost:k,maxMessageSize:l.maxMessageSize||E.maxMessageSize,timeouts:U})}o.normaliseOptions=f,o.default=E;function p(l){return Object.assign(E,l)}o.getDefaults=p},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),S=s.__importDefault(n(3)),A=s.__importDefault(n(5)),c=s.__importStar(n(2));function d(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function b(a){if(a&&a.cipher&&!a.cipher.channelCipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var O=i.default.Crypto.getCipher(a.cipher);return{cipher:O.cipherParams,channelCipher:O.cipher}}return a}function E(a){var O=0;return a.name&&(O+=a.name.length),a.clientId&&(O+=a.clientId.length),a.extras&&(O+=JSON.stringify(a.extras).length),a.data&&(O+=c.dataSizeBytes(a.data)),O}var R=function(){function a(){}return a.prototype.toJSON=function(){var O=this.encoding,M=this.data;return M&&i.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(O=O?O+"/base64":"base64",M=i.default.BufferUtils.base64Encode(M)):M=i.default.BufferUtils.toBuffer(M)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:O,data:M}},a.prototype.toString=function(){var O="[Message";return this.name&&(O+="; name="+this.name),this.id&&(O+="; id="+this.id),this.timestamp&&(O+="; timestamp="+this.timestamp),this.clientId&&(O+="; clientId="+this.clientId),this.connectionId&&(O+="; connectionId="+this.connectionId),this.encoding&&(O+="; encoding="+this.encoding),this.extras&&(O+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?O+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?O+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):O+="; data (json)="+JSON.stringify(this.data)),this.extras&&(O+="; extras="+JSON.stringify(this.extras)),O+="]",O},a.encrypt=function(O,M,w){var C=O.data,m=O.encoding,T=M.channelCipher;m=m?m+"/":"",i.default.BufferUtils.isBuffer(C)||(C=i.default.BufferUtils.utf8Encode(String(C)),m=m+"utf-8/"),T.encrypt(C,function(u,v){if(u){w(u);return}O.data=v,O.encoding=m+"cipher+"+T.algorithm,w(null,O)})},a.encode=function(O,M,w){var C=O.data,m=typeof C=="string"||i.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!m)if(c.isObject(C)||c.isArray(C))O.data=JSON.stringify(C),O.encoding=O.encoding?O.encoding+"/json":"json";else throw new A.default("Data type is unsupported",40013,400);M!=null&&M.cipher?a.encrypt(O,M,w):w(null,O)},a.encodeArray=function(O,M,w){for(var C=0,m=0;m<O.length;m++)a.encode(O[m],M,function(T){if(T){w(T);return}C++,C==O.length&&w(null,O)})},a.decode=function(O,M){var w=d(M),C=O.data,m=O.encoding;if(m){var T=m.split("/"),u=void 0,v=T.length,f=O.data,p="";try{for(;(u=v)>0;){var l=T[--v].match(/([-\w]+)(\+([\w-]+))?/);if(!l)break;switch(p=l[1],p){case"base64":f=i.default.BufferUtils.base64Decode(String(f)),u==T.length&&(C=f);continue;case"utf-8":f=i.default.BufferUtils.utf8Decode(f);continue;case"json":f=JSON.parse(f);continue;case"cipher":if(w.channelOptions!=null&&w.channelOptions.cipher&&w.channelOptions.channelCipher){var y=l[3],P=w.channelOptions.channelCipher;if(y!=P.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");f=P.decrypt(f);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!w.plugins||!w.plugins.vcdiff)throw new A.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new A.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var D=w.baseEncodedPreviousPayload;typeof D=="string"&&(D=i.default.BufferUtils.utf8Encode(D)),D=i.default.BufferUtils.toBuffer(D),f=i.default.BufferUtils.toBuffer(f),f=i.default.BufferUtils.typedArrayToBuffer(w.plugins.vcdiff.decode(f,D)),C=f}catch(H){throw new A.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var k=H;throw new A.default("Error processing the "+p+" encoding, decoder returned \u2018"+k.message+"\u2019",k.code||40013,400)}finally{O.encoding=u<=0?null:T.slice(0,u).join("/"),O.data=f}}w.baseEncodedPreviousPayload=C},a.fromResponseBody=function(O,M,w){w&&(O=c.decodeBody(O,w));for(var C=0;C<O.length;C++){var m=O[C]=a.fromValues(O[C]);try{a.decode(m,M)}catch(T){S.default.logAction(S.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return O},a.fromValues=function(O){return Object.assign(new a,O)},a.fromValuesArray=function(O){for(var M=O.length,w=new Array(M),C=0;C<M;C++)w[C]=a.fromValues(O[C]);return w},a.fromEncoded=function(O,M){var w=a.fromValues(O),C=b(M);try{a.decode(w,C)}catch(m){S.default.logAction(S.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return w},a.fromEncodedArray=function(O,M){return b(M),O.map(function(w){return a.fromEncoded(w,M)})},a.getMessagesSize=function(O){for(var M,w=0,C=0;C<O.length;C++)M=O[C],w+=M.size||(M.size=E(M));return w},a.serialize=c.encodeBody,a}();o.default=R},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(5)),A=s.__importDefault(n(9)),c=s.__importDefault(n(14)),d={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},b=[];Object.keys(d).forEach(function(w){b[d[w]]=w});var E={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},R=Object.keys(E);E.MODE_ALL=E.PRESENCE|E.PUBLISH|E.SUBSCRIBE|E.PRESENCE_SUBSCRIBE;function a(w){var C=[];if(w)for(var m=0;m<w.length;m++)C.push(w[m].toString());return"[ "+C.join(", ")+" ]"}var O="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),M=function(){function w(){var C=this;this.hasFlag=function(m){return(C.flags&E[m])>0}}return w.prototype.setFlag=function(C){return this.flags=this.flags|E[C]},w.prototype.getMode=function(){return this.flags&&this.flags&E.MODE_ALL},w.prototype.encodeModesToFlags=function(C){var m=this;C.forEach(function(T){return m.setFlag(T)})},w.prototype.decodeModesFromFlags=function(){var C=this,m=[];return w.channelModes.forEach(function(T){C.hasFlag(T)&&m.push(T)}),m.length>0?m:void 0},w.fromValues=function(C){return Object.assign(new w,C)},w.Action=d,w.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],w.ActionName=b,w.serialize=i.encodeBody,w.deserialize=function(C,m){var T=i.decodeBody(C,m);return w.fromDeserialized(T)},w.fromDeserialized=function(C){var m=C.error;m&&(C.error=S.default.fromValues(m));var T=C.messages;if(T)for(var u=0;u<T.length;u++)T[u]=A.default.fromValues(T[u]);var v=C.presence;if(v)for(var u=0;u<v.length;u++)v[u]=c.default.fromValues(v[u],!0);return Object.assign(new w,C)},w.stringify=function(C){var m="[ProtocolMessage";C.action!==void 0&&(m+="; action="+w.ActionName[C.action]||!1);for(var T,u=0;u<O.length;u++)T=O[u],C[T]!==void 0&&(m+="; "+T+"="+C[T]);if(C.messages&&(m+="; messages="+a(A.default.fromValuesArray(C.messages))),C.presence&&(m+="; presence="+a(c.default.fromValuesArray(C.presence))),C.error&&(m+="; error="+S.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(m+="; token="+C.auth.accessToken),C.flags&&(m+="; flags="+R.filter(C.hasFlag).join(",")),C.params){var v="";i.forInOwnNonNullProperties(C.params,function(f){v.length>0&&(v+="; "),v+=f+"="+C.params[f]}),v.length>0&&(m+="; params=["+v+"]")}return m+="]",m},w.isDuplicate=function(C,m){if(C&&m&&(C.action===d.MESSAGE||C.action===d.PRESENCE)&&C.action===m.action&&C.channel===m.channel&&C.id===m.id){if(C.action===d.PRESENCE)return!0;if(C.messages.length===m.messages.length){for(var T=0;T<C.messages.length;T++){var u=C.messages[T],v=m.messages[T];if((u.extras&&u.extras.delta&&u.extras.delta.format)!==(v.extras&&v.extras.delta&&v.extras.delta.format))return!1}return!0}}return!1},w}();o.default=M},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(10)),A=s.__importDefault(n(26)),c=s.__importDefault(n(3)),d=s.__importDefault(n(8)),b=s.__importDefault(n(19)),E=s.__importDefault(n(16)),R=s.__importDefault(n(5)),a=s.__importDefault(n(20)),O=s.__importDefault(n(0));function M(m){var T=[80015,80017,80030];return m.code?E.default.isTokenErr(m)?!1:i.arrIn(T,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function w(m){return M(m)?[S.default.fromValues({action:S.default.Action.ERROR,error:m})]:[S.default.fromValues({action:S.default.Action.DISCONNECTED,error:m})]}var C=function(m){s.__extends(T,m);function T(u,v,f){var p=m.call(this,u,v,f,!0)||this;return p.onAuthUpdated=function(l){p.authParams={access_token:l.token}},p.stream="stream"in f?f.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return T.prototype.connect=function(){var u=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","starting"),A.default.prototype.connect.call(this);var v=this.params,f=v.options,p=d.default.getHost(f,v.host),l=d.default.getPort(f),y=f.tls?"https://":"http://";this.baseUri=y+p+":"+l+"/comet/";var P=this.baseUri+"connect";c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","uri: "+P),this.auth.getAuthParams(function(D,k){if(D){u.disconnect(D);return}if(!u.isDisposed){u.authParams=k;var H=u.params.getConnectParams(k);"stream"in H&&(u.stream=H.stream),c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(H));var U=!1,_=u.recvRequest=u.createRequest(P,null,H,null,u.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);_.on("data",function(x){!u.recvRequest||(U||(U=!0,u.emit("preconnect")),u.onData(x))}),_.on("complete",function(x){if(u.recvRequest||(x=x||new R.default("Request cancelled",80003,400)),u.recvRequest=null,!U&&!x&&(U=!0,u.emit("preconnect")),u.onActivity(),x){x.code?u.onData(w(x)):u.disconnect(x);return}O.default.Config.nextTick(function(){u.recv()})}),_.exec()}})},T.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(u){var v=this,f=u?this.closeUri:this.disconnectUri;if(f){var p=this.createRequest(f,null,this.authParams,null,a.default.REQ_SEND);p.on("complete",function(l){l&&(c.default.logAction(c.default.LOG_ERROR,"CometTransport.request"+(u?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(l)),v.finish("disconnected",l))}),p.exec()}},T.prototype.dispose=function(){var u=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",b.default.disconnected),O.default.Config.nextTick(function(){u.emit("disposed")}))},T.prototype.onConnect=function(u){if(!this.isDisposed){var v=u.connectionKey;A.default.prototype.onConnect.call(this,u);var f=this.baseUri+v;c.default.logAction(c.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+f+"; connectionKey = "+u.connectionKey),this.sendUri=f+"/send",this.recvUri=f+"/recv",this.closeUri=f+"/close",this.disconnectUri=f+"/disconnect"}},T.prototype.send=function(u){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(u);return}var v=this.pendingItems||[];v.push(u),this.pendingItems=null,this.sendItems(v)},T.prototype.sendAnyPending=function(){var u=this.pendingItems;!u||(this.pendingItems=null,this.sendItems(u))},T.prototype.sendItems=function(u){var v=this,f=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(u),a.default.REQ_SEND);f.on("complete",function(p,l){if(p&&c.default.logAction(c.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(p)),v.sendRequest=null,p){p.code?v.onData(w(p)):v.disconnect(p);return}l&&v.onData(l),v.pendingItems&&O.default.Config.nextTick(function(){v.sendRequest||v.sendAnyPending()})}),f.exec()},T.prototype.recv=function(){var u=this;if(!this.recvRequest&&!!this.isConnected){var v=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);v.on("data",function(f){u.onData(f)}),v.on("complete",function(f){if(u.recvRequest=null,u.onActivity(),f){f.code?u.onData(w(f)):u.disconnect(f);return}O.default.Config.nextTick(function(){u.recv()})}),v.exec()}},T.prototype.onData=function(u){try{var v=this.decodeResponse(u);if(v&&v.length)for(var f=0;f<v.length;f++)this.onProtocolMessage(S.default.fromDeserialized(v[f]))}catch(p){c.default.logAction(c.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},T.prototype.encodeRequest=function(u){return JSON.stringify(u)},T.prototype.decodeResponse=function(u){return typeof u=="string"?JSON.parse(u):u},T}(A.default);o.default=C},function(h,o){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(s){typeof window=="object"&&(n=window)}h.exports=n},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(){var i=s,S=i.lib,A=S.WordArray,c=i.enc,d=c.Base64={stringify:function(E){var R=E.words,a=E.sigBytes,O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.clamp();for(var M=[],w=0;w<a;w+=3)for(var C=R[w>>>2]>>>24-w%4*8&255,m=R[w+1>>>2]>>>24-(w+1)%4*8&255,T=R[w+2>>>2]>>>24-(w+2)%4*8&255,u=C<<16|m<<8|T,v=0;v<4&&w+v*.75<a;v++)M.push(O.charAt(u>>>6*(3-v)&63));var f=O.charAt(64);if(f)for(;M.length%4;)M.push(f);return M.join("")},parse:function(E){var R=E.length,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",O=this._reverseMap;if(!O){O=this._reverseMap=[];for(var M=0;M<a.length;M++)O[a.charCodeAt(M)]=M}var w=a.charAt(64);if(w){var C=E.indexOf(w);C!==-1&&(R=C)}return b(E,R,O)}};function b(E,R,a){for(var O=[],M=0,w=0;w<R;w++)if(w%4){var C=a[E.charCodeAt(w-1)]<<w%4*2,m=a[E.charCodeAt(w)]>>>6-w%4*2,T=C|m;O[M>>>2]|=T<<24-M%4*8,M++}return A.create(O,M)}}(),s.enc.Base64})},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),S=s.__importDefault(n(0)),A=s.__importDefault(n(9)),c=s.__importStar(n(2));function d(E){return b.Actions.indexOf(E)}var b=function(){function E(){}return E.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},E.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var R=this.id.split(":");return{connectionId:R[0],msgSerial:parseInt(R[1],10),index:parseInt(R[2],10)}},E.prototype.toJSON=function(){var R=this.data,a=this.encoding;return R&&S.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(a=a?a+"/base64":"base64",R=S.default.BufferUtils.base64Encode(R)):R=S.default.BufferUtils.toBuffer(R)),{clientId:this.clientId,action:d(this.action),data:R,encoding:a}},E.prototype.toString=function(){var R="[PresenceMessage";return R+="; action="+this.action,this.id&&(R+="; id="+this.id),this.timestamp&&(R+="; timestamp="+this.timestamp),this.clientId&&(R+="; clientId="+this.clientId),this.connectionId&&(R+="; connectionId="+this.connectionId),this.encoding&&(R+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?R+="; data="+this.data:S.default.BufferUtils.isBuffer(this.data)?R+="; data (buffer)="+S.default.BufferUtils.base64Encode(this.data):R+="; data (json)="+JSON.stringify(this.data)),R+="]",R},E.fromResponseBody=function(R,a,O){var M=[];O&&(R=c.decodeBody(R,O));for(var w=0;w<R.length;w++){var C=M[w]=E.fromValues(R[w],!0);try{E.decode(C,a)}catch(m){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return M},E.fromValues=function(R,a){return a&&(R.action=E.Actions[R.action]),Object.assign(new E,R)},E.fromValuesArray=function(R){for(var a=R.length,O=new Array(a),M=0;M<a;M++)O[M]=E.fromValues(R[M]);return O},E.fromEncoded=function(R,a){var O=E.fromValues(R,!0);try{E.decode(O,a)}catch(M){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",M.toString())}return O},E.fromEncodedArray=function(R,a){return R.map(function(O){return E.fromEncoded(O,a)})},E.Actions=["absent","present","enter","leave","update"],E.encode=A.default.encode,E.decode=A.default.decode,E.getMessagesSize=A.default.getMessagesSize,E}();o.default=b},function(h,o,n){"use strict";(function(s){o.__esModule=!0;var i=n(1),S=i.__importStar(n(2)),A=i.__importDefault(n(7)),c=i.__importDefault(n(5)),d=i.__importDefault(n(3)),b=i.__importDefault(n(8)),E=i.__importDefault(n(20)),R=i.__importDefault(n(0));function a(y,P){return S.arrIn(S.allToLowerCase(S.keysArray(P)),"x-ably-errorcode")}function O(y,P){if(a(y,P))return y.error&&c.default.fromValues(y.error)}var M=function(){},w=0,C={},m=typeof s!="undefined"&&s.XDomainRequest;function T(){var y=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return y&&Number(y[1])}function u(){var y;return m&&(y=T())&&y===10}function v(y,P){return y.getResponseHeader&&y.getResponseHeader(P)}function f(y){return y.getResponseHeader&&(y.getResponseHeader("transfer-encoding")||!y.getResponseHeader("content-length"))}function p(y){for(var P=S.trim(y.getAllResponseHeaders()).split(`\r
`),D={},k=0;k<P.length;k++){var H=P[k].split(":").map(S.trim);D[H[0].toLowerCase()]=H[1]}return D}var l=function(y){i.__extends(P,y);function P(D,k,H,U,_,x,z){var W=y.call(this)||this;return H=H||{},H.rnd=S.cheapRandStr(),u()&&!H.envelope&&(H.envelope="json"),W.uri=D+S.toQueryString(H),W.headers=k||{},W.body=U,W.method=z?z.toUpperCase():S.isEmptyArg(U)?"GET":"POST",W.requestMode=_,W.timeouts=x,W.timedOut=!1,W.requestComplete=!1,W.id=String(++w),C[W.id]=W,W}return P.createRequest=function(D,k,H,U,_,x,z){var W=x||b.default.TIMEOUTS;return new P(D,k,S.copy(H),U,_,W,z)},P.prototype.complete=function(D,k,H,U,_){this.requestComplete||(this.requestComplete=!0,!D&&k&&this.emit("data",k),this.emit("complete",D,k,H,U,_),this.dispose())},P.prototype.abort=function(){this.dispose()},P.prototype.exec=function(){var D=this,k=this.headers,H=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,U=this.timer=setTimeout(function(){D.timedOut=!0,x.abort()},H),_=this.method,x=this.xhr=new XMLHttpRequest,z=k.accept,W=this.body,J="text";if(z?z.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):k.accept="application/json",W){var Z=k["content-type"]||(k["content-type"]="application/json");Z.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}x.open(_,this.uri,!0),x.responseType=J,"authorization"in k&&(x.withCredentials=!0);for(var Q in k)x.setRequestHeader(Q,k[Q]);var G=function(ft,Mt,Yt,Ut){var Ht,ue=Mt+" (event type: "+ft.type+")";!((Ht=D==null?void 0:D.xhr)===null||Ht===void 0)&&Ht.statusText&&(ue+=", current statusText is "+D.xhr.statusText),d.default.logAction(d.default.LOG_ERROR,"Request.on"+ft.type+"()",ue),D.complete(new c.default(ue,Yt,Ut))};x.onerror=function(ft){G(ft,"XHR error occurred",null,400)},x.onabort=function(ft){D.timedOut?G(ft,"Request aborted due to request timeout expiring",null,408):G(ft,"Request cancelled",null,400)},x.ontimeout=function(ft){G(ft,"Request timed out",null,408)};var N,B,V,j=0,tt=!1,lt=function(){if(clearTimeout(U),V=B<400,B==204){D.complete(null,null,null,null,B);return}N=D.requestMode==E.default.REQ_RECV_STREAM&&V&&f(x)},mt=function(){var ft;try{var Mt=v(x,"content-type"),Yt=Mt?Mt.indexOf("application/json")>=0:x.responseType=="text";if(Yt){var Ut=x.responseType==="arraybuffer"?R.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Ut.length?ft=JSON.parse(Ut):ft=Ut,tt=!0}else ft=x.response;ft.response!==void 0?(B=ft.statusCode,V=B<400,k=ft.headers,ft=ft.response):k=p(x)}catch(ue){D.complete(new c.default("Malformed response body from server: "+ue.message,null,400));return}if(V||S.isArray(ft)){D.complete(null,ft,k,tt,B);return}var Ht=O(ft,k);Ht||(Ht=new c.default("Error response received from server: "+B+" body was: "+R.default.Config.inspect(ft),null,B)),D.complete(Ht,ft,k,tt,B)};function vt(){for(var ft=x.responseText,Mt=ft.length-1,Yt,Ut;j<Mt&&(Yt=ft.indexOf(`
`,j))>-1;)Ut=ft.slice(j,Yt),j=Yt+1,Ot(Ut)}var Ot=function(ft){try{ft=JSON.parse(ft)}catch(Mt){D.complete(new c.default("Malformed response body from server: "+Mt.message,null,400));return}D.emit("data",ft)},xt=function(){vt(),D.streamComplete=!0,R.default.Config.nextTick(function(){D.complete()})};x.onreadystatechange=function(){var ft=x.readyState;ft<3||x.status!==0&&(B===void 0&&(B=x.status,B===1223&&(B=204),lt()),ft==3&&N?vt():ft==4&&(N?xt():mt()))},x.send(W)},P.prototype.dispose=function(){var D=this.xhr;if(D){D.onreadystatechange=D.onerror=D.onabort=D.ontimeout=M,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||D.abort()}delete C[this.id]},P}(A.default);o.default=l}).call(this,n(12))},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),S=s.__importStar(n(2)),A=s.__importDefault(n(22)),c=s.__importDefault(n(5)),d=s.__importDefault(n(43)),b=n(13),E=n(32),R=s.__importDefault(n(17)),a=s.__importDefault(n(0)),O=Math.pow(2,17);function M(){}function w(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function C(H){return!!H.connection}function m(H){return S.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new c.default(S.inspectError(H),H.code||40170,H.statusCode||401)}var T=function(H){return a.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):b.stringify(E.parse(H))},u=function(H,U){if(a.default.Config.createHmac){var _=a.default.Config.createHmac("SHA256",U);return _.update(H),_.digest("base64")}return b.stringify(d.default(H,U))};function v(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var U={},_=S.keysArray(H,!0);if(!_)return"";_.sort();for(var x=0;x<_.length;x++)U[_[x]]=H[_[x]].sort();return JSON.stringify(U)}function f(H){if(H.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var U="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",U),new Error(U)}}function p(H){return"useTokenAuth"in H&&!H.useTokenAuth}function l(H){return H.useTokenAuth||!p(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function y(H){return!H.key&&!H.authCallback&&!H.authUrl}var P=0;function D(){return P++}var k=function(){function H(U,_){if(this.authOptions={},this.client=U,this.tokenParams=_.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,l(_)){if(_.key&&!u){var x="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new Error(x)}y(_)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(_.defaultTokenParams,_),f(this.authOptions)}else{if(!_.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new c.default(x,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(_)}}return H.prototype.authorize=function(U,_,x){var z=this,W;if(typeof U=="function"&&!x?(x=U,W=U=null):typeof _=="function"&&!x?(x=_,W=null):W=_,!x&&this.client.options.promises)return S.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new c.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),S.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(U,W,function(J,Z){if(J){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize(J),x==null||x(J);return}C(z.client)?z.client.connection.connectionManager.onAuthUpdated(Z,x||M):x==null||x(null,Z)})},H.prototype.authorise=function(U,_,x){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(U,_,x)},H.prototype._forceNewToken=function(U,_,x){var z=this;this.tokenDetails=null,this._saveTokenOptions(U,_),f(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,J){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,x(W,J)})},H.prototype.requestToken=function(U,_,x){var z=this;if(typeof U=="function"&&!x?(x=U,_=U=null):typeof _=="function"&&!x&&(x=_,_=null),!x&&this.client.options.promises)return S.promisify(this,"requestToken",arguments);_=_||this.authOptions,U=U||S.copy(this.tokenParams);var W=x||M,J,Z=this.client;if(_.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=_.authCallback;else if(_.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,tt){var lt=S.mixin({accept:"application/json, text/plain"},_.authHeaders),mt=_.authMethod&&_.authMethod.toLowerCase()==="post",vt,Ot=_.authUrl.indexOf("?");Ot>-1&&(vt=S.parseQueryString(_.authUrl.slice(Ot)),_.authUrl=_.authUrl.slice(0,Ot),mt||(_.authParams=S.mixin(vt,_.authParams)));var xt=S.mixin({},_.authParams||{},j),ft=function(Ut,Ht,ue,X){var it;if(Ut?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+S.inspectError(Ut)):(it=ue["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+it+"; body: "+S.inspectBody(Ht))),Ut||X)return tt(Ut,Ht);if(a.default.BufferUtils.isBuffer(Ht)&&(Ht=Ht.toString()),!it){tt(new c.default("authUrl response is missing a content-type header",40170,401));return}var ut=it.indexOf("application/json")>-1,pt=it.indexOf("text/plain")>-1||it.indexOf("application/jwt")>-1;if(!ut&&!pt){tt(new c.default("authUrl responded with unacceptable content-type "+it+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ut){if(Ht.length>O){tt(new c.default("authUrl response exceeded max permitted length",40170,401));return}try{Ht=JSON.parse(Ht)}catch(Et){tt(new c.default("Unexpected error processing authURL response; err = "+Et.message,40170,401));return}}tt(null,Ht,it)};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+_.authUrl+"; Params: "+JSON.stringify(xt)+"; method: "+(mt?"POST":"GET")),mt){var Mt=lt||{};Mt["content-type"]="application/x-www-form-urlencoded";var Yt=S.toQueryString(xt).slice(1);z.client.http.doUri(R.default.Post,Z,_.authUrl,Mt,Yt,vt,ft)}else z.client.http.doUri(R.default.Get,Z,_.authUrl,lt||{},null,xt,ft)};else if(_.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,tt){z.createTokenRequest(j,_,tt)};else{var Q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new c.default(Q,40171,403));return}"capability"in U&&(U.capability=v(U.capability));var G=function(j,tt){var lt=j.keyName,mt="/keys/"+lt+"/requestToken",vt=function(xt){return Z.baseUri(xt)+mt},Ot=S.defaultPostHeaders();_.requestHeaders&&S.mixin(Ot,_.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+mt+"; Token params: "+JSON.stringify(j)),z.client.http.do(R.default.Post,Z,vt,Ot,JSON.stringify(j),null,tt)},N=!1,B=this.client.options.timeouts.realtimeRequestTimeout,V=setTimeout(function(){N=!0;var j="Token request callback timed out after "+B/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",j),W(new c.default(j,40170,401))},B);J(U,function(j,tt,lt){if(!N){if(clearTimeout(V),j){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+S.inspectError(j)),W(m(j));return}if(typeof tt=="string"){tt.length===0?W(new c.default("Token string is empty",40170,401)):tt.length>O?W(new c.default("Token string exceeded max permitted length (was "+tt.length+" bytes)",40170,401)):tt==="undefined"||tt==="null"?W(new c.default("Token string was literal null/undefined",40170,401)):tt[0]==="{"&&!(lt&&lt.indexOf("application/jwt")>-1)?W(new c.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:tt});return}if(typeof tt!="object"){var mt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof tt;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",mt),W(new c.default(mt,40170,401));return}var vt=JSON.stringify(tt).length;if(vt>O&&!_.suppressMaxLengthCheck){W(new c.default("Token request/details object exceeded max permitted stringified size (was "+vt+" bytes)",40170,401));return}if("issued"in tt){W(null,tt);return}if(!("keyName"in tt)){var mt="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",mt),W(new c.default(mt,40170,401));return}G(tt,function(Ot,xt,ft,Mt){if(Ot){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+S.inspectError(Ot)),W(m(Ot));return}Mt||(xt=JSON.parse(xt)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,xt)})}})},H.prototype.createTokenRequest=function(U,_,x){var z=this;if(typeof U=="function"&&!x?(x=U,_=U=null):typeof _=="function"&&!x&&(x=_,_=null),!x&&this.client.options.promises)return S.promisify(this,"createTokenRequest",arguments);_=_||this.authOptions,U=U||S.copy(this.tokenParams);var W=_.key;if(!W){x(new c.default("No key specified",40101,403));return}var J=W.split(":"),Z=J[0],Q=J[1];if(!Q){x(new c.default("Invalid key specified",40101,403));return}if(U.clientId===""){x(new c.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in U&&(U.capability=v(U.capability));var G=S.mixin({keyName:Z},U),N=U.clientId||"",B=U.ttl||"",V=U.capability||"";(function(j){if(G.timestamp){j();return}z.getTimestamp(_&&_.queryTime,function(tt,lt){if(tt){x(tt);return}G.timestamp=lt,j()})})(function(){var j=G.nonce||(G.nonce=w()),tt=G.timestamp,lt=G.keyName+`
`+B+`
`+V+`
`+N+`
`+tt+`
`+j+`
`;G.mac=G.mac||u(lt,Q),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(U){this.method=="basic"?U(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(_,x){if(_){U(_);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(U){this.method=="basic"?U(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(_,x){if(_){U(_);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{authorization:"Bearer "+T(x.token)})})},H.prototype.getTimestamp=function(U,_){!this.isTimeOffsetSet()&&(U||this.authOptions.queryTime)?this.client.time(_):_(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return S.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(U){this.method="basic",this.key=U.key,this.basicKey=T(U.key),this.authOptions=U||{},"clientId"in U&&this._userSetClientId(U.clientId)},H.prototype._saveTokenOptions=function(U,_){this.method="token",U&&(this.tokenParams=U),_&&(_.token&&(_.tokenDetails=typeof _.token=="string"?{token:_.token}:_.token),_.tokenDetails&&(this.tokenDetails=_.tokenDetails),"clientId"in _&&this._userSetClientId(_.clientId),this.authOptions=_)},H.prototype._ensureValidAuthCredentials=function(U,_){var x=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){_(new c.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),_(null,z);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=A.default.create())).push(_),!(this.currentTokenRequestId!==null&&!U)){var W=this.currentTokenRequestId=D();this.requestToken(this.tokenParams,this.authOptions,function(J,Z){if(x.currentTokenRequestId>W){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var Q=x.waitingForTokenRequest||M;if(x.waitingForTokenRequest=null,J){Q(J);return}Q(null,x.tokenDetails=Z)})}},H.prototype._userSetClientId=function(U){if(typeof U=="string"||U===null){if(U==="*")throw new c.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var _=this._uncheckedSetClientId(U);if(_)throw _}else throw new c.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(U){if(this._tokenClientIdMismatch(U)){var _="Unexpected clientId mismatch: client has "+this.clientId+", requested "+U,x=new c.default(_,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",_),x}else return this.clientId=this.tokenParams.clientId=U,null},H.prototype._tokenClientIdMismatch=function(U){return!!(this.clientId&&this.clientId!=="*"&&U&&U!=="*"&&this.clientId!==U)},H.isTokenErr=function(U){return U.code&&U.code>=40140&&U.code<40150},H}();o.default=k},function(h,o,n){"use strict";o.__esModule=!0;var s;(function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch"})(s||(s={})),o.default=s},function(h,o,n){"use strict";o.__esModule=!0,o.HttpPaginatedResponse=o.PaginatedResult=void 0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(3)),A=s.__importDefault(n(24));function c(O){var M=O.match(/^\.\/(\w+)\?(.*)$/);return M&&M[2]&&i.parseQueryString(M[2])}function d(O){typeof O=="string"&&(O=O.split(","));for(var M={},w=0;w<O.length;w++){var C=O[w].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(C){var m=c(C[1]);m&&(M[C[2]]=m)}}return M}function b(O,M,w){return!(w&&(M||typeof O.code=="number"))}var E=function(){function O(M,w,C,m,T,u){this.rest=M,this.path=w,this.headers=C,this.envelope=m!=null?m:null,this.bodyHandler=T,this.useHttpPaginatedResponse=u||!1}return O.prototype.get=function(M,w){var C=this;A.default.get(this.rest,this.path,this.headers,M,this.envelope,function(m,T,u,v,f){C.handlePage(m,T,u,v,f,w)})},O.prototype.delete=function(M,w){var C=this;A.default.delete(this.rest,this.path,this.headers,M,this.envelope,function(m,T,u,v,f){C.handlePage(m,T,u,v,f,w)})},O.prototype.post=function(M,w,C){var m=this;A.default.post(this.rest,this.path,w,this.headers,M,this.envelope,function(T,u,v,f,p){C&&m.handlePage(T,u,v,f,p,C)})},O.prototype.put=function(M,w,C){var m=this;A.default.put(this.rest,this.path,w,this.headers,M,this.envelope,function(T,u,v,f,p){C&&m.handlePage(T,u,v,f,p,C)})},O.prototype.patch=function(M,w,C){var m=this;A.default.patch(this.rest,this.path,w,this.headers,M,this.envelope,function(T,u,v,f,p){C&&m.handlePage(T,u,v,f,p,C)})},O.prototype.handlePage=function(M,w,C,m,T,u){if(M&&b(M,w,this.useHttpPaginatedResponse)){S.default.logAction(S.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(M)),u==null||u(M);return}var v,f,p;try{v=this.bodyHandler(w,C||{},m)}catch(l){u==null||u(M||l);return}C&&(f=C.Link||C.link)&&(p=d(f)),this.useHttpPaginatedResponse?u(null,new a(this,v,C||{},T,p,M)):u(null,new R(this,v,p))},O}(),R=function(){function O(M,w,C){var m=this;this.resource=M,this.items=w;var T=this;C&&("first"in C&&(this.first=function(u){if(!u&&T.resource.rest.options.promises)return i.promisify(T,"first",[]);T.get(C.first,u)}),"current"in C&&(this.current=function(u){if(!u&&T.resource.rest.options.promises)return i.promisify(T,"current",[]);T.get(C.current,u)}),this.next=function(u){if(!u&&T.resource.rest.options.promises)return i.promisify(T,"next",[]);"next"in C?T.get(C.next,u):u(null)},this.hasNext=function(){return"next"in C},this.isLast=function(){var u;return!(!((u=m.hasNext)===null||u===void 0)&&u.call(m))})}return O.prototype.get=function(M,w){var C=this.resource;A.default.get(C.rest,C.path,C.headers,M,C.envelope,function(m,T,u,v,f){C.handlePage(m,T,u,v,f,w)})},O}();o.PaginatedResult=R;var a=function(O){s.__extends(M,O);function M(w,C,m,T,u,v){var f=O.call(this,w,C,u)||this;return f.statusCode=T,f.success=T<300&&T>=200,f.headers=m,f.errorCode=v&&v.code,f.errorMessage=v&&v.message,f}return M.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},M}(R);o.HttpPaginatedResponse=a,o.default=E},function(h,o,n){"use strict";o.__esModule=!0,o.isRetriable=void 0;var s=n(1),i=s.__importDefault(n(5)),S={disconnected:i.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:i.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:i.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:i.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:i.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:i.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:i.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function A(c){if(!c.statusCode||!c.code||c.statusCode>=500)return!0;var d=!1;return Object.values(S).forEach(function(b){b.code&&b.code==c.code&&(d=!0)}),d}o.isRetriable=A,o.default=S},function(h,o,n){"use strict";o.__esModule=!0;var s;(function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),o.default=s},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(s){return s})},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(3)),S=function(){function A(c){this.members=c||[]}return A.prototype.call=function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];for(var b=0,E=this.members;b<E.length;b++){var R=E[b];if(R)try{R.apply(void 0,c)}catch(a){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},A.prototype.push=function(){for(var c,d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];(c=this.members).push.apply(c,d)},A.create=function(c){var d=new A(c);return Object.assign(function(){for(var b=[],E=0;E<arguments.length;E++)b[E]=arguments[E];return d.call.apply(d,b)},{push:function(b){return d.push(b)}})},A}();o.default=S},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){(function(){var i=s,S=i.lib,A=S.Base,c=i.enc,d=c.Utf8,b=i.algo,E=b.HMAC=A.extend({init:function(R,a){R=this._hasher=new R.init,typeof a=="string"&&(a=d.parse(a));var O=R.blockSize,M=O*4;a.sigBytes>M&&(a=R.finalize(a)),a.clamp();for(var w=this._oKey=a.clone(),C=this._iKey=a.clone(),m=w.words,T=C.words,u=0;u<O;u++)m[u]^=1549556828,T[u]^=909522486;w.sigBytes=C.sigBytes=M,this.reset()},reset:function(){var R=this._hasher;R.reset(),R.update(this._iKey)},update:function(R){return this._hasher.update(R),this},finalize:function(R){var a=this._hasher,O=a.finalize(R);a.reset();var M=a.finalize(this._oKey.clone().concat(O));return M}})})()})},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),S=s.__importStar(n(2)),A=s.__importDefault(n(3)),c=s.__importDefault(n(16)),d=s.__importDefault(n(17)),b=s.__importDefault(n(5));function E(C,m,T,u,v){C.http.supportsAuthHeaders?C.auth.getAuthHeaders(function(f,p){f?u(f):v(S.mixin(p,m),T)}):C.auth.getAuthParams(function(f,p){f?u(f):v(m,S.mixin(p,T))})}function R(C,m){return function(T,u,v,f,p){if(T&&!u){C(T);return}if(!f)try{u=S.decodeBody(u,m)}catch(H){C(H);return}if(!u){C(new b.default("unenvelope(): Response body is missing",null));return}var l=u,y=l.statusCode,P=l.response,D=l.headers;if(y===void 0){C(T,u,v,!0,p);return}if(y<200||y>=300){var k=P&&P.error||T;k||(k=new Error("Error in unenveloping "+u),k.statusCode=y),C(k,P,D,!0,y);return}C(T,P,D,!0,y)}}function a(C){var m=[];if(C)for(var T in C)m.push(T+"="+C[T]);return m.join("&")}function O(C,m){return C+(m?"?":"")+a(m)}function M(C,m,T,u){return function(v,f,p,l,y){v?A.default.logAction(A.default.LOG_MICRO,"Resource."+m+"()","Received Error; "+O(T,u)+"; Error: "+S.inspectError(v)):A.default.logAction(A.default.LOG_MICRO,"Resource."+m+"()","Received; "+O(T,u)+"; Headers: "+a(p)+"; StatusCode: "+y+"; Body: "+(i.default.BufferUtils.isBuffer(f)?f.toString():f)),C&&C(v,f,p,l,y)}}var w=function(){function C(){}return C.get=function(m,T,u,v,f,p){C.do(d.default.Get,m,T,null,u,v,f,p)},C.delete=function(m,T,u,v,f,p){C.do(d.default.Delete,m,T,null,u,v,f,p)},C.post=function(m,T,u,v,f,p,l){C.do(d.default.Post,m,T,u,v,f,p,l)},C.patch=function(m,T,u,v,f,p,l){C.do(d.default.Patch,m,T,u,v,f,p,l)},C.put=function(m,T,u,v,f,p,l){C.do(d.default.Put,m,T,u,v,f,p,l)},C.do=function(m,T,u,v,f,p,l,y){A.default.shouldLog(A.default.LOG_MICRO)&&(y=M(y,m,u,p)),l&&(y=y&&R(y,l),(p=p||{}).envelope=l);function P(D,k){var H;if(A.default.shouldLog(A.default.LOG_MICRO)&&A.default.logAction(A.default.LOG_MICRO,"Resource."+m+"()","Sending; "+O(u,k)),A.default.shouldLog(A.default.LOG_MICRO)){var U=v;if(((H=D["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{U=i.default.Config.msgpack.decode(v)}catch(_){A.default.logAction(A.default.LOG_MICRO,"Resource."+m+"()","Sending MsgPack Decoding Error: "+S.inspectError(_))}A.default.logAction(A.default.LOG_MICRO,"Resource."+m+"()","Sending; "+O(u,k)+"; Body: "+U)}T.http.do(m,T,u,D,v,k,function(_,x,z,W,J){if(_&&c.default.isTokenErr(_)){T.auth.authorize(null,null,function(Z){if(Z){y(Z);return}E(T,z,k,y,P)});return}y(_,x,z,W,J)})}E(T,f,p,y,P)},C}();o.default=w},function(h,o,n){"use strict";(function(s){o.__esModule=!0,o.TransportParams=void 0;var i=n(1),S=i.__importDefault(n(10)),A=i.__importStar(n(2)),c=i.__importStar(n(51)),d=i.__importDefault(n(8)),b=i.__importDefault(n(0)),E=i.__importDefault(n(7)),R=i.__importDefault(n(35)),a=i.__importDefault(n(3)),O=i.__importDefault(n(36)),M=i.__importStar(n(19)),w=i.__importDefault(n(5)),C=i.__importDefault(n(16)),m=i.__importDefault(n(9)),T=i.__importDefault(n(22)),u=i.__importDefault(n(52)),v=i.__importDefault(n(26)),f=i.__importDefault(n(53)),p=function(){var Z;return typeof b.default.WebStorage!="undefined"&&((Z=b.default.WebStorage)===null||Z===void 0?void 0:Z.localSupported)},l=function(){var Z;return typeof b.default.WebStorage!="undefined"&&((Z=b.default.WebStorage)===null||Z===void 0?void 0:Z.sessionSupported)},y=S.default.Action,P=function(){},D="ably-transport-preference",k="ably-connection-recovery";function H(){var Z,Q;return l()&&((Q=(Z=b.default.WebStorage)===null||Z===void 0?void 0:Z.getSession)===null||Q===void 0?void 0:Q.call(Z,k))}function U(Z){var Q,G;return l()&&((G=(Q=b.default.WebStorage)===null||Q===void 0?void 0:Q.setSession)===null||G===void 0?void 0:G.call(Q,k,Z))}function _(){var Z,Q;return l()&&((Q=(Z=b.default.WebStorage)===null||Z===void 0?void 0:Z.removeSession)===null||Q===void 0?void 0:Q.call(Z,k))}function x(Z,Q){return A.arrIndexOf(b.default.Defaults.transportPreferenceOrder,Z.shortName)>A.arrIndexOf(b.default.Defaults.transportPreferenceOrder,Q.shortName)}function z(Z,Q,G){var N;if(Z.channel!==Q.channel||(N=Z.action)!==y.PRESENCE&&N!==y.MESSAGE||N!==Q.action)return!1;var B=N===y.PRESENCE?"presence":"messages",V=Z[B].concat(Q[B]),j=m.default.getMessagesSize(V);return j>G||!A.allSame(V,"clientId")||!A.arrEvery(V,function(tt){return!tt.id})?!1:(Z[B]=V,!0)}var W=function(){function Z(Q,G,N,B){this.options=Q,this.host=G,this.mode=N,this.connectionKey=B,this.format=Q.useBinaryProtocol?A.Format.msgpack:A.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return Z.prototype.getConnectParams=function(Q){var G=Q?A.copy(Q):{},N=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var B=N.recover.split(":");if(B){G.recover=B[0];var V=B[1];isNaN(Number(V))?G.timeSerial=V:G.connectionSerial=V}break}default:}return N.clientId!==void 0&&(G.clientId=N.clientId),N.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=d.default.apiVersion,G.agent=encodeURIComponent(d.default.agent),N.transportParams!==void 0&&A.mixin(G,N.transportParams),G},Z.prototype.toString=function(){var Q="[mode="+this.mode;return this.host&&(Q+=",host="+this.host),this.connectionKey&&(Q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Q+=",timeSerial="+this.timeSerial),this.format&&(Q+=",format="+this.format),Q+="]",Q},Z}();o.TransportParams=W;var J=function(Z){i.__extends(Q,Z);function Q(G,N){var B=Z.call(this)||this;B.disconnectedRetryCount=0,Q.initTransports(),B.realtime=G,B.options=N;var V=N.timeouts,j=V.preferenceConnectTimeout+V.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new R.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.timeSerial=void 0,B.connectionSerial=void 0,B.connectionStateTtl=V.connectionStateTtl,B.maxIdleInterval=null,B.transports=A.intersect(N.transports||d.default.defaultTransports,Q.supportedTransports),B.baseTransport=A.intersect(d.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=A.intersect(B.transports,d.default.upgradeTransports),B.transportPreference=null,B.httpHosts=d.default.getHosts(N),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.mostRecentMsg=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||d.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var tt="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",tt),new Error(tt)}var lt=b.default.Config.addEventListener;return lt&&(l()&&typeof N.recover=="function"&&lt("beforeunload",B.persistConnection.bind(B)),N.closeOnUnload===!0&&lt("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),lt("online",function(){(B.state==B.states.disconnected||B.state==B.states.suspended)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),B.requestState({state:"connecting"}))}),lt("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),B.disconnectAllTransports())})),B}return Q.initTransports=function(){u.default(Q),A.arrForEach(b.default.Transports,function(G){G(Q)})},Q.prototype.createTransportParams=function(G,N){var B=new W(this.options,G,N,this.connectionKey);return this.timeSerial?B.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(B.connectionSerial=this.connectionSerial),B},Q.prototype.getTransportParams=function(G){var N=this,B=function(V){if(N.connectionKey){V("resume");return}if(typeof N.options.recover=="string"){V("recover");return}var j=N.options.recover,tt=H();if(tt&&typeof j=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),j(tt,function(lt){lt?(N.options.recover=tt.recoveryKey,V("recover")):V("clean")});return}V("clean")};B(function(V){var j=N.createTransportParams(null,V);if(V==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var tt=N.options.recover.split(":");tt&&tt[2]&&(N.msgSerial=Number(tt[2]))}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+j.toString());G(j)})},Q.prototype.tryATransport=function(G,N,B){var V=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),v.default.tryConnect(Q.supportedTransports[N],this,this.realtime.auth,G,function(j,tt){var lt=V.state;if(lt==V.states.closing||lt==V.states.closed||lt==V.states.failed){tt&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+lt.state+" while we were attempting the transport; closing "+tt),tt.close()),B(!0);return}if(j){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+j.event+", err: "+j.error.toString()),C.default.isTokenErr(j.error)&&!(V.errorReason&&C.default.isTokenErr(V.errorReason))?(V.errorReason=j.error,V.realtime.auth._forceNewToken(null,null,function(mt){if(mt){V.actOnErrorFromAuthorize(mt);return}V.tryATransport(G,N,B)})):j.event==="failed"?(V.notifyState({state:"failed",error:j.error}),B(!0)):j.event==="disconnected"&&(M.isRetriable(j.error)?B(!1):(V.notifyState({state:V.states.connecting.failState,error:j.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),V.setTransportPending(tt,G),B(null,tt)})},Q.prototype.setTransportPending=function(G,N){var B=this,V=N.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+V),A.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var j=b.default.Defaults.transportPreferenceOrder[b.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(lt,mt,vt,Ot){V=="upgrade"?G.shortName!==j&&A.arrIn(B.getUpgradePossibilities(),j)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(lt,G,mt,vt,Ot)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(lt,G,mt,vt,Ot):(B.activateTransport(lt,G,mt,vt,Ot),b.default.Config.nextTick(function(){B.connectImpl(N)})),V==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var tt=this;G.on(["disconnected","closed","failed"],function(lt){tt.deactivateTransport(G,this.event,lt)}),this.emit("transport.pending",G)},Q.prototype.scheduleTransportActivation=function(G,N,B,V,j){var tt=this,lt=this.activeProtocol&&this.activeProtocol.getTransport(),mt=function(){N.disconnect(),A.arrDeleteValue(tt.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),mt();return}if(lt&&!x(N,lt)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+lt.shortName+" - abandoning upgrade"),mt();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var vt=function(Ot){var xt;if(Ot){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+N+"; err = "+Ot);return}if(!N.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),mt();return}if(tt.state===tt.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),tt.state=tt.states.synchronizing,xt=tt.activeProtocol;else if(tt.state!==tt.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+tt.state.state+(tt.state===tt.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),mt();return}var ft=B!==tt.connectionId,Mt=ft?j:tt;ft&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(tt.timeSerial||tt.connectionSerial)+" to "+(Mt.timeSerial||Mt.connectionSerial)+"; upgrade error was "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N),tt.sync(N,Mt,function(Yt,Ut,Ht){if(Yt){tt.state===tt.states.synchronizing&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+N+"; err = "+Yt),tt.disconnectAllTransports());return}var ue=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),tt.activateTransport(G,N,Ut,V,Ht),tt.state===tt.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),tt.state=tt.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+tt.state.state+", so leaving unchanged"),tt.state.sendEvents&&tt.sendQueuedMessages()};xt?xt.onceIdle(ue):ue()})};lt?this.realtime.channels.onceNopending(vt):vt()},Q.prototype.activateTransport=function(G,N,B,V,j){var tt=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),G&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),V&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(V)),j&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(j.timeSerial||j.connectionSerial)),this.persistTransportPreference(N);var lt=this.state,mt=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+lt.state),lt.state==this.states.closing.state||lt.state==this.states.closed.state||lt.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(A.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var vt=this.activeProtocol;this.activeProtocol=new c.default(N),this.host=N.params.host;var Ot=V.connectionKey;if(Ot&&this.connectionKey!=Ot&&this.setConnection(B,V,j,!!G),this.onConnectionDetailsUpdate(V,N),b.default.Config.nextTick(function(){N.on("connected",function(ft,Mt,Yt){tt.onConnectionDetailsUpdate(Yt,N),tt.emit("update",new O.default(mt,mt,null,ft))})}),lt.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new O.default(mt,mt,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",N),vt)if(vt.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+vt.transport.shortName+", new one is "+N.shortName+") finishing with "+vt.messageQueue.count()+" messages still pending"),vt.transport===N){var xt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",xt)}else vt.finish();return A.safeArrForEach(this.pendingTransports,function(ft){if(ft===N){var Mt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",Mt),A.arrDeleteValue(tt.pendingTransports,N)}else ft.disconnect()}),A.safeArrForEach(this.proposedTransports,function(ft){ft===N?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),A.arrDeleteValue(tt.proposedTransports,N)):ft.dispose()}),!0},Q.prototype.deactivateTransport=function(G,N,B){var V=this.activeProtocol,j=V&&V.getTransport()===G,tt=A.arrDeleteValue(this.pendingTransports,G),lt=A.arrDeleteValue(this.proposedTransports,G),mt=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(j?"; was active":tt?"; was pending":lt?"; was proposed":"")+(mt?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),j&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(V.getPendingMessages()),b.default.Config.nextTick(function(){V.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),j&&mt||j&&N==="failed"||N==="closed"||V===null&&tt&&this.pendingTransports.length===0){if(N==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:B,retryImmediately:!0});return}var vt=N==="failed"&&C.default.isTokenErr(B)?"disconnected":N;this.notifyState({state:vt,error:B});return}j&&N==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},Q.prototype.noTransportsScheduledForActivation=function(){return A.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Q.prototype.sync=function(G,N,B){var V=setTimeout(function(){G.off("sync"),B(new w.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),j=S.default.fromValues({action:y.SYNC,connectionKey:this.connectionKey});N.timeSerial?j.timeSerial=N.timeSerial:N.connectionSerial!==void 0&&(j.connectionSerial=N.connectionSerial),G.send(j),G.once("sync",function(tt,lt){clearTimeout(V),B(null,tt,lt)})},Q.prototype.setConnection=function(G,N,B,V){var j=this,tt=this.connectionId,lt=tt&&tt!==G,mt=!tt&&V;(lt||mt)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),b.default.Config.nextTick(function(){j.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){j.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=N.connectionKey;var vt=lt||!tt;this.setConnectionSerial(B,vt,!1)},Q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Q.prototype.setConnectionSerial=function(G,N,B){var V=G.timeSerial,j=G.connectionSerial;if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+j+"; timeSerial = "+V+"; force = "+N+"; previous = "+this.connectionSerial),V!==void 0){if(V<=this.timeSerial&&!N)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+V+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=V,this.setRecoveryKey();return}if(j!==void 0){if(j<=this.connectionSerial&&!N)return B&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+j+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=j,this.setRecoveryKey()}},Q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=A.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Q.prototype.persistConnection=function(){if(l()){var G=this.realtime.connection.recoveryKey;G&&U({recoveryKey:G,disconnectedAt:A.now(),location:s.location,clientId:this.realtime.auth.clientId})}},Q.prototype.unpersistConnection=function(){_()},Q.prototype.getError=function(){return this.errorReason||this.getStateError()},Q.prototype.getStateError=function(){return M.default[this.state.state]},Q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Q.prototype.enactStateChange=function(G){var N=G.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(N,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var B=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Q.prototype.startTransitionTimer=function(G){var N=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),N.notifyState({state:G.failState}))},G.retryDelay)},Q.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Q.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Q.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Q.prototype.startRetryTimer=function(G){var N=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},G)},Q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Q.prototype.notifyState=function(G){var N=this,B=G.state,V=B==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&C.default.isTokenErr(G.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+B+(V?"; will retry connection immediately":"")),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(B==="suspended"||B==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var j=this.states[G.state],tt=j.retryDelay;j.state==="disconnected"&&(this.disconnectedRetryCount++,tt=j.retryDelay*A.getBackoffCoefficient(this.disconnectedRetryCount)*A.getJitterCoefficient());var lt=new O.default(this.state.state,j.state,tt,G.error||M.default[j.state]);if(V){var mt=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=A.now(),N.requestState({state:"connecting"}))},vt=this.lastAutoReconnectAttempt&&A.now()-this.lastAutoReconnectAttempt+1;vt&&vt<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+vt+"ms ago, waiting another "+(1e3-vt)+"ms before trying again"),setTimeout(mt,1e3-vt)):b.default.Config.nextTick(mt)}else(B==="disconnected"||B==="suspended")&&this.startRetryTimer(tt);(B==="disconnected"&&!V||B==="suspended"||j.terminal)&&b.default.Config.nextTick(function(){N.disconnectAllTransports()}),B=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(lt),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(B,lt.reason),this.failQueuedMessages(lt.reason))}},Q.prototype.requestState=function(G){var N=this,B=G.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+B+"; current state: "+this.state.state),B!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(B),!(B=="connecting"&&this.state.state=="connected")&&!(B=="closing"&&this.state.state=="closed"))){var V=this.states[B],j=new O.default(this.state.state,V.state,null,G.error||M.default[V.state]);this.enactStateChange(j),B=="connecting"&&b.default.Config.nextTick(function(){N.startConnect()}),B=="closing"&&this.closeImpl()}},Q.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,B=++this.connectCounter,V=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(tt){B===G.connectCounter&&G.connectImpl(tt,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")V();else{var j=function(tt){B===G.connectCounter&&(tt?G.actOnErrorFromAuthorize(tt):V())};this.errorReason&&C.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,j):N._ensureValidAuthCredentials(!1,j)}},Q.prototype.connectImpl=function(G,N){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,N)},Q.prototype.connectPreference=function(G){var N=this,B=this.getTransportPreference(),V=!1;A.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(G)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var j=setTimeout(function(){V=!0,N.state.state!==N.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),N.disconnectAllTransports(),N.unpersistTransportPreference()),N.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,B,function(tt,lt){clearTimeout(j),V&&lt?(lt.off(),lt.disconnect(),A.arrDeleteValue(N.pendingTransports,lt)):!lt&&!tt&&(N.unpersistTransportPreference(),N.connectImpl(G))})},Q.prototype.connectBase=function(G,N){var B=this,V=function(vt){B.notifyState({state:B.states.connecting.failState,error:vt})},j=this.httpHosts.slice(),tt=function(vt,Ot){N===B.connectCounter&&!Ot&&!vt&&mt()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var lt=j.shift();if(!lt){V(new w.default("Unable to connect (no available host)",80003,404));return}G.host=lt;var mt=function(){if(!j.length){V(new w.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){V(new w.default("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(vt,Ot){if(N===B.connectCounter){if(vt){V(vt);return}if(!Ot){V(new w.default("Unable to connect (network unreachable)",80003,404));return}G.host=A.arrPopRandomElement(j),B.tryATransport(G,B.baseTransport,tt)}})};if(this.forceFallbackHost&&j.length){this.forceFallbackHost=!1,mt();return}this.tryATransport(G,this.baseTransport,tt)},Q.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,N=A.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(N+1)},Q.prototype.upgradeIfNeeded=function(G){var N=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+b.default.Config.inspect(B)),B.length&&A.arrForEach(B,function(V){var j=N.createTransportParams(G.host,"upgrade");N.tryATransport(j,V,P)})},Q.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),A.safeArrForEach(this.pendingTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),A.safeArrForEach(this.proposedTransports,function(G){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Q.prototype.onAuthUpdated=function(G,N){var B=this,V;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var j=this.activeProtocol.getTransport().params;b.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(j)})}var tt=(V=this.activeProtocol)===null||V===void 0?void 0:V.getTransport();tt&&tt.onAuthUpdated&&tt.onAuthUpdated(G);var lt=S.default.fromValues({action:y.AUTH,auth:{accessToken:G.token}});this.send(lt);var mt=function(){B.off(vt),N(null,G)},vt=function(xt){xt.current==="failed"&&(B.off(mt),B.off(vt),N(xt.reason||B.getStateError()))};this.once("connectiondetails",mt),this.on("connectionstate",vt);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Ot=function(xt){switch(xt.current){case"connected":B.off(Ot),N(null,G);break;case"failed":case"closed":case"suspended":B.off(Ot),N(xt.reason||B.getStateError());break;default:break}};this.on("connectionstate",Ot),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Q.prototype.disconnectAllTransports=function(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,A.safeArrForEach(this.pendingTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],A.safeArrForEach(this.proposedTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Q.prototype.send=function(G,N,B){B=B||P;var V=this.state;if(V.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new c.PendingMessage(G,B));return}var j=N&&V.queueEvents||V.forceQueueEvents;if(!j){var tt="rejecting event, queueEvent was "+N+", state was "+V.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",tt),B(this.errorReason||new w.default(tt,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+S.default.stringify(G)),this.queue(G,B)},Q.prototype.sendImpl=function(G){var N=G.message;G.ackRequired&&!G.sendAttempted&&(N.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},Q.prototype.queue=function(G,N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),V=this.options.maxMessageSize;B&&!B.sendAttempted&&z(B.message,G,V)?(B.merged||(B.callback=T.default.create([B.callback]),B.merged=!0),B.callback.push(N)):this.queuedMessages.push(new c.PendingMessage(G,N))},Q.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Q.prototype.queuePendingMessages=function(G){G&&G.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Q.prototype.failQueuedMessages=function(G){var N=this.queuedMessages.count();N>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+A.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Q.prototype.onChannelMessage=function(G,N){var B=this.activeProtocol&&N===this.activeProtocol.getTransport(),V=A.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing,j=G.action===y.MESSAGE||G.action===y.PRESENCE;if(B||V){if(j){var tt=this.setConnectionSerial(G,!1,!0);if(tt)return;if(S.default.isDuplicate(G,this.mostRecentMsg)){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else A.arrIndexOf([y.ACK,y.NACK,y.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Q.prototype.ping=function(G,N){var B=this;if(G){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var V=function(){G.off("heartbeat",lt),N(new w.default("Timeout waiting for heartbeat response",5e4,500))},j=A.now(),tt=A.cheapRandStr(),lt=function(ft){if(ft===tt){G.off("heartbeat",lt),clearTimeout(mt);var Mt=A.now()-j;N(null,Mt)}},mt=setTimeout(V,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",lt),G.ping(tt);return}if(this.state.state!=="connected"){N(new w.default("Unable to ping service; not connected",4e4,400));return}var vt=!1,Ot=function(ft,Mt){B.off("transport.active",xt),vt||(vt=!0,N(ft,Mt))},xt=function(){vt||(vt=!0,b.default.Config.nextTick(function(){B.ping(null,N)}))};this.on("transport.active",xt),this.ping(this.activeProtocol.getTransport(),Ot)},Q.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Q.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Q.prototype.getTransportPreference=function(){var G,N;return this.transportPreference||p()&&((N=(G=b.default.WebStorage)===null||G===void 0?void 0:G.get)===null||N===void 0?void 0:N.call(G,D))},Q.prototype.persistTransportPreference=function(G){var N,B;A.arrIn(d.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,p()&&((B=(N=b.default.WebStorage)===null||N===void 0?void 0:N.set)===null||B===void 0||B.call(N,D,G.shortName)))},Q.prototype.unpersistTransportPreference=function(){var G,N;this.transportPreference=null,p()&&((N=(G=b.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||N===void 0||N.call(G,D))},Q.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===f.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new w.default(N,80019,403,G)})}else{var N="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new w.default(N,80019,401,G)})}},Q.prototype.onConnectionDetailsUpdate=function(G,N){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var B=G.clientId;if(B){var V=this.realtime.auth._uncheckedSetClientId(B);if(V){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",V.message),N.fail(V);return}}var j=G.connectionStateTtl;j&&(this.connectionStateTtl=j),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Q.supportedTransports={},Q}(E.default);o.default=J}).call(this,n(12))},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),S=s.__importStar(n(2)),A=s.__importDefault(n(7)),c=s.__importDefault(n(3)),d=s.__importDefault(n(19)),b=s.__importDefault(n(5)),E=s.__importDefault(n(0)),R=i.default.Action,a=i.default.fromValues({action:R.CLOSE}),O=i.default.fromValues({action:R.DISCONNECT}),M=function(w){s.__extends(C,w);function C(m,T,u,v){var f=w.call(this)||this;return v&&(u.format=void 0,u.heartbeats=!0),f.connectionManager=m,m.registerProposedTransport(f),f.auth=T,f.params=u,f.timeouts=u.options.timeouts,f.format=u.format,f.isConnected=!1,f.isFinished=!1,f.isDisposed=!1,f.maxIdleInterval=null,f.idleTimer=null,f.lastActivity=null,f}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",d.default.closed)},C.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||d.default.disconnected)},C.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||d.default.failed)},C.prototype.finish=function(m,T){var u;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((u=this.idleTimer)!==null&&u!==void 0?u:void 0),this.idleTimer=null,this.emit(m,T),this.dispose())},C.prototype.onProtocolMessage=function(m){switch(c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case R.HEARTBEAT:c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case R.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case R.CLOSED:this.onClose(m);break;case R.DISCONNECTED:this.onDisconnect(m);break;case R.ACK:this.emit("ack",m.msgSerial,m.count);break;case R.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case R.SYNC:if(m.connectionId!==void 0){this.emit("sync",m.connectionId,m);break}this.connectionManager.onChannelMessage(m,this);break;case R.AUTH:this.auth.authorize(function(T){T&&c.default.logAction(c.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+S.inspectError(T))});break;case R.ERROR:if(c.default.logAction(c.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+E.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},C.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=m.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(m){var T=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onDisconnect()","err = "+S.inspectError(T)),this.finish("disconnected",T)},C.prototype.onFatalError=function(m){var T=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onFatalError()","err = "+S.inspectError(T)),this.finish("failed",T)},C.prototype.onClose=function(m){var T=m&&m.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onClose()","err = "+S.inspectError(T)),this.finish("closed",T)},C.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},C.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(O)},C.prototype.ping=function(m){var T={action:i.default.Action.HEARTBEAT};m&&(T.id=m),this.send(i.default.fromValues(T))},C.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=S.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(m){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},m))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=S.now()-this.lastActivity,T=this.maxIdleInterval-m;if(T<=0){var u="No activity seen from realtime in "+m+"ms; assuming connection has dropped";c.default.logAction(c.default.LOG_ERROR,"Transport.onIdleTimerExpire()",u),this.disconnect(new b.default(u,80003,408))}else this.setIdleTimer(T+100)},C.tryConnect=function(m,T,u,v,f){var p=new m(T,u,v),l,y=function(D){clearTimeout(l),f({event:this.event,error:D})},P=T.options.timeouts.realtimeRequestTimeout;l=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),y.call({event:"disconnected"},new b.default("Timeout waiting for transport to indicate itself viable",5e4,500))},P),p.on(["failed","disconnected"],y),p.on("preconnect",function(){c.default.logAction(c.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(l),p.off(["failed","disconnected"],y),f(null,p)}),p.connect()},C}(A.default);o.default=M},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(39),n(23))})(this,function(s){return function(){var i=s,S=i.lib,A=S.Base,c=S.WordArray,d=i.algo,b=d.MD5,E=d.EvpKDF=A.extend({cfg:A.extend({keySize:128/32,hasher:b,iterations:1}),init:function(R){this.cfg=this.cfg.extend(R)},compute:function(R,a){for(var O,M=this.cfg,w=M.hasher.create(),C=c.create(),m=C.words,T=M.keySize,u=M.iterations;m.length<T;){O&&w.update(O),O=w.update(R).finalize(a),w.reset();for(var v=1;v<u;v++)O=w.finalize(O),w.reset();C.concat(O)}return C.sigBytes=T*4,C}});i.EvpKDF=function(R,a,O){return E.create(O).compute(R,a)}}(),s.EvpKDF})},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(27))})(this,function(s){s.lib.Cipher||function(i){var S=s,A=S.lib,c=A.Base,d=A.WordArray,b=A.BufferedBlockAlgorithm,E=S.enc,R=E.Utf8,a=E.Base64,O=S.algo,M=O.EvpKDF,w=A.Cipher=b.extend({cfg:c.extend(),createEncryptor:function(_,x){return this.create(this._ENC_XFORM_MODE,_,x)},createDecryptor:function(_,x){return this.create(this._DEC_XFORM_MODE,_,x)},init:function(_,x,z){this.cfg=this.cfg.extend(z),this._xformMode=_,this._key=x,this.reset()},reset:function(){b.reset.call(this),this._doReset()},process:function(_){return this._append(_),this._process()},finalize:function(_){_&&this._append(_);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function _(x){return typeof x=="string"?U:D}return function(x){return{encrypt:function(z,W,J){return _(W).encrypt(x,z,W,J)},decrypt:function(z,W,J){return _(W).decrypt(x,z,W,J)}}}}()}),C=A.StreamCipher=w.extend({_doFinalize:function(){var _=this._process(!0);return _},blockSize:1}),m=S.mode={},T=A.BlockCipherMode=c.extend({createEncryptor:function(_,x){return this.Encryptor.create(_,x)},createDecryptor:function(_,x){return this.Decryptor.create(_,x)},init:function(_,x){this._cipher=_,this._iv=x}}),u=m.CBC=function(){var _=T.extend();_.Encryptor=_.extend({processBlock:function(z,W){var J=this._cipher,Z=J.blockSize;x.call(this,z,W,Z),J.encryptBlock(z,W),this._prevBlock=z.slice(W,W+Z)}}),_.Decryptor=_.extend({processBlock:function(z,W){var J=this._cipher,Z=J.blockSize,Q=z.slice(W,W+Z);J.decryptBlock(z,W),x.call(this,z,W,Z),this._prevBlock=Q}});function x(z,W,J){var Z,Q=this._iv;Q?(Z=Q,this._iv=i):Z=this._prevBlock;for(var G=0;G<J;G++)z[W+G]^=Z[G]}return _}(),v=S.pad={},f=v.Pkcs7={pad:function(_,x){for(var z=x*4,W=z-_.sigBytes%z,J=W<<24|W<<16|W<<8|W,Z=[],Q=0;Q<W;Q+=4)Z.push(J);var G=d.create(Z,W);_.concat(G)},unpad:function(_){var x=_.words[_.sigBytes-1>>>2]&255;_.sigBytes-=x}},p=A.BlockCipher=w.extend({cfg:w.cfg.extend({mode:u,padding:f}),reset:function(){var _;w.reset.call(this);var x=this.cfg,z=x.iv,W=x.mode;this._xformMode==this._ENC_XFORM_MODE?_=W.createEncryptor:(_=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==_?this._mode.init(this,z&&z.words):(this._mode=_.call(W,this,z&&z.words),this._mode.__creator=_)},_doProcessBlock:function(_,x){this._mode.processBlock(_,x)},_doFinalize:function(){var _,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),_=this._process(!0)):(_=this._process(!0),x.unpad(_)),_},blockSize:128/32}),l=A.CipherParams=c.extend({init:function(_){this.mixIn(_)},toString:function(_){return(_||this.formatter).stringify(this)}}),y=S.format={},P=y.OpenSSL={stringify:function(_){var x,z=_.ciphertext,W=_.salt;return W?x=d.create([1398893684,1701076831]).concat(W).concat(z):x=z,x.toString(a)},parse:function(_){var x,z=a.parse(_),W=z.words;return W[0]==1398893684&&W[1]==1701076831&&(x=d.create(W.slice(2,4)),W.splice(0,4),z.sigBytes-=16),l.create({ciphertext:z,salt:x})}},D=A.SerializableCipher=c.extend({cfg:c.extend({format:P}),encrypt:function(_,x,z,W){W=this.cfg.extend(W);var J=_.createEncryptor(z,W),Z=J.finalize(x),Q=J.cfg;return l.create({ciphertext:Z,key:z,iv:Q.iv,algorithm:_,mode:Q.mode,padding:Q.padding,blockSize:_.blockSize,formatter:W.format})},decrypt:function(_,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var J=_.createDecryptor(z,W).finalize(x.ciphertext);return J},_parse:function(_,x){return typeof _=="string"?x.parse(_,this):_}}),k=S.kdf={},H=k.OpenSSL={execute:function(_,x,z,W){W||(W=d.random(64/8));var J=M.create({keySize:x+z}).compute(_,W),Z=d.create(J.words.slice(x),z*4);return J.sigBytes=x*4,l.create({key:J,iv:Z,salt:W})}},U=A.PasswordBasedCipher=D.extend({cfg:D.cfg.extend({kdf:H}),encrypt:function(_,x,z,W){W=this.cfg.extend(W);var J=W.kdf.execute(z,_.keySize,_.ivSize);W.iv=J.iv;var Z=D.encrypt.call(this,_,x,J.key,W);return Z.mixIn(J),Z},decrypt:function(_,x,z,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var J=W.kdf.execute(z,_.keySize,_.ivSize,x.salt);W.iv=J.iv;var Z=D.decrypt.call(this,_,x,J.key,W);return Z}})}()})},function(h,o,n){"use strict";o.__esModule=!0,o.Request=o.createRequest=void 0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(11)),A=s.__importDefault(n(0)),c=s.__importDefault(n(7)),d=s.__importDefault(n(5)),b=s.__importDefault(n(8)),E=s.__importDefault(n(3)),R=s.__importDefault(n(20)),a=i.getGlobalObject(),O=function(){},M=a._ablyjs_jsonp={};M._=function(f){return M["_"+f]||O};var w=1,C="jsonp";function m(f,p,l,y,P,D,k){return D=D||b.default.TIMEOUTS,new u(void 0,f,p,i.copy(l),y,P,D,k)}o.createRequest=m;var T=function(f){s.__extends(p,f);function p(l,y,P){var D=f.call(this,l,y,P)||this;return D.shortName=C,P.stream=!1,D}return p.isAvailable=function(){return A.default.Config.jsonpSupported&&A.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(l,y,P,D,k,H,U){return H=(this===null||this===void 0?void 0:this.timeouts)||H||b.default.TIMEOUTS,m(l,y,P,D,k,H,U)},p}(S.default),u=function(f){s.__extends(p,f);function p(l,y,P,D,k,H,U,_){var x=f.call(this)||this;return l===void 0&&(l=w++),x.id=l,x.uri=y,x.params=D||{},x.params.rnd=i.cheapRandStr(),P&&(P["X-Ably-Version"]&&(x.params.v=P["X-Ably-Version"]),P["X-Ably-Lib"]&&(x.params.lib=P["X-Ably-Lib"])),x.body=k,x.method=_,x.requestMode=H,x.timeouts=U,x.requestComplete=!1,x}return p.prototype.exec=function(){var l=this,y=this.id,P=this.body,D=this.method,k=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+y+")",H.envelope="jsonp",P&&(H.body=P),D&&D!=="get"&&(H.method=D);var U=this.script=document.createElement("script"),_=k+i.toQueryString(H);U.src=_,U.src.split("/").slice(-1)[0]!==_.split("/").slice(-1)[0]&&E.default.logAction(E.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),U.async=!0,U.type="text/javascript",U.charset="UTF-8",U.onerror=function(W){l.complete(new d.default("JSONP script error (event: "+A.default.Config.inspect(W)+")",null,400))},M["_"+y]=function(W){if(W.statusCode){var J=W.response;if(W.statusCode==204)l.complete(null,null,null,W.statusCode);else if(!J)l.complete(new d.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||i.isArray(J))l.complete(null,J,W.headers,W.statusCode);else{var Z=J.error||new d.default("Error response received from server",null,W.statusCode);l.complete(Z)}}else l.complete(null,W)};var x=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var z=document.getElementsByTagName("head")[0];z.insertBefore(U,z.firstChild)},p.prototype.complete=function(l,y,P,D){if(P=P||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;y&&(k=typeof y=="string"?"text/plain":"application/json",P["content-type"]=k,this.emit("data",y)),this.emit("complete",l,y,P,!0,D),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var l=this.timer;l&&(clearTimeout(l),this.timer=null);var y=this.script;y.parentNode&&y.parentNode.removeChild(y),delete M[this.id],this.emit("disposed")},p}(c.default);o.Request=u;function v(f){return a.JSONPTransport=T,T.isAvailable()&&(f.supportedTransports[C]=T),T}o.default=v},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(3)),A=s.__importDefault(n(8)),c=s.__importDefault(n(16)),d=s.__importDefault(n(45)),b=s.__importDefault(n(18)),E=s.__importDefault(n(33)),R=s.__importDefault(n(5)),a=s.__importDefault(n(48)),O=s.__importDefault(n(17)),M=s.__importDefault(n(0)),w=function(){},C=function(){function T(u){if(!u){var v="no options provided";throw S.default.logAction(S.default.LOG_ERROR,"Rest()",v),new Error(v)}var f=A.default.objectifyOptions(u);f.log&&S.default.setLog(f.log.level,f.log.handler),S.default.logAction(S.default.LOG_MICRO,"Rest()","initialized with clientOptions "+M.default.Config.inspect(u));var p=this.options=A.default.normaliseOptions(f);if(p.key){var l=p.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!l){var v="invalid key parameter";throw S.default.logAction(S.default.LOG_ERROR,"Rest()",v),new R.default(v,40400,404)}p.keyName=l[1],p.keySecret=l[2]}if("clientId"in p)if(typeof p.clientId=="string"||p.clientId===null){if(p.clientId==="*")throw new R.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new R.default("clientId must be either a string or null",40012,400);S.default.logAction(S.default.LOG_MINOR,"Rest()","started; version = "+A.default.version),this.baseUri=this.authority=function(y){return A.default.getHttpScheme(p)+y+":"+A.default.getPort(p,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new M.default.Http,this.auth=new c.default(this,p),this.channels=new m(this),this.push=new d.default(this)}return T.prototype.stats=function(u,v){if(v===void 0)if(typeof u=="function")v=u,u=null;else{if(this.options.promises)return i.promisify(this,"stats",arguments);v=w}var f=i.defaultGetHeaders(),p=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,l=this.http.supportsLinkHeaders?void 0:p;this.options.headers&&i.mixin(f,this.options.headers),new b.default(this,"/stats",f,l,function(y,P,D){for(var k=D?y:JSON.parse(y),H=0;H<k.length;H++)k[H]=a.default.fromValues(k[H]);return k}).get(u,v)},T.prototype.time=function(u,v){var f=this;if(v===void 0){if(typeof u=="function")v=u,u=null;else if(this.options.promises)return i.promisify(this,"time",arguments)}var p=v||w,l=i.defaultGetHeaders();this.options.headers&&i.mixin(l,this.options.headers);var y=function(P){return f.authority(P)+"/time"};this.http.do(O.default.Get,this,y,l,null,u,function(P,D,k,H){if(P){p(P);return}H||(D=JSON.parse(D));var U=D[0];if(!U){p(new R.default("Internal error (unexpected result type from GET /time)",5e4,500));return}f.serverTimeOffset=U-i.now(),p(null,U)})},T.prototype.request=function(u,v,f,p,l,y){var P=this.options.useBinaryProtocol,D=P?M.default.Config.msgpack.encode:JSON.stringify,k=P?M.default.Config.msgpack.decode:JSON.parse,H=P?i.Format.msgpack:i.Format.json,U=this.http.supportsLinkHeaders?void 0:H;f=f||{};var _=u.toLowerCase(),x=_=="get"?i.defaultGetHeaders(H):i.defaultPostHeaders(H);if(y===void 0){if(this.options.promises)return i.promisify(this,"request",arguments);y=w}typeof p!="string"&&(p=D(p)),this.options.headers&&i.mixin(x,this.options.headers),l&&i.mixin(x,l);var z=new b.default(this,v,x,U,function(W,J,Z){return i.ensureArray(Z?W:k(W))},!0);if(!i.arrIn(M.default.Http.methods,_))throw new R.default("Unsupported method "+_,40500,405);i.arrIn(M.default.Http.methodsWithBody,_)?z[_](f,p,y):z[_](f,y)},T.prototype.setLog=function(u){S.default.setLog(u.level,u.handler)},T.Promise=function(u){return u=A.default.objectifyOptions(u),u.promises=!0,new T(u)},T.Callbacks=T,T.Platform=M.default,T}(),m=function(){function T(u){this.rest=u,this.all={}}return T.prototype.get=function(u,v){u=String(u);var f=this.all[u];return f?v&&f.setOptions(v):this.all[u]=f=new E.default(this.rest,u,v),f},T.prototype.release=function(u){delete this.all[String(u)]},T}();o.default=C},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(i){var S=s,A=S.lib,c=A.WordArray,d=A.Hasher,b=S.algo,E=[],R=[];(function(){function M(T){for(var u=i.sqrt(T),v=2;v<=u;v++)if(!(T%v))return!1;return!0}function w(T){return(T-(T|0))*4294967296|0}for(var C=2,m=0;m<64;)M(C)&&(m<8&&(E[m]=w(i.pow(C,1/2))),R[m]=w(i.pow(C,1/3)),m++),C++})();var a=[],O=b.SHA256=d.extend({_doReset:function(){this._hash=new c.init(E.slice(0))},_doProcessBlock:function(M,w){for(var C=this._hash.words,m=C[0],T=C[1],u=C[2],v=C[3],f=C[4],p=C[5],l=C[6],y=C[7],P=0;P<64;P++){if(P<16)a[P]=M[w+P]|0;else{var D=a[P-15],k=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,H=a[P-2],U=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;a[P]=k+a[P-7]+U+a[P-16]}var _=f&p^~f&l,x=m&T^m&u^T&u,z=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),W=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),J=y+W+_+R[P]+a[P],Z=z+x;y=l,l=p,p=f,f=v+J|0,v=u,u=T,T=m,m=J+Z|0}C[0]=C[0]+m|0,C[1]=C[1]+T|0,C[2]=C[2]+u|0,C[3]=C[3]+v|0,C[4]=C[4]+f|0,C[5]=C[5]+p|0,C[6]=C[6]+l|0,C[7]=C[7]+y|0},_doFinalize:function(){var M=this._data,w=M.words,C=this._nDataBytes*8,m=M.sigBytes*8;return w[m>>>5]|=128<<24-m%32,w[(m+64>>>9<<4)+14]=i.floor(C/4294967296),w[(m+64>>>9<<4)+15]=C,M.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var M=d.clone.call(this);return M._hash=this._hash.clone(),M}});S.SHA256=d._createHelper(O),S.HmacSHA256=d._createHmacHelper(O)}(Math),s.SHA256})},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return s.enc.Utf8})},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(7)),A=s.__importDefault(n(3)),c=s.__importDefault(n(34)),d=s.__importDefault(n(9)),b=s.__importDefault(n(5)),E=s.__importDefault(n(18)),R=s.__importDefault(n(24)),a=s.__importDefault(n(0));function O(){}var M=9;function w(T){return i.arrEvery(T,function(u){return!u.id})}function C(T){var u=T||{};if(u.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var v=a.default.Crypto.getCipher(u.cipher);u.cipher=v.cipherParams,u.channelCipher=v.cipher}else"cipher"in u&&(u.cipher=void 0,u.channelCipher=null);return u}var m=function(T){s.__extends(u,T);function u(v,f,p){var l=T.call(this)||this;return A.default.logAction(A.default.LOG_MINOR,"Channel()","started; name = "+f),l.rest=v,l.name=f,l.basePath="/channels/"+encodeURIComponent(f),l.presence=new c.default(l),l.channelOptions=C(p),l}return u.prototype.setOptions=function(v){this.channelOptions=C(v)},u.prototype.history=function(v,f){if(A.default.logAction(A.default.LOG_MICRO,"Channel.history()","channel = "+this.name),f===void 0)if(typeof v=="function")f=v,v=null;else{if(this.rest.options.promises)return i.promisify(this,"history",arguments);f=O}this._history(v,f)},u.prototype._history=function(v,f){var p=this.rest,l=p.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:l,P=i.defaultGetHeaders(l);p.options.headers&&i.mixin(P,p.options.headers);var D=this.channelOptions;new E.default(p,this.basePath+"/messages",P,y,function(k,H,U){return d.default.fromResponseBody(k,D,U?void 0:l)}).get(v,f)},u.prototype.publish=function(){var v=this,f=arguments.length,p=arguments[0],l=arguments[1],y=arguments[f-1],P,D;if(typeof y!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);y=O}if(typeof p=="string"||p===null)P=[d.default.fromValues({name:p,data:l})],D=arguments[2];else if(i.isObject(p))P=[d.default.fromValues(p)],D=arguments[1];else if(i.isArray(p))P=d.default.fromValuesArray(p),D=arguments[1];else throw new b.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof D!="object"||!D)&&(D={});var k=this.rest,H=k.options,U=H.useBinaryProtocol?i.Format.msgpack:i.Format.json,_=k.options.idempotentRestPublishing,x=i.defaultPostHeaders(U);if(H.headers&&i.mixin(x,H.headers),_&&w(P)){var z=i.randomString(M);i.arrForEach(P,function(W,J){W.id=z+":"+J.toString()})}d.default.encodeArray(P,this.channelOptions,function(W){if(W){y(W);return}var J=d.default.getMessagesSize(P),Z=H.maxMessageSize;if(J>Z){y(new b.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+Z+" bytes)",40009,400));return}v._publish(d.default.serialize(P,U),x,D,y)})},u.prototype._publish=function(v,f,p,l){R.default.post(this.rest,this.basePath+"/messages",v,f,p,null,l)},u.prototype.status=function(v){if(typeof v!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var f=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,p=i.defaultPostHeaders(f);R.default.get(this.rest,this.basePath,p,{},f,v||O)},u}(S.default);o.default=m},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(7)),A=s.__importDefault(n(3)),c=s.__importDefault(n(18)),d=s.__importDefault(n(14));function b(){}var E=function(R){s.__extends(a,R);function a(O){var M=R.call(this)||this;return M.channel=O,M.basePath=O.basePath+"/presence",M}return a.prototype.get=function(O,M){if(A.default.logAction(A.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),M===void 0)if(typeof O=="function")M=O,O=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);M=b}var w=this.channel.rest,C=w.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:C,T=i.defaultGetHeaders(C);w.options.headers&&i.mixin(T,w.options.headers);var u=this.channel.channelOptions;new c.default(w,this.basePath,T,m,function(v,f,p){return d.default.fromResponseBody(v,u,p?void 0:C)}).get(O,M)},a.prototype.history=function(O,M){A.default.logAction(A.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(O,M)},a.prototype._history=function(O,M){if(M===void 0)if(typeof O=="function")M=O,O=null;else{if(this.channel.rest.options.promises)return i.promisify(this,"_history",arguments);M=b}var w=this.channel.rest,C=w.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:C,T=i.defaultGetHeaders(C);w.options.headers&&i.mixin(T,w.options.headers);var u=this.channel.channelOptions;new c.default(w,this.basePath+"/history",T,m,function(v,f,p){return d.default.fromResponseBody(v,u,p?void 0:C)}).get(O,M)},a}(S.default);o.default=E},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(7)),S=s.__importDefault(n(3)),A=function(c){s.__extends(d,c);function d(){var b=c.call(this)||this;return b.messages=[],b}return d.prototype.count=function(){return this.messages.length},d.prototype.push=function(b){this.messages.push(b)},d.prototype.shift=function(){return this.messages.shift()},d.prototype.last=function(){return this.messages[this.messages.length-1]},d.prototype.copyAll=function(){return this.messages.slice()},d.prototype.append=function(b){this.messages.push.apply(this.messages,b)},d.prototype.prepend=function(b){this.messages.unshift.apply(this.messages,b)},d.prototype.completeMessages=function(b,E,R){S.default.logAction(S.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+b+"; count = "+E),R=R||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var O=a[0];if(O){var M=O.message.msgSerial,w=b+E;if(w>M)for(var C=a.splice(0,w-M),m=0,T=C;m<T.length;m++){var u=T[m];u.callback(R)}a.length==0&&this.emit("idle")}},d.prototype.completeAllMessages=function(b){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,b)},d.prototype.clear=function(){S.default.logAction(S.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},d}(i.default);o.default=A},function(h,o,n){"use strict";o.__esModule=!0;var s=function(){function i(S,A,c,d){this.previous=S,this.current=A,c&&(this.retryIn=c),d&&(this.reason=d)}return i}();o.default=s},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(10)),S=s.__importDefault(n(7)),A=s.__importStar(n(2)),c=s.__importDefault(n(33)),d=s.__importDefault(n(3)),b=s.__importDefault(n(54)),E=s.__importDefault(n(9)),R=s.__importDefault(n(38)),a=s.__importDefault(n(5)),O=s.__importDefault(n(14)),M=s.__importDefault(n(19)),w=i.default.Action,C=function(){},m="statechange",T="sync";function u(f){if(f&&"params"in f&&!A.isObject(f.params))return new a.default("options.params must be an object",4e4,400);if(f&&"modes"in f){if(!A.isArray(f.modes))return new a.default("options.modes must be an array",4e4,400);for(var p=0;p<f.modes.length;p++){var l=f.modes[p];if(!l||typeof l!="string"||!A.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(l)))return new a.default("Invalid channel mode: "+l,4e4,400)}}}var v=function(f){s.__extends(p,f);function p(l,y,P){var D=f.call(this,l,y,P)||this;return D.retryCount=0,D.history=function(k,H){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof k=="function")H=k,k=null;else{if(this.rest.options.promises)return A.promisify(this,"history",arguments);H=C}if(k&&k.untilAttach){if(this.state!=="attached"){H(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete k.untilAttach,k.from_serial=this.properties.attachSerial}c.default.prototype._history.call(this,k,H)},D.whenState=function(k,H){return S.default.prototype.whenState.call(D,k,D.state,H)},d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel()","started; name = "+y),D.realtime=l,D.presence=new b.default(D),D.connectionManager=l.connection.connectionManager,D.state="initialized",D.subscriptions=new S.default,D.syncChannelSerial=void 0,D.properties={attachSerial:void 0},D.setOptions(P),D.errorReason=null,D._requestedFlags=null,D._mode=null,D._attachedMsgIndicator=!1,D._attachResume=!1,D._decodingContext={channelOptions:D.channelOptions,plugins:l.options.plugins||{},baseEncodedPreviousPayload:void 0},D._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},D._allChannelChanges=new S.default,D}return p.invalidStateError=function(l){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+l}},p.processListenerArgs=function(l){return l=Array.prototype.slice.call(l),typeof l[0]=="function"&&l.unshift(null),l[l.length-1]==null&&l.pop(),l},p.prototype.setOptions=function(l,y){if(!y&&this.rest.options.promises)return A.promisify(this,"setOptions",arguments);var P=y||function(k){k&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},D=u(l);if(D){P(D);return}c.default.prototype.setOptions.call(this,l),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(l)?(this.attachImpl(),this._allChannelChanges.once(function(k){switch(this.event){case"update":case"attached":P==null||P(null);return;default:P==null||P(k.reason);return}})):P()},p.prototype._shouldReattachToSetOptions=function(l){return(this.state==="attached"||this.state==="attaching")&&(l.params||l.modes)},p.prototype.publish=function(){for(var l=this,y=[],P=0;P<arguments.length;P++)y[P]=arguments[P];var D=y[0],k=y.length,H=y[k-1];if(typeof H!="function"){if(this.realtime.options.promises)return A.promisify(this,"publish",arguments);H=C,++k}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(k==2)if(A.isObject(D))D=[E.default.fromValues(D)];else if(A.isArray(D))D=E.default.fromValuesArray(D);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else D=[E.default.fromValues({name:y[0],data:y[1]})];var U=this.realtime.options.maxMessageSize;E.default.encodeArray(D,this.channelOptions,function(_){if(_){H(_);return}var x=E.default.getMessagesSize(D);if(x>U){H(new a.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+U+" bytes)",40009,400));return}l.__publish(D,H)})},p.prototype.__publish=function(l,y){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+l.length);var P=this.state;switch(P){case"failed":case"suspended":y(a.default.fromValues(p.invalidStateError(P)));break;default:{d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+P);var D=new i.default;D.action=w.MESSAGE,D.channel=this.name,D.messages=l,this.sendMessage(D,y);break}}},p.prototype.onEvent=function(l){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var y=this.subscriptions,P=0;P<l.length;P++){var D=l[P];y.emit(D.name,D)}},p.prototype.attach=function(l,y){var P;if(typeof l=="function"?(y=l,P=null):P=l,!y){if(this.realtime.options.promises)return A.promisify(this,"attach",arguments);y=function(D){D&&d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+D.toString())}}if(P)d.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=P;else if(this.state==="attached"){y();return}this._attach(!1,null,y)},p.prototype._attach=function(l,y,P){P||(P=function(k){k&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+k.toString())});var D=this.connectionManager;if(!D.activeState()){P(D.getError());return}(this.state!=="attaching"||l)&&this.requestState("attaching",y),this.once(function(k){switch(this.event){case"attached":P==null||P();break;case"detached":case"suspended":case"failed":P==null||P(k.reason||D.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":P==null||P(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},p.prototype.attachImpl=function(){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(m,!0);var l=i.default.fromValues({action:w.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?l.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&l.encodeModesToFlags(A.allToUpperCase(this.channelOptions.modes)),this._attachResume&&l.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(l.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(l,C)},p.prototype.detach=function(l){if(!l){if(this.realtime.options.promises)return A.promisify(this,"detach",arguments);l=C}var y=this.connectionManager;if(!y.activeState()){l(y.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),l();break;case"detached":l();break;case"failed":l(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(P){switch(this.event){case"detached":l();break;case"attached":case"suspended":case"failed":l(P.reason||y.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":l(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},p.prototype.detachImpl=function(l){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(m,!0);var y=i.default.fromValues({action:w.DETACH,channel:this.name});this.sendMessage(y,l||C)},p.prototype.subscribe=function(){for(var l=[],y=0;y<arguments.length;y++)l[y]=arguments[y];var P=p.processListenerArgs(l),D=P[0],k=P[1],H=P[2];if(!H&&this.realtime.options.promises)return A.promisify(this,"subscribe",[D,k]);if(this.state==="failed"){H==null||H(a.default.fromValues(p.invalidStateError("failed")));return}return D&&typeof D=="object"&&!Array.isArray(D)?this._subscribeFilter(D,k):this.subscriptions.on(D,k),this.attach(H||C)},p.prototype._subscribeFilter=function(l,y){var P=function(D){var k,H,U,_,x,z,W={name:D.name,refTimeserial:(H=(k=D.extras)===null||k===void 0?void 0:k.ref)===null||H===void 0?void 0:H.timeserial,refType:(_=(U=D.extras)===null||U===void 0?void 0:U.ref)===null||_===void 0?void 0:_.type,isRef:!!(!((z=(x=D.extras)===null||x===void 0?void 0:x.ref)===null||z===void 0)&&z.timeserial),clientId:D.clientId};Object.entries(l).find(function(J){var Z=J[0],Q=J[1];return Q!==void 0?W[Z]!==Q:!1})||y(D)};this._addFilteredSubscription(l,y,P),this.subscriptions.on(P)},p.prototype._addFilteredSubscription=function(l,y,P){var D;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(y)){var k=this.filteredSubscriptions.get(y);k.set(l,((D=k==null?void 0:k.get(l))===null||D===void 0?void 0:D.concat(P))||[P])}else this.filteredSubscriptions.set(y,new Map([[l,[P]]]))},p.prototype._getAndDeleteFilteredSubscriptions=function(l,y){var P=this;if(!this.filteredSubscriptions)return[];if(!y&&l)return Array.from(this.filteredSubscriptions.entries()).map(function(U){var _,x=U[0],z=U[1],W=z.get(l);return z.delete(l),z.size===0&&((_=P.filteredSubscriptions)===null||_===void 0||_.delete(x)),W}).reduce(function(U,_){var x;return _?(x=U).concat.apply(x,_):U},[]);if(!y||!this.filteredSubscriptions.has(y))return[];var D=this.filteredSubscriptions.get(y);if(!l){var k=Array.from(D.values()).reduce(function(U,_){return U.concat.apply(U,_)},[]);return this.filteredSubscriptions.delete(y),k}var H=D.get(l);return D.delete(l),H||[]},p.prototype.unsubscribe=function(){for(var l=this,y,P=[],D=0;D<arguments.length;D++)P[D]=arguments[D];var k=p.processListenerArgs(P),H=k[0],U=k[1];if(typeof H=="object"&&!U||((y=this.filteredSubscriptions)===null||y===void 0?void 0:y.has(U))){this._getAndDeleteFilteredSubscriptions(H,U).forEach(function(_){return l.subscriptions.off(_)});return}this.subscriptions.off(H,U)},p.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.default("Unable to sync to channel; not attached",4e4);default:}var l=this.connectionManager;if(!l.activeState())throw l.getError();var y=i.default.fromValues({action:w.SYNC,channel:this.name});this.syncChannelSerial&&(y.channelSerial=this.syncChannelSerial),l.send(y)},p.prototype.sendMessage=function(l,y){this.connectionManager.send(l,this.realtime.options.queueMessages,y)},p.prototype.sendPresence=function(l,y){var P=i.default.fromValues({action:w.PRESENCE,channel:this.name,presence:A.isArray(l)?O.default.fromValuesArray(l):[O.default.fromValues(l)]});this.sendMessage(P,y)},p.prototype.onMessage=function(l){var y,P=!1;switch(l.action){case w.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=l.channelSerial,this._mode=l.getMode(),this.params=l.params||{};var D=l.decodeModesFromFlags();this.modes=D&&A.allToLowerCase(D)||void 0;var k=l.hasFlag("RESUMED"),H=l.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(m,!1),k||this.presence.onAttached(H);var U=new R.default(this.state,this.state,k,l.error);this._allChannelChanges.emit("update",U),(!k||this.channelOptions.updateOnAttached)&&this.emit("update",U)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",l.error,k,H);break}case w.DETACHED:{var _=l.error?a.default.fromValues(l.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",_):this.state==="attaching"?this.notifyState("suspended",_):this.requestState("attaching",_);break}case w.SYNC:if(P=!0,y=this.syncChannelSerial=l.channelSerial,!l.presence)break;case w.PRESENCE:{for(var x=l.presence,z=l.id,W=l.connectionId,J=l.timestamp,Z=this.channelOptions,Q=void 0,G=0;G<x.length;G++)try{Q=x[G],O.default.decode(Q,Z),Q.connectionId||(Q.connectionId=W),Q.timestamp||(Q.timestamp=J),Q.id||(Q.id=z+":"+G)}catch(lt){d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",lt.toString())}this.presence.setPresence(x,P,y);break}case w.MESSAGE:{if(this.state!=="attached"){d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+l.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var N=l.messages,B=N[0],V=N[N.length-1],z=l.id,W=l.connectionId,J=l.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var j='Delta message decode failure - previous message not available for message "'+l.id+'" on this channel "'+this.name+'".';d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",j),this._startDecodeFailureRecovery(new a.default(j,40018,400));break}for(var G=0;G<N.length;G++){var j=N[G];try{E.default.decode(j,this._decodingContext)}catch(ft){switch(d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",ft.toString()),ft.code){case 40018:this._startDecodeFailureRecovery(ft);return;case 40019:case 40021:this.notifyState("failed",ft);return}}j.connectionId||(j.connectionId=W),j.timestamp||(j.timestamp=J),j.id||(j.id=z+":"+G)}this._lastPayload.messageId=V.id,this._lastPayload.protocolMessageChannelSerial=l.channelSerial,this.onEvent(N);break}case w.ERROR:{var tt=l.error;tt&&tt.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(tt));break}default:d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+l.action+")"),this.connectionManager.abort(M.default.unknownChannelErr)}},p.prototype._startDecodeFailureRecovery=function(l){var y=this;this._lastPayload.decodeFailureRecoveryInProgress||(d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,l,function(){y._lastPayload.decodeFailureRecoveryInProgress=!1}))},p.prototype.onAttached=function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},p.prototype.notifyState=function(l,y,P,D){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+l),this.clearStateTimer(),l!==this.state){this.presence.actOnChannelState(l,D,y),l==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),y&&(this.errorReason=y);var k=new R.default(this.state,l,P,y),H=l==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(H,'Channel state for channel "'+this.name+'"',l+(y?"; reason: "+y:"")),l!=="attaching"&&l!=="suspended"&&(this.retryCount=0),l==="attached"?(this.onAttached(),this.setInProgress(T,D),this.setInProgress(m,!1)):(l==="detached"||l==="failed"||l==="suspended")&&(this.setInProgress(m,!1),this.setInProgress(T,!1)),l==="attached"?this._attachResume=!0:(l==="detaching"||l==="failed")&&(this._attachResume=!1),this.state=l,this._allChannelChanges.emit(l,k),this.emit(l,k)}},p.prototype.requestState=function(l,y){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+l),this.notifyState(l,y),this.checkPendingState()},p.prototype.checkPendingState=function(){var l=this.connectionManager.state;if(!(l.sendEvents||l.forceQueueEvents)){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},p.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var l=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",l);break}case"detaching":{var l=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",l);break}default:this.checkPendingState();break}},p.prototype.startStateTimerIfNotRunning=function(){var l=this;this.stateTimer||(this.stateTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),l.stateTimer=null,l.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},p.prototype.clearStateTimer=function(){var l=this.stateTimer;l&&(clearTimeout(l),this.stateTimer=null)},p.prototype.startRetryTimer=function(){var l=this;if(!this.retryTimer){this.retryCount++;var y=this.realtime.options.timeouts.channelRetryTimeout*A.getJitterCoefficient()*A.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){l.state==="suspended"&&l.connectionManager.state.sendEvents&&(l.retryTimer=null,d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),l.requestState("attaching"))},y)}},p.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},p.prototype.setInProgress=function(l,y){this.rest.channels.setInProgress(this,l,y)},p.prototype.getReleaseErr=function(){var l=this.state;return l==="initialized"||l==="detached"||l==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+l,90001,400)},p.progressOps={statechange:m,sync:T},p}(c.default);o.default=v},function(h,o,n){"use strict";o.__esModule=!0;var s=function(){function i(S,A,c,d){this.previous=S,this.current=A,A==="attached"&&(this.resumed=c),d&&(this.reason=d)}return i}();o.default=s},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(){var i=s,S=i.lib,A=S.WordArray,c=S.Hasher,d=i.algo,b=[],E=d.SHA1=c.extend({_doReset:function(){this._hash=new A.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,a){for(var O=this._hash.words,M=O[0],w=O[1],C=O[2],m=O[3],T=O[4],u=0;u<80;u++){if(u<16)b[u]=R[a+u]|0;else{var v=b[u-3]^b[u-8]^b[u-14]^b[u-16];b[u]=v<<1|v>>>31}var f=(M<<5|M>>>27)+T+b[u];u<20?f+=(w&C|~w&m)+1518500249:u<40?f+=(w^C^m)+1859775393:u<60?f+=(w&C|w&m|C&m)-1894007588:f+=(w^C^m)-899497514,T=m,m=C,C=w<<30|w>>>2,w=M,M=f}O[0]=O[0]+M|0,O[1]=O[1]+w|0,O[2]=O[2]+C|0,O[3]=O[3]+m|0,O[4]=O[4]+T|0},_doFinalize:function(){var R=this._data,a=R.words,O=this._nDataBytes*8,M=R.sigBytes*8;return a[M>>>5]|=128<<24-M%32,a[(M+64>>>9<<4)+14]=Math.floor(O/4294967296),a[(M+64>>>9<<4)+15]=O,R.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var R=c.clone.call(this);return R._hash=this._hash.clone(),R}});i.SHA1=c._createHelper(E),i.HmacSHA1=c._createHmacHelper(E)}(),s.SHA1})},function(h,o,n){"use strict";o.__esModule=!0;function s(u){if(u===void 0)return"undefined";var v,f;if(u instanceof ArrayBuffer?(f="ArrayBuffer",v=new DataView(u)):u instanceof DataView&&(f="DataView",v=u),!v)return JSON.stringify(u);for(var p=[],l=0;l<u.byteLength;l++){if(l>20){p.push("...");break}var y=v.getUint8(l).toString(16);y.length===1&&(y="0"+y),p.push(y)}return"<"+f+" "+p.join(" ")+">"}function i(u,v,f){for(var p=0,l=f.length;p<l;p++){var y=f.charCodeAt(p);if(y<128){u.setUint8(v++,y>>>0&127|0);continue}if(y<2048){u.setUint8(v++,y>>>6&31|192),u.setUint8(v++,y>>>0&63|128);continue}if(y<65536){u.setUint8(v++,y>>>12&15|224),u.setUint8(v++,y>>>6&63|128),u.setUint8(v++,y>>>0&63|128);continue}if(y<1114112){u.setUint8(v++,y>>>18&7|240),u.setUint8(v++,y>>>12&63|128),u.setUint8(v++,y>>>6&63|128),u.setUint8(v++,y>>>0&63|128);continue}throw new Error("bad codepoint "+y)}}function S(u,v,f){for(var p="",l=v,y=v+f;l<y;l++){var P=u.getUint8(l);if((P&128)===0){p+=String.fromCharCode(P);continue}if((P&224)===192){p+=String.fromCharCode((P&15)<<6|u.getUint8(++l)&63);continue}if((P&240)===224){p+=String.fromCharCode((P&15)<<12|(u.getUint8(++l)&63)<<6|(u.getUint8(++l)&63)<<0);continue}if((P&248)===240){p+=String.fromCharCode((P&7)<<18|(u.getUint8(++l)&63)<<12|(u.getUint8(++l)&63)<<6|(u.getUint8(++l)&63)<<0);continue}throw new Error("Invalid byte "+P.toString(16))}return p}function A(u){for(var v=0,f=0,p=u.length;f<p;f++){var l=u.charCodeAt(f);if(l<128){v+=1;continue}if(l<2048){v+=2;continue}if(l<65536){v+=3;continue}if(l<1114112){v+=4;continue}throw new Error("bad codepoint "+l)}return v}function c(u,v){var f=T(u,v);if(f!==0){var p=new ArrayBuffer(f),l=new DataView(p);return m(u,l,0,v),p}}var d=(1<<16)*(1<<16),b=1/d;function E(u,v){return v=v||0,u.getInt32(v)*d+u.getUint32(v+4)}function R(u,v){return v=v||0,u.getUint32(v)*d+u.getUint32(v+4)}function a(u,v,f){f<9223372036854776e3?(u.setInt32(v,Math.floor(f*b)),u.setInt32(v+4,f&-1)):(u.setUint32(v,2147483647),u.setUint32(v+4,2147483647))}function O(u,v,f){f<18446744073709552e3?(u.setUint32(v,Math.floor(f*b)),u.setInt32(v+4,f&-1)):(u.setUint32(v,4294967295),u.setUint32(v+4,4294967295))}var M=function(){function u(v,f){var p=this;this.map=function(l){for(var y={},P=0;P<l;P++){var D=p.parse();y[D]=p.parse()}return y},this.bin=function(l){var y=new ArrayBuffer(l);return new Uint8Array(y).set(new Uint8Array(p.view.buffer,p.offset,l),0),p.offset+=l,y},this.buf=this.bin,this.str=function(l){var y=S(p.view,p.offset,l);return p.offset+=l,y},this.array=function(l){for(var y=new Array(l),P=0;P<l;P++)y[P]=p.parse();return y},this.ext=function(l){return p.offset+=l,{type:p.view.getInt8(p.offset),data:p.buf(l)}},this.parse=function(){var l=p.view.getUint8(p.offset),y,P;if((l&128)===0)return p.offset++,l;if((l&240)===128)return P=l&15,p.offset++,p.map(P);if((l&240)===144)return P=l&15,p.offset++,p.array(P);if((l&224)===160)return P=l&31,p.offset++,p.str(P);if((l&224)===224)return y=p.view.getInt8(p.offset),p.offset++,y;switch(l){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(P);case 197:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(P);case 198:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(P);case 199:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(P);case 200:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(P);case 201:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(P);case 202:return y=p.view.getFloat32(p.offset+1),p.offset+=5,y;case 203:return y=p.view.getFloat64(p.offset+1),p.offset+=9,y;case 204:return y=p.view.getUint8(p.offset+1),p.offset+=2,y;case 205:return y=p.view.getUint16(p.offset+1),p.offset+=3,y;case 206:return y=p.view.getUint32(p.offset+1),p.offset+=5,y;case 207:return y=R(p.view,p.offset+1),p.offset+=9,y;case 208:return y=p.view.getInt8(p.offset+1),p.offset+=2,y;case 209:return y=p.view.getInt16(p.offset+1),p.offset+=3,y;case 210:return y=p.view.getInt32(p.offset+1),p.offset+=5,y;case 211:return y=E(p.view,p.offset+1),p.offset+=9,y;case 212:return P=1,p.offset++,p.ext(P);case 213:return P=2,p.offset++,p.ext(P);case 214:return P=4,p.offset++,p.ext(P);case 215:return P=8,p.offset++,p.ext(P);case 216:return P=16,p.offset++,p.ext(P);case 217:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.str(P);case 218:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.str(P);case 219:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.str(P);case 220:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.array(P);case 221:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.array(P);case 222:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.map(P);case 223:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.map(P)}throw new Error("Unknown type 0x"+l.toString(16))},this.offset=f||0,this.view=v}return u}();function w(u){var v=new DataView(u),f=new M(v),p=f.parse();if(f.offset!==u.byteLength)throw new Error(u.byteLength-f.offset+" trailing bytes");return p}function C(u,v){return Object.keys(u).filter(function(f){var p=u[f],l=typeof p;return(!v||p!=null)&&(l!=="function"||!!p.toJSON)})}function m(u,v,f,p){var l=typeof u;if(typeof u=="string"){var y=A(u);if(y<32)return v.setUint8(f,y|160),i(v,f+1,u),1+y;if(y<256)return v.setUint8(f,217),v.setUint8(f+1,y),i(v,f+2,u),2+y;if(y<65536)return v.setUint8(f,218),v.setUint16(f+1,y),i(v,f+3,u),3+y;if(y<4294967296)return v.setUint8(f,219),v.setUint32(f+1,y),i(v,f+5,u),5+y}if(ArrayBuffer.isView&&ArrayBuffer.isView(u)&&(u=u.buffer),u instanceof ArrayBuffer){var P=u.byteLength;if(P<256)return v.setUint8(f,196),v.setUint8(f+1,P),new Uint8Array(v.buffer).set(new Uint8Array(u),f+2),2+P;if(P<65536)return v.setUint8(f,197),v.setUint16(f+1,P),new Uint8Array(v.buffer).set(new Uint8Array(u),f+3),3+P;if(P<4294967296)return v.setUint8(f,198),v.setUint32(f+1,P),new Uint8Array(v.buffer).set(new Uint8Array(u),f+5),5+P}if(typeof u=="number"){if(Math.floor(u)!==u)return v.setUint8(f,203),v.setFloat64(f+1,u),9;if(u>=0){if(u<128)return v.setUint8(f,u),1;if(u<256)return v.setUint8(f,204),v.setUint8(f+1,u),2;if(u<65536)return v.setUint8(f,205),v.setUint16(f+1,u),3;if(u<4294967296)return v.setUint8(f,206),v.setUint32(f+1,u),5;if(u<18446744073709552e3)return v.setUint8(f,207),O(v,f+1,u),9;throw new Error("Number too big 0x"+u.toString(16))}if(u>=-32)return v.setInt8(f,u),1;if(u>=-128)return v.setUint8(f,208),v.setInt8(f+1,u),2;if(u>=-32768)return v.setUint8(f,209),v.setInt16(f+1,u),3;if(u>=-2147483648)return v.setUint8(f,210),v.setInt32(f+1,u),5;if(u>=-9223372036854776e3)return v.setUint8(f,211),a(v,f+1,u),9;throw new Error("Number too small -0x"+(-u).toString(16).substr(1))}if(l==="undefined")return p?0:(v.setUint8(f,212),v.setUint8(f+1,0),v.setUint8(f+2,0),3);if(u===null)return p?0:(v.setUint8(f,192),1);if(l==="boolean")return v.setUint8(f,u?195:194),1;if(typeof u.toJSON=="function")return m(u.toJSON(),v,f,p);if(l==="object"){var D,k=0,H=void 0,U=Array.isArray(u);if(U?D=u.length:(H=C(u,p),D=H.length),D<16?(v.setUint8(f,D|(U?144:128)),k=1):D<65536?(v.setUint8(f,U?220:222),v.setUint16(f+1,D),k=3):D<4294967296&&(v.setUint8(f,U?221:223),v.setUint32(f+1,D),k=5),U)for(var _=0;_<D;_++)k+=m(u[_],v,f+k,p);else if(H)for(var _=0;_<D;_++){var x=H[_];k+=m(x,v,f+k),k+=m(u[x],v,f+k,p)}return k}if(l==="function")return 0;throw new Error("Unknown type "+l)}function T(u,v){var f=typeof u;if(f==="string"){var p=A(u);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(u)&&(u=u.buffer),u instanceof ArrayBuffer){var l=u.byteLength;if(l<256)return 2+l;if(l<65536)return 3+l;if(l<4294967296)return 5+l}if(typeof u=="number"){if(Math.floor(u)!==u)return 9;if(u>=0){if(u<128)return 1;if(u<256)return 2;if(u<65536)return 3;if(u<4294967296)return 5;if(u<18446744073709552e3)return 9;throw new Error("Number too big 0x"+u.toString(16))}if(u>=-32)return 1;if(u>=-128)return 2;if(u>=-32768)return 3;if(u>=-2147483648)return 5;if(u>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+u.toString(16).substr(1))}if(f==="boolean")return 1;if(u===null)return v?0:1;if(u===void 0)return v?0:3;if(typeof u.toJSON=="function")return T(u.toJSON(),v);if(f==="object"){var y,P=0;if(Array.isArray(u)){y=u.length;for(var D=0;D<y;D++)P+=T(u[D],v)}else{var k=C(u,v);y=k.length;for(var D=0;D<y;D++){var H=k[D];P+=T(H)+T(u[H],v)}}if(y<16)return 1+P;if(y<65536)return 3+P;if(y<4294967296)return 5+P;throw new Error("Array or object too long 0x"+y.toString(16))}if(f==="function")return 0;throw new Error("Unknown type "+f)}o.default={encode:c,decode:w,inspect:s,utf8Write:i,utf8Read:S,utf8ByteCount:A}},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(30)),S=s.__importDefault(n(49)),A=s.__importDefault(n(0)),c=s.__importDefault(n(55)),d=s.__importDefault(n(57)),b=s.__importDefault(n(62)),E=s.__importDefault(n(63)),R=s.__importDefault(n(67)),a=s.__importDefault(n(3)),O=n(8),M=s.__importDefault(n(25)),w=s.__importDefault(n(64)),C=s.__importDefault(n(65)),m=s.__importDefault(n(40)),T=s.__importDefault(n(9)),u=s.__importDefault(n(14));A.default.Crypto=d.default,A.default.BufferUtils=c.default,A.default.Http=b.default,A.default.Config=E.default,A.default.Transports=R.default,A.default.WebStorage=w.default,i.default.Crypto=d.default,S.default.Crypto=d.default,i.default.Message=T.default,S.default.Message=T.default,i.default.PresenceMessage=u.default,S.default.PresenceMessage=u.default,S.default.ConnectionManager=M.default,a.default.initLogHandlers(),A.default.Defaults=O.getDefaults(C.default),A.default.Config.agent&&(A.default.Defaults.agent+=" "+A.default.Config.agent),A.default.Config.noUpgrade&&(A.default.Defaults.upgradeTransports=[]),o.default={Rest:i.default,Realtime:S.default,msgpack:m.default}},function(h){h.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(31),n(23))})(this,function(s){return s.HmacSHA256})},function(h,o){},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(46)),A=s.__importDefault(n(24)),c=s.__importDefault(n(18)),d=s.__importDefault(n(5)),b=s.__importDefault(n(47)),E=function(){},R=function(){function w(C){this.rest=C,this.admin=new a(C)}return w}(),a=function(){function w(C){this.rest=C,this.deviceRegistrations=new O(C),this.channelSubscriptions=new M(C)}return w.prototype.publish=function(C,m,T){var u=this.rest,v=u.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(v),p={},l=i.mixin({recipient:C},m);if(typeof T!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);T=E}u.options.headers&&i.mixin(f,u.options.headers),u.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var y=i.encodeBody(l,v);A.default.post(u,"/push/publish",y,f,p,null,function(P){return T(P)})},w}(),O=function(){function w(C){this.rest=C}return w.prototype.save=function(C,m){var T=this.rest,u=S.default.fromValues(C),v=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(v),p={};if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);m=E}T.options.headers&&i.mixin(f,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var l=i.encodeBody(u,v);A.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(C.id),l,f,p,null,function(y,P,D,k){m(y,y?void 0:S.default.fromResponseBody(P,k?void 0:v))})},w.prototype.get=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(u),f=C.id||C;if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);m=E}if(typeof f!="string"||!f.length){m(new d.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(v,T.options.headers),A.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(f),v,{},null,function(p,l,y,P){m(p,p?void 0:S.default.fromResponseBody(l,P?void 0:u))})},w.prototype.list=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:u,f=i.defaultGetHeaders(u);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);m=E}T.options.headers&&i.mixin(f,T.options.headers),new c.default(T,"/push/deviceRegistrations",f,v,function(p,l,y){return S.default.fromResponseBody(p,y?void 0:u)}).get(C,m)},w.prototype.remove=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(u),f={},p=C.id||C;if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);m=E}if(typeof p!="string"||!p.length){m(new d.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(f,{fullWait:"true"}),A.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(p),v,f,null,function(l){return m(l)})},w.prototype.removeWhere=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(u);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);m=E}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(C,{fullWait:"true"}),A.default.delete(T,"/push/deviceRegistrations",v,C,null,function(f){return m(f)})},w}(),M=function(){function w(C){this.remove=w.prototype.removeWhere,this.rest=C}return w.prototype.save=function(C,m){var T=this.rest,u=b.default.fromValues(C),v=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,f=i.defaultPostHeaders(v),p={};if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);m=E}T.options.headers&&i.mixin(f,T.options.headers),T.options.pushFullWait&&i.mixin(p,{fullWait:"true"});var l=i.encodeBody(u,v);A.default.post(T,"/push/channelSubscriptions",l,f,p,null,function(y,P,D,k){m(y,!y&&b.default.fromResponseBody(P,k?void 0:v))})},w.prototype.list=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:u,f=i.defaultGetHeaders(u);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);m=E}T.options.headers&&i.mixin(f,T.options.headers),new c.default(T,"/push/channelSubscriptions",f,v,function(p,l,y){return b.default.fromResponseBody(p,y?void 0:u)}).get(C,m)},w.prototype.removeWhere=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=i.defaultGetHeaders(u);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);m=E}T.options.headers&&i.mixin(v,T.options.headers),T.options.pushFullWait&&i.mixin(C,{fullWait:"true"}),A.default.delete(T,"/push/channelSubscriptions",v,C,null,function(f){return m(f)})},w.prototype.listChannels=function(C,m){var T=this.rest,u=T.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:u,f=i.defaultGetHeaders(u);if(typeof m!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);m=E}T.options.headers&&i.mixin(f,T.options.headers),T.options.pushFullWait&&i.mixin(C,{fullWait:"true"}),new c.default(T,"/push/channels",f,v,function(p,l,y){for(var P=!y&&u?i.decodeBody(p,u):p,D=0;D<P.length;D++)P[D]=String(P[D]);return P}).get(C,m)},w}();o.default=R},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(5)),A;(function(b){b.Phone="phone",b.Tablet="tablet",b.Desktop="desktop",b.TV="tv",b.Watch="watch",b.Car="car",b.Embedded="embedded",b.Other="other"})(A||(A={}));var c;(function(b){b.Android="android",b.IOS="ios",b.Browser="browser"})(c||(c={}));var d=function(){function b(){}return b.prototype.toJSON=function(){var E,R,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(E=this.push)===null||E===void 0?void 0:E.recipient,state:(R=this.push)===null||R===void 0?void 0:R.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},b.prototype.toString=function(){var E,R,a,O,M="[DeviceDetails";return this.id&&(M+="; id="+this.id),this.platform&&(M+="; platform="+this.platform),this.formFactor&&(M+="; formFactor="+this.formFactor),this.clientId&&(M+="; clientId="+this.clientId),this.metadata&&(M+="; metadata="+this.metadata),this.deviceIdentityToken&&(M+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((E=this.push)===null||E===void 0)&&E.recipient&&(M+="; push.recipient="+JSON.stringify(this.push.recipient)),!((R=this.push)===null||R===void 0)&&R.state&&(M+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(M+="; push.error="+JSON.stringify(this.push.error)),!((O=this.push)===null||O===void 0)&&O.metadata&&(M+="; push.metadata="+this.push.metadata),M+="]",M},b.fromResponseBody=function(E,R){return R&&(E=i.decodeBody(E,R)),i.isArray(E)?b.fromValuesArray(E):b.fromValues(E)},b.fromValues=function(E){return E.error=E.error&&S.default.fromValues(E.error),Object.assign(new b,E)},b.fromValuesArray=function(E){for(var R=E.length,a=new Array(R),O=0;O<R;O++)a[O]=b.fromValues(E[O]);return a},b.toRequestBody=i.encodeBody,b}();o.default=d},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=function(){function A(){}return A.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},A.prototype.toString=function(){var c="[PushChannelSubscription";return this.channel&&(c+="; channel="+this.channel),this.deviceId&&(c+="; deviceId="+this.deviceId),this.clientId&&(c+="; clientId="+this.clientId),c+="]",c},A.fromResponseBody=function(c,d){return d&&(c=i.decodeBody(c,d)),i.isArray(c)?A.fromValuesArray(c):A.fromValues(c)},A.fromValues=function(c){return Object.assign(new A,c)},A.fromValuesArray=function(c){for(var d=c.length,b=new Array(d),E=0;E<d;E++)b[E]=A.fromValues(c[E]);return b},A.toRequestBody=i.encodeBody,A}();o.default=S},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=function(){function T(u){this.count=u&&u.count||0,this.data=u&&u.data||0,this.uncompressedData=u&&u.uncompressedData||0,this.failed=u&&u.failed||0,this.refused=u&&u.refused||0}return T}(),A=function(T){s.__extends(u,T);function u(v){var f=T.call(this,v)||this;return v&&v.category&&(f.category={},i.forInOwnNonNullProperties(v.category,function(p){f.category[p]=new S(v.category[p])})),f}return u}(S),c=function(){function T(u){this.peak=u&&u.peak||0,this.min=u&&u.min||0,this.mean=u&&u.mean||0,this.opened=u&&u.opened||0,this.refused=u&&u.refused||0}return T}(),d=function(){function T(u){this.succeeded=u&&u.succeeded||0,this.failed=u&&u.failed||0,this.refused=u&&u.refused||0}return T}(),b=function(){function T(u){this.plain=new c(u&&u.plain),this.tls=new c(u&&u.tls),this.all=new c(u&&u.all)}return T}(),E=function(){function T(u){this.messages=new A(u&&u.messages),this.presence=new A(u&&u.presence),this.all=new A(u&&u.all)}return T}(),R=function(){function T(u){this.realtime=new E(u&&u.realtime),this.rest=new E(u&&u.rest),this.webhook=new E(u&&u.webhook),this.sharedQueue=new E(u&&u.sharedQueue),this.externalQueue=new E(u&&u.externalQueue),this.httpEvent=new E(u&&u.httpEvent),this.push=new E(u&&u.push),this.all=new E(u&&u.all)}return T}(),a=function(){function T(u){this.all=new E(u&&u.all),this.inbound=new R(u&&u.inbound),this.outbound=new R(u&&u.outbound)}return T}(),O=function(){function T(u){this.all=new E(u&&u.all),this.producerPaid=new a(u&&u.producerPaid),this.consumerPaid=new a(u&&u.consumerPaid)}return T}(),M=function(){function T(u){this.messages=u&&u.messages||0;var v=u&&u.notifications;this.notifications={invalid:v&&v.invalid||0,attempted:v&&v.attempted||0,successful:v&&v.successful||0,failed:v&&v.failed||0},this.directPublishes=u&&u.directPublishes||0}return T}(),w=function(){function T(u){this.succeeded=u&&u.succeeded||0,this.skipped=u&&u.skipped||0,this.failed=u&&u.failed||0}return T}(),C=function(){function T(u){var v=this;this.delta=void 0,u&&u.delta&&(this.delta={},i.forInOwnNonNullProperties(u.delta,function(f){v.delta[f]=new w(u.delta[f])}))}return T}(),m=function(T){s.__extends(u,T);function u(v){var f=T.call(this,v)||this;return f.persisted=new E(v&&v.persisted),f.connections=new b(v&&v.connections),f.channels=new c(v&&v.channels),f.apiRequests=new d(v&&v.apiRequests),f.tokenRequests=new d(v&&v.tokenRequests),f.xchgProducer=new O(v&&v.xchgProducer),f.xchgConsumer=new O(v&&v.xchgConsumer),f.push=new M(v&&v.pushStats),f.processed=new C(v&&v.processed),f.inProgress=v&&v.inProgress||void 0,f.unit=v&&v.unit||void 0,f.intervalId=v&&v.intervalId||void 0,f}return u.fromValues=function(v){return new u(v)},u}(a);o.default=m},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(30)),A=s.__importDefault(n(7)),c=s.__importDefault(n(3)),d=s.__importDefault(n(50)),b=s.__importDefault(n(37)),E=s.__importDefault(n(8)),R=s.__importDefault(n(5)),a=s.__importDefault(n(10)),O=s.__importDefault(n(25)),M=s.__importDefault(n(0)),w=s.__importDefault(n(9)),C=function(T){s.__extends(u,T);function u(v){var f=T.call(this,v)||this;return c.default.logAction(c.default.LOG_MINOR,"Realtime()",""),f.connection=new d.default(f,f.options),f.channels=new m(f),v.autoConnect!==!1&&f.connect(),f}return u.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},u.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},u.Promise=function(v){return v=E.default.objectifyOptions(v),v.promises=!0,new u(v)},u.Callbacks=u,u.Utils=i,u.ConnectionManager=O.default,u.Platform=M.default,u.ProtocolMessage=a.default,u.Message=w.default,u}(S.default),m=function(T){s.__extends(u,T);function u(v){var f=T.call(this)||this;return f.realtime=v,f.all={},f.inProgress={},v.connection.connectionManager.on("transport.active",function(){f.onTransportActive()}),f}return u.prototype.onChannelMessage=function(v){var f=v.channel;if(f===void 0){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+v.action);return}var p=this.all[f];if(!p){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+f);return}p.onMessage(v)},u.prototype.onTransportActive=function(){for(var v in this.all){var f=this.all[v];f.state==="attaching"||f.state==="detaching"?f.checkPendingState():f.state==="suspended"&&f.attach()}},u.prototype.reattach=function(v){for(var f in this.all){var p=this.all[f];p.state==="attached"&&p.requestState("attaching",v)}},u.prototype.resetAttachedMsgIndicators=function(){for(var v in this.all){var f=this.all[v];f.state==="attached"&&(f._attachedMsgIndicator=!1)}},u.prototype.checkAttachedMsgIndicators=function(v){for(var f in this.all){var p=this.all[f];if(p.state==="attached"&&p._attachedMsgIndicator===!1){var l="30s after a resume, found channel which has not received an attached; channelId = "+f+"; connectionId = "+v;c.default.logAction(c.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",l),p.requestState("attaching")}}},u.prototype.propogateConnectionInterruption=function(v,f){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},l=["attaching","attached","detaching","suspended"],y=p[v];for(var P in this.all){var D=this.all[P];i.arrIn(l,D.state)&&D.notifyState(y,f)}},u.prototype.get=function(v,f){v=String(v);var p=this.all[v];if(!p)p=this.all[v]=new b.default(this.realtime,v,f);else if(f){if(p._shouldReattachToSetOptions(f))throw new R.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(f)}return p},u.prototype.release=function(v){v=String(v);var f=this.all[v];if(!!f){var p=f.getReleaseErr();if(p)throw p;delete this.all[v],delete this.inProgress[v]}},u.prototype.setInProgress=function(v,f,p){this.inProgress[v.name]=this.inProgress[v.name]||{},this.inProgress[v.name][f]=p,!p&&this.hasNopending()&&this.emit("nopending")},u.prototype.onceNopending=function(v){if(this.hasNopending()){v();return}this.once("nopending",v)},u.prototype.hasNopending=function(){return i.arrEvery(i.valuesArray(this.inProgress,!0),function(v){return!i.containsValue(v,!0)})},u}(A.default);o.default=C},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(7)),A=s.__importDefault(n(25)),c=s.__importDefault(n(3)),d=s.__importDefault(n(36)),b=s.__importDefault(n(0));function E(){}var R=function(a){s.__extends(O,a);function O(M,w){var C=a.call(this)||this;return C.whenState=function(m,T){return S.default.prototype.whenState.call(C,m,C.state,T,new d.default(void 0,m))},C.ably=M,C.connectionManager=new A.default(M,w),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.serial=void 0,C.timeSerial=void 0,C.recoveryKey=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(m){var T=C.state=m.current;b.default.Config.nextTick(function(){C.emit(T,m)})}),C.connectionManager.on("update",function(m){b.default.Config.nextTick(function(){C.emit("update",m)})}),C}return O.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},O.prototype.ping=function(M){if(c.default.logAction(c.default.LOG_MINOR,"Connection.ping()",""),!M){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);M=E}this.connectionManager.ping(null,M)},O.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},O}(S.default);o.default=R},function(h,o,n){"use strict";o.__esModule=!0,o.PendingMessage=void 0;var s=n(1),i=s.__importDefault(n(10)),S=s.__importStar(n(2)),A=s.__importDefault(n(7)),c=s.__importDefault(n(3)),d=s.__importDefault(n(35)),b=s.__importDefault(n(5)),E=i.default.Action,R=function(){function O(M,w){this.message=M,this.callback=w,this.merged=!1;var C=M.action;this.sendAttempted=!1,this.ackRequired=C==E.MESSAGE||C==E.PRESENCE}return O}();o.PendingMessage=R;var a=function(O){s.__extends(M,O);function M(w){var C=O.call(this)||this;return C.transport=w,C.messageQueue=new d.default,w.on("ack",function(m,T){C.onAck(m,T)}),w.on("nack",function(m,T,u){C.onNack(m,T,u)}),C}return M.prototype.onAck=function(w,C){c.default.logAction(c.default.LOG_MICRO,"Protocol.onAck()","serial = "+w+"; count = "+C),this.messageQueue.completeMessages(w,C)},M.prototype.onNack=function(w,C,m){c.default.logAction(c.default.LOG_ERROR,"Protocol.onNack()","serial = "+w+"; count = "+C+"; err = "+S.inspectError(m)),m||(m=new b.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(w,C,m)},M.prototype.onceIdle=function(w){var C=this.messageQueue;if(C.count()===0){w();return}C.once("idle",w)},M.prototype.send=function(w){w.ackRequired&&this.messageQueue.push(w),c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(w.message)),w.sendAttempted=!0,this.transport.send(w.message)},M.prototype.getTransport=function(){return this.transport},M.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},M.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},M.prototype.finish=function(){var w=this.transport;this.onceIdle(function(){w.disconnect()})},M}(A.default);o.default=a},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(0)),S=s.__importStar(n(2)),A=s.__importDefault(n(26)),c=s.__importDefault(n(8)),d=s.__importDefault(n(3)),b=s.__importDefault(n(10)),E=s.__importDefault(n(5)),R="web_socket";function a(w){return!!w.on}var O=function(w){s.__extends(C,w);function C(m,T,u){var v=w.call(this,m,T,u)||this;return v.shortName=R,u.heartbeats=i.default.Config.useProtocolHeartbeats,v.wsHost=c.default.getHost(u.options,u.host,!0),v}return C.isAvailable=function(){return!!i.default.Config.WebSocket},C.prototype.createWebSocket=function(m,T){var u=0;if(T)for(var v in T)m+=(u++?"&":"?")+v+"="+T[v];return this.uri=m,new i.default.Config.WebSocket(m)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),A.default.prototype.connect.call(this);var m=this,T=this.params,u=T.options,v=u.tls?"wss://":"ws://",f=v+this.wsHost+":"+c.default.getPort(u)+"/";d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+f),this.auth.getAuthParams(function(p,l){if(!m.isDisposed){var y="";for(var P in l)y+=" "+P+": "+l[P]+";";if(d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+y+" err: "+p),p){m.disconnect(p);return}var D=T.getConnectParams(l);try{var k=m.wsConnection=m.createWebSocket(f,D);k.binaryType=i.default.Config.binaryType,k.onopen=function(){m.onWsOpen()},k.onclose=function(H){m.onWsClose(H)},k.onmessage=function(H){m.onWsData(H.data)},k.onerror=function(H){m.onWsError(H)},a(k)&&k.on("ping",function(){m.onActivity()})}catch(H){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),m.disconnect(H)}}})},C.prototype.send=function(m){var T=this.wsConnection;if(!T){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(b.default.serialize(m,this.params.format))}catch(v){var u="Exception from ws connection when trying to send: "+S.inspectError(v);d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()",u),this.finish("disconnected",new E.default(u,5e4,500))}},C.prototype.onWsData=function(m){d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(b.default.deserialize(m,this.format))}catch(T){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},C.prototype.onWsOpen=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(m){var T,u;if(typeof m=="object"?(u=m.code,T=m.wasClean||u===1e3):(u=m,T=u==1e3),delete this.wsConnection,T){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var v=new E.default("Websocket closed",80003,400);this.finish("disconnected",v)}else{var f="Unclean disconnection of WebSocket ; code = "+u,v=new E.default(f,80003,400);d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()",f),this.finish("disconnected",v)}this.emit("disposed")},C.prototype.onWsError=function(m){var T=this;d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),i.default.Config.nextTick(function(){T.disconnect(Error(m.message))})},C.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},C}(A.default);function M(w){return O.isAvailable()&&(w.supportedTransports[R]=O),O}o.default=M},function(h,o,n){"use strict";o.__esModule=!0,o.isSuccessCode=void 0;var s;(function(S){S[S.Success=200]="Success",S[S.NoContent=204]="NoContent",S[S.BadRequest=400]="BadRequest",S[S.Unauthorized=401]="Unauthorized",S[S.Forbidden=403]="Forbidden",S[S.RequestTimeout=408]="RequestTimeout",S[S.InternalServerError=500]="InternalServerError"})(s||(s={}));function i(S){return S>=s.Success&&S<s.BadRequest}o.isSuccessCode=i,o.default=s},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importStar(n(2)),S=s.__importDefault(n(34)),A=s.__importDefault(n(7)),c=s.__importDefault(n(3)),d=s.__importDefault(n(14)),b=s.__importDefault(n(5)),E=s.__importDefault(n(37)),R=s.__importDefault(n(22)),a=s.__importDefault(n(38)),O=function(){};function M(f){return f.clientId+":"+f.connectionId}function w(f){return f.channel.realtime.auth.clientId}function C(f){var p=f.channel.realtime,l=p.auth.clientId;return(!l||l==="*")&&p.connection.state==="connected"}function m(f,p,l){switch(f.state){case"attached":case"suspended":l();break;case"initialized":case"detached":case"detaching":case"attaching":f.attach(function(y){y?p(y):l()});break;default:p(b.default.fromValues(E.default.invalidStateError(f.state)))}}function T(f,p){if(f.isSynthesized()||p.isSynthesized())return f.timestamp>p.timestamp;var l=f.parseId(),y=p.parseId();return l.msgSerial===y.msgSerial?l.index>y.index:l.msgSerial>y.msgSerial}var u=function(f){s.__extends(p,f);function p(l){var y=f.call(this,l)||this;return y.channel=l,y.syncComplete=!1,y.members=new v(y),y._myMembers=new v(y),y.subscriptions=new A.default,y.pendingPresence=[],y}return p.prototype.enter=function(l,y){if(C(this))throw new b.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,l,"enter",y)},p.prototype.update=function(l,y){if(C(this))throw new b.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,l,"update",y)},p.prototype.enterClient=function(l,y,P){return this._enterOrUpdateClient(l,y,"enter",P)},p.prototype.updateClient=function(l,y,P){return this._enterOrUpdateClient(l,y,"update",P)},p.prototype._enterOrUpdateClient=function(l,y,P,D){var k=this;if(!D)if(typeof y=="function")D=y,y=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[l,y,P]);D=O}var H=this.channel;if(!H.connectionManager.activeState()){D(H.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence."+P+"Client()","channel = "+H.name+", client = "+(l||"(implicit) "+w(this)));var U=d.default.fromValues({action:P,data:y});l&&(U.clientId=l),d.default.encode(U,H.channelOptions,function(_){if(_){D(_);return}switch(H.state){case"attached":H.sendPresence(U,D);break;case"initialized":case"detached":H.attach();case"attaching":k.pendingPresence.push({presence:U,callback:D});break;default:_=new b.default("Unable to "+P+" presence channel while in "+H.state+" state",90001),_.code=90001,D(_)}})},p.prototype.leave=function(l,y){if(C(this))throw new b.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,l,y)},p.prototype.leaveClient=function(l,y,P){if(!P)if(typeof y=="function")P=y,y=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[l,y]);P=O}var D=this.channel;if(!D.connectionManager.activeState()){P==null||P(D.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+l);var k=d.default.fromValues({action:"leave",data:y});switch(l&&(k.clientId=l),D.state){case"attached":D.sendPresence(k,P);break;case"attaching":this.pendingPresence.push({presence:k,callback:P});break;case"initialized":case"failed":{var H=new b.default("Unable to leave presence channel (incompatible state)",90001);P==null||P(H);break}default:P==null||P(E.default.invalidStateError(D.state))}},p.prototype.get=function(l,y){var P=this,D=Array.prototype.slice.call(arguments);D.length==1&&typeof D[0]=="function"&&D.unshift(null),l=D[0],y=D[1];var k=!l||("waitForSync"in l?l.waitForSync:!0);if(!y){if(this.channel.realtime.options.promises)return i.promisify(this,"get",D);y=O}function H(U){y(null,l?U.list(l):U.values())}if(this.channel.state==="suspended"){k?y(b.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}m(this.channel,y,function(){var U=P.members;k?U.waitSync(function(){H(U)}):H(U)})},p.prototype.history=function(l,y){if(c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),y===void 0)if(typeof l=="function")y=l,l=null;else{if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);y=O}l&&l.untilAttach&&(this.channel.state==="attached"?(delete l.untilAttach,l.from_serial=this.channel.properties.attachSerial):y(new b.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),S.default.prototype._history.call(this,l,y)},p.prototype.setPresence=function(l,y,P){c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+l.length+" participants; syncChannelSerial = "+P);var D,k,H=this.members,U=this._myMembers,_=[],x=this.channel.connectionManager.connectionId;y&&(this.members.startSync(),P&&(k=P.match(/^[\w-]+:(.*)$/))&&(D=k[1]));for(var z=0;z<l.length;z++){var W=d.default.fromValues(l[z]);switch(W.action){case"leave":H.remove(W)&&_.push(W),W.connectionId===x&&!W.isSynthesized()&&U.remove(W);break;case"enter":case"present":case"update":H.put(W)&&_.push(W),W.connectionId===x&&U.put(W);break}}y&&!D&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(E.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<_.length;z++){var W=_[z];this.subscriptions.emit(W.action,W)}},p.prototype.onAttached=function(l){c.default.logAction(c.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+l),l?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var y=this.pendingPresence,P=y.length;if(P){this.pendingPresence=[];var D=[],k=R.default.create();c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+P+" queued presence messages");for(var H=0;H<P;H++){var U=y[H];D.push(U.presence),k.push(U.callback)}this.channel.sendPresence(D,k)}},p.prototype.actOnChannelState=function(l,y,P){switch(l){case"attached":this.onAttached(y);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(P);break}},p.prototype.failPendingPresence=function(l){if(this.pendingPresence.length){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(l));for(var y=0;y<this.pendingPresence.length;y++)try{this.pendingPresence[y].callback(l)}catch(P){}this.pendingPresence=[]}},p.prototype._clearMyMembers=function(){this._myMembers.clear()},p.prototype._ensureMyMembersPresent=function(){var l=this,y=this.members,P=this._myMembers,D=function(U){if(U){var _="Presence auto-re-enter failed: "+U.toString(),x=new b.default(_,91004,400);c.default.logAction(c.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",_);var z=new a.default(l.channel.state,l.channel.state,!0,x);l.channel.emit("update",z)}};for(var k in P.map)if(!(k in y.map)){var H=P.map[k];c.default.logAction(c.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",D),delete P.map[k]}},p.prototype._synthesizeLeaves=function(l){var y=this.subscriptions;i.arrForEach(l,function(P){var D=d.default.fromValues({action:"leave",connectionId:P.connectionId,clientId:P.clientId,data:P.data,encoding:P.encoding,timestamp:i.now()});y.emit("leave",D)})},p.prototype.on=function(){for(var l=[],y=0;y<arguments.length;y++)l[y]=arguments[y];c.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,l)},p.prototype.off=function(){for(var l=[],y=0;y<arguments.length;y++)l[y]=arguments[y];c.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,l)},p.prototype.subscribe=function(){for(var l=[],y=0;y<arguments.length;y++)l[y]=arguments[y];var P=E.default.processListenerArgs(l),D=P[0],k=P[1],H=P[2],U=this.channel;if(!H){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[D,k]);H=O}if(U.state==="failed"){H(b.default.fromValues(E.default.invalidStateError("failed")));return}this.subscriptions.on(D,k),U.attach(H)},p.prototype.unsubscribe=function(){for(var l=[],y=0;y<arguments.length;y++)l[y]=arguments[y];var P=E.default.processListenerArgs(l),D=P[0],k=P[1];this.subscriptions.off(D,k)},p}(S.default),v=function(f){s.__extends(p,f);function p(l){var y=f.call(this)||this;return y.presence=l,y.map={},y.syncInProgress=!1,y.residualMembers=null,y}return p.prototype.get=function(l){return this.map[l]},p.prototype.getClient=function(l){var y=this.map,P=[];for(var D in y){var k=y[D];k.clientId==l&&k.action!="absent"&&P.push(k)}return P},p.prototype.list=function(l){var y=this.map,P=l&&l.clientId,D=l&&l.connectionId,k=[];for(var H in y){var U=y[H];U.action!=="absent"&&(P&&P!=U.clientId||D&&D!=U.connectionId||k.push(U))}return k},p.prototype.put=function(l){(l.action==="enter"||l.action==="update")&&(l=d.default.fromValues(l),l.action="present");var y=this.map,P=M(l);this.residualMembers&&delete this.residualMembers[P];var D=y[P];return D&&!T(l,D)?!1:(y[P]=l,!0)},p.prototype.values=function(){var l=this.map,y=[];for(var P in l){var D=l[P];D.action!="absent"&&y.push(D)}return y},p.prototype.remove=function(l){var y=this.map,P=M(l),D=y[P];return D&&!T(l,D)?!1:(this.syncInProgress?(l=d.default.fromValues(l),l.action="absent",y[P]=l):delete y[P],!0)},p.prototype.startSync=function(){var l=this.map,y=this.syncInProgress;c.default.logAction(c.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),this.syncInProgress||(this.residualMembers=i.copy(l),this.setInProgress(!0))},p.prototype.endSync=function(){var l=this.map,y=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),y){for(var P in l){var D=l[P];D.action==="absent"&&delete l[P]}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var k in this.residualMembers)delete l[k];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},p.prototype.waitSync=function(l){var y=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+y),!y){l();return}this.once("sync",l)},p.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},p.prototype.setInProgress=function(l){c.default.logAction(c.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+l),this.syncInProgress=l,this.presence.syncComplete=!l},p}(A.default);o.default=u},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=n(56),S=n(32),A=n(13),c=s.__importDefault(n(4)),d=s.__importDefault(n(0)),b=function(){function E(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return E.prototype.isWordArray=function(R){return R!=null&&R.sigBytes!==void 0},E.prototype.isArrayBuffer=function(R){return R!=null&&R.constructor===ArrayBuffer},E.prototype.isTypedArray=function(R){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(R)},E.prototype.uint8ViewToBase64=function(R){for(var a="",O=this.base64CharSet,M=R.byteLength,w=M%3,C=M-w,m,T,u,v,f,p=0;p<C;p=p+3)f=R[p]<<16|R[p+1]<<8|R[p+2],m=(f&16515072)>>18,T=(f&258048)>>12,u=(f&4032)>>6,v=f&63,a+=O[m]+O[T]+O[u]+O[v];return w==1?(f=R[C],m=(f&252)>>2,T=(f&3)<<4,a+=O[m]+O[T]+"=="):w==2&&(f=R[C]<<8|R[C+1],m=(f&64512)>>10,T=(f&1008)>>4,u=(f&15)<<2,a+=O[m]+O[T]+O[u]+"="),a},E.prototype.base64ToArrayBuffer=function(R){for(var a=atob==null?void 0:atob(R),O=a.length,M=new Uint8Array(O),w=0;w<O;w++){var C=a.charCodeAt(w);M[w]=C}return M.buffer},E.prototype.isBuffer=function(R){return this.isArrayBuffer(R)||this.isWordArray(R)||this.isTypedArray(R)},E.prototype.toBuffer=function(R){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(R))return new Uint8Array(R);if(this.isTypedArray(R))return new Uint8Array(R.buffer);if(this.isWordArray(R)){for(var a=new ArrayBuffer(R.sigBytes),O=new Uint8Array(a),M=0;M<R.sigBytes;M++)O[M]=R.words[M>>>2]>>>24-M%4*8&255;return O}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},E.prototype.toArrayBuffer=function(R){return this.isArrayBuffer(R)?R:this.toBuffer(R).buffer},E.prototype.toWordArray=function(R){return this.isTypedArray(R)&&(R=R.buffer),this.isWordArray(R)?R:c.default.create(R)},E.prototype.base64Encode=function(R){return this.isWordArray(R)?A.stringify(R):this.uint8ViewToBase64(this.toBuffer(R))},E.prototype.base64Decode=function(R){return ArrayBuffer&&d.default.Config.atob?this.base64ToArrayBuffer(R):A.parse(R)},E.prototype.hexEncode=function(R){return i.stringify(this.toWordArray(R))},E.prototype.hexDecode=function(R){var a=i.parse(R);return ArrayBuffer?this.toArrayBuffer(a):a},E.prototype.utf8Encode=function(R){return TextEncoder?new TextEncoder().encode(R).buffer:S.parse(R)},E.prototype.utf8Decode=function(R){if(!this.isBuffer(R))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(R)?new TextDecoder().decode(R):(R=this.toWordArray(R),S.stringify(R))},E.prototype.bufferCompare=function(R,a){if(!R)return-1;if(!a)return 1;var O=this.toWordArray(R),M=this.toWordArray(a);O.clamp(),M.clamp();var w=O.sigBytes-M.sigBytes;if(w!=0)return w;for(var C=O.words,m=M.words,T=0;T<C.length;T++)if(w=C[T]-m[T],w!=0)return w;return 0},E.prototype.byteLength=function(R){return this.isArrayBuffer(R)||this.isTypedArray(R)?R.byteLength:this.isWordArray(R)?R.sigBytes:-1},E.prototype.typedArrayToBuffer=function(R){return R.buffer},E}();o.default=new b},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return s.enc.Hex})},function(h,o,n){"use strict";n.r(o);var s=n(4),i=n.n(s),S=n(13),A=n.n(S),c=n(21),d=n.n(c),b=n(0),E=n.n(b),R=n(3),a=n.n(R),O=function(){var M="aes",w=256,C="cbc",m=16,T=4,u=4294967296,v=2147483648,f;if(E.a.getRandomWordArray)f=E.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&E.a.getRandomValues){var p=new Uint32Array(T);f=function(_,x){var z=_/4,W=z==T?p:new Uint32Array(z);E.a.getRandomValues(W,function(J){x(J,E.a.BufferUtils.toWordArray(W))})}}else f=function(_,x){a.a.logAction(a.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=_/4,W=new Array(z),J=0;J<z;J++)W[J]=Math.floor(Math.random()*u)-v;x(null,i.a.create(W))};function l(_){return _+m&-m}function y(_){if(_.algorithm==="aes"&&_.mode==="cbc"){if(_.keyLength===128||_.keyLength===256)return;throw new Error("Unsupported key length "+_.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function P(_){return _.replace("_","/").replace("-","+")}var D=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function k(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}k.CipherParams=H,k.getDefaultParams=function(_){var x;if(typeof _=="function"||typeof _=="string"){if(a.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof _=="function")k.generateRandomKey(function(W){_(null,k.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,k.getDefaultParams({key:_}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!_.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof _.key=="string"?x=Object(S.parse)(P(_.key)):x=E.a.BufferUtils.toWordArray(_.key);var z=new H;if(z.key=x,z.algorithm=_.algorithm||M,z.keyLength=x.words.length*(4*8),z.mode=_.mode||C,_.keyLength&&_.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+_.keyLength+" was specified, but the key actually has length "+z.keyLength);return y(z),z},k.generateRandomKey=function(_,x){arguments.length==1&&typeof _=="function"&&(x=_,_=void 0),f((_||w)/8,x)},k.getCipher=function(_){var x=_ instanceof H?_:k.getDefaultParams(_);return{cipherParams:x,cipher:new U(x,T,_.iv)}};function U(_,x,z){this.algorithm=_.algorithm+"-"+String(_.keyLength)+"-"+_.mode,this.cjsAlgorithm=_.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=E.a.BufferUtils.toWordArray(_.key),z&&(this.iv=E.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=x}return U.prototype.encrypt=function(_,x){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.encrypt()",""),_=E.a.BufferUtils.toWordArray(_);var z=_.sigBytes,W=l(z),J=this,Z=function(){J.getIv(function(Q,G){if(Q){x(Q);return}var N=J.encryptCipher.process(_.concat(D[W-z])),B=G.concat(N);x(null,B)})};this.encryptCipher?Z():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),Z()):f(m,function(Q,G){if(Q){x(Q);return}J.encryptCipher=d.a.algo[J.cjsAlgorithm].createEncryptor(J.key,{iv:G}),J.iv=G,Z()})},U.prototype.decrypt=function(_){a.a.logAction(a.a.LOG_MICRO,"CBCCipher.decrypt()",""),_=E.a.BufferUtils.toWordArray(_);var x=this.blockLengthWords,z=_.words,W=i.a.create(z.slice(0,x)),J=i.a.create(z.slice(x)),Z=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),Q=Z.process(J),G=Z.finalize();return Z.reset(),G&&G.sigBytes&&Q.concat(G),Q},U.prototype.getIv=function(_){if(this.iv){var x=this.iv;this.iv=null,_(null,x);return}var z=this;f(m,function(W,J){if(W){_(W);return}_(null,z.encryptCipher.process(J))})},k}();o.default=O},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(){var i=s,S=i.lib,A=S.WordArray,c=i.enc,d=c.Utf16=c.Utf16BE={stringify:function(E){for(var R=E.words,a=E.sigBytes,O=[],M=0;M<a;M+=2){var w=R[M>>>2]>>>16-M%4*8&65535;O.push(String.fromCharCode(w))}return O.join("")},parse:function(E){for(var R=E.length,a=[],O=0;O<R;O++)a[O>>>1]|=E.charCodeAt(O)<<16-O%2*16;return A.create(a,R*2)}};c.Utf16LE={stringify:function(E){for(var R=E.words,a=E.sigBytes,O=[],M=0;M<a;M+=2){var w=b(R[M>>>2]>>>16-M%4*8&65535);O.push(String.fromCharCode(w))}return O.join("")},parse:function(E){for(var R=E.length,a=[],O=0;O<R;O++)a[O>>>1]|=b(E.charCodeAt(O)<<16-O%2*16);return A.create(a,R*2)}};function b(E){return E<<8&4278255360|E>>>8&16711935}}(),s.enc.Utf16})},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(28))})(this,function(s){return function(i){var S=s,A=S.lib,c=A.CipherParams,d=S.enc,b=d.Hex,E=S.format,R=E.Hex={stringify:function(a){return a.ciphertext.toString(b)},parse:function(a){var O=b.parse(a);return c.create({ciphertext:O})}}}(),s.format.Hex})},function(h,o,n){(function(s,i){h.exports=o=i(n(6),n(13),n(61),n(27),n(28))})(this,function(s){return function(){var i=s,S=i.lib,A=S.BlockCipher,c=i.algo,d=[],b=[],E=[],R=[],a=[],O=[],M=[],w=[],C=[],m=[];(function(){for(var v=[],f=0;f<256;f++)f<128?v[f]=f<<1:v[f]=f<<1^283;for(var p=0,l=0,f=0;f<256;f++){var y=l^l<<1^l<<2^l<<3^l<<4;y=y>>>8^y&255^99,d[p]=y,b[y]=p;var P=v[p],D=v[P],k=v[D],H=v[y]*257^y*16843008;E[p]=H<<24|H>>>8,R[p]=H<<16|H>>>16,a[p]=H<<8|H>>>24,O[p]=H;var H=k*16843009^D*65537^P*257^p*16843008;M[y]=H<<24|H>>>8,w[y]=H<<16|H>>>16,C[y]=H<<8|H>>>24,m[y]=H,p?(p=P^v[v[v[k^P]]],l^=v[v[l]]):p=l=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],u=c.AES=A.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var f=this._keyPriorReset=this._key,p=f.words,l=f.sigBytes/4,y=this._nRounds=l+6,P=(y+1)*4,D=this._keySchedule=[],k=0;k<P;k++)k<l?D[k]=p[k]:(v=D[k-1],k%l?l>6&&k%l==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255]):(v=v<<8|v>>>24,v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255],v^=T[k/l|0]<<24),D[k]=D[k-l]^v);for(var H=this._invKeySchedule=[],U=0;U<P;U++){var k=P-U;if(U%4)var v=D[k];else var v=D[k-4];U<4||k<=4?H[U]=v:H[U]=M[d[v>>>24]]^w[d[v>>>16&255]]^C[d[v>>>8&255]]^m[d[v&255]]}}},encryptBlock:function(v,f){this._doCryptBlock(v,f,this._keySchedule,E,R,a,O,d)},decryptBlock:function(v,f){var p=v[f+1];v[f+1]=v[f+3],v[f+3]=p,this._doCryptBlock(v,f,this._invKeySchedule,M,w,C,m,b);var p=v[f+1];v[f+1]=v[f+3],v[f+3]=p},_doCryptBlock:function(v,f,p,l,y,P,D,k){for(var H=this._nRounds,U=v[f]^p[0],_=v[f+1]^p[1],x=v[f+2]^p[2],z=v[f+3]^p[3],W=4,J=1;J<H;J++){var Z=l[U>>>24]^y[_>>>16&255]^P[x>>>8&255]^D[z&255]^p[W++],Q=l[_>>>24]^y[x>>>16&255]^P[z>>>8&255]^D[U&255]^p[W++],G=l[x>>>24]^y[z>>>16&255]^P[U>>>8&255]^D[_&255]^p[W++],N=l[z>>>24]^y[U>>>16&255]^P[_>>>8&255]^D[x&255]^p[W++];U=Z,_=Q,x=G,z=N}var Z=(k[U>>>24]<<24|k[_>>>16&255]<<16|k[x>>>8&255]<<8|k[z&255])^p[W++],Q=(k[_>>>24]<<24|k[x>>>16&255]<<16|k[z>>>8&255]<<8|k[U&255])^p[W++],G=(k[x>>>24]<<24|k[z>>>16&255]<<16|k[U>>>8&255]<<8|k[_&255])^p[W++],N=(k[z>>>24]<<24|k[U>>>16&255]<<16|k[_>>>8&255]<<8|k[x&255])^p[W++];v[f]=Z,v[f+1]=Q,v[f+2]=G,v[f+3]=N},keySize:256/32});i.AES=A._createHelper(u)}(),s.AES})},function(h,o,n){(function(s,i){h.exports=o=i(n(6))})(this,function(s){return function(i){var S=s,A=S.lib,c=A.WordArray,d=A.Hasher,b=S.algo,E=[];(function(){for(var C=0;C<64;C++)E[C]=i.abs(i.sin(C+1))*4294967296|0})();var R=b.MD5=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,m){for(var T=0;T<16;T++){var u=m+T,v=C[u];C[u]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var f=this._hash.words,p=C[m+0],l=C[m+1],y=C[m+2],P=C[m+3],D=C[m+4],k=C[m+5],H=C[m+6],U=C[m+7],_=C[m+8],x=C[m+9],z=C[m+10],W=C[m+11],J=C[m+12],Z=C[m+13],Q=C[m+14],G=C[m+15],N=f[0],B=f[1],V=f[2],j=f[3];N=a(N,B,V,j,p,7,E[0]),j=a(j,N,B,V,l,12,E[1]),V=a(V,j,N,B,y,17,E[2]),B=a(B,V,j,N,P,22,E[3]),N=a(N,B,V,j,D,7,E[4]),j=a(j,N,B,V,k,12,E[5]),V=a(V,j,N,B,H,17,E[6]),B=a(B,V,j,N,U,22,E[7]),N=a(N,B,V,j,_,7,E[8]),j=a(j,N,B,V,x,12,E[9]),V=a(V,j,N,B,z,17,E[10]),B=a(B,V,j,N,W,22,E[11]),N=a(N,B,V,j,J,7,E[12]),j=a(j,N,B,V,Z,12,E[13]),V=a(V,j,N,B,Q,17,E[14]),B=a(B,V,j,N,G,22,E[15]),N=O(N,B,V,j,l,5,E[16]),j=O(j,N,B,V,H,9,E[17]),V=O(V,j,N,B,W,14,E[18]),B=O(B,V,j,N,p,20,E[19]),N=O(N,B,V,j,k,5,E[20]),j=O(j,N,B,V,z,9,E[21]),V=O(V,j,N,B,G,14,E[22]),B=O(B,V,j,N,D,20,E[23]),N=O(N,B,V,j,x,5,E[24]),j=O(j,N,B,V,Q,9,E[25]),V=O(V,j,N,B,P,14,E[26]),B=O(B,V,j,N,_,20,E[27]),N=O(N,B,V,j,Z,5,E[28]),j=O(j,N,B,V,y,9,E[29]),V=O(V,j,N,B,U,14,E[30]),B=O(B,V,j,N,J,20,E[31]),N=M(N,B,V,j,k,4,E[32]),j=M(j,N,B,V,_,11,E[33]),V=M(V,j,N,B,W,16,E[34]),B=M(B,V,j,N,Q,23,E[35]),N=M(N,B,V,j,l,4,E[36]),j=M(j,N,B,V,D,11,E[37]),V=M(V,j,N,B,U,16,E[38]),B=M(B,V,j,N,z,23,E[39]),N=M(N,B,V,j,Z,4,E[40]),j=M(j,N,B,V,p,11,E[41]),V=M(V,j,N,B,P,16,E[42]),B=M(B,V,j,N,H,23,E[43]),N=M(N,B,V,j,x,4,E[44]),j=M(j,N,B,V,J,11,E[45]),V=M(V,j,N,B,G,16,E[46]),B=M(B,V,j,N,y,23,E[47]),N=w(N,B,V,j,p,6,E[48]),j=w(j,N,B,V,U,10,E[49]),V=w(V,j,N,B,Q,15,E[50]),B=w(B,V,j,N,k,21,E[51]),N=w(N,B,V,j,J,6,E[52]),j=w(j,N,B,V,P,10,E[53]),V=w(V,j,N,B,z,15,E[54]),B=w(B,V,j,N,l,21,E[55]),N=w(N,B,V,j,_,6,E[56]),j=w(j,N,B,V,G,10,E[57]),V=w(V,j,N,B,H,15,E[58]),B=w(B,V,j,N,Z,21,E[59]),N=w(N,B,V,j,D,6,E[60]),j=w(j,N,B,V,W,10,E[61]),V=w(V,j,N,B,y,15,E[62]),B=w(B,V,j,N,x,21,E[63]),f[0]=f[0]+N|0,f[1]=f[1]+B|0,f[2]=f[2]+V|0,f[3]=f[3]+j|0},_doFinalize:function(){var C=this._data,m=C.words,T=this._nDataBytes*8,u=C.sigBytes*8;m[u>>>5]|=128<<24-u%32;var v=i.floor(T/4294967296),f=T;m[(u+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,m[(u+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,C.sigBytes=(m.length+1)*4,this._process();for(var p=this._hash,l=p.words,y=0;y<4;y++){var P=l[y];l[y]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return p},clone:function(){var C=d.clone.call(this);return C._hash=this._hash.clone(),C}});function a(C,m,T,u,v,f,p){var l=C+(m&T|~m&u)+v+p;return(l<<f|l>>>32-f)+m}function O(C,m,T,u,v,f,p){var l=C+(m&u|T&~u)+v+p;return(l<<f|l>>>32-f)+m}function M(C,m,T,u,v,f,p){var l=C+(m^T^u)+v+p;return(l<<f|l>>>32-f)+m}function w(C,m,T,u,v,f,p){var l=C+(T^(m|~u))+v+p;return(l<<f|l>>>32-f)+m}S.MD5=d._createHelper(R),S.HmacMD5=d._createHmacHelper(R)}(Math),s.MD5})},function(h,o,n){"use strict";var s;o.__esModule=!0;var i=n(1),S=i.__importDefault(n(0)),A=i.__importStar(n(2)),c=i.__importDefault(n(8)),d=i.__importDefault(n(5)),b=i.__importDefault(n(17)),E=i.__importDefault(n(15)),R=i.__importDefault(n(20)),a=i.__importDefault(n(3)),O=n(29);function M(m){var T=m.statusCode;return T===408&&!m.code||T===400&&!m.code||T>=500&&T<=504}function w(m){var T=m.connection,u=T&&T.connectionManager.host;return u?[u].concat(c.default.getFallbackHosts(m.options)):c.default.getHosts(m.options)}var C=(s=function(){function m(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=w,S.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(T,u,v,f,p,l,y){var P=E.default.createRequest(v,f,p,l,R.default.REQ_SEND,u&&u.options.timeouts,T);return P.once("complete",y),P.exec(),P},this.checkConnectivity=function(T){var u=c.default.internetUpUrl;a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u),this.doUri(b.default.Get,null,u,null,null,null,function(v,f){var p,l=!v&&((p=f)===null||p===void 0?void 0:p.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+l),T(null,l)})}):S.default.Config.jsonpSupported&&(this.Request=function(T,u,v,f,p,l,y){var P=O.createRequest(v,f,p,l,R.default.REQ_SEND,u&&u.options.timeouts,T);return P.once("complete",y),S.default.Config.nextTick(function(){P.exec()}),P},this.checkConnectivity=function(T){var u=this,v=c.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(T);return}this.checksInProgress=[T],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+v);var f=new O.Request("isTheInternetUp",v,null,null,null,R.default.REQ_SEND,c.default.TIMEOUTS);f.once("complete",function(p,l){var y=!p&&l;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+y);for(var P=0;P<u.checksInProgress.length;P++)u.checksInProgress[P](null,y);u.checksInProgress=null}),S.default.Config.nextTick(function(){f.exec()})})}return m.prototype.do=function(T,u,v,f,p,l,y){var P=this,D=typeof v=="function"?v:function(_){return u.baseUri(_)+v},k=u._currentFallback;if(k)if(k.validUntil>A.now()){if(!this.Request){y==null||y(new d.default("Request invoked before assigned to",null,500));return}this.Request(T,u,D(k.host),f,l,p,function(_){for(var x=[],z=1;z<arguments.length;z++)x[z-1]=arguments[z];if(_&&M(_)){u._currentFallback=null,P.do(T,u,v,f,p,l,y);return}y==null||y.apply(void 0,i.__spreadArray([_],x))});return}else u._currentFallback=null;var H=w(u);if(H.length===1){this.doUri(T,u,D(H[0]),f,p,l,y);return}var U=function(_,x){var z=_.shift();P.doUri(T,u,D(z),f,p,l,function(W){for(var J=[],Z=1;Z<arguments.length;Z++)J[Z-1]=arguments[Z];if(W&&M(W)&&_.length){U(_,!0);return}x&&(u._currentFallback={host:z,validUntil:A.now()+u.options.timeouts.fallbackRetryTimeout}),y==null||y.apply(void 0,i.__spreadArray([W],J))})};U(H)},m.prototype.doUri=function(T,u,v,f,p,l,y){if(!this.Request){y(new d.default("Request invoked before assigned to",null,500));return}this.Request(T,u,v,f,l,p,y)},m}(),s.methods=[b.default.Get,b.default.Delete,b.default.Post,b.default.Put,b.default.Patch],s.methodsWithoutBody=[b.default.Get,b.default.Delete],s.methodsWithBody=[b.default.Post,b.default.Put,b.default.Patch],s);o.default=C},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(40)),S=s.__importStar(n(2)),A=S.getGlobalObject();function c(){var R=A.location;return!A.WebSocket||!R||!R.origin||R.origin.indexOf("http")>-1}var d=A.navigator&&A.navigator.userAgent.toString(),b=A.location&&A.location.href,E={agent:"browser",logTimestamps:!0,userAgent:d,currentUrl:b,noUpgrade:d&&!!d.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:A.WebSocket,xhrSupported:A.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:c(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:i.default,supportsBinary:!!A.TextDecoder,preferBinary:!1,ArrayBuffer:A.ArrayBuffer,atob:A.atob,nextTick:typeof A.setImmediate!="undefined"?A.setImmediate.bind(A):function(R){setTimeout(R,0)},addEventListener:A.addEventListener,inspect:JSON.stringify,stringByteSize:function(R){return A.TextDecoder&&new A.TextEncoder().encode(R).length||R.length},TextEncoder:A.TextEncoder,TextDecoder:A.TextDecoder,Promise:A.Promise,getRandomValues:function(R){if(R!==void 0)return function(a,O){R.getRandomValues(a),O&&O(null)}}(A.crypto||msCrypto)};o.default=E},function(h,o,n){"use strict";(function(s){o.__esModule=!0;var i=n(1),S=i.__importStar(n(2)),A="ablyjs-storage-test",c=function(){function d(){try{s.sessionStorage.setItem(A,A),s.sessionStorage.removeItem(A),this.sessionSupported=!0}catch(b){this.sessionSupported=!1}try{s.localStorage.setItem(A,A),s.localStorage.removeItem(A),this.localSupported=!0}catch(b){this.localSupported=!1}}return d.prototype.get=function(b){return this._get(b,!1)},d.prototype.getSession=function(b){return this._get(b,!0)},d.prototype.remove=function(b){return this._remove(b,!1)},d.prototype.removeSession=function(b){return this._remove(b,!0)},d.prototype.set=function(b,E,R){return this._set(b,E,R,!1)},d.prototype.setSession=function(b,E,R){return this._set(b,E,R,!0)},d.prototype._set=function(b,E,R,a){var O={value:E};return R&&(O.expires=S.now()+R),this.storageInterface(a).setItem(b,JSON.stringify(O))},d.prototype._get=function(b,E){if(E&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!E&&!this.localSupported)throw new Error("Local Storage not supported");var R=this.storageInterface(E).getItem(b);if(!R)return null;var a=JSON.parse(R);return a.expires&&a.expires<S.now()?(this.storageInterface(E).removeItem(b),null):a.value},d.prototype._remove=function(b,E){return this.storageInterface(E).removeItem(b)},d.prototype.storageInterface=function(b){return b?s.sessionStorage:s.localStorage},d}();o.default=new c}).call(this,n(12))},function(h,o,n){"use strict";o.__esModule=!0;var s=n(1),i=s.__importDefault(n(66)),S={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};o.default=S},function(h,o,n){"use strict";o.__esModule=!0;var s;(function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp"})(s||(s={})),o.default=s},function(h,o,n){"use strict";n.r(o);var s=n(29),i=n.n(s),S=n(2),A=n(0),c=n.n(A),d=n(11),b=n.n(d),E=n(15),R=n.n(E),a=function(m){var T="xhr_polling";function u(v,f,p){p.stream=!1,b.a.call(this,v,f,p),this.shortName=T}return S.inherits(u,b.a),u.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.allowComet},u.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},u.prototype.createRequest=function(v,f,p,l,y){return R.a.createRequest(v,f,p,l,y,this.timeouts)},typeof m!="undefined"&&u.isAvailable()&&(m.supportedTransports[T]=u),u},O=a,M=function(m){var T="xhr_streaming";function u(v,f,p){b.a.call(this,v,f,p),this.shortName=T}return S.inherits(u,b.a),u.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.streamingSupported&&c.a.Config.allowComet},u.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},u.prototype.createRequest=function(v,f,p,l,y){return R.a.createRequest(v,f,p,l,y,this.timeouts)},typeof m!="undefined"&&u.isAvailable()&&(m.supportedTransports[T]=u),u},w=M,C=o.default=[i.a,O,w]}]).default})});var Lc=Vt((Er,Us)=>{nt();(function(h,o){typeof Er=="object"&&typeof Us=="object"?Us.exports=o():typeof define=="function"&&define.amd?define([],o):typeof Er=="object"?Er.bowser=o():h.bowser=o()})(Er,function(){return function(h){var o={};function n(s){if(o[s])return o[s].exports;var i=o[s]={i:s,l:!1,exports:{}};return h[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=h,n.c=o,n.d=function(s,i,S){n.o(s,i)||Object.defineProperty(s,i,{enumerable:!0,get:S})},n.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,i){if(1&i&&(s=n(s)),8&i||4&i&&typeof s=="object"&&s&&s.__esModule)return s;var S=Object.create(null);if(n.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:s}),2&i&&typeof s!="string")for(var A in s)n.d(S,A,function(c){return s[c]}.bind(null,A));return S},n.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(i,"a",i),i},n.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},n.p="",n(n.s=90)}({17:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s=n(18),i=function(){function S(){}return S.getFirstMatch=function(A,c){var d=c.match(A);return d&&d.length>0&&d[1]||""},S.getSecondMatch=function(A,c){var d=c.match(A);return d&&d.length>1&&d[2]||""},S.matchAndReturnConst=function(A,c,d){if(A.test(c))return d},S.getWindowsVersionName=function(A){switch(A){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},S.getMacOSVersionName=function(A){var c=A.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(c.push(0),c[0]===10)switch(c[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},S.getAndroidVersionName=function(A){var c=A.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(c.push(0),!(c[0]===1&&c[1]<5))return c[0]===1&&c[1]<6?"Cupcake":c[0]===1&&c[1]>=6?"Donut":c[0]===2&&c[1]<2?"Eclair":c[0]===2&&c[1]===2?"Froyo":c[0]===2&&c[1]>2?"Gingerbread":c[0]===3?"Honeycomb":c[0]===4&&c[1]<1?"Ice Cream Sandwich":c[0]===4&&c[1]<4?"Jelly Bean":c[0]===4&&c[1]>=4?"KitKat":c[0]===5?"Lollipop":c[0]===6?"Marshmallow":c[0]===7?"Nougat":c[0]===8?"Oreo":c[0]===9?"Pie":void 0},S.getVersionPrecision=function(A){return A.split(".").length},S.compareVersions=function(A,c,d){d===void 0&&(d=!1);var b=S.getVersionPrecision(A),E=S.getVersionPrecision(c),R=Math.max(b,E),a=0,O=S.map([A,c],function(M){var w=R-S.getVersionPrecision(M),C=M+new Array(w+1).join(".0");return S.map(C.split("."),function(m){return new Array(20-m.length).join("0")+m}).reverse()});for(d&&(a=R-Math.min(b,E)),R-=1;R>=a;){if(O[0][R]>O[1][R])return 1;if(O[0][R]===O[1][R]){if(R===a)return 0;R-=1}else if(O[0][R]<O[1][R])return-1}},S.map=function(A,c){var d,b=[];if(Array.prototype.map)return Array.prototype.map.call(A,c);for(d=0;d<A.length;d+=1)b.push(c(A[d]));return b},S.find=function(A,c){var d,b;if(Array.prototype.find)return Array.prototype.find.call(A,c);for(d=0,b=A.length;d<b;d+=1){var E=A[d];if(c(E,d))return E}},S.assign=function(A){for(var c,d,b=A,E=arguments.length,R=new Array(E>1?E-1:0),a=1;a<E;a++)R[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[A].concat(R));var O=function(){var M=R[c];typeof M=="object"&&M!==null&&Object.keys(M).forEach(function(w){b[w]=M[w]})};for(c=0,d=R.length;c<d;c+=1)O();return A},S.getBrowserAlias=function(A){return s.BROWSER_ALIASES_MAP[A]},S.getBrowserTypeByAlias=function(A){return s.BROWSER_MAP[A]||""},S}();o.default=i,h.exports=o.default},18:function(h,o,n){"use strict";o.__esModule=!0,o.ENGINE_MAP=o.OS_MAP=o.PLATFORMS_MAP=o.BROWSER_MAP=o.BROWSER_ALIASES_MAP=void 0,o.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},o.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},o.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},o.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},o.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s,i=(s=n(91))&&s.__esModule?s:{default:s},S=n(18);function A(d,b){for(var E=0;E<b.length;E++){var R=b[E];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(d,R.key,R)}}var c=function(){function d(){}var b,E,R;return d.getParser=function(a,O){if(O===void 0&&(O=!1),typeof a!="string")throw new Error("UserAgent should be a string");return new i.default(a,O)},d.parse=function(a){return new i.default(a).getResult()},b=d,R=[{key:"BROWSER_MAP",get:function(){return S.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return S.ENGINE_MAP}},{key:"OS_MAP",get:function(){return S.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return S.PLATFORMS_MAP}}],(E=null)&&A(b.prototype,E),R&&A(b,R),d}();o.default=c,h.exports=o.default},91:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s=d(n(92)),i=d(n(93)),S=d(n(94)),A=d(n(95)),c=d(n(17));function d(E){return E&&E.__esModule?E:{default:E}}var b=function(){function E(a,O){if(O===void 0&&(O=!1),a==null||a==="")throw new Error("UserAgent parameter can't be empty");this._ua=a,this.parsedResult={},O!==!0&&this.parse()}var R=E.prototype;return R.getUA=function(){return this._ua},R.test=function(a){return a.test(this._ua)},R.parseBrowser=function(){var a=this;this.parsedResult.browser={};var O=c.default.find(s.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(w){return a.test(w)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.browser=O.describe(this.getUA())),this.parsedResult.browser},R.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},R.getBrowserName=function(a){return a?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},R.getBrowserVersion=function(){return this.getBrowser().version},R.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},R.parseOS=function(){var a=this;this.parsedResult.os={};var O=c.default.find(i.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(w){return a.test(w)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.os=O.describe(this.getUA())),this.parsedResult.os},R.getOSName=function(a){var O=this.getOS().name;return a?String(O).toLowerCase()||"":O||""},R.getOSVersion=function(){return this.getOS().version},R.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},R.getPlatformType=function(a){a===void 0&&(a=!1);var O=this.getPlatform().type;return a?String(O).toLowerCase()||"":O||""},R.parsePlatform=function(){var a=this;this.parsedResult.platform={};var O=c.default.find(S.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(w){return a.test(w)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.platform=O.describe(this.getUA())),this.parsedResult.platform},R.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},R.getEngineName=function(a){return a?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},R.parseEngine=function(){var a=this;this.parsedResult.engine={};var O=c.default.find(A.default,function(M){if(typeof M.test=="function")return M.test(a);if(M.test instanceof Array)return M.test.some(function(w){return a.test(w)});throw new Error("Browser's test function is not valid")});return O&&(this.parsedResult.engine=O.describe(this.getUA())),this.parsedResult.engine},R.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},R.getResult=function(){return c.default.assign({},this.parsedResult)},R.satisfies=function(a){var O=this,M={},w=0,C={},m=0;if(Object.keys(a).forEach(function(P){var D=a[P];typeof D=="string"?(C[P]=D,m+=1):typeof D=="object"&&(M[P]=D,w+=1)}),w>0){var T=Object.keys(M),u=c.default.find(T,function(P){return O.isOS(P)});if(u){var v=this.satisfies(M[u]);if(v!==void 0)return v}var f=c.default.find(T,function(P){return O.isPlatform(P)});if(f){var p=this.satisfies(M[f]);if(p!==void 0)return p}}if(m>0){var l=Object.keys(C),y=c.default.find(l,function(P){return O.isBrowser(P,!0)});if(y!==void 0)return this.compareVersion(C[y])}},R.isBrowser=function(a,O){O===void 0&&(O=!1);var M=this.getBrowserName().toLowerCase(),w=a.toLowerCase(),C=c.default.getBrowserTypeByAlias(w);return O&&C&&(w=C.toLowerCase()),w===M},R.compareVersion=function(a){var O=[0],M=a,w=!1,C=this.getBrowserVersion();if(typeof C=="string")return a[0]===">"||a[0]==="<"?(M=a.substr(1),a[1]==="="?(w=!0,M=a.substr(2)):O=[],a[0]===">"?O.push(1):O.push(-1)):a[0]==="="?M=a.substr(1):a[0]==="~"&&(w=!0,M=a.substr(1)),O.indexOf(c.default.compareVersions(C,M,w))>-1},R.isOS=function(a){return this.getOSName(!0)===String(a).toLowerCase()},R.isPlatform=function(a){return this.getPlatformType(!0)===String(a).toLowerCase()},R.isEngine=function(a){return this.getEngineName(!0)===String(a).toLowerCase()},R.is=function(a,O){return O===void 0&&(O=!1),this.isBrowser(a,O)||this.isOS(a)||this.isPlatform(a)},R.some=function(a){var O=this;return a===void 0&&(a=[]),a.some(function(M){return O.is(M)})},E}();o.default=b,h.exports=o.default},92:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},S=/version\/(\d+(\.?_?\d+)+)/i,A=[{test:[/googlebot/i],describe:function(c){var d={name:"Googlebot"},b=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/opera/i],describe:function(c){var d={name:"Opera"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/opr\/|opios/i],describe:function(c){var d={name:"Opera"},b=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/SamsungBrowser/i],describe:function(c){var d={name:"Samsung Internet for Android"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/Whale/i],describe:function(c){var d={name:"NAVER Whale Browser"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/MZBrowser/i],describe:function(c){var d={name:"MZ Browser"},b=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/focus/i],describe:function(c){var d={name:"Focus"},b=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/swing/i],describe:function(c){var d={name:"Swing"},b=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/coast/i],describe:function(c){var d={name:"Opera Coast"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(c){var d={name:"Opera Touch"},b=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/yabrowser/i],describe:function(c){var d={name:"Yandex Browser"},b=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/ucbrowser/i],describe:function(c){var d={name:"UC Browser"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/Maxthon|mxios/i],describe:function(c){var d={name:"Maxthon"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/epiphany/i],describe:function(c){var d={name:"Epiphany"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/puffin/i],describe:function(c){var d={name:"Puffin"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/sleipnir/i],describe:function(c){var d={name:"Sleipnir"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/k-meleon/i],describe:function(c){var d={name:"K-Meleon"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/micromessenger/i],describe:function(c){var d={name:"WeChat"},b=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/qqbrowser/i],describe:function(c){var d={name:/qqbrowserlite/i.test(c)?"QQ Browser Lite":"QQ Browser"},b=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/msie|trident/i],describe:function(c){var d={name:"Internet Explorer"},b=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/\sedg\//i],describe:function(c){var d={name:"Microsoft Edge"},b=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/edg([ea]|ios)/i],describe:function(c){var d={name:"Microsoft Edge"},b=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/vivaldi/i],describe:function(c){var d={name:"Vivaldi"},b=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/seamonkey/i],describe:function(c){var d={name:"SeaMonkey"},b=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/sailfish/i],describe:function(c){var d={name:"Sailfish"},b=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,c);return b&&(d.version=b),d}},{test:[/silk/i],describe:function(c){var d={name:"Amazon Silk"},b=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/phantom/i],describe:function(c){var d={name:"PhantomJS"},b=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/slimerjs/i],describe:function(c){var d={name:"SlimerJS"},b=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var d={name:"BlackBerry"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var d={name:"WebOS Browser"},b=i.default.getFirstMatch(S,c)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/bada/i],describe:function(c){var d={name:"Bada"},b=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/tizen/i],describe:function(c){var d={name:"Tizen"},b=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/qupzilla/i],describe:function(c){var d={name:"QupZilla"},b=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(c){var d={name:"Firefox"},b=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/electron/i],describe:function(c){var d={name:"Electron"},b=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/MiuiBrowser/i],describe:function(c){var d={name:"Miui"},b=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/chromium/i],describe:function(c){var d={name:"Chromium"},b=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,c)||i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/chrome|crios|crmo/i],describe:function(c){var d={name:"Chrome"},b=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/GSA/i],describe:function(c){var d={name:"Google Search"},b=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:function(c){var d=!c.test(/like android/i),b=c.test(/android/i);return d&&b},describe:function(c){var d={name:"Android Browser"},b=i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/playstation 4/i],describe:function(c){var d={name:"PlayStation 4"},b=i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/safari|applewebkit/i],describe:function(c){var d={name:"Safari"},b=i.default.getFirstMatch(S,c);return b&&(d.version=b),d}},{test:[/.*/i],describe:function(c){var d=c.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(d,c),version:i.default.getSecondMatch(d,c)}}}];o.default=A,h.exports=o.default},93:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},S=n(18),A=[{test:[/Roku\/DVP/],describe:function(c){var d=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,c);return{name:S.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(c){var d=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,c);return{name:S.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(c){var d=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,c),b=i.default.getWindowsVersionName(d);return{name:S.OS_MAP.Windows,version:d,versionName:b}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(c){var d={name:S.OS_MAP.iOS},b=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,c);return b&&(d.version=b),d}},{test:[/macintosh/i],describe:function(c){var d=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,c).replace(/[_\s]/g,"."),b=i.default.getMacOSVersionName(d),E={name:S.OS_MAP.MacOS,version:d};return b&&(E.versionName=b),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(c){var d=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,c).replace(/[_\s]/g,".");return{name:S.OS_MAP.iOS,version:d}}},{test:function(c){var d=!c.test(/like android/i),b=c.test(/android/i);return d&&b},describe:function(c){var d=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,c),b=i.default.getAndroidVersionName(d),E={name:S.OS_MAP.Android,version:d};return b&&(E.versionName=b),E}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var d=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,c),b={name:S.OS_MAP.WebOS};return d&&d.length&&(b.version=d),b}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var d=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,c)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,c)||i.default.getFirstMatch(/\bbb(\d+)/i,c);return{name:S.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(c){var d=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,c);return{name:S.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(c){var d=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,c);return{name:S.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:S.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:S.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(c){var d=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,c);return{name:S.OS_MAP.PlayStation4,version:d}}}];o.default=A,h.exports=o.default},94:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},S=n(18),A=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(c){var d=i.default.getFirstMatch(/(can-l01)/i,c)&&"Nova",b={type:S.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(b.model=d),b}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:S.PLATFORMS_MAP.tablet}}},{test:function(c){var d=c.test(/ipod|iphone/i),b=c.test(/like (ipod|iphone)/i);return d&&!b},describe:function(c){var d=i.default.getFirstMatch(/(ipod|iphone)/i,c);return{type:S.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName(!0)==="blackberry"},describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(c){return c.getBrowserName(!0)==="bada"},describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName()==="windows phone"},describe:function(){return{type:S.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(c){var d=Number(String(c.getOSVersion()).split(".")[0]);return c.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:S.PLATFORMS_MAP.tablet}}},{test:function(c){return c.getOSName(!0)==="android"},describe:function(){return{type:S.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getOSName(!0)==="macos"},describe:function(){return{type:S.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(c){return c.getOSName(!0)==="windows"},describe:function(){return{type:S.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="linux"},describe:function(){return{type:S.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="playstation 4"},describe:function(){return{type:S.PLATFORMS_MAP.tv}}},{test:function(c){return c.getOSName(!0)==="roku"},describe:function(){return{type:S.PLATFORMS_MAP.tv}}}];o.default=A,h.exports=o.default},95:function(h,o,n){"use strict";o.__esModule=!0,o.default=void 0;var s,i=(s=n(17))&&s.__esModule?s:{default:s},S=n(18),A=[{test:function(c){return c.getBrowserName(!0)==="microsoft edge"},describe:function(c){if(/\sedg\//i.test(c))return{name:S.ENGINE_MAP.Blink};var d=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,c);return{name:S.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(c){var d={name:S.ENGINE_MAP.Trident},b=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:function(c){return c.test(/presto/i)},describe:function(c){var d={name:S.ENGINE_MAP.Presto},b=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:function(c){var d=c.test(/gecko/i),b=c.test(/like gecko/i);return d&&!b},describe:function(c){var d={name:S.ENGINE_MAP.Gecko},b=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:S.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(c){var d={name:S.ENGINE_MAP.WebKit},b=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,c);return b&&(d.version=b),d}}];o.default=A,h.exports=o.default}})})});nt();nt();var qo=(u=>(u.MEETING_START="meeting.start",u.MEETING_LEAVE="meeting.leave",u.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",u.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",u.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",u.MEETING_PARTICIPANT_LEFT="meeting.participant-left",u.MEETING_JOIN="meeting.join",u.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",u.MEETING_HOST_CHANGE="meeting.host-change",u.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",u.MEETING_DEVICES_CHANGE="meeting.devices-change",u.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",u.MEETING_STATE_UPDATE="meeting.state-update",u.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",u.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",u.MY_PARTICIPANT_UPDATED="my-participant.update",u.MY_PARTICIPANT_LEFT="my-participant.left",u.MY_PARTICIPANT_JOINED="my-participant.joined",u.DESTROY="destroy",u))(qo||{});var Qo=(A=>(A.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",A.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",A.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",A.TOGGLE_CAM="meeting-controls.toggle-cam",A.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",A.HANG_UP="hang-up",A))(Qo||{}),vr=(R=>(R.REALTIME_JOIN="realtime.join",R.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",R.REALTIME_HOST_CHANGE="realtime.host-change",R.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",R.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",R.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",R.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",R.REALTIME_GATHER="realtime.gather",R.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",R.REALTIME_SET_AVATAR="realtime.set-avatar",R.REALTIME_DRAWING_CHANGE="realtime.drawing-change",R))(vr||{});var Yo=(E=>(E[E.MEETING_FAILED=-1]="MEETING_FAILED",E[E.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",E[E.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",E[E.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",E[E.MEETING_CONNECTING=3]="MEETING_CONNECTING",E[E.MEETING_CONNECTED=4]="MEETING_CONNECTED",E[E.MEETING_RECONNECT=5]="MEETING_RECONNECT",E[E.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",E[E.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",E[E.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",E))(Yo||{}),pi=(A=>(A.JOINED="participant.joined",A.LOCAL_JOINED="participant.local-joined",A.LEFT="participant.left",A.LOCAL_LEFT="participant.local-left",A.LOCAL_UPDATED="participant.updated",A.LIST_UPDATED="participant.list-updated",A))(pi||{}),Xo=(c=>(c[c.NOT_AVAILABLE=0]="NOT_AVAILABLE",c[c.GOOD=1]="GOOD",c[c.BAD=2]="BAD",c[c.POOR=3]="POOR",c[c.DISCONNECTED=4]="DISCONNECTED",c[c.RECONNECTING=5]="RECONNECTING",c[c.LOST_CONNECTION=6]="LOST_CONNECTION",c))(Xo||{}),Zo=(A=>(A.NO_CAM="devices.no-cam",A.NO_DEVICES="devices.no-devices",A.DEVICES_BLOCKED="devices.blocked",A.DEVICES_CAM_BLOCKED="devices.cam-blocked",A.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",A.DEVICES_UNKNOWN_ERROR="devices.unknown-error",A))(Zo||{});nt();var vs=on(ts());nt();nt();nt();var An=(h,o,n)=>Qt(void 0,null,function*(){let s=yield fetch(h,{method:o,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(!s.ok)throw s;return s.json()});nt();var Ol=on(ts()),xe=class{constructor(o){this.debug=(0,Ol.default)(o)}log(o,...n){this.debug(o,...n)}};nt();var rc=on(is());var te=class{constructor(o={}){this.subscribe=o=>{this.callbacks.push(o)};this.unsubscribe=o=>{this.callbacks=this.callbacks.filter(n=>n!==o)};this.publish=(...o)=>{!this.callbacks||this.callbacks.forEach(n=>{this.callListener(n,o).catch(s=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${n}
            Event: ${JSON.stringify(o)}
            Error: ${s}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(o,n)=>new Promise((s,i)=>{try{let S=o(...n);s(S)}catch(S){i(S)}});let{logger:n,throttleTime:s}=o;this.logger=n!=null?n:new xe("@superviz/sdk/observer-helper"),this.throttle=s,this.callbacks=[],this.throttle&&(this.publish=(0,rc.default)(this.publish,this.throttle))}};var bn=class{static createUrl(o,n){return`${o}${n}`}static validateApiKey(o,n){let s="/user/checkapikey",i=this.createUrl(o,s);return An(i,"POST",{apiKey:n})}static fetchConfig(o,n){let s="/immersive-config",i=this.createUrl(o,s);return An(i,"POST",{apiKey:n})}static fetchWaterMark(o,n){return Qt(this,null,function*(){let s="/user/watermark",i=this.createUrl(o,s),{message:S}=yield An(i,"POST",{apiKey:n});return S})}};nt();function Ty(h,o){return Qt(this,null,function*(){try{return(yield bn.validateApiKey(h,o))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}})}var ic=Ty;nt();var oc=on(os()),ss=class{setConfig(o){this.configuration=o}get(o,n){if(!this.configuration)throw new Error("configs is not available");return(0,oc.get)(this.configuration,o,n)}},_y=new ss,Cn=_y;nt();nt();var Kn=class{static getRemoteConfig(){return Qt(this,arguments,function*(o="prod"){let{version:n}=yield Promise.resolve().then(()=>(ac(),sc));if(o==="local"){let{remoteConfig:S}=yield Promise.resolve().then(()=>(lc(),uc));return S}let s={version:n,environment:o},i=this.createUrl(s);return An(i,"GET",null)})}static createUrl({version:o,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${o}?env=${n}`}};Kn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";nt();var ps=on(os());nt();var yi=class{constructor(o){this.observers=new Map;this.subscribe=(o,n)=>{this.logger.log("pubsub service @ subscribe",{event:o,callback:n}),this.observers.has(o)||this.observers.set(o,new te),this.observers.get(o).subscribe(n)};this.unsubscribe=(o,n)=>{this.logger.log("pubsub service @ unsubscribe",{event:o,callback:n}),this.observers.has(o)&&(this.observers.get(o).reset(),this.observers.delete(o))};this.publish=(o,n)=>{this.logger.log("pubsub service @ publish",{event:o,data:n}),this.realtime.setSyncProperty(o,n)};this.publishEventToClient=(o,n)=>{this.logger.log("pubsub service @ publishEventToClient",{event:o,data:n}),this.observers.has(o)&&this.observers.get(o).publish(n)};this.onSyncPropertiesChange=o=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:o}),Object.entries(o).forEach(([n,s])=>{this.publishEventToClient(n,s)})};this.logger=new xe("@superviz/sdk/pubsub"),this.realtime=o,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(o){return this.realtime.fetchSyncClientProperty(o)}};nt();nt();var hs=on(cc()),Ar=on(is());nt();var us=(s=>(s.HOST="host",s.GUEST="guest",s.AUDIENCE="audience",s))(us||{});nt();var ls=(d=>(d[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d))(ls||{});nt();nt();var cs=(m=>(m[m.yellow=0]="yellow",m[m.turquoise=1]="turquoise",m[m.orange=2]="orange",m[m.blue=3]="blue",m[m.pink=4]="pink",m[m.purple=5]="purple",m[m.green=6]="green",m[m.red=7]="red",m[m.bluedark=8]="bluedark",m[m.pinklight=9]="pinklight",m[m.purplelight=10]="purplelight",m[m.greenlight=11]="greenlight",m[m.orangelight=12]="orangelight",m[m.bluelight=13]="bluelight",m[m.redlight=14]="redlight",m[m.brown=15]="brown",m[m.gray=16]="gray",m))(cs||{}),fs=(h=>(h[h["#FFEF33"]=0]="#FFEF33",h[h["#31E0B0"]=1]="#31E0B0",h[h["#FF5E10"]=2]="#FF5E10",h[h["#00ABF7"]=3]="#00ABF7",h[h["#FF00BB"]=4]="#FF00BB",h[h["#9C29FF"]=5]="#9C29FF",h[h["#6FDD00"]=6]="#6FDD00",h[h["#E30000"]=7]="#E30000",h[h["#304AFF"]=8]="#304AFF",h[h["#FF89C4"]=9]="#FF89C4",h[h["#D597FF"]=10]="#D597FF",h[h["#C6EC5C"]=11]="#C6EC5C",h[h["#FFA115"]=12]="#FFA115",h[h["#75DEFE"]=13]="#75DEFE",h[h["#FAA291"]=14]="#FAA291",h[h["#BB813F"]=15]="#BB813F",h[h["#878291"]=16]="#878291",h))(fs||{});var bi=class{constructor(){this.participantObservers=[],this.logger=new xe("@superviz/sdk/realtime-service"),this.participantsObserver=new te({logger:this.logger}),this.participantJoinedObserver=new te({logger:this.logger}),this.participantLeaveObserver=new te({logger:this.logger}),this.syncPropertiesObserver=new te({logger:this.logger}),this.reconnectObserver=new te({logger:this.logger}),this.roomInfoUpdatedObserver=new te({logger:this.logger}),this.roomListUpdatedObserver=new te({logger:this.logger}),this.hostObserver=new te({logger:this.logger}),this.realtimeStateObserver=new te({logger:this.logger}),this.kickAllParticipantsObserver=new te({logger:this.logger}),this.authenticationObserver=new te({logger:this.logger})}subscribeToParticipantUpdate(o,n){this.participantObservers[o]||(this.participantObservers[o]=new te({logger:this.logger})),this.participantObservers[o].subscribe(n)}unsubscribeFromParticipantUpdate(o,n){this.participantObservers[o]&&this.participantObservers[o].unsubscribe(n)}getSlotColor(o){let n=o!=null?o:16;return{color:fs[n],name:cs[n]}}};var wy=1e3*60,My=6e4,xy=1e4,Ly=1e3,ds=null,Jn=class extends bi{constructor(n,s){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=n=>{if(!n)return;let s=this.participants[n];this.updateRoomProperties({hostClientId:s.clientId})};this.freezeSync=n=>{var s,i;if(this.isSyncFrozen=n,n){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(s=this.broadcastChannel)==null||s.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(i=this.broadcastChannel)==null||i.unsubscribe();return}this.join()};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(n=>{let s=this.clientSyncPropertiesQueue[n];this.clientSyncPropertiesQueue[n]=[],s.length&&this.clientSyncChannel.publish(n,s)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(n,s)=>{this.clientRoomState[n]=s[s.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=n=>Qt(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?(n==null?void 0:n.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(n.hostClientId):this.hostPassingHandle(),this.updateParticipants()});this.updateMyProperties=(0,Ar.default)(n=>{let s=n;if(!(this.isMessageTooBig(n)||this.left||!this.enableSync||this.isSyncFrozen)&&(s.avatar===void 0&&delete s.avatar,this.myParticipant.data=Ue(Ue({},this.myParticipant.data),n),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},Ly);this.updateRoomProperties=n=>{if(this.isMessageTooBig(n)||this.isSyncFrozen||this.left)return;let s=Ue(Ue({},this.localRoomProperties),n);this.supervizChannel.publish("update",s)};this.updateParticipants=()=>{let n={};this.supervizChannel.presence.get((s,i)=>{i.forEach(S=>{n[S.clientId]=Ue({},S)}),this.participants=n,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=n=>{let s=[];if(this.supervizChannel.presence.get((S,A)=>{A.forEach(c=>{S||s.push(c.clientId)})}),!n||!s.includes(n)){this.hostPassingHandle();return}ds&&clearTimeout(ds);let i=this.hostParticipantId;this.hostParticipantId=n,this.hostObserver.publish({oldHostParticipantId:i,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var s;let n={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((s=this.myParticipant)==null?void 0:s.data.type)==="host"&&(n.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(n)};this.hostPassingHandle=(0,Ar.default)(()=>Qt(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((n,s)=>{let i=s.filter(A=>A.data.type==="host").map(A=>A.clientId);if(this.shouldKickParticipantsOnHostLeave&&i.length===0){ds=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},wy);return}let S=i[0];S===this.localParticipantId&&this.setHost(S)})}),1e3);this.findSlotIndex=n=>{let s=n,i=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((c,d)=>{if(c){i=[];return}d.forEach(b=>{b.connectionId===s.connectionId&&(s=b),b.connectionId!==s.connectionId&&b.data.hasOwnProperty("slotIndex")&&i.splice(i.indexOf(b.data.slotIndex),1)})}),i.length===0)return;let S=i[0];this.myParticipant.data.slotIndex=S,this.updateMyProperties({slotIndex:S});let A=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(s)},A)};this.confirmSlot=(0,Ar.default)(n=>Qt(this,null,function*(){let s=[],i=n;if(this.supervizChannel.presence.get((S,A)=>{A.forEach(c=>{c.connectionId===i.connectionId&&(i=c),c.connectionId!==i.connectionId&&c.data.slotIndex!==void 0&&s.push(c.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||s.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(i);else{let S=yield this.fetchRoomProperties();this.updateRoomProperties(S)}}),1e3);this.onParticipantJoin=n=>{this.updateParticipants(),this.participantJoinedObserver.publish(n),this.updateMyProperties({})};this.syncBroadcast=(0,Ar.default)(()=>{let n=btoa(this.ablyKey),s=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(s,{headers:{Authorization:`Basic ${n}`}}).then(i=>i.json()).then(i=>{this.broadcastChannel.publish("update",i)})},1e3);this.isMessageTooBig=(n,s=My)=>{let i=JSON.stringify(n);return new TextEncoder().encode(i).length>s?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=s,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var n,s;return(s=(n=this.myParticipant.data)==null?void 0:n.participantId)!=null?s:null}get isBroadcast(){return Object.values(this.participants).some(n=>n.data.type==="audience")}start({participant:n,roomId:s,apiKey:i,shouldKickParticipantsOnHostLeave:S}){this.myParticipant={data:gr(Ue({},n),{participantId:n.id}),timestamp:null,action:null,clientId:n.id,connectionId:null,encoding:null,id:null},this.enableSync=n.type!=="audience",this.roomId=`superviz:${s.toLowerCase()}-${i}`,this.shouldKickParticipantsOnHostLeave=S,this.apiKey=i,this.client||this.buildClient()}auth(n,s){let i=new hs.default.Rest({key:this.ablyKey}),{origin:S}=window.location;i.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:S,apiKey:this.apiKey}},(A,c)=>{A&&this.authenticationObserver.publish("realtime.authentication-failed"),s(A,c)})}join(n){let s=n?Object.assign({},n,{participantId:n.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(s),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{isGridModeEnable:n}))}setDrawing(n){let s=this.localRoomProperties;this.updateRoomProperties(Object.assign({},s,{drawing:n}))}setSyncProperty(n,s){var A;let i=(A=this.clientSyncPropertiesQueue[n])!=null?A:[],S=(c,d)=>({name:c,data:d,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(S(n,s),xy)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(i)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",n,s),this.clientSyncPropertiesQueue[n]||(this.clientSyncPropertiesQueue[n]=[]),this.clientSyncPropertiesQueue[n].push(S(n,s)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var s,i;if(n){let S=n.toString();if(this.participants&&this.participants[S])return(i=(s=this.participants[n])==null?void 0:s.data)==null?void 0:i.slotIndex}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:s}=n,i=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(i),this.participants&&this.participants[s]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onClientSyncChannelUpdate(n){let{name:s,data:i}=n,S={};S[s]=i,this.syncPropertiesObserver.publish(S),this.isLocalParticipantHost&&this.saveClientRoomState(s,i)}onReceiveBroadcastSync(n){n.data.forEach(i=>{var A;let S=i.clientId;this.participants[S]=i,(A=i.data)!=null&&A.isAudience||(this.participants[S].data=JSON.parse(this.participants[S].data),this.publishParticipantUpdate(this.participants[S]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new hs.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw this.logger.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,this.logger.log("REALTIME",`Realtime state did change. New state: ${ls[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,s)=>{this.supervizChannel.history((i,S)=>{var c;i&&s(i);let A=(c=S.items[0])==null?void 0:c.data;n(A||null)})})}fetchSyncClientProperty(n){return Qt(this,null,function*(){try{let s=yield new Promise((i,S)=>{this.clientRoomStateChannel.history((A,c)=>{var b;A&&S(A);let d=(b=c==null?void 0:c.items[0])==null?void 0:b.data;i(d||null)})});if(n&&!s[n])throw new Error(`Event ${n} not found in the history`);return n?s[n]:s}catch(s){this.logger.log("REALTIME","Error in fetch client realtime data",s.message),this.throw(s.message)}})}onStateChange(){var E,R,a;let n=(E=this.supervizChannelState)==null?void 0:E.current,s=(R=this.connectionState)==null?void 0:R.current,i=s==="connected",S=["initialized","connecting"].includes(s),A=["closed","closing"].includes(s)||["detaching","detached"].includes(n),c={[0]:A,[1]:S,[2]:!n&&i,[3]:n==="attaching",[4]:n==="attached"&&i,[-1]:n==="failed"||s==="failed",[-2]:s==="suspended"||n==="suspended"},d=Object.entries(c).find(([O,M])=>M&&O)[0],b=Number(d);if(b===2&&(this.currentReconnectAttempt=0),i&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(b===-2||b===-1)&&this.forceReconnect(),(a=this.connectionState)!=null&&a.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(b)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.supervizChannelState=n,this.onStateChange()}onJoinRoom(n){return Qt(this,null,function*(){var s;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(n),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((s=this.localRoomProperties)==null?void 0:s.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(n),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let s=n.data.participantId===this.hostParticipantId;n.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(n),s&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};nt();var gs=class{constructor({participant:o,group:n,shouldKickParticipantsOnHostLeave:s}){this.components=[];this.participants=[];this.addComponent=o=>{o.attach({localParticipant:this.participant,realtime:this.realtime})};this.removeComponent=o=>{o.detach()};this.subscribeToPubSubEvent=(o,n)=>{this.logger.log("launcher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(o,n)};this.unsubscribeFromPubSubEvent=(o,n)=>{this.logger.log("launcher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(o,n)};this.publishToPubSubEvent=(o,n)=>{this.logger.log("launcher service @ publishToPubSubEvent"),this.pubsub.publish(o,n)};this.fetchPubSubHistory=o=>this.pubsub.fetchHistory(o);this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:Cn.get("apiKey"),roomId:Cn.get("roomId"),shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.onParticipantListUpdate=o=>{this.logger.log("launcher service @ onParticipantListUpdate");let n=Object.values(o).map(i=>{var S,A,c,d,b;return{id:i.data.id,name:(S=i.data)==null?void 0:S.name,type:(A=i.data)==null?void 0:A.type,avatar:(c=i.data)==null?void 0:c.avatar,avatarConfig:(d=i.data)==null?void 0:d.avatarConfig,isHost:this.realtime.hostClientId===i.clientId,color:this.realtime.getSlotColor((b=i.data)==null?void 0:b.slotIndex).color}}),s=n.find(i=>{var S;return(i==null?void 0:i.id)===((S=this.participant)==null?void 0:S.id)});(0,ps.isEqual)(this.participants,n)||(this.participants=n,this.pubsub.publishEventToClient("participant.list-updated",n),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n)),s&&!(0,ps.isEqual)(this.participant,s)&&(this.participant=s,this.pubsub.publishEventToClient("participant.updated",s),this.logger.log("Publishing ParticipantEvent.UPDATED",s))};this.onParticipantJoined=o=>{this.logger.log("launcher service @ onParticipantJoined");let n=this.participants.find(s=>s.id===o.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.pubsub.publishEventToClient("participant.local-joined",n)),this.logger.log("launcher service @ onParticipantJoined - participant joined",n),this.pubsub.publishEventToClient("participant.joined",n))};this.onParticipantLeave=o=>{this.logger.log("launcher service @ onParticipantLeave");let n=this.participants.find(s=>s.id===o.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.pubsub.publishEventToClient("participant.local-left",n)),this.logger.log("launcher service @ onParticipantLeave - participant left",n),this.pubsub.publishEventToClient("participant.left",n))};this.onHostParticipantDidChange=o=>{let n=this.participants.find(s=>s.id===(o==null?void 0:o.newHostParticipantId));this.realtime.isLocalParticipantHost&&this.publishToPubSubEvent("realtime.host-change",n)};this.shouldKickParticipantsOnHostLeave=s!=null?s:!0,this.participant=o,this.group=n,this.logger=new xe("@superviz/sdk/launcher"),this.realtime=new Jn(Cn.get("apiUrl"),Cn.get("ablyKey")),this.pubsub=new yi(this.realtime),this.logger.log("launcher created"),this.startRealtime()}},fc=h=>{let o=new gs(h);return{subscribe:o.subscribeToPubSubEvent,unsubscribe:o.unsubscribeFromPubSubEvent,publish:o.publishToPubSubEvent,fetchHistory:o.fetchPubSubHistory,addComponent:o.addComponent,removeComponent:o.removeComponent}};var Dy=({group:h,participant:o,roomId:n})=>{if(!h||!h.name||!h.id)throw new Error("Group fields is required");if(!o||!o.id)throw new Error("Participants fields is required");if(!n)throw new Error("Room id is required")},Ny=(h,o)=>Qt(void 0,null,function*(){if(!(h&&h.trim()))throw new Error("API key is required");if(!o)throw new Error("Options is required");Dy(o),o.debug?vs.debug.enable("*"):vs.debug.disable();let{apiUrl:s,conferenceLayerUrl:i}=yield Kn.getRemoteConfig(o.environment);if(!(yield ic(s,h)))throw new Error("Failed to validate API key");let A=yield bn.fetchConfig(s,h);if(!A||!A.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:c}=A;return Cn.setConfig({apiUrl:s,ablyKey:c,apiKey:h,conferenceLayerUrl:i,environment:A,roomId:o.roomId,debug:o.debug}),fc(Object.assign({},o,{apiKey:h,ablyKey:c,conferenceLayerUrl:i,apiUrl:s}))}),ms=Ny;nt();nt();nt();nt();nt();var Ci=window,Si=Ci.ShadowRoot&&(Ci.ShadyCSS===void 0||Ci.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ys=Symbol(),dc=new WeakMap,br=class{constructor(o,n,s){if(this._$cssResult$=!0,s!==ys)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=o,this.t=n}get styleSheet(){let o=this.o,n=this.t;if(Si&&o===void 0){let s=n!==void 0&&n.length===1;s&&(o=dc.get(n)),o===void 0&&((this.o=o=new CSSStyleSheet).replaceSync(this.cssText),s&&dc.set(n,o))}return o}toString(){return this.cssText}},hc=h=>new br(typeof h=="string"?h:h+"",void 0,ys),As=(h,...o)=>{let n=h.length===1?h[0]:o.reduce((s,i,S)=>s+(A=>{if(A._$cssResult$===!0)return A.cssText;if(typeof A=="number")return A;throw Error("Value passed to 'css' function must be a 'css' function result: "+A+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+h[S+1],h[0]);return new br(n,h,ys)},bs=(h,o)=>{Si?h.adoptedStyleSheets=o.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet):o.forEach(n=>{let s=document.createElement("style"),i=Ci.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=n.cssText,h.appendChild(s)})},Oi=Si?h=>h:h=>h instanceof CSSStyleSheet?(o=>{let n="";for(let s of o.cssRules)n+=s.cssText;return hc(n)})(h):h;var Cs,Ri=window,pc=Ri.trustedTypes,Uy=pc?pc.emptyScript:"",gc=Ri.reactiveElementPolyfillSupport,Os={toAttribute(h,o){switch(o){case Boolean:h=h?Uy:null;break;case Object:case Array:h=h==null?h:JSON.stringify(h)}return h},fromAttribute(h,o){let n=h;switch(o){case Boolean:n=h!==null;break;case Number:n=h===null?null:Number(h);break;case Object:case Array:try{n=JSON.parse(h)}catch(s){n=null}}return n}},vc=(h,o)=>o!==h&&(o==o||h==h),Ss={attribute:!0,type:String,converter:Os,reflect:!1,hasChanged:vc},Rs="finalized",Ke=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(o){var n;this.finalize(),((n=this.h)!==null&&n!==void 0?n:this.h=[]).push(o)}static get observedAttributes(){this.finalize();let o=[];return this.elementProperties.forEach((n,s)=>{let i=this._$Ep(s,n);i!==void 0&&(this._$Ev.set(i,s),o.push(i))}),o}static createProperty(o,n=Ss){if(n.state&&(n.attribute=!1),this.finalize(),this.elementProperties.set(o,n),!n.noAccessor&&!this.prototype.hasOwnProperty(o)){let s=typeof o=="symbol"?Symbol():"__"+o,i=this.getPropertyDescriptor(o,s,n);i!==void 0&&Object.defineProperty(this.prototype,o,i)}}static getPropertyDescriptor(o,n,s){return{get(){return this[n]},set(i){let S=this[o];this[n]=i,this.requestUpdate(o,S,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(o){return this.elementProperties.get(o)||Ss}static finalize(){if(this.hasOwnProperty(Rs))return!1;this[Rs]=!0;let o=Object.getPrototypeOf(this);if(o.finalize(),o.h!==void 0&&(this.h=[...o.h]),this.elementProperties=new Map(o.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){let n=this.properties,s=[...Object.getOwnPropertyNames(n),...Object.getOwnPropertySymbols(n)];for(let i of s)this.createProperty(i,n[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(o){let n=[];if(Array.isArray(o)){let s=new Set(o.flat(1/0).reverse());for(let i of s)n.unshift(Oi(i))}else o!==void 0&&n.push(Oi(o));return n}static _$Ep(o,n){let s=n.attribute;return s===!1?void 0:typeof s=="string"?s:typeof o=="string"?o.toLowerCase():void 0}u(){var o;this._$E_=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(o=this.constructor.h)===null||o===void 0||o.forEach(n=>n(this))}addController(o){var n,s;((n=this._$ES)!==null&&n!==void 0?n:this._$ES=[]).push(o),this.renderRoot!==void 0&&this.isConnected&&((s=o.hostConnected)===null||s===void 0||s.call(o))}removeController(o){var n;(n=this._$ES)===null||n===void 0||n.splice(this._$ES.indexOf(o)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((o,n)=>{this.hasOwnProperty(n)&&(this._$Ei.set(n,this[n]),delete this[n])})}createRenderRoot(){var o;let n=(o=this.shadowRoot)!==null&&o!==void 0?o:this.attachShadow(this.constructor.shadowRootOptions);return bs(n,this.constructor.elementStyles),n}connectedCallback(){var o;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(o=this._$ES)===null||o===void 0||o.forEach(n=>{var s;return(s=n.hostConnected)===null||s===void 0?void 0:s.call(n)})}enableUpdating(o){}disconnectedCallback(){var o;(o=this._$ES)===null||o===void 0||o.forEach(n=>{var s;return(s=n.hostDisconnected)===null||s===void 0?void 0:s.call(n)})}attributeChangedCallback(o,n,s){this._$AK(o,s)}_$EO(o,n,s=Ss){var i;let S=this.constructor._$Ep(o,s);if(S!==void 0&&s.reflect===!0){let A=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:Os).toAttribute(n,s.type);this._$El=o,A==null?this.removeAttribute(S):this.setAttribute(S,A),this._$El=null}}_$AK(o,n){var s;let i=this.constructor,S=i._$Ev.get(o);if(S!==void 0&&this._$El!==S){let A=i.getPropertyOptions(S),c=typeof A.converter=="function"?{fromAttribute:A.converter}:((s=A.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?A.converter:Os;this._$El=S,this[S]=c.fromAttribute(n,A.type),this._$El=null}}requestUpdate(o,n,s){let i=!0;o!==void 0&&(((s=s||this.constructor.getPropertyOptions(o)).hasChanged||vc)(this[o],n)?(this._$AL.has(o)||this._$AL.set(o,n),s.reflect===!0&&this._$El!==o&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(o,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}_$Ej(){return Qt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(n){Promise.reject(n)}let o=this.scheduleUpdate();return o!=null&&(yield o),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var o;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,S)=>this[S]=i),this._$Ei=void 0);let n=!1,s=this._$AL;try{n=this.shouldUpdate(s),n?(this.willUpdate(s),(o=this._$ES)===null||o===void 0||o.forEach(i=>{var S;return(S=i.hostUpdate)===null||S===void 0?void 0:S.call(i)}),this.update(s)):this._$Ek()}catch(i){throw n=!1,this._$Ek(),i}n&&this._$AE(s)}willUpdate(o){}_$AE(o){var n;(n=this._$ES)===null||n===void 0||n.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(o)),this.updated(o)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(o){return!0}update(o){this._$EC!==void 0&&(this._$EC.forEach((n,s)=>this._$EO(s,this[s],n)),this._$EC=void 0),this._$Ek()}updated(o){}firstUpdated(o){}};Ke[Rs]=!0,Ke.elementProperties=new Map,Ke.elementStyles=[],Ke.shadowRootOptions={mode:"open"},gc==null||gc({ReactiveElement:Ke}),((Cs=Ri.reactiveElementVersions)!==null&&Cs!==void 0?Cs:Ri.reactiveElementVersions=[]).push("1.6.2");nt();var Es,Ei=window,qn=Ei.trustedTypes,mc=qn?qn.createPolicy("lit-html",{createHTML:h=>h}):void 0,_s="$lit$",sn=`lit$${(Math.random()+"").slice(9)}$`,Rc="?"+sn,By=`<${Rc}>`,Rn=document,Sr=()=>Rn.createComment(""),Or=h=>h===null||typeof h!="object"&&typeof h!="function",Ec=Array.isArray,Fy=h=>Ec(h)||typeof(h==null?void 0:h[Symbol.iterator])=="function",Ts=`[ 	
\f\r]`,Cr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,yc=/-->/g,Ac=/>/g,Sn=RegExp(`>|${Ts}(?:([^\\s"'>=/]+)(${Ts}*=${Ts}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),bc=/'/g,Cc=/"/g,Tc=/^(?:script|style|textarea|title)$/i,_c=h=>(o,...n)=>({_$litType$:h,strings:o,values:n}),Pc=_c(1),sb=_c(2),En=Symbol.for("lit-noChange"),ee=Symbol.for("lit-nothing"),Sc=new WeakMap,On=Rn.createTreeWalker(Rn,129,null,!1);function Ic(h,o){if(!Array.isArray(h)||!h.hasOwnProperty("raw"))throw Error("invalid template strings array");return mc!==void 0?mc.createHTML(o):o}var Gy=(h,o)=>{let n=h.length-1,s=[],i,S=o===2?"<svg>":"",A=Cr;for(let c=0;c<n;c++){let d=h[c],b,E,R=-1,a=0;for(;a<d.length&&(A.lastIndex=a,E=A.exec(d),E!==null);)a=A.lastIndex,A===Cr?E[1]==="!--"?A=yc:E[1]!==void 0?A=Ac:E[2]!==void 0?(Tc.test(E[2])&&(i=RegExp("</"+E[2],"g")),A=Sn):E[3]!==void 0&&(A=Sn):A===Sn?E[0]===">"?(A=i!=null?i:Cr,R=-1):E[1]===void 0?R=-2:(R=A.lastIndex-E[2].length,b=E[1],A=E[3]===void 0?Sn:E[3]==='"'?Cc:bc):A===Cc||A===bc?A=Sn:A===yc||A===Ac?A=Cr:(A=Sn,i=void 0);let O=A===Sn&&h[c+1].startsWith("/>")?" ":"";S+=A===Cr?d+By:R>=0?(s.push(b),d.slice(0,R)+_s+d.slice(R)+sn+O):d+sn+(R===-2?(s.push(void 0),c):O)}return[Ic(h,S+(h[n]||"<?>")+(o===2?"</svg>":"")),s]},Tn=class{constructor({strings:o,_$litType$:n},s){let i;this.parts=[];let S=0,A=0,c=o.length-1,d=this.parts,[b,E]=Gy(o,n);if(this.el=Tn.createElement(b,s),On.currentNode=this.el.content,n===2){let R=this.el.content,a=R.firstChild;a.remove(),R.append(...a.childNodes)}for(;(i=On.nextNode())!==null&&d.length<c;){if(i.nodeType===1){if(i.hasAttributes()){let R=[];for(let a of i.getAttributeNames())if(a.endsWith(_s)||a.startsWith(sn)){let O=E[A++];if(R.push(a),O!==void 0){let M=i.getAttribute(O.toLowerCase()+_s).split(sn),w=/([.?@])?(.*)/.exec(O);d.push({type:1,index:S,name:w[2],strings:M,ctor:w[1]==="."?Is:w[1]==="?"?ws:w[1]==="@"?Ms:Yn})}else d.push({type:6,index:S})}for(let a of R)i.removeAttribute(a)}if(Tc.test(i.tagName)){let R=i.textContent.split(sn),a=R.length-1;if(a>0){i.textContent=qn?qn.emptyScript:"";for(let O=0;O<a;O++)i.append(R[O],Sr()),On.nextNode(),d.push({type:2,index:++S});i.append(R[a],Sr())}}}else if(i.nodeType===8)if(i.data===Rc)d.push({type:2,index:S});else{let R=-1;for(;(R=i.data.indexOf(sn,R+1))!==-1;)d.push({type:7,index:S}),R+=sn.length-1}S++}}static createElement(o,n){let s=Rn.createElement("template");return s.innerHTML=o,s}};function Qn(h,o,n=h,s){var i,S,A,c;if(o===En)return o;let d=s!==void 0?(i=n._$Co)===null||i===void 0?void 0:i[s]:n._$Cl,b=Or(o)?void 0:o._$litDirective$;return(d==null?void 0:d.constructor)!==b&&((S=d==null?void 0:d._$AO)===null||S===void 0||S.call(d,!1),b===void 0?d=void 0:(d=new b(h),d._$AT(h,n,s)),s!==void 0?((A=(c=n)._$Co)!==null&&A!==void 0?A:c._$Co=[])[s]=d:n._$Cl=d),d!==void 0&&(o=Qn(h,d._$AS(h,o.values),d,s)),o}var Ps=class{constructor(o,n){this._$AV=[],this._$AN=void 0,this._$AD=o,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(o){var n;let{el:{content:s},parts:i}=this._$AD,S=((n=o==null?void 0:o.creationScope)!==null&&n!==void 0?n:Rn).importNode(s,!0);On.currentNode=S;let A=On.nextNode(),c=0,d=0,b=i[0];for(;b!==void 0;){if(c===b.index){let E;b.type===2?E=new _n(A,A.nextSibling,this,o):b.type===1?E=new b.ctor(A,b.name,b.strings,this,o):b.type===6&&(E=new xs(A,this,o)),this._$AV.push(E),b=i[++d]}c!==(b==null?void 0:b.index)&&(A=On.nextNode(),c++)}return On.currentNode=Rn,S}v(o){let n=0;for(let s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(o,s,n),n+=s.strings.length-2):s._$AI(o[n])),n++}},_n=class{constructor(o,n,s,i){var S;this.type=2,this._$AH=ee,this._$AN=void 0,this._$AA=o,this._$AB=n,this._$AM=s,this.options=i,this._$Cp=(S=i==null?void 0:i.isConnected)===null||S===void 0||S}get _$AU(){var o,n;return(n=(o=this._$AM)===null||o===void 0?void 0:o._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let o=this._$AA.parentNode,n=this._$AM;return n!==void 0&&(o==null?void 0:o.nodeType)===11&&(o=n.parentNode),o}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(o,n=this){o=Qn(this,o,n),Or(o)?o===ee||o==null||o===""?(this._$AH!==ee&&this._$AR(),this._$AH=ee):o!==this._$AH&&o!==En&&this._(o):o._$litType$!==void 0?this.g(o):o.nodeType!==void 0?this.$(o):Fy(o)?this.T(o):this._(o)}k(o){return this._$AA.parentNode.insertBefore(o,this._$AB)}$(o){this._$AH!==o&&(this._$AR(),this._$AH=this.k(o))}_(o){this._$AH!==ee&&Or(this._$AH)?this._$AA.nextSibling.data=o:this.$(Rn.createTextNode(o)),this._$AH=o}g(o){var n;let{values:s,_$litType$:i}=o,S=typeof i=="number"?this._$AC(o):(i.el===void 0&&(i.el=Tn.createElement(Ic(i.h,i.h[0]),this.options)),i);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===S)this._$AH.v(s);else{let A=new Ps(S,this),c=A.u(this.options);A.v(s),this.$(c),this._$AH=A}}_$AC(o){let n=Sc.get(o.strings);return n===void 0&&Sc.set(o.strings,n=new Tn(o)),n}T(o){Ec(this._$AH)||(this._$AH=[],this._$AR());let n=this._$AH,s,i=0;for(let S of o)i===n.length?n.push(s=new _n(this.k(Sr()),this.k(Sr()),this,this.options)):s=n[i],s._$AI(S),i++;i<n.length&&(this._$AR(s&&s._$AB.nextSibling,i),n.length=i)}_$AR(o=this._$AA.nextSibling,n){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,n);o&&o!==this._$AB;){let i=o.nextSibling;o.remove(),o=i}}setConnected(o){var n;this._$AM===void 0&&(this._$Cp=o,(n=this._$AP)===null||n===void 0||n.call(this,o))}},Yn=class{constructor(o,n,s,i,S){this.type=1,this._$AH=ee,this._$AN=void 0,this.element=o,this.name=n,this._$AM=i,this.options=S,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=ee}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(o,n=this,s,i){let S=this.strings,A=!1;if(S===void 0)o=Qn(this,o,n,0),A=!Or(o)||o!==this._$AH&&o!==En,A&&(this._$AH=o);else{let c=o,d,b;for(o=S[0],d=0;d<S.length-1;d++)b=Qn(this,c[s+d],n,d),b===En&&(b=this._$AH[d]),A||(A=!Or(b)||b!==this._$AH[d]),b===ee?o=ee:o!==ee&&(o+=(b!=null?b:"")+S[d+1]),this._$AH[d]=b}A&&!i&&this.j(o)}j(o){o===ee?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,o!=null?o:"")}},Is=class extends Yn{constructor(){super(...arguments),this.type=3}j(o){this.element[this.name]=o===ee?void 0:o}},Hy=qn?qn.emptyScript:"",ws=class extends Yn{constructor(){super(...arguments),this.type=4}j(o){o&&o!==ee?this.element.setAttribute(this.name,Hy):this.element.removeAttribute(this.name)}},Ms=class extends Yn{constructor(o,n,s,i,S){super(o,n,s,i,S),this.type=5}_$AI(o,n=this){var s;if((o=(s=Qn(this,o,n,0))!==null&&s!==void 0?s:ee)===En)return;let i=this._$AH,S=o===ee&&i!==ee||o.capture!==i.capture||o.once!==i.once||o.passive!==i.passive,A=o!==ee&&(i===ee||S);S&&this.element.removeEventListener(this.name,this,i),A&&this.element.addEventListener(this.name,this,o),this._$AH=o}handleEvent(o){var n,s;typeof this._$AH=="function"?this._$AH.call((s=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&s!==void 0?s:this.element,o):this._$AH.handleEvent(o)}},xs=class{constructor(o,n,s){this.element=o,this.type=6,this._$AN=void 0,this._$AM=n,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(o){Qn(this,o)}};var Oc=Ei.litHtmlPolyfillSupport;Oc==null||Oc(Tn,_n),((Es=Ei.litHtmlVersions)!==null&&Es!==void 0?Es:Ei.litHtmlVersions=[]).push("2.7.5");var wc=(h,o,n)=>{var s,i;let S=(s=n==null?void 0:n.renderBefore)!==null&&s!==void 0?s:o,A=S._$litPart$;if(A===void 0){let c=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:null;S._$litPart$=A=new _n(o.insertBefore(Sr(),c),c,void 0,n!=null?n:{})}return A._$AI(h),A};nt();var Ls,Ds;var an=class extends Ke{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var o,n;let s=super.createRenderRoot();return(o=(n=this.renderOptions).renderBefore)!==null&&o!==void 0||(n.renderBefore=s.firstChild),s}update(o){let n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(o),this._$Do=wc(n,this.renderRoot,this.renderOptions)}connectedCallback(){var o;super.connectedCallback(),(o=this._$Do)===null||o===void 0||o.setConnected(!0)}disconnectedCallback(){var o;super.disconnectedCallback(),(o=this._$Do)===null||o===void 0||o.setConnected(!1)}render(){return En}};an.finalized=!0,an._$litElement$=!0,(Ls=globalThis.litElementHydrateSupport)===null||Ls===void 0||Ls.call(globalThis,{LitElement:an});var Mc=globalThis.litElementPolyfillSupport;Mc==null||Mc({LitElement:an});((Ds=globalThis.litElementVersions)!==null&&Ds!==void 0?Ds:globalThis.litElementVersions=[]).push("3.3.2");nt();nt();nt();var xc=h=>o=>typeof o=="function"?((n,s)=>(customElements.define(n,s),s))(h,o):((n,s)=>{let{kind:i,elements:S}=s;return{kind:i,elements:S,finisher(A){customElements.define(n,A)}}})(h,o);nt();nt();nt();nt();nt();nt();nt();nt();var Ns,Db=((Ns=window.HTMLSlotElement)===null||Ns===void 0?void 0:Ns.prototype.assignedElements)!=null?(h,o)=>h.assignedElements(o):(h,o)=>h.assignedNodes(o).filter(n=>n.nodeType===Node.ELEMENT_NODE);nt();var Pn=class extends an{render(){return Pc` <div>Hello from SuperViz, ${this.name}</div> `}};Pn.properties={name:{type:String}},Pn.styles=As`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,Pn=yl([xc("superviz-hello-world")],Pn);nt();var Be=on(Lc()),Bs=class{constructor(){this.browser=Be.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Be.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Be.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Be.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Be.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Be.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Be.default.PLATFORMS_MAP.mobile)||this.browser.is(Be.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Be.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};nt();nt();nt();nt();nt();nt();window&&(window.SuperVizSdk={init:ms,MeetingEvent:qo,DeviceEvent:Zo,RealtimeEvent:vr,MeetingState:Yo,MeetingConnectionStatus:Xo,MeetingControlsEvent:Qo,ParticipantEvent:pi});var o1=ms;export{Bs as BrowserService,Zo as DeviceEvent,Xo as MeetingConnectionStatus,Qo as MeetingControlsEvent,qo as MeetingEvent,Yo as MeetingState,pi as ParticipantEvent,us as ParticipantType,vr as RealtimeEvent,o1 as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
