var TS=Object.create;var $i=Object.defineProperty,OS=Object.defineProperties,Qd=Object.getOwnPropertyDescriptor,wS=Object.getOwnPropertyDescriptors,IS=Object.getOwnPropertyNames,Is=Object.getOwnPropertySymbols,MS=Object.getPrototypeOf,Du=Object.prototype.hasOwnProperty,Xd=Object.prototype.propertyIsEnumerable;var eh=Math.pow,Yd=(s,e,t)=>e in s?$i(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fe=(s,e)=>{for(var t in e||(e={}))Du.call(e,t)&&Yd(s,t,e[t]);if(Is)for(var t of Is(e))Xd.call(e,t)&&Yd(s,t,e[t]);return s},Xe=(s,e)=>OS(s,wS(e));var Nu=(s,e)=>{var t={};for(var i in s)Du.call(s,i)&&e.indexOf(i)<0&&(t[i]=s[i]);if(s!=null&&Is)for(var i of Is(s))e.indexOf(i)<0&&Xd.call(s,i)&&(t[i]=s[i]);return t};var Fu=(s,e)=>()=>(s&&(e=s(s=0)),e);var mt=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),th=(s,e)=>{for(var t in e)$i(s,t,{get:e[t],enumerable:!0})},RS=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of IS(e))!Du.call(s,o)&&o!==t&&$i(s,o,{get:()=>e[o],enumerable:!(i=Qd(e,o))||i.enumerable});return s};var Pn=(s,e,t)=>(t=s!=null?TS(MS(s)):{},RS(e||!s||!s.__esModule?$i(t,"default",{value:s,enumerable:!0}):t,s));var He=(s,e,t,i)=>{for(var o=i>1?void 0:i?Qd(e,t):e,l=s.length-1,c;l>=0;l--)(c=s[l])&&(o=(i?c(e,t,o):c(o))||o);return i&&o&&$i(e,t,o),o};var Le=(s,e,t)=>new Promise((i,o)=>{var l=f=>{try{u(t.next(f))}catch(m){o(m)}},c=f=>{try{u(t.throw(f))}catch(m){o(m)}},u=f=>f.done?i(f.value):Promise.resolve(f.value).then(l,c);u((t=t.apply(s,e)).next())});var ee,k=Fu(()=>{ee={}});var rh=mt((WO,nh)=>{k();var Yr=1e3,Qr=Yr*60,Xr=Qr*60,dr=Xr*24,_S=dr*7,PS=dr*365.25;nh.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return LS(s);if(t==="number"&&isFinite(s))return e.long?NS(s):DS(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function LS(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!e){var t=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return t*PS;case"weeks":case"week":case"w":return t*_S;case"days":case"day":case"d":return t*dr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Xr;case"minutes":case"minute":case"mins":case"min":case"m":return t*Qr;case"seconds":case"second":case"secs":case"sec":case"s":return t*Yr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function DS(s){var e=Math.abs(s);return e>=dr?Math.round(s/dr)+"d":e>=Xr?Math.round(s/Xr)+"h":e>=Qr?Math.round(s/Qr)+"m":e>=Yr?Math.round(s/Yr)+"s":s+"ms"}function NS(s){var e=Math.abs(s);return e>=dr?_s(s,e,dr,"day"):e>=Xr?_s(s,e,Xr,"hour"):e>=Qr?_s(s,e,Qr,"minute"):e>=Yr?_s(s,e,Yr,"second"):s+" ms"}function _s(s,e,t,i){var o=e>=t*1.5;return Math.round(s/t)+" "+i+(o?"s":"")}});var oh=mt(($O,ih)=>{k();function FS(s){t.debug=t,t.default=t,t.coerce=f,t.disable=l,t.enable=o,t.enabled=c,t.humanize=rh(),t.destroy=m,Object.keys(s).forEach(E=>{t[E]=s[E]}),t.names=[],t.skips=[],t.formatters={};function e(E){let O=0;for(let d=0;d<E.length;d++)O=(O<<5)-O+E.charCodeAt(d),O|=0;return t.colors[Math.abs(O)%t.colors.length]}t.selectColor=e;function t(E){let O,d=null,A,I;function x(...T){if(!x.enabled)return;let S=x,w=Number(new Date),p=w-(O||w);S.diff=p,S.prev=O,S.curr=w,O=w,T[0]=t.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let y=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(v,h)=>{if(v==="%%")return"%";y++;let C=t.formatters[h];if(typeof C=="function"){let M=T[y];v=C.call(S,M),T.splice(y,1),y--}return v}),t.formatArgs.call(S,T),(S.log||t.log).apply(S,T)}return x.namespace=E,x.useColors=t.useColors(),x.color=t.selectColor(E),x.extend=i,x.destroy=t.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(A!==t.namespaces&&(A=t.namespaces,I=t.enabled(E)),I),set:T=>{d=T}}),typeof t.init=="function"&&t.init(x),x}function i(E,O){let d=t(this.namespace+(typeof O=="undefined"?":":O)+E);return d.log=this.log,d}function o(E){t.save(E),t.namespaces=E,t.names=[],t.skips=[];let O,d=(typeof E=="string"?E:"").split(/[\s,]+/),A=d.length;for(O=0;O<A;O++)!d[O]||(E=d[O].replace(/\*/g,".*?"),E[0]==="-"?t.skips.push(new RegExp("^"+E.slice(1)+"$")):t.names.push(new RegExp("^"+E+"$")))}function l(){let E=[...t.names.map(u),...t.skips.map(u).map(O=>"-"+O)].join(",");return t.enable(""),E}function c(E){if(E[E.length-1]==="*")return!0;let O,d;for(O=0,d=t.skips.length;O<d;O++)if(t.skips[O].test(E))return!1;for(O=0,d=t.names.length;O<d;O++)if(t.names[O].test(E))return!0;return!1}function u(E){return E.toString().substring(2,E.toString().length-2).replace(/\.\*\?$/,"*")}function f(E){return E instanceof Error?E.stack||E.message:E}function m(){}return t.enable(t.load()),t}ih.exports=FS});var Bu=mt((Kt,Ps)=>{k();Kt.formatArgs=BS;Kt.save=kS;Kt.load=GS;Kt.useColors=US;Kt.storage=HS();Kt.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Kt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function US(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function BS(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+Ps.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,i=0;s[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(i=t))}),s.splice(i,0,e)}Kt.log=console.debug||console.log||(()=>{});function kS(s){try{s?Kt.storage.setItem("debug",s):Kt.storage.removeItem("debug")}catch(e){}}function GS(){let s;try{s=Kt.storage.getItem("debug")}catch(e){}return!s&&typeof process!="undefined"&&"env"in process&&(s=ee.DEBUG),s}function HS(){try{return localStorage}catch(s){}}Ps.exports=oh()(Kt);var{formatters:WS}=Ps.exports;WS.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Ls=mt((VO,ah)=>{k();function $S(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}ah.exports=$S});var lh=mt((jO,uh)=>{k();var zS=typeof global=="object"&&global&&global.Object===Object&&global;uh.exports=zS});var ku=mt((KO,ch)=>{k();var VS=lh(),jS=typeof self=="object"&&self&&self.Object===Object&&self,KS=VS||jS||Function("return this")();ch.exports=KS});var dh=mt((JO,fh)=>{k();var JS=ku(),ZS=function(){return JS.Date.now()};fh.exports=ZS});var ph=mt((ZO,hh)=>{k();var qS=/\s/;function YS(s){for(var e=s.length;e--&&qS.test(s.charAt(e)););return e}hh.exports=YS});var gh=mt((qO,mh)=>{k();var QS=ph(),XS=/^\s+/;function eC(s){return s&&s.slice(0,QS(s)+1).replace(XS,"")}mh.exports=eC});var Gu=mt((YO,vh)=>{k();var tC=ku(),nC=tC.Symbol;vh.exports=nC});var Ah=mt((QO,Eh)=>{k();var yh=Gu(),bh=Object.prototype,rC=bh.hasOwnProperty,iC=bh.toString,Ki=yh?yh.toStringTag:void 0;function oC(s){var e=rC.call(s,Ki),t=s[Ki];try{s[Ki]=void 0;var i=!0}catch(l){}var o=iC.call(s);return i&&(e?s[Ki]=t:delete s[Ki]),o}Eh.exports=oC});var Ch=mt((XO,Sh)=>{k();var sC=Object.prototype,aC=sC.toString;function uC(s){return aC.call(s)}Sh.exports=uC});var Ih=mt((e1,wh)=>{k();var Th=Gu(),lC=Ah(),cC=Ch(),fC="[object Null]",dC="[object Undefined]",Oh=Th?Th.toStringTag:void 0;function hC(s){return s==null?s===void 0?dC:fC:Oh&&Oh in Object(s)?lC(s):cC(s)}wh.exports=hC});var Rh=mt((t1,Mh)=>{k();function pC(s){return s!=null&&typeof s=="object"}Mh.exports=pC});var _h=mt((n1,xh)=>{k();var mC=Ih(),gC=Rh(),vC="[object Symbol]";function yC(s){return typeof s=="symbol"||gC(s)&&mC(s)==vC}xh.exports=yC});var Nh=mt((r1,Dh)=>{k();var bC=gh(),Ph=Ls(),EC=_h(),Lh=0/0,AC=/^[-+]0x[0-9a-f]+$/i,SC=/^0b[01]+$/i,CC=/^0o[0-7]+$/i,TC=parseInt;function OC(s){if(typeof s=="number")return s;if(EC(s))return Lh;if(Ph(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=Ph(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=bC(s);var t=SC.test(s);return t||CC.test(s)?TC(s.slice(2),t?2:8):AC.test(s)?Lh:+s}Dh.exports=OC});var Bh=mt((i1,Uh)=>{k();var wC=Ls(),Hu=dh(),Fh=Nh(),IC="Expected a function",MC=Math.max,RC=Math.min;function xC(s,e,t){var i,o,l,c,u,f,m=0,E=!1,O=!1,d=!0;if(typeof s!="function")throw new TypeError(IC);e=Fh(e)||0,wC(t)&&(E=!!t.leading,O="maxWait"in t,l=O?MC(Fh(t.maxWait)||0,e):l,d="trailing"in t?!!t.trailing:d);function A(v){var h=i,C=o;return i=o=void 0,m=v,c=s.apply(C,h),c}function I(v){return m=v,u=setTimeout(S,e),E?A(v):c}function x(v){var h=v-f,C=v-m,M=e-h;return O?RC(M,l-C):M}function T(v){var h=v-f,C=v-m;return f===void 0||h>=e||h<0||O&&C>=l}function S(){var v=Hu();if(T(v))return w(v);u=setTimeout(S,x(v))}function w(v){return u=void 0,d&&i?A(v):(i=o=void 0,c)}function p(){u!==void 0&&clearTimeout(u),m=0,i=f=o=u=void 0}function y(){return u===void 0?c:w(Hu())}function g(){var v=Hu(),h=T(v);if(i=arguments,o=this,f=v,h){if(u===void 0)return I(f);if(O)return clearTimeout(u),u=setTimeout(S,e),A(f)}return u===void 0&&(u=setTimeout(S,e)),c}return g.cancel=p,g.flush=y,g}Uh.exports=xC});var Wu=mt((o1,kh)=>{k();var _C=Bh(),PC=Ls(),LC="Expected a function";function DC(s,e,t){var i=!0,o=!0;if(typeof s!="function")throw new TypeError(LC);return PC(t)&&(i="leading"in t?!!t.leading:i,o="trailing"in t?!!t.trailing:o),_C(s,e,{leading:i,maxWait:e,trailing:o})}kh.exports=DC});var Ds=mt((ei,Ji)=>{k();(function(){var s,e="4.17.21",t=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",u=500,f="__lodash_placeholder__",m=1,E=2,O=4,d=1,A=2,I=1,x=2,T=4,S=8,w=16,p=32,y=64,g=128,v=256,h=512,C=30,M="...",L=800,$=16,H=1,F=2,R=3,P=1/0,z=9007199254740991,W=17976931348623157e292,Z=0/0,te=4294967295,Y=te-1,G=te>>>1,N=[["ary",g],["bind",I],["bindKey",x],["curry",S],["curryRight",w],["flip",h],["partial",p],["partialRight",y],["rearg",v]],U="[object Arguments]",K="[object Array]",j="[object AsyncFunction]",ne="[object Boolean]",ce="[object Date]",Ee="[object DOMException]",be="[object Error]",_e="[object Function]",Ke="[object GeneratorFunction]",pe="[object Map]",Ve="[object Number]",St="[object Null]",et="[object Object]",st="[object Promise]",Nt="[object Proxy]",X="[object RegExp]",oe="[object Set]",le="[object String]",ge="[object Symbol]",De="[object Undefined]",gt="[object WeakMap]",tr="[object WeakSet]",Ii="[object ArrayBuffer]",Ur="[object DataView]",ha="[object Float32Array]",pa="[object Float64Array]",ma="[object Int8Array]",ga="[object Int16Array]",va="[object Int32Array]",ya="[object Uint8Array]",ba="[object Uint8ClampedArray]",Ea="[object Uint16Array]",Aa="[object Uint32Array]",Vm=/\b__p \+= '';/g,jm=/\b(__p \+=) '' \+/g,Km=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ac=/&(?:amp|lt|gt|quot|#39);/g,Sc=/[&<>"']/g,Jm=RegExp(Ac.source),Zm=RegExp(Sc.source),qm=/<%-([\s\S]+?)%>/g,Ym=/<%([\s\S]+?)%>/g,Cc=/<%=([\s\S]+?)%>/g,Qm=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xm=/^\w*$/,eg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Sa=/[\\^$.*+?()[\]{}|]/g,tg=RegExp(Sa.source),Ca=/^\s+/,ng=/\s/,rg=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ig=/\{\n\/\* \[wrapped with (.+)\] \*/,og=/,? & /,sg=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ag=/[()=,{}\[\]\/\s]/,ug=/\\(\\)?/g,lg=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Tc=/\w*$/,cg=/^[-+]0x[0-9a-f]+$/i,fg=/^0b[01]+$/i,dg=/^\[object .+?Constructor\]$/,hg=/^0o[0-7]+$/i,pg=/^(?:0|[1-9]\d*)$/,mg=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ko=/($^)/,gg=/['\n\r\u2028\u2029\\]/g,Go="\\ud800-\\udfff",vg="\\u0300-\\u036f",yg="\\ufe20-\\ufe2f",bg="\\u20d0-\\u20ff",Oc=vg+yg+bg,wc="\\u2700-\\u27bf",Ic="a-z\\xdf-\\xf6\\xf8-\\xff",Eg="\\xac\\xb1\\xd7\\xf7",Ag="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Sg="\\u2000-\\u206f",Cg=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Mc="A-Z\\xc0-\\xd6\\xd8-\\xde",Rc="\\ufe0e\\ufe0f",xc=Eg+Ag+Sg+Cg,Ta="['\u2019]",Tg="["+Go+"]",_c="["+xc+"]",Ho="["+Oc+"]",Pc="\\d+",Og="["+wc+"]",Lc="["+Ic+"]",Dc="[^"+Go+xc+Pc+wc+Ic+Mc+"]",Oa="\\ud83c[\\udffb-\\udfff]",wg="(?:"+Ho+"|"+Oa+")",Nc="[^"+Go+"]",wa="(?:\\ud83c[\\udde6-\\uddff]){2}",Ia="[\\ud800-\\udbff][\\udc00-\\udfff]",Br="["+Mc+"]",Fc="\\u200d",Uc="(?:"+Lc+"|"+Dc+")",Ig="(?:"+Br+"|"+Dc+")",Bc="(?:"+Ta+"(?:d|ll|m|re|s|t|ve))?",kc="(?:"+Ta+"(?:D|LL|M|RE|S|T|VE))?",Gc=wg+"?",Hc="["+Rc+"]?",Mg="(?:"+Fc+"(?:"+[Nc,wa,Ia].join("|")+")"+Hc+Gc+")*",Rg="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xg="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Wc=Hc+Gc+Mg,_g="(?:"+[Og,wa,Ia].join("|")+")"+Wc,Pg="(?:"+[Nc+Ho+"?",Ho,wa,Ia,Tg].join("|")+")",Lg=RegExp(Ta,"g"),Dg=RegExp(Ho,"g"),Ma=RegExp(Oa+"(?="+Oa+")|"+Pg+Wc,"g"),Ng=RegExp([Br+"?"+Lc+"+"+Bc+"(?="+[_c,Br,"$"].join("|")+")",Ig+"+"+kc+"(?="+[_c,Br+Uc,"$"].join("|")+")",Br+"?"+Uc+"+"+Bc,Br+"+"+kc,xg,Rg,Pc,_g].join("|"),"g"),Fg=RegExp("["+Fc+Go+Oc+Rc+"]"),Ug=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Bg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],kg=-1,ot={};ot[ha]=ot[pa]=ot[ma]=ot[ga]=ot[va]=ot[ya]=ot[ba]=ot[Ea]=ot[Aa]=!0,ot[U]=ot[K]=ot[Ii]=ot[ne]=ot[Ur]=ot[ce]=ot[be]=ot[_e]=ot[pe]=ot[Ve]=ot[et]=ot[X]=ot[oe]=ot[le]=ot[gt]=!1;var it={};it[U]=it[K]=it[Ii]=it[Ur]=it[ne]=it[ce]=it[ha]=it[pa]=it[ma]=it[ga]=it[va]=it[pe]=it[Ve]=it[et]=it[X]=it[oe]=it[le]=it[ge]=it[ya]=it[ba]=it[Ea]=it[Aa]=!0,it[be]=it[_e]=it[gt]=!1;var Gg={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Hg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wg={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},$g={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},zg=parseFloat,Vg=parseInt,$c=typeof global=="object"&&global&&global.Object===Object&&global,jg=typeof self=="object"&&self&&self.Object===Object&&self,Ct=$c||jg||Function("return this")(),Ra=typeof ei=="object"&&ei&&!ei.nodeType&&ei,nr=Ra&&typeof Ji=="object"&&Ji&&!Ji.nodeType&&Ji,zc=nr&&nr.exports===Ra,xa=zc&&$c.process,Zt=function(){try{var q=nr&&nr.require&&nr.require("util").types;return q||xa&&xa.binding&&xa.binding("util")}catch(ie){}}(),Vc=Zt&&Zt.isArrayBuffer,jc=Zt&&Zt.isDate,Kc=Zt&&Zt.isMap,Jc=Zt&&Zt.isRegExp,Zc=Zt&&Zt.isSet,qc=Zt&&Zt.isTypedArray;function Ht(q,ie,re){switch(re.length){case 0:return q.call(ie);case 1:return q.call(ie,re[0]);case 2:return q.call(ie,re[0],re[1]);case 3:return q.call(ie,re[0],re[1],re[2])}return q.apply(ie,re)}function Kg(q,ie,re,me){for(var Ie=-1,Je=q==null?0:q.length;++Ie<Je;){var yt=q[Ie];ie(me,yt,re(yt),q)}return me}function qt(q,ie){for(var re=-1,me=q==null?0:q.length;++re<me&&ie(q[re],re,q)!==!1;);return q}function Jg(q,ie){for(var re=q==null?0:q.length;re--&&ie(q[re],re,q)!==!1;);return q}function Yc(q,ie){for(var re=-1,me=q==null?0:q.length;++re<me;)if(!ie(q[re],re,q))return!1;return!0}function kn(q,ie){for(var re=-1,me=q==null?0:q.length,Ie=0,Je=[];++re<me;){var yt=q[re];ie(yt,re,q)&&(Je[Ie++]=yt)}return Je}function Wo(q,ie){var re=q==null?0:q.length;return!!re&&kr(q,ie,0)>-1}function _a(q,ie,re){for(var me=-1,Ie=q==null?0:q.length;++me<Ie;)if(re(ie,q[me]))return!0;return!1}function at(q,ie){for(var re=-1,me=q==null?0:q.length,Ie=Array(me);++re<me;)Ie[re]=ie(q[re],re,q);return Ie}function Gn(q,ie){for(var re=-1,me=ie.length,Ie=q.length;++re<me;)q[Ie+re]=ie[re];return q}function Pa(q,ie,re,me){var Ie=-1,Je=q==null?0:q.length;for(me&&Je&&(re=q[++Ie]);++Ie<Je;)re=ie(re,q[Ie],Ie,q);return re}function Zg(q,ie,re,me){var Ie=q==null?0:q.length;for(me&&Ie&&(re=q[--Ie]);Ie--;)re=ie(re,q[Ie],Ie,q);return re}function La(q,ie){for(var re=-1,me=q==null?0:q.length;++re<me;)if(ie(q[re],re,q))return!0;return!1}var qg=Da("length");function Yg(q){return q.split("")}function Qg(q){return q.match(sg)||[]}function Qc(q,ie,re){var me;return re(q,function(Ie,Je,yt){if(ie(Ie,Je,yt))return me=Je,!1}),me}function $o(q,ie,re,me){for(var Ie=q.length,Je=re+(me?1:-1);me?Je--:++Je<Ie;)if(ie(q[Je],Je,q))return Je;return-1}function kr(q,ie,re){return ie===ie?cv(q,ie,re):$o(q,Xc,re)}function Xg(q,ie,re,me){for(var Ie=re-1,Je=q.length;++Ie<Je;)if(me(q[Ie],ie))return Ie;return-1}function Xc(q){return q!==q}function ef(q,ie){var re=q==null?0:q.length;return re?Fa(q,ie)/re:Z}function Da(q){return function(ie){return ie==null?s:ie[q]}}function Na(q){return function(ie){return q==null?s:q[ie]}}function tf(q,ie,re,me,Ie){return Ie(q,function(Je,yt,tt){re=me?(me=!1,Je):ie(re,Je,yt,tt)}),re}function ev(q,ie){var re=q.length;for(q.sort(ie);re--;)q[re]=q[re].value;return q}function Fa(q,ie){for(var re,me=-1,Ie=q.length;++me<Ie;){var Je=ie(q[me]);Je!==s&&(re=re===s?Je:re+Je)}return re}function Ua(q,ie){for(var re=-1,me=Array(q);++re<q;)me[re]=ie(re);return me}function tv(q,ie){return at(ie,function(re){return[re,q[re]]})}function nf(q){return q&&q.slice(0,af(q)+1).replace(Ca,"")}function Wt(q){return function(ie){return q(ie)}}function Ba(q,ie){return at(ie,function(re){return q[re]})}function Mi(q,ie){return q.has(ie)}function rf(q,ie){for(var re=-1,me=q.length;++re<me&&kr(ie,q[re],0)>-1;);return re}function of(q,ie){for(var re=q.length;re--&&kr(ie,q[re],0)>-1;);return re}function nv(q,ie){for(var re=q.length,me=0;re--;)q[re]===ie&&++me;return me}var rv=Na(Gg),iv=Na(Hg);function ov(q){return"\\"+$g[q]}function sv(q,ie){return q==null?s:q[ie]}function Gr(q){return Fg.test(q)}function av(q){return Ug.test(q)}function uv(q){for(var ie,re=[];!(ie=q.next()).done;)re.push(ie.value);return re}function ka(q){var ie=-1,re=Array(q.size);return q.forEach(function(me,Ie){re[++ie]=[Ie,me]}),re}function sf(q,ie){return function(re){return q(ie(re))}}function Hn(q,ie){for(var re=-1,me=q.length,Ie=0,Je=[];++re<me;){var yt=q[re];(yt===ie||yt===f)&&(q[re]=f,Je[Ie++]=re)}return Je}function zo(q){var ie=-1,re=Array(q.size);return q.forEach(function(me){re[++ie]=me}),re}function lv(q){var ie=-1,re=Array(q.size);return q.forEach(function(me){re[++ie]=[me,me]}),re}function cv(q,ie,re){for(var me=re-1,Ie=q.length;++me<Ie;)if(q[me]===ie)return me;return-1}function fv(q,ie,re){for(var me=re+1;me--;)if(q[me]===ie)return me;return me}function Hr(q){return Gr(q)?hv(q):qg(q)}function an(q){return Gr(q)?pv(q):Yg(q)}function af(q){for(var ie=q.length;ie--&&ng.test(q.charAt(ie)););return ie}var dv=Na(Wg);function hv(q){for(var ie=Ma.lastIndex=0;Ma.test(q);)++ie;return ie}function pv(q){return q.match(Ma)||[]}function mv(q){return q.match(Ng)||[]}var gv=function q(ie){ie=ie==null?Ct:Wn.defaults(Ct.Object(),ie,Wn.pick(Ct,Bg));var re=ie.Array,me=ie.Date,Ie=ie.Error,Je=ie.Function,yt=ie.Math,tt=ie.Object,Ga=ie.RegExp,vv=ie.String,Yt=ie.TypeError,Vo=re.prototype,yv=Je.prototype,Wr=tt.prototype,jo=ie["__core-js_shared__"],Ko=yv.toString,Qe=Wr.hasOwnProperty,bv=0,uf=function(){var n=/[^.]+$/.exec(jo&&jo.keys&&jo.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),Jo=Wr.toString,Ev=Ko.call(tt),Av=Ct._,Sv=Ga("^"+Ko.call(Qe).replace(Sa,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zo=zc?ie.Buffer:s,$n=ie.Symbol,qo=ie.Uint8Array,lf=Zo?Zo.allocUnsafe:s,Yo=sf(tt.getPrototypeOf,tt),cf=tt.create,ff=Wr.propertyIsEnumerable,Qo=Vo.splice,df=$n?$n.isConcatSpreadable:s,Ri=$n?$n.iterator:s,rr=$n?$n.toStringTag:s,Xo=function(){try{var n=ur(tt,"defineProperty");return n({},"",{}),n}catch(r){}}(),Cv=ie.clearTimeout!==Ct.clearTimeout&&ie.clearTimeout,Tv=me&&me.now!==Ct.Date.now&&me.now,Ov=ie.setTimeout!==Ct.setTimeout&&ie.setTimeout,es=yt.ceil,ts=yt.floor,Ha=tt.getOwnPropertySymbols,wv=Zo?Zo.isBuffer:s,hf=ie.isFinite,Iv=Vo.join,Mv=sf(tt.keys,tt),bt=yt.max,xt=yt.min,Rv=me.now,xv=ie.parseInt,pf=yt.random,_v=Vo.reverse,Wa=ur(ie,"DataView"),xi=ur(ie,"Map"),$a=ur(ie,"Promise"),$r=ur(ie,"Set"),_i=ur(ie,"WeakMap"),Pi=ur(tt,"create"),ns=_i&&new _i,zr={},Pv=lr(Wa),Lv=lr(xi),Dv=lr($a),Nv=lr($r),Fv=lr(_i),rs=$n?$n.prototype:s,Li=rs?rs.valueOf:s,mf=rs?rs.toString:s;function D(n){if(dt(n)&&!Me(n)&&!(n instanceof Ge)){if(n instanceof Qt)return n;if(Qe.call(n,"__wrapped__"))return gd(n)}return new Qt(n)}var Vr=function(){function n(){}return function(r){if(!ut(r))return{};if(cf)return cf(r);n.prototype=r;var a=new n;return n.prototype=s,a}}();function is(){}function Qt(n,r){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=s}D.templateSettings={escape:qm,evaluate:Ym,interpolate:Cc,variable:"",imports:{_:D}},D.prototype=is.prototype,D.prototype.constructor=D,Qt.prototype=Vr(is.prototype),Qt.prototype.constructor=Qt;function Ge(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=te,this.__views__=[]}function Uv(){var n=new Ge(this.__wrapped__);return n.__actions__=Ft(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=Ft(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=Ft(this.__views__),n}function Bv(){if(this.__filtered__){var n=new Ge(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function kv(){var n=this.__wrapped__.value(),r=this.__dir__,a=Me(n),b=r<0,_=a?n.length:0,B=Yy(0,_,this.__views__),V=B.start,J=B.end,Q=J-V,se=b?J:V-1,ae=this.__iteratees__,ue=ae.length,de=0,ve=xt(Q,this.__takeCount__);if(!a||!b&&_==Q&&ve==Q)return kf(n,this.__actions__);var Ce=[];e:for(;Q--&&de<ve;){se+=r;for(var Ne=-1,Te=n[se];++Ne<ue;){var ke=ae[Ne],$e=ke.iteratee,Vt=ke.type,Dt=$e(Te);if(Vt==F)Te=Dt;else if(!Dt){if(Vt==H)continue e;break e}}Ce[de++]=Te}return Ce}Ge.prototype=Vr(is.prototype),Ge.prototype.constructor=Ge;function ir(n){var r=-1,a=n==null?0:n.length;for(this.clear();++r<a;){var b=n[r];this.set(b[0],b[1])}}function Gv(){this.__data__=Pi?Pi(null):{},this.size=0}function Hv(n){var r=this.has(n)&&delete this.__data__[n];return this.size-=r?1:0,r}function Wv(n){var r=this.__data__;if(Pi){var a=r[n];return a===c?s:a}return Qe.call(r,n)?r[n]:s}function $v(n){var r=this.__data__;return Pi?r[n]!==s:Qe.call(r,n)}function zv(n,r){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=Pi&&r===s?c:r,this}ir.prototype.clear=Gv,ir.prototype.delete=Hv,ir.prototype.get=Wv,ir.prototype.has=$v,ir.prototype.set=zv;function Cn(n){var r=-1,a=n==null?0:n.length;for(this.clear();++r<a;){var b=n[r];this.set(b[0],b[1])}}function Vv(){this.__data__=[],this.size=0}function jv(n){var r=this.__data__,a=os(r,n);if(a<0)return!1;var b=r.length-1;return a==b?r.pop():Qo.call(r,a,1),--this.size,!0}function Kv(n){var r=this.__data__,a=os(r,n);return a<0?s:r[a][1]}function Jv(n){return os(this.__data__,n)>-1}function Zv(n,r){var a=this.__data__,b=os(a,n);return b<0?(++this.size,a.push([n,r])):a[b][1]=r,this}Cn.prototype.clear=Vv,Cn.prototype.delete=jv,Cn.prototype.get=Kv,Cn.prototype.has=Jv,Cn.prototype.set=Zv;function Tn(n){var r=-1,a=n==null?0:n.length;for(this.clear();++r<a;){var b=n[r];this.set(b[0],b[1])}}function qv(){this.size=0,this.__data__={hash:new ir,map:new(xi||Cn),string:new ir}}function Yv(n){var r=vs(this,n).delete(n);return this.size-=r?1:0,r}function Qv(n){return vs(this,n).get(n)}function Xv(n){return vs(this,n).has(n)}function ey(n,r){var a=vs(this,n),b=a.size;return a.set(n,r),this.size+=a.size==b?0:1,this}Tn.prototype.clear=qv,Tn.prototype.delete=Yv,Tn.prototype.get=Qv,Tn.prototype.has=Xv,Tn.prototype.set=ey;function or(n){var r=-1,a=n==null?0:n.length;for(this.__data__=new Tn;++r<a;)this.add(n[r])}function ty(n){return this.__data__.set(n,c),this}function ny(n){return this.__data__.has(n)}or.prototype.add=or.prototype.push=ty,or.prototype.has=ny;function un(n){var r=this.__data__=new Cn(n);this.size=r.size}function ry(){this.__data__=new Cn,this.size=0}function iy(n){var r=this.__data__,a=r.delete(n);return this.size=r.size,a}function oy(n){return this.__data__.get(n)}function sy(n){return this.__data__.has(n)}function ay(n,r){var a=this.__data__;if(a instanceof Cn){var b=a.__data__;if(!xi||b.length<t-1)return b.push([n,r]),this.size=++a.size,this;a=this.__data__=new Tn(b)}return a.set(n,r),this.size=a.size,this}un.prototype.clear=ry,un.prototype.delete=iy,un.prototype.get=oy,un.prototype.has=sy,un.prototype.set=ay;function gf(n,r){var a=Me(n),b=!a&&cr(n),_=!a&&!b&&Jn(n),B=!a&&!b&&!_&&Zr(n),V=a||b||_||B,J=V?Ua(n.length,vv):[],Q=J.length;for(var se in n)(r||Qe.call(n,se))&&!(V&&(se=="length"||_&&(se=="offset"||se=="parent")||B&&(se=="buffer"||se=="byteLength"||se=="byteOffset")||Mn(se,Q)))&&J.push(se);return J}function vf(n){var r=n.length;return r?n[eu(0,r-1)]:s}function uy(n,r){return ys(Ft(n),sr(r,0,n.length))}function ly(n){return ys(Ft(n))}function za(n,r,a){(a!==s&&!ln(n[r],a)||a===s&&!(r in n))&&On(n,r,a)}function Di(n,r,a){var b=n[r];(!(Qe.call(n,r)&&ln(b,a))||a===s&&!(r in n))&&On(n,r,a)}function os(n,r){for(var a=n.length;a--;)if(ln(n[a][0],r))return a;return-1}function cy(n,r,a,b){return zn(n,function(_,B,V){r(b,_,a(_),V)}),b}function yf(n,r){return n&&gn(r,Tt(r),n)}function fy(n,r){return n&&gn(r,Bt(r),n)}function On(n,r,a){r=="__proto__"&&Xo?Xo(n,r,{configurable:!0,enumerable:!0,value:a,writable:!0}):n[r]=a}function Va(n,r){for(var a=-1,b=r.length,_=re(b),B=n==null;++a<b;)_[a]=B?s:Ou(n,r[a]);return _}function sr(n,r,a){return n===n&&(a!==s&&(n=n<=a?n:a),r!==s&&(n=n>=r?n:r)),n}function Xt(n,r,a,b,_,B){var V,J=r&m,Q=r&E,se=r&O;if(a&&(V=_?a(n,b,_,B):a(n)),V!==s)return V;if(!ut(n))return n;var ae=Me(n);if(ae){if(V=Xy(n),!J)return Ft(n,V)}else{var ue=_t(n),de=ue==_e||ue==Ke;if(Jn(n))return Wf(n,J);if(ue==et||ue==U||de&&!_){if(V=Q||de?{}:ad(n),!J)return Q?Wy(n,fy(V,n)):Hy(n,yf(V,n))}else{if(!it[ue])return _?n:{};V=e0(n,ue,J)}}B||(B=new un);var ve=B.get(n);if(ve)return ve;B.set(n,V),Fd(n)?n.forEach(function(Te){V.add(Xt(Te,r,a,Te,n,B))}):Dd(n)&&n.forEach(function(Te,ke){V.set(ke,Xt(Te,r,a,ke,n,B))});var Ce=se?Q?fu:cu:Q?Bt:Tt,Ne=ae?s:Ce(n);return qt(Ne||n,function(Te,ke){Ne&&(ke=Te,Te=n[ke]),Di(V,ke,Xt(Te,r,a,ke,n,B))}),V}function dy(n){var r=Tt(n);return function(a){return bf(a,n,r)}}function bf(n,r,a){var b=a.length;if(n==null)return!b;for(n=tt(n);b--;){var _=a[b],B=r[_],V=n[_];if(V===s&&!(_ in n)||!B(V))return!1}return!0}function Ef(n,r,a){if(typeof n!="function")throw new Yt(o);return Hi(function(){n.apply(s,a)},r)}function Ni(n,r,a,b){var _=-1,B=Wo,V=!0,J=n.length,Q=[],se=r.length;if(!J)return Q;a&&(r=at(r,Wt(a))),b?(B=_a,V=!1):r.length>=t&&(B=Mi,V=!1,r=new or(r));e:for(;++_<J;){var ae=n[_],ue=a==null?ae:a(ae);if(ae=b||ae!==0?ae:0,V&&ue===ue){for(var de=se;de--;)if(r[de]===ue)continue e;Q.push(ae)}else B(r,ue,b)||Q.push(ae)}return Q}var zn=Kf(mn),Af=Kf(Ka,!0);function hy(n,r){var a=!0;return zn(n,function(b,_,B){return a=!!r(b,_,B),a}),a}function ss(n,r,a){for(var b=-1,_=n.length;++b<_;){var B=n[b],V=r(B);if(V!=null&&(J===s?V===V&&!zt(V):a(V,J)))var J=V,Q=B}return Q}function py(n,r,a,b){var _=n.length;for(a=Pe(a),a<0&&(a=-a>_?0:_+a),b=b===s||b>_?_:Pe(b),b<0&&(b+=_),b=a>b?0:Bd(b);a<b;)n[a++]=r;return n}function Sf(n,r){var a=[];return zn(n,function(b,_,B){r(b,_,B)&&a.push(b)}),a}function Mt(n,r,a,b,_){var B=-1,V=n.length;for(a||(a=n0),_||(_=[]);++B<V;){var J=n[B];r>0&&a(J)?r>1?Mt(J,r-1,a,b,_):Gn(_,J):b||(_[_.length]=J)}return _}var ja=Jf(),Cf=Jf(!0);function mn(n,r){return n&&ja(n,r,Tt)}function Ka(n,r){return n&&Cf(n,r,Tt)}function as(n,r){return kn(r,function(a){return Rn(n[a])})}function ar(n,r){r=jn(r,n);for(var a=0,b=r.length;n!=null&&a<b;)n=n[vn(r[a++])];return a&&a==b?n:s}function Tf(n,r,a){var b=r(n);return Me(n)?b:Gn(b,a(n))}function Pt(n){return n==null?n===s?De:St:rr&&rr in tt(n)?qy(n):l0(n)}function Ja(n,r){return n>r}function my(n,r){return n!=null&&Qe.call(n,r)}function gy(n,r){return n!=null&&r in tt(n)}function vy(n,r,a){return n>=xt(r,a)&&n<bt(r,a)}function Za(n,r,a){for(var b=a?_a:Wo,_=n[0].length,B=n.length,V=B,J=re(B),Q=1/0,se=[];V--;){var ae=n[V];V&&r&&(ae=at(ae,Wt(r))),Q=xt(ae.length,Q),J[V]=!a&&(r||_>=120&&ae.length>=120)?new or(V&&ae):s}ae=n[0];var ue=-1,de=J[0];e:for(;++ue<_&&se.length<Q;){var ve=ae[ue],Ce=r?r(ve):ve;if(ve=a||ve!==0?ve:0,!(de?Mi(de,Ce):b(se,Ce,a))){for(V=B;--V;){var Ne=J[V];if(!(Ne?Mi(Ne,Ce):b(n[V],Ce,a)))continue e}de&&de.push(Ce),se.push(ve)}}return se}function yy(n,r,a,b){return mn(n,function(_,B,V){r(b,a(_),B,V)}),b}function Fi(n,r,a){r=jn(r,n),n=fd(n,r);var b=n==null?n:n[vn(tn(r))];return b==null?s:Ht(b,n,a)}function Of(n){return dt(n)&&Pt(n)==U}function by(n){return dt(n)&&Pt(n)==Ii}function Ey(n){return dt(n)&&Pt(n)==ce}function Ui(n,r,a,b,_){return n===r?!0:n==null||r==null||!dt(n)&&!dt(r)?n!==n&&r!==r:Ay(n,r,a,b,Ui,_)}function Ay(n,r,a,b,_,B){var V=Me(n),J=Me(r),Q=V?K:_t(n),se=J?K:_t(r);Q=Q==U?et:Q,se=se==U?et:se;var ae=Q==et,ue=se==et,de=Q==se;if(de&&Jn(n)){if(!Jn(r))return!1;V=!0,ae=!1}if(de&&!ae)return B||(B=new un),V||Zr(n)?id(n,r,a,b,_,B):Jy(n,r,Q,a,b,_,B);if(!(a&d)){var ve=ae&&Qe.call(n,"__wrapped__"),Ce=ue&&Qe.call(r,"__wrapped__");if(ve||Ce){var Ne=ve?n.value():n,Te=Ce?r.value():r;return B||(B=new un),_(Ne,Te,a,b,B)}}return de?(B||(B=new un),Zy(n,r,a,b,_,B)):!1}function Sy(n){return dt(n)&&_t(n)==pe}function qa(n,r,a,b){var _=a.length,B=_,V=!b;if(n==null)return!B;for(n=tt(n);_--;){var J=a[_];if(V&&J[2]?J[1]!==n[J[0]]:!(J[0]in n))return!1}for(;++_<B;){J=a[_];var Q=J[0],se=n[Q],ae=J[1];if(V&&J[2]){if(se===s&&!(Q in n))return!1}else{var ue=new un;if(b)var de=b(se,ae,Q,n,r,ue);if(!(de===s?Ui(ae,se,d|A,b,ue):de))return!1}}return!0}function wf(n){if(!ut(n)||i0(n))return!1;var r=Rn(n)?Sv:dg;return r.test(lr(n))}function Cy(n){return dt(n)&&Pt(n)==X}function Ty(n){return dt(n)&&_t(n)==oe}function Oy(n){return dt(n)&&Ts(n.length)&&!!ot[Pt(n)]}function If(n){return typeof n=="function"?n:n==null?kt:typeof n=="object"?Me(n)?xf(n[0],n[1]):Rf(n):Zd(n)}function Ya(n){if(!Gi(n))return Mv(n);var r=[];for(var a in tt(n))Qe.call(n,a)&&a!="constructor"&&r.push(a);return r}function wy(n){if(!ut(n))return u0(n);var r=Gi(n),a=[];for(var b in n)b=="constructor"&&(r||!Qe.call(n,b))||a.push(b);return a}function Qa(n,r){return n<r}function Mf(n,r){var a=-1,b=Ut(n)?re(n.length):[];return zn(n,function(_,B,V){b[++a]=r(_,B,V)}),b}function Rf(n){var r=hu(n);return r.length==1&&r[0][2]?ld(r[0][0],r[0][1]):function(a){return a===n||qa(a,n,r)}}function xf(n,r){return mu(n)&&ud(r)?ld(vn(n),r):function(a){var b=Ou(a,n);return b===s&&b===r?wu(a,n):Ui(r,b,d|A)}}function us(n,r,a,b,_){n!==r&&ja(r,function(B,V){if(_||(_=new un),ut(B))Iy(n,r,V,a,us,b,_);else{var J=b?b(vu(n,V),B,V+"",n,r,_):s;J===s&&(J=B),za(n,V,J)}},Bt)}function Iy(n,r,a,b,_,B,V){var J=vu(n,a),Q=vu(r,a),se=V.get(Q);if(se){za(n,a,se);return}var ae=B?B(J,Q,a+"",n,r,V):s,ue=ae===s;if(ue){var de=Me(Q),ve=!de&&Jn(Q),Ce=!de&&!ve&&Zr(Q);ae=Q,de||ve||Ce?Me(J)?ae=J:ht(J)?ae=Ft(J):ve?(ue=!1,ae=Wf(Q,!0)):Ce?(ue=!1,ae=$f(Q,!0)):ae=[]:Wi(Q)||cr(Q)?(ae=J,cr(J)?ae=kd(J):(!ut(J)||Rn(J))&&(ae=ad(Q))):ue=!1}ue&&(V.set(Q,ae),_(ae,Q,b,B,V),V.delete(Q)),za(n,a,ae)}function _f(n,r){var a=n.length;if(!!a)return r+=r<0?a:0,Mn(r,a)?n[r]:s}function Pf(n,r,a){r.length?r=at(r,function(B){return Me(B)?function(V){return ar(V,B.length===1?B[0]:B)}:B}):r=[kt];var b=-1;r=at(r,Wt(Se()));var _=Mf(n,function(B,V,J){var Q=at(r,function(se){return se(B)});return{criteria:Q,index:++b,value:B}});return ev(_,function(B,V){return Gy(B,V,a)})}function My(n,r){return Lf(n,r,function(a,b){return wu(n,b)})}function Lf(n,r,a){for(var b=-1,_=r.length,B={};++b<_;){var V=r[b],J=ar(n,V);a(J,V)&&Bi(B,jn(V,n),J)}return B}function Ry(n){return function(r){return ar(r,n)}}function Xa(n,r,a,b){var _=b?Xg:kr,B=-1,V=r.length,J=n;for(n===r&&(r=Ft(r)),a&&(J=at(n,Wt(a)));++B<V;)for(var Q=0,se=r[B],ae=a?a(se):se;(Q=_(J,ae,Q,b))>-1;)J!==n&&Qo.call(J,Q,1),Qo.call(n,Q,1);return n}function Df(n,r){for(var a=n?r.length:0,b=a-1;a--;){var _=r[a];if(a==b||_!==B){var B=_;Mn(_)?Qo.call(n,_,1):ru(n,_)}}return n}function eu(n,r){return n+ts(pf()*(r-n+1))}function xy(n,r,a,b){for(var _=-1,B=bt(es((r-n)/(a||1)),0),V=re(B);B--;)V[b?B:++_]=n,n+=a;return V}function tu(n,r){var a="";if(!n||r<1||r>z)return a;do r%2&&(a+=n),r=ts(r/2),r&&(n+=n);while(r);return a}function Be(n,r){return yu(cd(n,r,kt),n+"")}function _y(n){return vf(qr(n))}function Py(n,r){var a=qr(n);return ys(a,sr(r,0,a.length))}function Bi(n,r,a,b){if(!ut(n))return n;r=jn(r,n);for(var _=-1,B=r.length,V=B-1,J=n;J!=null&&++_<B;){var Q=vn(r[_]),se=a;if(Q==="__proto__"||Q==="constructor"||Q==="prototype")return n;if(_!=V){var ae=J[Q];se=b?b(ae,Q,J):s,se===s&&(se=ut(ae)?ae:Mn(r[_+1])?[]:{})}Di(J,Q,se),J=J[Q]}return n}var Nf=ns?function(n,r){return ns.set(n,r),n}:kt,Ly=Xo?function(n,r){return Xo(n,"toString",{configurable:!0,enumerable:!1,value:Mu(r),writable:!0})}:kt;function Dy(n){return ys(qr(n))}function en(n,r,a){var b=-1,_=n.length;r<0&&(r=-r>_?0:_+r),a=a>_?_:a,a<0&&(a+=_),_=r>a?0:a-r>>>0,r>>>=0;for(var B=re(_);++b<_;)B[b]=n[b+r];return B}function Ny(n,r){var a;return zn(n,function(b,_,B){return a=r(b,_,B),!a}),!!a}function ls(n,r,a){var b=0,_=n==null?b:n.length;if(typeof r=="number"&&r===r&&_<=G){for(;b<_;){var B=b+_>>>1,V=n[B];V!==null&&!zt(V)&&(a?V<=r:V<r)?b=B+1:_=B}return _}return nu(n,r,kt,a)}function nu(n,r,a,b){var _=0,B=n==null?0:n.length;if(B===0)return 0;r=a(r);for(var V=r!==r,J=r===null,Q=zt(r),se=r===s;_<B;){var ae=ts((_+B)/2),ue=a(n[ae]),de=ue!==s,ve=ue===null,Ce=ue===ue,Ne=zt(ue);if(V)var Te=b||Ce;else se?Te=Ce&&(b||de):J?Te=Ce&&de&&(b||!ve):Q?Te=Ce&&de&&!ve&&(b||!Ne):ve||Ne?Te=!1:Te=b?ue<=r:ue<r;Te?_=ae+1:B=ae}return xt(B,Y)}function Ff(n,r){for(var a=-1,b=n.length,_=0,B=[];++a<b;){var V=n[a],J=r?r(V):V;if(!a||!ln(J,Q)){var Q=J;B[_++]=V===0?0:V}}return B}function Uf(n){return typeof n=="number"?n:zt(n)?Z:+n}function $t(n){if(typeof n=="string")return n;if(Me(n))return at(n,$t)+"";if(zt(n))return mf?mf.call(n):"";var r=n+"";return r=="0"&&1/n==-P?"-0":r}function Vn(n,r,a){var b=-1,_=Wo,B=n.length,V=!0,J=[],Q=J;if(a)V=!1,_=_a;else if(B>=t){var se=r?null:jy(n);if(se)return zo(se);V=!1,_=Mi,Q=new or}else Q=r?[]:J;e:for(;++b<B;){var ae=n[b],ue=r?r(ae):ae;if(ae=a||ae!==0?ae:0,V&&ue===ue){for(var de=Q.length;de--;)if(Q[de]===ue)continue e;r&&Q.push(ue),J.push(ae)}else _(Q,ue,a)||(Q!==J&&Q.push(ue),J.push(ae))}return J}function ru(n,r){return r=jn(r,n),n=fd(n,r),n==null||delete n[vn(tn(r))]}function Bf(n,r,a,b){return Bi(n,r,a(ar(n,r)),b)}function cs(n,r,a,b){for(var _=n.length,B=b?_:-1;(b?B--:++B<_)&&r(n[B],B,n););return a?en(n,b?0:B,b?B+1:_):en(n,b?B+1:0,b?_:B)}function kf(n,r){var a=n;return a instanceof Ge&&(a=a.value()),Pa(r,function(b,_){return _.func.apply(_.thisArg,Gn([b],_.args))},a)}function iu(n,r,a){var b=n.length;if(b<2)return b?Vn(n[0]):[];for(var _=-1,B=re(b);++_<b;)for(var V=n[_],J=-1;++J<b;)J!=_&&(B[_]=Ni(B[_]||V,n[J],r,a));return Vn(Mt(B,1),r,a)}function Gf(n,r,a){for(var b=-1,_=n.length,B=r.length,V={};++b<_;){var J=b<B?r[b]:s;a(V,n[b],J)}return V}function ou(n){return ht(n)?n:[]}function su(n){return typeof n=="function"?n:kt}function jn(n,r){return Me(n)?n:mu(n,r)?[n]:md(qe(n))}var Fy=Be;function Kn(n,r,a){var b=n.length;return a=a===s?b:a,!r&&a>=b?n:en(n,r,a)}var Hf=Cv||function(n){return Ct.clearTimeout(n)};function Wf(n,r){if(r)return n.slice();var a=n.length,b=lf?lf(a):new n.constructor(a);return n.copy(b),b}function au(n){var r=new n.constructor(n.byteLength);return new qo(r).set(new qo(n)),r}function Uy(n,r){var a=r?au(n.buffer):n.buffer;return new n.constructor(a,n.byteOffset,n.byteLength)}function By(n){var r=new n.constructor(n.source,Tc.exec(n));return r.lastIndex=n.lastIndex,r}function ky(n){return Li?tt(Li.call(n)):{}}function $f(n,r){var a=r?au(n.buffer):n.buffer;return new n.constructor(a,n.byteOffset,n.length)}function zf(n,r){if(n!==r){var a=n!==s,b=n===null,_=n===n,B=zt(n),V=r!==s,J=r===null,Q=r===r,se=zt(r);if(!J&&!se&&!B&&n>r||B&&V&&Q&&!J&&!se||b&&V&&Q||!a&&Q||!_)return 1;if(!b&&!B&&!se&&n<r||se&&a&&_&&!b&&!B||J&&a&&_||!V&&_||!Q)return-1}return 0}function Gy(n,r,a){for(var b=-1,_=n.criteria,B=r.criteria,V=_.length,J=a.length;++b<V;){var Q=zf(_[b],B[b]);if(Q){if(b>=J)return Q;var se=a[b];return Q*(se=="desc"?-1:1)}}return n.index-r.index}function Vf(n,r,a,b){for(var _=-1,B=n.length,V=a.length,J=-1,Q=r.length,se=bt(B-V,0),ae=re(Q+se),ue=!b;++J<Q;)ae[J]=r[J];for(;++_<V;)(ue||_<B)&&(ae[a[_]]=n[_]);for(;se--;)ae[J++]=n[_++];return ae}function jf(n,r,a,b){for(var _=-1,B=n.length,V=-1,J=a.length,Q=-1,se=r.length,ae=bt(B-J,0),ue=re(ae+se),de=!b;++_<ae;)ue[_]=n[_];for(var ve=_;++Q<se;)ue[ve+Q]=r[Q];for(;++V<J;)(de||_<B)&&(ue[ve+a[V]]=n[_++]);return ue}function Ft(n,r){var a=-1,b=n.length;for(r||(r=re(b));++a<b;)r[a]=n[a];return r}function gn(n,r,a,b){var _=!a;a||(a={});for(var B=-1,V=r.length;++B<V;){var J=r[B],Q=b?b(a[J],n[J],J,a,n):s;Q===s&&(Q=n[J]),_?On(a,J,Q):Di(a,J,Q)}return a}function Hy(n,r){return gn(n,pu(n),r)}function Wy(n,r){return gn(n,od(n),r)}function fs(n,r){return function(a,b){var _=Me(a)?Kg:cy,B=r?r():{};return _(a,n,Se(b,2),B)}}function jr(n){return Be(function(r,a){var b=-1,_=a.length,B=_>1?a[_-1]:s,V=_>2?a[2]:s;for(B=n.length>3&&typeof B=="function"?(_--,B):s,V&&Lt(a[0],a[1],V)&&(B=_<3?s:B,_=1),r=tt(r);++b<_;){var J=a[b];J&&n(r,J,b,B)}return r})}function Kf(n,r){return function(a,b){if(a==null)return a;if(!Ut(a))return n(a,b);for(var _=a.length,B=r?_:-1,V=tt(a);(r?B--:++B<_)&&b(V[B],B,V)!==!1;);return a}}function Jf(n){return function(r,a,b){for(var _=-1,B=tt(r),V=b(r),J=V.length;J--;){var Q=V[n?J:++_];if(a(B[Q],Q,B)===!1)break}return r}}function $y(n,r,a){var b=r&I,_=ki(n);function B(){var V=this&&this!==Ct&&this instanceof B?_:n;return V.apply(b?a:this,arguments)}return B}function Zf(n){return function(r){r=qe(r);var a=Gr(r)?an(r):s,b=a?a[0]:r.charAt(0),_=a?Kn(a,1).join(""):r.slice(1);return b[n]()+_}}function Kr(n){return function(r){return Pa(Kd(jd(r).replace(Lg,"")),n,"")}}function ki(n){return function(){var r=arguments;switch(r.length){case 0:return new n;case 1:return new n(r[0]);case 2:return new n(r[0],r[1]);case 3:return new n(r[0],r[1],r[2]);case 4:return new n(r[0],r[1],r[2],r[3]);case 5:return new n(r[0],r[1],r[2],r[3],r[4]);case 6:return new n(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new n(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var a=Vr(n.prototype),b=n.apply(a,r);return ut(b)?b:a}}function zy(n,r,a){var b=ki(n);function _(){for(var B=arguments.length,V=re(B),J=B,Q=Jr(_);J--;)V[J]=arguments[J];var se=B<3&&V[0]!==Q&&V[B-1]!==Q?[]:Hn(V,Q);if(B-=se.length,B<a)return ed(n,r,ds,_.placeholder,s,V,se,s,s,a-B);var ae=this&&this!==Ct&&this instanceof _?b:n;return Ht(ae,this,V)}return _}function qf(n){return function(r,a,b){var _=tt(r);if(!Ut(r)){var B=Se(a,3);r=Tt(r),a=function(J){return B(_[J],J,_)}}var V=n(r,a,b);return V>-1?_[B?r[V]:V]:s}}function Yf(n){return In(function(r){var a=r.length,b=a,_=Qt.prototype.thru;for(n&&r.reverse();b--;){var B=r[b];if(typeof B!="function")throw new Yt(o);if(_&&!V&&gs(B)=="wrapper")var V=new Qt([],!0)}for(b=V?b:a;++b<a;){B=r[b];var J=gs(B),Q=J=="wrapper"?du(B):s;Q&&gu(Q[0])&&Q[1]==(g|S|p|v)&&!Q[4].length&&Q[9]==1?V=V[gs(Q[0])].apply(V,Q[3]):V=B.length==1&&gu(B)?V[J]():V.thru(B)}return function(){var se=arguments,ae=se[0];if(V&&se.length==1&&Me(ae))return V.plant(ae).value();for(var ue=0,de=a?r[ue].apply(this,se):ae;++ue<a;)de=r[ue].call(this,de);return de}})}function ds(n,r,a,b,_,B,V,J,Q,se){var ae=r&g,ue=r&I,de=r&x,ve=r&(S|w),Ce=r&h,Ne=de?s:ki(n);function Te(){for(var ke=arguments.length,$e=re(ke),Vt=ke;Vt--;)$e[Vt]=arguments[Vt];if(ve)var Dt=Jr(Te),jt=nv($e,Dt);if(b&&($e=Vf($e,b,_,ve)),B&&($e=jf($e,B,V,ve)),ke-=jt,ve&&ke<se){var pt=Hn($e,Dt);return ed(n,r,ds,Te.placeholder,a,$e,pt,J,Q,se-ke)}var cn=ue?a:this,_n=de?cn[n]:n;return ke=$e.length,J?$e=c0($e,J):Ce&&ke>1&&$e.reverse(),ae&&Q<ke&&($e.length=Q),this&&this!==Ct&&this instanceof Te&&(_n=Ne||ki(_n)),_n.apply(cn,$e)}return Te}function Qf(n,r){return function(a,b){return yy(a,n,r(b),{})}}function hs(n,r){return function(a,b){var _;if(a===s&&b===s)return r;if(a!==s&&(_=a),b!==s){if(_===s)return b;typeof a=="string"||typeof b=="string"?(a=$t(a),b=$t(b)):(a=Uf(a),b=Uf(b)),_=n(a,b)}return _}}function uu(n){return In(function(r){return r=at(r,Wt(Se())),Be(function(a){var b=this;return n(r,function(_){return Ht(_,b,a)})})})}function ps(n,r){r=r===s?" ":$t(r);var a=r.length;if(a<2)return a?tu(r,n):r;var b=tu(r,es(n/Hr(r)));return Gr(r)?Kn(an(b),0,n).join(""):b.slice(0,n)}function Vy(n,r,a,b){var _=r&I,B=ki(n);function V(){for(var J=-1,Q=arguments.length,se=-1,ae=b.length,ue=re(ae+Q),de=this&&this!==Ct&&this instanceof V?B:n;++se<ae;)ue[se]=b[se];for(;Q--;)ue[se++]=arguments[++J];return Ht(de,_?a:this,ue)}return V}function Xf(n){return function(r,a,b){return b&&typeof b!="number"&&Lt(r,a,b)&&(a=b=s),r=xn(r),a===s?(a=r,r=0):a=xn(a),b=b===s?r<a?1:-1:xn(b),xy(r,a,b,n)}}function ms(n){return function(r,a){return typeof r=="string"&&typeof a=="string"||(r=nn(r),a=nn(a)),n(r,a)}}function ed(n,r,a,b,_,B,V,J,Q,se){var ae=r&S,ue=ae?V:s,de=ae?s:V,ve=ae?B:s,Ce=ae?s:B;r|=ae?p:y,r&=~(ae?y:p),r&T||(r&=~(I|x));var Ne=[n,r,_,ve,ue,Ce,de,J,Q,se],Te=a.apply(s,Ne);return gu(n)&&dd(Te,Ne),Te.placeholder=b,hd(Te,n,r)}function lu(n){var r=yt[n];return function(a,b){if(a=nn(a),b=b==null?0:xt(Pe(b),292),b&&hf(a)){var _=(qe(a)+"e").split("e"),B=r(_[0]+"e"+(+_[1]+b));return _=(qe(B)+"e").split("e"),+(_[0]+"e"+(+_[1]-b))}return r(a)}}var jy=$r&&1/zo(new $r([,-0]))[1]==P?function(n){return new $r(n)}:_u;function td(n){return function(r){var a=_t(r);return a==pe?ka(r):a==oe?lv(r):tv(r,n(r))}}function wn(n,r,a,b,_,B,V,J){var Q=r&x;if(!Q&&typeof n!="function")throw new Yt(o);var se=b?b.length:0;if(se||(r&=~(p|y),b=_=s),V=V===s?V:bt(Pe(V),0),J=J===s?J:Pe(J),se-=_?_.length:0,r&y){var ae=b,ue=_;b=_=s}var de=Q?s:du(n),ve=[n,r,a,b,_,ae,ue,B,V,J];if(de&&a0(ve,de),n=ve[0],r=ve[1],a=ve[2],b=ve[3],_=ve[4],J=ve[9]=ve[9]===s?Q?0:n.length:bt(ve[9]-se,0),!J&&r&(S|w)&&(r&=~(S|w)),!r||r==I)var Ce=$y(n,r,a);else r==S||r==w?Ce=zy(n,r,J):(r==p||r==(I|p))&&!_.length?Ce=Vy(n,r,a,b):Ce=ds.apply(s,ve);var Ne=de?Nf:dd;return hd(Ne(Ce,ve),n,r)}function nd(n,r,a,b){return n===s||ln(n,Wr[a])&&!Qe.call(b,a)?r:n}function rd(n,r,a,b,_,B){return ut(n)&&ut(r)&&(B.set(r,n),us(n,r,s,rd,B),B.delete(r)),n}function Ky(n){return Wi(n)?s:n}function id(n,r,a,b,_,B){var V=a&d,J=n.length,Q=r.length;if(J!=Q&&!(V&&Q>J))return!1;var se=B.get(n),ae=B.get(r);if(se&&ae)return se==r&&ae==n;var ue=-1,de=!0,ve=a&A?new or:s;for(B.set(n,r),B.set(r,n);++ue<J;){var Ce=n[ue],Ne=r[ue];if(b)var Te=V?b(Ne,Ce,ue,r,n,B):b(Ce,Ne,ue,n,r,B);if(Te!==s){if(Te)continue;de=!1;break}if(ve){if(!La(r,function(ke,$e){if(!Mi(ve,$e)&&(Ce===ke||_(Ce,ke,a,b,B)))return ve.push($e)})){de=!1;break}}else if(!(Ce===Ne||_(Ce,Ne,a,b,B))){de=!1;break}}return B.delete(n),B.delete(r),de}function Jy(n,r,a,b,_,B,V){switch(a){case Ur:if(n.byteLength!=r.byteLength||n.byteOffset!=r.byteOffset)return!1;n=n.buffer,r=r.buffer;case Ii:return!(n.byteLength!=r.byteLength||!B(new qo(n),new qo(r)));case ne:case ce:case Ve:return ln(+n,+r);case be:return n.name==r.name&&n.message==r.message;case X:case le:return n==r+"";case pe:var J=ka;case oe:var Q=b&d;if(J||(J=zo),n.size!=r.size&&!Q)return!1;var se=V.get(n);if(se)return se==r;b|=A,V.set(n,r);var ae=id(J(n),J(r),b,_,B,V);return V.delete(n),ae;case ge:if(Li)return Li.call(n)==Li.call(r)}return!1}function Zy(n,r,a,b,_,B){var V=a&d,J=cu(n),Q=J.length,se=cu(r),ae=se.length;if(Q!=ae&&!V)return!1;for(var ue=Q;ue--;){var de=J[ue];if(!(V?de in r:Qe.call(r,de)))return!1}var ve=B.get(n),Ce=B.get(r);if(ve&&Ce)return ve==r&&Ce==n;var Ne=!0;B.set(n,r),B.set(r,n);for(var Te=V;++ue<Q;){de=J[ue];var ke=n[de],$e=r[de];if(b)var Vt=V?b($e,ke,de,r,n,B):b(ke,$e,de,n,r,B);if(!(Vt===s?ke===$e||_(ke,$e,a,b,B):Vt)){Ne=!1;break}Te||(Te=de=="constructor")}if(Ne&&!Te){var Dt=n.constructor,jt=r.constructor;Dt!=jt&&"constructor"in n&&"constructor"in r&&!(typeof Dt=="function"&&Dt instanceof Dt&&typeof jt=="function"&&jt instanceof jt)&&(Ne=!1)}return B.delete(n),B.delete(r),Ne}function In(n){return yu(cd(n,s,bd),n+"")}function cu(n){return Tf(n,Tt,pu)}function fu(n){return Tf(n,Bt,od)}var du=ns?function(n){return ns.get(n)}:_u;function gs(n){for(var r=n.name+"",a=zr[r],b=Qe.call(zr,r)?a.length:0;b--;){var _=a[b],B=_.func;if(B==null||B==n)return _.name}return r}function Jr(n){var r=Qe.call(D,"placeholder")?D:n;return r.placeholder}function Se(){var n=D.iteratee||Ru;return n=n===Ru?If:n,arguments.length?n(arguments[0],arguments[1]):n}function vs(n,r){var a=n.__data__;return r0(r)?a[typeof r=="string"?"string":"hash"]:a.map}function hu(n){for(var r=Tt(n),a=r.length;a--;){var b=r[a],_=n[b];r[a]=[b,_,ud(_)]}return r}function ur(n,r){var a=sv(n,r);return wf(a)?a:s}function qy(n){var r=Qe.call(n,rr),a=n[rr];try{n[rr]=s;var b=!0}catch(B){}var _=Jo.call(n);return b&&(r?n[rr]=a:delete n[rr]),_}var pu=Ha?function(n){return n==null?[]:(n=tt(n),kn(Ha(n),function(r){return ff.call(n,r)}))}:Pu,od=Ha?function(n){for(var r=[];n;)Gn(r,pu(n)),n=Yo(n);return r}:Pu,_t=Pt;(Wa&&_t(new Wa(new ArrayBuffer(1)))!=Ur||xi&&_t(new xi)!=pe||$a&&_t($a.resolve())!=st||$r&&_t(new $r)!=oe||_i&&_t(new _i)!=gt)&&(_t=function(n){var r=Pt(n),a=r==et?n.constructor:s,b=a?lr(a):"";if(b)switch(b){case Pv:return Ur;case Lv:return pe;case Dv:return st;case Nv:return oe;case Fv:return gt}return r});function Yy(n,r,a){for(var b=-1,_=a.length;++b<_;){var B=a[b],V=B.size;switch(B.type){case"drop":n+=V;break;case"dropRight":r-=V;break;case"take":r=xt(r,n+V);break;case"takeRight":n=bt(n,r-V);break}}return{start:n,end:r}}function Qy(n){var r=n.match(ig);return r?r[1].split(og):[]}function sd(n,r,a){r=jn(r,n);for(var b=-1,_=r.length,B=!1;++b<_;){var V=vn(r[b]);if(!(B=n!=null&&a(n,V)))break;n=n[V]}return B||++b!=_?B:(_=n==null?0:n.length,!!_&&Ts(_)&&Mn(V,_)&&(Me(n)||cr(n)))}function Xy(n){var r=n.length,a=new n.constructor(r);return r&&typeof n[0]=="string"&&Qe.call(n,"index")&&(a.index=n.index,a.input=n.input),a}function ad(n){return typeof n.constructor=="function"&&!Gi(n)?Vr(Yo(n)):{}}function e0(n,r,a){var b=n.constructor;switch(r){case Ii:return au(n);case ne:case ce:return new b(+n);case Ur:return Uy(n,a);case ha:case pa:case ma:case ga:case va:case ya:case ba:case Ea:case Aa:return $f(n,a);case pe:return new b;case Ve:case le:return new b(n);case X:return By(n);case oe:return new b;case ge:return ky(n)}}function t0(n,r){var a=r.length;if(!a)return n;var b=a-1;return r[b]=(a>1?"& ":"")+r[b],r=r.join(a>2?", ":" "),n.replace(rg,`{
/* [wrapped with `+r+`] */
`)}function n0(n){return Me(n)||cr(n)||!!(df&&n&&n[df])}function Mn(n,r){var a=typeof n;return r=r==null?z:r,!!r&&(a=="number"||a!="symbol"&&pg.test(n))&&n>-1&&n%1==0&&n<r}function Lt(n,r,a){if(!ut(a))return!1;var b=typeof r;return(b=="number"?Ut(a)&&Mn(r,a.length):b=="string"&&r in a)?ln(a[r],n):!1}function mu(n,r){if(Me(n))return!1;var a=typeof n;return a=="number"||a=="symbol"||a=="boolean"||n==null||zt(n)?!0:Xm.test(n)||!Qm.test(n)||r!=null&&n in tt(r)}function r0(n){var r=typeof n;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?n!=="__proto__":n===null}function gu(n){var r=gs(n),a=D[r];if(typeof a!="function"||!(r in Ge.prototype))return!1;if(n===a)return!0;var b=du(a);return!!b&&n===b[0]}function i0(n){return!!uf&&uf in n}var o0=jo?Rn:Lu;function Gi(n){var r=n&&n.constructor,a=typeof r=="function"&&r.prototype||Wr;return n===a}function ud(n){return n===n&&!ut(n)}function ld(n,r){return function(a){return a==null?!1:a[n]===r&&(r!==s||n in tt(a))}}function s0(n){var r=Ss(n,function(b){return a.size===u&&a.clear(),b}),a=r.cache;return r}function a0(n,r){var a=n[1],b=r[1],_=a|b,B=_<(I|x|g),V=b==g&&a==S||b==g&&a==v&&n[7].length<=r[8]||b==(g|v)&&r[7].length<=r[8]&&a==S;if(!(B||V))return n;b&I&&(n[2]=r[2],_|=a&I?0:T);var J=r[3];if(J){var Q=n[3];n[3]=Q?Vf(Q,J,r[4]):J,n[4]=Q?Hn(n[3],f):r[4]}return J=r[5],J&&(Q=n[5],n[5]=Q?jf(Q,J,r[6]):J,n[6]=Q?Hn(n[5],f):r[6]),J=r[7],J&&(n[7]=J),b&g&&(n[8]=n[8]==null?r[8]:xt(n[8],r[8])),n[9]==null&&(n[9]=r[9]),n[0]=r[0],n[1]=_,n}function u0(n){var r=[];if(n!=null)for(var a in tt(n))r.push(a);return r}function l0(n){return Jo.call(n)}function cd(n,r,a){return r=bt(r===s?n.length-1:r,0),function(){for(var b=arguments,_=-1,B=bt(b.length-r,0),V=re(B);++_<B;)V[_]=b[r+_];_=-1;for(var J=re(r+1);++_<r;)J[_]=b[_];return J[r]=a(V),Ht(n,this,J)}}function fd(n,r){return r.length<2?n:ar(n,en(r,0,-1))}function c0(n,r){for(var a=n.length,b=xt(r.length,a),_=Ft(n);b--;){var B=r[b];n[b]=Mn(B,a)?_[B]:s}return n}function vu(n,r){if(!(r==="constructor"&&typeof n[r]=="function")&&r!="__proto__")return n[r]}var dd=pd(Nf),Hi=Ov||function(n,r){return Ct.setTimeout(n,r)},yu=pd(Ly);function hd(n,r,a){var b=r+"";return yu(n,t0(b,f0(Qy(b),a)))}function pd(n){var r=0,a=0;return function(){var b=Rv(),_=$-(b-a);if(a=b,_>0){if(++r>=L)return arguments[0]}else r=0;return n.apply(s,arguments)}}function ys(n,r){var a=-1,b=n.length,_=b-1;for(r=r===s?b:r;++a<r;){var B=eu(a,_),V=n[B];n[B]=n[a],n[a]=V}return n.length=r,n}var md=s0(function(n){var r=[];return n.charCodeAt(0)===46&&r.push(""),n.replace(eg,function(a,b,_,B){r.push(_?B.replace(ug,"$1"):b||a)}),r});function vn(n){if(typeof n=="string"||zt(n))return n;var r=n+"";return r=="0"&&1/n==-P?"-0":r}function lr(n){if(n!=null){try{return Ko.call(n)}catch(r){}try{return n+""}catch(r){}}return""}function f0(n,r){return qt(N,function(a){var b="_."+a[0];r&a[1]&&!Wo(n,b)&&n.push(b)}),n.sort()}function gd(n){if(n instanceof Ge)return n.clone();var r=new Qt(n.__wrapped__,n.__chain__);return r.__actions__=Ft(n.__actions__),r.__index__=n.__index__,r.__values__=n.__values__,r}function d0(n,r,a){(a?Lt(n,r,a):r===s)?r=1:r=bt(Pe(r),0);var b=n==null?0:n.length;if(!b||r<1)return[];for(var _=0,B=0,V=re(es(b/r));_<b;)V[B++]=en(n,_,_+=r);return V}function h0(n){for(var r=-1,a=n==null?0:n.length,b=0,_=[];++r<a;){var B=n[r];B&&(_[b++]=B)}return _}function p0(){var n=arguments.length;if(!n)return[];for(var r=re(n-1),a=arguments[0],b=n;b--;)r[b-1]=arguments[b];return Gn(Me(a)?Ft(a):[a],Mt(r,1))}var m0=Be(function(n,r){return ht(n)?Ni(n,Mt(r,1,ht,!0)):[]}),g0=Be(function(n,r){var a=tn(r);return ht(a)&&(a=s),ht(n)?Ni(n,Mt(r,1,ht,!0),Se(a,2)):[]}),v0=Be(function(n,r){var a=tn(r);return ht(a)&&(a=s),ht(n)?Ni(n,Mt(r,1,ht,!0),s,a):[]});function y0(n,r,a){var b=n==null?0:n.length;return b?(r=a||r===s?1:Pe(r),en(n,r<0?0:r,b)):[]}function b0(n,r,a){var b=n==null?0:n.length;return b?(r=a||r===s?1:Pe(r),r=b-r,en(n,0,r<0?0:r)):[]}function E0(n,r){return n&&n.length?cs(n,Se(r,3),!0,!0):[]}function A0(n,r){return n&&n.length?cs(n,Se(r,3),!0):[]}function S0(n,r,a,b){var _=n==null?0:n.length;return _?(a&&typeof a!="number"&&Lt(n,r,a)&&(a=0,b=_),py(n,r,a,b)):[]}function vd(n,r,a){var b=n==null?0:n.length;if(!b)return-1;var _=a==null?0:Pe(a);return _<0&&(_=bt(b+_,0)),$o(n,Se(r,3),_)}function yd(n,r,a){var b=n==null?0:n.length;if(!b)return-1;var _=b-1;return a!==s&&(_=Pe(a),_=a<0?bt(b+_,0):xt(_,b-1)),$o(n,Se(r,3),_,!0)}function bd(n){var r=n==null?0:n.length;return r?Mt(n,1):[]}function C0(n){var r=n==null?0:n.length;return r?Mt(n,P):[]}function T0(n,r){var a=n==null?0:n.length;return a?(r=r===s?1:Pe(r),Mt(n,r)):[]}function O0(n){for(var r=-1,a=n==null?0:n.length,b={};++r<a;){var _=n[r];b[_[0]]=_[1]}return b}function Ed(n){return n&&n.length?n[0]:s}function w0(n,r,a){var b=n==null?0:n.length;if(!b)return-1;var _=a==null?0:Pe(a);return _<0&&(_=bt(b+_,0)),kr(n,r,_)}function I0(n){var r=n==null?0:n.length;return r?en(n,0,-1):[]}var M0=Be(function(n){var r=at(n,ou);return r.length&&r[0]===n[0]?Za(r):[]}),R0=Be(function(n){var r=tn(n),a=at(n,ou);return r===tn(a)?r=s:a.pop(),a.length&&a[0]===n[0]?Za(a,Se(r,2)):[]}),x0=Be(function(n){var r=tn(n),a=at(n,ou);return r=typeof r=="function"?r:s,r&&a.pop(),a.length&&a[0]===n[0]?Za(a,s,r):[]});function _0(n,r){return n==null?"":Iv.call(n,r)}function tn(n){var r=n==null?0:n.length;return r?n[r-1]:s}function P0(n,r,a){var b=n==null?0:n.length;if(!b)return-1;var _=b;return a!==s&&(_=Pe(a),_=_<0?bt(b+_,0):xt(_,b-1)),r===r?fv(n,r,_):$o(n,Xc,_,!0)}function L0(n,r){return n&&n.length?_f(n,Pe(r)):s}var D0=Be(Ad);function Ad(n,r){return n&&n.length&&r&&r.length?Xa(n,r):n}function N0(n,r,a){return n&&n.length&&r&&r.length?Xa(n,r,Se(a,2)):n}function F0(n,r,a){return n&&n.length&&r&&r.length?Xa(n,r,s,a):n}var U0=In(function(n,r){var a=n==null?0:n.length,b=Va(n,r);return Df(n,at(r,function(_){return Mn(_,a)?+_:_}).sort(zf)),b});function B0(n,r){var a=[];if(!(n&&n.length))return a;var b=-1,_=[],B=n.length;for(r=Se(r,3);++b<B;){var V=n[b];r(V,b,n)&&(a.push(V),_.push(b))}return Df(n,_),a}function bu(n){return n==null?n:_v.call(n)}function k0(n,r,a){var b=n==null?0:n.length;return b?(a&&typeof a!="number"&&Lt(n,r,a)?(r=0,a=b):(r=r==null?0:Pe(r),a=a===s?b:Pe(a)),en(n,r,a)):[]}function G0(n,r){return ls(n,r)}function H0(n,r,a){return nu(n,r,Se(a,2))}function W0(n,r){var a=n==null?0:n.length;if(a){var b=ls(n,r);if(b<a&&ln(n[b],r))return b}return-1}function $0(n,r){return ls(n,r,!0)}function z0(n,r,a){return nu(n,r,Se(a,2),!0)}function V0(n,r){var a=n==null?0:n.length;if(a){var b=ls(n,r,!0)-1;if(ln(n[b],r))return b}return-1}function j0(n){return n&&n.length?Ff(n):[]}function K0(n,r){return n&&n.length?Ff(n,Se(r,2)):[]}function J0(n){var r=n==null?0:n.length;return r?en(n,1,r):[]}function Z0(n,r,a){return n&&n.length?(r=a||r===s?1:Pe(r),en(n,0,r<0?0:r)):[]}function q0(n,r,a){var b=n==null?0:n.length;return b?(r=a||r===s?1:Pe(r),r=b-r,en(n,r<0?0:r,b)):[]}function Y0(n,r){return n&&n.length?cs(n,Se(r,3),!1,!0):[]}function Q0(n,r){return n&&n.length?cs(n,Se(r,3)):[]}var X0=Be(function(n){return Vn(Mt(n,1,ht,!0))}),eb=Be(function(n){var r=tn(n);return ht(r)&&(r=s),Vn(Mt(n,1,ht,!0),Se(r,2))}),tb=Be(function(n){var r=tn(n);return r=typeof r=="function"?r:s,Vn(Mt(n,1,ht,!0),s,r)});function nb(n){return n&&n.length?Vn(n):[]}function rb(n,r){return n&&n.length?Vn(n,Se(r,2)):[]}function ib(n,r){return r=typeof r=="function"?r:s,n&&n.length?Vn(n,s,r):[]}function Eu(n){if(!(n&&n.length))return[];var r=0;return n=kn(n,function(a){if(ht(a))return r=bt(a.length,r),!0}),Ua(r,function(a){return at(n,Da(a))})}function Sd(n,r){if(!(n&&n.length))return[];var a=Eu(n);return r==null?a:at(a,function(b){return Ht(r,s,b)})}var ob=Be(function(n,r){return ht(n)?Ni(n,r):[]}),sb=Be(function(n){return iu(kn(n,ht))}),ab=Be(function(n){var r=tn(n);return ht(r)&&(r=s),iu(kn(n,ht),Se(r,2))}),ub=Be(function(n){var r=tn(n);return r=typeof r=="function"?r:s,iu(kn(n,ht),s,r)}),lb=Be(Eu);function cb(n,r){return Gf(n||[],r||[],Di)}function fb(n,r){return Gf(n||[],r||[],Bi)}var db=Be(function(n){var r=n.length,a=r>1?n[r-1]:s;return a=typeof a=="function"?(n.pop(),a):s,Sd(n,a)});function Cd(n){var r=D(n);return r.__chain__=!0,r}function hb(n,r){return r(n),n}function bs(n,r){return r(n)}var pb=In(function(n){var r=n.length,a=r?n[0]:0,b=this.__wrapped__,_=function(B){return Va(B,n)};return r>1||this.__actions__.length||!(b instanceof Ge)||!Mn(a)?this.thru(_):(b=b.slice(a,+a+(r?1:0)),b.__actions__.push({func:bs,args:[_],thisArg:s}),new Qt(b,this.__chain__).thru(function(B){return r&&!B.length&&B.push(s),B}))});function mb(){return Cd(this)}function gb(){return new Qt(this.value(),this.__chain__)}function vb(){this.__values__===s&&(this.__values__=Ud(this.value()));var n=this.__index__>=this.__values__.length,r=n?s:this.__values__[this.__index__++];return{done:n,value:r}}function yb(){return this}function bb(n){for(var r,a=this;a instanceof is;){var b=gd(a);b.__index__=0,b.__values__=s,r?_.__wrapped__=b:r=b;var _=b;a=a.__wrapped__}return _.__wrapped__=n,r}function Eb(){var n=this.__wrapped__;if(n instanceof Ge){var r=n;return this.__actions__.length&&(r=new Ge(this)),r=r.reverse(),r.__actions__.push({func:bs,args:[bu],thisArg:s}),new Qt(r,this.__chain__)}return this.thru(bu)}function Ab(){return kf(this.__wrapped__,this.__actions__)}var Sb=fs(function(n,r,a){Qe.call(n,a)?++n[a]:On(n,a,1)});function Cb(n,r,a){var b=Me(n)?Yc:hy;return a&&Lt(n,r,a)&&(r=s),b(n,Se(r,3))}function Tb(n,r){var a=Me(n)?kn:Sf;return a(n,Se(r,3))}var Ob=qf(vd),wb=qf(yd);function Ib(n,r){return Mt(Es(n,r),1)}function Mb(n,r){return Mt(Es(n,r),P)}function Rb(n,r,a){return a=a===s?1:Pe(a),Mt(Es(n,r),a)}function Td(n,r){var a=Me(n)?qt:zn;return a(n,Se(r,3))}function Od(n,r){var a=Me(n)?Jg:Af;return a(n,Se(r,3))}var xb=fs(function(n,r,a){Qe.call(n,a)?n[a].push(r):On(n,a,[r])});function _b(n,r,a,b){n=Ut(n)?n:qr(n),a=a&&!b?Pe(a):0;var _=n.length;return a<0&&(a=bt(_+a,0)),Os(n)?a<=_&&n.indexOf(r,a)>-1:!!_&&kr(n,r,a)>-1}var Pb=Be(function(n,r,a){var b=-1,_=typeof r=="function",B=Ut(n)?re(n.length):[];return zn(n,function(V){B[++b]=_?Ht(r,V,a):Fi(V,r,a)}),B}),Lb=fs(function(n,r,a){On(n,a,r)});function Es(n,r){var a=Me(n)?at:Mf;return a(n,Se(r,3))}function Db(n,r,a,b){return n==null?[]:(Me(r)||(r=r==null?[]:[r]),a=b?s:a,Me(a)||(a=a==null?[]:[a]),Pf(n,r,a))}var Nb=fs(function(n,r,a){n[a?0:1].push(r)},function(){return[[],[]]});function Fb(n,r,a){var b=Me(n)?Pa:tf,_=arguments.length<3;return b(n,Se(r,4),a,_,zn)}function Ub(n,r,a){var b=Me(n)?Zg:tf,_=arguments.length<3;return b(n,Se(r,4),a,_,Af)}function Bb(n,r){var a=Me(n)?kn:Sf;return a(n,Cs(Se(r,3)))}function kb(n){var r=Me(n)?vf:_y;return r(n)}function Gb(n,r,a){(a?Lt(n,r,a):r===s)?r=1:r=Pe(r);var b=Me(n)?uy:Py;return b(n,r)}function Hb(n){var r=Me(n)?ly:Dy;return r(n)}function Wb(n){if(n==null)return 0;if(Ut(n))return Os(n)?Hr(n):n.length;var r=_t(n);return r==pe||r==oe?n.size:Ya(n).length}function $b(n,r,a){var b=Me(n)?La:Ny;return a&&Lt(n,r,a)&&(r=s),b(n,Se(r,3))}var zb=Be(function(n,r){if(n==null)return[];var a=r.length;return a>1&&Lt(n,r[0],r[1])?r=[]:a>2&&Lt(r[0],r[1],r[2])&&(r=[r[0]]),Pf(n,Mt(r,1),[])}),As=Tv||function(){return Ct.Date.now()};function Vb(n,r){if(typeof r!="function")throw new Yt(o);return n=Pe(n),function(){if(--n<1)return r.apply(this,arguments)}}function wd(n,r,a){return r=a?s:r,r=n&&r==null?n.length:r,wn(n,g,s,s,s,s,r)}function Id(n,r){var a;if(typeof r!="function")throw new Yt(o);return n=Pe(n),function(){return--n>0&&(a=r.apply(this,arguments)),n<=1&&(r=s),a}}var Au=Be(function(n,r,a){var b=I;if(a.length){var _=Hn(a,Jr(Au));b|=p}return wn(n,b,r,a,_)}),Md=Be(function(n,r,a){var b=I|x;if(a.length){var _=Hn(a,Jr(Md));b|=p}return wn(r,b,n,a,_)});function Rd(n,r,a){r=a?s:r;var b=wn(n,S,s,s,s,s,s,r);return b.placeholder=Rd.placeholder,b}function xd(n,r,a){r=a?s:r;var b=wn(n,w,s,s,s,s,s,r);return b.placeholder=xd.placeholder,b}function _d(n,r,a){var b,_,B,V,J,Q,se=0,ae=!1,ue=!1,de=!0;if(typeof n!="function")throw new Yt(o);r=nn(r)||0,ut(a)&&(ae=!!a.leading,ue="maxWait"in a,B=ue?bt(nn(a.maxWait)||0,r):B,de="trailing"in a?!!a.trailing:de);function ve(pt){var cn=b,_n=_;return b=_=s,se=pt,V=n.apply(_n,cn),V}function Ce(pt){return se=pt,J=Hi(ke,r),ae?ve(pt):V}function Ne(pt){var cn=pt-Q,_n=pt-se,qd=r-cn;return ue?xt(qd,B-_n):qd}function Te(pt){var cn=pt-Q,_n=pt-se;return Q===s||cn>=r||cn<0||ue&&_n>=B}function ke(){var pt=As();if(Te(pt))return $e(pt);J=Hi(ke,Ne(pt))}function $e(pt){return J=s,de&&b?ve(pt):(b=_=s,V)}function Vt(){J!==s&&Hf(J),se=0,b=Q=_=J=s}function Dt(){return J===s?V:$e(As())}function jt(){var pt=As(),cn=Te(pt);if(b=arguments,_=this,Q=pt,cn){if(J===s)return Ce(Q);if(ue)return Hf(J),J=Hi(ke,r),ve(Q)}return J===s&&(J=Hi(ke,r)),V}return jt.cancel=Vt,jt.flush=Dt,jt}var jb=Be(function(n,r){return Ef(n,1,r)}),Kb=Be(function(n,r,a){return Ef(n,nn(r)||0,a)});function Jb(n){return wn(n,h)}function Ss(n,r){if(typeof n!="function"||r!=null&&typeof r!="function")throw new Yt(o);var a=function(){var b=arguments,_=r?r.apply(this,b):b[0],B=a.cache;if(B.has(_))return B.get(_);var V=n.apply(this,b);return a.cache=B.set(_,V)||B,V};return a.cache=new(Ss.Cache||Tn),a}Ss.Cache=Tn;function Cs(n){if(typeof n!="function")throw new Yt(o);return function(){var r=arguments;switch(r.length){case 0:return!n.call(this);case 1:return!n.call(this,r[0]);case 2:return!n.call(this,r[0],r[1]);case 3:return!n.call(this,r[0],r[1],r[2])}return!n.apply(this,r)}}function Zb(n){return Id(2,n)}var qb=Fy(function(n,r){r=r.length==1&&Me(r[0])?at(r[0],Wt(Se())):at(Mt(r,1),Wt(Se()));var a=r.length;return Be(function(b){for(var _=-1,B=xt(b.length,a);++_<B;)b[_]=r[_].call(this,b[_]);return Ht(n,this,b)})}),Su=Be(function(n,r){var a=Hn(r,Jr(Su));return wn(n,p,s,r,a)}),Pd=Be(function(n,r){var a=Hn(r,Jr(Pd));return wn(n,y,s,r,a)}),Yb=In(function(n,r){return wn(n,v,s,s,s,r)});function Qb(n,r){if(typeof n!="function")throw new Yt(o);return r=r===s?r:Pe(r),Be(n,r)}function Xb(n,r){if(typeof n!="function")throw new Yt(o);return r=r==null?0:bt(Pe(r),0),Be(function(a){var b=a[r],_=Kn(a,0,r);return b&&Gn(_,b),Ht(n,this,_)})}function eE(n,r,a){var b=!0,_=!0;if(typeof n!="function")throw new Yt(o);return ut(a)&&(b="leading"in a?!!a.leading:b,_="trailing"in a?!!a.trailing:_),_d(n,r,{leading:b,maxWait:r,trailing:_})}function tE(n){return wd(n,1)}function nE(n,r){return Su(su(r),n)}function rE(){if(!arguments.length)return[];var n=arguments[0];return Me(n)?n:[n]}function iE(n){return Xt(n,O)}function oE(n,r){return r=typeof r=="function"?r:s,Xt(n,O,r)}function sE(n){return Xt(n,m|O)}function aE(n,r){return r=typeof r=="function"?r:s,Xt(n,m|O,r)}function uE(n,r){return r==null||bf(n,r,Tt(r))}function ln(n,r){return n===r||n!==n&&r!==r}var lE=ms(Ja),cE=ms(function(n,r){return n>=r}),cr=Of(function(){return arguments}())?Of:function(n){return dt(n)&&Qe.call(n,"callee")&&!ff.call(n,"callee")},Me=re.isArray,fE=Vc?Wt(Vc):by;function Ut(n){return n!=null&&Ts(n.length)&&!Rn(n)}function ht(n){return dt(n)&&Ut(n)}function dE(n){return n===!0||n===!1||dt(n)&&Pt(n)==ne}var Jn=wv||Lu,hE=jc?Wt(jc):Ey;function pE(n){return dt(n)&&n.nodeType===1&&!Wi(n)}function mE(n){if(n==null)return!0;if(Ut(n)&&(Me(n)||typeof n=="string"||typeof n.splice=="function"||Jn(n)||Zr(n)||cr(n)))return!n.length;var r=_t(n);if(r==pe||r==oe)return!n.size;if(Gi(n))return!Ya(n).length;for(var a in n)if(Qe.call(n,a))return!1;return!0}function gE(n,r){return Ui(n,r)}function vE(n,r,a){a=typeof a=="function"?a:s;var b=a?a(n,r):s;return b===s?Ui(n,r,s,a):!!b}function Cu(n){if(!dt(n))return!1;var r=Pt(n);return r==be||r==Ee||typeof n.message=="string"&&typeof n.name=="string"&&!Wi(n)}function yE(n){return typeof n=="number"&&hf(n)}function Rn(n){if(!ut(n))return!1;var r=Pt(n);return r==_e||r==Ke||r==j||r==Nt}function Ld(n){return typeof n=="number"&&n==Pe(n)}function Ts(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=z}function ut(n){var r=typeof n;return n!=null&&(r=="object"||r=="function")}function dt(n){return n!=null&&typeof n=="object"}var Dd=Kc?Wt(Kc):Sy;function bE(n,r){return n===r||qa(n,r,hu(r))}function EE(n,r,a){return a=typeof a=="function"?a:s,qa(n,r,hu(r),a)}function AE(n){return Nd(n)&&n!=+n}function SE(n){if(o0(n))throw new Ie(i);return wf(n)}function CE(n){return n===null}function TE(n){return n==null}function Nd(n){return typeof n=="number"||dt(n)&&Pt(n)==Ve}function Wi(n){if(!dt(n)||Pt(n)!=et)return!1;var r=Yo(n);if(r===null)return!0;var a=Qe.call(r,"constructor")&&r.constructor;return typeof a=="function"&&a instanceof a&&Ko.call(a)==Ev}var Tu=Jc?Wt(Jc):Cy;function OE(n){return Ld(n)&&n>=-z&&n<=z}var Fd=Zc?Wt(Zc):Ty;function Os(n){return typeof n=="string"||!Me(n)&&dt(n)&&Pt(n)==le}function zt(n){return typeof n=="symbol"||dt(n)&&Pt(n)==ge}var Zr=qc?Wt(qc):Oy;function wE(n){return n===s}function IE(n){return dt(n)&&_t(n)==gt}function ME(n){return dt(n)&&Pt(n)==tr}var RE=ms(Qa),xE=ms(function(n,r){return n<=r});function Ud(n){if(!n)return[];if(Ut(n))return Os(n)?an(n):Ft(n);if(Ri&&n[Ri])return uv(n[Ri]());var r=_t(n),a=r==pe?ka:r==oe?zo:qr;return a(n)}function xn(n){if(!n)return n===0?n:0;if(n=nn(n),n===P||n===-P){var r=n<0?-1:1;return r*W}return n===n?n:0}function Pe(n){var r=xn(n),a=r%1;return r===r?a?r-a:r:0}function Bd(n){return n?sr(Pe(n),0,te):0}function nn(n){if(typeof n=="number")return n;if(zt(n))return Z;if(ut(n)){var r=typeof n.valueOf=="function"?n.valueOf():n;n=ut(r)?r+"":r}if(typeof n!="string")return n===0?n:+n;n=nf(n);var a=fg.test(n);return a||hg.test(n)?Vg(n.slice(2),a?2:8):cg.test(n)?Z:+n}function kd(n){return gn(n,Bt(n))}function _E(n){return n?sr(Pe(n),-z,z):n===0?n:0}function qe(n){return n==null?"":$t(n)}var PE=jr(function(n,r){if(Gi(r)||Ut(r)){gn(r,Tt(r),n);return}for(var a in r)Qe.call(r,a)&&Di(n,a,r[a])}),Gd=jr(function(n,r){gn(r,Bt(r),n)}),ws=jr(function(n,r,a,b){gn(r,Bt(r),n,b)}),LE=jr(function(n,r,a,b){gn(r,Tt(r),n,b)}),DE=In(Va);function NE(n,r){var a=Vr(n);return r==null?a:yf(a,r)}var FE=Be(function(n,r){n=tt(n);var a=-1,b=r.length,_=b>2?r[2]:s;for(_&&Lt(r[0],r[1],_)&&(b=1);++a<b;)for(var B=r[a],V=Bt(B),J=-1,Q=V.length;++J<Q;){var se=V[J],ae=n[se];(ae===s||ln(ae,Wr[se])&&!Qe.call(n,se))&&(n[se]=B[se])}return n}),UE=Be(function(n){return n.push(s,rd),Ht(Hd,s,n)});function BE(n,r){return Qc(n,Se(r,3),mn)}function kE(n,r){return Qc(n,Se(r,3),Ka)}function GE(n,r){return n==null?n:ja(n,Se(r,3),Bt)}function HE(n,r){return n==null?n:Cf(n,Se(r,3),Bt)}function WE(n,r){return n&&mn(n,Se(r,3))}function $E(n,r){return n&&Ka(n,Se(r,3))}function zE(n){return n==null?[]:as(n,Tt(n))}function VE(n){return n==null?[]:as(n,Bt(n))}function Ou(n,r,a){var b=n==null?s:ar(n,r);return b===s?a:b}function jE(n,r){return n!=null&&sd(n,r,my)}function wu(n,r){return n!=null&&sd(n,r,gy)}var KE=Qf(function(n,r,a){r!=null&&typeof r.toString!="function"&&(r=Jo.call(r)),n[r]=a},Mu(kt)),JE=Qf(function(n,r,a){r!=null&&typeof r.toString!="function"&&(r=Jo.call(r)),Qe.call(n,r)?n[r].push(a):n[r]=[a]},Se),ZE=Be(Fi);function Tt(n){return Ut(n)?gf(n):Ya(n)}function Bt(n){return Ut(n)?gf(n,!0):wy(n)}function qE(n,r){var a={};return r=Se(r,3),mn(n,function(b,_,B){On(a,r(b,_,B),b)}),a}function YE(n,r){var a={};return r=Se(r,3),mn(n,function(b,_,B){On(a,_,r(b,_,B))}),a}var QE=jr(function(n,r,a){us(n,r,a)}),Hd=jr(function(n,r,a,b){us(n,r,a,b)}),XE=In(function(n,r){var a={};if(n==null)return a;var b=!1;r=at(r,function(B){return B=jn(B,n),b||(b=B.length>1),B}),gn(n,fu(n),a),b&&(a=Xt(a,m|E|O,Ky));for(var _=r.length;_--;)ru(a,r[_]);return a});function eA(n,r){return Wd(n,Cs(Se(r)))}var tA=In(function(n,r){return n==null?{}:My(n,r)});function Wd(n,r){if(n==null)return{};var a=at(fu(n),function(b){return[b]});return r=Se(r),Lf(n,a,function(b,_){return r(b,_[0])})}function nA(n,r,a){r=jn(r,n);var b=-1,_=r.length;for(_||(_=1,n=s);++b<_;){var B=n==null?s:n[vn(r[b])];B===s&&(b=_,B=a),n=Rn(B)?B.call(n):B}return n}function rA(n,r,a){return n==null?n:Bi(n,r,a)}function iA(n,r,a,b){return b=typeof b=="function"?b:s,n==null?n:Bi(n,r,a,b)}var $d=td(Tt),zd=td(Bt);function oA(n,r,a){var b=Me(n),_=b||Jn(n)||Zr(n);if(r=Se(r,4),a==null){var B=n&&n.constructor;_?a=b?new B:[]:ut(n)?a=Rn(B)?Vr(Yo(n)):{}:a={}}return(_?qt:mn)(n,function(V,J,Q){return r(a,V,J,Q)}),a}function sA(n,r){return n==null?!0:ru(n,r)}function aA(n,r,a){return n==null?n:Bf(n,r,su(a))}function uA(n,r,a,b){return b=typeof b=="function"?b:s,n==null?n:Bf(n,r,su(a),b)}function qr(n){return n==null?[]:Ba(n,Tt(n))}function lA(n){return n==null?[]:Ba(n,Bt(n))}function cA(n,r,a){return a===s&&(a=r,r=s),a!==s&&(a=nn(a),a=a===a?a:0),r!==s&&(r=nn(r),r=r===r?r:0),sr(nn(n),r,a)}function fA(n,r,a){return r=xn(r),a===s?(a=r,r=0):a=xn(a),n=nn(n),vy(n,r,a)}function dA(n,r,a){if(a&&typeof a!="boolean"&&Lt(n,r,a)&&(r=a=s),a===s&&(typeof r=="boolean"?(a=r,r=s):typeof n=="boolean"&&(a=n,n=s)),n===s&&r===s?(n=0,r=1):(n=xn(n),r===s?(r=n,n=0):r=xn(r)),n>r){var b=n;n=r,r=b}if(a||n%1||r%1){var _=pf();return xt(n+_*(r-n+zg("1e-"+((_+"").length-1))),r)}return eu(n,r)}var hA=Kr(function(n,r,a){return r=r.toLowerCase(),n+(a?Vd(r):r)});function Vd(n){return Iu(qe(n).toLowerCase())}function jd(n){return n=qe(n),n&&n.replace(mg,rv).replace(Dg,"")}function pA(n,r,a){n=qe(n),r=$t(r);var b=n.length;a=a===s?b:sr(Pe(a),0,b);var _=a;return a-=r.length,a>=0&&n.slice(a,_)==r}function mA(n){return n=qe(n),n&&Zm.test(n)?n.replace(Sc,iv):n}function gA(n){return n=qe(n),n&&tg.test(n)?n.replace(Sa,"\\$&"):n}var vA=Kr(function(n,r,a){return n+(a?"-":"")+r.toLowerCase()}),yA=Kr(function(n,r,a){return n+(a?" ":"")+r.toLowerCase()}),bA=Zf("toLowerCase");function EA(n,r,a){n=qe(n),r=Pe(r);var b=r?Hr(n):0;if(!r||b>=r)return n;var _=(r-b)/2;return ps(ts(_),a)+n+ps(es(_),a)}function AA(n,r,a){n=qe(n),r=Pe(r);var b=r?Hr(n):0;return r&&b<r?n+ps(r-b,a):n}function SA(n,r,a){n=qe(n),r=Pe(r);var b=r?Hr(n):0;return r&&b<r?ps(r-b,a)+n:n}function CA(n,r,a){return a||r==null?r=0:r&&(r=+r),xv(qe(n).replace(Ca,""),r||0)}function TA(n,r,a){return(a?Lt(n,r,a):r===s)?r=1:r=Pe(r),tu(qe(n),r)}function OA(){var n=arguments,r=qe(n[0]);return n.length<3?r:r.replace(n[1],n[2])}var wA=Kr(function(n,r,a){return n+(a?"_":"")+r.toLowerCase()});function IA(n,r,a){return a&&typeof a!="number"&&Lt(n,r,a)&&(r=a=s),a=a===s?te:a>>>0,a?(n=qe(n),n&&(typeof r=="string"||r!=null&&!Tu(r))&&(r=$t(r),!r&&Gr(n))?Kn(an(n),0,a):n.split(r,a)):[]}var MA=Kr(function(n,r,a){return n+(a?" ":"")+Iu(r)});function RA(n,r,a){return n=qe(n),a=a==null?0:sr(Pe(a),0,n.length),r=$t(r),n.slice(a,a+r.length)==r}function xA(n,r,a){var b=D.templateSettings;a&&Lt(n,r,a)&&(r=s),n=qe(n),r=ws({},r,b,nd);var _=ws({},r.imports,b.imports,nd),B=Tt(_),V=Ba(_,B),J,Q,se=0,ae=r.interpolate||ko,ue="__p += '",de=Ga((r.escape||ko).source+"|"+ae.source+"|"+(ae===Cc?lg:ko).source+"|"+(r.evaluate||ko).source+"|$","g"),ve="//# sourceURL="+(Qe.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++kg+"]")+`
`;n.replace(de,function(Te,ke,$e,Vt,Dt,jt){return $e||($e=Vt),ue+=n.slice(se,jt).replace(gg,ov),ke&&(J=!0,ue+=`' +
__e(`+ke+`) +
'`),Dt&&(Q=!0,ue+=`';
`+Dt+`;
__p += '`),$e&&(ue+=`' +
((__t = (`+$e+`)) == null ? '' : __t) +
'`),se=jt+Te.length,Te}),ue+=`';
`;var Ce=Qe.call(r,"variable")&&r.variable;if(!Ce)ue=`with (obj) {
`+ue+`
}
`;else if(ag.test(Ce))throw new Ie(l);ue=(Q?ue.replace(Vm,""):ue).replace(jm,"$1").replace(Km,"$1;"),ue="function("+(Ce||"obj")+`) {
`+(Ce?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ue+`return __p
}`;var Ne=Jd(function(){return Je(B,ve+"return "+ue).apply(s,V)});if(Ne.source=ue,Cu(Ne))throw Ne;return Ne}function _A(n){return qe(n).toLowerCase()}function PA(n){return qe(n).toUpperCase()}function LA(n,r,a){if(n=qe(n),n&&(a||r===s))return nf(n);if(!n||!(r=$t(r)))return n;var b=an(n),_=an(r),B=rf(b,_),V=of(b,_)+1;return Kn(b,B,V).join("")}function DA(n,r,a){if(n=qe(n),n&&(a||r===s))return n.slice(0,af(n)+1);if(!n||!(r=$t(r)))return n;var b=an(n),_=of(b,an(r))+1;return Kn(b,0,_).join("")}function NA(n,r,a){if(n=qe(n),n&&(a||r===s))return n.replace(Ca,"");if(!n||!(r=$t(r)))return n;var b=an(n),_=rf(b,an(r));return Kn(b,_).join("")}function FA(n,r){var a=C,b=M;if(ut(r)){var _="separator"in r?r.separator:_;a="length"in r?Pe(r.length):a,b="omission"in r?$t(r.omission):b}n=qe(n);var B=n.length;if(Gr(n)){var V=an(n);B=V.length}if(a>=B)return n;var J=a-Hr(b);if(J<1)return b;var Q=V?Kn(V,0,J).join(""):n.slice(0,J);if(_===s)return Q+b;if(V&&(J+=Q.length-J),Tu(_)){if(n.slice(J).search(_)){var se,ae=Q;for(_.global||(_=Ga(_.source,qe(Tc.exec(_))+"g")),_.lastIndex=0;se=_.exec(ae);)var ue=se.index;Q=Q.slice(0,ue===s?J:ue)}}else if(n.indexOf($t(_),J)!=J){var de=Q.lastIndexOf(_);de>-1&&(Q=Q.slice(0,de))}return Q+b}function UA(n){return n=qe(n),n&&Jm.test(n)?n.replace(Ac,dv):n}var BA=Kr(function(n,r,a){return n+(a?" ":"")+r.toUpperCase()}),Iu=Zf("toUpperCase");function Kd(n,r,a){return n=qe(n),r=a?s:r,r===s?av(n)?mv(n):Qg(n):n.match(r)||[]}var Jd=Be(function(n,r){try{return Ht(n,s,r)}catch(a){return Cu(a)?a:new Ie(a)}}),kA=In(function(n,r){return qt(r,function(a){a=vn(a),On(n,a,Au(n[a],n))}),n});function GA(n){var r=n==null?0:n.length,a=Se();return n=r?at(n,function(b){if(typeof b[1]!="function")throw new Yt(o);return[a(b[0]),b[1]]}):[],Be(function(b){for(var _=-1;++_<r;){var B=n[_];if(Ht(B[0],this,b))return Ht(B[1],this,b)}})}function HA(n){return dy(Xt(n,m))}function Mu(n){return function(){return n}}function WA(n,r){return n==null||n!==n?r:n}var $A=Yf(),zA=Yf(!0);function kt(n){return n}function Ru(n){return If(typeof n=="function"?n:Xt(n,m))}function VA(n){return Rf(Xt(n,m))}function jA(n,r){return xf(n,Xt(r,m))}var KA=Be(function(n,r){return function(a){return Fi(a,n,r)}}),JA=Be(function(n,r){return function(a){return Fi(n,a,r)}});function xu(n,r,a){var b=Tt(r),_=as(r,b);a==null&&!(ut(r)&&(_.length||!b.length))&&(a=r,r=n,n=this,_=as(r,Tt(r)));var B=!(ut(a)&&"chain"in a)||!!a.chain,V=Rn(n);return qt(_,function(J){var Q=r[J];n[J]=Q,V&&(n.prototype[J]=function(){var se=this.__chain__;if(B||se){var ae=n(this.__wrapped__),ue=ae.__actions__=Ft(this.__actions__);return ue.push({func:Q,args:arguments,thisArg:n}),ae.__chain__=se,ae}return Q.apply(n,Gn([this.value()],arguments))})}),n}function ZA(){return Ct._===this&&(Ct._=Av),this}function _u(){}function qA(n){return n=Pe(n),Be(function(r){return _f(r,n)})}var YA=uu(at),QA=uu(Yc),XA=uu(La);function Zd(n){return mu(n)?Da(vn(n)):Ry(n)}function eS(n){return function(r){return n==null?s:ar(n,r)}}var tS=Xf(),nS=Xf(!0);function Pu(){return[]}function Lu(){return!1}function rS(){return{}}function iS(){return""}function oS(){return!0}function sS(n,r){if(n=Pe(n),n<1||n>z)return[];var a=te,b=xt(n,te);r=Se(r),n-=te;for(var _=Ua(b,r);++a<n;)r(a);return _}function aS(n){return Me(n)?at(n,vn):zt(n)?[n]:Ft(md(qe(n)))}function uS(n){var r=++bv;return qe(n)+r}var lS=hs(function(n,r){return n+r},0),cS=lu("ceil"),fS=hs(function(n,r){return n/r},1),dS=lu("floor");function hS(n){return n&&n.length?ss(n,kt,Ja):s}function pS(n,r){return n&&n.length?ss(n,Se(r,2),Ja):s}function mS(n){return ef(n,kt)}function gS(n,r){return ef(n,Se(r,2))}function vS(n){return n&&n.length?ss(n,kt,Qa):s}function yS(n,r){return n&&n.length?ss(n,Se(r,2),Qa):s}var bS=hs(function(n,r){return n*r},1),ES=lu("round"),AS=hs(function(n,r){return n-r},0);function SS(n){return n&&n.length?Fa(n,kt):0}function CS(n,r){return n&&n.length?Fa(n,Se(r,2)):0}return D.after=Vb,D.ary=wd,D.assign=PE,D.assignIn=Gd,D.assignInWith=ws,D.assignWith=LE,D.at=DE,D.before=Id,D.bind=Au,D.bindAll=kA,D.bindKey=Md,D.castArray=rE,D.chain=Cd,D.chunk=d0,D.compact=h0,D.concat=p0,D.cond=GA,D.conforms=HA,D.constant=Mu,D.countBy=Sb,D.create=NE,D.curry=Rd,D.curryRight=xd,D.debounce=_d,D.defaults=FE,D.defaultsDeep=UE,D.defer=jb,D.delay=Kb,D.difference=m0,D.differenceBy=g0,D.differenceWith=v0,D.drop=y0,D.dropRight=b0,D.dropRightWhile=E0,D.dropWhile=A0,D.fill=S0,D.filter=Tb,D.flatMap=Ib,D.flatMapDeep=Mb,D.flatMapDepth=Rb,D.flatten=bd,D.flattenDeep=C0,D.flattenDepth=T0,D.flip=Jb,D.flow=$A,D.flowRight=zA,D.fromPairs=O0,D.functions=zE,D.functionsIn=VE,D.groupBy=xb,D.initial=I0,D.intersection=M0,D.intersectionBy=R0,D.intersectionWith=x0,D.invert=KE,D.invertBy=JE,D.invokeMap=Pb,D.iteratee=Ru,D.keyBy=Lb,D.keys=Tt,D.keysIn=Bt,D.map=Es,D.mapKeys=qE,D.mapValues=YE,D.matches=VA,D.matchesProperty=jA,D.memoize=Ss,D.merge=QE,D.mergeWith=Hd,D.method=KA,D.methodOf=JA,D.mixin=xu,D.negate=Cs,D.nthArg=qA,D.omit=XE,D.omitBy=eA,D.once=Zb,D.orderBy=Db,D.over=YA,D.overArgs=qb,D.overEvery=QA,D.overSome=XA,D.partial=Su,D.partialRight=Pd,D.partition=Nb,D.pick=tA,D.pickBy=Wd,D.property=Zd,D.propertyOf=eS,D.pull=D0,D.pullAll=Ad,D.pullAllBy=N0,D.pullAllWith=F0,D.pullAt=U0,D.range=tS,D.rangeRight=nS,D.rearg=Yb,D.reject=Bb,D.remove=B0,D.rest=Qb,D.reverse=bu,D.sampleSize=Gb,D.set=rA,D.setWith=iA,D.shuffle=Hb,D.slice=k0,D.sortBy=zb,D.sortedUniq=j0,D.sortedUniqBy=K0,D.split=IA,D.spread=Xb,D.tail=J0,D.take=Z0,D.takeRight=q0,D.takeRightWhile=Y0,D.takeWhile=Q0,D.tap=hb,D.throttle=eE,D.thru=bs,D.toArray=Ud,D.toPairs=$d,D.toPairsIn=zd,D.toPath=aS,D.toPlainObject=kd,D.transform=oA,D.unary=tE,D.union=X0,D.unionBy=eb,D.unionWith=tb,D.uniq=nb,D.uniqBy=rb,D.uniqWith=ib,D.unset=sA,D.unzip=Eu,D.unzipWith=Sd,D.update=aA,D.updateWith=uA,D.values=qr,D.valuesIn=lA,D.without=ob,D.words=Kd,D.wrap=nE,D.xor=sb,D.xorBy=ab,D.xorWith=ub,D.zip=lb,D.zipObject=cb,D.zipObjectDeep=fb,D.zipWith=db,D.entries=$d,D.entriesIn=zd,D.extend=Gd,D.extendWith=ws,xu(D,D),D.add=lS,D.attempt=Jd,D.camelCase=hA,D.capitalize=Vd,D.ceil=cS,D.clamp=cA,D.clone=iE,D.cloneDeep=sE,D.cloneDeepWith=aE,D.cloneWith=oE,D.conformsTo=uE,D.deburr=jd,D.defaultTo=WA,D.divide=fS,D.endsWith=pA,D.eq=ln,D.escape=mA,D.escapeRegExp=gA,D.every=Cb,D.find=Ob,D.findIndex=vd,D.findKey=BE,D.findLast=wb,D.findLastIndex=yd,D.findLastKey=kE,D.floor=dS,D.forEach=Td,D.forEachRight=Od,D.forIn=GE,D.forInRight=HE,D.forOwn=WE,D.forOwnRight=$E,D.get=Ou,D.gt=lE,D.gte=cE,D.has=jE,D.hasIn=wu,D.head=Ed,D.identity=kt,D.includes=_b,D.indexOf=w0,D.inRange=fA,D.invoke=ZE,D.isArguments=cr,D.isArray=Me,D.isArrayBuffer=fE,D.isArrayLike=Ut,D.isArrayLikeObject=ht,D.isBoolean=dE,D.isBuffer=Jn,D.isDate=hE,D.isElement=pE,D.isEmpty=mE,D.isEqual=gE,D.isEqualWith=vE,D.isError=Cu,D.isFinite=yE,D.isFunction=Rn,D.isInteger=Ld,D.isLength=Ts,D.isMap=Dd,D.isMatch=bE,D.isMatchWith=EE,D.isNaN=AE,D.isNative=SE,D.isNil=TE,D.isNull=CE,D.isNumber=Nd,D.isObject=ut,D.isObjectLike=dt,D.isPlainObject=Wi,D.isRegExp=Tu,D.isSafeInteger=OE,D.isSet=Fd,D.isString=Os,D.isSymbol=zt,D.isTypedArray=Zr,D.isUndefined=wE,D.isWeakMap=IE,D.isWeakSet=ME,D.join=_0,D.kebabCase=vA,D.last=tn,D.lastIndexOf=P0,D.lowerCase=yA,D.lowerFirst=bA,D.lt=RE,D.lte=xE,D.max=hS,D.maxBy=pS,D.mean=mS,D.meanBy=gS,D.min=vS,D.minBy=yS,D.stubArray=Pu,D.stubFalse=Lu,D.stubObject=rS,D.stubString=iS,D.stubTrue=oS,D.multiply=bS,D.nth=L0,D.noConflict=ZA,D.noop=_u,D.now=As,D.pad=EA,D.padEnd=AA,D.padStart=SA,D.parseInt=CA,D.random=dA,D.reduce=Fb,D.reduceRight=Ub,D.repeat=TA,D.replace=OA,D.result=nA,D.round=ES,D.runInContext=q,D.sample=kb,D.size=Wb,D.snakeCase=wA,D.some=$b,D.sortedIndex=G0,D.sortedIndexBy=H0,D.sortedIndexOf=W0,D.sortedLastIndex=$0,D.sortedLastIndexBy=z0,D.sortedLastIndexOf=V0,D.startCase=MA,D.startsWith=RA,D.subtract=AS,D.sum=SS,D.sumBy=CS,D.template=xA,D.times=sS,D.toFinite=xn,D.toInteger=Pe,D.toLength=Bd,D.toLower=_A,D.toNumber=nn,D.toSafeInteger=_E,D.toString=qe,D.toUpper=PA,D.trim=LA,D.trimEnd=DA,D.trimStart=NA,D.truncate=FA,D.unescape=UA,D.uniqueId=uS,D.upperCase=BA,D.upperFirst=Iu,D.each=Td,D.eachRight=Od,D.first=Ed,xu(D,function(){var n={};return mn(D,function(r,a){Qe.call(D.prototype,a)||(n[a]=r)}),n}(),{chain:!1}),D.VERSION=e,qt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){D[n].placeholder=D}),qt(["drop","take"],function(n,r){Ge.prototype[n]=function(a){a=a===s?1:bt(Pe(a),0);var b=this.__filtered__&&!r?new Ge(this):this.clone();return b.__filtered__?b.__takeCount__=xt(a,b.__takeCount__):b.__views__.push({size:xt(a,te),type:n+(b.__dir__<0?"Right":"")}),b},Ge.prototype[n+"Right"]=function(a){return this.reverse()[n](a).reverse()}}),qt(["filter","map","takeWhile"],function(n,r){var a=r+1,b=a==H||a==R;Ge.prototype[n]=function(_){var B=this.clone();return B.__iteratees__.push({iteratee:Se(_,3),type:a}),B.__filtered__=B.__filtered__||b,B}}),qt(["head","last"],function(n,r){var a="take"+(r?"Right":"");Ge.prototype[n]=function(){return this[a](1).value()[0]}}),qt(["initial","tail"],function(n,r){var a="drop"+(r?"":"Right");Ge.prototype[n]=function(){return this.__filtered__?new Ge(this):this[a](1)}}),Ge.prototype.compact=function(){return this.filter(kt)},Ge.prototype.find=function(n){return this.filter(n).head()},Ge.prototype.findLast=function(n){return this.reverse().find(n)},Ge.prototype.invokeMap=Be(function(n,r){return typeof n=="function"?new Ge(this):this.map(function(a){return Fi(a,n,r)})}),Ge.prototype.reject=function(n){return this.filter(Cs(Se(n)))},Ge.prototype.slice=function(n,r){n=Pe(n);var a=this;return a.__filtered__&&(n>0||r<0)?new Ge(a):(n<0?a=a.takeRight(-n):n&&(a=a.drop(n)),r!==s&&(r=Pe(r),a=r<0?a.dropRight(-r):a.take(r-n)),a)},Ge.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},Ge.prototype.toArray=function(){return this.take(te)},mn(Ge.prototype,function(n,r){var a=/^(?:filter|find|map|reject)|While$/.test(r),b=/^(?:head|last)$/.test(r),_=D[b?"take"+(r=="last"?"Right":""):r],B=b||/^find/.test(r);!_||(D.prototype[r]=function(){var V=this.__wrapped__,J=b?[1]:arguments,Q=V instanceof Ge,se=J[0],ae=Q||Me(V),ue=function(ke){var $e=_.apply(D,Gn([ke],J));return b&&de?$e[0]:$e};ae&&a&&typeof se=="function"&&se.length!=1&&(Q=ae=!1);var de=this.__chain__,ve=!!this.__actions__.length,Ce=B&&!de,Ne=Q&&!ve;if(!B&&ae){V=Ne?V:new Ge(this);var Te=n.apply(V,J);return Te.__actions__.push({func:bs,args:[ue],thisArg:s}),new Qt(Te,de)}return Ce&&Ne?n.apply(this,J):(Te=this.thru(ue),Ce?b?Te.value()[0]:Te.value():Te)})}),qt(["pop","push","shift","sort","splice","unshift"],function(n){var r=Vo[n],a=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",b=/^(?:pop|shift)$/.test(n);D.prototype[n]=function(){var _=arguments;if(b&&!this.__chain__){var B=this.value();return r.apply(Me(B)?B:[],_)}return this[a](function(V){return r.apply(Me(V)?V:[],_)})}}),mn(Ge.prototype,function(n,r){var a=D[r];if(a){var b=a.name+"";Qe.call(zr,b)||(zr[b]=[]),zr[b].push({name:r,func:a})}}),zr[ds(s,x).name]=[{name:"wrapper",func:s}],Ge.prototype.clone=Uv,Ge.prototype.reverse=Bv,Ge.prototype.value=kv,D.prototype.at=pb,D.prototype.chain=mb,D.prototype.commit=gb,D.prototype.next=vb,D.prototype.plant=bb,D.prototype.reverse=Eb,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=Ab,D.prototype.first=D.prototype.head,Ri&&(D.prototype[Ri]=yb),D},Wn=gv();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Ct._=Wn,define(function(){return Wn})):nr?((nr.exports=Wn)._=Wn,Ra._=Wn):Ct._=Wn}).call(ei)});var Wh=mt((Yi,ju)=>{k();(function(s,e){typeof Yi=="object"&&typeof ju=="object"?ju.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Yi=="object"?Yi.bowser=e():s.bowser=e()})(Yi,function(){return function(s){var e={};function t(i){if(e[i])return e[i].exports;var o=e[i]={i,l:!1,exports:{}};return s[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=s,t.c=e,t.d=function(i,o,l){t.o(i,o)||Object.defineProperty(i,o,{enumerable:!0,get:l})},t.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,o){if(1&o&&(i=t(i)),8&o||4&o&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(t.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),2&o&&typeof i!="string")for(var c in i)t.d(l,c,function(u){return i[u]}.bind(null,c));return l},t.n=function(i){var o=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(o,"a",o),o},t.o=function(i,o){return Object.prototype.hasOwnProperty.call(i,o)},t.p="",t(t.s=90)}({17:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i=t(18),o=function(){function l(){}return l.getFirstMatch=function(c,u){var f=u.match(c);return f&&f.length>0&&f[1]||""},l.getSecondMatch=function(c,u){var f=u.match(c);return f&&f.length>1&&f[2]||""},l.matchAndReturnConst=function(c,u,f){if(c.test(u))return f},l.getWindowsVersionName=function(c){switch(c){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},l.getMacOSVersionName=function(c){var u=c.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(u.push(0),u[0]===10)switch(u[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},l.getAndroidVersionName=function(c){var u=c.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(u.push(0),!(u[0]===1&&u[1]<5))return u[0]===1&&u[1]<6?"Cupcake":u[0]===1&&u[1]>=6?"Donut":u[0]===2&&u[1]<2?"Eclair":u[0]===2&&u[1]===2?"Froyo":u[0]===2&&u[1]>2?"Gingerbread":u[0]===3?"Honeycomb":u[0]===4&&u[1]<1?"Ice Cream Sandwich":u[0]===4&&u[1]<4?"Jelly Bean":u[0]===4&&u[1]>=4?"KitKat":u[0]===5?"Lollipop":u[0]===6?"Marshmallow":u[0]===7?"Nougat":u[0]===8?"Oreo":u[0]===9?"Pie":void 0},l.getVersionPrecision=function(c){return c.split(".").length},l.compareVersions=function(c,u,f){f===void 0&&(f=!1);var m=l.getVersionPrecision(c),E=l.getVersionPrecision(u),O=Math.max(m,E),d=0,A=l.map([c,u],function(I){var x=O-l.getVersionPrecision(I),T=I+new Array(x+1).join(".0");return l.map(T.split("."),function(S){return new Array(20-S.length).join("0")+S}).reverse()});for(f&&(d=O-Math.min(m,E)),O-=1;O>=d;){if(A[0][O]>A[1][O])return 1;if(A[0][O]===A[1][O]){if(O===d)return 0;O-=1}else if(A[0][O]<A[1][O])return-1}},l.map=function(c,u){var f,m=[];if(Array.prototype.map)return Array.prototype.map.call(c,u);for(f=0;f<c.length;f+=1)m.push(u(c[f]));return m},l.find=function(c,u){var f,m;if(Array.prototype.find)return Array.prototype.find.call(c,u);for(f=0,m=c.length;f<m;f+=1){var E=c[f];if(u(E,f))return E}},l.assign=function(c){for(var u,f,m=c,E=arguments.length,O=new Array(E>1?E-1:0),d=1;d<E;d++)O[d-1]=arguments[d];if(Object.assign)return Object.assign.apply(Object,[c].concat(O));var A=function(){var I=O[u];typeof I=="object"&&I!==null&&Object.keys(I).forEach(function(x){m[x]=I[x]})};for(u=0,f=O.length;u<f;u+=1)A();return c},l.getBrowserAlias=function(c){return i.BROWSER_ALIASES_MAP[c]},l.getBrowserTypeByAlias=function(c){return i.BROWSER_MAP[c]||""},l}();e.default=o,s.exports=e.default},18:function(s,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,o=(i=t(91))&&i.__esModule?i:{default:i},l=t(18);function c(f,m){for(var E=0;E<m.length;E++){var O=m[E];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(f,O.key,O)}}var u=function(){function f(){}var m,E,O;return f.getParser=function(d,A){if(A===void 0&&(A=!1),typeof d!="string")throw new Error("UserAgent should be a string");return new o.default(d,A)},f.parse=function(d){return new o.default(d).getResult()},m=f,O=[{key:"BROWSER_MAP",get:function(){return l.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return l.ENGINE_MAP}},{key:"OS_MAP",get:function(){return l.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return l.PLATFORMS_MAP}}],(E=null)&&c(m.prototype,E),O&&c(m,O),f}();e.default=u,s.exports=e.default},91:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i=f(t(92)),o=f(t(93)),l=f(t(94)),c=f(t(95)),u=f(t(17));function f(E){return E&&E.__esModule?E:{default:E}}var m=function(){function E(d,A){if(A===void 0&&(A=!1),d==null||d==="")throw new Error("UserAgent parameter can't be empty");this._ua=d,this.parsedResult={},A!==!0&&this.parse()}var O=E.prototype;return O.getUA=function(){return this._ua},O.test=function(d){return d.test(this._ua)},O.parseBrowser=function(){var d=this;this.parsedResult.browser={};var A=u.default.find(i.default,function(I){if(typeof I.test=="function")return I.test(d);if(I.test instanceof Array)return I.test.some(function(x){return d.test(x)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.browser=A.describe(this.getUA())),this.parsedResult.browser},O.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},O.getBrowserName=function(d){return d?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},O.getBrowserVersion=function(){return this.getBrowser().version},O.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},O.parseOS=function(){var d=this;this.parsedResult.os={};var A=u.default.find(o.default,function(I){if(typeof I.test=="function")return I.test(d);if(I.test instanceof Array)return I.test.some(function(x){return d.test(x)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.os=A.describe(this.getUA())),this.parsedResult.os},O.getOSName=function(d){var A=this.getOS().name;return d?String(A).toLowerCase()||"":A||""},O.getOSVersion=function(){return this.getOS().version},O.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},O.getPlatformType=function(d){d===void 0&&(d=!1);var A=this.getPlatform().type;return d?String(A).toLowerCase()||"":A||""},O.parsePlatform=function(){var d=this;this.parsedResult.platform={};var A=u.default.find(l.default,function(I){if(typeof I.test=="function")return I.test(d);if(I.test instanceof Array)return I.test.some(function(x){return d.test(x)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.platform=A.describe(this.getUA())),this.parsedResult.platform},O.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},O.getEngineName=function(d){return d?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},O.parseEngine=function(){var d=this;this.parsedResult.engine={};var A=u.default.find(c.default,function(I){if(typeof I.test=="function")return I.test(d);if(I.test instanceof Array)return I.test.some(function(x){return d.test(x)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.engine=A.describe(this.getUA())),this.parsedResult.engine},O.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},O.getResult=function(){return u.default.assign({},this.parsedResult)},O.satisfies=function(d){var A=this,I={},x=0,T={},S=0;if(Object.keys(d).forEach(function(M){var L=d[M];typeof L=="string"?(T[M]=L,S+=1):typeof L=="object"&&(I[M]=L,x+=1)}),x>0){var w=Object.keys(I),p=u.default.find(w,function(M){return A.isOS(M)});if(p){var y=this.satisfies(I[p]);if(y!==void 0)return y}var g=u.default.find(w,function(M){return A.isPlatform(M)});if(g){var v=this.satisfies(I[g]);if(v!==void 0)return v}}if(S>0){var h=Object.keys(T),C=u.default.find(h,function(M){return A.isBrowser(M,!0)});if(C!==void 0)return this.compareVersion(T[C])}},O.isBrowser=function(d,A){A===void 0&&(A=!1);var I=this.getBrowserName().toLowerCase(),x=d.toLowerCase(),T=u.default.getBrowserTypeByAlias(x);return A&&T&&(x=T.toLowerCase()),x===I},O.compareVersion=function(d){var A=[0],I=d,x=!1,T=this.getBrowserVersion();if(typeof T=="string")return d[0]===">"||d[0]==="<"?(I=d.substr(1),d[1]==="="?(x=!0,I=d.substr(2)):A=[],d[0]===">"?A.push(1):A.push(-1)):d[0]==="="?I=d.substr(1):d[0]==="~"&&(x=!0,I=d.substr(1)),A.indexOf(u.default.compareVersions(T,I,x))>-1},O.isOS=function(d){return this.getOSName(!0)===String(d).toLowerCase()},O.isPlatform=function(d){return this.getPlatformType(!0)===String(d).toLowerCase()},O.isEngine=function(d){return this.getEngineName(!0)===String(d).toLowerCase()},O.is=function(d,A){return A===void 0&&(A=!1),this.isBrowser(d,A)||this.isOS(d)||this.isPlatform(d)},O.some=function(d){var A=this;return d===void 0&&(d=[]),d.some(function(I){return A.is(I)})},E}();e.default=m,s.exports=e.default},92:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,o=(i=t(17))&&i.__esModule?i:{default:i},l=/version\/(\d+(\.?_?\d+)+)/i,c=[{test:[/googlebot/i],describe:function(u){var f={name:"Googlebot"},m=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/opera/i],describe:function(u){var f={name:"Opera"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/opr\/|opios/i],describe:function(u){var f={name:"Opera"},m=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/SamsungBrowser/i],describe:function(u){var f={name:"Samsung Internet for Android"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/Whale/i],describe:function(u){var f={name:"NAVER Whale Browser"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/MZBrowser/i],describe:function(u){var f={name:"MZ Browser"},m=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/focus/i],describe:function(u){var f={name:"Focus"},m=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/swing/i],describe:function(u){var f={name:"Swing"},m=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/coast/i],describe:function(u){var f={name:"Opera Coast"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(u){var f={name:"Opera Touch"},m=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/yabrowser/i],describe:function(u){var f={name:"Yandex Browser"},m=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/ucbrowser/i],describe:function(u){var f={name:"UC Browser"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/Maxthon|mxios/i],describe:function(u){var f={name:"Maxthon"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/epiphany/i],describe:function(u){var f={name:"Epiphany"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/puffin/i],describe:function(u){var f={name:"Puffin"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/sleipnir/i],describe:function(u){var f={name:"Sleipnir"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/k-meleon/i],describe:function(u){var f={name:"K-Meleon"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/micromessenger/i],describe:function(u){var f={name:"WeChat"},m=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/qqbrowser/i],describe:function(u){var f={name:/qqbrowserlite/i.test(u)?"QQ Browser Lite":"QQ Browser"},m=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/msie|trident/i],describe:function(u){var f={name:"Internet Explorer"},m=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/\sedg\//i],describe:function(u){var f={name:"Microsoft Edge"},m=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/edg([ea]|ios)/i],describe:function(u){var f={name:"Microsoft Edge"},m=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/vivaldi/i],describe:function(u){var f={name:"Vivaldi"},m=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/seamonkey/i],describe:function(u){var f={name:"SeaMonkey"},m=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/sailfish/i],describe:function(u){var f={name:"Sailfish"},m=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,u);return m&&(f.version=m),f}},{test:[/silk/i],describe:function(u){var f={name:"Amazon Silk"},m=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/phantom/i],describe:function(u){var f={name:"PhantomJS"},m=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/slimerjs/i],describe:function(u){var f={name:"SlimerJS"},m=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var f={name:"BlackBerry"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var f={name:"WebOS Browser"},m=o.default.getFirstMatch(l,u)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/bada/i],describe:function(u){var f={name:"Bada"},m=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/tizen/i],describe:function(u){var f={name:"Tizen"},m=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/qupzilla/i],describe:function(u){var f={name:"QupZilla"},m=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(u){var f={name:"Firefox"},m=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/electron/i],describe:function(u){var f={name:"Electron"},m=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/MiuiBrowser/i],describe:function(u){var f={name:"Miui"},m=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/chromium/i],describe:function(u){var f={name:"Chromium"},m=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,u)||o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/chrome|crios|crmo/i],describe:function(u){var f={name:"Chrome"},m=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/GSA/i],describe:function(u){var f={name:"Google Search"},m=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){var f=!u.test(/like android/i),m=u.test(/android/i);return f&&m},describe:function(u){var f={name:"Android Browser"},m=o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/playstation 4/i],describe:function(u){var f={name:"PlayStation 4"},m=o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/safari|applewebkit/i],describe:function(u){var f={name:"Safari"},m=o.default.getFirstMatch(l,u);return m&&(f.version=m),f}},{test:[/.*/i],describe:function(u){var f=u.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(f,u),version:o.default.getSecondMatch(f,u)}}}];e.default=c,s.exports=e.default},93:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,o=(i=t(17))&&i.__esModule?i:{default:i},l=t(18),c=[{test:[/Roku\/DVP/],describe:function(u){var f=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,u);return{name:l.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(u){var f=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,u);return{name:l.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(u){var f=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,u),m=o.default.getWindowsVersionName(f);return{name:l.OS_MAP.Windows,version:f,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(u){var f={name:l.OS_MAP.iOS},m=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,u);return m&&(f.version=m),f}},{test:[/macintosh/i],describe:function(u){var f=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,u).replace(/[_\s]/g,"."),m=o.default.getMacOSVersionName(f),E={name:l.OS_MAP.MacOS,version:f};return m&&(E.versionName=m),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(u){var f=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,u).replace(/[_\s]/g,".");return{name:l.OS_MAP.iOS,version:f}}},{test:function(u){var f=!u.test(/like android/i),m=u.test(/android/i);return f&&m},describe:function(u){var f=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,u),m=o.default.getAndroidVersionName(f),E={name:l.OS_MAP.Android,version:f};return m&&(E.versionName=m),E}},{test:[/(web|hpw)[o0]s/i],describe:function(u){var f=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,u),m={name:l.OS_MAP.WebOS};return f&&f.length&&(m.version=f),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(u){var f=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,u)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,u)||o.default.getFirstMatch(/\bbb(\d+)/i,u);return{name:l.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(u){var f=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,u);return{name:l.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(u){var f=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,u);return{name:l.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:l.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:l.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(u){var f=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,u);return{name:l.OS_MAP.PlayStation4,version:f}}}];e.default=c,s.exports=e.default},94:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,o=(i=t(17))&&i.__esModule?i:{default:i},l=t(18),c=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(u){var f=o.default.getFirstMatch(/(can-l01)/i,u)&&"Nova",m={type:l.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(m.model=f),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:l.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:l.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:l.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:l.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:l.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:l.PLATFORMS_MAP.tablet}}},{test:function(u){var f=u.test(/ipod|iphone/i),m=u.test(/like (ipod|iphone)/i);return f&&!m},describe:function(u){var f=o.default.getFirstMatch(/(ipod|iphone)/i,u);return{type:l.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:l.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:l.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName(!0)==="blackberry"},describe:function(){return{type:l.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(u){return u.getBrowserName(!0)==="bada"},describe:function(){return{type:l.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getBrowserName()==="windows phone"},describe:function(){return{type:l.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(u){var f=Number(String(u.getOSVersion()).split(".")[0]);return u.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:l.PLATFORMS_MAP.tablet}}},{test:function(u){return u.getOSName(!0)==="android"},describe:function(){return{type:l.PLATFORMS_MAP.mobile}}},{test:function(u){return u.getOSName(!0)==="macos"},describe:function(){return{type:l.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(u){return u.getOSName(!0)==="windows"},describe:function(){return{type:l.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="linux"},describe:function(){return{type:l.PLATFORMS_MAP.desktop}}},{test:function(u){return u.getOSName(!0)==="playstation 4"},describe:function(){return{type:l.PLATFORMS_MAP.tv}}},{test:function(u){return u.getOSName(!0)==="roku"},describe:function(){return{type:l.PLATFORMS_MAP.tv}}}];e.default=c,s.exports=e.default},95:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var i,o=(i=t(17))&&i.__esModule?i:{default:i},l=t(18),c=[{test:function(u){return u.getBrowserName(!0)==="microsoft edge"},describe:function(u){if(/\sedg\//i.test(u))return{name:l.ENGINE_MAP.Blink};var f=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,u);return{name:l.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(u){var f={name:l.ENGINE_MAP.Trident},m=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){return u.test(/presto/i)},describe:function(u){var f={name:l.ENGINE_MAP.Presto},m=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:function(u){var f=u.test(/gecko/i),m=u.test(/like gecko/i);return f&&!m},describe:function(u){var f={name:l.ENGINE_MAP.Gecko},m=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:l.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(u){var f={name:l.ENGINE_MAP.WebKit},m=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,u);return m&&(f.version=m),f}}];e.default=c,s.exports=e.default}})})});var Vh={};th(Vh,{version:()=>BC});var BC,jh=Fu(()=>{k();BC="lab"});var Kh={};th(Kh,{remoteConfig:()=>kC});var kC,Jh=Fu(()=>{k();kC={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});var Zh=mt((Ws,Ju)=>{k();(function(e,t){typeof Ws=="object"&&typeof Ju=="object"?Ju.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Ws=="object"?Ws.Ably=t():e.Ably=t()})(window,function(){return function(s){var e={};function t(i){if(e[i])return e[i].exports;var o=e[i]={i,l:!1,exports:{}};return s[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=s,t.c=e,t.d=function(i,o,l){t.o(i,o)||Object.defineProperty(i,o,{enumerable:!0,get:l})},t.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,o){if(o&1&&(i=t(i)),o&8||o&4&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(t.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),o&2&&typeof i!="string")for(var c in i)t.d(l,c,function(u){return i[u]}.bind(null,c));return l},t.n=function(i){var o=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(o,"a",o),o},t.o=function(i,o){return Object.prototype.hasOwnProperty.call(i,o)},t.p="",t(t.s=41)}([function(s,e,t){"use strict";e.__esModule=!0;var i=function(){function o(){}return o}();e.default=i},function(s,e,t){"use strict";t.r(e),t.d(e,"__extends",function(){return o}),t.d(e,"__assign",function(){return l}),t.d(e,"__rest",function(){return c}),t.d(e,"__decorate",function(){return u}),t.d(e,"__param",function(){return f}),t.d(e,"__metadata",function(){return m}),t.d(e,"__awaiter",function(){return E}),t.d(e,"__generator",function(){return O}),t.d(e,"__createBinding",function(){return d}),t.d(e,"__exportStar",function(){return A}),t.d(e,"__values",function(){return I}),t.d(e,"__read",function(){return x}),t.d(e,"__spread",function(){return T}),t.d(e,"__spreadArrays",function(){return S}),t.d(e,"__spreadArray",function(){return w}),t.d(e,"__await",function(){return p}),t.d(e,"__asyncGenerator",function(){return y}),t.d(e,"__asyncDelegator",function(){return g}),t.d(e,"__asyncValues",function(){return v}),t.d(e,"__makeTemplateObject",function(){return h}),t.d(e,"__importStar",function(){return M}),t.d(e,"__importDefault",function(){return L}),t.d(e,"__classPrivateFieldGet",function(){return $}),t.d(e,"__classPrivateFieldSet",function(){return H});var i=function(F,R){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,z){P.__proto__=z}||function(P,z){for(var W in z)Object.prototype.hasOwnProperty.call(z,W)&&(P[W]=z[W])},i(F,R)};function o(F,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");i(F,R);function P(){this.constructor=F}F.prototype=R===null?Object.create(R):(P.prototype=R.prototype,new P)}var l=function(){return l=Object.assign||function(R){for(var P,z=1,W=arguments.length;z<W;z++){P=arguments[z];for(var Z in P)Object.prototype.hasOwnProperty.call(P,Z)&&(R[Z]=P[Z])}return R},l.apply(this,arguments)};function c(F,R){var P={};for(var z in F)Object.prototype.hasOwnProperty.call(F,z)&&R.indexOf(z)<0&&(P[z]=F[z]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,z=Object.getOwnPropertySymbols(F);W<z.length;W++)R.indexOf(z[W])<0&&Object.prototype.propertyIsEnumerable.call(F,z[W])&&(P[z[W]]=F[z[W]]);return P}function u(F,R,P,z){var W=arguments.length,Z=W<3?R:z===null?z=Object.getOwnPropertyDescriptor(R,P):z,te;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(F,R,P,z);else for(var Y=F.length-1;Y>=0;Y--)(te=F[Y])&&(Z=(W<3?te(Z):W>3?te(R,P,Z):te(R,P))||Z);return W>3&&Z&&Object.defineProperty(R,P,Z),Z}function f(F,R){return function(P,z){R(P,z,F)}}function m(F,R){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(F,R)}function E(F,R,P,z){function W(Z){return Z instanceof P?Z:new P(function(te){te(Z)})}return new(P||(P=Promise))(function(Z,te){function Y(U){try{N(z.next(U))}catch(K){te(K)}}function G(U){try{N(z.throw(U))}catch(K){te(K)}}function N(U){U.done?Z(U.value):W(U.value).then(Y,G)}N((z=z.apply(F,R||[])).next())})}function O(F,R){var P={label:0,sent:function(){if(Z[0]&1)throw Z[1];return Z[1]},trys:[],ops:[]},z,W,Z,te;return te={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function Y(N){return function(U){return G([N,U])}}function G(N){if(z)throw new TypeError("Generator is already executing.");for(;P;)try{if(z=1,W&&(Z=N[0]&2?W.return:N[0]?W.throw||((Z=W.return)&&Z.call(W),0):W.next)&&!(Z=Z.call(W,N[1])).done)return Z;switch(W=0,Z&&(N=[N[0]&2,Z.value]),N[0]){case 0:case 1:Z=N;break;case 4:return P.label++,{value:N[1],done:!1};case 5:P.label++,W=N[1],N=[0];continue;case 7:N=P.ops.pop(),P.trys.pop();continue;default:if(Z=P.trys,!(Z=Z.length>0&&Z[Z.length-1])&&(N[0]===6||N[0]===2)){P=0;continue}if(N[0]===3&&(!Z||N[1]>Z[0]&&N[1]<Z[3])){P.label=N[1];break}if(N[0]===6&&P.label<Z[1]){P.label=Z[1],Z=N;break}if(Z&&P.label<Z[2]){P.label=Z[2],P.ops.push(N);break}Z[2]&&P.ops.pop(),P.trys.pop();continue}N=R.call(F,P)}catch(U){N=[6,U],W=0}finally{z=Z=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}var d=Object.create?function(F,R,P,z){z===void 0&&(z=P),Object.defineProperty(F,z,{enumerable:!0,get:function(){return R[P]}})}:function(F,R,P,z){z===void 0&&(z=P),F[z]=R[P]};function A(F,R){for(var P in F)P!=="default"&&!Object.prototype.hasOwnProperty.call(R,P)&&d(R,F,P)}function I(F){var R=typeof Symbol=="function"&&Symbol.iterator,P=R&&F[R],z=0;if(P)return P.call(F);if(F&&typeof F.length=="number")return{next:function(){return F&&z>=F.length&&(F=void 0),{value:F&&F[z++],done:!F}}};throw new TypeError(R?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(F,R){var P=typeof Symbol=="function"&&F[Symbol.iterator];if(!P)return F;var z=P.call(F),W,Z=[],te;try{for(;(R===void 0||R-- >0)&&!(W=z.next()).done;)Z.push(W.value)}catch(Y){te={error:Y}}finally{try{W&&!W.done&&(P=z.return)&&P.call(z)}finally{if(te)throw te.error}}return Z}function T(){for(var F=[],R=0;R<arguments.length;R++)F=F.concat(x(arguments[R]));return F}function S(){for(var F=0,R=0,P=arguments.length;R<P;R++)F+=arguments[R].length;for(var z=Array(F),W=0,R=0;R<P;R++)for(var Z=arguments[R],te=0,Y=Z.length;te<Y;te++,W++)z[W]=Z[te];return z}function w(F,R,P){if(P||arguments.length===2)for(var z=0,W=R.length,Z;z<W;z++)(Z||!(z in R))&&(Z||(Z=Array.prototype.slice.call(R,0,z)),Z[z]=R[z]);return F.concat(Z||Array.prototype.slice.call(R))}function p(F){return this instanceof p?(this.v=F,this):new p(F)}function y(F,R,P){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var z=P.apply(F,R||[]),W,Z=[];return W={},te("next"),te("throw"),te("return"),W[Symbol.asyncIterator]=function(){return this},W;function te(j){z[j]&&(W[j]=function(ne){return new Promise(function(ce,Ee){Z.push([j,ne,ce,Ee])>1||Y(j,ne)})})}function Y(j,ne){try{G(z[j](ne))}catch(ce){K(Z[0][3],ce)}}function G(j){j.value instanceof p?Promise.resolve(j.value.v).then(N,U):K(Z[0][2],j)}function N(j){Y("next",j)}function U(j){Y("throw",j)}function K(j,ne){j(ne),Z.shift(),Z.length&&Y(Z[0][0],Z[0][1])}}function g(F){var R,P;return R={},z("next"),z("throw",function(W){throw W}),z("return"),R[Symbol.iterator]=function(){return this},R;function z(W,Z){R[W]=F[W]?function(te){return(P=!P)?{value:p(F[W](te)),done:W==="return"}:Z?Z(te):te}:Z}}function v(F){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var R=F[Symbol.asyncIterator],P;return R?R.call(F):(F=typeof I=="function"?I(F):F[Symbol.iterator](),P={},z("next"),z("throw"),z("return"),P[Symbol.asyncIterator]=function(){return this},P);function z(Z){P[Z]=F[Z]&&function(te){return new Promise(function(Y,G){te=F[Z](te),W(Y,G,te.done,te.value)})}}function W(Z,te,Y,G){Promise.resolve(G).then(function(N){Z({value:N,done:Y})},te)}}function h(F,R){return Object.defineProperty?Object.defineProperty(F,"raw",{value:R}):F.raw=R,F}var C=Object.create?function(F,R){Object.defineProperty(F,"default",{enumerable:!0,value:R})}:function(F,R){F.default=R};function M(F){if(F&&F.__esModule)return F;var R={};if(F!=null)for(var P in F)P!=="default"&&Object.prototype.hasOwnProperty.call(F,P)&&d(R,F,P);return C(R,F),R}function L(F){return F&&F.__esModule?F:{default:F}}function $(F,R,P,z){if(P==="a"&&!z)throw new TypeError("Private accessor was defined without a getter");if(typeof R=="function"?F!==R||!z:!R.has(F))throw new TypeError("Cannot read private member from an object whose class did not declare it");return P==="m"?z:P==="a"?z.call(F):z?z.value:R.get(F)}function H(F,R,P,z,W){if(z==="m")throw new TypeError("Private method is not writable");if(z==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof R=="function"?F!==R||!W:!R.has(F))throw new TypeError("Cannot write private member to an object whose class did not declare it");return z==="a"?W.call(F,P):W?W.value=P:R.set(F,P),P}},function(s,e,t){"use strict";(function(i){e.__esModule=!0,e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.getGlobalObject=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var o=t(1),l=o.__importDefault(t(0)),c=o.__importDefault(t(8));function u(X){return Math.floor(Math.random()*X.length)}function f(X){for(var oe=[],le=1;le<arguments.length;le++)oe[le-1]=arguments[le];for(var ge=0;ge<oe.length;ge++){var De=oe[ge];if(!De)break;var gt=Object.prototype.hasOwnProperty;for(var tr in De)(!gt||gt.call(De,tr))&&(X[tr]=De[tr])}return X}e.mixin=f;function m(X){return f({},X)}e.copy=m,e.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function E(X){return I(X)?[]:e.isArray(X)?X:[X]}e.ensureArray=E;function O(X){return Object.prototype.toString.call(X)=="[object Object]"}e.isObject=O;function d(X){for(var oe in X)return!1;return!0}e.isEmpty=d;function A(X,oe){for(var le in X)if(le!==oe)return!1;return!0}e.isOnlyPropIn=A;function I(X){return X==null}e.isEmptyArg=I;function x(X){var oe=new Object;for(var le in X)oe[le]=X[le];return oe}e.shallowClone=x;function T(X,oe){var le=function(){function De(){}return De}();le.prototype=X;var ge=new le;return oe&&f(ge,oe),ge}e.prototypicalClone=T;var S=function(X,oe){if(l.default.Config.inherits){l.default.Config.inherits(X,oe);return}X.super_=oe,X.prototype=T(oe.prototype,{constructor:X})};e.inherits=S;function w(X,oe){for(var le in X)if(X[le]==oe)return!0;return!1}e.containsValue=w;function p(X,oe){return e.isArray(oe)?y(X,oe):g(X,oe)}e.intersect=p;function y(X,oe){for(var le=[],ge=0;ge<X.length;ge++){var De=X[ge];e.arrIndexOf(oe,De)!=-1&&le.push(De)}return le}e.arrIntersect=y;function g(X,oe){for(var le=[],ge=0;ge<X.length;ge++){var De=X[ge];De in oe&&le.push(De)}return le}e.arrIntersectOb=g;function v(X,oe){for(var le=[],ge=0;ge<X.length;ge++){var De=X[ge];e.arrIndexOf(oe,De)==-1&&le.push(De)}return le}e.arrSubtract=v,e.arrIndexOf=Array.prototype.indexOf?function(X,oe,le){return X.indexOf(oe,le)}:function(X,oe,le){le=le||0;for(var ge=X.length;le<ge;le++)if(X[le]===oe)return le;return-1};function h(X,oe){return e.arrIndexOf(X,oe)!==-1}e.arrIn=h;function C(X,oe){var le=e.arrIndexOf(X,oe),ge=le!=-1;return ge&&X.splice(le,1),ge}e.arrDeleteValue=C;function M(X,oe){var le=X.slice();return C(le,oe),le}e.arrWithoutValue=M;function L(X,oe){var le=[];for(var ge in X)oe&&!Object.prototype.hasOwnProperty.call(X,ge)||le.push(ge);return le}e.keysArray=L;function $(X,oe){var le=[];for(var ge in X)oe&&!Object.prototype.hasOwnProperty.call(X,ge)||le.push(X[ge]);return le}e.valuesArray=$;function H(X,oe){for(var le in X)Object.prototype.hasOwnProperty.call(X,le)&&X[le]&&oe(le)}e.forInOwnNonNullProperties=H,e.arrForEach=Array.prototype.forEach?function(X,oe){X.forEach(oe)}:function(X,oe){for(var le=X.length,ge=0;ge<le;ge++)oe(X[ge],ge,X)};function F(X,oe){return e.arrForEach(X.slice(),oe)}e.safeArrForEach=F,e.arrMap=Array.prototype.map?function(X,oe){return X.map(oe)}:function(X,oe){for(var le=[],ge=X.length,De=0;De<ge;De++)le.push(oe(X[De],De,X));return le},e.arrFilter=Array.prototype.filter?function(X,oe){return X.filter(oe)}:function(X,oe){for(var le=[],ge=X.length,De=0;De<ge;De++)oe(X[De])&&le.push(X[De]);return le},e.arrEvery=Array.prototype.every?function(X,oe){return X.every(oe)}:function(X,oe){for(var le=X.length,ge=0;ge<le;ge++)if(!oe(X[ge],ge,X))return!1;return!0};function R(X,oe){if(X.length===0)return!0;var le=X[0][oe];return e.arrEvery(X,function(ge){return ge[oe]===le})}e.allSame=R;var P={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(X){var oe=P[X||_e.json];return{accept:oe,"X-Ably-Version":c.default.apiVersion,"Ably-Agent":c.default.agent}}e.defaultGetHeaders=z;function W(X){var oe,le=oe=P[X||_e.json];return{accept:le,"content-type":oe,"X-Ably-Version":c.default.apiVersion,"Ably-Agent":c.default.agent}}e.defaultPostHeaders=W;function Z(X){return X.splice(u(X),1)[0]}e.arrPopRandomElement=Z;function te(X){var oe=[];if(X)for(var le in X)oe.push(encodeURIComponent(le)+"="+encodeURIComponent(X[le]));return oe.length?"?"+oe.join("&"):""}e.toQueryString=te;function Y(X){for(var oe,le=/([^?&=]+)=?([^&]*)/g,ge={};oe=le.exec(X);)ge[decodeURIComponent(oe[1])]=decodeURIComponent(oe[2]);return ge}e.parseQueryString=Y,e.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}e.isErrorInfo=G;function N(X){var oe,le;return X instanceof Error||((le=(oe=X)===null||oe===void 0?void 0:oe.constructor)===null||le===void 0?void 0:le.name)==="ErrorInfo"?l.default.Config.inspect(X):X.toString()}e.inspectError=N;function U(X){return l.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:l.default.Config.inspect(X)}e.inspectBody=U;function K(X){if(l.default.BufferUtils.isBuffer(X))return l.default.BufferUtils.byteLength(X);if(typeof X=="string")return l.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}e.dataSizeBytes=K;function j(){return String(Math.random()).substr(2)}e.cheapRandStr=j;var ne=function(X){if(l.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(X);return l.default.Config.getRandomValues(oe),l.default.BufferUtils.base64Encode(oe)}for(var le=l.default.BufferUtils.base64CharSet,ge=Math.round(X*4/3),De="",gt=0;gt<ge;gt++)De+=le[u(le)];return De};e.randomString=ne;var ce=function(X){if(l.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var oe=new Uint8Array(X);return l.default.Config.getRandomValues(oe),l.default.BufferUtils.hexEncode(oe)}for(var le=l.default.BufferUtils.hexCharSet,ge=X*2,De="",gt=0;gt<ge;gt++)De+=le[u(le)];return De};e.randomHexString=ce;function Ee(X,oe){for(var le=Math.min(oe,X.length),ge=X.slice(),De=[],gt=0;gt<le;gt++)De.push(Z(ge));return De}e.arrChooseN=Ee,e.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function be(X,oe,le){return new Promise(function(ge,De){X[oe].apply(X,o.__spreadArray(o.__spreadArray([],le),[function(gt,tr){gt?De(gt):ge(tr)}]))})}e.promisify=be;var _e;(function(X){X.msgpack="msgpack",X.json="json"})(_e=e.Format||(e.Format={}));function Ke(X,oe){return oe=="msgpack"?l.default.Config.msgpack.decode(X):JSON.parse(String(X))}e.decodeBody=Ke;function pe(X,oe){return oe=="msgpack"?l.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}e.encodeBody=pe;function Ve(X){return X.map(function(oe){return oe&&oe.toLowerCase()})}e.allToLowerCase=Ve;function St(X){return X.map(function(oe){return oe&&oe.toUpperCase()})}e.allToUpperCase=St;function et(X){return Math.min((X+2)/3,2)}e.getBackoffCoefficient=et;function st(){return 1-Math.random()*.2}e.getJitterCoefficient=st;function Nt(){return i||(typeof window!="undefined"?window:self)}e.getGlobalObject=Nt}).call(this,t(12))},function(s,e,t){"use strict";(function(i){e.__esModule=!0;var o=t(1),l=o.__importDefault(t(0)),c=i||(typeof window!="undefined"?window:self),u;(function(d){d[d.None=0]="None",d[d.Error=1]="Error",d[d.Major=2]="Major",d[d.Minor=3]="Minor",d[d.Micro=4]="Micro"})(u||(u={}));function f(d,A){return(""+d).padStart(A?3:2,"0")}function m(d){return l.default.Config.logTimestamps?function(A){var I=new Date;d(f(I.getHours())+":"+f(I.getMinutes())+":"+f(I.getSeconds())+"."+f(I.getMilliseconds(),1)+" "+A)}:d}var E=function(){var d,A,I,x;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((A=(d=c==null?void 0:c.console)===null||d===void 0?void 0:d.log)===null||A===void 0?void 0:A.apply)=="function"?(I=function(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S]},x=console.warn?function(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S]}:I):c!=null&&c.console.log?I=x=function(){Function.prototype.apply.call(console.log,console,arguments)}:I=x=function(){},[I,x].map(m)},O=function(){function d(){d.logLevel=d.LOG_DEFAULT}return d.initLogHandlers=function(){var A=E(),I=A[0],x=A[1];this.logHandler=I,this.logErrorHandler=x},d.logLevel=u.Error,d.LOG_NONE=u.None,d.LOG_ERROR=u.Error,d.LOG_MAJOR=u.Major,d.LOG_MINOR=u.Minor,d.LOG_MICRO=u.Micro,d.LOG_DEFAULT=u.Error,d.LOG_DEBUG=u.Micro,d.logAction=function(A,I,x){d.shouldLog(A)&&(A===u.Error?d.logErrorHandler:d.logHandler)("Ably: "+I+": "+x)},d.deprecated=function(A,I){d.deprecatedWithMsg(A,"Please use '"+I+"' instead.")},d.deprecatedWithMsg=function(A,I){d.shouldLog(u.Error)&&d.logErrorHandler("Ably: Deprecation warning - '"+A+"' is deprecated and will be removed from a future version. "+I)},d.shouldLog=function(A){return A<=d.logLevel},d.setLog=function(A,I){A!==void 0&&(d.logLevel=A),I!==void 0&&(d.logHandler=d.logErrorHandler=I)},d}();e.default=O}).call(this,t(12))},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(){if(typeof ArrayBuffer=="function"){var o=i,l=o.lib,c=l.WordArray,u=c.init,f=c.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var E=m.byteLength,O=[],d=0;d<E;d++)O[d>>>2]|=m[d]<<24-d%4*8;u.call(this,O,E)}else u.apply(this,arguments)};f.prototype=c}}(),i.lib.WordArray})},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(0)),l=i.__importStar(t(2)),c=function(){function u(f,m,E,O){this.message=f,this.code=m,this.statusCode=E,this.cause=O}return u.prototype.toString=function(){var f="["+this.constructor.name;return this.message&&(f+=": "+this.message),this.statusCode&&(f+="; statusCode="+this.statusCode),this.code&&(f+="; code="+this.code),this.cause&&(f+="; cause="+l.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(f+="; see "+this.href+" "),f+="]",f},u.fromValues=function(f){var m=f,E=m.message,O=m.code,d=m.statusCode;if(typeof E!="string"||typeof O!="number"||typeof d!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(f));var A=Object.assign(new u(E,O,d),f);return A.code&&!A.href&&(A.href="https://help.ably.io/error/"+A.code),A},u}();e.default=c},function(s,e,t){(function(i){(function(o,l){s.exports=e=l()})(this,function(){var o=o||function(l,c){var u;if(typeof window!="undefined"&&window.crypto&&(u=window.crypto),!u&&typeof window!="undefined"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof i!="undefined"&&i.crypto&&(u=i.crypto),!u)try{u=t(44)}catch(g){}var f=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch(g){}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function g(){}return function(v){var h;return g.prototype=v,h=new g,g.prototype=null,h}}(),E={},O=E.lib={},d=O.Base=function(){return{extend:function(g){var v=m(this);return g&&v.mixIn(g),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var v in g)g.hasOwnProperty(v)&&(this[v]=g[v]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=O.WordArray=d.extend({init:function(g,v){g=this.words=g||[],v!=c?this.sigBytes=v:this.sigBytes=g.length*4},toString:function(g){return(g||x).stringify(this)},concat:function(g){var v=this.words,h=g.words,C=this.sigBytes,M=g.sigBytes;if(this.clamp(),C%4)for(var L=0;L<M;L++){var $=h[L>>>2]>>>24-L%4*8&255;v[C+L>>>2]|=$<<24-(C+L)%4*8}else for(var L=0;L<M;L+=4)v[C+L>>>2]=h[L>>>2];return this.sigBytes+=M,this},clamp:function(){var g=this.words,v=this.sigBytes;g[v>>>2]&=4294967295<<32-v%4*8,g.length=l.ceil(v/4)},clone:function(){var g=d.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var v=[],h=0;h<g;h+=4)v.push(f());return new A.init(v,g)}}),I=E.enc={},x=I.Hex={stringify:function(g){for(var v=g.words,h=g.sigBytes,C=[],M=0;M<h;M++){var L=v[M>>>2]>>>24-M%4*8&255;C.push((L>>>4).toString(16)),C.push((L&15).toString(16))}return C.join("")},parse:function(g){for(var v=g.length,h=[],C=0;C<v;C+=2)h[C>>>3]|=parseInt(g.substr(C,2),16)<<24-C%8*4;return new A.init(h,v/2)}},T=I.Latin1={stringify:function(g){for(var v=g.words,h=g.sigBytes,C=[],M=0;M<h;M++){var L=v[M>>>2]>>>24-M%4*8&255;C.push(String.fromCharCode(L))}return C.join("")},parse:function(g){for(var v=g.length,h=[],C=0;C<v;C++)h[C>>>2]|=(g.charCodeAt(C)&255)<<24-C%4*8;return new A.init(h,v)}},S=I.Utf8={stringify:function(g){try{return decodeURIComponent(escape(T.stringify(g)))}catch(v){throw new Error("Malformed UTF-8 data")}},parse:function(g){return T.parse(unescape(encodeURIComponent(g)))}},w=O.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(g){typeof g=="string"&&(g=S.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var v,h=this._data,C=h.words,M=h.sigBytes,L=this.blockSize,$=L*4,H=M/$;g?H=l.ceil(H):H=l.max((H|0)-this._minBufferSize,0);var F=H*L,R=l.min(F*4,M);if(F){for(var P=0;P<F;P+=L)this._doProcessBlock(C,P);v=C.splice(0,F),h.sigBytes-=R}return new A.init(v,R)},clone:function(){var g=d.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0}),p=O.Hasher=w.extend({cfg:d.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){w.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){g&&this._append(g);var v=this._doFinalize();return v},blockSize:512/32,_createHelper:function(g){return function(v,h){return new g.init(h).finalize(v)}},_createHmacHelper:function(g){return function(v,h){return new y.HMAC.init(g,h).finalize(v)}}}),y=E.algo={};return E}(Math);return o})}).call(this,t(12))},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(3)),c=i.__importDefault(t(0));function u(E,O,d){try{O.apply(E,d)}catch(A){l.default.logAction(l.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+A+"; stack = "+(A&&A.stack))}}function f(E,O,d){for(var A,I,x,T=0;T<E.length;T++)if(A=E[T],d&&(A=A[d]),o.isArray(A)){for(;(I=o.arrIndexOf(A,O))!==-1;)A.splice(I,1);d&&A.length===0&&delete E[T][d]}else if(o.isObject(A))for(x in A)Object.prototype.hasOwnProperty.call(A,x)&&o.isArray(A[x])&&f([A],O,x)}var m=function(){function E(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return E.prototype.on=function(){for(var O=this,d=[],A=0;A<arguments.length;A++)d[A]=arguments[A];if(d.length===1){var I=d[0];if(typeof I=="function")this.any.push(I);else throw new Error("EventListener.on(): Invalid arguments: "+c.default.Config.inspect(d))}if(d.length===2){var x=d[0],T=d[1];if(typeof T!="function")throw new Error("EventListener.on(): Invalid arguments: "+c.default.Config.inspect(d));if(o.isEmptyArg(x))this.any.push(T);else if(o.isArray(x))x.forEach(function(w){O.on(w,T)});else{if(typeof x!="string")throw new Error("EventListener.on(): Invalid arguments: "+c.default.Config.inspect(d));var S=this.events[x]||(this.events[x]=[]);S.push(T)}}},E.prototype.off=function(){for(var O,d=this,A=[],I=0;I<arguments.length;I++)A[I]=arguments[I];if(A.length==0||o.isEmptyArg(A[0])&&o.isEmptyArg(A[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var x=A[0],T=A[1],S=null,w=null;if(A.length===1||!T)typeof x=="function"?S=x:w=x;else{if(typeof T!="function")throw new Error("EventEmitter.off(): invalid arguments:"+c.default.Config.inspect(A));O=[x,T],w=O[0],S=O[1]}if(S&&o.isEmptyArg(w)){f([this.any,this.events,this.anyOnce,this.eventsOnce],S);return}if(o.isArray(w)){w.forEach(function(p){d.off(p,S)});return}if(typeof w!="string")throw new Error("EventEmitter.off(): invalid arguments:"+c.default.Config.inspect(A));S?f([this.events,this.eventsOnce],S,w):(delete this.events[w],delete this.eventsOnce[w])},E.prototype.listeners=function(O){if(O){var d=this.events[O]||[];return this.eventsOnce[O]&&Array.prototype.push.apply(d,this.eventsOnce[O]),d.length?d:null}return this.any.length?this.any:null},E.prototype.emit=function(O){for(var d=[],A=1;A<arguments.length;A++)d[A-1]=arguments[A];var I={event:O},x=[];this.anyOnce.length&&(Array.prototype.push.apply(x,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(x,this.any);var T=this.eventsOnce[O];T&&(Array.prototype.push.apply(x,T),delete this.eventsOnce[O]);var S=this.events[O];S&&Array.prototype.push.apply(x,S),o.arrForEach(x,function(w){u(I,w,d)})},E.prototype.once=function(){for(var O=this,d=[],A=0;A<arguments.length;A++)d[A]=arguments[A];var I=d.length;if((I===0||I===1&&typeof d[0]!="function")&&c.default.Config.Promise){var x=d[0];if(typeof x!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+c.default.Config.inspect(d));return new c.default.Config.Promise(function(g){O.once(x,g)})}var T=d[0],S=d[1];if(d.length===1&&typeof T=="function")this.anyOnce.push(T);else if(o.isEmptyArg(T)){if(typeof S!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+c.default.Config.inspect(d));this.anyOnce.push(S)}else if(o.isArray(T)){var w=this,p=function(){var g=Array.prototype.slice.call(arguments);if(o.arrForEach(T,function(v){w.off(v,p)}),typeof S!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+c.default.Config.inspect(d));S.apply(this,g)};o.arrForEach(T,function(g){w.on(g,p)})}else{if(typeof T!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+c.default.Config.inspect(d));var y=this.eventsOnce[T]||(this.eventsOnce[T]=[]);if(S){if(typeof S!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+c.default.Config.inspect(d));y.push(S)}}},E.prototype.whenState=function(O,d,A){for(var I=this,x=[],T=3;T<arguments.length;T++)x[T-3]=arguments[T];var S={event:O};if(typeof O!="string"||typeof d!="string")throw"whenState requires a valid event String argument";if(typeof A!="function"&&c.default.Config.Promise)return new c.default.Config.Promise(function(w){E.prototype.whenState.apply(I,[O,d,w].concat(x))});O===d?u(S,A,x):this.once(O,A)},E}();e.default=m},function(s,e,t){"use strict";e.__esModule=!0,e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var i=t(1),o=i.__importDefault(t(0)),l=i.__importStar(t(2)),c=i.__importDefault(t(3)),u=i.__importDefault(t(5)),f=t(42),m="ably-js/"+f.version,E={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:f.version,apiVersion:"1.2",agent:m,getHost:O,getPort:d,getHttpScheme:A,environmentFallbackHosts:I,getFallbackHosts:x,getHosts:T,checkHost:S,objectifyOptions:y,normaliseOptions:g};function O(h,C,M){return M?C=C==h.restHost&&h.realtimeHost||C||h.realtimeHost:C=C||h.restHost,C}e.getHost=O;function d(h,C){return C||h.tls?h.tlsPort:h.port}e.getPort=d;function A(h){return h.tls?"https://":"http://"}e.getHttpScheme=A;function I(h){return[h+"-a-fallback.ably-realtime.com",h+"-b-fallback.ably-realtime.com",h+"-c-fallback.ably-realtime.com",h+"-d-fallback.ably-realtime.com",h+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=I;function x(h){var C=h.fallbackHosts,M=typeof h.httpMaxRetryCount!="undefined"?h.httpMaxRetryCount:E.httpMaxRetryCount;return C?l.arrChooseN(C,M):[]}e.getFallbackHosts=x;function T(h){return[h.restHost].concat(x(h))}e.getHosts=T;function S(h){if(typeof h!="string")throw new u.default("host must be a string; was a "+typeof h,4e4,400);if(!h.length)throw new u.default("host must not be zero-length",4e4,400)}function w(h,C,M){return h.realtimeHost?h.realtimeHost:h.restHost?(c.default.logAction(c.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+h.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+h.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),h.restHost):C?E.REALTIME_HOST:M+"-"+E.REALTIME_HOST}function p(h){var C={};for(var M in E.TIMEOUTS)C[M]=h[M]||E.TIMEOUTS[M];return C}function y(h){return typeof h=="string"?h.indexOf(":")==-1?{token:h}:{key:h}:h}e.objectifyOptions=y;function g(h){if(h.host&&(c.default.deprecated("host","restHost"),h.restHost=h.host),h.wsHost&&(c.default.deprecated("wsHost","realtimeHost"),h.realtimeHost=h.wsHost),h.queueEvents&&(c.default.deprecated("queueEvents","queueMessages"),h.queueMessages=h.queueEvents),h.fallbackHostsUseDefault){if(h.fallbackHosts){var C="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions",C),new u.default(C,4e4,400)}if(h.port||h.tlsPort){var C="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions",C),new u.default(C,4e4,400)}h.environment?c.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):c.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),h.fallbackHosts=E.FALLBACK_HOSTS}h.recover===!0&&(c.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),h.recover=function(z,W){W(!0)}),typeof h.recover=="function"&&h.closeOnUnload===!0&&(c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),h.recover=void 0),"closeOnUnload"in h||(h.closeOnUnload=!h.recover),h.transports&&l.arrIn(h.transports,"xhr")&&(c.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),l.arrDeleteValue(h.transports,"xhr"),h.transports.push("xhr_streaming")),"queueMessages"in h||(h.queueMessages=!0);var M=h.environment&&String(h.environment).toLowerCase()||E.ENVIRONMENT,L=!M||M==="production";!h.fallbackHosts&&!h.restHost&&!h.realtimeHost&&!h.port&&!h.tlsPort&&(h.fallbackHosts=L?E.FALLBACK_HOSTS:I(M));var $=h.restHost||(L?E.REST_HOST:M+"-"+E.REST_HOST),H=w(h,L,M);l.arrForEach((h.fallbackHosts||[]).concat($,H),S),h.port=h.port||E.PORT,h.tlsPort=h.tlsPort||E.TLS_PORT,"tls"in h||(h.tls=!0);var F=p(h);if("useBinaryProtocol"in h?h.useBinaryProtocol=o.default.Config.supportsBinary&&h.useBinaryProtocol:h.useBinaryProtocol=o.default.Config.preferBinary,h.clientId){var R=h.headers=h.headers||{};R["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(h.clientId))}if("idempotentRestPublishing"in h||(h.idempotentRestPublishing=!0),h.promises&&!o.default.Config.Promise&&(c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),h.promises=!1),h.agents)for(var P in h.agents)E.agent+=" "+P+"/"+h.agents[P];return i.__assign(i.__assign({},h),{useBinaryProtocol:"useBinaryProtocol"in h?o.default.Config.supportsBinary&&h.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:H,restHost:$,maxMessageSize:h.maxMessageSize||E.maxMessageSize,timeouts:F})}e.normaliseOptions=g,e.default=E;function v(h){return Object.assign(E,h)}e.getDefaults=v},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(0)),l=i.__importDefault(t(3)),c=i.__importDefault(t(5)),u=i.__importStar(t(2));function f(d){return!d||!d.channelOptions?{channelOptions:d,plugins:{},baseEncodedPreviousPayload:void 0}:d}function m(d){if(d&&d.cipher&&!d.cipher.channelCipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=o.default.Crypto.getCipher(d.cipher);return{cipher:A.cipherParams,channelCipher:A.cipher}}return d}function E(d){var A=0;return d.name&&(A+=d.name.length),d.clientId&&(A+=d.clientId.length),d.extras&&(A+=JSON.stringify(d.extras).length),d.data&&(A+=u.dataSizeBytes(d.data)),A}var O=function(){function d(){}return d.prototype.toJSON=function(){var A=this.encoding,I=this.data;return I&&o.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(A=A?A+"/base64":"base64",I=o.default.BufferUtils.base64Encode(I)):I=o.default.BufferUtils.toBuffer(I)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:A,data:I}},d.prototype.toString=function(){var A="[Message";return this.name&&(A+="; name="+this.name),this.id&&(A+="; id="+this.id),this.timestamp&&(A+="; timestamp="+this.timestamp),this.clientId&&(A+="; clientId="+this.clientId),this.connectionId&&(A+="; connectionId="+this.connectionId),this.encoding&&(A+="; encoding="+this.encoding),this.extras&&(A+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?A+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?A+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):A+="; data (json)="+JSON.stringify(this.data)),this.extras&&(A+="; extras="+JSON.stringify(this.extras)),A+="]",A},d.encrypt=function(A,I,x){var T=A.data,S=A.encoding,w=I.channelCipher;S=S?S+"/":"",o.default.BufferUtils.isBuffer(T)||(T=o.default.BufferUtils.utf8Encode(String(T)),S=S+"utf-8/"),w.encrypt(T,function(p,y){if(p){x(p);return}A.data=y,A.encoding=S+"cipher+"+w.algorithm,x(null,A)})},d.encode=function(A,I,x){var T=A.data,S=typeof T=="string"||o.default.BufferUtils.isBuffer(T)||T===null||T===void 0;if(!S)if(u.isObject(T)||u.isArray(T))A.data=JSON.stringify(T),A.encoding=A.encoding?A.encoding+"/json":"json";else throw new c.default("Data type is unsupported",40013,400);I!=null&&I.cipher?d.encrypt(A,I,x):x(null,A)},d.encodeArray=function(A,I,x){for(var T=0,S=0;S<A.length;S++)d.encode(A[S],I,function(w){if(w){x(w);return}T++,T==A.length&&x(null,A)})},d.decode=function(A,I){var x=f(I),T=A.data,S=A.encoding;if(S){var w=S.split("/"),p=void 0,y=w.length,g=A.data,v="";try{for(;(p=y)>0;){var h=w[--y].match(/([-\w]+)(\+([\w-]+))?/);if(!h)break;switch(v=h[1],v){case"base64":g=o.default.BufferUtils.base64Decode(String(g)),p==w.length&&(T=g);continue;case"utf-8":g=o.default.BufferUtils.utf8Decode(g);continue;case"json":g=JSON.parse(g);continue;case"cipher":if(x.channelOptions!=null&&x.channelOptions.cipher&&x.channelOptions.channelCipher){var C=h[3],M=x.channelOptions.channelCipher;if(C!=M.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");g=M.decrypt(g);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!x.plugins||!x.plugins.vcdiff)throw new c.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new c.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=x.baseEncodedPreviousPayload;typeof L=="string"&&(L=o.default.BufferUtils.utf8Encode(L)),L=o.default.BufferUtils.toBuffer(L),g=o.default.BufferUtils.toBuffer(g),g=o.default.BufferUtils.typedArrayToBuffer(x.plugins.vcdiff.decode(g,L)),T=g}catch(H){throw new c.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var $=H;throw new c.default("Error processing the "+v+" encoding, decoder returned \u2018"+$.message+"\u2019",$.code||40013,400)}finally{A.encoding=p<=0?null:w.slice(0,p).join("/"),A.data=g}}x.baseEncodedPreviousPayload=T},d.fromResponseBody=function(A,I,x){x&&(A=u.decodeBody(A,x));for(var T=0;T<A.length;T++){var S=A[T]=d.fromValues(A[T]);try{d.decode(S,I)}catch(w){l.default.logAction(l.default.LOG_ERROR,"Message.fromResponseBody()",w.toString())}}return A},d.fromValues=function(A){return Object.assign(new d,A)},d.fromValuesArray=function(A){for(var I=A.length,x=new Array(I),T=0;T<I;T++)x[T]=d.fromValues(A[T]);return x},d.fromEncoded=function(A,I){var x=d.fromValues(A),T=m(I);try{d.decode(x,T)}catch(S){l.default.logAction(l.default.LOG_ERROR,"Message.fromEncoded()",S.toString())}return x},d.fromEncodedArray=function(A,I){return m(I),A.map(function(x){return d.fromEncoded(x,I)})},d.getMessagesSize=function(A){for(var I,x=0,T=0;T<A.length;T++)I=A[T],x+=I.size||(I.size=E(I));return x},d.serialize=u.encodeBody,d}();e.default=O},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(5)),c=i.__importDefault(t(9)),u=i.__importDefault(t(14)),f={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},m=[];Object.keys(f).forEach(function(x){m[f[x]]=x});var E={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},O=Object.keys(E);E.MODE_ALL=E.PRESENCE|E.PUBLISH|E.SUBSCRIBE|E.PRESENCE_SUBSCRIBE;function d(x){var T=[];if(x)for(var S=0;S<x.length;S++)T.push(x[S].toString());return"[ "+T.join(", ")+" ]"}var A="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),I=function(){function x(){var T=this;this.hasFlag=function(S){return(T.flags&E[S])>0}}return x.prototype.setFlag=function(T){return this.flags=this.flags|E[T]},x.prototype.getMode=function(){return this.flags&&this.flags&E.MODE_ALL},x.prototype.encodeModesToFlags=function(T){var S=this;T.forEach(function(w){return S.setFlag(w)})},x.prototype.decodeModesFromFlags=function(){var T=this,S=[];return x.channelModes.forEach(function(w){T.hasFlag(w)&&S.push(w)}),S.length>0?S:void 0},x.fromValues=function(T){return Object.assign(new x,T)},x.Action=f,x.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],x.ActionName=m,x.serialize=o.encodeBody,x.deserialize=function(T,S){var w=o.decodeBody(T,S);return x.fromDeserialized(w)},x.fromDeserialized=function(T){var S=T.error;S&&(T.error=l.default.fromValues(S));var w=T.messages;if(w)for(var p=0;p<w.length;p++)w[p]=c.default.fromValues(w[p]);var y=T.presence;if(y)for(var p=0;p<y.length;p++)y[p]=u.default.fromValues(y[p],!0);return Object.assign(new x,T)},x.stringify=function(T){var S="[ProtocolMessage";T.action!==void 0&&(S+="; action="+x.ActionName[T.action]||!1);for(var w,p=0;p<A.length;p++)w=A[p],T[w]!==void 0&&(S+="; "+w+"="+T[w]);if(T.messages&&(S+="; messages="+d(c.default.fromValuesArray(T.messages))),T.presence&&(S+="; presence="+d(u.default.fromValuesArray(T.presence))),T.error&&(S+="; error="+l.default.fromValues(T.error).toString()),T.auth&&T.auth.accessToken&&(S+="; token="+T.auth.accessToken),T.flags&&(S+="; flags="+O.filter(T.hasFlag).join(",")),T.params){var y="";o.forInOwnNonNullProperties(T.params,function(g){y.length>0&&(y+="; "),y+=g+"="+T.params[g]}),y.length>0&&(S+="; params=["+y+"]")}return S+="]",S},x.isDuplicate=function(T,S){if(T&&S&&(T.action===f.MESSAGE||T.action===f.PRESENCE)&&T.action===S.action&&T.channel===S.channel&&T.id===S.id){if(T.action===f.PRESENCE)return!0;if(T.messages.length===S.messages.length){for(var w=0;w<T.messages.length;w++){var p=T.messages[w],y=S.messages[w];if((p.extras&&p.extras.delta&&p.extras.delta.format)!==(y.extras&&y.extras.delta&&y.extras.delta.format))return!1}return!0}}return!1},x}();e.default=I},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(10)),c=i.__importDefault(t(26)),u=i.__importDefault(t(3)),f=i.__importDefault(t(8)),m=i.__importDefault(t(19)),E=i.__importDefault(t(16)),O=i.__importDefault(t(5)),d=i.__importDefault(t(20)),A=i.__importDefault(t(0));function I(S){var w=[80015,80017,80030];return S.code?E.default.isTokenErr(S)?!1:o.arrIn(w,S.code)?!0:S.code>=4e4&&S.code<5e4:!1}function x(S){return I(S)?[l.default.fromValues({action:l.default.Action.ERROR,error:S})]:[l.default.fromValues({action:l.default.Action.DISCONNECTED,error:S})]}var T=function(S){i.__extends(w,S);function w(p,y,g){var v=S.call(this,p,y,g,!0)||this;return v.onAuthUpdated=function(h){v.authParams={access_token:h.token}},v.stream="stream"in g?g.stream:!0,v.sendRequest=null,v.recvRequest=null,v.pendingCallback=null,v.pendingItems=null,v}return w.prototype.connect=function(){var p=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","starting"),c.default.prototype.connect.call(this);var y=this.params,g=y.options,v=f.default.getHost(g,y.host),h=f.default.getPort(g),C=g.tls?"https://":"http://";this.baseUri=C+v+":"+h+"/comet/";var M=this.baseUri+"connect";u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","uri: "+M),this.auth.getAuthParams(function(L,$){if(L){p.disconnect(L);return}if(!p.isDisposed){p.authParams=$;var H=p.params.getConnectParams($);"stream"in H&&(p.stream=H.stream),u.default.logAction(u.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(H));var F=!1,R=p.recvRequest=p.createRequest(M,null,H,null,p.stream?d.default.REQ_RECV_STREAM:d.default.REQ_RECV);R.on("data",function(P){!p.recvRequest||(F||(F=!0,p.emit("preconnect")),p.onData(P))}),R.on("complete",function(P){if(p.recvRequest||(P=P||new O.default("Request cancelled",80003,400)),p.recvRequest=null,!F&&!P&&(F=!0,p.emit("preconnect")),p.onActivity(),P){P.code?p.onData(x(P)):p.disconnect(P);return}A.default.Config.nextTick(function(){p.recv()})}),R.exec()}})},w.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},w.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},w.prototype._requestCloseOrDisconnect=function(p){var y=this,g=p?this.closeUri:this.disconnectUri;if(g){var v=this.createRequest(g,null,this.authParams,null,d.default.REQ_SEND);v.on("complete",function(h){h&&(u.default.logAction(u.default.LOG_ERROR,"CometTransport.request"+(p?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(h)),y.finish("disconnected",h))}),v.exec()}},w.prototype.dispose=function(){var p=this;u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(u.default.logAction(u.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected),A.default.Config.nextTick(function(){p.emit("disposed")}))},w.prototype.onConnect=function(p){if(!this.isDisposed){var y=p.connectionKey;c.default.prototype.onConnect.call(this,p);var g=this.baseUri+y;u.default.logAction(u.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+g+"; connectionKey = "+p.connectionKey),this.sendUri=g+"/send",this.recvUri=g+"/recv",this.closeUri=g+"/close",this.disconnectUri=g+"/disconnect"}},w.prototype.send=function(p){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(p);return}var y=this.pendingItems||[];y.push(p),this.pendingItems=null,this.sendItems(y)},w.prototype.sendAnyPending=function(){var p=this.pendingItems;!p||(this.pendingItems=null,this.sendItems(p))},w.prototype.sendItems=function(p){var y=this,g=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(p),d.default.REQ_SEND);g.on("complete",function(v,h){if(v&&u.default.logAction(u.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(v)),y.sendRequest=null,v){v.code?y.onData(x(v)):y.disconnect(v);return}h&&y.onData(h),y.pendingItems&&A.default.Config.nextTick(function(){y.sendRequest||y.sendAnyPending()})}),g.exec()},w.prototype.recv=function(){var p=this;if(!this.recvRequest&&!!this.isConnected){var y=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?d.default.REQ_RECV_STREAM:d.default.REQ_RECV_POLL);y.on("data",function(g){p.onData(g)}),y.on("complete",function(g){if(p.recvRequest=null,p.onActivity(),g){g.code?p.onData(x(g)):p.disconnect(g);return}A.default.Config.nextTick(function(){p.recv()})}),y.exec()}},w.prototype.onData=function(p){try{var y=this.decodeResponse(p);if(y&&y.length)for(var g=0;g<y.length;g++)this.onProtocolMessage(l.default.fromDeserialized(y[g]))}catch(v){u.default.logAction(u.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+v.stack)}},w.prototype.encodeRequest=function(p){return JSON.stringify(p)},w.prototype.decodeResponse=function(p){return typeof p=="string"?JSON.parse(p):p},w}(c.default);e.default=T},function(s,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(i){typeof window=="object"&&(t=window)}s.exports=t},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(){var o=i,l=o.lib,c=l.WordArray,u=o.enc,f=u.Base64={stringify:function(E){var O=E.words,d=E.sigBytes,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.clamp();for(var I=[],x=0;x<d;x+=3)for(var T=O[x>>>2]>>>24-x%4*8&255,S=O[x+1>>>2]>>>24-(x+1)%4*8&255,w=O[x+2>>>2]>>>24-(x+2)%4*8&255,p=T<<16|S<<8|w,y=0;y<4&&x+y*.75<d;y++)I.push(A.charAt(p>>>6*(3-y)&63));var g=A.charAt(64);if(g)for(;I.length%4;)I.push(g);return I.join("")},parse:function(E){var O=E.length,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A=this._reverseMap;if(!A){A=this._reverseMap=[];for(var I=0;I<d.length;I++)A[d.charCodeAt(I)]=I}var x=d.charAt(64);if(x){var T=E.indexOf(x);T!==-1&&(O=T)}return m(E,O,A)}};function m(E,O,d){for(var A=[],I=0,x=0;x<O;x++)if(x%4){var T=d[E.charCodeAt(x-1)]<<x%4*2,S=d[E.charCodeAt(x)]>>>6-x%4*2,w=T|S;A[I>>>2]|=w<<24-I%4*8,I++}return c.create(A,I)}}(),i.enc.Base64})},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(3)),l=i.__importDefault(t(0)),c=i.__importDefault(t(9)),u=i.__importStar(t(2));function f(E){return m.Actions.indexOf(E)}var m=function(){function E(){}return E.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},E.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var O=this.id.split(":");return{connectionId:O[0],msgSerial:parseInt(O[1],10),index:parseInt(O[2],10)}},E.prototype.toJSON=function(){var O=this.data,d=this.encoding;return O&&l.default.BufferUtils.isBuffer(O)&&(arguments.length>0?(d=d?d+"/base64":"base64",O=l.default.BufferUtils.base64Encode(O)):O=l.default.BufferUtils.toBuffer(O)),{clientId:this.clientId,action:f(this.action),data:O,encoding:d}},E.prototype.toString=function(){var O="[PresenceMessage";return O+="; action="+this.action,this.id&&(O+="; id="+this.id),this.timestamp&&(O+="; timestamp="+this.timestamp),this.clientId&&(O+="; clientId="+this.clientId),this.connectionId&&(O+="; connectionId="+this.connectionId),this.encoding&&(O+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?O+="; data="+this.data:l.default.BufferUtils.isBuffer(this.data)?O+="; data (buffer)="+l.default.BufferUtils.base64Encode(this.data):O+="; data (json)="+JSON.stringify(this.data)),O+="]",O},E.fromResponseBody=function(O,d,A){var I=[];A&&(O=u.decodeBody(O,A));for(var x=0;x<O.length;x++){var T=I[x]=E.fromValues(O[x],!0);try{E.decode(T,d)}catch(S){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",S.toString())}}return I},E.fromValues=function(O,d){return d&&(O.action=E.Actions[O.action]),Object.assign(new E,O)},E.fromValuesArray=function(O){for(var d=O.length,A=new Array(d),I=0;I<d;I++)A[I]=E.fromValues(O[I]);return A},E.fromEncoded=function(O,d){var A=E.fromValues(O,!0);try{E.decode(A,d)}catch(I){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",I.toString())}return A},E.fromEncodedArray=function(O,d){return O.map(function(A){return E.fromEncoded(A,d)})},E.Actions=["absent","present","enter","leave","update"],E.encode=c.default.encode,E.decode=c.default.decode,E.getMessagesSize=c.default.getMessagesSize,E}();e.default=m},function(s,e,t){"use strict";(function(i){e.__esModule=!0;var o=t(1),l=o.__importStar(t(2)),c=o.__importDefault(t(7)),u=o.__importDefault(t(5)),f=o.__importDefault(t(3)),m=o.__importDefault(t(8)),E=o.__importDefault(t(20)),O=o.__importDefault(t(0));function d(C,M){return l.arrIn(l.allToLowerCase(l.keysArray(M)),"x-ably-errorcode")}function A(C,M){if(d(C,M))return C.error&&u.default.fromValues(C.error)}var I=function(){},x=0,T={},S=typeof i!="undefined"&&i.XDomainRequest;function w(){var C=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return C&&Number(C[1])}function p(){var C;return S&&(C=w())&&C===10}function y(C,M){return C.getResponseHeader&&C.getResponseHeader(M)}function g(C){return C.getResponseHeader&&(C.getResponseHeader("transfer-encoding")||!C.getResponseHeader("content-length"))}function v(C){for(var M=l.trim(C.getAllResponseHeaders()).split(`\r
`),L={},$=0;$<M.length;$++){var H=M[$].split(":").map(l.trim);L[H[0].toLowerCase()]=H[1]}return L}var h=function(C){o.__extends(M,C);function M(L,$,H,F,R,P,z){var W=C.call(this)||this;return H=H||{},H.rnd=l.cheapRandStr(),p()&&!H.envelope&&(H.envelope="json"),W.uri=L+l.toQueryString(H),W.headers=$||{},W.body=F,W.method=z?z.toUpperCase():l.isEmptyArg(F)?"GET":"POST",W.requestMode=R,W.timeouts=P,W.timedOut=!1,W.requestComplete=!1,W.id=String(++x),T[W.id]=W,W}return M.createRequest=function(L,$,H,F,R,P,z){var W=P||m.default.TIMEOUTS;return new M(L,$,l.copy(H),F,R,W,z)},M.prototype.complete=function(L,$,H,F,R){this.requestComplete||(this.requestComplete=!0,!L&&$&&this.emit("data",$),this.emit("complete",L,$,H,F,R),this.dispose())},M.prototype.abort=function(){this.dispose()},M.prototype.exec=function(){var L=this,$=this.headers,H=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,F=this.timer=setTimeout(function(){L.timedOut=!0,P.abort()},H),R=this.method,P=this.xhr=new XMLHttpRequest,z=$.accept,W=this.body,Z="text";if(z?z.indexOf("application/x-msgpack")===0&&(Z="arraybuffer"):$.accept="application/json",W){var te=$["content-type"]||($["content-type"]="application/json");te.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}P.open(R,this.uri,!0),P.responseType=Z,"authorization"in $&&(P.withCredentials=!0);for(var Y in $)P.setRequestHeader(Y,$[Y]);var G=function(pe,Ve,St,et){var st,Nt=Ve+" (event type: "+pe.type+")";!((st=L==null?void 0:L.xhr)===null||st===void 0)&&st.statusText&&(Nt+=", current statusText is "+L.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+pe.type+"()",Nt),L.complete(new u.default(Nt,St,et))};P.onerror=function(pe){G(pe,"XHR error occurred",null,400)},P.onabort=function(pe){L.timedOut?G(pe,"Request aborted due to request timeout expiring",null,408):G(pe,"Request cancelled",null,400)},P.ontimeout=function(pe){G(pe,"Request timed out",null,408)};var N,U,K,j=0,ne=!1,ce=function(){if(clearTimeout(F),K=U<400,U==204){L.complete(null,null,null,null,U);return}N=L.requestMode==E.default.REQ_RECV_STREAM&&K&&g(P)},Ee=function(){var pe;try{var Ve=y(P,"content-type"),St=Ve?Ve.indexOf("application/json")>=0:P.responseType=="text";if(St){var et=P.responseType==="arraybuffer"?O.default.BufferUtils.utf8Decode(P.response):String(P.responseText);et.length?pe=JSON.parse(et):pe=et,ne=!0}else pe=P.response;pe.response!==void 0?(U=pe.statusCode,K=U<400,$=pe.headers,pe=pe.response):$=v(P)}catch(Nt){L.complete(new u.default("Malformed response body from server: "+Nt.message,null,400));return}if(K||l.isArray(pe)){L.complete(null,pe,$,ne,U);return}var st=A(pe,$);st||(st=new u.default("Error response received from server: "+U+" body was: "+O.default.Config.inspect(pe),null,U)),L.complete(st,pe,$,ne,U)};function be(){for(var pe=P.responseText,Ve=pe.length-1,St,et;j<Ve&&(St=pe.indexOf(`
`,j))>-1;)et=pe.slice(j,St),j=St+1,_e(et)}var _e=function(pe){try{pe=JSON.parse(pe)}catch(Ve){L.complete(new u.default("Malformed response body from server: "+Ve.message,null,400));return}L.emit("data",pe)},Ke=function(){be(),L.streamComplete=!0,O.default.Config.nextTick(function(){L.complete()})};P.onreadystatechange=function(){var pe=P.readyState;pe<3||P.status!==0&&(U===void 0&&(U=P.status,U===1223&&(U=204),ce()),pe==3&&N?be():pe==4&&(N?Ke():Ee()))},P.send(W)},M.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=I,this.xhr=null;var $=this.timer;$&&(clearTimeout($),this.timer=null),this.requestComplete||L.abort()}delete T[this.id]},M}(c.default);e.default=h}).call(this,t(12))},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(3)),l=i.__importStar(t(2)),c=i.__importDefault(t(22)),u=i.__importDefault(t(5)),f=i.__importDefault(t(43)),m=t(13),E=t(32),O=i.__importDefault(t(17)),d=i.__importDefault(t(0)),A=Math.pow(2,17);function I(){}function x(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function T(H){return!!H.connection}function S(H){return l.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new u.default(l.inspectError(H),H.code||40170,H.statusCode||401)}var w=function(H){return d.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):m.stringify(E.parse(H))},p=function(H,F){if(d.default.Config.createHmac){var R=d.default.Config.createHmac("SHA256",F);return R.update(H),R.digest("base64")}return m.stringify(f.default(H,F))};function y(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var F={},R=l.keysArray(H,!0);if(!R)return"";R.sort();for(var P=0;P<R.length;P++)F[R[P]]=H[R[P]].sort();return JSON.stringify(F)}function g(H){if(H.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var F="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",F),new Error(F)}}function v(H){return"useTokenAuth"in H&&!H.useTokenAuth}function h(H){return H.useTokenAuth||!v(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function C(H){return!H.key&&!H.authCallback&&!H.authUrl}var M=0;function L(){return M++}var $=function(){function H(F,R){if(this.authOptions={},this.client=F,this.tokenParams=R.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,h(R)){if(R.key&&!p){var P="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",P),new Error(P)}C(R)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(R.defaultTokenParams,R),g(this.authOptions)}else{if(!R.key){var P="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",P),new u.default(P,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(R)}}return H.prototype.authorize=function(F,R,P){var z=this,W;if(typeof F=="function"&&!P?(P=F,W=F=null):typeof R=="function"&&!P?(P=R,W=null):W=R,!P&&this.client.options.promises)return l.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new u.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(o.default.logAction(o.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),l.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(F,W,function(Z,te){if(Z){z.client.connection&&z.client.connection.connectionManager.actOnErrorFromAuthorize(Z),P==null||P(Z);return}T(z.client)?z.client.connection.connectionManager.onAuthUpdated(te,P||I):P==null||P(null,te)})},H.prototype.authorise=function(F,R,P){o.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(F,R,P)},H.prototype._forceNewToken=function(F,R,P){var z=this;this.tokenDetails=null,this._saveTokenOptions(F,R),g(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,Z){delete z.tokenParams.timestamp,delete z.authOptions.queryTime,P(W,Z)})},H.prototype.requestToken=function(F,R,P){var z=this;if(typeof F=="function"&&!P?(P=F,R=F=null):typeof R=="function"&&!P&&(P=R,R=null),!P&&this.client.options.promises)return l.promisify(this,"requestToken",arguments);R=R||this.authOptions,F=F||l.copy(this.tokenParams);var W=P||I,Z,te=this.client;if(R.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),Z=R.authCallback;else if(R.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),Z=function(j,ne){var ce=l.mixin({accept:"application/json, text/plain"},R.authHeaders),Ee=R.authMethod&&R.authMethod.toLowerCase()==="post",be,_e=R.authUrl.indexOf("?");_e>-1&&(be=l.parseQueryString(R.authUrl.slice(_e)),R.authUrl=R.authUrl.slice(0,_e),Ee||(R.authParams=l.mixin(be,R.authParams)));var Ke=l.mixin({},R.authParams||{},j),pe=function(et,st,Nt,X){var oe;if(et?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+l.inspectError(et)):(oe=Nt["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+oe+"; body: "+l.inspectBody(st))),et||X)return ne(et,st);if(d.default.BufferUtils.isBuffer(st)&&(st=st.toString()),!oe){ne(new u.default("authUrl response is missing a content-type header",40170,401));return}var le=oe.indexOf("application/json")>-1,ge=oe.indexOf("text/plain")>-1||oe.indexOf("application/jwt")>-1;if(!le&&!ge){ne(new u.default("authUrl responded with unacceptable content-type "+oe+", should be either text/plain, application/jwt or application/json",40170,401));return}if(le){if(st.length>A){ne(new u.default("authUrl response exceeded max permitted length",40170,401));return}try{st=JSON.parse(st)}catch(De){ne(new u.default("Unexpected error processing authURL response; err = "+De.message,40170,401));return}}ne(null,st,oe)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+R.authUrl+"; Params: "+JSON.stringify(Ke)+"; method: "+(Ee?"POST":"GET")),Ee){var Ve=ce||{};Ve["content-type"]="application/x-www-form-urlencoded";var St=l.toQueryString(Ke).slice(1);z.client.http.doUri(O.default.Post,te,R.authUrl,Ve,St,be,pe)}else z.client.http.doUri(O.default.Get,te,R.authUrl,ce||{},null,Ke,pe)};else if(R.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),Z=function(j,ne){z.createTokenRequest(j,R,ne)};else{var Y="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new u.default(Y,40171,403));return}"capability"in F&&(F.capability=y(F.capability));var G=function(j,ne){var ce=j.keyName,Ee="/keys/"+ce+"/requestToken",be=function(Ke){return te.baseUri(Ke)+Ee},_e=l.defaultPostHeaders();R.requestHeaders&&l.mixin(_e,R.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Ee+"; Token params: "+JSON.stringify(j)),z.client.http.do(O.default.Post,te,be,_e,JSON.stringify(j),null,ne)},N=!1,U=this.client.options.timeouts.realtimeRequestTimeout,K=setTimeout(function(){N=!0;var j="Token request callback timed out after "+U/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",j),W(new u.default(j,40170,401))},U);Z(F,function(j,ne,ce){if(!N){if(clearTimeout(K),j){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+l.inspectError(j)),W(S(j));return}if(typeof ne=="string"){ne.length===0?W(new u.default("Token string is empty",40170,401)):ne.length>A?W(new u.default("Token string exceeded max permitted length (was "+ne.length+" bytes)",40170,401)):ne==="undefined"||ne==="null"?W(new u.default("Token string was literal null/undefined",40170,401)):ne[0]==="{"&&!(ce&&ce.indexOf("application/jwt")>-1)?W(new u.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:ne});return}if(typeof ne!="object"){var Ee="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof ne;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Ee),W(new u.default(Ee,40170,401));return}var be=JSON.stringify(ne).length;if(be>A&&!R.suppressMaxLengthCheck){W(new u.default("Token request/details object exceeded max permitted stringified size (was "+be+" bytes)",40170,401));return}if("issued"in ne){W(null,ne);return}if(!("keyName"in ne)){var Ee="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Ee),W(new u.default(Ee,40170,401));return}G(ne,function(_e,Ke,pe,Ve){if(_e){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+l.inspectError(_e)),W(S(_e));return}Ve||(Ke=JSON.parse(Ke)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,Ke)})}})},H.prototype.createTokenRequest=function(F,R,P){var z=this;if(typeof F=="function"&&!P?(P=F,R=F=null):typeof R=="function"&&!P&&(P=R,R=null),!P&&this.client.options.promises)return l.promisify(this,"createTokenRequest",arguments);R=R||this.authOptions,F=F||l.copy(this.tokenParams);var W=R.key;if(!W){P(new u.default("No key specified",40101,403));return}var Z=W.split(":"),te=Z[0],Y=Z[1];if(!Y){P(new u.default("Invalid key specified",40101,403));return}if(F.clientId===""){P(new u.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in F&&(F.capability=y(F.capability));var G=l.mixin({keyName:te},F),N=F.clientId||"",U=F.ttl||"",K=F.capability||"";(function(j){if(G.timestamp){j();return}z.getTimestamp(R&&R.queryTime,function(ne,ce){if(ne){P(ne);return}G.timestamp=ce,j()})})(function(){var j=G.nonce||(G.nonce=x()),ne=G.timestamp,ce=G.keyName+`
`+U+`
`+K+`
`+N+`
`+ne+`
`+j+`
`;G.mac=G.mac||p(ce,Y),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),P(null,G)})},H.prototype.getAuthParams=function(F){this.method=="basic"?F(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(R,P){if(R){F(R);return}if(!P)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");F(null,{access_token:P.token})})},H.prototype.getAuthHeaders=function(F){this.method=="basic"?F(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(R,P){if(R){F(R);return}if(!P)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");F(null,{authorization:"Bearer "+w(P.token)})})},H.prototype.getTimestamp=function(F,R){!this.isTimeOffsetSet()&&(F||this.authOptions.queryTime)?this.client.time(R):R(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return l.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(F){this.method="basic",this.key=F.key,this.basicKey=w(F.key),this.authOptions=F||{},"clientId"in F&&this._userSetClientId(F.clientId)},H.prototype._saveTokenOptions=function(F,R){this.method="token",F&&(this.tokenParams=F),R&&(R.token&&(R.tokenDetails=typeof R.token=="string"?{token:R.token}:R.token),R.tokenDetails&&(this.tokenDetails=R.tokenDetails),"clientId"in R&&this._userSetClientId(R.clientId),this.authOptions=R)},H.prototype._ensureValidAuthCredentials=function(F,R){var P=this,z=this.tokenDetails;if(z){if(this._tokenClientIdMismatch(z.clientId)){R(new u.default("Mismatch between clientId in token ("+z.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!z.expires||z.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+z.expires),R(null,z);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=c.default.create())).push(R),!(this.currentTokenRequestId!==null&&!F)){var W=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(Z,te){if(P.currentTokenRequestId>W){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}P.currentTokenRequestId=null;var Y=P.waitingForTokenRequest||I;if(P.waitingForTokenRequest=null,Z){Y(Z);return}Y(null,P.tokenDetails=te)})}},H.prototype._userSetClientId=function(F){if(typeof F=="string"||F===null){if(F==="*")throw new u.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var R=this._uncheckedSetClientId(F);if(R)throw R}else throw new u.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(F){if(this._tokenClientIdMismatch(F)){var R="Unexpected clientId mismatch: client has "+this.clientId+", requested "+F,P=new u.default(R,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",R),P}else return this.clientId=this.tokenParams.clientId=F,null},H.prototype._tokenClientIdMismatch=function(F){return!!(this.clientId&&this.clientId!=="*"&&F&&F!=="*"&&this.clientId!==F)},H.isTokenErr=function(F){return F.code&&F.code>=40140&&F.code<40150},H}();e.default=$},function(s,e,t){"use strict";e.__esModule=!0;var i;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(i||(i={})),e.default=i},function(s,e,t){"use strict";e.__esModule=!0,e.HttpPaginatedResponse=e.PaginatedResult=void 0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(3)),c=i.__importDefault(t(24));function u(A){var I=A.match(/^\.\/(\w+)\?(.*)$/);return I&&I[2]&&o.parseQueryString(I[2])}function f(A){typeof A=="string"&&(A=A.split(","));for(var I={},x=0;x<A.length;x++){var T=A[x].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(T){var S=u(T[1]);S&&(I[T[2]]=S)}}return I}function m(A,I,x){return!(x&&(I||typeof A.code=="number"))}var E=function(){function A(I,x,T,S,w,p){this.rest=I,this.path=x,this.headers=T,this.envelope=S!=null?S:null,this.bodyHandler=w,this.useHttpPaginatedResponse=p||!1}return A.prototype.get=function(I,x){var T=this;c.default.get(this.rest,this.path,this.headers,I,this.envelope,function(S,w,p,y,g){T.handlePage(S,w,p,y,g,x)})},A.prototype.delete=function(I,x){var T=this;c.default.delete(this.rest,this.path,this.headers,I,this.envelope,function(S,w,p,y,g){T.handlePage(S,w,p,y,g,x)})},A.prototype.post=function(I,x,T){var S=this;c.default.post(this.rest,this.path,x,this.headers,I,this.envelope,function(w,p,y,g,v){T&&S.handlePage(w,p,y,g,v,T)})},A.prototype.put=function(I,x,T){var S=this;c.default.put(this.rest,this.path,x,this.headers,I,this.envelope,function(w,p,y,g,v){T&&S.handlePage(w,p,y,g,v,T)})},A.prototype.patch=function(I,x,T){var S=this;c.default.patch(this.rest,this.path,x,this.headers,I,this.envelope,function(w,p,y,g,v){T&&S.handlePage(w,p,y,g,v,T)})},A.prototype.handlePage=function(I,x,T,S,w,p){if(I&&m(I,x,this.useHttpPaginatedResponse)){l.default.logAction(l.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(I)),p==null||p(I);return}var y,g,v;try{y=this.bodyHandler(x,T||{},S)}catch(h){p==null||p(I||h);return}T&&(g=T.Link||T.link)&&(v=f(g)),this.useHttpPaginatedResponse?p(null,new d(this,y,T||{},w,v,I)):p(null,new O(this,y,v))},A}(),O=function(){function A(I,x,T){var S=this;this.resource=I,this.items=x;var w=this;T&&("first"in T&&(this.first=function(p){if(!p&&w.resource.rest.options.promises)return o.promisify(w,"first",[]);w.get(T.first,p)}),"current"in T&&(this.current=function(p){if(!p&&w.resource.rest.options.promises)return o.promisify(w,"current",[]);w.get(T.current,p)}),this.next=function(p){if(!p&&w.resource.rest.options.promises)return o.promisify(w,"next",[]);"next"in T?w.get(T.next,p):p(null)},this.hasNext=function(){return"next"in T},this.isLast=function(){var p;return!(!((p=S.hasNext)===null||p===void 0)&&p.call(S))})}return A.prototype.get=function(I,x){var T=this.resource;c.default.get(T.rest,T.path,T.headers,I,T.envelope,function(S,w,p,y,g){T.handlePage(S,w,p,y,g,x)})},A}();e.PaginatedResult=O;var d=function(A){i.__extends(I,A);function I(x,T,S,w,p,y){var g=A.call(this,x,T,p)||this;return g.statusCode=w,g.success=w<300&&w>=200,g.headers=S,g.errorCode=y&&y.code,g.errorMessage=y&&y.message,g}return I.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},I}(O);e.HttpPaginatedResponse=d,e.default=E},function(s,e,t){"use strict";e.__esModule=!0,e.isRetriable=void 0;var i=t(1),o=i.__importDefault(t(5)),l={disconnected:o.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:o.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:o.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:o.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:o.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:o.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:o.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function c(u){if(!u.statusCode||!u.code||u.statusCode>=500)return!0;var f=!1;return Object.values(l).forEach(function(m){m.code&&m.code==u.code&&(f=!0)}),f}e.isRetriable=c,e.default=l},function(s,e,t){"use strict";e.__esModule=!0;var i;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(i||(i={})),e.default=i},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(4),t(58),t(13),t(39),t(31),t(23),t(27),t(28),t(59),t(60))})(this,function(i){return i})},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(3)),l=function(){function c(u){this.members=u||[]}return c.prototype.call=function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];for(var m=0,E=this.members;m<E.length;m++){var O=E[m];if(O)try{O.apply(void 0,u)}catch(d){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+d+"; stack = "+d.stack)}}},c.prototype.push=function(){for(var u,f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];(u=this.members).push.apply(u,f)},c.create=function(u){var f=new c(u);return Object.assign(function(){for(var m=[],E=0;E<arguments.length;E++)m[E]=arguments[E];return f.call.apply(f,m)},{push:function(m){return f.push(m)}})},c}();e.default=l},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){(function(){var o=i,l=o.lib,c=l.Base,u=o.enc,f=u.Utf8,m=o.algo,E=m.HMAC=c.extend({init:function(O,d){O=this._hasher=new O.init,typeof d=="string"&&(d=f.parse(d));var A=O.blockSize,I=A*4;d.sigBytes>I&&(d=O.finalize(d)),d.clamp();for(var x=this._oKey=d.clone(),T=this._iKey=d.clone(),S=x.words,w=T.words,p=0;p<A;p++)S[p]^=1549556828,w[p]^=909522486;x.sigBytes=T.sigBytes=I,this.reset()},reset:function(){var O=this._hasher;O.reset(),O.update(this._iKey)},update:function(O){return this._hasher.update(O),this},finalize:function(O){var d=this._hasher,A=d.finalize(O);d.reset();var I=d.finalize(this._oKey.clone().concat(A));return I}})})()})},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(0)),l=i.__importStar(t(2)),c=i.__importDefault(t(3)),u=i.__importDefault(t(16)),f=i.__importDefault(t(17)),m=i.__importDefault(t(5));function E(T,S,w,p,y){T.http.supportsAuthHeaders?T.auth.getAuthHeaders(function(g,v){g?p(g):y(l.mixin(v,S),w)}):T.auth.getAuthParams(function(g,v){g?p(g):y(S,l.mixin(v,w))})}function O(T,S){return function(w,p,y,g,v){if(w&&!p){T(w);return}if(!g)try{p=l.decodeBody(p,S)}catch(H){T(H);return}if(!p){T(new m.default("unenvelope(): Response body is missing",null));return}var h=p,C=h.statusCode,M=h.response,L=h.headers;if(C===void 0){T(w,p,y,!0,v);return}if(C<200||C>=300){var $=M&&M.error||w;$||($=new Error("Error in unenveloping "+p),$.statusCode=C),T($,M,L,!0,C);return}T(w,M,L,!0,C)}}function d(T){var S=[];if(T)for(var w in T)S.push(w+"="+T[w]);return S.join("&")}function A(T,S){return T+(S?"?":"")+d(S)}function I(T,S,w,p){return function(y,g,v,h,C){y?c.default.logAction(c.default.LOG_MICRO,"Resource."+S+"()","Received Error; "+A(w,p)+"; Error: "+l.inspectError(y)):c.default.logAction(c.default.LOG_MICRO,"Resource."+S+"()","Received; "+A(w,p)+"; Headers: "+d(v)+"; StatusCode: "+C+"; Body: "+(o.default.BufferUtils.isBuffer(g)?g.toString():g)),T&&T(y,g,v,h,C)}}var x=function(){function T(){}return T.get=function(S,w,p,y,g,v){T.do(f.default.Get,S,w,null,p,y,g,v)},T.delete=function(S,w,p,y,g,v){T.do(f.default.Delete,S,w,null,p,y,g,v)},T.post=function(S,w,p,y,g,v,h){T.do(f.default.Post,S,w,p,y,g,v,h)},T.patch=function(S,w,p,y,g,v,h){T.do(f.default.Patch,S,w,p,y,g,v,h)},T.put=function(S,w,p,y,g,v,h){T.do(f.default.Put,S,w,p,y,g,v,h)},T.do=function(S,w,p,y,g,v,h,C){c.default.shouldLog(c.default.LOG_MICRO)&&(C=I(C,S,p,v)),h&&(C=C&&O(C,h),(v=v||{}).envelope=h);function M(L,$){var H;if(c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Resource."+S+"()","Sending; "+A(p,$)),c.default.shouldLog(c.default.LOG_MICRO)){var F=y;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{F=o.default.Config.msgpack.decode(y)}catch(R){c.default.logAction(c.default.LOG_MICRO,"Resource."+S+"()","Sending MsgPack Decoding Error: "+l.inspectError(R))}c.default.logAction(c.default.LOG_MICRO,"Resource."+S+"()","Sending; "+A(p,$)+"; Body: "+F)}w.http.do(S,w,p,L,y,$,function(R,P,z,W,Z){if(R&&u.default.isTokenErr(R)){w.auth.authorize(null,null,function(te){if(te){C(te);return}E(w,z,$,C,M)});return}C(R,P,z,W,Z)})}E(w,g,v,C,M)},T}();e.default=x},function(s,e,t){"use strict";(function(i){e.__esModule=!0,e.TransportParams=void 0;var o=t(1),l=o.__importDefault(t(10)),c=o.__importStar(t(2)),u=o.__importStar(t(51)),f=o.__importDefault(t(8)),m=o.__importDefault(t(0)),E=o.__importDefault(t(7)),O=o.__importDefault(t(35)),d=o.__importDefault(t(3)),A=o.__importDefault(t(36)),I=o.__importStar(t(19)),x=o.__importDefault(t(5)),T=o.__importDefault(t(16)),S=o.__importDefault(t(9)),w=o.__importDefault(t(22)),p=o.__importDefault(t(52)),y=o.__importDefault(t(26)),g=o.__importDefault(t(53)),v=function(){var te;return typeof m.default.WebStorage!="undefined"&&((te=m.default.WebStorage)===null||te===void 0?void 0:te.localSupported)},h=function(){var te;return typeof m.default.WebStorage!="undefined"&&((te=m.default.WebStorage)===null||te===void 0?void 0:te.sessionSupported)},C=l.default.Action,M=function(){},L="ably-transport-preference",$="ably-connection-recovery";function H(){var te,Y;return h()&&((Y=(te=m.default.WebStorage)===null||te===void 0?void 0:te.getSession)===null||Y===void 0?void 0:Y.call(te,$))}function F(te){var Y,G;return h()&&((G=(Y=m.default.WebStorage)===null||Y===void 0?void 0:Y.setSession)===null||G===void 0?void 0:G.call(Y,$,te))}function R(){var te,Y;return h()&&((Y=(te=m.default.WebStorage)===null||te===void 0?void 0:te.removeSession)===null||Y===void 0?void 0:Y.call(te,$))}function P(te,Y){return c.arrIndexOf(m.default.Defaults.transportPreferenceOrder,te.shortName)>c.arrIndexOf(m.default.Defaults.transportPreferenceOrder,Y.shortName)}function z(te,Y,G){var N;if(te.channel!==Y.channel||(N=te.action)!==C.PRESENCE&&N!==C.MESSAGE||N!==Y.action)return!1;var U=N===C.PRESENCE?"presence":"messages",K=te[U].concat(Y[U]),j=S.default.getMessagesSize(K);return j>G||!c.allSame(K,"clientId")||!c.arrEvery(K,function(ne){return!ne.id})?!1:(te[U]=K,!0)}var W=function(){function te(Y,G,N,U){this.options=Y,this.host=G,this.mode=N,this.connectionKey=U,this.format=Y.useBinaryProtocol?c.Format.msgpack:c.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return te.prototype.getConnectParams=function(Y){var G=Y?c.copy(Y):{},N=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var U=N.recover.split(":");if(U){G.recover=U[0];var K=U[1];isNaN(Number(K))?G.timeSerial=K:G.connectionSerial=K}break}default:}return N.clientId!==void 0&&(G.clientId=N.clientId),N.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=f.default.apiVersion,G.agent=encodeURIComponent(f.default.agent),N.transportParams!==void 0&&c.mixin(G,N.transportParams),G},te.prototype.toString=function(){var Y="[mode="+this.mode;return this.host&&(Y+=",host="+this.host),this.connectionKey&&(Y+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Y+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Y+=",timeSerial="+this.timeSerial),this.format&&(Y+=",format="+this.format),Y+="]",Y},te}();e.TransportParams=W;var Z=function(te){o.__extends(Y,te);function Y(G,N){var U=te.call(this)||this;U.disconnectedRetryCount=0,Y.initTransports(),U.realtime=G,U.options=N;var K=N.timeouts,j=K.preferenceConnectTimeout+K.realtimeRequestTimeout;if(U.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:K.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},U.state=U.states.initialized,U.errorReason=null,U.queuedMessages=new O.default,U.msgSerial=0,U.connectionDetails=void 0,U.connectionId=void 0,U.connectionKey=void 0,U.timeSerial=void 0,U.connectionSerial=void 0,U.connectionStateTtl=K.connectionStateTtl,U.maxIdleInterval=null,U.transports=c.intersect(N.transports||f.default.defaultTransports,Y.supportedTransports),U.baseTransport=c.intersect(f.default.baseTransportOrder,U.transports)[0],U.upgradeTransports=c.intersect(U.transports,f.default.upgradeTransports),U.transportPreference=null,U.httpHosts=f.default.getHosts(N),U.activeProtocol=null,U.proposedTransports=[],U.pendingTransports=[],U.host=null,U.lastAutoReconnectAttempt=null,U.lastActivity=null,U.mostRecentMsg=null,U.forceFallbackHost=!1,U.connectCounter=0,d.default.logAction(d.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),d.default.logAction(d.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||f.default.defaultTransports)+"]"),d.default.logAction(d.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+U.transports+"]"),d.default.logAction(d.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+U.httpHosts+"]"),!U.transports.length){var ne="no requested transports available";throw d.default.logAction(d.default.LOG_ERROR,"realtime.ConnectionManager()",ne),new Error(ne)}var ce=m.default.Config.addEventListener;return ce&&(h()&&typeof N.recover=="function"&&ce("beforeunload",U.persistConnection.bind(U)),N.closeOnUnload===!0&&ce("beforeunload",function(){d.default.logAction(d.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),U.requestState({state:"closing"})}),ce("online",function(){(U.state==U.states.disconnected||U.state==U.states.suspended)&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),U.requestState({state:"connecting"}))}),ce("offline",function(){U.state==U.states.connected&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),U.disconnectAllTransports())})),U}return Y.initTransports=function(){p.default(Y),c.arrForEach(m.default.Transports,function(G){G(Y)})},Y.prototype.createTransportParams=function(G,N){var U=new W(this.options,G,N,this.connectionKey);return this.timeSerial?U.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(U.connectionSerial=this.connectionSerial),U},Y.prototype.getTransportParams=function(G){var N=this,U=function(K){if(N.connectionKey){K("resume");return}if(typeof N.options.recover=="string"){K("recover");return}var j=N.options.recover,ne=H();if(ne&&typeof j=="function"){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),j(ne,function(ce){ce?(N.options.recover=ne.recoveryKey,K("recover")):K("clean")});return}K("clean")};U(function(K){var j=N.createTransportParams(null,K);if(K==="recover"){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var ne=N.options.recover.split(":");ne&&ne[2]&&(N.msgSerial=Number(ne[2]))}else d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+j.toString());G(j)})},Y.prototype.tryATransport=function(G,N,U){var K=this;d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),y.default.tryConnect(Y.supportedTransports[N],this,this.realtime.auth,G,function(j,ne){var ce=K.state;if(ce==K.states.closing||ce==K.states.closed||ce==K.states.failed){ne&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ce.state+" while we were attempting the transport; closing "+ne),ne.close()),U(!0);return}if(j){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+j.event+", err: "+j.error.toString()),T.default.isTokenErr(j.error)&&!(K.errorReason&&T.default.isTokenErr(K.errorReason))?(K.errorReason=j.error,K.realtime.auth._forceNewToken(null,null,function(Ee){if(Ee){K.actOnErrorFromAuthorize(Ee);return}K.tryATransport(G,N,U)})):j.event==="failed"?(K.notifyState({state:"failed",error:j.error}),U(!0)):j.event==="disconnected"&&(I.isRetriable(j.error)?U(!1):(K.notifyState({state:K.states.connecting.failState,error:j.error}),U(!0)));return}d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),K.setTransportPending(ne,G),U(null,ne)})},Y.prototype.setTransportPending=function(G,N){var U=this,K=N.mode;d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+K),c.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var j=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ce,Ee,be,_e){K=="upgrade"?G.shortName!==j&&c.arrIn(U.getUpgradePossibilities(),j)&&U.activeProtocol?setTimeout(function(){U.scheduleTransportActivation(ce,G,Ee,be,_e)},U.options.timeouts.parallelUpgradeDelay):U.scheduleTransportActivation(ce,G,Ee,be,_e):(U.activateTransport(ce,G,Ee,be,_e),m.default.Config.nextTick(function(){U.connectImpl(N)})),K==="recover"&&U.options.recover&&(U.options.recover=null,U.unpersistConnection())});var ne=this;G.on(["disconnected","closed","failed"],function(ce){ne.deactivateTransport(G,this.event,ce)}),this.emit("transport.pending",G)},Y.prototype.scheduleTransportActivation=function(G,N,U,K,j){var ne=this,ce=this.activeProtocol&&this.activeProtocol.getTransport(),Ee=function(){N.disconnect(),c.arrDeleteValue(ne.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Ee();return}if(ce&&!P(N,ce)){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+ce.shortName+" - abandoning upgrade"),Ee();return}d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var be=function(_e){var Ke;if(_e){d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+N+"; err = "+_e);return}if(!N.isConnected){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),Ee();return}if(ne.state===ne.states.connected)d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),ne.state=ne.states.synchronizing,Ke=ne.activeProtocol;else if(ne.state!==ne.states.connecting){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+ne.state.state+(ne.state===ne.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Ee();return}var pe=U!==ne.connectionId,Ve=pe?j:ne;pe&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(ne.timeSerial||ne.connectionSerial)+" to "+(Ve.timeSerial||Ve.connectionSerial)+"; upgrade error was "+G),d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N),ne.sync(N,Ve,function(St,et,st){if(St){ne.state===ne.states.synchronizing&&(d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+N+"; err = "+St),ne.disconnectAllTransports());return}var Nt=function(){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),ne.activateTransport(G,N,et,K,st),ne.state===ne.states.synchronizing?(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),ne.state=ne.states.connected):d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+ne.state.state+", so leaving unchanged"),ne.state.sendEvents&&ne.sendQueuedMessages()};Ke?Ke.onceIdle(Nt):Nt()})};ce?this.realtime.channels.onceNopending(be):be()},Y.prototype.activateTransport=function(G,N,U,K,j){var ne=this;d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),G&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),U&&d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+U),K&&d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(K)),j&&d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(j.timeSerial||j.connectionSerial)),this.persistTransportPreference(N);var ce=this.state,Ee=this.states.connected.state;if(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ce.state),ce.state==this.states.closing.state||ce.state==this.states.closed.state||ce.state==this.states.failed.state)return d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(c.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var be=this.activeProtocol;this.activeProtocol=new u.default(N),this.host=N.params.host;var _e=K.connectionKey;if(_e&&this.connectionKey!=_e&&this.setConnection(U,K,j,!!G),this.onConnectionDetailsUpdate(K,N),m.default.Config.nextTick(function(){N.on("connected",function(pe,Ve,St){ne.onConnectionDetailsUpdate(St,N),ne.emit("update",new A.default(Ee,Ee,null,pe))})}),ce.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new A.default(Ee,Ee,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",N),be)if(be.messageQueue.count()>0&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+be.transport.shortName+", new one is "+N.shortName+") finishing with "+be.messageQueue.count()+" messages still pending"),be.transport===N){var Ke="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.activateTransport()",Ke)}else be.finish();return c.safeArrForEach(this.pendingTransports,function(pe){if(pe===N){var Ve="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.activateTransport()",Ve),c.arrDeleteValue(ne.pendingTransports,N)}else pe.disconnect()}),c.safeArrForEach(this.proposedTransports,function(pe){pe===N?(d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),c.arrDeleteValue(ne.proposedTransports,N)):pe.dispose()}),!0},Y.prototype.deactivateTransport=function(G,N,U){var K=this.activeProtocol,j=K&&K.getTransport()===G,ne=c.arrDeleteValue(this.pendingTransports,G),ce=c.arrDeleteValue(this.proposedTransports,G),Ee=this.noTransportsScheduledForActivation();if(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(j?"; was active":ne?"; was pending":ce?"; was proposed":"")+(Ee?"":"; another transport is scheduled for activation")),U&&U.message&&d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+U.message),j&&(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(K.getPendingMessages()),m.default.Config.nextTick(function(){K.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),j&&Ee||j&&N==="failed"||N==="closed"||K===null&&ne&&this.pendingTransports.length===0){if(N==="disconnected"&&U&&U.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:U,retryImmediately:!0});return}var be=N==="failed"&&T.default.isTokenErr(U)?"disconnected":N;this.notifyState({state:be,error:U});return}j&&N==="disconnected"&&this.state!==this.states.synchronizing&&(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:U}))},Y.prototype.noTransportsScheduledForActivation=function(){return c.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Y.prototype.sync=function(G,N,U){var K=setTimeout(function(){G.off("sync"),U(new x.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),j=l.default.fromValues({action:C.SYNC,connectionKey:this.connectionKey});N.timeSerial?j.timeSerial=N.timeSerial:N.connectionSerial!==void 0&&(j.connectionSerial=N.connectionSerial),G.send(j),G.once("sync",function(ne,ce){clearTimeout(K),U(null,ne,ce)})},Y.prototype.setConnection=function(G,N,U,K){var j=this,ne=this.connectionId,ce=ne&&ne!==G,Ee=!ne&&K;(ce||Ee)&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),m.default.Config.nextTick(function(){j.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){j.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=N.connectionKey;var be=ce||!ne;this.setConnectionSerial(U,be,!1)},Y.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Y.prototype.setConnectionSerial=function(G,N,U){var K=G.timeSerial,j=G.connectionSerial;if(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+j+"; timeSerial = "+K+"; force = "+N+"; previous = "+this.connectionSerial),K!==void 0){if(K<=this.timeSerial&&!N)return U&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+K+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=K,this.setRecoveryKey();return}if(j!==void 0){if(j<=this.connectionSerial&&!N)return U&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+j+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=j,this.setRecoveryKey()}},Y.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Y.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Y.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Y.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=c.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Y.prototype.persistConnection=function(){if(h()){var G=this.realtime.connection.recoveryKey;G&&F({recoveryKey:G,disconnectedAt:c.now(),location:i.location,clientId:this.realtime.auth.clientId})}},Y.prototype.unpersistConnection=function(){R()},Y.prototype.getError=function(){return this.errorReason||this.getStateError()},Y.prototype.getStateError=function(){return I.default[this.state.state]},Y.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Y.prototype.enactStateChange=function(G){var N=G.current==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(N,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var U=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(U.terminal||U.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Y.prototype.startTransitionTimer=function(G){var N=this;d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,d.default.logAction(d.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),N.notifyState({state:G.failState}))},G.retryDelay)},Y.prototype.cancelTransitionTimer=function(){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Y.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,d.default.logAction(d.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Y.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Y.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Y.prototype.startRetryTimer=function(G){var N=this;this.retryTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},G)},Y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Y.prototype.notifyState=function(G){var N=this,U=G.state,K=U==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&T.default.isTokenErr(G.error)&&!(this.errorReason&&T.default.isTokenErr(this.errorReason)));if(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+U+(K?"; will retry connection immediately":"")),U!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(U==="suspended"||U==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var j=this.states[G.state],ne=j.retryDelay;j.state==="disconnected"&&(this.disconnectedRetryCount++,ne=j.retryDelay*c.getBackoffCoefficient(this.disconnectedRetryCount)*c.getJitterCoefficient());var ce=new A.default(this.state.state,j.state,ne,G.error||I.default[j.state]);if(K){var Ee=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=c.now(),N.requestState({state:"connecting"}))},be=this.lastAutoReconnectAttempt&&c.now()-this.lastAutoReconnectAttempt+1;be&&be<1e3?(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+be+"ms ago, waiting another "+(1e3-be)+"ms before trying again"),setTimeout(Ee,1e3-be)):m.default.Config.nextTick(Ee)}else(U==="disconnected"||U==="suspended")&&this.startRetryTimer(ne);(U==="disconnected"&&!K||U==="suspended"||j.terminal)&&m.default.Config.nextTick(function(){N.disconnectAllTransports()}),U=="connected"&&!this.activeProtocol&&d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ce),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(U,ce.reason),this.failQueuedMessages(ce.reason))}},Y.prototype.requestState=function(G){var N=this,U=G.state;if(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+U+"; current state: "+this.state.state),U!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(U),!(U=="connecting"&&this.state.state=="connected")&&!(U=="closing"&&this.state.state=="closed"))){var K=this.states[U],j=new A.default(this.state.state,K.state,null,G.error||I.default[K.state]);this.enactStateChange(j),U=="connecting"&&m.default.Config.nextTick(function(){N.startConnect()}),U=="closing"&&this.closeImpl()}},Y.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,U=++this.connectCounter,K=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(ne){U===G.connectCounter&&G.connectImpl(ne,U)})};if(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")K();else{var j=function(ne){U===G.connectCounter&&(ne?G.actOnErrorFromAuthorize(ne):K())};this.errorReason&&T.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,j):N._ensureValidAuthCredentials(!1,j)}},Y.prototype.connectImpl=function(G,N){var U=this.state.state;U!==this.states.connecting.state&&U!==this.states.connected.state?d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+U):this.pendingTransports.length?d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):U==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,N)},Y.prototype.connectPreference=function(G){var N=this,U=this.getTransportPreference(),K=!1;c.arrIn(this.transports,U)||(this.unpersistTransportPreference(),this.connectImpl(G)),d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+U);var j=setTimeout(function(){K=!0,N.state.state!==N.states.connected.state&&(d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+U+" failed; clearing preference and trying from scratch"),N.disconnectAllTransports(),N.unpersistTransportPreference()),N.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,U,function(ne,ce){clearTimeout(j),K&&ce?(ce.off(),ce.disconnect(),c.arrDeleteValue(N.pendingTransports,ce)):!ce&&!ne&&(N.unpersistTransportPreference(),N.connectImpl(G))})},Y.prototype.connectBase=function(G,N){var U=this,K=function(be){U.notifyState({state:U.states.connecting.failState,error:be})},j=this.httpHosts.slice(),ne=function(be,_e){N===U.connectCounter&&!_e&&!be&&Ee()};d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ce=j.shift();if(!ce){K(new x.default("Unable to connect (no available host)",80003,404));return}G.host=ce;var Ee=function(){if(!j.length){K(new x.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!U.realtime.http.checkConnectivity){K(new x.default("Internal error: Http.checkConnectivity not set",null,500));return}U.realtime.http.checkConnectivity(function(be,_e){if(N===U.connectCounter){if(be){K(be);return}if(!_e){K(new x.default("Unable to connect (network unreachable)",80003,404));return}G.host=c.arrPopRandomElement(j),U.tryATransport(G,U.baseTransport,ne)}})};if(this.forceFallbackHost&&j.length){this.forceFallbackHost=!1,Ee();return}this.tryATransport(G,this.baseTransport,ne)},Y.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,N=c.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(N+1)},Y.prototype.upgradeIfNeeded=function(G){var N=this,U=this.getUpgradePossibilities();d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(U)),U.length&&c.arrForEach(U,function(K){var j=N.createTransportParams(G.host,"upgrade");N.tryATransport(j,K,M)})},Y.prototype.closeImpl=function(){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),c.safeArrForEach(this.pendingTransports,function(G){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),c.safeArrForEach(this.proposedTransports,function(G){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Y.prototype.onAuthUpdated=function(G,N){var U=this,K;switch(this.state.state){case"connected":{if(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var j=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){U.state.state==="connected"&&U.upgradeIfNeeded(j)})}var ne=(K=this.activeProtocol)===null||K===void 0?void 0:K.getTransport();ne&&ne.onAuthUpdated&&ne.onAuthUpdated(G);var ce=l.default.fromValues({action:C.AUTH,auth:{accessToken:G.token}});this.send(ce);var Ee=function(){U.off(be),N(null,G)},be=function(Ke){Ke.current==="failed"&&(U.off(Ee),U.off(be),N(Ke.reason||U.getStateError()))};this.once("connectiondetails",Ee),this.on("connectionstate",be);break}case"connecting":d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var _e=function(Ke){switch(Ke.current){case"connected":U.off(_e),N(null,G);break;case"failed":case"closed":case"suspended":U.off(_e),N(Ke.reason||U.getStateError());break;default:break}};this.on("connectionstate",_e),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Y.prototype.disconnectAllTransports=function(G){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,c.safeArrForEach(this.pendingTransports,function(N){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],c.safeArrForEach(this.proposedTransports,function(N){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Y.prototype.send=function(G,N,U){U=U||M;var K=this.state;if(K.sendEvents){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new u.PendingMessage(G,U));return}var j=N&&K.queueEvents||K.forceQueueEvents;if(!j){var ne="rejecting event, queueEvent was "+N+", state was "+K.state;d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.send()",ne),U(this.errorReason||new x.default(ne,9e4,400));return}d.default.shouldLog(d.default.LOG_MICRO)&&d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+l.default.stringify(G)),this.queue(G,U)},Y.prototype.sendImpl=function(G){var N=G.message;G.ackRequired&&!G.sendAttempted&&(N.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(U){d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+U.stack)}},Y.prototype.queue=function(G,N){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var U=this.queuedMessages.last(),K=this.options.maxMessageSize;U&&!U.sendAttempted&&z(U.message,G,K)?(U.merged||(U.callback=w.default.create([U.callback]),U.merged=!0),U.callback.push(N)):this.queuedMessages.push(new u.PendingMessage(G,N))},Y.prototype.sendQueuedMessages=function(){d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Y.prototype.queuePendingMessages=function(G){G&&G.length&&(d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Y.prototype.failQueuedMessages=function(G){var N=this.queuedMessages.count();N>0&&(d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+c.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Y.prototype.onChannelMessage=function(G,N){var U=this.activeProtocol&&N===this.activeProtocol.getTransport(),K=c.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing,j=G.action===C.MESSAGE||G.action===C.PRESENCE;if(U||K){if(j){var ne=this.setConnectionSerial(G,!1,!0);if(ne)return;if(l.default.isDuplicate(G,this.mostRecentMsg)){d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else c.arrIndexOf([C.ACK,C.NACK,C.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):d.default.logAction(d.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Y.prototype.ping=function(G,N){var U=this;if(G){d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var K=function(){G.off("heartbeat",ce),N(new x.default("Timeout waiting for heartbeat response",5e4,500))},j=c.now(),ne=c.cheapRandStr(),ce=function(pe){if(pe===ne){G.off("heartbeat",ce),clearTimeout(Ee);var Ve=c.now()-j;N(null,Ve)}},Ee=setTimeout(K,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ce),G.ping(ne);return}if(this.state.state!=="connected"){N(new x.default("Unable to ping service; not connected",4e4,400));return}var be=!1,_e=function(pe,Ve){U.off("transport.active",Ke),be||(be=!0,N(pe,Ve))},Ke=function(){be||(be=!0,m.default.Config.nextTick(function(){U.ping(null,N)}))};this.on("transport.active",Ke),this.ping(this.activeProtocol.getTransport(),_e)},Y.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Y.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Y.prototype.getTransportPreference=function(){var G,N;return this.transportPreference||v()&&((N=(G=m.default.WebStorage)===null||G===void 0?void 0:G.get)===null||N===void 0?void 0:N.call(G,L))},Y.prototype.persistTransportPreference=function(G){var N,U;c.arrIn(f.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,v()&&((U=(N=m.default.WebStorage)===null||N===void 0?void 0:N.set)===null||U===void 0||U.call(N,L,G.shortName)))},Y.prototype.unpersistTransportPreference=function(){var G,N;this.transportPreference=null,v()&&((N=(G=m.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||N===void 0||N.call(G,L))},Y.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===g.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new x.default(N,80019,403,G)})}else{var N="Client configured authentication provider request failed";d.default.logAction(d.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new x.default(N,80019,401,G)})}},Y.prototype.onConnectionDetailsUpdate=function(G,N){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var U=G.clientId;if(U){var K=this.realtime.auth._uncheckedSetClientId(U);if(K){d.default.logAction(d.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",K.message),N.fail(K);return}}var j=G.connectionStateTtl;j&&(this.connectionStateTtl=j),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Y.supportedTransports={},Y}(E.default);e.default=Z}).call(this,t(12))},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(10)),l=i.__importStar(t(2)),c=i.__importDefault(t(7)),u=i.__importDefault(t(3)),f=i.__importDefault(t(19)),m=i.__importDefault(t(5)),E=i.__importDefault(t(0)),O=o.default.Action,d=o.default.fromValues({action:O.CLOSE}),A=o.default.fromValues({action:O.DISCONNECT}),I=function(x){i.__extends(T,x);function T(S,w,p,y){var g=x.call(this)||this;return y&&(p.format=void 0,p.heartbeats=!0),g.connectionManager=S,S.registerProposedTransport(g),g.auth=w,g.params=p,g.timeouts=p.options.timeouts,g.format=p.format,g.isConnected=!1,g.isFinished=!1,g.isDisposed=!1,g.maxIdleInterval=null,g.idleTimer=null,g.lastActivity=null,g}return T.prototype.connect=function(){},T.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",f.default.closed)},T.prototype.disconnect=function(S){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",S||f.default.disconnected)},T.prototype.fail=function(S){this.isConnected&&this.requestDisconnect(),this.finish("failed",S||f.default.failed)},T.prototype.finish=function(S,w){var p;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((p=this.idleTimer)!==null&&p!==void 0?p:void 0),this.idleTimer=null,this.emit(S,w),this.dispose())},T.prototype.onProtocolMessage=function(S){switch(u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(S)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),S.action){case O.HEARTBEAT:u.default.logAction(u.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",S.id);break;case O.CONNECTED:this.onConnect(S),this.emit("connected",S.error,S.connectionId,S.connectionDetails,S);break;case O.CLOSED:this.onClose(S);break;case O.DISCONNECTED:this.onDisconnect(S);break;case O.ACK:this.emit("ack",S.msgSerial,S.count);break;case O.NACK:this.emit("nack",S.msgSerial,S.count,S.error);break;case O.SYNC:if(S.connectionId!==void 0){this.emit("sync",S.connectionId,S);break}this.connectionManager.onChannelMessage(S,this);break;case O.AUTH:this.auth.authorize(function(w){w&&u.default.logAction(u.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+l.inspectError(w))});break;case O.ERROR:if(u.default.logAction(u.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+E.default.Config.inspect(S.error)+(S.channel?", channel: "+S.channel:"")),S.channel===void 0){this.onFatalError(S);break}this.connectionManager.onChannelMessage(S,this);break;default:this.connectionManager.onChannelMessage(S,this)}},T.prototype.onConnect=function(S){if(this.isConnected=!0,!S.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var w=S.connectionDetails.maxIdleInterval;w&&(this.maxIdleInterval=w+this.timeouts.realtimeRequestTimeout,this.onActivity())},T.prototype.onDisconnect=function(S){var w=S&&S.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onDisconnect()","err = "+l.inspectError(w)),this.finish("disconnected",w)},T.prototype.onFatalError=function(S){var w=S&&S.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onFatalError()","err = "+l.inspectError(w)),this.finish("failed",w)},T.prototype.onClose=function(S){var w=S&&S.error;u.default.logAction(u.default.LOG_MINOR,"Transport.onClose()","err = "+l.inspectError(w)),this.finish("closed",w)},T.prototype.requestClose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestClose()",""),this.send(d)},T.prototype.requestDisconnect=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(A)},T.prototype.ping=function(S){var w={action:o.default.Action.HEARTBEAT};S&&(w.id=S),this.send(o.default.fromValues(w))},T.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},T.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=l.now(),this.setIdleTimer(this.maxIdleInterval+100))},T.prototype.setIdleTimer=function(S){var w=this;this.idleTimer||(this.idleTimer=setTimeout(function(){w.onIdleTimerExpire()},S))},T.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var S=l.now()-this.lastActivity,w=this.maxIdleInterval-S;if(w<=0){var p="No activity seen from realtime in "+S+"ms; assuming connection has dropped";u.default.logAction(u.default.LOG_ERROR,"Transport.onIdleTimerExpire()",p),this.disconnect(new m.default(p,80003,408))}else this.setIdleTimer(w+100)},T.tryConnect=function(S,w,p,y,g){var v=new S(w,p,y),h,C=function(L){clearTimeout(h),g({event:this.event,error:L})},M=w.options.timeouts.realtimeRequestTimeout;h=setTimeout(function(){v.off(["preconnect","disconnected","failed"]),v.dispose(),C.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},M),v.on(["failed","disconnected"],C),v.on("preconnect",function(){u.default.logAction(u.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+v),clearTimeout(h),v.off(["failed","disconnected"],C),g(null,v)}),v.connect()},T}(c.default);e.default=I},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(39),t(23))})(this,function(i){return function(){var o=i,l=o.lib,c=l.Base,u=l.WordArray,f=o.algo,m=f.MD5,E=f.EvpKDF=c.extend({cfg:c.extend({keySize:128/32,hasher:m,iterations:1}),init:function(O){this.cfg=this.cfg.extend(O)},compute:function(O,d){for(var A,I=this.cfg,x=I.hasher.create(),T=u.create(),S=T.words,w=I.keySize,p=I.iterations;S.length<w;){A&&x.update(A),A=x.update(O).finalize(d),x.reset();for(var y=1;y<p;y++)A=x.finalize(A),x.reset();T.concat(A)}return T.sigBytes=w*4,T}});o.EvpKDF=function(O,d,A){return E.create(A).compute(O,d)}}(),i.EvpKDF})},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(27))})(this,function(i){i.lib.Cipher||function(o){var l=i,c=l.lib,u=c.Base,f=c.WordArray,m=c.BufferedBlockAlgorithm,E=l.enc,O=E.Utf8,d=E.Base64,A=l.algo,I=A.EvpKDF,x=c.Cipher=m.extend({cfg:u.extend(),createEncryptor:function(R,P){return this.create(this._ENC_XFORM_MODE,R,P)},createDecryptor:function(R,P){return this.create(this._DEC_XFORM_MODE,R,P)},init:function(R,P,z){this.cfg=this.cfg.extend(z),this._xformMode=R,this._key=P,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(R){return this._append(R),this._process()},finalize:function(R){R&&this._append(R);var P=this._doFinalize();return P},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function R(P){return typeof P=="string"?F:L}return function(P){return{encrypt:function(z,W,Z){return R(W).encrypt(P,z,W,Z)},decrypt:function(z,W,Z){return R(W).decrypt(P,z,W,Z)}}}}()}),T=c.StreamCipher=x.extend({_doFinalize:function(){var R=this._process(!0);return R},blockSize:1}),S=l.mode={},w=c.BlockCipherMode=u.extend({createEncryptor:function(R,P){return this.Encryptor.create(R,P)},createDecryptor:function(R,P){return this.Decryptor.create(R,P)},init:function(R,P){this._cipher=R,this._iv=P}}),p=S.CBC=function(){var R=w.extend();R.Encryptor=R.extend({processBlock:function(z,W){var Z=this._cipher,te=Z.blockSize;P.call(this,z,W,te),Z.encryptBlock(z,W),this._prevBlock=z.slice(W,W+te)}}),R.Decryptor=R.extend({processBlock:function(z,W){var Z=this._cipher,te=Z.blockSize,Y=z.slice(W,W+te);Z.decryptBlock(z,W),P.call(this,z,W,te),this._prevBlock=Y}});function P(z,W,Z){var te,Y=this._iv;Y?(te=Y,this._iv=o):te=this._prevBlock;for(var G=0;G<Z;G++)z[W+G]^=te[G]}return R}(),y=l.pad={},g=y.Pkcs7={pad:function(R,P){for(var z=P*4,W=z-R.sigBytes%z,Z=W<<24|W<<16|W<<8|W,te=[],Y=0;Y<W;Y+=4)te.push(Z);var G=f.create(te,W);R.concat(G)},unpad:function(R){var P=R.words[R.sigBytes-1>>>2]&255;R.sigBytes-=P}},v=c.BlockCipher=x.extend({cfg:x.cfg.extend({mode:p,padding:g}),reset:function(){var R;x.reset.call(this);var P=this.cfg,z=P.iv,W=P.mode;this._xformMode==this._ENC_XFORM_MODE?R=W.createEncryptor:(R=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==R?this._mode.init(this,z&&z.words):(this._mode=R.call(W,this,z&&z.words),this._mode.__creator=R)},_doProcessBlock:function(R,P){this._mode.processBlock(R,P)},_doFinalize:function(){var R,P=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(P.pad(this._data,this.blockSize),R=this._process(!0)):(R=this._process(!0),P.unpad(R)),R},blockSize:128/32}),h=c.CipherParams=u.extend({init:function(R){this.mixIn(R)},toString:function(R){return(R||this.formatter).stringify(this)}}),C=l.format={},M=C.OpenSSL={stringify:function(R){var P,z=R.ciphertext,W=R.salt;return W?P=f.create([1398893684,1701076831]).concat(W).concat(z):P=z,P.toString(d)},parse:function(R){var P,z=d.parse(R),W=z.words;return W[0]==1398893684&&W[1]==1701076831&&(P=f.create(W.slice(2,4)),W.splice(0,4),z.sigBytes-=16),h.create({ciphertext:z,salt:P})}},L=c.SerializableCipher=u.extend({cfg:u.extend({format:M}),encrypt:function(R,P,z,W){W=this.cfg.extend(W);var Z=R.createEncryptor(z,W),te=Z.finalize(P),Y=Z.cfg;return h.create({ciphertext:te,key:z,iv:Y.iv,algorithm:R,mode:Y.mode,padding:Y.padding,blockSize:R.blockSize,formatter:W.format})},decrypt:function(R,P,z,W){W=this.cfg.extend(W),P=this._parse(P,W.format);var Z=R.createDecryptor(z,W).finalize(P.ciphertext);return Z},_parse:function(R,P){return typeof R=="string"?P.parse(R,this):R}}),$=l.kdf={},H=$.OpenSSL={execute:function(R,P,z,W){W||(W=f.random(64/8));var Z=I.create({keySize:P+z}).compute(R,W),te=f.create(Z.words.slice(P),z*4);return Z.sigBytes=P*4,h.create({key:Z,iv:te,salt:W})}},F=c.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(R,P,z,W){W=this.cfg.extend(W);var Z=W.kdf.execute(z,R.keySize,R.ivSize);W.iv=Z.iv;var te=L.encrypt.call(this,R,P,Z.key,W);return te.mixIn(Z),te},decrypt:function(R,P,z,W){W=this.cfg.extend(W),P=this._parse(P,W.format);var Z=W.kdf.execute(z,R.keySize,R.ivSize,P.salt);W.iv=Z.iv;var te=L.decrypt.call(this,R,P,Z.key,W);return te}})}()})},function(s,e,t){"use strict";e.__esModule=!0,e.Request=e.createRequest=void 0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(11)),c=i.__importDefault(t(0)),u=i.__importDefault(t(7)),f=i.__importDefault(t(5)),m=i.__importDefault(t(8)),E=i.__importDefault(t(3)),O=i.__importDefault(t(20)),d=o.getGlobalObject(),A=function(){},I=d._ablyjs_jsonp={};I._=function(g){return I["_"+g]||A};var x=1,T="jsonp";function S(g,v,h,C,M,L,$){return L=L||m.default.TIMEOUTS,new p(void 0,g,v,o.copy(h),C,M,L,$)}e.createRequest=S;var w=function(g){i.__extends(v,g);function v(h,C,M){var L=g.call(this,h,C,M)||this;return L.shortName=T,M.stream=!1,L}return v.isAvailable=function(){return c.default.Config.jsonpSupported&&c.default.Config.allowComet},v.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},v.prototype.createRequest=function(h,C,M,L,$,H,F){return H=(this===null||this===void 0?void 0:this.timeouts)||H||m.default.TIMEOUTS,S(h,C,M,L,$,H,F)},v}(l.default),p=function(g){i.__extends(v,g);function v(h,C,M,L,$,H,F,R){var P=g.call(this)||this;return h===void 0&&(h=x++),P.id=h,P.uri=C,P.params=L||{},P.params.rnd=o.cheapRandStr(),M&&(M["X-Ably-Version"]&&(P.params.v=M["X-Ably-Version"]),M["X-Ably-Lib"]&&(P.params.lib=M["X-Ably-Lib"])),P.body=$,P.method=R,P.requestMode=H,P.timeouts=F,P.requestComplete=!1,P}return v.prototype.exec=function(){var h=this,C=this.id,M=this.body,L=this.method,$=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+C+")",H.envelope="jsonp",M&&(H.body=M),L&&L!=="get"&&(H.method=L);var F=this.script=document.createElement("script"),R=$+o.toQueryString(H);F.src=R,F.src.split("/").slice(-1)[0]!==R.split("/").slice(-1)[0]&&E.default.logAction(E.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),F.async=!0,F.type="text/javascript",F.charset="UTF-8",F.onerror=function(W){h.complete(new f.default("JSONP script error (event: "+c.default.Config.inspect(W)+")",null,400))},I["_"+C]=function(W){if(W.statusCode){var Z=W.response;if(W.statusCode==204)h.complete(null,null,null,W.statusCode);else if(!Z)h.complete(new f.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||o.isArray(Z))h.complete(null,Z,W.headers,W.statusCode);else{var te=Z.error||new f.default("Error response received from server",null,W.statusCode);h.complete(te)}}else h.complete(null,W)};var P=this.requestMode==O.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),P);var z=document.getElementsByTagName("head")[0];z.insertBefore(F,z.firstChild)},v.prototype.complete=function(h,C,M,L){if(M=M||{},!this.requestComplete){this.requestComplete=!0;var $=void 0;C&&($=typeof C=="string"?"text/plain":"application/json",M["content-type"]=$,this.emit("data",C)),this.emit("complete",h,C,M,!0,L),this.dispose()}},v.prototype.abort=function(){this.dispose()},v.prototype.dispose=function(){var h=this.timer;h&&(clearTimeout(h),this.timer=null);var C=this.script;C.parentNode&&C.parentNode.removeChild(C),delete I[this.id],this.emit("disposed")},v}(u.default);e.Request=p;function y(g){return d.JSONPTransport=w,w.isAvailable()&&(g.supportedTransports[T]=w),w}e.default=y},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(3)),c=i.__importDefault(t(8)),u=i.__importDefault(t(16)),f=i.__importDefault(t(45)),m=i.__importDefault(t(18)),E=i.__importDefault(t(33)),O=i.__importDefault(t(5)),d=i.__importDefault(t(48)),A=i.__importDefault(t(17)),I=i.__importDefault(t(0)),x=function(){},T=function(){function w(p){if(!p){var y="no options provided";throw l.default.logAction(l.default.LOG_ERROR,"Rest()",y),new Error(y)}var g=c.default.objectifyOptions(p);g.log&&l.default.setLog(g.log.level,g.log.handler),l.default.logAction(l.default.LOG_MICRO,"Rest()","initialized with clientOptions "+I.default.Config.inspect(p));var v=this.options=c.default.normaliseOptions(g);if(v.key){var h=v.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!h){var y="invalid key parameter";throw l.default.logAction(l.default.LOG_ERROR,"Rest()",y),new O.default(y,40400,404)}v.keyName=h[1],v.keySecret=h[2]}if("clientId"in v)if(typeof v.clientId=="string"||v.clientId===null){if(v.clientId==="*")throw new O.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new O.default("clientId must be either a string or null",40012,400);l.default.logAction(l.default.LOG_MINOR,"Rest()","started; version = "+c.default.version),this.baseUri=this.authority=function(C){return c.default.getHttpScheme(v)+C+":"+c.default.getPort(v,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new I.default.Http,this.auth=new u.default(this,v),this.channels=new S(this),this.push=new f.default(this)}return w.prototype.stats=function(p,y){if(y===void 0)if(typeof p=="function")y=p,p=null;else{if(this.options.promises)return o.promisify(this,"stats",arguments);y=x}var g=o.defaultGetHeaders(),v=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.http.supportsLinkHeaders?void 0:v;this.options.headers&&o.mixin(g,this.options.headers),new m.default(this,"/stats",g,h,function(C,M,L){for(var $=L?C:JSON.parse(C),H=0;H<$.length;H++)$[H]=d.default.fromValues($[H]);return $}).get(p,y)},w.prototype.time=function(p,y){var g=this;if(y===void 0){if(typeof p=="function")y=p,p=null;else if(this.options.promises)return o.promisify(this,"time",arguments)}var v=y||x,h=o.defaultGetHeaders();this.options.headers&&o.mixin(h,this.options.headers);var C=function(M){return g.authority(M)+"/time"};this.http.do(A.default.Get,this,C,h,null,p,function(M,L,$,H){if(M){v(M);return}H||(L=JSON.parse(L));var F=L[0];if(!F){v(new O.default("Internal error (unexpected result type from GET /time)",5e4,500));return}g.serverTimeOffset=F-o.now(),v(null,F)})},w.prototype.request=function(p,y,g,v,h,C){var M=this.options.useBinaryProtocol,L=M?I.default.Config.msgpack.encode:JSON.stringify,$=M?I.default.Config.msgpack.decode:JSON.parse,H=M?o.Format.msgpack:o.Format.json,F=this.http.supportsLinkHeaders?void 0:H;g=g||{};var R=p.toLowerCase(),P=R=="get"?o.defaultGetHeaders(H):o.defaultPostHeaders(H);if(C===void 0){if(this.options.promises)return o.promisify(this,"request",arguments);C=x}typeof v!="string"&&(v=L(v)),this.options.headers&&o.mixin(P,this.options.headers),h&&o.mixin(P,h);var z=new m.default(this,y,P,F,function(W,Z,te){return o.ensureArray(te?W:$(W))},!0);if(!o.arrIn(I.default.Http.methods,R))throw new O.default("Unsupported method "+R,40500,405);o.arrIn(I.default.Http.methodsWithBody,R)?z[R](g,v,C):z[R](g,C)},w.prototype.setLog=function(p){l.default.setLog(p.level,p.handler)},w.Promise=function(p){return p=c.default.objectifyOptions(p),p.promises=!0,new w(p)},w.Callbacks=w,w.Platform=I.default,w}(),S=function(){function w(p){this.rest=p,this.all={}}return w.prototype.get=function(p,y){p=String(p);var g=this.all[p];return g?y&&g.setOptions(y):this.all[p]=g=new E.default(this.rest,p,y),g},w.prototype.release=function(p){delete this.all[String(p)]},w}();e.default=T},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(o){var l=i,c=l.lib,u=c.WordArray,f=c.Hasher,m=l.algo,E=[],O=[];(function(){function I(w){for(var p=o.sqrt(w),y=2;y<=p;y++)if(!(w%y))return!1;return!0}function x(w){return(w-(w|0))*4294967296|0}for(var T=2,S=0;S<64;)I(T)&&(S<8&&(E[S]=x(o.pow(T,1/2))),O[S]=x(o.pow(T,1/3)),S++),T++})();var d=[],A=m.SHA256=f.extend({_doReset:function(){this._hash=new u.init(E.slice(0))},_doProcessBlock:function(I,x){for(var T=this._hash.words,S=T[0],w=T[1],p=T[2],y=T[3],g=T[4],v=T[5],h=T[6],C=T[7],M=0;M<64;M++){if(M<16)d[M]=I[x+M]|0;else{var L=d[M-15],$=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=d[M-2],F=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;d[M]=$+d[M-7]+F+d[M-16]}var R=g&v^~g&h,P=S&w^S&p^w&p,z=(S<<30|S>>>2)^(S<<19|S>>>13)^(S<<10|S>>>22),W=(g<<26|g>>>6)^(g<<21|g>>>11)^(g<<7|g>>>25),Z=C+W+R+O[M]+d[M],te=z+P;C=h,h=v,v=g,g=y+Z|0,y=p,p=w,w=S,S=Z+te|0}T[0]=T[0]+S|0,T[1]=T[1]+w|0,T[2]=T[2]+p|0,T[3]=T[3]+y|0,T[4]=T[4]+g|0,T[5]=T[5]+v|0,T[6]=T[6]+h|0,T[7]=T[7]+C|0},_doFinalize:function(){var I=this._data,x=I.words,T=this._nDataBytes*8,S=I.sigBytes*8;return x[S>>>5]|=128<<24-S%32,x[(S+64>>>9<<4)+14]=o.floor(T/4294967296),x[(S+64>>>9<<4)+15]=T,I.sigBytes=x.length*4,this._process(),this._hash},clone:function(){var I=f.clone.call(this);return I._hash=this._hash.clone(),I}});l.SHA256=f._createHelper(A),l.HmacSHA256=f._createHmacHelper(A)}(Math),i.SHA256})},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return i.enc.Utf8})},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(7)),c=i.__importDefault(t(3)),u=i.__importDefault(t(34)),f=i.__importDefault(t(9)),m=i.__importDefault(t(5)),E=i.__importDefault(t(18)),O=i.__importDefault(t(24)),d=i.__importDefault(t(0));function A(){}var I=9;function x(w){return o.arrEvery(w,function(p){return!p.id})}function T(w){var p=w||{};if(p.cipher){if(!d.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var y=d.default.Crypto.getCipher(p.cipher);p.cipher=y.cipherParams,p.channelCipher=y.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var S=function(w){i.__extends(p,w);function p(y,g,v){var h=w.call(this)||this;return c.default.logAction(c.default.LOG_MINOR,"Channel()","started; name = "+g),h.rest=y,h.name=g,h.basePath="/channels/"+encodeURIComponent(g),h.presence=new u.default(h),h.channelOptions=T(v),h}return p.prototype.setOptions=function(y){this.channelOptions=T(y)},p.prototype.history=function(y,g){if(c.default.logAction(c.default.LOG_MICRO,"Channel.history()","channel = "+this.name),g===void 0)if(typeof y=="function")g=y,y=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);g=A}this._history(y,g)},p.prototype._history=function(y,g){var v=this.rest,h=v.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,C=this.rest.http.supportsLinkHeaders?void 0:h,M=o.defaultGetHeaders(h);v.options.headers&&o.mixin(M,v.options.headers);var L=this.channelOptions;new E.default(v,this.basePath+"/messages",M,C,function($,H,F){return f.default.fromResponseBody($,L,F?void 0:h)}).get(y,g)},p.prototype.publish=function(){var y=this,g=arguments.length,v=arguments[0],h=arguments[1],C=arguments[g-1],M,L;if(typeof C!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);C=A}if(typeof v=="string"||v===null)M=[f.default.fromValues({name:v,data:h})],L=arguments[2];else if(o.isObject(v))M=[f.default.fromValues(v)],L=arguments[1];else if(o.isArray(v))M=f.default.fromValuesArray(v),L=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var $=this.rest,H=$.options,F=H.useBinaryProtocol?o.Format.msgpack:o.Format.json,R=$.options.idempotentRestPublishing,P=o.defaultPostHeaders(F);if(H.headers&&o.mixin(P,H.headers),R&&x(M)){var z=o.randomString(I);o.arrForEach(M,function(W,Z){W.id=z+":"+Z.toString()})}f.default.encodeArray(M,this.channelOptions,function(W){if(W){C(W);return}var Z=f.default.getMessagesSize(M),te=H.maxMessageSize;if(Z>te){C(new m.default("Maximum size of messages that can be published at once exceeded ( was "+Z+" bytes; limit is "+te+" bytes)",40009,400));return}y._publish(f.default.serialize(M,F),P,L,C)})},p.prototype._publish=function(y,g,v,h){O.default.post(this.rest,this.basePath+"/messages",y,g,v,null,h)},p.prototype.status=function(y){if(typeof y!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var g=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=o.defaultPostHeaders(g);O.default.get(this.rest,this.basePath,v,{},g,y||A)},p}(l.default);e.default=S},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(7)),c=i.__importDefault(t(3)),u=i.__importDefault(t(18)),f=i.__importDefault(t(14));function m(){}var E=function(O){i.__extends(d,O);function d(A){var I=O.call(this)||this;return I.channel=A,I.basePath=A.basePath+"/presence",I}return d.prototype.get=function(A,I){if(c.default.logAction(c.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),I===void 0)if(typeof A=="function")I=A,A=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);I=m}var x=this.channel.rest,T=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,S=this.channel.rest.http.supportsLinkHeaders?void 0:T,w=o.defaultGetHeaders(T);x.options.headers&&o.mixin(w,x.options.headers);var p=this.channel.channelOptions;new u.default(x,this.basePath,w,S,function(y,g,v){return f.default.fromResponseBody(y,p,v?void 0:T)}).get(A,I)},d.prototype.history=function(A,I){c.default.logAction(c.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(A,I)},d.prototype._history=function(A,I){if(I===void 0)if(typeof A=="function")I=A,A=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",arguments);I=m}var x=this.channel.rest,T=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,S=this.channel.rest.http.supportsLinkHeaders?void 0:T,w=o.defaultGetHeaders(T);x.options.headers&&o.mixin(w,x.options.headers);var p=this.channel.channelOptions;new u.default(x,this.basePath+"/history",w,S,function(y,g,v){return f.default.fromResponseBody(y,p,v?void 0:T)}).get(A,I)},d}(l.default);e.default=E},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(7)),l=i.__importDefault(t(3)),c=function(u){i.__extends(f,u);function f(){var m=u.call(this)||this;return m.messages=[],m}return f.prototype.count=function(){return this.messages.length},f.prototype.push=function(m){this.messages.push(m)},f.prototype.shift=function(){return this.messages.shift()},f.prototype.last=function(){return this.messages[this.messages.length-1]},f.prototype.copyAll=function(){return this.messages.slice()},f.prototype.append=function(m){this.messages.push.apply(this.messages,m)},f.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},f.prototype.completeMessages=function(m,E,O){l.default.logAction(l.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+E),O=O||null;var d=this.messages;if(d.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var A=d[0];if(A){var I=A.message.msgSerial,x=m+E;if(x>I)for(var T=d.splice(0,x-I),S=0,w=T;S<w.length;S++){var p=w[S];p.callback(O)}d.length==0&&this.emit("idle")}},f.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},f.prototype.clear=function(){l.default.logAction(l.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},f}(o.default);e.default=c},function(s,e,t){"use strict";e.__esModule=!0;var i=function(){function o(l,c,u,f){this.previous=l,this.current=c,u&&(this.retryIn=u),f&&(this.reason=f)}return o}();e.default=i},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(10)),l=i.__importDefault(t(7)),c=i.__importStar(t(2)),u=i.__importDefault(t(33)),f=i.__importDefault(t(3)),m=i.__importDefault(t(54)),E=i.__importDefault(t(9)),O=i.__importDefault(t(38)),d=i.__importDefault(t(5)),A=i.__importDefault(t(14)),I=i.__importDefault(t(19)),x=o.default.Action,T=function(){},S="statechange",w="sync";function p(g){if(g&&"params"in g&&!c.isObject(g.params))return new d.default("options.params must be an object",4e4,400);if(g&&"modes"in g){if(!c.isArray(g.modes))return new d.default("options.modes must be an array",4e4,400);for(var v=0;v<g.modes.length;v++){var h=g.modes[v];if(!h||typeof h!="string"||!c.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(h)))return new d.default("Invalid channel mode: "+h,4e4,400)}}}var y=function(g){i.__extends(v,g);function v(h,C,M){var L=g.call(this,h,C,M)||this;return L.retryCount=0,L.history=function($,H){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof $=="function")H=$,$=null;else{if(this.rest.options.promises)return c.promisify(this,"history",arguments);H=T}if($&&$.untilAttach){if(this.state!=="attached"){H(new d.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new d.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete $.untilAttach,$.from_serial=this.properties.attachSerial}u.default.prototype._history.call(this,$,H)},L.whenState=function($,H){return l.default.prototype.whenState.call(L,$,L.state,H)},f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel()","started; name = "+C),L.realtime=h,L.presence=new m.default(L),L.connectionManager=h.connection.connectionManager,L.state="initialized",L.subscriptions=new l.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(M),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:h.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new l.default,L}return v.invalidStateError=function(h){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+h}},v.processListenerArgs=function(h){return h=Array.prototype.slice.call(h),typeof h[0]=="function"&&h.unshift(null),h[h.length-1]==null&&h.pop(),h},v.prototype.setOptions=function(h,C){if(!C&&this.rest.options.promises)return c.promisify(this,"setOptions",arguments);var M=C||function($){$&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+$.toString())},L=p(h);if(L){M(L);return}u.default.prototype.setOptions.call(this,h),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(h)?(this.attachImpl(),this._allChannelChanges.once(function($){switch(this.event){case"update":case"attached":M==null||M(null);return;default:M==null||M($.reason);return}})):M()},v.prototype._shouldReattachToSetOptions=function(h){return(this.state==="attached"||this.state==="attaching")&&(h.params||h.modes)},v.prototype.publish=function(){for(var h=this,C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];var L=C[0],$=C.length,H=C[$-1];if(typeof H!="function"){if(this.realtime.options.promises)return c.promisify(this,"publish",arguments);H=T,++$}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if($==2)if(c.isObject(L))L=[E.default.fromValues(L)];else if(c.isArray(L))L=E.default.fromValuesArray(L);else throw new d.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[E.default.fromValues({name:C[0],data:C[1]})];var F=this.realtime.options.maxMessageSize;E.default.encodeArray(L,this.channelOptions,function(R){if(R){H(R);return}var P=E.default.getMessagesSize(L);if(P>F){H(new d.default("Maximum size of messages that can be published at once exceeded ( was "+P+" bytes; limit is "+F+" bytes)",40009,400));return}h.__publish(L,H)})},v.prototype.__publish=function(h,C){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+h.length);var M=this.state;switch(M){case"failed":case"suspended":C(d.default.fromValues(v.invalidStateError(M)));break;default:{f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+M);var L=new o.default;L.action=x.MESSAGE,L.channel=this.name,L.messages=h,this.sendMessage(L,C);break}}},v.prototype.onEvent=function(h){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var C=this.subscriptions,M=0;M<h.length;M++){var L=h[M];C.emit(L.name,L)}},v.prototype.attach=function(h,C){var M;if(typeof h=="function"?(C=h,M=null):M=h,!C){if(this.realtime.options.promises)return c.promisify(this,"attach",arguments);C=function(L){L&&f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(M)f.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=M;else if(this.state==="attached"){C();return}this._attach(!1,null,C)},v.prototype._attach=function(h,C,M){M||(M=function($){$&&f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+$.toString())});var L=this.connectionManager;if(!L.activeState()){M(L.getError());return}(this.state!=="attaching"||h)&&this.requestState("attaching",C),this.once(function($){switch(this.event){case"attached":M==null||M();break;case"detached":case"suspended":case"failed":M==null||M($.reason||L.getError()||new d.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":M==null||M(new d.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},v.prototype.attachImpl=function(){f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(S,!0);var h=o.default.fromValues({action:x.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?h.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&h.encodeModesToFlags(c.allToUpperCase(this.channelOptions.modes)),this._attachResume&&h.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(h.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(h,T)},v.prototype.detach=function(h){if(!h){if(this.realtime.options.promises)return c.promisify(this,"detach",arguments);h=T}var C=this.connectionManager;if(!C.activeState()){h(C.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),h();break;case"detached":h();break;case"failed":h(new d.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(M){switch(this.event){case"detached":h();break;case"attached":case"suspended":case"failed":h(M.reason||C.getError()||new d.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":h(new d.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},v.prototype.detachImpl=function(h){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(S,!0);var C=o.default.fromValues({action:x.DETACH,channel:this.name});this.sendMessage(C,h||T)},v.prototype.subscribe=function(){for(var h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];var M=v.processListenerArgs(h),L=M[0],$=M[1],H=M[2];if(!H&&this.realtime.options.promises)return c.promisify(this,"subscribe",[L,$]);if(this.state==="failed"){H==null||H(d.default.fromValues(v.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,$):this.subscriptions.on(L,$),this.attach(H||T)},v.prototype._subscribeFilter=function(h,C){var M=function(L){var $,H,F,R,P,z,W={name:L.name,refTimeserial:(H=($=L.extras)===null||$===void 0?void 0:$.ref)===null||H===void 0?void 0:H.timeserial,refType:(R=(F=L.extras)===null||F===void 0?void 0:F.ref)===null||R===void 0?void 0:R.type,isRef:!!(!((z=(P=L.extras)===null||P===void 0?void 0:P.ref)===null||z===void 0)&&z.timeserial),clientId:L.clientId};Object.entries(h).find(function(Z){var te=Z[0],Y=Z[1];return Y!==void 0?W[te]!==Y:!1})||C(L)};this._addFilteredSubscription(h,C,M),this.subscriptions.on(M)},v.prototype._addFilteredSubscription=function(h,C,M){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(C)){var $=this.filteredSubscriptions.get(C);$.set(h,((L=$==null?void 0:$.get(h))===null||L===void 0?void 0:L.concat(M))||[M])}else this.filteredSubscriptions.set(C,new Map([[h,[M]]]))},v.prototype._getAndDeleteFilteredSubscriptions=function(h,C){var M=this;if(!this.filteredSubscriptions)return[];if(!C&&h)return Array.from(this.filteredSubscriptions.entries()).map(function(F){var R,P=F[0],z=F[1],W=z.get(h);return z.delete(h),z.size===0&&((R=M.filteredSubscriptions)===null||R===void 0||R.delete(P)),W}).reduce(function(F,R){var P;return R?(P=F).concat.apply(P,R):F},[]);if(!C||!this.filteredSubscriptions.has(C))return[];var L=this.filteredSubscriptions.get(C);if(!h){var $=Array.from(L.values()).reduce(function(F,R){return F.concat.apply(F,R)},[]);return this.filteredSubscriptions.delete(C),$}var H=L.get(h);return L.delete(h),H||[]},v.prototype.unsubscribe=function(){for(var h=this,C,M=[],L=0;L<arguments.length;L++)M[L]=arguments[L];var $=v.processListenerArgs(M),H=$[0],F=$[1];if(typeof H=="object"&&!F||((C=this.filteredSubscriptions)===null||C===void 0?void 0:C.has(F))){this._getAndDeleteFilteredSubscriptions(H,F).forEach(function(R){return h.subscriptions.off(R)});return}this.subscriptions.off(H,F)},v.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new d.default("Unable to sync to channel; not attached",4e4);default:}var h=this.connectionManager;if(!h.activeState())throw h.getError();var C=o.default.fromValues({action:x.SYNC,channel:this.name});this.syncChannelSerial&&(C.channelSerial=this.syncChannelSerial),h.send(C)},v.prototype.sendMessage=function(h,C){this.connectionManager.send(h,this.realtime.options.queueMessages,C)},v.prototype.sendPresence=function(h,C){var M=o.default.fromValues({action:x.PRESENCE,channel:this.name,presence:c.isArray(h)?A.default.fromValuesArray(h):[A.default.fromValues(h)]});this.sendMessage(M,C)},v.prototype.onMessage=function(h){var C,M=!1;switch(h.action){case x.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=h.channelSerial,this._mode=h.getMode(),this.params=h.params||{};var L=h.decodeModesFromFlags();this.modes=L&&c.allToLowerCase(L)||void 0;var $=h.hasFlag("RESUMED"),H=h.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(S,!1),$||this.presence.onAttached(H);var F=new O.default(this.state,this.state,$,h.error);this._allChannelChanges.emit("update",F),(!$||this.channelOptions.updateOnAttached)&&this.emit("update",F)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",h.error,$,H);break}case x.DETACHED:{var R=h.error?d.default.fromValues(h.error):new d.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",R):this.state==="attaching"?this.notifyState("suspended",R):this.requestState("attaching",R);break}case x.SYNC:if(M=!0,C=this.syncChannelSerial=h.channelSerial,!h.presence)break;case x.PRESENCE:{for(var P=h.presence,z=h.id,W=h.connectionId,Z=h.timestamp,te=this.channelOptions,Y=void 0,G=0;G<P.length;G++)try{Y=P[G],A.default.decode(Y,te),Y.connectionId||(Y.connectionId=W),Y.timestamp||(Y.timestamp=Z),Y.id||(Y.id=z+":"+G)}catch(ce){f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",ce.toString())}this.presence.setPresence(P,M,C);break}case x.MESSAGE:{if(this.state!=="attached"){f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+h.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var N=h.messages,U=N[0],K=N[N.length-1],z=h.id,W=h.connectionId,Z=h.timestamp;if(U.extras&&U.extras.delta&&U.extras.delta.from!==this._lastPayload.messageId){var j='Delta message decode failure - previous message not available for message "'+h.id+'" on this channel "'+this.name+'".';f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",j),this._startDecodeFailureRecovery(new d.default(j,40018,400));break}for(var G=0;G<N.length;G++){var j=N[G];try{E.default.decode(j,this._decodingContext)}catch(pe){switch(f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()",pe.toString()),pe.code){case 40018:this._startDecodeFailureRecovery(pe);return;case 40019:case 40021:this.notifyState("failed",pe);return}}j.connectionId||(j.connectionId=W),j.timestamp||(j.timestamp=Z),j.id||(j.id=z+":"+G)}this._lastPayload.messageId=K.id,this._lastPayload.protocolMessageChannelSerial=h.channelSerial,this.onEvent(N);break}case x.ERROR:{var ne=h.error;ne&&ne.code==80016?this.checkPendingState():this.notifyState("failed",d.default.fromValues(ne));break}default:f.default.logAction(f.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+h.action+")"),this.connectionManager.abort(I.default.unknownChannelErr)}},v.prototype._startDecodeFailureRecovery=function(h){var C=this;this._lastPayload.decodeFailureRecoveryInProgress||(f.default.logAction(f.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,h,function(){C._lastPayload.decodeFailureRecoveryInProgress=!1}))},v.prototype.onAttached=function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},v.prototype.notifyState=function(h,C,M,L){if(f.default.logAction(f.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+h),this.clearStateTimer(),h!==this.state){this.presence.actOnChannelState(h,L,C),h==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),C&&(this.errorReason=C);var $=new O.default(this.state,h,M,C),H=h==="failed"?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(H,'Channel state for channel "'+this.name+'"',h+(C?"; reason: "+C:"")),h!=="attaching"&&h!=="suspended"&&(this.retryCount=0),h==="attached"?(this.onAttached(),this.setInProgress(w,L),this.setInProgress(S,!1)):(h==="detached"||h==="failed"||h==="suspended")&&(this.setInProgress(S,!1),this.setInProgress(w,!1)),h==="attached"?this._attachResume=!0:(h==="detaching"||h==="failed")&&(this._attachResume=!1),this.state=h,this._allChannelChanges.emit(h,$),this.emit(h,$)}},v.prototype.requestState=function(h,C){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+h),this.notifyState(h,C),this.checkPendingState()},v.prototype.checkPendingState=function(){var h=this.connectionManager.state;if(!(h.sendEvents||h.forceQueueEvents)){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},v.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var h=new d.default("Channel attach timed out",90007,408);this.notifyState("suspended",h);break}case"detaching":{var h=new d.default("Channel detach timed out",90007,408);this.notifyState("attached",h);break}default:this.checkPendingState();break}},v.prototype.startStateTimerIfNotRunning=function(){var h=this;this.stateTimer||(this.stateTimer=setTimeout(function(){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),h.stateTimer=null,h.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},v.prototype.clearStateTimer=function(){var h=this.stateTimer;h&&(clearTimeout(h),this.stateTimer=null)},v.prototype.startRetryTimer=function(){var h=this;if(!this.retryTimer){this.retryCount++;var C=this.realtime.options.timeouts.channelRetryTimeout*c.getJitterCoefficient()*c.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){h.state==="suspended"&&h.connectionManager.state.sendEvents&&(h.retryTimer=null,f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),h.requestState("attaching"))},C)}},v.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},v.prototype.setInProgress=function(h,C){this.rest.channels.setInProgress(this,h,C)},v.prototype.getReleaseErr=function(){var h=this.state;return h==="initialized"||h==="detached"||h==="failed"?null:new d.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+h,90001,400)},v.progressOps={statechange:S,sync:w},v}(u.default);e.default=y},function(s,e,t){"use strict";e.__esModule=!0;var i=function(){function o(l,c,u,f){this.previous=l,this.current=c,c==="attached"&&(this.resumed=u),f&&(this.reason=f)}return o}();e.default=i},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(){var o=i,l=o.lib,c=l.WordArray,u=l.Hasher,f=o.algo,m=[],E=f.SHA1=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(O,d){for(var A=this._hash.words,I=A[0],x=A[1],T=A[2],S=A[3],w=A[4],p=0;p<80;p++){if(p<16)m[p]=O[d+p]|0;else{var y=m[p-3]^m[p-8]^m[p-14]^m[p-16];m[p]=y<<1|y>>>31}var g=(I<<5|I>>>27)+w+m[p];p<20?g+=(x&T|~x&S)+1518500249:p<40?g+=(x^T^S)+1859775393:p<60?g+=(x&T|x&S|T&S)-1894007588:g+=(x^T^S)-899497514,w=S,S=T,T=x<<30|x>>>2,x=I,I=g}A[0]=A[0]+I|0,A[1]=A[1]+x|0,A[2]=A[2]+T|0,A[3]=A[3]+S|0,A[4]=A[4]+w|0},_doFinalize:function(){var O=this._data,d=O.words,A=this._nDataBytes*8,I=O.sigBytes*8;return d[I>>>5]|=128<<24-I%32,d[(I+64>>>9<<4)+14]=Math.floor(A/4294967296),d[(I+64>>>9<<4)+15]=A,O.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var O=u.clone.call(this);return O._hash=this._hash.clone(),O}});o.SHA1=u._createHelper(E),o.HmacSHA1=u._createHmacHelper(E)}(),i.SHA1})},function(s,e,t){"use strict";e.__esModule=!0;function i(p){if(p===void 0)return"undefined";var y,g;if(p instanceof ArrayBuffer?(g="ArrayBuffer",y=new DataView(p)):p instanceof DataView&&(g="DataView",y=p),!y)return JSON.stringify(p);for(var v=[],h=0;h<p.byteLength;h++){if(h>20){v.push("...");break}var C=y.getUint8(h).toString(16);C.length===1&&(C="0"+C),v.push(C)}return"<"+g+" "+v.join(" ")+">"}function o(p,y,g){for(var v=0,h=g.length;v<h;v++){var C=g.charCodeAt(v);if(C<128){p.setUint8(y++,C>>>0&127|0);continue}if(C<2048){p.setUint8(y++,C>>>6&31|192),p.setUint8(y++,C>>>0&63|128);continue}if(C<65536){p.setUint8(y++,C>>>12&15|224),p.setUint8(y++,C>>>6&63|128),p.setUint8(y++,C>>>0&63|128);continue}if(C<1114112){p.setUint8(y++,C>>>18&7|240),p.setUint8(y++,C>>>12&63|128),p.setUint8(y++,C>>>6&63|128),p.setUint8(y++,C>>>0&63|128);continue}throw new Error("bad codepoint "+C)}}function l(p,y,g){for(var v="",h=y,C=y+g;h<C;h++){var M=p.getUint8(h);if((M&128)===0){v+=String.fromCharCode(M);continue}if((M&224)===192){v+=String.fromCharCode((M&15)<<6|p.getUint8(++h)&63);continue}if((M&240)===224){v+=String.fromCharCode((M&15)<<12|(p.getUint8(++h)&63)<<6|(p.getUint8(++h)&63)<<0);continue}if((M&248)===240){v+=String.fromCharCode((M&7)<<18|(p.getUint8(++h)&63)<<12|(p.getUint8(++h)&63)<<6|(p.getUint8(++h)&63)<<0);continue}throw new Error("Invalid byte "+M.toString(16))}return v}function c(p){for(var y=0,g=0,v=p.length;g<v;g++){var h=p.charCodeAt(g);if(h<128){y+=1;continue}if(h<2048){y+=2;continue}if(h<65536){y+=3;continue}if(h<1114112){y+=4;continue}throw new Error("bad codepoint "+h)}return y}function u(p,y){var g=w(p,y);if(g!==0){var v=new ArrayBuffer(g),h=new DataView(v);return S(p,h,0,y),v}}var f=(1<<16)*(1<<16),m=1/f;function E(p,y){return y=y||0,p.getInt32(y)*f+p.getUint32(y+4)}function O(p,y){return y=y||0,p.getUint32(y)*f+p.getUint32(y+4)}function d(p,y,g){g<9223372036854776e3?(p.setInt32(y,Math.floor(g*m)),p.setInt32(y+4,g&-1)):(p.setUint32(y,2147483647),p.setUint32(y+4,2147483647))}function A(p,y,g){g<18446744073709552e3?(p.setUint32(y,Math.floor(g*m)),p.setInt32(y+4,g&-1)):(p.setUint32(y,4294967295),p.setUint32(y+4,4294967295))}var I=function(){function p(y,g){var v=this;this.map=function(h){for(var C={},M=0;M<h;M++){var L=v.parse();C[L]=v.parse()}return C},this.bin=function(h){var C=new ArrayBuffer(h);return new Uint8Array(C).set(new Uint8Array(v.view.buffer,v.offset,h),0),v.offset+=h,C},this.buf=this.bin,this.str=function(h){var C=l(v.view,v.offset,h);return v.offset+=h,C},this.array=function(h){for(var C=new Array(h),M=0;M<h;M++)C[M]=v.parse();return C},this.ext=function(h){return v.offset+=h,{type:v.view.getInt8(v.offset),data:v.buf(h)}},this.parse=function(){var h=v.view.getUint8(v.offset),C,M;if((h&128)===0)return v.offset++,h;if((h&240)===128)return M=h&15,v.offset++,v.map(M);if((h&240)===144)return M=h&15,v.offset++,v.array(M);if((h&224)===160)return M=h&31,v.offset++,v.str(M);if((h&224)===224)return C=v.view.getInt8(v.offset),v.offset++,C;switch(h){case 192:return v.offset++,null;case 193:v.offset++;return;case 194:return v.offset++,!1;case 195:return v.offset++,!0;case 196:return M=v.view.getUint8(v.offset+1),v.offset+=2,v.bin(M);case 197:return M=v.view.getUint16(v.offset+1),v.offset+=3,v.bin(M);case 198:return M=v.view.getUint32(v.offset+1),v.offset+=5,v.bin(M);case 199:return M=v.view.getUint8(v.offset+1),v.offset+=2,v.ext(M);case 200:return M=v.view.getUint16(v.offset+1),v.offset+=3,v.ext(M);case 201:return M=v.view.getUint32(v.offset+1),v.offset+=5,v.ext(M);case 202:return C=v.view.getFloat32(v.offset+1),v.offset+=5,C;case 203:return C=v.view.getFloat64(v.offset+1),v.offset+=9,C;case 204:return C=v.view.getUint8(v.offset+1),v.offset+=2,C;case 205:return C=v.view.getUint16(v.offset+1),v.offset+=3,C;case 206:return C=v.view.getUint32(v.offset+1),v.offset+=5,C;case 207:return C=O(v.view,v.offset+1),v.offset+=9,C;case 208:return C=v.view.getInt8(v.offset+1),v.offset+=2,C;case 209:return C=v.view.getInt16(v.offset+1),v.offset+=3,C;case 210:return C=v.view.getInt32(v.offset+1),v.offset+=5,C;case 211:return C=E(v.view,v.offset+1),v.offset+=9,C;case 212:return M=1,v.offset++,v.ext(M);case 213:return M=2,v.offset++,v.ext(M);case 214:return M=4,v.offset++,v.ext(M);case 215:return M=8,v.offset++,v.ext(M);case 216:return M=16,v.offset++,v.ext(M);case 217:return M=v.view.getUint8(v.offset+1),v.offset+=2,v.str(M);case 218:return M=v.view.getUint16(v.offset+1),v.offset+=3,v.str(M);case 219:return M=v.view.getUint32(v.offset+1),v.offset+=5,v.str(M);case 220:return M=v.view.getUint16(v.offset+1),v.offset+=3,v.array(M);case 221:return M=v.view.getUint32(v.offset+1),v.offset+=5,v.array(M);case 222:return M=v.view.getUint16(v.offset+1),v.offset+=3,v.map(M);case 223:return M=v.view.getUint32(v.offset+1),v.offset+=5,v.map(M)}throw new Error("Unknown type 0x"+h.toString(16))},this.offset=g||0,this.view=y}return p}();function x(p){var y=new DataView(p),g=new I(y),v=g.parse();if(g.offset!==p.byteLength)throw new Error(p.byteLength-g.offset+" trailing bytes");return v}function T(p,y){return Object.keys(p).filter(function(g){var v=p[g],h=typeof v;return(!y||v!=null)&&(h!=="function"||!!v.toJSON)})}function S(p,y,g,v){var h=typeof p;if(typeof p=="string"){var C=c(p);if(C<32)return y.setUint8(g,C|160),o(y,g+1,p),1+C;if(C<256)return y.setUint8(g,217),y.setUint8(g+1,C),o(y,g+2,p),2+C;if(C<65536)return y.setUint8(g,218),y.setUint16(g+1,C),o(y,g+3,p),3+C;if(C<4294967296)return y.setUint8(g,219),y.setUint32(g+1,C),o(y,g+5,p),5+C}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var M=p.byteLength;if(M<256)return y.setUint8(g,196),y.setUint8(g+1,M),new Uint8Array(y.buffer).set(new Uint8Array(p),g+2),2+M;if(M<65536)return y.setUint8(g,197),y.setUint16(g+1,M),new Uint8Array(y.buffer).set(new Uint8Array(p),g+3),3+M;if(M<4294967296)return y.setUint8(g,198),y.setUint32(g+1,M),new Uint8Array(y.buffer).set(new Uint8Array(p),g+5),5+M}if(typeof p=="number"){if(Math.floor(p)!==p)return y.setUint8(g,203),y.setFloat64(g+1,p),9;if(p>=0){if(p<128)return y.setUint8(g,p),1;if(p<256)return y.setUint8(g,204),y.setUint8(g+1,p),2;if(p<65536)return y.setUint8(g,205),y.setUint16(g+1,p),3;if(p<4294967296)return y.setUint8(g,206),y.setUint32(g+1,p),5;if(p<18446744073709552e3)return y.setUint8(g,207),A(y,g+1,p),9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return y.setInt8(g,p),1;if(p>=-128)return y.setUint8(g,208),y.setInt8(g+1,p),2;if(p>=-32768)return y.setUint8(g,209),y.setInt16(g+1,p),3;if(p>=-2147483648)return y.setUint8(g,210),y.setInt32(g+1,p),5;if(p>=-9223372036854776e3)return y.setUint8(g,211),d(y,g+1,p),9;throw new Error("Number too small -0x"+(-p).toString(16).substr(1))}if(h==="undefined")return v?0:(y.setUint8(g,212),y.setUint8(g+1,0),y.setUint8(g+2,0),3);if(p===null)return v?0:(y.setUint8(g,192),1);if(h==="boolean")return y.setUint8(g,p?195:194),1;if(typeof p.toJSON=="function")return S(p.toJSON(),y,g,v);if(h==="object"){var L,$=0,H=void 0,F=Array.isArray(p);if(F?L=p.length:(H=T(p,v),L=H.length),L<16?(y.setUint8(g,L|(F?144:128)),$=1):L<65536?(y.setUint8(g,F?220:222),y.setUint16(g+1,L),$=3):L<4294967296&&(y.setUint8(g,F?221:223),y.setUint32(g+1,L),$=5),F)for(var R=0;R<L;R++)$+=S(p[R],y,g+$,v);else if(H)for(var R=0;R<L;R++){var P=H[R];$+=S(P,y,g+$),$+=S(p[P],y,g+$,v)}return $}if(h==="function")return 0;throw new Error("Unknown type "+h)}function w(p,y){var g=typeof p;if(g==="string"){var v=c(p);if(v<32)return 1+v;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var h=p.byteLength;if(h<256)return 2+h;if(h<65536)return 3+h;if(h<4294967296)return 5+h}if(typeof p=="number"){if(Math.floor(p)!==p)return 9;if(p>=0){if(p<128)return 1;if(p<256)return 2;if(p<65536)return 3;if(p<4294967296)return 5;if(p<18446744073709552e3)return 9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return 1;if(p>=-128)return 2;if(p>=-32768)return 3;if(p>=-2147483648)return 5;if(p>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+p.toString(16).substr(1))}if(g==="boolean")return 1;if(p===null)return y?0:1;if(p===void 0)return y?0:3;if(typeof p.toJSON=="function")return w(p.toJSON(),y);if(g==="object"){var C,M=0;if(Array.isArray(p)){C=p.length;for(var L=0;L<C;L++)M+=w(p[L],y)}else{var $=T(p,y);C=$.length;for(var L=0;L<C;L++){var H=$[L];M+=w(H)+w(p[H],y)}}if(C<16)return 1+M;if(C<65536)return 3+M;if(C<4294967296)return 5+M;throw new Error("Array or object too long 0x"+C.toString(16))}if(g==="function")return 0;throw new Error("Unknown type "+g)}e.default={encode:u,decode:x,inspect:i,utf8Write:o,utf8Read:l,utf8ByteCount:c}},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(30)),l=i.__importDefault(t(49)),c=i.__importDefault(t(0)),u=i.__importDefault(t(55)),f=i.__importDefault(t(57)),m=i.__importDefault(t(62)),E=i.__importDefault(t(63)),O=i.__importDefault(t(67)),d=i.__importDefault(t(3)),A=t(8),I=i.__importDefault(t(25)),x=i.__importDefault(t(64)),T=i.__importDefault(t(65)),S=i.__importDefault(t(40)),w=i.__importDefault(t(9)),p=i.__importDefault(t(14));c.default.Crypto=f.default,c.default.BufferUtils=u.default,c.default.Http=m.default,c.default.Config=E.default,c.default.Transports=O.default,c.default.WebStorage=x.default,o.default.Crypto=f.default,l.default.Crypto=f.default,o.default.Message=w.default,l.default.Message=w.default,o.default.PresenceMessage=p.default,l.default.PresenceMessage=p.default,l.default.ConnectionManager=I.default,d.default.initLogHandlers(),c.default.Defaults=A.getDefaults(T.default),c.default.Config.agent&&(c.default.Defaults.agent+=" "+c.default.Config.agent),c.default.Config.noUpgrade&&(c.default.Defaults.upgradeTransports=[]),e.default={Rest:o.default,Realtime:l.default,msgpack:S.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(31),t(23))})(this,function(i){return i.HmacSHA256})},function(s,e){},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(46)),c=i.__importDefault(t(24)),u=i.__importDefault(t(18)),f=i.__importDefault(t(5)),m=i.__importDefault(t(47)),E=function(){},O=function(){function x(T){this.rest=T,this.admin=new d(T)}return x}(),d=function(){function x(T){this.rest=T,this.deviceRegistrations=new A(T),this.channelSubscriptions=new I(T)}return x.prototype.publish=function(T,S,w){var p=this.rest,y=p.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=o.defaultPostHeaders(y),v={},h=o.mixin({recipient:T},S);if(typeof w!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);w=E}p.options.headers&&o.mixin(g,p.options.headers),p.options.pushFullWait&&o.mixin(v,{fullWait:"true"});var C=o.encodeBody(h,y);c.default.post(p,"/push/publish",C,g,v,null,function(M){return w(M)})},x}(),A=function(){function x(T){this.rest=T}return x.prototype.save=function(T,S){var w=this.rest,p=l.default.fromValues(T),y=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=o.defaultPostHeaders(y),v={};if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);S=E}w.options.headers&&o.mixin(g,w.options.headers),w.options.pushFullWait&&o.mixin(v,{fullWait:"true"});var h=o.encodeBody(p,y);c.default.put(w,"/push/deviceRegistrations/"+encodeURIComponent(T.id),h,g,v,null,function(C,M,L,$){S(C,C?void 0:l.default.fromResponseBody(M,$?void 0:y))})},x.prototype.get=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=o.defaultGetHeaders(p),g=T.id||T;if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);S=E}if(typeof g!="string"||!g.length){S(new f.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}w.options.headers&&o.mixin(y,w.options.headers),c.default.get(w,"/push/deviceRegistrations/"+encodeURIComponent(g),y,{},null,function(v,h,C,M){S(v,v?void 0:l.default.fromResponseBody(h,M?void 0:p))})},x.prototype.list=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:p,g=o.defaultGetHeaders(p);if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);S=E}w.options.headers&&o.mixin(g,w.options.headers),new u.default(w,"/push/deviceRegistrations",g,y,function(v,h,C){return l.default.fromResponseBody(v,C?void 0:p)}).get(T,S)},x.prototype.remove=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=o.defaultGetHeaders(p),g={},v=T.id||T;if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);S=E}if(typeof v!="string"||!v.length){S(new f.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}w.options.headers&&o.mixin(y,w.options.headers),w.options.pushFullWait&&o.mixin(g,{fullWait:"true"}),c.default.delete(w,"/push/deviceRegistrations/"+encodeURIComponent(v),y,g,null,function(h){return S(h)})},x.prototype.removeWhere=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=o.defaultGetHeaders(p);if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);S=E}w.options.headers&&o.mixin(y,w.options.headers),w.options.pushFullWait&&o.mixin(T,{fullWait:"true"}),c.default.delete(w,"/push/deviceRegistrations",y,T,null,function(g){return S(g)})},x}(),I=function(){function x(T){this.remove=x.prototype.removeWhere,this.rest=T}return x.prototype.save=function(T,S){var w=this.rest,p=m.default.fromValues(T),y=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=o.defaultPostHeaders(y),v={};if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);S=E}w.options.headers&&o.mixin(g,w.options.headers),w.options.pushFullWait&&o.mixin(v,{fullWait:"true"});var h=o.encodeBody(p,y);c.default.post(w,"/push/channelSubscriptions",h,g,v,null,function(C,M,L,$){S(C,!C&&m.default.fromResponseBody(M,$?void 0:y))})},x.prototype.list=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:p,g=o.defaultGetHeaders(p);if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);S=E}w.options.headers&&o.mixin(g,w.options.headers),new u.default(w,"/push/channelSubscriptions",g,y,function(v,h,C){return m.default.fromResponseBody(v,C?void 0:p)}).get(T,S)},x.prototype.removeWhere=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=o.defaultGetHeaders(p);if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);S=E}w.options.headers&&o.mixin(y,w.options.headers),w.options.pushFullWait&&o.mixin(T,{fullWait:"true"}),c.default.delete(w,"/push/channelSubscriptions",y,T,null,function(g){return S(g)})},x.prototype.listChannels=function(T,S){var w=this.rest,p=w.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.rest.http.supportsLinkHeaders?void 0:p,g=o.defaultGetHeaders(p);if(typeof S!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);S=E}w.options.headers&&o.mixin(g,w.options.headers),w.options.pushFullWait&&o.mixin(T,{fullWait:"true"}),new u.default(w,"/push/channels",g,y,function(v,h,C){for(var M=!C&&p?o.decodeBody(v,p):v,L=0;L<M.length;L++)M[L]=String(M[L]);return M}).get(T,S)},x}();e.default=O},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(5)),c;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(c||(c={}));var u;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(u||(u={}));var f=function(){function m(){}return m.prototype.toJSON=function(){var E,O,d;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(E=this.push)===null||E===void 0?void 0:E.recipient,state:(O=this.push)===null||O===void 0?void 0:O.state,error:(d=this.push)===null||d===void 0?void 0:d.error}}},m.prototype.toString=function(){var E,O,d,A,I="[DeviceDetails";return this.id&&(I+="; id="+this.id),this.platform&&(I+="; platform="+this.platform),this.formFactor&&(I+="; formFactor="+this.formFactor),this.clientId&&(I+="; clientId="+this.clientId),this.metadata&&(I+="; metadata="+this.metadata),this.deviceIdentityToken&&(I+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((E=this.push)===null||E===void 0)&&E.recipient&&(I+="; push.recipient="+JSON.stringify(this.push.recipient)),!((O=this.push)===null||O===void 0)&&O.state&&(I+="; push.state="+this.push.state),!((d=this.push)===null||d===void 0)&&d.error&&(I+="; push.error="+JSON.stringify(this.push.error)),!((A=this.push)===null||A===void 0)&&A.metadata&&(I+="; push.metadata="+this.push.metadata),I+="]",I},m.fromResponseBody=function(E,O){return O&&(E=o.decodeBody(E,O)),o.isArray(E)?m.fromValuesArray(E):m.fromValues(E)},m.fromValues=function(E){return E.error=E.error&&l.default.fromValues(E.error),Object.assign(new m,E)},m.fromValuesArray=function(E){for(var O=E.length,d=new Array(O),A=0;A<O;A++)d[A]=m.fromValues(E[A]);return d},m.toRequestBody=o.encodeBody,m}();e.default=f},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=function(){function c(){}return c.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},c.prototype.toString=function(){var u="[PushChannelSubscription";return this.channel&&(u+="; channel="+this.channel),this.deviceId&&(u+="; deviceId="+this.deviceId),this.clientId&&(u+="; clientId="+this.clientId),u+="]",u},c.fromResponseBody=function(u,f){return f&&(u=o.decodeBody(u,f)),o.isArray(u)?c.fromValuesArray(u):c.fromValues(u)},c.fromValues=function(u){return Object.assign(new c,u)},c.fromValuesArray=function(u){for(var f=u.length,m=new Array(f),E=0;E<f;E++)m[E]=c.fromValues(u[E]);return m},c.toRequestBody=o.encodeBody,c}();e.default=l},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=function(){function w(p){this.count=p&&p.count||0,this.data=p&&p.data||0,this.uncompressedData=p&&p.uncompressedData||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return w}(),c=function(w){i.__extends(p,w);function p(y){var g=w.call(this,y)||this;return y&&y.category&&(g.category={},o.forInOwnNonNullProperties(y.category,function(v){g.category[v]=new l(y.category[v])})),g}return p}(l),u=function(){function w(p){this.peak=p&&p.peak||0,this.min=p&&p.min||0,this.mean=p&&p.mean||0,this.opened=p&&p.opened||0,this.refused=p&&p.refused||0}return w}(),f=function(){function w(p){this.succeeded=p&&p.succeeded||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return w}(),m=function(){function w(p){this.plain=new u(p&&p.plain),this.tls=new u(p&&p.tls),this.all=new u(p&&p.all)}return w}(),E=function(){function w(p){this.messages=new c(p&&p.messages),this.presence=new c(p&&p.presence),this.all=new c(p&&p.all)}return w}(),O=function(){function w(p){this.realtime=new E(p&&p.realtime),this.rest=new E(p&&p.rest),this.webhook=new E(p&&p.webhook),this.sharedQueue=new E(p&&p.sharedQueue),this.externalQueue=new E(p&&p.externalQueue),this.httpEvent=new E(p&&p.httpEvent),this.push=new E(p&&p.push),this.all=new E(p&&p.all)}return w}(),d=function(){function w(p){this.all=new E(p&&p.all),this.inbound=new O(p&&p.inbound),this.outbound=new O(p&&p.outbound)}return w}(),A=function(){function w(p){this.all=new E(p&&p.all),this.producerPaid=new d(p&&p.producerPaid),this.consumerPaid=new d(p&&p.consumerPaid)}return w}(),I=function(){function w(p){this.messages=p&&p.messages||0;var y=p&&p.notifications;this.notifications={invalid:y&&y.invalid||0,attempted:y&&y.attempted||0,successful:y&&y.successful||0,failed:y&&y.failed||0},this.directPublishes=p&&p.directPublishes||0}return w}(),x=function(){function w(p){this.succeeded=p&&p.succeeded||0,this.skipped=p&&p.skipped||0,this.failed=p&&p.failed||0}return w}(),T=function(){function w(p){var y=this;this.delta=void 0,p&&p.delta&&(this.delta={},o.forInOwnNonNullProperties(p.delta,function(g){y.delta[g]=new x(p.delta[g])}))}return w}(),S=function(w){i.__extends(p,w);function p(y){var g=w.call(this,y)||this;return g.persisted=new E(y&&y.persisted),g.connections=new m(y&&y.connections),g.channels=new u(y&&y.channels),g.apiRequests=new f(y&&y.apiRequests),g.tokenRequests=new f(y&&y.tokenRequests),g.xchgProducer=new A(y&&y.xchgProducer),g.xchgConsumer=new A(y&&y.xchgConsumer),g.push=new I(y&&y.pushStats),g.processed=new T(y&&y.processed),g.inProgress=y&&y.inProgress||void 0,g.unit=y&&y.unit||void 0,g.intervalId=y&&y.intervalId||void 0,g}return p.fromValues=function(y){return new p(y)},p}(d);e.default=S},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(30)),c=i.__importDefault(t(7)),u=i.__importDefault(t(3)),f=i.__importDefault(t(50)),m=i.__importDefault(t(37)),E=i.__importDefault(t(8)),O=i.__importDefault(t(5)),d=i.__importDefault(t(10)),A=i.__importDefault(t(25)),I=i.__importDefault(t(0)),x=i.__importDefault(t(9)),T=function(w){i.__extends(p,w);function p(y){var g=w.call(this,y)||this;return u.default.logAction(u.default.LOG_MINOR,"Realtime()",""),g.connection=new f.default(g,g.options),g.channels=new S(g),y.autoConnect!==!1&&g.connect(),g}return p.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},p.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},p.Promise=function(y){return y=E.default.objectifyOptions(y),y.promises=!0,new p(y)},p.Callbacks=p,p.Utils=o,p.ConnectionManager=A.default,p.Platform=I.default,p.ProtocolMessage=d.default,p.Message=x.default,p}(l.default),S=function(w){i.__extends(p,w);function p(y){var g=w.call(this)||this;return g.realtime=y,g.all={},g.inProgress={},y.connection.connectionManager.on("transport.active",function(){g.onTransportActive()}),g}return p.prototype.onChannelMessage=function(y){var g=y.channel;if(g===void 0){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+y.action);return}var v=this.all[g];if(!v){u.default.logAction(u.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+g);return}v.onMessage(y)},p.prototype.onTransportActive=function(){for(var y in this.all){var g=this.all[y];g.state==="attaching"||g.state==="detaching"?g.checkPendingState():g.state==="suspended"&&g.attach()}},p.prototype.reattach=function(y){for(var g in this.all){var v=this.all[g];v.state==="attached"&&v.requestState("attaching",y)}},p.prototype.resetAttachedMsgIndicators=function(){for(var y in this.all){var g=this.all[y];g.state==="attached"&&(g._attachedMsgIndicator=!1)}},p.prototype.checkAttachedMsgIndicators=function(y){for(var g in this.all){var v=this.all[g];if(v.state==="attached"&&v._attachedMsgIndicator===!1){var h="30s after a resume, found channel which has not received an attached; channelId = "+g+"; connectionId = "+y;u.default.logAction(u.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",h),v.requestState("attaching")}}},p.prototype.propogateConnectionInterruption=function(y,g){var v={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},h=["attaching","attached","detaching","suspended"],C=v[y];for(var M in this.all){var L=this.all[M];o.arrIn(h,L.state)&&L.notifyState(C,g)}},p.prototype.get=function(y,g){y=String(y);var v=this.all[y];if(!v)v=this.all[y]=new m.default(this.realtime,y,g);else if(g){if(v._shouldReattachToSetOptions(g))throw new O.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);v.setOptions(g)}return v},p.prototype.release=function(y){y=String(y);var g=this.all[y];if(!!g){var v=g.getReleaseErr();if(v)throw v;delete this.all[y],delete this.inProgress[y]}},p.prototype.setInProgress=function(y,g,v){this.inProgress[y.name]=this.inProgress[y.name]||{},this.inProgress[y.name][g]=v,!v&&this.hasNopending()&&this.emit("nopending")},p.prototype.onceNopending=function(y){if(this.hasNopending()){y();return}this.once("nopending",y)},p.prototype.hasNopending=function(){return o.arrEvery(o.valuesArray(this.inProgress,!0),function(y){return!o.containsValue(y,!0)})},p}(c.default);e.default=T},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(7)),c=i.__importDefault(t(25)),u=i.__importDefault(t(3)),f=i.__importDefault(t(36)),m=i.__importDefault(t(0));function E(){}var O=function(d){i.__extends(A,d);function A(I,x){var T=d.call(this)||this;return T.whenState=function(S,w){return l.default.prototype.whenState.call(T,S,T.state,w,new f.default(void 0,S))},T.ably=I,T.connectionManager=new c.default(I,x),T.state=T.connectionManager.state.state,T.key=void 0,T.id=void 0,T.serial=void 0,T.timeSerial=void 0,T.recoveryKey=void 0,T.errorReason=null,T.connectionManager.on("connectionstate",function(S){var w=T.state=S.current;m.default.Config.nextTick(function(){T.emit(w,S)})}),T.connectionManager.on("update",function(S){m.default.Config.nextTick(function(){T.emit("update",S)})}),T}return A.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},A.prototype.ping=function(I){if(u.default.logAction(u.default.LOG_MINOR,"Connection.ping()",""),!I){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);I=E}this.connectionManager.ping(null,I)},A.prototype.close=function(){u.default.logAction(u.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},A}(l.default);e.default=O},function(s,e,t){"use strict";e.__esModule=!0,e.PendingMessage=void 0;var i=t(1),o=i.__importDefault(t(10)),l=i.__importStar(t(2)),c=i.__importDefault(t(7)),u=i.__importDefault(t(3)),f=i.__importDefault(t(35)),m=i.__importDefault(t(5)),E=o.default.Action,O=function(){function A(I,x){this.message=I,this.callback=x,this.merged=!1;var T=I.action;this.sendAttempted=!1,this.ackRequired=T==E.MESSAGE||T==E.PRESENCE}return A}();e.PendingMessage=O;var d=function(A){i.__extends(I,A);function I(x){var T=A.call(this)||this;return T.transport=x,T.messageQueue=new f.default,x.on("ack",function(S,w){T.onAck(S,w)}),x.on("nack",function(S,w,p){T.onNack(S,w,p)}),T}return I.prototype.onAck=function(x,T){u.default.logAction(u.default.LOG_MICRO,"Protocol.onAck()","serial = "+x+"; count = "+T),this.messageQueue.completeMessages(x,T)},I.prototype.onNack=function(x,T,S){u.default.logAction(u.default.LOG_ERROR,"Protocol.onNack()","serial = "+x+"; count = "+T+"; err = "+l.inspectError(S)),S||(S=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(x,T,S)},I.prototype.onceIdle=function(x){var T=this.messageQueue;if(T.count()===0){x();return}T.once("idle",x)},I.prototype.send=function(x){x.ackRequired&&this.messageQueue.push(x),u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(x.message)),x.sendAttempted=!0,this.transport.send(x.message)},I.prototype.getTransport=function(){return this.transport},I.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},I.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},I.prototype.finish=function(){var x=this.transport;this.onceIdle(function(){x.disconnect()})},I}(c.default);e.default=d},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(0)),l=i.__importStar(t(2)),c=i.__importDefault(t(26)),u=i.__importDefault(t(8)),f=i.__importDefault(t(3)),m=i.__importDefault(t(10)),E=i.__importDefault(t(5)),O="web_socket";function d(x){return!!x.on}var A=function(x){i.__extends(T,x);function T(S,w,p){var y=x.call(this,S,w,p)||this;return y.shortName=O,p.heartbeats=o.default.Config.useProtocolHeartbeats,y.wsHost=u.default.getHost(p.options,p.host,!0),y}return T.isAvailable=function(){return!!o.default.Config.WebSocket},T.prototype.createWebSocket=function(S,w){var p=0;if(w)for(var y in w)S+=(p++?"&":"?")+y+"="+w[y];return this.uri=S,new o.default.Config.WebSocket(S)},T.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},T.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),c.default.prototype.connect.call(this);var S=this,w=this.params,p=w.options,y=p.tls?"wss://":"ws://",g=y+this.wsHost+":"+u.default.getPort(p)+"/";f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+g),this.auth.getAuthParams(function(v,h){if(!S.isDisposed){var C="";for(var M in h)C+=" "+M+": "+h[M]+";";if(f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+C+" err: "+v),v){S.disconnect(v);return}var L=w.getConnectParams(h);try{var $=S.wsConnection=S.createWebSocket(g,L);$.binaryType=o.default.Config.binaryType,$.onopen=function(){S.onWsOpen()},$.onclose=function(H){S.onWsClose(H)},$.onmessage=function(H){S.onWsData(H.data)},$.onerror=function(H){S.onWsError(H)},d($)&&$.on("ping",function(){S.onActivity()})}catch(H){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),S.disconnect(H)}}})},T.prototype.send=function(S){var w=this.wsConnection;if(!w){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{w.send(m.default.serialize(S,this.params.format))}catch(y){var p="Exception from ws connection when trying to send: "+l.inspectError(y);f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new E.default(p,5e4,500))}},T.prototype.onWsData=function(S){f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+S.length+"; type = "+typeof S);try{this.onProtocolMessage(m.default.deserialize(S,this.format))}catch(w){f.default.logAction(f.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+w.stack)}},T.prototype.onWsOpen=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},T.prototype.onWsClose=function(S){var w,p;if(typeof S=="object"?(p=S.code,w=S.wasClean||p===1e3):(p=S,w=p==1e3),delete this.wsConnection,w){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var y=new E.default("Websocket closed",80003,400);this.finish("disconnected",y)}else{var g="Unclean disconnection of WebSocket ; code = "+p,y=new E.default(g,80003,400);f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onWsClose()",g),this.finish("disconnected",y)}this.emit("disposed")},T.prototype.onWsError=function(S){var w=this;f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+S.message),o.default.Config.nextTick(function(){w.disconnect(Error(S.message))})},T.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var S=this.wsConnection;S&&(S.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(f.default.logAction(f.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!S)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");S.close()}))},T}(c.default);function I(x){return A.isAvailable()&&(x.supportedTransports[O]=A),A}e.default=I},function(s,e,t){"use strict";e.__esModule=!0,e.isSuccessCode=void 0;var i;(function(l){l[l.Success=200]="Success",l[l.NoContent=204]="NoContent",l[l.BadRequest=400]="BadRequest",l[l.Unauthorized=401]="Unauthorized",l[l.Forbidden=403]="Forbidden",l[l.RequestTimeout=408]="RequestTimeout",l[l.InternalServerError=500]="InternalServerError"})(i||(i={}));function o(l){return l>=i.Success&&l<i.BadRequest}e.isSuccessCode=o,e.default=i},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importStar(t(2)),l=i.__importDefault(t(34)),c=i.__importDefault(t(7)),u=i.__importDefault(t(3)),f=i.__importDefault(t(14)),m=i.__importDefault(t(5)),E=i.__importDefault(t(37)),O=i.__importDefault(t(22)),d=i.__importDefault(t(38)),A=function(){};function I(g){return g.clientId+":"+g.connectionId}function x(g){return g.channel.realtime.auth.clientId}function T(g){var v=g.channel.realtime,h=v.auth.clientId;return(!h||h==="*")&&v.connection.state==="connected"}function S(g,v,h){switch(g.state){case"attached":case"suspended":h();break;case"initialized":case"detached":case"detaching":case"attaching":g.attach(function(C){C?v(C):h()});break;default:v(m.default.fromValues(E.default.invalidStateError(g.state)))}}function w(g,v){if(g.isSynthesized()||v.isSynthesized())return g.timestamp>v.timestamp;var h=g.parseId(),C=v.parseId();return h.msgSerial===C.msgSerial?h.index>C.index:h.msgSerial>C.msgSerial}var p=function(g){i.__extends(v,g);function v(h){var C=g.call(this,h)||this;return C.channel=h,C.syncComplete=!1,C.members=new y(C),C._myMembers=new y(C),C.subscriptions=new c.default,C.pendingPresence=[],C}return v.prototype.enter=function(h,C){if(T(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,h,"enter",C)},v.prototype.update=function(h,C){if(T(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,h,"update",C)},v.prototype.enterClient=function(h,C,M){return this._enterOrUpdateClient(h,C,"enter",M)},v.prototype.updateClient=function(h,C,M){return this._enterOrUpdateClient(h,C,"update",M)},v.prototype._enterOrUpdateClient=function(h,C,M,L){var $=this;if(!L)if(typeof C=="function")L=C,C=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[h,C,M]);L=A}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence."+M+"Client()","channel = "+H.name+", client = "+(h||"(implicit) "+x(this)));var F=f.default.fromValues({action:M,data:C});h&&(F.clientId=h),f.default.encode(F,H.channelOptions,function(R){if(R){L(R);return}switch(H.state){case"attached":H.sendPresence(F,L);break;case"initialized":case"detached":H.attach();case"attaching":$.pendingPresence.push({presence:F,callback:L});break;default:R=new m.default("Unable to "+M+" presence channel while in "+H.state+" state",90001),R.code=90001,L(R)}})},v.prototype.leave=function(h,C){if(T(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,h,C)},v.prototype.leaveClient=function(h,C,M){if(!M)if(typeof C=="function")M=C,C=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[h,C]);M=A}var L=this.channel;if(!L.connectionManager.activeState()){M==null||M(L.connectionManager.getError());return}u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+h);var $=f.default.fromValues({action:"leave",data:C});switch(h&&($.clientId=h),L.state){case"attached":L.sendPresence($,M);break;case"attaching":this.pendingPresence.push({presence:$,callback:M});break;case"initialized":case"failed":{var H=new m.default("Unable to leave presence channel (incompatible state)",90001);M==null||M(H);break}default:M==null||M(E.default.invalidStateError(L.state))}},v.prototype.get=function(h,C){var M=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),h=L[0],C=L[1];var $=!h||("waitForSync"in h?h.waitForSync:!0);if(!C){if(this.channel.realtime.options.promises)return o.promisify(this,"get",L);C=A}function H(F){C(null,h?F.list(h):F.values())}if(this.channel.state==="suspended"){$?C(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}S(this.channel,C,function(){var F=M.members;$?F.waitSync(function(){H(F)}):H(F)})},v.prototype.history=function(h,C){if(u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),C===void 0)if(typeof h=="function")C=h,h=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);C=A}h&&h.untilAttach&&(this.channel.state==="attached"?(delete h.untilAttach,h.from_serial=this.channel.properties.attachSerial):C(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),l.default.prototype._history.call(this,h,C)},v.prototype.setPresence=function(h,C,M){u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+h.length+" participants; syncChannelSerial = "+M);var L,$,H=this.members,F=this._myMembers,R=[],P=this.channel.connectionManager.connectionId;C&&(this.members.startSync(),M&&($=M.match(/^[\w-]+:(.*)$/))&&(L=$[1]));for(var z=0;z<h.length;z++){var W=f.default.fromValues(h[z]);switch(W.action){case"leave":H.remove(W)&&R.push(W),W.connectionId===P&&!W.isSynthesized()&&F.remove(W);break;case"enter":case"present":case"update":H.put(W)&&R.push(W),W.connectionId===P&&F.put(W);break}}C&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(E.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var z=0;z<R.length;z++){var W=R[z];this.subscriptions.emit(W.action,W)}},v.prototype.onAttached=function(h){u.default.logAction(u.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+h),h?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var C=this.pendingPresence,M=C.length;if(M){this.pendingPresence=[];var L=[],$=O.default.create();u.default.logAction(u.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+M+" queued presence messages");for(var H=0;H<M;H++){var F=C[H];L.push(F.presence),$.push(F.callback)}this.channel.sendPresence(L,$)}},v.prototype.actOnChannelState=function(h,C,M){switch(h){case"attached":this.onAttached(C);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(M);break}},v.prototype.failPendingPresence=function(h){if(this.pendingPresence.length){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(h));for(var C=0;C<this.pendingPresence.length;C++)try{this.pendingPresence[C].callback(h)}catch(M){}this.pendingPresence=[]}},v.prototype._clearMyMembers=function(){this._myMembers.clear()},v.prototype._ensureMyMembersPresent=function(){var h=this,C=this.members,M=this._myMembers,L=function(F){if(F){var R="Presence auto-re-enter failed: "+F.toString(),P=new m.default(R,91004,400);u.default.logAction(u.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",R);var z=new d.default(h.channel.state,h.channel.state,!0,P);h.channel.emit("update",z)}};for(var $ in M.map)if(!($ in C.map)){var H=M.map[$];u.default.logAction(u.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete M.map[$]}},v.prototype._synthesizeLeaves=function(h){var C=this.subscriptions;o.arrForEach(h,function(M){var L=f.default.fromValues({action:"leave",connectionId:M.connectionId,clientId:M.clientId,data:M.data,encoding:M.encoding,timestamp:o.now()});C.emit("leave",L)})},v.prototype.on=function(){for(var h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];u.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,h)},v.prototype.off=function(){for(var h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];u.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,h)},v.prototype.subscribe=function(){for(var h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];var M=E.default.processListenerArgs(h),L=M[0],$=M[1],H=M[2],F=this.channel;if(!H){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[L,$]);H=A}if(F.state==="failed"){H(m.default.fromValues(E.default.invalidStateError("failed")));return}this.subscriptions.on(L,$),F.attach(H)},v.prototype.unsubscribe=function(){for(var h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];var M=E.default.processListenerArgs(h),L=M[0],$=M[1];this.subscriptions.off(L,$)},v}(l.default),y=function(g){i.__extends(v,g);function v(h){var C=g.call(this)||this;return C.presence=h,C.map={},C.syncInProgress=!1,C.residualMembers=null,C}return v.prototype.get=function(h){return this.map[h]},v.prototype.getClient=function(h){var C=this.map,M=[];for(var L in C){var $=C[L];$.clientId==h&&$.action!="absent"&&M.push($)}return M},v.prototype.list=function(h){var C=this.map,M=h&&h.clientId,L=h&&h.connectionId,$=[];for(var H in C){var F=C[H];F.action!=="absent"&&(M&&M!=F.clientId||L&&L!=F.connectionId||$.push(F))}return $},v.prototype.put=function(h){(h.action==="enter"||h.action==="update")&&(h=f.default.fromValues(h),h.action="present");var C=this.map,M=I(h);this.residualMembers&&delete this.residualMembers[M];var L=C[M];return L&&!w(h,L)?!1:(C[M]=h,!0)},v.prototype.values=function(){var h=this.map,C=[];for(var M in h){var L=h[M];L.action!="absent"&&C.push(L)}return C},v.prototype.remove=function(h){var C=this.map,M=I(h),L=C[M];return L&&!w(h,L)?!1:(this.syncInProgress?(h=f.default.fromValues(h),h.action="absent",C[M]=h):delete C[M],!0)},v.prototype.startSync=function(){var h=this.map,C=this.syncInProgress;u.default.logAction(u.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),this.syncInProgress||(this.residualMembers=o.copy(h),this.setInProgress(!0))},v.prototype.endSync=function(){var h=this.map,C=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),C){for(var M in h){var L=h[M];L.action==="absent"&&delete h[M]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var $ in this.residualMembers)delete h[$];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},v.prototype.waitSync=function(h){var C=this.syncInProgress;if(u.default.logAction(u.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+C),!C){h();return}this.once("sync",h)},v.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},v.prototype.setInProgress=function(h){u.default.logAction(u.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+h),this.syncInProgress=h,this.presence.syncComplete=!h},v}(c.default);e.default=p},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=t(56),l=t(32),c=t(13),u=i.__importDefault(t(4)),f=i.__importDefault(t(0)),m=function(){function E(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return E.prototype.isWordArray=function(O){return O!=null&&O.sigBytes!==void 0},E.prototype.isArrayBuffer=function(O){return O!=null&&O.constructor===ArrayBuffer},E.prototype.isTypedArray=function(O){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(O)},E.prototype.uint8ViewToBase64=function(O){for(var d="",A=this.base64CharSet,I=O.byteLength,x=I%3,T=I-x,S,w,p,y,g,v=0;v<T;v=v+3)g=O[v]<<16|O[v+1]<<8|O[v+2],S=(g&16515072)>>18,w=(g&258048)>>12,p=(g&4032)>>6,y=g&63,d+=A[S]+A[w]+A[p]+A[y];return x==1?(g=O[T],S=(g&252)>>2,w=(g&3)<<4,d+=A[S]+A[w]+"=="):x==2&&(g=O[T]<<8|O[T+1],S=(g&64512)>>10,w=(g&1008)>>4,p=(g&15)<<2,d+=A[S]+A[w]+A[p]+"="),d},E.prototype.base64ToArrayBuffer=function(O){for(var d=atob==null?void 0:atob(O),A=d.length,I=new Uint8Array(A),x=0;x<A;x++){var T=d.charCodeAt(x);I[x]=T}return I.buffer},E.prototype.isBuffer=function(O){return this.isArrayBuffer(O)||this.isWordArray(O)||this.isTypedArray(O)},E.prototype.toBuffer=function(O){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(O))return new Uint8Array(O);if(this.isTypedArray(O))return new Uint8Array(O.buffer);if(this.isWordArray(O)){for(var d=new ArrayBuffer(O.sigBytes),A=new Uint8Array(d),I=0;I<O.sigBytes;I++)A[I]=O.words[I>>>2]>>>24-I%4*8&255;return A}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},E.prototype.toArrayBuffer=function(O){return this.isArrayBuffer(O)?O:this.toBuffer(O).buffer},E.prototype.toWordArray=function(O){return this.isTypedArray(O)&&(O=O.buffer),this.isWordArray(O)?O:u.default.create(O)},E.prototype.base64Encode=function(O){return this.isWordArray(O)?c.stringify(O):this.uint8ViewToBase64(this.toBuffer(O))},E.prototype.base64Decode=function(O){return ArrayBuffer&&f.default.Config.atob?this.base64ToArrayBuffer(O):c.parse(O)},E.prototype.hexEncode=function(O){return o.stringify(this.toWordArray(O))},E.prototype.hexDecode=function(O){var d=o.parse(O);return ArrayBuffer?this.toArrayBuffer(d):d},E.prototype.utf8Encode=function(O){return TextEncoder?new TextEncoder().encode(O).buffer:l.parse(O)},E.prototype.utf8Decode=function(O){if(!this.isBuffer(O))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(O)?new TextDecoder().decode(O):(O=this.toWordArray(O),l.stringify(O))},E.prototype.bufferCompare=function(O,d){if(!O)return-1;if(!d)return 1;var A=this.toWordArray(O),I=this.toWordArray(d);A.clamp(),I.clamp();var x=A.sigBytes-I.sigBytes;if(x!=0)return x;for(var T=A.words,S=I.words,w=0;w<T.length;w++)if(x=T[w]-S[w],x!=0)return x;return 0},E.prototype.byteLength=function(O){return this.isArrayBuffer(O)||this.isTypedArray(O)?O.byteLength:this.isWordArray(O)?O.sigBytes:-1},E.prototype.typedArrayToBuffer=function(O){return O.buffer},E}();e.default=new m},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return i.enc.Hex})},function(s,e,t){"use strict";t.r(e);var i=t(4),o=t.n(i),l=t(13),c=t.n(l),u=t(21),f=t.n(u),m=t(0),E=t.n(m),O=t(3),d=t.n(O),A=function(){var I="aes",x=256,T="cbc",S=16,w=4,p=4294967296,y=2147483648,g;if(E.a.getRandomWordArray)g=E.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&E.a.getRandomValues){var v=new Uint32Array(w);g=function(R,P){var z=R/4,W=z==w?v:new Uint32Array(z);E.a.getRandomValues(W,function(Z){P(Z,E.a.BufferUtils.toWordArray(W))})}}else g=function(R,P){d.a.logAction(d.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var z=R/4,W=new Array(z),Z=0;Z<z;Z++)W[Z]=Math.floor(Math.random()*p)-y;P(null,o.a.create(W))};function h(R){return R+S&-S}function C(R){if(R.algorithm==="aes"&&R.mode==="cbc"){if(R.keyLength===128||R.keyLength===256)return;throw new Error("Unsupported key length "+R.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function M(R){return R.replace("_","/").replace("-","+")}var L=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function $(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}$.CipherParams=H,$.getDefaultParams=function(R){var P;if(typeof R=="function"||typeof R=="string"){if(d.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof R=="function")$.generateRandomKey(function(W){R(null,$.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,$.getDefaultParams({key:R}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!R.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof R.key=="string"?P=Object(l.parse)(M(R.key)):P=E.a.BufferUtils.toWordArray(R.key);var z=new H;if(z.key=P,z.algorithm=R.algorithm||I,z.keyLength=P.words.length*(4*8),z.mode=R.mode||T,R.keyLength&&R.keyLength!==z.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+R.keyLength+" was specified, but the key actually has length "+z.keyLength);return C(z),z},$.generateRandomKey=function(R,P){arguments.length==1&&typeof R=="function"&&(P=R,R=void 0),g((R||x)/8,P)},$.getCipher=function(R){var P=R instanceof H?R:$.getDefaultParams(R);return{cipherParams:P,cipher:new F(P,w,R.iv)}};function F(R,P,z){this.algorithm=R.algorithm+"-"+String(R.keyLength)+"-"+R.mode,this.cjsAlgorithm=R.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=E.a.BufferUtils.toWordArray(R.key),z&&(this.iv=E.a.BufferUtils.toWordArray(z).clone()),this.blockLengthWords=P}return F.prototype.encrypt=function(R,P){d.a.logAction(d.a.LOG_MICRO,"CBCCipher.encrypt()",""),R=E.a.BufferUtils.toWordArray(R);var z=R.sigBytes,W=h(z),Z=this,te=function(){Z.getIv(function(Y,G){if(Y){P(Y);return}var N=Z.encryptCipher.process(R.concat(L[W-z])),U=G.concat(N);P(null,U)})};this.encryptCipher?te():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),te()):g(S,function(Y,G){if(Y){P(Y);return}Z.encryptCipher=f.a.algo[Z.cjsAlgorithm].createEncryptor(Z.key,{iv:G}),Z.iv=G,te()})},F.prototype.decrypt=function(R){d.a.logAction(d.a.LOG_MICRO,"CBCCipher.decrypt()",""),R=E.a.BufferUtils.toWordArray(R);var P=this.blockLengthWords,z=R.words,W=o.a.create(z.slice(0,P)),Z=o.a.create(z.slice(P)),te=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),Y=te.process(Z),G=te.finalize();return te.reset(),G&&G.sigBytes&&Y.concat(G),Y},F.prototype.getIv=function(R){if(this.iv){var P=this.iv;this.iv=null,R(null,P);return}var z=this;g(S,function(W,Z){if(W){R(W);return}R(null,z.encryptCipher.process(Z))})},$}();e.default=A},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(){var o=i,l=o.lib,c=l.WordArray,u=o.enc,f=u.Utf16=u.Utf16BE={stringify:function(E){for(var O=E.words,d=E.sigBytes,A=[],I=0;I<d;I+=2){var x=O[I>>>2]>>>16-I%4*8&65535;A.push(String.fromCharCode(x))}return A.join("")},parse:function(E){for(var O=E.length,d=[],A=0;A<O;A++)d[A>>>1]|=E.charCodeAt(A)<<16-A%2*16;return c.create(d,O*2)}};u.Utf16LE={stringify:function(E){for(var O=E.words,d=E.sigBytes,A=[],I=0;I<d;I+=2){var x=m(O[I>>>2]>>>16-I%4*8&65535);A.push(String.fromCharCode(x))}return A.join("")},parse:function(E){for(var O=E.length,d=[],A=0;A<O;A++)d[A>>>1]|=m(E.charCodeAt(A)<<16-A%2*16);return c.create(d,O*2)}};function m(E){return E<<8&4278255360|E>>>8&16711935}}(),i.enc.Utf16})},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(28))})(this,function(i){return function(o){var l=i,c=l.lib,u=c.CipherParams,f=l.enc,m=f.Hex,E=l.format,O=E.Hex={stringify:function(d){return d.ciphertext.toString(m)},parse:function(d){var A=m.parse(d);return u.create({ciphertext:A})}}}(),i.format.Hex})},function(s,e,t){(function(i,o){s.exports=e=o(t(6),t(13),t(61),t(27),t(28))})(this,function(i){return function(){var o=i,l=o.lib,c=l.BlockCipher,u=o.algo,f=[],m=[],E=[],O=[],d=[],A=[],I=[],x=[],T=[],S=[];(function(){for(var y=[],g=0;g<256;g++)g<128?y[g]=g<<1:y[g]=g<<1^283;for(var v=0,h=0,g=0;g<256;g++){var C=h^h<<1^h<<2^h<<3^h<<4;C=C>>>8^C&255^99,f[v]=C,m[C]=v;var M=y[v],L=y[M],$=y[L],H=y[C]*257^C*16843008;E[v]=H<<24|H>>>8,O[v]=H<<16|H>>>16,d[v]=H<<8|H>>>24,A[v]=H;var H=$*16843009^L*65537^M*257^v*16843008;I[C]=H<<24|H>>>8,x[C]=H<<16|H>>>16,T[C]=H<<8|H>>>24,S[C]=H,v?(v=M^y[y[y[$^M]]],h^=y[y[h]]):v=h=1}})();var w=[0,1,2,4,8,16,32,64,128,27,54],p=u.AES=c.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var g=this._keyPriorReset=this._key,v=g.words,h=g.sigBytes/4,C=this._nRounds=h+6,M=(C+1)*4,L=this._keySchedule=[],$=0;$<M;$++)$<h?L[$]=v[$]:(y=L[$-1],$%h?h>6&&$%h==4&&(y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255]):(y=y<<8|y>>>24,y=f[y>>>24]<<24|f[y>>>16&255]<<16|f[y>>>8&255]<<8|f[y&255],y^=w[$/h|0]<<24),L[$]=L[$-h]^y);for(var H=this._invKeySchedule=[],F=0;F<M;F++){var $=M-F;if(F%4)var y=L[$];else var y=L[$-4];F<4||$<=4?H[F]=y:H[F]=I[f[y>>>24]]^x[f[y>>>16&255]]^T[f[y>>>8&255]]^S[f[y&255]]}}},encryptBlock:function(y,g){this._doCryptBlock(y,g,this._keySchedule,E,O,d,A,f)},decryptBlock:function(y,g){var v=y[g+1];y[g+1]=y[g+3],y[g+3]=v,this._doCryptBlock(y,g,this._invKeySchedule,I,x,T,S,m);var v=y[g+1];y[g+1]=y[g+3],y[g+3]=v},_doCryptBlock:function(y,g,v,h,C,M,L,$){for(var H=this._nRounds,F=y[g]^v[0],R=y[g+1]^v[1],P=y[g+2]^v[2],z=y[g+3]^v[3],W=4,Z=1;Z<H;Z++){var te=h[F>>>24]^C[R>>>16&255]^M[P>>>8&255]^L[z&255]^v[W++],Y=h[R>>>24]^C[P>>>16&255]^M[z>>>8&255]^L[F&255]^v[W++],G=h[P>>>24]^C[z>>>16&255]^M[F>>>8&255]^L[R&255]^v[W++],N=h[z>>>24]^C[F>>>16&255]^M[R>>>8&255]^L[P&255]^v[W++];F=te,R=Y,P=G,z=N}var te=($[F>>>24]<<24|$[R>>>16&255]<<16|$[P>>>8&255]<<8|$[z&255])^v[W++],Y=($[R>>>24]<<24|$[P>>>16&255]<<16|$[z>>>8&255]<<8|$[F&255])^v[W++],G=($[P>>>24]<<24|$[z>>>16&255]<<16|$[F>>>8&255]<<8|$[R&255])^v[W++],N=($[z>>>24]<<24|$[F>>>16&255]<<16|$[R>>>8&255]<<8|$[P&255])^v[W++];y[g]=te,y[g+1]=Y,y[g+2]=G,y[g+3]=N},keySize:256/32});o.AES=c._createHelper(p)}(),i.AES})},function(s,e,t){(function(i,o){s.exports=e=o(t(6))})(this,function(i){return function(o){var l=i,c=l.lib,u=c.WordArray,f=c.Hasher,m=l.algo,E=[];(function(){for(var T=0;T<64;T++)E[T]=o.abs(o.sin(T+1))*4294967296|0})();var O=m.MD5=f.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(T,S){for(var w=0;w<16;w++){var p=S+w,y=T[p];T[p]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var g=this._hash.words,v=T[S+0],h=T[S+1],C=T[S+2],M=T[S+3],L=T[S+4],$=T[S+5],H=T[S+6],F=T[S+7],R=T[S+8],P=T[S+9],z=T[S+10],W=T[S+11],Z=T[S+12],te=T[S+13],Y=T[S+14],G=T[S+15],N=g[0],U=g[1],K=g[2],j=g[3];N=d(N,U,K,j,v,7,E[0]),j=d(j,N,U,K,h,12,E[1]),K=d(K,j,N,U,C,17,E[2]),U=d(U,K,j,N,M,22,E[3]),N=d(N,U,K,j,L,7,E[4]),j=d(j,N,U,K,$,12,E[5]),K=d(K,j,N,U,H,17,E[6]),U=d(U,K,j,N,F,22,E[7]),N=d(N,U,K,j,R,7,E[8]),j=d(j,N,U,K,P,12,E[9]),K=d(K,j,N,U,z,17,E[10]),U=d(U,K,j,N,W,22,E[11]),N=d(N,U,K,j,Z,7,E[12]),j=d(j,N,U,K,te,12,E[13]),K=d(K,j,N,U,Y,17,E[14]),U=d(U,K,j,N,G,22,E[15]),N=A(N,U,K,j,h,5,E[16]),j=A(j,N,U,K,H,9,E[17]),K=A(K,j,N,U,W,14,E[18]),U=A(U,K,j,N,v,20,E[19]),N=A(N,U,K,j,$,5,E[20]),j=A(j,N,U,K,z,9,E[21]),K=A(K,j,N,U,G,14,E[22]),U=A(U,K,j,N,L,20,E[23]),N=A(N,U,K,j,P,5,E[24]),j=A(j,N,U,K,Y,9,E[25]),K=A(K,j,N,U,M,14,E[26]),U=A(U,K,j,N,R,20,E[27]),N=A(N,U,K,j,te,5,E[28]),j=A(j,N,U,K,C,9,E[29]),K=A(K,j,N,U,F,14,E[30]),U=A(U,K,j,N,Z,20,E[31]),N=I(N,U,K,j,$,4,E[32]),j=I(j,N,U,K,R,11,E[33]),K=I(K,j,N,U,W,16,E[34]),U=I(U,K,j,N,Y,23,E[35]),N=I(N,U,K,j,h,4,E[36]),j=I(j,N,U,K,L,11,E[37]),K=I(K,j,N,U,F,16,E[38]),U=I(U,K,j,N,z,23,E[39]),N=I(N,U,K,j,te,4,E[40]),j=I(j,N,U,K,v,11,E[41]),K=I(K,j,N,U,M,16,E[42]),U=I(U,K,j,N,H,23,E[43]),N=I(N,U,K,j,P,4,E[44]),j=I(j,N,U,K,Z,11,E[45]),K=I(K,j,N,U,G,16,E[46]),U=I(U,K,j,N,C,23,E[47]),N=x(N,U,K,j,v,6,E[48]),j=x(j,N,U,K,F,10,E[49]),K=x(K,j,N,U,Y,15,E[50]),U=x(U,K,j,N,$,21,E[51]),N=x(N,U,K,j,Z,6,E[52]),j=x(j,N,U,K,M,10,E[53]),K=x(K,j,N,U,z,15,E[54]),U=x(U,K,j,N,h,21,E[55]),N=x(N,U,K,j,R,6,E[56]),j=x(j,N,U,K,G,10,E[57]),K=x(K,j,N,U,H,15,E[58]),U=x(U,K,j,N,te,21,E[59]),N=x(N,U,K,j,L,6,E[60]),j=x(j,N,U,K,W,10,E[61]),K=x(K,j,N,U,C,15,E[62]),U=x(U,K,j,N,P,21,E[63]),g[0]=g[0]+N|0,g[1]=g[1]+U|0,g[2]=g[2]+K|0,g[3]=g[3]+j|0},_doFinalize:function(){var T=this._data,S=T.words,w=this._nDataBytes*8,p=T.sigBytes*8;S[p>>>5]|=128<<24-p%32;var y=o.floor(w/4294967296),g=w;S[(p+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S[(p+64>>>9<<4)+14]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,T.sigBytes=(S.length+1)*4,this._process();for(var v=this._hash,h=v.words,C=0;C<4;C++){var M=h[C];h[C]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360}return v},clone:function(){var T=f.clone.call(this);return T._hash=this._hash.clone(),T}});function d(T,S,w,p,y,g,v){var h=T+(S&w|~S&p)+y+v;return(h<<g|h>>>32-g)+S}function A(T,S,w,p,y,g,v){var h=T+(S&p|w&~p)+y+v;return(h<<g|h>>>32-g)+S}function I(T,S,w,p,y,g,v){var h=T+(S^w^p)+y+v;return(h<<g|h>>>32-g)+S}function x(T,S,w,p,y,g,v){var h=T+(w^(S|~p))+y+v;return(h<<g|h>>>32-g)+S}l.MD5=f._createHelper(O),l.HmacMD5=f._createHmacHelper(O)}(Math),i.MD5})},function(s,e,t){"use strict";var i;e.__esModule=!0;var o=t(1),l=o.__importDefault(t(0)),c=o.__importStar(t(2)),u=o.__importDefault(t(8)),f=o.__importDefault(t(5)),m=o.__importDefault(t(17)),E=o.__importDefault(t(15)),O=o.__importDefault(t(20)),d=o.__importDefault(t(3)),A=t(29);function I(S){var w=S.statusCode;return w===408&&!S.code||w===400&&!S.code||w>=500&&w<=504}function x(S){var w=S.connection,p=w&&w.connectionManager.host;return p?[p].concat(u.default.getFallbackHosts(S.options)):u.default.getHosts(S.options)}var T=(i=function(){function S(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=x,l.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(w,p,y,g,v,h,C){var M=E.default.createRequest(y,g,v,h,O.default.REQ_SEND,p&&p.options.timeouts,w);return M.once("complete",C),M.exec(),M},this.checkConnectivity=function(w){var p=u.default.internetUpUrl;d.default.logAction(d.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+p),this.doUri(m.default.Get,null,p,null,null,null,function(y,g){var v,h=!y&&((v=g)===null||v===void 0?void 0:v.replace(/\n/,""))=="yes";d.default.logAction(d.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+h),w(null,h)})}):l.default.Config.jsonpSupported&&(this.Request=function(w,p,y,g,v,h,C){var M=A.createRequest(y,g,v,h,O.default.REQ_SEND,p&&p.options.timeouts,w);return M.once("complete",C),l.default.Config.nextTick(function(){M.exec()}),M},this.checkConnectivity=function(w){var p=this,y=u.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(w);return}this.checksInProgress=[w],d.default.logAction(d.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+y);var g=new A.Request("isTheInternetUp",y,null,null,null,O.default.REQ_SEND,u.default.TIMEOUTS);g.once("complete",function(v,h){var C=!v&&h;d.default.logAction(d.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+C);for(var M=0;M<p.checksInProgress.length;M++)p.checksInProgress[M](null,C);p.checksInProgress=null}),l.default.Config.nextTick(function(){g.exec()})})}return S.prototype.do=function(w,p,y,g,v,h,C){var M=this,L=typeof y=="function"?y:function(R){return p.baseUri(R)+y},$=p._currentFallback;if($)if($.validUntil>c.now()){if(!this.Request){C==null||C(new f.default("Request invoked before assigned to",null,500));return}this.Request(w,p,L($.host),g,h,v,function(R){for(var P=[],z=1;z<arguments.length;z++)P[z-1]=arguments[z];if(R&&I(R)){p._currentFallback=null,M.do(w,p,y,g,v,h,C);return}C==null||C.apply(void 0,o.__spreadArray([R],P))});return}else p._currentFallback=null;var H=x(p);if(H.length===1){this.doUri(w,p,L(H[0]),g,v,h,C);return}var F=function(R,P){var z=R.shift();M.doUri(w,p,L(z),g,v,h,function(W){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];if(W&&I(W)&&R.length){F(R,!0);return}P&&(p._currentFallback={host:z,validUntil:c.now()+p.options.timeouts.fallbackRetryTimeout}),C==null||C.apply(void 0,o.__spreadArray([W],Z))})};F(H)},S.prototype.doUri=function(w,p,y,g,v,h,C){if(!this.Request){C(new f.default("Request invoked before assigned to",null,500));return}this.Request(w,p,y,g,h,v,C)},S}(),i.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],i.methodsWithoutBody=[m.default.Get,m.default.Delete],i.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],i);e.default=T},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(40)),l=i.__importStar(t(2)),c=l.getGlobalObject();function u(){var O=c.location;return!c.WebSocket||!O||!O.origin||O.origin.indexOf("http")>-1}var f=c.navigator&&c.navigator.userAgent.toString(),m=c.location&&c.location.href,E={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:m,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:c.WebSocket,xhrSupported:c.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:u(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!c.TextDecoder,preferBinary:!1,ArrayBuffer:c.ArrayBuffer,atob:c.atob,nextTick:typeof c.setImmediate!="undefined"?c.setImmediate.bind(c):function(O){setTimeout(O,0)},addEventListener:c.addEventListener,inspect:JSON.stringify,stringByteSize:function(O){return c.TextDecoder&&new c.TextEncoder().encode(O).length||O.length},TextEncoder:c.TextEncoder,TextDecoder:c.TextDecoder,Promise:c.Promise,getRandomValues:function(O){if(O!==void 0)return function(d,A){O.getRandomValues(d),A&&A(null)}}(c.crypto||msCrypto)};e.default=E},function(s,e,t){"use strict";(function(i){e.__esModule=!0;var o=t(1),l=o.__importStar(t(2)),c="ablyjs-storage-test",u=function(){function f(){try{i.sessionStorage.setItem(c,c),i.sessionStorage.removeItem(c),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{i.localStorage.setItem(c,c),i.localStorage.removeItem(c),this.localSupported=!0}catch(m){this.localSupported=!1}}return f.prototype.get=function(m){return this._get(m,!1)},f.prototype.getSession=function(m){return this._get(m,!0)},f.prototype.remove=function(m){return this._remove(m,!1)},f.prototype.removeSession=function(m){return this._remove(m,!0)},f.prototype.set=function(m,E,O){return this._set(m,E,O,!1)},f.prototype.setSession=function(m,E,O){return this._set(m,E,O,!0)},f.prototype._set=function(m,E,O,d){var A={value:E};return O&&(A.expires=l.now()+O),this.storageInterface(d).setItem(m,JSON.stringify(A))},f.prototype._get=function(m,E){if(E&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!E&&!this.localSupported)throw new Error("Local Storage not supported");var O=this.storageInterface(E).getItem(m);if(!O)return null;var d=JSON.parse(O);return d.expires&&d.expires<l.now()?(this.storageInterface(E).removeItem(m),null):d.value},f.prototype._remove=function(m,E){return this.storageInterface(E).removeItem(m)},f.prototype.storageInterface=function(m){return m?i.sessionStorage:i.localStorage},f}();e.default=new u}).call(this,t(12))},function(s,e,t){"use strict";e.__esModule=!0;var i=t(1),o=i.__importDefault(t(66)),l={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};e.default=l},function(s,e,t){"use strict";e.__esModule=!0;var i;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(i||(i={})),e.default=i},function(s,e,t){"use strict";t.r(e);var i=t(29),o=t.n(i),l=t(2),c=t(0),u=t.n(c),f=t(11),m=t.n(f),E=t(15),O=t.n(E),d=function(S){var w="xhr_polling";function p(y,g,v){v.stream=!1,m.a.call(this,y,g,v),this.shortName=w}return l.inherits(p,m.a),p.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.allowComet},p.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(y,g,v,h,C){return O.a.createRequest(y,g,v,h,C,this.timeouts)},typeof S!="undefined"&&p.isAvailable()&&(S.supportedTransports[w]=p),p},A=d,I=function(S){var w="xhr_streaming";function p(y,g,v){m.a.call(this,y,g,v),this.shortName=w}return l.inherits(p,m.a),p.isAvailable=function(){return u.a.Config.xhrSupported&&u.a.Config.streamingSupported&&u.a.Config.allowComet},p.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(y,g,v,h,C){return O.a.createRequest(y,g,v,h,C,this.timeouts)},typeof S!="undefined"&&p.isAvailable()&&(S.supportedTransports[w]=p),p},x=I,T=e.default=[o.a,A,x]}]).default})});k();k();var zi=(y=>(y.MEETING_START="meeting.start",y.MEETING_LEAVE="meeting.leave",y.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",y.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",y.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",y.MEETING_PARTICIPANT_LEFT="meeting.participant-left",y.MEETING_JOIN="meeting.join",y.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",y.MEETING_HOST_CHANGE="meeting.host-change",y.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",y.MEETING_DEVICES_CHANGE="meeting.devices-change",y.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",y.MEETING_STATE_UPDATE="meeting.state-update",y.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",y.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",y.MY_PARTICIPANT_UPDATED="my-participant.update",y.MY_PARTICIPANT_LEFT="my-participant.left",y.MY_PARTICIPANT_JOINED="my-participant.joined",y.MEETING_KICK_PARTICIPANT="meeting.kick-participant",y.DESTROY="destroy",y))(zi||{}),Vi=(c=>(c.FRAME_LOAD="frame.load",c.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",c.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",c.FRAME_LOCALE_UPDATE="frame.locales-update",c.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",c.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",c))(Vi||{}),Ms=(u=>(u.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",u.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",u.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",u.TOGGLE_CAM="meeting-controls.toggle-cam",u.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",u.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",u.HANG_UP="hang-up",u))(Ms||{}),fr=(A=>(A.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",A.REALTIME_HOST_CHANGE="realtime.host-change",A.REALTIME_HOST_AVAILABLE="realtime.host-available",A.REALTIME_NO_HOST_AVAILABLE="realtime.no-host-available",A.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",A.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",A.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",A.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",A.REALTIME_GATHER="realtime.gather",A.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",A.REALTIME_SET_AVATAR="realtime.set-avatar",A.REALTIME_DRAWING_CHANGE="realtime.drawing-change",A.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",A))(fr||{});var Rs=(E=>(E[E.MEETING_FAILED=-1]="MEETING_FAILED",E[E.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",E[E.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",E[E.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",E[E.MEETING_CONNECTING=3]="MEETING_CONNECTING",E[E.MEETING_CONNECTED=4]="MEETING_CONNECTED",E[E.MEETING_RECONNECT=5]="MEETING_RECONNECT",E[E.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",E[E.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",E[E.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",E))(Rs||{}),xs=(c=>(c.JOINED="participant.joined",c.LOCAL_JOINED="participant.local-joined",c.LEFT="participant.left",c.LOCAL_LEFT="participant.local-left",c.LOCAL_UPDATED="participant.updated",c.LIST_UPDATED="participant.list-updated",c))(xs||{}),ji=(u=>(u[u.NOT_AVAILABLE=0]="NOT_AVAILABLE",u[u.GOOD=1]="GOOD",u[u.BAD=2]="BAD",u[u.POOR=3]="POOR",u[u.DISCONNECTED=4]="DISCONNECTED",u[u.RECONNECTING=5]="RECONNECTING",u[u.LOST_CONNECTION=6]="LOST_CONNECTION",u))(ji||{}),Uu=(c=>(c.NO_CAM="devices.no-cam",c.NO_DEVICES="devices.no-devices",c.DEVICES_BLOCKED="devices.blocked",c.DEVICES_CAM_BLOCKED="devices.cam-blocked",c.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",c.DEVICES_UNKNOWN_ERROR="devices.unknown-error",c))(Uu||{});k();k();k();k();var Rt=(o,l,c,...u)=>Le(void 0,[o,l,c,...u],function*(s,e,t,i={}){let f=yield fetch(s,{method:e,headers:fe({"Content-Type":"application/json"},i),body:t?JSON.stringify(t):null});if(!f.ok)throw f;try{return yield f.json()}catch(m){return f.ok}});k();var sh=Pn(Bu()),nt=class{constructor(e){this.debug=(0,sh.default)(e)}log(e,...t){this.debug(e,...t)}};k();k();var Gh=Pn(Wu());var Oe=class{constructor(e={}){this.subscribe=e=>{this.callbacks.push(e)};this.unsubscribe=e=>{this.callbacks=this.callbacks.filter(t=>t!==e)};this.publish=(...e)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,e).catch(i=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(e)}
            Error: ${i}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(e,t)=>new Promise((i,o)=>{try{let l=e(...t);i(l)}catch(l){o(l)}});let{logger:t,throttleTime:i}=e;this.logger=t!=null?t:new nt("@superviz/sdk/observer-helper"),this.throttle=i,this.callbacks=[],this.throttle&&(this.publish=(0,Gh.default)(this.publish,this.throttle))}};var hr=class{constructor(){this.observers={};this.subscribe=(e,t)=>{this.logger.log(`subscribed to ${e} event`),this.observers[e]||(this.observers[e]=new Oe({logger:this.logger})),this.observers[e].subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log(`unsubscribed from ${e} event`),this.observers[e]&&(this.observers[e].reset(),delete this.observers[e])};this.publish=(e,t)=>{e in this.observers&&this.observers[e].publish(t)}}};k();k();k();var Hh=Pn(Ds()),$u=class{setConfig(e){this.configuration=e}get(e,t){if(!this.configuration)throw new Error("configs is not available");return(0,Hh.get)(this.configuration,e,t)}},we=new $u;var vt=class{static createUrl(e,t,i={}){let o=new URL(t,e);return Object.keys(i).forEach(l=>o.searchParams.append(l,i[l])),o.toString()}static validateApiKey(e,t){let i="/user/checkapikey",o=this.createUrl(e,i);return Rt(o,"POST",{apiKey:t})}static fetchConfig(e,t){let i="/immersive-config",o=this.createUrl(e,i);return Rt(o,"POST",{apiKey:t})}static fetchLimits(e,t){return Le(this,null,function*(){let i="/user/check_limits",o=this.createUrl(e,i);return(yield Rt(o,"GET","",{apikey:t})).usage})}static fetchWaterMark(e,t){return Le(this,null,function*(){let i="/user/watermark",o=this.createUrl(e,i),{message:l}=yield Rt(o,"POST",{apiKey:t});return l})}static createAnnotations(e,t,i){return Le(this,null,function*(){let o="/annotations",l=this.createUrl(e,o);return Rt(l,"POST",fe({},i),{apikey:t})})}static updateComment(e,t,i,o){return Le(this,null,function*(){let l=`/comments/${i}`,c=this.createUrl(e,l);return Rt(c,"PUT",{text:o},{apikey:t})})}static createComment(e,t,i){return Le(this,null,function*(){let o="/comments",l=this.createUrl(e,o);return Rt(l,"POST",fe({},i),{apikey:t})})}static fetchAnnotation(e,t,i){return Le(this,null,function*(){let o="/annotations",l=this.createUrl(e,o,{roomId:i.roomId,url:i.url});return Rt(l,"GET",void 0,{apikey:t})})}static resolveAnnotation(e,t,i){return Le(this,null,function*(){let o=`/annotations/resolve/${i}`,l=this.createUrl(e,o);return Rt(l,"POST",{},{apikey:t})})}static deleteComment(e,t,i){return Le(this,null,function*(){let o=`/comments/${i}`,l=this.createUrl(e,o);return Rt(l,"DELETE",{},{apikey:t})})}static deleteAnnotation(e,t,i){return Le(this,null,function*(){let o=`/annotations/${i}`,l=this.createUrl(e,o);return Rt(l,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(e,t){return Le(this,null,function*(){let i=we.get("apiUrl"),o="/participants",l=this.createUrl(i,o);return Rt(l,"POST",fe({},t),{apikey:e})})}static sendActivity(e,t,i,o){return Le(this,null,function*(){let l="/activity",c=we.get("apiUrl"),u=we.get("roomId"),f=we.get("apiKey"),m=this.createUrl(c,l);return Rt(m,"POST",{groupId:t,groupName:i,meetingId:u,product:o,userId:e},{apikey:f})})}};k();var Ns=(t=>(t.GRID="grid",t.LIST="list",t))(Ns||{});k();var yn=class extends hr{constructor(){super(...arguments);this.isAttached=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let f=`${this.name} @ attach - params are required`;throw this.logger.log(f),new Error(f)}let{realtime:i,localParticipant:o,group:l,config:c,eventBus:u}=t;if(we.setConfig(c),this.realtime=i,this.localParticipant=o,this.group=l,this.eventBus=u,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start()};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached}`);return}this.logger.log("detached"),this.destroy(),this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1,Object.keys(this.observers).forEach(t=>this.unsubscribe(t))}}};k();var zu=(i=>(i.presence3dMatterport="presence3d",i.presence3dAutodesk="presence3d",i.presence3dThreejs="presence3d",i))(zu||{});var Zi=class extends yn{constructor(t){super();this.sidebarOpen=!1;this.onFixedPin=t=>{document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:fe({},t),composed:!0,bubbles:!0}))};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),this.pinAdapter.setActive(this.sidebarOpen),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0}))};this.createAnnotation=i=>Le(this,[i],function*({detail:t}){try{let{position:o,text:l}=t,{url:c}=this,u=yield vt.createAnnotations(we.get("apiUrl"),we.get("apiKey"),{roomId:we.get("roomId"),position:JSON.stringify(o),url:c,userId:this.localParticipant.id}),f=yield this.createComment(u.uuid,l);this.addAnnotation([Xe(fe({},u),{comments:[f]})]),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:u.uuid},composed:!0,bubbles:!0}))}catch(o){this.logger.log("error when creating annotation",o)}});this.deleteAnnotation=i=>Le(this,[i],function*({detail:t}){try{let{uuid:o}=t;yield vt.deleteAnnotation(we.get("apiUrl"),we.get("apiKey"),o);let l=this.annotations.filter(c=>c.uuid!==o);this.updateAnnotationList(l),this.pinAdapter.removeAnnotationPin(o)}catch(o){this.logger.log("error when deleting annotation",o)}});this.updateComment=i=>Le(this,[i],function*({detail:t}){try{let{uuid:o,text:l}=t;yield vt.updateComment(we.get("apiUrl"),we.get("apiKey"),o,l);let c=this.annotations.map(u=>Object.assign({},u,{comments:u.comments.map(f=>f.uuid===o?Object.assign({},f,{text:l}):f)}));this.updateAnnotationList(c)}catch(o){this.logger.log("error when updating comment",o)}});this.resolveAnnotation=i=>Le(this,[i],function*({detail:t}){try{let{uuid:o}=t;yield vt.resolveAnnotation(we.get("apiUrl"),we.get("apiKey"),o);let l=this.annotations.map(c=>c.uuid===o?Object.assign({},c,{resolved:!0}):c);this.updateAnnotationList(l)}catch(o){this.logger.log("error when resolve annotation",o)}});this.deleteComment=i=>Le(this,[i],function*({detail:t}){try{let{uuid:o}=t;yield vt.deleteComment(we.get("apiUrl"),we.get("apiKey"),o);let l=this.annotations.findIndex(f=>f.comments.some(m=>m.uuid===o));if(l===-1)return;let c=this.annotations[l];c.comments=c.comments.filter(f=>f.uuid!==o);let u=[...this.annotations.slice(0,l),c,...this.annotations.slice(l+1)];this.updateAnnotationList(u)}catch(o){this.logger.log("error when deleting comment",o)}});this.onAnnotationListUpdate=t=>{this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)};this.name="comments",this.logger=new nt("@superviz/sdk/comments-component"),this.annotations=[],this.pinAdapter=t}start(){this.url=window.location.href,this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),document.body.appendChild(this.element),this.button=document.createElement("superviz-comments-button"),document.body.appendChild(this.button),this.fetchAnnotations(),this.waterMarkState(),this.addListeners()}destroy(){this.destroyListeners(),document.body.removeChild(this.element),this.element=void 0,this.pinAdapter.destroy()}addListeners(){this.button.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("toggle",this.toggleAnnotationSidebar),this.element.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onFixedPin)}destroyListeners(){this.button.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("toggle",this.toggleAnnotationSidebar),this.element.removeEventListener("create-annotation",this.createAnnotation),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:t})=>{this.createComment(t.uuid,t.text,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onFixedPin)}createComment(t,i,o=!1){return Le(this,null,function*(){try{let l=yield vt.createComment(we.get("apiUrl"),we.get("apiKey"),{annotationId:t,userId:this.localParticipant.id,text:i});return o&&this.addComment(t,l),l}catch(l){this.logger.log("error when creating comment",l)}})}addAnnotation(t){let i=[...this.annotations,...t];this.updateAnnotationList(i)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,i){let o=this.annotations.findIndex(u=>u.uuid===t);if(o===-1)return;let l=this.annotations[o];l.comments=[...l.comments,i];let c=[...this.annotations.slice(0,o),l,...this.annotations.slice(o+1)];this.updateAnnotationList(c)}fetchAnnotations(){return Le(this,null,function*(){try{let t=yield vt.fetchAnnotation(we.get("apiUrl"),we.get("apiKey"),{roomId:we.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return Le(this,null,function*(){try{let t=yield vt.fetchWaterMark(we.get("apiUrl"),we.get("apiKey")),i=["all","powered-by","powered-by"].includes(t);this.element.waterMarkStatus(i)}catch(t){this.logger.log("error when fetching waterMark",t)}})}};k();k();var Fs=(t=>(t.ADD="add",t.SHOW="show",t))(Fs||{});var qi=class{constructor(e){this.divWrapperReplacementInterval=null;this.annotationSelected=({detail:e})=>{let{uuid:t}=e;if(!t)return;this.pins.forEach(o=>{o.id!=="superviz-temporary-pin"&&o.removeAttribute("active")});let i=this.pins.get(t);!i||i.setAttribute("active","")};this.onClick=e=>{let{x:t,y:i}=e,o=this.divWrapper.getBoundingClientRect(),l=t-o.x,c=i-o.y;this.onPinFixedObserver.publish({x:l,y:c,type:"canvas"}),this.createTemporaryPin({x:l,y:c,type:"canvas"})};this.onMouseMove=e=>{let{x:t,y:i}=e;this.mouseElement||(this.mouseElement=this.createMouseElement()),this.mouseElement.setAttribute("position",JSON.stringify({x:t,y:i}))};this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.canvas.style.cursor="default"};this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())};if(this.logger=new nt("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvasId=e,this.canvas=document.getElementById(e),this.isActive=!1,this.pins=new Map,!this.canvas){let t=`Canvas with id ${e} not found`;throw this.logger.log(t),new Error(t)}document.body.style.position="relative",this.onPinFixedObserver=new Oe({logger:this.logger}),this.divWrapper=this.createDivWrapper(),this.annotations=[]}destroy(){this.removeListeners(),this.mouseElement=null,this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}setActive(e){if(this.isActive=e,this.canvas.style.cursor=e?"none":"default",this.isActive){this.addListeners(),this.renderAnnotationsPins();return}this.removeAnnotationsPins(),this.removeListeners()}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,this.isActive&&this.renderAnnotationsPins()}removeAnnotationPin(e){let t=this.pins.get(e);!t||(t.remove(),this.pins.delete(e))}createTemporaryPin(e){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttributeNode(document.createAttribute("active")),t.style.pointerEvents="auto"),t.setAttribute("position",JSON.stringify(e)),this.divWrapper.appendChild(t),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseout",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("select-annotation",this.annotationSelected)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseout",this.onMouseLeave),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("select-annotation",this.annotationSelected)}createMouseElement(){let e=document.createElement("superviz-comments-annotation-pin");return e.setAttribute("type","add"),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(e),this.canvas.style.cursor="none",e}createDivWrapper(){let e=this.canvas.getBoundingClientRect(),t=document.createElement("div");return this.canvas.parentElement.style.position="relative",t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let i=this.canvas.getBoundingClientRect();t.style.top=`${i.top}px`,t.style.left=`${i.left}px`,t.style.width=`${i.width}px`,t.style.height=`${i.height}px`},1)),this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){this.annotations.forEach(e=>{let t=JSON.parse(e.position);if(t.type!=="canvas"||e.resolved||this.pins.has(e.uuid))return;let{x:i,y:o}=t,l=document.createElement("superviz-comments-annotation-pin");l.setAttribute("type","show"),l.setAttribute("annotation",JSON.stringify(e)),l.setAttribute("position",JSON.stringify({x:i,y:o})),l.style.pointerEvents="auto",this.divWrapper.appendChild(l),this.pins.set(e.uuid,l)})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}};k();var Ku=Pn(Ds());k();var bn=Pn(Wh()),Qi=class{constructor(){this.browser=bn.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(bn.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(bn.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(bn.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(bn.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(bn.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(bn.default.PLATFORMS_MAP.mobile)||this.browser.is(bn.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(bn.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};k();var Us=class{constructor(){this.updateMeetingConnectionStatus=e=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=e,this.connectionStatusObserver.publish(e),this.logger.log("CONNECTION STATUS CHANGE",e)};this.onUpdateBrowserOnlineStatus=e=>{let{type:t}=e;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new nt("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new Oe({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};k();k();var Bs=class{build(e,t,i,o={},l={}){let c=document.querySelector(`#${e}`),u=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(o).forEach(([f,m])=>{u.searchParams.set(f,m)}),Object.entries(l).forEach(([f,m])=>{this.element.setAttribute(f,m)}),this.element.src=u.toString(),this.element.id=i,c.appendChild(this.element),this.wrapperId=e}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let e=document.querySelector(`#${this.wrapperId}`);!!e&&!!e.querySelector(`#${this.element.id}`)&&e.removeChild(this.element),this.wrapperId=null,this.element=null}};k();var ks=class{constructor(e){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(e,t={})=>{this.logger.log("MessageBridge","Posting message to frame",e,t),this.contentWindow.postMessage({type:e,data:t},this.allowedOrigins)};this.listen=(e,t)=>{this.observers[e]||(this.observers[e]=new Oe({logger:this.logger})),this.observers[e].subscribe(t)};this.onReceiveMessage=e=>{let{type:t,data:i,source:o}=e.data;if(this.sourceBlockList.includes(o)||this.originBlockList.includes(e.origin))return;let l=!!t,c=!this.domains.length||this.domains.includes(e.origin),u=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${e.type}
        ORIGIN: ${e.origin}
        DATA: ${JSON.stringify(e.data)} `),!l||!c||!u){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(i)};let{contentWindow:t,domains:i=[],allowedOrigins:o="*",sourceBlockList:l=[],logger:c}=e;if(this.logger=c,this.domains=i,this.allowedOrigins=o,this.sourceBlockList.push(...l),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([e,t])=>{t.reset(),delete this.observers[e]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};var $h="sv-video-frame",Xi=class{constructor(e){this.logger=new nt("@superviz/sdk/video-conference-manager");this.frameStateObserver=new Oe({logger:this.logger});this.frameSizeObserver=new Oe({logger:this.logger});this.waitingForHostObserver=new Oe({logger:this.logger});this.realtimeEventsObserver=new Oe({logger:this.logger});this.sameAccountErrorObserver=new Oe({logger:this.logger});this.devicesObserver=new Oe({logger:this.logger});this.meetingStateObserver=new Oe({logger:this.logger});this.meetingConnectionObserver=new Oe({logger:this.logger});this.participantJoinedObserver=new Oe({logger:this.logger});this.participantLeftObserver=new Oe({logger:this.logger});this.participantListObserver=new Oe({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(e,t)=>{let i=e,o=t,l=["left","right","bottom","top"].includes(o),c=["left","right","center"].includes(i);return l||(o="right"),c||(i="right"),this.browserService.isMobileDevice?(o="bottom",{layoutPosition:i,camerasPosition:o}):(i==="left"&&o==="right"&&(i="right"),i==="right"&&o==="left"&&(i="left"),{layoutPosition:i,camerasPosition:o})};this.onFrameLoad=()=>{this.messageBridge=new ks({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors()};this.setFrameOffset=e=>{let t=e!=null?e:{};["top","bottom","left","right"].forEach(i=>{Object.keys(t).includes(i)||(t[i]=0)}),this.frameOffset=t};this.setCustomColors=()=>{!this.customColors||this.messageBridge.publish("frame.color-list-update",this.customColors)};this.setFrameStyle=e=>{let t=document.createElement("style"),{bottom:i,left:o,right:l,top:c}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${c}px;
        --superviz-offset-right: ${l}px;
        --superviz-offset-left: ${o}px;
        --superviz-offset-bottom: ${i}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${e}`)};this.onFrameDimensionsUpdate=({width:e,height:t})=>{let i=document.getElementById($h),{bottom:o,right:l,left:c,top:u}=this.frameOffset,f=this.isWaterMarkEnabled?40:0,m=`${e}px`,E=`${t+f}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${l}px - ${c}px)`),t>=window.innerHeight&&(E=`calc(100% - ${u}px - ${o}px)`),i.style.width=m,i.style.height=E,this.frameSizeObserver.publish({width:i.offsetWidth,height:i.offsetHeight})};this.onWindowResize=()=>{let{top:e,bottom:t,right:i,left:o}=this.frameOffset,{innerHeight:l,innerWidth:c}=window,u=l-e-t,f=c-i-o;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:u,width:f})};this.updateFrameLocale=()=>{var l,c;if(!this.frameLocale||!((l=this.frameLocale)!=null&&l.language)&&((c=this.frameLocale)==null?void 0:c.locales))return;let{language:e,locales:t}=this.frameLocale,i=t.map(u=>u==null?void 0:u.language),o=["en",...i];if(e&&!o.includes(e))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=e=>{this.participantJoinedObserver.publish(e)};this.onParticipantLeft=e=>{this.participantLeftObserver.publish(e)};this.onMeetingHostChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:e})};this.onMeetingKickParticipant=e=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:e})};this.onFollowParticipantDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:e})};this.onGoToDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:e})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:e})};this.onDrawingChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:e})};this.onTranscriptChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:e})};this.onSameAccountError=e=>{this.sameAccountErrorObserver.publish(e)};this.onDevicesChange=e=>{this.devicesObserver.publish(e)};this.meetingStateUpdate=e=>{this.meetingStateObserver.publish(e)};this.onConnectionStatusChange=e=>{this.meetingConnectionObserver.publish(e)};this.onWaitingForHostDidChange=e=>{this.waitingForHostObserver.publish(e)};this.onParticipantListUpdate=e=>{this.participantListObserver.publish(e)};var C,M,L,$;let{language:t,canUseCams:i,canUseChat:o,canUseScreenshare:l,canUseDefaultAvatars:c,canUseFollow:u,canUseGoTo:f,canUseGather:m,browserService:E,offset:O,canUseDefaultToolbar:d,locales:A,avatars:I,customColors:x,waterMark:T,layoutPosition:S,camerasPosition:w,skipMeetingSettings:p,devices:y,layoutMode:g}=e;this.browserService=E;let v=this.layoutModalsAndCamerasConfig(S,w),h=document.createElement("div");this.frameConfig={apiKey:we.get("apiKey"),apiUrl:we.get("apiUrl"),ablyKey:we.get("ablyKey"),debug:we.get("debug"),canUseFollow:u,canUseGoTo:f,canUseCams:i,canUseChat:o,canUseGather:m,canUseScreenshare:l,canUseDefaultAvatars:c,camerasPosition:(C=v.camerasPosition)!=null?C:"right",canUseDefaultToolbar:d,roomId:we.get("roomId"),devices:{audioInput:(M=y==null?void 0:y.audioInput)!=null?M:!0,audioOutput:(L=y==null?void 0:y.audioOutput)!=null?L:!0,videoInput:($=y==null?void 0:y.videoInput)!=null?$:!0},waterMark:T,layoutMode:g,skipMeetingSettings:p,layoutPosition:v.layoutPosition},this.customColors=x,h.classList.add("sv_video_wrapper"),h.id="sv-video-wrapper",document.body.appendChild(h),this.updateFrameState(1),this.bricklayer=new Bs,this.bricklayer.build(h.id,we.get("conferenceLayerUrl"),$h,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(O),this.setFrameStyle(v.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:A},this.meetingAvatars=I,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:["all","powered-by"].includes(this.frameConfig.waterMark)}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(e){e!==this.frameState&&(this.frameState=e,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[e])}start(e){this.messageBridge.publish("meeting.start",Xe(fe({},e),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var e,t;(e=this.messageBridge)==null||e.destroy(),(t=this.bricklayer)==null||t.destroy(),this.frameSizeObserver.destroy(),this.realtimeEventsObserver.destroy(),this.sameAccountErrorObserver.destroy(),this.devicesObserver.destroy(),this.meetingStateObserver.destroy(),this.meetingConnectionObserver.destroy(),this.participantJoinedObserver.destroy(),this.participantLeftObserver.destroy(),this.bricklayer=null,this.frameState=null}publishMessageToFrame(e,t){this.messageBridge.publish(e,t)}};var eo=class extends yn{constructor(t){super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.startVideo=()=>{var t,i,o,l,c,u,f,m,E,O,d,A,I,x,T,S,w,p,y,g,v,h,C,M;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseChat:!((i=this.params)!=null&&i.chatOff),canUseCams:!((o=this.params)!=null&&o.camsOff),canUseScreenshare:!((l=this.params)!=null&&l.screenshareOff),canUseDefaultAvatars:!!((c=this.params)!=null&&c.defaultAvatars)&&!((f=(u=this.localParticipant)==null?void 0:u.avatar)!=null&&f.model3DUrl),canUseGather:!!((m=this.params)!=null&&m.enableGather),canUseFollow:!!((E=this.params)!=null&&E.enableFollow),canUseGoTo:!!((O=this.params)!=null&&O.enableGoTo),canUseDefaultToolbar:(A=(d=this.params)==null?void 0:d.defaultToolbar)!=null?A:!0,camerasPosition:(I=this.params)==null?void 0:I.camerasPosition,devices:(x=this.params)==null?void 0:x.devices,skipMeetingSettings:(T=this.params)==null?void 0:T.skipMeetingSettings,browserService:this.browserService,offset:(S=this.params)==null?void 0:S.offset,locales:(p=(w=this.params)==null?void 0:w.locales)!=null?p:[],avatars:(g=(y=this.params)==null?void 0:y.avatars)!=null?g:[],customColors:(v=this.params)==null?void 0:v.customColors,layoutPosition:(h=this.params)==null?void 0:h.layoutPosition,layoutMode:(M=(C=this.params)==null?void 0:C.layoutMode)!=null?M:"list"},this.logger.log("video component @ start video",this.videoConfig),this.videoManager=new Xi(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video component @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video component @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video component @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video component @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange)};this.createParticipantFromAblyPresence=t=>{var i;return{id:t.clientId,color:this.realtime.getSlotColor((i=t.data)==null?void 0:i.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video component @ on connection status change",t);let i=[2,4,3,6];i.includes(t)&&this.realtime.freezeSync(!0),i.includes(this.connectionService.oldConnectionStatus)&&!i.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video component @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.detach()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video component @ on frame state change",t),t===2&&this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:we.get("roomId")})};this.onRealtimeEventFromFrame=({event:t,data:i})=>{this.logger.log("video component @ on realtime event from frame",t,i);let o={["realtime.host-change"]:l=>this.realtime.setHost(l),["realtime.gather"]:l=>this.realtime.setGather(l),["realtime.grid-mode-change"]:l=>this.realtime.setGridMode(l),["realtime.drawing-change"]:l=>{this.realtime.setDrawing(l)},["realtime.follow-participant"]:l=>{this.realtime.setFollowParticipant(l)},["meeting.kick-participant"]:l=>{this.realtime.setKickParticipant(l)},["realtime.transcript-change"]:l=>{this.realtime.setTranscript(l)},["realtime.go-to-participant"]:l=>{this.eventBus.publish("realtime.go-to-participant",l)}}[t](i);this.publish(t,i)};this.onParticipantJoined=t=>{if(this.logger.log("video component @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name});return}this.realtime.updateMyProperties({name:t.name})};this.onParticipantLeft=t=>{this.logger.log("video component @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.detach()};this.onParticipantListUpdate=t=>{this.logger.log("video component @ on participant list update",t),!(0,Ku.isEqual)(this.participantsOnMeeting,t)&&(this.publish("meeting.participant-list-update",t),this.participantsOnMeeting.length!==t.length&&this.publish("meeting.amount-of-participants-update",t.length),this.participantsOnMeeting=t)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video component @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.detach()};this.onKickLocalParticipant=()=>{this.logger.log("video component @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.onRoomInfoUpdated=t=>{this.logger.log("video component @ on room info updated",t);let{isGridModeEnable:i,followParticipantId:o,gather:l,drawing:c,transcript:u}=t;this.videoManager.publishMessageToFrame("realtime.grid-mode-change",i),this.videoManager.publishMessageToFrame("realtime.drawing-change",c),this.videoManager.publishMessageToFrame("realtime.follow-participant",o),this.videoManager.publishMessageToFrame("realtime.transcript-change",u),this.realtime.hostClientId===this.localParticipant.id&&l&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video component @ on participants did change",t);let i=Object.values(t).map(o=>({timestamp:o.timestamp,connectionId:o.connectionId,participantId:o.clientId,color:this.realtime.getSlotColor(o.data.slotIndex).name,name:o.data.name,isHost:this.realtime.hostClientId===o.clientId,avatar:o.data.avatar,type:o.data.type}));(0,Ku.isEqual)(this.participantToFrameList,i)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",i),this.participantToFrameList=i};this.onHostParticipantDidChange=t=>{this.logger.log("video component @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t==null?void 0:t.newHostParticipantId)};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video component @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video component @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.params=t,this.name="videoConference",this.logger=new nt(`@superviz/sdk/${"videoConference"}`),this.browserService=new Qi,this.connectionService=new Us,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){this.logger.log("video component @ start"),this.publish("meeting.start"),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){this.logger.log("video component @ destroy"),this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}};k();var to=class extends yn{constructor(t){super();this.divWrapperReplacementInterval=null;this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.onMyParticipantMouseMove=t=>{let i=this.divWrapper.getBoundingClientRect();this.realtime.updatePresenceMouse(Xe(fe({},this.localParticipant),{mousePositionX:t.x-i.x,mousePositionY:t.y-i.y,originalWidth:i.width,originalHeight:i.height,containerId:this.containerId,visible:!0}))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.values(t).forEach(i=>{var c;let o=(i==null?void 0:i.mousePositionX)&&this.presenceMouseElement,l=(i==null?void 0:i.id)===((c=this.localParticipant)==null?void 0:c.id);if(!(i!=null&&i.visible)){this.presenceMouseElement.removePresenceMouseParticipant(i.id);return}!l&&o&&this.presenceMouseElement.updatePresenceMouseParticipant(i)})};this.onMyParticipantMouseOut=()=>{this.realtime.updatePresenceMouse(fe({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=t=>{this.presenceMouseElement.removePresenceMouseParticipant(t.id)};if(this.name="presence",this.logger=new nt(`@superviz/sdk/${"presence"}`),this.containerId=t,this.container=document.getElementById(t),!this.container){let i=`Container with id ${t} not found`;throw this.logger.log(i),new Error(i)}this.divWrapper=this.createDivWrapper()}start(){this.logger.log("presence-mouse component @ start"),this.presenceMouseElement=document.createElement("superviz-presence-mouse"),this.divWrapper.appendChild(this.presenceMouseElement),this.container.addEventListener("mousemove",this.onMyParticipantMouseMove),this.container.addEventListener("mouseout",this.onMyParticipantMouseOut),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),this.container.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.container.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.removeChild(this.presenceMouseElement),this.divWrapperReplacementInterval&&(clearInterval(this.divWrapperReplacementInterval),this.divWrapperReplacementInterval=null)}createDivWrapper(){let t=this.container.getBoundingClientRect(),i=document.createElement("div");return this.container.parentElement.style.position="relative",i.style.position="fixed",i.style.top=`${t.top}px`,i.style.left=`${t.left}px`,i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.pointerEvents="none",this.container.parentElement.appendChild(i),this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval(()=>{let o=this.container.getBoundingClientRect();i.style.top=`${o.top}px`,i.style.left=`${o.left}px`,i.style.width=`${o.width}px`,i.style.height=`${o.height}px`},1)),i}};k();k();var Gs=class{constructor(e){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("pubsub service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Oe),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("pubsub service @ publish",{event:e,data:t}),this.realtime.setSyncProperty(e,t)};this.publishEventToClient=(e,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(e=>e.destroy()),this.observers.clear()};this.onSyncPropertiesChange=e=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:e}),Object.entries(e).forEach(([t,i])=>{this.publishEventToClient(t,i)})};this.logger=new nt("@superviz/sdk/pubsub"),this.realtime=e,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(e){return this.realtime.fetchSyncClientProperty(e)}};var no=class extends yn{constructor(){super();this.publish=(t,i)=>{this.pubsub.publish(t,i)};this.subscribe=(t,i)=>{this.pubsub.subscribe(t,i)};this.unsubscribe=(t,i)=>{this.pubsub.unsubscribe(t,i)};this.name="realtime",this.logger=new nt("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new Gs(this.realtime)}fetchHistory(t){return this.pubsub.fetchHistory(t)}};k();var nl=Pn(Bu());k();var Hs=(i=>(i.HOST="host",i.GUEST="guest",i.AUDIENCE="audience",i))(Hs||{});k();function UC(s,e){return Le(this,null,function*(){try{return(yield vt.validateApiKey(s,e))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var zh=UC;k();k();var ti=class{static getRemoteConfig(){return Le(this,arguments,function*(e="prod"){let{version:t}=yield Promise.resolve().then(()=>(jh(),Vh));if(e==="local"){let{remoteConfig:l}=yield Promise.resolve().then(()=>(Jh(),Kh));return l}let i={version:t,environment:e},o=this.createUrl(i);return Rt(o,"GET",null)})}static createUrl({version:e,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${e}?env=${t}`}};ti.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";k();var el=Pn(Ds());k();var ro=class{constructor(){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("event bus service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new Oe),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("event bus service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("event bus service @ publish",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.logger=new nt("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};k();var io=class{static checkComponentLimit(e){var o;let t=(o=zu[e])!=null?o:e,i=we.get("limits");return!0}};k();k();var Xu=Pn(Zh()),ni=Pn(Wu());k();var Zu=(f=>(f[f.DISCONNECTED=0]="DISCONNECTED",f[f.INITIALIZING=1]="INITIALIZING",f[f.READY_TO_JOIN=2]="READY_TO_JOIN",f[f.CONNECTING=3]="CONNECTING",f[f.CONNECTED=4]="CONNECTED",f[f.JOINED=5]="JOINED",f[f.FAILED=-1]="FAILED",f[f.RETRYING=-2]="RETRYING",f))(Zu||{});k();k();var qu=(S=>(S[S.yellow=0]="yellow",S[S.turquoise=1]="turquoise",S[S.orange=2]="orange",S[S.blue=3]="blue",S[S.pink=4]="pink",S[S.purple=5]="purple",S[S.green=6]="green",S[S.red=7]="red",S[S.bluedark=8]="bluedark",S[S.pinklight=9]="pinklight",S[S.purplelight=10]="purplelight",S[S.greenlight=11]="greenlight",S[S.orangelight=12]="orangelight",S[S.bluelight=13]="bluelight",S[S.redlight=14]="redlight",S[S.brown=15]="brown",S[S.gray=16]="gray",S))(qu||{}),Yu=(s=>(s[s["#FFEF33"]=0]="#FFEF33",s[s["#31E0B0"]=1]="#31E0B0",s[s["#FF5E10"]=2]="#FF5E10",s[s["#00ABF7"]=3]="#00ABF7",s[s["#FF00BB"]=4]="#FF00BB",s[s["#9C29FF"]=5]="#9C29FF",s[s["#6FDD00"]=6]="#6FDD00",s[s["#E30000"]=7]="#E30000",s[s["#304AFF"]=8]="#304AFF",s[s["#FF89C4"]=9]="#FF89C4",s[s["#D597FF"]=10]="#D597FF",s[s["#C6EC5C"]=11]="#C6EC5C",s[s["#FFA115"]=12]="#FFA115",s[s["#75DEFE"]=13]="#75DEFE",s[s["#FAA291"]=14]="#FAA291",s[s["#BB813F"]=15]="#BB813F",s[s["#878291"]=16]="#878291",s))(Yu||{});var $s=class{constructor(){this.participantObservers=[],this.logger=new nt("@superviz/sdk/realtime-service"),this.participantsObserver=new Oe({logger:this.logger}),this.participantJoinedObserver=new Oe({logger:this.logger}),this.participantLeaveObserver=new Oe({logger:this.logger}),this.syncPropertiesObserver=new Oe({logger:this.logger}),this.reconnectObserver=new Oe({logger:this.logger}),this.roomInfoUpdatedObserver=new Oe({logger:this.logger}),this.roomListUpdatedObserver=new Oe({logger:this.logger}),this.hostObserver=new Oe({logger:this.logger}),this.hostAvailabilityObserver=new Oe({logger:this.logger}),this.realtimeStateObserver=new Oe({logger:this.logger}),this.kickAllParticipantsObserver=new Oe({logger:this.logger}),this.kickParticipantObserver=new Oe({logger:this.logger}),this.authenticationObserver=new Oe({logger:this.logger}),this.commentsObserver=new Oe({logger:this.logger}),this.presenceMouseObserver=new Oe({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Oe({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Oe({logger:this.logger})}subscribeToParticipantUpdate(e,t){this.participantObservers[e]||(this.participantObservers[e]=new Oe({logger:this.logger})),this.participantObservers[e].subscribe(t)}unsubscribeFromParticipantUpdate(e,t){this.participantObservers[e]&&this.participantObservers[e].unsubscribe(t)}getSlotColor(e){let t=e!=null?e:16;return{color:Yu[t],name:qu[t]}}};var GC=1e3*60,HC=6e4,WC=1e4,qh=1e3,Qu=null,ri=class extends $s{constructor(t,i){super();this.participants={};this.participantsMouse={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceMouseChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=t=>{if(!t)return;let i=this.participants[t];this.updateRoomProperties({hostClientId:i.clientId})};this.setKickParticipant=t=>{if(!t)return;let i=this.participants[t];this.updateRoomProperties({kickParticipant:i})};this.freezeSync=t=>{var i,o;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(i=this.broadcastChannel)==null||i.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(o=this.broadcastChannel)==null||o.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{let i=this.clientSyncPropertiesQueue[t];this.clientSyncPropertiesQueue[t]=[],i.length&&this.clientSyncChannel.publish(t,i)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(t,i)=>Le(this,null,function*(){let o=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},o,{[t]:i[i.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=t=>Le(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),t.hostClientId?(t==null?void 0:t.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(t.hostClientId):(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,ni.default)((t={})=>{let i=t;if(!(this.isMessageTooBig(i)||this.left||!this.enableSync||this.isSyncFrozen)&&(i.avatar===void 0&&delete i.avatar,this.myParticipant.data=fe(fe({},this.myParticipant.data),i),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},qh);this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let i=fe(fe({},this.localRoomProperties),t);this.supervizChannel.publish("update",i)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((i,o)=>{o.forEach(l=>{t[l.clientId]=fe({},l)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=t=>{let i=[];if(this.supervizChannel.presence.get((l,c)=>{c.forEach(u=>{l||i.push(u.clientId)})}),!t||!i.includes(t)){this.hostPassingHandle();return}Qu&&(clearTimeout(Qu),this.hostAvailabilityObserver.publish(!0));let o=this.hostParticipantId;this.hostParticipantId=t,this.hostObserver.publish({oldHostParticipantId:o,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var i;let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((i=this.myParticipant)==null?void 0:i.data.type)==="host"&&(t.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(t)};this.hostPassingHandle=(0,ni.default)(()=>Le(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((t,i)=>{let o=i.filter(c=>c.data.type==="host").map(c=>c.clientId);if(this.shouldKickParticipantsOnHostLeave&&o.length===0){this.hostAvailabilityObserver.publish(!1),Qu=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},GC);return}let l=o[0];l===this.localParticipantId&&this.setHost(l)})}),1e3);this.findSlotIndex=t=>{let i=t,o=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((u,f)=>{if(u){o=[];return}f.forEach(m=>{m.connectionId===i.connectionId&&(i=m),m.connectionId!==i.connectionId&&m.data.hasOwnProperty("slotIndex")&&o.splice(o.indexOf(m.data.slotIndex),1)})}),o.length===0)return;let l=o[0];this.myParticipant.data.slotIndex=l,this.updateMyProperties({slotIndex:l});let c=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(i)},c)};this.confirmSlot=(0,ni.default)(t=>Le(this,null,function*(){let i=[],o=t;if(this.supervizChannel.presence.get((l,c)=>{c.forEach(u=>{u.connectionId===o.connectionId&&(o=u),u.connectionId!==o.connectionId&&u.data.slotIndex!==void 0&&i.push(u.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||i.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(o);else{let l=yield this.fetchRoomProperties();this.updateRoomProperties(l)}}),1e3);this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties()};this.syncBroadcast=(0,ni.default)(()=>{let t=btoa(this.ablyKey),i=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(i,{headers:{Authorization:`Basic ${t}`}}).then(o=>o.json()).then(o=>{this.broadcastChannel.publish("update",o)})},1e3);this.isMessageTooBig=(t,i=HC)=>{let o=JSON.stringify(t);return new TextEncoder().encode(o).length>i?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t.data)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterPresenceMouseChannel=t=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(t)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel=null,this.presenceMouseChannel.presence.leave())};this.updatePresenceMouse=(0,ni.default)(t=>{let i=Object.assign({},this.participantsMouse[t.id]||{},t);this.presenceMouseChannel.presence.update(i)},qh);this.onPresenceMouseChannelEnter=t=>{this.presenceMouseParticipantJoinedObserver.publish(t.data)};this.onPresenceMouseChannelLeave=t=>{this.presenceMouseParticipantLeaveObserver.publish(t.data)};this.publishPresenceMouseUpdate=t=>{let i=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=Xe(fe({},t.data),{slotIndex:i,color:this.getSlotColor(i).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.ablyKey=i,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,i;return(i=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?i:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:i,apiKey:o,shouldKickParticipantsOnHostLeave:l}){this.myParticipant={data:Xe(fe({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${i.toLowerCase()}-${o}`,this.shouldKickParticipantsOnHostLeave=l,this.apiKey=o,this.client||this.buildClient()}auth(t,i){let o=new Xu.default.Rest({key:this.ablyKey}),{origin:l}=window.location;o.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:l,apiKey:this.apiKey}},(c,u)=>{c&&this.authenticationObserver.publish("realtime.authentication-failed"),i(c,u)})}join(t){let i=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(i),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{isGridModeEnable:t}))}setDrawing(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{drawing:t}))}setTranscript(t){let i=this.localRoomProperties;this.updateRoomProperties(Object.assign({},i,{transcript:t}))}setSyncProperty(t,i){var c;let o=(c=this.clientSyncPropertiesQueue[t])!=null?c:[],l=(u,f)=>({name:u,data:f,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(l(t,i),WC)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(o)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",t,i),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(l(t,i)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var i,o;if(t){let l=t.toString();if(this.participants&&this.participants[l])return(o=(i=this.participants[t])==null?void 0:i.data)==null?void 0:o.slotIndex}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){if(!this.isJoinedRoom)return;let{clientId:i}=t,o=Object.assign({},t,{participantId:t.clientId});this.publishParticipantUpdate(o),this.participants&&this.participants[i]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:i,data:o}=t,l={};l[i]=o,this.syncPropertiesObserver.publish(l),this.isLocalParticipantHost&&this.saveClientRoomState(i,o)}onReceiveBroadcastSync(t){t.data.forEach(o=>{var c;let l=o.clientId;this.participants[l]=o,(c=o.data)!=null&&c.isAudience||(this.participants[l].data=JSON.parse(this.participants[l].data),this.publishParticipantUpdate(this.participants[l]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Xu.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${Zu[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,i)=>{this.supervizChannel.history((o,l)=>{var u;o&&i(o);let c=(u=l.items[0])==null?void 0:u.data;t(c||null)})})}fetchSyncClientProperty(t){return Le(this,null,function*(){try{let i=yield new Promise((o,l)=>{this.clientRoomStateChannel.history((c,u)=>{var m;c&&l(c);let f=(m=u==null?void 0:u.items[0])==null?void 0:m.data;o(f||null)})});if(t&&!i[t])throw new Error(`Event ${t} not found in the history`);return t?i[t]:i}catch(i){this.logger.log("REALTIME","Error in fetch client realtime data",i.message),this.throw(i.message)}})}onStateChange(){var E,O,d;let t=(E=this.supervizChannelState)==null?void 0:E.current,i=(O=this.connectionState)==null?void 0:O.current,o=i==="connected",l=["initialized","connecting"].includes(i),c=["closed","closing"].includes(i)||["detaching","detached"].includes(t),u={[0]:c,[1]:l,[2]:!t&&o,[3]:t==="attaching",[4]:t==="attached"&&o,[-1]:t==="failed"||i==="failed",[-2]:i==="suspended"||t==="suspended"},f=Object.entries(u).find(([A,I])=>I&&A)[0],m=Number(f);if(m===2&&(this.currentReconnectAttempt=0),o&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(d=this.connectionState)!=null&&d.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return Le(this,null,function*(){var i;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(t),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let o=this.myParticipant.data.type==="host";(i=this.localRoomProperties)!=null&&i.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):o&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;let i=t.data.participantId===this.hostParticipantId;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),i&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};k();var tl=class extends hr{constructor({participant:t,group:i,shouldKickParticipantsOnHostLeave:o}){super();this.eventBus=new ro;this.participants=[];this.addComponent=t=>{var o,l,c;if(!io.checkComponentLimit(t.name)){let u=`You reached the limit usage of ${t.name}`;this.logger.log(u);return}t.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:we.configuration,eventBus:this.eventBus}),vt.sendActivity(this.participant.id,this.group.id,this.group.name,t.name),vt.createOrUpdateParticipant(we.get("apiKey"),{name:(l=(o=this.participant)==null?void 0:o.name)!=null?l:"Anonymous",participantId:(c=this.participant)==null?void 0:c.id})};this.removeComponent=t=>{t.detach()};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:we.get("apiKey"),roomId:we.get("roomId"),shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=t=>{this.logger.log("launcher service @ onParticipantListUpdate");let i=Object.values(t).map(l=>{var c,u,f,m,E;return{id:l.data.id,name:(c=l.data)==null?void 0:c.name,type:(u=l.data)==null?void 0:u.type,avatar:(f=l.data)==null?void 0:f.avatar,avatarConfig:(m=l.data)==null?void 0:m.avatarConfig,isHost:this.realtime.hostClientId===l.clientId,color:this.realtime.getSlotColor((E=l.data)==null?void 0:E.slotIndex).color}}),o=i.find(l=>{var c;return(l==null?void 0:l.id)===((c=this.participant)==null?void 0:c.id)});(0,el.isEqual)(this.participants,i)||(this.participants=i,this.publish("participant.list-updated",i),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",i)),o&&!(0,el.isEqual)(this.participant,o)&&(this.participant=o,this.publish("participant.updated",o),this.logger.log("Publishing ParticipantEvent.UPDATED",o))};this.onParticipantJoined=t=>{this.logger.log("launcher service @ onParticipantJoined");let i=this.participants.find(o=>o.id===t.data.id);!i||(i.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",i)),this.logger.log("launcher service @ onParticipantJoined - participant joined",i),this.publish("participant.joined",i))};this.onParticipantLeave=t=>{this.logger.log("launcher service @ onParticipantLeave");let i=this.participants.find(o=>o.id===t.data.id);!i||(i.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",i)),this.logger.log("launcher service @ onParticipantLeave - participant left",i),this.publish("participant.left",i))};this.onHostParticipantDidChange=t=>{let i=this.participants.find(o=>o.id===(t==null?void 0:t.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",i),this.publish("realtime.host-change",i))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.shouldKickParticipantsOnHostLeave=o!=null?o:!0,this.participant=t,this.group=i,this.logger=new nt("@superviz/sdk/launcher"),this.realtime=new ri(we.get("apiUrl"),we.get("ablyKey")),this.eventBus=new ro,this.logger.log("launcher created"),this.startRealtime()}},Yh=s=>{let e=new tl(s);return{subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}};var $C=({group:s,participant:e,roomId:t})=>{if(!s||!s.name||!s.id)throw new Error("Group fields is required");if(!e||!e.id||!e.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},zC=(s,e)=>Le(void 0,null,function*(){if(!(s&&s.trim()))throw new Error("API key is required");if(!e)throw new Error("Options is required");$C(e),e.debug?nl.debug.enable("*"):nl.debug.disable();let{apiUrl:i,conferenceLayerUrl:o}=yield ti.getRemoteConfig(e.environment);if(!(yield zh(i,s)))throw new Error("Failed to validate API key");let c=yield vt.fetchConfig(i,s),u=yield vt.fetchLimits(i,s);if(!c||!c.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:f}=c;return we.setConfig({apiUrl:i,ablyKey:f,apiKey:s,conferenceLayerUrl:o,environment:c,roomId:e.roomId,debug:e.debug,limits:u}),Yh(Object.assign({},e,{participant:Xe(fe({},e.participant),{type:e.participant.type||"guest"})}))}),rl=zC;k();k();k();k();k();var zs=window,Vs=zs.ShadowRoot&&(zs.ShadyCSS===void 0||zs.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,il=Symbol(),Qh=new WeakMap,oo=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==il)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Vs&&e===void 0){let i=t!==void 0&&t.length===1;i&&(e=Qh.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&Qh.set(t,e))}return e}toString(){return this.cssText}},Xh=s=>new oo(typeof s=="string"?s:s+"",void 0,il),Re=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((i,o,l)=>i+(c=>{if(c._$cssResult$===!0)return c.cssText;if(typeof c=="number")return c;throw Error("Value passed to 'css' function must be a 'css' function result: "+c+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(o)+s[l+1],s[0]);return new oo(t,s,il)},ol=(s,e)=>{Vs?s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(t=>{let i=document.createElement("style"),o=zs.litNonce;o!==void 0&&i.setAttribute("nonce",o),i.textContent=t.cssText,s.appendChild(i)})},js=Vs?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return Xh(t)})(s):s;var sl,Ks=window,ep=Ks.trustedTypes,VC=ep?ep.emptyScript:"",tp=Ks.reactiveElementPolyfillSupport,ul={toAttribute(s,e){switch(e){case Boolean:s=s?VC:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(i){t=null}}return t}},np=(s,e)=>e!==s&&(e==e||s==s),al={attribute:!0,type:String,converter:ul,reflect:!1,hasChanged:np},ll="finalized",Ln=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),((t=this.h)!==null&&t!==void 0?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();let e=[];return this.elementProperties.forEach((t,i)=>{let o=this._$Ep(i,t);o!==void 0&&(this._$Ev.set(o,i),e.push(o))}),e}static createProperty(e,t=al){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){let i=typeof e=="symbol"?Symbol():"__"+e,o=this.getPropertyDescriptor(e,i,t);o!==void 0&&Object.defineProperty(this.prototype,e,o)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){let l=this[e];this[t]=o,this.requestUpdate(e,l,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||al}static finalize(){if(this.hasOwnProperty(ll))return!1;this[ll]=!0;let e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){let t=this.properties,i=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let o of i)this.createProperty(o,t[o])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let o of i)t.unshift(js(o))}else e!==void 0&&t.push(js(e));return t}static _$Ep(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(t=>t(this))}addController(e){var t,i;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)===null||i===void 0||i.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])})}createRenderRoot(){var e;let t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return ol(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(t=>{var i;return(i=t.hostConnected)===null||i===void 0?void 0:i.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(t=>{var i;return(i=t.hostDisconnected)===null||i===void 0?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=al){var o;let l=this.constructor._$Ep(e,i);if(l!==void 0&&i.reflect===!0){let c=(((o=i.converter)===null||o===void 0?void 0:o.toAttribute)!==void 0?i.converter:ul).toAttribute(t,i.type);this._$El=e,c==null?this.removeAttribute(l):this.setAttribute(l,c),this._$El=null}}_$AK(e,t){var i;let o=this.constructor,l=o._$Ev.get(e);if(l!==void 0&&this._$El!==l){let c=o.getPropertyOptions(l),u=typeof c.converter=="function"?{fromAttribute:c.converter}:((i=c.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?c.converter:ul;this._$El=l,this[l]=u.fromAttribute(t,c.type),this._$El=null}}requestUpdate(e,t,i){let o=!0;e!==void 0&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||np)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,i))):o=!1),!this.isUpdatePending&&o&&(this._$E_=this._$Ej())}_$Ej(){return Le(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((o,l)=>this[l]=o),this._$Ei=void 0);let t=!1,i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$ES)===null||e===void 0||e.forEach(o=>{var l;return(l=o.hostUpdate)===null||l===void 0?void 0:l.call(o)}),this.update(i)):this._$Ek()}catch(o){throw t=!1,this._$Ek(),o}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach(i=>{var o;return(o=i.hostUpdated)===null||o===void 0?void 0:o.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((t,i)=>this._$EO(i,this[i],t)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};Ln[ll]=!0,Ln.elementProperties=new Map,Ln.elementStyles=[],Ln.shadowRootOptions={mode:"open"},tp==null||tp({ReactiveElement:Ln}),((sl=Ks.reactiveElementVersions)!==null&&sl!==void 0?sl:Ks.reactiveElementVersions=[]).push("1.6.2");k();var cl,Js=window,ii=Js.trustedTypes,rp=ii?ii.createPolicy("lit-html",{createHTML:s=>s}):void 0,dl="$lit$",Zn=`lit$${(Math.random()+"").slice(9)}$`,cp="?"+Zn,jC=`<${cp}>`,gr=document,ao=()=>gr.createComment(""),uo=s=>s===null||typeof s!="object"&&typeof s!="function",fp=Array.isArray,KC=s=>fp(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",fl=`[ 	
\f\r]`,so=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ip=/-->/g,op=/>/g,pr=RegExp(`>|${fl}(?:([^\\s"'>=/]+)(${fl}*=${fl}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),sp=/'/g,ap=/"/g,dp=/^(?:script|style|textarea|title)$/i,hp=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),ye=hp(1),zI=hp(2),Dn=Symbol.for("lit-noChange"),Ot=Symbol.for("lit-nothing"),up=new WeakMap,mr=gr.createTreeWalker(gr,129,null,!1);function pp(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return rp!==void 0?rp.createHTML(e):e}var JC=(s,e)=>{let t=s.length-1,i=[],o,l=e===2?"<svg>":"",c=so;for(let u=0;u<t;u++){let f=s[u],m,E,O=-1,d=0;for(;d<f.length&&(c.lastIndex=d,E=c.exec(f),E!==null);)d=c.lastIndex,c===so?E[1]==="!--"?c=ip:E[1]!==void 0?c=op:E[2]!==void 0?(dp.test(E[2])&&(o=RegExp("</"+E[2],"g")),c=pr):E[3]!==void 0&&(c=pr):c===pr?E[0]===">"?(c=o!=null?o:so,O=-1):E[1]===void 0?O=-2:(O=c.lastIndex-E[2].length,m=E[1],c=E[3]===void 0?pr:E[3]==='"'?ap:sp):c===ap||c===sp?c=pr:c===ip||c===op?c=so:(c=pr,o=void 0);let A=c===pr&&s[u+1].startsWith("/>")?" ":"";l+=c===so?f+jC:O>=0?(i.push(m),f.slice(0,O)+dl+f.slice(O)+Zn+A):f+Zn+(O===-2?(i.push(void 0),u):A)}return[pp(s,l+(s[t]||"<?>")+(e===2?"</svg>":"")),i]},vr=class{constructor({strings:e,_$litType$:t},i){let o;this.parts=[];let l=0,c=0,u=e.length-1,f=this.parts,[m,E]=JC(e,t);if(this.el=vr.createElement(m,i),mr.currentNode=this.el.content,t===2){let O=this.el.content,d=O.firstChild;d.remove(),O.append(...d.childNodes)}for(;(o=mr.nextNode())!==null&&f.length<u;){if(o.nodeType===1){if(o.hasAttributes()){let O=[];for(let d of o.getAttributeNames())if(d.endsWith(dl)||d.startsWith(Zn)){let A=E[c++];if(O.push(d),A!==void 0){let I=o.getAttribute(A.toLowerCase()+dl).split(Zn),x=/([.?@])?(.*)/.exec(A);f.push({type:1,index:l,name:x[2],strings:I,ctor:x[1]==="."?pl:x[1]==="?"?ml:x[1]==="@"?gl:si})}else f.push({type:6,index:l})}for(let d of O)o.removeAttribute(d)}if(dp.test(o.tagName)){let O=o.textContent.split(Zn),d=O.length-1;if(d>0){o.textContent=ii?ii.emptyScript:"";for(let A=0;A<d;A++)o.append(O[A],ao()),mr.nextNode(),f.push({type:2,index:++l});o.append(O[d],ao())}}}else if(o.nodeType===8)if(o.data===cp)f.push({type:2,index:l});else{let O=-1;for(;(O=o.data.indexOf(Zn,O+1))!==-1;)f.push({type:7,index:l}),O+=Zn.length-1}l++}}static createElement(e,t){let i=gr.createElement("template");return i.innerHTML=e,i}};function oi(s,e,t=s,i){var o,l,c,u;if(e===Dn)return e;let f=i!==void 0?(o=t._$Co)===null||o===void 0?void 0:o[i]:t._$Cl,m=uo(e)?void 0:e._$litDirective$;return(f==null?void 0:f.constructor)!==m&&((l=f==null?void 0:f._$AO)===null||l===void 0||l.call(f,!1),m===void 0?f=void 0:(f=new m(s),f._$AT(s,t,i)),i!==void 0?((c=(u=t)._$Co)!==null&&c!==void 0?c:u._$Co=[])[i]=f:t._$Cl=f),f!==void 0&&(e=oi(s,f._$AS(s,e.values),f,i)),e}var hl=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;let{el:{content:i},parts:o}=this._$AD,l=((t=e==null?void 0:e.creationScope)!==null&&t!==void 0?t:gr).importNode(i,!0);mr.currentNode=l;let c=mr.nextNode(),u=0,f=0,m=o[0];for(;m!==void 0;){if(u===m.index){let E;m.type===2?E=new yr(c,c.nextSibling,this,e):m.type===1?E=new m.ctor(c,m.name,m.strings,this,e):m.type===6&&(E=new vl(c,this,e)),this._$AV.push(E),m=o[++f]}u!==(m==null?void 0:m.index)&&(c=mr.nextNode(),u++)}return mr.currentNode=gr,l}v(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},yr=class{constructor(e,t,i,o){var l;this.type=2,this._$AH=Ot,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=o,this._$Cp=(l=o==null?void 0:o.isConnected)===null||l===void 0||l}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=oi(this,e,t),uo(e)?e===Ot||e==null||e===""?(this._$AH!==Ot&&this._$AR(),this._$AH=Ot):e!==this._$AH&&e!==Dn&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):KC(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Ot&&uo(this._$AH)?this._$AA.nextSibling.data=e:this.$(gr.createTextNode(e)),this._$AH=e}g(e){var t;let{values:i,_$litType$:o}=e,l=typeof o=="number"?this._$AC(e):(o.el===void 0&&(o.el=vr.createElement(pp(o.h,o.h[0]),this.options)),o);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===l)this._$AH.v(i);else{let c=new hl(l,this),u=c.u(this.options);c.v(i),this.$(u),this._$AH=c}}_$AC(e){let t=up.get(e.strings);return t===void 0&&up.set(e.strings,t=new vr(e)),t}T(e){fp(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,o=0;for(let l of e)o===t.length?t.push(i=new yr(this.k(ao()),this.k(ao()),this,this.options)):i=t[o],i._$AI(l),o++;o<t.length&&(this._$AR(i&&i._$AB.nextSibling,o),t.length=o)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,t);e&&e!==this._$AB;){let o=e.nextSibling;e.remove(),e=o}}setConnected(e){var t;this._$AM===void 0&&(this._$Cp=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}},si=class{constructor(e,t,i,o,l){this.type=1,this._$AH=Ot,this._$AN=void 0,this.element=e,this.name=t,this._$AM=o,this.options=l,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Ot}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,o){let l=this.strings,c=!1;if(l===void 0)e=oi(this,e,t,0),c=!uo(e)||e!==this._$AH&&e!==Dn,c&&(this._$AH=e);else{let u=e,f,m;for(e=l[0],f=0;f<l.length-1;f++)m=oi(this,u[i+f],t,f),m===Dn&&(m=this._$AH[f]),c||(c=!uo(m)||m!==this._$AH[f]),m===Ot?e=Ot:e!==Ot&&(e+=(m!=null?m:"")+l[f+1]),this._$AH[f]=m}c&&!o&&this.j(e)}j(e){e===Ot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},pl=class extends si{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ot?void 0:e}},ZC=ii?ii.emptyScript:"",ml=class extends si{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Ot?this.element.setAttribute(this.name,ZC):this.element.removeAttribute(this.name)}},gl=class extends si{constructor(e,t,i,o,l){super(e,t,i,o,l),this.type=5}_$AI(e,t=this){var i;if((e=(i=oi(this,e,t,0))!==null&&i!==void 0?i:Ot)===Dn)return;let o=this._$AH,l=e===Ot&&o!==Ot||e.capture!==o.capture||e.once!==o.once||e.passive!==o.passive,c=e!==Ot&&(o===Ot||l);l&&this.element.removeEventListener(this.name,this,o),c&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;typeof this._$AH=="function"?this._$AH.call((i=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&i!==void 0?i:this.element,e):this._$AH.handleEvent(e)}},vl=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){oi(this,e)}};var lp=Js.litHtmlPolyfillSupport;lp==null||lp(vr,yr),((cl=Js.litHtmlVersions)!==null&&cl!==void 0?cl:Js.litHtmlVersions=[]).push("2.7.5");var mp=(s,e,t)=>{var i,o;let l=(i=t==null?void 0:t.renderBefore)!==null&&i!==void 0?i:e,c=l._$litPart$;if(c===void 0){let u=(o=t==null?void 0:t.renderBefore)!==null&&o!==void 0?o:null;l._$litPart$=c=new yr(e.insertBefore(ao(),u),u,void 0,t!=null?t:{})}return c._$AI(s),c};k();var yl,bl;var xe=class extends Ln{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;let i=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=i.firstChild),i}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=mp(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return Dn}};xe.finalized=!0,xe._$litElement$=!0,(yl=globalThis.litElementHydrateSupport)===null||yl===void 0||yl.call(globalThis,{LitElement:xe});var gp=globalThis.litElementPolyfillSupport;gp==null||gp({LitElement:xe});((bl=globalThis.litElementVersions)!==null&&bl!==void 0?bl:globalThis.litElementVersions=[]).push("3.3.2");k();k();k();var We=s=>e=>typeof e=="function"?((t,i)=>(customElements.define(t,i),i))(s,e):((t,i)=>{let{kind:o,elements:l}=i;return{kind:o,elements:l,finisher(c){customElements.define(t,c)}}})(s,e);k();k();k();k();k();k();k();k();var El,yM=((El=window.HTMLSlotElement)===null||El===void 0?void 0:El.prototype.assignedElements)!=null?(s,e)=>s.assignedElements(e):(s,e)=>s.assignedNodes(e).filter(t=>t.nodeType===Node.ELEMENT_NODE);k();var br=class extends xe{render(){return ye` <div>Hello from SuperViz, ${this.name}</div> `}};br.properties={name:{type:String}},br.styles=Re`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,br=He([We("superviz-hello-world")],br);k();k();k();k();var Al=Re`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;k();var Sl=Re`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;k();var Cl=Re`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;k();var Tl=Re`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }

  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
  }
`;var ze=s=>{var t;class e extends s{connectedCallback(){setTimeout(()=>{var c;let o=document.getElementById("superviz-style"),l=document.createElement("style");l.innerHTML=(o==null?void 0:o.innerHTML)||"",(c=this.shadowRoot)==null||c.appendChild(l)}),super.connectedCallback()}emitEvent(o,l,c={composed:!0,bubbles:!0}){let u=new CustomEvent(o,fe({detail:l},c));this.dispatchEvent(u)}}return e.styles=[Al,Sl,Cl,Tl,(t=s.styles)!=null?t:[]],e};var vp=ze(xe),qC=[vp.styles],Er=class extends vp{constructor(){super();this.name="",this.size="md"}render(){return ye` <i class="sv-icon sv-icon-${this.name}_${this.size}"></i> `}};Er.properties={name:{type:String},size:{type:String}},Er.styles=[qC,Re`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }
    `],Er=He([We("superviz-icon")],Er);k();k();k();k();var yp={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},bp=s=>(...e)=>({_$litDirective$:s,values:e}),Zs=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var Et=bp(class extends Zs{constructor(s){var e;if(super(s),s.type!==yp.ATTRIBUTE||s.name!=="class"||((e=s.strings)===null||e===void 0?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){var t,i;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.nt=new Set(s.strings.join(" ").split(/\s/).filter(l=>l!=="")));for(let l in e)e[l]&&!(!((t=this.nt)===null||t===void 0)&&t.has(l))&&this.it.add(l);return this.render(e)}let o=s.element.classList;this.it.forEach(l=>{l in e||(o.remove(l),this.it.delete(l))});for(let l in e){let c=!!e[l];c===this.it.has(l)||((i=this.nt)===null||i===void 0?void 0:i.has(l))||(c?(o.add(l),this.it.add(l)):(o.remove(l),this.it.delete(l)))}return Dn}});k();var Ep=Re`
  .dropdown {
    position: relative;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
  }

  .dropdown-list * {
    box-sizing: border-box;
  }

  .menu {
    list-style: none;
    padding: 0;
    background: #fff;
    color: #9fa5b5;
    opacity: 0;
    display: none;
    transition: 0.2s;
    z-index: 1;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    top: -10px;
    border-radius: 3px;
  }

  .menu--bottom-left {
    min-width: 103px;
    position: absolute;
    left: 100%;
    transform: translateX(-100%);
  }

  .menu--bottom-center {
    min-width: 103px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .menu--bottom-right {
    min-width: 103px;
    position: absolute;
    left: 26px;
    transform: translateX(-100%);
  }

  .menu li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .menu li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
  }
`;var Ap=ze(xe),YC=[Ap.styles,Ep],Ar=class extends Ap{constructor(){super(...arguments);this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let i=t.composedPath(),o=this.shadowRoot.querySelector(".dropdown-content"),l=this.shadowRoot.querySelector(".dropdown-list"),u=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],f=i.includes(o),m=i.includes(l),E=i.includes(u);f||m||E||(this.open=!1)};this.close=()=>{this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let i=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",i,{bubbles:!1,composed:!1})}}updated(t){t.has("open")&&(this.open&&document.addEventListener("click",this.onClickOutDropdown),this.open||(document.removeEventListener("click",this.onClickOutDropdown),this.close()))}render(){let t={menu:!0,"menu--bottom-left":this.position==="bottom-left","menu--bottom-center":this.position==="bottom-center","menu--bottom-right":this.position==="bottom-right","menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right"},i=this.options.map(l=>{let c={text:!0,"text-bold":!0,active:this.active===(l==null?void 0:l[this.returnTo])};return ye`<li @click=${()=>this.callbackSelected(l)} class=${Et(c)}>${l[this.label]}</li>`}),o=()=>{this.open=!this.open};return ye`
      <div class="dropdown">
        <div class="dropdown-content" @click=${()=>o()}>
          <slot name="dropdown"></slot>
        </div>
      </div>
      <div class="dropdown-list">
        <ul class=${Et(t)}>
          ${i}
        </ul>
      </div>
    `}};Ar.styles=YC,Ar.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},position:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]}},Ar=He([We("superviz-dropdown")],Ar);k();k();var Sp=Re`
#mouse-container {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

#mouse-sync {
  position: absolute;
}

.mouse-board {
  background: transparent;
  position: absolute;
  top: 0;
  cursor: none !important;
}

.mouse-follower {
  position: absolute;
  display: block;
  transition: all 0.4s;
}

.pointer-mouse {
  display: flex;
  height: 17px;
  width: 17px;
  background-image: url(https://production.cdn.superviz.com/static/pointers/0.svg);
}

.mouse-user-name {
  display: block;
  position: absolute;  
  border-radius: 30px;
  padding: 2px 8px;
  font-weight: 700;
  font-size: 14px;
  font-family: 'Open Sans, sans-serif';
  line-height: 22px;
  margin-left: 10px;
  margin-top: -6px;
  background: yellow;
  white-space: nowrap;
}
`;var ai=class extends xe{constructor(){super();this.updatePresenceMouseParticipant=t=>{if(!this.shadowRoot.getElementById(`mouse-${t.id}`)){let u=this.shadowRoot.getElementById("mouse-sync"),f=document.createElement("div");f.setAttribute("id",`mouse-${t.id}`),f.setAttribute("class","mouse-follower");let m=document.createElement("div");m.setAttribute("class","pointer-mouse");let E=document.createElement("div");E.setAttribute("class","mouse-user-name"),E.innerHTML=t.name,f.appendChild(m),f.appendChild(E),u&&u.appendChild(f)}let o=this.shadowRoot.getElementById(`mouse-${t.id}`);if(!o)return;let l=this.shadowRoot.getElementById(`mouse-${t.id}`),c=this.shadowRoot.getElementById(`mouse-${t.id}`);if(l&&c){let u=l.getElementsByClassName("mouse-user-name")[0],f=c.getElementsByClassName("pointer-mouse")[0];f&&(f.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers/${t.slotIndex}.svg)`),u&&(u.style.color=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#000000",u.style.backgroundColor=t.color,u.innerHTML=t.name);let{containerId:m}=t,E=document.getElementById(m),O=t.mousePositionX,d=t.mousePositionY;if(m){let A=(E==null?void 0:E.clientWidth)||1,I=(E==null?void 0:E.clientHeight)||1;O=t.mousePositionX/t.originalWidth*A,d=t.mousePositionY/t.originalHeight*I}o.style.left=`${O}px`,o.style.top=`${d}px`}};this.textColorValues=[2,4,5,7,8,16]}removePresenceMouseParticipant(t){let i=this.shadowRoot.getElementById(`mouse-${t}`);i&&i.remove()}render(){return ye`
      <div id="mouse-container" class="mouse-board">
        <div id="mouse-sync"></div>
      </div>
    `}};ai.styles=[Sp],ai=He([We("superviz-presence-mouse")],ai);k();k();k();var qs=Re`  
  .modal--overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: rgba(var(--sv-gray-400), 0.8);
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: transparent;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var Cp=ze(xe),QC=[Cp.styles,qs],ui=class extends Cp{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};ui.styles=QC,ui=He([We("superviz-modal")],ui);k();var Tp=ze(xe),XC=[Tp.styles,qs],li=class extends Tp{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>ye`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,i=()=>ye`
        <div class="modal--body">
          <div class="modal--body-content">
            ${this.options.body}
          </div>
        </div>
      `,o=()=>{if(this.options.footer)return ye`
          <div class="modal--footer">
            ${this.options.footer}
          </div>
        `;let l=this.options.confirmLabel||"OK",c=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?ye`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>${c}</button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${l}</button>
          </div>
        `:ye`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>${l}</button>
        </div>
      `};return ye`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">
          ${t()}

          ${i()}

          ${o()}
        </div>
      </div>
    `}};li.styles=XC,li=He([We("superviz-modal-container")],li);k();k();k();k();var Ol=Re`
  .container {
    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
  }

  .container-close {
    display: none;
  }

  .header {
    width: 100%;
  }

  .content {
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }
`;k();var wl=Re`
  div.topbar {
    display: flex;
    justify-content: space-between;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  div.topbar span {
    margin: 16px;
    color: rgb(var(--sv-gray-600));
  }
`;k();var Il=Re`
  .annotations {
    display: flex;
    flex-direction: column;
    background-color: rgb(var(--sv-gray-400));
    min-height: 10px;
    padding: 8px;
  }

  .annotations--add-comment-btn {
    color: rgb(var(--sv-white));
    text-align: center;
    padding: 8px;
  }

  .annotations--comments-input {
    width: 288px;
    padding: 8px;
  }

  .hidden {
    display: none;
  }
`;k();var Ml=Re`
  .reply {
    padding-left: 24px !important;
  }

  .comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comment-item__user {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comment-item__user-details {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comment-item__avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comment-item__content__body {
    color: rgb(var(--sv-gray-700));
  }

  .hidden {
    display: none;
  }
`;k();var Rl=Re`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;k();var xl=Re`
  .comment-input {
    display: flex;
    flex-direction: column;
    width: 100%;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
  }

  .comment-input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comment-input:focus-within > .sv-hr {
    background: rgb(var(--sv-gray-500))
  }

  #comment-input--textarea {
    all: unset;
    border: 0px;
    border-radius: 4px;
    outline: none;
    height: 13px;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    padding: 12px 11px !important;
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    resize: none;
    appearance: none;
    width: 90%;
  }

  #comment-input--textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
  }

  .comment-input--options {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
  }

  .mention {
    display: none;
  }

  .comment-input--send-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-primary));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgba(var(--sv-white), 1);
    border: 0px;
    cursor: pointer;
  }

  .align-send-btn > superviz-icon {
    margin-right: 2px;
    margin-top: 4px;
  }

  .comment-input--send-btn:disabled {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgb(var(--sv-gray-200));
    border-radius: 100%;
    width: 32px;
    height: 32px;
    color: rgb(var(--sv-gray-400));
    border: 0px;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
  }
`;k();var _l=Re`
  .annotation-item--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
  }

  .annotation-item:hover:not(.annotation-item--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    padding: 8px;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
    height: 18px;
  }

  .avatar {
    position: absolute;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
  }

  .avatar-divs-1 {
    z-index: 4;
    left: 0;
  }

  .avatar-divs-2 {
    z-index: 3;
    left: 16px;
  }

  .avatar-divs-3 {
    z-index: 2;
    left: 32px;
  }

  .avatar-divs-4 {
    z-index: 1;
    left: 48px;
  }

  .avatar-divs-5 {
    z-index: 1;
    left: 60px;
  }

  .replies {
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    padding-left: 8px;
  }

  .last-reply {
    padding-left: 14px;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .comments-container {
    display: flex;
    flex-direction: column;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    display: none;
  }

  .annotation-item {
    padding: 8px;
    cursor: pointer;
  }
`;k();var Pl=Re`
  .annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;k();var Ll=Re`
  .annotation-pin,
  .annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: white;
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid white;
    box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.25);
    transition: border-color 0.2s ease-in-out;
    padding: 2px;
    cursor: pointer;
  }

  .annotation-pin:hover,
  .annotation-pin:focus,
  .annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: white;
  }

  .annotation-pin__avatar--add {
    font-size: 24px;
    color: rgb(var(--sv-gray-700));
    background-color: white;
  }

  .annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;

    object-fit: cover;
  }
`;k();var Dl=Re`
  .select {
    display: flex;
    width: 100%;
    justify-content: flex-end;
    align-items: center;
  }

  .select-container {
    text-wrap: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
`;k();var Nl=Re`
  button.float-button {
    position: fixed;
    top: 20px;
    left: 20px;

    border-radius: 50%;
    width: 38px;
    height: 38px;

    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    border: none;

    background-color: white;
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    transition: all 300ms;
    cursor: pointer;
  }

  button.float-button p {
    display: none;
  }

  button.float-button:hover {
    width: 110px;
    border-radius: 30px;
  }

  button.float-button:hover p {
    display: block;
  }
`;k();var Fl=Re`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;k();function Ul(s){let e=s.querySelector("#superviz-comments");if(e){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};new MutationObserver((o,l)=>{o.forEach(c=>{let u=s.querySelector("#superviz-comments");u&&u.contains(c.target)&&(l.disconnect(),eT(s))})}).observe(e,t)}}function eT(s){let e=s.querySelector("#poweredby-footer");e&&e.remove();let t=document.createElement("div");t.id="poweredby-footer",t.className="footer";let i=document.createElement("div");i.className="powered-by powered-by--horizontal";let o=document.createElement("a");o.href="https://superviz.com/",o.target="_blank",o.className="link";let l=document.createElement("div");l.textContent="Powered by";let c=document.createElement("img");c.width=48,c.height=8.86,c.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",i.appendChild(o),o.appendChild(l),l.appendChild(c),t.appendChild(i);let u=s.getElementById("superviz-comments");u&&u.appendChild(t),Ul(s)}var Op=ze(xe),tT=[Op.styles,Ol,Fl],Sr=class extends Op{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1}updateAnnotations(t){this.annotations=t}toggle(){this.emitEvent("toggle",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:i}=t;this.annotationFilter=i}updated(t){super.updated(t),this.updateComplete.then(()=>{this.shadowRoot.querySelector("#superviz-comments")&&this.waterMarkState&&Ul(this.shadowRoot)})}render(){let t=[this.open?"container":"container-close"].join(" "),i=ye`
    <div id="poweredby-footer" class="footer">
    <div class="powered-by powered-by--horizontal">
      <a href="https://superviz.com/" target="_blank" class="link">
        <div class="">
          Powered by
          <img
            width="48px"
            height="8.86px"
            src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
          />
        </div>
      </a>
    </div>
  </div>`,o=this.waterMarkState?i:"";return ye`
      <div id="superviz-comments" class=${t}>
        <div class="header">
          <superviz-comments-topbar @close=${this.toggle}></superviz-comments-topbar>
          <superviz-comments-annotations id="annotations" open=${this.open}>
          </superviz-comments-annotations>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          class="content"
        ></superviz-comments-content>
      ${o}
      </div>
    `}};Sr.styles=tT,Sr.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean}},Sr=He([We("superviz-comments")],Sr);k();k();var nT=ze(xe),rT=[nT.styles,wl],ci=class extends ze(xe){close(){this.dispatchEvent(new CustomEvent("close"))}render(){return ye`
      <div class="topbar">
        <span class="text text-bold">COMMENTS</span>
        <span @click=${this.close}>
          <superviz-icon name="right" size="lg"></superviz-icon>
        </span>
      </div>
    `}};ci.styles=rT,ci=He([We("superviz-comments-topbar")],ci);k();var wp=ze(xe),iT=[wp.styles,Il],Cr=class extends wp{constructor(){super(...arguments);this.prepareToCreateAnnotation=i=>Le(this,[i],function*({detail:t}){this.annotation=t,yield this.updateComplete,this.emitEvent("comment-input-focus",t)})}createComment({detail:t}){this.emitEvent("create-annotation",t),this.annotation=null}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("prepare-to-create-annotation",this.prepareToCreateAnnotation)}render(){let t={"annotations--comments-input":!0,hidden:!this.annotation};return ye`
      <div class="annotations">
        <span class="text text-big text-bold annotations--add-comment-btn"
          >Click anywhere to add a comment</span
        >
        <div class=${Et(t)}>
          <superviz-comments-comment-input
            @create-annotation=${this.createComment}
            eventType="create-annotation"
          >
          </superviz-comments-comment-input>
        </div>
      </div>
    `}};Cr.styles=iT,Cr.properties={annotation:{type:Object}},Cr=He([We("superviz-comments-annotations")],Cr);k();var Ip=ze(xe),oT=[Ip.styles,Rl],Tr=class extends Ip{constructor(){super();this.selectAnnotation=({detail:t})=>{let{uuid:i}=t;this.selectedAnnotation=i};this.annotations=[]}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation)}render(){var f,m;let t=(f=this.annotations)==null?void 0:f.filter(E=>E.resolved===!1),i=(m=this.annotations)==null?void 0:m.filter(E=>E.resolved===!0),o=(E,O)=>O?(i==null?void 0:i.length)===E+1:(t==null?void 0:t.length)===E+1,l=(E,O,d)=>{let I=E.comments.length>0?ye`
            <superviz-comments-annotation-item
              annotation=${JSON.stringify(E)}
              selected="${this.selectedAnnotation}"
              ?isLastAnnotation=${o(O,d)}
              annotationFilter=${this.annotationFilter}
            >
            </superviz-comments-annotation-item>
          `:ye``;return ye` ${I} `},c=t==null?void 0:t.map((E,O)=>l(E,O,!1)),u=i==null?void 0:i.map((E,O)=>l(E,O,!0));return ye` ${c} ${u} `}};Tr.styles=oT,Tr.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String}},Tr=He([We("superviz-comments-content")],Tr);k();k();k();k();k();var Nn=class extends Error{},Ys=class extends Nn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},Qs=class extends Nn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},Xs=class extends Nn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},Fn=class extends Nn{},fi=class extends Nn{constructor(e){super(`Invalid unit ${e}`)}},wt=class extends Nn{},fn=class extends Nn{constructor(){super("Zone is an abstract class")}};k();k();k();var he="numeric",dn="short",Jt="long",qn={year:he,month:he,day:he},co={year:he,month:dn,day:he},kl={year:he,month:dn,day:he,weekday:dn},fo={year:he,month:Jt,day:he},ho={year:he,month:Jt,day:he,weekday:Jt},po={hour:he,minute:he},mo={hour:he,minute:he,second:he},go={hour:he,minute:he,second:he,timeZoneName:dn},vo={hour:he,minute:he,second:he,timeZoneName:Jt},yo={hour:he,minute:he,hourCycle:"h23"},bo={hour:he,minute:he,second:he,hourCycle:"h23"},Eo={hour:he,minute:he,second:he,hourCycle:"h23",timeZoneName:dn},Ao={hour:he,minute:he,second:he,hourCycle:"h23",timeZoneName:Jt},So={year:he,month:he,day:he,hour:he,minute:he},Co={year:he,month:he,day:he,hour:he,minute:he,second:he},To={year:he,month:dn,day:he,hour:he,minute:he},Oo={year:he,month:dn,day:he,hour:he,minute:he,second:he},Gl={year:he,month:dn,day:he,weekday:dn,hour:he,minute:he},wo={year:he,month:Jt,day:he,hour:he,minute:he,timeZoneName:dn},Io={year:he,month:Jt,day:he,hour:he,minute:he,second:he,timeZoneName:dn},Mo={year:he,month:Jt,day:he,weekday:Jt,hour:he,minute:he,timeZoneName:Jt},Ro={year:he,month:Jt,day:he,weekday:Jt,hour:he,minute:he,second:he,timeZoneName:Jt};k();k();k();k();var Gt=class{get type(){throw new fn}get name(){throw new fn}get ianaName(){return this.name}get isUniversal(){throw new fn}offsetName(e,t){throw new fn}formatOffset(e,t){throw new fn}offset(e){throw new fn}equals(e){throw new fn}get isValid(){throw new fn}};var Hl=null,En=class extends Gt{static get instance(){return Hl===null&&(Hl=new En),Hl}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return ta(e,t,i)}formatOffset(e,t){return Yn(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}};k();var ra={};function sT(s){return ra[s]||(ra[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),ra[s]}var aT={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function uT(s,e){let t=s.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,o,l,c,u,f,m,E]=i;return[c,o,l,u,f,m,E]}function lT(s,e){let t=s.formatToParts(e),i=[];for(let o=0;o<t.length;o++){let{type:l,value:c}=t[o],u=aT[l];l==="era"?i[u]=c:Fe(u)||(i[u]=parseInt(c,10))}return i}var na={},At=class extends Gt{static create(e){return na[e]||(na[e]=new At(e)),na[e]}static resetCache(){na={},ra={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=At.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return ta(e,t,i,this.name)}formatOffset(e,t){return Yn(this.offset(e),t)}offset(e){let t=new Date(e);if(isNaN(t))return NaN;let i=sT(this.name),[o,l,c,u,f,m,E]=i.formatToParts?lT(i,t):uT(i,t);u==="BC"&&(o=-Math.abs(o)+1);let d=di({year:o,month:l,day:c,hour:f===24?0:f,minute:m,second:E,millisecond:0}),A=+t,I=A%1e3;return A-=I>=0?I:1e3+I,(d-A)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}};k();var Mp={};function cT(s,e={}){let t=JSON.stringify([s,e]),i=Mp[t];return i||(i=new Intl.ListFormat(s,e),Mp[t]=i),i}var Wl={};function $l(s,e={}){let t=JSON.stringify([s,e]),i=Wl[t];return i||(i=new Intl.DateTimeFormat(s,e),Wl[t]=i),i}var zl={};function fT(s,e={}){let t=JSON.stringify([s,e]),i=zl[t];return i||(i=new Intl.NumberFormat(s,e),zl[t]=i),i}var Vl={};function dT(s,e={}){let c=e,{base:t}=c,i=Nu(c,["base"]),o=JSON.stringify([s,i]),l=Vl[o];return l||(l=new Intl.RelativeTimeFormat(s,e),Vl[o]=l),l}var xo=null;function hT(){return xo||(xo=new Intl.DateTimeFormat().resolvedOptions().locale,xo)}function pT(s){let e=s.indexOf("-x-");e!==-1&&(s=s.substring(0,e));let t=s.indexOf("-u-");if(t===-1)return[s];{let i,o;try{i=$l(s).resolvedOptions(),o=s}catch(u){let f=s.substring(0,t);i=$l(f).resolvedOptions(),o=f}let{numberingSystem:l,calendar:c}=i;return[o,l,c]}}function mT(s,e,t){return(t||e)&&(s.includes("-u-")||(s+="-u"),t&&(s+=`-ca-${t}`),e&&(s+=`-nu-${e}`)),s}function gT(s){let e=[];for(let t=1;t<=12;t++){let i=Ae.utc(2009,t,1);e.push(s(i))}return e}function vT(s){let e=[];for(let t=1;t<=7;t++){let i=Ae.utc(2016,11,13+t);e.push(s(i))}return e}function ia(s,e,t,i){let o=s.listingMode();return o==="error"?null:o==="en"?t(e):i(e)}function yT(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var jl=class{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;let u=i,{padTo:o,floor:l}=u,c=Nu(u,["padTo","floor"]);if(!t||Object.keys(c).length>0){let f=fe({useGrouping:!1},i);i.padTo>0&&(f.minimumIntegerDigits=i.padTo),this.inf=fT(e,f)}}format(e){if(this.inf){let t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{let t=this.floor?Math.floor(e):hi(e,3);return lt(t,this.padTo)}}},Kl=class{constructor(e,t,i){this.opts=i,this.originalZone=void 0;let o;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let c=-1*(e.offset/60),u=c>=0?`Etc/GMT+${c}`:`Etc/GMT${c}`;e.offset!==0&&At.create(u).valid?(o=u,this.dt=e):(o="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,o=e.zone.name):(o="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let l=fe({},this.opts);l.timeZone=l.timeZone||o,this.dtf=$l(t,l)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){let i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return Xe(fe({},t),{value:i})}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},Jl=class{constructor(e,t,i){this.opts=fe({style:"long"},i),!t&&oa()&&(this.rtf=dT(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):Rp(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}},je=class{static fromOpts(e){return je.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,i,o=!1){let l=e||Ye.defaultLocale,c=l||(o?"en-US":hT()),u=t||Ye.defaultNumberingSystem,f=i||Ye.defaultOutputCalendar;return new je(c,u,f,l)}static resetCache(){xo=null,Wl={},zl={},Vl={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i}={}){return je.create(e,t,i)}constructor(e,t,i,o){let[l,c,u]=pT(e);this.locale=l,this.numberingSystem=t||c||null,this.outputCalendar=i||u||null,this.intl=mT(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=o,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=yT(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:je.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone(Xe(fe({},e),{defaultToEN:!0}))}redefaultToSystem(e={}){return this.clone(Xe(fe({},e),{defaultToEN:!1}))}months(e,t=!1){return ia(this,e,Zl,()=>{let i=t?{month:e,day:"numeric"}:{month:e},o=t?"format":"standalone";return this.monthsCache[o][e]||(this.monthsCache[o][e]=gT(l=>this.extract(l,i,"month"))),this.monthsCache[o][e]})}weekdays(e,t=!1){return ia(this,e,ql,()=>{let i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},o=t?"format":"standalone";return this.weekdaysCache[o][e]||(this.weekdaysCache[o][e]=vT(l=>this.extract(l,i,"weekday"))),this.weekdaysCache[o][e]})}meridiems(){return ia(this,void 0,()=>Yl,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ae.utc(2016,11,13,9),Ae.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return ia(this,e,Ql,()=>{let t={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ae.utc(-40,1,1),Ae.utc(2017,1,1)].map(i=>this.extract(i,t,"era"))),this.eraCache[e]})}extract(e,t,i){let o=this.dtFormatter(e,t),l=o.formatToParts(),c=l.find(u=>u.type.toLowerCase()===i);return c?c.value:null}numberFormatter(e={}){return new jl(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Kl(e,this.intl,t)}relFormatter(e={}){return new Jl(this.intl,this.isEnglish(),e)}listFormatter(e={}){return cT(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}};k();k();var ec=null,ct=class extends Gt{static get utcInstance(){return ec===null&&(ec=new ct(0)),ec}static instance(e){return e===0?ct.utcInstance:new ct(e)}static parseSpecifier(e){if(e){let t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new ct(Or(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${Yn(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${Yn(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return Yn(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}};k();var pi=class extends Gt{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function hn(s,e){let t;if(Fe(s)||s===null)return e;if(s instanceof Gt)return s;if(xp(s)){let i=s.toLowerCase();return i==="default"?e:i==="local"||i==="system"?En.instance:i==="utc"||i==="gmt"?ct.utcInstance:ct.parseSpecifier(i)||At.create(s)}else return An(s)?ct.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new pi(s)}var _p=()=>Date.now(),Pp="system",Lp=null,Dp=null,Np=null,Fp=60,Up,Ye=class{static get now(){return _p}static set now(e){_p=e}static set defaultZone(e){Pp=e}static get defaultZone(){return hn(Pp,En.instance)}static get defaultLocale(){return Lp}static set defaultLocale(e){Lp=e}static get defaultNumberingSystem(){return Dp}static set defaultNumberingSystem(e){Dp=e}static get defaultOutputCalendar(){return Np}static set defaultOutputCalendar(e){Np=e}static get twoDigitCutoffYear(){return Fp}static set twoDigitCutoffYear(e){Fp=e%100}static get throwOnInvalid(){return Up}static set throwOnInvalid(e){Up=e}static resetCaches(){je.resetCache(),At.resetCache()}};function Fe(s){return typeof s=="undefined"}function An(s){return typeof s=="number"}function _o(s){return typeof s=="number"&&s%1===0}function xp(s){return typeof s=="string"}function Bp(s){return Object.prototype.toString.call(s)==="[object Date]"}function oa(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function kp(s){return Array.isArray(s)?s:[s]}function tc(s,e,t){if(s.length!==0)return s.reduce((i,o)=>{let l=[e(o),o];return i&&t(i[0],l[0])===i[0]?i:l},null)[1]}function Gp(s,e){return e.reduce((t,i)=>(t[i]=s[i],t),{})}function Qn(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Sn(s,e,t){return _o(s)&&s>=e&&s<=t}function bT(s,e){return s-e*Math.floor(s/e)}function lt(s,e=2){let t=s<0,i;return t?i="-"+(""+-s).padStart(e,"0"):i=(""+s).padStart(e,"0"),i}function Un(s){if(!(Fe(s)||s===null||s===""))return parseInt(s,10)}function Xn(s){if(!(Fe(s)||s===null||s===""))return parseFloat(s)}function Po(s){if(!(Fe(s)||s===null||s==="")){let e=parseFloat("0."+s)*1e3;return Math.floor(e)}}function hi(s,e,t=!1){let i=eh(10,e);return(t?Math.trunc:Math.round)(s*i)/i}function wr(s){return s%4===0&&(s%100!==0||s%400===0)}function Ir(s){return wr(s)?366:365}function mi(s,e){let t=bT(e-1,12)+1,i=s+(e-t)/12;return t===2?wr(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function di(s){let e=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(e=new Date(e),e.setUTCFullYear(s.year,s.month-1,s.day)),+e}function gi(s){let e=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,t=s-1,i=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||i===3?53:52}function Lo(s){return s>99?s:s>Ye.twoDigitCutoffYear?1900+s:2e3+s}function ta(s,e,t,i=null){let o=new Date(s),l={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(l.timeZone=i);let c=fe({timeZoneName:e},l),u=new Intl.DateTimeFormat(t,c).formatToParts(o).find(f=>f.type.toLowerCase()==="timezonename");return u?u.value:null}function Or(s,e){let t=parseInt(s,10);Number.isNaN(t)&&(t=0);let i=parseInt(e,10)||0,o=t<0||Object.is(t,-0)?-i:i;return t*60+o}function nc(s){let e=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(e))throw new wt(`Invalid unit value ${s}`);return e}function vi(s,e){let t={};for(let i in s)if(Qn(s,i)){let o=s[i];if(o==null)continue;t[e(i)]=nc(o)}return t}function Yn(s,e){let t=Math.trunc(Math.abs(s/60)),i=Math.trunc(Math.abs(s%60)),o=s>=0?"+":"-";switch(e){case"short":return`${o}${lt(t,2)}:${lt(i,2)}`;case"narrow":return`${o}${t}${i>0?`:${i}`:""}`;case"techie":return`${o}${lt(t,2)}${lt(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Do(s){return Gp(s,["hour","minute","second","millisecond"])}var ET=["January","February","March","April","May","June","July","August","September","October","November","December"],rc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AT=["J","F","M","A","M","J","J","A","S","O","N","D"];function Zl(s){switch(s){case"narrow":return[...AT];case"short":return[...rc];case"long":return[...ET];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var ic=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],oc=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ST=["M","T","W","T","F","S","S"];function ql(s){switch(s){case"narrow":return[...ST];case"short":return[...oc];case"long":return[...ic];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Yl=["AM","PM"],CT=["Before Christ","Anno Domini"],TT=["BC","AD"],OT=["B","A"];function Ql(s){switch(s){case"narrow":return[...OT];case"short":return[...TT];case"long":return[...CT];default:return null}}function Hp(s){return Yl[s.hour<12?0:1]}function Wp(s,e){return ql(e)[s.weekday-1]}function $p(s,e){return Zl(e)[s.month-1]}function zp(s,e){return Ql(e)[s.year<0?0:1]}function Rp(s,e,t="always",i=!1){let o={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},l=["hours","minutes","seconds"].indexOf(s)===-1;if(t==="auto"&&l){let O=s==="days";switch(e){case 1:return O?"tomorrow":`next ${o[s][0]}`;case-1:return O?"yesterday":`last ${o[s][0]}`;case 0:return O?"today":`this ${o[s][0]}`;default:}}let c=Object.is(e,-0)||e<0,u=Math.abs(e),f=u===1,m=o[s],E=i?f?m[1]:m[2]||m[1]:f?o[s][0]:s;return c?`${u} ${E} ago`:`in ${u} ${E}`}function Vp(s,e){let t="";for(let i of s)i.literal?t+=i.val:t+=e(i.val);return t}var wT={D:qn,DD:co,DDD:fo,DDDD:ho,t:po,tt:mo,ttt:go,tttt:vo,T:yo,TT:bo,TTT:Eo,TTTT:Ao,f:So,ff:To,fff:wo,ffff:Mo,F:Co,FF:Oo,FFF:Io,FFFF:Ro},ft=class{static create(e,t={}){return new ft(e,t)}static parseFormat(e){let t=null,i="",o=!1,l=[];for(let c=0;c<e.length;c++){let u=e.charAt(c);u==="'"?(i.length>0&&l.push({literal:o||/^\s+$/.test(i),val:i}),t=null,i="",o=!o):o||u===t?i+=u:(i.length>0&&l.push({literal:/^\s+$/.test(i),val:i}),i=u,t=u)}return i.length>0&&l.push({literal:o||/^\s+$/.test(i),val:i}),l}static macroTokenToFormatOpts(e){return wT[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,fe(fe({},this.opts),t)).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,fe(fe({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return lt(e,t);let i=fe({},this.opts);return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){let i=this.loc.listingMode()==="en",o=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",l=(A,I)=>this.loc.extract(e,A,I),c=A=>e.isOffsetFixed&&e.offset===0&&A.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,A.format):"",u=()=>i?Hp(e):l({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(A,I)=>i?$p(e,A):l(I?{month:A}:{month:A,day:"numeric"},"month"),m=(A,I)=>i?Wp(e,A):l(I?{weekday:A}:{weekday:A,month:"long",day:"numeric"},"weekday"),E=A=>{let I=ft.macroTokenToFormatOpts(A);return I?this.formatWithSystemDefault(e,I):A},O=A=>i?zp(e,A):l({era:A},"era"),d=A=>{switch(A){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return c({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return c({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return c({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return u();case"d":return o?l({day:"numeric"},"day"):this.num(e.day);case"dd":return o?l({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return o?l({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return o?l({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return o?l({month:"numeric"},"month"):this.num(e.month);case"MM":return o?l({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return o?l({year:"numeric"},"year"):this.num(e.year);case"yy":return o?l({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return o?l({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return o?l({year:"numeric"},"year"):this.num(e.year,6);case"G":return O("short");case"GG":return O("long");case"GGGGG":return O("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return E(A)}};return Vp(ft.parseFormat(t),d)}formatDurationFromString(e,t){let i=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},o=f=>m=>{let E=i(m);return E?this.num(f.get(E),m.length):m},l=ft.parseFormat(t),c=l.reduce((f,{literal:m,val:E})=>m?f:f.concat(E),[]),u=e.shiftTo(...c.map(i).filter(f=>f));return Vp(l,o(u))}};k();var It=class{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};k();var Kp=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function bi(...s){let e=s.reduce((t,i)=>t+i.source,"");return RegExp(`^${e}$`)}function Ei(...s){return e=>s.reduce(([t,i,o],l)=>{let[c,u,f]=l(e,o);return[fe(fe({},t),c),u||i,f]},[{},null,1]).slice(0,2)}function Ai(s,...e){if(s==null)return[null,null];for(let[t,i]of e){let o=t.exec(s);if(o)return i(o)}return[null,null]}function Jp(...s){return(e,t)=>{let i={},o;for(o=0;o<s.length;o++)i[s[o]]=Un(e[t+o]);return[i,null,t+o]}}var Zp=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,IT=`(?:${Zp.source}?(?:\\[(${Kp.source})\\])?)?`,sc=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,qp=RegExp(`${sc.source}${IT}`),ac=RegExp(`(?:T${qp.source})?`),MT=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,RT=/(\d{4})-?W(\d\d)(?:-?(\d))?/,xT=/(\d{4})-?(\d{3})/,_T=Jp("weekYear","weekNumber","weekDay"),PT=Jp("year","ordinal"),LT=/(\d{4})-(\d\d)-(\d\d)/,Yp=RegExp(`${sc.source} ?(?:${Zp.source}|(${Kp.source}))?`),DT=RegExp(`(?: ${Yp.source})?`);function yi(s,e,t){let i=s[e];return Fe(i)?t:Un(i)}function NT(s,e){return[{year:yi(s,e),month:yi(s,e+1,1),day:yi(s,e+2,1)},null,e+3]}function Si(s,e){return[{hours:yi(s,e,0),minutes:yi(s,e+1,0),seconds:yi(s,e+2,0),milliseconds:Po(s[e+3])},null,e+4]}function No(s,e){let t=!s[e]&&!s[e+1],i=Or(s[e+1],s[e+2]),o=t?null:ct.instance(i);return[{},o,e+3]}function Fo(s,e){let t=s[e]?At.create(s[e]):null;return[{},t,e+1]}var FT=RegExp(`^T?${sc.source}$`),UT=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function BT(s){let[e,t,i,o,l,c,u,f,m]=s,E=e[0]==="-",O=f&&f[0]==="-",d=(A,I=!1)=>A!==void 0&&(I||A&&E)?-A:A;return[{years:d(Xn(t)),months:d(Xn(i)),weeks:d(Xn(o)),days:d(Xn(l)),hours:d(Xn(c)),minutes:d(Xn(u)),seconds:d(Xn(f),f==="-0"),milliseconds:d(Po(m),O)}]}var kT={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function uc(s,e,t,i,o,l,c){let u={year:e.length===2?Lo(Un(e)):Un(e),month:rc.indexOf(t)+1,day:Un(i),hour:Un(o),minute:Un(l)};return c&&(u.second=Un(c)),s&&(u.weekday=s.length>3?ic.indexOf(s)+1:oc.indexOf(s)+1),u}var GT=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function HT(s){let[,e,t,i,o,l,c,u,f,m,E,O]=s,d=uc(e,o,i,t,l,c,u),A;return f?A=kT[f]:m?A=0:A=Or(E,O),[d,new ct(A)]}function WT(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var $T=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,zT=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,VT=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function jp(s){let[,e,t,i,o,l,c,u]=s;return[uc(e,o,i,t,l,c,u),ct.utcInstance]}function jT(s){let[,e,t,i,o,l,c,u]=s;return[uc(e,u,t,i,o,l,c),ct.utcInstance]}var KT=bi(MT,ac),JT=bi(RT,ac),ZT=bi(xT,ac),qT=bi(qp),Qp=Ei(NT,Si,No,Fo),YT=Ei(_T,Si,No,Fo),QT=Ei(PT,Si,No,Fo),XT=Ei(Si,No,Fo);function Xp(s){return Ai(s,[KT,Qp],[JT,YT],[ZT,QT],[qT,XT])}function em(s){return Ai(WT(s),[GT,HT])}function tm(s){return Ai(s,[$T,jp],[zT,jp],[VT,jT])}function nm(s){return Ai(s,[UT,BT])}var eO=Ei(Si);function rm(s){return Ai(s,[FT,eO])}var tO=bi(LT,DT),nO=bi(Yp),rO=Ei(Si,No,Fo);function im(s){return Ai(s,[tO,Qp],[nO,rO])}var iO="Invalid Duration",sm={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},oO=fe({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},sm),rn=146097/400,Ci=146097/4800,sO=fe({years:{quarters:4,months:12,weeks:rn/7,days:rn,hours:rn*24,minutes:rn*24*60,seconds:rn*24*60*60,milliseconds:rn*24*60*60*1e3},quarters:{months:3,weeks:rn/28,days:rn/4,hours:rn*24/4,minutes:rn*24*60/4,seconds:rn*24*60*60/4,milliseconds:rn*24*60*60*1e3/4},months:{weeks:Ci/7,days:Ci,hours:Ci*24,minutes:Ci*24*60,seconds:Ci*24*60*60,milliseconds:Ci*24*60*60*1e3}},sm),Mr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],am=Mr.slice(0).reverse();function er(s,e,t=!1){let i={values:t?e.values:fe(fe({},s.values),e.values||{}),loc:s.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||s.conversionAccuracy,matrix:e.matrix||s.matrix};return new Ue(i)}function om(s){return Math.trunc(s*1e3)/1e3}function um(s,e,t,i,o){let l=s[o][t],c=e[t]/l,u=Math.floor(c);i[o]=om(i[o]+u),e[t]=om(e[t]-u*l)}function aO(s,e){am.reduce((t,i)=>Fe(e[i])?t:(t&&um(s,e,t,e,i),i),null)}function uO(s){let e={};for(let[t,i]of Object.entries(s))i!==0&&(e[t]=i);return e}var Ue=class{constructor(e){let t=e.conversionAccuracy==="longterm"||!1,i=t?sO:oO;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||je.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return Ue.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new wt(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ue({values:vi(e,Ue.normalizeUnit),loc:je.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(An(e))return Ue.fromMillis(e);if(Ue.isDuration(e))return e;if(typeof e=="object")return Ue.fromObject(e);throw new wt(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){let[i]=nm(e);return i?Ue.fromObject(i,t):Ue.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){let[i]=rm(e);return i?Ue.fromObject(i,t):Ue.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new wt("need to specify a reason the Duration is invalid");let i=e instanceof It?e:new It(e,t);if(Ye.throwOnInvalid)throw new Xs(i);return new Ue({invalid:i})}static normalizeUnit(e){let t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new fi(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){let i=Xe(fe({},t),{floor:t.round!==!1&&t.floor!==!1});return this.isValid?ft.create(this.loc,i).formatDurationFromString(this,e):iO}toHuman(e={}){let t=Mr.map(i=>{let o=this.values[i];return Fe(o)?null:this.loc.numberFormatter(Xe(fe({style:"unit",unitDisplay:"long"},e),{unit:i.slice(0,-1)})).format(o)}).filter(i=>i);return this.loc.listFormatter(fe({type:"conjunction",style:e.listStyle||"narrow"},e)).format(t)}toObject(){return this.isValid?fe({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=hi(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let t=this.toMillis();return t<0||t>=864e5?null:(e=Xe(fe({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{includeOffset:!1}),Ae.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){var t,i;let e=(t=this.values.milliseconds)!=null?t:0;for(let o of am.slice(1))(i=this.values)!=null&&i[o]&&(e+=this.values[o]*this.matrix[o].milliseconds);return e}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e),i={};for(let o of Mr)(Qn(t.values,o)||Qn(this.values,o))&&(i[o]=t.get(o)+this.get(o));return er(this,{values:i},!0)}minus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;let t={};for(let i of Object.keys(this.values))t[i]=nc(e(this.values[i],i));return er(this,{values:t},!0)}get(e){return this[Ue.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let t=fe(fe({},this.values),vi(e,Ue.normalizeUnit));return er(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:o}={}){let c={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:o,conversionAccuracy:i};return er(this,c)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return this.valueOf()>=0?(aO(this.matrix,e),er(this,{values:e},!0)):this.negate().normalize().negate()}rescale(){if(!this.isValid)return this;let e=uO(this.normalize().shiftToAll().toObject());return er(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(c=>Ue.normalizeUnit(c));let t={},i={},o=this.toObject(),l;for(let c of Mr)if(e.indexOf(c)>=0){l=c;let u=0;for(let m in i)u+=this.matrix[m][c]*i[m],i[m]=0;An(o[c])&&(u+=o[c]);let f=Math.trunc(u);t[c]=f,i[c]=(u*1e3-f*1e3)/1e3;for(let m in o)Mr.indexOf(m)>Mr.indexOf(c)&&um(this.matrix,o,m,t,c)}else An(o[c])&&(i[c]=o[c]);for(let c in i)i[c]!==0&&(t[l]+=c===l?i[c]:i[c]/this.matrix[l][c]);return er(this,{values:t},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return er(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(i,o){return i===void 0||i===0?o===void 0||o===0:i===o}for(let i of Mr)if(!t(this.values[i],e.values[i]))return!1;return!0}};k();var Ti="Invalid Interval";function lO(s,e){return!s||!s.isValid?rt.invalid("missing or invalid start"):!e||!e.isValid?rt.invalid("missing or invalid end"):e<s?rt.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${e.toISO()}`):null}var rt=class{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new wt("need to specify a reason the Interval is invalid");let i=e instanceof It?e:new It(e,t);if(Ye.throwOnInvalid)throw new Qs(i);return new rt({invalid:i})}static fromDateTimes(e,t){let i=Oi(e),o=Oi(t),l=lO(i,o);return l==null?new rt({start:i,end:o}):l}static after(e,t){let i=Ue.fromDurationLike(t),o=Oi(e);return rt.fromDateTimes(o,o.plus(i))}static before(e,t){let i=Ue.fromDurationLike(t),o=Oi(e);return rt.fromDateTimes(o.minus(i),o)}static fromISO(e,t){let[i,o]=(e||"").split("/",2);if(i&&o){let l,c;try{l=Ae.fromISO(i,t),c=l.isValid}catch(m){c=!1}let u,f;try{u=Ae.fromISO(o,t),f=u.isValid}catch(m){f=!1}if(c&&f)return rt.fromDateTimes(l,u);if(c){let m=Ue.fromISO(o,t);if(m.isValid)return rt.after(l,m)}else if(f){let m=Ue.fromISO(i,t);if(m.isValid)return rt.before(u,m)}}return rt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let t=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(t,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?rt.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];let t=e.map(Oi).filter(c=>this.contains(c)).sort(),i=[],{s:o}=this,l=0;for(;o<this.e;){let c=t[l]||this.e,u=+c>+this.e?this.e:c;i.push(rt.fromDateTimes(o,u)),o=u,l+=1}return i}splitBy(e){let t=Ue.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:i}=this,o=1,l,c=[];for(;i<this.e;){let u=this.start.plus(t.mapUnits(f=>f*o));l=+u>+this.e?this.e:u,c.push(rt.fromDateTimes(i,l)),i=l,o+=1}return c}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:rt.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;let t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return rt.fromDateTimes(t,i)}static merge(e){let[t,i]=e.sort((o,l)=>o.s-l.s).reduce(([o,l],c)=>l?l.overlaps(c)||l.abutsStart(c)?[o,l.union(c)]:[o.concat([l]),c]:[o,c],[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0,o=[],l=e.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),c=Array.prototype.concat(...l),u=c.sort((f,m)=>f.time-m.time);for(let f of u)i+=f.type==="s"?1:-1,i===1?t=f.time:(t&&+t!=+f.time&&o.push(rt.fromDateTimes(t,f.time)),t=null);return rt.merge(o)}difference(...e){return rt.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Ti}toLocaleString(e=qn,t={}){return this.isValid?ft.create(this.s.loc.clone(t),e).formatInterval(this):Ti}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ti}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ti}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ti}toFormat(e,{separator:t=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Ti}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Ue.invalid(this.invalidReason)}mapEndpoints(e){return rt.fromDateTimes(e(this.s),e(this.e))}};k();var Bn=class{static hasDST(e=Ye.defaultZone){let t=Ae.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return At.isValidZone(e)}static normalizeZone(e){return hn(e,Ye.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:o=null,outputCalendar:l="gregory"}={}){return(o||je.create(t,i,l)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:o=null,outputCalendar:l="gregory"}={}){return(o||je.create(t,i,l)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:o=null}={}){return(o||je.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:o=null}={}){return(o||je.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return je.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return je.create(t,null,"gregory").eras(e)}static features(){return{relative:oa()}}};k();function lm(s,e){let t=o=>o.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=t(e)-t(s);return Math.floor(Ue.fromMillis(i).as("days"))}function cO(s,e,t){let i=[["years",(f,m)=>m.year-f.year],["quarters",(f,m)=>m.quarter-f.quarter+(m.year-f.year)*4],["months",(f,m)=>m.month-f.month+(m.year-f.year)*12],["weeks",(f,m)=>{let E=lm(f,m);return(E-E%7)/7}],["days",lm]],o={},l=s,c,u;for(let[f,m]of i)t.indexOf(f)>=0&&(c=f,o[f]=m(s,e),u=l.plus(o),u>e?(o[f]--,s=l.plus(o),s>e&&(u=s,o[f]--,s=l.plus(o))):s=u);return[s,o,u,c]}function cm(s,e,t,i){let[o,l,c,u]=cO(s,e,t),f=e-o,m=t.filter(O=>["hours","minutes","seconds","milliseconds"].indexOf(O)>=0);m.length===0&&(c<e&&(c=o.plus({[u]:1})),c!==o&&(l[u]=(l[u]||0)+f/(c-o)));let E=Ue.fromObject(l,i);return m.length>0?Ue.fromMillis(f,i).shiftTo(...m).plus(E):E}k();k();var lc={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},fm={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},fO=lc.hanidec.replace(/[\[|\]]/g,"").split("");function dm(s){let e=parseInt(s,10);if(isNaN(e)){e="";for(let t=0;t<s.length;t++){let i=s.charCodeAt(t);if(s[t].search(lc.hanidec)!==-1)e+=fO.indexOf(s[t]);else for(let o in fm){let[l,c]=fm[o];i>=l&&i<=c&&(e+=i-l)}}return parseInt(e,10)}else return e}function on({numberingSystem:s},e=""){return new RegExp(`${lc[s||"latn"]}${e}`)}var dO="missing Intl.DateTimeFormat.formatToParts support";function Ze(s,e=t=>t){return{regex:s,deser:([t])=>e(dm(t))}}var hO=String.fromCharCode(160),mm=`[ ${hO}]`,gm=new RegExp(mm,"g");function pO(s){return s.replace(/\./g,"\\.?").replace(gm,mm)}function hm(s){return s.replace(/\./g,"").replace(gm," ").toLowerCase()}function pn(s,e){return s===null?null:{regex:RegExp(s.map(pO).join("|")),deser:([t])=>s.findIndex(i=>hm(t)===hm(i))+e}}function pm(s,e){return{regex:s,deser:([,t,i])=>Or(t,i),groups:e}}function sa(s){return{regex:s,deser:([e])=>e}}function mO(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function gO(s,e){let t=on(e),i=on(e,"{2}"),o=on(e,"{3}"),l=on(e,"{4}"),c=on(e,"{6}"),u=on(e,"{1,2}"),f=on(e,"{1,3}"),m=on(e,"{1,6}"),E=on(e,"{1,9}"),O=on(e,"{2,4}"),d=on(e,"{4,6}"),A=T=>({regex:RegExp(mO(T.val)),deser:([S])=>S,literal:!0}),x=(T=>{if(s.literal)return A(T);switch(T.val){case"G":return pn(e.eras("short"),0);case"GG":return pn(e.eras("long"),0);case"y":return Ze(m);case"yy":return Ze(O,Lo);case"yyyy":return Ze(l);case"yyyyy":return Ze(d);case"yyyyyy":return Ze(c);case"M":return Ze(u);case"MM":return Ze(i);case"MMM":return pn(e.months("short",!0),1);case"MMMM":return pn(e.months("long",!0),1);case"L":return Ze(u);case"LL":return Ze(i);case"LLL":return pn(e.months("short",!1),1);case"LLLL":return pn(e.months("long",!1),1);case"d":return Ze(u);case"dd":return Ze(i);case"o":return Ze(f);case"ooo":return Ze(o);case"HH":return Ze(i);case"H":return Ze(u);case"hh":return Ze(i);case"h":return Ze(u);case"mm":return Ze(i);case"m":return Ze(u);case"q":return Ze(u);case"qq":return Ze(i);case"s":return Ze(u);case"ss":return Ze(i);case"S":return Ze(f);case"SSS":return Ze(o);case"u":return sa(E);case"uu":return sa(u);case"uuu":return Ze(t);case"a":return pn(e.meridiems(),0);case"kkkk":return Ze(l);case"kk":return Ze(O,Lo);case"W":return Ze(u);case"WW":return Ze(i);case"E":case"c":return Ze(t);case"EEE":return pn(e.weekdays("short",!1),1);case"EEEE":return pn(e.weekdays("long",!1),1);case"ccc":return pn(e.weekdays("short",!0),1);case"cccc":return pn(e.weekdays("long",!0),1);case"Z":case"ZZ":return pm(new RegExp(`([+-]${u.source})(?::(${i.source}))?`),2);case"ZZZ":return pm(new RegExp(`([+-]${u.source})(${i.source})?`),2);case"z":return sa(/[a-z_+-/]{1,256}?/i);case" ":return sa(/[^\S\n\r]/);default:return A(T)}})(s)||{invalidReason:dO};return x.token=s,x}var vO={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function yO(s,e,t){let{type:i,value:o}=s;if(i==="literal"){let f=/^\s+$/.test(o);return{literal:!f,val:f?" ":o}}let l=e[i],c=i;i==="hour"&&(e.hour12!=null?c=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?c="hour12":c="hour24":c=t.hour12?"hour12":"hour24");let u=vO[c];if(typeof u=="object"&&(u=u[l]),u)return{literal:!1,val:u}}function bO(s){return[`^${s.map(t=>t.regex).reduce((t,i)=>`${t}(${i.source})`,"")}$`,s]}function EO(s,e,t){let i=s.match(e);if(i){let o={},l=1;for(let c in t)if(Qn(t,c)){let u=t[c],f=u.groups?u.groups+1:1;!u.literal&&u.token&&(o[u.token.val[0]]=u.deser(i.slice(l,l+f))),l+=f}return[i,o]}else return[i,{}]}function AO(s){let e=l=>{switch(l){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},t=null,i;return Fe(s.z)||(t=At.create(s.z)),Fe(s.Z)||(t||(t=new ct(s.Z)),i=s.Z),Fe(s.q)||(s.M=(s.q-1)*3+1),Fe(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),Fe(s.u)||(s.S=Po(s.u)),[Object.keys(s).reduce((l,c)=>{let u=e(c);return u&&(l[u]=s[c]),l},{}),t,i]}var cc=null;function SO(){return cc||(cc=Ae.fromMillis(1555555555555)),cc}function CO(s,e){if(s.literal)return s;let t=ft.macroTokenToFormatOpts(s.val),i=hc(t,e);return i==null||i.includes(void 0)?s:i}function fc(s,e){return Array.prototype.concat(...s.map(t=>CO(t,e)))}function dc(s,e,t){let i=fc(ft.parseFormat(t),s),o=i.map(c=>gO(c,s)),l=o.find(c=>c.invalidReason);if(l)return{input:e,tokens:i,invalidReason:l.invalidReason};{let[c,u]=bO(o),f=RegExp(c,"i"),[m,E]=EO(e,f,u),[O,d,A]=E?AO(E):[null,null,void 0];if(Qn(E,"a")&&Qn(E,"H"))throw new Fn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:f,rawMatches:m,matches:E,result:O,zone:d,specificOffset:A}}}function vm(s,e,t){let{result:i,zone:o,specificOffset:l,invalidReason:c}=dc(s,e,t);return[i,o,l,c]}function hc(s,e){if(!s)return null;let i=ft.create(e,s).dtFormatter(SO()),o=i.formatToParts(),l=i.resolvedOptions();return o.map(c=>yO(c,s,l))}k();var ym=[0,31,59,90,120,151,181,212,243,273,304,334],bm=[0,31,60,91,121,152,182,213,244,274,305,335];function sn(s,e){return new It("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${s}, which is invalid`)}function Em(s,e,t){let i=new Date(Date.UTC(s,e-1,t));s<100&&s>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);let o=i.getUTCDay();return o===0?7:o}function Am(s,e,t){return t+(wr(s)?bm:ym)[e-1]}function Sm(s,e){let t=wr(s)?bm:ym,i=t.findIndex(l=>l<e),o=e-t[i];return{month:i+1,day:o}}function aa(s){let{year:e,month:t,day:i}=s,o=Am(e,t,i),l=Em(e,t,i),c=Math.floor((o-l+10)/7),u;return c<1?(u=e-1,c=gi(u)):c>gi(e)?(u=e+1,c=1):u=e,fe({weekYear:u,weekNumber:c,weekday:l},Do(s))}function pc(s){let{weekYear:e,weekNumber:t,weekday:i}=s,o=Em(e,1,4),l=Ir(e),c=t*7+i-o-3,u;c<1?(u=e-1,c+=Ir(u)):c>l?(u=e+1,c-=Ir(e)):u=e;let{month:f,day:m}=Sm(u,c);return fe({year:u,month:f,day:m},Do(s))}function ua(s){let{year:e,month:t,day:i}=s,o=Am(e,t,i);return fe({year:e,ordinal:o},Do(s))}function mc(s){let{year:e,ordinal:t}=s,{month:i,day:o}=Sm(e,t);return fe({year:e,month:i,day:o},Do(s))}function Cm(s){let e=_o(s.weekYear),t=Sn(s.weekNumber,1,gi(s.weekYear)),i=Sn(s.weekday,1,7);return e?t?i?!1:sn("weekday",s.weekday):sn("week",s.week):sn("weekYear",s.weekYear)}function Tm(s){let e=_o(s.year),t=Sn(s.ordinal,1,Ir(s.year));return e?t?!1:sn("ordinal",s.ordinal):sn("year",s.year)}function gc(s){let e=_o(s.year),t=Sn(s.month,1,12),i=Sn(s.day,1,mi(s.year,s.month));return e?t?i?!1:sn("day",s.day):sn("month",s.month):sn("year",s.year)}function vc(s){let{hour:e,minute:t,second:i,millisecond:o}=s,l=Sn(e,0,23)||e===24&&t===0&&i===0&&o===0,c=Sn(t,0,59),u=Sn(i,0,59),f=Sn(o,0,999);return l?c?u?f?!1:sn("millisecond",o):sn("second",i):sn("minute",t):sn("hour",e)}var yc="Invalid DateTime",Om=864e13;function la(s){return new It("unsupported zone",`the zone "${s.name}" is not supported`)}function bc(s){return s.weekData===null&&(s.weekData=aa(s.c)),s.weekData}function Rr(s,e){let t={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Ae(Xe(fe(fe({},t),e),{old:t}))}function Pm(s,e,t){let i=s-e*60*1e3,o=t.offset(i);if(e===o)return[i,e];i-=(o-e)*60*1e3;let l=t.offset(i);return o===l?[i,o]:[s-Math.min(o,l)*60*1e3,Math.max(o,l)]}function ca(s,e){s+=e*60*1e3;let t=new Date(s);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function da(s,e,t){return Pm(di(s),e,t)}function wm(s,e){let t=s.o,i=s.c.year+Math.trunc(e.years),o=s.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,l=Xe(fe({},s.c),{year:i,month:o,day:Math.min(s.c.day,mi(i,o))+Math.trunc(e.days)+Math.trunc(e.weeks)*7}),c=Ue.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),u=di(l),[f,m]=Pm(u,t,s.zone);return c!==0&&(f+=c,m=s.zone.offset(f)),{ts:f,o:m}}function Uo(s,e,t,i,o,l){let{setZone:c,zone:u}=t;if(s&&Object.keys(s).length!==0||e){let f=e||u,m=Ae.fromObject(s,Xe(fe({},t),{zone:f,specificOffset:l}));return c?m:m.setZone(u)}else return Ae.invalid(new It("unparsable",`the input "${o}" can't be parsed as ${i}`))}function fa(s,e,t=!0){return s.isValid?ft.create(je.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(s,e):null}function Ec(s,e){let t=s.c.year>9999||s.c.year<0,i="";return t&&s.c.year>=0&&(i+="+"),i+=lt(s.c.year,t?6:4),e?(i+="-",i+=lt(s.c.month),i+="-",i+=lt(s.c.day)):(i+=lt(s.c.month),i+=lt(s.c.day)),i}function Im(s,e,t,i,o,l){let c=lt(s.c.hour);return e?(c+=":",c+=lt(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(c+=":")):c+=lt(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(c+=lt(s.c.second),(s.c.millisecond!==0||!i)&&(c+=".",c+=lt(s.c.millisecond,3))),o&&(s.isOffsetFixed&&s.offset===0&&!l?c+="Z":s.o<0?(c+="-",c+=lt(Math.trunc(-s.o/60)),c+=":",c+=lt(Math.trunc(-s.o%60))):(c+="+",c+=lt(Math.trunc(s.o/60)),c+=":",c+=lt(Math.trunc(s.o%60)))),l&&(c+="["+s.zone.ianaName+"]"),c}var Lm={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},TO={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},OO={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Dm=["year","month","day","hour","minute","second","millisecond"],wO=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],IO=["year","ordinal","hour","minute","second","millisecond"];function Mm(s){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!e)throw new fi(s);return e}function Rm(s,e){let t=hn(e.zone,Ye.defaultZone),i=je.fromObject(e),o=Ye.now(),l,c;if(Fe(s.year))l=o;else{for(let m of Dm)Fe(s[m])&&(s[m]=Lm[m]);let u=gc(s)||vc(s);if(u)return Ae.invalid(u);let f=t.offset(o);[l,c]=da(s,f,t)}return new Ae({ts:l,zone:t,loc:i,o:c})}function xm(s,e,t){let i=Fe(t.round)?!0:t.round,o=(c,u)=>(c=hi(c,i||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(c,u)),l=c=>t.calendary?e.hasSame(s,c)?0:e.startOf(c).diff(s.startOf(c),c).get(c):e.diff(s,c).get(c);if(t.unit)return o(l(t.unit),t.unit);for(let c of t.units){let u=l(c);if(Math.abs(u)>=1)return o(u,c)}return o(s>e?-0:0,t.units[t.units.length-1])}function _m(s){let e={},t;return s.length>0&&typeof s[s.length-1]=="object"?(e=s[s.length-1],t=Array.from(s).slice(0,s.length-1)):t=Array.from(s),[e,t]}var Ae=class{constructor(e){let t=e.zone||Ye.defaultZone,i=e.invalid||(Number.isNaN(e.ts)?new It("invalid input"):null)||(t.isValid?null:la(t));this.ts=Fe(e.ts)?Ye.now():e.ts;let o=null,l=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[o,l]=[e.old.c,e.old.o];else{let u=t.offset(this.ts);o=ca(this.ts,u),i=Number.isNaN(o.year)?new It("invalid input"):null,o=i?null:o,l=i?null:u}this._zone=t,this.loc=e.loc||je.create(),this.invalid=i,this.weekData=null,this.c=o,this.o=l,this.isLuxonDateTime=!0}static now(){return new Ae({})}static local(){let[e,t]=_m(arguments),[i,o,l,c,u,f,m]=t;return Rm({year:i,month:o,day:l,hour:c,minute:u,second:f,millisecond:m},e)}static utc(){let[e,t]=_m(arguments),[i,o,l,c,u,f,m]=t;return e.zone=ct.utcInstance,Rm({year:i,month:o,day:l,hour:c,minute:u,second:f,millisecond:m},e)}static fromJSDate(e,t={}){let i=Bp(e)?e.valueOf():NaN;if(Number.isNaN(i))return Ae.invalid("invalid input");let o=hn(t.zone,Ye.defaultZone);return o.isValid?new Ae({ts:i,zone:o,loc:je.fromObject(t)}):Ae.invalid(la(o))}static fromMillis(e,t={}){if(An(e))return e<-Om||e>Om?Ae.invalid("Timestamp out of range"):new Ae({ts:e,zone:hn(t.zone,Ye.defaultZone),loc:je.fromObject(t)});throw new wt(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(An(e))return new Ae({ts:e*1e3,zone:hn(t.zone,Ye.defaultZone),loc:je.fromObject(t)});throw new wt("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};let i=hn(t.zone,Ye.defaultZone);if(!i.isValid)return Ae.invalid(la(i));let o=Ye.now(),l=Fe(t.specificOffset)?i.offset(o):t.specificOffset,c=vi(e,Mm),u=!Fe(c.ordinal),f=!Fe(c.year),m=!Fe(c.month)||!Fe(c.day),E=f||m,O=c.weekYear||c.weekNumber,d=je.fromObject(t);if((E||u)&&O)throw new Fn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&u)throw new Fn("Can't mix ordinal dates with month/day");let A=O||c.weekday&&!E,I,x,T=ca(o,l);A?(I=wO,x=TO,T=aa(T)):u?(I=IO,x=OO,T=ua(T)):(I=Dm,x=Lm);let S=!1;for(let C of I){let M=c[C];Fe(M)?S?c[C]=x[C]:c[C]=T[C]:S=!0}let w=A?Cm(c):u?Tm(c):gc(c),p=w||vc(c);if(p)return Ae.invalid(p);let y=A?pc(c):u?mc(c):c,[g,v]=da(y,l,i),h=new Ae({ts:g,zone:i,o:v,loc:d});return c.weekday&&E&&e.weekday!==h.weekday?Ae.invalid("mismatched weekday",`you can't specify both a weekday of ${c.weekday} and a date of ${h.toISO()}`):h}static fromISO(e,t={}){let[i,o]=Xp(e);return Uo(i,o,t,"ISO 8601",e)}static fromRFC2822(e,t={}){let[i,o]=em(e);return Uo(i,o,t,"RFC 2822",e)}static fromHTTP(e,t={}){let[i,o]=tm(e);return Uo(i,o,t,"HTTP",t)}static fromFormat(e,t,i={}){if(Fe(e)||Fe(t))throw new wt("fromFormat requires an input string and a format");let{locale:o=null,numberingSystem:l=null}=i,c=je.fromOpts({locale:o,numberingSystem:l,defaultToEN:!0}),[u,f,m,E]=vm(c,e,t);return E?Ae.invalid(E):Uo(u,f,i,`format ${t}`,e,m)}static fromString(e,t,i={}){return Ae.fromFormat(e,t,i)}static fromSQL(e,t={}){let[i,o]=im(e);return Uo(i,o,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new wt("need to specify a reason the DateTime is invalid");let i=e instanceof It?e:new It(e,t);if(Ye.throwOnInvalid)throw new Ys(i);return new Ae({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){let i=hc(e,je.fromObject(t));return i?i.map(o=>o?o.val:null).join(""):null}static expandFormat(e,t={}){return fc(ft.parseFormat(e),je.fromObject(t)).map(o=>o.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?bc(this).weekYear:NaN}get weekNumber(){return this.isValid?bc(this).weekNumber:NaN}get weekday(){return this.isValid?bc(this).weekday:NaN}get ordinal(){return this.isValid?ua(this.c).ordinal:NaN}get monthShort(){return this.isValid?Bn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Bn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Bn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Bn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,t=6e4,i=di(this.c),o=this.zone.offset(i-e),l=this.zone.offset(i+e),c=this.zone.offset(i-o*t),u=this.zone.offset(i-l*t);if(c===u)return[this];let f=i-c*t,m=i-u*t,E=ca(f,c),O=ca(m,u);return E.hour===O.hour&&E.minute===O.minute&&E.second===O.second&&E.millisecond===O.millisecond?[Rr(this,{ts:f}),Rr(this,{ts:m})]:[this]}get isInLeapYear(){return wr(this.year)}get daysInMonth(){return mi(this.year,this.month)}get daysInYear(){return this.isValid?Ir(this.year):NaN}get weeksInWeekYear(){return this.isValid?gi(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:t,numberingSystem:i,calendar:o}=ft.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:o}}toUTC(e=0,t={}){return this.setZone(ct.instance(e),t)}toLocal(){return this.setZone(Ye.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if(e=hn(e,Ye.defaultZone),e.equals(this.zone))return this;if(e.isValid){let o=this.ts;if(t||i){let l=e.offset(this.ts),c=this.toObject();[o]=da(c,l,e)}return Rr(this,{ts:o,zone:e})}else return Ae.invalid(la(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){let o=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i});return Rr(this,{loc:o})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let t=vi(e,Mm),i=!Fe(t.weekYear)||!Fe(t.weekNumber)||!Fe(t.weekday),o=!Fe(t.ordinal),l=!Fe(t.year),c=!Fe(t.month)||!Fe(t.day),u=l||c,f=t.weekYear||t.weekNumber;if((u||o)&&f)throw new Fn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&o)throw new Fn("Can't mix ordinal dates with month/day");let m;i?m=pc(fe(fe({},aa(this.c)),t)):Fe(t.ordinal)?(m=fe(fe({},this.toObject()),t),Fe(t.day)&&(m.day=Math.min(mi(m.year,m.month),m.day))):m=mc(fe(fe({},ua(this.c)),t));let[E,O]=da(m,this.o,this.zone);return Rr(this,{ts:E,o:O})}plus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e);return Rr(this,wm(this,t))}minus(e){if(!this.isValid)return this;let t=Ue.fromDurationLike(e).negate();return Rr(this,wm(this,t))}startOf(e){if(!this.isValid)return this;let t={},i=Ue.normalizeUnit(e);switch(i){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break;case"milliseconds":break}if(i==="weeks"&&(t.weekday=1),i==="quarters"){let o=Math.ceil(this.month/3);t.month=(o-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?ft.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):yc}toLocaleString(e=qn,t={}){return this.isValid?ft.create(this.loc.clone(t),e).formatDateTime(this):yc}toLocaleParts(e={}){return this.isValid?ft.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:o=!0,extendedZone:l=!1}={}){if(!this.isValid)return null;let c=e==="extended",u=Ec(this,c);return u+="T",u+=Im(this,c,t,i,o,l),u}toISODate({format:e="extended"}={}){return this.isValid?Ec(this,e==="extended"):null}toISOWeekDate(){return fa(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:o=!1,extendedZone:l=!1,format:c="extended"}={}){return this.isValid?(o?"T":"")+Im(this,c==="extended",t,e,i,l):null}toRFC2822(){return fa(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return fa(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Ec(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let o="HH:mm:ss.SSS";return(t||e)&&(i&&(o+=" "),t?o+="z":e&&(o+="ZZ")),fa(this,o,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():yc}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let t=fe({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return Ue.invalid("created by diffing an invalid DateTime");let o=fe({locale:this.locale,numberingSystem:this.numberingSystem},i),l=kp(t).map(Ue.normalizeUnit),c=e.valueOf()>this.valueOf(),u=c?this:e,f=c?e:this,m=cm(u,f,l,o);return c?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(Ae.now(),e,t)}until(e){return this.isValid?rt.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;let i=e.valueOf(),o=this.setZone(e.zone,{keepLocalTime:!0});return o.startOf(t)<=i&&i<=o.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let t=e.base||Ae.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0,o=["years","months","days","hours","minutes","seconds"],l=e.unit;return Array.isArray(e.unit)&&(o=e.unit,l=void 0),xm(t,this.plus(i),Xe(fe({},e),{numeric:"always",units:o,unit:l}))}toRelativeCalendar(e={}){return this.isValid?xm(e.base||Ae.fromObject({},{zone:this.zone}),this,Xe(fe({},e),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...e){if(!e.every(Ae.isDateTime))throw new wt("min requires all arguments be DateTimes");return tc(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(Ae.isDateTime))throw new wt("max requires all arguments be DateTimes");return tc(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,i={}){let{locale:o=null,numberingSystem:l=null}=i,c=je.fromOpts({locale:o,numberingSystem:l,defaultToEN:!0});return dc(c,e,t)}static fromStringExplain(e,t,i={}){return Ae.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return qn}static get DATE_MED(){return co}static get DATE_MED_WITH_WEEKDAY(){return kl}static get DATE_FULL(){return fo}static get DATE_HUGE(){return ho}static get TIME_SIMPLE(){return po}static get TIME_WITH_SECONDS(){return mo}static get TIME_WITH_SHORT_OFFSET(){return go}static get TIME_WITH_LONG_OFFSET(){return vo}static get TIME_24_SIMPLE(){return yo}static get TIME_24_WITH_SECONDS(){return bo}static get TIME_24_WITH_SHORT_OFFSET(){return Eo}static get TIME_24_WITH_LONG_OFFSET(){return Ao}static get DATETIME_SHORT(){return So}static get DATETIME_SHORT_WITH_SECONDS(){return Co}static get DATETIME_MED(){return To}static get DATETIME_MED_WITH_SECONDS(){return Oo}static get DATETIME_MED_WITH_WEEKDAY(){return Gl}static get DATETIME_FULL(){return wo}static get DATETIME_FULL_WITH_SECONDS(){return Io}static get DATETIME_HUGE(){return Mo}static get DATETIME_HUGE_WITH_SECONDS(){return Ro}};function Oi(s){if(Ae.isDateTime(s))return s;if(s&&s.valueOf&&An(s.valueOf()))return Ae.fromJSDate(s);if(s&&typeof s=="object")return Ae.fromObject(s);throw new wt(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var Nm=ze(xe),MO=[Nm.styles,Ml],xr=class extends Nm{constructor(){super();this.updateComment=({detail:t})=>{let{text:i}=t;this.text=i,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,text:i})};this.resolveAnnotation=()=>{this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly"};this.resolved=!1}render(){var A;let t=this.annotationFilter==="all"?"resolve":"undo",i=I=>Ae.fromISO(I).toFormat("yyyy-dd-MM"),o=this.resolvable?"comment-item__resolve":"hidden",l=[{label:"EDIT"},{label:"DELETE"}],c=({detail:I})=>{I==="EDIT"&&(this.mode="editable"),I==="DELETE"&&(this.deleteCommentModalOpen=!0)},u=()=>{this.text.length<120||(this.expandElipsis=!0)},f=()=>{if(this.mode==="editable")return ye`
        <superviz-comments-comment-input
          class="comment-item--editable"
          editable
          text=${this.text}
          eventType="update-comment"
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{if(this.mode!=="editable")return ye`
        <span
          id="comment-text"
          @click=${u}
          class="text text-big sv-gray-700 ${d}"
          >${this.text}</span
        >
      `},E=()=>{this.deleteCommentModalOpen=!1},O={"comment-item":!0,reply:!this.primaryComment},d=!this.expandElipsis&&this.text.length>120?"line-clamp":"";return ye`
      <div class=${Et(O)}>
        <div class="comment-item__user">
          <div class="comment-item__user-details">
            <div class="comment-item__avatar">
              <p class="text text-bold">${((A=this.username[0])==null?void 0:A.toUpperCase())||"A"}</p>
            </div>
            <span class="text text-bold sv-gray-600">${this.username}</span>
            <span class="text text-small sv-gray-500">${i(this.createdAt)}</span>
          </div>
          <button
            @click=${this.resolveAnnotation}
            class="icon-button icon-button--clickable icon-button--xsmall ${o}"
          >
            <superviz-icon name=${t} size="md"></superviz-icon>
          </button>
          <superviz-dropdown
            options=${JSON.stringify(l)}
            label="label"
            returnTo="label"
            position="bottom-right"
            @selected=${c}
          >
            <button slot="dropdown" class="icon-button icon-button--clickable icon-button--small">
              <superviz-icon name="more" size="sm"></superviz-icon>
            </button>
          </superviz-dropdown>
        </div>

        <div class="comment-item__content">
          <div class="comment-item__content__body">${f()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${E}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};xr.styles=MO,xr.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String}},xr=He([We("superviz-comments-comment-item")],xr);k();var Fm=ze(xe),RO=[Fm.styles,xl],_r=class extends Fm{constructor(){super();this.pinCoordinates=null;this.getCommentInput=()=>this.shadowRoot.getElementById("comment-input--textarea");this.getCommentInputContainer=()=>this.shadowRoot.getElementById("comment-input--container");this.getSendBtn=()=>this.shadowRoot.querySelector(".comment-input--send-btn");this.commentInputFocus=({detail:t})=>{this.pinCoordinates=t,this.getCommentInput().focus()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1})};this.btnActive=!1,this.text=""}connectedCallback(){super.connectedCallback(),this.eventType==="create-annotation"&&window.document.body.addEventListener("comment-input-focus",this.commentInputFocus)}disconnectedCallback(){super.disconnectedCallback(),this.eventType==="create-annotation"&&window.document.body.removeEventListener("comment-input-focus",this.commentInputFocus)}updated(t){if(t.has("text")&&this.text.length>0){let i=this.getCommentInput();i.value=this.text,this.updateHeight()}if(t.has("btnActive")){let i=this.getSendBtn();i.disabled=!this.btnActive}}updateHeight(){let t=this.getCommentInput(),i=this.getCommentInputContainer();t.style.height="0px",i.style.height="0px";let o=t.scrollHeight+4,l=t.scrollHeight;t.style.height=`${o}px`,i.style.height=`${l}px`;let c=this.getSendBtn();c.disabled=!(t.value.length>0)}send(t){var c,u,f,m,E,O,d,A;t.preventDefault();let i=this.getCommentInput(),o=this.getSendBtn(),l=i.value;this.emitEvent(this.eventType,{text:l,position:{x:(u=(c=this.pinCoordinates)==null?void 0:c.x)!=null?u:null,y:(m=(f=this.pinCoordinates)==null?void 0:f.y)!=null?m:null,z:(O=(E=this.pinCoordinates)==null?void 0:E.z)!=null?O:null,type:(A=(d=this.pinCoordinates)==null?void 0:d.type)!=null?A:null}},{composed:!1,bubbles:!1}),this.pinCoordinates=null,i.value="",o.disabled=!0,this.updateHeight()}render(){let t=()=>{if(!!this.editable)return ye`
        <button
          id="close"
          @click=${()=>this.closeEditMode()}
          class="icon-button icon-button--medium icon-button--clickable"
          @click=${this.send}
        >
          <superviz-icon name="close" size="md"></superviz-icon>
        </button>
        <button id="confirm" class="comment-input--send-btn" disabled @click=${this.send}>
          <superviz-icon name="check" size="md"></superviz-icon>
        </button>
      `},i=()=>{if(!this.editable)return ye`
        <button class="comment-input--send-btn align-send-btn" disabled @click=${this.send}>
          <superviz-icon name="send" size="sm"></superviz-icon>
        </button>
      `};return ye`
      <div class="comment-input">
        <div id="comment-input--container">
          <textarea
            id="comment-input--textarea"
            placeholder="Add comment..."
            @input=${this.updateHeight}
          ></textarea>
        </div>
        <div class="sv-hr"></div>
        <div class="comment-input--options">
          <div>
            <button class="icon-button mention">
              <superviz-icon name="mention" size="sm"></superviz-icon>
            </button>
          </div>
          <div class="comment-input-options">
            ${i()} ${t()}
          </div>
        </div>
      </div>
    `}};_r.styles=RO,_r.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean}},_r=He([We("superviz-comments-comment-input")],_r);k();var Um=ze(xe),xO=[Um.styles,Ll],Pr=class extends Um{constructor(){super();this.position={x:0,y:0}}get userInitial(){var i,o,l;return(((l=(o=(i=this.annotation)==null?void 0:i.comments[0])==null?void 0:o.participant)==null?void 0:l.name)||"Anonymous")[0].toUpperCase()}emitClick(){document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:this.annotation.uuid}}))}render(){var i,o;let t={"annotation-pin":!0,"annotation-pin--active":this.active};return this.type==="add"?ye`
        <div
          class=${Et(t)}
          style=${`top: ${this.position.y}px; left: ${this.position.x}px;`}
        >
          <div class="annotation-pin__avatar annotation-pin__avatar--add">
            <superviz-icon name="add"></superviz-icon>
          </div>
        </div>
      `:ye`
      <div
        @click=${this.emitClick}
        class=${Et(t)}
        style=${`top: ${(i=this.position)==null?void 0:i.y}px; left: ${(o=this.position)==null?void 0:o.x}px;`}
      >
        <div class="annotation-pin__avatar">
          <p class="text text-bold text-big">${this.userInitial}</p>
          <!-- <img src="https://picsum.photos/200/300" alt="" /> -->
        </div>
      </div>
    `}};Pr.styles=xO,Pr.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean}},Pr=He([We("superviz-comments-annotation-pin")],Pr);k();var Bm=ze(xe),_O=[Bm.styles,_l],Lr=class extends Bm{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))}}firstUpdated(){this.resolved=this.annotation.resolved}updated(t){if(t.has("selected")){let i=this.selected===this.annotation.uuid;this.expandComments=i}}createComment({detail:t}){let{text:i}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,text:i})}render(){var T,S,w,p,y,g,v;let t=this.annotationFilter==="all",i=this.annotationFilter==="resolved",o=(T=this.annotation.comments)==null?void 0:T.length,l=this.selected===this.annotation.uuid,c={"annotation-item":!0,"annotation-item--selected":l},u={hidden:this.resolved&&t||!this.resolved&&i},f={"sv-hr":!0,hidden:this.isLastAnnotation},m={"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&o>1,hidden:!(!this.expandComments&&o>1)},E={"comments-container":!0,"comment-item--expand":l&&this.expandComments,hidden:!(l&&this.expandComments)},O=({detail:h})=>{let{uuid:C}=this.annotation,{resolved:M,type:L}=h,$=L==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=M,this.emitEvent("resolve-annotation",{uuid:C,resolved:M}),$&&(this.shouldShowUndoResolved=!0)},d=()=>{this.shouldShowUndoResolved=!1},A=()=>{let h=o>=5?5:o,C=o-1>5?"last-reply":"",M=o-1>1?"replies":"reply",L=[];for(let $=0;$<h;$++)L.push(ye`
          <div class="avatar avatar-divs-${$}">
            <img src="https://picsum.photos/200/300" />
          </div>
        `);return ye`
        ${L}
        <div class="avatar-divs-${h} replies ${C} text text-big sv-gray-500">
          ${o-1} ${M}
        </div>
      `},I=(h,C)=>C===0?ye``:ye`
        <superviz-comments-comment-item
          uuid=${h.uuid}
          avatar="https://picsum.photos/200/300"
          username=${h.participant.name||"Anonymous"}
          text=${h.text}
          createdAt=${h.createdAt}
        ></superviz-comments-comment-item>
      `;return ye`
      ${(()=>this.shouldShowUndoResolved?ye`
        <superviz-comments-annotation-resolved
          @undo-resolve=${O}
          @hide=${d}
          class=${Et({hidden:i})}
        >
        </superviz-comments-annotation-resolved>
      `:ye``)()}

      <div class=${Et(u)}>
        <div class=${Et(c)} @click=${this.selectAnnotation}>
          <div>
            <superviz-comments-comment-item
              uuid=${(S=this.annotation.comments)==null?void 0:S[0].uuid}
              annotationId=${this.annotation.uuid}
              username=${((p=(w=this.annotation.comments)==null?void 0:w[0].participant)==null?void 0:p.name)||"Anonymous"}
              text=${(y=this.annotation.comments)==null?void 0:y[0].text}
              createdAt=${(g=this.annotation.comments)==null?void 0:g[0].createdAt}
              primaryComment
              resolvable
              ?resolved=${this.resolved}
              annotationFilter=${this.annotationFilter}
              @resolve-annotation=${O}
            ></superviz-comments-comment-item>

            <div class=${Et(m)}>
              <div class="avatar-container">${A()}</div>
            </div>
          </div>

          <div class=${Et(E)}>
            ${(v=this.annotation.comments)==null?void 0:v.map(I)}
            <superviz-comments-comment-input
              @create-comment=${this.createComment}
              eventType="create-comment"
            ></superviz-comments-comment-input>
          </div>
        </div>
        <div class=${Et(f)}></div>
      </div>
    `}};Lr.styles=_O,Lr.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String}},Lr=He([We("superviz-comments-annotation-item")],Lr);k();var km=ze(xe),PO=[km.styles],Dr=class extends km{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:ye`<span class="text text-big sv-gray-600">Are you sure you want to delete this comment? <br /> This action cannot be undone</span>`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return ye`<slot name="modal-handler" @click=${this.toggle}></slot>`},i=()=>{if(!!this.open)return ye`
        <superviz-modal></superviz-modal>
      `};return ye`
      ${t()}
      ${i()}
    `}};Dr.styles=PO,Dr.properties={open:{type:Boolean},useSlot:{type:Boolean}},Dr=He([We("superviz-comments-delete-comments-modal")],Dr);k();var Gm=ze(xe),LO=[Gm.styles,Pl],DO=10*1e3,Nr=class extends Gm{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=DO,this.isCanceled=!1}firstUpdated(){this.setTimer()}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?ye``:this.isCanceled?ye``:ye`
      <div class="annotation-resolved">
        <span class="text text-big sv-gray-700">You resolve this comment</span>
        <button id="undone" @click=${this.undone} class="icon-button icon-button--clickable icon-button--medium">
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};Nr.styles=LO,Nr.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},Nr=He([We("superviz-comments-annotation-resolved")],Nr);k();var Hm=ze(xe),NO=[Hm.styles,Dl],Bo=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],Fr=class extends Hm{constructor(){super();this.caret="down"}render(){let t=this.filter==="all"?Bo[0].label:Bo[1].label,i=({detail:u})=>{this.emitEvent("select",{filter:u}),o()},o=()=>{this.caret=this.caret==="down"?"up":"down"},l=this.filter==="all"?Bo[0].code:Bo[1].code,c={text:!0,"text-bold":!0,"select-content":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return ye`
      <div class="select">
        <div class="select-container">
          <superviz-dropdown 
            options=${JSON.stringify(Bo)}
            active=${l}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${o}
            @selected=${i}
            @close=${o}
          >
            <div class="content" slot="dropdown">
              <span class=${Et(c)}>${t}</span>
              <superviz-icon name=${this.caret} size="md"></superviz-icon>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};Fr.styles=NO,Fr.properties={filter:{type:String},caret:{type:String}},Fr=He([We("superviz-comments-annotation-filter")],Fr);k();var Wm=ze(xe),FO=[Wm.styles,Nl],wi=class extends Wm{toggle(){this.emitEvent("toggle",{})}render(){return ye` <button @click=${this.toggle} class="float-button">
      <superviz-icon name="comment"></superviz-icon>

      <p class="text text-big text-bold">Comments</p>
    </button>`}};wi.styles=FO,wi=He([We("superviz-comments-button")],wi);k();k();function $m(s){if(typeof document!="undefined"){let e=document.createElement("style");e.id="superviz-style";let t=document.createTextNode(s);e.appendChild(t),document.head.appendChild(e)}}var zm=`@import"https://unpkg.com/@superviz/sv-icons@0.8.7/css/style.css";html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}
`;$m(zm);k();k();k();k();window&&(window.SuperVizSdk={init:rl,MeetingEvent:zi,DeviceEvent:Uu,RealtimeEvent:fr,MeetingState:Rs,MeetingConnectionStatus:ji,MeetingControlsEvent:Ms,ParticipantEvent:xs,FrameEvent:Vi,LayoutMode:Ns,VideoComponent:eo,MousePointers:to,Realtime:no,Comments:Zi,CanvasPin:qi});var kD=rl;export{Qi as BrowserService,Uu as DeviceEvent,Vi as FrameEvent,Ns as LayoutMode,ji as MeetingConnectionStatus,Ms as MeetingControlsEvent,zi as MeetingEvent,Rs as MeetingState,Oe as Observer,xs as ParticipantEvent,Hs as ParticipantType,Fs as PinMode,fr as RealtimeEvent,kD as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
