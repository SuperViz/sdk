var Qv=Object.create;var Zr=Object.defineProperty,qv=Object.defineProperties,Yv=Object.getOwnPropertyDescriptor,Xv=Object.getOwnPropertyDescriptors,Zv=Object.getOwnPropertyNames,vu=Object.getOwnPropertySymbols,tm=Object.getPrototypeOf,yu=Object.prototype.hasOwnProperty,em=Object.prototype.propertyIsEnumerable;var mu=(p,f,r)=>f in p?Zr(p,f,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[f]=r,Bt=(p,f)=>{for(var r in f||(f={}))yu.call(f,r)&&mu(p,r,f[r]);if(vu)for(var r of vu(f))em.call(f,r)&&mu(p,r,f[r]);return p},Ue=(p,f)=>qv(p,Xv(f));var Io=(p,f)=>()=>(p&&(f=p(p=0)),f);var qt=(p,f)=>()=>(f||p((f={exports:{}}).exports,f),f.exports),Cu=(p,f)=>{for(var r in f)Zr(p,r,{get:f[r],enumerable:!0})},nm=(p,f,r,c)=>{if(f&&typeof f=="object"||typeof f=="function")for(let s of Zv(f))!yu.call(p,s)&&s!==r&&Zr(p,s,{get:()=>f[s],enumerable:!(c=Yv(f,s))||c.enumerable});return p};var bn=(p,f,r)=>(r=p!=null?Qv(tm(p)):{},nm(f||!p||!p.__esModule?Zr(r,"default",{value:p,enumerable:!0}):r,p));var Gt=(p,f,r)=>new Promise((c,s)=>{var E=_=>{try{S(r.next(_))}catch(L){s(L)}},O=_=>{try{S(r.throw(_))}catch(L){s(L)}},S=_=>_.done?c(_.value):Promise.resolve(_.value).then(E,O);S((r=r.apply(p,f)).next())});var bt,ut=Io(()=>{bt={}});var bu=qt((b0,Ou)=>{ut();var Gn=1e3,Fn=Gn*60,Hn=Fn*60,An=Hn*24,im=An*7,om=An*365.25;Ou.exports=function(p,f){f=f||{};var r=typeof p;if(r==="string"&&p.length>0)return sm(p);if(r==="number"&&isFinite(p))return f.long?um(p):am(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function sm(p){if(p=String(p),!(p.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(!!f){var r=parseFloat(f[1]),c=(f[2]||"ms").toLowerCase();switch(c){case"years":case"year":case"yrs":case"yr":case"y":return r*om;case"weeks":case"week":case"w":return r*im;case"days":case"day":case"d":return r*An;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Hn;case"minutes":case"minute":case"mins":case"min":case"m":return r*Fn;case"seconds":case"second":case"secs":case"sec":case"s":return r*Gn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function am(p){var f=Math.abs(p);return f>=An?Math.round(p/An)+"d":f>=Hn?Math.round(p/Hn)+"h":f>=Fn?Math.round(p/Fn)+"m":f>=Gn?Math.round(p/Gn)+"s":p+"ms"}function um(p){var f=Math.abs(p);return f>=An?ti(p,f,An,"day"):f>=Hn?ti(p,f,Hn,"hour"):f>=Fn?ti(p,f,Fn,"minute"):f>=Gn?ti(p,f,Gn,"second"):p+" ms"}function ti(p,f,r,c){var s=f>=r*1.5;return Math.round(p/r)+" "+c+(s?"s":"")}});var Ru=qt((A0,Au)=>{ut();function lm(p){r.debug=r,r.default=r,r.coerce=_,r.disable=E,r.enable=s,r.enabled=O,r.humanize=bu(),r.destroy=L,Object.keys(p).forEach(y=>{r[y]=p[y]}),r.names=[],r.skips=[],r.formatters={};function f(y){let I=0;for(let u=0;u<y.length;u++)I=(I<<5)-I+y.charCodeAt(u),I|=0;return r.colors[Math.abs(I)%r.colors.length]}r.selectColor=f;function r(y){let I,u=null,C,x;function T(...m){if(!T.enabled)return;let g=T,b=Number(new Date),a=b-(I||b);g.diff=a,g.prev=I,g.curr=b,I=b,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let h=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(o,v)=>{if(o==="%%")return"%";h++;let l=r.formatters[v];if(typeof l=="function"){let A=m[h];o=l.call(g,A),m.splice(h,1),h--}return o}),r.formatArgs.call(g,m),(g.log||r.log).apply(g,m)}return T.namespace=y,T.useColors=r.useColors(),T.color=r.selectColor(y),T.extend=c,T.destroy=r.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(C!==r.namespaces&&(C=r.namespaces,x=r.enabled(y)),x),set:m=>{u=m}}),typeof r.init=="function"&&r.init(T),T}function c(y,I){let u=r(this.namespace+(typeof I=="undefined"?":":I)+y);return u.log=this.log,u}function s(y){r.save(y),r.namespaces=y,r.names=[],r.skips=[];let I,u=(typeof y=="string"?y:"").split(/[\s,]+/),C=u.length;for(I=0;I<C;I++)!u[I]||(y=u[I].replace(/\*/g,".*?"),y[0]==="-"?r.skips.push(new RegExp("^"+y.slice(1)+"$")):r.names.push(new RegExp("^"+y+"$")))}function E(){let y=[...r.names.map(S),...r.skips.map(S).map(I=>"-"+I)].join(",");return r.enable(""),y}function O(y){if(y[y.length-1]==="*")return!0;let I,u;for(I=0,u=r.skips.length;I<u;I++)if(r.skips[I].test(y))return!1;for(I=0,u=r.names.length;I<u;I++)if(r.names[I].test(y))return!0;return!1}function S(y){return y.toString().substring(2,y.toString().length-2).replace(/\.\*\?$/,"*")}function _(y){return y instanceof Error?y.stack||y.message:y}function L(){}return r.enable(r.load()),r}Au.exports=lm});var To=qt((be,ei)=>{ut();be.formatArgs=fm;be.save=dm;be.load=hm;be.useColors=cm;be.storage=pm();be.destroy=(()=>{let p=!1;return()=>{p||(p=!0)}})();be.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function cm(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function fm(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+ei.exports.humanize(this.diff),!this.useColors)return;let f="color: "+this.color;p.splice(1,0,f,"color: inherit");let r=0,c=0;p[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(c=r))}),p.splice(c,0,f)}be.log=console.debug||console.log||(()=>{});function dm(p){try{p?be.storage.setItem("debug",p):be.storage.removeItem("debug")}catch(f){}}function hm(){let p;try{p=be.storage.getItem("debug")}catch(f){}return!p&&typeof process!="undefined"&&"env"in process&&(p=bt.DEBUG),p}function pm(){try{return localStorage}catch(p){}}ei.exports=Ru()(be);var{formatters:gm}=ei.exports;gm.j=function(p){try{return JSON.stringify(p)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}});var ni=qt((E0,Tu)=>{ut();function vm(p){var f=typeof p;return p!=null&&(f=="object"||f=="function")}Tu.exports=vm});var Su=qt((S0,Eu)=>{ut();var mm=typeof global=="object"&&global&&global.Object===Object&&global;Eu.exports=mm});var So=qt((P0,Pu)=>{ut();var ym=Su(),Cm=typeof self=="object"&&self&&self.Object===Object&&self,Om=ym||Cm||Function("return this")();Pu.exports=Om});var _u=qt((w0,wu)=>{ut();var bm=So(),Am=function(){return bm.Date.now()};wu.exports=Am});var Mu=qt((_0,xu)=>{ut();var Rm=/\s/;function Im(p){for(var f=p.length;f--&&Rm.test(p.charAt(f)););return f}xu.exports=Im});var Du=qt((x0,Lu)=>{ut();var Tm=Mu(),Em=/^\s+/;function Sm(p){return p&&p.slice(0,Tm(p)+1).replace(Em,"")}Lu.exports=Sm});var Po=qt((M0,Nu)=>{ut();var Pm=So(),wm=Pm.Symbol;Nu.exports=wm});var Fu=qt((L0,Gu)=>{ut();var Uu=Po(),Bu=Object.prototype,_m=Bu.hasOwnProperty,xm=Bu.toString,sr=Uu?Uu.toStringTag:void 0;function Mm(p){var f=_m.call(p,sr),r=p[sr];try{p[sr]=void 0;var c=!0}catch(E){}var s=xm.call(p);return c&&(f?p[sr]=r:delete p[sr]),s}Gu.exports=Mm});var Wu=qt((D0,Hu)=>{ut();var Lm=Object.prototype,Dm=Lm.toString;function Nm(p){return Dm.call(p)}Hu.exports=Nm});var Vu=qt((N0,zu)=>{ut();var ju=Po(),Um=Fu(),Bm=Wu(),Gm="[object Null]",Fm="[object Undefined]",ku=ju?ju.toStringTag:void 0;function Hm(p){return p==null?p===void 0?Fm:Gm:ku&&ku in Object(p)?Um(p):Bm(p)}zu.exports=Hm});var Ju=qt((U0,Ku)=>{ut();function Wm(p){return p!=null&&typeof p=="object"}Ku.exports=Wm});var Qu=qt((B0,$u)=>{ut();var jm=Vu(),km=Ju(),zm="[object Symbol]";function Vm(p){return typeof p=="symbol"||km(p)&&jm(p)==zm}$u.exports=Vm});var Zu=qt((G0,Xu)=>{ut();var Km=Du(),qu=ni(),Jm=Qu(),Yu=0/0,$m=/^[-+]0x[0-9a-f]+$/i,Qm=/^0b[01]+$/i,qm=/^0o[0-7]+$/i,Ym=parseInt;function Xm(p){if(typeof p=="number")return p;if(Jm(p))return Yu;if(qu(p)){var f=typeof p.valueOf=="function"?p.valueOf():p;p=qu(f)?f+"":f}if(typeof p!="string")return p===0?p:+p;p=Km(p);var r=Qm.test(p);return r||qm.test(p)?Ym(p.slice(2),r?2:8):$m.test(p)?Yu:+p}Xu.exports=Xm});var nl=qt((F0,el)=>{ut();var Zm=ni(),wo=_u(),tl=Zu(),t0="Expected a function",e0=Math.max,n0=Math.min;function r0(p,f,r){var c,s,E,O,S,_,L=0,y=!1,I=!1,u=!0;if(typeof p!="function")throw new TypeError(t0);f=tl(f)||0,Zm(r)&&(y=!!r.leading,I="maxWait"in r,E=I?e0(tl(r.maxWait)||0,f):E,u="trailing"in r?!!r.trailing:u);function C(o){var v=c,l=s;return c=s=void 0,L=o,O=p.apply(l,v),O}function x(o){return L=o,S=setTimeout(g,f),y?C(o):O}function T(o){var v=o-_,l=o-L,A=f-v;return I?n0(A,E-l):A}function m(o){var v=o-_,l=o-L;return _===void 0||v>=f||v<0||I&&l>=E}function g(){var o=wo();if(m(o))return b(o);S=setTimeout(g,T(o))}function b(o){return S=void 0,u&&c?C(o):(c=s=void 0,O)}function a(){S!==void 0&&clearTimeout(S),L=0,c=_=s=S=void 0}function h(){return S===void 0?O:b(wo())}function i(){var o=wo(),v=m(o);if(c=arguments,s=this,_=o,v){if(S===void 0)return x(_);if(I)return clearTimeout(S),S=setTimeout(g,f),C(_)}return S===void 0&&(S=setTimeout(g,f)),O}return i.cancel=a,i.flush=h,i}el.exports=r0});var _o=qt((H0,rl)=>{ut();var i0=nl(),o0=ni(),s0="Expected a function";function a0(p,f,r){var c=!0,s=!0;if(typeof p!="function")throw new TypeError(s0);return o0(r)&&(c="leading"in r?!!r.leading:c,s="trailing"in r?!!r.trailing:s),i0(p,f,{leading:c,maxWait:f,trailing:s})}rl.exports=a0});var xo=qt((Wn,ur)=>{ut();(function(){var p,f="4.17.21",r=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",E="Invalid `variable` option passed into `_.template`",O="__lodash_hash_undefined__",S=500,_="__lodash_placeholder__",L=1,y=2,I=4,u=1,C=2,x=1,T=2,m=4,g=8,b=16,a=32,h=64,i=128,o=256,v=512,l=30,A="...",U=800,k=16,j=1,N=2,P=3,M=1/0,F=9007199254740991,W=17976931348623157e292,K=0/0,X=4294967295,et=X-1,Y=X>>>1,w=[["ary",i],["bind",x],["bindKey",T],["curry",g],["curryRight",b],["flip",v],["partial",a],["partialRight",h],["rearg",o]],B="[object Arguments]",H="[object Array]",V="[object AsyncFunction]",Z="[object Boolean]",lt="[object Date]",dt="[object DOMException]",vt="[object Error]",mt="[object Function]",wt="[object GeneratorFunction]",ct="[object Map]",Dt="[object Number]",Yt="[object Null]",Wt="[object Object]",Kt="[object Promise]",xe="[object Proxy]",Ge="[object RegExp]",zt="[object Set]",Fe="[object String]",Ze="[object Symbol]",zn="[object Undefined]",fn="[object WeakMap]",si="[object WeakSet]",$="[object ArrayBuffer]",rt="[object DataView]",at="[object Float32Array]",pt="[object Float64Array]",Tt="[object Int8Array]",te="[object Int16Array]",ke="[object Int32Array]",ai="[object Uint8Array]",ui="[object Uint8ClampedArray]",li="[object Uint16Array]",ci="[object Uint32Array]",gl=/\b__p \+= '';/g,vl=/\b(__p \+=) '' \+/g,ml=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wo=/&(?:amp|lt|gt|quot|#39);/g,jo=/[&<>"']/g,yl=RegExp(Wo.source),Cl=RegExp(jo.source),Ol=/<%-([\s\S]+?)%>/g,bl=/<%([\s\S]+?)%>/g,ko=/<%=([\s\S]+?)%>/g,Al=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Rl=/^\w*$/,Il=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fi=/[\\^$.*+?()[\]{}|]/g,Tl=RegExp(fi.source),di=/^\s+/,El=/\s/,Sl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Pl=/\{\n\/\* \[wrapped with (.+)\] \*/,wl=/,? & /,_l=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,xl=/[()=,{}\[\]\/\s]/,Ml=/\\(\\)?/g,Ll=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,zo=/\w*$/,Dl=/^[-+]0x[0-9a-f]+$/i,Nl=/^0b[01]+$/i,Ul=/^\[object .+?Constructor\]$/,Bl=/^0o[0-7]+$/i,Gl=/^(?:0|[1-9]\d*)$/,Fl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fr=/($^)/,Hl=/['\n\r\u2028\u2029\\]/g,dr="\\ud800-\\udfff",Wl="\\u0300-\\u036f",jl="\\ufe20-\\ufe2f",kl="\\u20d0-\\u20ff",Vo=Wl+jl+kl,Ko="\\u2700-\\u27bf",Jo="a-z\\xdf-\\xf6\\xf8-\\xff",zl="\\xac\\xb1\\xd7\\xf7",Vl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Kl="\\u2000-\\u206f",Jl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",$o="A-Z\\xc0-\\xd6\\xd8-\\xde",Qo="\\ufe0e\\ufe0f",qo=zl+Vl+Kl+Jl,hi="['\u2019]",$l="["+dr+"]",Yo="["+qo+"]",hr="["+Vo+"]",Xo="\\d+",Ql="["+Ko+"]",Zo="["+Jo+"]",ts="[^"+dr+qo+Xo+Ko+Jo+$o+"]",pi="\\ud83c[\\udffb-\\udfff]",ql="(?:"+hr+"|"+pi+")",es="[^"+dr+"]",gi="(?:\\ud83c[\\udde6-\\uddff]){2}",vi="[\\ud800-\\udbff][\\udc00-\\udfff]",Tn="["+$o+"]",ns="\\u200d",rs="(?:"+Zo+"|"+ts+")",Yl="(?:"+Tn+"|"+ts+")",is="(?:"+hi+"(?:d|ll|m|re|s|t|ve))?",os="(?:"+hi+"(?:D|LL|M|RE|S|T|VE))?",ss=ql+"?",as="["+Qo+"]?",Xl="(?:"+ns+"(?:"+[es,gi,vi].join("|")+")"+as+ss+")*",Zl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",tc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",us=as+ss+Xl,ec="(?:"+[Ql,gi,vi].join("|")+")"+us,nc="(?:"+[es+hr+"?",hr,gi,vi,$l].join("|")+")",rc=RegExp(hi,"g"),ic=RegExp(hr,"g"),mi=RegExp(pi+"(?="+pi+")|"+nc+us,"g"),oc=RegExp([Tn+"?"+Zo+"+"+is+"(?="+[Yo,Tn,"$"].join("|")+")",Yl+"+"+os+"(?="+[Yo,Tn+rs,"$"].join("|")+")",Tn+"?"+rs+"+"+is,Tn+"+"+os,tc,Zl,Xo,ec].join("|"),"g"),sc=RegExp("["+ns+dr+Vo+Qo+"]"),ac=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,uc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lc=-1,jt={};jt[at]=jt[pt]=jt[Tt]=jt[te]=jt[ke]=jt[ai]=jt[ui]=jt[li]=jt[ci]=!0,jt[B]=jt[H]=jt[$]=jt[Z]=jt[rt]=jt[lt]=jt[vt]=jt[mt]=jt[ct]=jt[Dt]=jt[Wt]=jt[Ge]=jt[zt]=jt[Fe]=jt[fn]=!1;var Ht={};Ht[B]=Ht[H]=Ht[$]=Ht[rt]=Ht[Z]=Ht[lt]=Ht[at]=Ht[pt]=Ht[Tt]=Ht[te]=Ht[ke]=Ht[ct]=Ht[Dt]=Ht[Wt]=Ht[Ge]=Ht[zt]=Ht[Fe]=Ht[Ze]=Ht[ai]=Ht[ui]=Ht[li]=Ht[ci]=!0,Ht[vt]=Ht[mt]=Ht[fn]=!1;var cc={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},fc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},hc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},pc=parseFloat,gc=parseInt,ls=typeof global=="object"&&global&&global.Object===Object&&global,vc=typeof self=="object"&&self&&self.Object===Object&&self,ee=ls||vc||Function("return this")(),yi=typeof Wn=="object"&&Wn&&!Wn.nodeType&&Wn,dn=yi&&typeof ur=="object"&&ur&&!ur.nodeType&&ur,cs=dn&&dn.exports===yi,Ci=cs&&ls.process,Re=function(){try{var Q=dn&&dn.require&&dn.require("util").types;return Q||Ci&&Ci.binding&&Ci.binding("util")}catch(nt){}}(),fs=Re&&Re.isArrayBuffer,ds=Re&&Re.isDate,hs=Re&&Re.isMap,ps=Re&&Re.isRegExp,gs=Re&&Re.isSet,vs=Re&&Re.isTypedArray;function ge(Q,nt,tt){switch(tt.length){case 0:return Q.call(nt);case 1:return Q.call(nt,tt[0]);case 2:return Q.call(nt,tt[0],tt[1]);case 3:return Q.call(nt,tt[0],tt[1],tt[2])}return Q.apply(nt,tt)}function mc(Q,nt,tt,ht){for(var At=-1,Lt=Q==null?0:Q.length;++At<Lt;){var Xt=Q[At];nt(ht,Xt,tt(Xt),Q)}return ht}function Ie(Q,nt){for(var tt=-1,ht=Q==null?0:Q.length;++tt<ht&&nt(Q[tt],tt,Q)!==!1;);return Q}function yc(Q,nt){for(var tt=Q==null?0:Q.length;tt--&&nt(Q[tt],tt,Q)!==!1;);return Q}function ms(Q,nt){for(var tt=-1,ht=Q==null?0:Q.length;++tt<ht;)if(!nt(Q[tt],tt,Q))return!1;return!0}function tn(Q,nt){for(var tt=-1,ht=Q==null?0:Q.length,At=0,Lt=[];++tt<ht;){var Xt=Q[tt];nt(Xt,tt,Q)&&(Lt[At++]=Xt)}return Lt}function pr(Q,nt){var tt=Q==null?0:Q.length;return!!tt&&En(Q,nt,0)>-1}function Oi(Q,nt,tt){for(var ht=-1,At=Q==null?0:Q.length;++ht<At;)if(tt(nt,Q[ht]))return!0;return!1}function kt(Q,nt){for(var tt=-1,ht=Q==null?0:Q.length,At=Array(ht);++tt<ht;)At[tt]=nt(Q[tt],tt,Q);return At}function en(Q,nt){for(var tt=-1,ht=nt.length,At=Q.length;++tt<ht;)Q[At+tt]=nt[tt];return Q}function bi(Q,nt,tt,ht){var At=-1,Lt=Q==null?0:Q.length;for(ht&&Lt&&(tt=Q[++At]);++At<Lt;)tt=nt(tt,Q[At],At,Q);return tt}function Cc(Q,nt,tt,ht){var At=Q==null?0:Q.length;for(ht&&At&&(tt=Q[--At]);At--;)tt=nt(tt,Q[At],At,Q);return tt}function Ai(Q,nt){for(var tt=-1,ht=Q==null?0:Q.length;++tt<ht;)if(nt(Q[tt],tt,Q))return!0;return!1}var Oc=Ri("length");function bc(Q){return Q.split("")}function Ac(Q){return Q.match(_l)||[]}function ys(Q,nt,tt){var ht;return tt(Q,function(At,Lt,Xt){if(nt(At,Lt,Xt))return ht=Lt,!1}),ht}function gr(Q,nt,tt,ht){for(var At=Q.length,Lt=tt+(ht?1:-1);ht?Lt--:++Lt<At;)if(nt(Q[Lt],Lt,Q))return Lt;return-1}function En(Q,nt,tt){return nt===nt?Dc(Q,nt,tt):gr(Q,Cs,tt)}function Rc(Q,nt,tt,ht){for(var At=tt-1,Lt=Q.length;++At<Lt;)if(ht(Q[At],nt))return At;return-1}function Cs(Q){return Q!==Q}function Os(Q,nt){var tt=Q==null?0:Q.length;return tt?Ti(Q,nt)/tt:K}function Ri(Q){return function(nt){return nt==null?p:nt[Q]}}function Ii(Q){return function(nt){return Q==null?p:Q[nt]}}function bs(Q,nt,tt,ht,At){return At(Q,function(Lt,Xt,Ft){tt=ht?(ht=!1,Lt):nt(tt,Lt,Xt,Ft)}),tt}function Ic(Q,nt){var tt=Q.length;for(Q.sort(nt);tt--;)Q[tt]=Q[tt].value;return Q}function Ti(Q,nt){for(var tt,ht=-1,At=Q.length;++ht<At;){var Lt=nt(Q[ht]);Lt!==p&&(tt=tt===p?Lt:tt+Lt)}return tt}function Ei(Q,nt){for(var tt=-1,ht=Array(Q);++tt<Q;)ht[tt]=nt(tt);return ht}function Tc(Q,nt){return kt(nt,function(tt){return[tt,Q[tt]]})}function As(Q){return Q&&Q.slice(0,Es(Q)+1).replace(di,"")}function ve(Q){return function(nt){return Q(nt)}}function Si(Q,nt){return kt(nt,function(tt){return Q[tt]})}function Vn(Q,nt){return Q.has(nt)}function Rs(Q,nt){for(var tt=-1,ht=Q.length;++tt<ht&&En(nt,Q[tt],0)>-1;);return tt}function Is(Q,nt){for(var tt=Q.length;tt--&&En(nt,Q[tt],0)>-1;);return tt}function Ec(Q,nt){for(var tt=Q.length,ht=0;tt--;)Q[tt]===nt&&++ht;return ht}var Sc=Ii(cc),Pc=Ii(fc);function wc(Q){return"\\"+hc[Q]}function _c(Q,nt){return Q==null?p:Q[nt]}function Sn(Q){return sc.test(Q)}function xc(Q){return ac.test(Q)}function Mc(Q){for(var nt,tt=[];!(nt=Q.next()).done;)tt.push(nt.value);return tt}function Pi(Q){var nt=-1,tt=Array(Q.size);return Q.forEach(function(ht,At){tt[++nt]=[At,ht]}),tt}function Ts(Q,nt){return function(tt){return Q(nt(tt))}}function nn(Q,nt){for(var tt=-1,ht=Q.length,At=0,Lt=[];++tt<ht;){var Xt=Q[tt];(Xt===nt||Xt===_)&&(Q[tt]=_,Lt[At++]=tt)}return Lt}function vr(Q){var nt=-1,tt=Array(Q.size);return Q.forEach(function(ht){tt[++nt]=ht}),tt}function Lc(Q){var nt=-1,tt=Array(Q.size);return Q.forEach(function(ht){tt[++nt]=[ht,ht]}),tt}function Dc(Q,nt,tt){for(var ht=tt-1,At=Q.length;++ht<At;)if(Q[ht]===nt)return ht;return-1}function Nc(Q,nt,tt){for(var ht=tt+1;ht--;)if(Q[ht]===nt)return ht;return ht}function Pn(Q){return Sn(Q)?Bc(Q):Oc(Q)}function Me(Q){return Sn(Q)?Gc(Q):bc(Q)}function Es(Q){for(var nt=Q.length;nt--&&El.test(Q.charAt(nt)););return nt}var Uc=Ii(dc);function Bc(Q){for(var nt=mi.lastIndex=0;mi.test(Q);)++nt;return nt}function Gc(Q){return Q.match(mi)||[]}function Fc(Q){return Q.match(oc)||[]}var Hc=function Q(nt){nt=nt==null?ee:rn.defaults(ee.Object(),nt,rn.pick(ee,uc));var tt=nt.Array,ht=nt.Date,At=nt.Error,Lt=nt.Function,Xt=nt.Math,Ft=nt.Object,wi=nt.RegExp,Wc=nt.String,Te=nt.TypeError,mr=tt.prototype,jc=Lt.prototype,wn=Ft.prototype,yr=nt["__core-js_shared__"],Cr=jc.toString,Ut=wn.hasOwnProperty,kc=0,Ss=function(){var t=/[^.]+$/.exec(yr&&yr.keys&&yr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Or=wn.toString,zc=Cr.call(Ft),Vc=ee._,Kc=wi("^"+Cr.call(Ut).replace(fi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),br=cs?nt.Buffer:p,on=nt.Symbol,Ar=nt.Uint8Array,Ps=br?br.allocUnsafe:p,Rr=Ts(Ft.getPrototypeOf,Ft),ws=Ft.create,_s=wn.propertyIsEnumerable,Ir=mr.splice,xs=on?on.isConcatSpreadable:p,Kn=on?on.iterator:p,hn=on?on.toStringTag:p,Tr=function(){try{var t=yn(Ft,"defineProperty");return t({},"",{}),t}catch(e){}}(),Jc=nt.clearTimeout!==ee.clearTimeout&&nt.clearTimeout,$c=ht&&ht.now!==ee.Date.now&&ht.now,Qc=nt.setTimeout!==ee.setTimeout&&nt.setTimeout,Er=Xt.ceil,Sr=Xt.floor,_i=Ft.getOwnPropertySymbols,qc=br?br.isBuffer:p,Ms=nt.isFinite,Yc=mr.join,Xc=Ts(Ft.keys,Ft),Zt=Xt.max,oe=Xt.min,Zc=ht.now,tf=nt.parseInt,Ls=Xt.random,ef=mr.reverse,xi=yn(nt,"DataView"),Jn=yn(nt,"Map"),Mi=yn(nt,"Promise"),_n=yn(nt,"Set"),$n=yn(nt,"WeakMap"),Qn=yn(Ft,"create"),Pr=$n&&new $n,xn={},nf=Cn(xi),rf=Cn(Jn),of=Cn(Mi),sf=Cn(_n),af=Cn($n),wr=on?on.prototype:p,qn=wr?wr.valueOf:p,Ds=wr?wr.toString:p;function D(t){if(Jt(t)&&!Rt(t)&&!(t instanceof _t)){if(t instanceof Ee)return t;if(Ut.call(t,"__wrapped__"))return Na(t)}return new Ee(t)}var Mn=function(){function t(){}return function(e){if(!Vt(e))return{};if(ws)return ws(e);t.prototype=e;var n=new t;return t.prototype=p,n}}();function _r(){}function Ee(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=p}D.templateSettings={escape:Ol,evaluate:bl,interpolate:ko,variable:"",imports:{_:D}},D.prototype=_r.prototype,D.prototype.constructor=D,Ee.prototype=Mn(_r.prototype),Ee.prototype.constructor=Ee;function _t(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function uf(){var t=new _t(this.__wrapped__);return t.__actions__=fe(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=fe(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=fe(this.__views__),t}function lf(){if(this.__filtered__){var t=new _t(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function cf(){var t=this.__wrapped__.value(),e=this.__dir__,n=Rt(t),d=e<0,R=n?t.length:0,G=Ad(0,R,this.__views__),z=G.start,J=G.end,q=J-z,it=d?J:z-1,ot=this.__iteratees__,st=ot.length,ft=0,gt=oe(q,this.__takeCount__);if(!n||!d&&R==q&&gt==q)return ia(t,this.__actions__);var Ct=[];t:for(;q--&&ft<gt;){it+=e;for(var Et=-1,Ot=t[it];++Et<st;){var Pt=ot[Et],xt=Pt.iteratee,Ce=Pt.type,ce=xt(Ot);if(Ce==N)Ot=ce;else if(!ce){if(Ce==j)continue t;break t}}Ct[ft++]=Ot}return Ct}_t.prototype=Mn(_r.prototype),_t.prototype.constructor=_t;function pn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var d=t[e];this.set(d[0],d[1])}}function ff(){this.__data__=Qn?Qn(null):{},this.size=0}function df(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function hf(t){var e=this.__data__;if(Qn){var n=e[t];return n===O?p:n}return Ut.call(e,t)?e[t]:p}function pf(t){var e=this.__data__;return Qn?e[t]!==p:Ut.call(e,t)}function gf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Qn&&e===p?O:e,this}pn.prototype.clear=ff,pn.prototype.delete=df,pn.prototype.get=hf,pn.prototype.has=pf,pn.prototype.set=gf;function ze(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var d=t[e];this.set(d[0],d[1])}}function vf(){this.__data__=[],this.size=0}function mf(t){var e=this.__data__,n=xr(e,t);if(n<0)return!1;var d=e.length-1;return n==d?e.pop():Ir.call(e,n,1),--this.size,!0}function yf(t){var e=this.__data__,n=xr(e,t);return n<0?p:e[n][1]}function Cf(t){return xr(this.__data__,t)>-1}function Of(t,e){var n=this.__data__,d=xr(n,t);return d<0?(++this.size,n.push([t,e])):n[d][1]=e,this}ze.prototype.clear=vf,ze.prototype.delete=mf,ze.prototype.get=yf,ze.prototype.has=Cf,ze.prototype.set=Of;function Ve(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var d=t[e];this.set(d[0],d[1])}}function bf(){this.size=0,this.__data__={hash:new pn,map:new(Jn||ze),string:new pn}}function Af(t){var e=kr(this,t).delete(t);return this.size-=e?1:0,e}function Rf(t){return kr(this,t).get(t)}function If(t){return kr(this,t).has(t)}function Tf(t,e){var n=kr(this,t),d=n.size;return n.set(t,e),this.size+=n.size==d?0:1,this}Ve.prototype.clear=bf,Ve.prototype.delete=Af,Ve.prototype.get=Rf,Ve.prototype.has=If,Ve.prototype.set=Tf;function gn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ve;++e<n;)this.add(t[e])}function Ef(t){return this.__data__.set(t,O),this}function Sf(t){return this.__data__.has(t)}gn.prototype.add=gn.prototype.push=Ef,gn.prototype.has=Sf;function Le(t){var e=this.__data__=new ze(t);this.size=e.size}function Pf(){this.__data__=new ze,this.size=0}function wf(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function _f(t){return this.__data__.get(t)}function xf(t){return this.__data__.has(t)}function Mf(t,e){var n=this.__data__;if(n instanceof ze){var d=n.__data__;if(!Jn||d.length<r-1)return d.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ve(d)}return n.set(t,e),this.size=n.size,this}Le.prototype.clear=Pf,Le.prototype.delete=wf,Le.prototype.get=_f,Le.prototype.has=xf,Le.prototype.set=Mf;function Ns(t,e){var n=Rt(t),d=!n&&On(t),R=!n&&!d&&cn(t),G=!n&&!d&&!R&&Un(t),z=n||d||R||G,J=z?Ei(t.length,Wc):[],q=J.length;for(var it in t)(e||Ut.call(t,it))&&!(z&&(it=="length"||R&&(it=="offset"||it=="parent")||G&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||Qe(it,q)))&&J.push(it);return J}function Us(t){var e=t.length;return e?t[ki(0,e-1)]:p}function Lf(t,e){return zr(fe(t),vn(e,0,t.length))}function Df(t){return zr(fe(t))}function Li(t,e,n){(n!==p&&!De(t[e],n)||n===p&&!(e in t))&&Ke(t,e,n)}function Yn(t,e,n){var d=t[e];(!(Ut.call(t,e)&&De(d,n))||n===p&&!(e in t))&&Ke(t,e,n)}function xr(t,e){for(var n=t.length;n--;)if(De(t[n][0],e))return n;return-1}function Nf(t,e,n,d){return sn(t,function(R,G,z){e(d,R,n(R),z)}),d}function Bs(t,e){return t&&We(e,ne(e),t)}function Uf(t,e){return t&&We(e,he(e),t)}function Ke(t,e,n){e=="__proto__"&&Tr?Tr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Di(t,e){for(var n=-1,d=e.length,R=tt(d),G=t==null;++n<d;)R[n]=G?p:go(t,e[n]);return R}function vn(t,e,n){return t===t&&(n!==p&&(t=t<=n?t:n),e!==p&&(t=t>=e?t:e)),t}function Se(t,e,n,d,R,G){var z,J=e&L,q=e&y,it=e&I;if(n&&(z=R?n(t,d,R,G):n(t)),z!==p)return z;if(!Vt(t))return t;var ot=Rt(t);if(ot){if(z=Id(t),!J)return fe(t,z)}else{var st=se(t),ft=st==mt||st==wt;if(cn(t))return aa(t,J);if(st==Wt||st==B||ft&&!R){if(z=q||ft?{}:Ea(t),!J)return q?hd(t,Uf(z,t)):dd(t,Bs(z,t))}else{if(!Ht[st])return R?t:{};z=Td(t,st,J)}}G||(G=new Le);var gt=G.get(t);if(gt)return gt;G.set(t,z),eu(t)?t.forEach(function(Ot){z.add(Se(Ot,e,n,Ot,t,G))}):Za(t)&&t.forEach(function(Ot,Pt){z.set(Pt,Se(Ot,e,n,Pt,t,G))});var Ct=it?q?to:Zi:q?he:ne,Et=ot?p:Ct(t);return Ie(Et||t,function(Ot,Pt){Et&&(Pt=Ot,Ot=t[Pt]),Yn(z,Pt,Se(Ot,e,n,Pt,t,G))}),z}function Bf(t){var e=ne(t);return function(n){return Gs(n,t,e)}}function Gs(t,e,n){var d=n.length;if(t==null)return!d;for(t=Ft(t);d--;){var R=n[d],G=e[R],z=t[R];if(z===p&&!(R in t)||!G(z))return!1}return!0}function Fs(t,e,n){if(typeof t!="function")throw new Te(s);return ir(function(){t.apply(p,n)},e)}function Xn(t,e,n,d){var R=-1,G=pr,z=!0,J=t.length,q=[],it=e.length;if(!J)return q;n&&(e=kt(e,ve(n))),d?(G=Oi,z=!1):e.length>=r&&(G=Vn,z=!1,e=new gn(e));t:for(;++R<J;){var ot=t[R],st=n==null?ot:n(ot);if(ot=d||ot!==0?ot:0,z&&st===st){for(var ft=it;ft--;)if(e[ft]===st)continue t;q.push(ot)}else G(e,st,d)||q.push(ot)}return q}var sn=da(He),Hs=da(Ui,!0);function Gf(t,e){var n=!0;return sn(t,function(d,R,G){return n=!!e(d,R,G),n}),n}function Mr(t,e,n){for(var d=-1,R=t.length;++d<R;){var G=t[d],z=e(G);if(z!=null&&(J===p?z===z&&!ye(z):n(z,J)))var J=z,q=G}return q}function Ff(t,e,n,d){var R=t.length;for(n=It(n),n<0&&(n=-n>R?0:R+n),d=d===p||d>R?R:It(d),d<0&&(d+=R),d=n>d?0:ru(d);n<d;)t[n++]=e;return t}function Ws(t,e){var n=[];return sn(t,function(d,R,G){e(d,R,G)&&n.push(d)}),n}function re(t,e,n,d,R){var G=-1,z=t.length;for(n||(n=Sd),R||(R=[]);++G<z;){var J=t[G];e>0&&n(J)?e>1?re(J,e-1,n,d,R):en(R,J):d||(R[R.length]=J)}return R}var Ni=ha(),js=ha(!0);function He(t,e){return t&&Ni(t,e,ne)}function Ui(t,e){return t&&js(t,e,ne)}function Lr(t,e){return tn(e,function(n){return qe(t[n])})}function mn(t,e){e=un(e,t);for(var n=0,d=e.length;t!=null&&n<d;)t=t[je(e[n++])];return n&&n==d?t:p}function ks(t,e,n){var d=e(t);return Rt(t)?d:en(d,n(t))}function ue(t){return t==null?t===p?zn:Yt:hn&&hn in Ft(t)?bd(t):Dd(t)}function Bi(t,e){return t>e}function Hf(t,e){return t!=null&&Ut.call(t,e)}function Wf(t,e){return t!=null&&e in Ft(t)}function jf(t,e,n){return t>=oe(e,n)&&t<Zt(e,n)}function Gi(t,e,n){for(var d=n?Oi:pr,R=t[0].length,G=t.length,z=G,J=tt(G),q=1/0,it=[];z--;){var ot=t[z];z&&e&&(ot=kt(ot,ve(e))),q=oe(ot.length,q),J[z]=!n&&(e||R>=120&&ot.length>=120)?new gn(z&&ot):p}ot=t[0];var st=-1,ft=J[0];t:for(;++st<R&&it.length<q;){var gt=ot[st],Ct=e?e(gt):gt;if(gt=n||gt!==0?gt:0,!(ft?Vn(ft,Ct):d(it,Ct,n))){for(z=G;--z;){var Et=J[z];if(!(Et?Vn(Et,Ct):d(t[z],Ct,n)))continue t}ft&&ft.push(Ct),it.push(gt)}}return it}function kf(t,e,n,d){return He(t,function(R,G,z){e(d,n(R),G,z)}),d}function Zn(t,e,n){e=un(e,t),t=_a(t,e);var d=t==null?t:t[je(we(e))];return d==null?p:ge(d,t,n)}function zs(t){return Jt(t)&&ue(t)==B}function zf(t){return Jt(t)&&ue(t)==$}function Vf(t){return Jt(t)&&ue(t)==lt}function tr(t,e,n,d,R){return t===e?!0:t==null||e==null||!Jt(t)&&!Jt(e)?t!==t&&e!==e:Kf(t,e,n,d,tr,R)}function Kf(t,e,n,d,R,G){var z=Rt(t),J=Rt(e),q=z?H:se(t),it=J?H:se(e);q=q==B?Wt:q,it=it==B?Wt:it;var ot=q==Wt,st=it==Wt,ft=q==it;if(ft&&cn(t)){if(!cn(e))return!1;z=!0,ot=!1}if(ft&&!ot)return G||(G=new Le),z||Un(t)?Ra(t,e,n,d,R,G):Cd(t,e,q,n,d,R,G);if(!(n&u)){var gt=ot&&Ut.call(t,"__wrapped__"),Ct=st&&Ut.call(e,"__wrapped__");if(gt||Ct){var Et=gt?t.value():t,Ot=Ct?e.value():e;return G||(G=new Le),R(Et,Ot,n,d,G)}}return ft?(G||(G=new Le),Od(t,e,n,d,R,G)):!1}function Jf(t){return Jt(t)&&se(t)==ct}function Fi(t,e,n,d){var R=n.length,G=R,z=!d;if(t==null)return!G;for(t=Ft(t);R--;){var J=n[R];if(z&&J[2]?J[1]!==t[J[0]]:!(J[0]in t))return!1}for(;++R<G;){J=n[R];var q=J[0],it=t[q],ot=J[1];if(z&&J[2]){if(it===p&&!(q in t))return!1}else{var st=new Le;if(d)var ft=d(it,ot,q,t,e,st);if(!(ft===p?tr(ot,it,u|C,d,st):ft))return!1}}return!0}function Vs(t){if(!Vt(t)||wd(t))return!1;var e=qe(t)?Kc:Ul;return e.test(Cn(t))}function $f(t){return Jt(t)&&ue(t)==Ge}function Qf(t){return Jt(t)&&se(t)==zt}function qf(t){return Jt(t)&&qr(t.length)&&!!jt[ue(t)]}function Ks(t){return typeof t=="function"?t:t==null?pe:typeof t=="object"?Rt(t)?Qs(t[0],t[1]):$s(t):pu(t)}function Hi(t){if(!rr(t))return Xc(t);var e=[];for(var n in Ft(t))Ut.call(t,n)&&n!="constructor"&&e.push(n);return e}function Yf(t){if(!Vt(t))return Ld(t);var e=rr(t),n=[];for(var d in t)d=="constructor"&&(e||!Ut.call(t,d))||n.push(d);return n}function Wi(t,e){return t<e}function Js(t,e){var n=-1,d=de(t)?tt(t.length):[];return sn(t,function(R,G,z){d[++n]=e(R,G,z)}),d}function $s(t){var e=no(t);return e.length==1&&e[0][2]?Pa(e[0][0],e[0][1]):function(n){return n===t||Fi(n,t,e)}}function Qs(t,e){return io(t)&&Sa(e)?Pa(je(t),e):function(n){var d=go(n,t);return d===p&&d===e?vo(n,t):tr(e,d,u|C)}}function Dr(t,e,n,d,R){t!==e&&Ni(e,function(G,z){if(R||(R=new Le),Vt(G))Xf(t,e,z,n,Dr,d,R);else{var J=d?d(so(t,z),G,z+"",t,e,R):p;J===p&&(J=G),Li(t,z,J)}},he)}function Xf(t,e,n,d,R,G,z){var J=so(t,n),q=so(e,n),it=z.get(q);if(it){Li(t,n,it);return}var ot=G?G(J,q,n+"",t,e,z):p,st=ot===p;if(st){var ft=Rt(q),gt=!ft&&cn(q),Ct=!ft&&!gt&&Un(q);ot=q,ft||gt||Ct?Rt(J)?ot=J:$t(J)?ot=fe(J):gt?(st=!1,ot=aa(q,!0)):Ct?(st=!1,ot=ua(q,!0)):ot=[]:or(q)||On(q)?(ot=J,On(J)?ot=iu(J):(!Vt(J)||qe(J))&&(ot=Ea(q))):st=!1}st&&(z.set(q,ot),R(ot,q,d,G,z),z.delete(q)),Li(t,n,ot)}function qs(t,e){var n=t.length;if(!!n)return e+=e<0?n:0,Qe(e,n)?t[e]:p}function Ys(t,e,n){e.length?e=kt(e,function(G){return Rt(G)?function(z){return mn(z,G.length===1?G[0]:G)}:G}):e=[pe];var d=-1;e=kt(e,ve(yt()));var R=Js(t,function(G,z,J){var q=kt(e,function(it){return it(G)});return{criteria:q,index:++d,value:G}});return Ic(R,function(G,z){return fd(G,z,n)})}function Zf(t,e){return Xs(t,e,function(n,d){return vo(t,d)})}function Xs(t,e,n){for(var d=-1,R=e.length,G={};++d<R;){var z=e[d],J=mn(t,z);n(J,z)&&er(G,un(z,t),J)}return G}function td(t){return function(e){return mn(e,t)}}function ji(t,e,n,d){var R=d?Rc:En,G=-1,z=e.length,J=t;for(t===e&&(e=fe(e)),n&&(J=kt(t,ve(n)));++G<z;)for(var q=0,it=e[G],ot=n?n(it):it;(q=R(J,ot,q,d))>-1;)J!==t&&Ir.call(J,q,1),Ir.call(t,q,1);return t}function Zs(t,e){for(var n=t?e.length:0,d=n-1;n--;){var R=e[n];if(n==d||R!==G){var G=R;Qe(R)?Ir.call(t,R,1):Ki(t,R)}}return t}function ki(t,e){return t+Sr(Ls()*(e-t+1))}function ed(t,e,n,d){for(var R=-1,G=Zt(Er((e-t)/(n||1)),0),z=tt(G);G--;)z[d?G:++R]=t,t+=n;return z}function zi(t,e){var n="";if(!t||e<1||e>F)return n;do e%2&&(n+=t),e=Sr(e/2),e&&(t+=t);while(e);return n}function St(t,e){return ao(wa(t,e,pe),t+"")}function nd(t){return Us(Bn(t))}function rd(t,e){var n=Bn(t);return zr(n,vn(e,0,n.length))}function er(t,e,n,d){if(!Vt(t))return t;e=un(e,t);for(var R=-1,G=e.length,z=G-1,J=t;J!=null&&++R<G;){var q=je(e[R]),it=n;if(q==="__proto__"||q==="constructor"||q==="prototype")return t;if(R!=z){var ot=J[q];it=d?d(ot,q,J):p,it===p&&(it=Vt(ot)?ot:Qe(e[R+1])?[]:{})}Yn(J,q,it),J=J[q]}return t}var ta=Pr?function(t,e){return Pr.set(t,e),t}:pe,id=Tr?function(t,e){return Tr(t,"toString",{configurable:!0,enumerable:!1,value:yo(e),writable:!0})}:pe;function od(t){return zr(Bn(t))}function Pe(t,e,n){var d=-1,R=t.length;e<0&&(e=-e>R?0:R+e),n=n>R?R:n,n<0&&(n+=R),R=e>n?0:n-e>>>0,e>>>=0;for(var G=tt(R);++d<R;)G[d]=t[d+e];return G}function sd(t,e){var n;return sn(t,function(d,R,G){return n=e(d,R,G),!n}),!!n}function Nr(t,e,n){var d=0,R=t==null?d:t.length;if(typeof e=="number"&&e===e&&R<=Y){for(;d<R;){var G=d+R>>>1,z=t[G];z!==null&&!ye(z)&&(n?z<=e:z<e)?d=G+1:R=G}return R}return Vi(t,e,pe,n)}function Vi(t,e,n,d){var R=0,G=t==null?0:t.length;if(G===0)return 0;e=n(e);for(var z=e!==e,J=e===null,q=ye(e),it=e===p;R<G;){var ot=Sr((R+G)/2),st=n(t[ot]),ft=st!==p,gt=st===null,Ct=st===st,Et=ye(st);if(z)var Ot=d||Ct;else it?Ot=Ct&&(d||ft):J?Ot=Ct&&ft&&(d||!gt):q?Ot=Ct&&ft&&!gt&&(d||!Et):gt||Et?Ot=!1:Ot=d?st<=e:st<e;Ot?R=ot+1:G=ot}return oe(G,et)}function ea(t,e){for(var n=-1,d=t.length,R=0,G=[];++n<d;){var z=t[n],J=e?e(z):z;if(!n||!De(J,q)){var q=J;G[R++]=z===0?0:z}}return G}function na(t){return typeof t=="number"?t:ye(t)?K:+t}function me(t){if(typeof t=="string")return t;if(Rt(t))return kt(t,me)+"";if(ye(t))return Ds?Ds.call(t):"";var e=t+"";return e=="0"&&1/t==-M?"-0":e}function an(t,e,n){var d=-1,R=pr,G=t.length,z=!0,J=[],q=J;if(n)z=!1,R=Oi;else if(G>=r){var it=e?null:md(t);if(it)return vr(it);z=!1,R=Vn,q=new gn}else q=e?[]:J;t:for(;++d<G;){var ot=t[d],st=e?e(ot):ot;if(ot=n||ot!==0?ot:0,z&&st===st){for(var ft=q.length;ft--;)if(q[ft]===st)continue t;e&&q.push(st),J.push(ot)}else R(q,st,n)||(q!==J&&q.push(st),J.push(ot))}return J}function Ki(t,e){return e=un(e,t),t=_a(t,e),t==null||delete t[je(we(e))]}function ra(t,e,n,d){return er(t,e,n(mn(t,e)),d)}function Ur(t,e,n,d){for(var R=t.length,G=d?R:-1;(d?G--:++G<R)&&e(t[G],G,t););return n?Pe(t,d?0:G,d?G+1:R):Pe(t,d?G+1:0,d?R:G)}function ia(t,e){var n=t;return n instanceof _t&&(n=n.value()),bi(e,function(d,R){return R.func.apply(R.thisArg,en([d],R.args))},n)}function Ji(t,e,n){var d=t.length;if(d<2)return d?an(t[0]):[];for(var R=-1,G=tt(d);++R<d;)for(var z=t[R],J=-1;++J<d;)J!=R&&(G[R]=Xn(G[R]||z,t[J],e,n));return an(re(G,1),e,n)}function oa(t,e,n){for(var d=-1,R=t.length,G=e.length,z={};++d<R;){var J=d<G?e[d]:p;n(z,t[d],J)}return z}function $i(t){return $t(t)?t:[]}function Qi(t){return typeof t=="function"?t:pe}function un(t,e){return Rt(t)?t:io(t,e)?[t]:Da(Nt(t))}var ad=St;function ln(t,e,n){var d=t.length;return n=n===p?d:n,!e&&n>=d?t:Pe(t,e,n)}var sa=Jc||function(t){return ee.clearTimeout(t)};function aa(t,e){if(e)return t.slice();var n=t.length,d=Ps?Ps(n):new t.constructor(n);return t.copy(d),d}function qi(t){var e=new t.constructor(t.byteLength);return new Ar(e).set(new Ar(t)),e}function ud(t,e){var n=e?qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function ld(t){var e=new t.constructor(t.source,zo.exec(t));return e.lastIndex=t.lastIndex,e}function cd(t){return qn?Ft(qn.call(t)):{}}function ua(t,e){var n=e?qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function la(t,e){if(t!==e){var n=t!==p,d=t===null,R=t===t,G=ye(t),z=e!==p,J=e===null,q=e===e,it=ye(e);if(!J&&!it&&!G&&t>e||G&&z&&q&&!J&&!it||d&&z&&q||!n&&q||!R)return 1;if(!d&&!G&&!it&&t<e||it&&n&&R&&!d&&!G||J&&n&&R||!z&&R||!q)return-1}return 0}function fd(t,e,n){for(var d=-1,R=t.criteria,G=e.criteria,z=R.length,J=n.length;++d<z;){var q=la(R[d],G[d]);if(q){if(d>=J)return q;var it=n[d];return q*(it=="desc"?-1:1)}}return t.index-e.index}function ca(t,e,n,d){for(var R=-1,G=t.length,z=n.length,J=-1,q=e.length,it=Zt(G-z,0),ot=tt(q+it),st=!d;++J<q;)ot[J]=e[J];for(;++R<z;)(st||R<G)&&(ot[n[R]]=t[R]);for(;it--;)ot[J++]=t[R++];return ot}function fa(t,e,n,d){for(var R=-1,G=t.length,z=-1,J=n.length,q=-1,it=e.length,ot=Zt(G-J,0),st=tt(ot+it),ft=!d;++R<ot;)st[R]=t[R];for(var gt=R;++q<it;)st[gt+q]=e[q];for(;++z<J;)(ft||R<G)&&(st[gt+n[z]]=t[R++]);return st}function fe(t,e){var n=-1,d=t.length;for(e||(e=tt(d));++n<d;)e[n]=t[n];return e}function We(t,e,n,d){var R=!n;n||(n={});for(var G=-1,z=e.length;++G<z;){var J=e[G],q=d?d(n[J],t[J],J,n,t):p;q===p&&(q=t[J]),R?Ke(n,J,q):Yn(n,J,q)}return n}function dd(t,e){return We(t,ro(t),e)}function hd(t,e){return We(t,Ia(t),e)}function Br(t,e){return function(n,d){var R=Rt(n)?mc:Nf,G=e?e():{};return R(n,t,yt(d,2),G)}}function Ln(t){return St(function(e,n){var d=-1,R=n.length,G=R>1?n[R-1]:p,z=R>2?n[2]:p;for(G=t.length>3&&typeof G=="function"?(R--,G):p,z&&le(n[0],n[1],z)&&(G=R<3?p:G,R=1),e=Ft(e);++d<R;){var J=n[d];J&&t(e,J,d,G)}return e})}function da(t,e){return function(n,d){if(n==null)return n;if(!de(n))return t(n,d);for(var R=n.length,G=e?R:-1,z=Ft(n);(e?G--:++G<R)&&d(z[G],G,z)!==!1;);return n}}function ha(t){return function(e,n,d){for(var R=-1,G=Ft(e),z=d(e),J=z.length;J--;){var q=z[t?J:++R];if(n(G[q],q,G)===!1)break}return e}}function pd(t,e,n){var d=e&x,R=nr(t);function G(){var z=this&&this!==ee&&this instanceof G?R:t;return z.apply(d?n:this,arguments)}return G}function pa(t){return function(e){e=Nt(e);var n=Sn(e)?Me(e):p,d=n?n[0]:e.charAt(0),R=n?ln(n,1).join(""):e.slice(1);return d[t]()+R}}function Dn(t){return function(e){return bi(du(fu(e).replace(rc,"")),t,"")}}function nr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Mn(t.prototype),d=t.apply(n,e);return Vt(d)?d:n}}function gd(t,e,n){var d=nr(t);function R(){for(var G=arguments.length,z=tt(G),J=G,q=Nn(R);J--;)z[J]=arguments[J];var it=G<3&&z[0]!==q&&z[G-1]!==q?[]:nn(z,q);if(G-=it.length,G<n)return Ca(t,e,Gr,R.placeholder,p,z,it,p,p,n-G);var ot=this&&this!==ee&&this instanceof R?d:t;return ge(ot,this,z)}return R}function ga(t){return function(e,n,d){var R=Ft(e);if(!de(e)){var G=yt(n,3);e=ne(e),n=function(J){return G(R[J],J,R)}}var z=t(e,n,d);return z>-1?R[G?e[z]:z]:p}}function va(t){return $e(function(e){var n=e.length,d=n,R=Ee.prototype.thru;for(t&&e.reverse();d--;){var G=e[d];if(typeof G!="function")throw new Te(s);if(R&&!z&&jr(G)=="wrapper")var z=new Ee([],!0)}for(d=z?d:n;++d<n;){G=e[d];var J=jr(G),q=J=="wrapper"?eo(G):p;q&&oo(q[0])&&q[1]==(i|g|a|o)&&!q[4].length&&q[9]==1?z=z[jr(q[0])].apply(z,q[3]):z=G.length==1&&oo(G)?z[J]():z.thru(G)}return function(){var it=arguments,ot=it[0];if(z&&it.length==1&&Rt(ot))return z.plant(ot).value();for(var st=0,ft=n?e[st].apply(this,it):ot;++st<n;)ft=e[st].call(this,ft);return ft}})}function Gr(t,e,n,d,R,G,z,J,q,it){var ot=e&i,st=e&x,ft=e&T,gt=e&(g|b),Ct=e&v,Et=ft?p:nr(t);function Ot(){for(var Pt=arguments.length,xt=tt(Pt),Ce=Pt;Ce--;)xt[Ce]=arguments[Ce];if(gt)var ce=Nn(Ot),Oe=Ec(xt,ce);if(d&&(xt=ca(xt,d,R,gt)),G&&(xt=fa(xt,G,z,gt)),Pt-=Oe,gt&&Pt<it){var Qt=nn(xt,ce);return Ca(t,e,Gr,Ot.placeholder,n,xt,Qt,J,q,it-Pt)}var Ne=st?n:this,Xe=ft?Ne[t]:t;return Pt=xt.length,J?xt=Nd(xt,J):Ct&&Pt>1&&xt.reverse(),ot&&q<Pt&&(xt.length=q),this&&this!==ee&&this instanceof Ot&&(Xe=Et||nr(Xe)),Xe.apply(Ne,xt)}return Ot}function ma(t,e){return function(n,d){return kf(n,t,e(d),{})}}function Fr(t,e){return function(n,d){var R;if(n===p&&d===p)return e;if(n!==p&&(R=n),d!==p){if(R===p)return d;typeof n=="string"||typeof d=="string"?(n=me(n),d=me(d)):(n=na(n),d=na(d)),R=t(n,d)}return R}}function Yi(t){return $e(function(e){return e=kt(e,ve(yt())),St(function(n){var d=this;return t(e,function(R){return ge(R,d,n)})})})}function Hr(t,e){e=e===p?" ":me(e);var n=e.length;if(n<2)return n?zi(e,t):e;var d=zi(e,Er(t/Pn(e)));return Sn(e)?ln(Me(d),0,t).join(""):d.slice(0,t)}function vd(t,e,n,d){var R=e&x,G=nr(t);function z(){for(var J=-1,q=arguments.length,it=-1,ot=d.length,st=tt(ot+q),ft=this&&this!==ee&&this instanceof z?G:t;++it<ot;)st[it]=d[it];for(;q--;)st[it++]=arguments[++J];return ge(ft,R?n:this,st)}return z}function ya(t){return function(e,n,d){return d&&typeof d!="number"&&le(e,n,d)&&(n=d=p),e=Ye(e),n===p?(n=e,e=0):n=Ye(n),d=d===p?e<n?1:-1:Ye(d),ed(e,n,d,t)}}function Wr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=_e(e),n=_e(n)),t(e,n)}}function Ca(t,e,n,d,R,G,z,J,q,it){var ot=e&g,st=ot?z:p,ft=ot?p:z,gt=ot?G:p,Ct=ot?p:G;e|=ot?a:h,e&=~(ot?h:a),e&m||(e&=~(x|T));var Et=[t,e,R,gt,st,Ct,ft,J,q,it],Ot=n.apply(p,Et);return oo(t)&&xa(Ot,Et),Ot.placeholder=d,Ma(Ot,t,e)}function Xi(t){var e=Xt[t];return function(n,d){if(n=_e(n),d=d==null?0:oe(It(d),292),d&&Ms(n)){var R=(Nt(n)+"e").split("e"),G=e(R[0]+"e"+(+R[1]+d));return R=(Nt(G)+"e").split("e"),+(R[0]+"e"+(+R[1]-d))}return e(n)}}var md=_n&&1/vr(new _n([,-0]))[1]==M?function(t){return new _n(t)}:bo;function Oa(t){return function(e){var n=se(e);return n==ct?Pi(e):n==zt?Lc(e):Tc(e,t(e))}}function Je(t,e,n,d,R,G,z,J){var q=e&T;if(!q&&typeof t!="function")throw new Te(s);var it=d?d.length:0;if(it||(e&=~(a|h),d=R=p),z=z===p?z:Zt(It(z),0),J=J===p?J:It(J),it-=R?R.length:0,e&h){var ot=d,st=R;d=R=p}var ft=q?p:eo(t),gt=[t,e,n,d,R,ot,st,G,z,J];if(ft&&Md(gt,ft),t=gt[0],e=gt[1],n=gt[2],d=gt[3],R=gt[4],J=gt[9]=gt[9]===p?q?0:t.length:Zt(gt[9]-it,0),!J&&e&(g|b)&&(e&=~(g|b)),!e||e==x)var Ct=pd(t,e,n);else e==g||e==b?Ct=gd(t,e,J):(e==a||e==(x|a))&&!R.length?Ct=vd(t,e,n,d):Ct=Gr.apply(p,gt);var Et=ft?ta:xa;return Ma(Et(Ct,gt),t,e)}function ba(t,e,n,d){return t===p||De(t,wn[n])&&!Ut.call(d,n)?e:t}function Aa(t,e,n,d,R,G){return Vt(t)&&Vt(e)&&(G.set(e,t),Dr(t,e,p,Aa,G),G.delete(e)),t}function yd(t){return or(t)?p:t}function Ra(t,e,n,d,R,G){var z=n&u,J=t.length,q=e.length;if(J!=q&&!(z&&q>J))return!1;var it=G.get(t),ot=G.get(e);if(it&&ot)return it==e&&ot==t;var st=-1,ft=!0,gt=n&C?new gn:p;for(G.set(t,e),G.set(e,t);++st<J;){var Ct=t[st],Et=e[st];if(d)var Ot=z?d(Et,Ct,st,e,t,G):d(Ct,Et,st,t,e,G);if(Ot!==p){if(Ot)continue;ft=!1;break}if(gt){if(!Ai(e,function(Pt,xt){if(!Vn(gt,xt)&&(Ct===Pt||R(Ct,Pt,n,d,G)))return gt.push(xt)})){ft=!1;break}}else if(!(Ct===Et||R(Ct,Et,n,d,G))){ft=!1;break}}return G.delete(t),G.delete(e),ft}function Cd(t,e,n,d,R,G,z){switch(n){case rt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $:return!(t.byteLength!=e.byteLength||!G(new Ar(t),new Ar(e)));case Z:case lt:case Dt:return De(+t,+e);case vt:return t.name==e.name&&t.message==e.message;case Ge:case Fe:return t==e+"";case ct:var J=Pi;case zt:var q=d&u;if(J||(J=vr),t.size!=e.size&&!q)return!1;var it=z.get(t);if(it)return it==e;d|=C,z.set(t,e);var ot=Ra(J(t),J(e),d,R,G,z);return z.delete(t),ot;case Ze:if(qn)return qn.call(t)==qn.call(e)}return!1}function Od(t,e,n,d,R,G){var z=n&u,J=Zi(t),q=J.length,it=Zi(e),ot=it.length;if(q!=ot&&!z)return!1;for(var st=q;st--;){var ft=J[st];if(!(z?ft in e:Ut.call(e,ft)))return!1}var gt=G.get(t),Ct=G.get(e);if(gt&&Ct)return gt==e&&Ct==t;var Et=!0;G.set(t,e),G.set(e,t);for(var Ot=z;++st<q;){ft=J[st];var Pt=t[ft],xt=e[ft];if(d)var Ce=z?d(xt,Pt,ft,e,t,G):d(Pt,xt,ft,t,e,G);if(!(Ce===p?Pt===xt||R(Pt,xt,n,d,G):Ce)){Et=!1;break}Ot||(Ot=ft=="constructor")}if(Et&&!Ot){var ce=t.constructor,Oe=e.constructor;ce!=Oe&&"constructor"in t&&"constructor"in e&&!(typeof ce=="function"&&ce instanceof ce&&typeof Oe=="function"&&Oe instanceof Oe)&&(Et=!1)}return G.delete(t),G.delete(e),Et}function $e(t){return ao(wa(t,p,Ga),t+"")}function Zi(t){return ks(t,ne,ro)}function to(t){return ks(t,he,Ia)}var eo=Pr?function(t){return Pr.get(t)}:bo;function jr(t){for(var e=t.name+"",n=xn[e],d=Ut.call(xn,e)?n.length:0;d--;){var R=n[d],G=R.func;if(G==null||G==t)return R.name}return e}function Nn(t){var e=Ut.call(D,"placeholder")?D:t;return e.placeholder}function yt(){var t=D.iteratee||Co;return t=t===Co?Ks:t,arguments.length?t(arguments[0],arguments[1]):t}function kr(t,e){var n=t.__data__;return Pd(e)?n[typeof e=="string"?"string":"hash"]:n.map}function no(t){for(var e=ne(t),n=e.length;n--;){var d=e[n],R=t[d];e[n]=[d,R,Sa(R)]}return e}function yn(t,e){var n=_c(t,e);return Vs(n)?n:p}function bd(t){var e=Ut.call(t,hn),n=t[hn];try{t[hn]=p;var d=!0}catch(G){}var R=Or.call(t);return d&&(e?t[hn]=n:delete t[hn]),R}var ro=_i?function(t){return t==null?[]:(t=Ft(t),tn(_i(t),function(e){return _s.call(t,e)}))}:Ao,Ia=_i?function(t){for(var e=[];t;)en(e,ro(t)),t=Rr(t);return e}:Ao,se=ue;(xi&&se(new xi(new ArrayBuffer(1)))!=rt||Jn&&se(new Jn)!=ct||Mi&&se(Mi.resolve())!=Kt||_n&&se(new _n)!=zt||$n&&se(new $n)!=fn)&&(se=function(t){var e=ue(t),n=e==Wt?t.constructor:p,d=n?Cn(n):"";if(d)switch(d){case nf:return rt;case rf:return ct;case of:return Kt;case sf:return zt;case af:return fn}return e});function Ad(t,e,n){for(var d=-1,R=n.length;++d<R;){var G=n[d],z=G.size;switch(G.type){case"drop":t+=z;break;case"dropRight":e-=z;break;case"take":e=oe(e,t+z);break;case"takeRight":t=Zt(t,e-z);break}}return{start:t,end:e}}function Rd(t){var e=t.match(Pl);return e?e[1].split(wl):[]}function Ta(t,e,n){e=un(e,t);for(var d=-1,R=e.length,G=!1;++d<R;){var z=je(e[d]);if(!(G=t!=null&&n(t,z)))break;t=t[z]}return G||++d!=R?G:(R=t==null?0:t.length,!!R&&qr(R)&&Qe(z,R)&&(Rt(t)||On(t)))}function Id(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Ut.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Ea(t){return typeof t.constructor=="function"&&!rr(t)?Mn(Rr(t)):{}}function Td(t,e,n){var d=t.constructor;switch(e){case $:return qi(t);case Z:case lt:return new d(+t);case rt:return ud(t,n);case at:case pt:case Tt:case te:case ke:case ai:case ui:case li:case ci:return ua(t,n);case ct:return new d;case Dt:case Fe:return new d(t);case Ge:return ld(t);case zt:return new d;case Ze:return cd(t)}}function Ed(t,e){var n=e.length;if(!n)return t;var d=n-1;return e[d]=(n>1?"& ":"")+e[d],e=e.join(n>2?", ":" "),t.replace(Sl,`{
/* [wrapped with `+e+`] */
`)}function Sd(t){return Rt(t)||On(t)||!!(xs&&t&&t[xs])}function Qe(t,e){var n=typeof t;return e=e==null?F:e,!!e&&(n=="number"||n!="symbol"&&Gl.test(t))&&t>-1&&t%1==0&&t<e}function le(t,e,n){if(!Vt(n))return!1;var d=typeof e;return(d=="number"?de(n)&&Qe(e,n.length):d=="string"&&e in n)?De(n[e],t):!1}function io(t,e){if(Rt(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ye(t)?!0:Rl.test(t)||!Al.test(t)||e!=null&&t in Ft(e)}function Pd(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function oo(t){var e=jr(t),n=D[e];if(typeof n!="function"||!(e in _t.prototype))return!1;if(t===n)return!0;var d=eo(n);return!!d&&t===d[0]}function wd(t){return!!Ss&&Ss in t}var _d=yr?qe:Ro;function rr(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||wn;return t===n}function Sa(t){return t===t&&!Vt(t)}function Pa(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==p||t in Ft(n))}}function xd(t){var e=$r(t,function(d){return n.size===S&&n.clear(),d}),n=e.cache;return e}function Md(t,e){var n=t[1],d=e[1],R=n|d,G=R<(x|T|i),z=d==i&&n==g||d==i&&n==o&&t[7].length<=e[8]||d==(i|o)&&e[7].length<=e[8]&&n==g;if(!(G||z))return t;d&x&&(t[2]=e[2],R|=n&x?0:m);var J=e[3];if(J){var q=t[3];t[3]=q?ca(q,J,e[4]):J,t[4]=q?nn(t[3],_):e[4]}return J=e[5],J&&(q=t[5],t[5]=q?fa(q,J,e[6]):J,t[6]=q?nn(t[5],_):e[6]),J=e[7],J&&(t[7]=J),d&i&&(t[8]=t[8]==null?e[8]:oe(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=R,t}function Ld(t){var e=[];if(t!=null)for(var n in Ft(t))e.push(n);return e}function Dd(t){return Or.call(t)}function wa(t,e,n){return e=Zt(e===p?t.length-1:e,0),function(){for(var d=arguments,R=-1,G=Zt(d.length-e,0),z=tt(G);++R<G;)z[R]=d[e+R];R=-1;for(var J=tt(e+1);++R<e;)J[R]=d[R];return J[e]=n(z),ge(t,this,J)}}function _a(t,e){return e.length<2?t:mn(t,Pe(e,0,-1))}function Nd(t,e){for(var n=t.length,d=oe(e.length,n),R=fe(t);d--;){var G=e[d];t[d]=Qe(G,n)?R[G]:p}return t}function so(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var xa=La(ta),ir=Qc||function(t,e){return ee.setTimeout(t,e)},ao=La(id);function Ma(t,e,n){var d=e+"";return ao(t,Ed(d,Ud(Rd(d),n)))}function La(t){var e=0,n=0;return function(){var d=Zc(),R=k-(d-n);if(n=d,R>0){if(++e>=U)return arguments[0]}else e=0;return t.apply(p,arguments)}}function zr(t,e){var n=-1,d=t.length,R=d-1;for(e=e===p?d:e;++n<e;){var G=ki(n,R),z=t[G];t[G]=t[n],t[n]=z}return t.length=e,t}var Da=xd(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Il,function(n,d,R,G){e.push(R?G.replace(Ml,"$1"):d||n)}),e});function je(t){if(typeof t=="string"||ye(t))return t;var e=t+"";return e=="0"&&1/t==-M?"-0":e}function Cn(t){if(t!=null){try{return Cr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Ud(t,e){return Ie(w,function(n){var d="_."+n[0];e&n[1]&&!pr(t,d)&&t.push(d)}),t.sort()}function Na(t){if(t instanceof _t)return t.clone();var e=new Ee(t.__wrapped__,t.__chain__);return e.__actions__=fe(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Bd(t,e,n){(n?le(t,e,n):e===p)?e=1:e=Zt(It(e),0);var d=t==null?0:t.length;if(!d||e<1)return[];for(var R=0,G=0,z=tt(Er(d/e));R<d;)z[G++]=Pe(t,R,R+=e);return z}function Gd(t){for(var e=-1,n=t==null?0:t.length,d=0,R=[];++e<n;){var G=t[e];G&&(R[d++]=G)}return R}function Fd(){var t=arguments.length;if(!t)return[];for(var e=tt(t-1),n=arguments[0],d=t;d--;)e[d-1]=arguments[d];return en(Rt(n)?fe(n):[n],re(e,1))}var Hd=St(function(t,e){return $t(t)?Xn(t,re(e,1,$t,!0)):[]}),Wd=St(function(t,e){var n=we(e);return $t(n)&&(n=p),$t(t)?Xn(t,re(e,1,$t,!0),yt(n,2)):[]}),jd=St(function(t,e){var n=we(e);return $t(n)&&(n=p),$t(t)?Xn(t,re(e,1,$t,!0),p,n):[]});function kd(t,e,n){var d=t==null?0:t.length;return d?(e=n||e===p?1:It(e),Pe(t,e<0?0:e,d)):[]}function zd(t,e,n){var d=t==null?0:t.length;return d?(e=n||e===p?1:It(e),e=d-e,Pe(t,0,e<0?0:e)):[]}function Vd(t,e){return t&&t.length?Ur(t,yt(e,3),!0,!0):[]}function Kd(t,e){return t&&t.length?Ur(t,yt(e,3),!0):[]}function Jd(t,e,n,d){var R=t==null?0:t.length;return R?(n&&typeof n!="number"&&le(t,e,n)&&(n=0,d=R),Ff(t,e,n,d)):[]}function Ua(t,e,n){var d=t==null?0:t.length;if(!d)return-1;var R=n==null?0:It(n);return R<0&&(R=Zt(d+R,0)),gr(t,yt(e,3),R)}function Ba(t,e,n){var d=t==null?0:t.length;if(!d)return-1;var R=d-1;return n!==p&&(R=It(n),R=n<0?Zt(d+R,0):oe(R,d-1)),gr(t,yt(e,3),R,!0)}function Ga(t){var e=t==null?0:t.length;return e?re(t,1):[]}function $d(t){var e=t==null?0:t.length;return e?re(t,M):[]}function Qd(t,e){var n=t==null?0:t.length;return n?(e=e===p?1:It(e),re(t,e)):[]}function qd(t){for(var e=-1,n=t==null?0:t.length,d={};++e<n;){var R=t[e];d[R[0]]=R[1]}return d}function Fa(t){return t&&t.length?t[0]:p}function Yd(t,e,n){var d=t==null?0:t.length;if(!d)return-1;var R=n==null?0:It(n);return R<0&&(R=Zt(d+R,0)),En(t,e,R)}function Xd(t){var e=t==null?0:t.length;return e?Pe(t,0,-1):[]}var Zd=St(function(t){var e=kt(t,$i);return e.length&&e[0]===t[0]?Gi(e):[]}),th=St(function(t){var e=we(t),n=kt(t,$i);return e===we(n)?e=p:n.pop(),n.length&&n[0]===t[0]?Gi(n,yt(e,2)):[]}),eh=St(function(t){var e=we(t),n=kt(t,$i);return e=typeof e=="function"?e:p,e&&n.pop(),n.length&&n[0]===t[0]?Gi(n,p,e):[]});function nh(t,e){return t==null?"":Yc.call(t,e)}function we(t){var e=t==null?0:t.length;return e?t[e-1]:p}function rh(t,e,n){var d=t==null?0:t.length;if(!d)return-1;var R=d;return n!==p&&(R=It(n),R=R<0?Zt(d+R,0):oe(R,d-1)),e===e?Nc(t,e,R):gr(t,Cs,R,!0)}function ih(t,e){return t&&t.length?qs(t,It(e)):p}var oh=St(Ha);function Ha(t,e){return t&&t.length&&e&&e.length?ji(t,e):t}function sh(t,e,n){return t&&t.length&&e&&e.length?ji(t,e,yt(n,2)):t}function ah(t,e,n){return t&&t.length&&e&&e.length?ji(t,e,p,n):t}var uh=$e(function(t,e){var n=t==null?0:t.length,d=Di(t,e);return Zs(t,kt(e,function(R){return Qe(R,n)?+R:R}).sort(la)),d});function lh(t,e){var n=[];if(!(t&&t.length))return n;var d=-1,R=[],G=t.length;for(e=yt(e,3);++d<G;){var z=t[d];e(z,d,t)&&(n.push(z),R.push(d))}return Zs(t,R),n}function uo(t){return t==null?t:ef.call(t)}function ch(t,e,n){var d=t==null?0:t.length;return d?(n&&typeof n!="number"&&le(t,e,n)?(e=0,n=d):(e=e==null?0:It(e),n=n===p?d:It(n)),Pe(t,e,n)):[]}function fh(t,e){return Nr(t,e)}function dh(t,e,n){return Vi(t,e,yt(n,2))}function hh(t,e){var n=t==null?0:t.length;if(n){var d=Nr(t,e);if(d<n&&De(t[d],e))return d}return-1}function ph(t,e){return Nr(t,e,!0)}function gh(t,e,n){return Vi(t,e,yt(n,2),!0)}function vh(t,e){var n=t==null?0:t.length;if(n){var d=Nr(t,e,!0)-1;if(De(t[d],e))return d}return-1}function mh(t){return t&&t.length?ea(t):[]}function yh(t,e){return t&&t.length?ea(t,yt(e,2)):[]}function Ch(t){var e=t==null?0:t.length;return e?Pe(t,1,e):[]}function Oh(t,e,n){return t&&t.length?(e=n||e===p?1:It(e),Pe(t,0,e<0?0:e)):[]}function bh(t,e,n){var d=t==null?0:t.length;return d?(e=n||e===p?1:It(e),e=d-e,Pe(t,e<0?0:e,d)):[]}function Ah(t,e){return t&&t.length?Ur(t,yt(e,3),!1,!0):[]}function Rh(t,e){return t&&t.length?Ur(t,yt(e,3)):[]}var Ih=St(function(t){return an(re(t,1,$t,!0))}),Th=St(function(t){var e=we(t);return $t(e)&&(e=p),an(re(t,1,$t,!0),yt(e,2))}),Eh=St(function(t){var e=we(t);return e=typeof e=="function"?e:p,an(re(t,1,$t,!0),p,e)});function Sh(t){return t&&t.length?an(t):[]}function Ph(t,e){return t&&t.length?an(t,yt(e,2)):[]}function wh(t,e){return e=typeof e=="function"?e:p,t&&t.length?an(t,p,e):[]}function lo(t){if(!(t&&t.length))return[];var e=0;return t=tn(t,function(n){if($t(n))return e=Zt(n.length,e),!0}),Ei(e,function(n){return kt(t,Ri(n))})}function Wa(t,e){if(!(t&&t.length))return[];var n=lo(t);return e==null?n:kt(n,function(d){return ge(e,p,d)})}var _h=St(function(t,e){return $t(t)?Xn(t,e):[]}),xh=St(function(t){return Ji(tn(t,$t))}),Mh=St(function(t){var e=we(t);return $t(e)&&(e=p),Ji(tn(t,$t),yt(e,2))}),Lh=St(function(t){var e=we(t);return e=typeof e=="function"?e:p,Ji(tn(t,$t),p,e)}),Dh=St(lo);function Nh(t,e){return oa(t||[],e||[],Yn)}function Uh(t,e){return oa(t||[],e||[],er)}var Bh=St(function(t){var e=t.length,n=e>1?t[e-1]:p;return n=typeof n=="function"?(t.pop(),n):p,Wa(t,n)});function ja(t){var e=D(t);return e.__chain__=!0,e}function Gh(t,e){return e(t),t}function Vr(t,e){return e(t)}var Fh=$e(function(t){var e=t.length,n=e?t[0]:0,d=this.__wrapped__,R=function(G){return Di(G,t)};return e>1||this.__actions__.length||!(d instanceof _t)||!Qe(n)?this.thru(R):(d=d.slice(n,+n+(e?1:0)),d.__actions__.push({func:Vr,args:[R],thisArg:p}),new Ee(d,this.__chain__).thru(function(G){return e&&!G.length&&G.push(p),G}))});function Hh(){return ja(this)}function Wh(){return new Ee(this.value(),this.__chain__)}function jh(){this.__values__===p&&(this.__values__=nu(this.value()));var t=this.__index__>=this.__values__.length,e=t?p:this.__values__[this.__index__++];return{done:t,value:e}}function kh(){return this}function zh(t){for(var e,n=this;n instanceof _r;){var d=Na(n);d.__index__=0,d.__values__=p,e?R.__wrapped__=d:e=d;var R=d;n=n.__wrapped__}return R.__wrapped__=t,e}function Vh(){var t=this.__wrapped__;if(t instanceof _t){var e=t;return this.__actions__.length&&(e=new _t(this)),e=e.reverse(),e.__actions__.push({func:Vr,args:[uo],thisArg:p}),new Ee(e,this.__chain__)}return this.thru(uo)}function Kh(){return ia(this.__wrapped__,this.__actions__)}var Jh=Br(function(t,e,n){Ut.call(t,n)?++t[n]:Ke(t,n,1)});function $h(t,e,n){var d=Rt(t)?ms:Gf;return n&&le(t,e,n)&&(e=p),d(t,yt(e,3))}function Qh(t,e){var n=Rt(t)?tn:Ws;return n(t,yt(e,3))}var qh=ga(Ua),Yh=ga(Ba);function Xh(t,e){return re(Kr(t,e),1)}function Zh(t,e){return re(Kr(t,e),M)}function tp(t,e,n){return n=n===p?1:It(n),re(Kr(t,e),n)}function ka(t,e){var n=Rt(t)?Ie:sn;return n(t,yt(e,3))}function za(t,e){var n=Rt(t)?yc:Hs;return n(t,yt(e,3))}var ep=Br(function(t,e,n){Ut.call(t,n)?t[n].push(e):Ke(t,n,[e])});function np(t,e,n,d){t=de(t)?t:Bn(t),n=n&&!d?It(n):0;var R=t.length;return n<0&&(n=Zt(R+n,0)),Yr(t)?n<=R&&t.indexOf(e,n)>-1:!!R&&En(t,e,n)>-1}var rp=St(function(t,e,n){var d=-1,R=typeof e=="function",G=de(t)?tt(t.length):[];return sn(t,function(z){G[++d]=R?ge(e,z,n):Zn(z,e,n)}),G}),ip=Br(function(t,e,n){Ke(t,n,e)});function Kr(t,e){var n=Rt(t)?kt:Js;return n(t,yt(e,3))}function op(t,e,n,d){return t==null?[]:(Rt(e)||(e=e==null?[]:[e]),n=d?p:n,Rt(n)||(n=n==null?[]:[n]),Ys(t,e,n))}var sp=Br(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function ap(t,e,n){var d=Rt(t)?bi:bs,R=arguments.length<3;return d(t,yt(e,4),n,R,sn)}function up(t,e,n){var d=Rt(t)?Cc:bs,R=arguments.length<3;return d(t,yt(e,4),n,R,Hs)}function lp(t,e){var n=Rt(t)?tn:Ws;return n(t,Qr(yt(e,3)))}function cp(t){var e=Rt(t)?Us:nd;return e(t)}function fp(t,e,n){(n?le(t,e,n):e===p)?e=1:e=It(e);var d=Rt(t)?Lf:rd;return d(t,e)}function dp(t){var e=Rt(t)?Df:od;return e(t)}function hp(t){if(t==null)return 0;if(de(t))return Yr(t)?Pn(t):t.length;var e=se(t);return e==ct||e==zt?t.size:Hi(t).length}function pp(t,e,n){var d=Rt(t)?Ai:sd;return n&&le(t,e,n)&&(e=p),d(t,yt(e,3))}var gp=St(function(t,e){if(t==null)return[];var n=e.length;return n>1&&le(t,e[0],e[1])?e=[]:n>2&&le(e[0],e[1],e[2])&&(e=[e[0]]),Ys(t,re(e,1),[])}),Jr=$c||function(){return ee.Date.now()};function vp(t,e){if(typeof e!="function")throw new Te(s);return t=It(t),function(){if(--t<1)return e.apply(this,arguments)}}function Va(t,e,n){return e=n?p:e,e=t&&e==null?t.length:e,Je(t,i,p,p,p,p,e)}function Ka(t,e){var n;if(typeof e!="function")throw new Te(s);return t=It(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=p),n}}var co=St(function(t,e,n){var d=x;if(n.length){var R=nn(n,Nn(co));d|=a}return Je(t,d,e,n,R)}),Ja=St(function(t,e,n){var d=x|T;if(n.length){var R=nn(n,Nn(Ja));d|=a}return Je(e,d,t,n,R)});function $a(t,e,n){e=n?p:e;var d=Je(t,g,p,p,p,p,p,e);return d.placeholder=$a.placeholder,d}function Qa(t,e,n){e=n?p:e;var d=Je(t,b,p,p,p,p,p,e);return d.placeholder=Qa.placeholder,d}function qa(t,e,n){var d,R,G,z,J,q,it=0,ot=!1,st=!1,ft=!0;if(typeof t!="function")throw new Te(s);e=_e(e)||0,Vt(n)&&(ot=!!n.leading,st="maxWait"in n,G=st?Zt(_e(n.maxWait)||0,e):G,ft="trailing"in n?!!n.trailing:ft);function gt(Qt){var Ne=d,Xe=R;return d=R=p,it=Qt,z=t.apply(Xe,Ne),z}function Ct(Qt){return it=Qt,J=ir(Pt,e),ot?gt(Qt):z}function Et(Qt){var Ne=Qt-q,Xe=Qt-it,gu=e-Ne;return st?oe(gu,G-Xe):gu}function Ot(Qt){var Ne=Qt-q,Xe=Qt-it;return q===p||Ne>=e||Ne<0||st&&Xe>=G}function Pt(){var Qt=Jr();if(Ot(Qt))return xt(Qt);J=ir(Pt,Et(Qt))}function xt(Qt){return J=p,ft&&d?gt(Qt):(d=R=p,z)}function Ce(){J!==p&&sa(J),it=0,d=q=R=J=p}function ce(){return J===p?z:xt(Jr())}function Oe(){var Qt=Jr(),Ne=Ot(Qt);if(d=arguments,R=this,q=Qt,Ne){if(J===p)return Ct(q);if(st)return sa(J),J=ir(Pt,e),gt(q)}return J===p&&(J=ir(Pt,e)),z}return Oe.cancel=Ce,Oe.flush=ce,Oe}var mp=St(function(t,e){return Fs(t,1,e)}),yp=St(function(t,e,n){return Fs(t,_e(e)||0,n)});function Cp(t){return Je(t,v)}function $r(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Te(s);var n=function(){var d=arguments,R=e?e.apply(this,d):d[0],G=n.cache;if(G.has(R))return G.get(R);var z=t.apply(this,d);return n.cache=G.set(R,z)||G,z};return n.cache=new($r.Cache||Ve),n}$r.Cache=Ve;function Qr(t){if(typeof t!="function")throw new Te(s);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Op(t){return Ka(2,t)}var bp=ad(function(t,e){e=e.length==1&&Rt(e[0])?kt(e[0],ve(yt())):kt(re(e,1),ve(yt()));var n=e.length;return St(function(d){for(var R=-1,G=oe(d.length,n);++R<G;)d[R]=e[R].call(this,d[R]);return ge(t,this,d)})}),fo=St(function(t,e){var n=nn(e,Nn(fo));return Je(t,a,p,e,n)}),Ya=St(function(t,e){var n=nn(e,Nn(Ya));return Je(t,h,p,e,n)}),Ap=$e(function(t,e){return Je(t,o,p,p,p,e)});function Rp(t,e){if(typeof t!="function")throw new Te(s);return e=e===p?e:It(e),St(t,e)}function Ip(t,e){if(typeof t!="function")throw new Te(s);return e=e==null?0:Zt(It(e),0),St(function(n){var d=n[e],R=ln(n,0,e);return d&&en(R,d),ge(t,this,R)})}function Tp(t,e,n){var d=!0,R=!0;if(typeof t!="function")throw new Te(s);return Vt(n)&&(d="leading"in n?!!n.leading:d,R="trailing"in n?!!n.trailing:R),qa(t,e,{leading:d,maxWait:e,trailing:R})}function Ep(t){return Va(t,1)}function Sp(t,e){return fo(Qi(e),t)}function Pp(){if(!arguments.length)return[];var t=arguments[0];return Rt(t)?t:[t]}function wp(t){return Se(t,I)}function _p(t,e){return e=typeof e=="function"?e:p,Se(t,I,e)}function xp(t){return Se(t,L|I)}function Mp(t,e){return e=typeof e=="function"?e:p,Se(t,L|I,e)}function Lp(t,e){return e==null||Gs(t,e,ne(e))}function De(t,e){return t===e||t!==t&&e!==e}var Dp=Wr(Bi),Np=Wr(function(t,e){return t>=e}),On=zs(function(){return arguments}())?zs:function(t){return Jt(t)&&Ut.call(t,"callee")&&!_s.call(t,"callee")},Rt=tt.isArray,Up=fs?ve(fs):zf;function de(t){return t!=null&&qr(t.length)&&!qe(t)}function $t(t){return Jt(t)&&de(t)}function Bp(t){return t===!0||t===!1||Jt(t)&&ue(t)==Z}var cn=qc||Ro,Gp=ds?ve(ds):Vf;function Fp(t){return Jt(t)&&t.nodeType===1&&!or(t)}function Hp(t){if(t==null)return!0;if(de(t)&&(Rt(t)||typeof t=="string"||typeof t.splice=="function"||cn(t)||Un(t)||On(t)))return!t.length;var e=se(t);if(e==ct||e==zt)return!t.size;if(rr(t))return!Hi(t).length;for(var n in t)if(Ut.call(t,n))return!1;return!0}function Wp(t,e){return tr(t,e)}function jp(t,e,n){n=typeof n=="function"?n:p;var d=n?n(t,e):p;return d===p?tr(t,e,p,n):!!d}function ho(t){if(!Jt(t))return!1;var e=ue(t);return e==vt||e==dt||typeof t.message=="string"&&typeof t.name=="string"&&!or(t)}function kp(t){return typeof t=="number"&&Ms(t)}function qe(t){if(!Vt(t))return!1;var e=ue(t);return e==mt||e==wt||e==V||e==xe}function Xa(t){return typeof t=="number"&&t==It(t)}function qr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=F}function Vt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Jt(t){return t!=null&&typeof t=="object"}var Za=hs?ve(hs):Jf;function zp(t,e){return t===e||Fi(t,e,no(e))}function Vp(t,e,n){return n=typeof n=="function"?n:p,Fi(t,e,no(e),n)}function Kp(t){return tu(t)&&t!=+t}function Jp(t){if(_d(t))throw new At(c);return Vs(t)}function $p(t){return t===null}function Qp(t){return t==null}function tu(t){return typeof t=="number"||Jt(t)&&ue(t)==Dt}function or(t){if(!Jt(t)||ue(t)!=Wt)return!1;var e=Rr(t);if(e===null)return!0;var n=Ut.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Cr.call(n)==zc}var po=ps?ve(ps):$f;function qp(t){return Xa(t)&&t>=-F&&t<=F}var eu=gs?ve(gs):Qf;function Yr(t){return typeof t=="string"||!Rt(t)&&Jt(t)&&ue(t)==Fe}function ye(t){return typeof t=="symbol"||Jt(t)&&ue(t)==Ze}var Un=vs?ve(vs):qf;function Yp(t){return t===p}function Xp(t){return Jt(t)&&se(t)==fn}function Zp(t){return Jt(t)&&ue(t)==si}var tg=Wr(Wi),eg=Wr(function(t,e){return t<=e});function nu(t){if(!t)return[];if(de(t))return Yr(t)?Me(t):fe(t);if(Kn&&t[Kn])return Mc(t[Kn]());var e=se(t),n=e==ct?Pi:e==zt?vr:Bn;return n(t)}function Ye(t){if(!t)return t===0?t:0;if(t=_e(t),t===M||t===-M){var e=t<0?-1:1;return e*W}return t===t?t:0}function It(t){var e=Ye(t),n=e%1;return e===e?n?e-n:e:0}function ru(t){return t?vn(It(t),0,X):0}function _e(t){if(typeof t=="number")return t;if(ye(t))return K;if(Vt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Vt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=As(t);var n=Nl.test(t);return n||Bl.test(t)?gc(t.slice(2),n?2:8):Dl.test(t)?K:+t}function iu(t){return We(t,he(t))}function ng(t){return t?vn(It(t),-F,F):t===0?t:0}function Nt(t){return t==null?"":me(t)}var rg=Ln(function(t,e){if(rr(e)||de(e)){We(e,ne(e),t);return}for(var n in e)Ut.call(e,n)&&Yn(t,n,e[n])}),ou=Ln(function(t,e){We(e,he(e),t)}),Xr=Ln(function(t,e,n,d){We(e,he(e),t,d)}),ig=Ln(function(t,e,n,d){We(e,ne(e),t,d)}),og=$e(Di);function sg(t,e){var n=Mn(t);return e==null?n:Bs(n,e)}var ag=St(function(t,e){t=Ft(t);var n=-1,d=e.length,R=d>2?e[2]:p;for(R&&le(e[0],e[1],R)&&(d=1);++n<d;)for(var G=e[n],z=he(G),J=-1,q=z.length;++J<q;){var it=z[J],ot=t[it];(ot===p||De(ot,wn[it])&&!Ut.call(t,it))&&(t[it]=G[it])}return t}),ug=St(function(t){return t.push(p,Aa),ge(su,p,t)});function lg(t,e){return ys(t,yt(e,3),He)}function cg(t,e){return ys(t,yt(e,3),Ui)}function fg(t,e){return t==null?t:Ni(t,yt(e,3),he)}function dg(t,e){return t==null?t:js(t,yt(e,3),he)}function hg(t,e){return t&&He(t,yt(e,3))}function pg(t,e){return t&&Ui(t,yt(e,3))}function gg(t){return t==null?[]:Lr(t,ne(t))}function vg(t){return t==null?[]:Lr(t,he(t))}function go(t,e,n){var d=t==null?p:mn(t,e);return d===p?n:d}function mg(t,e){return t!=null&&Ta(t,e,Hf)}function vo(t,e){return t!=null&&Ta(t,e,Wf)}var yg=ma(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Or.call(e)),t[e]=n},yo(pe)),Cg=ma(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Or.call(e)),Ut.call(t,e)?t[e].push(n):t[e]=[n]},yt),Og=St(Zn);function ne(t){return de(t)?Ns(t):Hi(t)}function he(t){return de(t)?Ns(t,!0):Yf(t)}function bg(t,e){var n={};return e=yt(e,3),He(t,function(d,R,G){Ke(n,e(d,R,G),d)}),n}function Ag(t,e){var n={};return e=yt(e,3),He(t,function(d,R,G){Ke(n,R,e(d,R,G))}),n}var Rg=Ln(function(t,e,n){Dr(t,e,n)}),su=Ln(function(t,e,n,d){Dr(t,e,n,d)}),Ig=$e(function(t,e){var n={};if(t==null)return n;var d=!1;e=kt(e,function(G){return G=un(G,t),d||(d=G.length>1),G}),We(t,to(t),n),d&&(n=Se(n,L|y|I,yd));for(var R=e.length;R--;)Ki(n,e[R]);return n});function Tg(t,e){return au(t,Qr(yt(e)))}var Eg=$e(function(t,e){return t==null?{}:Zf(t,e)});function au(t,e){if(t==null)return{};var n=kt(to(t),function(d){return[d]});return e=yt(e),Xs(t,n,function(d,R){return e(d,R[0])})}function Sg(t,e,n){e=un(e,t);var d=-1,R=e.length;for(R||(R=1,t=p);++d<R;){var G=t==null?p:t[je(e[d])];G===p&&(d=R,G=n),t=qe(G)?G.call(t):G}return t}function Pg(t,e,n){return t==null?t:er(t,e,n)}function wg(t,e,n,d){return d=typeof d=="function"?d:p,t==null?t:er(t,e,n,d)}var uu=Oa(ne),lu=Oa(he);function _g(t,e,n){var d=Rt(t),R=d||cn(t)||Un(t);if(e=yt(e,4),n==null){var G=t&&t.constructor;R?n=d?new G:[]:Vt(t)?n=qe(G)?Mn(Rr(t)):{}:n={}}return(R?Ie:He)(t,function(z,J,q){return e(n,z,J,q)}),n}function xg(t,e){return t==null?!0:Ki(t,e)}function Mg(t,e,n){return t==null?t:ra(t,e,Qi(n))}function Lg(t,e,n,d){return d=typeof d=="function"?d:p,t==null?t:ra(t,e,Qi(n),d)}function Bn(t){return t==null?[]:Si(t,ne(t))}function Dg(t){return t==null?[]:Si(t,he(t))}function Ng(t,e,n){return n===p&&(n=e,e=p),n!==p&&(n=_e(n),n=n===n?n:0),e!==p&&(e=_e(e),e=e===e?e:0),vn(_e(t),e,n)}function Ug(t,e,n){return e=Ye(e),n===p?(n=e,e=0):n=Ye(n),t=_e(t),jf(t,e,n)}function Bg(t,e,n){if(n&&typeof n!="boolean"&&le(t,e,n)&&(e=n=p),n===p&&(typeof e=="boolean"?(n=e,e=p):typeof t=="boolean"&&(n=t,t=p)),t===p&&e===p?(t=0,e=1):(t=Ye(t),e===p?(e=t,t=0):e=Ye(e)),t>e){var d=t;t=e,e=d}if(n||t%1||e%1){var R=Ls();return oe(t+R*(e-t+pc("1e-"+((R+"").length-1))),e)}return ki(t,e)}var Gg=Dn(function(t,e,n){return e=e.toLowerCase(),t+(n?cu(e):e)});function cu(t){return mo(Nt(t).toLowerCase())}function fu(t){return t=Nt(t),t&&t.replace(Fl,Sc).replace(ic,"")}function Fg(t,e,n){t=Nt(t),e=me(e);var d=t.length;n=n===p?d:vn(It(n),0,d);var R=n;return n-=e.length,n>=0&&t.slice(n,R)==e}function Hg(t){return t=Nt(t),t&&Cl.test(t)?t.replace(jo,Pc):t}function Wg(t){return t=Nt(t),t&&Tl.test(t)?t.replace(fi,"\\$&"):t}var jg=Dn(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),kg=Dn(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),zg=pa("toLowerCase");function Vg(t,e,n){t=Nt(t),e=It(e);var d=e?Pn(t):0;if(!e||d>=e)return t;var R=(e-d)/2;return Hr(Sr(R),n)+t+Hr(Er(R),n)}function Kg(t,e,n){t=Nt(t),e=It(e);var d=e?Pn(t):0;return e&&d<e?t+Hr(e-d,n):t}function Jg(t,e,n){t=Nt(t),e=It(e);var d=e?Pn(t):0;return e&&d<e?Hr(e-d,n)+t:t}function $g(t,e,n){return n||e==null?e=0:e&&(e=+e),tf(Nt(t).replace(di,""),e||0)}function Qg(t,e,n){return(n?le(t,e,n):e===p)?e=1:e=It(e),zi(Nt(t),e)}function qg(){var t=arguments,e=Nt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var Yg=Dn(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function Xg(t,e,n){return n&&typeof n!="number"&&le(t,e,n)&&(e=n=p),n=n===p?X:n>>>0,n?(t=Nt(t),t&&(typeof e=="string"||e!=null&&!po(e))&&(e=me(e),!e&&Sn(t))?ln(Me(t),0,n):t.split(e,n)):[]}var Zg=Dn(function(t,e,n){return t+(n?" ":"")+mo(e)});function tv(t,e,n){return t=Nt(t),n=n==null?0:vn(It(n),0,t.length),e=me(e),t.slice(n,n+e.length)==e}function ev(t,e,n){var d=D.templateSettings;n&&le(t,e,n)&&(e=p),t=Nt(t),e=Xr({},e,d,ba);var R=Xr({},e.imports,d.imports,ba),G=ne(R),z=Si(R,G),J,q,it=0,ot=e.interpolate||fr,st="__p += '",ft=wi((e.escape||fr).source+"|"+ot.source+"|"+(ot===ko?Ll:fr).source+"|"+(e.evaluate||fr).source+"|$","g"),gt="//# sourceURL="+(Ut.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lc+"]")+`
`;t.replace(ft,function(Ot,Pt,xt,Ce,ce,Oe){return xt||(xt=Ce),st+=t.slice(it,Oe).replace(Hl,wc),Pt&&(J=!0,st+=`' +
__e(`+Pt+`) +
'`),ce&&(q=!0,st+=`';
`+ce+`;
__p += '`),xt&&(st+=`' +
((__t = (`+xt+`)) == null ? '' : __t) +
'`),it=Oe+Ot.length,Ot}),st+=`';
`;var Ct=Ut.call(e,"variable")&&e.variable;if(!Ct)st=`with (obj) {
`+st+`
}
`;else if(xl.test(Ct))throw new At(E);st=(q?st.replace(gl,""):st).replace(vl,"$1").replace(ml,"$1;"),st="function("+(Ct||"obj")+`) {
`+(Ct?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+st+`return __p
}`;var Et=hu(function(){return Lt(G,gt+"return "+st).apply(p,z)});if(Et.source=st,ho(Et))throw Et;return Et}function nv(t){return Nt(t).toLowerCase()}function rv(t){return Nt(t).toUpperCase()}function iv(t,e,n){if(t=Nt(t),t&&(n||e===p))return As(t);if(!t||!(e=me(e)))return t;var d=Me(t),R=Me(e),G=Rs(d,R),z=Is(d,R)+1;return ln(d,G,z).join("")}function ov(t,e,n){if(t=Nt(t),t&&(n||e===p))return t.slice(0,Es(t)+1);if(!t||!(e=me(e)))return t;var d=Me(t),R=Is(d,Me(e))+1;return ln(d,0,R).join("")}function sv(t,e,n){if(t=Nt(t),t&&(n||e===p))return t.replace(di,"");if(!t||!(e=me(e)))return t;var d=Me(t),R=Rs(d,Me(e));return ln(d,R).join("")}function av(t,e){var n=l,d=A;if(Vt(e)){var R="separator"in e?e.separator:R;n="length"in e?It(e.length):n,d="omission"in e?me(e.omission):d}t=Nt(t);var G=t.length;if(Sn(t)){var z=Me(t);G=z.length}if(n>=G)return t;var J=n-Pn(d);if(J<1)return d;var q=z?ln(z,0,J).join(""):t.slice(0,J);if(R===p)return q+d;if(z&&(J+=q.length-J),po(R)){if(t.slice(J).search(R)){var it,ot=q;for(R.global||(R=wi(R.source,Nt(zo.exec(R))+"g")),R.lastIndex=0;it=R.exec(ot);)var st=it.index;q=q.slice(0,st===p?J:st)}}else if(t.indexOf(me(R),J)!=J){var ft=q.lastIndexOf(R);ft>-1&&(q=q.slice(0,ft))}return q+d}function uv(t){return t=Nt(t),t&&yl.test(t)?t.replace(Wo,Uc):t}var lv=Dn(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),mo=pa("toUpperCase");function du(t,e,n){return t=Nt(t),e=n?p:e,e===p?xc(t)?Fc(t):Ac(t):t.match(e)||[]}var hu=St(function(t,e){try{return ge(t,p,e)}catch(n){return ho(n)?n:new At(n)}}),cv=$e(function(t,e){return Ie(e,function(n){n=je(n),Ke(t,n,co(t[n],t))}),t});function fv(t){var e=t==null?0:t.length,n=yt();return t=e?kt(t,function(d){if(typeof d[1]!="function")throw new Te(s);return[n(d[0]),d[1]]}):[],St(function(d){for(var R=-1;++R<e;){var G=t[R];if(ge(G[0],this,d))return ge(G[1],this,d)}})}function dv(t){return Bf(Se(t,L))}function yo(t){return function(){return t}}function hv(t,e){return t==null||t!==t?e:t}var pv=va(),gv=va(!0);function pe(t){return t}function Co(t){return Ks(typeof t=="function"?t:Se(t,L))}function vv(t){return $s(Se(t,L))}function mv(t,e){return Qs(t,Se(e,L))}var yv=St(function(t,e){return function(n){return Zn(n,t,e)}}),Cv=St(function(t,e){return function(n){return Zn(t,n,e)}});function Oo(t,e,n){var d=ne(e),R=Lr(e,d);n==null&&!(Vt(e)&&(R.length||!d.length))&&(n=e,e=t,t=this,R=Lr(e,ne(e)));var G=!(Vt(n)&&"chain"in n)||!!n.chain,z=qe(t);return Ie(R,function(J){var q=e[J];t[J]=q,z&&(t.prototype[J]=function(){var it=this.__chain__;if(G||it){var ot=t(this.__wrapped__),st=ot.__actions__=fe(this.__actions__);return st.push({func:q,args:arguments,thisArg:t}),ot.__chain__=it,ot}return q.apply(t,en([this.value()],arguments))})}),t}function Ov(){return ee._===this&&(ee._=Vc),this}function bo(){}function bv(t){return t=It(t),St(function(e){return qs(e,t)})}var Av=Yi(kt),Rv=Yi(ms),Iv=Yi(Ai);function pu(t){return io(t)?Ri(je(t)):td(t)}function Tv(t){return function(e){return t==null?p:mn(t,e)}}var Ev=ya(),Sv=ya(!0);function Ao(){return[]}function Ro(){return!1}function Pv(){return{}}function wv(){return""}function _v(){return!0}function xv(t,e){if(t=It(t),t<1||t>F)return[];var n=X,d=oe(t,X);e=yt(e),t-=X;for(var R=Ei(d,e);++n<t;)e(n);return R}function Mv(t){return Rt(t)?kt(t,je):ye(t)?[t]:fe(Da(Nt(t)))}function Lv(t){var e=++kc;return Nt(t)+e}var Dv=Fr(function(t,e){return t+e},0),Nv=Xi("ceil"),Uv=Fr(function(t,e){return t/e},1),Bv=Xi("floor");function Gv(t){return t&&t.length?Mr(t,pe,Bi):p}function Fv(t,e){return t&&t.length?Mr(t,yt(e,2),Bi):p}function Hv(t){return Os(t,pe)}function Wv(t,e){return Os(t,yt(e,2))}function jv(t){return t&&t.length?Mr(t,pe,Wi):p}function kv(t,e){return t&&t.length?Mr(t,yt(e,2),Wi):p}var zv=Fr(function(t,e){return t*e},1),Vv=Xi("round"),Kv=Fr(function(t,e){return t-e},0);function Jv(t){return t&&t.length?Ti(t,pe):0}function $v(t,e){return t&&t.length?Ti(t,yt(e,2)):0}return D.after=vp,D.ary=Va,D.assign=rg,D.assignIn=ou,D.assignInWith=Xr,D.assignWith=ig,D.at=og,D.before=Ka,D.bind=co,D.bindAll=cv,D.bindKey=Ja,D.castArray=Pp,D.chain=ja,D.chunk=Bd,D.compact=Gd,D.concat=Fd,D.cond=fv,D.conforms=dv,D.constant=yo,D.countBy=Jh,D.create=sg,D.curry=$a,D.curryRight=Qa,D.debounce=qa,D.defaults=ag,D.defaultsDeep=ug,D.defer=mp,D.delay=yp,D.difference=Hd,D.differenceBy=Wd,D.differenceWith=jd,D.drop=kd,D.dropRight=zd,D.dropRightWhile=Vd,D.dropWhile=Kd,D.fill=Jd,D.filter=Qh,D.flatMap=Xh,D.flatMapDeep=Zh,D.flatMapDepth=tp,D.flatten=Ga,D.flattenDeep=$d,D.flattenDepth=Qd,D.flip=Cp,D.flow=pv,D.flowRight=gv,D.fromPairs=qd,D.functions=gg,D.functionsIn=vg,D.groupBy=ep,D.initial=Xd,D.intersection=Zd,D.intersectionBy=th,D.intersectionWith=eh,D.invert=yg,D.invertBy=Cg,D.invokeMap=rp,D.iteratee=Co,D.keyBy=ip,D.keys=ne,D.keysIn=he,D.map=Kr,D.mapKeys=bg,D.mapValues=Ag,D.matches=vv,D.matchesProperty=mv,D.memoize=$r,D.merge=Rg,D.mergeWith=su,D.method=yv,D.methodOf=Cv,D.mixin=Oo,D.negate=Qr,D.nthArg=bv,D.omit=Ig,D.omitBy=Tg,D.once=Op,D.orderBy=op,D.over=Av,D.overArgs=bp,D.overEvery=Rv,D.overSome=Iv,D.partial=fo,D.partialRight=Ya,D.partition=sp,D.pick=Eg,D.pickBy=au,D.property=pu,D.propertyOf=Tv,D.pull=oh,D.pullAll=Ha,D.pullAllBy=sh,D.pullAllWith=ah,D.pullAt=uh,D.range=Ev,D.rangeRight=Sv,D.rearg=Ap,D.reject=lp,D.remove=lh,D.rest=Rp,D.reverse=uo,D.sampleSize=fp,D.set=Pg,D.setWith=wg,D.shuffle=dp,D.slice=ch,D.sortBy=gp,D.sortedUniq=mh,D.sortedUniqBy=yh,D.split=Xg,D.spread=Ip,D.tail=Ch,D.take=Oh,D.takeRight=bh,D.takeRightWhile=Ah,D.takeWhile=Rh,D.tap=Gh,D.throttle=Tp,D.thru=Vr,D.toArray=nu,D.toPairs=uu,D.toPairsIn=lu,D.toPath=Mv,D.toPlainObject=iu,D.transform=_g,D.unary=Ep,D.union=Ih,D.unionBy=Th,D.unionWith=Eh,D.uniq=Sh,D.uniqBy=Ph,D.uniqWith=wh,D.unset=xg,D.unzip=lo,D.unzipWith=Wa,D.update=Mg,D.updateWith=Lg,D.values=Bn,D.valuesIn=Dg,D.without=_h,D.words=du,D.wrap=Sp,D.xor=xh,D.xorBy=Mh,D.xorWith=Lh,D.zip=Dh,D.zipObject=Nh,D.zipObjectDeep=Uh,D.zipWith=Bh,D.entries=uu,D.entriesIn=lu,D.extend=ou,D.extendWith=Xr,Oo(D,D),D.add=Dv,D.attempt=hu,D.camelCase=Gg,D.capitalize=cu,D.ceil=Nv,D.clamp=Ng,D.clone=wp,D.cloneDeep=xp,D.cloneDeepWith=Mp,D.cloneWith=_p,D.conformsTo=Lp,D.deburr=fu,D.defaultTo=hv,D.divide=Uv,D.endsWith=Fg,D.eq=De,D.escape=Hg,D.escapeRegExp=Wg,D.every=$h,D.find=qh,D.findIndex=Ua,D.findKey=lg,D.findLast=Yh,D.findLastIndex=Ba,D.findLastKey=cg,D.floor=Bv,D.forEach=ka,D.forEachRight=za,D.forIn=fg,D.forInRight=dg,D.forOwn=hg,D.forOwnRight=pg,D.get=go,D.gt=Dp,D.gte=Np,D.has=mg,D.hasIn=vo,D.head=Fa,D.identity=pe,D.includes=np,D.indexOf=Yd,D.inRange=Ug,D.invoke=Og,D.isArguments=On,D.isArray=Rt,D.isArrayBuffer=Up,D.isArrayLike=de,D.isArrayLikeObject=$t,D.isBoolean=Bp,D.isBuffer=cn,D.isDate=Gp,D.isElement=Fp,D.isEmpty=Hp,D.isEqual=Wp,D.isEqualWith=jp,D.isError=ho,D.isFinite=kp,D.isFunction=qe,D.isInteger=Xa,D.isLength=qr,D.isMap=Za,D.isMatch=zp,D.isMatchWith=Vp,D.isNaN=Kp,D.isNative=Jp,D.isNil=Qp,D.isNull=$p,D.isNumber=tu,D.isObject=Vt,D.isObjectLike=Jt,D.isPlainObject=or,D.isRegExp=po,D.isSafeInteger=qp,D.isSet=eu,D.isString=Yr,D.isSymbol=ye,D.isTypedArray=Un,D.isUndefined=Yp,D.isWeakMap=Xp,D.isWeakSet=Zp,D.join=nh,D.kebabCase=jg,D.last=we,D.lastIndexOf=rh,D.lowerCase=kg,D.lowerFirst=zg,D.lt=tg,D.lte=eg,D.max=Gv,D.maxBy=Fv,D.mean=Hv,D.meanBy=Wv,D.min=jv,D.minBy=kv,D.stubArray=Ao,D.stubFalse=Ro,D.stubObject=Pv,D.stubString=wv,D.stubTrue=_v,D.multiply=zv,D.nth=ih,D.noConflict=Ov,D.noop=bo,D.now=Jr,D.pad=Vg,D.padEnd=Kg,D.padStart=Jg,D.parseInt=$g,D.random=Bg,D.reduce=ap,D.reduceRight=up,D.repeat=Qg,D.replace=qg,D.result=Sg,D.round=Vv,D.runInContext=Q,D.sample=cp,D.size=hp,D.snakeCase=Yg,D.some=pp,D.sortedIndex=fh,D.sortedIndexBy=dh,D.sortedIndexOf=hh,D.sortedLastIndex=ph,D.sortedLastIndexBy=gh,D.sortedLastIndexOf=vh,D.startCase=Zg,D.startsWith=tv,D.subtract=Kv,D.sum=Jv,D.sumBy=$v,D.template=ev,D.times=xv,D.toFinite=Ye,D.toInteger=It,D.toLength=ru,D.toLower=nv,D.toNumber=_e,D.toSafeInteger=ng,D.toString=Nt,D.toUpper=rv,D.trim=iv,D.trimEnd=ov,D.trimStart=sv,D.truncate=av,D.unescape=uv,D.uniqueId=Lv,D.upperCase=lv,D.upperFirst=mo,D.each=ka,D.eachRight=za,D.first=Fa,Oo(D,function(){var t={};return He(D,function(e,n){Ut.call(D.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),D.VERSION=f,Ie(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){D[t].placeholder=D}),Ie(["drop","take"],function(t,e){_t.prototype[t]=function(n){n=n===p?1:Zt(It(n),0);var d=this.__filtered__&&!e?new _t(this):this.clone();return d.__filtered__?d.__takeCount__=oe(n,d.__takeCount__):d.__views__.push({size:oe(n,X),type:t+(d.__dir__<0?"Right":"")}),d},_t.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),Ie(["filter","map","takeWhile"],function(t,e){var n=e+1,d=n==j||n==P;_t.prototype[t]=function(R){var G=this.clone();return G.__iteratees__.push({iteratee:yt(R,3),type:n}),G.__filtered__=G.__filtered__||d,G}}),Ie(["head","last"],function(t,e){var n="take"+(e?"Right":"");_t.prototype[t]=function(){return this[n](1).value()[0]}}),Ie(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");_t.prototype[t]=function(){return this.__filtered__?new _t(this):this[n](1)}}),_t.prototype.compact=function(){return this.filter(pe)},_t.prototype.find=function(t){return this.filter(t).head()},_t.prototype.findLast=function(t){return this.reverse().find(t)},_t.prototype.invokeMap=St(function(t,e){return typeof t=="function"?new _t(this):this.map(function(n){return Zn(n,t,e)})}),_t.prototype.reject=function(t){return this.filter(Qr(yt(t)))},_t.prototype.slice=function(t,e){t=It(t);var n=this;return n.__filtered__&&(t>0||e<0)?new _t(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==p&&(e=It(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},_t.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},_t.prototype.toArray=function(){return this.take(X)},He(_t.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),d=/^(?:head|last)$/.test(e),R=D[d?"take"+(e=="last"?"Right":""):e],G=d||/^find/.test(e);!R||(D.prototype[e]=function(){var z=this.__wrapped__,J=d?[1]:arguments,q=z instanceof _t,it=J[0],ot=q||Rt(z),st=function(Pt){var xt=R.apply(D,en([Pt],J));return d&&ft?xt[0]:xt};ot&&n&&typeof it=="function"&&it.length!=1&&(q=ot=!1);var ft=this.__chain__,gt=!!this.__actions__.length,Ct=G&&!ft,Et=q&&!gt;if(!G&&ot){z=Et?z:new _t(this);var Ot=t.apply(z,J);return Ot.__actions__.push({func:Vr,args:[st],thisArg:p}),new Ee(Ot,ft)}return Ct&&Et?t.apply(this,J):(Ot=this.thru(st),Ct?d?Ot.value()[0]:Ot.value():Ot)})}),Ie(["pop","push","shift","sort","splice","unshift"],function(t){var e=mr[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",d=/^(?:pop|shift)$/.test(t);D.prototype[t]=function(){var R=arguments;if(d&&!this.__chain__){var G=this.value();return e.apply(Rt(G)?G:[],R)}return this[n](function(z){return e.apply(Rt(z)?z:[],R)})}}),He(_t.prototype,function(t,e){var n=D[e];if(n){var d=n.name+"";Ut.call(xn,d)||(xn[d]=[]),xn[d].push({name:e,func:n})}}),xn[Gr(p,T).name]=[{name:"wrapper",func:p}],_t.prototype.clone=uf,_t.prototype.reverse=lf,_t.prototype.value=cf,D.prototype.at=Fh,D.prototype.chain=Hh,D.prototype.commit=Wh,D.prototype.next=jh,D.prototype.plant=zh,D.prototype.reverse=Vh,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=Kh,D.prototype.first=D.prototype.head,Kn&&(D.prototype[Kn]=kh),D},rn=Hc();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(ee._=rn,define(function(){return rn})):dn?((dn.exports=rn)._=rn,yi._=rn):ee._=rn}).call(Wn)});var al={};Cu(al,{version:()=>l0});var l0,ul=Io(()=>{ut();l0="lab"});var ll={};Cu(ll,{default:()=>c0});var c0,cl=Io(()=>{ut();c0={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var fl=qt((ri,Do)=>{ut();(function(f,r){typeof ri=="object"&&typeof Do=="object"?Do.exports=r():typeof define=="function"&&define.amd?define([],r):typeof ri=="object"?ri.Ably=r():f.Ably=r()})(window,function(){return function(p){var f={};function r(c){if(f[c])return f[c].exports;var s=f[c]={i:c,l:!1,exports:{}};return p[c].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=p,r.c=f,r.d=function(c,s,E){r.o(c,s)||Object.defineProperty(c,s,{enumerable:!0,get:E})},r.r=function(c){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},r.t=function(c,s){if(s&1&&(c=r(c)),s&8||s&4&&typeof c=="object"&&c&&c.__esModule)return c;var E=Object.create(null);if(r.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:c}),s&2&&typeof c!="string")for(var O in c)r.d(E,O,function(S){return c[S]}.bind(null,O));return E},r.n=function(c){var s=c&&c.__esModule?function(){return c.default}:function(){return c};return r.d(s,"a",s),s},r.o=function(c,s){return Object.prototype.hasOwnProperty.call(c,s)},r.p="",r(r.s=42)}([function(p,f,r){"use strict";r.r(f),r.d(f,"__extends",function(){return s}),r.d(f,"__assign",function(){return E}),r.d(f,"__rest",function(){return O}),r.d(f,"__decorate",function(){return S}),r.d(f,"__param",function(){return _}),r.d(f,"__metadata",function(){return L}),r.d(f,"__awaiter",function(){return y}),r.d(f,"__generator",function(){return I}),r.d(f,"__createBinding",function(){return u}),r.d(f,"__exportStar",function(){return C}),r.d(f,"__values",function(){return x}),r.d(f,"__read",function(){return T}),r.d(f,"__spread",function(){return m}),r.d(f,"__spreadArrays",function(){return g}),r.d(f,"__spreadArray",function(){return b}),r.d(f,"__await",function(){return a}),r.d(f,"__asyncGenerator",function(){return h}),r.d(f,"__asyncDelegator",function(){return i}),r.d(f,"__asyncValues",function(){return o}),r.d(f,"__makeTemplateObject",function(){return v}),r.d(f,"__importStar",function(){return A}),r.d(f,"__importDefault",function(){return U}),r.d(f,"__classPrivateFieldGet",function(){return k}),r.d(f,"__classPrivateFieldSet",function(){return j});var c=function(N,P){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,F){M.__proto__=F}||function(M,F){for(var W in F)Object.prototype.hasOwnProperty.call(F,W)&&(M[W]=F[W])},c(N,P)};function s(N,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");c(N,P);function M(){this.constructor=N}N.prototype=P===null?Object.create(P):(M.prototype=P.prototype,new M)}var E=function(){return E=Object.assign||function(P){for(var M,F=1,W=arguments.length;F<W;F++){M=arguments[F];for(var K in M)Object.prototype.hasOwnProperty.call(M,K)&&(P[K]=M[K])}return P},E.apply(this,arguments)};function O(N,P){var M={};for(var F in N)Object.prototype.hasOwnProperty.call(N,F)&&P.indexOf(F)<0&&(M[F]=N[F]);if(N!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,F=Object.getOwnPropertySymbols(N);W<F.length;W++)P.indexOf(F[W])<0&&Object.prototype.propertyIsEnumerable.call(N,F[W])&&(M[F[W]]=N[F[W]]);return M}function S(N,P,M,F){var W=arguments.length,K=W<3?P:F===null?F=Object.getOwnPropertyDescriptor(P,M):F,X;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(N,P,M,F);else for(var et=N.length-1;et>=0;et--)(X=N[et])&&(K=(W<3?X(K):W>3?X(P,M,K):X(P,M))||K);return W>3&&K&&Object.defineProperty(P,M,K),K}function _(N,P){return function(M,F){P(M,F,N)}}function L(N,P){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(N,P)}function y(N,P,M,F){function W(K){return K instanceof M?K:new M(function(X){X(K)})}return new(M||(M=Promise))(function(K,X){function et(B){try{w(F.next(B))}catch(H){X(H)}}function Y(B){try{w(F.throw(B))}catch(H){X(H)}}function w(B){B.done?K(B.value):W(B.value).then(et,Y)}w((F=F.apply(N,P||[])).next())})}function I(N,P){var M={label:0,sent:function(){if(K[0]&1)throw K[1];return K[1]},trys:[],ops:[]},F,W,K,X;return X={next:et(0),throw:et(1),return:et(2)},typeof Symbol=="function"&&(X[Symbol.iterator]=function(){return this}),X;function et(w){return function(B){return Y([w,B])}}function Y(w){if(F)throw new TypeError("Generator is already executing.");for(;M;)try{if(F=1,W&&(K=w[0]&2?W.return:w[0]?W.throw||((K=W.return)&&K.call(W),0):W.next)&&!(K=K.call(W,w[1])).done)return K;switch(W=0,K&&(w=[w[0]&2,K.value]),w[0]){case 0:case 1:K=w;break;case 4:return M.label++,{value:w[1],done:!1};case 5:M.label++,W=w[1],w=[0];continue;case 7:w=M.ops.pop(),M.trys.pop();continue;default:if(K=M.trys,!(K=K.length>0&&K[K.length-1])&&(w[0]===6||w[0]===2)){M=0;continue}if(w[0]===3&&(!K||w[1]>K[0]&&w[1]<K[3])){M.label=w[1];break}if(w[0]===6&&M.label<K[1]){M.label=K[1],K=w;break}if(K&&M.label<K[2]){M.label=K[2],M.ops.push(w);break}K[2]&&M.ops.pop(),M.trys.pop();continue}w=P.call(N,M)}catch(B){w=[6,B],W=0}finally{F=K=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var u=Object.create?function(N,P,M,F){F===void 0&&(F=M),Object.defineProperty(N,F,{enumerable:!0,get:function(){return P[M]}})}:function(N,P,M,F){F===void 0&&(F=M),N[F]=P[M]};function C(N,P){for(var M in N)M!=="default"&&!Object.prototype.hasOwnProperty.call(P,M)&&u(P,N,M)}function x(N){var P=typeof Symbol=="function"&&Symbol.iterator,M=P&&N[P],F=0;if(M)return M.call(N);if(N&&typeof N.length=="number")return{next:function(){return N&&F>=N.length&&(N=void 0),{value:N&&N[F++],done:!N}}};throw new TypeError(P?"Object is not iterable.":"Symbol.iterator is not defined.")}function T(N,P){var M=typeof Symbol=="function"&&N[Symbol.iterator];if(!M)return N;var F=M.call(N),W,K=[],X;try{for(;(P===void 0||P-- >0)&&!(W=F.next()).done;)K.push(W.value)}catch(et){X={error:et}}finally{try{W&&!W.done&&(M=F.return)&&M.call(F)}finally{if(X)throw X.error}}return K}function m(){for(var N=[],P=0;P<arguments.length;P++)N=N.concat(T(arguments[P]));return N}function g(){for(var N=0,P=0,M=arguments.length;P<M;P++)N+=arguments[P].length;for(var F=Array(N),W=0,P=0;P<M;P++)for(var K=arguments[P],X=0,et=K.length;X<et;X++,W++)F[W]=K[X];return F}function b(N,P,M){if(M||arguments.length===2)for(var F=0,W=P.length,K;F<W;F++)(K||!(F in P))&&(K||(K=Array.prototype.slice.call(P,0,F)),K[F]=P[F]);return N.concat(K||Array.prototype.slice.call(P))}function a(N){return this instanceof a?(this.v=N,this):new a(N)}function h(N,P,M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=M.apply(N,P||[]),W,K=[];return W={},X("next"),X("throw"),X("return"),W[Symbol.asyncIterator]=function(){return this},W;function X(V){F[V]&&(W[V]=function(Z){return new Promise(function(lt,dt){K.push([V,Z,lt,dt])>1||et(V,Z)})})}function et(V,Z){try{Y(F[V](Z))}catch(lt){H(K[0][3],lt)}}function Y(V){V.value instanceof a?Promise.resolve(V.value.v).then(w,B):H(K[0][2],V)}function w(V){et("next",V)}function B(V){et("throw",V)}function H(V,Z){V(Z),K.shift(),K.length&&et(K[0][0],K[0][1])}}function i(N){var P,M;return P={},F("next"),F("throw",function(W){throw W}),F("return"),P[Symbol.iterator]=function(){return this},P;function F(W,K){P[W]=N[W]?function(X){return(M=!M)?{value:a(N[W](X)),done:W==="return"}:K?K(X):X}:K}}function o(N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var P=N[Symbol.asyncIterator],M;return P?P.call(N):(N=typeof x=="function"?x(N):N[Symbol.iterator](),M={},F("next"),F("throw"),F("return"),M[Symbol.asyncIterator]=function(){return this},M);function F(K){M[K]=N[K]&&function(X){return new Promise(function(et,Y){X=N[K](X),W(et,Y,X.done,X.value)})}}function W(K,X,et,Y){Promise.resolve(Y).then(function(w){K({value:w,done:et})},X)}}function v(N,P){return Object.defineProperty?Object.defineProperty(N,"raw",{value:P}):N.raw=P,N}var l=Object.create?function(N,P){Object.defineProperty(N,"default",{enumerable:!0,value:P})}:function(N,P){N.default=P};function A(N){if(N&&N.__esModule)return N;var P={};if(N!=null)for(var M in N)M!=="default"&&Object.prototype.hasOwnProperty.call(N,M)&&u(P,N,M);return l(P,N),P}function U(N){return N&&N.__esModule?N:{default:N}}function k(N,P,M,F){if(M==="a"&&!F)throw new TypeError("Private accessor was defined without a getter");if(typeof P=="function"?N!==P||!F:!P.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?F:M==="a"?F.call(N):F?F.value:P.get(N)}function j(N,P,M,F,W){if(F==="m")throw new TypeError("Private method is not writable");if(F==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof P=="function"?N!==P||!W:!P.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return F==="a"?W.call(N,M):W?W.value=M:P.set(N,M),M}},function(p,f,r){"use strict";(function(c){Object.defineProperty(f,"__esModule",{value:!0}),f.allToUpperCase=f.allToLowerCase=f.encodeBody=f.decodeBody=f.Format=f.promisify=f.trim=f.arrChooseN=f.randomHexString=f.randomString=f.cheapRandStr=f.dataSizeBytes=f.inspectBody=f.inspectError=f.isErrorInfoOrPartialErrorInfo=f.now=f.parseQueryString=f.toQueryString=f.arrPopRandomElement=f.defaultPostHeaders=f.defaultGetHeaders=f.allSame=f.arrEvery=f.arrFilter=f.arrMap=f.safeArrForEach=f.arrForEach=f.forInOwnNonNullProperties=f.valuesArray=f.keysArray=f.arrWithoutValue=f.arrDeleteValue=f.arrIn=f.arrIndexOf=f.arrSubtract=f.arrIntersectOb=f.arrIntersect=f.intersect=f.containsValue=f.inherits=f.prototypicalClone=f.shallowClone=f.isEmptyArg=f.isOnlyPropIn=f.isEmpty=f.isObject=f.ensureArray=f.isArray=f.copy=f.mixin=void 0,f.toBase64=f.matchDerivedChannel=f.shallowEquals=f.getGlobalObject=f.getRetryTime=f.getJitterCoefficient=f.getBackoffCoefficient=void 0;var s=r(0),E=s.__importDefault(r(3)),O=s.__importStar(r(8)),S=s.__importDefault(r(4)),_=r(11),L=r(31);function y($){return Math.floor(Math.random()*$.length)}function I($){for(var rt=[],at=1;at<arguments.length;at++)rt[at-1]=arguments[at];for(var pt=0;pt<rt.length;pt++){var Tt=rt[pt];if(!Tt)break;var te=Object.prototype.hasOwnProperty;for(var ke in Tt)(!te||te.call(Tt,ke))&&($[ke]=Tt[ke])}return $}f.mixin=I;function u($){return I({},$)}f.copy=u,f.isArray=Array.isArray||function($){return Object.prototype.toString.call($)=="[object Array]"};function C($){return g($)?[]:(0,f.isArray)($)?$:[$]}f.ensureArray=C;function x($){return Object.prototype.toString.call($)=="[object Object]"}f.isObject=x;function T($){for(var rt in $)return!1;return!0}f.isEmpty=T;function m($,rt){for(var at in $)if(at!==rt)return!1;return!0}f.isOnlyPropIn=m;function g($){return $==null}f.isEmptyArg=g;function b($){var rt=new Object;for(var at in $)rt[at]=$[at];return rt}f.shallowClone=b;function a($,rt){var at=function(){function Tt(){}return Tt}();at.prototype=$;var pt=new at;return rt&&I(pt,rt),pt}f.prototypicalClone=a;var h=function($,rt){if(E.default.Config.inherits){E.default.Config.inherits($,rt);return}$.super_=rt,$.prototype=a(rt.prototype,{constructor:$})};f.inherits=h;function i($,rt){for(var at in $)if($[at]==rt)return!0;return!1}f.containsValue=i;function o($,rt){return(0,f.isArray)(rt)?v($,rt):l($,rt)}f.intersect=o;function v($,rt){for(var at=[],pt=0;pt<$.length;pt++){var Tt=$[pt];(0,f.arrIndexOf)(rt,Tt)!=-1&&at.push(Tt)}return at}f.arrIntersect=v;function l($,rt){for(var at=[],pt=0;pt<$.length;pt++){var Tt=$[pt];Tt in rt&&at.push(Tt)}return at}f.arrIntersectOb=l;function A($,rt){for(var at=[],pt=0;pt<$.length;pt++){var Tt=$[pt];(0,f.arrIndexOf)(rt,Tt)==-1&&at.push(Tt)}return at}f.arrSubtract=A,f.arrIndexOf=Array.prototype.indexOf?function($,rt,at){return $.indexOf(rt,at)}:function($,rt,at){at=at||0;for(var pt=$.length;at<pt;at++)if($[at]===rt)return at;return-1};function U($,rt){return(0,f.arrIndexOf)($,rt)!==-1}f.arrIn=U;function k($,rt){var at=(0,f.arrIndexOf)($,rt),pt=at!=-1;return pt&&$.splice(at,1),pt}f.arrDeleteValue=k;function j($,rt){var at=$.slice();return k(at,rt),at}f.arrWithoutValue=j;function N($,rt){var at=[];for(var pt in $)rt&&!Object.prototype.hasOwnProperty.call($,pt)||at.push(pt);return at}f.keysArray=N;function P($,rt){var at=[];for(var pt in $)rt&&!Object.prototype.hasOwnProperty.call($,pt)||at.push($[pt]);return at}f.valuesArray=P;function M($,rt){for(var at in $)Object.prototype.hasOwnProperty.call($,at)&&$[at]&&rt(at)}f.forInOwnNonNullProperties=M,f.arrForEach=Array.prototype.forEach?function($,rt){$.forEach(rt)}:function($,rt){for(var at=$.length,pt=0;pt<at;pt++)rt($[pt],pt,$)};function F($,rt){return(0,f.arrForEach)($.slice(),rt)}f.safeArrForEach=F,f.arrMap=Array.prototype.map?function($,rt){return $.map(rt)}:function($,rt){for(var at=[],pt=$.length,Tt=0;Tt<pt;Tt++)at.push(rt($[Tt],Tt,$));return at},f.arrFilter=Array.prototype.filter?function($,rt){return $.filter(rt)}:function($,rt){for(var at=[],pt=$.length,Tt=0;Tt<pt;Tt++)rt($[Tt])&&at.push($[Tt]);return at},f.arrEvery=Array.prototype.every?function($,rt){return $.every(rt)}:function($,rt){for(var at=$.length,pt=0;pt<at;pt++)if(!rt($[pt],pt,$))return!1;return!0};function W($,rt){if($.length===0)return!0;var at=$[0][rt];return(0,f.arrEvery)($,function(pt){return pt[rt]===at})}f.allSame=W;var K={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function X($,rt){var at=K[rt||Dt.json];return{accept:at,"X-Ably-Version":O.default.protocolVersion.toString(),"Ably-Agent":(0,O.getAgentString)($)}}f.defaultGetHeaders=X;function et($,rt){var at,pt=at=K[rt||Dt.json];return{accept:pt,"content-type":at,"X-Ably-Version":O.default.protocolVersion.toString(),"Ably-Agent":(0,O.getAgentString)($)}}f.defaultPostHeaders=et;function Y($){return $.splice(y($),1)[0]}f.arrPopRandomElement=Y;function w($){var rt=[];if($)for(var at in $)rt.push(encodeURIComponent(at)+"="+encodeURIComponent($[at]));return rt.length?"?"+rt.join("&"):""}f.toQueryString=w;function B($){for(var rt,at=/([^?&=]+)=?([^&]*)/g,pt={};rt=at.exec($);)pt[decodeURIComponent(rt[1])]=decodeURIComponent(rt[2]);return pt}f.parseQueryString=B,f.now=Date.now||function(){return new Date().getTime()};function H($){return typeof $=="object"&&$!==null&&($.constructor.name=="ErrorInfo"||$.constructor.name=="PartialErrorInfo")}f.isErrorInfoOrPartialErrorInfo=H;function V($){var rt,at;return $ instanceof Error||((rt=$==null?void 0:$.constructor)===null||rt===void 0?void 0:rt.name)==="ErrorInfo"||((at=$==null?void 0:$.constructor)===null||at===void 0?void 0:at.name)==="PartialErrorInfo"?$.toString():E.default.Config.inspect($)}f.inspectError=V;function Z($){return E.default.BufferUtils.isBuffer($)?$.toString():typeof $=="string"?$:E.default.Config.inspect($)}f.inspectBody=Z;function lt($){if(E.default.BufferUtils.isBuffer($))return E.default.BufferUtils.byteLength($);if(typeof $=="string")return E.default.Config.stringByteSize($);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof $)}f.dataSizeBytes=lt;function dt(){return String(Math.random()).substr(2)}f.cheapRandStr=dt;var vt=function($){if(E.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array($);return E.default.Config.getRandomValues(rt),E.default.BufferUtils.base64Encode(rt)}for(var at=E.default.BufferUtils.base64CharSet,pt=Math.round($*4/3),Tt="",te=0;te<pt;te++)Tt+=at[y(at)];return Tt};f.randomString=vt;var mt=function($){if(E.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array($);return E.default.Config.getRandomValues(rt),E.default.BufferUtils.hexEncode(rt)}for(var at=E.default.BufferUtils.hexCharSet,pt=$*2,Tt="",te=0;te<pt;te++)Tt+=at[y(at)];return Tt};f.randomHexString=mt;function wt($,rt){for(var at=Math.min(rt,$.length),pt=$.slice(),Tt=[],te=0;te<at;te++)Tt.push(Y(pt));return Tt}f.arrChooseN=wt,f.trim=String.prototype.trim?function($){return $.trim()}:function($){return $.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ct($,rt,at){return new Promise(function(pt,Tt){$[rt].apply($,s.__spreadArray(s.__spreadArray([],at,!1),[function(te,ke){te?Tt(te):pt(ke)}],!1))})}f.promisify=ct;var Dt;(function($){$.msgpack="msgpack",$.json="json"})(Dt=f.Format||(f.Format={}));function Yt($,rt){return rt=="msgpack"?E.default.Config.msgpack.decode($):JSON.parse(String($))}f.decodeBody=Yt;function Wt($,rt){return rt=="msgpack"?E.default.Config.msgpack.encode($,!0):JSON.stringify($)}f.encodeBody=Wt;function Kt($){return $.map(function(rt){return rt&&rt.toLowerCase()})}f.allToLowerCase=Kt;function xe($){return $.map(function(rt){return rt&&rt.toUpperCase()})}f.allToUpperCase=xe;function Ge($){return Math.min(($+2)/3,2)}f.getBackoffCoefficient=Ge;function zt(){return 1-Math.random()*.2}f.getJitterCoefficient=zt;function Fe($,rt){return $*Ge(rt)*zt()}f.getRetryTime=Fe;function Ze(){return c||(typeof window!="undefined"?window:self)}f.getGlobalObject=Ze;function zn($,rt){return Object.keys($).every(function(at){return $[at]===rt[at]})&&Object.keys(rt).every(function(at){return rt[at]===$[at]})}f.shallowEquals=zn;function fn($){var rt=/^(\[([^?]*)(?:(.*))\])?(.+)$/,at=$.match(rt);if(!at||!at.length||at.length<5)throw new S.default("regex match failed",400,40010);if(at[2])throw new S.default("cannot use a derived option with a ".concat(at[2]," channel"),400,40010);return{qualifierParam:at[3]||"",channelName:at[4]}}f.matchDerivedChannel=fn;function si($){return E.default.Config.createHmac?Buffer.from($,"ascii").toString("base64"):(0,_.stringify)((0,L.parse)($))}f.toBase64=si}).call(this,r(13))},function(p,f,r){"use strict";(function(c){Object.defineProperty(f,"__esModule",{value:!0});var s=r(0),E=s.__importDefault(r(3)),O=c||(typeof window!="undefined"?window:self),S;(function(u){u[u.None=0]="None",u[u.Error=1]="Error",u[u.Major=2]="Major",u[u.Minor=3]="Minor",u[u.Micro=4]="Micro"})(S||(S={}));function _(u,C){return"".concat(u).padStart(C?3:2,"0")}function L(u){return E.default.Config.logTimestamps?function(C){var x=new Date;u(_(x.getHours())+":"+_(x.getMinutes())+":"+_(x.getSeconds())+"."+_(x.getMilliseconds(),1)+" "+C)}:u}var y=function(){var u,C,x,T;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((C=(u=O==null?void 0:O.console)===null||u===void 0?void 0:u.log)===null||C===void 0?void 0:C.apply)=="function"?(x=function(){for(var m=[],g=0;g<arguments.length;g++)m[g]=arguments[g]},T=console.warn?function(){for(var m=[],g=0;g<arguments.length;g++)m[g]=arguments[g]}:x):O!=null&&O.console.log?x=T=function(){Function.prototype.apply.call(console.log,console,arguments)}:x=T=function(){},[x,T].map(L)},I=function(){function u(){u.logLevel=u.LOG_DEFAULT}return u.initLogHandlers=function(){var C=y(),x=C[0],T=C[1];this.logHandler=x,this.logErrorHandler=T},u.logLevel=S.Error,u.LOG_NONE=S.None,u.LOG_ERROR=S.Error,u.LOG_MAJOR=S.Major,u.LOG_MINOR=S.Minor,u.LOG_MICRO=S.Micro,u.LOG_DEFAULT=S.Error,u.LOG_DEBUG=S.Micro,u.logAction=function(C,x,T){u.shouldLog(C)&&(C===S.Error?u.logErrorHandler:u.logHandler)("Ably: "+x+": "+T)},u.deprecated=function(C,x){u.deprecatedWithMsg(C,"Please use '"+x+"' instead.")},u.deprecatedWithMsg=function(C,x){u.shouldLog(S.Error)&&u.logErrorHandler("Ably: Deprecation warning - '"+C+"' is deprecated and will be removed from a future version. "+x)},u.shouldLog=function(C){return C<=u.logLevel},u.setLog=function(C,x){C!==void 0&&(u.logLevel=C),x!==void 0&&(u.logHandler=u.logErrorHandler=x)},u}();f.default=I}).call(this,r(13))},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=function(){function s(){}return s}();f.default=c},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.PartialErrorInfo=void 0;var c=r(0),s=c.__importDefault(r(3)),E=c.__importStar(r(1));function O(L){var y="["+L.constructor.name;return L.message&&(y+=": "+L.message),L.statusCode&&(y+="; statusCode="+L.statusCode),L.code&&(y+="; code="+L.code),L.cause&&(y+="; cause="+E.inspectError(L.cause)),L.href&&!(L.message&&L.message.indexOf("help.ably.io")>-1)&&(y+="; see "+L.href+" "),y+="]",y}var S=function(L){c.__extends(y,L);function y(I,u,C,x){var T=L.call(this,I)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(T,y.prototype),T.code=u,T.statusCode=C,T.cause=x,T}return y.prototype.toString=function(){return O(this)},y.fromValues=function(I){var u=I,C=u.message,x=u.code,T=u.statusCode;if(typeof C!="string"||typeof x!="number"||typeof T!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+s.default.Config.inspect(I));var m=Object.assign(new y(C,x,T),I);return m.code&&!m.href&&(m.href="https://help.ably.io/error/"+m.code),m},y}(Error);f.default=S;var _=function(L){c.__extends(y,L);function y(I,u,C,x){var T=L.call(this,I)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(T,y.prototype),T.code=u,T.statusCode=C,T.cause=x,T}return y.prototype.toString=function(){return O(this)},y}(Error);f.PartialErrorInfo=_},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(){if(typeof ArrayBuffer=="function"){var s=c,E=s.lib,O=E.WordArray,S=O.init,_=O.init=function(L){if(L instanceof ArrayBuffer&&(L=new Uint8Array(L)),(L instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&L instanceof Uint8ClampedArray||L instanceof Int16Array||L instanceof Uint16Array||L instanceof Int32Array||L instanceof Uint32Array||L instanceof Float32Array||L instanceof Float64Array)&&(L=new Uint8Array(L.buffer,L.byteOffset,L.byteLength)),L instanceof Uint8Array){for(var y=L.byteLength,I=[],u=0;u<y;u++)I[u>>>2]|=L[u]<<24-u%4*8;S.call(this,I,y)}else S.apply(this,arguments)};_.prototype=O}}(),c.lib.WordArray})},function(p,f,r){(function(c){(function(s,E){p.exports=f=E()})(this,function(){var s=s||function(E,O){var S;if(typeof window!="undefined"&&window.crypto&&(S=window.crypto),!S&&typeof window!="undefined"&&window.msCrypto&&(S=window.msCrypto),!S&&typeof c!="undefined"&&c.crypto&&(S=c.crypto),!S)try{S=r(44)}catch(i){}var _=function(){if(S){if(typeof S.getRandomValues=="function")try{return S.getRandomValues(new Uint32Array(1))[0]}catch(i){}if(typeof S.randomBytes=="function")try{return S.randomBytes(4).readInt32LE()}catch(i){}}throw new Error("Native crypto module could not be used to get secure random number.")},L=Object.create||function(){function i(){}return function(o){var v;return i.prototype=o,v=new i,i.prototype=null,v}}(),y={},I=y.lib={},u=I.Base=function(){return{extend:function(i){var o=L(this);return i&&o.mixIn(i),(!o.hasOwnProperty("init")||this.init===o.init)&&(o.init=function(){o.$super.init.apply(this,arguments)}),o.init.prototype=o,o.$super=this,o},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var o in i)i.hasOwnProperty(o)&&(this[o]=i[o]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),C=I.WordArray=u.extend({init:function(i,o){i=this.words=i||[],o!=O?this.sigBytes=o:this.sigBytes=i.length*4},toString:function(i){return(i||T).stringify(this)},concat:function(i){var o=this.words,v=i.words,l=this.sigBytes,A=i.sigBytes;if(this.clamp(),l%4)for(var U=0;U<A;U++){var k=v[U>>>2]>>>24-U%4*8&255;o[l+U>>>2]|=k<<24-(l+U)%4*8}else for(var U=0;U<A;U+=4)o[l+U>>>2]=v[U>>>2];return this.sigBytes+=A,this},clamp:function(){var i=this.words,o=this.sigBytes;i[o>>>2]&=4294967295<<32-o%4*8,i.length=E.ceil(o/4)},clone:function(){var i=u.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var o=[],v=0;v<i;v+=4)o.push(_());return new C.init(o,i)}}),x=y.enc={},T=x.Hex={stringify:function(i){for(var o=i.words,v=i.sigBytes,l=[],A=0;A<v;A++){var U=o[A>>>2]>>>24-A%4*8&255;l.push((U>>>4).toString(16)),l.push((U&15).toString(16))}return l.join("")},parse:function(i){for(var o=i.length,v=[],l=0;l<o;l+=2)v[l>>>3]|=parseInt(i.substr(l,2),16)<<24-l%8*4;return new C.init(v,o/2)}},m=x.Latin1={stringify:function(i){for(var o=i.words,v=i.sigBytes,l=[],A=0;A<v;A++){var U=o[A>>>2]>>>24-A%4*8&255;l.push(String.fromCharCode(U))}return l.join("")},parse:function(i){for(var o=i.length,v=[],l=0;l<o;l++)v[l>>>2]|=(i.charCodeAt(l)&255)<<24-l%4*8;return new C.init(v,o)}},g=x.Utf8={stringify:function(i){try{return decodeURIComponent(escape(m.stringify(i)))}catch(o){throw new Error("Malformed UTF-8 data")}},parse:function(i){return m.parse(unescape(encodeURIComponent(i)))}},b=I.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new C.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=g.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var o,v=this._data,l=v.words,A=v.sigBytes,U=this.blockSize,k=U*4,j=A/k;i?j=E.ceil(j):j=E.max((j|0)-this._minBufferSize,0);var N=j*U,P=E.min(N*4,A);if(N){for(var M=0;M<N;M+=U)this._doProcessBlock(l,M);o=l.splice(0,N),v.sigBytes-=P}return new C.init(o,P)},clone:function(){var i=u.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),a=I.Hasher=b.extend({cfg:u.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){b.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){i&&this._append(i);var o=this._doFinalize();return o},blockSize:512/32,_createHelper:function(i){return function(o,v){return new i.init(v).finalize(o)}},_createHmacHelper:function(i){return function(o,v){return new h.HMAC.init(i,v).finalize(o)}}}),h=y.algo={};return y}(Math);return s})}).call(this,r(13))},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(2)),O=c.__importDefault(r(3));function S(y,I,u){try{I.apply(y,u)}catch(C){E.default.logAction(E.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+C+"; stack = "+(C&&C.stack))}}function _(y,I,u){for(var C,x,T,m=0;m<y.length;m++)if(C=y[m],u&&(C=C[u]),s.isArray(C)){for(;(x=s.arrIndexOf(C,I))!==-1;)C.splice(x,1);u&&C.length===0&&delete y[m][u]}else if(s.isObject(C))for(T in C)Object.prototype.hasOwnProperty.call(C,T)&&s.isArray(C[T])&&_([C],I,T)}var L=function(){function y(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return y.prototype.on=function(){for(var I=this,u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];if(u.length===1){var x=u[0];if(typeof x=="function")this.any.push(x);else throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(u))}if(u.length===2){var T=u[0],m=u[1];if(typeof m!="function")throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(u));if(s.isEmptyArg(T))this.any.push(m);else if(s.isArray(T))T.forEach(function(b){I.on(b,m)});else{if(typeof T!="string")throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(u));var g=this.events[T]||(this.events[T]=[]);g.push(m)}}},y.prototype.off=function(){for(var I,u=this,C=[],x=0;x<arguments.length;x++)C[x]=arguments[x];if(C.length==0||s.isEmptyArg(C[0])&&s.isEmptyArg(C[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var T=C[0],m=C[1],g=null,b=null;if(C.length===1||!m)typeof T=="function"?g=T:b=T;else{if(typeof m!="function")throw new Error("EventEmitter.off(): invalid arguments:"+O.default.Config.inspect(C));I=[T,m],b=I[0],g=I[1]}if(g&&s.isEmptyArg(b)){_([this.any,this.events,this.anyOnce,this.eventsOnce],g);return}if(s.isArray(b)){b.forEach(function(a){u.off(a,g)});return}if(typeof b!="string")throw new Error("EventEmitter.off(): invalid arguments:"+O.default.Config.inspect(C));g?_([this.events,this.eventsOnce],g,b):(delete this.events[b],delete this.eventsOnce[b])},y.prototype.listeners=function(I){if(I){var u=this.events[I]||[];return this.eventsOnce[I]&&Array.prototype.push.apply(u,this.eventsOnce[I]),u.length?u:null}return this.any.length?this.any:null},y.prototype.emit=function(I){for(var u=[],C=1;C<arguments.length;C++)u[C-1]=arguments[C];var x={event:I},T=[];this.anyOnce.length&&(Array.prototype.push.apply(T,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(T,this.any);var m=this.eventsOnce[I];m&&(Array.prototype.push.apply(T,m),delete this.eventsOnce[I]);var g=this.events[I];g&&Array.prototype.push.apply(T,g),s.arrForEach(T,function(b){S(x,b,u)})},y.prototype.once=function(){for(var I=this,u=[],C=0;C<arguments.length;C++)u[C]=arguments[C];var x=u.length;if((x===0||x===1&&typeof u[0]!="function")&&O.default.Config.Promise){var T=u[0];return new O.default.Config.Promise(function(i){I.once(T,i)})}var m=u[0],g=u[1];if(u.length===1&&typeof m=="function")this.anyOnce.push(m);else if(s.isEmptyArg(m)){if(typeof g!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(u));this.anyOnce.push(g)}else if(s.isArray(m)){var b=this,a=function(){var i=Array.prototype.slice.call(arguments);if(s.arrForEach(m,function(o){b.off(o,a)}),typeof g!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(u));g.apply(this,i)};s.arrForEach(m,function(i){b.on(i,a)})}else{if(typeof m!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(u));var h=this.eventsOnce[m]||(this.eventsOnce[m]=[]);if(g){if(typeof g!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(u));h.push(g)}}},y.prototype.whenState=function(I,u,C){for(var x=this,T=[],m=3;m<arguments.length;m++)T[m-3]=arguments[m];var g={event:I};if(typeof I!="string"||typeof u!="string")throw"whenState requires a valid event String argument";if(typeof C!="function"&&O.default.Config.Promise)return new O.default.Config.Promise(function(b){y.prototype.whenState.apply(x,[I,u,b].concat(T))});I===u?S(g,C,T):this.once(I,C)},y}();f.default=L},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.getDefaults=f.normaliseOptions=f.objectifyOptions=f.getAgentString=f.getHosts=f.getFallbackHosts=f.environmentFallbackHosts=f.getHttpScheme=f.getPort=f.getHost=void 0;var c=r(0),s=c.__importDefault(r(3)),E=c.__importStar(r(1)),O=c.__importDefault(r(2)),S=c.__importDefault(r(4)),_=r(43),L="ably-js/"+_.version,y={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:_.version,protocolVersion:2,agent:L,getHost:I,getPort:u,getHttpScheme:C,environmentFallbackHosts:x,getFallbackHosts:T,getHosts:m,checkHost:g,objectifyOptions:i,normaliseOptions:o};function I(l,A,U){return U?A=A==l.restHost&&l.realtimeHost||A||l.realtimeHost:A=A||l.restHost,A}f.getHost=I;function u(l,A){return A||l.tls?l.tlsPort:l.port}f.getPort=u;function C(l){return l.tls?"https://":"http://"}f.getHttpScheme=C;function x(l){return[l+"-a-fallback.ably-realtime.com",l+"-b-fallback.ably-realtime.com",l+"-c-fallback.ably-realtime.com",l+"-d-fallback.ably-realtime.com",l+"-e-fallback.ably-realtime.com"]}f.environmentFallbackHosts=x;function T(l){var A=l.fallbackHosts,U=typeof l.httpMaxRetryCount!="undefined"?l.httpMaxRetryCount:y.httpMaxRetryCount;return A?E.arrChooseN(A,U):[]}f.getFallbackHosts=T;function m(l){return[l.restHost].concat(T(l))}f.getHosts=m;function g(l){if(typeof l!="string")throw new S.default("host must be a string; was a "+typeof l,4e4,400);if(!l.length)throw new S.default("host must not be zero-length",4e4,400)}function b(l,A,U){return l.realtimeHost?l.realtimeHost:l.restHost?(O.default.logAction(O.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+l.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+l.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),l.restHost):A?y.REALTIME_HOST:U+"-"+y.REALTIME_HOST}function a(l){var A={};for(var U in y.TIMEOUTS)A[U]=l[U]||y.TIMEOUTS[U];return A}function h(l){var A=y.agent;if(l.agents)for(var U in l.agents)A+=" "+U+"/"+l.agents[U];return A}f.getAgentString=h;function i(l){return typeof l=="string"?l.indexOf(":")==-1?{token:l}:{key:l}:l}f.objectifyOptions=i;function o(l){if(l.host&&(O.default.deprecated("host","restHost"),l.restHost=l.host),l.wsHost&&(O.default.deprecated("wsHost","realtimeHost"),l.realtimeHost=l.wsHost),l.queueEvents&&(O.default.deprecated("queueEvents","queueMessages"),l.queueMessages=l.queueEvents),l.fallbackHostsUseDefault){if(l.fallbackHosts){var A="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions",A),new S.default(A,4e4,400)}if(l.port||l.tlsPort){var A="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions",A),new S.default(A,4e4,400)}l.environment?O.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):O.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),l.fallbackHosts=y.FALLBACK_HOSTS}l.recover===!0&&(O.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),l.recover=function(Y,w){w(!0)}),typeof l.recover=="function"&&l.closeOnUnload===!0&&(O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),l.recover=void 0),"closeOnUnload"in l||(l.closeOnUnload=!l.recover),l.transports&&E.arrIn(l.transports,"xhr")&&(O.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),E.arrDeleteValue(l.transports,"xhr"),l.transports.push("xhr_streaming")),"queueMessages"in l||(l.queueMessages=!0);var U=l.environment&&String(l.environment).toLowerCase()||y.ENVIRONMENT,k=!U||U==="production";!l.fallbackHosts&&!l.restHost&&!l.realtimeHost&&!l.port&&!l.tlsPort&&(l.fallbackHosts=k?y.FALLBACK_HOSTS:x(U));var j=l.restHost||(k?y.REST_HOST:U+"-"+y.REST_HOST),N=b(l,k,U);E.arrForEach((l.fallbackHosts||[]).concat(j,N),g),l.port=l.port||y.PORT,l.tlsPort=l.tlsPort||y.TLS_PORT,"tls"in l||(l.tls=!0);var P=a(l);if("useBinaryProtocol"in l?l.useBinaryProtocol=s.default.Config.supportsBinary&&l.useBinaryProtocol:l.useBinaryProtocol=s.default.Config.preferBinary,l.clientId){var M=l.headers=l.headers||{};M["X-Ably-ClientId"]=s.default.BufferUtils.base64Encode(s.default.BufferUtils.utf8Encode(l.clientId))}"idempotentRestPublishing"in l||(l.idempotentRestPublishing=!0),l.promises&&!s.default.Config.Promise&&(O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),l.promises=!1);var F=null,W=l.connectivityCheckUrl;if(l.connectivityCheckUrl){var K=l.connectivityCheckUrl.split("?"),X=K[0],et=K[1];F=et?E.parseQueryString(et):{},X.indexOf("://")===-1&&(X="https://"+X),W=X}return c.__assign(c.__assign({},l),{useBinaryProtocol:"useBinaryProtocol"in l?s.default.Config.supportsBinary&&l.useBinaryProtocol:s.default.Config.preferBinary,realtimeHost:N,restHost:j,maxMessageSize:l.maxMessageSize||y.maxMessageSize,timeouts:P,connectivityCheckParams:F,connectivityCheckUrl:W})}f.normaliseOptions=o,f.default=y;function v(l){return Object.assign(y,l)}f.getDefaults=v},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(3)),E=c.__importDefault(r(2)),O=c.__importDefault(r(4)),S=c.__importStar(r(1));function _(u){return!u||!u.channelOptions?{channelOptions:u,plugins:{},baseEncodedPreviousPayload:void 0}:u}function L(u){if(u&&u.cipher){if(!s.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var C=s.default.Crypto.getCipher(u.cipher);return{cipher:C.cipherParams,channelCipher:C.cipher}}return u!=null?u:{}}function y(u){var C=0;return u.name&&(C+=u.name.length),u.clientId&&(C+=u.clientId.length),u.extras&&(C+=JSON.stringify(u.extras).length),u.data&&(C+=S.dataSizeBytes(u.data)),C}var I=function(){function u(){}return u.prototype.toJSON=function(){var C=this.encoding,x=this.data;return x&&s.default.BufferUtils.isBuffer(x)&&(arguments.length>0?(C=C?C+"/base64":"base64",x=s.default.BufferUtils.base64Encode(x)):x=s.default.BufferUtils.toBuffer(x)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:C,data:x}},u.prototype.toString=function(){var C="[Message";return this.name&&(C+="; name="+this.name),this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.extras&&(C+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?C+="; data="+this.data:s.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+s.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),this.extras&&(C+="; extras="+JSON.stringify(this.extras)),C+="]",C},u.encrypt=function(C,x,T){var m=C.data,g=C.encoding,b=x.channelCipher;g=g?g+"/":"",s.default.BufferUtils.isBuffer(m)||(m=s.default.BufferUtils.utf8Encode(String(m)),g=g+"utf-8/"),b.encrypt(m,function(a,h){if(a){T(a);return}C.data=h,C.encoding=g+"cipher+"+b.algorithm,T(null,C)})},u.encode=function(C,x,T){var m=C.data,g=typeof m=="string"||s.default.BufferUtils.isBuffer(m)||m===null||m===void 0;if(!g)if(S.isObject(m)||S.isArray(m))C.data=JSON.stringify(m),C.encoding=C.encoding?C.encoding+"/json":"json";else throw new O.default("Data type is unsupported",40013,400);x!=null&&x.cipher?u.encrypt(C,x,T):T(null,C)},u.encodeArray=function(C,x,T){for(var m=0,g=0;g<C.length;g++)u.encode(C[g],x,function(b){if(b){T(b);return}m++,m==C.length&&T(null,C)})},u.decode=function(C,x){var T=_(x),m=C.data,g=C.encoding;if(g){var b=g.split("/"),a=void 0,h=b.length,i=C.data,o="";try{for(;(a=h)>0;){var v=b[--h].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(o=v[1],o){case"base64":i=s.default.BufferUtils.base64Decode(String(i)),a==b.length&&(m=i);continue;case"utf-8":i=s.default.BufferUtils.utf8Decode(i);continue;case"json":i=JSON.parse(i);continue;case"cipher":if(T.channelOptions!=null&&T.channelOptions.cipher&&T.channelOptions.channelCipher){var l=v[3],A=T.channelOptions.channelCipher;if(l!=A.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");i=A.decrypt(i);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!T.plugins||!T.plugins.vcdiff)throw new O.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new O.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var U=T.baseEncodedPreviousPayload;typeof U=="string"&&(U=s.default.BufferUtils.utf8Encode(U)),U=s.default.BufferUtils.toBuffer(U),i=s.default.BufferUtils.toBuffer(i),i=s.default.BufferUtils.typedArrayToBuffer(T.plugins.vcdiff.decode(i,U)),m=i}catch(j){throw new O.default("Vcdiff delta decode failed with "+j,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(j){var k=j;throw new O.default("Error processing the "+o+" encoding, decoder returned \u2018"+k.message+"\u2019",k.code||40013,400)}finally{C.encoding=a<=0?null:b.slice(0,a).join("/"),C.data=i}}T.baseEncodedPreviousPayload=m},u.fromResponseBody=function(C,x,T){T&&(C=S.decodeBody(C,T));for(var m=0;m<C.length;m++){var g=C[m]=u.fromValues(C[m]);try{u.decode(g,x)}catch(b){E.default.logAction(E.default.LOG_ERROR,"Message.fromResponseBody()",b.toString())}}return C},u.fromValues=function(C){return Object.assign(new u,C)},u.fromValuesArray=function(C){for(var x=C.length,T=new Array(x),m=0;m<x;m++)T[m]=u.fromValues(C[m]);return T},u.fromEncoded=function(C,x){var T=u.fromValues(C),m=L(x!=null?x:null);try{u.decode(T,m)}catch(g){E.default.logAction(E.default.LOG_ERROR,"Message.fromEncoded()",g.toString())}return T},u.fromEncodedArray=function(C,x){return C.map(function(T){return u.fromEncoded(T,x)})},u.getMessagesSize=function(C){for(var x,T=0,m=0;m<C.length;m++)x=C[m],T+=x.size||(x.size=y(x));return T},u.serialize=S.encodeBody,u}();f.default=I},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(4)),O=c.__importDefault(r(9)),S=c.__importDefault(r(15)),_={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},L=[];Object.keys(_).forEach(function(T){L[_[T]]=T});var y={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},I=Object.keys(y);y.MODE_ALL=y.PRESENCE|y.PUBLISH|y.SUBSCRIBE|y.PRESENCE_SUBSCRIBE;function u(T){var m=[];if(T)for(var g=0;g<T.length;g++)m.push(T[g].toString());return"[ "+m.join(", ")+" ]"}var C="id channel channelSerial connectionId count msgSerial timestamp".split(" "),x=function(){function T(){var m=this;this.hasFlag=function(g){return(m.flags&y[g])>0}}return T.prototype.setFlag=function(m){return this.flags=this.flags|y[m]},T.prototype.getMode=function(){return this.flags&&this.flags&y.MODE_ALL},T.prototype.encodeModesToFlags=function(m){var g=this;m.forEach(function(b){return g.setFlag(b)})},T.prototype.decodeModesFromFlags=function(){var m=this,g=[];return T.channelModes.forEach(function(b){m.hasFlag(b)&&g.push(b)}),g.length>0?g:void 0},T.fromValues=function(m){return Object.assign(new T,m)},T.Action=_,T.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],T.ActionName=L,T.serialize=s.encodeBody,T.deserialize=function(m,g){var b=s.decodeBody(m,g);return T.fromDeserialized(b)},T.fromDeserialized=function(m){var g=m.error;g&&(m.error=E.default.fromValues(g));var b=m.messages;if(b)for(var a=0;a<b.length;a++)b[a]=O.default.fromValues(b[a]);var h=m.presence;if(h)for(var a=0;a<h.length;a++)h[a]=S.default.fromValues(h[a],!0);return Object.assign(new T,m)},T.stringify=function(m){var g="[ProtocolMessage";m.action!==void 0&&(g+="; action="+T.ActionName[m.action]||!1);for(var b,a=0;a<C.length;a++)b=C[a],m[b]!==void 0&&(g+="; "+b+"="+m[b]);if(m.messages&&(g+="; messages="+u(O.default.fromValuesArray(m.messages))),m.presence&&(g+="; presence="+u(S.default.fromValuesArray(m.presence))),m.error&&(g+="; error="+E.default.fromValues(m.error).toString()),m.auth&&m.auth.accessToken&&(g+="; token="+m.auth.accessToken),m.flags&&(g+="; flags="+I.filter(m.hasFlag).join(",")),m.params){var h="";s.forInOwnNonNullProperties(m.params,function(i){h.length>0&&(h+="; "),h+=i+"="+m.params[i]}),h.length>0&&(g+="; params=["+h+"]")}return g+="]",g},T}();f.default=x},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(){var s=c,E=s.lib,O=E.WordArray,S=s.enc,_=S.Base64={stringify:function(y){var I=y.words,u=y.sigBytes,C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.clamp();for(var x=[],T=0;T<u;T+=3)for(var m=I[T>>>2]>>>24-T%4*8&255,g=I[T+1>>>2]>>>24-(T+1)%4*8&255,b=I[T+2>>>2]>>>24-(T+2)%4*8&255,a=m<<16|g<<8|b,h=0;h<4&&T+h*.75<u;h++)x.push(C.charAt(a>>>6*(3-h)&63));var i=C.charAt(64);if(i)for(;x.length%4;)x.push(i);return x.join("")},parse:function(y){var I=y.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",C=this._reverseMap;if(!C){C=this._reverseMap=[];for(var x=0;x<u.length;x++)C[u.charCodeAt(x)]=x}var T=u.charAt(64);if(T){var m=y.indexOf(T);m!==-1&&(I=m)}return L(y,I,C)}};function L(y,I,u){for(var C=[],x=0,T=0;T<I;T++)if(T%4){var m=u[y.charCodeAt(T-1)]<<T%4*2,g=u[y.charCodeAt(T)]>>>6-T%4*2,b=m|g;C[x>>>2]|=b<<24-x%4*8,x++}return O.create(C,x)}}(),c.enc.Base64})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(10)),O=c.__importDefault(r(26)),S=c.__importDefault(r(2)),_=c.__importDefault(r(8)),L=c.__importDefault(r(20)),y=c.__importDefault(r(17)),I=c.__importDefault(r(4)),u=c.__importDefault(r(21)),C=c.__importDefault(r(3));function x(g){var b=[80015,80017,80030];return g.code?y.default.isTokenErr(g)?!1:s.arrIn(b,g.code)?!0:g.code>=4e4&&g.code<5e4:!1}function T(g){return x(g)?[E.default.fromValues({action:E.default.Action.ERROR,error:g})]:[E.default.fromValues({action:E.default.Action.DISCONNECTED,error:g})]}var m=function(g){c.__extends(b,g);function b(a,h,i){var o=g.call(this,a,h,i,!0)||this;return o.onAuthUpdated=function(v){o.authParams={access_token:v.token}},o.stream="stream"in i?i.stream:!0,o.sendRequest=null,o.recvRequest=null,o.pendingCallback=null,o.pendingItems=null,o}return b.prototype.connect=function(){var a=this;S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","starting"),O.default.prototype.connect.call(this);var h=this.params,i=h.options,o=_.default.getHost(i,h.host),v=_.default.getPort(i),l=i.tls?"https://":"http://";this.baseUri=l+o+":"+v+"/comet/";var A=this.baseUri+"connect";S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","uri: "+A),this.auth.getAuthParams(function(U,k){if(U){a.disconnect(U);return}if(!a.isDisposed){a.authParams=k;var j=a.params.getConnectParams(k);"stream"in j&&(a.stream=j.stream),S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+s.toQueryString(j));var N=!1,P=a.recvRequest=a.createRequest(A,null,j,null,a.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV);P.on("data",function(M){!a.recvRequest||(N||(N=!0,a.emit("preconnect")),a.onData(M))}),P.on("complete",function(M){if(a.recvRequest||(M=M||new I.default("Request cancelled",80003,400)),a.recvRequest=null,!N&&!M&&(N=!0,a.emit("preconnect")),a.onActivity(),M){M.code?a.onData(T(M)):a.disconnect(M);return}C.default.Config.nextTick(function(){a.recv()})}),P.exec()}})},b.prototype.requestClose=function(){S.default.logAction(S.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},b.prototype.requestDisconnect=function(){S.default.logAction(S.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},b.prototype._requestCloseOrDisconnect=function(a){var h=this,i=a?this.closeUri:this.disconnectUri;if(i){var o=this.createRequest(i,null,this.authParams,null,u.default.REQ_SEND);o.on("complete",function(v){v&&(S.default.logAction(S.default.LOG_ERROR,"CometTransport.request"+(a?"Close()":"Disconnect()"),"request returned err = "+s.inspectError(v)),h.finish("disconnected",v))}),o.exec()}},b.prototype.dispose=function(){var a=this;S.default.logAction(S.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(S.default.logAction(S.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",L.default.disconnected()),C.default.Config.nextTick(function(){a.emit("disposed")}))},b.prototype.onConnect=function(a){var h;if(!this.isDisposed){var i=(h=a.connectionDetails)===null||h===void 0?void 0:h.connectionKey;O.default.prototype.onConnect.call(this,a);var o=this.baseUri+i;S.default.logAction(S.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+o),this.sendUri=o+"/send",this.recvUri=o+"/recv",this.closeUri=o+"/close",this.disconnectUri=o+"/disconnect"}},b.prototype.send=function(a){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(a);return}var h=this.pendingItems||[];h.push(a),this.pendingItems=null,this.sendItems(h)},b.prototype.sendAnyPending=function(){var a=this.pendingItems;!a||(this.pendingItems=null,this.sendItems(a))},b.prototype.sendItems=function(a){var h=this,i=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(a),u.default.REQ_SEND);i.on("complete",function(o,v){if(o&&S.default.logAction(S.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+s.inspectError(o)),h.sendRequest=null,o){o.code?h.onData(T(o)):h.disconnect(o);return}v&&h.onData(v),h.pendingItems&&C.default.Config.nextTick(function(){h.sendRequest||h.sendAnyPending()})}),i.exec()},b.prototype.recv=function(){var a=this;if(!this.recvRequest&&!!this.isConnected){var h=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV_POLL);h.on("data",function(i){a.onData(i)}),h.on("complete",function(i){if(a.recvRequest=null,a.onActivity(),i){i.code?a.onData(T(i)):a.disconnect(i);return}C.default.Config.nextTick(function(){a.recv()})}),h.exec()}},b.prototype.onData=function(a){try{var h=this.decodeResponse(a);if(h&&h.length)for(var i=0;i<h.length;i++)this.onProtocolMessage(E.default.fromDeserialized(h[i]))}catch(o){S.default.logAction(S.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack)}},b.prototype.encodeRequest=function(a){return JSON.stringify(a)},b.prototype.decodeResponse=function(a){return typeof a=="string"?JSON.parse(a):a},b}(O.default);f.default=m},function(p,f){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(c){typeof window=="object"&&(r=window)}p.exports=r},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(3)),E=c.__importStar(r(1)),O=c.__importDefault(r(2)),S=c.__importDefault(r(17)),_=c.__importDefault(r(18)),L=r(4);function y(m,g,b,a,h){m.http.supportsAuthHeaders?m.auth.getAuthHeaders(function(i,o){i?a(i):h(E.mixin(o,g),b)}):m.auth.getAuthParams(function(i,o){i?a(i):h(g,E.mixin(o,b))})}function I(m,g){return function(b,a,h,i,o){if(b&&!a){m(b);return}if(!i)try{a=E.decodeBody(a,g)}catch(j){E.isErrorInfoOrPartialErrorInfo(j)?m(j):m(new L.PartialErrorInfo(E.inspectError(j),null));return}if(!a){m(new L.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var v=a,l=v.statusCode,A=v.response,U=v.headers;if(l===void 0){m(b,a,h,!0,o);return}if(l<200||l>=300){var k=A&&A.error||b;k||(k=new Error("Error in unenveloping "+a),k.statusCode=l),m(k,A,U,!0,l);return}m(b,A,U,!0,l)}}function u(m){var g=[];if(m)for(var b in m)g.push(b+"="+m[b]);return g.join("&")}function C(m,g){return m+(g?"?":"")+u(g)}function x(m,g,b,a){return function(h,i,o,v,l){h?O.default.logAction(O.default.LOG_MICRO,"Resource."+g+"()","Received Error; "+C(b,a)+"; Error: "+E.inspectError(h)):O.default.logAction(O.default.LOG_MICRO,"Resource."+g+"()","Received; "+C(b,a)+"; Headers: "+u(o)+"; StatusCode: "+l+"; Body: "+(s.default.BufferUtils.isBuffer(i)?i.toString():i)),m&&m(h,i,o,v,l)}}var T=function(){function m(){}return m.get=function(g,b,a,h,i,o){m.do(_.default.Get,g,b,null,a,h,i,o)},m.delete=function(g,b,a,h,i,o){m.do(_.default.Delete,g,b,null,a,h,i,o)},m.post=function(g,b,a,h,i,o,v){m.do(_.default.Post,g,b,a,h,i,o,v)},m.patch=function(g,b,a,h,i,o,v){m.do(_.default.Patch,g,b,a,h,i,o,v)},m.put=function(g,b,a,h,i,o,v){m.do(_.default.Put,g,b,a,h,i,o,v)},m.do=function(g,b,a,h,i,o,v,l){O.default.shouldLog(O.default.LOG_MICRO)&&(l=x(l,g,a,o)),v&&(l=l&&I(l,v),(o=o||{}).envelope=v);function A(U,k){var j;if(O.default.shouldLog(O.default.LOG_MICRO)&&O.default.logAction(O.default.LOG_MICRO,"Resource."+g+"()","Sending; "+C(a,k)),O.default.shouldLog(O.default.LOG_MICRO)){var N=h;if(((j=U["content-type"])===null||j===void 0?void 0:j.indexOf("msgpack"))>0)try{N=s.default.Config.msgpack.decode(h)}catch(P){O.default.logAction(O.default.LOG_MICRO,"Resource."+g+"()","Sending MsgPack Decoding Error: "+E.inspectError(P))}O.default.logAction(O.default.LOG_MICRO,"Resource."+g+"()","Sending; "+C(a,k)+"; Body: "+N)}b.http.do(g,b,a,U,h,k,function(P,M,F,W,K){if(P&&S.default.isTokenErr(P)){b.auth.authorize(null,null,function(X){if(X){l(X);return}y(b,F,k,l,A)});return}l(P,M,F,W,K)})}y(b,i,o,l,A)},m}();f.default=T},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(2)),E=c.__importDefault(r(3)),O=c.__importDefault(r(9)),S=c.__importStar(r(1));function _(y){return L.Actions.indexOf(y)}var L=function(){function y(){}return y.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},y.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var I=this.id.split(":");return{connectionId:I[0],msgSerial:parseInt(I[1],10),index:parseInt(I[2],10)}},y.prototype.toJSON=function(){var I=this.data,u=this.encoding;return I&&E.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(u=u?u+"/base64":"base64",I=E.default.BufferUtils.base64Encode(I)):I=E.default.BufferUtils.toBuffer(I)),{id:this.id,clientId:this.clientId,action:_(this.action),data:I,encoding:u,extras:this.extras}},y.prototype.toString=function(){var I="[PresenceMessage";return I+="; action="+this.action,this.id&&(I+="; id="+this.id),this.timestamp&&(I+="; timestamp="+this.timestamp),this.clientId&&(I+="; clientId="+this.clientId),this.connectionId&&(I+="; connectionId="+this.connectionId),this.encoding&&(I+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?I+="; data="+this.data:E.default.BufferUtils.isBuffer(this.data)?I+="; data (buffer)="+E.default.BufferUtils.base64Encode(this.data):I+="; data (json)="+JSON.stringify(this.data)),this.extras&&(I+="; extras="+JSON.stringify(this.extras)),I+="]",I},y.fromResponseBody=function(I,u,C){var x=[];C&&(I=S.decodeBody(I,C));for(var T=0;T<I.length;T++){var m=x[T]=y.fromValues(I[T],!0);try{y.decode(m,u)}catch(g){s.default.logAction(s.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",g.toString())}}return x},y.fromValues=function(I,u){return u&&(I.action=y.Actions[I.action]),Object.assign(new y,I)},y.fromValuesArray=function(I){for(var u=I.length,C=new Array(u),x=0;x<u;x++)C[x]=y.fromValues(I[x]);return C},y.fromEncoded=function(I,u){var C=y.fromValues(I,!0);try{y.decode(C,u!=null?u:{})}catch(x){s.default.logAction(s.default.LOG_ERROR,"PresenceMessage.fromEncoded()",x.toString())}return C},y.fromEncodedArray=function(I,u){return I.map(function(C){return y.fromEncoded(C,u)})},y.fromData=function(I){return I instanceof y?I:y.fromValues({data:I})},y.Actions=["absent","present","enter","leave","update"],y.encode=O.default.encode,y.decode=O.default.decode,y.getMessagesSize=O.default.getMessagesSize,y}();f.default=L},function(p,f,r){"use strict";(function(c){Object.defineProperty(f,"__esModule",{value:!0});var s=r(0),E=s.__importStar(r(1)),O=s.__importDefault(r(7)),S=s.__importStar(r(4)),_=s.__importDefault(r(2)),L=s.__importDefault(r(8)),y=s.__importDefault(r(21)),I=s.__importDefault(r(3));function u(l,A){return E.arrIn(E.allToLowerCase(E.keysArray(A)),"x-ably-errorcode")}function C(l,A){if(u(l,A))return l.error&&S.default.fromValues(l.error)}var x=function(){},T=0,m={},g=typeof c!="undefined"&&c.XDomainRequest;function b(){var l=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return l&&Number(l[1])}function a(){var l;return g&&(l=b())&&l===10}function h(l,A){return l.getResponseHeader&&l.getResponseHeader(A)}function i(l){return l.getResponseHeader&&(l.getResponseHeader("transfer-encoding")||!l.getResponseHeader("content-length"))}function o(l){for(var A=E.trim(l.getAllResponseHeaders()).split(`\r
`),U={},k=0;k<A.length;k++){var j=A[k].split(":").map(E.trim);U[j[0].toLowerCase()]=j[1]}return U}var v=function(l){s.__extends(A,l);function A(U,k,j,N,P,M,F){var W=l.call(this)||this;return j=j||{},j.rnd=E.cheapRandStr(),a()&&!j.envelope&&(j.envelope="json"),W.uri=U+E.toQueryString(j),W.headers=k||{},W.body=N,W.method=F?F.toUpperCase():E.isEmptyArg(N)?"GET":"POST",W.requestMode=P,W.timeouts=M,W.timedOut=!1,W.requestComplete=!1,W.id=String(++T),m[W.id]=W,W}return A.createRequest=function(U,k,j,N,P,M,F){var W=M||L.default.TIMEOUTS;return new A(U,k,E.copy(j),N,P,W,F)},A.prototype.complete=function(U,k,j,N,P){this.requestComplete||(this.requestComplete=!0,!U&&k&&this.emit("data",k),this.emit("complete",U,k,j,N,P),this.dispose())},A.prototype.abort=function(){this.dispose()},A.prototype.exec=function(){var U=this,k=this.headers,j=this.requestMode==y.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,N=this.timer=setTimeout(function(){U.timedOut=!0,M.abort()},j),P=this.method,M=this.xhr=new XMLHttpRequest,F=k.accept,W=this.body,K="text";if(F?F.indexOf("application/x-msgpack")===0&&(K="arraybuffer"):k.accept="application/json",W){var X=k["content-type"]||(k["content-type"]="application/json");X.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}M.open(P,this.uri,!0),M.responseType=K,"authorization"in k&&(M.withCredentials=!0);for(var et in k)M.setRequestHeader(et,k[et]);var Y=function(ct,Dt,Yt,Wt){var Kt,xe=Dt+" (event type: "+ct.type+")";!((Kt=U==null?void 0:U.xhr)===null||Kt===void 0)&&Kt.statusText&&(xe+=", current statusText is "+U.xhr.statusText),_.default.logAction(_.default.LOG_ERROR,"Request.on"+ct.type+"()",xe),U.complete(new S.PartialErrorInfo(xe,Yt,Wt))};M.onerror=function(ct){Y(ct,"XHR error occurred",null,400)},M.onabort=function(ct){U.timedOut?Y(ct,"Request aborted due to request timeout expiring",null,408):Y(ct,"Request cancelled",null,400)},M.ontimeout=function(ct){Y(ct,"Request timed out",null,408)};var w,B,H,V=0,Z=!1,lt=function(){if(clearTimeout(N),H=B<400,B==204){U.complete(null,null,null,null,B);return}w=U.requestMode==y.default.REQ_RECV_STREAM&&H&&i(M)},dt=function(){var ct;try{var Dt=h(M,"content-type"),Yt=Dt?Dt.indexOf("application/json")>=0:M.responseType=="text";if(Yt){var Wt=M.responseType==="arraybuffer"?I.default.BufferUtils.utf8Decode(M.response):String(M.responseText);Wt.length?ct=JSON.parse(Wt):ct=Wt,Z=!0}else ct=M.response;ct.response!==void 0?(B=ct.statusCode,H=B<400,k=ct.headers,ct=ct.response):k=o(M)}catch(xe){U.complete(new S.PartialErrorInfo("Malformed response body from server: "+xe.message,null,400));return}if(H||E.isArray(ct)){U.complete(null,ct,k,Z,B);return}var Kt=C(ct,k);Kt||(Kt=new S.PartialErrorInfo("Error response received from server: "+B+" body was: "+I.default.Config.inspect(ct),null,B)),U.complete(Kt,ct,k,Z,B)};function vt(){for(var ct=M.responseText,Dt=ct.length-1,Yt,Wt;V<Dt&&(Yt=ct.indexOf(`
`,V))>-1;)Wt=ct.slice(V,Yt),V=Yt+1,mt(Wt)}var mt=function(ct){try{ct=JSON.parse(ct)}catch(Dt){U.complete(new S.PartialErrorInfo("Malformed response body from server: "+Dt.message,null,400));return}U.emit("data",ct)},wt=function(){vt(),U.streamComplete=!0,I.default.Config.nextTick(function(){U.complete()})};M.onreadystatechange=function(){var ct=M.readyState;ct<3||M.status!==0&&(B===void 0&&(B=M.status,B===1223&&(B=204),lt()),ct==3&&w?vt():ct==4&&(w?wt():dt()))},M.send(W)},A.prototype.dispose=function(){var U=this.xhr;if(U){U.onreadystatechange=U.onerror=U.onabort=U.ontimeout=x,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||U.abort()}delete m[this.id]},A}(O.default);f.default=v}).call(this,r(13))},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(2)),E=c.__importStar(r(1)),O=c.__importDefault(r(23)),S=c.__importDefault(r(4)),_=c.__importDefault(r(45)),L=r(11),y=c.__importDefault(r(18)),I=c.__importDefault(r(25)),u=c.__importDefault(r(3)),C=c.__importDefault(r(14)),x=Math.pow(2,17);function T(){}function m(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function g(j){return!!j.connection}function b(j){return E.isErrorInfoOrPartialErrorInfo(j)?(j.code||(j.statusCode===403?j.code=40300:(j.code=40170,j.statusCode=401)),j):new S.default(E.inspectError(j),j.code||40170,j.statusCode||401)}var a=function(j,N){if(u.default.Config.createHmac){var P=u.default.Config.createHmac("SHA256",N);return P.update(j),P.digest("base64")}return(0,L.stringify)((0,_.default)(j,N))};function h(j){if(!j)return"";typeof j=="string"&&(j=JSON.parse(j));var N=Object.create(null),P=E.keysArray(j,!0);if(!P)return"";P.sort();for(var M=0;M<P.length;M++)N[P[M]]=j[P[M]].sort();return JSON.stringify(N)}function i(j){if(j.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(j.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(j.key)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(j.tokenDetails)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var N="authOptions must include valid authentication parameters";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",N),new Error(N)}}function o(j){return"useTokenAuth"in j&&!j.useTokenAuth}function v(j){return j.useTokenAuth||!o(j)&&(j.authCallback||j.authUrl||j.token||j.tokenDetails)}function l(j){return!j.key&&!j.authCallback&&!j.authUrl}var A=0;function U(){return A++}var k=function(){function j(N,P){if(this.authOptions={},this.client=N,this.tokenParams=P.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(P)){if(P.key&&!a){var M="client-side token request signing not supported";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",M),new Error(M)}l(P)&&s.default.logAction(s.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(P.defaultTokenParams,P),i(this.authOptions)}else{if(!P.key){var M="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",M),new S.default(M,40160,401)}s.default.logAction(s.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(P)}}return j.prototype.authorize=function(N,P,M){var F=this,W;if(typeof N=="function"&&!M?(M=N,W=N=null):typeof P=="function"&&!M?(M=P,W=null):W=P,!M&&this.client.options.promises)return E.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new S.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(s.default.logAction(s.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),E.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(N,W,function(K,X){if(K){F.client.connection&&K.statusCode===I.default.Forbidden&&F.client.connection.connectionManager.actOnErrorFromAuthorize(K),M==null||M(K);return}g(F.client)?F.client.connection.connectionManager.onAuthUpdated(X,M||T):M==null||M(null,X)})},j.prototype.authorise=function(N,P,M){s.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(N,P,M)},j.prototype._forceNewToken=function(N,P,M){var F=this;this.tokenDetails=null,this._saveTokenOptions(N,P),i(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,K){delete F.tokenParams.timestamp,delete F.authOptions.queryTime,M(W,K)})},j.prototype.requestToken=function(N,P,M){var F=this;if(typeof N=="function"&&!M?(M=N,P=N=null):typeof P=="function"&&!M&&(M=P,P=null),!M&&this.client.options.promises)return E.promisify(this,"requestToken",arguments);P=P||this.authOptions,N=N||E.copy(this.tokenParams);var W=M||T,K,X=this.client;if(P.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),K=P.authCallback;else if(P.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),K=function(V,Z){var lt=E.mixin({accept:"application/json, text/plain"},P.authHeaders),dt=P.authMethod&&P.authMethod.toLowerCase()==="post",vt,mt=P.authUrl.indexOf("?");mt>-1&&(vt=E.parseQueryString(P.authUrl.slice(mt)),P.authUrl=P.authUrl.slice(0,mt),dt||(P.authParams=E.mixin(vt,P.authParams)));var wt=E.mixin({},P.authParams||{},V),ct=function(Wt,Kt,xe,Ge){var zt;if(Wt?s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+E.inspectError(Wt)):(zt=xe["content-type"],s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+zt+"; body: "+E.inspectBody(Kt))),Wt||Ge)return Z(Wt,Kt);if(u.default.BufferUtils.isBuffer(Kt)&&(Kt=Kt.toString()),!zt){Z(new S.default("authUrl response is missing a content-type header",40170,401));return}var Fe=zt.indexOf("application/json")>-1,Ze=zt.indexOf("text/plain")>-1||zt.indexOf("application/jwt")>-1;if(!Fe&&!Ze){Z(new S.default("authUrl responded with unacceptable content-type "+zt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(Fe){if(Kt.length>x){Z(new S.default("authUrl response exceeded max permitted length",40170,401));return}try{Kt=JSON.parse(Kt)}catch(zn){Z(new S.default("Unexpected error processing authURL response; err = "+zn.message,40170,401));return}}Z(null,Kt,zt)};if(s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+P.authUrl+"; Params: "+JSON.stringify(wt)+"; method: "+(dt?"POST":"GET")),dt){var Dt=lt||{};Dt["content-type"]="application/x-www-form-urlencoded";var Yt=E.toQueryString(wt).slice(1);F.client.http.doUri(y.default.Post,X,P.authUrl,Dt,Yt,vt,ct)}else F.client.http.doUri(y.default.Get,X,P.authUrl,lt||{},null,wt,ct)};else if(P.key)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),K=function(V,Z){F.createTokenRequest(V,P,Z)};else{var et="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";s.default.logAction(s.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new S.default(et,40171,403));return}"capability"in N&&(N.capability=h(N.capability));var Y=function(V,Z){var lt=V.keyName,dt="/keys/"+lt+"/requestToken",vt=function(wt){return X.baseUri(wt)+dt},mt=E.defaultPostHeaders(F.client.options);P.requestHeaders&&E.mixin(mt,P.requestHeaders),s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+dt+"; Token params: "+JSON.stringify(V)),F.client.http.do(y.default.Post,X,vt,mt,JSON.stringify(V),null,Z)},w=!1,B=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){w=!0;var V="Token request callback timed out after "+B/1e3+" seconds";s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",V),W(new S.default(V,40170,401))},B);K(N,function(V,Z,lt){if(!w){if(clearTimeout(H),V){s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+E.inspectError(V)),W(b(V));return}if(typeof Z=="string"){Z.length===0?W(new S.default("Token string is empty",40170,401)):Z.length>x?W(new S.default("Token string exceeded max permitted length (was "+Z.length+" bytes)",40170,401)):Z==="undefined"||Z==="null"?W(new S.default("Token string was literal null/undefined",40170,401)):Z[0]==="{"&&!(lt&&lt.indexOf("application/jwt")>-1)?W(new S.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:Z});return}if(typeof Z!="object"){var dt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof Z;s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",dt),W(new S.default(dt,40170,401));return}var vt=JSON.stringify(Z).length;if(vt>x&&!P.suppressMaxLengthCheck){W(new S.default("Token request/details object exceeded max permitted stringified size (was "+vt+" bytes)",40170,401));return}if("issued"in Z){W(null,Z);return}if(!("keyName"in Z)){var dt="Expected token request callback to call back with a token string, token request object, or token details object";s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",dt),W(new S.default(dt,40170,401));return}Y(Z,function(mt,wt,ct,Dt){if(mt){s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+E.inspectError(mt)),W(b(mt));return}Dt||(wt=JSON.parse(wt)),s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,wt)})}})},j.prototype.createTokenRequest=function(N,P,M){var F=this;if(typeof N=="function"&&!M?(M=N,P=N=null):typeof P=="function"&&!M&&(M=P,P=null),!M&&this.client.options.promises)return E.promisify(this,"createTokenRequest",arguments);P=P||this.authOptions,N=N||E.copy(this.tokenParams);var W=P.key;if(!W){M(new S.default("No key specified",40101,403));return}var K=W.split(":"),X=K[0],et=K[1];if(!et){M(new S.default("Invalid key specified",40101,403));return}if(N.clientId===""){M(new S.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in N&&(N.capability=h(N.capability));var Y=E.mixin({keyName:X},N),w=N.clientId||"",B=N.ttl||"",H=N.capability||"";(function(V){if(Y.timestamp){V();return}F.getTimestamp(P&&P.queryTime,function(Z,lt){if(Z){M(Z);return}Y.timestamp=lt,V()})})(function(){var V=Y.nonce||(Y.nonce=m()),Z=Y.timestamp,lt=Y.keyName+`
`+B+`
`+H+`
`+w+`
`+Z+`
`+V+`
`;Y.mac=Y.mac||a(lt,et),s.default.logAction(s.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),M(null,Y)})},j.prototype.getAuthParams=function(N){this.method=="basic"?N(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(P,M){if(P){N(P);return}if(!M)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{access_token:M.token})})},j.prototype.getAuthHeaders=function(N){this.method=="basic"?N(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(P,M){if(P){N(P);return}if(!M)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{authorization:"Bearer "+E.toBase64(M.token)})})},j.prototype.getTimestamp=function(N,P){!this.isTimeOffsetSet()&&(N||this.authOptions.queryTime)?this.client.time(P):P(null,this.getTimestampUsingOffset())},j.prototype.getTimestampUsingOffset=function(){return E.now()+(this.client.serverTimeOffset||0)},j.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},j.prototype._saveBasicOptions=function(N){this.method="basic",this.key=N.key,this.basicKey=E.toBase64(N.key),this.authOptions=N||{},"clientId"in N&&this._userSetClientId(N.clientId)},j.prototype._saveTokenOptions=function(N,P){this.method="token",N&&(this.tokenParams=N),P&&(P.token&&(P.tokenDetails=typeof P.token=="string"?{token:P.token}:P.token),P.tokenDetails&&(this.tokenDetails=P.tokenDetails),"clientId"in P&&this._userSetClientId(P.clientId),this.authOptions=P)},j.prototype._ensureValidAuthCredentials=function(N,P){var M=this,F=this.tokenDetails;if(F){if(this._tokenClientIdMismatch(F.clientId)){P(new S.default("Mismatch between clientId in token ("+F.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!F.expires||F.expires>=this.getTimestampUsingOffset()){s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+F.expires),P(null,F);return}s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=O.default.create())).push(P),!(this.currentTokenRequestId!==null&&!N)){var W=this.currentTokenRequestId=U();this.requestToken(this.tokenParams,this.authOptions,function(K,X){if(M.currentTokenRequestId>W){s.default.logAction(s.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}M.currentTokenRequestId=null;var et=M.waitingForTokenRequest||T;if(M.waitingForTokenRequest=null,K){et(K);return}et(null,M.tokenDetails=X)})}},j.prototype._userSetClientId=function(N){if(typeof N=="string"||N===null){if(N==="*")throw new S.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var P=this._uncheckedSetClientId(N);if(P)throw P}else throw new S.default("clientId must be either a string or null",40012,400)},j.prototype._uncheckedSetClientId=function(N){if(this._tokenClientIdMismatch(N)){var P="Unexpected clientId mismatch: client has "+this.clientId+", requested "+N,M=new S.default(P,40102,401);return s.default.logAction(s.default.LOG_ERROR,"Auth._uncheckedSetClientId()",P),M}else return this.clientId=this.tokenParams.clientId=N,null},j.prototype._tokenClientIdMismatch=function(N){return!!(this.clientId&&this.clientId!=="*"&&N&&N!=="*"&&this.clientId!==N)},j.isTokenErr=function(N){return N.code&&N.code>=40140&&N.code<40150},j.prototype.revokeTokens=function(N,P,M){if(v(this.client.options))throw new S.default("Cannot revoke tokens when using token auth",40162,401);var F=this.client.options.keyName,W;if(typeof P=="function"?(M=P,W={}):W=P!=null?P:{},M===void 0){if(this.client.options.promises)return E.promisify(this,"revokeTokens",[N,W]);M=T}var K=M,X=c.__assign({targets:N.map(function(B){return"".concat(B.type,":").concat(B.value)})},W),et=this.client.options.useBinaryProtocol?E.Format.msgpack:E.Format.json,Y=E.defaultPostHeaders(this.client.options,et);this.client.options.headers&&E.mixin(Y,this.client.options.headers);var w=E.encodeBody(X,et);C.default.post(this.client,"/keys/".concat(F,"/revokeTokens"),w,Y,{newBatchResponse:"true"},null,function(B,H,V,Z){if(B){K(B);return}var lt=Z?H:E.decodeBody(H,et);K(null,lt)})},j}();f.default=k},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c;(function(s){s.Get="get",s.Delete="delete",s.Post="post",s.Put="put",s.Patch="patch"})(c||(c={})),f.default=c},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.HttpPaginatedResponse=f.PaginatedResult=void 0;var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(2)),O=c.__importDefault(r(14));function S(C){var x=C.match(/^\.\/(\w+)\?(.*)$/);return x&&x[2]&&s.parseQueryString(x[2])}function _(C){typeof C=="string"&&(C=C.split(","));for(var x={},T=0;T<C.length;T++){var m=C[T].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(m){var g=S(m[1]);g&&(x[m[2]]=g)}}return x}function L(C,x,T){return!(T&&(x||typeof C.code=="number"))}var y=function(){function C(x,T,m,g,b,a){this.rest=x,this.path=T,this.headers=m,this.envelope=g!=null?g:null,this.bodyHandler=b,this.useHttpPaginatedResponse=a||!1}return C.prototype.get=function(x,T){var m=this;O.default.get(this.rest,this.path,this.headers,x,this.envelope,function(g,b,a,h,i){m.handlePage(g,b,a,h,i,T)})},C.prototype.delete=function(x,T){var m=this;O.default.delete(this.rest,this.path,this.headers,x,this.envelope,function(g,b,a,h,i){m.handlePage(g,b,a,h,i,T)})},C.prototype.post=function(x,T,m){var g=this;O.default.post(this.rest,this.path,T,this.headers,x,this.envelope,function(b,a,h,i,o){m&&g.handlePage(b,a,h,i,o,m)})},C.prototype.put=function(x,T,m){var g=this;O.default.put(this.rest,this.path,T,this.headers,x,this.envelope,function(b,a,h,i,o){m&&g.handlePage(b,a,h,i,o,m)})},C.prototype.patch=function(x,T,m){var g=this;O.default.patch(this.rest,this.path,T,this.headers,x,this.envelope,function(b,a,h,i,o){m&&g.handlePage(b,a,h,i,o,m)})},C.prototype.handlePage=function(x,T,m,g,b,a){if(x&&L(x,T,this.useHttpPaginatedResponse)){E.default.logAction(E.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+s.inspectError(x)),a==null||a(x);return}var h,i,o;try{h=this.bodyHandler(T,m||{},g)}catch(v){a==null||a(x||v);return}m&&(i=m.Link||m.link)&&(o=_(i)),this.useHttpPaginatedResponse?a(null,new u(this,h,m||{},b,o,x)):a(null,new I(this,h,o))},C}(),I=function(){function C(x,T,m){var g=this;this.resource=x,this.items=T;var b=this;m&&("first"in m&&(this.first=function(a){if(!a&&b.resource.rest.options.promises)return s.promisify(b,"first",[]);b.get(m.first,a)}),"current"in m&&(this.current=function(a){if(!a&&b.resource.rest.options.promises)return s.promisify(b,"current",[]);b.get(m.current,a)}),this.next=function(a){if(!a&&b.resource.rest.options.promises)return s.promisify(b,"next",[]);"next"in m?b.get(m.next,a):a(null)},this.hasNext=function(){return"next"in m},this.isLast=function(){var a;return!(!((a=g.hasNext)===null||a===void 0)&&a.call(g))})}return C.prototype.get=function(x,T){var m=this.resource;O.default.get(m.rest,m.path,m.headers,x,m.envelope,function(g,b,a,h,i){m.handlePage(g,b,a,h,i,T)})},C}();f.PaginatedResult=I;var u=function(C){c.__extends(x,C);function x(T,m,g,b,a,h){var i=C.call(this,T,m,a)||this;return i.statusCode=b,i.success=b<300&&b>=200,i.headers=g,i.errorCode=h&&h.code,i.errorMessage=h&&h.message,i}return x.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},x}(I);f.HttpPaginatedResponse=u,f.default=y},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.isRetriable=void 0;var c=r(0),s=c.__importDefault(r(4)),E={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},O={disconnected:function(){return s.default.fromValues({statusCode:400,code:E.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return s.default.fromValues({statusCode:400,code:E.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return s.default.fromValues({statusCode:400,code:E.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return s.default.fromValues({statusCode:400,code:E.CLOSING,message:"Connection closing"})},closed:function(){return s.default.fromValues({statusCode:400,code:E.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return s.default.fromValues({statusCode:500,code:E.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return s.default.fromValues({statusCode:500,code:E.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function S(_){return!_.statusCode||!_.code||_.statusCode>=500?!0:Object.values(E).includes(_.code)}f.isRetriable=S,f.default=O},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c;(function(s){s[s.REQ_SEND=0]="REQ_SEND",s[s.REQ_RECV=1]="REQ_RECV",s[s.REQ_RECV_POLL=2]="REQ_RECV_POLL",s[s.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(c||(c={})),f.default=c},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(5),r(58),r(11),r(40),r(32),r(24),r(27),r(28),r(59),r(60))})(this,function(c){return c})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(2)),E=function(){function O(S){this.members=S||[]}return O.prototype.call=function(){for(var S=[],_=0;_<arguments.length;_++)S[_]=arguments[_];for(var L=0,y=this.members;L<y.length;L++){var I=y[L];if(I)try{I.apply(void 0,S)}catch(u){s.default.logAction(s.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+u+"; stack = "+u.stack)}}},O.prototype.push=function(){for(var S,_=[],L=0;L<arguments.length;L++)_[L]=arguments[L];(S=this.members).push.apply(S,_)},O.create=function(S){var _=new O(S);return Object.assign(function(){for(var L=[],y=0;y<arguments.length;y++)L[y]=arguments[y];return _.call.apply(_,L)},{push:function(L){return _.push(L)}})},O}();f.default=E},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){(function(){var s=c,E=s.lib,O=E.Base,S=s.enc,_=S.Utf8,L=s.algo,y=L.HMAC=O.extend({init:function(I,u){I=this._hasher=new I.init,typeof u=="string"&&(u=_.parse(u));var C=I.blockSize,x=C*4;u.sigBytes>x&&(u=I.finalize(u)),u.clamp();for(var T=this._oKey=u.clone(),m=this._iKey=u.clone(),g=T.words,b=m.words,a=0;a<C;a++)g[a]^=1549556828,b[a]^=909522486;T.sigBytes=m.sigBytes=x,this.reset()},reset:function(){var I=this._hasher;I.reset(),I.update(this._iKey)},update:function(I){return this._hasher.update(I),this},finalize:function(I){var u=this._hasher,C=u.finalize(I);u.reset();var x=u.finalize(this._oKey.clone().concat(C));return x}})})()})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.isSuccessCode=void 0;var c;(function(E){E[E.Success=200]="Success",E[E.NoContent=204]="NoContent",E[E.BadRequest=400]="BadRequest",E[E.Unauthorized=401]="Unauthorized",E[E.Forbidden=403]="Forbidden",E[E.RequestTimeout=408]="RequestTimeout",E[E.InternalServerError=500]="InternalServerError"})(c||(c={}));function s(E){return E>=c.Success&&E<c.BadRequest}f.isSuccessCode=s,f.default=c},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(10)),E=c.__importStar(r(1)),O=c.__importDefault(r(7)),S=c.__importDefault(r(2)),_=c.__importDefault(r(20)),L=c.__importDefault(r(4)),y=c.__importDefault(r(3)),I=s.default.Action,u=s.default.fromValues({action:I.CLOSE}),C=s.default.fromValues({action:I.DISCONNECT}),x=function(T){c.__extends(m,T);function m(g,b,a,h){var i=T.call(this)||this;return h&&(a.format=void 0,a.heartbeats=!0),i.connectionManager=g,g.registerProposedTransport(i),i.auth=b,i.params=a,i.timeouts=a.options.timeouts,i.format=a.format,i.isConnected=!1,i.isFinished=!1,i.isDisposed=!1,i.maxIdleInterval=null,i.idleTimer=null,i.lastActivity=null,i}return m.prototype.connect=function(){},m.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",_.default.closed())},m.prototype.disconnect=function(g){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",g||_.default.disconnected())},m.prototype.fail=function(g){this.isConnected&&this.requestDisconnect(),this.finish("failed",g||_.default.failed())},m.prototype.finish=function(g,b){var a;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((a=this.idleTimer)!==null&&a!==void 0?a:void 0),this.idleTimer=null,this.emit(g,b),this.dispose())},m.prototype.onProtocolMessage=function(g){switch(S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+s.default.stringify(g)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),g.action){case I.HEARTBEAT:S.default.logAction(S.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",g.id);break;case I.CONNECTED:this.onConnect(g),this.emit("connected",g.error,g.connectionId,g.connectionDetails,g);break;case I.CLOSED:this.onClose(g);break;case I.DISCONNECTED:this.onDisconnect(g);break;case I.ACK:this.emit("ack",g.msgSerial,g.count);break;case I.NACK:this.emit("nack",g.msgSerial,g.count,g.error);break;case I.SYNC:this.connectionManager.onChannelMessage(g,this);break;case I.ACTIVATE:break;case I.AUTH:this.auth.authorize(function(b){b&&S.default.logAction(S.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+E.inspectError(b))});break;case I.ERROR:if(S.default.logAction(S.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+y.default.Config.inspect(g.error)+(g.channel?", channel: "+g.channel:"")),g.channel===void 0){this.onFatalError(g);break}this.connectionManager.onChannelMessage(g,this);break;default:this.connectionManager.onChannelMessage(g,this)}},m.prototype.onConnect=function(g){if(this.isConnected=!0,!g.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var b=g.connectionDetails.maxIdleInterval;b&&(this.maxIdleInterval=b+this.timeouts.realtimeRequestTimeout,this.onActivity())},m.prototype.onDisconnect=function(g){var b=g&&g.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onDisconnect()","err = "+E.inspectError(b)),this.finish("disconnected",b)},m.prototype.onFatalError=function(g){var b=g&&g.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onFatalError()","err = "+E.inspectError(b)),this.finish("failed",b)},m.prototype.onClose=function(g){var b=g&&g.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onClose()","err = "+E.inspectError(b)),this.finish("closed",b)},m.prototype.requestClose=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.requestClose()",""),this.send(u)},m.prototype.requestDisconnect=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(C)},m.prototype.ping=function(g){var b={action:s.default.Action.HEARTBEAT};g&&(b.id=g),this.send(s.default.fromValues(b))},m.prototype.dispose=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},m.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=E.now(),this.setIdleTimer(this.maxIdleInterval+100))},m.prototype.setIdleTimer=function(g){var b=this;this.idleTimer||(this.idleTimer=setTimeout(function(){b.onIdleTimerExpire()},g))},m.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var g=E.now()-this.lastActivity,b=this.maxIdleInterval-g;if(b<=0){var a="No activity seen from realtime in "+g+"ms; assuming connection has dropped";S.default.logAction(S.default.LOG_ERROR,"Transport.onIdleTimerExpire()",a),this.disconnect(new L.default(a,80003,408))}else this.setIdleTimer(b+100)},m.tryConnect=function(g,b,a,h,i){var o=new g(b,a,h),v,l=function(U){clearTimeout(v),i({event:this.event,error:U})},A=b.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){o.off(["preconnect","disconnected","failed"]),o.dispose(),l.call({event:"disconnected"},new L.default("Timeout waiting for transport to indicate itself viable",5e4,500))},A),o.on(["failed","disconnected"],l),o.on("preconnect",function(){S.default.logAction(S.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+o),clearTimeout(v),o.off(["failed","disconnected"],l),i(null,o)}),o.connect()},m}(O.default);f.default=x},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(40),r(24))})(this,function(c){return function(){var s=c,E=s.lib,O=E.Base,S=E.WordArray,_=s.algo,L=_.MD5,y=_.EvpKDF=O.extend({cfg:O.extend({keySize:128/32,hasher:L,iterations:1}),init:function(I){this.cfg=this.cfg.extend(I)},compute:function(I,u){for(var C,x=this.cfg,T=x.hasher.create(),m=S.create(),g=m.words,b=x.keySize,a=x.iterations;g.length<b;){C&&T.update(C),C=T.update(I).finalize(u),T.reset();for(var h=1;h<a;h++)C=T.finalize(C),T.reset();m.concat(C)}return m.sigBytes=b*4,m}});s.EvpKDF=function(I,u,C){return y.create(C).compute(I,u)}}(),c.EvpKDF})},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(27))})(this,function(c){c.lib.Cipher||function(s){var E=c,O=E.lib,S=O.Base,_=O.WordArray,L=O.BufferedBlockAlgorithm,y=E.enc,I=y.Utf8,u=y.Base64,C=E.algo,x=C.EvpKDF,T=O.Cipher=L.extend({cfg:S.extend(),createEncryptor:function(P,M){return this.create(this._ENC_XFORM_MODE,P,M)},createDecryptor:function(P,M){return this.create(this._DEC_XFORM_MODE,P,M)},init:function(P,M,F){this.cfg=this.cfg.extend(F),this._xformMode=P,this._key=M,this.reset()},reset:function(){L.reset.call(this),this._doReset()},process:function(P){return this._append(P),this._process()},finalize:function(P){P&&this._append(P);var M=this._doFinalize();return M},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function P(M){return typeof M=="string"?N:U}return function(M){return{encrypt:function(F,W,K){return P(W).encrypt(M,F,W,K)},decrypt:function(F,W,K){return P(W).decrypt(M,F,W,K)}}}}()}),m=O.StreamCipher=T.extend({_doFinalize:function(){var P=this._process(!0);return P},blockSize:1}),g=E.mode={},b=O.BlockCipherMode=S.extend({createEncryptor:function(P,M){return this.Encryptor.create(P,M)},createDecryptor:function(P,M){return this.Decryptor.create(P,M)},init:function(P,M){this._cipher=P,this._iv=M}}),a=g.CBC=function(){var P=b.extend();P.Encryptor=P.extend({processBlock:function(F,W){var K=this._cipher,X=K.blockSize;M.call(this,F,W,X),K.encryptBlock(F,W),this._prevBlock=F.slice(W,W+X)}}),P.Decryptor=P.extend({processBlock:function(F,W){var K=this._cipher,X=K.blockSize,et=F.slice(W,W+X);K.decryptBlock(F,W),M.call(this,F,W,X),this._prevBlock=et}});function M(F,W,K){var X,et=this._iv;et?(X=et,this._iv=s):X=this._prevBlock;for(var Y=0;Y<K;Y++)F[W+Y]^=X[Y]}return P}(),h=E.pad={},i=h.Pkcs7={pad:function(P,M){for(var F=M*4,W=F-P.sigBytes%F,K=W<<24|W<<16|W<<8|W,X=[],et=0;et<W;et+=4)X.push(K);var Y=_.create(X,W);P.concat(Y)},unpad:function(P){var M=P.words[P.sigBytes-1>>>2]&255;P.sigBytes-=M}},o=O.BlockCipher=T.extend({cfg:T.cfg.extend({mode:a,padding:i}),reset:function(){var P;T.reset.call(this);var M=this.cfg,F=M.iv,W=M.mode;this._xformMode==this._ENC_XFORM_MODE?P=W.createEncryptor:(P=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==P?this._mode.init(this,F&&F.words):(this._mode=P.call(W,this,F&&F.words),this._mode.__creator=P)},_doProcessBlock:function(P,M){this._mode.processBlock(P,M)},_doFinalize:function(){var P,M=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(M.pad(this._data,this.blockSize),P=this._process(!0)):(P=this._process(!0),M.unpad(P)),P},blockSize:128/32}),v=O.CipherParams=S.extend({init:function(P){this.mixIn(P)},toString:function(P){return(P||this.formatter).stringify(this)}}),l=E.format={},A=l.OpenSSL={stringify:function(P){var M,F=P.ciphertext,W=P.salt;return W?M=_.create([1398893684,1701076831]).concat(W).concat(F):M=F,M.toString(u)},parse:function(P){var M,F=u.parse(P),W=F.words;return W[0]==1398893684&&W[1]==1701076831&&(M=_.create(W.slice(2,4)),W.splice(0,4),F.sigBytes-=16),v.create({ciphertext:F,salt:M})}},U=O.SerializableCipher=S.extend({cfg:S.extend({format:A}),encrypt:function(P,M,F,W){W=this.cfg.extend(W);var K=P.createEncryptor(F,W),X=K.finalize(M),et=K.cfg;return v.create({ciphertext:X,key:F,iv:et.iv,algorithm:P,mode:et.mode,padding:et.padding,blockSize:P.blockSize,formatter:W.format})},decrypt:function(P,M,F,W){W=this.cfg.extend(W),M=this._parse(M,W.format);var K=P.createDecryptor(F,W).finalize(M.ciphertext);return K},_parse:function(P,M){return typeof P=="string"?M.parse(P,this):P}}),k=E.kdf={},j=k.OpenSSL={execute:function(P,M,F,W){W||(W=_.random(64/8));var K=x.create({keySize:M+F}).compute(P,W),X=_.create(K.words.slice(M),F*4);return K.sigBytes=M*4,v.create({key:K,iv:X,salt:W})}},N=O.PasswordBasedCipher=U.extend({cfg:U.cfg.extend({kdf:j}),encrypt:function(P,M,F,W){W=this.cfg.extend(W);var K=W.kdf.execute(F,P.keySize,P.ivSize);W.iv=K.iv;var X=U.encrypt.call(this,P,M,K.key,W);return X.mixIn(K),X},decrypt:function(P,M,F,W){W=this.cfg.extend(W),M=this._parse(M,W.format);var K=W.kdf.execute(F,P.keySize,P.ivSize,M.salt);W.iv=K.iv;var X=U.decrypt.call(this,P,M,K.key,W);return X}})}()})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.Request=f.createRequest=void 0;var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(12)),O=c.__importDefault(r(3)),S=c.__importDefault(r(7)),_=r(4),L=c.__importDefault(r(8)),y=c.__importDefault(r(2)),I=c.__importDefault(r(21)),u=s.getGlobalObject(),C=function(){},x=u._ablyjs_jsonp={};x._=function(i){return x["_"+i]||C};var T=1,m="jsonp";function g(i,o,v,l,A,U,k){return U=U||L.default.TIMEOUTS,new a(void 0,i,o,s.copy(v),l,A,U,k)}f.createRequest=g;var b=function(i){c.__extends(o,i);function o(v,l,A){var U=i.call(this,v,l,A)||this;return U.shortName=m,A.stream=!1,U}return o.isAvailable=function(){return O.default.Config.jsonpSupported&&O.default.Config.allowComet},o.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(v,l,A,U,k,j,N){return j=(this===null||this===void 0?void 0:this.timeouts)||j||L.default.TIMEOUTS,g(v,l,A,U,k,j,N)},o}(E.default),a=function(i){c.__extends(o,i);function o(v,l,A,U,k,j,N,P){var M=i.call(this)||this;return v===void 0&&(v=T++),M.id=v,M.uri=l,M.params=U||{},M.params.rnd=s.cheapRandStr(),A&&(A["X-Ably-Version"]&&(M.params.v=A["X-Ably-Version"]),A["X-Ably-Lib"]&&(M.params.lib=A["X-Ably-Lib"])),M.body=k,M.method=P,M.requestMode=j,M.timeouts=N,M.requestComplete=!1,M}return o.prototype.exec=function(){var v=this,l=this.id,A=this.body,U=this.method,k=this.uri,j=this.params;j.callback="_ablyjs_jsonp._("+l+")",j.envelope="jsonp",A&&(j.body=A),U&&U!=="get"&&(j.method=U);var N=this.script=document.createElement("script"),P=k+s.toQueryString(j);N.src=P,N.src.split("/").slice(-1)[0]!==P.split("/").slice(-1)[0]&&y.default.logAction(y.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),N.async=!0,N.type="text/javascript",N.charset="UTF-8",N.onerror=function(W){v.complete(new _.PartialErrorInfo("JSONP script error (event: "+O.default.Config.inspect(W)+")",null,400))},x["_"+l]=function(W){if(W.statusCode){var K=W.response;if(W.statusCode==204)v.complete(null,null,null,W.statusCode);else if(!K)v.complete(new _.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||s.isArray(K))v.complete(null,K,W.headers,W.statusCode);else{var X=K.error||new _.PartialErrorInfo("Error response received from server",null,W.statusCode);v.complete(X)}}else v.complete(null,W)};var M=this.requestMode==I.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),M);var F=document.getElementsByTagName("head")[0];F.insertBefore(N,F.firstChild)},o.prototype.complete=function(v,l,A,U){if(A=A||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;l&&(k=typeof l=="string"?"text/plain":"application/json",A["content-type"]=k,this.emit("data",l)),this.emit("complete",v,l,A,!0,U),this.dispose()}},o.prototype.abort=function(){this.dispose()},o.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var l=this.script;l.parentNode&&l.parentNode.removeChild(l),delete x[this.id],this.emit("disposed")},o}(S.default);f.Request=a;function h(i){return u.JSONPTransport=b,b.isAvailable()&&(i.supportedTransports[m]=b),b}f.default=h},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(2)),O=c.__importDefault(r(8)),S=c.__importDefault(r(17)),_=c.__importDefault(r(46)),L=c.__importDefault(r(19)),y=c.__importDefault(r(33)),I=c.__importDefault(r(4)),u=c.__importDefault(r(49)),C=c.__importDefault(r(18)),x=c.__importDefault(r(3)),T=c.__importDefault(r(9)),m=c.__importDefault(r(15)),g=c.__importDefault(r(14)),b=function(){},a=function(){function i(o){if(!o){var v="no options provided";throw E.default.logAction(E.default.LOG_ERROR,"Rest()",v),new Error(v)}var l=O.default.objectifyOptions(o);l.log&&E.default.setLog(l.log.level,l.log.handler),E.default.logAction(E.default.LOG_MICRO,"Rest()","initialized with clientOptions "+x.default.Config.inspect(o));var A=this.options=O.default.normaliseOptions(l);if(A.key){var U=A.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!U){var v="invalid key parameter";throw E.default.logAction(E.default.LOG_ERROR,"Rest()",v),new I.default(v,40400,404)}A.keyName=U[1],A.keySecret=U[2]}if("clientId"in A)if(typeof A.clientId=="string"||A.clientId===null){if(A.clientId==="*")throw new I.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new I.default("clientId must be either a string or null",40012,400);E.default.logAction(E.default.LOG_MINOR,"Rest()","started; version = "+O.default.version),this.baseUri=this.authority=function(k){return O.default.getHttpScheme(A)+k+":"+O.default.getPort(A,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new x.default.Http(A),this.auth=new S.default(this,A),this.channels=new h(this),this.push=new _.default(this)}return i.prototype.stats=function(o,v){if(v===void 0)if(typeof o=="function")v=o,o=null;else{if(this.options.promises)return s.promisify(this,"stats",[o]);v=b}var l=s.defaultGetHeaders(this.options),A=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,U=this.http.supportsLinkHeaders?void 0:A;this.options.headers&&s.mixin(l,this.options.headers),new L.default(this,"/stats",l,U,function(k,j,N){for(var P=N?k:JSON.parse(k),M=0;M<P.length;M++)P[M]=u.default.fromValues(P[M]);return P}).get(o,v)},i.prototype.time=function(o,v){var l=this;if(v===void 0){if(typeof o=="function")v=o,o=null;else if(this.options.promises)return s.promisify(this,"time",[o])}var A=v||b,U=s.defaultGetHeaders(this.options);this.options.headers&&s.mixin(U,this.options.headers);var k=function(j){return l.authority(j)+"/time"};this.http.do(C.default.Get,this,k,U,null,o,function(j,N,P,M){if(j){A(j);return}M||(N=JSON.parse(N));var F=N[0];if(!F){A(new I.default("Internal error (unexpected result type from GET /time)",5e4,500));return}l.serverTimeOffset=F-s.now(),A(null,F)})},i.prototype.request=function(o,v,l,A,U,k){var j=this.options.useBinaryProtocol,N=j?x.default.Config.msgpack.encode:JSON.stringify,P=j?x.default.Config.msgpack.decode:JSON.parse,M=j?s.Format.msgpack:s.Format.json,F=this.http.supportsLinkHeaders?void 0:M;l=l||{};var W=o.toLowerCase(),K=W=="get"?s.defaultGetHeaders(this.options,M):s.defaultPostHeaders(this.options,M);if(k===void 0){if(this.options.promises)return s.promisify(this,"request",[o,v,l,A,U]);k=b}typeof A!="string"&&(A=N(A)),this.options.headers&&s.mixin(K,this.options.headers),U&&s.mixin(K,U);var X=new L.default(this,v,K,F,function(et,Y,w){return s.ensureArray(w?et:P(et))},!0);if(!s.arrIn(x.default.Http.methods,W))throw new I.default("Unsupported method "+W,40500,405);s.arrIn(x.default.Http.methodsWithBody,W)?X[W](l,A,k):X[W](l,k)},i.prototype.batchPublish=function(o,v){if(v===void 0){if(this.options.promises)return s.promisify(this,"batchPublish",[o]);v=b}var l=v,A,U;s.isArray(o)?(A=o,U=!1):(A=[o],U=!0);var k=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,j=s.defaultPostHeaders(this.options,k);this.options.headers&&s.mixin(j,this.options.headers);var N=s.encodeBody(A,k);g.default.post(this,"/messages",N,j,{newBatchResponse:"true"},null,function(P,M,F,W){if(P){l(P);return}var K=W?M:s.decodeBody(M,k);U?l(null,K[0]):l(null,K)})},i.prototype.batchPresence=function(o,v){if(v===void 0){if(this.options.promises)return s.promisify(this,"batchPresence",[o]);v=b}var l=v,A=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,U=s.defaultPostHeaders(this.options,A);this.options.headers&&s.mixin(U,this.options.headers);var k=o.join(",");g.default.get(this,"/presence",U,{newBatchResponse:"true",channels:k},null,function(j,N,P,M){if(j){l(j);return}var F=M?N:s.decodeBody(N,A);l(null,F)})},i.prototype.setLog=function(o){E.default.setLog(o.level,o.handler)},i.Promise=function(o){return o=O.default.objectifyOptions(o),o.promises=!0,new i(o)},i.Callbacks=i,i.Platform=x.default,i.Message=T.default,i.PresenceMessage=m.default,i}(),h=function(){function i(o){this.rest=o,this.all=Object.create(null)}return i.prototype.get=function(o,v){o=String(o);var l=this.all[o];return l?v&&l.setOptions(v):this.all[o]=l=new y.default(this.rest,o,v),l},i.prototype.release=function(o){delete this.all[String(o)]},i}();f.default=a},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return c.enc.Utf8})},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(s){var E=c,O=E.lib,S=O.WordArray,_=O.Hasher,L=E.algo,y=[],I=[];(function(){function x(b){for(var a=s.sqrt(b),h=2;h<=a;h++)if(!(b%h))return!1;return!0}function T(b){return(b-(b|0))*4294967296|0}for(var m=2,g=0;g<64;)x(m)&&(g<8&&(y[g]=T(s.pow(m,1/2))),I[g]=T(s.pow(m,1/3)),g++),m++})();var u=[],C=L.SHA256=_.extend({_doReset:function(){this._hash=new S.init(y.slice(0))},_doProcessBlock:function(x,T){for(var m=this._hash.words,g=m[0],b=m[1],a=m[2],h=m[3],i=m[4],o=m[5],v=m[6],l=m[7],A=0;A<64;A++){if(A<16)u[A]=x[T+A]|0;else{var U=u[A-15],k=(U<<25|U>>>7)^(U<<14|U>>>18)^U>>>3,j=u[A-2],N=(j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10;u[A]=k+u[A-7]+N+u[A-16]}var P=i&o^~i&v,M=g&b^g&a^b&a,F=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),W=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),K=l+W+P+I[A]+u[A],X=F+M;l=v,v=o,o=i,i=h+K|0,h=a,a=b,b=g,g=K+X|0}m[0]=m[0]+g|0,m[1]=m[1]+b|0,m[2]=m[2]+a|0,m[3]=m[3]+h|0,m[4]=m[4]+i|0,m[5]=m[5]+o|0,m[6]=m[6]+v|0,m[7]=m[7]+l|0},_doFinalize:function(){var x=this._data,T=x.words,m=this._nDataBytes*8,g=x.sigBytes*8;return T[g>>>5]|=128<<24-g%32,T[(g+64>>>9<<4)+14]=s.floor(m/4294967296),T[(g+64>>>9<<4)+15]=m,x.sigBytes=T.length*4,this._process(),this._hash},clone:function(){var x=_.clone.call(this);return x._hash=this._hash.clone(),x}});E.SHA256=_._createHelper(C),E.HmacSHA256=_._createHmacHelper(C)}(Math),c.SHA256})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(7)),O=c.__importDefault(r(2)),S=c.__importDefault(r(34)),_=c.__importDefault(r(9)),L=c.__importDefault(r(4)),y=c.__importDefault(r(19)),I=c.__importDefault(r(14)),u=c.__importDefault(r(3));function C(){}var x=9;function T(b){return s.arrEvery(b,function(a){return!a.id})}function m(b){var a=b||{};if(a.cipher){if(!u.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var h=u.default.Crypto.getCipher(a.cipher);a.cipher=h.cipherParams,a.channelCipher=h.cipher}else"cipher"in a&&(a.cipher=void 0,a.channelCipher=null);return a}var g=function(b){c.__extends(a,b);function a(h,i,o){var v=b.call(this)||this;return O.default.logAction(O.default.LOG_MINOR,"Channel()","started; name = "+i),v.rest=h,v.name=i,v.basePath="/channels/"+encodeURIComponent(i),v.presence=new S.default(v),v.channelOptions=m(o),v}return a.prototype.setOptions=function(h){this.channelOptions=m(h)},a.prototype.history=function(h,i){if(O.default.logAction(O.default.LOG_MICRO,"Channel.history()","channel = "+this.name),i===void 0)if(typeof h=="function")i=h,h=null;else{if(this.rest.options.promises)return s.promisify(this,"history",arguments);i=C}this._history(h,i)},a.prototype._history=function(h,i){var o=this.rest,v=o.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,l=this.rest.http.supportsLinkHeaders?void 0:v,A=s.defaultGetHeaders(o.options,v);o.options.headers&&s.mixin(A,o.options.headers);var U=this.channelOptions;new y.default(o,this.basePath+"/messages",A,l,function(k,j,N){return _.default.fromResponseBody(k,U,N?void 0:v)}).get(h,i)},a.prototype.publish=function(){var h=this,i=arguments.length,o=arguments[0],v=arguments[1],l=arguments[i-1],A,U;if(typeof l!="function"){if(this.rest.options.promises)return s.promisify(this,"publish",arguments);l=C}if(typeof o=="string"||o===null)A=[_.default.fromValues({name:o,data:v})],U=arguments[2];else if(s.isObject(o))A=[_.default.fromValues(o)],U=arguments[1];else if(s.isArray(o))A=_.default.fromValuesArray(o),U=arguments[1];else throw new L.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof U!="object"||!U)&&(U={});var k=this.rest,j=k.options,N=j.useBinaryProtocol?s.Format.msgpack:s.Format.json,P=k.options.idempotentRestPublishing,M=s.defaultPostHeaders(k.options,N);if(j.headers&&s.mixin(M,j.headers),P&&T(A)){var F=s.randomString(x);s.arrForEach(A,function(W,K){W.id=F+":"+K.toString()})}_.default.encodeArray(A,this.channelOptions,function(W){if(W){l(W);return}var K=_.default.getMessagesSize(A),X=j.maxMessageSize;if(K>X){l(new L.default("Maximum size of messages that can be published at once exceeded ( was "+K+" bytes; limit is "+X+" bytes)",40009,400));return}h._publish(_.default.serialize(A,N),M,U,l)})},a.prototype._publish=function(h,i,o,v){I.default.post(this.rest,this.basePath+"/messages",h,i,o,null,v)},a.prototype.status=function(h){if(typeof h!="function"&&this.rest.options.promises)return s.promisify(this,"status",[]);var i=this.rest.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,o=s.defaultPostHeaders(this.rest.options,i);I.default.get(this.rest,this.basePath,o,{},i,h||C)},a}(E.default);f.default=g},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(7)),O=c.__importDefault(r(2)),S=c.__importDefault(r(19)),_=c.__importDefault(r(15));function L(){}var y=function(I){c.__extends(u,I);function u(C){var x=I.call(this)||this;return x.channel=C,x.basePath=C.basePath+"/presence",x}return u.prototype.get=function(C,x){if(O.default.logAction(O.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),x===void 0)if(typeof C=="function")x=C,C=null;else{if(this.channel.rest.options.promises)return s.promisify(this,"get",arguments);x=L}var T=this.channel.rest,m=T.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,g=this.channel.rest.http.supportsLinkHeaders?void 0:m,b=s.defaultGetHeaders(T.options,m);T.options.headers&&s.mixin(b,T.options.headers);var a=this.channel.channelOptions;new S.default(T,this.basePath,b,g,function(h,i,o){return _.default.fromResponseBody(h,a,o?void 0:m)}).get(C,x)},u.prototype.history=function(C,x){return O.default.logAction(O.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(C,x)},u.prototype._history=function(C,x){if(x===void 0)if(typeof C=="function")x=C,C=null;else{if(this.channel.rest.options.promises)return s.promisify(this,"_history",[C]);x=L}var T=this.channel.rest,m=T.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,g=this.channel.rest.http.supportsLinkHeaders?void 0:m,b=s.defaultGetHeaders(T.options,m);T.options.headers&&s.mixin(b,T.options.headers);var a=this.channel.channelOptions;new S.default(T,this.basePath+"/history",b,g,function(h,i,o){return _.default.fromResponseBody(h,a,o?void 0:m)}).get(C,x)},u}(E.default);f.default=y},function(p,f,r){"use strict";(function(c){Object.defineProperty(f,"__esModule",{value:!0}),f.TransportParams=void 0;var s=r(0),E=s.__importDefault(r(10)),O=s.__importStar(r(1)),S=s.__importStar(r(52)),_=s.__importStar(r(8)),L=s.__importDefault(r(3)),y=s.__importDefault(r(7)),I=s.__importDefault(r(36)),u=s.__importDefault(r(2)),C=s.__importDefault(r(37)),x=s.__importStar(r(20)),T=s.__importStar(r(4)),m=s.__importDefault(r(17)),g=s.__importDefault(r(9)),b=s.__importDefault(r(23)),a=s.__importDefault(r(53)),h=s.__importDefault(r(26)),i=s.__importDefault(r(25)),o=function(){var et;return typeof L.default.WebStorage!="undefined"&&((et=L.default.WebStorage)===null||et===void 0?void 0:et.localSupported)},v=function(){var et;return typeof L.default.WebStorage!="undefined"&&((et=L.default.WebStorage)===null||et===void 0?void 0:et.sessionSupported)},l=E.default.Action,A=function(){},U="ably-transport-preference",k="ably-connection-recovery";function j(){var et,Y;return v()&&((Y=(et=L.default.WebStorage)===null||et===void 0?void 0:et.getSession)===null||Y===void 0?void 0:Y.call(et,k))}function N(et){var Y,w;return v()&&((w=(Y=L.default.WebStorage)===null||Y===void 0?void 0:Y.setSession)===null||w===void 0?void 0:w.call(Y,k,et))}function P(){var et,Y;return v()&&((Y=(et=L.default.WebStorage)===null||et===void 0?void 0:et.removeSession)===null||Y===void 0?void 0:Y.call(et,k))}function M(et,Y){return O.arrIndexOf(L.default.Defaults.transportPreferenceOrder,et.shortName)>O.arrIndexOf(L.default.Defaults.transportPreferenceOrder,Y.shortName)}function F(et,Y,w){var B;if(et.channel!==Y.channel||(B=et.action)!==l.PRESENCE&&B!==l.MESSAGE||B!==Y.action)return!1;var H=B===l.PRESENCE?"presence":"messages",V=et[H].concat(Y[H]),Z=g.default.getMessagesSize(V);return Z>w||!O.allSame(V,"clientId")||!O.arrEvery(V,function(lt){return!lt.id})?!1:(et[H]=V,!0)}function W(et){try{return JSON.parse(et)}catch(Y){return null}}var K=function(){function et(Y,w,B,H){this.options=Y,this.host=w,this.mode=B,this.connectionKey=H,this.format=Y.useBinaryProtocol?O.Format.msgpack:O.Format.json}return et.prototype.getConnectParams=function(Y){var w=Y?O.copy(Y):{},B=this.options;switch(this.mode){case"upgrade":w.upgrade=this.connectionKey;break;case"resume":w.resume=this.connectionKey;break;case"recover":{var H=W(B.recover);H&&(w.recover=H.connectionKey);break}default:}return B.clientId!==void 0&&(w.clientId=B.clientId),B.echoMessages===!1&&(w.echo="false"),this.format!==void 0&&(w.format=this.format),this.stream!==void 0&&(w.stream=this.stream),this.heartbeats!==void 0&&(w.heartbeats=this.heartbeats),w.v=_.default.protocolVersion,w.agent=encodeURIComponent((0,_.getAgentString)(this.options)),B.transportParams!==void 0&&O.mixin(w,B.transportParams),w},et.prototype.toString=function(){var Y="[mode="+this.mode;return this.host&&(Y+=",host="+this.host),this.connectionKey&&(Y+=",connectionKey="+this.connectionKey),this.format&&(Y+=",format="+this.format),Y+="]",Y},et}();f.TransportParams=K;var X=function(et){s.__extends(Y,et);function Y(w,B){var H=et.call(this)||this;H.disconnectedRetryCount=0,Y.initTransports(),H.realtime=w,H.options=B;var V=B.timeouts,Z=V.preferenceConnectTimeout+V.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:Z,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:V.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new I.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=V.connectionStateTtl,H.maxIdleInterval=null,H.transports=O.intersect(B.transports||_.default.defaultTransports,Y.supportedTransports),H.baseTransport=O.intersect(_.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=O.intersect(H.transports,_.default.upgradeTransports),H.transportPreference=null,H.httpHosts=_.default.getHosts(B),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,u.default.logAction(u.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(B.transports||_.default.defaultTransports)+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var lt="no requested transports available";throw u.default.logAction(u.default.LOG_ERROR,"realtime.ConnectionManager()",lt),new Error(lt)}var dt=L.default.Config.addEventListener;return dt&&(v()&&typeof B.recover=="function"&&dt("beforeunload",H.persistConnection.bind(H)),B.closeOnUnload===!0&&dt("beforeunload",function(){u.default.logAction(u.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),dt("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(vt){vt.off()}),H.disconnectAllTransports(),H.startConnect())}),dt("offline",function(){H.state==H.states.connected&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return Y.initTransports=function(){(0,a.default)(Y),O.arrForEach(L.default.Transports,function(w){w(Y)})},Y.prototype.createTransportParams=function(w,B){return new K(this.options,w,B,this.connectionKey)},Y.prototype.getTransportParams=function(w){var B=this,H=function(V){if(B.connectionKey){V("resume");return}if(typeof B.options.recover=="string"){V("recover");return}var Z=B.options.recover,lt=j();if(lt&&typeof Z=="function"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),Z(lt,function(dt){dt?(B.options.recover=lt.recoveryKey,V("recover")):V("clean")});return}V("clean")};H(function(V){var Z=B.createTransportParams(null,V);if(V==="recover"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+B.options.recover);var lt=W(B.options.recover);lt&&(B.msgSerial=lt.msgSerial)}else u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+Z.toString());w(Z)})},Y.prototype.tryATransport=function(w,B,H){var V=this;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+B),h.default.tryConnect(Y.supportedTransports[B],this,this.realtime.auth,w,function(Z,lt){var dt=V.state;if(dt==V.states.closing||dt==V.states.closed||dt==V.states.failed){lt&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+dt.state+" while we were attempting the transport; closing "+lt),lt.close()),H(!0);return}if(Z){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+B+" "+Z.event+", err: "+Z.error.toString()),m.default.isTokenErr(Z.error)&&!(V.errorReason&&m.default.isTokenErr(V.errorReason))?(V.errorReason=Z.error,V.realtime.auth._forceNewToken(null,null,function(vt){if(vt){V.actOnErrorFromAuthorize(vt);return}V.tryATransport(w,B,H)})):Z.event==="failed"?(V.notifyState({state:"failed",error:Z.error}),H(!0)):Z.event==="disconnected"&&((0,x.isRetriable)(Z.error)?H(!1):(V.notifyState({state:V.states.connecting.failState,error:Z.error}),H(!0)));return}u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+B+"; setting pending"),V.setTransportPending(lt,w),H(null,lt)})},Y.prototype.setTransportPending=function(w,B){var H=this,V=B.mode;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+w+"; mode = "+V),O.arrDeleteValue(this.proposedTransports,w),this.pendingTransports.push(w);var Z=L.default.Defaults.transportPreferenceOrder[L.default.Defaults.transportPreferenceOrder.length-1];w.once("connected",function(dt,vt,mt){V=="upgrade"&&H.activeProtocol?w.shortName!==Z&&O.arrIn(H.getUpgradePossibilities(),Z)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(dt,w,vt,mt)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(dt,w,vt,mt):(H.activateTransport(dt,w,vt,mt),L.default.Config.nextTick(function(){H.connectImpl(B)})),V==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var lt=this;w.on(["disconnected","closed","failed"],function(dt){lt.deactivateTransport(w,this.event,dt)}),this.emit("transport.pending",w)},Y.prototype.scheduleTransportActivation=function(w,B,H,V){var Z=this,lt=this.activeProtocol&&this.activeProtocol.getTransport(),dt=function(){B.disconnect(),O.arrDeleteValue(Z.pendingTransports,B)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),dt();return}if(lt&&!M(B,lt)){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+" is no better than current active transport "+lt.shortName+" - abandoning upgrade"),dt();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+B);var vt=null;if(!B.isConnected){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+B.shortName+"is no longer connected; abandoning upgrade"),dt();return}if(this.state===this.states.connected)u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,vt=this.activeProtocol;else if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+B.shortName),dt();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+B);var mt=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+B),B.send(E.default.fromValues({action:l.ACTIVATE})),Z.activateTransport(w,B,H,V),Z.state===Z.states.synchronizing?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+B),Z.state=Z.states.connected):u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+Z.state.state+", so leaving unchanged"),Z.state.sendEvents&&Z.sendQueuedMessages()};vt?vt.onceIdle(mt):mt()},Y.prototype.activateTransport=function(w,B,H,V){var Z=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+B),w&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+w),H&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),V&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(V)),this.persistTransportPreference(B);var lt=this.state,dt=this.states.connected.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+lt.state),lt.state==this.states.closing.state||lt.state==this.states.closed.state||lt.state==this.states.failed.state)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),B.disconnect(),!1;if(O.arrDeleteValue(this.pendingTransports,B),!B.isConnected)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+B+" since it appears to no longer be connected"),!1;var vt=this.activeProtocol;this.activeProtocol=new S.default(B),this.host=B.params.host;var mt=V.connectionKey;if(mt&&this.connectionKey!=mt&&this.setConnection(H,V,!!w),this.onConnectionDetailsUpdate(V,B),L.default.Config.nextTick(function(){B.on("connected",function(ct,Dt,Yt){Z.onConnectionDetailsUpdate(Yt,B),Z.emit("update",new C.default(dt,dt,null,ct))})}),lt.state===this.states.connected.state?w&&(this.errorReason=this.realtime.connection.errorReason=w,this.emit("update",new C.default(dt,dt,null,w))):(this.notifyState({state:"connected",error:w}),this.errorReason=this.realtime.connection.errorReason=w||null),this.emit("transport.active",B),vt)if(vt.messageQueue.count()>0&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+vt.transport.shortName+", new one is "+B.shortName+") finishing with "+vt.messageQueue.count()+" messages still pending"),vt.transport===B){var wt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+B.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",wt)}else vt.finish();return O.safeArrForEach(this.pendingTransports,function(ct){if(ct===B){var Dt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+B.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",Dt),O.arrDeleteValue(Z.pendingTransports,B)}else ct.disconnect()}),O.safeArrForEach(this.proposedTransports,function(ct){ct===B?(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+B.shortName+"; stack = "+new Error().stack),O.arrDeleteValue(Z.proposedTransports,B)):ct.dispose()}),!0},Y.prototype.deactivateTransport=function(w,B,H){var V=this.activeProtocol,Z=V&&V.getTransport()===w,lt=O.arrDeleteValue(this.pendingTransports,w),dt=O.arrDeleteValue(this.proposedTransports,w),vt=this.noTransportsScheduledForActivation();if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+w),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+B+(Z?"; was active":lt?"; was pending":dt?"; was proposed":"")+(vt?"":"; another transport is scheduled for activation")),H&&H.message&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),Z&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(V.getPendingMessages()),L.default.Config.nextTick(function(){V.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",w),Z&&vt||Z&&B==="failed"||B==="closed"||V===null&&lt&&this.pendingTransports.length===0){if(B==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:B,error:H,retryImmediately:!0});return}var mt=B==="failed"&&m.default.isTokenErr(H)?"disconnected":B;this.notifyState({state:mt,error:H});return}Z&&B==="disconnected"&&this.state!==this.states.synchronizing&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},Y.prototype.noTransportsScheduledForActivation=function(){return O.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(w){return!w.isConnected})},Y.prototype.setConnection=function(w,B,H){var V=this.connectionId,Z=V&&V!==w,lt=!V&&H;(Z||lt)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==w&&u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=w,this.realtime.connection.key=this.connectionKey=B.connectionKey},Y.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},Y.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},Y.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var w=O.now()-this.lastActivity;w>this.connectionStateTtl+this.maxIdleInterval&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+w+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Y.prototype.persistConnection=function(){if(v()){var w=this.createRecoveryKey();w&&N({recoveryKey:w,disconnectedAt:O.now(),location:c.location,clientId:this.realtime.auth.clientId})}},Y.prototype.unpersistConnection=function(){P()},Y.prototype.getError=function(){return this.errorReason||this.getStateError()},Y.prototype.getStateError=function(){var w,B;return(B=(w=x.default)[this.state.state])===null||B===void 0?void 0:B.call(w)},Y.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Y.prototype.enactStateChange=function(w){var B=w.current==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(B,"Connection state",w.current+(w.reason?"; reason: "+w.reason:"")),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+w.current+"; reason = "+(w.reason&&w.reason.message));var H=this.state=this.states[w.current];w.reason&&(this.errorReason=w.reason,this.realtime.connection.errorReason=w.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",w)},Y.prototype.startTransitionTimer=function(w){var B=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+w.state),this.transitionTimer&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){B.transitionTimer&&(B.transitionTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager "+w.state+" timer expired","requesting new state: "+w.failState),B.notifyState({state:w.failState}))},w.retryDelay)},Y.prototype.cancelTransitionTimer=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Y.prototype.startSuspendTimer=function(){var w=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){w.suspendTimer&&(w.suspendTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),w.states.connecting.failState="suspended",w.notifyState({state:"suspended"}))},this.connectionStateTtl))},Y.prototype.checkSuspendTimer=function(w){w!=="disconnected"&&w!=="suspended"&&w!=="connecting"&&this.cancelSuspendTimer()},Y.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Y.prototype.startRetryTimer=function(w){var B=this;this.retryTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),B.retryTimer=null,B.requestState({state:"connecting"})},w)},Y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Y.prototype.notifyState=function(w){var B=this,H,V,Z=w.state,lt=Z==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||w.retryImmediately||this.state===this.states.connecting&&w.error&&m.default.isTokenErr(w.error)&&!(this.errorReason&&m.default.isTokenErr(this.errorReason)));if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+Z+(lt?"; will retry connection immediately":"")),Z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(w.state),(Z==="suspended"||Z==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var dt=this.states[w.state],vt=dt.retryDelay;dt.state==="disconnected"&&(this.disconnectedRetryCount++,vt=O.getRetryTime(dt.retryDelay,this.disconnectedRetryCount));var mt=new C.default(this.state.state,dt.state,vt,w.error||((V=(H=x.default)[dt.state])===null||V===void 0?void 0:V.call(H)));if(lt){var wt=function(){B.state===B.states.disconnected&&(B.lastAutoReconnectAttempt=O.now(),B.requestState({state:"connecting"}))},ct=this.lastAutoReconnectAttempt&&O.now()-this.lastAutoReconnectAttempt+1;ct&&ct<1e3?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ct+"ms ago, waiting another "+(1e3-ct)+"ms before trying again"),setTimeout(wt,1e3-ct)):L.default.Config.nextTick(wt)}else(Z==="disconnected"||Z==="suspended")&&this.startRetryTimer(vt);(Z==="disconnected"&&!lt||Z==="suspended"||dt.terminal)&&L.default.Config.nextTick(function(){B.disconnectAllTransports()}),Z=="connected"&&!this.activeProtocol&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(mt),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(Z,mt.reason),this.failQueuedMessages(mt.reason))}},Y.prototype.requestState=function(w){var B=this,H,V,Z=w.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+Z+"; current state: "+this.state.state),Z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(Z),!(Z=="connecting"&&this.state.state=="connected")&&!(Z=="closing"&&this.state.state=="closed"))){var lt=this.states[Z],dt=new C.default(this.state.state,lt.state,null,w.error||((V=(H=x.default)[lt.state])===null||V===void 0?void 0:V.call(H)));this.enactStateChange(dt),Z=="connecting"&&L.default.Config.nextTick(function(){B.startConnect()}),Z=="closing"&&this.closeImpl()}},Y.prototype.startConnect=function(){var w=this;if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var B=this.realtime.auth,H=++this.connectCounter,V=function(){w.checkConnectionStateFreshness(),w.getTransportParams(function(lt){if(lt.mode==="recover"&&lt.options.recover){var dt=W(lt.options.recover);dt&&w.realtime.channels.recoverChannels(dt.channelSerials)}H===w.connectCounter&&w.connectImpl(lt,H)})};if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),B.method==="basic")V();else{var Z=function(lt){H===w.connectCounter&&(lt?w.actOnErrorFromAuthorize(lt):V())};this.errorReason&&m.default.isTokenErr(this.errorReason)?B._forceNewToken(null,null,Z):B._ensureValidAuthCredentials(!1,Z)}},Y.prototype.connectImpl=function(w,B){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(w):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(w,B):this.connectBase(w,B)},Y.prototype.connectPreference=function(w,B){var H=this,V=this.getTransportPreference(),Z=!1;O.arrIn(this.transports,V)||(this.unpersistTransportPreference(),this.connectImpl(w,B)),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+V);var lt=setTimeout(function(){Z=!0,H.state.state!==H.states.connected.state&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+V+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(w,B)},this.options.timeouts.preferenceConnectTimeout);w.host=this.httpHosts[0],this.tryATransport(w,V,function(dt,vt){clearTimeout(lt),Z&&vt?(vt.off(),vt.disconnect(),O.arrDeleteValue(H.pendingTransports,vt)):!vt&&!dt&&(H.unpersistTransportPreference(),H.connectImpl(w,B))})},Y.prototype.connectBase=function(w,B){var H=this,V=function(mt){H.notifyState({state:H.states.connecting.failState,error:mt})},Z=this.httpHosts.slice(),lt=function(mt,wt){B===H.connectCounter&&!wt&&!mt&&vt()};u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var dt=Z.shift();if(!dt){V(new T.default("Unable to connect (no available host)",80003,404));return}w.host=dt;var vt=function(){if(!Z.length){V(new T.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){V(new T.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(mt,wt){if(B===H.connectCounter){if(mt){V(mt);return}if(!wt){V(new T.default("Unable to connect (network unreachable)",80003,404));return}w.host=O.arrPopRandomElement(Z),H.tryATransport(w,H.baseTransport,lt)}})};if(this.forceFallbackHost&&Z.length){this.forceFallbackHost=!1,vt();return}this.tryATransport(w,this.baseTransport,lt)},Y.prototype.getUpgradePossibilities=function(){var w=this.activeProtocol.getTransport().shortName,B=O.arrIndexOf(this.upgradeTransports,w);return this.upgradeTransports.slice(B+1)},Y.prototype.upgradeIfNeeded=function(w){var B=this,H=this.getUpgradePossibilities();u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+L.default.Config.inspect(H)),H.length&&O.arrForEach(H,function(V){var Z=B.createTransportParams(w.host,"upgrade");B.tryATransport(Z,V,A)})},Y.prototype.closeImpl=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),O.safeArrForEach(this.pendingTransports,function(w){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+w),w&&w.close()}),O.safeArrForEach(this.proposedTransports,function(w){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+w),w&&w.dispose()}),this.activeProtocol&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Y.prototype.onAuthUpdated=function(w,B){var H=this,V;switch(this.state.state){case"connected":{if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var Z=this.activeProtocol.getTransport().params;L.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(Z)})}var lt=(V=this.activeProtocol)===null||V===void 0?void 0:V.getTransport();lt&&lt.onAuthUpdated&&lt.onAuthUpdated(w);var dt=E.default.fromValues({action:l.AUTH,auth:{accessToken:w.token}});this.send(dt);var vt=function(){H.off(mt),B(null,w)},mt=function(ct){ct.current==="failed"&&(H.off(vt),H.off(mt),B(ct.reason||H.getStateError()))};this.once("connectiondetails",vt),this.on("connectionstate",mt);break}case"connecting":u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var wt=function(ct){switch(ct.current){case"connected":H.off(wt),B(null,w);break;case"failed":case"closed":case"suspended":H.off(wt),B(ct.reason||H.getStateError());break;default:break}};this.on("connectionstate",wt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Y.prototype.disconnectAllTransports=function(w){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(w?" except the active transport":"")),this.connectCounter++,O.safeArrForEach(this.pendingTransports,function(B){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+B),B&&B.disconnect()}),this.pendingTransports=[],O.safeArrForEach(this.proposedTransports,function(B){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+B),B&&B.dispose()}),this.proposedTransports=[],this.activeProtocol&&!w&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Y.prototype.send=function(w,B,H){H=H||A;var V=this.state;if(V.sendEvents){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new S.PendingMessage(w,H));return}var Z=B&&V.queueEvents||V.forceQueueEvents;if(!Z){var lt="rejecting event, queueEvent was "+B+", state was "+V.state;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()",lt),H(this.errorReason||new T.default(lt,9e4,400));return}u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+E.default.stringify(w)),this.queue(w,H)},Y.prototype.sendImpl=function(w){var B=w.message;w.ackRequired&&!w.sendAttempted&&(B.msgSerial=this.msgSerial++);try{this.activeProtocol.send(w)}catch(H){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},Y.prototype.queue=function(w,B){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),V=this.options.maxMessageSize;H&&!H.sendAttempted&&F(H.message,w,V)?(H.merged||(H.callback=b.default.create([H.callback]),H.merged=!0),H.callback.push(B)):this.queuedMessages.push(new S.PendingMessage(w,B))},Y.prototype.sendQueuedMessages=function(){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var w;w=this.queuedMessages.shift();)this.sendImpl(w)},Y.prototype.queuePendingMessages=function(w){w&&w.length&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+w.length+" pending messages"),this.queuedMessages.prepend(w))},Y.prototype.failQueuedMessages=function(w){var B=this.queuedMessages.count();B>0&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+B+" queued messages, err = "+O.inspectError(w)),this.queuedMessages.completeAllMessages(w))},Y.prototype.onChannelMessage=function(w,B){var H=this.activeProtocol&&B===this.activeProtocol.getTransport(),V=O.arrIn(this.pendingTransports,B)&&this.state==this.states.synchronizing;H||V?this.realtime.channels.onChannelMessage(w):O.arrIndexOf([l.ACK,l.NACK,l.ERROR],w.action)>-1?this.realtime.channels.onChannelMessage(w):u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(w)+"on defunct transport; discarding")},Y.prototype.ping=function(w,B){var H=this;if(w){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+w);var V=function(){w.off("heartbeat",dt),B(new T.default("Timeout waiting for heartbeat response",5e4,500))},Z=O.now(),lt=O.cheapRandStr(),dt=function(Dt){if(Dt===lt){w.off("heartbeat",dt),clearTimeout(vt);var Yt=O.now()-Z;B(null,Yt)}},vt=setTimeout(V,this.options.timeouts.realtimeRequestTimeout);w.on("heartbeat",dt),w.ping(lt);return}if(this.state.state!=="connected"){B(new T.default("Unable to ping service; not connected",4e4,400));return}var mt=!1,wt=function(Dt,Yt){H.off("transport.active",ct),mt||(mt=!0,B(Dt,Yt))},ct=function(){mt||(mt=!0,L.default.Config.nextTick(function(){H.ping(null,B)}))};this.on("transport.active",ct),this.ping(this.activeProtocol.getTransport(),wt)},Y.prototype.abort=function(w){this.activeProtocol.getTransport().fail(w)},Y.prototype.registerProposedTransport=function(w){this.proposedTransports.push(w)},Y.prototype.getTransportPreference=function(){var w,B;return this.transportPreference||o()&&((B=(w=L.default.WebStorage)===null||w===void 0?void 0:w.get)===null||B===void 0?void 0:B.call(w,U))},Y.prototype.persistTransportPreference=function(w){var B,H;O.arrIn(_.default.upgradeTransports,w.shortName)&&(this.transportPreference=w.shortName,o()&&((H=(B=L.default.WebStorage)===null||B===void 0?void 0:B.set)===null||H===void 0||H.call(B,U,w.shortName)))},Y.prototype.unpersistTransportPreference=function(){var w,B;this.transportPreference=null,o()&&((B=(w=L.default.WebStorage)===null||w===void 0?void 0:w.remove)===null||B===void 0||B.call(w,U))},Y.prototype.actOnErrorFromAuthorize=function(w){if(w.code===40171)this.notifyState({state:"failed",error:w});else if(w.code===40102)this.notifyState({state:"failed",error:w});else if(w.statusCode===i.default.Forbidden){var B="Client configured authentication provider returned 403; failing the connection";u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",B),this.notifyState({state:"failed",error:new T.default(B,80019,403,w)})}else{var B="Client configured authentication provider request failed";u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",B),this.notifyState({state:this.state.failState,error:new T.default(B,80019,401,w)})}},Y.prototype.onConnectionDetailsUpdate=function(w,B){if(!!w){this.connectionDetails=w,w.maxMessageSize&&(this.options.maxMessageSize=w.maxMessageSize);var H=w.clientId;if(H){var V=this.realtime.auth._uncheckedSetClientId(H);if(V){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",V.message),B.fail(V);return}}var Z=w.connectionStateTtl;Z&&(this.connectionStateTtl=Z),this.maxIdleInterval=w.maxIdleInterval,this.emit("connectiondetails",w)}},Y.supportedTransports={},Y}(y.default);f.default=X}).call(this,r(13))},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(7)),E=c.__importDefault(r(2)),O=function(S){c.__extends(_,S);function _(){var L=S.call(this)||this;return L.messages=[],L}return _.prototype.count=function(){return this.messages.length},_.prototype.push=function(L){this.messages.push(L)},_.prototype.shift=function(){return this.messages.shift()},_.prototype.last=function(){return this.messages[this.messages.length-1]},_.prototype.copyAll=function(){return this.messages.slice()},_.prototype.append=function(L){this.messages.push.apply(this.messages,L)},_.prototype.prepend=function(L){this.messages.unshift.apply(this.messages,L)},_.prototype.completeMessages=function(L,y,I){E.default.logAction(E.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+L+"; count = "+y),I=I||null;var u=this.messages;if(u.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var C=u[0];if(C){var x=C.message.msgSerial,T=L+y;if(T>x)for(var m=u.splice(0,T-x),g=0,b=m;g<b.length;g++){var a=b[g];a.callback(I)}u.length==0&&this.emit("idle")}},_.prototype.completeAllMessages=function(L){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,L)},_.prototype.resetSendAttempted=function(){for(var L=0,y=this.messages;L<y.length;L++){var I=y[L];I.sendAttempted=!1}},_.prototype.clear=function(){E.default.logAction(E.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},_}(s.default);f.default=O},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=function(){function s(E,O,S,_){this.previous=E,this.current=O,S&&(this.retryIn=S),_&&(this.reason=_)}return s}();f.default=c},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(10)),E=c.__importDefault(r(7)),O=c.__importStar(r(1)),S=c.__importDefault(r(33)),_=c.__importDefault(r(2)),L=c.__importDefault(r(54)),y=c.__importDefault(r(9)),I=c.__importDefault(r(39)),u=c.__importStar(r(4)),C=c.__importDefault(r(15)),x=c.__importDefault(r(20)),T=s.default.Action,m=function(){};function g(a){if(a&&"params"in a&&!O.isObject(a.params))return new u.default("options.params must be an object",4e4,400);if(a&&"modes"in a){if(!O.isArray(a.modes))return new u.default("options.modes must be an array",4e4,400);for(var h=0;h<a.modes.length;h++){var i=a.modes[h];if(!i||typeof i!="string"||!O.arrIn(s.default.channelModes,String.prototype.toUpperCase.call(i)))return new u.default("Invalid channel mode: "+i,4e4,400)}}}var b=function(a){c.__extends(h,a);function h(i,o,v){var l=a.call(this,i,o,v)||this;return l.retryCount=0,l.history=function(A,U){if(_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),U===void 0)if(typeof A=="function")U=A,A=null;else{if(this.rest.options.promises)return O.promisify(this,"history",arguments);U=m}if(A&&A.untilAttach){if(this.state!=="attached"){U(new u.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){U(new u.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete A.untilAttach,A.from_serial=this.properties.attachSerial}S.default.prototype._history.call(this,A,U)},l.whenState=function(A,U){return E.default.prototype.whenState.call(l,A,l.state,U)},_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel()","started; name = "+o),l.realtime=i,l.presence=new L.default(l),l.connectionManager=i.connection.connectionManager,l.state="initialized",l.subscriptions=new E.default,l.syncChannelSerial=void 0,l.properties={attachSerial:void 0,channelSerial:void 0},l.setOptions(v),l.errorReason=null,l._requestedFlags=null,l._mode=null,l._attachResume=!1,l._decodingContext={channelOptions:l.channelOptions,plugins:i.options.plugins||{},baseEncodedPreviousPayload:void 0},l._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},l._allChannelChanges=new E.default,l}return h.prototype.invalidStateError=function(){return new u.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},h.processListenerArgs=function(i){return i=Array.prototype.slice.call(i),typeof i[0]=="function"&&i.unshift(null),i[i.length-1]==null&&i.pop(),i},h.prototype.setOptions=function(i,o){if(!o&&this.rest.options.promises)return O.promisify(this,"setOptions",arguments);var v=o||function(A){A&&_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+A.toString())},l=g(i);if(l){v(l);return}S.default.prototype.setOptions.call(this,i),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(i)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(A){switch(this.event){case"update":case"attached":v==null||v(null);return;default:v==null||v(A.reason);return}})):v()},h.prototype._shouldReattachToSetOptions=function(i){return(this.state==="attached"||this.state==="attaching")&&((i==null?void 0:i.params)||(i==null?void 0:i.modes))},h.prototype.publish=function(){for(var i=this,o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];var l=o[0],A=o.length,U=o[A-1];if(typeof U!="function"){if(this.realtime.options.promises)return O.promisify(this,"publish",arguments);U=m,++A}if(!this.connectionManager.activeState()){U(this.connectionManager.getError());return}if(A==2)if(O.isObject(l))l=[y.default.fromValues(l)];else if(O.isArray(l))l=y.default.fromValuesArray(l);else throw new u.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else l=[y.default.fromValues({name:o[0],data:o[1]})];var k=this.realtime.options.maxMessageSize;y.default.encodeArray(l,this.channelOptions,function(j){if(j){U(j);return}var N=y.default.getMessagesSize(l);if(N>k){U(new u.default("Maximum size of messages that can be published at once exceeded ( was "+N+" bytes; limit is "+k+" bytes)",40009,400));return}i.__publish(l,U)})},h.prototype.__publish=function(i,o){_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+i.length);var v=this.state;switch(v){case"failed":case"suspended":o(u.default.fromValues(this.invalidStateError()));break;default:{_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+v);var l=new s.default;l.action=T.MESSAGE,l.channel=this.name,l.messages=i,this.sendMessage(l,o);break}}},h.prototype.onEvent=function(i){_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var o=this.subscriptions,v=0;v<i.length;v++){var l=i[v];o.emit(l.name,l)}},h.prototype.attach=function(i,o){var v;if(typeof i=="function"?(o=i,v=null):v=i,!o){if(this.realtime.options.promises)return O.promisify(this,"attach",arguments);o=function(l){l&&_.default.logAction(_.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+l.toString())}}if(v)_.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=v;else if(this.state==="attached"){o(null,null);return}this._attach(!1,null,o)},h.prototype._attach=function(i,o,v){v||(v=function(A){A&&_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+A.toString())});var l=this.connectionManager;if(!l.activeState()){v(l.getError());return}(this.state!=="attaching"||i)&&this.requestState("attaching",o),this.once(function(A){switch(this.event){case"attached":v==null||v(null,A);break;case"detached":case"suspended":case"failed":v==null||v(A.reason||l.getError()||new u.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":v==null||v(new u.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},h.prototype.attachImpl=function(){_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var i=s.default.fromValues({action:T.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?i.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&i.encodeModesToFlags(O.allToUpperCase(this.channelOptions.modes)),this._attachResume&&i.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(i.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(i,m)},h.prototype.detach=function(i){if(!i){if(this.realtime.options.promises)return O.promisify(this,"detach",arguments);i=m}var o=this.connectionManager;if(!o.activeState()){i(o.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),i();break;case"detached":i();break;case"failed":i(new u.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(v){switch(this.event){case"detached":i();break;case"attached":case"suspended":case"failed":i(v.reason||o.getError()||new u.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":i(new u.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},h.prototype.detachImpl=function(i){_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var o=s.default.fromValues({action:T.DETACH,channel:this.name});this.sendMessage(o,i||m)},h.prototype.subscribe=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var v=h.processListenerArgs(i),l=v[0],A=v[1],U=v[2];if(!U&&this.realtime.options.promises)return O.promisify(this,"subscribe",[l,A]);if(this.state==="failed"){U==null||U(u.default.fromValues(this.invalidStateError()));return}return l&&typeof l=="object"&&!Array.isArray(l)?this._subscribeFilter(l,A):this.subscriptions.on(l,A),this.attach(U||m)},h.prototype._subscribeFilter=function(i,o){var v=function(l){var A,U,k,j,N,P,M={name:l.name,refTimeserial:(U=(A=l.extras)===null||A===void 0?void 0:A.ref)===null||U===void 0?void 0:U.timeserial,refType:(j=(k=l.extras)===null||k===void 0?void 0:k.ref)===null||j===void 0?void 0:j.type,isRef:!!(!((P=(N=l.extras)===null||N===void 0?void 0:N.ref)===null||P===void 0)&&P.timeserial),clientId:l.clientId};Object.entries(i).find(function(F){var W=F[0],K=F[1];return K!==void 0?M[W]!==K:!1})||o(l)};this._addFilteredSubscription(i,o,v),this.subscriptions.on(v)},h.prototype._addFilteredSubscription=function(i,o,v){var l;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(o)){var A=this.filteredSubscriptions.get(o);A.set(i,((l=A==null?void 0:A.get(i))===null||l===void 0?void 0:l.concat(v))||[v])}else this.filteredSubscriptions.set(o,new Map([[i,[v]]]))},h.prototype._getAndDeleteFilteredSubscriptions=function(i,o){var v=this;if(!this.filteredSubscriptions)return[];if(!o&&i)return Array.from(this.filteredSubscriptions.entries()).map(function(k){var j,N=k[0],P=k[1],M=P.get(i);return P.delete(i),P.size===0&&((j=v.filteredSubscriptions)===null||j===void 0||j.delete(N)),M}).reduce(function(k,j){var N;return j?(N=k).concat.apply(N,j):k},[]);if(!o||!this.filteredSubscriptions.has(o))return[];var l=this.filteredSubscriptions.get(o);if(!i){var A=Array.from(l.values()).reduce(function(k,j){return k.concat.apply(k,j)},[]);return this.filteredSubscriptions.delete(o),A}var U=l.get(i);return l.delete(i),U||[]},h.prototype.unsubscribe=function(){for(var i=this,o,v=[],l=0;l<arguments.length;l++)v[l]=arguments[l];var A=h.processListenerArgs(v),U=A[0],k=A[1];if(typeof U=="object"&&!k||((o=this.filteredSubscriptions)===null||o===void 0?void 0:o.has(k))){this._getAndDeleteFilteredSubscriptions(U,k).forEach(function(j){return i.subscriptions.off(j)});return}this.subscriptions.off(U,k)},h.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new u.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var i=this.connectionManager;if(!i.activeState())throw i.getError();var o=s.default.fromValues({action:T.SYNC,channel:this.name});this.syncChannelSerial&&(o.channelSerial=this.syncChannelSerial),i.send(o)},h.prototype.sendMessage=function(i,o){this.connectionManager.send(i,this.realtime.options.queueMessages,o)},h.prototype.sendPresence=function(i,o){var v=s.default.fromValues({action:T.PRESENCE,channel:this.name,presence:O.isArray(i)?C.default.fromValuesArray(i):[C.default.fromValues(i)]});this.sendMessage(v,o)},h.prototype.onMessage=function(i){(i.action===T.ATTACHED||i.action===T.MESSAGE||i.action===T.PRESENCE)&&this.setChannelSerial(i.channelSerial);var o,v=!1;switch(i.action){case T.ATTACHED:{this.properties.attachSerial=i.channelSerial,this._mode=i.getMode(),this.params=i.params||{};var l=i.decodeModesFromFlags();this.modes=l&&O.allToLowerCase(l)||void 0;var A=i.hasFlag("RESUMED"),U=i.hasFlag("HAS_PRESENCE"),k=i.hasFlag("HAS_BACKLOG");if(this.state==="attached"){A||this.presence.onAttached(U);var j=new I.default(this.state,this.state,A,k,i.error);this._allChannelChanges.emit("update",j),(!A||this.channelOptions.updateOnAttached)&&this.emit("update",j)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",i.error,A,U,k);break}case T.DETACHED:{var N=i.error?u.default.fromValues(i.error):new u.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",N):this.state==="attaching"?this.notifyState("suspended",N):this.requestState("attaching",N);break}case T.SYNC:if(v=!0,o=this.syncChannelSerial=i.channelSerial,!i.presence)break;case T.PRESENCE:{for(var P=i.presence,M=i.id,F=i.connectionId,W=i.timestamp,K=this.channelOptions,X=void 0,et=0;et<P.length;et++)try{X=P[et],C.default.decode(X,K),X.connectionId||(X.connectionId=F),X.timestamp||(X.timestamp=W),X.id||(X.id=M+":"+et)}catch(Z){_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel.onMessage()",Z.toString())}this.presence.setPresence(P,v,o);break}case T.MESSAGE:{if(this.state!=="attached"){_.default.logAction(_.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+i.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var Y=i.messages,w=Y[0],B=Y[Y.length-1],M=i.id,F=i.connectionId,W=i.timestamp;if(w.extras&&w.extras.delta&&w.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+i.id+'" on this channel "'+this.name+'".';_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new u.default(H,40018,400));break}for(var et=0;et<Y.length;et++){var H=Y[et];try{y.default.decode(H,this._decodingContext)}catch(wt){switch(_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel.onMessage()",wt.toString()),wt.code){case 40018:this._startDecodeFailureRecovery(wt);return;case 40019:case 40021:this.notifyState("failed",wt);return}}H.connectionId||(H.connectionId=F),H.timestamp||(H.timestamp=W),H.id||(H.id=M+":"+et)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=i.channelSerial,this.onEvent(Y);break}case T.ERROR:{var V=i.error;V&&V.code==80016?this.checkPendingState():this.notifyState("failed",u.default.fromValues(V));break}default:_.default.logAction(_.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+i.action+")"),this.connectionManager.abort(x.default.unknownChannelErr())}},h.prototype._startDecodeFailureRecovery=function(i){var o=this;this._lastPayload.decodeFailureRecoveryInProgress||(_.default.logAction(_.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,i,function(){o._lastPayload.decodeFailureRecoveryInProgress=!1}))},h.prototype.onAttached=function(){_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},h.prototype.notifyState=function(i,o,v,l,A){if(_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+i),this.clearStateTimer(),O.arrIn(["detached","suspended","failed"],i)&&(this.properties.channelSerial=null),i!==this.state){this.presence.actOnChannelState(i,l,o),i==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),o&&(this.errorReason=o);var U=new I.default(this.state,i,v,A,o),k=i==="failed"?_.default.LOG_ERROR:_.default.LOG_MAJOR;_.default.logAction(k,'Channel state for channel "'+this.name+'"',i+(o?"; reason: "+o:"")),i!=="attaching"&&i!=="suspended"&&(this.retryCount=0),i==="attached"&&this.onAttached(),i==="attached"?this._attachResume=!0:(i==="detaching"||i==="failed")&&(this._attachResume=!1),this.state=i,this._allChannelChanges.emit(i,U),this.emit(i,U)}},h.prototype.requestState=function(i,o){_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+i),this.notifyState(i,o),this.checkPendingState()},h.prototype.checkPendingState=function(){var i=this.connectionManager.state;if(!(i.sendEvents||i.forceQueueEvents)){_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},h.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var i=new u.default("Channel attach timed out",90007,408);this.notifyState("suspended",i);break}case"detaching":{var i=new u.default("Channel detach timed out",90007,408);this.notifyState("attached",i);break}default:this.checkPendingState();break}},h.prototype.startStateTimerIfNotRunning=function(){var i=this;this.stateTimer||(this.stateTimer=setTimeout(function(){_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),i.stateTimer=null,i.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},h.prototype.clearStateTimer=function(){var i=this.stateTimer;i&&(clearTimeout(i),this.stateTimer=null)},h.prototype.startRetryTimer=function(){var i=this;if(!this.retryTimer){this.retryCount++;var o=O.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){i.state==="suspended"&&i.connectionManager.state.sendEvents&&(i.retryTimer=null,_.default.logAction(_.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),i.requestState("attaching"))},o)}},h.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},h.prototype.getReleaseErr=function(){var i=this.state;return i==="initialized"||i==="detached"||i==="failed"?null:new u.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+i,90001,400)},h.prototype.setChannelSerial=function(i){_.default.logAction(_.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+i+"; previous = "+this.properties.channelSerial),i&&(this.properties.channelSerial=i)},h}(S.default);f.default=b},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=function(){function s(E,O,S,_,L){this.previous=E,this.current=O,O==="attached"&&(this.resumed=S,this.hasBacklog=_),L&&(this.reason=L)}return s}();f.default=c},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(){var s=c,E=s.lib,O=E.WordArray,S=E.Hasher,_=s.algo,L=[],y=_.SHA1=S.extend({_doReset:function(){this._hash=new O.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,u){for(var C=this._hash.words,x=C[0],T=C[1],m=C[2],g=C[3],b=C[4],a=0;a<80;a++){if(a<16)L[a]=I[u+a]|0;else{var h=L[a-3]^L[a-8]^L[a-14]^L[a-16];L[a]=h<<1|h>>>31}var i=(x<<5|x>>>27)+b+L[a];a<20?i+=(T&m|~T&g)+1518500249:a<40?i+=(T^m^g)+1859775393:a<60?i+=(T&m|T&g|m&g)-1894007588:i+=(T^m^g)-899497514,b=g,g=m,m=T<<30|T>>>2,T=x,x=i}C[0]=C[0]+x|0,C[1]=C[1]+T|0,C[2]=C[2]+m|0,C[3]=C[3]+g|0,C[4]=C[4]+b|0},_doFinalize:function(){var I=this._data,u=I.words,C=this._nDataBytes*8,x=I.sigBytes*8;return u[x>>>5]|=128<<24-x%32,u[(x+64>>>9<<4)+14]=Math.floor(C/4294967296),u[(x+64>>>9<<4)+15]=C,I.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var I=S.clone.call(this);return I._hash=this._hash.clone(),I}});s.SHA1=S._createHelper(y),s.HmacSHA1=S._createHmacHelper(y)}(),c.SHA1})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});function c(a){if(a===void 0)return"undefined";var h,i;if(a instanceof ArrayBuffer?(i="ArrayBuffer",h=new DataView(a)):a instanceof DataView&&(i="DataView",h=a),!h)return JSON.stringify(a);for(var o=[],v=0;v<a.byteLength;v++){if(v>20){o.push("...");break}var l=h.getUint8(v).toString(16);l.length===1&&(l="0"+l),o.push(l)}return"<"+i+" "+o.join(" ")+">"}function s(a,h,i){for(var o=0,v=i.length;o<v;o++){var l=i.charCodeAt(o);if(l<128){a.setUint8(h++,l>>>0&127|0);continue}if(l<2048){a.setUint8(h++,l>>>6&31|192),a.setUint8(h++,l>>>0&63|128);continue}if(l<65536){a.setUint8(h++,l>>>12&15|224),a.setUint8(h++,l>>>6&63|128),a.setUint8(h++,l>>>0&63|128);continue}if(l<1114112){a.setUint8(h++,l>>>18&7|240),a.setUint8(h++,l>>>12&63|128),a.setUint8(h++,l>>>6&63|128),a.setUint8(h++,l>>>0&63|128);continue}throw new Error("bad codepoint "+l)}}function E(a,h,i){for(var o="",v=h,l=h+i;v<l;v++){var A=a.getUint8(v);if((A&128)===0){o+=String.fromCharCode(A);continue}if((A&224)===192){o+=String.fromCharCode((A&15)<<6|a.getUint8(++v)&63);continue}if((A&240)===224){o+=String.fromCharCode((A&15)<<12|(a.getUint8(++v)&63)<<6|(a.getUint8(++v)&63)<<0);continue}if((A&248)===240){o+=String.fromCharCode((A&7)<<18|(a.getUint8(++v)&63)<<12|(a.getUint8(++v)&63)<<6|(a.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+A.toString(16))}return o}function O(a){for(var h=0,i=0,o=a.length;i<o;i++){var v=a.charCodeAt(i);if(v<128){h+=1;continue}if(v<2048){h+=2;continue}if(v<65536){h+=3;continue}if(v<1114112){h+=4;continue}throw new Error("bad codepoint "+v)}return h}function S(a,h){var i=b(a,h);if(i!==0){var o=new ArrayBuffer(i),v=new DataView(o);return g(a,v,0,h),o}}var _=(1<<16)*(1<<16),L=1/_;function y(a,h){return h=h||0,a.getInt32(h)*_+a.getUint32(h+4)}function I(a,h){return h=h||0,a.getUint32(h)*_+a.getUint32(h+4)}function u(a,h,i){i<9223372036854776e3?(a.setInt32(h,Math.floor(i*L)),a.setInt32(h+4,i&-1)):(a.setUint32(h,2147483647),a.setUint32(h+4,2147483647))}function C(a,h,i){i<18446744073709552e3?(a.setUint32(h,Math.floor(i*L)),a.setInt32(h+4,i&-1)):(a.setUint32(h,4294967295),a.setUint32(h+4,4294967295))}var x=function(){function a(h,i){var o=this;this.map=function(v){for(var l={},A=0;A<v;A++){var U=o.parse();l[U]=o.parse()}return l},this.bin=function(v){var l=new ArrayBuffer(v);return new Uint8Array(l).set(new Uint8Array(o.view.buffer,o.offset,v),0),o.offset+=v,l},this.buf=this.bin,this.str=function(v){var l=E(o.view,o.offset,v);return o.offset+=v,l},this.array=function(v){for(var l=new Array(v),A=0;A<v;A++)l[A]=o.parse();return l},this.ext=function(v){return o.offset+=v,{type:o.view.getInt8(o.offset),data:o.buf(v)}},this.parse=function(){var v=o.view.getUint8(o.offset),l,A;if((v&128)===0)return o.offset++,v;if((v&240)===128)return A=v&15,o.offset++,o.map(A);if((v&240)===144)return A=v&15,o.offset++,o.array(A);if((v&224)===160)return A=v&31,o.offset++,o.str(A);if((v&224)===224)return l=o.view.getInt8(o.offset),o.offset++,l;switch(v){case 192:return o.offset++,null;case 193:o.offset++;return;case 194:return o.offset++,!1;case 195:return o.offset++,!0;case 196:return A=o.view.getUint8(o.offset+1),o.offset+=2,o.bin(A);case 197:return A=o.view.getUint16(o.offset+1),o.offset+=3,o.bin(A);case 198:return A=o.view.getUint32(o.offset+1),o.offset+=5,o.bin(A);case 199:return A=o.view.getUint8(o.offset+1),o.offset+=2,o.ext(A);case 200:return A=o.view.getUint16(o.offset+1),o.offset+=3,o.ext(A);case 201:return A=o.view.getUint32(o.offset+1),o.offset+=5,o.ext(A);case 202:return l=o.view.getFloat32(o.offset+1),o.offset+=5,l;case 203:return l=o.view.getFloat64(o.offset+1),o.offset+=9,l;case 204:return l=o.view.getUint8(o.offset+1),o.offset+=2,l;case 205:return l=o.view.getUint16(o.offset+1),o.offset+=3,l;case 206:return l=o.view.getUint32(o.offset+1),o.offset+=5,l;case 207:return l=I(o.view,o.offset+1),o.offset+=9,l;case 208:return l=o.view.getInt8(o.offset+1),o.offset+=2,l;case 209:return l=o.view.getInt16(o.offset+1),o.offset+=3,l;case 210:return l=o.view.getInt32(o.offset+1),o.offset+=5,l;case 211:return l=y(o.view,o.offset+1),o.offset+=9,l;case 212:return A=1,o.offset++,o.ext(A);case 213:return A=2,o.offset++,o.ext(A);case 214:return A=4,o.offset++,o.ext(A);case 215:return A=8,o.offset++,o.ext(A);case 216:return A=16,o.offset++,o.ext(A);case 217:return A=o.view.getUint8(o.offset+1),o.offset+=2,o.str(A);case 218:return A=o.view.getUint16(o.offset+1),o.offset+=3,o.str(A);case 219:return A=o.view.getUint32(o.offset+1),o.offset+=5,o.str(A);case 220:return A=o.view.getUint16(o.offset+1),o.offset+=3,o.array(A);case 221:return A=o.view.getUint32(o.offset+1),o.offset+=5,o.array(A);case 222:return A=o.view.getUint16(o.offset+1),o.offset+=3,o.map(A);case 223:return A=o.view.getUint32(o.offset+1),o.offset+=5,o.map(A)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=i||0,this.view=h}return a}();function T(a){var h=new DataView(a),i=new x(h),o=i.parse();if(i.offset!==a.byteLength)throw new Error(a.byteLength-i.offset+" trailing bytes");return o}function m(a,h){return Object.keys(a).filter(function(i){var o=a[i],v=typeof o;return(!h||o!=null)&&(v!=="function"||!!o.toJSON)})}function g(a,h,i,o){var v=typeof a;if(typeof a=="string"){var l=O(a);if(l<32)return h.setUint8(i,l|160),s(h,i+1,a),1+l;if(l<256)return h.setUint8(i,217),h.setUint8(i+1,l),s(h,i+2,a),2+l;if(l<65536)return h.setUint8(i,218),h.setUint16(i+1,l),s(h,i+3,a),3+l;if(l<4294967296)return h.setUint8(i,219),h.setUint32(i+1,l),s(h,i+5,a),5+l}if(ArrayBuffer.isView&&ArrayBuffer.isView(a)&&(a=a.buffer),a instanceof ArrayBuffer){var A=a.byteLength;if(A<256)return h.setUint8(i,196),h.setUint8(i+1,A),new Uint8Array(h.buffer).set(new Uint8Array(a),i+2),2+A;if(A<65536)return h.setUint8(i,197),h.setUint16(i+1,A),new Uint8Array(h.buffer).set(new Uint8Array(a),i+3),3+A;if(A<4294967296)return h.setUint8(i,198),h.setUint32(i+1,A),new Uint8Array(h.buffer).set(new Uint8Array(a),i+5),5+A}if(typeof a=="number"){if(Math.floor(a)!==a)return h.setUint8(i,203),h.setFloat64(i+1,a),9;if(a>=0){if(a<128)return h.setUint8(i,a),1;if(a<256)return h.setUint8(i,204),h.setUint8(i+1,a),2;if(a<65536)return h.setUint8(i,205),h.setUint16(i+1,a),3;if(a<4294967296)return h.setUint8(i,206),h.setUint32(i+1,a),5;if(a<18446744073709552e3)return h.setUint8(i,207),C(h,i+1,a),9;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return h.setInt8(i,a),1;if(a>=-128)return h.setUint8(i,208),h.setInt8(i+1,a),2;if(a>=-32768)return h.setUint8(i,209),h.setInt16(i+1,a),3;if(a>=-2147483648)return h.setUint8(i,210),h.setInt32(i+1,a),5;if(a>=-9223372036854776e3)return h.setUint8(i,211),u(h,i+1,a),9;throw new Error("Number too small -0x"+(-a).toString(16).substr(1))}if(v==="undefined")return o?0:(h.setUint8(i,212),h.setUint8(i+1,0),h.setUint8(i+2,0),3);if(a===null)return o?0:(h.setUint8(i,192),1);if(v==="boolean")return h.setUint8(i,a?195:194),1;if(typeof a.toJSON=="function")return g(a.toJSON(),h,i,o);if(v==="object"){var U,k=0,j=void 0,N=Array.isArray(a);if(N?U=a.length:(j=m(a,o),U=j.length),U<16?(h.setUint8(i,U|(N?144:128)),k=1):U<65536?(h.setUint8(i,N?220:222),h.setUint16(i+1,U),k=3):U<4294967296&&(h.setUint8(i,N?221:223),h.setUint32(i+1,U),k=5),N)for(var P=0;P<U;P++)k+=g(a[P],h,i+k,o);else if(j)for(var P=0;P<U;P++){var M=j[P];k+=g(M,h,i+k),k+=g(a[M],h,i+k,o)}return k}if(v==="function")return 0;throw new Error("Unknown type "+v)}function b(a,h){var i=typeof a;if(i==="string"){var o=O(a);if(o<32)return 1+o;if(o<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if(ArrayBuffer.isView&&ArrayBuffer.isView(a)&&(a=a.buffer),a instanceof ArrayBuffer){var v=a.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof a=="number"){if(Math.floor(a)!==a)return 9;if(a>=0){if(a<128)return 1;if(a<256)return 2;if(a<65536)return 3;if(a<4294967296)return 5;if(a<18446744073709552e3)return 9;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return 1;if(a>=-128)return 2;if(a>=-32768)return 3;if(a>=-2147483648)return 5;if(a>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+a.toString(16).substr(1))}if(i==="boolean")return 1;if(a===null)return h?0:1;if(a===void 0)return h?0:3;if(typeof a.toJSON=="function")return b(a.toJSON(),h);if(i==="object"){var l,A=0;if(Array.isArray(a)){l=a.length;for(var U=0;U<l;U++)A+=b(a[U],h)}else{var k=m(a,h);l=k.length;for(var U=0;U<l;U++){var j=k[U];A+=b(j)+b(a[j],h)}}if(l<16)return 1+A;if(l<65536)return 3+A;if(l<4294967296)return 5+A;throw new Error("Array or object too long 0x"+l.toString(16))}if(i==="function")return 0;throw new Error("Unknown type "+i)}f.default={encode:S,decode:T,inspect:c,utf8Write:s,utf8Read:E,utf8ByteCount:O}},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(30)),E=c.__importDefault(r(50)),O=c.__importDefault(r(3)),S=c.__importDefault(r(4)),_=c.__importDefault(r(55)),L=c.__importDefault(r(57)),y=c.__importDefault(r(62)),I=c.__importDefault(r(64)),u=c.__importDefault(r(68)),C=c.__importDefault(r(2)),x=r(8),T=c.__importDefault(r(65)),m=c.__importDefault(r(66)),g=c.__importDefault(r(41)),b=(0,L.default)(I.default,_.default);O.default.Crypto=b,O.default.BufferUtils=_.default,O.default.Http=y.default,O.default.Config=I.default,O.default.Transports=u.default,O.default.WebStorage=T.default,s.default.Crypto=b,E.default.Crypto=b,C.default.initLogHandlers(),O.default.Defaults=(0,x.getDefaults)(m.default),O.default.Config.agent&&(O.default.Defaults.agent+=" "+O.default.Config.agent),O.default.Config.noUpgrade&&(O.default.Defaults.upgradeTransports=[]),f.default={ErrorInfo:S.default,Rest:s.default,Realtime:E.default,msgpack:g.default}},function(p){p.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(p,f){},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(32),r(24))})(this,function(c){return c.HmacSHA256})},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(47)),O=c.__importDefault(r(14)),S=c.__importDefault(r(19)),_=c.__importDefault(r(4)),L=c.__importDefault(r(48)),y=function(){},I=function(){function T(m){this.rest=m,this.admin=new u(m)}return T}(),u=function(){function T(m){this.rest=m,this.deviceRegistrations=new C(m),this.channelSubscriptions=new x(m)}return T.prototype.publish=function(m,g,b){var a=this.rest,h=a.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,i=s.defaultPostHeaders(a.options,h),o={},v=s.mixin({recipient:m},g);if(typeof b!="function"){if(this.rest.options.promises)return s.promisify(this,"publish",arguments);b=y}a.options.headers&&s.mixin(i,a.options.headers),a.options.pushFullWait&&s.mixin(o,{fullWait:"true"});var l=s.encodeBody(v,h);O.default.post(a,"/push/publish",l,i,o,null,function(A){return b(A)})},T}(),C=function(){function T(m){this.rest=m}return T.prototype.save=function(m,g){var b=this.rest,a=E.default.fromValues(m),h=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,i=s.defaultPostHeaders(b.options,h),o={};if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"save",arguments);g=y}b.options.headers&&s.mixin(i,b.options.headers),b.options.pushFullWait&&s.mixin(o,{fullWait:"true"});var v=s.encodeBody(a,h);O.default.put(b,"/push/deviceRegistrations/"+encodeURIComponent(m.id),v,i,o,null,function(l,A,U,k){g(l,l?void 0:E.default.fromResponseBody(A,k?void 0:h))})},T.prototype.get=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=s.defaultGetHeaders(b.options,a),i=m.id||m;if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"get",arguments);g=y}if(typeof i!="string"||!i.length){g(new _.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}b.options.headers&&s.mixin(h,b.options.headers),O.default.get(b,"/push/deviceRegistrations/"+encodeURIComponent(i),h,{},null,function(o,v,l,A){g(o,o?void 0:E.default.fromResponseBody(v,A?void 0:a))})},T.prototype.list=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:a,i=s.defaultGetHeaders(b.options,a);if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"list",arguments);g=y}b.options.headers&&s.mixin(i,b.options.headers),new S.default(b,"/push/deviceRegistrations",i,h,function(o,v,l){return E.default.fromResponseBody(o,l?void 0:a)}).get(m,g)},T.prototype.remove=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=s.defaultGetHeaders(b.options,a),i={},o=m.id||m;if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"remove",arguments);g=y}if(typeof o!="string"||!o.length){g(new _.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}b.options.headers&&s.mixin(h,b.options.headers),b.options.pushFullWait&&s.mixin(i,{fullWait:"true"}),O.default.delete(b,"/push/deviceRegistrations/"+encodeURIComponent(o),h,i,null,function(v){return g(v)})},T.prototype.removeWhere=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=s.defaultGetHeaders(b.options,a);if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"removeWhere",arguments);g=y}b.options.headers&&s.mixin(h,b.options.headers),b.options.pushFullWait&&s.mixin(m,{fullWait:"true"}),O.default.delete(b,"/push/deviceRegistrations",h,m,null,function(i){return g(i)})},T}(),x=function(){function T(m){this.remove=T.prototype.removeWhere,this.rest=m}return T.prototype.save=function(m,g){var b=this.rest,a=L.default.fromValues(m),h=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,i=s.defaultPostHeaders(b.options,h),o={};if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"save",arguments);g=y}b.options.headers&&s.mixin(i,b.options.headers),b.options.pushFullWait&&s.mixin(o,{fullWait:"true"});var v=s.encodeBody(a,h);O.default.post(b,"/push/channelSubscriptions",v,i,o,null,function(l,A,U,k){g(l,!l&&L.default.fromResponseBody(A,k?void 0:h))})},T.prototype.list=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:a,i=s.defaultGetHeaders(b.options,a);if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"list",arguments);g=y}b.options.headers&&s.mixin(i,b.options.headers),new S.default(b,"/push/channelSubscriptions",i,h,function(o,v,l){return L.default.fromResponseBody(o,l?void 0:a)}).get(m,g)},T.prototype.removeWhere=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=s.defaultGetHeaders(b.options,a);if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"removeWhere",arguments);g=y}b.options.headers&&s.mixin(h,b.options.headers),b.options.pushFullWait&&s.mixin(m,{fullWait:"true"}),O.default.delete(b,"/push/channelSubscriptions",h,m,null,function(i){return g(i)})},T.prototype.listChannels=function(m,g){var b=this.rest,a=b.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:a,i=s.defaultGetHeaders(b.options,a);if(typeof g!="function"){if(this.rest.options.promises)return s.promisify(this,"listChannels",arguments);g=y}b.options.headers&&s.mixin(i,b.options.headers),b.options.pushFullWait&&s.mixin(m,{fullWait:"true"}),new S.default(b,"/push/channels",i,h,function(o,v,l){for(var A=!l&&a?s.decodeBody(o,a):o,U=0;U<A.length;U++)A[U]=String(A[U]);return A}).get(m,g)},T}();f.default=I},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(4)),O;(function(L){L.Phone="phone",L.Tablet="tablet",L.Desktop="desktop",L.TV="tv",L.Watch="watch",L.Car="car",L.Embedded="embedded",L.Other="other"})(O||(O={}));var S;(function(L){L.Android="android",L.IOS="ios",L.Browser="browser"})(S||(S={}));var _=function(){function L(){}return L.prototype.toJSON=function(){var y,I,u;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(y=this.push)===null||y===void 0?void 0:y.recipient,state:(I=this.push)===null||I===void 0?void 0:I.state,error:(u=this.push)===null||u===void 0?void 0:u.error}}},L.prototype.toString=function(){var y,I,u,C,x="[DeviceDetails";return this.id&&(x+="; id="+this.id),this.platform&&(x+="; platform="+this.platform),this.formFactor&&(x+="; formFactor="+this.formFactor),this.clientId&&(x+="; clientId="+this.clientId),this.metadata&&(x+="; metadata="+this.metadata),this.deviceIdentityToken&&(x+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((y=this.push)===null||y===void 0)&&y.recipient&&(x+="; push.recipient="+JSON.stringify(this.push.recipient)),!((I=this.push)===null||I===void 0)&&I.state&&(x+="; push.state="+this.push.state),!((u=this.push)===null||u===void 0)&&u.error&&(x+="; push.error="+JSON.stringify(this.push.error)),!((C=this.push)===null||C===void 0)&&C.metadata&&(x+="; push.metadata="+this.push.metadata),x+="]",x},L.fromResponseBody=function(y,I){return I&&(y=s.decodeBody(y,I)),s.isArray(y)?L.fromValuesArray(y):L.fromValues(y)},L.fromValues=function(y){return y.error=y.error&&E.default.fromValues(y.error),Object.assign(new L,y)},L.fromValuesArray=function(y){for(var I=y.length,u=new Array(I),C=0;C<I;C++)u[C]=L.fromValues(y[C]);return u},L.toRequestBody=s.encodeBody,L}();f.default=_},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=function(){function O(){}return O.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},O.prototype.toString=function(){var S="[PushChannelSubscription";return this.channel&&(S+="; channel="+this.channel),this.deviceId&&(S+="; deviceId="+this.deviceId),this.clientId&&(S+="; clientId="+this.clientId),S+="]",S},O.fromResponseBody=function(S,_){return _&&(S=s.decodeBody(S,_)),s.isArray(S)?O.fromValuesArray(S):O.fromValues(S)},O.fromValues=function(S){return Object.assign(new O,S)},O.fromValuesArray=function(S){for(var _=S.length,L=new Array(_),y=0;y<_;y++)L[y]=O.fromValues(S[y]);return L},O.toRequestBody=s.encodeBody,O}();f.default=E},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=function(){function b(a){this.count=a&&a.count||0,this.data=a&&a.data||0,this.uncompressedData=a&&a.uncompressedData||0,this.failed=a&&a.failed||0,this.refused=a&&a.refused||0}return b}(),O=function(b){c.__extends(a,b);function a(h){var i=b.call(this,h)||this;return h&&h.category&&(i.category={},s.forInOwnNonNullProperties(h.category,function(o){i.category[o]=new E(h.category[o])})),i}return a}(E),S=function(){function b(a){this.peak=a&&a.peak||0,this.min=a&&a.min||0,this.mean=a&&a.mean||0,this.opened=a&&a.opened||0,this.refused=a&&a.refused||0}return b}(),_=function(){function b(a){this.succeeded=a&&a.succeeded||0,this.failed=a&&a.failed||0,this.refused=a&&a.refused||0}return b}(),L=function(){function b(a){this.plain=new S(a&&a.plain),this.tls=new S(a&&a.tls),this.all=new S(a&&a.all)}return b}(),y=function(){function b(a){this.messages=new O(a&&a.messages),this.presence=new O(a&&a.presence),this.all=new O(a&&a.all)}return b}(),I=function(){function b(a){this.realtime=new y(a&&a.realtime),this.rest=new y(a&&a.rest),this.webhook=new y(a&&a.webhook),this.sharedQueue=new y(a&&a.sharedQueue),this.externalQueue=new y(a&&a.externalQueue),this.httpEvent=new y(a&&a.httpEvent),this.push=new y(a&&a.push),this.all=new y(a&&a.all)}return b}(),u=function(){function b(a){this.all=new y(a&&a.all),this.inbound=new I(a&&a.inbound),this.outbound=new I(a&&a.outbound)}return b}(),C=function(){function b(a){this.all=new y(a&&a.all),this.producerPaid=new u(a&&a.producerPaid),this.consumerPaid=new u(a&&a.consumerPaid)}return b}(),x=function(){function b(a){this.messages=a&&a.messages||0;var h=a&&a.notifications;this.notifications={invalid:h&&h.invalid||0,attempted:h&&h.attempted||0,successful:h&&h.successful||0,failed:h&&h.failed||0},this.directPublishes=a&&a.directPublishes||0}return b}(),T=function(){function b(a){this.succeeded=a&&a.succeeded||0,this.skipped=a&&a.skipped||0,this.failed=a&&a.failed||0}return b}(),m=function(){function b(a){var h=this;this.delta=void 0,a&&a.delta&&(this.delta={},s.forInOwnNonNullProperties(a.delta,function(i){h.delta[i]=new T(a.delta[i])}))}return b}(),g=function(b){c.__extends(a,b);function a(h){var i=b.call(this,h)||this;return i.persisted=new y(h&&h.persisted),i.connections=new L(h&&h.connections),i.channels=new S(h&&h.channels),i.apiRequests=new _(h&&h.apiRequests),i.tokenRequests=new _(h&&h.tokenRequests),i.xchgProducer=new C(h&&h.xchgProducer),i.xchgConsumer=new C(h&&h.xchgConsumer),i.push=new x(h&&h.pushStats),i.processed=new m(h&&h.processed),i.inProgress=h&&h.inProgress||void 0,i.unit=h&&h.unit||void 0,i.intervalId=h&&h.intervalId||void 0,i}return a.fromValues=function(h){return new a(h)},a}(u);f.default=g},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(30)),O=c.__importDefault(r(7)),S=c.__importDefault(r(2)),_=c.__importDefault(r(51)),L=c.__importDefault(r(38)),y=c.__importDefault(r(8)),I=c.__importDefault(r(4)),u=c.__importDefault(r(10)),C=c.__importDefault(r(35)),x=c.__importDefault(r(3)),T=c.__importDefault(r(9)),m=function(b){c.__extends(a,b);function a(h){var i=b.call(this,h)||this;return S.default.logAction(S.default.LOG_MINOR,"Realtime()",""),i.connection=new _.default(i,i.options),i.channels=new g(i),h.autoConnect!==!1&&i.connect(),i}return a.prototype.connect=function(){S.default.logAction(S.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},a.prototype.close=function(){S.default.logAction(S.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},a.Promise=function(h){return h=y.default.objectifyOptions(h),h.promises=!0,new a(h)},a.Callbacks=a,a.Utils=s,a.ConnectionManager=C.default,a.Platform=x.default,a.ProtocolMessage=u.default,a.Message=T.default,a}(E.default),g=function(b){c.__extends(a,b);function a(h){var i=b.call(this)||this;return i.realtime=h,i.all=Object.create(null),h.connection.connectionManager.on("transport.active",function(){i.onTransportActive()}),i}return a.prototype.channelSerials=function(){for(var h={},i=0,o=s.keysArray(this.all,!0);i<o.length;i++){var v=o[i],l=this.all[v];l.properties.channelSerial&&(h[v]=l.properties.channelSerial)}return h},a.prototype.recoverChannels=function(h){for(var i=0,o=s.keysArray(h,!0);i<o.length;i++){var v=o[i],l=this.get(v);l.properties.channelSerial=h[v]}},a.prototype.onChannelMessage=function(h){var i=h.channel;if(i===void 0){S.default.logAction(S.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+h.action);return}var o=this.all[i];if(!o){S.default.logAction(S.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+i);return}o.onMessage(h)},a.prototype.onTransportActive=function(){for(var h in this.all){var i=this.all[h];i.state==="attaching"||i.state==="detaching"?i.checkPendingState():i.state==="suspended"?i._attach(!1,null):i.state==="attached"&&i.requestState("attaching")}},a.prototype.propogateConnectionInterruption=function(h,i){var o={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],l=o[h];for(var A in this.all){var U=this.all[A];s.arrIn(v,U.state)&&U.notifyState(l,i)}},a.prototype.get=function(h,i){h=String(h);var o=this.all[h];if(!o)o=this.all[h]=new L.default(this.realtime,h,i);else if(i){if(o._shouldReattachToSetOptions(i))throw new I.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);o.setOptions(i)}return o},a.prototype.getDerived=function(h,i,o){if(i.filter){var v=s.toBase64(i.filter),l=s.matchDerivedChannel(h);h="[filter=".concat(v).concat(l.qualifierParam,"]").concat(l.channelName)}return this.get(h,o)},a.prototype.release=function(h){h=String(h);var i=this.all[h];if(!!i){var o=i.getReleaseErr();if(o)throw o;delete this.all[h]}},a}(O.default);f.default=m},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(7)),O=c.__importDefault(r(35)),S=c.__importDefault(r(2)),_=c.__importDefault(r(37)),L=c.__importDefault(r(3));function y(){}var I=function(u){c.__extends(C,u);function C(x,T){var m=u.call(this)||this;return m.whenState=function(g,b){return E.default.prototype.whenState.call(m,g,m.state,b,new _.default(void 0,g))},m.ably=x,m.connectionManager=new O.default(x,T),m.state=m.connectionManager.state.state,m.key=void 0,m.id=void 0,m.errorReason=null,m.connectionManager.on("connectionstate",function(g){var b=m.state=g.current;L.default.Config.nextTick(function(){m.emit(b,g)})}),m.connectionManager.on("update",function(g){L.default.Config.nextTick(function(){m.emit("update",g)})}),m}return C.prototype.connect=function(){S.default.logAction(S.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},C.prototype.ping=function(x){if(S.default.logAction(S.default.LOG_MINOR,"Connection.ping()",""),!x){if(this.ably.options.promises)return s.promisify(this,"ping",arguments);x=y}this.connectionManager.ping(null,x)},C.prototype.close=function(){S.default.logAction(S.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(C.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),C.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},C}(E.default);f.default=I},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.PendingMessage=void 0;var c=r(0),s=c.__importDefault(r(10)),E=c.__importStar(r(1)),O=c.__importDefault(r(7)),S=c.__importDefault(r(2)),_=c.__importDefault(r(36)),L=c.__importDefault(r(4)),y=s.default.Action,I=function(){function C(x,T){this.message=x,this.callback=T,this.merged=!1;var m=x.action;this.sendAttempted=!1,this.ackRequired=m==y.MESSAGE||m==y.PRESENCE}return C}();f.PendingMessage=I;var u=function(C){c.__extends(x,C);function x(T){var m=C.call(this)||this;return m.transport=T,m.messageQueue=new _.default,T.on("ack",function(g,b){m.onAck(g,b)}),T.on("nack",function(g,b,a){m.onNack(g,b,a)}),m}return x.prototype.onAck=function(T,m){S.default.logAction(S.default.LOG_MICRO,"Protocol.onAck()","serial = "+T+"; count = "+m),this.messageQueue.completeMessages(T,m)},x.prototype.onNack=function(T,m,g){S.default.logAction(S.default.LOG_ERROR,"Protocol.onNack()","serial = "+T+"; count = "+m+"; err = "+E.inspectError(g)),g||(g=new L.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(T,m,g)},x.prototype.onceIdle=function(T){var m=this.messageQueue;if(m.count()===0){T();return}m.once("idle",T)},x.prototype.send=function(T){T.ackRequired&&this.messageQueue.push(T),S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Protocol.send()","sending msg; "+s.default.stringify(T.message)),T.sendAttempted=!0,this.transport.send(T.message)},x.prototype.getTransport=function(){return this.transport},x.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},x.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},x.prototype.finish=function(){var T=this.transport;this.onceIdle(function(){T.disconnect()})},x}(O.default);f.default=u},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(3)),E=c.__importStar(r(1)),O=c.__importDefault(r(26)),S=c.__importDefault(r(8)),_=c.__importDefault(r(2)),L=c.__importDefault(r(10)),y=c.__importDefault(r(4)),I="web_socket";function u(T){return!!T.on}var C=function(T){c.__extends(m,T);function m(g,b,a){var h=T.call(this,g,b,a)||this;return h.shortName=I,a.heartbeats=s.default.Config.useProtocolHeartbeats,h.wsHost=S.default.getHost(a.options,a.host,!0),h}return m.isAvailable=function(){return!!s.default.Config.WebSocket},m.prototype.createWebSocket=function(g,b){return this.uri=g+E.toQueryString(b),new s.default.Config.WebSocket(this.uri)},m.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},m.prototype.connect=function(){_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),O.default.prototype.connect.call(this);var g=this,b=this.params,a=b.options,h=a.tls?"wss://":"ws://",i=h+this.wsHost+":"+S.default.getPort(a)+"/";_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+i),this.auth.getAuthParams(function(o,v){if(!g.isDisposed){var l="";for(var A in v)l+=" "+A+": "+v[A]+";";if(_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+l+" err: "+o),o){g.disconnect(o);return}var U=b.getConnectParams(v);try{var k=g.wsConnection=g.createWebSocket(i,U);k.binaryType=s.default.Config.binaryType,k.onopen=function(){g.onWsOpen()},k.onclose=function(j){g.onWsClose(j)},k.onmessage=function(j){g.onWsData(j.data)},k.onerror=function(j){g.onWsError(j)},u(k)&&k.on("ping",function(){g.onActivity()})}catch(j){_.default.logAction(_.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(j.stack||j.message)),g.disconnect(j)}}})},m.prototype.send=function(g){var b=this.wsConnection;if(!b){_.default.logAction(_.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{b.send(L.default.serialize(g,this.params.format))}catch(h){var a="Exception from ws connection when trying to send: "+E.inspectError(h);_.default.logAction(_.default.LOG_ERROR,"WebSocketTransport.send()",a),this.finish("disconnected",new y.default(a,5e4,500))}},m.prototype.onWsData=function(g){_.default.logAction(_.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+g.length+"; type = "+typeof g);try{this.onProtocolMessage(L.default.deserialize(g,this.format))}catch(b){_.default.logAction(_.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+b.stack)}},m.prototype.onWsOpen=function(){_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},m.prototype.onWsClose=function(g){var b,a;if(typeof g=="object"?(a=g.code,b=g.wasClean||a===1e3):(a=g,b=a==1e3),delete this.wsConnection,b){_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var h=new y.default("Websocket closed",80003,400);this.finish("disconnected",h)}else{var i="Unclean disconnection of WebSocket ; code = "+a,h=new y.default(i,80003,400);_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.onWsClose()",i),this.finish("disconnected",h)}this.emit("disposed")},m.prototype.onWsError=function(g){var b=this;_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+g.message),s.default.Config.nextTick(function(){b.disconnect(Error(g.message))})},m.prototype.dispose=function(){_.default.logAction(_.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var g=this.wsConnection;g&&(g.onmessage=function(){},delete this.wsConnection,s.default.Config.nextTick(function(){if(_.default.logAction(_.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!g)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");g.close()}))},m}(O.default);function x(T){return C.isAvailable()&&(T.supportedTransports[I]=C),C}f.default=x},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(1)),E=c.__importDefault(r(34)),O=c.__importDefault(r(7)),S=c.__importDefault(r(2)),_=c.__importDefault(r(15)),L=c.__importStar(r(4)),y=c.__importDefault(r(38)),I=c.__importDefault(r(23)),u=c.__importDefault(r(39)),C=function(){};function x(h){return h.channel.realtime.auth.clientId}function T(h){var i=h.channel.realtime,o=i.auth.clientId;return(!o||o==="*")&&i.connection.state==="connected"}function m(h,i,o){switch(h.state){case"attached":case"suspended":o();break;case"initialized":case"detached":case"detaching":case"attaching":h.attach(function(v){v?i(v):o()});break;default:i(L.default.fromValues(h.invalidStateError()))}}function g(h,i){if(h.isSynthesized()||i.isSynthesized())return h.timestamp>=i.timestamp;var o=h.parseId(),v=i.parseId();return o.msgSerial===v.msgSerial?o.index>v.index:o.msgSerial>v.msgSerial}var b=function(h){c.__extends(i,h);function i(o){var v=h.call(this,o)||this;return v.channel=o,v.syncComplete=!1,v.members=new a(v,function(l){return l.clientId+":"+l.connectionId}),v._myMembers=new a(v,function(l){return l.clientId}),v.subscriptions=new O.default,v.pendingPresence=[],v}return i.prototype.enter=function(o,v){if(T(this))throw new L.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,o,"enter",v)},i.prototype.update=function(o,v){if(T(this))throw new L.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,o,"update",v)},i.prototype.enterClient=function(o,v,l){return this._enterOrUpdateClient(void 0,o,v,"enter",l)},i.prototype.updateClient=function(o,v,l){return this._enterOrUpdateClient(void 0,o,v,"update",l)},i.prototype._enterOrUpdateClient=function(o,v,l,A,U){var k=this;if(!U)if(typeof l=="function")U=l,l=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"_enterOrUpdateClient",[o,v,l,A]);U=C}var j=this.channel;if(!j.connectionManager.activeState()){U(j.connectionManager.getError());return}S.default.logAction(S.default.LOG_MICRO,"RealtimePresence."+A+"Client()","channel = "+j.name+", id = "+o+", client = "+(v||"(implicit) "+x(this)));var N=_.default.fromData(l);N.action=A,o&&(N.id=o),v&&(N.clientId=v),_.default.encode(N,j.channelOptions,function(P){if(P){U(P);return}switch(j.state){case"attached":j.sendPresence(N,U);break;case"initialized":case"detached":j.attach();case"attaching":k.pendingPresence.push({presence:N,callback:U});break;default:P=new L.PartialErrorInfo("Unable to "+A+" presence channel while in "+j.state+" state",90001),P.code=90001,U(P)}})},i.prototype.leave=function(o,v){if(T(this))throw new L.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,o,v)},i.prototype.leaveClient=function(o,v,l){if(!l)if(typeof v=="function")l=v,v=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"leaveClient",[o,v]);l=C}var A=this.channel;if(!A.connectionManager.activeState()){l==null||l(A.connectionManager.getError());return}S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+o);var U=_.default.fromValues({action:"leave",data:v});switch(o&&(U.clientId=o),A.state){case"attached":A.sendPresence(U,l);break;case"attaching":this.pendingPresence.push({presence:U,callback:l});break;case"initialized":case"failed":{var k=new L.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);l==null||l(k);break}default:l==null||l(A.invalidStateError())}},i.prototype.get=function(o,v){var l=this,A=Array.prototype.slice.call(arguments);A.length==1&&typeof A[0]=="function"&&A.unshift(null),o=A[0],v=A[1];var U=!o||("waitForSync"in o?o.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return s.promisify(this,"get",A);v=C}function k(j){v(null,o?j.list(o):j.values())}if(this.channel.state==="suspended"){U?v(L.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):k(this.members);return}m(this.channel,v,function(){var j=l.members;U?j.waitSync(function(){k(j)}):k(j)})},i.prototype.history=function(o,v){if(S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof o=="function")v=o,o=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"history",arguments);v=C}o&&o.untilAttach&&(this.channel.state==="attached"?(delete o.untilAttach,o.from_serial=this.channel.properties.attachSerial):v(new L.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),E.default.prototype._history.call(this,o,v)},i.prototype.setPresence=function(o,v,l){S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+o.length+" participants; syncChannelSerial = "+l);var A,U,k=this.members,j=this._myMembers,N=[],P=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),l&&(U=l.match(/^[\w-]+:(.*)$/))&&(A=U[1]));for(var M=0;M<o.length;M++){var F=_.default.fromValues(o[M]);switch(F.action){case"leave":k.remove(F)&&N.push(F),F.connectionId===P&&!F.isSynthesized()&&j.remove(F);break;case"enter":case"present":case"update":k.put(F)&&N.push(F),F.connectionId===P&&j.put(F);break}}v&&!A&&(k.endSync(),this.channel.syncChannelSerial=null);for(var M=0;M<N.length;M++){var F=N[M];this.subscriptions.emit(F.action,F)}},i.prototype.onAttached=function(o){S.default.logAction(S.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+o),o?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,l=v.length;if(l){this.pendingPresence=[];var A=[],U=I.default.create();S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+l+" queued presence messages");for(var k=0;k<l;k++){var j=v[k];A.push(j.presence),U.push(j.callback)}this.channel.sendPresence(A,U)}},i.prototype.actOnChannelState=function(o,v,l){switch(o){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(l);break}},i.prototype.failPendingPresence=function(o){if(this.pendingPresence.length){S.default.logAction(S.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+s.inspectError(o));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(o)}catch(l){}this.pendingPresence=[]}},i.prototype._clearMyMembers=function(){this._myMembers.clear()},i.prototype._ensureMyMembersPresent=function(){var o=this,v=this._myMembers,l=function(k){if(k){var j="Presence auto-re-enter failed: "+k.toString(),N=new L.default(j,91004,400);S.default.logAction(S.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",j);var P=new u.default(o.channel.state,o.channel.state,!0,!1,N);o.channel.emit("update",P)}};for(var A in v.map){var U=v.map[A];S.default.logAction(S.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+U.clientId+'" into the presence set'),this._enterOrUpdateClient(U.id,U.clientId,U.data,"enter",l)}},i.prototype._synthesizeLeaves=function(o){var v=this.subscriptions;s.arrForEach(o,function(l){var A=_.default.fromValues({action:"leave",connectionId:l.connectionId,clientId:l.clientId,data:l.data,encoding:l.encoding,timestamp:s.now()});v.emit("leave",A)})},i.prototype.on=function(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];S.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,o)},i.prototype.off=function(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];S.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,o)},i.prototype.subscribe=function(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];var l=y.default.processListenerArgs(o),A=l[0],U=l[1],k=l[2],j=this.channel;if(!k){if(this.channel.realtime.options.promises)return s.promisify(this,"subscribe",[A,U]);k=C}if(j.state==="failed"){k(L.default.fromValues(j.invalidStateError()));return}this.subscriptions.on(A,U),j.attach(k)},i.prototype.unsubscribe=function(){for(var o=[],v=0;v<arguments.length;v++)o[v]=arguments[v];var l=y.default.processListenerArgs(o),A=l[0],U=l[1];this.subscriptions.off(A,U)},i}(E.default),a=function(h){c.__extends(i,h);function i(o,v){var l=h.call(this)||this;return l.presence=o,l.map=Object.create(null),l.syncInProgress=!1,l.residualMembers=null,l.memberKey=v,l}return i.prototype.get=function(o){return this.map[o]},i.prototype.getClient=function(o){var v=this.map,l=[];for(var A in v){var U=v[A];U.clientId==o&&U.action!="absent"&&l.push(U)}return l},i.prototype.list=function(o){var v=this.map,l=o&&o.clientId,A=o&&o.connectionId,U=[];for(var k in v){var j=v[k];j.action!=="absent"&&(l&&l!=j.clientId||A&&A!=j.connectionId||U.push(j))}return U},i.prototype.put=function(o){(o.action==="enter"||o.action==="update")&&(o=_.default.fromValues(o),o.action="present");var v=this.map,l=this.memberKey(o);this.residualMembers&&delete this.residualMembers[l];var A=v[l];return A&&!g(o,A)?!1:(v[l]=o,!0)},i.prototype.values=function(){var o=this.map,v=[];for(var l in o){var A=o[l];A.action!="absent"&&v.push(A)}return v},i.prototype.remove=function(o){var v=this.map,l=this.memberKey(o),A=v[l];return A&&!g(o,A)?!1:(this.syncInProgress?(o=_.default.fromValues(o),o.action="absent",v[l]=o):delete v[l],!0)},i.prototype.startSync=function(){var o=this.map,v=this.syncInProgress;S.default.logAction(S.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=s.copy(o),this.setInProgress(!0))},i.prototype.endSync=function(){var o=this.map,v=this.syncInProgress;if(S.default.logAction(S.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var l in o){var A=o[l];A.action==="absent"&&delete o[l]}this.presence._synthesizeLeaves(s.valuesArray(this.residualMembers));for(var l in this.residualMembers)delete o[l];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},i.prototype.waitSync=function(o){var v=this.syncInProgress;if(S.default.logAction(S.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){o();return}this.once("sync",o)},i.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},i.prototype.setInProgress=function(o){S.default.logAction(S.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+o),this.syncInProgress=o,this.presence.syncComplete=!o},i}(O.default);f.default=b},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=r(56),E=r(31),O=r(11),S=c.__importDefault(r(5)),_=c.__importDefault(r(3)),L=function(){function y(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return y.prototype.isWordArray=function(I){return I!=null&&I.sigBytes!==void 0},y.prototype.isArrayBuffer=function(I){return I!=null&&I.constructor===ArrayBuffer},y.prototype.isTypedArray=function(I){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(I)},y.prototype.uint8ViewToBase64=function(I){for(var u="",C=this.base64CharSet,x=I.byteLength,T=x%3,m=x-T,g,b,a,h,i,o=0;o<m;o=o+3)i=I[o]<<16|I[o+1]<<8|I[o+2],g=(i&16515072)>>18,b=(i&258048)>>12,a=(i&4032)>>6,h=i&63,u+=C[g]+C[b]+C[a]+C[h];return T==1?(i=I[m],g=(i&252)>>2,b=(i&3)<<4,u+=C[g]+C[b]+"=="):T==2&&(i=I[m]<<8|I[m+1],g=(i&64512)>>10,b=(i&1008)>>4,a=(i&15)<<2,u+=C[g]+C[b]+C[a]+"="),u},y.prototype.base64ToArrayBuffer=function(I){for(var u=atob==null?void 0:atob(I),C=u.length,x=new Uint8Array(C),T=0;T<C;T++){var m=u.charCodeAt(T);x[T]=m}return x.buffer},y.prototype.isBuffer=function(I){return this.isArrayBuffer(I)||this.isWordArray(I)||this.isTypedArray(I)},y.prototype.toBuffer=function(I){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(I))return new Uint8Array(I);if(this.isTypedArray(I))return new Uint8Array(I.buffer);if(this.isWordArray(I)){for(var u=new ArrayBuffer(I.sigBytes),C=new Uint8Array(u),x=0;x<I.sigBytes;x++)C[x]=I.words[x>>>2]>>>24-x%4*8&255;return C}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},y.prototype.toArrayBuffer=function(I){return this.isArrayBuffer(I)?I:this.toBuffer(I).buffer},y.prototype.toWordArray=function(I){return this.isTypedArray(I)&&(I=I.buffer),this.isWordArray(I)?I:S.default.create(I)},y.prototype.base64Encode=function(I){return this.isWordArray(I)?(0,O.stringify)(I):this.uint8ViewToBase64(this.toBuffer(I))},y.prototype.base64Decode=function(I){return ArrayBuffer&&_.default.Config.atob?this.base64ToArrayBuffer(I):(0,O.parse)(I)},y.prototype.hexEncode=function(I){return(0,s.stringify)(this.toWordArray(I))},y.prototype.hexDecode=function(I){var u=(0,s.parse)(I);return ArrayBuffer?this.toArrayBuffer(u):u},y.prototype.utf8Encode=function(I){return _.default.Config.TextEncoder?new _.default.Config.TextEncoder().encode(I).buffer:(0,E.parse)(I)},y.prototype.utf8Decode=function(I){if(!this.isBuffer(I))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(I)?new TextDecoder().decode(I):(I=this.toWordArray(I),(0,E.stringify)(I))},y.prototype.bufferCompare=function(I,u){if(!I)return-1;if(!u)return 1;var C=this.toWordArray(I),x=this.toWordArray(u);C.clamp(),x.clamp();var T=C.sigBytes-x.sigBytes;if(T!=0)return T;for(var m=C.words,g=x.words,b=0;b<m.length;b++)if(T=m[b]-g[b],T!=0)return T;return 0},y.prototype.byteLength=function(I){return this.isArrayBuffer(I)||this.isTypedArray(I)?I.byteLength:this.isWordArray(I)?I.sigBytes:-1},y.prototype.typedArrayToBuffer=function(I){return I.buffer},y}();f.default=new L},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return c.enc.Hex})},function(p,f,r){"use strict";r.r(f);var c=r(5),s=r.n(c),E=r(11),O=r.n(E),S=r(22),_=r.n(S),L=r(2),y=r.n(L),I=r(4),u=r.n(I),C=function(x,T){var m="aes",g=256,b="cbc",a=16,h=4,i=4294967296,o=2147483648,v;if(x.getRandomWordArray)v=x.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&x.getRandomValues){var l=new Uint32Array(h);v=function(F,W){var K=F/4,X=K==h?l:new Uint32Array(K);x.getRandomValues(X,function(et){typeof W!="undefined"&&W(et,T.toWordArray(X))})}}else v=function(F,W){y.a.logAction(y.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var K=F/4,X=new Array(K),et=0;et<K;et++)X[et]=Math.floor(Math.random()*i)-o;W(null,s.a.create(X))};function A(F){return F+a&-a}function U(F){if(F.algorithm==="aes"&&F.mode==="cbc"){if(F.keyLength===128||F.keyLength===256)return;throw new Error("Unsupported key length "+F.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function k(F){return F.replace("_","/").replace("-","+")}var j=[s.a.create([269488144,269488144,269488144,269488144],16),s.a.create([16777216],1),s.a.create([33685504],2),s.a.create([50529024],3),s.a.create([67372036],4),s.a.create([84215045,83886080],5),s.a.create([101058054,101056512],6),s.a.create([117901063,117901056],7),s.a.create([134744072,134744072],8),s.a.create([151587081,151587081,150994944],9),s.a.create([168430090,168430090,168427520],10),s.a.create([185273099,185273099,185273088],11),s.a.create([202116108,202116108,202116108],12),s.a.create([218959117,218959117,218959117,218103808],13),s.a.create([235802126,235802126,235802126,235798528],14),s.a.create([252645135,252645135,252645135,252645135],15),s.a.create([269488144,269488144,269488144,269488144],16)];function N(){}function P(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}N.CipherParams=P,N.getDefaultParams=function(F){var W;if(typeof F=="function"||typeof F=="string"){if(y.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof F=="function")N.generateRandomKey(function(X){F(null,N.getDefaultParams({key:X}))});else if(typeof arguments[1]=="function")arguments[1](null,N.getDefaultParams({key:F}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!F.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof F.key=="string"?W=Object(E.parse)(k(F.key)):W=T.toWordArray(F.key);var K=new P;if(K.key=W,K.algorithm=F.algorithm||m,K.keyLength=W.words.length*(4*8),K.mode=F.mode||b,F.keyLength&&F.keyLength!==K.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+F.keyLength+" was specified, but the key actually has length "+K.keyLength);return U(K),K},N.generateRandomKey=function(F,W){arguments.length==1&&typeof F=="function"&&(W=F,F=void 0),v((F||g)/8,function(K,X){W!==void 0&&W(K?u.a.fromValues(K):null,X)})},N.getCipher=function(F){var W=F instanceof P?F:N.getDefaultParams(F);return{cipherParams:W,cipher:new M(W,h,F.iv)}};function M(F,W,K){this.algorithm=F.algorithm+"-"+String(F.keyLength)+"-"+F.mode,this.cjsAlgorithm=F.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=T.toWordArray(F.key),K&&(this.iv=T.toWordArray(K).clone()),this.blockLengthWords=W}return M.prototype.encrypt=function(F,W){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.encrypt()",""),F=T.toWordArray(F);var K=F.sigBytes,X=A(K),et=this,Y=function(){et.getIv(function(w,B){if(w){W(w);return}var H=et.encryptCipher.process(F.concat(j[X-K])),V=B.concat(H);W(null,V)})};this.encryptCipher?Y():this.iv?(this.encryptCipher=_.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),Y()):v(a,function(w,B){if(w){W(w);return}et.encryptCipher=_.a.algo[et.cjsAlgorithm].createEncryptor(et.key,{iv:B}),et.iv=B,Y()})},M.prototype.decrypt=function(F){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.decrypt()",""),F=T.toWordArray(F);var W=this.blockLengthWords,K=F.words,X=s.a.create(K.slice(0,W)),et=s.a.create(K.slice(W)),Y=_.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:X}),w=Y.process(et),B=Y.finalize();return Y.reset(),B&&B.sigBytes&&w.concat(B),w},M.prototype.getIv=function(F){if(this.iv){var W=this.iv;this.iv=null,F(null,W);return}var K=this;v(a,function(X,et){if(X){F(X);return}F(null,K.encryptCipher.process(et))})},N};f.default=C},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(){var s=c,E=s.lib,O=E.WordArray,S=s.enc,_=S.Utf16=S.Utf16BE={stringify:function(y){for(var I=y.words,u=y.sigBytes,C=[],x=0;x<u;x+=2){var T=I[x>>>2]>>>16-x%4*8&65535;C.push(String.fromCharCode(T))}return C.join("")},parse:function(y){for(var I=y.length,u=[],C=0;C<I;C++)u[C>>>1]|=y.charCodeAt(C)<<16-C%2*16;return O.create(u,I*2)}};S.Utf16LE={stringify:function(y){for(var I=y.words,u=y.sigBytes,C=[],x=0;x<u;x+=2){var T=L(I[x>>>2]>>>16-x%4*8&65535);C.push(String.fromCharCode(T))}return C.join("")},parse:function(y){for(var I=y.length,u=[],C=0;C<I;C++)u[C>>>1]|=L(y.charCodeAt(C)<<16-C%2*16);return O.create(u,I*2)}};function L(y){return y<<8&4278255360|y>>>8&16711935}}(),c.enc.Utf16})},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(28))})(this,function(c){return function(s){var E=c,O=E.lib,S=O.CipherParams,_=E.enc,L=_.Hex,y=E.format,I=y.Hex={stringify:function(u){return u.ciphertext.toString(L)},parse:function(u){var C=L.parse(u);return S.create({ciphertext:C})}}}(),c.format.Hex})},function(p,f,r){(function(c,s){p.exports=f=s(r(6),r(11),r(61),r(27),r(28))})(this,function(c){return function(){var s=c,E=s.lib,O=E.BlockCipher,S=s.algo,_=[],L=[],y=[],I=[],u=[],C=[],x=[],T=[],m=[],g=[];(function(){for(var h=[],i=0;i<256;i++)i<128?h[i]=i<<1:h[i]=i<<1^283;for(var o=0,v=0,i=0;i<256;i++){var l=v^v<<1^v<<2^v<<3^v<<4;l=l>>>8^l&255^99,_[o]=l,L[l]=o;var A=h[o],U=h[A],k=h[U],j=h[l]*257^l*16843008;y[o]=j<<24|j>>>8,I[o]=j<<16|j>>>16,u[o]=j<<8|j>>>24,C[o]=j;var j=k*16843009^U*65537^A*257^o*16843008;x[l]=j<<24|j>>>8,T[l]=j<<16|j>>>16,m[l]=j<<8|j>>>24,g[l]=j,o?(o=A^h[h[h[k^A]]],v^=h[h[v]]):o=v=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],a=S.AES=O.extend({_doReset:function(){var h;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var i=this._keyPriorReset=this._key,o=i.words,v=i.sigBytes/4,l=this._nRounds=v+6,A=(l+1)*4,U=this._keySchedule=[],k=0;k<A;k++)k<v?U[k]=o[k]:(h=U[k-1],k%v?v>6&&k%v==4&&(h=_[h>>>24]<<24|_[h>>>16&255]<<16|_[h>>>8&255]<<8|_[h&255]):(h=h<<8|h>>>24,h=_[h>>>24]<<24|_[h>>>16&255]<<16|_[h>>>8&255]<<8|_[h&255],h^=b[k/v|0]<<24),U[k]=U[k-v]^h);for(var j=this._invKeySchedule=[],N=0;N<A;N++){var k=A-N;if(N%4)var h=U[k];else var h=U[k-4];N<4||k<=4?j[N]=h:j[N]=x[_[h>>>24]]^T[_[h>>>16&255]]^m[_[h>>>8&255]]^g[_[h&255]]}}},encryptBlock:function(h,i){this._doCryptBlock(h,i,this._keySchedule,y,I,u,C,_)},decryptBlock:function(h,i){var o=h[i+1];h[i+1]=h[i+3],h[i+3]=o,this._doCryptBlock(h,i,this._invKeySchedule,x,T,m,g,L);var o=h[i+1];h[i+1]=h[i+3],h[i+3]=o},_doCryptBlock:function(h,i,o,v,l,A,U,k){for(var j=this._nRounds,N=h[i]^o[0],P=h[i+1]^o[1],M=h[i+2]^o[2],F=h[i+3]^o[3],W=4,K=1;K<j;K++){var X=v[N>>>24]^l[P>>>16&255]^A[M>>>8&255]^U[F&255]^o[W++],et=v[P>>>24]^l[M>>>16&255]^A[F>>>8&255]^U[N&255]^o[W++],Y=v[M>>>24]^l[F>>>16&255]^A[N>>>8&255]^U[P&255]^o[W++],w=v[F>>>24]^l[N>>>16&255]^A[P>>>8&255]^U[M&255]^o[W++];N=X,P=et,M=Y,F=w}var X=(k[N>>>24]<<24|k[P>>>16&255]<<16|k[M>>>8&255]<<8|k[F&255])^o[W++],et=(k[P>>>24]<<24|k[M>>>16&255]<<16|k[F>>>8&255]<<8|k[N&255])^o[W++],Y=(k[M>>>24]<<24|k[F>>>16&255]<<16|k[N>>>8&255]<<8|k[P&255])^o[W++],w=(k[F>>>24]<<24|k[N>>>16&255]<<16|k[P>>>8&255]<<8|k[M&255])^o[W++];h[i]=X,h[i+1]=et,h[i+2]=Y,h[i+3]=w},keySize:256/32});s.AES=O._createHelper(a)}(),c.AES})},function(p,f,r){(function(c,s){p.exports=f=s(r(6))})(this,function(c){return function(s){var E=c,O=E.lib,S=O.WordArray,_=O.Hasher,L=E.algo,y=[];(function(){for(var m=0;m<64;m++)y[m]=s.abs(s.sin(m+1))*4294967296|0})();var I=L.MD5=_.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,g){for(var b=0;b<16;b++){var a=g+b,h=m[a];m[a]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var i=this._hash.words,o=m[g+0],v=m[g+1],l=m[g+2],A=m[g+3],U=m[g+4],k=m[g+5],j=m[g+6],N=m[g+7],P=m[g+8],M=m[g+9],F=m[g+10],W=m[g+11],K=m[g+12],X=m[g+13],et=m[g+14],Y=m[g+15],w=i[0],B=i[1],H=i[2],V=i[3];w=u(w,B,H,V,o,7,y[0]),V=u(V,w,B,H,v,12,y[1]),H=u(H,V,w,B,l,17,y[2]),B=u(B,H,V,w,A,22,y[3]),w=u(w,B,H,V,U,7,y[4]),V=u(V,w,B,H,k,12,y[5]),H=u(H,V,w,B,j,17,y[6]),B=u(B,H,V,w,N,22,y[7]),w=u(w,B,H,V,P,7,y[8]),V=u(V,w,B,H,M,12,y[9]),H=u(H,V,w,B,F,17,y[10]),B=u(B,H,V,w,W,22,y[11]),w=u(w,B,H,V,K,7,y[12]),V=u(V,w,B,H,X,12,y[13]),H=u(H,V,w,B,et,17,y[14]),B=u(B,H,V,w,Y,22,y[15]),w=C(w,B,H,V,v,5,y[16]),V=C(V,w,B,H,j,9,y[17]),H=C(H,V,w,B,W,14,y[18]),B=C(B,H,V,w,o,20,y[19]),w=C(w,B,H,V,k,5,y[20]),V=C(V,w,B,H,F,9,y[21]),H=C(H,V,w,B,Y,14,y[22]),B=C(B,H,V,w,U,20,y[23]),w=C(w,B,H,V,M,5,y[24]),V=C(V,w,B,H,et,9,y[25]),H=C(H,V,w,B,A,14,y[26]),B=C(B,H,V,w,P,20,y[27]),w=C(w,B,H,V,X,5,y[28]),V=C(V,w,B,H,l,9,y[29]),H=C(H,V,w,B,N,14,y[30]),B=C(B,H,V,w,K,20,y[31]),w=x(w,B,H,V,k,4,y[32]),V=x(V,w,B,H,P,11,y[33]),H=x(H,V,w,B,W,16,y[34]),B=x(B,H,V,w,et,23,y[35]),w=x(w,B,H,V,v,4,y[36]),V=x(V,w,B,H,U,11,y[37]),H=x(H,V,w,B,N,16,y[38]),B=x(B,H,V,w,F,23,y[39]),w=x(w,B,H,V,X,4,y[40]),V=x(V,w,B,H,o,11,y[41]),H=x(H,V,w,B,A,16,y[42]),B=x(B,H,V,w,j,23,y[43]),w=x(w,B,H,V,M,4,y[44]),V=x(V,w,B,H,K,11,y[45]),H=x(H,V,w,B,Y,16,y[46]),B=x(B,H,V,w,l,23,y[47]),w=T(w,B,H,V,o,6,y[48]),V=T(V,w,B,H,N,10,y[49]),H=T(H,V,w,B,et,15,y[50]),B=T(B,H,V,w,k,21,y[51]),w=T(w,B,H,V,K,6,y[52]),V=T(V,w,B,H,A,10,y[53]),H=T(H,V,w,B,F,15,y[54]),B=T(B,H,V,w,v,21,y[55]),w=T(w,B,H,V,P,6,y[56]),V=T(V,w,B,H,Y,10,y[57]),H=T(H,V,w,B,j,15,y[58]),B=T(B,H,V,w,X,21,y[59]),w=T(w,B,H,V,U,6,y[60]),V=T(V,w,B,H,W,10,y[61]),H=T(H,V,w,B,l,15,y[62]),B=T(B,H,V,w,M,21,y[63]),i[0]=i[0]+w|0,i[1]=i[1]+B|0,i[2]=i[2]+H|0,i[3]=i[3]+V|0},_doFinalize:function(){var m=this._data,g=m.words,b=this._nDataBytes*8,a=m.sigBytes*8;g[a>>>5]|=128<<24-a%32;var h=s.floor(b/4294967296),i=b;g[(a+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,g[(a+64>>>9<<4)+14]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360,m.sigBytes=(g.length+1)*4,this._process();for(var o=this._hash,v=o.words,l=0;l<4;l++){var A=v[l];v[l]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return o},clone:function(){var m=_.clone.call(this);return m._hash=this._hash.clone(),m}});function u(m,g,b,a,h,i,o){var v=m+(g&b|~g&a)+h+o;return(v<<i|v>>>32-i)+g}function C(m,g,b,a,h,i,o){var v=m+(g&a|b&~a)+h+o;return(v<<i|v>>>32-i)+g}function x(m,g,b,a,h,i,o){var v=m+(g^b^a)+h+o;return(v<<i|v>>>32-i)+g}function T(m,g,b,a,h,i,o){var v=m+(b^(g|~a))+h+o;return(v<<i|v>>>32-i)+g}E.MD5=_._createHelper(I),E.HmacMD5=_._createHmacHelper(I)}(Math),c.MD5})},function(p,f,r){"use strict";var c;Object.defineProperty(f,"__esModule",{value:!0});var s=r(0),E=s.__importDefault(r(3)),O=s.__importStar(r(1)),S=s.__importDefault(r(8)),_=r(4),L=s.__importDefault(r(18)),y=s.__importDefault(r(16)),I=s.__importDefault(r(21)),u=s.__importDefault(r(2)),C=r(29),x=s.__importDefault(r(63)),T=r(25);function m(a){var h=a.statusCode;return h===408&&!a.code||h===400&&!a.code||h>=500&&h<=504}function g(a){var h=a.connection,i=h&&h.connectionManager.host;return i?[i].concat(S.default.getFallbackHosts(a.options)):S.default.getHosts(a.options)}var b=(c=function(){function a(h){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=g,this.options=h||{};var i=this.options.connectivityCheckUrl||S.default.connectivityCheckUrl,o=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;E.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(l,A,U,k,j,N,P){var M=y.default.createRequest(U,k,j,N,I.default.REQ_SEND,A&&A.options.timeouts,l);return M.once("complete",P),M.exec(),M},this.options.disableConnectivityCheck?this.checkConnectivity=function(l){l(null,!0)}:this.checkConnectivity=function(l){u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+i),this.doUri(L.default.Get,null,i,null,null,o,function(A,U,k,j,N){var P=!1;v?P=!A&&(U==null?void 0:U.replace(/\n/,""))=="yes":P=!A&&(0,T.isSuccessCode)(N),u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+P),l(null,P)})}):E.default.Config.jsonpSupported?(this.Request=function(l,A,U,k,j,N,P){var M=(0,C.createRequest)(U,k,j,N,I.default.REQ_SEND,A&&A.options.timeouts,l);return M.once("complete",P),E.default.Config.nextTick(function(){M.exec()}),M},this.options.disableConnectivityCheck?this.checkConnectivity=function(l){l(null,!0)}:this.checkConnectivity=function(l){var A=this,U=S.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(l);return}this.checksInProgress=[l],u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+U);var k=new C.Request("isTheInternetUp",U,null,null,null,I.default.REQ_SEND,S.default.TIMEOUTS);k.once("complete",function(j,N){var P=!j&&N;u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+P);for(var M=0;M<A.checksInProgress.length;M++)A.checksInProgress[M](null,P);A.checksInProgress=null}),E.default.Config.nextTick(function(){k.exec()})}):E.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=x.default,this.checkConnectivity=function(l){u.default.logAction(u.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+i),this.doUri(L.default.Get,null,i,null,null,null,function(A,U){var k=!A&&(U==null?void 0:U.replace(/\n/,""))=="yes";u.default.logAction(u.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+k),l(null,k)})}):this.Request=function(l,A,U,k,j,N,P){P(new _.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return a.prototype.do=function(h,i,o,v,l,A,U){var k=this,j=typeof o=="function"?o:function(F){return i.baseUri(F)+o},N=i._currentFallback;if(N)if(N.validUntil>O.now()){if(!this.Request){U==null||U(new _.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(h,i,j(N.host),v,A,l,function(F){for(var W=[],K=1;K<arguments.length;K++)W[K-1]=arguments[K];if(F&&m(F)){i._currentFallback=null,k.do(h,i,o,v,l,A,U);return}U==null||U.apply(void 0,s.__spreadArray([F],W,!1))});return}else i._currentFallback=null;var P=g(i);if(P.length===1){this.doUri(h,i,j(P[0]),v,l,A,U);return}var M=function(F,W){var K=F.shift();k.doUri(h,i,j(K),v,l,A,function(X){for(var et=[],Y=1;Y<arguments.length;Y++)et[Y-1]=arguments[Y];if(X&&m(X)&&F.length){M(F,!0);return}W&&(i._currentFallback={host:K,validUntil:O.now()+i.options.timeouts.fallbackRetryTimeout}),U==null||U.apply(void 0,s.__spreadArray([X],et,!1))})};M(P)},a.prototype.doUri=function(h,i,o,v,l,A,U){if(!this.Request){U(new _.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(h,i,o,v,A,l,U)},a}(),c.methods=[L.default.Get,L.default.Delete,L.default.Post,L.default.Put,L.default.Patch],c.methodsWithoutBody=[L.default.Get,L.default.Delete],c.methodsWithBody=[L.default.Post,L.default.Put,L.default.Patch],c);f.default=b},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importStar(r(4)),E=c.__importDefault(r(3)),O=c.__importDefault(r(8)),S=c.__importStar(r(1)),_=r(1);function L(u,C){return!!C.get("x-ably-errorcode")}function y(u,C){if(L(u,C))return u.error&&s.default.fromValues(u.error)}function I(u,C,x,T,m,g,b){var a=new Headers(T||{}),h=u?u.toUpperCase():S.isEmptyArg(g)?"GET":"POST",i=new AbortController,o=setTimeout(function(){i.abort(),b(new s.PartialErrorInfo("Request timed out",null,408))},C?C.options.timeouts.httpRequestTimeout:O.default.TIMEOUTS.httpRequestTimeout),v={method:h,headers:a,body:g};E.default.Config.isWebworker||(v.credentials=a.has("authorization")?"include":"same-origin"),(0,_.getGlobalObject)().fetch(x+"?"+new URLSearchParams(m||{}),v).then(function(l){clearTimeout(o);var A=l.headers.get("Content-Type"),U;A&&A.indexOf("application/x-msgpack")>-1?U=l.arrayBuffer():A&&A.indexOf("application/json")>-1?U=l.json():U=l.text(),U.then(function(k){var j=!!A&&A.indexOf("application/x-msgpack")===-1;if(l.ok)b(null,k,l.headers,j,l.status);else{var N=y(k,l.headers)||new s.PartialErrorInfo("Error response received from server: "+l.status+" body was: "+E.default.Config.inspect(k),null,l.status);b(N,k,l.headers,j,l.status)}})}).catch(function(l){clearTimeout(o),b(l)})}f.default=I},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(41)),E=c.__importStar(r(1)),O=E.getGlobalObject();function S(){var I=O.location;return!O.WebSocket||!I||!I.origin||I.origin.indexOf("http")>-1}var _=O.navigator&&O.navigator.userAgent.toString(),L=O.location&&O.location.href,y={agent:"browser",logTimestamps:!0,userAgent:_,currentUrl:L,noUpgrade:_&&!!_.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:O.WebSocket,fetchSupported:!!O.fetch,xhrSupported:O.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:S(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:s.default,supportsBinary:!!O.TextDecoder,preferBinary:!1,ArrayBuffer:O.ArrayBuffer,atob:O.atob,nextTick:typeof O.setImmediate!="undefined"?O.setImmediate.bind(O):function(I){setTimeout(I,0)},addEventListener:O.addEventListener,inspect:JSON.stringify,stringByteSize:function(I){return O.TextDecoder&&new O.TextEncoder().encode(I).length||I.length},TextEncoder:O.TextEncoder,TextDecoder:O.TextDecoder,Promise:O.Promise,getRandomValues:function(I){if(I!==void 0)return function(u,C){I.getRandomValues(u),C&&C(null)}}(O.crypto||msCrypto)};f.default=y},function(p,f,r){"use strict";(function(c){Object.defineProperty(f,"__esModule",{value:!0});var s=r(0),E=s.__importStar(r(1)),O="ablyjs-storage-test",S=function(){function _(){try{c.sessionStorage.setItem(O,O),c.sessionStorage.removeItem(O),this.sessionSupported=!0}catch(L){this.sessionSupported=!1}try{c.localStorage.setItem(O,O),c.localStorage.removeItem(O),this.localSupported=!0}catch(L){this.localSupported=!1}}return _.prototype.get=function(L){return this._get(L,!1)},_.prototype.getSession=function(L){return this._get(L,!0)},_.prototype.remove=function(L){return this._remove(L,!1)},_.prototype.removeSession=function(L){return this._remove(L,!0)},_.prototype.set=function(L,y,I){return this._set(L,y,I,!1)},_.prototype.setSession=function(L,y,I){return this._set(L,y,I,!0)},_.prototype._set=function(L,y,I,u){var C={value:y};return I&&(C.expires=E.now()+I),this.storageInterface(u).setItem(L,JSON.stringify(C))},_.prototype._get=function(L,y){if(y&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!y&&!this.localSupported)throw new Error("Local Storage not supported");var I=this.storageInterface(y).getItem(L);if(!I)return null;var u=JSON.parse(I);return u.expires&&u.expires<E.now()?(this.storageInterface(y).removeItem(L),null):u.value},_.prototype._remove=function(L,y){return this.storageInterface(y).removeItem(L)},_.prototype.storageInterface=function(L){return L?c.sessionStorage:c.localStorage},_}();f.default=new S}).call(this,r(13))},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c=r(0),s=c.__importDefault(r(67)),E={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[s.default.XhrPolling,s.default.XhrStreaming,s.default.JsonP,s.default.WebSocket],baseTransportOrder:[s.default.XhrPolling,s.default.XhrStreaming,s.default.JsonP,s.default.WebSocket],transportPreferenceOrder:[s.default.JsonP,s.default.XhrPolling,s.default.XhrStreaming,s.default.WebSocket],upgradeTransports:[s.default.XhrStreaming,s.default.WebSocket]};f.default=E},function(p,f,r){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var c;(function(s){s.WebSocket="web_socket",s.Comet="comet",s.XhrStreaming="xhr_streaming",s.XhrPolling="xhr_polling",s.JsonP="jsonp"})(c||(c={})),f.default=c},function(p,f,r){"use strict";r.r(f);var c=r(29),s=r.n(c),E=r(1),O=r(3),S=r.n(O),_=r(12),L=r.n(_),y=r(16),I=r.n(y),u=function(g){var b="xhr_polling";function a(h,i,o){o.stream=!1,L.a.call(this,h,i,o),this.shortName=b}return E.inherits(a,L.a),a.isAvailable=function(){return S.a.Config.xhrSupported&&S.a.Config.allowComet},a.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(h,i,o,v,l){return I.a.createRequest(h,i,o,v,l,this.timeouts)},typeof g!="undefined"&&a.isAvailable()&&(g.supportedTransports[b]=a),a},C=u,x=function(g){var b="xhr_streaming";function a(h,i,o){L.a.call(this,h,i,o),this.shortName=b}return E.inherits(a,L.a),a.isAvailable=function(){return S.a.Config.xhrSupported&&S.a.Config.streamingSupported&&S.a.Config.allowComet},a.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(h,i,o,v,l){return I.a.createRequest(h,i,o,v,l,this.timeouts)},typeof g!="undefined"&&a.isAvailable()&&(g.supportedTransports[b]=a),a},T=x,m=f.default=[s.a,C,T]}]).default})});ut();var Ho=bn(To());ut();var Eo=(g=>(g.svPrimary="sv-primary",g.svPrimary900="sv-primary-900",g.svPrimary200="sv-primary-200",g.svSecondary="sv-secondary",g.svGray="sv-gray",g.svSuccess="sv-success",g.svDanger="sv-danger",g.svBlack="sv-black",g.svWhite="sv-white",g.svGray100="sv-gray-100",g.svGray200="sv-gray-200",g.svGray300="sv-gray-300",g.svGray400="sv-gray-400",g.svGray500="sv-gray-500",g.svGray600="sv-gray-600",g.svGray700="sv-gray-700",g.svGray800="sv-gray-800",g))(Eo||{});ut();ut();ut();var ie=(s,E,O,...S)=>Gt(void 0,[s,E,O,...S],function*(p,f,r,c={}){let _=yield fetch(p,{method:f,headers:Bt({"Content-Type":"application/json"},c),body:r?JSON.stringify(r):null});if(!_.ok)throw _;try{return yield _.json()}catch(L){return _.ok}});ut();var Iu=bn(To()),Be=class{constructor(f){this.debug=(0,Iu.default)(f)}log(f,...r){this.debug(f,...r)}};ut();ut();var il=bn(_o());var Mt=class{constructor(f={}){this.subscribe=f=>{this.callbacks.push(f)};this.unsubscribe=f=>{this.callbacks=this.callbacks.filter(r=>r!==f)};this.publish=(...f)=>{!this.callbacks||this.callbacks.forEach(r=>{this.callListener(r,f).catch(c=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(f)}
            Error: ${c}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(f,r)=>new Promise((c,s)=>{try{let E=f(...r);c(E)}catch(E){s(E)}});let{logger:r,throttleTime:c}=f;this.logger=r!=null?r:new Be("@superviz/sdk/observer-helper"),this.throttle=c,this.callbacks=[],this.throttle&&(this.publish=(0,il.default)(this.publish,this.throttle))}};var ar=class{constructor(){this.observers={};this.subscribe=(f,r)=>{this.logger.log(`subscribed to ${f} event`),this.observers[f]||(this.observers[f]=new Mt({logger:this.logger})),this.observers[f].subscribe(r)};this.unsubscribe=(f,r)=>{if(this.logger.log(`unsubscribed from ${f} event`),!!this.observers[f]){if(!r){this.observers[f].destroy(),delete this.observers[f];return}this.observers[f].unsubscribe(r)}};this.publish=(f,r)=>{f in this.observers&&this.observers[f].publish(r)}}};ut();ut();var ol=bn(xo()),Mo=class{setConfig(f){this.configuration=f}get(f,r){return this.configuration?ol.default.get(this.configuration,f,r):r}},ae=new Mo;var Ae=class{static createUrl(f,r,c={}){let s=new URL(r,f);return Object.keys(c).forEach(E=>s.searchParams.append(E,c[E])),s.toString()}static validateApiKey(f,r){let c="/user/checkapikey",s=this.createUrl(f,c);return ie(s,"POST",{apiKey:r})}static fetchConfig(f,r){let c="/immersive-config",s=this.createUrl(f,c);return ie(s,"POST",{apiKey:r})}static fetchLimits(f,r){return Gt(this,null,function*(){let c="/user/check_limits",s=this.createUrl(f,c);return(yield ie(s,"GET","",{apikey:r})).usage})}static fetchWaterMark(f,r){return Gt(this,null,function*(){let c="/user/watermark",s=this.createUrl(f,c),{message:E}=yield ie(s,"POST",{apiKey:r});return E})}static createAnnotations(f,r,c){return Gt(this,null,function*(){let s="/annotations",E=this.createUrl(f,s);return ie(E,"POST",Bt({},c),{apikey:r})})}static updateComment(f,r,c,s){return Gt(this,null,function*(){let E=`/comments/${c}`,O=this.createUrl(f,E);return ie(O,"PUT",{text:s},{apikey:r})})}static createComment(f,r,c){return Gt(this,null,function*(){let s="/comments",E=this.createUrl(f,s);return ie(E,"POST",Bt({},c),{apikey:r})})}static fetchAnnotation(f,r,c){return Gt(this,null,function*(){let s="/annotations",E=this.createUrl(f,s,{roomId:c.roomId,url:c.url});return ie(E,"GET",void 0,{apikey:r})})}static resolveAnnotation(f,r,c){return Gt(this,null,function*(){let s=`/annotations/resolve/${c}`,E=this.createUrl(f,s);return ie(E,"POST",{},{apikey:r})})}static deleteComment(f,r,c){return Gt(this,null,function*(){let s=`/comments/${c}`,E=this.createUrl(f,s);return ie(E,"DELETE",{},{apikey:r})})}static deleteAnnotation(f,r,c){return Gt(this,null,function*(){let s=`/annotations/${c}`,E=this.createUrl(f,s);return ie(E,"DELETE",{},{apikey:r})})}static createOrUpdateParticipant(f){return Gt(this,null,function*(){let r=ae.get("apiUrl"),c="/participants",s=this.createUrl(r,c);return ie(s,"POST",Bt({},f),{apikey:ae.get("apiKey")})})}static sendActivity(f,r,c,s){return Gt(this,null,function*(){let E="/activity",O=ae.get("apiUrl"),S=ae.get("roomId"),_=ae.get("apiKey"),L=this.createUrl(O,E);return ie(L,"POST",{groupId:r,groupName:c,meetingId:S,product:s,userId:f},{apikey:_})})}static validadeParticipantIsEnteringTwice(f,r,c,s){return Gt(this,null,function*(){let E=window.btoa(s),S=`https://rest.ably.io/channels/${`superviz:${r.toLowerCase()}-${c}`}/presence`;try{return(yield(yield fetch(S,{headers:{Authorization:`Basic ${E}`}})).json()).some(I=>JSON.parse(I.data).id===f.id)}catch(_){throw new Error("Failed to fetch realtime participants")}})}};ut();function u0(p,f){return Gt(this,null,function*(){try{return(yield Ae.validateApiKey(p,f))===!0}catch(r){if(r.status===404)return!1;throw new Error("Unable to validate API key")}})}var sl=u0;ut();ut();var jn=class{static getRemoteConfig(){return Gt(this,arguments,function*(f="prod"){let{version:r}=yield Promise.resolve().then(()=>(ul(),al));if(f==="local"){let{remoteConfig:E}=yield Promise.resolve().then(()=>(cl(),ll));return E}let c={version:r,environment:f},s=this.createUrl(c);return ie(s,"GET",null)})}static createUrl({version:f,environment:r}){return`${this.REMOTE_CONFIG_BASE_URL}/${f}?env=${r}`}};jn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";ut();var Go=bn(xo());ut();ut();ut();var lr=class{constructor(){this.observers=new Map;this.subscribe=(f,r)=>{this.logger.log("event bus service @ subscribe",{event:f,callback:r}),this.observers.has(f)||this.observers.set(f,new Mt),this.observers.get(f).subscribe(r)};this.unsubscribe=(f,r)=>{this.logger.log("event bus service @ unsubscribe",{event:f,callback:r}),this.observers.has(f)&&(this.observers.get(f).reset(),this.observers.delete(f))};this.publish=(f,r)=>{this.logger.log("event bus service @ publish",{event:f,data:r}),this.observers.has(f)&&this.observers.get(f).publish(r)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(f=>{f.reset(),f.destroy()}),this.observers.clear()};this.logger=new Be("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};ut();ut();var Lo=(E=>(E.presence3dMatterport="presence",E.presence3dAutodesk="presence",E.presence3dThreejs="presence",E.realtime="presence",E.whoIsOnline="presence",E))(Lo||{});var cr=class{static checkComponentLimit(f){var s,E;let r=(s=Lo[f])!=null?s:f,c=ae.get("limits");return(E=c==null?void 0:c[r])!=null?E:!1}};ut();ut();var Bo=bn(fl()),In=bn(_o());ut();var ii=(g=>(g[g.yellow=0]="yellow",g[g.turquoise=1]="turquoise",g[g.orange=2]="orange",g[g.blue=3]="blue",g[g.pink=4]="pink",g[g.purple=5]="purple",g[g.green=6]="green",g[g.red=7]="red",g[g.bluedark=8]="bluedark",g[g.pinklight=9]="pinklight",g[g.purplelight=10]="purplelight",g[g.greenlight=11]="greenlight",g[g.orangelight=12]="orangelight",g[g.bluelight=13]="bluelight",g[g.redlight=14]="redlight",g[g.brown=15]="brown",g[g.gray=16]="gray",g))(ii||{}),No=(p=>(p[p["#FFEF33"]=0]="#FFEF33",p[p["#31E0B0"]=1]="#31E0B0",p[p["#FF5E10"]=2]="#FF5E10",p[p["#00ABF7"]=3]="#00ABF7",p[p["#FF00BB"]=4]="#FF00BB",p[p["#9C29FF"]=5]="#9C29FF",p[p["#6FDD00"]=6]="#6FDD00",p[p["#E30000"]=7]="#E30000",p[p["#304AFF"]=8]="#304AFF",p[p["#FF89C4"]=9]="#FF89C4",p[p["#D597FF"]=10]="#D597FF",p[p["#C6EC5C"]=11]="#C6EC5C",p[p["#FFA115"]=12]="#FFA115",p[p["#75DEFE"]=13]="#75DEFE",p[p["#FAA291"]=14]="#FAA291",p[p["#BB813F"]=15]="#BB813F",p[p["#878291"]=16]="#878291",p))(No||{});ut();var Uo=(_=>(_[_.DISCONNECTED=0]="DISCONNECTED",_[_.INITIALIZING=1]="INITIALIZING",_[_.READY_TO_JOIN=2]="READY_TO_JOIN",_[_.CONNECTING=3]="CONNECTING",_[_.CONNECTED=4]="CONNECTED",_[_.JOINED=5]="JOINED",_[_.FAILED=-1]="FAILED",_[_.RETRYING=-2]="RETRYING",_))(Uo||{});ut();var oi=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new Be("@superviz/sdk/realtime-service"),this.participantsObserver=new Mt({logger:this.logger}),this.participantJoinedObserver=new Mt({logger:this.logger}),this.participantLeaveObserver=new Mt({logger:this.logger}),this.syncPropertiesObserver=new Mt({logger:this.logger}),this.reconnectObserver=new Mt({logger:this.logger}),this.roomInfoUpdatedObserver=new Mt({logger:this.logger}),this.roomListUpdatedObserver=new Mt({logger:this.logger}),this.hostObserver=new Mt({logger:this.logger}),this.hostAvailabilityObserver=new Mt({logger:this.logger}),this.realtimeStateObserver=new Mt({logger:this.logger}),this.kickAllParticipantsObserver=new Mt({logger:this.logger}),this.kickParticipantObserver=new Mt({logger:this.logger}),this.authenticationObserver=new Mt({logger:this.logger}),this.domainRefusedObserver=new Mt({logger:this.logger}),this.commentsObserver=new Mt({logger:this.logger}),this.presenceMouseObserver=new Mt({logger:this.logger}),this.privateModeWIOObserver=new Mt({logger:this.logger}),this.followWIOObserver=new Mt({logger:this.logger}),this.gatherWIOObserver=new Mt({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Mt({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Mt({logger:this.logger}),this.presenceSlotsInfosObserver=new Mt({logger:this.logger}),this.presence3dObserver=new Mt({logger:this.logger}),this.presence3dLeaveObserver=new Mt({logger:this.logger}),this.presence3dJoinedObserver=new Mt({logger:this.logger})}subscribeToParticipantUpdate(f,r){this.participantObservers[f]||(this.participantObservers[f]=new Mt({logger:this.logger})),this.participantObservers[f].subscribe(r)}unsubscribeFromParticipantUpdate(f,r){this.participantObservers[f]&&this.participantObservers[f].unsubscribe(r)}subscribeToParticipant3DUpdate(f,r){this.participants3DObservers[f]||(this.participants3DObservers[f]=new Mt({logger:this.logger})),this.participants3DObservers[f].subscribe(r)}unsubscribeFromParticipant3DUpdate(f,r){this.participants3DObservers[f]&&this.participants3DObservers[f].unsubscribe(r)}getSlotColor(f){let r=f!=null?f:16;return{color:No[r],name:ii[r]}}};var h0=1e3*60,dl=6e4,p0=1e4,hl=1e3,g0=100,Rn=null,kn=class extends oi{constructor(r,c){super();this.participants={};this.participantsWIO={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceWIOChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=r=>{if(!r){this.updateRoomProperties({hostClientId:null});return}let c=this.participants[r];this.updateRoomProperties({hostClientId:c.clientId})};this.setKickParticipant=r=>{if(!r)return;let c=this.participants[r];this.updateRoomProperties({kickParticipant:c})};this.freezeSync=r=>{var c,s;if(this.isSyncFrozen=r,r){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(c=this.broadcastChannel)==null||c.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(s=this.broadcastChannel)==null||s.unsubscribe();return}this.join()};this.setParticipantData=r=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,r),this.updatePresence3D(this.myParticipant.data)};this.setKickParticipantsOnHostLeave=r=>{this.shouldKickParticipantsOnHostLeave=r};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(r=>{if(this.clientSyncPropertiesQueue[r]=this.clientSyncPropertiesQueue[r].sort((O,S)=>O.timestamp-S.timestamp),!this.clientSyncPropertiesQueue[r].length)return;let{data:c,lengthToBeSplitted:s}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[r]),E=c;this.clientSyncPropertiesQueue[r].splice(0,s),this.clientSyncChannel.publish(r,E,O=>{!O||this.logger.log("REALTIME","Error in publish client sync properties",O.message)})})};this.saveClientRoomState=(r,c)=>Gt(this,null,function*(){let s=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},s,{[r]:c[c.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=r=>Gt(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,r),this.roomInfoUpdatedObserver.publish(this.localRoomProperties);let c=Object.values(this.participants).some(s=>{var E,O;return((O=(E=s.data)==null?void 0:E.activeComponents)==null?void 0:O.includes("videoConference"))&&s.data.type==="host"});r.hostClientId&&c&&Rn&&(clearTimeout(Rn),Rn=null,this.hostAvailabilityObserver.publish(!0)),!r.hostClientId&&c?(this.hostParticipantId=null,this.hostPassingHandle()):!!(r!=null&&r.hostClientId)&&(r==null?void 0:r.hostClientId)!==this.hostParticipantId?this.updateHostInfo(r.hostClientId):!c&&!!(r!=null&&r.hostClientId)?this.updateHostInfo(null):!r.hostClientId&&!Rn&&!c&&this.hostParticipantId&&(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),r.kickParticipant&&r.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,In.default)((r={})=>{let c=r;this.isMessageTooBig(c)||this.left||!this.enableSync||this.isSyncFrozen||(c.avatar===void 0&&delete c.avatar,this.myParticipant.data=Bt(Bt({},this.myParticipant.data),c),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},hl);this.updateRoomProperties=r=>{if(this.isMessageTooBig(r)||this.isSyncFrozen||this.left)return;let c=Bt(Bt({},this.localRoomProperties),r);this.supervizChannel.publish("update",c)};this.updateParticipants=()=>{let r={};this.supervizChannel.presence.get((c,s)=>{s.forEach(E=>{r[E.clientId]=Bt({},E)}),this.participants=r,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=r=>{let c=[];if(this.supervizChannel.presence.get((E,O)=>{O.forEach(S=>{E||c.push({clientId:S.clientId,type:S.data.type})})}),!r||!c.some(E=>E.clientId===r&&E.type==="host")){this.hostPassingHandle();return}Rn&&(clearTimeout(Rn),this.hostAvailabilityObserver.publish(!0));let s=this.hostParticipantId;this.hostParticipantId=r,this.hostObserver.publish({oldHostParticipantId:s,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var c;let r={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((c=this.myParticipant)==null?void 0:c.data.type)==="host"&&(r.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(r)};this.hostPassingHandle=(0,In.default)(()=>Gt(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((r,c)=>{let s=c.filter(O=>O.data.type==="host").map(O=>O.clientId);if(this.shouldKickParticipantsOnHostLeave&&!s.length){this.hostAvailabilityObserver.publish(!1),Rn=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},h0),this.setHost(null);return}let E=s[0];(E===this.localParticipantId||!s.length)&&this.setHost(E)})}),1e3);this.findSlotIndex=r=>{let c=r,s=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((S,_)=>{if(S){s=[];return}_.forEach(L=>{L.connectionId===c.connectionId&&(c=L),L.connectionId!==c.connectionId&&L.data.hasOwnProperty("slotIndex")&&s.splice(s.indexOf(L.data.slotIndex),1)})}),s.length===0)return;let E=s[0];this.myParticipant.data.slotIndex=E,this.updateMyProperties({slotIndex:E});let O=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(c)},O)};this.confirmSlot=(0,In.default)(r=>Gt(this,null,function*(){let c=[],s=r;if(this.supervizChannel.presence.get((E,O)=>{O.forEach(S=>{S.connectionId===s.connectionId&&(s=S),S.connectionId!==s.connectionId&&S.data.slotIndex!==void 0&&c.push(S.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||c.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(s);else{let E=yield this.fetchRoomProperties();this.updateRoomProperties(E)}}),1e3);this.onParticipantJoin=r=>{this.updateParticipants(),this.participantJoinedObserver.publish(r),this.updateMyProperties()};this.syncBroadcast=(0,In.default)(()=>{let r=btoa(this.ablyKey),c=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(c,{headers:{Authorization:`Basic ${r}`}}).then(s=>s.json()).then(s=>{this.broadcastChannel.publish("update",s)})},1e3);this.isMessageTooBig=(r,c=dl)=>{let s=JSON.stringify(r);return new TextEncoder().encode(s).length>c?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=r=>{this.logger.log("REALTIME","Comments channel update",r),this.commentsObserver.publish(r)};this.updateComments=r=>{this.commentsChannel.publish("update",r)};this.enterPresenceMouseChannel=r=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(r)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel.presence.leave(),this.presenceMouseChannel=null)};this.updatePresenceMouse=(0,In.default)(r=>{let c=Object.assign({},this.participantsMouse[r.id]||{},r);this.presenceMouseChannel.presence.update(c)},g0);this.onPresenceMouseChannelEnter=r=>{let c=this.getParticipantSlot(r.clientId);this.participantsMouse[r.clientId]=Ue(Bt({},r.data),{slotIndex:c,color:this.getSlotColor(c).color}),this.presenceMouseParticipantJoinedObserver.publish(this.participantsMouse[r.clientId])};this.onPresenceMouseChannelLeave=r=>{this.presenceMouseParticipantLeaveObserver.publish(this.participantsMouse[r.clientId]),delete this.participantsMouse[r.clientId]};this.publishPresenceMouseUpdate=r=>{let c=this.getParticipantSlot(r.clientId);this.participantsMouse[r.clientId]=Ue(Bt({},r.data),{slotIndex:c,color:this.getSlotColor(c).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.enterWIOChannel=r=>{this.presenceWIOChannel||(this.presenceWIOChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-wio`)),this.presenceWIOChannel.attach(),this.presenceWIOChannel.subscribe("private",this.onSetPrivate),this.presenceWIOChannel.subscribe("follow",this.onSetFollow),this.presenceWIOChannel.subscribe("gather",this.onSetGather)};this.leaveWIOChannel=()=>{!this.presenceWIOChannel||(this.presenceWIOChannel.unsubscribe(),this.presenceWIOChannel.detach(),this.presenceWIOChannel=null)};this.onSetPrivate=({data:{id:r,isPrivate:c}})=>{this.participants[r].data.isPrivate=c,this.privateModeWIOObserver.publish(this.participants)};this.onSetFollow=r=>{this.followWIOObserver.publish(r)};this.onSetGather=({data:r})=>{this.gatherWIOObserver.publish({detail:{id:r.id}})};this.setPrivateWIOParticipant=(r,c)=>{this.presenceWIOChannel.publish("private",{id:r,isPrivate:c})};this.setFollowWIOParticipant=r=>{this.presenceWIOChannel.publish("follow",Bt({},r))};this.setGatherWIOParticipant=r=>{this.presenceWIOChannel.publish("gather",Bt({},r))};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=(0,In.default)(r=>{var s,E,O;if(!r||!r.id)return;let c=Object.assign({},(E=(s=this.participantsOn3d[r.id])==null?void 0:s.data)!=null?E:{},r);this.participantsOn3d[r.id]=Ue(Bt({},this.participants[c.id]),{data:Bt(Bt({},c),(O=this.participants[c.id])==null?void 0:O.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(c)},hl);this.onPresence3DChannelEnter=r=>{var s;r.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let c=this.getParticipantSlot(r.clientId);this.presence3dJoinedObserver.publish(Ue(Bt({},r),{data:Ue(Bt(Bt({},r.data),(s=this.participants[r.clientId])==null?void 0:s.data),{slotIndex:c,color:this.getSlotColor(c).color})}))};this.onPresence3DChannelLeave=r=>{delete this.participantsOn3d[r.clientId],this.presence3dLeaveObserver.publish(r)};this.publish3DUpdate=r=>{var E;let c=this.getParticipantSlot(r.clientId),s=Ue(Bt({},r),{data:Ue(Bt(Bt({},r.data),(E=this.participants[r.clientId])==null?void 0:E.data),{slotIndex:c,color:this.getSlotColor(c).color})});this.participantsOn3d[r.clientId]=s,this.participants3DObservers[r.clientId]&&this.participants3DObservers[r.clientId].publish(s),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=c,this.apiUrl=r,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var r;return(r=this.roomProperties)==null?void 0:r.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var r,c;return(c=(r=this.myParticipant.data)==null?void 0:r.participantId)!=null?c:null}get isBroadcast(){return Object.values(this.participants).some(r=>r.data.type==="audience")}start({participant:r,roomId:c,apiKey:s}){this.myParticipant={data:Ue(Bt({},r),{participantId:r.id}),timestamp:null,action:null,clientId:r.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=r.type!=="audience",this.roomId=`superviz:${c.toLowerCase()}-${s}`,this.apiKey=s,this.client||this.buildClient()}auth(r,c){if(!this.domainWhitelisted)return;let s=new Bo.default.Rest({key:this.ablyKey}),{origin:E}=window.location;s.auth.requestToken(r,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:E,apiKey:this.apiKey}},(O,S)=>{var _;O&&this.authenticationObserver.publish("realtime.authentication-failed"),(_=O==null?void 0:O.message)!=null&&_.includes("this domain don't have permission")&&(this.domainWhitelisted=!1,this.domainRefusedObserver.publish(this.domainWhitelisted)),c(O,S)})}join(r){let c=r?Object.assign({},r,{participantId:r.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(c),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(r){let c=this.localRoomProperties;this.updateRoomProperties(Object.assign({},c,{isGridModeEnable:r}))}setDrawing(r){let c=this.localRoomProperties;this.updateRoomProperties(Object.assign({},c,{drawing:r}))}setTranscript(r){let c=this.localRoomProperties;this.updateRoomProperties(Object.assign({},c,{transcript:r}))}setSyncProperty(r,c){let s=(E,O)=>({name:E,data:O,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(s(r,c),p0)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",r,c),this.clientSyncPropertiesQueue[r]||(this.clientSyncPropertiesQueue[r]=[]),this.clientSyncPropertiesQueue[r].push(s(r,c))}setFollowParticipant(r){this.updateRoomProperties({followParticipantId:r})}setGather(r){this.updateRoomProperties({gather:r})}getParticipantSlot(r){var c,s;if(r){let E=r.toString();if(this.participants&&this.participants[E])return(s=(c=this.participants[r])==null?void 0:c.data)==null?void 0:s.slotIndex}return 16}onAblyPresenceEnter(r){r.clientId===this.myParticipant.data.participantId?this.onJoinRoom(r):this.onParticipantJoin(r)}onAblyPresenceUpdate(r){var _,L,y,I,u;if(!this.isJoinedRoom)return;let{clientId:c}=r,s=Object.assign({},r,{participantId:r.clientId}),E=(y=(L=(_=this.participants[s.clientId])==null?void 0:_.data)==null?void 0:L.activeComponents)==null?void 0:y.includes("videoConference"),O=(u=(I=s.data)==null?void 0:I.activeComponents)==null?void 0:u.includes("videoConference"),S=E&&!O;this.publishParticipantUpdate(s),this.participants&&this.participants[c]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast(),S&&this.hostPassingHandle()}onAblyPresenceLeave(r){this.onParticipantLeave(r)}onClientSyncChannelUpdate(r){let{name:c,data:s}=r,E={};E[c]=s,this.syncPropertiesObserver.publish(E),r.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(c,s)}onReceiveBroadcastSync(r){r.data.forEach(s=>{var O;let E=s.clientId;this.participants[E]=s,(O=s.data)!=null&&O.isAudience||(this.participants[E].data=JSON.parse(this.participants[E].data),this.publishParticipantUpdate(this.participants[E]))})}onAblyRoomUpdate(r){this.updateLocalRoomState(r.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let r={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Bo.default.Realtime(r),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(r){this.participants[r.clientId]=r,this.participantsObserver.publish(this.participants),this.participantObservers[r.clientId]&&this.participantObservers[r.clientId].publish(r)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(r){throw this.logger.log(r),new Error(r)}publishStateUpdate(r){this.state!==r&&(this.state=r,this.logger.log("REALTIME",`Realtime state did change. New state: ${Uo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((r,c)=>{this.supervizChannel.history((s,E)=>{var S;s&&c(s);let O=(S=E.items[0])==null?void 0:S.data;r(O||null)})})}fetchSyncClientProperty(r){return Gt(this,null,function*(){try{let c=yield new Promise((s,E)=>{this.clientRoomStateChannel.history((O,S)=>{var L;O&&E(O);let _=(L=S==null?void 0:S.items[0])==null?void 0:L.data;s(_||null)})});if(r&&!c[r])throw new Error(`Event ${r} not found in the history`);return r?c[r]:c}catch(c){this.logger.log("REALTIME","Error in fetch client realtime data",c.message),this.throw(c.message)}})}onStateChange(){var y,I,u;let r=(y=this.supervizChannelState)==null?void 0:y.current,c=(I=this.connectionState)==null?void 0:I.current,s=c==="connected",E=["initialized","connecting"].includes(c),O=["closed","closing"].includes(c)||["detaching","detached"].includes(r),S={[0]:O,[1]:E,[2]:!r&&s,[3]:r==="attaching",[4]:r==="attached"&&s,[-1]:r==="failed"||c==="failed",[-2]:c==="suspended"||r==="suspended"},_=Object.entries(S).find(([C,x])=>x&&C)[0],L=Number(_);if(!!this.domainWhitelisted){if(L===2&&(this.currentReconnectAttempt=0),s&&this.isReconnecting&&this.onJoinRoom(this.participant),(L===-2||L===-1)&&this.forceReconnect(),(u=this.connectionState)!=null&&u.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(L)}}onAblyConnectionStateChange(r){this.connectionState=r,this.onStateChange()}onAblyChannelStateChange(r){this.supervizChannelState=r,this.onStateChange()}onJoinRoom(r){return Gt(this,null,function*(){var c;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(r),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let s=this.myParticipant.data.type==="host";(c=this.localRoomProperties)!=null&&c.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):s&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(r),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(r){if(this.state===2)return;let c=r.data.participantId===this.hostParticipantId;r.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(r),c&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}spliceArrayBySize(r,c=dl){let s=_=>{let L=JSON.stringify(_);return new TextEncoder().encode(L).length},E=0,O=[],S=[];for(let _=0;_<r.length;_++){let L=s(r[_]);E+L<=c?(S.push(r[_]),E+=L):(O.push(S),S=[r[_]],E=L)}return S.length>0&&O.push(S),{data:O[0],lengthToBeSplitted:O[0].length}}enterPresence3DChannel(r){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(r)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(r)}};ut();var Fo=class extends ar{constructor({participant:r,group:c}){super();this.isDestroyed=!1;this.activeComponents=[];this.activeComponentsInstances=[];this.eventBus=new lr;this.participants=[];this.addComponent=r=>{var c,s,E;!this.canAddComponent(r)||(r.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:ae.configuration,eventBus:this.eventBus}),this.activeComponents.push(r.name),this.activeComponentsInstances.push(r),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),Ae.sendActivity(this.participant.id,this.group.id,this.group.name,r.name),Ae.createOrUpdateParticipant({name:(c=this.participant)==null?void 0:c.name,participantId:(s=this.participant)==null?void 0:s.id,avatar:(E=this.participant)==null?void 0:E.avatar.imageUrl}))};this.removeComponent=r=>{if(!this.activeComponents.includes(r.name)){let c=`Component ${r.name} is not initialized yet.`;this.logger.log(c);return}r.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(c=>c.name!==r.name),this.activeComponents.splice(this.activeComponents.indexOf(r.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.destroy=()=>{this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(r=>{this.logger.log("launcher service @ destroy - removing component",r.name),this.removeComponent(r)}),this.activeComponents=[],this.activeComponentsInstances=[],this.participant=void 0,this.eventBus.destroy(),this.eventBus=void 0,this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeave),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.hostObserver.unsubscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.unsubscribe(this.onHostAvailabilityChange),this.realtime.leave(),this.realtime=void 0,this.isDestroyed=!0};this.canAddComponent=r=>{var S;let c=(S=this.realtime)==null?void 0:S.isDomainWhitelisted,s=cr.checkComponentLimit(r.name),E=this.activeComponents.includes(r.name),O=[{isValid:!this.isDestroyed,message:"Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:c,message:`Component ${r.name} can't be used because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dev-dashboard.superviz.com/developer`},{isValid:!E,message:`Component ${r.name} is already active. Please remove it first`},{isValid:s,message:`You reached the limit usage of ${r.name}`}];for(let _=0;_<O.length;_++){let{isValid:L,message:y}=O[_];if(!L)return this.logger.log(y),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:ae.get("apiKey"),roomId:ae.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=r=>{var E;this.logger.log("launcher service @ onParticipantListUpdate",r);let c=Object.values(r).map(O=>{var S,_,L,y,I,u;return{id:O.data.id,name:(S=O.data)==null?void 0:S.name,type:(_=O.data)==null?void 0:_.type,avatar:(L=O.data)==null?void 0:L.avatar,avatarConfig:(y=O.data)==null?void 0:y.avatarConfig,isHost:this.realtime.hostClientId===O.clientId,color:this.realtime.getSlotColor((I=O.data)==null?void 0:I.slotIndex).color,activeComponents:(u=O.data)==null?void 0:u.activeComponents}}),s=c.find(O=>{var S;return(O==null?void 0:O.id)===((S=this.participant)==null?void 0:S.id)});(0,Go.isEqual)(this.participants,c)||(this.participants=c,this.publish("participant.list-updated",c),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",c)),s&&!(0,Go.isEqual)(this.participant,s)&&(this.activeComponents=(E=s.activeComponents)!=null?E:[],this.activeComponentsInstances=this.activeComponentsInstances.filter(O=>s.activeComponents?this.activeComponents.includes(O.name):!0),this.participant=s,this.publish("participant.updated",s),this.logger.log("Publishing ParticipantEvent.UPDATED",s)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",c)};this.onParticipantJoined=r=>{this.logger.log("launcher service @ onParticipantJoined");let c=this.participants.find(s=>s.id===r.data.id);!c||(c.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",c)),this.logger.log("launcher service @ onParticipantJoined - participant joined",c),this.publish("participant.joined",c))};this.onParticipantLeave=r=>{this.logger.log("launcher service @ onParticipantLeave");let c=this.participants.find(s=>s.id===r.data.id);!c||(c.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",c)),this.logger.log("launcher service @ onParticipantLeave - participant left",c),this.publish("participant.left",c))};this.onHostParticipantDidChange=r=>{let c=this.participants.find(s=>s.id===(r==null?void 0:r.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",c),this.publish("realtime.host-change",c))};this.onHostAvailabilityChange=r=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),r){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=Ue(Bt({},r),{type:"guest"}),this.group=c,this.logger=new Be("@superviz/sdk/launcher"),this.realtime=new kn(ae.get("apiUrl"),ae.get("ablyKey")),this.eventBus=new lr,this.logger.log("launcher created"),this.startRealtime()}},pl=p=>{let f=new Fo(p);return{destroy:f.destroy,subscribe:f.subscribe,unsubscribe:f.unsubscribe,addComponent:f.addComponent,removeComponent:f.removeComponent}};var v0=({group:p,participant:f,roomId:r,customColors:c})=>{if(c&&m0(c),!p||!p.name||!p.id)throw new Error("Group fields is required");if(!f||!f.id||!f.name)throw new Error("Participant name and id is required");if(!r)throw new Error("Room id is required")},m0=p=>{Object.entries(p).forEach(([f,r])=>{if(!Object.values(Eo).includes(f))throw new Error(`Color ${f} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(r))throw new Error(`Color ${f} is not a valid color variable value. Please check the documentation for more information.`)})},y0=(p,f)=>Gt(void 0,null,function*(){if(!(p&&p.trim()))throw new Error("API key is required");if(!f)throw new Error("Options is required");v0(f),f.debug?Ho.debug.enable("*"):Ho.debug.disable();let{apiUrl:c,conferenceLayerUrl:s}=yield jn.getRemoteConfig(f.environment);if(!(yield sl(c,p)))throw new Error("Failed to validate API key");let O=yield Ae.fetchConfig(c,p),S=yield Ae.fetchLimits(c,p),_=yield Ae.fetchWaterMark(c,p);if(!O||!O.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:L}=O;if(yield Ae.validadeParticipantIsEnteringTwice(f.participant,f.roomId,p,L))throw new Error("Participant is already in the room");return ae.setConfig({apiUrl:c,ablyKey:L,apiKey:p,conferenceLayerUrl:s,environment:O,roomId:f.roomId,debug:f.debug,limits:S,waterMark:_,colors:f.customColors}),pl(f)}),oC=y0;export{oC as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
