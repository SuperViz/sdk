var xv=Object.create;var go=Object.defineProperty,Mv=Object.defineProperties,Lv=Object.getOwnPropertyDescriptor,Dv=Object.getOwnPropertyDescriptors,Nv=Object.getOwnPropertyNames,ou=Object.getOwnPropertySymbols,Uv=Object.getPrototypeOf,su=Object.prototype.hasOwnProperty,Bv=Object.prototype.propertyIsEnumerable;var au=(v,h,r)=>h in v?go(v,h,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[h]=r,ln=(v,h)=>{for(var r in h||(h={}))su.call(h,r)&&au(v,r,h[r]);if(ou)for(var r of ou(h))Bv.call(h,r)&&au(v,r,h[r]);return v},uu=(v,h)=>Mv(v,Dv(h));var Gv=(v,h)=>()=>(v&&(h=v(v=0)),h);var Jt=(v,h)=>()=>(h||v((h={exports:{}}).exports,h),h.exports);var Fv=(v,h,r,g)=>{if(h&&typeof h=="object"||typeof h=="function")for(let a of Nv(h))!su.call(v,a)&&a!==r&&go(v,a,{get:()=>h[a],enumerable:!(g=Lv(h,a))||g.enumerable});return v};var En=(v,h,r)=>(r=v!=null?xv(Uv(v)):{},Fv(h||!v||!v.__esModule?go(r,"default",{value:v,enumerable:!0}):r,v));var cn=(v,h,r)=>new Promise((g,a)=>{var N=P=>{try{E(r.next(P))}catch(F){a(F)}},I=P=>{try{E(r.throw(P))}catch(F){a(F)}},E=P=>P.done?g(P.value):Promise.resolve(P.value).then(N,I);E((r=r.apply(v,h)).next())});var _t,ct=Gv(()=>{_t={}});var vo=Jt((_n,$n)=>{ct();(function(){var v,h="4.17.21",r=200,g="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",N="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",E=500,P="__lodash_placeholder__",F=1,S=2,b=4,u=1,A=2,w=1,T=2,m=4,d=8,y=16,o=32,c=64,s=128,f=256,i=512,p=30,R="...",L=800,z=16,H=1,D=2,C=3,_=1/0,j=9007199254740991,W=17976931348623157e292,Q=0/0,Z=4294967295,q=Z-1,G=Z>>>1,M=[["ary",s],["bind",w],["bindKey",T],["curry",d],["curryRight",y],["flip",i],["partial",o],["partialRight",c],["rearg",f]],U="[object Arguments]",K="[object Array]",k="[object AsyncFunction]",tt="[object Boolean]",ut="[object Date]",vt="[object DOMException]",gt="[object Error]",Ot="[object Function]",Mt="[object GeneratorFunction]",lt="[object Map]",xt="[object Number]",qt="[object Null]",Ut="[object Object]",Ht="[object Promise]",ae="[object Proxy]",X="[object RegExp]",rt="[object Set]",st="[object String]",ht="[object Symbol]",bt="[object Undefined]",Kt="[object WeakMap]",Ze="[object WeakSet]",Ln="[object ArrayBuffer]",hn="[object DataView]",Jr="[object Float32Array]",Qr="[object Float64Array]",$r="[object Int8Array]",qr="[object Int16Array]",Yr="[object Int32Array]",Xr="[object Uint8Array]",Zr="[object Uint8ClampedArray]",ti="[object Uint16Array]",ei="[object Uint32Array]",Yu=/\b__p \+= '';/g,Xu=/\b(__p \+=) '' \+/g,Zu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wo=/&(?:amp|lt|gt|quot|#39);/g,xo=/[&<>"']/g,tf=RegExp(wo.source),ef=RegExp(xo.source),nf=/<%-([\s\S]+?)%>/g,rf=/<%([\s\S]+?)%>/g,Mo=/<%=([\s\S]+?)%>/g,of=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,af=/^\w*$/,sf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ni=/[\\^$.*+?()[\]{}|]/g,uf=RegExp(ni.source),ri=/^\s+/,ff=/\s/,lf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,cf=/\{\n\/\* \[wrapped with (.+)\] \*/,df=/,? & /,hf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pf=/[()=,{}\[\]\/\s]/,gf=/\\(\\)?/g,vf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Lo=/\w*$/,mf=/^[-+]0x[0-9a-f]+$/i,yf=/^0b[01]+$/i,Cf=/^\[object .+?Constructor\]$/,Af=/^0o[0-7]+$/i,Rf=/^(?:0|[1-9]\d*)$/,Of=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zn=/($^)/,Sf=/['\n\r\u2028\u2029\\]/g,tr="\\ud800-\\udfff",bf="\\u0300-\\u036f",Tf="\\ufe20-\\ufe2f",If="\\u20d0-\\u20ff",Do=bf+Tf+If,No="\\u2700-\\u27bf",Uo="a-z\\xdf-\\xf6\\xf8-\\xff",Ef="\\xac\\xb1\\xd7\\xf7",_f="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Pf="\\u2000-\\u206f",wf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Bo="A-Z\\xc0-\\xd6\\xd8-\\xde",Go="\\ufe0e\\ufe0f",Fo=Ef+_f+Pf+wf,ii="['\u2019]",xf="["+tr+"]",Ho="["+Fo+"]",er="["+Do+"]",Wo="\\d+",Mf="["+No+"]",zo="["+Uo+"]",jo="[^"+tr+Fo+Wo+No+Uo+Bo+"]",oi="\\ud83c[\\udffb-\\udfff]",Lf="(?:"+er+"|"+oi+")",Vo="[^"+tr+"]",ai="(?:\\ud83c[\\udde6-\\uddff]){2}",si="[\\ud800-\\udbff][\\udc00-\\udfff]",pn="["+Bo+"]",ko="\\u200d",Ko="(?:"+zo+"|"+jo+")",Df="(?:"+pn+"|"+jo+")",Jo="(?:"+ii+"(?:d|ll|m|re|s|t|ve))?",Qo="(?:"+ii+"(?:D|LL|M|RE|S|T|VE))?",$o=Lf+"?",qo="["+Go+"]?",Nf="(?:"+ko+"(?:"+[Vo,ai,si].join("|")+")"+qo+$o+")*",Uf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Bf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Yo=qo+$o+Nf,Gf="(?:"+[Mf,ai,si].join("|")+")"+Yo,Ff="(?:"+[Vo+er+"?",er,ai,si,xf].join("|")+")",Hf=RegExp(ii,"g"),Wf=RegExp(er,"g"),ui=RegExp(oi+"(?="+oi+")|"+Ff+Yo,"g"),zf=RegExp([pn+"?"+zo+"+"+Jo+"(?="+[Ho,pn,"$"].join("|")+")",Df+"+"+Qo+"(?="+[Ho,pn+Ko,"$"].join("|")+")",pn+"?"+Ko+"+"+Jo,pn+"+"+Qo,Bf,Uf,Wo,Gf].join("|"),"g"),jf=RegExp("["+ko+tr+Do+Go+"]"),Vf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,kf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Kf=-1,Ft={};Ft[Jr]=Ft[Qr]=Ft[$r]=Ft[qr]=Ft[Yr]=Ft[Xr]=Ft[Zr]=Ft[ti]=Ft[ei]=!0,Ft[U]=Ft[K]=Ft[Ln]=Ft[tt]=Ft[hn]=Ft[ut]=Ft[gt]=Ft[Ot]=Ft[lt]=Ft[xt]=Ft[Ut]=Ft[X]=Ft[rt]=Ft[st]=Ft[Kt]=!1;var Gt={};Gt[U]=Gt[K]=Gt[Ln]=Gt[hn]=Gt[tt]=Gt[ut]=Gt[Jr]=Gt[Qr]=Gt[$r]=Gt[qr]=Gt[Yr]=Gt[lt]=Gt[xt]=Gt[Ut]=Gt[X]=Gt[rt]=Gt[st]=Gt[ht]=Gt[Xr]=Gt[Zr]=Gt[ti]=Gt[ei]=!0,Gt[gt]=Gt[Ot]=Gt[Kt]=!1;var Jf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Qf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$f={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},qf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yf=parseFloat,Xf=parseInt,Xo=typeof global=="object"&&global&&global.Object===Object&&global,Zf=typeof self=="object"&&self&&self.Object===Object&&self,Yt=Xo||Zf||Function("return this")(),fi=typeof _n=="object"&&_n&&!_n.nodeType&&_n,tn=fi&&typeof $n=="object"&&$n&&!$n.nodeType&&$n,Zo=tn&&tn.exports===fi,li=Zo&&Xo.process,ye=function(){try{var $=tn&&tn.require&&tn.require("util").types;return $||li&&li.binding&&li.binding("util")}catch(nt){}}(),ta=ye&&ye.isArrayBuffer,ea=ye&&ye.isDate,na=ye&&ye.isMap,ra=ye&&ye.isRegExp,ia=ye&&ye.isSet,oa=ye&&ye.isTypedArray;function ce($,nt,et){switch(et.length){case 0:return $.call(nt);case 1:return $.call(nt,et[0]);case 2:return $.call(nt,et[0],et[1]);case 3:return $.call(nt,et[0],et[1],et[2])}return $.apply(nt,et)}function tl($,nt,et,dt){for(var At=-1,Lt=$==null?0:$.length;++At<Lt;){var Qt=$[At];nt(dt,Qt,et(Qt),$)}return dt}function Ce($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt&&nt($[et],et,$)!==!1;);return $}function el($,nt){for(var et=$==null?0:$.length;et--&&nt($[et],et,$)!==!1;);return $}function aa($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt;)if(!nt($[et],et,$))return!1;return!0}function je($,nt){for(var et=-1,dt=$==null?0:$.length,At=0,Lt=[];++et<dt;){var Qt=$[et];nt(Qt,et,$)&&(Lt[At++]=Qt)}return Lt}function nr($,nt){var et=$==null?0:$.length;return!!et&&gn($,nt,0)>-1}function ci($,nt,et){for(var dt=-1,At=$==null?0:$.length;++dt<At;)if(et(nt,$[dt]))return!0;return!1}function Wt($,nt){for(var et=-1,dt=$==null?0:$.length,At=Array(dt);++et<dt;)At[et]=nt($[et],et,$);return At}function Ve($,nt){for(var et=-1,dt=nt.length,At=$.length;++et<dt;)$[At+et]=nt[et];return $}function di($,nt,et,dt){var At=-1,Lt=$==null?0:$.length;for(dt&&Lt&&(et=$[++At]);++At<Lt;)et=nt(et,$[At],At,$);return et}function nl($,nt,et,dt){var At=$==null?0:$.length;for(dt&&At&&(et=$[--At]);At--;)et=nt(et,$[At],At,$);return et}function hi($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt;)if(nt($[et],et,$))return!0;return!1}var rl=pi("length");function il($){return $.split("")}function ol($){return $.match(hf)||[]}function sa($,nt,et){var dt;return et($,function(At,Lt,Qt){if(nt(At,Lt,Qt))return dt=Lt,!1}),dt}function rr($,nt,et,dt){for(var At=$.length,Lt=et+(dt?1:-1);dt?Lt--:++Lt<At;)if(nt($[Lt],Lt,$))return Lt;return-1}function gn($,nt,et){return nt===nt?ml($,nt,et):rr($,ua,et)}function al($,nt,et,dt){for(var At=et-1,Lt=$.length;++At<Lt;)if(dt($[At],nt))return At;return-1}function ua($){return $!==$}function fa($,nt){var et=$==null?0:$.length;return et?vi($,nt)/et:Q}function pi($){return function(nt){return nt==null?v:nt[$]}}function gi($){return function(nt){return $==null?v:$[nt]}}function la($,nt,et,dt,At){return At($,function(Lt,Qt,Bt){et=dt?(dt=!1,Lt):nt(et,Lt,Qt,Bt)}),et}function sl($,nt){var et=$.length;for($.sort(nt);et--;)$[et]=$[et].value;return $}function vi($,nt){for(var et,dt=-1,At=$.length;++dt<At;){var Lt=nt($[dt]);Lt!==v&&(et=et===v?Lt:et+Lt)}return et}function mi($,nt){for(var et=-1,dt=Array($);++et<$;)dt[et]=nt(et);return dt}function ul($,nt){return Wt(nt,function(et){return[et,$[et]]})}function ca($){return $&&$.slice(0,ga($)+1).replace(ri,"")}function de($){return function(nt){return $(nt)}}function yi($,nt){return Wt(nt,function(et){return $[et]})}function Dn($,nt){return $.has(nt)}function da($,nt){for(var et=-1,dt=$.length;++et<dt&&gn(nt,$[et],0)>-1;);return et}function ha($,nt){for(var et=$.length;et--&&gn(nt,$[et],0)>-1;);return et}function fl($,nt){for(var et=$.length,dt=0;et--;)$[et]===nt&&++dt;return dt}var ll=gi(Jf),cl=gi(Qf);function dl($){return"\\"+qf[$]}function hl($,nt){return $==null?v:$[nt]}function vn($){return jf.test($)}function pl($){return Vf.test($)}function gl($){for(var nt,et=[];!(nt=$.next()).done;)et.push(nt.value);return et}function Ci($){var nt=-1,et=Array($.size);return $.forEach(function(dt,At){et[++nt]=[At,dt]}),et}function pa($,nt){return function(et){return $(nt(et))}}function ke($,nt){for(var et=-1,dt=$.length,At=0,Lt=[];++et<dt;){var Qt=$[et];(Qt===nt||Qt===P)&&($[et]=P,Lt[At++]=et)}return Lt}function ir($){var nt=-1,et=Array($.size);return $.forEach(function(dt){et[++nt]=dt}),et}function vl($){var nt=-1,et=Array($.size);return $.forEach(function(dt){et[++nt]=[dt,dt]}),et}function ml($,nt,et){for(var dt=et-1,At=$.length;++dt<At;)if($[dt]===nt)return dt;return-1}function yl($,nt,et){for(var dt=et+1;dt--;)if($[dt]===nt)return dt;return dt}function mn($){return vn($)?Al($):rl($)}function Ie($){return vn($)?Rl($):il($)}function ga($){for(var nt=$.length;nt--&&ff.test($.charAt(nt)););return nt}var Cl=gi($f);function Al($){for(var nt=ui.lastIndex=0;ui.test($);)++nt;return nt}function Rl($){return $.match(ui)||[]}function Ol($){return $.match(zf)||[]}var Sl=function $(nt){nt=nt==null?Yt:Ke.defaults(Yt.Object(),nt,Ke.pick(Yt,kf));var et=nt.Array,dt=nt.Date,At=nt.Error,Lt=nt.Function,Qt=nt.Math,Bt=nt.Object,Ai=nt.RegExp,bl=nt.String,Ae=nt.TypeError,or=et.prototype,Tl=Lt.prototype,yn=Bt.prototype,ar=nt["__core-js_shared__"],sr=Tl.toString,Nt=yn.hasOwnProperty,Il=0,va=function(){var t=/[^.]+$/.exec(ar&&ar.keys&&ar.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ur=yn.toString,El=sr.call(Bt),_l=Yt._,Pl=Ai("^"+sr.call(Nt).replace(ni,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fr=Zo?nt.Buffer:v,Je=nt.Symbol,lr=nt.Uint8Array,ma=fr?fr.allocUnsafe:v,cr=pa(Bt.getPrototypeOf,Bt),ya=Bt.create,Ca=yn.propertyIsEnumerable,dr=or.splice,Aa=Je?Je.isConcatSpreadable:v,Nn=Je?Je.iterator:v,en=Je?Je.toStringTag:v,hr=function(){try{var t=sn(Bt,"defineProperty");return t({},"",{}),t}catch(e){}}(),wl=nt.clearTimeout!==Yt.clearTimeout&&nt.clearTimeout,xl=dt&&dt.now!==Yt.Date.now&&dt.now,Ml=nt.setTimeout!==Yt.setTimeout&&nt.setTimeout,pr=Qt.ceil,gr=Qt.floor,Ri=Bt.getOwnPropertySymbols,Ll=fr?fr.isBuffer:v,Ra=nt.isFinite,Dl=or.join,Nl=pa(Bt.keys,Bt),$t=Qt.max,ee=Qt.min,Ul=dt.now,Bl=nt.parseInt,Oa=Qt.random,Gl=or.reverse,Oi=sn(nt,"DataView"),Un=sn(nt,"Map"),Si=sn(nt,"Promise"),Cn=sn(nt,"Set"),Bn=sn(nt,"WeakMap"),Gn=sn(Bt,"create"),vr=Bn&&new Bn,An={},Fl=un(Oi),Hl=un(Un),Wl=un(Si),zl=un(Cn),jl=un(Bn),mr=Je?Je.prototype:v,Fn=mr?mr.valueOf:v,Sa=mr?mr.toString:v;function x(t){if(jt(t)&&!Rt(t)&&!(t instanceof Pt)){if(t instanceof Re)return t;if(Nt.call(t,"__wrapped__"))return bs(t)}return new Re(t)}var Rn=function(){function t(){}return function(e){if(!zt(e))return{};if(ya)return ya(e);t.prototype=e;var n=new t;return t.prototype=v,n}}();function yr(){}function Re(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=v}x.templateSettings={escape:nf,evaluate:rf,interpolate:Mo,variable:"",imports:{_:x}},x.prototype=yr.prototype,x.prototype.constructor=x,Re.prototype=Rn(yr.prototype),Re.prototype.constructor=Re;function Pt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function Vl(){var t=new Pt(this.__wrapped__);return t.__actions__=se(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=se(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=se(this.__views__),t}function kl(){if(this.__filtered__){var t=new Pt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Kl(){var t=this.__wrapped__.value(),e=this.__dir__,n=Rt(t),l=e<0,O=n?t.length:0,B=id(0,O,this.__views__),V=B.start,J=B.end,Y=J-V,it=l?J:V-1,ot=this.__iteratees__,at=ot.length,ft=0,pt=ee(Y,this.__takeCount__);if(!n||!l&&O==Y&&pt==Y)return Ja(t,this.__actions__);var yt=[];t:for(;Y--&&ft<pt;){it+=e;for(var Tt=-1,Ct=t[it];++Tt<at;){var Et=ot[Tt],wt=Et.iteratee,ge=Et.type,oe=wt(Ct);if(ge==D)Ct=oe;else if(!oe){if(ge==H)continue t;break t}}yt[ft++]=Ct}return yt}Pt.prototype=Rn(yr.prototype),Pt.prototype.constructor=Pt;function nn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var l=t[e];this.set(l[0],l[1])}}function Jl(){this.__data__=Gn?Gn(null):{},this.size=0}function Ql(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function $l(t){var e=this.__data__;if(Gn){var n=e[t];return n===I?v:n}return Nt.call(e,t)?e[t]:v}function ql(t){var e=this.__data__;return Gn?e[t]!==v:Nt.call(e,t)}function Yl(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Gn&&e===v?I:e,this}nn.prototype.clear=Jl,nn.prototype.delete=Ql,nn.prototype.get=$l,nn.prototype.has=ql,nn.prototype.set=Yl;function De(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var l=t[e];this.set(l[0],l[1])}}function Xl(){this.__data__=[],this.size=0}function Zl(t){var e=this.__data__,n=Cr(e,t);if(n<0)return!1;var l=e.length-1;return n==l?e.pop():dr.call(e,n,1),--this.size,!0}function tc(t){var e=this.__data__,n=Cr(e,t);return n<0?v:e[n][1]}function ec(t){return Cr(this.__data__,t)>-1}function nc(t,e){var n=this.__data__,l=Cr(n,t);return l<0?(++this.size,n.push([t,e])):n[l][1]=e,this}De.prototype.clear=Xl,De.prototype.delete=Zl,De.prototype.get=tc,De.prototype.has=ec,De.prototype.set=nc;function Ne(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var l=t[e];this.set(l[0],l[1])}}function rc(){this.size=0,this.__data__={hash:new nn,map:new(Un||De),string:new nn}}function ic(t){var e=xr(this,t).delete(t);return this.size-=e?1:0,e}function oc(t){return xr(this,t).get(t)}function ac(t){return xr(this,t).has(t)}function sc(t,e){var n=xr(this,t),l=n.size;return n.set(t,e),this.size+=n.size==l?0:1,this}Ne.prototype.clear=rc,Ne.prototype.delete=ic,Ne.prototype.get=oc,Ne.prototype.has=ac,Ne.prototype.set=sc;function rn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ne;++e<n;)this.add(t[e])}function uc(t){return this.__data__.set(t,I),this}function fc(t){return this.__data__.has(t)}rn.prototype.add=rn.prototype.push=uc,rn.prototype.has=fc;function Ee(t){var e=this.__data__=new De(t);this.size=e.size}function lc(){this.__data__=new De,this.size=0}function cc(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function dc(t){return this.__data__.get(t)}function hc(t){return this.__data__.has(t)}function pc(t,e){var n=this.__data__;if(n instanceof De){var l=n.__data__;if(!Un||l.length<r-1)return l.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ne(l)}return n.set(t,e),this.size=n.size,this}Ee.prototype.clear=lc,Ee.prototype.delete=cc,Ee.prototype.get=dc,Ee.prototype.has=hc,Ee.prototype.set=pc;function ba(t,e){var n=Rt(t),l=!n&&fn(t),O=!n&&!l&&Xe(t),B=!n&&!l&&!O&&Tn(t),V=n||l||O||B,J=V?mi(t.length,bl):[],Y=J.length;for(var it in t)(e||Nt.call(t,it))&&!(V&&(it=="length"||O&&(it=="offset"||it=="parent")||B&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||Fe(it,Y)))&&J.push(it);return J}function Ta(t){var e=t.length;return e?t[Di(0,e-1)]:v}function gc(t,e){return Mr(se(t),on(e,0,t.length))}function vc(t){return Mr(se(t))}function bi(t,e,n){(n!==v&&!_e(t[e],n)||n===v&&!(e in t))&&Ue(t,e,n)}function Hn(t,e,n){var l=t[e];(!(Nt.call(t,e)&&_e(l,n))||n===v&&!(e in t))&&Ue(t,e,n)}function Cr(t,e){for(var n=t.length;n--;)if(_e(t[n][0],e))return n;return-1}function mc(t,e,n,l){return Qe(t,function(O,B,V){e(l,O,n(O),V)}),l}function Ia(t,e){return t&&Me(e,Xt(e),t)}function yc(t,e){return t&&Me(e,fe(e),t)}function Ue(t,e,n){e=="__proto__"&&hr?hr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ti(t,e){for(var n=-1,l=e.length,O=et(l),B=t==null;++n<l;)O[n]=B?v:oo(t,e[n]);return O}function on(t,e,n){return t===t&&(n!==v&&(t=t<=n?t:n),e!==v&&(t=t>=e?t:e)),t}function Oe(t,e,n,l,O,B){var V,J=e&F,Y=e&S,it=e&b;if(n&&(V=O?n(t,l,O,B):n(t)),V!==v)return V;if(!zt(t))return t;var ot=Rt(t);if(ot){if(V=ad(t),!J)return se(t,V)}else{var at=ne(t),ft=at==Ot||at==Mt;if(Xe(t))return qa(t,J);if(at==Ut||at==U||ft&&!O){if(V=Y||ft?{}:gs(t),!J)return Y?$c(t,yc(V,t)):Qc(t,Ia(V,t))}else{if(!Gt[at])return O?t:{};V=sd(t,at,J)}}B||(B=new Ee);var pt=B.get(t);if(pt)return pt;B.set(t,V),Vs(t)?t.forEach(function(Ct){V.add(Oe(Ct,e,n,Ct,t,B))}):zs(t)&&t.forEach(function(Ct,Et){V.set(Et,Oe(Ct,e,n,Et,t,B))});var yt=it?Y?ki:Vi:Y?fe:Xt,Tt=ot?v:yt(t);return Ce(Tt||t,function(Ct,Et){Tt&&(Et=Ct,Ct=t[Et]),Hn(V,Et,Oe(Ct,e,n,Et,t,B))}),V}function Cc(t){var e=Xt(t);return function(n){return Ea(n,t,e)}}function Ea(t,e,n){var l=n.length;if(t==null)return!l;for(t=Bt(t);l--;){var O=n[l],B=e[O],V=t[O];if(V===v&&!(O in t)||!B(V))return!1}return!0}function _a(t,e,n){if(typeof t!="function")throw new Ae(a);return Jn(function(){t.apply(v,n)},e)}function Wn(t,e,n,l){var O=-1,B=nr,V=!0,J=t.length,Y=[],it=e.length;if(!J)return Y;n&&(e=Wt(e,de(n))),l?(B=ci,V=!1):e.length>=r&&(B=Dn,V=!1,e=new rn(e));t:for(;++O<J;){var ot=t[O],at=n==null?ot:n(ot);if(ot=l||ot!==0?ot:0,V&&at===at){for(var ft=it;ft--;)if(e[ft]===at)continue t;Y.push(ot)}else B(e,at,l)||Y.push(ot)}return Y}var Qe=es(xe),Pa=es(Ei,!0);function Ac(t,e){var n=!0;return Qe(t,function(l,O,B){return n=!!e(l,O,B),n}),n}function Ar(t,e,n){for(var l=-1,O=t.length;++l<O;){var B=t[l],V=e(B);if(V!=null&&(J===v?V===V&&!pe(V):n(V,J)))var J=V,Y=B}return Y}function Rc(t,e,n,l){var O=t.length;for(n=St(n),n<0&&(n=-n>O?0:O+n),l=l===v||l>O?O:St(l),l<0&&(l+=O),l=n>l?0:Ks(l);n<l;)t[n++]=e;return t}function wa(t,e){var n=[];return Qe(t,function(l,O,B){e(l,O,B)&&n.push(l)}),n}function te(t,e,n,l,O){var B=-1,V=t.length;for(n||(n=fd),O||(O=[]);++B<V;){var J=t[B];e>0&&n(J)?e>1?te(J,e-1,n,l,O):Ve(O,J):l||(O[O.length]=J)}return O}var Ii=ns(),xa=ns(!0);function xe(t,e){return t&&Ii(t,e,Xt)}function Ei(t,e){return t&&xa(t,e,Xt)}function Rr(t,e){return je(e,function(n){return He(t[n])})}function an(t,e){e=qe(e,t);for(var n=0,l=e.length;t!=null&&n<l;)t=t[Le(e[n++])];return n&&n==l?t:v}function Ma(t,e,n){var l=e(t);return Rt(t)?l:Ve(l,n(t))}function re(t){return t==null?t===v?bt:qt:en&&en in Bt(t)?rd(t):vd(t)}function _i(t,e){return t>e}function Oc(t,e){return t!=null&&Nt.call(t,e)}function Sc(t,e){return t!=null&&e in Bt(t)}function bc(t,e,n){return t>=ee(e,n)&&t<$t(e,n)}function Pi(t,e,n){for(var l=n?ci:nr,O=t[0].length,B=t.length,V=B,J=et(B),Y=1/0,it=[];V--;){var ot=t[V];V&&e&&(ot=Wt(ot,de(e))),Y=ee(ot.length,Y),J[V]=!n&&(e||O>=120&&ot.length>=120)?new rn(V&&ot):v}ot=t[0];var at=-1,ft=J[0];t:for(;++at<O&&it.length<Y;){var pt=ot[at],yt=e?e(pt):pt;if(pt=n||pt!==0?pt:0,!(ft?Dn(ft,yt):l(it,yt,n))){for(V=B;--V;){var Tt=J[V];if(!(Tt?Dn(Tt,yt):l(t[V],yt,n)))continue t}ft&&ft.push(yt),it.push(pt)}}return it}function Tc(t,e,n,l){return xe(t,function(O,B,V){e(l,n(O),B,V)}),l}function zn(t,e,n){e=qe(e,t),t=Cs(t,e);var l=t==null?t:t[Le(be(e))];return l==null?v:ce(l,t,n)}function La(t){return jt(t)&&re(t)==U}function Ic(t){return jt(t)&&re(t)==Ln}function Ec(t){return jt(t)&&re(t)==ut}function jn(t,e,n,l,O){return t===e?!0:t==null||e==null||!jt(t)&&!jt(e)?t!==t&&e!==e:_c(t,e,n,l,jn,O)}function _c(t,e,n,l,O,B){var V=Rt(t),J=Rt(e),Y=V?K:ne(t),it=J?K:ne(e);Y=Y==U?Ut:Y,it=it==U?Ut:it;var ot=Y==Ut,at=it==Ut,ft=Y==it;if(ft&&Xe(t)){if(!Xe(e))return!1;V=!0,ot=!1}if(ft&&!ot)return B||(B=new Ee),V||Tn(t)?ds(t,e,n,l,O,B):ed(t,e,Y,n,l,O,B);if(!(n&u)){var pt=ot&&Nt.call(t,"__wrapped__"),yt=at&&Nt.call(e,"__wrapped__");if(pt||yt){var Tt=pt?t.value():t,Ct=yt?e.value():e;return B||(B=new Ee),O(Tt,Ct,n,l,B)}}return ft?(B||(B=new Ee),nd(t,e,n,l,O,B)):!1}function Pc(t){return jt(t)&&ne(t)==lt}function wi(t,e,n,l){var O=n.length,B=O,V=!l;if(t==null)return!B;for(t=Bt(t);O--;){var J=n[O];if(V&&J[2]?J[1]!==t[J[0]]:!(J[0]in t))return!1}for(;++O<B;){J=n[O];var Y=J[0],it=t[Y],ot=J[1];if(V&&J[2]){if(it===v&&!(Y in t))return!1}else{var at=new Ee;if(l)var ft=l(it,ot,Y,t,e,at);if(!(ft===v?jn(ot,it,u|A,l,at):ft))return!1}}return!0}function Da(t){if(!zt(t)||cd(t))return!1;var e=He(t)?Pl:Cf;return e.test(un(t))}function wc(t){return jt(t)&&re(t)==X}function xc(t){return jt(t)&&ne(t)==rt}function Mc(t){return jt(t)&&Gr(t.length)&&!!Ft[re(t)]}function Na(t){return typeof t=="function"?t:t==null?le:typeof t=="object"?Rt(t)?Ga(t[0],t[1]):Ba(t):ru(t)}function xi(t){if(!Kn(t))return Nl(t);var e=[];for(var n in Bt(t))Nt.call(t,n)&&n!="constructor"&&e.push(n);return e}function Lc(t){if(!zt(t))return gd(t);var e=Kn(t),n=[];for(var l in t)l=="constructor"&&(e||!Nt.call(t,l))||n.push(l);return n}function Mi(t,e){return t<e}function Ua(t,e){var n=-1,l=ue(t)?et(t.length):[];return Qe(t,function(O,B,V){l[++n]=e(O,B,V)}),l}function Ba(t){var e=Ji(t);return e.length==1&&e[0][2]?ms(e[0][0],e[0][1]):function(n){return n===t||wi(n,t,e)}}function Ga(t,e){return $i(t)&&vs(e)?ms(Le(t),e):function(n){var l=oo(n,t);return l===v&&l===e?ao(n,t):jn(e,l,u|A)}}function Or(t,e,n,l,O){t!==e&&Ii(e,function(B,V){if(O||(O=new Ee),zt(B))Dc(t,e,V,n,Or,l,O);else{var J=l?l(Yi(t,V),B,V+"",t,e,O):v;J===v&&(J=B),bi(t,V,J)}},fe)}function Dc(t,e,n,l,O,B,V){var J=Yi(t,n),Y=Yi(e,n),it=V.get(Y);if(it){bi(t,n,it);return}var ot=B?B(J,Y,n+"",t,e,V):v,at=ot===v;if(at){var ft=Rt(Y),pt=!ft&&Xe(Y),yt=!ft&&!pt&&Tn(Y);ot=Y,ft||pt||yt?Rt(J)?ot=J:Vt(J)?ot=se(J):pt?(at=!1,ot=qa(Y,!0)):yt?(at=!1,ot=Ya(Y,!0)):ot=[]:Qn(Y)||fn(Y)?(ot=J,fn(J)?ot=Js(J):(!zt(J)||He(J))&&(ot=gs(Y))):at=!1}at&&(V.set(Y,ot),O(ot,Y,l,B,V),V.delete(Y)),bi(t,n,ot)}function Fa(t,e){var n=t.length;if(!!n)return e+=e<0?n:0,Fe(e,n)?t[e]:v}function Ha(t,e,n){e.length?e=Wt(e,function(B){return Rt(B)?function(V){return an(V,B.length===1?B[0]:B)}:B}):e=[le];var l=-1;e=Wt(e,de(mt()));var O=Ua(t,function(B,V,J){var Y=Wt(e,function(it){return it(B)});return{criteria:Y,index:++l,value:B}});return sl(O,function(B,V){return Jc(B,V,n)})}function Nc(t,e){return Wa(t,e,function(n,l){return ao(t,l)})}function Wa(t,e,n){for(var l=-1,O=e.length,B={};++l<O;){var V=e[l],J=an(t,V);n(J,V)&&Vn(B,qe(V,t),J)}return B}function Uc(t){return function(e){return an(e,t)}}function Li(t,e,n,l){var O=l?al:gn,B=-1,V=e.length,J=t;for(t===e&&(e=se(e)),n&&(J=Wt(t,de(n)));++B<V;)for(var Y=0,it=e[B],ot=n?n(it):it;(Y=O(J,ot,Y,l))>-1;)J!==t&&dr.call(J,Y,1),dr.call(t,Y,1);return t}function za(t,e){for(var n=t?e.length:0,l=n-1;n--;){var O=e[n];if(n==l||O!==B){var B=O;Fe(O)?dr.call(t,O,1):Bi(t,O)}}return t}function Di(t,e){return t+gr(Oa()*(e-t+1))}function Bc(t,e,n,l){for(var O=-1,B=$t(pr((e-t)/(n||1)),0),V=et(B);B--;)V[l?B:++O]=t,t+=n;return V}function Ni(t,e){var n="";if(!t||e<1||e>j)return n;do e%2&&(n+=t),e=gr(e/2),e&&(t+=t);while(e);return n}function It(t,e){return Xi(ys(t,e,le),t+"")}function Gc(t){return Ta(In(t))}function Fc(t,e){var n=In(t);return Mr(n,on(e,0,n.length))}function Vn(t,e,n,l){if(!zt(t))return t;e=qe(e,t);for(var O=-1,B=e.length,V=B-1,J=t;J!=null&&++O<B;){var Y=Le(e[O]),it=n;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return t;if(O!=V){var ot=J[Y];it=l?l(ot,Y,J):v,it===v&&(it=zt(ot)?ot:Fe(e[O+1])?[]:{})}Hn(J,Y,it),J=J[Y]}return t}var ja=vr?function(t,e){return vr.set(t,e),t}:le,Hc=hr?function(t,e){return hr(t,"toString",{configurable:!0,enumerable:!1,value:uo(e),writable:!0})}:le;function Wc(t){return Mr(In(t))}function Se(t,e,n){var l=-1,O=t.length;e<0&&(e=-e>O?0:O+e),n=n>O?O:n,n<0&&(n+=O),O=e>n?0:n-e>>>0,e>>>=0;for(var B=et(O);++l<O;)B[l]=t[l+e];return B}function zc(t,e){var n;return Qe(t,function(l,O,B){return n=e(l,O,B),!n}),!!n}function Sr(t,e,n){var l=0,O=t==null?l:t.length;if(typeof e=="number"&&e===e&&O<=G){for(;l<O;){var B=l+O>>>1,V=t[B];V!==null&&!pe(V)&&(n?V<=e:V<e)?l=B+1:O=B}return O}return Ui(t,e,le,n)}function Ui(t,e,n,l){var O=0,B=t==null?0:t.length;if(B===0)return 0;e=n(e);for(var V=e!==e,J=e===null,Y=pe(e),it=e===v;O<B;){var ot=gr((O+B)/2),at=n(t[ot]),ft=at!==v,pt=at===null,yt=at===at,Tt=pe(at);if(V)var Ct=l||yt;else it?Ct=yt&&(l||ft):J?Ct=yt&&ft&&(l||!pt):Y?Ct=yt&&ft&&!pt&&(l||!Tt):pt||Tt?Ct=!1:Ct=l?at<=e:at<e;Ct?O=ot+1:B=ot}return ee(B,q)}function Va(t,e){for(var n=-1,l=t.length,O=0,B=[];++n<l;){var V=t[n],J=e?e(V):V;if(!n||!_e(J,Y)){var Y=J;B[O++]=V===0?0:V}}return B}function ka(t){return typeof t=="number"?t:pe(t)?Q:+t}function he(t){if(typeof t=="string")return t;if(Rt(t))return Wt(t,he)+"";if(pe(t))return Sa?Sa.call(t):"";var e=t+"";return e=="0"&&1/t==-_?"-0":e}function $e(t,e,n){var l=-1,O=nr,B=t.length,V=!0,J=[],Y=J;if(n)V=!1,O=ci;else if(B>=r){var it=e?null:Zc(t);if(it)return ir(it);V=!1,O=Dn,Y=new rn}else Y=e?[]:J;t:for(;++l<B;){var ot=t[l],at=e?e(ot):ot;if(ot=n||ot!==0?ot:0,V&&at===at){for(var ft=Y.length;ft--;)if(Y[ft]===at)continue t;e&&Y.push(at),J.push(ot)}else O(Y,at,n)||(Y!==J&&Y.push(at),J.push(ot))}return J}function Bi(t,e){return e=qe(e,t),t=Cs(t,e),t==null||delete t[Le(be(e))]}function Ka(t,e,n,l){return Vn(t,e,n(an(t,e)),l)}function br(t,e,n,l){for(var O=t.length,B=l?O:-1;(l?B--:++B<O)&&e(t[B],B,t););return n?Se(t,l?0:B,l?B+1:O):Se(t,l?B+1:0,l?O:B)}function Ja(t,e){var n=t;return n instanceof Pt&&(n=n.value()),di(e,function(l,O){return O.func.apply(O.thisArg,Ve([l],O.args))},n)}function Gi(t,e,n){var l=t.length;if(l<2)return l?$e(t[0]):[];for(var O=-1,B=et(l);++O<l;)for(var V=t[O],J=-1;++J<l;)J!=O&&(B[O]=Wn(B[O]||V,t[J],e,n));return $e(te(B,1),e,n)}function Qa(t,e,n){for(var l=-1,O=t.length,B=e.length,V={};++l<O;){var J=l<B?e[l]:v;n(V,t[l],J)}return V}function Fi(t){return Vt(t)?t:[]}function Hi(t){return typeof t=="function"?t:le}function qe(t,e){return Rt(t)?t:$i(t,e)?[t]:Ss(Dt(t))}var jc=It;function Ye(t,e,n){var l=t.length;return n=n===v?l:n,!e&&n>=l?t:Se(t,e,n)}var $a=wl||function(t){return Yt.clearTimeout(t)};function qa(t,e){if(e)return t.slice();var n=t.length,l=ma?ma(n):new t.constructor(n);return t.copy(l),l}function Wi(t){var e=new t.constructor(t.byteLength);return new lr(e).set(new lr(t)),e}function Vc(t,e){var n=e?Wi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function kc(t){var e=new t.constructor(t.source,Lo.exec(t));return e.lastIndex=t.lastIndex,e}function Kc(t){return Fn?Bt(Fn.call(t)):{}}function Ya(t,e){var n=e?Wi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Xa(t,e){if(t!==e){var n=t!==v,l=t===null,O=t===t,B=pe(t),V=e!==v,J=e===null,Y=e===e,it=pe(e);if(!J&&!it&&!B&&t>e||B&&V&&Y&&!J&&!it||l&&V&&Y||!n&&Y||!O)return 1;if(!l&&!B&&!it&&t<e||it&&n&&O&&!l&&!B||J&&n&&O||!V&&O||!Y)return-1}return 0}function Jc(t,e,n){for(var l=-1,O=t.criteria,B=e.criteria,V=O.length,J=n.length;++l<V;){var Y=Xa(O[l],B[l]);if(Y){if(l>=J)return Y;var it=n[l];return Y*(it=="desc"?-1:1)}}return t.index-e.index}function Za(t,e,n,l){for(var O=-1,B=t.length,V=n.length,J=-1,Y=e.length,it=$t(B-V,0),ot=et(Y+it),at=!l;++J<Y;)ot[J]=e[J];for(;++O<V;)(at||O<B)&&(ot[n[O]]=t[O]);for(;it--;)ot[J++]=t[O++];return ot}function ts(t,e,n,l){for(var O=-1,B=t.length,V=-1,J=n.length,Y=-1,it=e.length,ot=$t(B-J,0),at=et(ot+it),ft=!l;++O<ot;)at[O]=t[O];for(var pt=O;++Y<it;)at[pt+Y]=e[Y];for(;++V<J;)(ft||O<B)&&(at[pt+n[V]]=t[O++]);return at}function se(t,e){var n=-1,l=t.length;for(e||(e=et(l));++n<l;)e[n]=t[n];return e}function Me(t,e,n,l){var O=!n;n||(n={});for(var B=-1,V=e.length;++B<V;){var J=e[B],Y=l?l(n[J],t[J],J,n,t):v;Y===v&&(Y=t[J]),O?Ue(n,J,Y):Hn(n,J,Y)}return n}function Qc(t,e){return Me(t,Qi(t),e)}function $c(t,e){return Me(t,hs(t),e)}function Tr(t,e){return function(n,l){var O=Rt(n)?tl:mc,B=e?e():{};return O(n,t,mt(l,2),B)}}function On(t){return It(function(e,n){var l=-1,O=n.length,B=O>1?n[O-1]:v,V=O>2?n[2]:v;for(B=t.length>3&&typeof B=="function"?(O--,B):v,V&&ie(n[0],n[1],V)&&(B=O<3?v:B,O=1),e=Bt(e);++l<O;){var J=n[l];J&&t(e,J,l,B)}return e})}function es(t,e){return function(n,l){if(n==null)return n;if(!ue(n))return t(n,l);for(var O=n.length,B=e?O:-1,V=Bt(n);(e?B--:++B<O)&&l(V[B],B,V)!==!1;);return n}}function ns(t){return function(e,n,l){for(var O=-1,B=Bt(e),V=l(e),J=V.length;J--;){var Y=V[t?J:++O];if(n(B[Y],Y,B)===!1)break}return e}}function qc(t,e,n){var l=e&w,O=kn(t);function B(){var V=this&&this!==Yt&&this instanceof B?O:t;return V.apply(l?n:this,arguments)}return B}function rs(t){return function(e){e=Dt(e);var n=vn(e)?Ie(e):v,l=n?n[0]:e.charAt(0),O=n?Ye(n,1).join(""):e.slice(1);return l[t]()+O}}function Sn(t){return function(e){return di(eu(tu(e).replace(Hf,"")),t,"")}}function kn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Rn(t.prototype),l=t.apply(n,e);return zt(l)?l:n}}function Yc(t,e,n){var l=kn(t);function O(){for(var B=arguments.length,V=et(B),J=B,Y=bn(O);J--;)V[J]=arguments[J];var it=B<3&&V[0]!==Y&&V[B-1]!==Y?[]:ke(V,Y);if(B-=it.length,B<n)return us(t,e,Ir,O.placeholder,v,V,it,v,v,n-B);var ot=this&&this!==Yt&&this instanceof O?l:t;return ce(ot,this,V)}return O}function is(t){return function(e,n,l){var O=Bt(e);if(!ue(e)){var B=mt(n,3);e=Xt(e),n=function(J){return B(O[J],J,O)}}var V=t(e,n,l);return V>-1?O[B?e[V]:V]:v}}function os(t){return Ge(function(e){var n=e.length,l=n,O=Re.prototype.thru;for(t&&e.reverse();l--;){var B=e[l];if(typeof B!="function")throw new Ae(a);if(O&&!V&&wr(B)=="wrapper")var V=new Re([],!0)}for(l=V?l:n;++l<n;){B=e[l];var J=wr(B),Y=J=="wrapper"?Ki(B):v;Y&&qi(Y[0])&&Y[1]==(s|d|o|f)&&!Y[4].length&&Y[9]==1?V=V[wr(Y[0])].apply(V,Y[3]):V=B.length==1&&qi(B)?V[J]():V.thru(B)}return function(){var it=arguments,ot=it[0];if(V&&it.length==1&&Rt(ot))return V.plant(ot).value();for(var at=0,ft=n?e[at].apply(this,it):ot;++at<n;)ft=e[at].call(this,ft);return ft}})}function Ir(t,e,n,l,O,B,V,J,Y,it){var ot=e&s,at=e&w,ft=e&T,pt=e&(d|y),yt=e&i,Tt=ft?v:kn(t);function Ct(){for(var Et=arguments.length,wt=et(Et),ge=Et;ge--;)wt[ge]=arguments[ge];if(pt)var oe=bn(Ct),ve=fl(wt,oe);if(l&&(wt=Za(wt,l,O,pt)),B&&(wt=ts(wt,B,V,pt)),Et-=ve,pt&&Et<it){var kt=ke(wt,oe);return us(t,e,Ir,Ct.placeholder,n,wt,kt,J,Y,it-Et)}var Pe=at?n:this,ze=ft?Pe[t]:t;return Et=wt.length,J?wt=md(wt,J):yt&&Et>1&&wt.reverse(),ot&&Y<Et&&(wt.length=Y),this&&this!==Yt&&this instanceof Ct&&(ze=Tt||kn(ze)),ze.apply(Pe,wt)}return Ct}function as(t,e){return function(n,l){return Tc(n,t,e(l),{})}}function Er(t,e){return function(n,l){var O;if(n===v&&l===v)return e;if(n!==v&&(O=n),l!==v){if(O===v)return l;typeof n=="string"||typeof l=="string"?(n=he(n),l=he(l)):(n=ka(n),l=ka(l)),O=t(n,l)}return O}}function zi(t){return Ge(function(e){return e=Wt(e,de(mt())),It(function(n){var l=this;return t(e,function(O){return ce(O,l,n)})})})}function _r(t,e){e=e===v?" ":he(e);var n=e.length;if(n<2)return n?Ni(e,t):e;var l=Ni(e,pr(t/mn(e)));return vn(e)?Ye(Ie(l),0,t).join(""):l.slice(0,t)}function Xc(t,e,n,l){var O=e&w,B=kn(t);function V(){for(var J=-1,Y=arguments.length,it=-1,ot=l.length,at=et(ot+Y),ft=this&&this!==Yt&&this instanceof V?B:t;++it<ot;)at[it]=l[it];for(;Y--;)at[it++]=arguments[++J];return ce(ft,O?n:this,at)}return V}function ss(t){return function(e,n,l){return l&&typeof l!="number"&&ie(e,n,l)&&(n=l=v),e=We(e),n===v?(n=e,e=0):n=We(n),l=l===v?e<n?1:-1:We(l),Bc(e,n,l,t)}}function Pr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Te(e),n=Te(n)),t(e,n)}}function us(t,e,n,l,O,B,V,J,Y,it){var ot=e&d,at=ot?V:v,ft=ot?v:V,pt=ot?B:v,yt=ot?v:B;e|=ot?o:c,e&=~(ot?c:o),e&m||(e&=~(w|T));var Tt=[t,e,O,pt,at,yt,ft,J,Y,it],Ct=n.apply(v,Tt);return qi(t)&&As(Ct,Tt),Ct.placeholder=l,Rs(Ct,t,e)}function ji(t){var e=Qt[t];return function(n,l){if(n=Te(n),l=l==null?0:ee(St(l),292),l&&Ra(n)){var O=(Dt(n)+"e").split("e"),B=e(O[0]+"e"+(+O[1]+l));return O=(Dt(B)+"e").split("e"),+(O[0]+"e"+(+O[1]-l))}return e(n)}}var Zc=Cn&&1/ir(new Cn([,-0]))[1]==_?function(t){return new Cn(t)}:co;function fs(t){return function(e){var n=ne(e);return n==lt?Ci(e):n==rt?vl(e):ul(e,t(e))}}function Be(t,e,n,l,O,B,V,J){var Y=e&T;if(!Y&&typeof t!="function")throw new Ae(a);var it=l?l.length:0;if(it||(e&=~(o|c),l=O=v),V=V===v?V:$t(St(V),0),J=J===v?J:St(J),it-=O?O.length:0,e&c){var ot=l,at=O;l=O=v}var ft=Y?v:Ki(t),pt=[t,e,n,l,O,ot,at,B,V,J];if(ft&&pd(pt,ft),t=pt[0],e=pt[1],n=pt[2],l=pt[3],O=pt[4],J=pt[9]=pt[9]===v?Y?0:t.length:$t(pt[9]-it,0),!J&&e&(d|y)&&(e&=~(d|y)),!e||e==w)var yt=qc(t,e,n);else e==d||e==y?yt=Yc(t,e,J):(e==o||e==(w|o))&&!O.length?yt=Xc(t,e,n,l):yt=Ir.apply(v,pt);var Tt=ft?ja:As;return Rs(Tt(yt,pt),t,e)}function ls(t,e,n,l){return t===v||_e(t,yn[n])&&!Nt.call(l,n)?e:t}function cs(t,e,n,l,O,B){return zt(t)&&zt(e)&&(B.set(e,t),Or(t,e,v,cs,B),B.delete(e)),t}function td(t){return Qn(t)?v:t}function ds(t,e,n,l,O,B){var V=n&u,J=t.length,Y=e.length;if(J!=Y&&!(V&&Y>J))return!1;var it=B.get(t),ot=B.get(e);if(it&&ot)return it==e&&ot==t;var at=-1,ft=!0,pt=n&A?new rn:v;for(B.set(t,e),B.set(e,t);++at<J;){var yt=t[at],Tt=e[at];if(l)var Ct=V?l(Tt,yt,at,e,t,B):l(yt,Tt,at,t,e,B);if(Ct!==v){if(Ct)continue;ft=!1;break}if(pt){if(!hi(e,function(Et,wt){if(!Dn(pt,wt)&&(yt===Et||O(yt,Et,n,l,B)))return pt.push(wt)})){ft=!1;break}}else if(!(yt===Tt||O(yt,Tt,n,l,B))){ft=!1;break}}return B.delete(t),B.delete(e),ft}function ed(t,e,n,l,O,B,V){switch(n){case hn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Ln:return!(t.byteLength!=e.byteLength||!B(new lr(t),new lr(e)));case tt:case ut:case xt:return _e(+t,+e);case gt:return t.name==e.name&&t.message==e.message;case X:case st:return t==e+"";case lt:var J=Ci;case rt:var Y=l&u;if(J||(J=ir),t.size!=e.size&&!Y)return!1;var it=V.get(t);if(it)return it==e;l|=A,V.set(t,e);var ot=ds(J(t),J(e),l,O,B,V);return V.delete(t),ot;case ht:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}function nd(t,e,n,l,O,B){var V=n&u,J=Vi(t),Y=J.length,it=Vi(e),ot=it.length;if(Y!=ot&&!V)return!1;for(var at=Y;at--;){var ft=J[at];if(!(V?ft in e:Nt.call(e,ft)))return!1}var pt=B.get(t),yt=B.get(e);if(pt&&yt)return pt==e&&yt==t;var Tt=!0;B.set(t,e),B.set(e,t);for(var Ct=V;++at<Y;){ft=J[at];var Et=t[ft],wt=e[ft];if(l)var ge=V?l(wt,Et,ft,e,t,B):l(Et,wt,ft,t,e,B);if(!(ge===v?Et===wt||O(Et,wt,n,l,B):ge)){Tt=!1;break}Ct||(Ct=ft=="constructor")}if(Tt&&!Ct){var oe=t.constructor,ve=e.constructor;oe!=ve&&"constructor"in t&&"constructor"in e&&!(typeof oe=="function"&&oe instanceof oe&&typeof ve=="function"&&ve instanceof ve)&&(Tt=!1)}return B.delete(t),B.delete(e),Tt}function Ge(t){return Xi(ys(t,v,Es),t+"")}function Vi(t){return Ma(t,Xt,Qi)}function ki(t){return Ma(t,fe,hs)}var Ki=vr?function(t){return vr.get(t)}:co;function wr(t){for(var e=t.name+"",n=An[e],l=Nt.call(An,e)?n.length:0;l--;){var O=n[l],B=O.func;if(B==null||B==t)return O.name}return e}function bn(t){var e=Nt.call(x,"placeholder")?x:t;return e.placeholder}function mt(){var t=x.iteratee||fo;return t=t===fo?Na:t,arguments.length?t(arguments[0],arguments[1]):t}function xr(t,e){var n=t.__data__;return ld(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ji(t){for(var e=Xt(t),n=e.length;n--;){var l=e[n],O=t[l];e[n]=[l,O,vs(O)]}return e}function sn(t,e){var n=hl(t,e);return Da(n)?n:v}function rd(t){var e=Nt.call(t,en),n=t[en];try{t[en]=v;var l=!0}catch(B){}var O=ur.call(t);return l&&(e?t[en]=n:delete t[en]),O}var Qi=Ri?function(t){return t==null?[]:(t=Bt(t),je(Ri(t),function(e){return Ca.call(t,e)}))}:ho,hs=Ri?function(t){for(var e=[];t;)Ve(e,Qi(t)),t=cr(t);return e}:ho,ne=re;(Oi&&ne(new Oi(new ArrayBuffer(1)))!=hn||Un&&ne(new Un)!=lt||Si&&ne(Si.resolve())!=Ht||Cn&&ne(new Cn)!=rt||Bn&&ne(new Bn)!=Kt)&&(ne=function(t){var e=re(t),n=e==Ut?t.constructor:v,l=n?un(n):"";if(l)switch(l){case Fl:return hn;case Hl:return lt;case Wl:return Ht;case zl:return rt;case jl:return Kt}return e});function id(t,e,n){for(var l=-1,O=n.length;++l<O;){var B=n[l],V=B.size;switch(B.type){case"drop":t+=V;break;case"dropRight":e-=V;break;case"take":e=ee(e,t+V);break;case"takeRight":t=$t(t,e-V);break}}return{start:t,end:e}}function od(t){var e=t.match(cf);return e?e[1].split(df):[]}function ps(t,e,n){e=qe(e,t);for(var l=-1,O=e.length,B=!1;++l<O;){var V=Le(e[l]);if(!(B=t!=null&&n(t,V)))break;t=t[V]}return B||++l!=O?B:(O=t==null?0:t.length,!!O&&Gr(O)&&Fe(V,O)&&(Rt(t)||fn(t)))}function ad(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Nt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function gs(t){return typeof t.constructor=="function"&&!Kn(t)?Rn(cr(t)):{}}function sd(t,e,n){var l=t.constructor;switch(e){case Ln:return Wi(t);case tt:case ut:return new l(+t);case hn:return Vc(t,n);case Jr:case Qr:case $r:case qr:case Yr:case Xr:case Zr:case ti:case ei:return Ya(t,n);case lt:return new l;case xt:case st:return new l(t);case X:return kc(t);case rt:return new l;case ht:return Kc(t)}}function ud(t,e){var n=e.length;if(!n)return t;var l=n-1;return e[l]=(n>1?"& ":"")+e[l],e=e.join(n>2?", ":" "),t.replace(lf,`{
/* [wrapped with `+e+`] */
`)}function fd(t){return Rt(t)||fn(t)||!!(Aa&&t&&t[Aa])}function Fe(t,e){var n=typeof t;return e=e==null?j:e,!!e&&(n=="number"||n!="symbol"&&Rf.test(t))&&t>-1&&t%1==0&&t<e}function ie(t,e,n){if(!zt(n))return!1;var l=typeof e;return(l=="number"?ue(n)&&Fe(e,n.length):l=="string"&&e in n)?_e(n[e],t):!1}function $i(t,e){if(Rt(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||pe(t)?!0:af.test(t)||!of.test(t)||e!=null&&t in Bt(e)}function ld(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function qi(t){var e=wr(t),n=x[e];if(typeof n!="function"||!(e in Pt.prototype))return!1;if(t===n)return!0;var l=Ki(n);return!!l&&t===l[0]}function cd(t){return!!va&&va in t}var dd=ar?He:po;function Kn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||yn;return t===n}function vs(t){return t===t&&!zt(t)}function ms(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==v||t in Bt(n))}}function hd(t){var e=Ur(t,function(l){return n.size===E&&n.clear(),l}),n=e.cache;return e}function pd(t,e){var n=t[1],l=e[1],O=n|l,B=O<(w|T|s),V=l==s&&n==d||l==s&&n==f&&t[7].length<=e[8]||l==(s|f)&&e[7].length<=e[8]&&n==d;if(!(B||V))return t;l&w&&(t[2]=e[2],O|=n&w?0:m);var J=e[3];if(J){var Y=t[3];t[3]=Y?Za(Y,J,e[4]):J,t[4]=Y?ke(t[3],P):e[4]}return J=e[5],J&&(Y=t[5],t[5]=Y?ts(Y,J,e[6]):J,t[6]=Y?ke(t[5],P):e[6]),J=e[7],J&&(t[7]=J),l&s&&(t[8]=t[8]==null?e[8]:ee(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=O,t}function gd(t){var e=[];if(t!=null)for(var n in Bt(t))e.push(n);return e}function vd(t){return ur.call(t)}function ys(t,e,n){return e=$t(e===v?t.length-1:e,0),function(){for(var l=arguments,O=-1,B=$t(l.length-e,0),V=et(B);++O<B;)V[O]=l[e+O];O=-1;for(var J=et(e+1);++O<e;)J[O]=l[O];return J[e]=n(V),ce(t,this,J)}}function Cs(t,e){return e.length<2?t:an(t,Se(e,0,-1))}function md(t,e){for(var n=t.length,l=ee(e.length,n),O=se(t);l--;){var B=e[l];t[l]=Fe(B,n)?O[B]:v}return t}function Yi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var As=Os(ja),Jn=Ml||function(t,e){return Yt.setTimeout(t,e)},Xi=Os(Hc);function Rs(t,e,n){var l=e+"";return Xi(t,ud(l,yd(od(l),n)))}function Os(t){var e=0,n=0;return function(){var l=Ul(),O=z-(l-n);if(n=l,O>0){if(++e>=L)return arguments[0]}else e=0;return t.apply(v,arguments)}}function Mr(t,e){var n=-1,l=t.length,O=l-1;for(e=e===v?l:e;++n<e;){var B=Di(n,O),V=t[B];t[B]=t[n],t[n]=V}return t.length=e,t}var Ss=hd(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(sf,function(n,l,O,B){e.push(O?B.replace(gf,"$1"):l||n)}),e});function Le(t){if(typeof t=="string"||pe(t))return t;var e=t+"";return e=="0"&&1/t==-_?"-0":e}function un(t){if(t!=null){try{return sr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function yd(t,e){return Ce(M,function(n){var l="_."+n[0];e&n[1]&&!nr(t,l)&&t.push(l)}),t.sort()}function bs(t){if(t instanceof Pt)return t.clone();var e=new Re(t.__wrapped__,t.__chain__);return e.__actions__=se(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Cd(t,e,n){(n?ie(t,e,n):e===v)?e=1:e=$t(St(e),0);var l=t==null?0:t.length;if(!l||e<1)return[];for(var O=0,B=0,V=et(pr(l/e));O<l;)V[B++]=Se(t,O,O+=e);return V}function Ad(t){for(var e=-1,n=t==null?0:t.length,l=0,O=[];++e<n;){var B=t[e];B&&(O[l++]=B)}return O}function Rd(){var t=arguments.length;if(!t)return[];for(var e=et(t-1),n=arguments[0],l=t;l--;)e[l-1]=arguments[l];return Ve(Rt(n)?se(n):[n],te(e,1))}var Od=It(function(t,e){return Vt(t)?Wn(t,te(e,1,Vt,!0)):[]}),Sd=It(function(t,e){var n=be(e);return Vt(n)&&(n=v),Vt(t)?Wn(t,te(e,1,Vt,!0),mt(n,2)):[]}),bd=It(function(t,e){var n=be(e);return Vt(n)&&(n=v),Vt(t)?Wn(t,te(e,1,Vt,!0),v,n):[]});function Td(t,e,n){var l=t==null?0:t.length;return l?(e=n||e===v?1:St(e),Se(t,e<0?0:e,l)):[]}function Id(t,e,n){var l=t==null?0:t.length;return l?(e=n||e===v?1:St(e),e=l-e,Se(t,0,e<0?0:e)):[]}function Ed(t,e){return t&&t.length?br(t,mt(e,3),!0,!0):[]}function _d(t,e){return t&&t.length?br(t,mt(e,3),!0):[]}function Pd(t,e,n,l){var O=t==null?0:t.length;return O?(n&&typeof n!="number"&&ie(t,e,n)&&(n=0,l=O),Rc(t,e,n,l)):[]}function Ts(t,e,n){var l=t==null?0:t.length;if(!l)return-1;var O=n==null?0:St(n);return O<0&&(O=$t(l+O,0)),rr(t,mt(e,3),O)}function Is(t,e,n){var l=t==null?0:t.length;if(!l)return-1;var O=l-1;return n!==v&&(O=St(n),O=n<0?$t(l+O,0):ee(O,l-1)),rr(t,mt(e,3),O,!0)}function Es(t){var e=t==null?0:t.length;return e?te(t,1):[]}function wd(t){var e=t==null?0:t.length;return e?te(t,_):[]}function xd(t,e){var n=t==null?0:t.length;return n?(e=e===v?1:St(e),te(t,e)):[]}function Md(t){for(var e=-1,n=t==null?0:t.length,l={};++e<n;){var O=t[e];l[O[0]]=O[1]}return l}function _s(t){return t&&t.length?t[0]:v}function Ld(t,e,n){var l=t==null?0:t.length;if(!l)return-1;var O=n==null?0:St(n);return O<0&&(O=$t(l+O,0)),gn(t,e,O)}function Dd(t){var e=t==null?0:t.length;return e?Se(t,0,-1):[]}var Nd=It(function(t){var e=Wt(t,Fi);return e.length&&e[0]===t[0]?Pi(e):[]}),Ud=It(function(t){var e=be(t),n=Wt(t,Fi);return e===be(n)?e=v:n.pop(),n.length&&n[0]===t[0]?Pi(n,mt(e,2)):[]}),Bd=It(function(t){var e=be(t),n=Wt(t,Fi);return e=typeof e=="function"?e:v,e&&n.pop(),n.length&&n[0]===t[0]?Pi(n,v,e):[]});function Gd(t,e){return t==null?"":Dl.call(t,e)}function be(t){var e=t==null?0:t.length;return e?t[e-1]:v}function Fd(t,e,n){var l=t==null?0:t.length;if(!l)return-1;var O=l;return n!==v&&(O=St(n),O=O<0?$t(l+O,0):ee(O,l-1)),e===e?yl(t,e,O):rr(t,ua,O,!0)}function Hd(t,e){return t&&t.length?Fa(t,St(e)):v}var Wd=It(Ps);function Ps(t,e){return t&&t.length&&e&&e.length?Li(t,e):t}function zd(t,e,n){return t&&t.length&&e&&e.length?Li(t,e,mt(n,2)):t}function jd(t,e,n){return t&&t.length&&e&&e.length?Li(t,e,v,n):t}var Vd=Ge(function(t,e){var n=t==null?0:t.length,l=Ti(t,e);return za(t,Wt(e,function(O){return Fe(O,n)?+O:O}).sort(Xa)),l});function kd(t,e){var n=[];if(!(t&&t.length))return n;var l=-1,O=[],B=t.length;for(e=mt(e,3);++l<B;){var V=t[l];e(V,l,t)&&(n.push(V),O.push(l))}return za(t,O),n}function Zi(t){return t==null?t:Gl.call(t)}function Kd(t,e,n){var l=t==null?0:t.length;return l?(n&&typeof n!="number"&&ie(t,e,n)?(e=0,n=l):(e=e==null?0:St(e),n=n===v?l:St(n)),Se(t,e,n)):[]}function Jd(t,e){return Sr(t,e)}function Qd(t,e,n){return Ui(t,e,mt(n,2))}function $d(t,e){var n=t==null?0:t.length;if(n){var l=Sr(t,e);if(l<n&&_e(t[l],e))return l}return-1}function qd(t,e){return Sr(t,e,!0)}function Yd(t,e,n){return Ui(t,e,mt(n,2),!0)}function Xd(t,e){var n=t==null?0:t.length;if(n){var l=Sr(t,e,!0)-1;if(_e(t[l],e))return l}return-1}function Zd(t){return t&&t.length?Va(t):[]}function th(t,e){return t&&t.length?Va(t,mt(e,2)):[]}function eh(t){var e=t==null?0:t.length;return e?Se(t,1,e):[]}function nh(t,e,n){return t&&t.length?(e=n||e===v?1:St(e),Se(t,0,e<0?0:e)):[]}function rh(t,e,n){var l=t==null?0:t.length;return l?(e=n||e===v?1:St(e),e=l-e,Se(t,e<0?0:e,l)):[]}function ih(t,e){return t&&t.length?br(t,mt(e,3),!1,!0):[]}function oh(t,e){return t&&t.length?br(t,mt(e,3)):[]}var ah=It(function(t){return $e(te(t,1,Vt,!0))}),sh=It(function(t){var e=be(t);return Vt(e)&&(e=v),$e(te(t,1,Vt,!0),mt(e,2))}),uh=It(function(t){var e=be(t);return e=typeof e=="function"?e:v,$e(te(t,1,Vt,!0),v,e)});function fh(t){return t&&t.length?$e(t):[]}function lh(t,e){return t&&t.length?$e(t,mt(e,2)):[]}function ch(t,e){return e=typeof e=="function"?e:v,t&&t.length?$e(t,v,e):[]}function to(t){if(!(t&&t.length))return[];var e=0;return t=je(t,function(n){if(Vt(n))return e=$t(n.length,e),!0}),mi(e,function(n){return Wt(t,pi(n))})}function ws(t,e){if(!(t&&t.length))return[];var n=to(t);return e==null?n:Wt(n,function(l){return ce(e,v,l)})}var dh=It(function(t,e){return Vt(t)?Wn(t,e):[]}),hh=It(function(t){return Gi(je(t,Vt))}),ph=It(function(t){var e=be(t);return Vt(e)&&(e=v),Gi(je(t,Vt),mt(e,2))}),gh=It(function(t){var e=be(t);return e=typeof e=="function"?e:v,Gi(je(t,Vt),v,e)}),vh=It(to);function mh(t,e){return Qa(t||[],e||[],Hn)}function yh(t,e){return Qa(t||[],e||[],Vn)}var Ch=It(function(t){var e=t.length,n=e>1?t[e-1]:v;return n=typeof n=="function"?(t.pop(),n):v,ws(t,n)});function xs(t){var e=x(t);return e.__chain__=!0,e}function Ah(t,e){return e(t),t}function Lr(t,e){return e(t)}var Rh=Ge(function(t){var e=t.length,n=e?t[0]:0,l=this.__wrapped__,O=function(B){return Ti(B,t)};return e>1||this.__actions__.length||!(l instanceof Pt)||!Fe(n)?this.thru(O):(l=l.slice(n,+n+(e?1:0)),l.__actions__.push({func:Lr,args:[O],thisArg:v}),new Re(l,this.__chain__).thru(function(B){return e&&!B.length&&B.push(v),B}))});function Oh(){return xs(this)}function Sh(){return new Re(this.value(),this.__chain__)}function bh(){this.__values__===v&&(this.__values__=ks(this.value()));var t=this.__index__>=this.__values__.length,e=t?v:this.__values__[this.__index__++];return{done:t,value:e}}function Th(){return this}function Ih(t){for(var e,n=this;n instanceof yr;){var l=bs(n);l.__index__=0,l.__values__=v,e?O.__wrapped__=l:e=l;var O=l;n=n.__wrapped__}return O.__wrapped__=t,e}function Eh(){var t=this.__wrapped__;if(t instanceof Pt){var e=t;return this.__actions__.length&&(e=new Pt(this)),e=e.reverse(),e.__actions__.push({func:Lr,args:[Zi],thisArg:v}),new Re(e,this.__chain__)}return this.thru(Zi)}function _h(){return Ja(this.__wrapped__,this.__actions__)}var Ph=Tr(function(t,e,n){Nt.call(t,n)?++t[n]:Ue(t,n,1)});function wh(t,e,n){var l=Rt(t)?aa:Ac;return n&&ie(t,e,n)&&(e=v),l(t,mt(e,3))}function xh(t,e){var n=Rt(t)?je:wa;return n(t,mt(e,3))}var Mh=is(Ts),Lh=is(Is);function Dh(t,e){return te(Dr(t,e),1)}function Nh(t,e){return te(Dr(t,e),_)}function Uh(t,e,n){return n=n===v?1:St(n),te(Dr(t,e),n)}function Ms(t,e){var n=Rt(t)?Ce:Qe;return n(t,mt(e,3))}function Ls(t,e){var n=Rt(t)?el:Pa;return n(t,mt(e,3))}var Bh=Tr(function(t,e,n){Nt.call(t,n)?t[n].push(e):Ue(t,n,[e])});function Gh(t,e,n,l){t=ue(t)?t:In(t),n=n&&!l?St(n):0;var O=t.length;return n<0&&(n=$t(O+n,0)),Fr(t)?n<=O&&t.indexOf(e,n)>-1:!!O&&gn(t,e,n)>-1}var Fh=It(function(t,e,n){var l=-1,O=typeof e=="function",B=ue(t)?et(t.length):[];return Qe(t,function(V){B[++l]=O?ce(e,V,n):zn(V,e,n)}),B}),Hh=Tr(function(t,e,n){Ue(t,n,e)});function Dr(t,e){var n=Rt(t)?Wt:Ua;return n(t,mt(e,3))}function Wh(t,e,n,l){return t==null?[]:(Rt(e)||(e=e==null?[]:[e]),n=l?v:n,Rt(n)||(n=n==null?[]:[n]),Ha(t,e,n))}var zh=Tr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function jh(t,e,n){var l=Rt(t)?di:la,O=arguments.length<3;return l(t,mt(e,4),n,O,Qe)}function Vh(t,e,n){var l=Rt(t)?nl:la,O=arguments.length<3;return l(t,mt(e,4),n,O,Pa)}function kh(t,e){var n=Rt(t)?je:wa;return n(t,Br(mt(e,3)))}function Kh(t){var e=Rt(t)?Ta:Gc;return e(t)}function Jh(t,e,n){(n?ie(t,e,n):e===v)?e=1:e=St(e);var l=Rt(t)?gc:Fc;return l(t,e)}function Qh(t){var e=Rt(t)?vc:Wc;return e(t)}function $h(t){if(t==null)return 0;if(ue(t))return Fr(t)?mn(t):t.length;var e=ne(t);return e==lt||e==rt?t.size:xi(t).length}function qh(t,e,n){var l=Rt(t)?hi:zc;return n&&ie(t,e,n)&&(e=v),l(t,mt(e,3))}var Yh=It(function(t,e){if(t==null)return[];var n=e.length;return n>1&&ie(t,e[0],e[1])?e=[]:n>2&&ie(e[0],e[1],e[2])&&(e=[e[0]]),Ha(t,te(e,1),[])}),Nr=xl||function(){return Yt.Date.now()};function Xh(t,e){if(typeof e!="function")throw new Ae(a);return t=St(t),function(){if(--t<1)return e.apply(this,arguments)}}function Ds(t,e,n){return e=n?v:e,e=t&&e==null?t.length:e,Be(t,s,v,v,v,v,e)}function Ns(t,e){var n;if(typeof e!="function")throw new Ae(a);return t=St(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=v),n}}var eo=It(function(t,e,n){var l=w;if(n.length){var O=ke(n,bn(eo));l|=o}return Be(t,l,e,n,O)}),Us=It(function(t,e,n){var l=w|T;if(n.length){var O=ke(n,bn(Us));l|=o}return Be(e,l,t,n,O)});function Bs(t,e,n){e=n?v:e;var l=Be(t,d,v,v,v,v,v,e);return l.placeholder=Bs.placeholder,l}function Gs(t,e,n){e=n?v:e;var l=Be(t,y,v,v,v,v,v,e);return l.placeholder=Gs.placeholder,l}function Fs(t,e,n){var l,O,B,V,J,Y,it=0,ot=!1,at=!1,ft=!0;if(typeof t!="function")throw new Ae(a);e=Te(e)||0,zt(n)&&(ot=!!n.leading,at="maxWait"in n,B=at?$t(Te(n.maxWait)||0,e):B,ft="trailing"in n?!!n.trailing:ft);function pt(kt){var Pe=l,ze=O;return l=O=v,it=kt,V=t.apply(ze,Pe),V}function yt(kt){return it=kt,J=Jn(Et,e),ot?pt(kt):V}function Tt(kt){var Pe=kt-Y,ze=kt-it,iu=e-Pe;return at?ee(iu,B-ze):iu}function Ct(kt){var Pe=kt-Y,ze=kt-it;return Y===v||Pe>=e||Pe<0||at&&ze>=B}function Et(){var kt=Nr();if(Ct(kt))return wt(kt);J=Jn(Et,Tt(kt))}function wt(kt){return J=v,ft&&l?pt(kt):(l=O=v,V)}function ge(){J!==v&&$a(J),it=0,l=Y=O=J=v}function oe(){return J===v?V:wt(Nr())}function ve(){var kt=Nr(),Pe=Ct(kt);if(l=arguments,O=this,Y=kt,Pe){if(J===v)return yt(Y);if(at)return $a(J),J=Jn(Et,e),pt(Y)}return J===v&&(J=Jn(Et,e)),V}return ve.cancel=ge,ve.flush=oe,ve}var Zh=It(function(t,e){return _a(t,1,e)}),tp=It(function(t,e,n){return _a(t,Te(e)||0,n)});function ep(t){return Be(t,i)}function Ur(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Ae(a);var n=function(){var l=arguments,O=e?e.apply(this,l):l[0],B=n.cache;if(B.has(O))return B.get(O);var V=t.apply(this,l);return n.cache=B.set(O,V)||B,V};return n.cache=new(Ur.Cache||Ne),n}Ur.Cache=Ne;function Br(t){if(typeof t!="function")throw new Ae(a);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function np(t){return Ns(2,t)}var rp=jc(function(t,e){e=e.length==1&&Rt(e[0])?Wt(e[0],de(mt())):Wt(te(e,1),de(mt()));var n=e.length;return It(function(l){for(var O=-1,B=ee(l.length,n);++O<B;)l[O]=e[O].call(this,l[O]);return ce(t,this,l)})}),no=It(function(t,e){var n=ke(e,bn(no));return Be(t,o,v,e,n)}),Hs=It(function(t,e){var n=ke(e,bn(Hs));return Be(t,c,v,e,n)}),ip=Ge(function(t,e){return Be(t,f,v,v,v,e)});function op(t,e){if(typeof t!="function")throw new Ae(a);return e=e===v?e:St(e),It(t,e)}function ap(t,e){if(typeof t!="function")throw new Ae(a);return e=e==null?0:$t(St(e),0),It(function(n){var l=n[e],O=Ye(n,0,e);return l&&Ve(O,l),ce(t,this,O)})}function sp(t,e,n){var l=!0,O=!0;if(typeof t!="function")throw new Ae(a);return zt(n)&&(l="leading"in n?!!n.leading:l,O="trailing"in n?!!n.trailing:O),Fs(t,e,{leading:l,maxWait:e,trailing:O})}function up(t){return Ds(t,1)}function fp(t,e){return no(Hi(e),t)}function lp(){if(!arguments.length)return[];var t=arguments[0];return Rt(t)?t:[t]}function cp(t){return Oe(t,b)}function dp(t,e){return e=typeof e=="function"?e:v,Oe(t,b,e)}function hp(t){return Oe(t,F|b)}function pp(t,e){return e=typeof e=="function"?e:v,Oe(t,F|b,e)}function gp(t,e){return e==null||Ea(t,e,Xt(e))}function _e(t,e){return t===e||t!==t&&e!==e}var vp=Pr(_i),mp=Pr(function(t,e){return t>=e}),fn=La(function(){return arguments}())?La:function(t){return jt(t)&&Nt.call(t,"callee")&&!Ca.call(t,"callee")},Rt=et.isArray,yp=ta?de(ta):Ic;function ue(t){return t!=null&&Gr(t.length)&&!He(t)}function Vt(t){return jt(t)&&ue(t)}function Cp(t){return t===!0||t===!1||jt(t)&&re(t)==tt}var Xe=Ll||po,Ap=ea?de(ea):Ec;function Rp(t){return jt(t)&&t.nodeType===1&&!Qn(t)}function Op(t){if(t==null)return!0;if(ue(t)&&(Rt(t)||typeof t=="string"||typeof t.splice=="function"||Xe(t)||Tn(t)||fn(t)))return!t.length;var e=ne(t);if(e==lt||e==rt)return!t.size;if(Kn(t))return!xi(t).length;for(var n in t)if(Nt.call(t,n))return!1;return!0}function Sp(t,e){return jn(t,e)}function bp(t,e,n){n=typeof n=="function"?n:v;var l=n?n(t,e):v;return l===v?jn(t,e,v,n):!!l}function ro(t){if(!jt(t))return!1;var e=re(t);return e==gt||e==vt||typeof t.message=="string"&&typeof t.name=="string"&&!Qn(t)}function Tp(t){return typeof t=="number"&&Ra(t)}function He(t){if(!zt(t))return!1;var e=re(t);return e==Ot||e==Mt||e==k||e==ae}function Ws(t){return typeof t=="number"&&t==St(t)}function Gr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=j}function zt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function jt(t){return t!=null&&typeof t=="object"}var zs=na?de(na):Pc;function Ip(t,e){return t===e||wi(t,e,Ji(e))}function Ep(t,e,n){return n=typeof n=="function"?n:v,wi(t,e,Ji(e),n)}function _p(t){return js(t)&&t!=+t}function Pp(t){if(dd(t))throw new At(g);return Da(t)}function wp(t){return t===null}function xp(t){return t==null}function js(t){return typeof t=="number"||jt(t)&&re(t)==xt}function Qn(t){if(!jt(t)||re(t)!=Ut)return!1;var e=cr(t);if(e===null)return!0;var n=Nt.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&sr.call(n)==El}var io=ra?de(ra):wc;function Mp(t){return Ws(t)&&t>=-j&&t<=j}var Vs=ia?de(ia):xc;function Fr(t){return typeof t=="string"||!Rt(t)&&jt(t)&&re(t)==st}function pe(t){return typeof t=="symbol"||jt(t)&&re(t)==ht}var Tn=oa?de(oa):Mc;function Lp(t){return t===v}function Dp(t){return jt(t)&&ne(t)==Kt}function Np(t){return jt(t)&&re(t)==Ze}var Up=Pr(Mi),Bp=Pr(function(t,e){return t<=e});function ks(t){if(!t)return[];if(ue(t))return Fr(t)?Ie(t):se(t);if(Nn&&t[Nn])return gl(t[Nn]());var e=ne(t),n=e==lt?Ci:e==rt?ir:In;return n(t)}function We(t){if(!t)return t===0?t:0;if(t=Te(t),t===_||t===-_){var e=t<0?-1:1;return e*W}return t===t?t:0}function St(t){var e=We(t),n=e%1;return e===e?n?e-n:e:0}function Ks(t){return t?on(St(t),0,Z):0}function Te(t){if(typeof t=="number")return t;if(pe(t))return Q;if(zt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=zt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ca(t);var n=yf.test(t);return n||Af.test(t)?Xf(t.slice(2),n?2:8):mf.test(t)?Q:+t}function Js(t){return Me(t,fe(t))}function Gp(t){return t?on(St(t),-j,j):t===0?t:0}function Dt(t){return t==null?"":he(t)}var Fp=On(function(t,e){if(Kn(e)||ue(e)){Me(e,Xt(e),t);return}for(var n in e)Nt.call(e,n)&&Hn(t,n,e[n])}),Qs=On(function(t,e){Me(e,fe(e),t)}),Hr=On(function(t,e,n,l){Me(e,fe(e),t,l)}),Hp=On(function(t,e,n,l){Me(e,Xt(e),t,l)}),Wp=Ge(Ti);function zp(t,e){var n=Rn(t);return e==null?n:Ia(n,e)}var jp=It(function(t,e){t=Bt(t);var n=-1,l=e.length,O=l>2?e[2]:v;for(O&&ie(e[0],e[1],O)&&(l=1);++n<l;)for(var B=e[n],V=fe(B),J=-1,Y=V.length;++J<Y;){var it=V[J],ot=t[it];(ot===v||_e(ot,yn[it])&&!Nt.call(t,it))&&(t[it]=B[it])}return t}),Vp=It(function(t){return t.push(v,cs),ce($s,v,t)});function kp(t,e){return sa(t,mt(e,3),xe)}function Kp(t,e){return sa(t,mt(e,3),Ei)}function Jp(t,e){return t==null?t:Ii(t,mt(e,3),fe)}function Qp(t,e){return t==null?t:xa(t,mt(e,3),fe)}function $p(t,e){return t&&xe(t,mt(e,3))}function qp(t,e){return t&&Ei(t,mt(e,3))}function Yp(t){return t==null?[]:Rr(t,Xt(t))}function Xp(t){return t==null?[]:Rr(t,fe(t))}function oo(t,e,n){var l=t==null?v:an(t,e);return l===v?n:l}function Zp(t,e){return t!=null&&ps(t,e,Oc)}function ao(t,e){return t!=null&&ps(t,e,Sc)}var tg=as(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=ur.call(e)),t[e]=n},uo(le)),eg=as(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=ur.call(e)),Nt.call(t,e)?t[e].push(n):t[e]=[n]},mt),ng=It(zn);function Xt(t){return ue(t)?ba(t):xi(t)}function fe(t){return ue(t)?ba(t,!0):Lc(t)}function rg(t,e){var n={};return e=mt(e,3),xe(t,function(l,O,B){Ue(n,e(l,O,B),l)}),n}function ig(t,e){var n={};return e=mt(e,3),xe(t,function(l,O,B){Ue(n,O,e(l,O,B))}),n}var og=On(function(t,e,n){Or(t,e,n)}),$s=On(function(t,e,n,l){Or(t,e,n,l)}),ag=Ge(function(t,e){var n={};if(t==null)return n;var l=!1;e=Wt(e,function(B){return B=qe(B,t),l||(l=B.length>1),B}),Me(t,ki(t),n),l&&(n=Oe(n,F|S|b,td));for(var O=e.length;O--;)Bi(n,e[O]);return n});function sg(t,e){return qs(t,Br(mt(e)))}var ug=Ge(function(t,e){return t==null?{}:Nc(t,e)});function qs(t,e){if(t==null)return{};var n=Wt(ki(t),function(l){return[l]});return e=mt(e),Wa(t,n,function(l,O){return e(l,O[0])})}function fg(t,e,n){e=qe(e,t);var l=-1,O=e.length;for(O||(O=1,t=v);++l<O;){var B=t==null?v:t[Le(e[l])];B===v&&(l=O,B=n),t=He(B)?B.call(t):B}return t}function lg(t,e,n){return t==null?t:Vn(t,e,n)}function cg(t,e,n,l){return l=typeof l=="function"?l:v,t==null?t:Vn(t,e,n,l)}var Ys=fs(Xt),Xs=fs(fe);function dg(t,e,n){var l=Rt(t),O=l||Xe(t)||Tn(t);if(e=mt(e,4),n==null){var B=t&&t.constructor;O?n=l?new B:[]:zt(t)?n=He(B)?Rn(cr(t)):{}:n={}}return(O?Ce:xe)(t,function(V,J,Y){return e(n,V,J,Y)}),n}function hg(t,e){return t==null?!0:Bi(t,e)}function pg(t,e,n){return t==null?t:Ka(t,e,Hi(n))}function gg(t,e,n,l){return l=typeof l=="function"?l:v,t==null?t:Ka(t,e,Hi(n),l)}function In(t){return t==null?[]:yi(t,Xt(t))}function vg(t){return t==null?[]:yi(t,fe(t))}function mg(t,e,n){return n===v&&(n=e,e=v),n!==v&&(n=Te(n),n=n===n?n:0),e!==v&&(e=Te(e),e=e===e?e:0),on(Te(t),e,n)}function yg(t,e,n){return e=We(e),n===v?(n=e,e=0):n=We(n),t=Te(t),bc(t,e,n)}function Cg(t,e,n){if(n&&typeof n!="boolean"&&ie(t,e,n)&&(e=n=v),n===v&&(typeof e=="boolean"?(n=e,e=v):typeof t=="boolean"&&(n=t,t=v)),t===v&&e===v?(t=0,e=1):(t=We(t),e===v?(e=t,t=0):e=We(e)),t>e){var l=t;t=e,e=l}if(n||t%1||e%1){var O=Oa();return ee(t+O*(e-t+Yf("1e-"+((O+"").length-1))),e)}return Di(t,e)}var Ag=Sn(function(t,e,n){return e=e.toLowerCase(),t+(n?Zs(e):e)});function Zs(t){return so(Dt(t).toLowerCase())}function tu(t){return t=Dt(t),t&&t.replace(Of,ll).replace(Wf,"")}function Rg(t,e,n){t=Dt(t),e=he(e);var l=t.length;n=n===v?l:on(St(n),0,l);var O=n;return n-=e.length,n>=0&&t.slice(n,O)==e}function Og(t){return t=Dt(t),t&&ef.test(t)?t.replace(xo,cl):t}function Sg(t){return t=Dt(t),t&&uf.test(t)?t.replace(ni,"\\$&"):t}var bg=Sn(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Tg=Sn(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Ig=rs("toLowerCase");function Eg(t,e,n){t=Dt(t),e=St(e);var l=e?mn(t):0;if(!e||l>=e)return t;var O=(e-l)/2;return _r(gr(O),n)+t+_r(pr(O),n)}function _g(t,e,n){t=Dt(t),e=St(e);var l=e?mn(t):0;return e&&l<e?t+_r(e-l,n):t}function Pg(t,e,n){t=Dt(t),e=St(e);var l=e?mn(t):0;return e&&l<e?_r(e-l,n)+t:t}function wg(t,e,n){return n||e==null?e=0:e&&(e=+e),Bl(Dt(t).replace(ri,""),e||0)}function xg(t,e,n){return(n?ie(t,e,n):e===v)?e=1:e=St(e),Ni(Dt(t),e)}function Mg(){var t=arguments,e=Dt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var Lg=Sn(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function Dg(t,e,n){return n&&typeof n!="number"&&ie(t,e,n)&&(e=n=v),n=n===v?Z:n>>>0,n?(t=Dt(t),t&&(typeof e=="string"||e!=null&&!io(e))&&(e=he(e),!e&&vn(t))?Ye(Ie(t),0,n):t.split(e,n)):[]}var Ng=Sn(function(t,e,n){return t+(n?" ":"")+so(e)});function Ug(t,e,n){return t=Dt(t),n=n==null?0:on(St(n),0,t.length),e=he(e),t.slice(n,n+e.length)==e}function Bg(t,e,n){var l=x.templateSettings;n&&ie(t,e,n)&&(e=v),t=Dt(t),e=Hr({},e,l,ls);var O=Hr({},e.imports,l.imports,ls),B=Xt(O),V=yi(O,B),J,Y,it=0,ot=e.interpolate||Zn,at="__p += '",ft=Ai((e.escape||Zn).source+"|"+ot.source+"|"+(ot===Mo?vf:Zn).source+"|"+(e.evaluate||Zn).source+"|$","g"),pt="//# sourceURL="+(Nt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Kf+"]")+`
`;t.replace(ft,function(Ct,Et,wt,ge,oe,ve){return wt||(wt=ge),at+=t.slice(it,ve).replace(Sf,dl),Et&&(J=!0,at+=`' +
__e(`+Et+`) +
'`),oe&&(Y=!0,at+=`';
`+oe+`;
__p += '`),wt&&(at+=`' +
((__t = (`+wt+`)) == null ? '' : __t) +
'`),it=ve+Ct.length,Ct}),at+=`';
`;var yt=Nt.call(e,"variable")&&e.variable;if(!yt)at=`with (obj) {
`+at+`
}
`;else if(pf.test(yt))throw new At(N);at=(Y?at.replace(Yu,""):at).replace(Xu,"$1").replace(Zu,"$1;"),at="function("+(yt||"obj")+`) {
`+(yt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+at+`return __p
}`;var Tt=nu(function(){return Lt(B,pt+"return "+at).apply(v,V)});if(Tt.source=at,ro(Tt))throw Tt;return Tt}function Gg(t){return Dt(t).toLowerCase()}function Fg(t){return Dt(t).toUpperCase()}function Hg(t,e,n){if(t=Dt(t),t&&(n||e===v))return ca(t);if(!t||!(e=he(e)))return t;var l=Ie(t),O=Ie(e),B=da(l,O),V=ha(l,O)+1;return Ye(l,B,V).join("")}function Wg(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.slice(0,ga(t)+1);if(!t||!(e=he(e)))return t;var l=Ie(t),O=ha(l,Ie(e))+1;return Ye(l,0,O).join("")}function zg(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.replace(ri,"");if(!t||!(e=he(e)))return t;var l=Ie(t),O=da(l,Ie(e));return Ye(l,O).join("")}function jg(t,e){var n=p,l=R;if(zt(e)){var O="separator"in e?e.separator:O;n="length"in e?St(e.length):n,l="omission"in e?he(e.omission):l}t=Dt(t);var B=t.length;if(vn(t)){var V=Ie(t);B=V.length}if(n>=B)return t;var J=n-mn(l);if(J<1)return l;var Y=V?Ye(V,0,J).join(""):t.slice(0,J);if(O===v)return Y+l;if(V&&(J+=Y.length-J),io(O)){if(t.slice(J).search(O)){var it,ot=Y;for(O.global||(O=Ai(O.source,Dt(Lo.exec(O))+"g")),O.lastIndex=0;it=O.exec(ot);)var at=it.index;Y=Y.slice(0,at===v?J:at)}}else if(t.indexOf(he(O),J)!=J){var ft=Y.lastIndexOf(O);ft>-1&&(Y=Y.slice(0,ft))}return Y+l}function Vg(t){return t=Dt(t),t&&tf.test(t)?t.replace(wo,Cl):t}var kg=Sn(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),so=rs("toUpperCase");function eu(t,e,n){return t=Dt(t),e=n?v:e,e===v?pl(t)?Ol(t):ol(t):t.match(e)||[]}var nu=It(function(t,e){try{return ce(t,v,e)}catch(n){return ro(n)?n:new At(n)}}),Kg=Ge(function(t,e){return Ce(e,function(n){n=Le(n),Ue(t,n,eo(t[n],t))}),t});function Jg(t){var e=t==null?0:t.length,n=mt();return t=e?Wt(t,function(l){if(typeof l[1]!="function")throw new Ae(a);return[n(l[0]),l[1]]}):[],It(function(l){for(var O=-1;++O<e;){var B=t[O];if(ce(B[0],this,l))return ce(B[1],this,l)}})}function Qg(t){return Cc(Oe(t,F))}function uo(t){return function(){return t}}function $g(t,e){return t==null||t!==t?e:t}var qg=os(),Yg=os(!0);function le(t){return t}function fo(t){return Na(typeof t=="function"?t:Oe(t,F))}function Xg(t){return Ba(Oe(t,F))}function Zg(t,e){return Ga(t,Oe(e,F))}var tv=It(function(t,e){return function(n){return zn(n,t,e)}}),ev=It(function(t,e){return function(n){return zn(t,n,e)}});function lo(t,e,n){var l=Xt(e),O=Rr(e,l);n==null&&!(zt(e)&&(O.length||!l.length))&&(n=e,e=t,t=this,O=Rr(e,Xt(e)));var B=!(zt(n)&&"chain"in n)||!!n.chain,V=He(t);return Ce(O,function(J){var Y=e[J];t[J]=Y,V&&(t.prototype[J]=function(){var it=this.__chain__;if(B||it){var ot=t(this.__wrapped__),at=ot.__actions__=se(this.__actions__);return at.push({func:Y,args:arguments,thisArg:t}),ot.__chain__=it,ot}return Y.apply(t,Ve([this.value()],arguments))})}),t}function nv(){return Yt._===this&&(Yt._=_l),this}function co(){}function rv(t){return t=St(t),It(function(e){return Fa(e,t)})}var iv=zi(Wt),ov=zi(aa),av=zi(hi);function ru(t){return $i(t)?pi(Le(t)):Uc(t)}function sv(t){return function(e){return t==null?v:an(t,e)}}var uv=ss(),fv=ss(!0);function ho(){return[]}function po(){return!1}function lv(){return{}}function cv(){return""}function dv(){return!0}function hv(t,e){if(t=St(t),t<1||t>j)return[];var n=Z,l=ee(t,Z);e=mt(e),t-=Z;for(var O=mi(l,e);++n<t;)e(n);return O}function pv(t){return Rt(t)?Wt(t,Le):pe(t)?[t]:se(Ss(Dt(t)))}function gv(t){var e=++Il;return Dt(t)+e}var vv=Er(function(t,e){return t+e},0),mv=ji("ceil"),yv=Er(function(t,e){return t/e},1),Cv=ji("floor");function Av(t){return t&&t.length?Ar(t,le,_i):v}function Rv(t,e){return t&&t.length?Ar(t,mt(e,2),_i):v}function Ov(t){return fa(t,le)}function Sv(t,e){return fa(t,mt(e,2))}function bv(t){return t&&t.length?Ar(t,le,Mi):v}function Tv(t,e){return t&&t.length?Ar(t,mt(e,2),Mi):v}var Iv=Er(function(t,e){return t*e},1),Ev=ji("round"),_v=Er(function(t,e){return t-e},0);function Pv(t){return t&&t.length?vi(t,le):0}function wv(t,e){return t&&t.length?vi(t,mt(e,2)):0}return x.after=Xh,x.ary=Ds,x.assign=Fp,x.assignIn=Qs,x.assignInWith=Hr,x.assignWith=Hp,x.at=Wp,x.before=Ns,x.bind=eo,x.bindAll=Kg,x.bindKey=Us,x.castArray=lp,x.chain=xs,x.chunk=Cd,x.compact=Ad,x.concat=Rd,x.cond=Jg,x.conforms=Qg,x.constant=uo,x.countBy=Ph,x.create=zp,x.curry=Bs,x.curryRight=Gs,x.debounce=Fs,x.defaults=jp,x.defaultsDeep=Vp,x.defer=Zh,x.delay=tp,x.difference=Od,x.differenceBy=Sd,x.differenceWith=bd,x.drop=Td,x.dropRight=Id,x.dropRightWhile=Ed,x.dropWhile=_d,x.fill=Pd,x.filter=xh,x.flatMap=Dh,x.flatMapDeep=Nh,x.flatMapDepth=Uh,x.flatten=Es,x.flattenDeep=wd,x.flattenDepth=xd,x.flip=ep,x.flow=qg,x.flowRight=Yg,x.fromPairs=Md,x.functions=Yp,x.functionsIn=Xp,x.groupBy=Bh,x.initial=Dd,x.intersection=Nd,x.intersectionBy=Ud,x.intersectionWith=Bd,x.invert=tg,x.invertBy=eg,x.invokeMap=Fh,x.iteratee=fo,x.keyBy=Hh,x.keys=Xt,x.keysIn=fe,x.map=Dr,x.mapKeys=rg,x.mapValues=ig,x.matches=Xg,x.matchesProperty=Zg,x.memoize=Ur,x.merge=og,x.mergeWith=$s,x.method=tv,x.methodOf=ev,x.mixin=lo,x.negate=Br,x.nthArg=rv,x.omit=ag,x.omitBy=sg,x.once=np,x.orderBy=Wh,x.over=iv,x.overArgs=rp,x.overEvery=ov,x.overSome=av,x.partial=no,x.partialRight=Hs,x.partition=zh,x.pick=ug,x.pickBy=qs,x.property=ru,x.propertyOf=sv,x.pull=Wd,x.pullAll=Ps,x.pullAllBy=zd,x.pullAllWith=jd,x.pullAt=Vd,x.range=uv,x.rangeRight=fv,x.rearg=ip,x.reject=kh,x.remove=kd,x.rest=op,x.reverse=Zi,x.sampleSize=Jh,x.set=lg,x.setWith=cg,x.shuffle=Qh,x.slice=Kd,x.sortBy=Yh,x.sortedUniq=Zd,x.sortedUniqBy=th,x.split=Dg,x.spread=ap,x.tail=eh,x.take=nh,x.takeRight=rh,x.takeRightWhile=ih,x.takeWhile=oh,x.tap=Ah,x.throttle=sp,x.thru=Lr,x.toArray=ks,x.toPairs=Ys,x.toPairsIn=Xs,x.toPath=pv,x.toPlainObject=Js,x.transform=dg,x.unary=up,x.union=ah,x.unionBy=sh,x.unionWith=uh,x.uniq=fh,x.uniqBy=lh,x.uniqWith=ch,x.unset=hg,x.unzip=to,x.unzipWith=ws,x.update=pg,x.updateWith=gg,x.values=In,x.valuesIn=vg,x.without=dh,x.words=eu,x.wrap=fp,x.xor=hh,x.xorBy=ph,x.xorWith=gh,x.zip=vh,x.zipObject=mh,x.zipObjectDeep=yh,x.zipWith=Ch,x.entries=Ys,x.entriesIn=Xs,x.extend=Qs,x.extendWith=Hr,lo(x,x),x.add=vv,x.attempt=nu,x.camelCase=Ag,x.capitalize=Zs,x.ceil=mv,x.clamp=mg,x.clone=cp,x.cloneDeep=hp,x.cloneDeepWith=pp,x.cloneWith=dp,x.conformsTo=gp,x.deburr=tu,x.defaultTo=$g,x.divide=yv,x.endsWith=Rg,x.eq=_e,x.escape=Og,x.escapeRegExp=Sg,x.every=wh,x.find=Mh,x.findIndex=Ts,x.findKey=kp,x.findLast=Lh,x.findLastIndex=Is,x.findLastKey=Kp,x.floor=Cv,x.forEach=Ms,x.forEachRight=Ls,x.forIn=Jp,x.forInRight=Qp,x.forOwn=$p,x.forOwnRight=qp,x.get=oo,x.gt=vp,x.gte=mp,x.has=Zp,x.hasIn=ao,x.head=_s,x.identity=le,x.includes=Gh,x.indexOf=Ld,x.inRange=yg,x.invoke=ng,x.isArguments=fn,x.isArray=Rt,x.isArrayBuffer=yp,x.isArrayLike=ue,x.isArrayLikeObject=Vt,x.isBoolean=Cp,x.isBuffer=Xe,x.isDate=Ap,x.isElement=Rp,x.isEmpty=Op,x.isEqual=Sp,x.isEqualWith=bp,x.isError=ro,x.isFinite=Tp,x.isFunction=He,x.isInteger=Ws,x.isLength=Gr,x.isMap=zs,x.isMatch=Ip,x.isMatchWith=Ep,x.isNaN=_p,x.isNative=Pp,x.isNil=xp,x.isNull=wp,x.isNumber=js,x.isObject=zt,x.isObjectLike=jt,x.isPlainObject=Qn,x.isRegExp=io,x.isSafeInteger=Mp,x.isSet=Vs,x.isString=Fr,x.isSymbol=pe,x.isTypedArray=Tn,x.isUndefined=Lp,x.isWeakMap=Dp,x.isWeakSet=Np,x.join=Gd,x.kebabCase=bg,x.last=be,x.lastIndexOf=Fd,x.lowerCase=Tg,x.lowerFirst=Ig,x.lt=Up,x.lte=Bp,x.max=Av,x.maxBy=Rv,x.mean=Ov,x.meanBy=Sv,x.min=bv,x.minBy=Tv,x.stubArray=ho,x.stubFalse=po,x.stubObject=lv,x.stubString=cv,x.stubTrue=dv,x.multiply=Iv,x.nth=Hd,x.noConflict=nv,x.noop=co,x.now=Nr,x.pad=Eg,x.padEnd=_g,x.padStart=Pg,x.parseInt=wg,x.random=Cg,x.reduce=jh,x.reduceRight=Vh,x.repeat=xg,x.replace=Mg,x.result=fg,x.round=Ev,x.runInContext=$,x.sample=Kh,x.size=$h,x.snakeCase=Lg,x.some=qh,x.sortedIndex=Jd,x.sortedIndexBy=Qd,x.sortedIndexOf=$d,x.sortedLastIndex=qd,x.sortedLastIndexBy=Yd,x.sortedLastIndexOf=Xd,x.startCase=Ng,x.startsWith=Ug,x.subtract=_v,x.sum=Pv,x.sumBy=wv,x.template=Bg,x.times=hv,x.toFinite=We,x.toInteger=St,x.toLength=Ks,x.toLower=Gg,x.toNumber=Te,x.toSafeInteger=Gp,x.toString=Dt,x.toUpper=Fg,x.trim=Hg,x.trimEnd=Wg,x.trimStart=zg,x.truncate=jg,x.unescape=Vg,x.uniqueId=gv,x.upperCase=kg,x.upperFirst=so,x.each=Ms,x.eachRight=Ls,x.first=_s,lo(x,function(){var t={};return xe(x,function(e,n){Nt.call(x.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),x.VERSION=h,Ce(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){x[t].placeholder=x}),Ce(["drop","take"],function(t,e){Pt.prototype[t]=function(n){n=n===v?1:$t(St(n),0);var l=this.__filtered__&&!e?new Pt(this):this.clone();return l.__filtered__?l.__takeCount__=ee(n,l.__takeCount__):l.__views__.push({size:ee(n,Z),type:t+(l.__dir__<0?"Right":"")}),l},Pt.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),Ce(["filter","map","takeWhile"],function(t,e){var n=e+1,l=n==H||n==C;Pt.prototype[t]=function(O){var B=this.clone();return B.__iteratees__.push({iteratee:mt(O,3),type:n}),B.__filtered__=B.__filtered__||l,B}}),Ce(["head","last"],function(t,e){var n="take"+(e?"Right":"");Pt.prototype[t]=function(){return this[n](1).value()[0]}}),Ce(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Pt.prototype[t]=function(){return this.__filtered__?new Pt(this):this[n](1)}}),Pt.prototype.compact=function(){return this.filter(le)},Pt.prototype.find=function(t){return this.filter(t).head()},Pt.prototype.findLast=function(t){return this.reverse().find(t)},Pt.prototype.invokeMap=It(function(t,e){return typeof t=="function"?new Pt(this):this.map(function(n){return zn(n,t,e)})}),Pt.prototype.reject=function(t){return this.filter(Br(mt(t)))},Pt.prototype.slice=function(t,e){t=St(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Pt(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==v&&(e=St(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},Pt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Pt.prototype.toArray=function(){return this.take(Z)},xe(Pt.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),l=/^(?:head|last)$/.test(e),O=x[l?"take"+(e=="last"?"Right":""):e],B=l||/^find/.test(e);!O||(x.prototype[e]=function(){var V=this.__wrapped__,J=l?[1]:arguments,Y=V instanceof Pt,it=J[0],ot=Y||Rt(V),at=function(Et){var wt=O.apply(x,Ve([Et],J));return l&&ft?wt[0]:wt};ot&&n&&typeof it=="function"&&it.length!=1&&(Y=ot=!1);var ft=this.__chain__,pt=!!this.__actions__.length,yt=B&&!ft,Tt=Y&&!pt;if(!B&&ot){V=Tt?V:new Pt(this);var Ct=t.apply(V,J);return Ct.__actions__.push({func:Lr,args:[at],thisArg:v}),new Re(Ct,ft)}return yt&&Tt?t.apply(this,J):(Ct=this.thru(at),yt?l?Ct.value()[0]:Ct.value():Ct)})}),Ce(["pop","push","shift","sort","splice","unshift"],function(t){var e=or[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",l=/^(?:pop|shift)$/.test(t);x.prototype[t]=function(){var O=arguments;if(l&&!this.__chain__){var B=this.value();return e.apply(Rt(B)?B:[],O)}return this[n](function(V){return e.apply(Rt(V)?V:[],O)})}}),xe(Pt.prototype,function(t,e){var n=x[e];if(n){var l=n.name+"";Nt.call(An,l)||(An[l]=[]),An[l].push({name:e,func:n})}}),An[Ir(v,T).name]=[{name:"wrapper",func:v}],Pt.prototype.clone=Vl,Pt.prototype.reverse=kl,Pt.prototype.value=Kl,x.prototype.at=Rh,x.prototype.chain=Oh,x.prototype.commit=Sh,x.prototype.next=bh,x.prototype.plant=Ih,x.prototype.reverse=Eh,x.prototype.toJSON=x.prototype.valueOf=x.prototype.value=_h,x.prototype.first=x.prototype.head,Nn&&(x.prototype[Nn]=Th),x},Ke=Sl();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Yt._=Ke,define(function(){return Ke})):tn?((tn.exports=Ke)._=Ke,fi._=Ke):Yt._=Ke}).call(_n)});var lu=Jt((tm,fu)=>{ct();var Pn=1e3,wn=Pn*60,xn=wn*60,dn=xn*24,Wv=dn*7,zv=dn*365.25;fu.exports=function(v,h){h=h||{};var r=typeof v;if(r==="string"&&v.length>0)return jv(v);if(r==="number"&&isFinite(v))return h.long?kv(v):Vv(v);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(v))};function jv(v){if(v=String(v),!(v.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!h){var r=parseFloat(h[1]),g=(h[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return r*zv;case"weeks":case"week":case"w":return r*Wv;case"days":case"day":case"d":return r*dn;case"hours":case"hour":case"hrs":case"hr":case"h":return r*xn;case"minutes":case"minute":case"mins":case"min":case"m":return r*wn;case"seconds":case"second":case"secs":case"sec":case"s":return r*Pn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Vv(v){var h=Math.abs(v);return h>=dn?Math.round(v/dn)+"d":h>=xn?Math.round(v/xn)+"h":h>=wn?Math.round(v/wn)+"m":h>=Pn?Math.round(v/Pn)+"s":v+"ms"}function kv(v){var h=Math.abs(v);return h>=dn?Wr(v,h,dn,"day"):h>=xn?Wr(v,h,xn,"hour"):h>=wn?Wr(v,h,wn,"minute"):h>=Pn?Wr(v,h,Pn,"second"):v+" ms"}function Wr(v,h,r,g){var a=h>=r*1.5;return Math.round(v/r)+" "+g+(a?"s":"")}});var du=Jt((em,cu)=>{ct();function Kv(v){r.debug=r,r.default=r,r.coerce=P,r.disable=N,r.enable=a,r.enabled=I,r.humanize=lu(),r.destroy=F,Object.keys(v).forEach(S=>{r[S]=v[S]}),r.names=[],r.skips=[],r.formatters={};function h(S){let b=0;for(let u=0;u<S.length;u++)b=(b<<5)-b+S.charCodeAt(u),b|=0;return r.colors[Math.abs(b)%r.colors.length]}r.selectColor=h;function r(S){let b,u=null,A,w;function T(...m){if(!T.enabled)return;let d=T,y=Number(new Date),o=y-(b||y);d.diff=o,d.prev=b,d.curr=y,b=y,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let c=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(f,i)=>{if(f==="%%")return"%";c++;let p=r.formatters[i];if(typeof p=="function"){let R=m[c];f=p.call(d,R),m.splice(c,1),c--}return f}),r.formatArgs.call(d,m),(d.log||r.log).apply(d,m)}return T.namespace=S,T.useColors=r.useColors(),T.color=r.selectColor(S),T.extend=g,T.destroy=r.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(A!==r.namespaces&&(A=r.namespaces,w=r.enabled(S)),w),set:m=>{u=m}}),typeof r.init=="function"&&r.init(T),T}function g(S,b){let u=r(this.namespace+(typeof b=="undefined"?":":b)+S);return u.log=this.log,u}function a(S){r.save(S),r.namespaces=S,r.names=[],r.skips=[];let b,u=(typeof S=="string"?S:"").split(/[\s,]+/),A=u.length;for(b=0;b<A;b++)!u[b]||(S=u[b].replace(/\*/g,".*?"),S[0]==="-"?r.skips.push(new RegExp("^"+S.slice(1)+"$")):r.names.push(new RegExp("^"+S+"$")))}function N(){let S=[...r.names.map(E),...r.skips.map(E).map(b=>"-"+b)].join(",");return r.enable(""),S}function I(S){if(S[S.length-1]==="*")return!0;let b,u;for(b=0,u=r.skips.length;b<u;b++)if(r.skips[b].test(S))return!1;for(b=0,u=r.names.length;b<u;b++)if(r.names[b].test(S))return!0;return!1}function E(S){return S.toString().substring(2,S.toString().length-2).replace(/\.\*\?$/,"*")}function P(S){return S instanceof Error?S.stack||S.message:S}function F(){}return r.enable(r.load()),r}cu.exports=Kv});var hu=Jt((me,zr)=>{ct();me.formatArgs=Qv;me.save=$v;me.load=qv;me.useColors=Jv;me.storage=Yv();me.destroy=(()=>{let v=!1;return()=>{v||(v=!0)}})();me.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Jv(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Qv(v){if(v[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+v[0]+(this.useColors?"%c ":" ")+"+"+zr.exports.humanize(this.diff),!this.useColors)return;let h="color: "+this.color;v.splice(1,0,h,"color: inherit");let r=0,g=0;v[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(r++,a==="%c"&&(g=r))}),v.splice(g,0,h)}me.log=console.debug||console.log||(()=>{});function $v(v){try{v?me.storage.setItem("debug",v):me.storage.removeItem("debug")}catch(h){}}function qv(){let v;try{v=me.storage.getItem("debug")}catch(h){}return!v&&typeof process!="undefined"&&"env"in process&&(v=_t.DEBUG),v}function Yv(){try{return localStorage}catch(v){}}zr.exports=du()(me);var{formatters:Xv}=zr.exports;Xv.j=function(v){try{return JSON.stringify(v)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}});var jr=Jt((om,vu)=>{ct();function t0(v){var h=typeof v;return v!=null&&(h=="object"||h=="function")}vu.exports=t0});var yu=Jt((am,mu)=>{ct();var e0=typeof global=="object"&&global&&global.Object===Object&&global;mu.exports=e0});var yo=Jt((sm,Cu)=>{ct();var n0=yu(),r0=typeof self=="object"&&self&&self.Object===Object&&self,i0=n0||r0||Function("return this")();Cu.exports=i0});var Ru=Jt((um,Au)=>{ct();var o0=yo(),a0=function(){return o0.Date.now()};Au.exports=a0});var Su=Jt((fm,Ou)=>{ct();var s0=/\s/;function u0(v){for(var h=v.length;h--&&s0.test(v.charAt(h)););return h}Ou.exports=u0});var Tu=Jt((lm,bu)=>{ct();var f0=Su(),l0=/^\s+/;function c0(v){return v&&v.slice(0,f0(v)+1).replace(l0,"")}bu.exports=c0});var Co=Jt((cm,Iu)=>{ct();var d0=yo(),h0=d0.Symbol;Iu.exports=h0});var wu=Jt((dm,Pu)=>{ct();var Eu=Co(),_u=Object.prototype,p0=_u.hasOwnProperty,g0=_u.toString,Yn=Eu?Eu.toStringTag:void 0;function v0(v){var h=p0.call(v,Yn),r=v[Yn];try{v[Yn]=void 0;var g=!0}catch(N){}var a=g0.call(v);return g&&(h?v[Yn]=r:delete v[Yn]),a}Pu.exports=v0});var Mu=Jt((hm,xu)=>{ct();var m0=Object.prototype,y0=m0.toString;function C0(v){return y0.call(v)}xu.exports=C0});var Uu=Jt((pm,Nu)=>{ct();var Lu=Co(),A0=wu(),R0=Mu(),O0="[object Null]",S0="[object Undefined]",Du=Lu?Lu.toStringTag:void 0;function b0(v){return v==null?v===void 0?S0:O0:Du&&Du in Object(v)?A0(v):R0(v)}Nu.exports=b0});var Gu=Jt((gm,Bu)=>{ct();function T0(v){return v!=null&&typeof v=="object"}Bu.exports=T0});var Hu=Jt((vm,Fu)=>{ct();var I0=Uu(),E0=Gu(),_0="[object Symbol]";function P0(v){return typeof v=="symbol"||E0(v)&&I0(v)==_0}Fu.exports=P0});var Vu=Jt((mm,ju)=>{ct();var w0=Tu(),Wu=jr(),x0=Hu(),zu=0/0,M0=/^[-+]0x[0-9a-f]+$/i,L0=/^0b[01]+$/i,D0=/^0o[0-7]+$/i,N0=parseInt;function U0(v){if(typeof v=="number")return v;if(x0(v))return zu;if(Wu(v)){var h=typeof v.valueOf=="function"?v.valueOf():v;v=Wu(h)?h+"":h}if(typeof v!="string")return v===0?v:+v;v=w0(v);var r=L0.test(v);return r||D0.test(v)?N0(v.slice(2),r?2:8):M0.test(v)?zu:+v}ju.exports=U0});var Ju=Jt((ym,Ku)=>{ct();var B0=jr(),Ao=Ru(),ku=Vu(),G0="Expected a function",F0=Math.max,H0=Math.min;function W0(v,h,r){var g,a,N,I,E,P,F=0,S=!1,b=!1,u=!0;if(typeof v!="function")throw new TypeError(G0);h=ku(h)||0,B0(r)&&(S=!!r.leading,b="maxWait"in r,N=b?F0(ku(r.maxWait)||0,h):N,u="trailing"in r?!!r.trailing:u);function A(f){var i=g,p=a;return g=a=void 0,F=f,I=v.apply(p,i),I}function w(f){return F=f,E=setTimeout(d,h),S?A(f):I}function T(f){var i=f-P,p=f-F,R=h-i;return b?H0(R,N-p):R}function m(f){var i=f-P,p=f-F;return P===void 0||i>=h||i<0||b&&p>=N}function d(){var f=Ao();if(m(f))return y(f);E=setTimeout(d,T(f))}function y(f){return E=void 0,u&&g?A(f):(g=a=void 0,I)}function o(){E!==void 0&&clearTimeout(E),F=0,g=P=a=E=void 0}function c(){return E===void 0?I:y(Ao())}function s(){var f=Ao(),i=m(f);if(g=arguments,a=this,P=f,i){if(E===void 0)return w(P);if(b)return clearTimeout(E),E=setTimeout(d,h),A(P)}return E===void 0&&(E=setTimeout(d,h)),I}return s.cancel=o,s.flush=c,s}Ku.exports=W0});var Ro=Jt((Cm,Qu)=>{ct();var z0=Ju(),j0=jr(),V0="Expected a function";function k0(v,h,r){var g=!0,a=!0;if(typeof v!="function")throw new TypeError(V0);return j0(r)&&(g="leading"in r?!!r.leading:g,a="trailing"in r?!!r.trailing:a),z0(v,h,{leading:g,maxWait:h,trailing:a})}Qu.exports=k0});var qu=Jt((kr,Oo)=>{ct();(function(h,r){typeof kr=="object"&&typeof Oo=="object"?Oo.exports=r():typeof define=="function"&&define.amd?define([],r):typeof kr=="object"?kr.Ably=r():h.Ably=r()})(window,function(){return function(v){var h={};function r(g){if(h[g])return h[g].exports;var a=h[g]={i:g,l:!1,exports:{}};return v[g].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=v,r.c=h,r.d=function(g,a,N){r.o(g,a)||Object.defineProperty(g,a,{enumerable:!0,get:N})},r.r=function(g){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},r.t=function(g,a){if(a&1&&(g=r(g)),a&8||a&4&&typeof g=="object"&&g&&g.__esModule)return g;var N=Object.create(null);if(r.r(N),Object.defineProperty(N,"default",{enumerable:!0,value:g}),a&2&&typeof g!="string")for(var I in g)r.d(N,I,function(E){return g[E]}.bind(null,I));return N},r.n=function(g){var a=g&&g.__esModule?function(){return g.default}:function(){return g};return r.d(a,"a",a),a},r.o=function(g,a){return Object.prototype.hasOwnProperty.call(g,a)},r.p="",r(r.s=41)}([function(v,h,r){"use strict";h.__esModule=!0;var g=function(){function a(){}return a}();h.default=g},function(v,h,r){"use strict";r.r(h),r.d(h,"__extends",function(){return a}),r.d(h,"__assign",function(){return N}),r.d(h,"__rest",function(){return I}),r.d(h,"__decorate",function(){return E}),r.d(h,"__param",function(){return P}),r.d(h,"__metadata",function(){return F}),r.d(h,"__awaiter",function(){return S}),r.d(h,"__generator",function(){return b}),r.d(h,"__createBinding",function(){return u}),r.d(h,"__exportStar",function(){return A}),r.d(h,"__values",function(){return w}),r.d(h,"__read",function(){return T}),r.d(h,"__spread",function(){return m}),r.d(h,"__spreadArrays",function(){return d}),r.d(h,"__spreadArray",function(){return y}),r.d(h,"__await",function(){return o}),r.d(h,"__asyncGenerator",function(){return c}),r.d(h,"__asyncDelegator",function(){return s}),r.d(h,"__asyncValues",function(){return f}),r.d(h,"__makeTemplateObject",function(){return i}),r.d(h,"__importStar",function(){return R}),r.d(h,"__importDefault",function(){return L}),r.d(h,"__classPrivateFieldGet",function(){return z}),r.d(h,"__classPrivateFieldSet",function(){return H});var g=function(D,C){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,j){_.__proto__=j}||function(_,j){for(var W in j)Object.prototype.hasOwnProperty.call(j,W)&&(_[W]=j[W])},g(D,C)};function a(D,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");g(D,C);function _(){this.constructor=D}D.prototype=C===null?Object.create(C):(_.prototype=C.prototype,new _)}var N=function(){return N=Object.assign||function(C){for(var _,j=1,W=arguments.length;j<W;j++){_=arguments[j];for(var Q in _)Object.prototype.hasOwnProperty.call(_,Q)&&(C[Q]=_[Q])}return C},N.apply(this,arguments)};function I(D,C){var _={};for(var j in D)Object.prototype.hasOwnProperty.call(D,j)&&C.indexOf(j)<0&&(_[j]=D[j]);if(D!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,j=Object.getOwnPropertySymbols(D);W<j.length;W++)C.indexOf(j[W])<0&&Object.prototype.propertyIsEnumerable.call(D,j[W])&&(_[j[W]]=D[j[W]]);return _}function E(D,C,_,j){var W=arguments.length,Q=W<3?C:j===null?j=Object.getOwnPropertyDescriptor(C,_):j,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(D,C,_,j);else for(var q=D.length-1;q>=0;q--)(Z=D[q])&&(Q=(W<3?Z(Q):W>3?Z(C,_,Q):Z(C,_))||Q);return W>3&&Q&&Object.defineProperty(C,_,Q),Q}function P(D,C){return function(_,j){C(_,j,D)}}function F(D,C){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(D,C)}function S(D,C,_,j){function W(Q){return Q instanceof _?Q:new _(function(Z){Z(Q)})}return new(_||(_=Promise))(function(Q,Z){function q(U){try{M(j.next(U))}catch(K){Z(K)}}function G(U){try{M(j.throw(U))}catch(K){Z(K)}}function M(U){U.done?Q(U.value):W(U.value).then(q,G)}M((j=j.apply(D,C||[])).next())})}function b(D,C){var _={label:0,sent:function(){if(Q[0]&1)throw Q[1];return Q[1]},trys:[],ops:[]},j,W,Q,Z;return Z={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function q(M){return function(U){return G([M,U])}}function G(M){if(j)throw new TypeError("Generator is already executing.");for(;_;)try{if(j=1,W&&(Q=M[0]&2?W.return:M[0]?W.throw||((Q=W.return)&&Q.call(W),0):W.next)&&!(Q=Q.call(W,M[1])).done)return Q;switch(W=0,Q&&(M=[M[0]&2,Q.value]),M[0]){case 0:case 1:Q=M;break;case 4:return _.label++,{value:M[1],done:!1};case 5:_.label++,W=M[1],M=[0];continue;case 7:M=_.ops.pop(),_.trys.pop();continue;default:if(Q=_.trys,!(Q=Q.length>0&&Q[Q.length-1])&&(M[0]===6||M[0]===2)){_=0;continue}if(M[0]===3&&(!Q||M[1]>Q[0]&&M[1]<Q[3])){_.label=M[1];break}if(M[0]===6&&_.label<Q[1]){_.label=Q[1],Q=M;break}if(Q&&_.label<Q[2]){_.label=Q[2],_.ops.push(M);break}Q[2]&&_.ops.pop(),_.trys.pop();continue}M=C.call(D,_)}catch(U){M=[6,U],W=0}finally{j=Q=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}}var u=Object.create?function(D,C,_,j){j===void 0&&(j=_),Object.defineProperty(D,j,{enumerable:!0,get:function(){return C[_]}})}:function(D,C,_,j){j===void 0&&(j=_),D[j]=C[_]};function A(D,C){for(var _ in D)_!=="default"&&!Object.prototype.hasOwnProperty.call(C,_)&&u(C,D,_)}function w(D){var C=typeof Symbol=="function"&&Symbol.iterator,_=C&&D[C],j=0;if(_)return _.call(D);if(D&&typeof D.length=="number")return{next:function(){return D&&j>=D.length&&(D=void 0),{value:D&&D[j++],done:!D}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")}function T(D,C){var _=typeof Symbol=="function"&&D[Symbol.iterator];if(!_)return D;var j=_.call(D),W,Q=[],Z;try{for(;(C===void 0||C-- >0)&&!(W=j.next()).done;)Q.push(W.value)}catch(q){Z={error:q}}finally{try{W&&!W.done&&(_=j.return)&&_.call(j)}finally{if(Z)throw Z.error}}return Q}function m(){for(var D=[],C=0;C<arguments.length;C++)D=D.concat(T(arguments[C]));return D}function d(){for(var D=0,C=0,_=arguments.length;C<_;C++)D+=arguments[C].length;for(var j=Array(D),W=0,C=0;C<_;C++)for(var Q=arguments[C],Z=0,q=Q.length;Z<q;Z++,W++)j[W]=Q[Z];return j}function y(D,C,_){if(_||arguments.length===2)for(var j=0,W=C.length,Q;j<W;j++)(Q||!(j in C))&&(Q||(Q=Array.prototype.slice.call(C,0,j)),Q[j]=C[j]);return D.concat(Q||Array.prototype.slice.call(C))}function o(D){return this instanceof o?(this.v=D,this):new o(D)}function c(D,C,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j=_.apply(D,C||[]),W,Q=[];return W={},Z("next"),Z("throw"),Z("return"),W[Symbol.asyncIterator]=function(){return this},W;function Z(k){j[k]&&(W[k]=function(tt){return new Promise(function(ut,vt){Q.push([k,tt,ut,vt])>1||q(k,tt)})})}function q(k,tt){try{G(j[k](tt))}catch(ut){K(Q[0][3],ut)}}function G(k){k.value instanceof o?Promise.resolve(k.value.v).then(M,U):K(Q[0][2],k)}function M(k){q("next",k)}function U(k){q("throw",k)}function K(k,tt){k(tt),Q.shift(),Q.length&&q(Q[0][0],Q[0][1])}}function s(D){var C,_;return C={},j("next"),j("throw",function(W){throw W}),j("return"),C[Symbol.iterator]=function(){return this},C;function j(W,Q){C[W]=D[W]?function(Z){return(_=!_)?{value:o(D[W](Z)),done:W==="return"}:Q?Q(Z):Z}:Q}}function f(D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=D[Symbol.asyncIterator],_;return C?C.call(D):(D=typeof w=="function"?w(D):D[Symbol.iterator](),_={},j("next"),j("throw"),j("return"),_[Symbol.asyncIterator]=function(){return this},_);function j(Q){_[Q]=D[Q]&&function(Z){return new Promise(function(q,G){Z=D[Q](Z),W(q,G,Z.done,Z.value)})}}function W(Q,Z,q,G){Promise.resolve(G).then(function(M){Q({value:M,done:q})},Z)}}function i(D,C){return Object.defineProperty?Object.defineProperty(D,"raw",{value:C}):D.raw=C,D}var p=Object.create?function(D,C){Object.defineProperty(D,"default",{enumerable:!0,value:C})}:function(D,C){D.default=C};function R(D){if(D&&D.__esModule)return D;var C={};if(D!=null)for(var _ in D)_!=="default"&&Object.prototype.hasOwnProperty.call(D,_)&&u(C,D,_);return p(C,D),C}function L(D){return D&&D.__esModule?D:{default:D}}function z(D,C,_,j){if(_==="a"&&!j)throw new TypeError("Private accessor was defined without a getter");if(typeof C=="function"?D!==C||!j:!C.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return _==="m"?j:_==="a"?j.call(D):j?j.value:C.get(D)}function H(D,C,_,j,W){if(j==="m")throw new TypeError("Private method is not writable");if(j==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof C=="function"?D!==C||!W:!C.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return j==="a"?W.call(D,_):W?W.value=_:C.set(D,_),_}},function(v,h,r){"use strict";(function(g){h.__esModule=!0,h.allToUpperCase=h.allToLowerCase=h.encodeBody=h.decodeBody=h.Format=h.promisify=h.trim=h.arrChooseN=h.randomHexString=h.randomString=h.cheapRandStr=h.dataSizeBytes=h.inspectBody=h.inspectError=h.isErrorInfo=h.now=h.parseQueryString=h.toQueryString=h.arrPopRandomElement=h.defaultPostHeaders=h.defaultGetHeaders=h.allSame=h.arrEvery=h.arrFilter=h.arrMap=h.safeArrForEach=h.arrForEach=h.forInOwnNonNullProperties=h.valuesArray=h.keysArray=h.arrWithoutValue=h.arrDeleteValue=h.arrIn=h.arrIndexOf=h.arrSubtract=h.arrIntersectOb=h.arrIntersect=h.intersect=h.containsValue=h.inherits=h.prototypicalClone=h.shallowClone=h.isEmptyArg=h.isOnlyPropIn=h.isEmpty=h.isObject=h.ensureArray=h.isArray=h.copy=h.mixin=void 0,h.getGlobalObject=h.getJitterCoefficient=h.getBackoffCoefficient=void 0;var a=r(1),N=a.__importDefault(r(0)),I=a.__importDefault(r(8));function E(X){return Math.floor(Math.random()*X.length)}function P(X){for(var rt=[],st=1;st<arguments.length;st++)rt[st-1]=arguments[st];for(var ht=0;ht<rt.length;ht++){var bt=rt[ht];if(!bt)break;var Kt=Object.prototype.hasOwnProperty;for(var Ze in bt)(!Kt||Kt.call(bt,Ze))&&(X[Ze]=bt[Ze])}return X}h.mixin=P;function F(X){return P({},X)}h.copy=F,h.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function S(X){return w(X)?[]:h.isArray(X)?X:[X]}h.ensureArray=S;function b(X){return Object.prototype.toString.call(X)=="[object Object]"}h.isObject=b;function u(X){for(var rt in X)return!1;return!0}h.isEmpty=u;function A(X,rt){for(var st in X)if(st!==rt)return!1;return!0}h.isOnlyPropIn=A;function w(X){return X==null}h.isEmptyArg=w;function T(X){var rt=new Object;for(var st in X)rt[st]=X[st];return rt}h.shallowClone=T;function m(X,rt){var st=function(){function bt(){}return bt}();st.prototype=X;var ht=new st;return rt&&P(ht,rt),ht}h.prototypicalClone=m;var d=function(X,rt){if(N.default.Config.inherits){N.default.Config.inherits(X,rt);return}X.super_=rt,X.prototype=m(rt.prototype,{constructor:X})};h.inherits=d;function y(X,rt){for(var st in X)if(X[st]==rt)return!0;return!1}h.containsValue=y;function o(X,rt){return h.isArray(rt)?c(X,rt):s(X,rt)}h.intersect=o;function c(X,rt){for(var st=[],ht=0;ht<X.length;ht++){var bt=X[ht];h.arrIndexOf(rt,bt)!=-1&&st.push(bt)}return st}h.arrIntersect=c;function s(X,rt){for(var st=[],ht=0;ht<X.length;ht++){var bt=X[ht];bt in rt&&st.push(bt)}return st}h.arrIntersectOb=s;function f(X,rt){for(var st=[],ht=0;ht<X.length;ht++){var bt=X[ht];h.arrIndexOf(rt,bt)==-1&&st.push(bt)}return st}h.arrSubtract=f,h.arrIndexOf=Array.prototype.indexOf?function(X,rt,st){return X.indexOf(rt,st)}:function(X,rt,st){st=st||0;for(var ht=X.length;st<ht;st++)if(X[st]===rt)return st;return-1};function i(X,rt){return h.arrIndexOf(X,rt)!==-1}h.arrIn=i;function p(X,rt){var st=h.arrIndexOf(X,rt),ht=st!=-1;return ht&&X.splice(st,1),ht}h.arrDeleteValue=p;function R(X,rt){var st=X.slice();return p(st,rt),st}h.arrWithoutValue=R;function L(X,rt){var st=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||st.push(ht);return st}h.keysArray=L;function z(X,rt){var st=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||st.push(X[ht]);return st}h.valuesArray=z;function H(X,rt){for(var st in X)Object.prototype.hasOwnProperty.call(X,st)&&X[st]&&rt(st)}h.forInOwnNonNullProperties=H,h.arrForEach=Array.prototype.forEach?function(X,rt){X.forEach(rt)}:function(X,rt){for(var st=X.length,ht=0;ht<st;ht++)rt(X[ht],ht,X)};function D(X,rt){return h.arrForEach(X.slice(),rt)}h.safeArrForEach=D,h.arrMap=Array.prototype.map?function(X,rt){return X.map(rt)}:function(X,rt){for(var st=[],ht=X.length,bt=0;bt<ht;bt++)st.push(rt(X[bt],bt,X));return st},h.arrFilter=Array.prototype.filter?function(X,rt){return X.filter(rt)}:function(X,rt){for(var st=[],ht=X.length,bt=0;bt<ht;bt++)rt(X[bt])&&st.push(X[bt]);return st},h.arrEvery=Array.prototype.every?function(X,rt){return X.every(rt)}:function(X,rt){for(var st=X.length,ht=0;ht<st;ht++)if(!rt(X[ht],ht,X))return!1;return!0};function C(X,rt){if(X.length===0)return!0;var st=X[0][rt];return h.arrEvery(X,function(ht){return ht[rt]===st})}h.allSame=C;var _={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function j(X){var rt=_[X||Ot.json];return{accept:rt,"X-Ably-Version":I.default.apiVersion,"Ably-Agent":I.default.agent}}h.defaultGetHeaders=j;function W(X){var rt,st=rt=_[X||Ot.json];return{accept:st,"content-type":rt,"X-Ably-Version":I.default.apiVersion,"Ably-Agent":I.default.agent}}h.defaultPostHeaders=W;function Q(X){return X.splice(E(X),1)[0]}h.arrPopRandomElement=Q;function Z(X){var rt=[];if(X)for(var st in X)rt.push(encodeURIComponent(st)+"="+encodeURIComponent(X[st]));return rt.length?"?"+rt.join("&"):""}h.toQueryString=Z;function q(X){for(var rt,st=/([^?&=]+)=?([^&]*)/g,ht={};rt=st.exec(X);)ht[decodeURIComponent(rt[1])]=decodeURIComponent(rt[2]);return ht}h.parseQueryString=q,h.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}h.isErrorInfo=G;function M(X){var rt,st;return X instanceof Error||((st=(rt=X)===null||rt===void 0?void 0:rt.constructor)===null||st===void 0?void 0:st.name)==="ErrorInfo"?N.default.Config.inspect(X):X.toString()}h.inspectError=M;function U(X){return N.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:N.default.Config.inspect(X)}h.inspectBody=U;function K(X){if(N.default.BufferUtils.isBuffer(X))return N.default.BufferUtils.byteLength(X);if(typeof X=="string")return N.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}h.dataSizeBytes=K;function k(){return String(Math.random()).substr(2)}h.cheapRandStr=k;var tt=function(X){if(N.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return N.default.Config.getRandomValues(rt),N.default.BufferUtils.base64Encode(rt)}for(var st=N.default.BufferUtils.base64CharSet,ht=Math.round(X*4/3),bt="",Kt=0;Kt<ht;Kt++)bt+=st[E(st)];return bt};h.randomString=tt;var ut=function(X){if(N.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return N.default.Config.getRandomValues(rt),N.default.BufferUtils.hexEncode(rt)}for(var st=N.default.BufferUtils.hexCharSet,ht=X*2,bt="",Kt=0;Kt<ht;Kt++)bt+=st[E(st)];return bt};h.randomHexString=ut;function vt(X,rt){for(var st=Math.min(rt,X.length),ht=X.slice(),bt=[],Kt=0;Kt<st;Kt++)bt.push(Q(ht));return bt}h.arrChooseN=vt,h.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function gt(X,rt,st){return new Promise(function(ht,bt){X[rt].apply(X,a.__spreadArray(a.__spreadArray([],st),[function(Kt,Ze){Kt?bt(Kt):ht(Ze)}]))})}h.promisify=gt;var Ot;(function(X){X.msgpack="msgpack",X.json="json"})(Ot=h.Format||(h.Format={}));function Mt(X,rt){return rt=="msgpack"?N.default.Config.msgpack.decode(X):JSON.parse(String(X))}h.decodeBody=Mt;function lt(X,rt){return rt=="msgpack"?N.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}h.encodeBody=lt;function xt(X){return X.map(function(rt){return rt&&rt.toLowerCase()})}h.allToLowerCase=xt;function qt(X){return X.map(function(rt){return rt&&rt.toUpperCase()})}h.allToUpperCase=qt;function Ut(X){return Math.min((X+2)/3,2)}h.getBackoffCoefficient=Ut;function Ht(){return 1-Math.random()*.2}h.getJitterCoefficient=Ht;function ae(){return g||(typeof window!="undefined"?window:self)}h.getGlobalObject=ae}).call(this,r(12))},function(v,h,r){"use strict";(function(g){h.__esModule=!0;var a=r(1),N=a.__importDefault(r(0)),I=g||(typeof window!="undefined"?window:self),E;(function(u){u[u.None=0]="None",u[u.Error=1]="Error",u[u.Major=2]="Major",u[u.Minor=3]="Minor",u[u.Micro=4]="Micro"})(E||(E={}));function P(u,A){return(""+u).padStart(A?3:2,"0")}function F(u){return N.default.Config.logTimestamps?function(A){var w=new Date;u(P(w.getHours())+":"+P(w.getMinutes())+":"+P(w.getSeconds())+"."+P(w.getMilliseconds(),1)+" "+A)}:u}var S=function(){var u,A,w,T;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((A=(u=I==null?void 0:I.console)===null||u===void 0?void 0:u.log)===null||A===void 0?void 0:A.apply)=="function"?(w=function(){for(var m=[],d=0;d<arguments.length;d++)m[d]=arguments[d]},T=console.warn?function(){for(var m=[],d=0;d<arguments.length;d++)m[d]=arguments[d]}:w):I!=null&&I.console.log?w=T=function(){Function.prototype.apply.call(console.log,console,arguments)}:w=T=function(){},[w,T].map(F)},b=function(){function u(){u.logLevel=u.LOG_DEFAULT}return u.initLogHandlers=function(){var A=S(),w=A[0],T=A[1];this.logHandler=w,this.logErrorHandler=T},u.logLevel=E.Error,u.LOG_NONE=E.None,u.LOG_ERROR=E.Error,u.LOG_MAJOR=E.Major,u.LOG_MINOR=E.Minor,u.LOG_MICRO=E.Micro,u.LOG_DEFAULT=E.Error,u.LOG_DEBUG=E.Micro,u.logAction=function(A,w,T){u.shouldLog(A)&&(A===E.Error?u.logErrorHandler:u.logHandler)("Ably: "+w+": "+T)},u.deprecated=function(A,w){u.deprecatedWithMsg(A,"Please use '"+w+"' instead.")},u.deprecatedWithMsg=function(A,w){u.shouldLog(E.Error)&&u.logErrorHandler("Ably: Deprecation warning - '"+A+"' is deprecated and will be removed from a future version. "+w)},u.shouldLog=function(A){return A<=u.logLevel},u.setLog=function(A,w){A!==void 0&&(u.logLevel=A),w!==void 0&&(u.logHandler=u.logErrorHandler=w)},u}();h.default=b}).call(this,r(12))},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(){if(typeof ArrayBuffer=="function"){var a=g,N=a.lib,I=N.WordArray,E=I.init,P=I.init=function(F){if(F instanceof ArrayBuffer&&(F=new Uint8Array(F)),(F instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&F instanceof Uint8ClampedArray||F instanceof Int16Array||F instanceof Uint16Array||F instanceof Int32Array||F instanceof Uint32Array||F instanceof Float32Array||F instanceof Float64Array)&&(F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength)),F instanceof Uint8Array){for(var S=F.byteLength,b=[],u=0;u<S;u++)b[u>>>2]|=F[u]<<24-u%4*8;E.call(this,b,S)}else E.apply(this,arguments)};P.prototype=I}}(),g.lib.WordArray})},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(0)),N=g.__importStar(r(2)),I=function(){function E(P,F,S,b){this.message=P,this.code=F,this.statusCode=S,this.cause=b}return E.prototype.toString=function(){var P="["+this.constructor.name;return this.message&&(P+=": "+this.message),this.statusCode&&(P+="; statusCode="+this.statusCode),this.code&&(P+="; code="+this.code),this.cause&&(P+="; cause="+N.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(P+="; see "+this.href+" "),P+="]",P},E.fromValues=function(P){var F=P,S=F.message,b=F.code,u=F.statusCode;if(typeof S!="string"||typeof b!="number"||typeof u!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+a.default.Config.inspect(P));var A=Object.assign(new E(S,b,u),P);return A.code&&!A.href&&(A.href="https://help.ably.io/error/"+A.code),A},E}();h.default=I},function(v,h,r){(function(g){(function(a,N){v.exports=h=N()})(this,function(){var a=a||function(N,I){var E;if(typeof window!="undefined"&&window.crypto&&(E=window.crypto),!E&&typeof window!="undefined"&&window.msCrypto&&(E=window.msCrypto),!E&&typeof g!="undefined"&&g.crypto&&(E=g.crypto),!E)try{E=r(44)}catch(s){}var P=function(){if(E){if(typeof E.getRandomValues=="function")try{return E.getRandomValues(new Uint32Array(1))[0]}catch(s){}if(typeof E.randomBytes=="function")try{return E.randomBytes(4).readInt32LE()}catch(s){}}throw new Error("Native crypto module could not be used to get secure random number.")},F=Object.create||function(){function s(){}return function(f){var i;return s.prototype=f,i=new s,s.prototype=null,i}}(),S={},b=S.lib={},u=b.Base=function(){return{extend:function(s){var f=F(this);return s&&f.mixIn(s),(!f.hasOwnProperty("init")||this.init===f.init)&&(f.init=function(){f.$super.init.apply(this,arguments)}),f.init.prototype=f,f.$super=this,f},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var f in s)s.hasOwnProperty(f)&&(this[f]=s[f]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=b.WordArray=u.extend({init:function(s,f){s=this.words=s||[],f!=I?this.sigBytes=f:this.sigBytes=s.length*4},toString:function(s){return(s||T).stringify(this)},concat:function(s){var f=this.words,i=s.words,p=this.sigBytes,R=s.sigBytes;if(this.clamp(),p%4)for(var L=0;L<R;L++){var z=i[L>>>2]>>>24-L%4*8&255;f[p+L>>>2]|=z<<24-(p+L)%4*8}else for(var L=0;L<R;L+=4)f[p+L>>>2]=i[L>>>2];return this.sigBytes+=R,this},clamp:function(){var s=this.words,f=this.sigBytes;s[f>>>2]&=4294967295<<32-f%4*8,s.length=N.ceil(f/4)},clone:function(){var s=u.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var f=[],i=0;i<s;i+=4)f.push(P());return new A.init(f,s)}}),w=S.enc={},T=w.Hex={stringify:function(s){for(var f=s.words,i=s.sigBytes,p=[],R=0;R<i;R++){var L=f[R>>>2]>>>24-R%4*8&255;p.push((L>>>4).toString(16)),p.push((L&15).toString(16))}return p.join("")},parse:function(s){for(var f=s.length,i=[],p=0;p<f;p+=2)i[p>>>3]|=parseInt(s.substr(p,2),16)<<24-p%8*4;return new A.init(i,f/2)}},m=w.Latin1={stringify:function(s){for(var f=s.words,i=s.sigBytes,p=[],R=0;R<i;R++){var L=f[R>>>2]>>>24-R%4*8&255;p.push(String.fromCharCode(L))}return p.join("")},parse:function(s){for(var f=s.length,i=[],p=0;p<f;p++)i[p>>>2]|=(s.charCodeAt(p)&255)<<24-p%4*8;return new A.init(i,f)}},d=w.Utf8={stringify:function(s){try{return decodeURIComponent(escape(m.stringify(s)))}catch(f){throw new Error("Malformed UTF-8 data")}},parse:function(s){return m.parse(unescape(encodeURIComponent(s)))}},y=b.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=d.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var f,i=this._data,p=i.words,R=i.sigBytes,L=this.blockSize,z=L*4,H=R/z;s?H=N.ceil(H):H=N.max((H|0)-this._minBufferSize,0);var D=H*L,C=N.min(D*4,R);if(D){for(var _=0;_<D;_+=L)this._doProcessBlock(p,_);f=p.splice(0,D),i.sigBytes-=C}return new A.init(f,C)},clone:function(){var s=u.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0}),o=b.Hasher=y.extend({cfg:u.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var f=this._doFinalize();return f},blockSize:512/32,_createHelper:function(s){return function(f,i){return new s.init(i).finalize(f)}},_createHmacHelper:function(s){return function(f,i){return new c.HMAC.init(s,i).finalize(f)}}}),c=S.algo={};return S}(Math);return a})}).call(this,r(12))},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(3)),I=g.__importDefault(r(0));function E(S,b,u){try{b.apply(S,u)}catch(A){N.default.logAction(N.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+A+"; stack = "+(A&&A.stack))}}function P(S,b,u){for(var A,w,T,m=0;m<S.length;m++)if(A=S[m],u&&(A=A[u]),a.isArray(A)){for(;(w=a.arrIndexOf(A,b))!==-1;)A.splice(w,1);u&&A.length===0&&delete S[m][u]}else if(a.isObject(A))for(T in A)Object.prototype.hasOwnProperty.call(A,T)&&a.isArray(A[T])&&P([A],b,T)}var F=function(){function S(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return S.prototype.on=function(){for(var b=this,u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];if(u.length===1){var w=u[0];if(typeof w=="function")this.any.push(w);else throw new Error("EventListener.on(): Invalid arguments: "+I.default.Config.inspect(u))}if(u.length===2){var T=u[0],m=u[1];if(typeof m!="function")throw new Error("EventListener.on(): Invalid arguments: "+I.default.Config.inspect(u));if(a.isEmptyArg(T))this.any.push(m);else if(a.isArray(T))T.forEach(function(y){b.on(y,m)});else{if(typeof T!="string")throw new Error("EventListener.on(): Invalid arguments: "+I.default.Config.inspect(u));var d=this.events[T]||(this.events[T]=[]);d.push(m)}}},S.prototype.off=function(){for(var b,u=this,A=[],w=0;w<arguments.length;w++)A[w]=arguments[w];if(A.length==0||a.isEmptyArg(A[0])&&a.isEmptyArg(A[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var T=A[0],m=A[1],d=null,y=null;if(A.length===1||!m)typeof T=="function"?d=T:y=T;else{if(typeof m!="function")throw new Error("EventEmitter.off(): invalid arguments:"+I.default.Config.inspect(A));b=[T,m],y=b[0],d=b[1]}if(d&&a.isEmptyArg(y)){P([this.any,this.events,this.anyOnce,this.eventsOnce],d);return}if(a.isArray(y)){y.forEach(function(o){u.off(o,d)});return}if(typeof y!="string")throw new Error("EventEmitter.off(): invalid arguments:"+I.default.Config.inspect(A));d?P([this.events,this.eventsOnce],d,y):(delete this.events[y],delete this.eventsOnce[y])},S.prototype.listeners=function(b){if(b){var u=this.events[b]||[];return this.eventsOnce[b]&&Array.prototype.push.apply(u,this.eventsOnce[b]),u.length?u:null}return this.any.length?this.any:null},S.prototype.emit=function(b){for(var u=[],A=1;A<arguments.length;A++)u[A-1]=arguments[A];var w={event:b},T=[];this.anyOnce.length&&(Array.prototype.push.apply(T,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(T,this.any);var m=this.eventsOnce[b];m&&(Array.prototype.push.apply(T,m),delete this.eventsOnce[b]);var d=this.events[b];d&&Array.prototype.push.apply(T,d),a.arrForEach(T,function(y){E(w,y,u)})},S.prototype.once=function(){for(var b=this,u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];var w=u.length;if((w===0||w===1&&typeof u[0]!="function")&&I.default.Config.Promise){var T=u[0];if(typeof T!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+I.default.Config.inspect(u));return new I.default.Config.Promise(function(s){b.once(T,s)})}var m=u[0],d=u[1];if(u.length===1&&typeof m=="function")this.anyOnce.push(m);else if(a.isEmptyArg(m)){if(typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+I.default.Config.inspect(u));this.anyOnce.push(d)}else if(a.isArray(m)){var y=this,o=function(){var s=Array.prototype.slice.call(arguments);if(a.arrForEach(m,function(f){y.off(f,o)}),typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+I.default.Config.inspect(u));d.apply(this,s)};a.arrForEach(m,function(s){y.on(s,o)})}else{if(typeof m!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+I.default.Config.inspect(u));var c=this.eventsOnce[m]||(this.eventsOnce[m]=[]);if(d){if(typeof d!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+I.default.Config.inspect(u));c.push(d)}}},S.prototype.whenState=function(b,u,A){for(var w=this,T=[],m=3;m<arguments.length;m++)T[m-3]=arguments[m];var d={event:b};if(typeof b!="string"||typeof u!="string")throw"whenState requires a valid event String argument";if(typeof A!="function"&&I.default.Config.Promise)return new I.default.Config.Promise(function(y){S.prototype.whenState.apply(w,[b,u,y].concat(T))});b===u?E(d,A,T):this.once(b,A)},S}();h.default=F},function(v,h,r){"use strict";h.__esModule=!0,h.getDefaults=h.normaliseOptions=h.objectifyOptions=h.getHosts=h.getFallbackHosts=h.environmentFallbackHosts=h.getHttpScheme=h.getPort=h.getHost=void 0;var g=r(1),a=g.__importDefault(r(0)),N=g.__importStar(r(2)),I=g.__importDefault(r(3)),E=g.__importDefault(r(5)),P=r(42),F="ably-js/"+P.version,S={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:P.version,apiVersion:"1.2",agent:F,getHost:b,getPort:u,getHttpScheme:A,environmentFallbackHosts:w,getFallbackHosts:T,getHosts:m,checkHost:d,objectifyOptions:c,normaliseOptions:s};function b(i,p,R){return R?p=p==i.restHost&&i.realtimeHost||p||i.realtimeHost:p=p||i.restHost,p}h.getHost=b;function u(i,p){return p||i.tls?i.tlsPort:i.port}h.getPort=u;function A(i){return i.tls?"https://":"http://"}h.getHttpScheme=A;function w(i){return[i+"-a-fallback.ably-realtime.com",i+"-b-fallback.ably-realtime.com",i+"-c-fallback.ably-realtime.com",i+"-d-fallback.ably-realtime.com",i+"-e-fallback.ably-realtime.com"]}h.environmentFallbackHosts=w;function T(i){var p=i.fallbackHosts,R=typeof i.httpMaxRetryCount!="undefined"?i.httpMaxRetryCount:S.httpMaxRetryCount;return p?N.arrChooseN(p,R):[]}h.getFallbackHosts=T;function m(i){return[i.restHost].concat(T(i))}h.getHosts=m;function d(i){if(typeof i!="string")throw new E.default("host must be a string; was a "+typeof i,4e4,400);if(!i.length)throw new E.default("host must not be zero-length",4e4,400)}function y(i,p,R){return i.realtimeHost?i.realtimeHost:i.restHost?(I.default.logAction(I.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+i.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+i.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),i.restHost):p?S.REALTIME_HOST:R+"-"+S.REALTIME_HOST}function o(i){var p={};for(var R in S.TIMEOUTS)p[R]=i[R]||S.TIMEOUTS[R];return p}function c(i){return typeof i=="string"?i.indexOf(":")==-1?{token:i}:{key:i}:i}h.objectifyOptions=c;function s(i){if(i.host&&(I.default.deprecated("host","restHost"),i.restHost=i.host),i.wsHost&&(I.default.deprecated("wsHost","realtimeHost"),i.realtimeHost=i.wsHost),i.queueEvents&&(I.default.deprecated("queueEvents","queueMessages"),i.queueMessages=i.queueEvents),i.fallbackHostsUseDefault){if(i.fallbackHosts){var p="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw I.default.logAction(I.default.LOG_ERROR,"Defaults.normaliseOptions",p),new E.default(p,4e4,400)}if(i.port||i.tlsPort){var p="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw I.default.logAction(I.default.LOG_ERROR,"Defaults.normaliseOptions",p),new E.default(p,4e4,400)}i.environment?I.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):I.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),i.fallbackHosts=S.FALLBACK_HOSTS}i.recover===!0&&(I.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),i.recover=function(j,W){W(!0)}),typeof i.recover=="function"&&i.closeOnUnload===!0&&(I.default.logAction(I.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),i.recover=void 0),"closeOnUnload"in i||(i.closeOnUnload=!i.recover),i.transports&&N.arrIn(i.transports,"xhr")&&(I.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),N.arrDeleteValue(i.transports,"xhr"),i.transports.push("xhr_streaming")),"queueMessages"in i||(i.queueMessages=!0);var R=i.environment&&String(i.environment).toLowerCase()||S.ENVIRONMENT,L=!R||R==="production";!i.fallbackHosts&&!i.restHost&&!i.realtimeHost&&!i.port&&!i.tlsPort&&(i.fallbackHosts=L?S.FALLBACK_HOSTS:w(R));var z=i.restHost||(L?S.REST_HOST:R+"-"+S.REST_HOST),H=y(i,L,R);N.arrForEach((i.fallbackHosts||[]).concat(z,H),d),i.port=i.port||S.PORT,i.tlsPort=i.tlsPort||S.TLS_PORT,"tls"in i||(i.tls=!0);var D=o(i);if("useBinaryProtocol"in i?i.useBinaryProtocol=a.default.Config.supportsBinary&&i.useBinaryProtocol:i.useBinaryProtocol=a.default.Config.preferBinary,i.clientId){var C=i.headers=i.headers||{};C["X-Ably-ClientId"]=a.default.BufferUtils.base64Encode(a.default.BufferUtils.utf8Encode(i.clientId))}if("idempotentRestPublishing"in i||(i.idempotentRestPublishing=!0),i.promises&&!a.default.Config.Promise&&(I.default.logAction(I.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),i.promises=!1),i.agents)for(var _ in i.agents)S.agent+=" "+_+"/"+i.agents[_];return g.__assign(g.__assign({},i),{useBinaryProtocol:"useBinaryProtocol"in i?a.default.Config.supportsBinary&&i.useBinaryProtocol:a.default.Config.preferBinary,realtimeHost:H,restHost:z,maxMessageSize:i.maxMessageSize||S.maxMessageSize,timeouts:D})}h.normaliseOptions=s,h.default=S;function f(i){return Object.assign(S,i)}h.getDefaults=f},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(0)),N=g.__importDefault(r(3)),I=g.__importDefault(r(5)),E=g.__importStar(r(2));function P(u){return!u||!u.channelOptions?{channelOptions:u,plugins:{},baseEncodedPreviousPayload:void 0}:u}function F(u){if(u&&u.cipher&&!u.cipher.channelCipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=a.default.Crypto.getCipher(u.cipher);return{cipher:A.cipherParams,channelCipher:A.cipher}}return u}function S(u){var A=0;return u.name&&(A+=u.name.length),u.clientId&&(A+=u.clientId.length),u.extras&&(A+=JSON.stringify(u.extras).length),u.data&&(A+=E.dataSizeBytes(u.data)),A}var b=function(){function u(){}return u.prototype.toJSON=function(){var A=this.encoding,w=this.data;return w&&a.default.BufferUtils.isBuffer(w)&&(arguments.length>0?(A=A?A+"/base64":"base64",w=a.default.BufferUtils.base64Encode(w)):w=a.default.BufferUtils.toBuffer(w)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:A,data:w}},u.prototype.toString=function(){var A="[Message";return this.name&&(A+="; name="+this.name),this.id&&(A+="; id="+this.id),this.timestamp&&(A+="; timestamp="+this.timestamp),this.clientId&&(A+="; clientId="+this.clientId),this.connectionId&&(A+="; connectionId="+this.connectionId),this.encoding&&(A+="; encoding="+this.encoding),this.extras&&(A+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?A+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?A+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):A+="; data (json)="+JSON.stringify(this.data)),this.extras&&(A+="; extras="+JSON.stringify(this.extras)),A+="]",A},u.encrypt=function(A,w,T){var m=A.data,d=A.encoding,y=w.channelCipher;d=d?d+"/":"",a.default.BufferUtils.isBuffer(m)||(m=a.default.BufferUtils.utf8Encode(String(m)),d=d+"utf-8/"),y.encrypt(m,function(o,c){if(o){T(o);return}A.data=c,A.encoding=d+"cipher+"+y.algorithm,T(null,A)})},u.encode=function(A,w,T){var m=A.data,d=typeof m=="string"||a.default.BufferUtils.isBuffer(m)||m===null||m===void 0;if(!d)if(E.isObject(m)||E.isArray(m))A.data=JSON.stringify(m),A.encoding=A.encoding?A.encoding+"/json":"json";else throw new I.default("Data type is unsupported",40013,400);w!=null&&w.cipher?u.encrypt(A,w,T):T(null,A)},u.encodeArray=function(A,w,T){for(var m=0,d=0;d<A.length;d++)u.encode(A[d],w,function(y){if(y){T(y);return}m++,m==A.length&&T(null,A)})},u.decode=function(A,w){var T=P(w),m=A.data,d=A.encoding;if(d){var y=d.split("/"),o=void 0,c=y.length,s=A.data,f="";try{for(;(o=c)>0;){var i=y[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!i)break;switch(f=i[1],f){case"base64":s=a.default.BufferUtils.base64Decode(String(s)),o==y.length&&(m=s);continue;case"utf-8":s=a.default.BufferUtils.utf8Decode(s);continue;case"json":s=JSON.parse(s);continue;case"cipher":if(T.channelOptions!=null&&T.channelOptions.cipher&&T.channelOptions.channelCipher){var p=i[3],R=T.channelOptions.channelCipher;if(p!=R.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");s=R.decrypt(s);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!T.plugins||!T.plugins.vcdiff)throw new I.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new I.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=T.baseEncodedPreviousPayload;typeof L=="string"&&(L=a.default.BufferUtils.utf8Encode(L)),L=a.default.BufferUtils.toBuffer(L),s=a.default.BufferUtils.toBuffer(s),s=a.default.BufferUtils.typedArrayToBuffer(T.plugins.vcdiff.decode(s,L)),m=s}catch(H){throw new I.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var z=H;throw new I.default("Error processing the "+f+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{A.encoding=o<=0?null:y.slice(0,o).join("/"),A.data=s}}T.baseEncodedPreviousPayload=m},u.fromResponseBody=function(A,w,T){T&&(A=E.decodeBody(A,T));for(var m=0;m<A.length;m++){var d=A[m]=u.fromValues(A[m]);try{u.decode(d,w)}catch(y){N.default.logAction(N.default.LOG_ERROR,"Message.fromResponseBody()",y.toString())}}return A},u.fromValues=function(A){return Object.assign(new u,A)},u.fromValuesArray=function(A){for(var w=A.length,T=new Array(w),m=0;m<w;m++)T[m]=u.fromValues(A[m]);return T},u.fromEncoded=function(A,w){var T=u.fromValues(A),m=F(w);try{u.decode(T,m)}catch(d){N.default.logAction(N.default.LOG_ERROR,"Message.fromEncoded()",d.toString())}return T},u.fromEncodedArray=function(A,w){return F(w),A.map(function(T){return u.fromEncoded(T,w)})},u.getMessagesSize=function(A){for(var w,T=0,m=0;m<A.length;m++)w=A[m],T+=w.size||(w.size=S(w));return T},u.serialize=E.encodeBody,u}();h.default=b},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(5)),I=g.__importDefault(r(9)),E=g.__importDefault(r(14)),P={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},F=[];Object.keys(P).forEach(function(T){F[P[T]]=T});var S={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},b=Object.keys(S);S.MODE_ALL=S.PRESENCE|S.PUBLISH|S.SUBSCRIBE|S.PRESENCE_SUBSCRIBE;function u(T){var m=[];if(T)for(var d=0;d<T.length;d++)m.push(T[d].toString());return"[ "+m.join(", ")+" ]"}var A="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),w=function(){function T(){var m=this;this.hasFlag=function(d){return(m.flags&S[d])>0}}return T.prototype.setFlag=function(m){return this.flags=this.flags|S[m]},T.prototype.getMode=function(){return this.flags&&this.flags&S.MODE_ALL},T.prototype.encodeModesToFlags=function(m){var d=this;m.forEach(function(y){return d.setFlag(y)})},T.prototype.decodeModesFromFlags=function(){var m=this,d=[];return T.channelModes.forEach(function(y){m.hasFlag(y)&&d.push(y)}),d.length>0?d:void 0},T.fromValues=function(m){return Object.assign(new T,m)},T.Action=P,T.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],T.ActionName=F,T.serialize=a.encodeBody,T.deserialize=function(m,d){var y=a.decodeBody(m,d);return T.fromDeserialized(y)},T.fromDeserialized=function(m){var d=m.error;d&&(m.error=N.default.fromValues(d));var y=m.messages;if(y)for(var o=0;o<y.length;o++)y[o]=I.default.fromValues(y[o]);var c=m.presence;if(c)for(var o=0;o<c.length;o++)c[o]=E.default.fromValues(c[o],!0);return Object.assign(new T,m)},T.stringify=function(m){var d="[ProtocolMessage";m.action!==void 0&&(d+="; action="+T.ActionName[m.action]||!1);for(var y,o=0;o<A.length;o++)y=A[o],m[y]!==void 0&&(d+="; "+y+"="+m[y]);if(m.messages&&(d+="; messages="+u(I.default.fromValuesArray(m.messages))),m.presence&&(d+="; presence="+u(E.default.fromValuesArray(m.presence))),m.error&&(d+="; error="+N.default.fromValues(m.error).toString()),m.auth&&m.auth.accessToken&&(d+="; token="+m.auth.accessToken),m.flags&&(d+="; flags="+b.filter(m.hasFlag).join(",")),m.params){var c="";a.forInOwnNonNullProperties(m.params,function(s){c.length>0&&(c+="; "),c+=s+"="+m.params[s]}),c.length>0&&(d+="; params=["+c+"]")}return d+="]",d},T.isDuplicate=function(m,d){if(m&&d&&(m.action===P.MESSAGE||m.action===P.PRESENCE)&&m.action===d.action&&m.channel===d.channel&&m.id===d.id){if(m.action===P.PRESENCE)return!0;if(m.messages.length===d.messages.length){for(var y=0;y<m.messages.length;y++){var o=m.messages[y],c=d.messages[y];if((o.extras&&o.extras.delta&&o.extras.delta.format)!==(c.extras&&c.extras.delta&&c.extras.delta.format))return!1}return!0}}return!1},T}();h.default=w},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(10)),I=g.__importDefault(r(26)),E=g.__importDefault(r(3)),P=g.__importDefault(r(8)),F=g.__importDefault(r(19)),S=g.__importDefault(r(16)),b=g.__importDefault(r(5)),u=g.__importDefault(r(20)),A=g.__importDefault(r(0));function w(d){var y=[80015,80017,80030];return d.code?S.default.isTokenErr(d)?!1:a.arrIn(y,d.code)?!0:d.code>=4e4&&d.code<5e4:!1}function T(d){return w(d)?[N.default.fromValues({action:N.default.Action.ERROR,error:d})]:[N.default.fromValues({action:N.default.Action.DISCONNECTED,error:d})]}var m=function(d){g.__extends(y,d);function y(o,c,s){var f=d.call(this,o,c,s,!0)||this;return f.onAuthUpdated=function(i){f.authParams={access_token:i.token}},f.stream="stream"in s?s.stream:!0,f.sendRequest=null,f.recvRequest=null,f.pendingCallback=null,f.pendingItems=null,f}return y.prototype.connect=function(){var o=this;E.default.logAction(E.default.LOG_MINOR,"CometTransport.connect()","starting"),I.default.prototype.connect.call(this);var c=this.params,s=c.options,f=P.default.getHost(s,c.host),i=P.default.getPort(s),p=s.tls?"https://":"http://";this.baseUri=p+f+":"+i+"/comet/";var R=this.baseUri+"connect";E.default.logAction(E.default.LOG_MINOR,"CometTransport.connect()","uri: "+R),this.auth.getAuthParams(function(L,z){if(L){o.disconnect(L);return}if(!o.isDisposed){o.authParams=z;var H=o.params.getConnectParams(z);"stream"in H&&(o.stream=H.stream),E.default.logAction(E.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+a.toQueryString(H));var D=!1,C=o.recvRequest=o.createRequest(R,null,H,null,o.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV);C.on("data",function(_){!o.recvRequest||(D||(D=!0,o.emit("preconnect")),o.onData(_))}),C.on("complete",function(_){if(o.recvRequest||(_=_||new b.default("Request cancelled",80003,400)),o.recvRequest=null,!D&&!_&&(D=!0,o.emit("preconnect")),o.onActivity(),_){_.code?o.onData(T(_)):o.disconnect(_);return}A.default.Config.nextTick(function(){o.recv()})}),C.exec()}})},y.prototype.requestClose=function(){E.default.logAction(E.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},y.prototype.requestDisconnect=function(){E.default.logAction(E.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},y.prototype._requestCloseOrDisconnect=function(o){var c=this,s=o?this.closeUri:this.disconnectUri;if(s){var f=this.createRequest(s,null,this.authParams,null,u.default.REQ_SEND);f.on("complete",function(i){i&&(E.default.logAction(E.default.LOG_ERROR,"CometTransport.request"+(o?"Close()":"Disconnect()"),"request returned err = "+a.inspectError(i)),c.finish("disconnected",i))}),f.exec()}},y.prototype.dispose=function(){var o=this;E.default.logAction(E.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(E.default.logAction(E.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",F.default.disconnected),A.default.Config.nextTick(function(){o.emit("disposed")}))},y.prototype.onConnect=function(o){if(!this.isDisposed){var c=o.connectionKey;I.default.prototype.onConnect.call(this,o);var s=this.baseUri+c;E.default.logAction(E.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+s+"; connectionKey = "+o.connectionKey),this.sendUri=s+"/send",this.recvUri=s+"/recv",this.closeUri=s+"/close",this.disconnectUri=s+"/disconnect"}},y.prototype.send=function(o){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(o);return}var c=this.pendingItems||[];c.push(o),this.pendingItems=null,this.sendItems(c)},y.prototype.sendAnyPending=function(){var o=this.pendingItems;!o||(this.pendingItems=null,this.sendItems(o))},y.prototype.sendItems=function(o){var c=this,s=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(o),u.default.REQ_SEND);s.on("complete",function(f,i){if(f&&E.default.logAction(E.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+a.inspectError(f)),c.sendRequest=null,f){f.code?c.onData(T(f)):c.disconnect(f);return}i&&c.onData(i),c.pendingItems&&A.default.Config.nextTick(function(){c.sendRequest||c.sendAnyPending()})}),s.exec()},y.prototype.recv=function(){var o=this;if(!this.recvRequest&&!!this.isConnected){var c=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV_POLL);c.on("data",function(s){o.onData(s)}),c.on("complete",function(s){if(o.recvRequest=null,o.onActivity(),s){s.code?o.onData(T(s)):o.disconnect(s);return}A.default.Config.nextTick(function(){o.recv()})}),c.exec()}},y.prototype.onData=function(o){try{var c=this.decodeResponse(o);if(c&&c.length)for(var s=0;s<c.length;s++)this.onProtocolMessage(N.default.fromDeserialized(c[s]))}catch(f){E.default.logAction(E.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+f.stack)}},y.prototype.encodeRequest=function(o){return JSON.stringify(o)},y.prototype.decodeResponse=function(o){return typeof o=="string"?JSON.parse(o):o},y}(I.default);h.default=m},function(v,h){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(g){typeof window=="object"&&(r=window)}v.exports=r},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(){var a=g,N=a.lib,I=N.WordArray,E=a.enc,P=E.Base64={stringify:function(S){var b=S.words,u=S.sigBytes,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.clamp();for(var w=[],T=0;T<u;T+=3)for(var m=b[T>>>2]>>>24-T%4*8&255,d=b[T+1>>>2]>>>24-(T+1)%4*8&255,y=b[T+2>>>2]>>>24-(T+2)%4*8&255,o=m<<16|d<<8|y,c=0;c<4&&T+c*.75<u;c++)w.push(A.charAt(o>>>6*(3-c)&63));var s=A.charAt(64);if(s)for(;w.length%4;)w.push(s);return w.join("")},parse:function(S){var b=S.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A=this._reverseMap;if(!A){A=this._reverseMap=[];for(var w=0;w<u.length;w++)A[u.charCodeAt(w)]=w}var T=u.charAt(64);if(T){var m=S.indexOf(T);m!==-1&&(b=m)}return F(S,b,A)}};function F(S,b,u){for(var A=[],w=0,T=0;T<b;T++)if(T%4){var m=u[S.charCodeAt(T-1)]<<T%4*2,d=u[S.charCodeAt(T)]>>>6-T%4*2,y=m|d;A[w>>>2]|=y<<24-w%4*8,w++}return I.create(A,w)}}(),g.enc.Base64})},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(3)),N=g.__importDefault(r(0)),I=g.__importDefault(r(9)),E=g.__importStar(r(2));function P(S){return F.Actions.indexOf(S)}var F=function(){function S(){}return S.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},S.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var b=this.id.split(":");return{connectionId:b[0],msgSerial:parseInt(b[1],10),index:parseInt(b[2],10)}},S.prototype.toJSON=function(){var b=this.data,u=this.encoding;return b&&N.default.BufferUtils.isBuffer(b)&&(arguments.length>0?(u=u?u+"/base64":"base64",b=N.default.BufferUtils.base64Encode(b)):b=N.default.BufferUtils.toBuffer(b)),{clientId:this.clientId,action:P(this.action),data:b,encoding:u}},S.prototype.toString=function(){var b="[PresenceMessage";return b+="; action="+this.action,this.id&&(b+="; id="+this.id),this.timestamp&&(b+="; timestamp="+this.timestamp),this.clientId&&(b+="; clientId="+this.clientId),this.connectionId&&(b+="; connectionId="+this.connectionId),this.encoding&&(b+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?b+="; data="+this.data:N.default.BufferUtils.isBuffer(this.data)?b+="; data (buffer)="+N.default.BufferUtils.base64Encode(this.data):b+="; data (json)="+JSON.stringify(this.data)),b+="]",b},S.fromResponseBody=function(b,u,A){var w=[];A&&(b=E.decodeBody(b,A));for(var T=0;T<b.length;T++){var m=w[T]=S.fromValues(b[T],!0);try{S.decode(m,u)}catch(d){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",d.toString())}}return w},S.fromValues=function(b,u){return u&&(b.action=S.Actions[b.action]),Object.assign(new S,b)},S.fromValuesArray=function(b){for(var u=b.length,A=new Array(u),w=0;w<u;w++)A[w]=S.fromValues(b[w]);return A},S.fromEncoded=function(b,u){var A=S.fromValues(b,!0);try{S.decode(A,u)}catch(w){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromEncoded()",w.toString())}return A},S.fromEncodedArray=function(b,u){return b.map(function(A){return S.fromEncoded(A,u)})},S.Actions=["absent","present","enter","leave","update"],S.encode=I.default.encode,S.decode=I.default.decode,S.getMessagesSize=I.default.getMessagesSize,S}();h.default=F},function(v,h,r){"use strict";(function(g){h.__esModule=!0;var a=r(1),N=a.__importStar(r(2)),I=a.__importDefault(r(7)),E=a.__importDefault(r(5)),P=a.__importDefault(r(3)),F=a.__importDefault(r(8)),S=a.__importDefault(r(20)),b=a.__importDefault(r(0));function u(p,R){return N.arrIn(N.allToLowerCase(N.keysArray(R)),"x-ably-errorcode")}function A(p,R){if(u(p,R))return p.error&&E.default.fromValues(p.error)}var w=function(){},T=0,m={},d=typeof g!="undefined"&&g.XDomainRequest;function y(){var p=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return p&&Number(p[1])}function o(){var p;return d&&(p=y())&&p===10}function c(p,R){return p.getResponseHeader&&p.getResponseHeader(R)}function s(p){return p.getResponseHeader&&(p.getResponseHeader("transfer-encoding")||!p.getResponseHeader("content-length"))}function f(p){for(var R=N.trim(p.getAllResponseHeaders()).split(`\r
`),L={},z=0;z<R.length;z++){var H=R[z].split(":").map(N.trim);L[H[0].toLowerCase()]=H[1]}return L}var i=function(p){a.__extends(R,p);function R(L,z,H,D,C,_,j){var W=p.call(this)||this;return H=H||{},H.rnd=N.cheapRandStr(),o()&&!H.envelope&&(H.envelope="json"),W.uri=L+N.toQueryString(H),W.headers=z||{},W.body=D,W.method=j?j.toUpperCase():N.isEmptyArg(D)?"GET":"POST",W.requestMode=C,W.timeouts=_,W.timedOut=!1,W.requestComplete=!1,W.id=String(++T),m[W.id]=W,W}return R.createRequest=function(L,z,H,D,C,_,j){var W=_||F.default.TIMEOUTS;return new R(L,z,N.copy(H),D,C,W,j)},R.prototype.complete=function(L,z,H,D,C){this.requestComplete||(this.requestComplete=!0,!L&&z&&this.emit("data",z),this.emit("complete",L,z,H,D,C),this.dispose())},R.prototype.abort=function(){this.dispose()},R.prototype.exec=function(){var L=this,z=this.headers,H=this.requestMode==S.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,D=this.timer=setTimeout(function(){L.timedOut=!0,_.abort()},H),C=this.method,_=this.xhr=new XMLHttpRequest,j=z.accept,W=this.body,Q="text";if(j?j.indexOf("application/x-msgpack")===0&&(Q="arraybuffer"):z.accept="application/json",W){var Z=z["content-type"]||(z["content-type"]="application/json");Z.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}_.open(C,this.uri,!0),_.responseType=Q,"authorization"in z&&(_.withCredentials=!0);for(var q in z)_.setRequestHeader(q,z[q]);var G=function(lt,xt,qt,Ut){var Ht,ae=xt+" (event type: "+lt.type+")";!((Ht=L==null?void 0:L.xhr)===null||Ht===void 0)&&Ht.statusText&&(ae+=", current statusText is "+L.xhr.statusText),P.default.logAction(P.default.LOG_ERROR,"Request.on"+lt.type+"()",ae),L.complete(new E.default(ae,qt,Ut))};_.onerror=function(lt){G(lt,"XHR error occurred",null,400)},_.onabort=function(lt){L.timedOut?G(lt,"Request aborted due to request timeout expiring",null,408):G(lt,"Request cancelled",null,400)},_.ontimeout=function(lt){G(lt,"Request timed out",null,408)};var M,U,K,k=0,tt=!1,ut=function(){if(clearTimeout(D),K=U<400,U==204){L.complete(null,null,null,null,U);return}M=L.requestMode==S.default.REQ_RECV_STREAM&&K&&s(_)},vt=function(){var lt;try{var xt=c(_,"content-type"),qt=xt?xt.indexOf("application/json")>=0:_.responseType=="text";if(qt){var Ut=_.responseType==="arraybuffer"?b.default.BufferUtils.utf8Decode(_.response):String(_.responseText);Ut.length?lt=JSON.parse(Ut):lt=Ut,tt=!0}else lt=_.response;lt.response!==void 0?(U=lt.statusCode,K=U<400,z=lt.headers,lt=lt.response):z=f(_)}catch(ae){L.complete(new E.default("Malformed response body from server: "+ae.message,null,400));return}if(K||N.isArray(lt)){L.complete(null,lt,z,tt,U);return}var Ht=A(lt,z);Ht||(Ht=new E.default("Error response received from server: "+U+" body was: "+b.default.Config.inspect(lt),null,U)),L.complete(Ht,lt,z,tt,U)};function gt(){for(var lt=_.responseText,xt=lt.length-1,qt,Ut;k<xt&&(qt=lt.indexOf(`
`,k))>-1;)Ut=lt.slice(k,qt),k=qt+1,Ot(Ut)}var Ot=function(lt){try{lt=JSON.parse(lt)}catch(xt){L.complete(new E.default("Malformed response body from server: "+xt.message,null,400));return}L.emit("data",lt)},Mt=function(){gt(),L.streamComplete=!0,b.default.Config.nextTick(function(){L.complete()})};_.onreadystatechange=function(){var lt=_.readyState;lt<3||_.status!==0&&(U===void 0&&(U=_.status,U===1223&&(U=204),ut()),lt==3&&M?gt():lt==4&&(M?Mt():vt()))},_.send(W)},R.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=w,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||L.abort()}delete m[this.id]},R}(I.default);h.default=i}).call(this,r(12))},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(3)),N=g.__importStar(r(2)),I=g.__importDefault(r(22)),E=g.__importDefault(r(5)),P=g.__importDefault(r(43)),F=r(13),S=r(32),b=g.__importDefault(r(17)),u=g.__importDefault(r(0)),A=Math.pow(2,17);function w(){}function T(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function m(H){return!!H.connection}function d(H){return N.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new E.default(N.inspectError(H),H.code||40170,H.statusCode||401)}var y=function(H){return u.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):F.stringify(S.parse(H))},o=function(H,D){if(u.default.Config.createHmac){var C=u.default.Config.createHmac("SHA256",D);return C.update(H),C.digest("base64")}return F.stringify(P.default(H,D))};function c(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var D={},C=N.keysArray(H,!0);if(!C)return"";C.sort();for(var _=0;_<C.length;_++)D[C[_]]=H[C[_]].sort();return JSON.stringify(D)}function s(H){if(H.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var D="authOptions must include valid authentication parameters";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",D),new Error(D)}}function f(H){return"useTokenAuth"in H&&!H.useTokenAuth}function i(H){return H.useTokenAuth||!f(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function p(H){return!H.key&&!H.authCallback&&!H.authUrl}var R=0;function L(){return R++}var z=function(){function H(D,C){if(this.authOptions={},this.client=D,this.tokenParams=C.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,i(C)){if(C.key&&!o){var _="client-side token request signing not supported";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",_),new Error(_)}p(C)&&a.default.logAction(a.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(C.defaultTokenParams,C),s(this.authOptions)}else{if(!C.key){var _="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",_),new E.default(_,40160,401)}a.default.logAction(a.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(C)}}return H.prototype.authorize=function(D,C,_){var j=this,W;if(typeof D=="function"&&!_?(_=D,W=D=null):typeof C=="function"&&!_?(_=C,W=null):W=C,!_&&this.client.options.promises)return N.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new E.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(a.default.logAction(a.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),N.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(D,W,function(Q,Z){if(Q){j.client.connection&&j.client.connection.connectionManager.actOnErrorFromAuthorize(Q),_==null||_(Q);return}m(j.client)?j.client.connection.connectionManager.onAuthUpdated(Z,_||w):_==null||_(null,Z)})},H.prototype.authorise=function(D,C,_){a.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(D,C,_)},H.prototype._forceNewToken=function(D,C,_){var j=this;this.tokenDetails=null,this._saveTokenOptions(D,C),s(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,Q){delete j.tokenParams.timestamp,delete j.authOptions.queryTime,_(W,Q)})},H.prototype.requestToken=function(D,C,_){var j=this;if(typeof D=="function"&&!_?(_=D,C=D=null):typeof C=="function"&&!_&&(_=C,C=null),!_&&this.client.options.promises)return N.promisify(this,"requestToken",arguments);C=C||this.authOptions,D=D||N.copy(this.tokenParams);var W=_||w,Q,Z=this.client;if(C.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),Q=C.authCallback;else if(C.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),Q=function(k,tt){var ut=N.mixin({accept:"application/json, text/plain"},C.authHeaders),vt=C.authMethod&&C.authMethod.toLowerCase()==="post",gt,Ot=C.authUrl.indexOf("?");Ot>-1&&(gt=N.parseQueryString(C.authUrl.slice(Ot)),C.authUrl=C.authUrl.slice(0,Ot),vt||(C.authParams=N.mixin(gt,C.authParams)));var Mt=N.mixin({},C.authParams||{},k),lt=function(Ut,Ht,ae,X){var rt;if(Ut?a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+N.inspectError(Ut)):(rt=ae["content-type"],a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+rt+"; body: "+N.inspectBody(Ht))),Ut||X)return tt(Ut,Ht);if(u.default.BufferUtils.isBuffer(Ht)&&(Ht=Ht.toString()),!rt){tt(new E.default("authUrl response is missing a content-type header",40170,401));return}var st=rt.indexOf("application/json")>-1,ht=rt.indexOf("text/plain")>-1||rt.indexOf("application/jwt")>-1;if(!st&&!ht){tt(new E.default("authUrl responded with unacceptable content-type "+rt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(st){if(Ht.length>A){tt(new E.default("authUrl response exceeded max permitted length",40170,401));return}try{Ht=JSON.parse(Ht)}catch(bt){tt(new E.default("Unexpected error processing authURL response; err = "+bt.message,40170,401));return}}tt(null,Ht,rt)};if(a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+C.authUrl+"; Params: "+JSON.stringify(Mt)+"; method: "+(vt?"POST":"GET")),vt){var xt=ut||{};xt["content-type"]="application/x-www-form-urlencoded";var qt=N.toQueryString(Mt).slice(1);j.client.http.doUri(b.default.Post,Z,C.authUrl,xt,qt,gt,lt)}else j.client.http.doUri(b.default.Get,Z,C.authUrl,ut||{},null,Mt,lt)};else if(C.key)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),Q=function(k,tt){j.createTokenRequest(k,C,tt)};else{var q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";a.default.logAction(a.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new E.default(q,40171,403));return}"capability"in D&&(D.capability=c(D.capability));var G=function(k,tt){var ut=k.keyName,vt="/keys/"+ut+"/requestToken",gt=function(Mt){return Z.baseUri(Mt)+vt},Ot=N.defaultPostHeaders();C.requestHeaders&&N.mixin(Ot,C.requestHeaders),a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+vt+"; Token params: "+JSON.stringify(k)),j.client.http.do(b.default.Post,Z,gt,Ot,JSON.stringify(k),null,tt)},M=!1,U=this.client.options.timeouts.realtimeRequestTimeout,K=setTimeout(function(){M=!0;var k="Token request callback timed out after "+U/1e3+" seconds";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",k),W(new E.default(k,40170,401))},U);Q(D,function(k,tt,ut){if(!M){if(clearTimeout(K),k){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+N.inspectError(k)),W(d(k));return}if(typeof tt=="string"){tt.length===0?W(new E.default("Token string is empty",40170,401)):tt.length>A?W(new E.default("Token string exceeded max permitted length (was "+tt.length+" bytes)",40170,401)):tt==="undefined"||tt==="null"?W(new E.default("Token string was literal null/undefined",40170,401)):tt[0]==="{"&&!(ut&&ut.indexOf("application/jwt")>-1)?W(new E.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:tt});return}if(typeof tt!="object"){var vt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof tt;a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",vt),W(new E.default(vt,40170,401));return}var gt=JSON.stringify(tt).length;if(gt>A&&!C.suppressMaxLengthCheck){W(new E.default("Token request/details object exceeded max permitted stringified size (was "+gt+" bytes)",40170,401));return}if("issued"in tt){W(null,tt);return}if(!("keyName"in tt)){var vt="Expected token request callback to call back with a token string, token request object, or token details object";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",vt),W(new E.default(vt,40170,401));return}G(tt,function(Ot,Mt,lt,xt){if(Ot){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+N.inspectError(Ot)),W(d(Ot));return}xt||(Mt=JSON.parse(Mt)),a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,Mt)})}})},H.prototype.createTokenRequest=function(D,C,_){var j=this;if(typeof D=="function"&&!_?(_=D,C=D=null):typeof C=="function"&&!_&&(_=C,C=null),!_&&this.client.options.promises)return N.promisify(this,"createTokenRequest",arguments);C=C||this.authOptions,D=D||N.copy(this.tokenParams);var W=C.key;if(!W){_(new E.default("No key specified",40101,403));return}var Q=W.split(":"),Z=Q[0],q=Q[1];if(!q){_(new E.default("Invalid key specified",40101,403));return}if(D.clientId===""){_(new E.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in D&&(D.capability=c(D.capability));var G=N.mixin({keyName:Z},D),M=D.clientId||"",U=D.ttl||"",K=D.capability||"";(function(k){if(G.timestamp){k();return}j.getTimestamp(C&&C.queryTime,function(tt,ut){if(tt){_(tt);return}G.timestamp=ut,k()})})(function(){var k=G.nonce||(G.nonce=T()),tt=G.timestamp,ut=G.keyName+`
`+U+`
`+K+`
`+M+`
`+tt+`
`+k+`
`;G.mac=G.mac||o(ut,q),a.default.logAction(a.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),_(null,G)})},H.prototype.getAuthParams=function(D){this.method=="basic"?D(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(C,_){if(C){D(C);return}if(!_)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{access_token:_.token})})},H.prototype.getAuthHeaders=function(D){this.method=="basic"?D(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(C,_){if(C){D(C);return}if(!_)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{authorization:"Bearer "+y(_.token)})})},H.prototype.getTimestamp=function(D,C){!this.isTimeOffsetSet()&&(D||this.authOptions.queryTime)?this.client.time(C):C(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return N.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(D){this.method="basic",this.key=D.key,this.basicKey=y(D.key),this.authOptions=D||{},"clientId"in D&&this._userSetClientId(D.clientId)},H.prototype._saveTokenOptions=function(D,C){this.method="token",D&&(this.tokenParams=D),C&&(C.token&&(C.tokenDetails=typeof C.token=="string"?{token:C.token}:C.token),C.tokenDetails&&(this.tokenDetails=C.tokenDetails),"clientId"in C&&this._userSetClientId(C.clientId),this.authOptions=C)},H.prototype._ensureValidAuthCredentials=function(D,C){var _=this,j=this.tokenDetails;if(j){if(this._tokenClientIdMismatch(j.clientId)){C(new E.default("Mismatch between clientId in token ("+j.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!j.expires||j.expires>=this.getTimestampUsingOffset()){a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+j.expires),C(null,j);return}a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=I.default.create())).push(C),!(this.currentTokenRequestId!==null&&!D)){var W=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(Q,Z){if(_.currentTokenRequestId>W){a.default.logAction(a.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}_.currentTokenRequestId=null;var q=_.waitingForTokenRequest||w;if(_.waitingForTokenRequest=null,Q){q(Q);return}q(null,_.tokenDetails=Z)})}},H.prototype._userSetClientId=function(D){if(typeof D=="string"||D===null){if(D==="*")throw new E.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var C=this._uncheckedSetClientId(D);if(C)throw C}else throw new E.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(D){if(this._tokenClientIdMismatch(D)){var C="Unexpected clientId mismatch: client has "+this.clientId+", requested "+D,_=new E.default(C,40102,401);return a.default.logAction(a.default.LOG_ERROR,"Auth._uncheckedSetClientId()",C),_}else return this.clientId=this.tokenParams.clientId=D,null},H.prototype._tokenClientIdMismatch=function(D){return!!(this.clientId&&this.clientId!=="*"&&D&&D!=="*"&&this.clientId!==D)},H.isTokenErr=function(D){return D.code&&D.code>=40140&&D.code<40150},H}();h.default=z},function(v,h,r){"use strict";h.__esModule=!0;var g;(function(a){a.Get="get",a.Delete="delete",a.Post="post",a.Put="put",a.Patch="patch"})(g||(g={})),h.default=g},function(v,h,r){"use strict";h.__esModule=!0,h.HttpPaginatedResponse=h.PaginatedResult=void 0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(3)),I=g.__importDefault(r(24));function E(A){var w=A.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&a.parseQueryString(w[2])}function P(A){typeof A=="string"&&(A=A.split(","));for(var w={},T=0;T<A.length;T++){var m=A[T].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(m){var d=E(m[1]);d&&(w[m[2]]=d)}}return w}function F(A,w,T){return!(T&&(w||typeof A.code=="number"))}var S=function(){function A(w,T,m,d,y,o){this.rest=w,this.path=T,this.headers=m,this.envelope=d!=null?d:null,this.bodyHandler=y,this.useHttpPaginatedResponse=o||!1}return A.prototype.get=function(w,T){var m=this;I.default.get(this.rest,this.path,this.headers,w,this.envelope,function(d,y,o,c,s){m.handlePage(d,y,o,c,s,T)})},A.prototype.delete=function(w,T){var m=this;I.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(d,y,o,c,s){m.handlePage(d,y,o,c,s,T)})},A.prototype.post=function(w,T,m){var d=this;I.default.post(this.rest,this.path,T,this.headers,w,this.envelope,function(y,o,c,s,f){m&&d.handlePage(y,o,c,s,f,m)})},A.prototype.put=function(w,T,m){var d=this;I.default.put(this.rest,this.path,T,this.headers,w,this.envelope,function(y,o,c,s,f){m&&d.handlePage(y,o,c,s,f,m)})},A.prototype.patch=function(w,T,m){var d=this;I.default.patch(this.rest,this.path,T,this.headers,w,this.envelope,function(y,o,c,s,f){m&&d.handlePage(y,o,c,s,f,m)})},A.prototype.handlePage=function(w,T,m,d,y,o){if(w&&F(w,T,this.useHttpPaginatedResponse)){N.default.logAction(N.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+a.inspectError(w)),o==null||o(w);return}var c,s,f;try{c=this.bodyHandler(T,m||{},d)}catch(i){o==null||o(w||i);return}m&&(s=m.Link||m.link)&&(f=P(s)),this.useHttpPaginatedResponse?o(null,new u(this,c,m||{},y,f,w)):o(null,new b(this,c,f))},A}(),b=function(){function A(w,T,m){var d=this;this.resource=w,this.items=T;var y=this;m&&("first"in m&&(this.first=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"first",[]);y.get(m.first,o)}),"current"in m&&(this.current=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"current",[]);y.get(m.current,o)}),this.next=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"next",[]);"next"in m?y.get(m.next,o):o(null)},this.hasNext=function(){return"next"in m},this.isLast=function(){var o;return!(!((o=d.hasNext)===null||o===void 0)&&o.call(d))})}return A.prototype.get=function(w,T){var m=this.resource;I.default.get(m.rest,m.path,m.headers,w,m.envelope,function(d,y,o,c,s){m.handlePage(d,y,o,c,s,T)})},A}();h.PaginatedResult=b;var u=function(A){g.__extends(w,A);function w(T,m,d,y,o,c){var s=A.call(this,T,m,o)||this;return s.statusCode=y,s.success=y<300&&y>=200,s.headers=d,s.errorCode=c&&c.code,s.errorMessage=c&&c.message,s}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(b);h.HttpPaginatedResponse=u,h.default=S},function(v,h,r){"use strict";h.__esModule=!0,h.isRetriable=void 0;var g=r(1),a=g.__importDefault(r(5)),N={disconnected:a.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:a.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:a.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:a.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:a.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:a.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:a.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function I(E){if(!E.statusCode||!E.code||E.statusCode>=500)return!0;var P=!1;return Object.values(N).forEach(function(F){F.code&&F.code==E.code&&(P=!0)}),P}h.isRetriable=I,h.default=N},function(v,h,r){"use strict";h.__esModule=!0;var g;(function(a){a[a.REQ_SEND=0]="REQ_SEND",a[a.REQ_RECV=1]="REQ_RECV",a[a.REQ_RECV_POLL=2]="REQ_RECV_POLL",a[a.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(g||(g={})),h.default=g},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(4),r(58),r(13),r(39),r(31),r(23),r(27),r(28),r(59),r(60))})(this,function(g){return g})},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(3)),N=function(){function I(E){this.members=E||[]}return I.prototype.call=function(){for(var E=[],P=0;P<arguments.length;P++)E[P]=arguments[P];for(var F=0,S=this.members;F<S.length;F++){var b=S[F];if(b)try{b.apply(void 0,E)}catch(u){a.default.logAction(a.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+u+"; stack = "+u.stack)}}},I.prototype.push=function(){for(var E,P=[],F=0;F<arguments.length;F++)P[F]=arguments[F];(E=this.members).push.apply(E,P)},I.create=function(E){var P=new I(E);return Object.assign(function(){for(var F=[],S=0;S<arguments.length;S++)F[S]=arguments[S];return P.call.apply(P,F)},{push:function(F){return P.push(F)}})},I}();h.default=N},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){(function(){var a=g,N=a.lib,I=N.Base,E=a.enc,P=E.Utf8,F=a.algo,S=F.HMAC=I.extend({init:function(b,u){b=this._hasher=new b.init,typeof u=="string"&&(u=P.parse(u));var A=b.blockSize,w=A*4;u.sigBytes>w&&(u=b.finalize(u)),u.clamp();for(var T=this._oKey=u.clone(),m=this._iKey=u.clone(),d=T.words,y=m.words,o=0;o<A;o++)d[o]^=1549556828,y[o]^=909522486;T.sigBytes=m.sigBytes=w,this.reset()},reset:function(){var b=this._hasher;b.reset(),b.update(this._iKey)},update:function(b){return this._hasher.update(b),this},finalize:function(b){var u=this._hasher,A=u.finalize(b);u.reset();var w=u.finalize(this._oKey.clone().concat(A));return w}})})()})},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(0)),N=g.__importStar(r(2)),I=g.__importDefault(r(3)),E=g.__importDefault(r(16)),P=g.__importDefault(r(17)),F=g.__importDefault(r(5));function S(m,d,y,o,c){m.http.supportsAuthHeaders?m.auth.getAuthHeaders(function(s,f){s?o(s):c(N.mixin(f,d),y)}):m.auth.getAuthParams(function(s,f){s?o(s):c(d,N.mixin(f,y))})}function b(m,d){return function(y,o,c,s,f){if(y&&!o){m(y);return}if(!s)try{o=N.decodeBody(o,d)}catch(H){m(H);return}if(!o){m(new F.default("unenvelope(): Response body is missing",null));return}var i=o,p=i.statusCode,R=i.response,L=i.headers;if(p===void 0){m(y,o,c,!0,f);return}if(p<200||p>=300){var z=R&&R.error||y;z||(z=new Error("Error in unenveloping "+o),z.statusCode=p),m(z,R,L,!0,p);return}m(y,R,L,!0,p)}}function u(m){var d=[];if(m)for(var y in m)d.push(y+"="+m[y]);return d.join("&")}function A(m,d){return m+(d?"?":"")+u(d)}function w(m,d,y,o){return function(c,s,f,i,p){c?I.default.logAction(I.default.LOG_MICRO,"Resource."+d+"()","Received Error; "+A(y,o)+"; Error: "+N.inspectError(c)):I.default.logAction(I.default.LOG_MICRO,"Resource."+d+"()","Received; "+A(y,o)+"; Headers: "+u(f)+"; StatusCode: "+p+"; Body: "+(a.default.BufferUtils.isBuffer(s)?s.toString():s)),m&&m(c,s,f,i,p)}}var T=function(){function m(){}return m.get=function(d,y,o,c,s,f){m.do(P.default.Get,d,y,null,o,c,s,f)},m.delete=function(d,y,o,c,s,f){m.do(P.default.Delete,d,y,null,o,c,s,f)},m.post=function(d,y,o,c,s,f,i){m.do(P.default.Post,d,y,o,c,s,f,i)},m.patch=function(d,y,o,c,s,f,i){m.do(P.default.Patch,d,y,o,c,s,f,i)},m.put=function(d,y,o,c,s,f,i){m.do(P.default.Put,d,y,o,c,s,f,i)},m.do=function(d,y,o,c,s,f,i,p){I.default.shouldLog(I.default.LOG_MICRO)&&(p=w(p,d,o,f)),i&&(p=p&&b(p,i),(f=f||{}).envelope=i);function R(L,z){var H;if(I.default.shouldLog(I.default.LOG_MICRO)&&I.default.logAction(I.default.LOG_MICRO,"Resource."+d+"()","Sending; "+A(o,z)),I.default.shouldLog(I.default.LOG_MICRO)){var D=c;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{D=a.default.Config.msgpack.decode(c)}catch(C){I.default.logAction(I.default.LOG_MICRO,"Resource."+d+"()","Sending MsgPack Decoding Error: "+N.inspectError(C))}I.default.logAction(I.default.LOG_MICRO,"Resource."+d+"()","Sending; "+A(o,z)+"; Body: "+D)}y.http.do(d,y,o,L,c,z,function(C,_,j,W,Q){if(C&&E.default.isTokenErr(C)){y.auth.authorize(null,null,function(Z){if(Z){p(Z);return}S(y,j,z,p,R)});return}p(C,_,j,W,Q)})}S(y,s,f,p,R)},m}();h.default=T},function(v,h,r){"use strict";(function(g){h.__esModule=!0,h.TransportParams=void 0;var a=r(1),N=a.__importDefault(r(10)),I=a.__importStar(r(2)),E=a.__importStar(r(51)),P=a.__importDefault(r(8)),F=a.__importDefault(r(0)),S=a.__importDefault(r(7)),b=a.__importDefault(r(35)),u=a.__importDefault(r(3)),A=a.__importDefault(r(36)),w=a.__importStar(r(19)),T=a.__importDefault(r(5)),m=a.__importDefault(r(16)),d=a.__importDefault(r(9)),y=a.__importDefault(r(22)),o=a.__importDefault(r(52)),c=a.__importDefault(r(26)),s=a.__importDefault(r(53)),f=function(){var Z;return typeof F.default.WebStorage!="undefined"&&((Z=F.default.WebStorage)===null||Z===void 0?void 0:Z.localSupported)},i=function(){var Z;return typeof F.default.WebStorage!="undefined"&&((Z=F.default.WebStorage)===null||Z===void 0?void 0:Z.sessionSupported)},p=N.default.Action,R=function(){},L="ably-transport-preference",z="ably-connection-recovery";function H(){var Z,q;return i()&&((q=(Z=F.default.WebStorage)===null||Z===void 0?void 0:Z.getSession)===null||q===void 0?void 0:q.call(Z,z))}function D(Z){var q,G;return i()&&((G=(q=F.default.WebStorage)===null||q===void 0?void 0:q.setSession)===null||G===void 0?void 0:G.call(q,z,Z))}function C(){var Z,q;return i()&&((q=(Z=F.default.WebStorage)===null||Z===void 0?void 0:Z.removeSession)===null||q===void 0?void 0:q.call(Z,z))}function _(Z,q){return I.arrIndexOf(F.default.Defaults.transportPreferenceOrder,Z.shortName)>I.arrIndexOf(F.default.Defaults.transportPreferenceOrder,q.shortName)}function j(Z,q,G){var M;if(Z.channel!==q.channel||(M=Z.action)!==p.PRESENCE&&M!==p.MESSAGE||M!==q.action)return!1;var U=M===p.PRESENCE?"presence":"messages",K=Z[U].concat(q[U]),k=d.default.getMessagesSize(K);return k>G||!I.allSame(K,"clientId")||!I.arrEvery(K,function(tt){return!tt.id})?!1:(Z[U]=K,!0)}var W=function(){function Z(q,G,M,U){this.options=q,this.host=G,this.mode=M,this.connectionKey=U,this.format=q.useBinaryProtocol?I.Format.msgpack:I.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return Z.prototype.getConnectParams=function(q){var G=q?I.copy(q):{},M=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var U=M.recover.split(":");if(U){G.recover=U[0];var K=U[1];isNaN(Number(K))?G.timeSerial=K:G.connectionSerial=K}break}default:}return M.clientId!==void 0&&(G.clientId=M.clientId),M.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=P.default.apiVersion,G.agent=encodeURIComponent(P.default.agent),M.transportParams!==void 0&&I.mixin(G,M.transportParams),G},Z.prototype.toString=function(){var q="[mode="+this.mode;return this.host&&(q+=",host="+this.host),this.connectionKey&&(q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(q+=",timeSerial="+this.timeSerial),this.format&&(q+=",format="+this.format),q+="]",q},Z}();h.TransportParams=W;var Q=function(Z){a.__extends(q,Z);function q(G,M){var U=Z.call(this)||this;U.disconnectedRetryCount=0,q.initTransports(),U.realtime=G,U.options=M;var K=M.timeouts,k=K.preferenceConnectTimeout+K.realtimeRequestTimeout;if(U.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:k,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:K.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},U.state=U.states.initialized,U.errorReason=null,U.queuedMessages=new b.default,U.msgSerial=0,U.connectionDetails=void 0,U.connectionId=void 0,U.connectionKey=void 0,U.timeSerial=void 0,U.connectionSerial=void 0,U.connectionStateTtl=K.connectionStateTtl,U.maxIdleInterval=null,U.transports=I.intersect(M.transports||P.default.defaultTransports,q.supportedTransports),U.baseTransport=I.intersect(P.default.baseTransportOrder,U.transports)[0],U.upgradeTransports=I.intersect(U.transports,P.default.upgradeTransports),U.transportPreference=null,U.httpHosts=P.default.getHosts(M),U.activeProtocol=null,U.proposedTransports=[],U.pendingTransports=[],U.host=null,U.lastAutoReconnectAttempt=null,U.lastActivity=null,U.mostRecentMsg=null,U.forceFallbackHost=!1,U.connectCounter=0,u.default.logAction(u.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(M.transports||P.default.defaultTransports)+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+U.transports+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+U.httpHosts+"]"),!U.transports.length){var tt="no requested transports available";throw u.default.logAction(u.default.LOG_ERROR,"realtime.ConnectionManager()",tt),new Error(tt)}var ut=F.default.Config.addEventListener;return ut&&(i()&&typeof M.recover=="function"&&ut("beforeunload",U.persistConnection.bind(U)),M.closeOnUnload===!0&&ut("beforeunload",function(){u.default.logAction(u.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),U.requestState({state:"closing"})}),ut("online",function(){(U.state==U.states.disconnected||U.state==U.states.suspended)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),U.requestState({state:"connecting"}))}),ut("offline",function(){U.state==U.states.connected&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),U.disconnectAllTransports())})),U}return q.initTransports=function(){o.default(q),I.arrForEach(F.default.Transports,function(G){G(q)})},q.prototype.createTransportParams=function(G,M){var U=new W(this.options,G,M,this.connectionKey);return this.timeSerial?U.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(U.connectionSerial=this.connectionSerial),U},q.prototype.getTransportParams=function(G){var M=this,U=function(K){if(M.connectionKey){K("resume");return}if(typeof M.options.recover=="string"){K("recover");return}var k=M.options.recover,tt=H();if(tt&&typeof k=="function"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),k(tt,function(ut){ut?(M.options.recover=tt.recoveryKey,K("recover")):K("clean")});return}K("clean")};U(function(K){var k=M.createTransportParams(null,K);if(K==="recover"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+M.options.recover);var tt=M.options.recover.split(":");tt&&tt[2]&&(M.msgSerial=Number(tt[2]))}else u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+k.toString());G(k)})},q.prototype.tryATransport=function(G,M,U){var K=this;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+M),c.default.tryConnect(q.supportedTransports[M],this,this.realtime.auth,G,function(k,tt){var ut=K.state;if(ut==K.states.closing||ut==K.states.closed||ut==K.states.failed){tt&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ut.state+" while we were attempting the transport; closing "+tt),tt.close()),U(!0);return}if(k){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+M+" "+k.event+", err: "+k.error.toString()),m.default.isTokenErr(k.error)&&!(K.errorReason&&m.default.isTokenErr(K.errorReason))?(K.errorReason=k.error,K.realtime.auth._forceNewToken(null,null,function(vt){if(vt){K.actOnErrorFromAuthorize(vt);return}K.tryATransport(G,M,U)})):k.event==="failed"?(K.notifyState({state:"failed",error:k.error}),U(!0)):k.event==="disconnected"&&(w.isRetriable(k.error)?U(!1):(K.notifyState({state:K.states.connecting.failState,error:k.error}),U(!0)));return}u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+M+"; setting pending"),K.setTransportPending(tt,G),U(null,tt)})},q.prototype.setTransportPending=function(G,M){var U=this,K=M.mode;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+K),I.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var k=F.default.Defaults.transportPreferenceOrder[F.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ut,vt,gt,Ot){K=="upgrade"?G.shortName!==k&&I.arrIn(U.getUpgradePossibilities(),k)&&U.activeProtocol?setTimeout(function(){U.scheduleTransportActivation(ut,G,vt,gt,Ot)},U.options.timeouts.parallelUpgradeDelay):U.scheduleTransportActivation(ut,G,vt,gt,Ot):(U.activateTransport(ut,G,vt,gt,Ot),F.default.Config.nextTick(function(){U.connectImpl(M)})),K==="recover"&&U.options.recover&&(U.options.recover=null,U.unpersistConnection())});var tt=this;G.on(["disconnected","closed","failed"],function(ut){tt.deactivateTransport(G,this.event,ut)}),this.emit("transport.pending",G)},q.prototype.scheduleTransportActivation=function(G,M,U,K,k){var tt=this,ut=this.activeProtocol&&this.activeProtocol.getTransport(),vt=function(){M.disconnect(),I.arrDeleteValue(tt.pendingTransports,M)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+M.shortName),vt();return}if(ut&&!_(M,ut)){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+M.shortName+" is no better than current active transport "+ut.shortName+" - abandoning upgrade"),vt();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+M);var gt=function(Ot){var Mt;if(Ot){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+M+"; err = "+Ot);return}if(!M.isConnected){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+M.shortName+"is no longer connected; abandoning upgrade"),vt();return}if(tt.state===tt.states.connected)u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),tt.state=tt.states.synchronizing,Mt=tt.activeProtocol;else if(tt.state!==tt.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+tt.state.state+(tt.state===tt.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+M.shortName),vt();return}var lt=U!==tt.connectionId,xt=lt?k:tt;lt&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(tt.timeSerial||tt.connectionSerial)+" to "+(xt.timeSerial||xt.connectionSerial)+"; upgrade error was "+G),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+M),tt.sync(M,xt,function(qt,Ut,Ht){if(qt){tt.state===tt.states.synchronizing&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+M+"; err = "+qt),tt.disconnectAllTransports());return}var ae=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+M),tt.activateTransport(G,M,Ut,K,Ht),tt.state===tt.states.synchronizing?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+M),tt.state=tt.states.connected):u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+tt.state.state+", so leaving unchanged"),tt.state.sendEvents&&tt.sendQueuedMessages()};Mt?Mt.onceIdle(ae):ae()})};ut?this.realtime.channels.onceNopending(gt):gt()},q.prototype.activateTransport=function(G,M,U,K,k){var tt=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+M),G&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),U&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+U),K&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(K)),k&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(k.timeSerial||k.connectionSerial)),this.persistTransportPreference(M);var ut=this.state,vt=this.states.connected.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ut.state),ut.state==this.states.closing.state||ut.state==this.states.closed.state||ut.state==this.states.failed.state)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),M.disconnect(),!1;if(I.arrDeleteValue(this.pendingTransports,M),!M.isConnected)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+M+" since it appears to no longer be connected"),!1;var gt=this.activeProtocol;this.activeProtocol=new E.default(M),this.host=M.params.host;var Ot=K.connectionKey;if(Ot&&this.connectionKey!=Ot&&this.setConnection(U,K,k,!!G),this.onConnectionDetailsUpdate(K,M),F.default.Config.nextTick(function(){M.on("connected",function(lt,xt,qt){tt.onConnectionDetailsUpdate(qt,M),tt.emit("update",new A.default(vt,vt,null,lt))})}),ut.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new A.default(vt,vt,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",M),gt)if(gt.messageQueue.count()>0&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+gt.transport.shortName+", new one is "+M.shortName+") finishing with "+gt.messageQueue.count()+" messages still pending"),gt.transport===M){var Mt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+M.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",Mt)}else gt.finish();return I.safeArrForEach(this.pendingTransports,function(lt){if(lt===M){var xt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+M.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",xt),I.arrDeleteValue(tt.pendingTransports,M)}else lt.disconnect()}),I.safeArrForEach(this.proposedTransports,function(lt){lt===M?(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+M.shortName+"; stack = "+new Error().stack),I.arrDeleteValue(tt.proposedTransports,M)):lt.dispose()}),!0},q.prototype.deactivateTransport=function(G,M,U){var K=this.activeProtocol,k=K&&K.getTransport()===G,tt=I.arrDeleteValue(this.pendingTransports,G),ut=I.arrDeleteValue(this.proposedTransports,G),vt=this.noTransportsScheduledForActivation();if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+M+(k?"; was active":tt?"; was pending":ut?"; was proposed":"")+(vt?"":"; another transport is scheduled for activation")),U&&U.message&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+U.message),k&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(K.getPendingMessages()),F.default.Config.nextTick(function(){K.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),k&&vt||k&&M==="failed"||M==="closed"||K===null&&tt&&this.pendingTransports.length===0){if(M==="disconnected"&&U&&U.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:M,error:U,retryImmediately:!0});return}var gt=M==="failed"&&m.default.isTokenErr(U)?"disconnected":M;this.notifyState({state:gt,error:U});return}k&&M==="disconnected"&&this.state!==this.states.synchronizing&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:U}))},q.prototype.noTransportsScheduledForActivation=function(){return I.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},q.prototype.sync=function(G,M,U){var K=setTimeout(function(){G.off("sync"),U(new T.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),k=N.default.fromValues({action:p.SYNC,connectionKey:this.connectionKey});M.timeSerial?k.timeSerial=M.timeSerial:M.connectionSerial!==void 0&&(k.connectionSerial=M.connectionSerial),G.send(k),G.once("sync",function(tt,ut){clearTimeout(K),U(null,tt,ut)})},q.prototype.setConnection=function(G,M,U,K){var k=this,tt=this.connectionId,ut=tt&&tt!==G,vt=!tt&&K;(ut||vt)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),F.default.Config.nextTick(function(){k.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){k.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=M.connectionKey;var gt=ut||!tt;this.setConnectionSerial(U,gt,!1)},q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},q.prototype.setConnectionSerial=function(G,M,U){var K=G.timeSerial,k=G.connectionSerial;if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+k+"; timeSerial = "+K+"; force = "+M+"; previous = "+this.connectionSerial),K!==void 0){if(K<=this.timeSerial&&!M)return U&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+K+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=K,this.setRecoveryKey();return}if(k!==void 0){if(k<=this.connectionSerial&&!M)return U&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+k+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=k,this.setRecoveryKey()}},q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=I.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},q.prototype.persistConnection=function(){if(i()){var G=this.realtime.connection.recoveryKey;G&&D({recoveryKey:G,disconnectedAt:I.now(),location:g.location,clientId:this.realtime.auth.clientId})}},q.prototype.unpersistConnection=function(){C()},q.prototype.getError=function(){return this.errorReason||this.getStateError()},q.prototype.getStateError=function(){return w.default[this.state.state]},q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},q.prototype.enactStateChange=function(G){var M=G.current==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(M,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var U=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(U.terminal||U.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},q.prototype.startTransitionTimer=function(G){var M=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){M.transitionTimer&&(M.transitionTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),M.notifyState({state:G.failState}))},G.retryDelay)},q.prototype.cancelTransitionTimer=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},q.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},q.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},q.prototype.startRetryTimer=function(G){var M=this;this.retryTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),M.retryTimer=null,M.requestState({state:"connecting"})},G)},q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},q.prototype.notifyState=function(G){var M=this,U=G.state,K=U==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&m.default.isTokenErr(G.error)&&!(this.errorReason&&m.default.isTokenErr(this.errorReason)));if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+U+(K?"; will retry connection immediately":"")),U!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(U==="suspended"||U==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var k=this.states[G.state],tt=k.retryDelay;k.state==="disconnected"&&(this.disconnectedRetryCount++,tt=k.retryDelay*I.getBackoffCoefficient(this.disconnectedRetryCount)*I.getJitterCoefficient());var ut=new A.default(this.state.state,k.state,tt,G.error||w.default[k.state]);if(K){var vt=function(){M.state===M.states.disconnected&&(M.lastAutoReconnectAttempt=I.now(),M.requestState({state:"connecting"}))},gt=this.lastAutoReconnectAttempt&&I.now()-this.lastAutoReconnectAttempt+1;gt&&gt<1e3?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+gt+"ms ago, waiting another "+(1e3-gt)+"ms before trying again"),setTimeout(vt,1e3-gt)):F.default.Config.nextTick(vt)}else(U==="disconnected"||U==="suspended")&&this.startRetryTimer(tt);(U==="disconnected"&&!K||U==="suspended"||k.terminal)&&F.default.Config.nextTick(function(){M.disconnectAllTransports()}),U=="connected"&&!this.activeProtocol&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ut),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(U,ut.reason),this.failQueuedMessages(ut.reason))}},q.prototype.requestState=function(G){var M=this,U=G.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+U+"; current state: "+this.state.state),U!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(U),!(U=="connecting"&&this.state.state=="connected")&&!(U=="closing"&&this.state.state=="closed"))){var K=this.states[U],k=new A.default(this.state.state,K.state,null,G.error||w.default[K.state]);this.enactStateChange(k),U=="connecting"&&F.default.Config.nextTick(function(){M.startConnect()}),U=="closing"&&this.closeImpl()}},q.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var M=this.realtime.auth,U=++this.connectCounter,K=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(tt){U===G.connectCounter&&G.connectImpl(tt,U)})};if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),M.method==="basic")K();else{var k=function(tt){U===G.connectCounter&&(tt?G.actOnErrorFromAuthorize(tt):K())};this.errorReason&&m.default.isTokenErr(this.errorReason)?M._forceNewToken(null,null,k):M._ensureValidAuthCredentials(!1,k)}},q.prototype.connectImpl=function(G,M){var U=this.state.state;U!==this.states.connecting.state&&U!==this.states.connected.state?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+U):this.pendingTransports.length?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):U==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,M)},q.prototype.connectPreference=function(G){var M=this,U=this.getTransportPreference(),K=!1;I.arrIn(this.transports,U)||(this.unpersistTransportPreference(),this.connectImpl(G)),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+U);var k=setTimeout(function(){K=!0,M.state.state!==M.states.connected.state&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+U+" failed; clearing preference and trying from scratch"),M.disconnectAllTransports(),M.unpersistTransportPreference()),M.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,U,function(tt,ut){clearTimeout(k),K&&ut?(ut.off(),ut.disconnect(),I.arrDeleteValue(M.pendingTransports,ut)):!ut&&!tt&&(M.unpersistTransportPreference(),M.connectImpl(G))})},q.prototype.connectBase=function(G,M){var U=this,K=function(gt){U.notifyState({state:U.states.connecting.failState,error:gt})},k=this.httpHosts.slice(),tt=function(gt,Ot){M===U.connectCounter&&!Ot&&!gt&&vt()};u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ut=k.shift();if(!ut){K(new T.default("Unable to connect (no available host)",80003,404));return}G.host=ut;var vt=function(){if(!k.length){K(new T.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!U.realtime.http.checkConnectivity){K(new T.default("Internal error: Http.checkConnectivity not set",null,500));return}U.realtime.http.checkConnectivity(function(gt,Ot){if(M===U.connectCounter){if(gt){K(gt);return}if(!Ot){K(new T.default("Unable to connect (network unreachable)",80003,404));return}G.host=I.arrPopRandomElement(k),U.tryATransport(G,U.baseTransport,tt)}})};if(this.forceFallbackHost&&k.length){this.forceFallbackHost=!1,vt();return}this.tryATransport(G,this.baseTransport,tt)},q.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,M=I.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(M+1)},q.prototype.upgradeIfNeeded=function(G){var M=this,U=this.getUpgradePossibilities();u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+F.default.Config.inspect(U)),U.length&&I.arrForEach(U,function(K){var k=M.createTransportParams(G.host,"upgrade");M.tryATransport(k,K,R)})},q.prototype.closeImpl=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),I.safeArrForEach(this.pendingTransports,function(G){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),I.safeArrForEach(this.proposedTransports,function(G){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},q.prototype.onAuthUpdated=function(G,M){var U=this,K;switch(this.state.state){case"connected":{if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var k=this.activeProtocol.getTransport().params;F.default.Config.nextTick(function(){U.state.state==="connected"&&U.upgradeIfNeeded(k)})}var tt=(K=this.activeProtocol)===null||K===void 0?void 0:K.getTransport();tt&&tt.onAuthUpdated&&tt.onAuthUpdated(G);var ut=N.default.fromValues({action:p.AUTH,auth:{accessToken:G.token}});this.send(ut);var vt=function(){U.off(gt),M(null,G)},gt=function(Mt){Mt.current==="failed"&&(U.off(vt),U.off(gt),M(Mt.reason||U.getStateError()))};this.once("connectiondetails",vt),this.on("connectionstate",gt);break}case"connecting":u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Ot=function(Mt){switch(Mt.current){case"connected":U.off(Ot),M(null,G);break;case"failed":case"closed":case"suspended":U.off(Ot),M(Mt.reason||U.getStateError());break;default:break}};this.on("connectionstate",Ot),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},q.prototype.disconnectAllTransports=function(G){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,I.safeArrForEach(this.pendingTransports,function(M){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+M),M&&M.disconnect()}),this.pendingTransports=[],I.safeArrForEach(this.proposedTransports,function(M){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+M),M&&M.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},q.prototype.send=function(G,M,U){U=U||R;var K=this.state;if(K.sendEvents){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new E.PendingMessage(G,U));return}var k=M&&K.queueEvents||K.forceQueueEvents;if(!k){var tt="rejecting event, queueEvent was "+M+", state was "+K.state;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()",tt),U(this.errorReason||new T.default(tt,9e4,400));return}u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+N.default.stringify(G)),this.queue(G,U)},q.prototype.sendImpl=function(G){var M=G.message;G.ackRequired&&!G.sendAttempted&&(M.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(U){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+U.stack)}},q.prototype.queue=function(G,M){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var U=this.queuedMessages.last(),K=this.options.maxMessageSize;U&&!U.sendAttempted&&j(U.message,G,K)?(U.merged||(U.callback=y.default.create([U.callback]),U.merged=!0),U.callback.push(M)):this.queuedMessages.push(new E.PendingMessage(G,M))},q.prototype.sendQueuedMessages=function(){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},q.prototype.queuePendingMessages=function(G){G&&G.length&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},q.prototype.failQueuedMessages=function(G){var M=this.queuedMessages.count();M>0&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+M+" queued messages, err = "+I.inspectError(G)),this.queuedMessages.completeAllMessages(G))},q.prototype.onChannelMessage=function(G,M){var U=this.activeProtocol&&M===this.activeProtocol.getTransport(),K=I.arrIn(this.pendingTransports,M)&&this.state==this.states.synchronizing,k=G.action===p.MESSAGE||G.action===p.PRESENCE;if(U||K){if(k){var tt=this.setConnectionSerial(G,!1,!0);if(tt)return;if(N.default.isDuplicate(G,this.mostRecentMsg)){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else I.arrIndexOf([p.ACK,p.NACK,p.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},q.prototype.ping=function(G,M){var U=this;if(G){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var K=function(){G.off("heartbeat",ut),M(new T.default("Timeout waiting for heartbeat response",5e4,500))},k=I.now(),tt=I.cheapRandStr(),ut=function(lt){if(lt===tt){G.off("heartbeat",ut),clearTimeout(vt);var xt=I.now()-k;M(null,xt)}},vt=setTimeout(K,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ut),G.ping(tt);return}if(this.state.state!=="connected"){M(new T.default("Unable to ping service; not connected",4e4,400));return}var gt=!1,Ot=function(lt,xt){U.off("transport.active",Mt),gt||(gt=!0,M(lt,xt))},Mt=function(){gt||(gt=!0,F.default.Config.nextTick(function(){U.ping(null,M)}))};this.on("transport.active",Mt),this.ping(this.activeProtocol.getTransport(),Ot)},q.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},q.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},q.prototype.getTransportPreference=function(){var G,M;return this.transportPreference||f()&&((M=(G=F.default.WebStorage)===null||G===void 0?void 0:G.get)===null||M===void 0?void 0:M.call(G,L))},q.prototype.persistTransportPreference=function(G){var M,U;I.arrIn(P.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,f()&&((U=(M=F.default.WebStorage)===null||M===void 0?void 0:M.set)===null||U===void 0||U.call(M,L,G.shortName)))},q.prototype.unpersistTransportPreference=function(){var G,M;this.transportPreference=null,f()&&((M=(G=F.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||M===void 0||M.call(G,L))},q.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===s.default.Forbidden){var M="Client configured authentication provider returned 403; failing the connection";u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",M),this.notifyState({state:"failed",error:new T.default(M,80019,403,G)})}else{var M="Client configured authentication provider request failed";u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",M),this.notifyState({state:this.state.failState,error:new T.default(M,80019,401,G)})}},q.prototype.onConnectionDetailsUpdate=function(G,M){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var U=G.clientId;if(U){var K=this.realtime.auth._uncheckedSetClientId(U);if(K){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",K.message),M.fail(K);return}}var k=G.connectionStateTtl;k&&(this.connectionStateTtl=k),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},q.supportedTransports={},q}(S.default);h.default=Q}).call(this,r(12))},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(10)),N=g.__importStar(r(2)),I=g.__importDefault(r(7)),E=g.__importDefault(r(3)),P=g.__importDefault(r(19)),F=g.__importDefault(r(5)),S=g.__importDefault(r(0)),b=a.default.Action,u=a.default.fromValues({action:b.CLOSE}),A=a.default.fromValues({action:b.DISCONNECT}),w=function(T){g.__extends(m,T);function m(d,y,o,c){var s=T.call(this)||this;return c&&(o.format=void 0,o.heartbeats=!0),s.connectionManager=d,d.registerProposedTransport(s),s.auth=y,s.params=o,s.timeouts=o.options.timeouts,s.format=o.format,s.isConnected=!1,s.isFinished=!1,s.isDisposed=!1,s.maxIdleInterval=null,s.idleTimer=null,s.lastActivity=null,s}return m.prototype.connect=function(){},m.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",P.default.closed)},m.prototype.disconnect=function(d){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",d||P.default.disconnected)},m.prototype.fail=function(d){this.isConnected&&this.requestDisconnect(),this.finish("failed",d||P.default.failed)},m.prototype.finish=function(d,y){var o;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((o=this.idleTimer)!==null&&o!==void 0?o:void 0),this.idleTimer=null,this.emit(d,y),this.dispose())},m.prototype.onProtocolMessage=function(d){switch(E.default.shouldLog(E.default.LOG_MICRO)&&E.default.logAction(E.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+a.default.stringify(d)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),d.action){case b.HEARTBEAT:E.default.logAction(E.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",d.id);break;case b.CONNECTED:this.onConnect(d),this.emit("connected",d.error,d.connectionId,d.connectionDetails,d);break;case b.CLOSED:this.onClose(d);break;case b.DISCONNECTED:this.onDisconnect(d);break;case b.ACK:this.emit("ack",d.msgSerial,d.count);break;case b.NACK:this.emit("nack",d.msgSerial,d.count,d.error);break;case b.SYNC:if(d.connectionId!==void 0){this.emit("sync",d.connectionId,d);break}this.connectionManager.onChannelMessage(d,this);break;case b.AUTH:this.auth.authorize(function(y){y&&E.default.logAction(E.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+N.inspectError(y))});break;case b.ERROR:if(E.default.logAction(E.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+S.default.Config.inspect(d.error)+(d.channel?", channel: "+d.channel:"")),d.channel===void 0){this.onFatalError(d);break}this.connectionManager.onChannelMessage(d,this);break;default:this.connectionManager.onChannelMessage(d,this)}},m.prototype.onConnect=function(d){if(this.isConnected=!0,!d.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var y=d.connectionDetails.maxIdleInterval;y&&(this.maxIdleInterval=y+this.timeouts.realtimeRequestTimeout,this.onActivity())},m.prototype.onDisconnect=function(d){var y=d&&d.error;E.default.logAction(E.default.LOG_MINOR,"Transport.onDisconnect()","err = "+N.inspectError(y)),this.finish("disconnected",y)},m.prototype.onFatalError=function(d){var y=d&&d.error;E.default.logAction(E.default.LOG_MINOR,"Transport.onFatalError()","err = "+N.inspectError(y)),this.finish("failed",y)},m.prototype.onClose=function(d){var y=d&&d.error;E.default.logAction(E.default.LOG_MINOR,"Transport.onClose()","err = "+N.inspectError(y)),this.finish("closed",y)},m.prototype.requestClose=function(){E.default.logAction(E.default.LOG_MINOR,"Transport.requestClose()",""),this.send(u)},m.prototype.requestDisconnect=function(){E.default.logAction(E.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(A)},m.prototype.ping=function(d){var y={action:a.default.Action.HEARTBEAT};d&&(y.id=d),this.send(a.default.fromValues(y))},m.prototype.dispose=function(){E.default.logAction(E.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},m.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=N.now(),this.setIdleTimer(this.maxIdleInterval+100))},m.prototype.setIdleTimer=function(d){var y=this;this.idleTimer||(this.idleTimer=setTimeout(function(){y.onIdleTimerExpire()},d))},m.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var d=N.now()-this.lastActivity,y=this.maxIdleInterval-d;if(y<=0){var o="No activity seen from realtime in "+d+"ms; assuming connection has dropped";E.default.logAction(E.default.LOG_ERROR,"Transport.onIdleTimerExpire()",o),this.disconnect(new F.default(o,80003,408))}else this.setIdleTimer(y+100)},m.tryConnect=function(d,y,o,c,s){var f=new d(y,o,c),i,p=function(L){clearTimeout(i),s({event:this.event,error:L})},R=y.options.timeouts.realtimeRequestTimeout;i=setTimeout(function(){f.off(["preconnect","disconnected","failed"]),f.dispose(),p.call({event:"disconnected"},new F.default("Timeout waiting for transport to indicate itself viable",5e4,500))},R),f.on(["failed","disconnected"],p),f.on("preconnect",function(){E.default.logAction(E.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+f),clearTimeout(i),f.off(["failed","disconnected"],p),s(null,f)}),f.connect()},m}(I.default);h.default=w},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(39),r(23))})(this,function(g){return function(){var a=g,N=a.lib,I=N.Base,E=N.WordArray,P=a.algo,F=P.MD5,S=P.EvpKDF=I.extend({cfg:I.extend({keySize:128/32,hasher:F,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(b,u){for(var A,w=this.cfg,T=w.hasher.create(),m=E.create(),d=m.words,y=w.keySize,o=w.iterations;d.length<y;){A&&T.update(A),A=T.update(b).finalize(u),T.reset();for(var c=1;c<o;c++)A=T.finalize(A),T.reset();m.concat(A)}return m.sigBytes=y*4,m}});a.EvpKDF=function(b,u,A){return S.create(A).compute(b,u)}}(),g.EvpKDF})},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(27))})(this,function(g){g.lib.Cipher||function(a){var N=g,I=N.lib,E=I.Base,P=I.WordArray,F=I.BufferedBlockAlgorithm,S=N.enc,b=S.Utf8,u=S.Base64,A=N.algo,w=A.EvpKDF,T=I.Cipher=F.extend({cfg:E.extend(),createEncryptor:function(C,_){return this.create(this._ENC_XFORM_MODE,C,_)},createDecryptor:function(C,_){return this.create(this._DEC_XFORM_MODE,C,_)},init:function(C,_,j){this.cfg=this.cfg.extend(j),this._xformMode=C,this._key=_,this.reset()},reset:function(){F.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){C&&this._append(C);var _=this._doFinalize();return _},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function C(_){return typeof _=="string"?D:L}return function(_){return{encrypt:function(j,W,Q){return C(W).encrypt(_,j,W,Q)},decrypt:function(j,W,Q){return C(W).decrypt(_,j,W,Q)}}}}()}),m=I.StreamCipher=T.extend({_doFinalize:function(){var C=this._process(!0);return C},blockSize:1}),d=N.mode={},y=I.BlockCipherMode=E.extend({createEncryptor:function(C,_){return this.Encryptor.create(C,_)},createDecryptor:function(C,_){return this.Decryptor.create(C,_)},init:function(C,_){this._cipher=C,this._iv=_}}),o=d.CBC=function(){var C=y.extend();C.Encryptor=C.extend({processBlock:function(j,W){var Q=this._cipher,Z=Q.blockSize;_.call(this,j,W,Z),Q.encryptBlock(j,W),this._prevBlock=j.slice(W,W+Z)}}),C.Decryptor=C.extend({processBlock:function(j,W){var Q=this._cipher,Z=Q.blockSize,q=j.slice(W,W+Z);Q.decryptBlock(j,W),_.call(this,j,W,Z),this._prevBlock=q}});function _(j,W,Q){var Z,q=this._iv;q?(Z=q,this._iv=a):Z=this._prevBlock;for(var G=0;G<Q;G++)j[W+G]^=Z[G]}return C}(),c=N.pad={},s=c.Pkcs7={pad:function(C,_){for(var j=_*4,W=j-C.sigBytes%j,Q=W<<24|W<<16|W<<8|W,Z=[],q=0;q<W;q+=4)Z.push(Q);var G=P.create(Z,W);C.concat(G)},unpad:function(C){var _=C.words[C.sigBytes-1>>>2]&255;C.sigBytes-=_}},f=I.BlockCipher=T.extend({cfg:T.cfg.extend({mode:o,padding:s}),reset:function(){var C;T.reset.call(this);var _=this.cfg,j=_.iv,W=_.mode;this._xformMode==this._ENC_XFORM_MODE?C=W.createEncryptor:(C=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==C?this._mode.init(this,j&&j.words):(this._mode=C.call(W,this,j&&j.words),this._mode.__creator=C)},_doProcessBlock:function(C,_){this._mode.processBlock(C,_)},_doFinalize:function(){var C,_=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(_.pad(this._data,this.blockSize),C=this._process(!0)):(C=this._process(!0),_.unpad(C)),C},blockSize:128/32}),i=I.CipherParams=E.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),p=N.format={},R=p.OpenSSL={stringify:function(C){var _,j=C.ciphertext,W=C.salt;return W?_=P.create([1398893684,1701076831]).concat(W).concat(j):_=j,_.toString(u)},parse:function(C){var _,j=u.parse(C),W=j.words;return W[0]==1398893684&&W[1]==1701076831&&(_=P.create(W.slice(2,4)),W.splice(0,4),j.sigBytes-=16),i.create({ciphertext:j,salt:_})}},L=I.SerializableCipher=E.extend({cfg:E.extend({format:R}),encrypt:function(C,_,j,W){W=this.cfg.extend(W);var Q=C.createEncryptor(j,W),Z=Q.finalize(_),q=Q.cfg;return i.create({ciphertext:Z,key:j,iv:q.iv,algorithm:C,mode:q.mode,padding:q.padding,blockSize:C.blockSize,formatter:W.format})},decrypt:function(C,_,j,W){W=this.cfg.extend(W),_=this._parse(_,W.format);var Q=C.createDecryptor(j,W).finalize(_.ciphertext);return Q},_parse:function(C,_){return typeof C=="string"?_.parse(C,this):C}}),z=N.kdf={},H=z.OpenSSL={execute:function(C,_,j,W){W||(W=P.random(64/8));var Q=w.create({keySize:_+j}).compute(C,W),Z=P.create(Q.words.slice(_),j*4);return Q.sigBytes=_*4,i.create({key:Q,iv:Z,salt:W})}},D=I.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(C,_,j,W){W=this.cfg.extend(W);var Q=W.kdf.execute(j,C.keySize,C.ivSize);W.iv=Q.iv;var Z=L.encrypt.call(this,C,_,Q.key,W);return Z.mixIn(Q),Z},decrypt:function(C,_,j,W){W=this.cfg.extend(W),_=this._parse(_,W.format);var Q=W.kdf.execute(j,C.keySize,C.ivSize,_.salt);W.iv=Q.iv;var Z=L.decrypt.call(this,C,_,Q.key,W);return Z}})}()})},function(v,h,r){"use strict";h.__esModule=!0,h.Request=h.createRequest=void 0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(11)),I=g.__importDefault(r(0)),E=g.__importDefault(r(7)),P=g.__importDefault(r(5)),F=g.__importDefault(r(8)),S=g.__importDefault(r(3)),b=g.__importDefault(r(20)),u=a.getGlobalObject(),A=function(){},w=u._ablyjs_jsonp={};w._=function(s){return w["_"+s]||A};var T=1,m="jsonp";function d(s,f,i,p,R,L,z){return L=L||F.default.TIMEOUTS,new o(void 0,s,f,a.copy(i),p,R,L,z)}h.createRequest=d;var y=function(s){g.__extends(f,s);function f(i,p,R){var L=s.call(this,i,p,R)||this;return L.shortName=m,R.stream=!1,L}return f.isAvailable=function(){return I.default.Config.jsonpSupported&&I.default.Config.allowComet},f.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},f.prototype.createRequest=function(i,p,R,L,z,H,D){return H=(this===null||this===void 0?void 0:this.timeouts)||H||F.default.TIMEOUTS,d(i,p,R,L,z,H,D)},f}(N.default),o=function(s){g.__extends(f,s);function f(i,p,R,L,z,H,D,C){var _=s.call(this)||this;return i===void 0&&(i=T++),_.id=i,_.uri=p,_.params=L||{},_.params.rnd=a.cheapRandStr(),R&&(R["X-Ably-Version"]&&(_.params.v=R["X-Ably-Version"]),R["X-Ably-Lib"]&&(_.params.lib=R["X-Ably-Lib"])),_.body=z,_.method=C,_.requestMode=H,_.timeouts=D,_.requestComplete=!1,_}return f.prototype.exec=function(){var i=this,p=this.id,R=this.body,L=this.method,z=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+p+")",H.envelope="jsonp",R&&(H.body=R),L&&L!=="get"&&(H.method=L);var D=this.script=document.createElement("script"),C=z+a.toQueryString(H);D.src=C,D.src.split("/").slice(-1)[0]!==C.split("/").slice(-1)[0]&&S.default.logAction(S.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),D.async=!0,D.type="text/javascript",D.charset="UTF-8",D.onerror=function(W){i.complete(new P.default("JSONP script error (event: "+I.default.Config.inspect(W)+")",null,400))},w["_"+p]=function(W){if(W.statusCode){var Q=W.response;if(W.statusCode==204)i.complete(null,null,null,W.statusCode);else if(!Q)i.complete(new P.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||a.isArray(Q))i.complete(null,Q,W.headers,W.statusCode);else{var Z=Q.error||new P.default("Error response received from server",null,W.statusCode);i.complete(Z)}}else i.complete(null,W)};var _=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),_);var j=document.getElementsByTagName("head")[0];j.insertBefore(D,j.firstChild)},f.prototype.complete=function(i,p,R,L){if(R=R||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;p&&(z=typeof p=="string"?"text/plain":"application/json",R["content-type"]=z,this.emit("data",p)),this.emit("complete",i,p,R,!0,L),this.dispose()}},f.prototype.abort=function(){this.dispose()},f.prototype.dispose=function(){var i=this.timer;i&&(clearTimeout(i),this.timer=null);var p=this.script;p.parentNode&&p.parentNode.removeChild(p),delete w[this.id],this.emit("disposed")},f}(E.default);h.Request=o;function c(s){return u.JSONPTransport=y,y.isAvailable()&&(s.supportedTransports[m]=y),y}h.default=c},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(3)),I=g.__importDefault(r(8)),E=g.__importDefault(r(16)),P=g.__importDefault(r(45)),F=g.__importDefault(r(18)),S=g.__importDefault(r(33)),b=g.__importDefault(r(5)),u=g.__importDefault(r(48)),A=g.__importDefault(r(17)),w=g.__importDefault(r(0)),T=function(){},m=function(){function y(o){if(!o){var c="no options provided";throw N.default.logAction(N.default.LOG_ERROR,"Rest()",c),new Error(c)}var s=I.default.objectifyOptions(o);s.log&&N.default.setLog(s.log.level,s.log.handler),N.default.logAction(N.default.LOG_MICRO,"Rest()","initialized with clientOptions "+w.default.Config.inspect(o));var f=this.options=I.default.normaliseOptions(s);if(f.key){var i=f.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!i){var c="invalid key parameter";throw N.default.logAction(N.default.LOG_ERROR,"Rest()",c),new b.default(c,40400,404)}f.keyName=i[1],f.keySecret=i[2]}if("clientId"in f)if(typeof f.clientId=="string"||f.clientId===null){if(f.clientId==="*")throw new b.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new b.default("clientId must be either a string or null",40012,400);N.default.logAction(N.default.LOG_MINOR,"Rest()","started; version = "+I.default.version),this.baseUri=this.authority=function(p){return I.default.getHttpScheme(f)+p+":"+I.default.getPort(f,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new w.default.Http,this.auth=new E.default(this,f),this.channels=new d(this),this.push=new P.default(this)}return y.prototype.stats=function(o,c){if(c===void 0)if(typeof o=="function")c=o,o=null;else{if(this.options.promises)return a.promisify(this,"stats",arguments);c=T}var s=a.defaultGetHeaders(),f=this.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,i=this.http.supportsLinkHeaders?void 0:f;this.options.headers&&a.mixin(s,this.options.headers),new F.default(this,"/stats",s,i,function(p,R,L){for(var z=L?p:JSON.parse(p),H=0;H<z.length;H++)z[H]=u.default.fromValues(z[H]);return z}).get(o,c)},y.prototype.time=function(o,c){var s=this;if(c===void 0){if(typeof o=="function")c=o,o=null;else if(this.options.promises)return a.promisify(this,"time",arguments)}var f=c||T,i=a.defaultGetHeaders();this.options.headers&&a.mixin(i,this.options.headers);var p=function(R){return s.authority(R)+"/time"};this.http.do(A.default.Get,this,p,i,null,o,function(R,L,z,H){if(R){f(R);return}H||(L=JSON.parse(L));var D=L[0];if(!D){f(new b.default("Internal error (unexpected result type from GET /time)",5e4,500));return}s.serverTimeOffset=D-a.now(),f(null,D)})},y.prototype.request=function(o,c,s,f,i,p){var R=this.options.useBinaryProtocol,L=R?w.default.Config.msgpack.encode:JSON.stringify,z=R?w.default.Config.msgpack.decode:JSON.parse,H=R?a.Format.msgpack:a.Format.json,D=this.http.supportsLinkHeaders?void 0:H;s=s||{};var C=o.toLowerCase(),_=C=="get"?a.defaultGetHeaders(H):a.defaultPostHeaders(H);if(p===void 0){if(this.options.promises)return a.promisify(this,"request",arguments);p=T}typeof f!="string"&&(f=L(f)),this.options.headers&&a.mixin(_,this.options.headers),i&&a.mixin(_,i);var j=new F.default(this,c,_,D,function(W,Q,Z){return a.ensureArray(Z?W:z(W))},!0);if(!a.arrIn(w.default.Http.methods,C))throw new b.default("Unsupported method "+C,40500,405);a.arrIn(w.default.Http.methodsWithBody,C)?j[C](s,f,p):j[C](s,p)},y.prototype.setLog=function(o){N.default.setLog(o.level,o.handler)},y.Promise=function(o){return o=I.default.objectifyOptions(o),o.promises=!0,new y(o)},y.Callbacks=y,y.Platform=w.default,y}(),d=function(){function y(o){this.rest=o,this.all={}}return y.prototype.get=function(o,c){o=String(o);var s=this.all[o];return s?c&&s.setOptions(c):this.all[o]=s=new S.default(this.rest,o,c),s},y.prototype.release=function(o){delete this.all[String(o)]},y}();h.default=m},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(a){var N=g,I=N.lib,E=I.WordArray,P=I.Hasher,F=N.algo,S=[],b=[];(function(){function w(y){for(var o=a.sqrt(y),c=2;c<=o;c++)if(!(y%c))return!1;return!0}function T(y){return(y-(y|0))*4294967296|0}for(var m=2,d=0;d<64;)w(m)&&(d<8&&(S[d]=T(a.pow(m,1/2))),b[d]=T(a.pow(m,1/3)),d++),m++})();var u=[],A=F.SHA256=P.extend({_doReset:function(){this._hash=new E.init(S.slice(0))},_doProcessBlock:function(w,T){for(var m=this._hash.words,d=m[0],y=m[1],o=m[2],c=m[3],s=m[4],f=m[5],i=m[6],p=m[7],R=0;R<64;R++){if(R<16)u[R]=w[T+R]|0;else{var L=u[R-15],z=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=u[R-2],D=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;u[R]=z+u[R-7]+D+u[R-16]}var C=s&f^~s&i,_=d&y^d&o^y&o,j=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),W=(s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25),Q=p+W+C+b[R]+u[R],Z=j+_;p=i,i=f,f=s,s=c+Q|0,c=o,o=y,y=d,d=Q+Z|0}m[0]=m[0]+d|0,m[1]=m[1]+y|0,m[2]=m[2]+o|0,m[3]=m[3]+c|0,m[4]=m[4]+s|0,m[5]=m[5]+f|0,m[6]=m[6]+i|0,m[7]=m[7]+p|0},_doFinalize:function(){var w=this._data,T=w.words,m=this._nDataBytes*8,d=w.sigBytes*8;return T[d>>>5]|=128<<24-d%32,T[(d+64>>>9<<4)+14]=a.floor(m/4294967296),T[(d+64>>>9<<4)+15]=m,w.sigBytes=T.length*4,this._process(),this._hash},clone:function(){var w=P.clone.call(this);return w._hash=this._hash.clone(),w}});N.SHA256=P._createHelper(A),N.HmacSHA256=P._createHmacHelper(A)}(Math),g.SHA256})},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return g.enc.Utf8})},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(7)),I=g.__importDefault(r(3)),E=g.__importDefault(r(34)),P=g.__importDefault(r(9)),F=g.__importDefault(r(5)),S=g.__importDefault(r(18)),b=g.__importDefault(r(24)),u=g.__importDefault(r(0));function A(){}var w=9;function T(y){return a.arrEvery(y,function(o){return!o.id})}function m(y){var o=y||{};if(o.cipher){if(!u.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var c=u.default.Crypto.getCipher(o.cipher);o.cipher=c.cipherParams,o.channelCipher=c.cipher}else"cipher"in o&&(o.cipher=void 0,o.channelCipher=null);return o}var d=function(y){g.__extends(o,y);function o(c,s,f){var i=y.call(this)||this;return I.default.logAction(I.default.LOG_MINOR,"Channel()","started; name = "+s),i.rest=c,i.name=s,i.basePath="/channels/"+encodeURIComponent(s),i.presence=new E.default(i),i.channelOptions=m(f),i}return o.prototype.setOptions=function(c){this.channelOptions=m(c)},o.prototype.history=function(c,s){if(I.default.logAction(I.default.LOG_MICRO,"Channel.history()","channel = "+this.name),s===void 0)if(typeof c=="function")s=c,c=null;else{if(this.rest.options.promises)return a.promisify(this,"history",arguments);s=A}this._history(c,s)},o.prototype._history=function(c,s){var f=this.rest,i=f.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,p=this.rest.http.supportsLinkHeaders?void 0:i,R=a.defaultGetHeaders(i);f.options.headers&&a.mixin(R,f.options.headers);var L=this.channelOptions;new S.default(f,this.basePath+"/messages",R,p,function(z,H,D){return P.default.fromResponseBody(z,L,D?void 0:i)}).get(c,s)},o.prototype.publish=function(){var c=this,s=arguments.length,f=arguments[0],i=arguments[1],p=arguments[s-1],R,L;if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);p=A}if(typeof f=="string"||f===null)R=[P.default.fromValues({name:f,data:i})],L=arguments[2];else if(a.isObject(f))R=[P.default.fromValues(f)],L=arguments[1];else if(a.isArray(f))R=P.default.fromValuesArray(f),L=arguments[1];else throw new F.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var z=this.rest,H=z.options,D=H.useBinaryProtocol?a.Format.msgpack:a.Format.json,C=z.options.idempotentRestPublishing,_=a.defaultPostHeaders(D);if(H.headers&&a.mixin(_,H.headers),C&&T(R)){var j=a.randomString(w);a.arrForEach(R,function(W,Q){W.id=j+":"+Q.toString()})}P.default.encodeArray(R,this.channelOptions,function(W){if(W){p(W);return}var Q=P.default.getMessagesSize(R),Z=H.maxMessageSize;if(Q>Z){p(new F.default("Maximum size of messages that can be published at once exceeded ( was "+Q+" bytes; limit is "+Z+" bytes)",40009,400));return}c._publish(P.default.serialize(R,D),_,L,p)})},o.prototype._publish=function(c,s,f,i){b.default.post(this.rest,this.basePath+"/messages",c,s,f,null,i)},o.prototype.status=function(c){if(typeof c!="function"&&this.rest.options.promises)return a.promisify(this,"status",[]);var s=this.rest.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,f=a.defaultPostHeaders(s);b.default.get(this.rest,this.basePath,f,{},s,c||A)},o}(N.default);h.default=d},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(7)),I=g.__importDefault(r(3)),E=g.__importDefault(r(18)),P=g.__importDefault(r(14));function F(){}var S=function(b){g.__extends(u,b);function u(A){var w=b.call(this)||this;return w.channel=A,w.basePath=A.basePath+"/presence",w}return u.prototype.get=function(A,w){if(I.default.logAction(I.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),w===void 0)if(typeof A=="function")w=A,A=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"get",arguments);w=F}var T=this.channel.rest,m=T.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,d=this.channel.rest.http.supportsLinkHeaders?void 0:m,y=a.defaultGetHeaders(m);T.options.headers&&a.mixin(y,T.options.headers);var o=this.channel.channelOptions;new E.default(T,this.basePath,y,d,function(c,s,f){return P.default.fromResponseBody(c,o,f?void 0:m)}).get(A,w)},u.prototype.history=function(A,w){I.default.logAction(I.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(A,w)},u.prototype._history=function(A,w){if(w===void 0)if(typeof A=="function")w=A,A=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"_history",arguments);w=F}var T=this.channel.rest,m=T.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,d=this.channel.rest.http.supportsLinkHeaders?void 0:m,y=a.defaultGetHeaders(m);T.options.headers&&a.mixin(y,T.options.headers);var o=this.channel.channelOptions;new E.default(T,this.basePath+"/history",y,d,function(c,s,f){return P.default.fromResponseBody(c,o,f?void 0:m)}).get(A,w)},u}(N.default);h.default=S},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(7)),N=g.__importDefault(r(3)),I=function(E){g.__extends(P,E);function P(){var F=E.call(this)||this;return F.messages=[],F}return P.prototype.count=function(){return this.messages.length},P.prototype.push=function(F){this.messages.push(F)},P.prototype.shift=function(){return this.messages.shift()},P.prototype.last=function(){return this.messages[this.messages.length-1]},P.prototype.copyAll=function(){return this.messages.slice()},P.prototype.append=function(F){this.messages.push.apply(this.messages,F)},P.prototype.prepend=function(F){this.messages.unshift.apply(this.messages,F)},P.prototype.completeMessages=function(F,S,b){N.default.logAction(N.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+F+"; count = "+S),b=b||null;var u=this.messages;if(u.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var A=u[0];if(A){var w=A.message.msgSerial,T=F+S;if(T>w)for(var m=u.splice(0,T-w),d=0,y=m;d<y.length;d++){var o=y[d];o.callback(b)}u.length==0&&this.emit("idle")}},P.prototype.completeAllMessages=function(F){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,F)},P.prototype.clear=function(){N.default.logAction(N.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},P}(a.default);h.default=I},function(v,h,r){"use strict";h.__esModule=!0;var g=function(){function a(N,I,E,P){this.previous=N,this.current=I,E&&(this.retryIn=E),P&&(this.reason=P)}return a}();h.default=g},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(10)),N=g.__importDefault(r(7)),I=g.__importStar(r(2)),E=g.__importDefault(r(33)),P=g.__importDefault(r(3)),F=g.__importDefault(r(54)),S=g.__importDefault(r(9)),b=g.__importDefault(r(38)),u=g.__importDefault(r(5)),A=g.__importDefault(r(14)),w=g.__importDefault(r(19)),T=a.default.Action,m=function(){},d="statechange",y="sync";function o(s){if(s&&"params"in s&&!I.isObject(s.params))return new u.default("options.params must be an object",4e4,400);if(s&&"modes"in s){if(!I.isArray(s.modes))return new u.default("options.modes must be an array",4e4,400);for(var f=0;f<s.modes.length;f++){var i=s.modes[f];if(!i||typeof i!="string"||!I.arrIn(a.default.channelModes,String.prototype.toUpperCase.call(i)))return new u.default("Invalid channel mode: "+i,4e4,400)}}}var c=function(s){g.__extends(f,s);function f(i,p,R){var L=s.call(this,i,p,R)||this;return L.retryCount=0,L.history=function(z,H){if(P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof z=="function")H=z,z=null;else{if(this.rest.options.promises)return I.promisify(this,"history",arguments);H=m}if(z&&z.untilAttach){if(this.state!=="attached"){H(new u.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new u.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete z.untilAttach,z.from_serial=this.properties.attachSerial}E.default.prototype._history.call(this,z,H)},L.whenState=function(z,H){return N.default.prototype.whenState.call(L,z,L.state,H)},P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),L.realtime=i,L.presence=new F.default(L),L.connectionManager=i.connection.connectionManager,L.state="initialized",L.subscriptions=new N.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(R),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:i.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new N.default,L}return f.invalidStateError=function(i){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+i}},f.processListenerArgs=function(i){return i=Array.prototype.slice.call(i),typeof i[0]=="function"&&i.unshift(null),i[i.length-1]==null&&i.pop(),i},f.prototype.setOptions=function(i,p){if(!p&&this.rest.options.promises)return I.promisify(this,"setOptions",arguments);var R=p||function(z){z&&P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+z.toString())},L=o(i);if(L){R(L);return}E.default.prototype.setOptions.call(this,i),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(i)?(this.attachImpl(),this._allChannelChanges.once(function(z){switch(this.event){case"update":case"attached":R==null||R(null);return;default:R==null||R(z.reason);return}})):R()},f.prototype._shouldReattachToSetOptions=function(i){return(this.state==="attached"||this.state==="attaching")&&(i.params||i.modes)},f.prototype.publish=function(){for(var i=this,p=[],R=0;R<arguments.length;R++)p[R]=arguments[R];var L=p[0],z=p.length,H=p[z-1];if(typeof H!="function"){if(this.realtime.options.promises)return I.promisify(this,"publish",arguments);H=m,++z}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(z==2)if(I.isObject(L))L=[S.default.fromValues(L)];else if(I.isArray(L))L=S.default.fromValuesArray(L);else throw new u.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[S.default.fromValues({name:p[0],data:p[1]})];var D=this.realtime.options.maxMessageSize;S.default.encodeArray(L,this.channelOptions,function(C){if(C){H(C);return}var _=S.default.getMessagesSize(L);if(_>D){H(new u.default("Maximum size of messages that can be published at once exceeded ( was "+_+" bytes; limit is "+D+" bytes)",40009,400));return}i.__publish(L,H)})},f.prototype.__publish=function(i,p){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+i.length);var R=this.state;switch(R){case"failed":case"suspended":p(u.default.fromValues(f.invalidStateError(R)));break;default:{P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+R);var L=new a.default;L.action=T.MESSAGE,L.channel=this.name,L.messages=i,this.sendMessage(L,p);break}}},f.prototype.onEvent=function(i){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,R=0;R<i.length;R++){var L=i[R];p.emit(L.name,L)}},f.prototype.attach=function(i,p){var R;if(typeof i=="function"?(p=i,R=null):R=i,!p){if(this.realtime.options.promises)return I.promisify(this,"attach",arguments);p=function(L){L&&P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(R)P.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=R;else if(this.state==="attached"){p();return}this._attach(!1,null,p)},f.prototype._attach=function(i,p,R){R||(R=function(z){z&&P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+z.toString())});var L=this.connectionManager;if(!L.activeState()){R(L.getError());return}(this.state!=="attaching"||i)&&this.requestState("attaching",p),this.once(function(z){switch(this.event){case"attached":R==null||R();break;case"detached":case"suspended":case"failed":R==null||R(z.reason||L.getError()||new u.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":R==null||R(new u.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},f.prototype.attachImpl=function(){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(d,!0);var i=a.default.fromValues({action:T.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?i.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&i.encodeModesToFlags(I.allToUpperCase(this.channelOptions.modes)),this._attachResume&&i.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(i.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(i,m)},f.prototype.detach=function(i){if(!i){if(this.realtime.options.promises)return I.promisify(this,"detach",arguments);i=m}var p=this.connectionManager;if(!p.activeState()){i(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),i();break;case"detached":i();break;case"failed":i(new u.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(R){switch(this.event){case"detached":i();break;case"attached":case"suspended":case"failed":i(R.reason||p.getError()||new u.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":i(new u.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},f.prototype.detachImpl=function(i){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(d,!0);var p=a.default.fromValues({action:T.DETACH,channel:this.name});this.sendMessage(p,i||m)},f.prototype.subscribe=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];var R=f.processListenerArgs(i),L=R[0],z=R[1],H=R[2];if(!H&&this.realtime.options.promises)return I.promisify(this,"subscribe",[L,z]);if(this.state==="failed"){H==null||H(u.default.fromValues(f.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,z):this.subscriptions.on(L,z),this.attach(H||m)},f.prototype._subscribeFilter=function(i,p){var R=function(L){var z,H,D,C,_,j,W={name:L.name,refTimeserial:(H=(z=L.extras)===null||z===void 0?void 0:z.ref)===null||H===void 0?void 0:H.timeserial,refType:(C=(D=L.extras)===null||D===void 0?void 0:D.ref)===null||C===void 0?void 0:C.type,isRef:!!(!((j=(_=L.extras)===null||_===void 0?void 0:_.ref)===null||j===void 0)&&j.timeserial),clientId:L.clientId};Object.entries(i).find(function(Q){var Z=Q[0],q=Q[1];return q!==void 0?W[Z]!==q:!1})||p(L)};this._addFilteredSubscription(i,p,R),this.subscriptions.on(R)},f.prototype._addFilteredSubscription=function(i,p,R){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var z=this.filteredSubscriptions.get(p);z.set(i,((L=z==null?void 0:z.get(i))===null||L===void 0?void 0:L.concat(R))||[R])}else this.filteredSubscriptions.set(p,new Map([[i,[R]]]))},f.prototype._getAndDeleteFilteredSubscriptions=function(i,p){var R=this;if(!this.filteredSubscriptions)return[];if(!p&&i)return Array.from(this.filteredSubscriptions.entries()).map(function(D){var C,_=D[0],j=D[1],W=j.get(i);return j.delete(i),j.size===0&&((C=R.filteredSubscriptions)===null||C===void 0||C.delete(_)),W}).reduce(function(D,C){var _;return C?(_=D).concat.apply(_,C):D},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var L=this.filteredSubscriptions.get(p);if(!i){var z=Array.from(L.values()).reduce(function(D,C){return D.concat.apply(D,C)},[]);return this.filteredSubscriptions.delete(p),z}var H=L.get(i);return L.delete(i),H||[]},f.prototype.unsubscribe=function(){for(var i=this,p,R=[],L=0;L<arguments.length;L++)R[L]=arguments[L];var z=f.processListenerArgs(R),H=z[0],D=z[1];if(typeof H=="object"&&!D||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(D))){this._getAndDeleteFilteredSubscriptions(H,D).forEach(function(C){return i.subscriptions.off(C)});return}this.subscriptions.off(H,D)},f.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new u.default("Unable to sync to channel; not attached",4e4);default:}var i=this.connectionManager;if(!i.activeState())throw i.getError();var p=a.default.fromValues({action:T.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),i.send(p)},f.prototype.sendMessage=function(i,p){this.connectionManager.send(i,this.realtime.options.queueMessages,p)},f.prototype.sendPresence=function(i,p){var R=a.default.fromValues({action:T.PRESENCE,channel:this.name,presence:I.isArray(i)?A.default.fromValuesArray(i):[A.default.fromValues(i)]});this.sendMessage(R,p)},f.prototype.onMessage=function(i){var p,R=!1;switch(i.action){case T.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=i.channelSerial,this._mode=i.getMode(),this.params=i.params||{};var L=i.decodeModesFromFlags();this.modes=L&&I.allToLowerCase(L)||void 0;var z=i.hasFlag("RESUMED"),H=i.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(d,!1),z||this.presence.onAttached(H);var D=new b.default(this.state,this.state,z,i.error);this._allChannelChanges.emit("update",D),(!z||this.channelOptions.updateOnAttached)&&this.emit("update",D)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",i.error,z,H);break}case T.DETACHED:{var C=i.error?u.default.fromValues(i.error):new u.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",C):this.state==="attaching"?this.notifyState("suspended",C):this.requestState("attaching",C);break}case T.SYNC:if(R=!0,p=this.syncChannelSerial=i.channelSerial,!i.presence)break;case T.PRESENCE:{for(var _=i.presence,j=i.id,W=i.connectionId,Q=i.timestamp,Z=this.channelOptions,q=void 0,G=0;G<_.length;G++)try{q=_[G],A.default.decode(q,Z),q.connectionId||(q.connectionId=W),q.timestamp||(q.timestamp=Q),q.id||(q.id=j+":"+G)}catch(ut){P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",ut.toString())}this.presence.setPresence(_,R,p);break}case T.MESSAGE:{if(this.state!=="attached"){P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+i.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var M=i.messages,U=M[0],K=M[M.length-1],j=i.id,W=i.connectionId,Q=i.timestamp;if(U.extras&&U.extras.delta&&U.extras.delta.from!==this._lastPayload.messageId){var k='Delta message decode failure - previous message not available for message "'+i.id+'" on this channel "'+this.name+'".';P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",k),this._startDecodeFailureRecovery(new u.default(k,40018,400));break}for(var G=0;G<M.length;G++){var k=M[G];try{S.default.decode(k,this._decodingContext)}catch(lt){switch(P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",lt.toString()),lt.code){case 40018:this._startDecodeFailureRecovery(lt);return;case 40019:case 40021:this.notifyState("failed",lt);return}}k.connectionId||(k.connectionId=W),k.timestamp||(k.timestamp=Q),k.id||(k.id=j+":"+G)}this._lastPayload.messageId=K.id,this._lastPayload.protocolMessageChannelSerial=i.channelSerial,this.onEvent(M);break}case T.ERROR:{var tt=i.error;tt&&tt.code==80016?this.checkPendingState():this.notifyState("failed",u.default.fromValues(tt));break}default:P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+i.action+")"),this.connectionManager.abort(w.default.unknownChannelErr)}},f.prototype._startDecodeFailureRecovery=function(i){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,i,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},f.prototype.onAttached=function(){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},f.prototype.notifyState=function(i,p,R,L){if(P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+i),this.clearStateTimer(),i!==this.state){this.presence.actOnChannelState(i,L,p),i==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var z=new b.default(this.state,i,R,p),H=i==="failed"?P.default.LOG_ERROR:P.default.LOG_MAJOR;P.default.logAction(H,'Channel state for channel "'+this.name+'"',i+(p?"; reason: "+p:"")),i!=="attaching"&&i!=="suspended"&&(this.retryCount=0),i==="attached"?(this.onAttached(),this.setInProgress(y,L),this.setInProgress(d,!1)):(i==="detached"||i==="failed"||i==="suspended")&&(this.setInProgress(d,!1),this.setInProgress(y,!1)),i==="attached"?this._attachResume=!0:(i==="detaching"||i==="failed")&&(this._attachResume=!1),this.state=i,this._allChannelChanges.emit(i,z),this.emit(i,z)}},f.prototype.requestState=function(i,p){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+i),this.notifyState(i,p),this.checkPendingState()},f.prototype.checkPendingState=function(){var i=this.connectionManager.state;if(!(i.sendEvents||i.forceQueueEvents)){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},f.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var i=new u.default("Channel attach timed out",90007,408);this.notifyState("suspended",i);break}case"detaching":{var i=new u.default("Channel detach timed out",90007,408);this.notifyState("attached",i);break}default:this.checkPendingState();break}},f.prototype.startStateTimerIfNotRunning=function(){var i=this;this.stateTimer||(this.stateTimer=setTimeout(function(){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),i.stateTimer=null,i.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},f.prototype.clearStateTimer=function(){var i=this.stateTimer;i&&(clearTimeout(i),this.stateTimer=null)},f.prototype.startRetryTimer=function(){var i=this;if(!this.retryTimer){this.retryCount++;var p=this.realtime.options.timeouts.channelRetryTimeout*I.getJitterCoefficient()*I.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){i.state==="suspended"&&i.connectionManager.state.sendEvents&&(i.retryTimer=null,P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),i.requestState("attaching"))},p)}},f.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},f.prototype.setInProgress=function(i,p){this.rest.channels.setInProgress(this,i,p)},f.prototype.getReleaseErr=function(){var i=this.state;return i==="initialized"||i==="detached"||i==="failed"?null:new u.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+i,90001,400)},f.progressOps={statechange:d,sync:y},f}(E.default);h.default=c},function(v,h,r){"use strict";h.__esModule=!0;var g=function(){function a(N,I,E,P){this.previous=N,this.current=I,I==="attached"&&(this.resumed=E),P&&(this.reason=P)}return a}();h.default=g},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(){var a=g,N=a.lib,I=N.WordArray,E=N.Hasher,P=a.algo,F=[],S=P.SHA1=E.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(b,u){for(var A=this._hash.words,w=A[0],T=A[1],m=A[2],d=A[3],y=A[4],o=0;o<80;o++){if(o<16)F[o]=b[u+o]|0;else{var c=F[o-3]^F[o-8]^F[o-14]^F[o-16];F[o]=c<<1|c>>>31}var s=(w<<5|w>>>27)+y+F[o];o<20?s+=(T&m|~T&d)+1518500249:o<40?s+=(T^m^d)+1859775393:o<60?s+=(T&m|T&d|m&d)-1894007588:s+=(T^m^d)-899497514,y=d,d=m,m=T<<30|T>>>2,T=w,w=s}A[0]=A[0]+w|0,A[1]=A[1]+T|0,A[2]=A[2]+m|0,A[3]=A[3]+d|0,A[4]=A[4]+y|0},_doFinalize:function(){var b=this._data,u=b.words,A=this._nDataBytes*8,w=b.sigBytes*8;return u[w>>>5]|=128<<24-w%32,u[(w+64>>>9<<4)+14]=Math.floor(A/4294967296),u[(w+64>>>9<<4)+15]=A,b.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var b=E.clone.call(this);return b._hash=this._hash.clone(),b}});a.SHA1=E._createHelper(S),a.HmacSHA1=E._createHmacHelper(S)}(),g.SHA1})},function(v,h,r){"use strict";h.__esModule=!0;function g(o){if(o===void 0)return"undefined";var c,s;if(o instanceof ArrayBuffer?(s="ArrayBuffer",c=new DataView(o)):o instanceof DataView&&(s="DataView",c=o),!c)return JSON.stringify(o);for(var f=[],i=0;i<o.byteLength;i++){if(i>20){f.push("...");break}var p=c.getUint8(i).toString(16);p.length===1&&(p="0"+p),f.push(p)}return"<"+s+" "+f.join(" ")+">"}function a(o,c,s){for(var f=0,i=s.length;f<i;f++){var p=s.charCodeAt(f);if(p<128){o.setUint8(c++,p>>>0&127|0);continue}if(p<2048){o.setUint8(c++,p>>>6&31|192),o.setUint8(c++,p>>>0&63|128);continue}if(p<65536){o.setUint8(c++,p>>>12&15|224),o.setUint8(c++,p>>>6&63|128),o.setUint8(c++,p>>>0&63|128);continue}if(p<1114112){o.setUint8(c++,p>>>18&7|240),o.setUint8(c++,p>>>12&63|128),o.setUint8(c++,p>>>6&63|128),o.setUint8(c++,p>>>0&63|128);continue}throw new Error("bad codepoint "+p)}}function N(o,c,s){for(var f="",i=c,p=c+s;i<p;i++){var R=o.getUint8(i);if((R&128)===0){f+=String.fromCharCode(R);continue}if((R&224)===192){f+=String.fromCharCode((R&15)<<6|o.getUint8(++i)&63);continue}if((R&240)===224){f+=String.fromCharCode((R&15)<<12|(o.getUint8(++i)&63)<<6|(o.getUint8(++i)&63)<<0);continue}if((R&248)===240){f+=String.fromCharCode((R&7)<<18|(o.getUint8(++i)&63)<<12|(o.getUint8(++i)&63)<<6|(o.getUint8(++i)&63)<<0);continue}throw new Error("Invalid byte "+R.toString(16))}return f}function I(o){for(var c=0,s=0,f=o.length;s<f;s++){var i=o.charCodeAt(s);if(i<128){c+=1;continue}if(i<2048){c+=2;continue}if(i<65536){c+=3;continue}if(i<1114112){c+=4;continue}throw new Error("bad codepoint "+i)}return c}function E(o,c){var s=y(o,c);if(s!==0){var f=new ArrayBuffer(s),i=new DataView(f);return d(o,i,0,c),f}}var P=(1<<16)*(1<<16),F=1/P;function S(o,c){return c=c||0,o.getInt32(c)*P+o.getUint32(c+4)}function b(o,c){return c=c||0,o.getUint32(c)*P+o.getUint32(c+4)}function u(o,c,s){s<9223372036854776e3?(o.setInt32(c,Math.floor(s*F)),o.setInt32(c+4,s&-1)):(o.setUint32(c,2147483647),o.setUint32(c+4,2147483647))}function A(o,c,s){s<18446744073709552e3?(o.setUint32(c,Math.floor(s*F)),o.setInt32(c+4,s&-1)):(o.setUint32(c,4294967295),o.setUint32(c+4,4294967295))}var w=function(){function o(c,s){var f=this;this.map=function(i){for(var p={},R=0;R<i;R++){var L=f.parse();p[L]=f.parse()}return p},this.bin=function(i){var p=new ArrayBuffer(i);return new Uint8Array(p).set(new Uint8Array(f.view.buffer,f.offset,i),0),f.offset+=i,p},this.buf=this.bin,this.str=function(i){var p=N(f.view,f.offset,i);return f.offset+=i,p},this.array=function(i){for(var p=new Array(i),R=0;R<i;R++)p[R]=f.parse();return p},this.ext=function(i){return f.offset+=i,{type:f.view.getInt8(f.offset),data:f.buf(i)}},this.parse=function(){var i=f.view.getUint8(f.offset),p,R;if((i&128)===0)return f.offset++,i;if((i&240)===128)return R=i&15,f.offset++,f.map(R);if((i&240)===144)return R=i&15,f.offset++,f.array(R);if((i&224)===160)return R=i&31,f.offset++,f.str(R);if((i&224)===224)return p=f.view.getInt8(f.offset),f.offset++,p;switch(i){case 192:return f.offset++,null;case 193:f.offset++;return;case 194:return f.offset++,!1;case 195:return f.offset++,!0;case 196:return R=f.view.getUint8(f.offset+1),f.offset+=2,f.bin(R);case 197:return R=f.view.getUint16(f.offset+1),f.offset+=3,f.bin(R);case 198:return R=f.view.getUint32(f.offset+1),f.offset+=5,f.bin(R);case 199:return R=f.view.getUint8(f.offset+1),f.offset+=2,f.ext(R);case 200:return R=f.view.getUint16(f.offset+1),f.offset+=3,f.ext(R);case 201:return R=f.view.getUint32(f.offset+1),f.offset+=5,f.ext(R);case 202:return p=f.view.getFloat32(f.offset+1),f.offset+=5,p;case 203:return p=f.view.getFloat64(f.offset+1),f.offset+=9,p;case 204:return p=f.view.getUint8(f.offset+1),f.offset+=2,p;case 205:return p=f.view.getUint16(f.offset+1),f.offset+=3,p;case 206:return p=f.view.getUint32(f.offset+1),f.offset+=5,p;case 207:return p=b(f.view,f.offset+1),f.offset+=9,p;case 208:return p=f.view.getInt8(f.offset+1),f.offset+=2,p;case 209:return p=f.view.getInt16(f.offset+1),f.offset+=3,p;case 210:return p=f.view.getInt32(f.offset+1),f.offset+=5,p;case 211:return p=S(f.view,f.offset+1),f.offset+=9,p;case 212:return R=1,f.offset++,f.ext(R);case 213:return R=2,f.offset++,f.ext(R);case 214:return R=4,f.offset++,f.ext(R);case 215:return R=8,f.offset++,f.ext(R);case 216:return R=16,f.offset++,f.ext(R);case 217:return R=f.view.getUint8(f.offset+1),f.offset+=2,f.str(R);case 218:return R=f.view.getUint16(f.offset+1),f.offset+=3,f.str(R);case 219:return R=f.view.getUint32(f.offset+1),f.offset+=5,f.str(R);case 220:return R=f.view.getUint16(f.offset+1),f.offset+=3,f.array(R);case 221:return R=f.view.getUint32(f.offset+1),f.offset+=5,f.array(R);case 222:return R=f.view.getUint16(f.offset+1),f.offset+=3,f.map(R);case 223:return R=f.view.getUint32(f.offset+1),f.offset+=5,f.map(R)}throw new Error("Unknown type 0x"+i.toString(16))},this.offset=s||0,this.view=c}return o}();function T(o){var c=new DataView(o),s=new w(c),f=s.parse();if(s.offset!==o.byteLength)throw new Error(o.byteLength-s.offset+" trailing bytes");return f}function m(o,c){return Object.keys(o).filter(function(s){var f=o[s],i=typeof f;return(!c||f!=null)&&(i!=="function"||!!f.toJSON)})}function d(o,c,s,f){var i=typeof o;if(typeof o=="string"){var p=I(o);if(p<32)return c.setUint8(s,p|160),a(c,s+1,o),1+p;if(p<256)return c.setUint8(s,217),c.setUint8(s+1,p),a(c,s+2,o),2+p;if(p<65536)return c.setUint8(s,218),c.setUint16(s+1,p),a(c,s+3,o),3+p;if(p<4294967296)return c.setUint8(s,219),c.setUint32(s+1,p),a(c,s+5,o),5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var R=o.byteLength;if(R<256)return c.setUint8(s,196),c.setUint8(s+1,R),new Uint8Array(c.buffer).set(new Uint8Array(o),s+2),2+R;if(R<65536)return c.setUint8(s,197),c.setUint16(s+1,R),new Uint8Array(c.buffer).set(new Uint8Array(o),s+3),3+R;if(R<4294967296)return c.setUint8(s,198),c.setUint32(s+1,R),new Uint8Array(c.buffer).set(new Uint8Array(o),s+5),5+R}if(typeof o=="number"){if(Math.floor(o)!==o)return c.setUint8(s,203),c.setFloat64(s+1,o),9;if(o>=0){if(o<128)return c.setUint8(s,o),1;if(o<256)return c.setUint8(s,204),c.setUint8(s+1,o),2;if(o<65536)return c.setUint8(s,205),c.setUint16(s+1,o),3;if(o<4294967296)return c.setUint8(s,206),c.setUint32(s+1,o),5;if(o<18446744073709552e3)return c.setUint8(s,207),A(c,s+1,o),9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return c.setInt8(s,o),1;if(o>=-128)return c.setUint8(s,208),c.setInt8(s+1,o),2;if(o>=-32768)return c.setUint8(s,209),c.setInt16(s+1,o),3;if(o>=-2147483648)return c.setUint8(s,210),c.setInt32(s+1,o),5;if(o>=-9223372036854776e3)return c.setUint8(s,211),u(c,s+1,o),9;throw new Error("Number too small -0x"+(-o).toString(16).substr(1))}if(i==="undefined")return f?0:(c.setUint8(s,212),c.setUint8(s+1,0),c.setUint8(s+2,0),3);if(o===null)return f?0:(c.setUint8(s,192),1);if(i==="boolean")return c.setUint8(s,o?195:194),1;if(typeof o.toJSON=="function")return d(o.toJSON(),c,s,f);if(i==="object"){var L,z=0,H=void 0,D=Array.isArray(o);if(D?L=o.length:(H=m(o,f),L=H.length),L<16?(c.setUint8(s,L|(D?144:128)),z=1):L<65536?(c.setUint8(s,D?220:222),c.setUint16(s+1,L),z=3):L<4294967296&&(c.setUint8(s,D?221:223),c.setUint32(s+1,L),z=5),D)for(var C=0;C<L;C++)z+=d(o[C],c,s+z,f);else if(H)for(var C=0;C<L;C++){var _=H[C];z+=d(_,c,s+z),z+=d(o[_],c,s+z,f)}return z}if(i==="function")return 0;throw new Error("Unknown type "+i)}function y(o,c){var s=typeof o;if(s==="string"){var f=I(o);if(f<32)return 1+f;if(f<256)return 2+f;if(f<65536)return 3+f;if(f<4294967296)return 5+f}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var i=o.byteLength;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(typeof o=="number"){if(Math.floor(o)!==o)return 9;if(o>=0){if(o<128)return 1;if(o<256)return 2;if(o<65536)return 3;if(o<4294967296)return 5;if(o<18446744073709552e3)return 9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return 1;if(o>=-128)return 2;if(o>=-32768)return 3;if(o>=-2147483648)return 5;if(o>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+o.toString(16).substr(1))}if(s==="boolean")return 1;if(o===null)return c?0:1;if(o===void 0)return c?0:3;if(typeof o.toJSON=="function")return y(o.toJSON(),c);if(s==="object"){var p,R=0;if(Array.isArray(o)){p=o.length;for(var L=0;L<p;L++)R+=y(o[L],c)}else{var z=m(o,c);p=z.length;for(var L=0;L<p;L++){var H=z[L];R+=y(H)+y(o[H],c)}}if(p<16)return 1+R;if(p<65536)return 3+R;if(p<4294967296)return 5+R;throw new Error("Array or object too long 0x"+p.toString(16))}if(s==="function")return 0;throw new Error("Unknown type "+s)}h.default={encode:E,decode:T,inspect:g,utf8Write:a,utf8Read:N,utf8ByteCount:I}},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(30)),N=g.__importDefault(r(49)),I=g.__importDefault(r(0)),E=g.__importDefault(r(55)),P=g.__importDefault(r(57)),F=g.__importDefault(r(62)),S=g.__importDefault(r(63)),b=g.__importDefault(r(67)),u=g.__importDefault(r(3)),A=r(8),w=g.__importDefault(r(25)),T=g.__importDefault(r(64)),m=g.__importDefault(r(65)),d=g.__importDefault(r(40)),y=g.__importDefault(r(9)),o=g.__importDefault(r(14));I.default.Crypto=P.default,I.default.BufferUtils=E.default,I.default.Http=F.default,I.default.Config=S.default,I.default.Transports=b.default,I.default.WebStorage=T.default,a.default.Crypto=P.default,N.default.Crypto=P.default,a.default.Message=y.default,N.default.Message=y.default,a.default.PresenceMessage=o.default,N.default.PresenceMessage=o.default,N.default.ConnectionManager=w.default,u.default.initLogHandlers(),I.default.Defaults=A.getDefaults(m.default),I.default.Config.agent&&(I.default.Defaults.agent+=" "+I.default.Config.agent),I.default.Config.noUpgrade&&(I.default.Defaults.upgradeTransports=[]),h.default={Rest:a.default,Realtime:N.default,msgpack:d.default}},function(v){v.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(31),r(23))})(this,function(g){return g.HmacSHA256})},function(v,h){},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(46)),I=g.__importDefault(r(24)),E=g.__importDefault(r(18)),P=g.__importDefault(r(5)),F=g.__importDefault(r(47)),S=function(){},b=function(){function T(m){this.rest=m,this.admin=new u(m)}return T}(),u=function(){function T(m){this.rest=m,this.deviceRegistrations=new A(m),this.channelSubscriptions=new w(m)}return T.prototype.publish=function(m,d,y){var o=this.rest,c=o.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(c),f={},i=a.mixin({recipient:m},d);if(typeof y!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);y=S}o.options.headers&&a.mixin(s,o.options.headers),o.options.pushFullWait&&a.mixin(f,{fullWait:"true"});var p=a.encodeBody(i,c);I.default.post(o,"/push/publish",p,s,f,null,function(R){return y(R)})},T}(),A=function(){function T(m){this.rest=m}return T.prototype.save=function(m,d){var y=this.rest,o=N.default.fromValues(m),c=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(c),f={};if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);d=S}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(f,{fullWait:"true"});var i=a.encodeBody(o,c);I.default.put(y,"/push/deviceRegistrations/"+encodeURIComponent(m.id),i,s,f,null,function(p,R,L,z){d(p,p?void 0:N.default.fromResponseBody(R,z?void 0:c))})},T.prototype.get=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=a.defaultGetHeaders(o),s=m.id||m;if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"get",arguments);d=S}if(typeof s!="string"||!s.length){d(new P.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}y.options.headers&&a.mixin(c,y.options.headers),I.default.get(y,"/push/deviceRegistrations/"+encodeURIComponent(s),c,{},null,function(f,i,p,R){d(f,f?void 0:N.default.fromResponseBody(i,R?void 0:o))})},T.prototype.list=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);d=S}y.options.headers&&a.mixin(s,y.options.headers),new E.default(y,"/push/deviceRegistrations",s,c,function(f,i,p){return N.default.fromResponseBody(f,p?void 0:o)}).get(m,d)},T.prototype.remove=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=a.defaultGetHeaders(o),s={},f=m.id||m;if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"remove",arguments);d=S}if(typeof f!="string"||!f.length){d(new P.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}y.options.headers&&a.mixin(c,y.options.headers),y.options.pushFullWait&&a.mixin(s,{fullWait:"true"}),I.default.delete(y,"/push/deviceRegistrations/"+encodeURIComponent(f),c,s,null,function(i){return d(i)})},T.prototype.removeWhere=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=a.defaultGetHeaders(o);if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);d=S}y.options.headers&&a.mixin(c,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),I.default.delete(y,"/push/deviceRegistrations",c,m,null,function(s){return d(s)})},T}(),w=function(){function T(m){this.remove=T.prototype.removeWhere,this.rest=m}return T.prototype.save=function(m,d){var y=this.rest,o=F.default.fromValues(m),c=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(c),f={};if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);d=S}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(f,{fullWait:"true"});var i=a.encodeBody(o,c);I.default.post(y,"/push/channelSubscriptions",i,s,f,null,function(p,R,L,z){d(p,!p&&F.default.fromResponseBody(R,z?void 0:c))})},T.prototype.list=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);d=S}y.options.headers&&a.mixin(s,y.options.headers),new E.default(y,"/push/channelSubscriptions",s,c,function(f,i,p){return F.default.fromResponseBody(f,p?void 0:o)}).get(m,d)},T.prototype.removeWhere=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=a.defaultGetHeaders(o);if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);d=S}y.options.headers&&a.mixin(c,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),I.default.delete(y,"/push/channelSubscriptions",c,m,null,function(s){return d(s)})},T.prototype.listChannels=function(m,d){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof d!="function"){if(this.rest.options.promises)return a.promisify(this,"listChannels",arguments);d=S}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),new E.default(y,"/push/channels",s,c,function(f,i,p){for(var R=!p&&o?a.decodeBody(f,o):f,L=0;L<R.length;L++)R[L]=String(R[L]);return R}).get(m,d)},T}();h.default=b},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(5)),I;(function(F){F.Phone="phone",F.Tablet="tablet",F.Desktop="desktop",F.TV="tv",F.Watch="watch",F.Car="car",F.Embedded="embedded",F.Other="other"})(I||(I={}));var E;(function(F){F.Android="android",F.IOS="ios",F.Browser="browser"})(E||(E={}));var P=function(){function F(){}return F.prototype.toJSON=function(){var S,b,u;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(S=this.push)===null||S===void 0?void 0:S.recipient,state:(b=this.push)===null||b===void 0?void 0:b.state,error:(u=this.push)===null||u===void 0?void 0:u.error}}},F.prototype.toString=function(){var S,b,u,A,w="[DeviceDetails";return this.id&&(w+="; id="+this.id),this.platform&&(w+="; platform="+this.platform),this.formFactor&&(w+="; formFactor="+this.formFactor),this.clientId&&(w+="; clientId="+this.clientId),this.metadata&&(w+="; metadata="+this.metadata),this.deviceIdentityToken&&(w+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((S=this.push)===null||S===void 0)&&S.recipient&&(w+="; push.recipient="+JSON.stringify(this.push.recipient)),!((b=this.push)===null||b===void 0)&&b.state&&(w+="; push.state="+this.push.state),!((u=this.push)===null||u===void 0)&&u.error&&(w+="; push.error="+JSON.stringify(this.push.error)),!((A=this.push)===null||A===void 0)&&A.metadata&&(w+="; push.metadata="+this.push.metadata),w+="]",w},F.fromResponseBody=function(S,b){return b&&(S=a.decodeBody(S,b)),a.isArray(S)?F.fromValuesArray(S):F.fromValues(S)},F.fromValues=function(S){return S.error=S.error&&N.default.fromValues(S.error),Object.assign(new F,S)},F.fromValuesArray=function(S){for(var b=S.length,u=new Array(b),A=0;A<b;A++)u[A]=F.fromValues(S[A]);return u},F.toRequestBody=a.encodeBody,F}();h.default=P},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=function(){function I(){}return I.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},I.prototype.toString=function(){var E="[PushChannelSubscription";return this.channel&&(E+="; channel="+this.channel),this.deviceId&&(E+="; deviceId="+this.deviceId),this.clientId&&(E+="; clientId="+this.clientId),E+="]",E},I.fromResponseBody=function(E,P){return P&&(E=a.decodeBody(E,P)),a.isArray(E)?I.fromValuesArray(E):I.fromValues(E)},I.fromValues=function(E){return Object.assign(new I,E)},I.fromValuesArray=function(E){for(var P=E.length,F=new Array(P),S=0;S<P;S++)F[S]=I.fromValues(E[S]);return F},I.toRequestBody=a.encodeBody,I}();h.default=N},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=function(){function y(o){this.count=o&&o.count||0,this.data=o&&o.data||0,this.uncompressedData=o&&o.uncompressedData||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return y}(),I=function(y){g.__extends(o,y);function o(c){var s=y.call(this,c)||this;return c&&c.category&&(s.category={},a.forInOwnNonNullProperties(c.category,function(f){s.category[f]=new N(c.category[f])})),s}return o}(N),E=function(){function y(o){this.peak=o&&o.peak||0,this.min=o&&o.min||0,this.mean=o&&o.mean||0,this.opened=o&&o.opened||0,this.refused=o&&o.refused||0}return y}(),P=function(){function y(o){this.succeeded=o&&o.succeeded||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return y}(),F=function(){function y(o){this.plain=new E(o&&o.plain),this.tls=new E(o&&o.tls),this.all=new E(o&&o.all)}return y}(),S=function(){function y(o){this.messages=new I(o&&o.messages),this.presence=new I(o&&o.presence),this.all=new I(o&&o.all)}return y}(),b=function(){function y(o){this.realtime=new S(o&&o.realtime),this.rest=new S(o&&o.rest),this.webhook=new S(o&&o.webhook),this.sharedQueue=new S(o&&o.sharedQueue),this.externalQueue=new S(o&&o.externalQueue),this.httpEvent=new S(o&&o.httpEvent),this.push=new S(o&&o.push),this.all=new S(o&&o.all)}return y}(),u=function(){function y(o){this.all=new S(o&&o.all),this.inbound=new b(o&&o.inbound),this.outbound=new b(o&&o.outbound)}return y}(),A=function(){function y(o){this.all=new S(o&&o.all),this.producerPaid=new u(o&&o.producerPaid),this.consumerPaid=new u(o&&o.consumerPaid)}return y}(),w=function(){function y(o){this.messages=o&&o.messages||0;var c=o&&o.notifications;this.notifications={invalid:c&&c.invalid||0,attempted:c&&c.attempted||0,successful:c&&c.successful||0,failed:c&&c.failed||0},this.directPublishes=o&&o.directPublishes||0}return y}(),T=function(){function y(o){this.succeeded=o&&o.succeeded||0,this.skipped=o&&o.skipped||0,this.failed=o&&o.failed||0}return y}(),m=function(){function y(o){var c=this;this.delta=void 0,o&&o.delta&&(this.delta={},a.forInOwnNonNullProperties(o.delta,function(s){c.delta[s]=new T(o.delta[s])}))}return y}(),d=function(y){g.__extends(o,y);function o(c){var s=y.call(this,c)||this;return s.persisted=new S(c&&c.persisted),s.connections=new F(c&&c.connections),s.channels=new E(c&&c.channels),s.apiRequests=new P(c&&c.apiRequests),s.tokenRequests=new P(c&&c.tokenRequests),s.xchgProducer=new A(c&&c.xchgProducer),s.xchgConsumer=new A(c&&c.xchgConsumer),s.push=new w(c&&c.pushStats),s.processed=new m(c&&c.processed),s.inProgress=c&&c.inProgress||void 0,s.unit=c&&c.unit||void 0,s.intervalId=c&&c.intervalId||void 0,s}return o.fromValues=function(c){return new o(c)},o}(u);h.default=d},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(30)),I=g.__importDefault(r(7)),E=g.__importDefault(r(3)),P=g.__importDefault(r(50)),F=g.__importDefault(r(37)),S=g.__importDefault(r(8)),b=g.__importDefault(r(5)),u=g.__importDefault(r(10)),A=g.__importDefault(r(25)),w=g.__importDefault(r(0)),T=g.__importDefault(r(9)),m=function(y){g.__extends(o,y);function o(c){var s=y.call(this,c)||this;return E.default.logAction(E.default.LOG_MINOR,"Realtime()",""),s.connection=new P.default(s,s.options),s.channels=new d(s),c.autoConnect!==!1&&s.connect(),s}return o.prototype.connect=function(){E.default.logAction(E.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},o.prototype.close=function(){E.default.logAction(E.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},o.Promise=function(c){return c=S.default.objectifyOptions(c),c.promises=!0,new o(c)},o.Callbacks=o,o.Utils=a,o.ConnectionManager=A.default,o.Platform=w.default,o.ProtocolMessage=u.default,o.Message=T.default,o}(N.default),d=function(y){g.__extends(o,y);function o(c){var s=y.call(this)||this;return s.realtime=c,s.all={},s.inProgress={},c.connection.connectionManager.on("transport.active",function(){s.onTransportActive()}),s}return o.prototype.onChannelMessage=function(c){var s=c.channel;if(s===void 0){E.default.logAction(E.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+c.action);return}var f=this.all[s];if(!f){E.default.logAction(E.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+s);return}f.onMessage(c)},o.prototype.onTransportActive=function(){for(var c in this.all){var s=this.all[c];s.state==="attaching"||s.state==="detaching"?s.checkPendingState():s.state==="suspended"&&s.attach()}},o.prototype.reattach=function(c){for(var s in this.all){var f=this.all[s];f.state==="attached"&&f.requestState("attaching",c)}},o.prototype.resetAttachedMsgIndicators=function(){for(var c in this.all){var s=this.all[c];s.state==="attached"&&(s._attachedMsgIndicator=!1)}},o.prototype.checkAttachedMsgIndicators=function(c){for(var s in this.all){var f=this.all[s];if(f.state==="attached"&&f._attachedMsgIndicator===!1){var i="30s after a resume, found channel which has not received an attached; channelId = "+s+"; connectionId = "+c;E.default.logAction(E.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",i),f.requestState("attaching")}}},o.prototype.propogateConnectionInterruption=function(c,s){var f={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},i=["attaching","attached","detaching","suspended"],p=f[c];for(var R in this.all){var L=this.all[R];a.arrIn(i,L.state)&&L.notifyState(p,s)}},o.prototype.get=function(c,s){c=String(c);var f=this.all[c];if(!f)f=this.all[c]=new F.default(this.realtime,c,s);else if(s){if(f._shouldReattachToSetOptions(s))throw new b.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);f.setOptions(s)}return f},o.prototype.release=function(c){c=String(c);var s=this.all[c];if(!!s){var f=s.getReleaseErr();if(f)throw f;delete this.all[c],delete this.inProgress[c]}},o.prototype.setInProgress=function(c,s,f){this.inProgress[c.name]=this.inProgress[c.name]||{},this.inProgress[c.name][s]=f,!f&&this.hasNopending()&&this.emit("nopending")},o.prototype.onceNopending=function(c){if(this.hasNopending()){c();return}this.once("nopending",c)},o.prototype.hasNopending=function(){return a.arrEvery(a.valuesArray(this.inProgress,!0),function(c){return!a.containsValue(c,!0)})},o}(I.default);h.default=m},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(7)),I=g.__importDefault(r(25)),E=g.__importDefault(r(3)),P=g.__importDefault(r(36)),F=g.__importDefault(r(0));function S(){}var b=function(u){g.__extends(A,u);function A(w,T){var m=u.call(this)||this;return m.whenState=function(d,y){return N.default.prototype.whenState.call(m,d,m.state,y,new P.default(void 0,d))},m.ably=w,m.connectionManager=new I.default(w,T),m.state=m.connectionManager.state.state,m.key=void 0,m.id=void 0,m.serial=void 0,m.timeSerial=void 0,m.recoveryKey=void 0,m.errorReason=null,m.connectionManager.on("connectionstate",function(d){var y=m.state=d.current;F.default.Config.nextTick(function(){m.emit(y,d)})}),m.connectionManager.on("update",function(d){F.default.Config.nextTick(function(){m.emit("update",d)})}),m}return A.prototype.connect=function(){E.default.logAction(E.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},A.prototype.ping=function(w){if(E.default.logAction(E.default.LOG_MINOR,"Connection.ping()",""),!w){if(this.ably.options.promises)return a.promisify(this,"ping",arguments);w=S}this.connectionManager.ping(null,w)},A.prototype.close=function(){E.default.logAction(E.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},A}(N.default);h.default=b},function(v,h,r){"use strict";h.__esModule=!0,h.PendingMessage=void 0;var g=r(1),a=g.__importDefault(r(10)),N=g.__importStar(r(2)),I=g.__importDefault(r(7)),E=g.__importDefault(r(3)),P=g.__importDefault(r(35)),F=g.__importDefault(r(5)),S=a.default.Action,b=function(){function A(w,T){this.message=w,this.callback=T,this.merged=!1;var m=w.action;this.sendAttempted=!1,this.ackRequired=m==S.MESSAGE||m==S.PRESENCE}return A}();h.PendingMessage=b;var u=function(A){g.__extends(w,A);function w(T){var m=A.call(this)||this;return m.transport=T,m.messageQueue=new P.default,T.on("ack",function(d,y){m.onAck(d,y)}),T.on("nack",function(d,y,o){m.onNack(d,y,o)}),m}return w.prototype.onAck=function(T,m){E.default.logAction(E.default.LOG_MICRO,"Protocol.onAck()","serial = "+T+"; count = "+m),this.messageQueue.completeMessages(T,m)},w.prototype.onNack=function(T,m,d){E.default.logAction(E.default.LOG_ERROR,"Protocol.onNack()","serial = "+T+"; count = "+m+"; err = "+N.inspectError(d)),d||(d=new F.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(T,m,d)},w.prototype.onceIdle=function(T){var m=this.messageQueue;if(m.count()===0){T();return}m.once("idle",T)},w.prototype.send=function(T){T.ackRequired&&this.messageQueue.push(T),E.default.shouldLog(E.default.LOG_MICRO)&&E.default.logAction(E.default.LOG_MICRO,"Protocol.send()","sending msg; "+a.default.stringify(T.message)),T.sendAttempted=!0,this.transport.send(T.message)},w.prototype.getTransport=function(){return this.transport},w.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},w.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},w.prototype.finish=function(){var T=this.transport;this.onceIdle(function(){T.disconnect()})},w}(I.default);h.default=u},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(0)),N=g.__importStar(r(2)),I=g.__importDefault(r(26)),E=g.__importDefault(r(8)),P=g.__importDefault(r(3)),F=g.__importDefault(r(10)),S=g.__importDefault(r(5)),b="web_socket";function u(T){return!!T.on}var A=function(T){g.__extends(m,T);function m(d,y,o){var c=T.call(this,d,y,o)||this;return c.shortName=b,o.heartbeats=a.default.Config.useProtocolHeartbeats,c.wsHost=E.default.getHost(o.options,o.host,!0),c}return m.isAvailable=function(){return!!a.default.Config.WebSocket},m.prototype.createWebSocket=function(d,y){var o=0;if(y)for(var c in y)d+=(o++?"&":"?")+c+"="+y[c];return this.uri=d,new a.default.Config.WebSocket(d)},m.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},m.prototype.connect=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),I.default.prototype.connect.call(this);var d=this,y=this.params,o=y.options,c=o.tls?"wss://":"ws://",s=c+this.wsHost+":"+E.default.getPort(o)+"/";P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+s),this.auth.getAuthParams(function(f,i){if(!d.isDisposed){var p="";for(var R in i)p+=" "+R+": "+i[R]+";";if(P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+p+" err: "+f),f){d.disconnect(f);return}var L=y.getConnectParams(i);try{var z=d.wsConnection=d.createWebSocket(s,L);z.binaryType=a.default.Config.binaryType,z.onopen=function(){d.onWsOpen()},z.onclose=function(H){d.onWsClose(H)},z.onmessage=function(H){d.onWsData(H.data)},z.onerror=function(H){d.onWsError(H)},u(z)&&z.on("ping",function(){d.onActivity()})}catch(H){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),d.disconnect(H)}}})},m.prototype.send=function(d){var y=this.wsConnection;if(!y){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{y.send(F.default.serialize(d,this.params.format))}catch(c){var o="Exception from ws connection when trying to send: "+N.inspectError(c);P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.send()",o),this.finish("disconnected",new S.default(o,5e4,500))}},m.prototype.onWsData=function(d){P.default.logAction(P.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+d.length+"; type = "+typeof d);try{this.onProtocolMessage(F.default.deserialize(d,this.format))}catch(y){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+y.stack)}},m.prototype.onWsOpen=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},m.prototype.onWsClose=function(d){var y,o;if(typeof d=="object"?(o=d.code,y=d.wasClean||o===1e3):(o=d,y=o==1e3),delete this.wsConnection,y){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var c=new S.default("Websocket closed",80003,400);this.finish("disconnected",c)}else{var s="Unclean disconnection of WebSocket ; code = "+o,c=new S.default(s,80003,400);P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsClose()",s),this.finish("disconnected",c)}this.emit("disposed")},m.prototype.onWsError=function(d){var y=this;P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+d.message),a.default.Config.nextTick(function(){y.disconnect(Error(d.message))})},m.prototype.dispose=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var d=this.wsConnection;d&&(d.onmessage=function(){},delete this.wsConnection,a.default.Config.nextTick(function(){if(P.default.logAction(P.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!d)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");d.close()}))},m}(I.default);function w(T){return A.isAvailable()&&(T.supportedTransports[b]=A),A}h.default=w},function(v,h,r){"use strict";h.__esModule=!0,h.isSuccessCode=void 0;var g;(function(N){N[N.Success=200]="Success",N[N.NoContent=204]="NoContent",N[N.BadRequest=400]="BadRequest",N[N.Unauthorized=401]="Unauthorized",N[N.Forbidden=403]="Forbidden",N[N.RequestTimeout=408]="RequestTimeout",N[N.InternalServerError=500]="InternalServerError"})(g||(g={}));function a(N){return N>=g.Success&&N<g.BadRequest}h.isSuccessCode=a,h.default=g},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importStar(r(2)),N=g.__importDefault(r(34)),I=g.__importDefault(r(7)),E=g.__importDefault(r(3)),P=g.__importDefault(r(14)),F=g.__importDefault(r(5)),S=g.__importDefault(r(37)),b=g.__importDefault(r(22)),u=g.__importDefault(r(38)),A=function(){};function w(s){return s.clientId+":"+s.connectionId}function T(s){return s.channel.realtime.auth.clientId}function m(s){var f=s.channel.realtime,i=f.auth.clientId;return(!i||i==="*")&&f.connection.state==="connected"}function d(s,f,i){switch(s.state){case"attached":case"suspended":i();break;case"initialized":case"detached":case"detaching":case"attaching":s.attach(function(p){p?f(p):i()});break;default:f(F.default.fromValues(S.default.invalidStateError(s.state)))}}function y(s,f){if(s.isSynthesized()||f.isSynthesized())return s.timestamp>f.timestamp;var i=s.parseId(),p=f.parseId();return i.msgSerial===p.msgSerial?i.index>p.index:i.msgSerial>p.msgSerial}var o=function(s){g.__extends(f,s);function f(i){var p=s.call(this,i)||this;return p.channel=i,p.syncComplete=!1,p.members=new c(p),p._myMembers=new c(p),p.subscriptions=new I.default,p.pendingPresence=[],p}return f.prototype.enter=function(i,p){if(m(this))throw new F.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,i,"enter",p)},f.prototype.update=function(i,p){if(m(this))throw new F.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,i,"update",p)},f.prototype.enterClient=function(i,p,R){return this._enterOrUpdateClient(i,p,"enter",R)},f.prototype.updateClient=function(i,p,R){return this._enterOrUpdateClient(i,p,"update",R)},f.prototype._enterOrUpdateClient=function(i,p,R,L){var z=this;if(!L)if(typeof p=="function")L=p,p=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"_enterOrUpdateClient",[i,p,R]);L=A}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}E.default.logAction(E.default.LOG_MICRO,"RealtimePresence."+R+"Client()","channel = "+H.name+", client = "+(i||"(implicit) "+T(this)));var D=P.default.fromValues({action:R,data:p});i&&(D.clientId=i),P.default.encode(D,H.channelOptions,function(C){if(C){L(C);return}switch(H.state){case"attached":H.sendPresence(D,L);break;case"initialized":case"detached":H.attach();case"attaching":z.pendingPresence.push({presence:D,callback:L});break;default:C=new F.default("Unable to "+R+" presence channel while in "+H.state+" state",90001),C.code=90001,L(C)}})},f.prototype.leave=function(i,p){if(m(this))throw new F.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,i,p)},f.prototype.leaveClient=function(i,p,R){if(!R)if(typeof p=="function")R=p,p=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"leaveClient",[i,p]);R=A}var L=this.channel;if(!L.connectionManager.activeState()){R==null||R(L.connectionManager.getError());return}E.default.logAction(E.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+i);var z=P.default.fromValues({action:"leave",data:p});switch(i&&(z.clientId=i),L.state){case"attached":L.sendPresence(z,R);break;case"attaching":this.pendingPresence.push({presence:z,callback:R});break;case"initialized":case"failed":{var H=new F.default("Unable to leave presence channel (incompatible state)",90001);R==null||R(H);break}default:R==null||R(S.default.invalidStateError(L.state))}},f.prototype.get=function(i,p){var R=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),i=L[0],p=L[1];var z=!i||("waitForSync"in i?i.waitForSync:!0);if(!p){if(this.channel.realtime.options.promises)return a.promisify(this,"get",L);p=A}function H(D){p(null,i?D.list(i):D.values())}if(this.channel.state==="suspended"){z?p(F.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}d(this.channel,p,function(){var D=R.members;z?D.waitSync(function(){H(D)}):H(D)})},f.prototype.history=function(i,p){if(E.default.logAction(E.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),p===void 0)if(typeof i=="function")p=i,i=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"history",arguments);p=A}i&&i.untilAttach&&(this.channel.state==="attached"?(delete i.untilAttach,i.from_serial=this.channel.properties.attachSerial):p(new F.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),N.default.prototype._history.call(this,i,p)},f.prototype.setPresence=function(i,p,R){E.default.logAction(E.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+i.length+" participants; syncChannelSerial = "+R);var L,z,H=this.members,D=this._myMembers,C=[],_=this.channel.connectionManager.connectionId;p&&(this.members.startSync(),R&&(z=R.match(/^[\w-]+:(.*)$/))&&(L=z[1]));for(var j=0;j<i.length;j++){var W=P.default.fromValues(i[j]);switch(W.action){case"leave":H.remove(W)&&C.push(W),W.connectionId===_&&!W.isSynthesized()&&D.remove(W);break;case"enter":case"present":case"update":H.put(W)&&C.push(W),W.connectionId===_&&D.put(W);break}}p&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(S.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var j=0;j<C.length;j++){var W=C[j];this.subscriptions.emit(W.action,W)}},f.prototype.onAttached=function(i){E.default.logAction(E.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+i),i?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var p=this.pendingPresence,R=p.length;if(R){this.pendingPresence=[];var L=[],z=b.default.create();E.default.logAction(E.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+R+" queued presence messages");for(var H=0;H<R;H++){var D=p[H];L.push(D.presence),z.push(D.callback)}this.channel.sendPresence(L,z)}},f.prototype.actOnChannelState=function(i,p,R){switch(i){case"attached":this.onAttached(p);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(R);break}},f.prototype.failPendingPresence=function(i){if(this.pendingPresence.length){E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+a.inspectError(i));for(var p=0;p<this.pendingPresence.length;p++)try{this.pendingPresence[p].callback(i)}catch(R){}this.pendingPresence=[]}},f.prototype._clearMyMembers=function(){this._myMembers.clear()},f.prototype._ensureMyMembersPresent=function(){var i=this,p=this.members,R=this._myMembers,L=function(D){if(D){var C="Presence auto-re-enter failed: "+D.toString(),_=new F.default(C,91004,400);E.default.logAction(E.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",C);var j=new u.default(i.channel.state,i.channel.state,!0,_);i.channel.emit("update",j)}};for(var z in R.map)if(!(z in p.map)){var H=R.map[z];E.default.logAction(E.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete R.map[z]}},f.prototype._synthesizeLeaves=function(i){var p=this.subscriptions;a.arrForEach(i,function(R){var L=P.default.fromValues({action:"leave",connectionId:R.connectionId,clientId:R.clientId,data:R.data,encoding:R.encoding,timestamp:a.now()});p.emit("leave",L)})},f.prototype.on=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];E.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,i)},f.prototype.off=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];E.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,i)},f.prototype.subscribe=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];var R=S.default.processListenerArgs(i),L=R[0],z=R[1],H=R[2],D=this.channel;if(!H){if(this.channel.realtime.options.promises)return a.promisify(this,"subscribe",[L,z]);H=A}if(D.state==="failed"){H(F.default.fromValues(S.default.invalidStateError("failed")));return}this.subscriptions.on(L,z),D.attach(H)},f.prototype.unsubscribe=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];var R=S.default.processListenerArgs(i),L=R[0],z=R[1];this.subscriptions.off(L,z)},f}(N.default),c=function(s){g.__extends(f,s);function f(i){var p=s.call(this)||this;return p.presence=i,p.map={},p.syncInProgress=!1,p.residualMembers=null,p}return f.prototype.get=function(i){return this.map[i]},f.prototype.getClient=function(i){var p=this.map,R=[];for(var L in p){var z=p[L];z.clientId==i&&z.action!="absent"&&R.push(z)}return R},f.prototype.list=function(i){var p=this.map,R=i&&i.clientId,L=i&&i.connectionId,z=[];for(var H in p){var D=p[H];D.action!=="absent"&&(R&&R!=D.clientId||L&&L!=D.connectionId||z.push(D))}return z},f.prototype.put=function(i){(i.action==="enter"||i.action==="update")&&(i=P.default.fromValues(i),i.action="present");var p=this.map,R=w(i);this.residualMembers&&delete this.residualMembers[R];var L=p[R];return L&&!y(i,L)?!1:(p[R]=i,!0)},f.prototype.values=function(){var i=this.map,p=[];for(var R in i){var L=i[R];L.action!="absent"&&p.push(L)}return p},f.prototype.remove=function(i){var p=this.map,R=w(i),L=p[R];return L&&!y(i,L)?!1:(this.syncInProgress?(i=P.default.fromValues(i),i.action="absent",p[R]=i):delete p[R],!0)},f.prototype.startSync=function(){var i=this.map,p=this.syncInProgress;E.default.logAction(E.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+p),this.syncInProgress||(this.residualMembers=a.copy(i),this.setInProgress(!0))},f.prototype.endSync=function(){var i=this.map,p=this.syncInProgress;if(E.default.logAction(E.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+p),p){for(var R in i){var L=i[R];L.action==="absent"&&delete i[R]}this.presence._synthesizeLeaves(a.valuesArray(this.residualMembers));for(var z in this.residualMembers)delete i[z];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},f.prototype.waitSync=function(i){var p=this.syncInProgress;if(E.default.logAction(E.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+p),!p){i();return}this.once("sync",i)},f.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},f.prototype.setInProgress=function(i){E.default.logAction(E.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+i),this.syncInProgress=i,this.presence.syncComplete=!i},f}(I.default);h.default=o},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=r(56),N=r(32),I=r(13),E=g.__importDefault(r(4)),P=g.__importDefault(r(0)),F=function(){function S(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return S.prototype.isWordArray=function(b){return b!=null&&b.sigBytes!==void 0},S.prototype.isArrayBuffer=function(b){return b!=null&&b.constructor===ArrayBuffer},S.prototype.isTypedArray=function(b){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(b)},S.prototype.uint8ViewToBase64=function(b){for(var u="",A=this.base64CharSet,w=b.byteLength,T=w%3,m=w-T,d,y,o,c,s,f=0;f<m;f=f+3)s=b[f]<<16|b[f+1]<<8|b[f+2],d=(s&16515072)>>18,y=(s&258048)>>12,o=(s&4032)>>6,c=s&63,u+=A[d]+A[y]+A[o]+A[c];return T==1?(s=b[m],d=(s&252)>>2,y=(s&3)<<4,u+=A[d]+A[y]+"=="):T==2&&(s=b[m]<<8|b[m+1],d=(s&64512)>>10,y=(s&1008)>>4,o=(s&15)<<2,u+=A[d]+A[y]+A[o]+"="),u},S.prototype.base64ToArrayBuffer=function(b){for(var u=atob==null?void 0:atob(b),A=u.length,w=new Uint8Array(A),T=0;T<A;T++){var m=u.charCodeAt(T);w[T]=m}return w.buffer},S.prototype.isBuffer=function(b){return this.isArrayBuffer(b)||this.isWordArray(b)||this.isTypedArray(b)},S.prototype.toBuffer=function(b){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(b))return new Uint8Array(b);if(this.isTypedArray(b))return new Uint8Array(b.buffer);if(this.isWordArray(b)){for(var u=new ArrayBuffer(b.sigBytes),A=new Uint8Array(u),w=0;w<b.sigBytes;w++)A[w]=b.words[w>>>2]>>>24-w%4*8&255;return A}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},S.prototype.toArrayBuffer=function(b){return this.isArrayBuffer(b)?b:this.toBuffer(b).buffer},S.prototype.toWordArray=function(b){return this.isTypedArray(b)&&(b=b.buffer),this.isWordArray(b)?b:E.default.create(b)},S.prototype.base64Encode=function(b){return this.isWordArray(b)?I.stringify(b):this.uint8ViewToBase64(this.toBuffer(b))},S.prototype.base64Decode=function(b){return ArrayBuffer&&P.default.Config.atob?this.base64ToArrayBuffer(b):I.parse(b)},S.prototype.hexEncode=function(b){return a.stringify(this.toWordArray(b))},S.prototype.hexDecode=function(b){var u=a.parse(b);return ArrayBuffer?this.toArrayBuffer(u):u},S.prototype.utf8Encode=function(b){return TextEncoder?new TextEncoder().encode(b).buffer:N.parse(b)},S.prototype.utf8Decode=function(b){if(!this.isBuffer(b))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(b)?new TextDecoder().decode(b):(b=this.toWordArray(b),N.stringify(b))},S.prototype.bufferCompare=function(b,u){if(!b)return-1;if(!u)return 1;var A=this.toWordArray(b),w=this.toWordArray(u);A.clamp(),w.clamp();var T=A.sigBytes-w.sigBytes;if(T!=0)return T;for(var m=A.words,d=w.words,y=0;y<m.length;y++)if(T=m[y]-d[y],T!=0)return T;return 0},S.prototype.byteLength=function(b){return this.isArrayBuffer(b)||this.isTypedArray(b)?b.byteLength:this.isWordArray(b)?b.sigBytes:-1},S.prototype.typedArrayToBuffer=function(b){return b.buffer},S}();h.default=new F},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return g.enc.Hex})},function(v,h,r){"use strict";r.r(h);var g=r(4),a=r.n(g),N=r(13),I=r.n(N),E=r(21),P=r.n(E),F=r(0),S=r.n(F),b=r(3),u=r.n(b),A=function(){var w="aes",T=256,m="cbc",d=16,y=4,o=4294967296,c=2147483648,s;if(S.a.getRandomWordArray)s=S.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&S.a.getRandomValues){var f=new Uint32Array(y);s=function(C,_){var j=C/4,W=j==y?f:new Uint32Array(j);S.a.getRandomValues(W,function(Q){_(Q,S.a.BufferUtils.toWordArray(W))})}}else s=function(C,_){u.a.logAction(u.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var j=C/4,W=new Array(j),Q=0;Q<j;Q++)W[Q]=Math.floor(Math.random()*o)-c;_(null,a.a.create(W))};function i(C){return C+d&-d}function p(C){if(C.algorithm==="aes"&&C.mode==="cbc"){if(C.keyLength===128||C.keyLength===256)return;throw new Error("Unsupported key length "+C.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function R(C){return C.replace("_","/").replace("-","+")}var L=[a.a.create([269488144,269488144,269488144,269488144],16),a.a.create([16777216],1),a.a.create([33685504],2),a.a.create([50529024],3),a.a.create([67372036],4),a.a.create([84215045,83886080],5),a.a.create([101058054,101056512],6),a.a.create([117901063,117901056],7),a.a.create([134744072,134744072],8),a.a.create([151587081,151587081,150994944],9),a.a.create([168430090,168430090,168427520],10),a.a.create([185273099,185273099,185273088],11),a.a.create([202116108,202116108,202116108],12),a.a.create([218959117,218959117,218959117,218103808],13),a.a.create([235802126,235802126,235802126,235798528],14),a.a.create([252645135,252645135,252645135,252645135],15),a.a.create([269488144,269488144,269488144,269488144],16)];function z(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}z.CipherParams=H,z.getDefaultParams=function(C){var _;if(typeof C=="function"||typeof C=="string"){if(u.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof C=="function")z.generateRandomKey(function(W){C(null,z.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,z.getDefaultParams({key:C}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!C.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof C.key=="string"?_=Object(N.parse)(R(C.key)):_=S.a.BufferUtils.toWordArray(C.key);var j=new H;if(j.key=_,j.algorithm=C.algorithm||w,j.keyLength=_.words.length*(4*8),j.mode=C.mode||m,C.keyLength&&C.keyLength!==j.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+C.keyLength+" was specified, but the key actually has length "+j.keyLength);return p(j),j},z.generateRandomKey=function(C,_){arguments.length==1&&typeof C=="function"&&(_=C,C=void 0),s((C||T)/8,_)},z.getCipher=function(C){var _=C instanceof H?C:z.getDefaultParams(C);return{cipherParams:_,cipher:new D(_,y,C.iv)}};function D(C,_,j){this.algorithm=C.algorithm+"-"+String(C.keyLength)+"-"+C.mode,this.cjsAlgorithm=C.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=S.a.BufferUtils.toWordArray(C.key),j&&(this.iv=S.a.BufferUtils.toWordArray(j).clone()),this.blockLengthWords=_}return D.prototype.encrypt=function(C,_){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.encrypt()",""),C=S.a.BufferUtils.toWordArray(C);var j=C.sigBytes,W=i(j),Q=this,Z=function(){Q.getIv(function(q,G){if(q){_(q);return}var M=Q.encryptCipher.process(C.concat(L[W-j])),U=G.concat(M);_(null,U)})};this.encryptCipher?Z():this.iv?(this.encryptCipher=P.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),Z()):s(d,function(q,G){if(q){_(q);return}Q.encryptCipher=P.a.algo[Q.cjsAlgorithm].createEncryptor(Q.key,{iv:G}),Q.iv=G,Z()})},D.prototype.decrypt=function(C){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.decrypt()",""),C=S.a.BufferUtils.toWordArray(C);var _=this.blockLengthWords,j=C.words,W=a.a.create(j.slice(0,_)),Q=a.a.create(j.slice(_)),Z=P.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),q=Z.process(Q),G=Z.finalize();return Z.reset(),G&&G.sigBytes&&q.concat(G),q},D.prototype.getIv=function(C){if(this.iv){var _=this.iv;this.iv=null,C(null,_);return}var j=this;s(d,function(W,Q){if(W){C(W);return}C(null,j.encryptCipher.process(Q))})},z}();h.default=A},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(){var a=g,N=a.lib,I=N.WordArray,E=a.enc,P=E.Utf16=E.Utf16BE={stringify:function(S){for(var b=S.words,u=S.sigBytes,A=[],w=0;w<u;w+=2){var T=b[w>>>2]>>>16-w%4*8&65535;A.push(String.fromCharCode(T))}return A.join("")},parse:function(S){for(var b=S.length,u=[],A=0;A<b;A++)u[A>>>1]|=S.charCodeAt(A)<<16-A%2*16;return I.create(u,b*2)}};E.Utf16LE={stringify:function(S){for(var b=S.words,u=S.sigBytes,A=[],w=0;w<u;w+=2){var T=F(b[w>>>2]>>>16-w%4*8&65535);A.push(String.fromCharCode(T))}return A.join("")},parse:function(S){for(var b=S.length,u=[],A=0;A<b;A++)u[A>>>1]|=F(S.charCodeAt(A)<<16-A%2*16);return I.create(u,b*2)}};function F(S){return S<<8&4278255360|S>>>8&16711935}}(),g.enc.Utf16})},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(28))})(this,function(g){return function(a){var N=g,I=N.lib,E=I.CipherParams,P=N.enc,F=P.Hex,S=N.format,b=S.Hex={stringify:function(u){return u.ciphertext.toString(F)},parse:function(u){var A=F.parse(u);return E.create({ciphertext:A})}}}(),g.format.Hex})},function(v,h,r){(function(g,a){v.exports=h=a(r(6),r(13),r(61),r(27),r(28))})(this,function(g){return function(){var a=g,N=a.lib,I=N.BlockCipher,E=a.algo,P=[],F=[],S=[],b=[],u=[],A=[],w=[],T=[],m=[],d=[];(function(){for(var c=[],s=0;s<256;s++)s<128?c[s]=s<<1:c[s]=s<<1^283;for(var f=0,i=0,s=0;s<256;s++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^p&255^99,P[f]=p,F[p]=f;var R=c[f],L=c[R],z=c[L],H=c[p]*257^p*16843008;S[f]=H<<24|H>>>8,b[f]=H<<16|H>>>16,u[f]=H<<8|H>>>24,A[f]=H;var H=z*16843009^L*65537^R*257^f*16843008;w[p]=H<<24|H>>>8,T[p]=H<<16|H>>>16,m[p]=H<<8|H>>>24,d[p]=H,f?(f=R^c[c[c[z^R]]],i^=c[c[i]]):f=i=1}})();var y=[0,1,2,4,8,16,32,64,128,27,54],o=E.AES=I.extend({_doReset:function(){var c;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var s=this._keyPriorReset=this._key,f=s.words,i=s.sigBytes/4,p=this._nRounds=i+6,R=(p+1)*4,L=this._keySchedule=[],z=0;z<R;z++)z<i?L[z]=f[z]:(c=L[z-1],z%i?i>6&&z%i==4&&(c=P[c>>>24]<<24|P[c>>>16&255]<<16|P[c>>>8&255]<<8|P[c&255]):(c=c<<8|c>>>24,c=P[c>>>24]<<24|P[c>>>16&255]<<16|P[c>>>8&255]<<8|P[c&255],c^=y[z/i|0]<<24),L[z]=L[z-i]^c);for(var H=this._invKeySchedule=[],D=0;D<R;D++){var z=R-D;if(D%4)var c=L[z];else var c=L[z-4];D<4||z<=4?H[D]=c:H[D]=w[P[c>>>24]]^T[P[c>>>16&255]]^m[P[c>>>8&255]]^d[P[c&255]]}}},encryptBlock:function(c,s){this._doCryptBlock(c,s,this._keySchedule,S,b,u,A,P)},decryptBlock:function(c,s){var f=c[s+1];c[s+1]=c[s+3],c[s+3]=f,this._doCryptBlock(c,s,this._invKeySchedule,w,T,m,d,F);var f=c[s+1];c[s+1]=c[s+3],c[s+3]=f},_doCryptBlock:function(c,s,f,i,p,R,L,z){for(var H=this._nRounds,D=c[s]^f[0],C=c[s+1]^f[1],_=c[s+2]^f[2],j=c[s+3]^f[3],W=4,Q=1;Q<H;Q++){var Z=i[D>>>24]^p[C>>>16&255]^R[_>>>8&255]^L[j&255]^f[W++],q=i[C>>>24]^p[_>>>16&255]^R[j>>>8&255]^L[D&255]^f[W++],G=i[_>>>24]^p[j>>>16&255]^R[D>>>8&255]^L[C&255]^f[W++],M=i[j>>>24]^p[D>>>16&255]^R[C>>>8&255]^L[_&255]^f[W++];D=Z,C=q,_=G,j=M}var Z=(z[D>>>24]<<24|z[C>>>16&255]<<16|z[_>>>8&255]<<8|z[j&255])^f[W++],q=(z[C>>>24]<<24|z[_>>>16&255]<<16|z[j>>>8&255]<<8|z[D&255])^f[W++],G=(z[_>>>24]<<24|z[j>>>16&255]<<16|z[D>>>8&255]<<8|z[C&255])^f[W++],M=(z[j>>>24]<<24|z[D>>>16&255]<<16|z[C>>>8&255]<<8|z[_&255])^f[W++];c[s]=Z,c[s+1]=q,c[s+2]=G,c[s+3]=M},keySize:256/32});a.AES=I._createHelper(o)}(),g.AES})},function(v,h,r){(function(g,a){v.exports=h=a(r(6))})(this,function(g){return function(a){var N=g,I=N.lib,E=I.WordArray,P=I.Hasher,F=N.algo,S=[];(function(){for(var m=0;m<64;m++)S[m]=a.abs(a.sin(m+1))*4294967296|0})();var b=F.MD5=P.extend({_doReset:function(){this._hash=new E.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,d){for(var y=0;y<16;y++){var o=d+y,c=m[o];m[o]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}var s=this._hash.words,f=m[d+0],i=m[d+1],p=m[d+2],R=m[d+3],L=m[d+4],z=m[d+5],H=m[d+6],D=m[d+7],C=m[d+8],_=m[d+9],j=m[d+10],W=m[d+11],Q=m[d+12],Z=m[d+13],q=m[d+14],G=m[d+15],M=s[0],U=s[1],K=s[2],k=s[3];M=u(M,U,K,k,f,7,S[0]),k=u(k,M,U,K,i,12,S[1]),K=u(K,k,M,U,p,17,S[2]),U=u(U,K,k,M,R,22,S[3]),M=u(M,U,K,k,L,7,S[4]),k=u(k,M,U,K,z,12,S[5]),K=u(K,k,M,U,H,17,S[6]),U=u(U,K,k,M,D,22,S[7]),M=u(M,U,K,k,C,7,S[8]),k=u(k,M,U,K,_,12,S[9]),K=u(K,k,M,U,j,17,S[10]),U=u(U,K,k,M,W,22,S[11]),M=u(M,U,K,k,Q,7,S[12]),k=u(k,M,U,K,Z,12,S[13]),K=u(K,k,M,U,q,17,S[14]),U=u(U,K,k,M,G,22,S[15]),M=A(M,U,K,k,i,5,S[16]),k=A(k,M,U,K,H,9,S[17]),K=A(K,k,M,U,W,14,S[18]),U=A(U,K,k,M,f,20,S[19]),M=A(M,U,K,k,z,5,S[20]),k=A(k,M,U,K,j,9,S[21]),K=A(K,k,M,U,G,14,S[22]),U=A(U,K,k,M,L,20,S[23]),M=A(M,U,K,k,_,5,S[24]),k=A(k,M,U,K,q,9,S[25]),K=A(K,k,M,U,R,14,S[26]),U=A(U,K,k,M,C,20,S[27]),M=A(M,U,K,k,Z,5,S[28]),k=A(k,M,U,K,p,9,S[29]),K=A(K,k,M,U,D,14,S[30]),U=A(U,K,k,M,Q,20,S[31]),M=w(M,U,K,k,z,4,S[32]),k=w(k,M,U,K,C,11,S[33]),K=w(K,k,M,U,W,16,S[34]),U=w(U,K,k,M,q,23,S[35]),M=w(M,U,K,k,i,4,S[36]),k=w(k,M,U,K,L,11,S[37]),K=w(K,k,M,U,D,16,S[38]),U=w(U,K,k,M,j,23,S[39]),M=w(M,U,K,k,Z,4,S[40]),k=w(k,M,U,K,f,11,S[41]),K=w(K,k,M,U,R,16,S[42]),U=w(U,K,k,M,H,23,S[43]),M=w(M,U,K,k,_,4,S[44]),k=w(k,M,U,K,Q,11,S[45]),K=w(K,k,M,U,G,16,S[46]),U=w(U,K,k,M,p,23,S[47]),M=T(M,U,K,k,f,6,S[48]),k=T(k,M,U,K,D,10,S[49]),K=T(K,k,M,U,q,15,S[50]),U=T(U,K,k,M,z,21,S[51]),M=T(M,U,K,k,Q,6,S[52]),k=T(k,M,U,K,R,10,S[53]),K=T(K,k,M,U,j,15,S[54]),U=T(U,K,k,M,i,21,S[55]),M=T(M,U,K,k,C,6,S[56]),k=T(k,M,U,K,G,10,S[57]),K=T(K,k,M,U,H,15,S[58]),U=T(U,K,k,M,Z,21,S[59]),M=T(M,U,K,k,L,6,S[60]),k=T(k,M,U,K,W,10,S[61]),K=T(K,k,M,U,p,15,S[62]),U=T(U,K,k,M,_,21,S[63]),s[0]=s[0]+M|0,s[1]=s[1]+U|0,s[2]=s[2]+K|0,s[3]=s[3]+k|0},_doFinalize:function(){var m=this._data,d=m.words,y=this._nDataBytes*8,o=m.sigBytes*8;d[o>>>5]|=128<<24-o%32;var c=a.floor(y/4294967296),s=y;d[(o+64>>>9<<4)+15]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,d[(o+64>>>9<<4)+14]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,m.sigBytes=(d.length+1)*4,this._process();for(var f=this._hash,i=f.words,p=0;p<4;p++){var R=i[p];i[p]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return f},clone:function(){var m=P.clone.call(this);return m._hash=this._hash.clone(),m}});function u(m,d,y,o,c,s,f){var i=m+(d&y|~d&o)+c+f;return(i<<s|i>>>32-s)+d}function A(m,d,y,o,c,s,f){var i=m+(d&o|y&~o)+c+f;return(i<<s|i>>>32-s)+d}function w(m,d,y,o,c,s,f){var i=m+(d^y^o)+c+f;return(i<<s|i>>>32-s)+d}function T(m,d,y,o,c,s,f){var i=m+(y^(d|~o))+c+f;return(i<<s|i>>>32-s)+d}N.MD5=P._createHelper(b),N.HmacMD5=P._createHmacHelper(b)}(Math),g.MD5})},function(v,h,r){"use strict";var g;h.__esModule=!0;var a=r(1),N=a.__importDefault(r(0)),I=a.__importStar(r(2)),E=a.__importDefault(r(8)),P=a.__importDefault(r(5)),F=a.__importDefault(r(17)),S=a.__importDefault(r(15)),b=a.__importDefault(r(20)),u=a.__importDefault(r(3)),A=r(29);function w(d){var y=d.statusCode;return y===408&&!d.code||y===400&&!d.code||y>=500&&y<=504}function T(d){var y=d.connection,o=y&&y.connectionManager.host;return o?[o].concat(E.default.getFallbackHosts(d.options)):E.default.getHosts(d.options)}var m=(g=function(){function d(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=T,N.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(y,o,c,s,f,i,p){var R=S.default.createRequest(c,s,f,i,b.default.REQ_SEND,o&&o.options.timeouts,y);return R.once("complete",p),R.exec(),R},this.checkConnectivity=function(y){var o=E.default.internetUpUrl;u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+o),this.doUri(F.default.Get,null,o,null,null,null,function(c,s){var f,i=!c&&((f=s)===null||f===void 0?void 0:f.replace(/\n/,""))=="yes";u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+i),y(null,i)})}):N.default.Config.jsonpSupported&&(this.Request=function(y,o,c,s,f,i,p){var R=A.createRequest(c,s,f,i,b.default.REQ_SEND,o&&o.options.timeouts,y);return R.once("complete",p),N.default.Config.nextTick(function(){R.exec()}),R},this.checkConnectivity=function(y){var o=this,c=E.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(y);return}this.checksInProgress=[y],u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+c);var s=new A.Request("isTheInternetUp",c,null,null,null,b.default.REQ_SEND,E.default.TIMEOUTS);s.once("complete",function(f,i){var p=!f&&i;u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+p);for(var R=0;R<o.checksInProgress.length;R++)o.checksInProgress[R](null,p);o.checksInProgress=null}),N.default.Config.nextTick(function(){s.exec()})})}return d.prototype.do=function(y,o,c,s,f,i,p){var R=this,L=typeof c=="function"?c:function(C){return o.baseUri(C)+c},z=o._currentFallback;if(z)if(z.validUntil>I.now()){if(!this.Request){p==null||p(new P.default("Request invoked before assigned to",null,500));return}this.Request(y,o,L(z.host),s,i,f,function(C){for(var _=[],j=1;j<arguments.length;j++)_[j-1]=arguments[j];if(C&&w(C)){o._currentFallback=null,R.do(y,o,c,s,f,i,p);return}p==null||p.apply(void 0,a.__spreadArray([C],_))});return}else o._currentFallback=null;var H=T(o);if(H.length===1){this.doUri(y,o,L(H[0]),s,f,i,p);return}var D=function(C,_){var j=C.shift();R.doUri(y,o,L(j),s,f,i,function(W){for(var Q=[],Z=1;Z<arguments.length;Z++)Q[Z-1]=arguments[Z];if(W&&w(W)&&C.length){D(C,!0);return}_&&(o._currentFallback={host:j,validUntil:I.now()+o.options.timeouts.fallbackRetryTimeout}),p==null||p.apply(void 0,a.__spreadArray([W],Q))})};D(H)},d.prototype.doUri=function(y,o,c,s,f,i,p){if(!this.Request){p(new P.default("Request invoked before assigned to",null,500));return}this.Request(y,o,c,s,i,f,p)},d}(),g.methods=[F.default.Get,F.default.Delete,F.default.Post,F.default.Put,F.default.Patch],g.methodsWithoutBody=[F.default.Get,F.default.Delete],g.methodsWithBody=[F.default.Post,F.default.Put,F.default.Patch],g);h.default=m},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(40)),N=g.__importStar(r(2)),I=N.getGlobalObject();function E(){var b=I.location;return!I.WebSocket||!b||!b.origin||b.origin.indexOf("http")>-1}var P=I.navigator&&I.navigator.userAgent.toString(),F=I.location&&I.location.href,S={agent:"browser",logTimestamps:!0,userAgent:P,currentUrl:F,noUpgrade:P&&!!P.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:I.WebSocket,xhrSupported:I.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:E(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:a.default,supportsBinary:!!I.TextDecoder,preferBinary:!1,ArrayBuffer:I.ArrayBuffer,atob:I.atob,nextTick:typeof I.setImmediate!="undefined"?I.setImmediate.bind(I):function(b){setTimeout(b,0)},addEventListener:I.addEventListener,inspect:JSON.stringify,stringByteSize:function(b){return I.TextDecoder&&new I.TextEncoder().encode(b).length||b.length},TextEncoder:I.TextEncoder,TextDecoder:I.TextDecoder,Promise:I.Promise,getRandomValues:function(b){if(b!==void 0)return function(u,A){b.getRandomValues(u),A&&A(null)}}(I.crypto||msCrypto)};h.default=S},function(v,h,r){"use strict";(function(g){h.__esModule=!0;var a=r(1),N=a.__importStar(r(2)),I="ablyjs-storage-test",E=function(){function P(){try{g.sessionStorage.setItem(I,I),g.sessionStorage.removeItem(I),this.sessionSupported=!0}catch(F){this.sessionSupported=!1}try{g.localStorage.setItem(I,I),g.localStorage.removeItem(I),this.localSupported=!0}catch(F){this.localSupported=!1}}return P.prototype.get=function(F){return this._get(F,!1)},P.prototype.getSession=function(F){return this._get(F,!0)},P.prototype.remove=function(F){return this._remove(F,!1)},P.prototype.removeSession=function(F){return this._remove(F,!0)},P.prototype.set=function(F,S,b){return this._set(F,S,b,!1)},P.prototype.setSession=function(F,S,b){return this._set(F,S,b,!0)},P.prototype._set=function(F,S,b,u){var A={value:S};return b&&(A.expires=N.now()+b),this.storageInterface(u).setItem(F,JSON.stringify(A))},P.prototype._get=function(F,S){if(S&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!S&&!this.localSupported)throw new Error("Local Storage not supported");var b=this.storageInterface(S).getItem(F);if(!b)return null;var u=JSON.parse(b);return u.expires&&u.expires<N.now()?(this.storageInterface(S).removeItem(F),null):u.value},P.prototype._remove=function(F,S){return this.storageInterface(S).removeItem(F)},P.prototype.storageInterface=function(F){return F?g.sessionStorage:g.localStorage},P}();h.default=new E}).call(this,r(12))},function(v,h,r){"use strict";h.__esModule=!0;var g=r(1),a=g.__importDefault(r(66)),N={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],baseTransportOrder:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],transportPreferenceOrder:[a.default.JsonP,a.default.XhrPolling,a.default.XhrStreaming,a.default.WebSocket],upgradeTransports:[a.default.XhrStreaming,a.default.WebSocket]};h.default=N},function(v,h,r){"use strict";h.__esModule=!0;var g;(function(a){a.WebSocket="web_socket",a.Comet="comet",a.XhrStreaming="xhr_streaming",a.XhrPolling="xhr_polling",a.JsonP="jsonp"})(g||(g={})),h.default=g},function(v,h,r){"use strict";r.r(h);var g=r(29),a=r.n(g),N=r(2),I=r(0),E=r.n(I),P=r(11),F=r.n(P),S=r(15),b=r.n(S),u=function(d){var y="xhr_polling";function o(c,s,f){f.stream=!1,F.a.call(this,c,s,f),this.shortName=y}return N.inherits(o,F.a),o.isAvailable=function(){return E.a.Config.xhrSupported&&E.a.Config.allowComet},o.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(c,s,f,i,p){return b.a.createRequest(c,s,f,i,p,this.timeouts)},typeof d!="undefined"&&o.isAvailable()&&(d.supportedTransports[y]=o),o},A=u,w=function(d){var y="xhr_streaming";function o(c,s,f){F.a.call(this,c,s,f),this.shortName=y}return N.inherits(o,F.a),o.isAvailable=function(){return E.a.Config.xhrSupported&&E.a.Config.streamingSupported&&E.a.Config.allowComet},o.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(c,s,f,i,p){return b.a.createRequest(c,s,f,i,p,this.timeouts)},typeof d!="undefined"&&o.isAvailable()&&(d.supportedTransports[y]=o),o},T=w,m=h.default=[a.a,A,T]}]).default})});ct();ct();var _o=En(vo());ct();ct();var pu=En(hu()),we=class{constructor(h){this.debug=(0,pu.default)(h)}log(h,...r){this.debug(h,...r)}};ct();var gu=En(vo()),mo=class{setConfig(h){this.configuration=h}get(h,r){if(!this.configuration)throw new Error("configs is not available");return(0,gu.get)(this.configuration,h,r)}},Zv=new mo,qn=Zv;ct();ct();ct();ct();var $u=En(Ro());var Zt=class{constructor(h={}){this.subscribe=h=>{this.callbacks.push(h)};this.unsubscribe=h=>{this.callbacks=this.callbacks.filter(r=>r!==h)};this.publish=(...h)=>{!this.callbacks||this.callbacks.forEach(r=>{this.callListener(r,h).catch(g=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(h)}
            Error: ${g}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(h,r)=>new Promise((g,a)=>{try{let N=h(...r);g(N)}catch(N){a(N)}});let{logger:r,throttleTime:g}=h;this.logger=r!=null?r:new we("@superviz/sdk/observer-helper"),this.throttle=g,this.callbacks=[],this.throttle&&(this.publish=(0,$u.default)(this.publish,this.throttle))}};var Vr=class{constructor(h){this.observers=new Map;this.subscribe=(h,r)=>{this.logger.log("pubsub service @ subscribe",{event:h,callback:r}),this.observers.has(h)||this.observers.set(h,new Zt),this.observers.get(h).subscribe(r)};this.unsubscribe=(h,r)=>{this.logger.log("pubsub service @ unsubscribe",{event:h,callback:r}),this.observers.has(h)&&(this.observers.get(h).reset(),this.observers.delete(h))};this.publish=(h,r)=>{this.logger.log("pubsub service @ publish",{event:h,data:r}),this.realtime.setSyncProperty(h,r)};this.publishEventToClient=(h,r)=>{this.logger.log("pubsub service @ publishEventToClient",{event:h,data:r}),this.observers.has(h)&&this.observers.get(h).publish(r)};this.onSyncPropertiesChange=h=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:h}),Object.entries(h).forEach(([r,g])=>{this.publishEventToClient(r,g)})};this.logger=new we("@superviz/sdk/pubsub"),this.realtime=h,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(h){return this.realtime.fetchSyncClientProperty(h)}};ct();ct();var Eo=En(qu()),Xn=En(Ro());ct();ct();var So=(P=>(P[P.DISCONNECTED=0]="DISCONNECTED",P[P.INITIALIZING=1]="INITIALIZING",P[P.READY_TO_JOIN=2]="READY_TO_JOIN",P[P.CONNECTING=3]="CONNECTING",P[P.CONNECTED=4]="CONNECTED",P[P.JOINED=5]="JOINED",P[P.FAILED=-1]="FAILED",P[P.RETRYING=-2]="RETRYING",P))(So||{});ct();ct();var bo=(d=>(d[d.yellow=0]="yellow",d[d.turquoise=1]="turquoise",d[d.orange=2]="orange",d[d.blue=3]="blue",d[d.pink=4]="pink",d[d.purple=5]="purple",d[d.green=6]="green",d[d.red=7]="red",d[d.bluedark=8]="bluedark",d[d.pinklight=9]="pinklight",d[d.purplelight=10]="purplelight",d[d.greenlight=11]="greenlight",d[d.orangelight=12]="orangelight",d[d.bluelight=13]="bluelight",d[d.redlight=14]="redlight",d[d.brown=15]="brown",d[d.gray=16]="gray",d))(bo||{}),To=(v=>(v[v["#FFEF33"]=0]="#FFEF33",v[v["#31E0B0"]=1]="#31E0B0",v[v["#FF5E10"]=2]="#FF5E10",v[v["#00ABF7"]=3]="#00ABF7",v[v["#FF00BB"]=4]="#FF00BB",v[v["#9C29FF"]=5]="#9C29FF",v[v["#6FDD00"]=6]="#6FDD00",v[v["#E30000"]=7]="#E30000",v[v["#304AFF"]=8]="#304AFF",v[v["#FF89C4"]=9]="#FF89C4",v[v["#D597FF"]=10]="#D597FF",v[v["#C6EC5C"]=11]="#C6EC5C",v[v["#FFA115"]=12]="#FFA115",v[v["#75DEFE"]=13]="#75DEFE",v[v["#FAA291"]=14]="#FAA291",v[v["#BB813F"]=15]="#BB813F",v[v["#878291"]=16]="#878291",v))(To||{});var Kr=class{constructor(){this.participantObservers=[],this.logger=new we("@superviz/sdk/realtime-service"),this.participantsObserver=new Zt({logger:this.logger}),this.participantJoinedObserver=new Zt({logger:this.logger}),this.participantLeaveObserver=new Zt({logger:this.logger}),this.syncPropertiesObserver=new Zt({logger:this.logger}),this.reconnectObserver=new Zt({logger:this.logger}),this.roomInfoUpdatedObserver=new Zt({logger:this.logger}),this.roomListUpdatedObserver=new Zt({logger:this.logger}),this.hostObserver=new Zt({logger:this.logger}),this.realtimeStateObserver=new Zt({logger:this.logger}),this.kickAllParticipantsObserver=new Zt({logger:this.logger}),this.authenticationObserver=new Zt({logger:this.logger})}subscribeToParticipantUpdate(h,r){this.participantObservers[h]||(this.participantObservers[h]=new Zt({logger:this.logger})),this.participantObservers[h].subscribe(r)}unsubscribeFromParticipantUpdate(h,r){this.participantObservers[h]&&this.participantObservers[h].unsubscribe(r)}getSlotColor(h){let r=h!=null?h:16;return{color:To[r],name:bo[r]}}};var K0=1e3*60,J0=6e4,Q0=1e4,$0=1e3,Io=null,Mn=class extends Kr{constructor(r,g){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.state=0;this.setHost=r=>{if(!r)return;let g=this.participants[r];this.updateRoomProperties({hostClientId:g.clientId})};this.freezeSync=r=>{var g,a;if(this.isSyncFrozen=r,r){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(g=this.broadcastChannel)==null||g.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(a=this.broadcastChannel)==null||a.unsubscribe();return}this.join()};this.setParticipantData=r=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,r)};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(r=>{let g=this.clientSyncPropertiesQueue[r];this.clientSyncPropertiesQueue[r]=[],g.length&&this.clientSyncChannel.publish(r,g)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(r,g)=>{this.clientRoomState[r]=g[g.length-1],this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup")};this.updateLocalRoomState=r=>cn(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,r),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),r.hostClientId?(r==null?void 0:r.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(r.hostClientId):this.hostPassingHandle(),this.updateParticipants()});this.updateMyProperties=(0,Xn.default)(r=>{let g=r;if(!(this.isMessageTooBig(r)||this.left||!this.enableSync||this.isSyncFrozen)&&(g.avatar===void 0&&delete g.avatar,this.myParticipant.data=ln(ln({},this.myParticipant.data),r),!!this.isJoinedRoom))return this.supervizChannel.presence.update(this.myParticipant.data)},$0);this.updateRoomProperties=r=>{if(this.isMessageTooBig(r)||this.isSyncFrozen||this.left)return;let g=ln(ln({},this.localRoomProperties),r);this.supervizChannel.publish("update",g)};this.updateParticipants=()=>{let r={};this.supervizChannel.presence.get((g,a)=>{a.forEach(N=>{r[N.clientId]=ln({},N)}),this.participants=r,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=r=>{let g=[];if(this.supervizChannel.presence.get((N,I)=>{I.forEach(E=>{N||g.push(E.clientId)})}),!r||!g.includes(r)){this.hostPassingHandle();return}Io&&clearTimeout(Io);let a=this.hostParticipantId;this.hostParticipantId=r,this.hostObserver.publish({oldHostParticipantId:a,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var g;let r={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((g=this.myParticipant)==null?void 0:g.data.type)==="host"&&(r.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(r)};this.hostPassingHandle=(0,Xn.default)(()=>cn(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((r,g)=>{let a=g.filter(I=>I.data.type==="host").map(I=>I.clientId);if(this.shouldKickParticipantsOnHostLeave&&a.length===0){Io=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},K0);return}let N=a[0];N===this.localParticipantId&&this.setHost(N)})}),1e3);this.findSlotIndex=r=>{let g=r,a=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((E,P)=>{if(E){a=[];return}P.forEach(F=>{F.connectionId===g.connectionId&&(g=F),F.connectionId!==g.connectionId&&F.data.hasOwnProperty("slotIndex")&&a.splice(a.indexOf(F.data.slotIndex),1)})}),a.length===0)return;let N=a[0];this.myParticipant.data.slotIndex=N,this.updateMyProperties({slotIndex:N});let I=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(g)},I)};this.confirmSlot=(0,Xn.default)(r=>cn(this,null,function*(){let g=[],a=r;if(this.supervizChannel.presence.get((N,I)=>{I.forEach(E=>{E.connectionId===a.connectionId&&(a=E),E.connectionId!==a.connectionId&&E.data.slotIndex!==void 0&&g.push(E.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||g.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(a);else{let N=yield this.fetchRoomProperties();this.updateRoomProperties(N)}}),1e3);this.onParticipantJoin=r=>{this.updateParticipants(),this.participantJoinedObserver.publish(r),this.updateMyProperties({})};this.syncBroadcast=(0,Xn.default)(()=>{let r=btoa(this.ablyKey),g=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(g,{headers:{Authorization:`Basic ${r}`}}).then(a=>a.json()).then(a=>{this.broadcastChannel.publish("update",a)})},1e3);this.isMessageTooBig=(r,g=J0)=>{let a=JSON.stringify(r);return new TextEncoder().encode(a).length>g?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.ablyKey=g,this.apiUrl=r,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var r;return(r=this.roomProperties)==null?void 0:r.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var r,g;return(g=(r=this.myParticipant.data)==null?void 0:r.participantId)!=null?g:null}get isBroadcast(){return Object.values(this.participants).some(r=>r.data.type==="audience")}start({participant:r,roomId:g,apiKey:a,shouldKickParticipantsOnHostLeave:N}){this.myParticipant={data:uu(ln({},r),{participantId:r.id}),timestamp:null,action:null,clientId:r.id,connectionId:null,encoding:null,id:null},this.enableSync=r.type!=="audience",this.roomId=`superviz:${g.toLowerCase()}-${a}`,this.shouldKickParticipantsOnHostLeave=N,this.apiKey=a,this.client||this.buildClient()}auth(r,g){let a=new Eo.default.Rest({key:this.ablyKey}),{origin:N}=window.location;a.auth.requestToken(r,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:N,apiKey:this.apiKey}},(I,E)=>{I&&this.authenticationObserver.publish("realtime.authentication-failed"),g(I,E)})}join(r){let g=r?Object.assign({},r,{participantId:r.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(g),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(r){let g=this.localRoomProperties;this.updateRoomProperties(Object.assign({},g,{isGridModeEnable:r}))}setDrawing(r){let g=this.localRoomProperties;this.updateRoomProperties(Object.assign({},g,{drawing:r}))}setSyncProperty(r,g){var I;let a=(I=this.clientSyncPropertiesQueue[r])!=null?I:[],N=(E,P)=>({name:E,data:P,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(N(r,g),Q0)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(a)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",r,g),this.clientSyncPropertiesQueue[r]||(this.clientSyncPropertiesQueue[r]=[]),this.clientSyncPropertiesQueue[r].push(N(r,g)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(r){this.updateRoomProperties({followParticipantId:r})}setGather(r){this.updateRoomProperties({gather:r})}getParticipantSlot(r){var g,a;if(r){let N=r.toString();if(this.participants&&this.participants[N])return(a=(g=this.participants[r])==null?void 0:g.data)==null?void 0:a.slotIndex}return 16}onAblyPresenceEnter(r){r.clientId===this.myParticipant.data.participantId?this.onJoinRoom(r):this.onParticipantJoin(r)}onAblyPresenceUpdate(r){if(!this.isJoinedRoom)return;let{clientId:g}=r,a=Object.assign({},r,{participantId:r.clientId});this.publishParticipantUpdate(a),this.participants&&this.participants[g]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(r){this.onParticipantLeave(r)}onClientSyncChannelUpdate(r){let{name:g,data:a}=r,N={};N[g]=a,this.syncPropertiesObserver.publish(N),this.isLocalParticipantHost&&this.saveClientRoomState(g,a)}onReceiveBroadcastSync(r){r.data.forEach(a=>{var I;let N=a.clientId;this.participants[N]=a,(I=a.data)!=null&&I.isAudience||(this.participants[N].data=JSON.parse(this.participants[N].data),this.publishParticipantUpdate(this.participants[N]))})}onAblyRoomUpdate(r){this.updateLocalRoomState(r.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let r={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Eo.default.Realtime(r),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(r){this.participants[r.clientId]=r,this.participantsObserver.publish(this.participants),this.participantObservers[r.clientId]&&this.participantObservers[r.clientId].publish(r)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(r){throw this.logger.log(r),new Error(r)}publishStateUpdate(r){this.state!==r&&(this.state=r,this.logger.log("REALTIME",`Realtime state did change. New state: ${So[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((r,g)=>{this.supervizChannel.history((a,N)=>{var E;a&&g(a);let I=(E=N.items[0])==null?void 0:E.data;r(I||null)})})}fetchSyncClientProperty(r){return cn(this,null,function*(){try{let g=yield new Promise((a,N)=>{this.clientRoomStateChannel.history((I,E)=>{var F;I&&N(I);let P=(F=E==null?void 0:E.items[0])==null?void 0:F.data;a(P||null)})});if(r&&!g[r])throw new Error(`Event ${r} not found in the history`);return r?g[r]:g}catch(g){this.logger.log("REALTIME","Error in fetch client realtime data",g.message),this.throw(g.message)}})}onStateChange(){var S,b,u;let r=(S=this.supervizChannelState)==null?void 0:S.current,g=(b=this.connectionState)==null?void 0:b.current,a=g==="connected",N=["initialized","connecting"].includes(g),I=["closed","closing"].includes(g)||["detaching","detached"].includes(r),E={[0]:I,[1]:N,[2]:!r&&a,[3]:r==="attaching",[4]:r==="attached"&&a,[-1]:r==="failed"||g==="failed",[-2]:g==="suspended"||r==="suspended"},P=Object.entries(E).find(([A,w])=>w&&A)[0],F=Number(P);if(F===2&&(this.currentReconnectAttempt=0),a&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(F===-2||F===-1)&&this.forceReconnect(),(u=this.connectionState)!=null&&u.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(F)}onAblyConnectionStateChange(r){this.connectionState=r,this.onStateChange()}onAblyChannelStateChange(r){this.supervizChannelState=r,this.onStateChange()}onJoinRoom(r){return cn(this,null,function*(){var g;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(r),this.localRoomProperties?(yield Promise.all([this.updateParticipants(),((g=this.localRoomProperties)==null?void 0:g.hostClientId)&&this.updateHostInfo(this.localRoomProperties.hostClientId)]),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(r),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(r){if(this.state===2)return;let g=r.data.participantId===this.hostParticipantId;r.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(r),g&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};ct();var Po=class{constructor({participant:h,group:r,shouldKickParticipantsOnHostLeave:g}){this.components=[];this.participants=[];this.addComponent=h=>{h.attach({localParticipant:this.participant,realtime:this.realtime})};this.removeComponent=h=>{h.detach()};this.subscribeToPubSubEvent=(h,r)=>{this.logger.log("laucher service @ subscribeToPubSubEvent"),this.pubsub.subscribe(h,r)};this.unsubscribeFromPubSubEvent=(h,r)=>{this.logger.log("laucher service @ unsubscribeFromPubSubEvent"),this.pubsub.unsubscribe(h,r)};this.publishToPubSubEvent=(h,r)=>{this.logger.log("laucher service @ publishToPubSubEvent"),this.pubsub.publish(h,r)};this.fetchPubSubHistory=h=>this.pubsub.fetchHistory(h);this.startRealtime=()=>{this.logger.log("laucher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:qn.get("apiKey"),roomId:qn.get("roomId"),shouldKickParticipantsOnHostLeave:this.shouldKickParticipantsOnHostLeave}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)};this.onParticipantListUpdate=h=>{this.logger.log("laucher service @ onParticipantListUpdate");let r=Object.values(h).map(a=>{var N,I,E,P,F;return{id:a.data.id,name:(N=a.data)==null?void 0:N.name,type:(I=a.data)==null?void 0:I.type,avatar:(E=a.data)==null?void 0:E.avatar,avatarConfig:(P=a.data)==null?void 0:P.avatarConfig,isHost:this.realtime.hostClientId===a.clientId,color:this.realtime.getSlotColor((F=a.data)==null?void 0:F.slotIndex).color}}),g=r.find(a=>{var N;return(a==null?void 0:a.id)===((N=this.participant)==null?void 0:N.id)});(0,_o.isEqual)(this.participants,r)||(this.participants=r,this.pubsub.publishEventToClient("participant.list-updated",r),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",r)),g&&!(0,_o.isEqual)(this.participant,g)&&(this.participant=g,this.pubsub.publishEventToClient("participant.updated",g),this.logger.log("Publishing ParticipantEvent.UPDATED",g))};this.onParticipantJoined=h=>{this.logger.log("laucher service @ onParticipantJoined");let r=this.participants.find(g=>g.id===h.data.id);!r||(r.id===this.participant.id&&(this.logger.log("laucher service @ onParticipantJoined - local participant joined"),this.pubsub.publishEventToClient("participant.local-joined",r)),this.logger.log("laucher service @ onParticipantJoined - participant joined",r),this.pubsub.publishEventToClient("participant.joined",r))};this.onParticipantLeave=h=>{this.logger.log("laucher service @ onParticipantLeave");let r=this.participants.find(g=>g.id===h.data.id);!r||(r.id===this.participant.id&&(this.logger.log("laucher service @ onParticipantLeave - local participant left"),this.pubsub.publishEventToClient("participant.local-left",r)),this.logger.log("laucher service @ onParticipantLeave - participant left",r),this.pubsub.publishEventToClient("participant.left",r))};this.shouldKickParticipantsOnHostLeave=g!=null?g:!0,this.participant=h,this.group=r,this.logger=new we("@superviz/sdk/laucher"),this.realtime=new Mn(qn.get("apiUrl"),qn.get("ablyKey")),this.pubsub=new Vr(this.realtime),this.logger.log("laucher created"),this.startRealtime()}},q0=v=>{let h=new Po(v);return{subscribe:h.subscribeToPubSubEvent,unsubscribe:h.unsubscribeFromPubSubEvent,publish:h.publishToPubSubEvent,fetchHistory:h.fetchPubSubHistory,addComponent:h.addComponent,removeComponent:h.removeComponent}};export{q0 as Laucher};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
