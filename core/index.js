var Jv=Object.create;var Qr=Object.defineProperty,Qv=Object.defineProperties,$v=Object.getOwnPropertyDescriptor,qv=Object.getOwnPropertyDescriptors,Yv=Object.getOwnPropertyNames,vu=Object.getOwnPropertySymbols,Xv=Object.getPrototypeOf,yu=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable;var mu=(v,d,r)=>d in v?Qr(v,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[d]=r,Kt=(v,d)=>{for(var r in d||(d={}))yu.call(d,r)&&mu(v,r,d[r]);if(vu)for(var r of vu(d))Zv.call(d,r)&&mu(v,r,d[r]);return v},Qe=(v,d)=>Qv(v,qv(d));var Ro=(v,d)=>()=>(v&&(d=v(v=0)),d);var qt=(v,d)=>()=>(d||v((d={exports:{}}).exports,d),d.exports),Cu=(v,d)=>{for(var r in d)Qr(v,r,{get:d[r],enumerable:!0})},tm=(v,d,r,f)=>{if(d&&typeof d=="object"||typeof d=="function")for(let a of Yv(d))!yu.call(v,a)&&a!==r&&Qr(v,a,{get:()=>d[a],enumerable:!(f=$v(d,a))||f.enumerable});return v};var vn=(v,d,r)=>(r=v!=null?Jv(Xv(v)):{},tm(d||!v||!v.__esModule?Qr(r,"default",{value:v,enumerable:!0}):r,v));var Ft=(v,d,r)=>new Promise((f,a)=>{var _=P=>{try{I(r.next(P))}catch(G){a(G)}},S=P=>{try{I(r.throw(P))}catch(G){a(G)}},I=P=>P.done?f(P.value):Promise.resolve(P.value).then(_,S);I((r=r.apply(v,d)).next())});var At,st=Ro(()=>{At={}});var Ou=qt((y0,Au)=>{st();var Ln=1e3,Dn=Ln*60,Un=Dn*60,mn=Un*24,nm=mn*7,rm=mn*365.25;Au.exports=function(v,d){d=d||{};var r=typeof v;if(r==="string"&&v.length>0)return im(v);if(r==="number"&&isFinite(v))return d.long?am(v):om(v);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(v))};function im(v){if(v=String(v),!(v.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!d){var r=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return r*rm;case"weeks":case"week":case"w":return r*nm;case"days":case"day":case"d":return r*mn;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Un;case"minutes":case"minute":case"mins":case"min":case"m":return r*Dn;case"seconds":case"second":case"secs":case"sec":case"s":return r*Ln;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function om(v){var d=Math.abs(v);return d>=mn?Math.round(v/mn)+"d":d>=Un?Math.round(v/Un)+"h":d>=Dn?Math.round(v/Dn)+"m":d>=Ln?Math.round(v/Ln)+"s":v+"ms"}function am(v){var d=Math.abs(v);return d>=mn?$r(v,d,mn,"day"):d>=Un?$r(v,d,Un,"hour"):d>=Dn?$r(v,d,Dn,"minute"):d>=Ln?$r(v,d,Ln,"second"):v+" ms"}function $r(v,d,r,f){var a=d>=r*1.5;return Math.round(v/r)+" "+f+(a?"s":"")}});var bu=qt((C0,Ru)=>{st();function sm(v){r.debug=r,r.default=r,r.coerce=P,r.disable=_,r.enable=a,r.enabled=S,r.humanize=Ou(),r.destroy=G,Object.keys(v).forEach(b=>{r[b]=v[b]}),r.names=[],r.skips=[],r.formatters={};function d(b){let T=0;for(let u=0;u<b.length;u++)T=(T<<5)-T+b.charCodeAt(u),T|=0;return r.colors[Math.abs(T)%r.colors.length]}r.selectColor=d;function r(b){let T,u=null,A,M;function E(...m){if(!E.enabled)return;let p=E,y=Number(new Date),o=y-(T||y);p.diff=o,p.prev=T,p.curr=y,T=y,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let h=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(l,i)=>{if(l==="%%")return"%";h++;let g=r.formatters[i];if(typeof g=="function"){let O=m[h];l=g.call(p,O),m.splice(h,1),h--}return l}),r.formatArgs.call(p,m),(p.log||r.log).apply(p,m)}return E.namespace=b,E.useColors=r.useColors(),E.color=r.selectColor(b),E.extend=f,E.destroy=r.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(A!==r.namespaces&&(A=r.namespaces,M=r.enabled(b)),M),set:m=>{u=m}}),typeof r.init=="function"&&r.init(E),E}function f(b,T){let u=r(this.namespace+(typeof T=="undefined"?":":T)+b);return u.log=this.log,u}function a(b){r.save(b),r.namespaces=b,r.names=[],r.skips=[];let T,u=(typeof b=="string"?b:"").split(/[\s,]+/),A=u.length;for(T=0;T<A;T++)!u[T]||(b=u[T].replace(/\*/g,".*?"),b[0]==="-"?r.skips.push(new RegExp("^"+b.slice(1)+"$")):r.names.push(new RegExp("^"+b+"$")))}function _(){let b=[...r.names.map(I),...r.skips.map(I).map(T=>"-"+T)].join(",");return r.enable(""),b}function S(b){if(b[b.length-1]==="*")return!0;let T,u;for(T=0,u=r.skips.length;T<u;T++)if(r.skips[T].test(b))return!1;for(T=0,u=r.names.length;T<u;T++)if(r.names[T].test(b))return!0;return!1}function I(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}function P(b){return b instanceof Error?b.stack||b.message:b}function G(){}return r.enable(r.load()),r}Ru.exports=sm});var bo=qt((Oe,qr)=>{st();Oe.formatArgs=lm;Oe.save=cm;Oe.load=fm;Oe.useColors=um;Oe.storage=dm();Oe.destroy=(()=>{let v=!1;return()=>{v||(v=!0)}})();Oe.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function um(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function lm(v){if(v[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+v[0]+(this.useColors?"%c ":" ")+"+"+qr.exports.humanize(this.diff),!this.useColors)return;let d="color: "+this.color;v.splice(1,0,d,"color: inherit");let r=0,f=0;v[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(r++,a==="%c"&&(f=r))}),v.splice(f,0,d)}Oe.log=console.debug||console.log||(()=>{});function cm(v){try{v?Oe.storage.setItem("debug",v):Oe.storage.removeItem("debug")}catch(d){}}function fm(){let v;try{v=Oe.storage.getItem("debug")}catch(d){}return!v&&typeof process!="undefined"&&"env"in process&&(v=At.DEBUG),v}function dm(){try{return localStorage}catch(v){}}qr.exports=bu()(Oe);var{formatters:hm}=qr.exports;hm.j=function(v){try{return JSON.stringify(v)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}});var Yr=qt((b0,Su)=>{st();function pm(v){var d=typeof v;return v!=null&&(d=="object"||d=="function")}Su.exports=pm});var Eu=qt((T0,Iu)=>{st();var gm=typeof global=="object"&&global&&global.Object===Object&&global;Iu.exports=gm});var To=qt((S0,Pu)=>{st();var vm=Eu(),mm=typeof self=="object"&&self&&self.Object===Object&&self,ym=vm||mm||Function("return this")();Pu.exports=ym});var wu=qt((I0,_u)=>{st();var Cm=To(),Am=function(){return Cm.Date.now()};_u.exports=Am});var xu=qt((E0,Mu)=>{st();var Om=/\s/;function Rm(v){for(var d=v.length;d--&&Om.test(v.charAt(d)););return d}Mu.exports=Rm});var Du=qt((P0,Lu)=>{st();var bm=xu(),Tm=/^\s+/;function Sm(v){return v&&v.slice(0,bm(v)+1).replace(Tm,"")}Lu.exports=Sm});var So=qt((_0,Uu)=>{st();var Im=To(),Em=Im.Symbol;Uu.exports=Em});var Fu=qt((w0,Gu)=>{st();var Nu=So(),Bu=Object.prototype,Pm=Bu.hasOwnProperty,_m=Bu.toString,er=Nu?Nu.toStringTag:void 0;function wm(v){var d=Pm.call(v,er),r=v[er];try{v[er]=void 0;var f=!0}catch(_){}var a=_m.call(v);return f&&(d?v[er]=r:delete v[er]),a}Gu.exports=wm});var Wu=qt((M0,Hu)=>{st();var Mm=Object.prototype,xm=Mm.toString;function Lm(v){return xm.call(v)}Hu.exports=Lm});var Vu=qt((x0,ju)=>{st();var zu=So(),Dm=Fu(),Um=Wu(),Nm="[object Null]",Bm="[object Undefined]",ku=zu?zu.toStringTag:void 0;function Gm(v){return v==null?v===void 0?Bm:Nm:ku&&ku in Object(v)?Dm(v):Um(v)}ju.exports=Gm});var Ju=qt((L0,Ku)=>{st();function Fm(v){return v!=null&&typeof v=="object"}Ku.exports=Fm});var $u=qt((D0,Qu)=>{st();var Hm=Vu(),Wm=Ju(),zm="[object Symbol]";function km(v){return typeof v=="symbol"||Wm(v)&&Hm(v)==zm}Qu.exports=km});var Zu=qt((U0,Xu)=>{st();var jm=Du(),qu=Yr(),Vm=$u(),Yu=0/0,Km=/^[-+]0x[0-9a-f]+$/i,Jm=/^0b[01]+$/i,Qm=/^0o[0-7]+$/i,$m=parseInt;function qm(v){if(typeof v=="number")return v;if(Vm(v))return Yu;if(qu(v)){var d=typeof v.valueOf=="function"?v.valueOf():v;v=qu(d)?d+"":d}if(typeof v!="string")return v===0?v:+v;v=jm(v);var r=Jm.test(v);return r||Qm.test(v)?$m(v.slice(2),r?2:8):Km.test(v)?Yu:+v}Xu.exports=qm});var nl=qt((N0,el)=>{st();var Ym=Yr(),Io=wu(),tl=Zu(),Xm="Expected a function",Zm=Math.max,t0=Math.min;function e0(v,d,r){var f,a,_,S,I,P,G=0,b=!1,T=!1,u=!0;if(typeof v!="function")throw new TypeError(Xm);d=tl(d)||0,Ym(r)&&(b=!!r.leading,T="maxWait"in r,_=T?Zm(tl(r.maxWait)||0,d):_,u="trailing"in r?!!r.trailing:u);function A(l){var i=f,g=a;return f=a=void 0,G=l,S=v.apply(g,i),S}function M(l){return G=l,I=setTimeout(p,d),b?A(l):S}function E(l){var i=l-P,g=l-G,O=d-i;return T?t0(O,_-g):O}function m(l){var i=l-P,g=l-G;return P===void 0||i>=d||i<0||T&&g>=_}function p(){var l=Io();if(m(l))return y(l);I=setTimeout(p,E(l))}function y(l){return I=void 0,u&&f?A(l):(f=a=void 0,S)}function o(){I!==void 0&&clearTimeout(I),G=0,f=P=a=I=void 0}function h(){return I===void 0?S:y(Io())}function s(){var l=Io(),i=m(l);if(f=arguments,a=this,P=l,i){if(I===void 0)return M(P);if(T)return clearTimeout(I),I=setTimeout(p,d),A(P)}return I===void 0&&(I=setTimeout(p,d)),S}return s.cancel=o,s.flush=h,s}el.exports=e0});var Eo=qt((B0,rl)=>{st();var n0=nl(),r0=Yr(),i0="Expected a function";function o0(v,d,r){var f=!0,a=!0;if(typeof v!="function")throw new TypeError(i0);return r0(r)&&(f="leading"in r?!!r.leading:f,a="trailing"in r?!!r.trailing:a),n0(v,d,{leading:f,maxWait:d,trailing:a})}rl.exports=o0});var Po=qt((Nn,rr)=>{st();(function(){var v,d="4.17.21",r=200,f="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",_="Invalid `variable` option passed into `_.template`",S="__lodash_hash_undefined__",I=500,P="__lodash_placeholder__",G=1,b=2,T=4,u=1,A=2,M=1,E=2,m=4,p=8,y=16,o=32,h=64,s=128,l=256,i=512,g=30,O="...",D=800,z=16,H=1,U=2,C=3,w=1/0,k=9007199254740991,W=17976931348623157e292,Q=0/0,Z=4294967295,q=Z-1,F=Z>>>1,L=[["ary",s],["bind",M],["bindKey",E],["curry",p],["curryRight",y],["flip",i],["partial",o],["partialRight",h],["rearg",l]],N="[object Arguments]",K="[object Array]",V="[object AsyncFunction]",tt="[object Boolean]",lt="[object Date]",vt="[object DOMException]",gt="[object Error]",bt="[object Function]",xt="[object GeneratorFunction]",ft="[object Map]",Mt="[object Number]",Zt="[object Null]",Bt="[object Object]",zt="[object Promise]",ce="[object Proxy]",X="[object RegExp]",rt="[object Set]",ut="[object String]",ht="[object Symbol]",St="[object Undefined]",$t="[object WeakMap]",an="[object WeakSet]",Fn="[object ArrayBuffer]",Cn="[object DataView]",ti="[object Float32Array]",ei="[object Float64Array]",ni="[object Int8Array]",ri="[object Int16Array]",ii="[object Int32Array]",oi="[object Uint8Array]",ai="[object Uint8ClampedArray]",si="[object Uint16Array]",ui="[object Uint32Array]",hl=/\b__p \+= '';/g,pl=/\b(__p \+=) '' \+/g,gl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wo=/&(?:amp|lt|gt|quot|#39);/g,zo=/[&<>"']/g,vl=RegExp(Wo.source),ml=RegExp(zo.source),yl=/<%-([\s\S]+?)%>/g,Cl=/<%([\s\S]+?)%>/g,ko=/<%=([\s\S]+?)%>/g,Al=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ol=/^\w*$/,Rl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,li=/[\\^$.*+?()[\]{}|]/g,bl=RegExp(li.source),ci=/^\s+/,Tl=/\s/,Sl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Il=/\{\n\/\* \[wrapped with (.+)\] \*/,El=/,? & /,Pl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,_l=/[()=,{}\[\]\/\s]/,wl=/\\(\\)?/g,Ml=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jo=/\w*$/,xl=/^[-+]0x[0-9a-f]+$/i,Ll=/^0b[01]+$/i,Dl=/^\[object .+?Constructor\]$/,Ul=/^0o[0-7]+$/i,Nl=/^(?:0|[1-9]\d*)$/,Bl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ar=/($^)/,Gl=/['\n\r\u2028\u2029\\]/g,sr="\\ud800-\\udfff",Fl="\\u0300-\\u036f",Hl="\\ufe20-\\ufe2f",Wl="\\u20d0-\\u20ff",Vo=Fl+Hl+Wl,Ko="\\u2700-\\u27bf",Jo="a-z\\xdf-\\xf6\\xf8-\\xff",zl="\\xac\\xb1\\xd7\\xf7",kl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",jl="\\u2000-\\u206f",Vl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qo="A-Z\\xc0-\\xd6\\xd8-\\xde",$o="\\ufe0e\\ufe0f",qo=zl+kl+jl+Vl,fi="['\u2019]",Kl="["+sr+"]",Yo="["+qo+"]",ur="["+Vo+"]",Xo="\\d+",Jl="["+Ko+"]",Zo="["+Jo+"]",ta="[^"+sr+qo+Xo+Ko+Jo+Qo+"]",di="\\ud83c[\\udffb-\\udfff]",Ql="(?:"+ur+"|"+di+")",ea="[^"+sr+"]",hi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",An="["+Qo+"]",na="\\u200d",ra="(?:"+Zo+"|"+ta+")",$l="(?:"+An+"|"+ta+")",ia="(?:"+fi+"(?:d|ll|m|re|s|t|ve))?",oa="(?:"+fi+"(?:D|LL|M|RE|S|T|VE))?",aa=Ql+"?",sa="["+$o+"]?",ql="(?:"+na+"(?:"+[ea,hi,pi].join("|")+")"+sa+aa+")*",Yl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Xl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ua=sa+aa+ql,Zl="(?:"+[Jl,hi,pi].join("|")+")"+ua,tc="(?:"+[ea+ur+"?",ur,hi,pi,Kl].join("|")+")",ec=RegExp(fi,"g"),nc=RegExp(ur,"g"),gi=RegExp(di+"(?="+di+")|"+tc+ua,"g"),rc=RegExp([An+"?"+Zo+"+"+ia+"(?="+[Yo,An,"$"].join("|")+")",$l+"+"+oa+"(?="+[Yo,An+ra,"$"].join("|")+")",An+"?"+ra+"+"+ia,An+"+"+oa,Xl,Yl,Xo,Zl].join("|"),"g"),ic=RegExp("["+na+sr+Vo+$o+"]"),oc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ac=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],sc=-1,Wt={};Wt[ti]=Wt[ei]=Wt[ni]=Wt[ri]=Wt[ii]=Wt[oi]=Wt[ai]=Wt[si]=Wt[ui]=!0,Wt[N]=Wt[K]=Wt[Fn]=Wt[tt]=Wt[Cn]=Wt[lt]=Wt[gt]=Wt[bt]=Wt[ft]=Wt[Mt]=Wt[Bt]=Wt[X]=Wt[rt]=Wt[ut]=Wt[$t]=!1;var Ht={};Ht[N]=Ht[K]=Ht[Fn]=Ht[Cn]=Ht[tt]=Ht[lt]=Ht[ti]=Ht[ei]=Ht[ni]=Ht[ri]=Ht[ii]=Ht[ft]=Ht[Mt]=Ht[Bt]=Ht[X]=Ht[rt]=Ht[ut]=Ht[ht]=Ht[oi]=Ht[ai]=Ht[si]=Ht[ui]=!0,Ht[gt]=Ht[bt]=Ht[$t]=!1;var uc={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},fc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dc=parseFloat,hc=parseInt,la=typeof global=="object"&&global&&global.Object===Object&&global,pc=typeof self=="object"&&self&&self.Object===Object&&self,te=la||pc||Function("return this")(),vi=typeof Nn=="object"&&Nn&&!Nn.nodeType&&Nn,sn=vi&&typeof rr=="object"&&rr&&!rr.nodeType&&rr,ca=sn&&sn.exports===vi,mi=ca&&la.process,Re=function(){try{var $=sn&&sn.require&&sn.require("util").types;return $||mi&&mi.binding&&mi.binding("util")}catch(nt){}}(),fa=Re&&Re.isArrayBuffer,da=Re&&Re.isDate,ha=Re&&Re.isMap,pa=Re&&Re.isRegExp,ga=Re&&Re.isSet,va=Re&&Re.isTypedArray;function ge($,nt,et){switch(et.length){case 0:return $.call(nt);case 1:return $.call(nt,et[0]);case 2:return $.call(nt,et[0],et[1]);case 3:return $.call(nt,et[0],et[1],et[2])}return $.apply(nt,et)}function gc($,nt,et,dt){for(var Ot=-1,Lt=$==null?0:$.length;++Ot<Lt;){var Yt=$[Ot];nt(dt,Yt,et(Yt),$)}return dt}function be($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt&&nt($[et],et,$)!==!1;);return $}function vc($,nt){for(var et=$==null?0:$.length;et--&&nt($[et],et,$)!==!1;);return $}function ma($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt;)if(!nt($[et],et,$))return!1;return!0}function $e($,nt){for(var et=-1,dt=$==null?0:$.length,Ot=0,Lt=[];++et<dt;){var Yt=$[et];nt(Yt,et,$)&&(Lt[Ot++]=Yt)}return Lt}function lr($,nt){var et=$==null?0:$.length;return!!et&&On($,nt,0)>-1}function yi($,nt,et){for(var dt=-1,Ot=$==null?0:$.length;++dt<Ot;)if(et(nt,$[dt]))return!0;return!1}function kt($,nt){for(var et=-1,dt=$==null?0:$.length,Ot=Array(dt);++et<dt;)Ot[et]=nt($[et],et,$);return Ot}function qe($,nt){for(var et=-1,dt=nt.length,Ot=$.length;++et<dt;)$[Ot+et]=nt[et];return $}function Ci($,nt,et,dt){var Ot=-1,Lt=$==null?0:$.length;for(dt&&Lt&&(et=$[++Ot]);++Ot<Lt;)et=nt(et,$[Ot],Ot,$);return et}function mc($,nt,et,dt){var Ot=$==null?0:$.length;for(dt&&Ot&&(et=$[--Ot]);Ot--;)et=nt(et,$[Ot],Ot,$);return et}function Ai($,nt){for(var et=-1,dt=$==null?0:$.length;++et<dt;)if(nt($[et],et,$))return!0;return!1}var yc=Oi("length");function Cc($){return $.split("")}function Ac($){return $.match(Pl)||[]}function ya($,nt,et){var dt;return et($,function(Ot,Lt,Yt){if(nt(Ot,Lt,Yt))return dt=Lt,!1}),dt}function cr($,nt,et,dt){for(var Ot=$.length,Lt=et+(dt?1:-1);dt?Lt--:++Lt<Ot;)if(nt($[Lt],Lt,$))return Lt;return-1}function On($,nt,et){return nt===nt?xc($,nt,et):cr($,Ca,et)}function Oc($,nt,et,dt){for(var Ot=et-1,Lt=$.length;++Ot<Lt;)if(dt($[Ot],nt))return Ot;return-1}function Ca($){return $!==$}function Aa($,nt){var et=$==null?0:$.length;return et?bi($,nt)/et:Q}function Oi($){return function(nt){return nt==null?v:nt[$]}}function Ri($){return function(nt){return $==null?v:$[nt]}}function Oa($,nt,et,dt,Ot){return Ot($,function(Lt,Yt,Gt){et=dt?(dt=!1,Lt):nt(et,Lt,Yt,Gt)}),et}function Rc($,nt){var et=$.length;for($.sort(nt);et--;)$[et]=$[et].value;return $}function bi($,nt){for(var et,dt=-1,Ot=$.length;++dt<Ot;){var Lt=nt($[dt]);Lt!==v&&(et=et===v?Lt:et+Lt)}return et}function Ti($,nt){for(var et=-1,dt=Array($);++et<$;)dt[et]=nt(et);return dt}function bc($,nt){return kt(nt,function(et){return[et,$[et]]})}function Ra($){return $&&$.slice(0,Ia($)+1).replace(ci,"")}function ve($){return function(nt){return $(nt)}}function Si($,nt){return kt(nt,function(et){return $[et]})}function Hn($,nt){return $.has(nt)}function ba($,nt){for(var et=-1,dt=$.length;++et<dt&&On(nt,$[et],0)>-1;);return et}function Ta($,nt){for(var et=$.length;et--&&On(nt,$[et],0)>-1;);return et}function Tc($,nt){for(var et=$.length,dt=0;et--;)$[et]===nt&&++dt;return dt}var Sc=Ri(uc),Ic=Ri(lc);function Ec($){return"\\"+fc[$]}function Pc($,nt){return $==null?v:$[nt]}function Rn($){return ic.test($)}function _c($){return oc.test($)}function wc($){for(var nt,et=[];!(nt=$.next()).done;)et.push(nt.value);return et}function Ii($){var nt=-1,et=Array($.size);return $.forEach(function(dt,Ot){et[++nt]=[Ot,dt]}),et}function Sa($,nt){return function(et){return $(nt(et))}}function Ye($,nt){for(var et=-1,dt=$.length,Ot=0,Lt=[];++et<dt;){var Yt=$[et];(Yt===nt||Yt===P)&&($[et]=P,Lt[Ot++]=et)}return Lt}function fr($){var nt=-1,et=Array($.size);return $.forEach(function(dt){et[++nt]=dt}),et}function Mc($){var nt=-1,et=Array($.size);return $.forEach(function(dt){et[++nt]=[dt,dt]}),et}function xc($,nt,et){for(var dt=et-1,Ot=$.length;++dt<Ot;)if($[dt]===nt)return dt;return-1}function Lc($,nt,et){for(var dt=et+1;dt--;)if($[dt]===nt)return dt;return dt}function bn($){return Rn($)?Uc($):yc($)}function we($){return Rn($)?Nc($):Cc($)}function Ia($){for(var nt=$.length;nt--&&Tl.test($.charAt(nt)););return nt}var Dc=Ri(cc);function Uc($){for(var nt=gi.lastIndex=0;gi.test($);)++nt;return nt}function Nc($){return $.match(gi)||[]}function Bc($){return $.match(rc)||[]}var Gc=function $(nt){nt=nt==null?te:Xe.defaults(te.Object(),nt,Xe.pick(te,ac));var et=nt.Array,dt=nt.Date,Ot=nt.Error,Lt=nt.Function,Yt=nt.Math,Gt=nt.Object,Ei=nt.RegExp,Fc=nt.String,Te=nt.TypeError,dr=et.prototype,Hc=Lt.prototype,Tn=Gt.prototype,hr=nt["__core-js_shared__"],pr=Hc.toString,Ut=Tn.hasOwnProperty,Wc=0,Ea=function(){var t=/[^.]+$/.exec(hr&&hr.keys&&hr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),gr=Tn.toString,zc=pr.call(Gt),kc=te._,jc=Ei("^"+pr.call(Ut).replace(li,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vr=ca?nt.Buffer:v,Ze=nt.Symbol,mr=nt.Uint8Array,Pa=vr?vr.allocUnsafe:v,yr=Sa(Gt.getPrototypeOf,Gt),_a=Gt.create,wa=Tn.propertyIsEnumerable,Cr=dr.splice,Ma=Ze?Ze.isConcatSpreadable:v,Wn=Ze?Ze.iterator:v,un=Ze?Ze.toStringTag:v,Ar=function(){try{var t=hn(Gt,"defineProperty");return t({},"",{}),t}catch(e){}}(),Vc=nt.clearTimeout!==te.clearTimeout&&nt.clearTimeout,Kc=dt&&dt.now!==te.Date.now&&dt.now,Jc=nt.setTimeout!==te.setTimeout&&nt.setTimeout,Or=Yt.ceil,Rr=Yt.floor,Pi=Gt.getOwnPropertySymbols,Qc=vr?vr.isBuffer:v,xa=nt.isFinite,$c=dr.join,qc=Sa(Gt.keys,Gt),Xt=Yt.max,ie=Yt.min,Yc=dt.now,Xc=nt.parseInt,La=Yt.random,Zc=dr.reverse,_i=hn(nt,"DataView"),zn=hn(nt,"Map"),wi=hn(nt,"Promise"),Sn=hn(nt,"Set"),kn=hn(nt,"WeakMap"),jn=hn(Gt,"create"),br=kn&&new kn,In={},tf=pn(_i),ef=pn(zn),nf=pn(wi),rf=pn(Sn),of=pn(kn),Tr=Ze?Ze.prototype:v,Vn=Tr?Tr.valueOf:v,Da=Tr?Tr.toString:v;function x(t){if(Vt(t)&&!Rt(t)&&!(t instanceof _t)){if(t instanceof Se)return t;if(Ut.call(t,"__wrapped__"))return Us(t)}return new Se(t)}var En=function(){function t(){}return function(e){if(!jt(e))return{};if(_a)return _a(e);t.prototype=e;var n=new t;return t.prototype=v,n}}();function Sr(){}function Se(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=v}x.templateSettings={escape:yl,evaluate:Cl,interpolate:ko,variable:"",imports:{_:x}},x.prototype=Sr.prototype,x.prototype.constructor=x,Se.prototype=En(Sr.prototype),Se.prototype.constructor=Se;function _t(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function af(){var t=new _t(this.__wrapped__);return t.__actions__=fe(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=fe(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=fe(this.__views__),t}function sf(){if(this.__filtered__){var t=new _t(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function uf(){var t=this.__wrapped__.value(),e=this.__dir__,n=Rt(t),c=e<0,R=n?t.length:0,B=Ad(0,R,this.__views__),j=B.start,J=B.end,Y=J-j,it=c?J:j-1,ot=this.__iteratees__,at=ot.length,ct=0,pt=ie(Y,this.__takeCount__);if(!n||!c&&R==Y&&pt==Y)return is(t,this.__actions__);var yt=[];t:for(;Y--&&ct<pt;){it+=e;for(var It=-1,Ct=t[it];++It<at;){var Pt=ot[It],wt=Pt.iteratee,Ce=Pt.type,le=wt(Ct);if(Ce==U)Ct=le;else if(!le){if(Ce==H)continue t;break t}}yt[ct++]=Ct}return yt}_t.prototype=En(Sr.prototype),_t.prototype.constructor=_t;function ln(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var c=t[e];this.set(c[0],c[1])}}function lf(){this.__data__=jn?jn(null):{},this.size=0}function cf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function ff(t){var e=this.__data__;if(jn){var n=e[t];return n===S?v:n}return Ut.call(e,t)?e[t]:v}function df(t){var e=this.__data__;return jn?e[t]!==v:Ut.call(e,t)}function hf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=jn&&e===v?S:e,this}ln.prototype.clear=lf,ln.prototype.delete=cf,ln.prototype.get=ff,ln.prototype.has=df,ln.prototype.set=hf;function Fe(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var c=t[e];this.set(c[0],c[1])}}function pf(){this.__data__=[],this.size=0}function gf(t){var e=this.__data__,n=Ir(e,t);if(n<0)return!1;var c=e.length-1;return n==c?e.pop():Cr.call(e,n,1),--this.size,!0}function vf(t){var e=this.__data__,n=Ir(e,t);return n<0?v:e[n][1]}function mf(t){return Ir(this.__data__,t)>-1}function yf(t,e){var n=this.__data__,c=Ir(n,t);return c<0?(++this.size,n.push([t,e])):n[c][1]=e,this}Fe.prototype.clear=pf,Fe.prototype.delete=gf,Fe.prototype.get=vf,Fe.prototype.has=mf,Fe.prototype.set=yf;function He(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var c=t[e];this.set(c[0],c[1])}}function Cf(){this.size=0,this.__data__={hash:new ln,map:new(zn||Fe),string:new ln}}function Af(t){var e=Gr(this,t).delete(t);return this.size-=e?1:0,e}function Of(t){return Gr(this,t).get(t)}function Rf(t){return Gr(this,t).has(t)}function bf(t,e){var n=Gr(this,t),c=n.size;return n.set(t,e),this.size+=n.size==c?0:1,this}He.prototype.clear=Cf,He.prototype.delete=Af,He.prototype.get=Of,He.prototype.has=Rf,He.prototype.set=bf;function cn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new He;++e<n;)this.add(t[e])}function Tf(t){return this.__data__.set(t,S),this}function Sf(t){return this.__data__.has(t)}cn.prototype.add=cn.prototype.push=Tf,cn.prototype.has=Sf;function Me(t){var e=this.__data__=new Fe(t);this.size=e.size}function If(){this.__data__=new Fe,this.size=0}function Ef(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Pf(t){return this.__data__.get(t)}function _f(t){return this.__data__.has(t)}function wf(t,e){var n=this.__data__;if(n instanceof Fe){var c=n.__data__;if(!zn||c.length<r-1)return c.push([t,e]),this.size=++n.size,this;n=this.__data__=new He(c)}return n.set(t,e),this.size=n.size,this}Me.prototype.clear=If,Me.prototype.delete=Ef,Me.prototype.get=Pf,Me.prototype.has=_f,Me.prototype.set=wf;function Ua(t,e){var n=Rt(t),c=!n&&gn(t),R=!n&&!c&&on(t),B=!n&&!c&&!R&&Mn(t),j=n||c||R||B,J=j?Ti(t.length,Fc):[],Y=J.length;for(var it in t)(e||Ut.call(t,it))&&!(j&&(it=="length"||R&&(it=="offset"||it=="parent")||B&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||je(it,Y)))&&J.push(it);return J}function Na(t){var e=t.length;return e?t[Wi(0,e-1)]:v}function Mf(t,e){return Fr(fe(t),fn(e,0,t.length))}function xf(t){return Fr(fe(t))}function Mi(t,e,n){(n!==v&&!xe(t[e],n)||n===v&&!(e in t))&&We(t,e,n)}function Kn(t,e,n){var c=t[e];(!(Ut.call(t,e)&&xe(c,n))||n===v&&!(e in t))&&We(t,e,n)}function Ir(t,e){for(var n=t.length;n--;)if(xe(t[n][0],e))return n;return-1}function Lf(t,e,n,c){return tn(t,function(R,B,j){e(c,R,n(R),j)}),c}function Ba(t,e){return t&&Be(e,ee(e),t)}function Df(t,e){return t&&Be(e,he(e),t)}function We(t,e,n){e=="__proto__"&&Ar?Ar(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function xi(t,e){for(var n=-1,c=e.length,R=et(c),B=t==null;++n<c;)R[n]=B?v:ho(t,e[n]);return R}function fn(t,e,n){return t===t&&(n!==v&&(t=t<=n?t:n),e!==v&&(t=t>=e?t:e)),t}function Ie(t,e,n,c,R,B){var j,J=e&G,Y=e&b,it=e&T;if(n&&(j=R?n(t,c,R,B):n(t)),j!==v)return j;if(!jt(t))return t;var ot=Rt(t);if(ot){if(j=Rd(t),!J)return fe(t,j)}else{var at=oe(t),ct=at==bt||at==xt;if(on(t))return ss(t,J);if(at==Bt||at==N||ct&&!R){if(j=Y||ct?{}:Is(t),!J)return Y?fd(t,Df(j,t)):cd(t,Ba(j,t))}else{if(!Ht[at])return R?t:{};j=bd(t,at,J)}}B||(B=new Me);var pt=B.get(t);if(pt)return pt;B.set(t,j),eu(t)?t.forEach(function(Ct){j.add(Ie(Ct,e,n,Ct,t,B))}):Zs(t)&&t.forEach(function(Ct,Pt){j.set(Pt,Ie(Ct,e,n,Pt,t,B))});var yt=it?Y?Xi:Yi:Y?he:ee,It=ot?v:yt(t);return be(It||t,function(Ct,Pt){It&&(Pt=Ct,Ct=t[Pt]),Kn(j,Pt,Ie(Ct,e,n,Pt,t,B))}),j}function Uf(t){var e=ee(t);return function(n){return Ga(n,t,e)}}function Ga(t,e,n){var c=n.length;if(t==null)return!c;for(t=Gt(t);c--;){var R=n[c],B=e[R],j=t[R];if(j===v&&!(R in t)||!B(j))return!1}return!0}function Fa(t,e,n){if(typeof t!="function")throw new Te(a);return Zn(function(){t.apply(v,n)},e)}function Jn(t,e,n,c){var R=-1,B=lr,j=!0,J=t.length,Y=[],it=e.length;if(!J)return Y;n&&(e=kt(e,ve(n))),c?(B=yi,j=!1):e.length>=r&&(B=Hn,j=!1,e=new cn(e));t:for(;++R<J;){var ot=t[R],at=n==null?ot:n(ot);if(ot=c||ot!==0?ot:0,j&&at===at){for(var ct=it;ct--;)if(e[ct]===at)continue t;Y.push(ot)}else B(e,at,c)||Y.push(ot)}return Y}var tn=ds(Ne),Ha=ds(Di,!0);function Nf(t,e){var n=!0;return tn(t,function(c,R,B){return n=!!e(c,R,B),n}),n}function Er(t,e,n){for(var c=-1,R=t.length;++c<R;){var B=t[c],j=e(B);if(j!=null&&(J===v?j===j&&!ye(j):n(j,J)))var J=j,Y=B}return Y}function Bf(t,e,n,c){var R=t.length;for(n=Tt(n),n<0&&(n=-n>R?0:R+n),c=c===v||c>R?R:Tt(c),c<0&&(c+=R),c=n>c?0:ru(c);n<c;)t[n++]=e;return t}function Wa(t,e){var n=[];return tn(t,function(c,R,B){e(c,R,B)&&n.push(c)}),n}function ne(t,e,n,c,R){var B=-1,j=t.length;for(n||(n=Sd),R||(R=[]);++B<j;){var J=t[B];e>0&&n(J)?e>1?ne(J,e-1,n,c,R):qe(R,J):c||(R[R.length]=J)}return R}var Li=hs(),za=hs(!0);function Ne(t,e){return t&&Li(t,e,ee)}function Di(t,e){return t&&za(t,e,ee)}function Pr(t,e){return $e(e,function(n){return Ve(t[n])})}function dn(t,e){e=nn(e,t);for(var n=0,c=e.length;t!=null&&n<c;)t=t[Ge(e[n++])];return n&&n==c?t:v}function ka(t,e,n){var c=e(t);return Rt(t)?c:qe(c,n(t))}function se(t){return t==null?t===v?St:Zt:un&&un in Gt(t)?Cd(t):xd(t)}function Ui(t,e){return t>e}function Gf(t,e){return t!=null&&Ut.call(t,e)}function Ff(t,e){return t!=null&&e in Gt(t)}function Hf(t,e,n){return t>=ie(e,n)&&t<Xt(e,n)}function Ni(t,e,n){for(var c=n?yi:lr,R=t[0].length,B=t.length,j=B,J=et(B),Y=1/0,it=[];j--;){var ot=t[j];j&&e&&(ot=kt(ot,ve(e))),Y=ie(ot.length,Y),J[j]=!n&&(e||R>=120&&ot.length>=120)?new cn(j&&ot):v}ot=t[0];var at=-1,ct=J[0];t:for(;++at<R&&it.length<Y;){var pt=ot[at],yt=e?e(pt):pt;if(pt=n||pt!==0?pt:0,!(ct?Hn(ct,yt):c(it,yt,n))){for(j=B;--j;){var It=J[j];if(!(It?Hn(It,yt):c(t[j],yt,n)))continue t}ct&&ct.push(yt),it.push(pt)}}return it}function Wf(t,e,n,c){return Ne(t,function(R,B,j){e(c,n(R),B,j)}),c}function Qn(t,e,n){e=nn(e,t),t=ws(t,e);var c=t==null?t:t[Ge(Pe(e))];return c==null?v:ge(c,t,n)}function ja(t){return Vt(t)&&se(t)==N}function zf(t){return Vt(t)&&se(t)==Fn}function kf(t){return Vt(t)&&se(t)==lt}function $n(t,e,n,c,R){return t===e?!0:t==null||e==null||!Vt(t)&&!Vt(e)?t!==t&&e!==e:jf(t,e,n,c,$n,R)}function jf(t,e,n,c,R,B){var j=Rt(t),J=Rt(e),Y=j?K:oe(t),it=J?K:oe(e);Y=Y==N?Bt:Y,it=it==N?Bt:it;var ot=Y==Bt,at=it==Bt,ct=Y==it;if(ct&&on(t)){if(!on(e))return!1;j=!0,ot=!1}if(ct&&!ot)return B||(B=new Me),j||Mn(t)?bs(t,e,n,c,R,B):md(t,e,Y,n,c,R,B);if(!(n&u)){var pt=ot&&Ut.call(t,"__wrapped__"),yt=at&&Ut.call(e,"__wrapped__");if(pt||yt){var It=pt?t.value():t,Ct=yt?e.value():e;return B||(B=new Me),R(It,Ct,n,c,B)}}return ct?(B||(B=new Me),yd(t,e,n,c,R,B)):!1}function Vf(t){return Vt(t)&&oe(t)==ft}function Bi(t,e,n,c){var R=n.length,B=R,j=!c;if(t==null)return!B;for(t=Gt(t);R--;){var J=n[R];if(j&&J[2]?J[1]!==t[J[0]]:!(J[0]in t))return!1}for(;++R<B;){J=n[R];var Y=J[0],it=t[Y],ot=J[1];if(j&&J[2]){if(it===v&&!(Y in t))return!1}else{var at=new Me;if(c)var ct=c(it,ot,Y,t,e,at);if(!(ct===v?$n(ot,it,u|A,c,at):ct))return!1}}return!0}function Va(t){if(!jt(t)||Ed(t))return!1;var e=Ve(t)?jc:Dl;return e.test(pn(t))}function Kf(t){return Vt(t)&&se(t)==X}function Jf(t){return Vt(t)&&oe(t)==rt}function Qf(t){return Vt(t)&&Vr(t.length)&&!!Wt[se(t)]}function Ka(t){return typeof t=="function"?t:t==null?pe:typeof t=="object"?Rt(t)?$a(t[0],t[1]):Qa(t):pu(t)}function Gi(t){if(!Xn(t))return qc(t);var e=[];for(var n in Gt(t))Ut.call(t,n)&&n!="constructor"&&e.push(n);return e}function $f(t){if(!jt(t))return Md(t);var e=Xn(t),n=[];for(var c in t)c=="constructor"&&(e||!Ut.call(t,c))||n.push(c);return n}function Fi(t,e){return t<e}function Ja(t,e){var n=-1,c=de(t)?et(t.length):[];return tn(t,function(R,B,j){c[++n]=e(R,B,j)}),c}function Qa(t){var e=to(t);return e.length==1&&e[0][2]?Ps(e[0][0],e[0][1]):function(n){return n===t||Bi(n,t,e)}}function $a(t,e){return no(t)&&Es(e)?Ps(Ge(t),e):function(n){var c=ho(n,t);return c===v&&c===e?po(n,t):$n(e,c,u|A)}}function _r(t,e,n,c,R){t!==e&&Li(e,function(B,j){if(R||(R=new Me),jt(B))qf(t,e,j,n,_r,c,R);else{var J=c?c(io(t,j),B,j+"",t,e,R):v;J===v&&(J=B),Mi(t,j,J)}},he)}function qf(t,e,n,c,R,B,j){var J=io(t,n),Y=io(e,n),it=j.get(Y);if(it){Mi(t,n,it);return}var ot=B?B(J,Y,n+"",t,e,j):v,at=ot===v;if(at){var ct=Rt(Y),pt=!ct&&on(Y),yt=!ct&&!pt&&Mn(Y);ot=Y,ct||pt||yt?Rt(J)?ot=J:Jt(J)?ot=fe(J):pt?(at=!1,ot=ss(Y,!0)):yt?(at=!1,ot=us(Y,!0)):ot=[]:tr(Y)||gn(Y)?(ot=J,gn(J)?ot=iu(J):(!jt(J)||Ve(J))&&(ot=Is(Y))):at=!1}at&&(j.set(Y,ot),R(ot,Y,c,B,j),j.delete(Y)),Mi(t,n,ot)}function qa(t,e){var n=t.length;if(!!n)return e+=e<0?n:0,je(e,n)?t[e]:v}function Ya(t,e,n){e.length?e=kt(e,function(B){return Rt(B)?function(j){return dn(j,B.length===1?B[0]:B)}:B}):e=[pe];var c=-1;e=kt(e,ve(mt()));var R=Ja(t,function(B,j,J){var Y=kt(e,function(it){return it(B)});return{criteria:Y,index:++c,value:B}});return Rc(R,function(B,j){return ld(B,j,n)})}function Yf(t,e){return Xa(t,e,function(n,c){return po(t,c)})}function Xa(t,e,n){for(var c=-1,R=e.length,B={};++c<R;){var j=e[c],J=dn(t,j);n(J,j)&&qn(B,nn(j,t),J)}return B}function Xf(t){return function(e){return dn(e,t)}}function Hi(t,e,n,c){var R=c?Oc:On,B=-1,j=e.length,J=t;for(t===e&&(e=fe(e)),n&&(J=kt(t,ve(n)));++B<j;)for(var Y=0,it=e[B],ot=n?n(it):it;(Y=R(J,ot,Y,c))>-1;)J!==t&&Cr.call(J,Y,1),Cr.call(t,Y,1);return t}function Za(t,e){for(var n=t?e.length:0,c=n-1;n--;){var R=e[n];if(n==c||R!==B){var B=R;je(R)?Cr.call(t,R,1):ji(t,R)}}return t}function Wi(t,e){return t+Rr(La()*(e-t+1))}function Zf(t,e,n,c){for(var R=-1,B=Xt(Or((e-t)/(n||1)),0),j=et(B);B--;)j[c?B:++R]=t,t+=n;return j}function zi(t,e){var n="";if(!t||e<1||e>k)return n;do e%2&&(n+=t),e=Rr(e/2),e&&(t+=t);while(e);return n}function Et(t,e){return oo(_s(t,e,pe),t+"")}function td(t){return Na(xn(t))}function ed(t,e){var n=xn(t);return Fr(n,fn(e,0,n.length))}function qn(t,e,n,c){if(!jt(t))return t;e=nn(e,t);for(var R=-1,B=e.length,j=B-1,J=t;J!=null&&++R<B;){var Y=Ge(e[R]),it=n;if(Y==="__proto__"||Y==="constructor"||Y==="prototype")return t;if(R!=j){var ot=J[Y];it=c?c(ot,Y,J):v,it===v&&(it=jt(ot)?ot:je(e[R+1])?[]:{})}Kn(J,Y,it),J=J[Y]}return t}var ts=br?function(t,e){return br.set(t,e),t}:pe,nd=Ar?function(t,e){return Ar(t,"toString",{configurable:!0,enumerable:!1,value:vo(e),writable:!0})}:pe;function rd(t){return Fr(xn(t))}function Ee(t,e,n){var c=-1,R=t.length;e<0&&(e=-e>R?0:R+e),n=n>R?R:n,n<0&&(n+=R),R=e>n?0:n-e>>>0,e>>>=0;for(var B=et(R);++c<R;)B[c]=t[c+e];return B}function id(t,e){var n;return tn(t,function(c,R,B){return n=e(c,R,B),!n}),!!n}function wr(t,e,n){var c=0,R=t==null?c:t.length;if(typeof e=="number"&&e===e&&R<=F){for(;c<R;){var B=c+R>>>1,j=t[B];j!==null&&!ye(j)&&(n?j<=e:j<e)?c=B+1:R=B}return R}return ki(t,e,pe,n)}function ki(t,e,n,c){var R=0,B=t==null?0:t.length;if(B===0)return 0;e=n(e);for(var j=e!==e,J=e===null,Y=ye(e),it=e===v;R<B;){var ot=Rr((R+B)/2),at=n(t[ot]),ct=at!==v,pt=at===null,yt=at===at,It=ye(at);if(j)var Ct=c||yt;else it?Ct=yt&&(c||ct):J?Ct=yt&&ct&&(c||!pt):Y?Ct=yt&&ct&&!pt&&(c||!It):pt||It?Ct=!1:Ct=c?at<=e:at<e;Ct?R=ot+1:B=ot}return ie(B,q)}function es(t,e){for(var n=-1,c=t.length,R=0,B=[];++n<c;){var j=t[n],J=e?e(j):j;if(!n||!xe(J,Y)){var Y=J;B[R++]=j===0?0:j}}return B}function ns(t){return typeof t=="number"?t:ye(t)?Q:+t}function me(t){if(typeof t=="string")return t;if(Rt(t))return kt(t,me)+"";if(ye(t))return Da?Da.call(t):"";var e=t+"";return e=="0"&&1/t==-w?"-0":e}function en(t,e,n){var c=-1,R=lr,B=t.length,j=!0,J=[],Y=J;if(n)j=!1,R=yi;else if(B>=r){var it=e?null:gd(t);if(it)return fr(it);j=!1,R=Hn,Y=new cn}else Y=e?[]:J;t:for(;++c<B;){var ot=t[c],at=e?e(ot):ot;if(ot=n||ot!==0?ot:0,j&&at===at){for(var ct=Y.length;ct--;)if(Y[ct]===at)continue t;e&&Y.push(at),J.push(ot)}else R(Y,at,n)||(Y!==J&&Y.push(at),J.push(ot))}return J}function ji(t,e){return e=nn(e,t),t=ws(t,e),t==null||delete t[Ge(Pe(e))]}function rs(t,e,n,c){return qn(t,e,n(dn(t,e)),c)}function Mr(t,e,n,c){for(var R=t.length,B=c?R:-1;(c?B--:++B<R)&&e(t[B],B,t););return n?Ee(t,c?0:B,c?B+1:R):Ee(t,c?B+1:0,c?R:B)}function is(t,e){var n=t;return n instanceof _t&&(n=n.value()),Ci(e,function(c,R){return R.func.apply(R.thisArg,qe([c],R.args))},n)}function Vi(t,e,n){var c=t.length;if(c<2)return c?en(t[0]):[];for(var R=-1,B=et(c);++R<c;)for(var j=t[R],J=-1;++J<c;)J!=R&&(B[R]=Jn(B[R]||j,t[J],e,n));return en(ne(B,1),e,n)}function os(t,e,n){for(var c=-1,R=t.length,B=e.length,j={};++c<R;){var J=c<B?e[c]:v;n(j,t[c],J)}return j}function Ki(t){return Jt(t)?t:[]}function Ji(t){return typeof t=="function"?t:pe}function nn(t,e){return Rt(t)?t:no(t,e)?[t]:Ds(Dt(t))}var od=Et;function rn(t,e,n){var c=t.length;return n=n===v?c:n,!e&&n>=c?t:Ee(t,e,n)}var as=Vc||function(t){return te.clearTimeout(t)};function ss(t,e){if(e)return t.slice();var n=t.length,c=Pa?Pa(n):new t.constructor(n);return t.copy(c),c}function Qi(t){var e=new t.constructor(t.byteLength);return new mr(e).set(new mr(t)),e}function ad(t,e){var n=e?Qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function sd(t){var e=new t.constructor(t.source,jo.exec(t));return e.lastIndex=t.lastIndex,e}function ud(t){return Vn?Gt(Vn.call(t)):{}}function us(t,e){var n=e?Qi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ls(t,e){if(t!==e){var n=t!==v,c=t===null,R=t===t,B=ye(t),j=e!==v,J=e===null,Y=e===e,it=ye(e);if(!J&&!it&&!B&&t>e||B&&j&&Y&&!J&&!it||c&&j&&Y||!n&&Y||!R)return 1;if(!c&&!B&&!it&&t<e||it&&n&&R&&!c&&!B||J&&n&&R||!j&&R||!Y)return-1}return 0}function ld(t,e,n){for(var c=-1,R=t.criteria,B=e.criteria,j=R.length,J=n.length;++c<j;){var Y=ls(R[c],B[c]);if(Y){if(c>=J)return Y;var it=n[c];return Y*(it=="desc"?-1:1)}}return t.index-e.index}function cs(t,e,n,c){for(var R=-1,B=t.length,j=n.length,J=-1,Y=e.length,it=Xt(B-j,0),ot=et(Y+it),at=!c;++J<Y;)ot[J]=e[J];for(;++R<j;)(at||R<B)&&(ot[n[R]]=t[R]);for(;it--;)ot[J++]=t[R++];return ot}function fs(t,e,n,c){for(var R=-1,B=t.length,j=-1,J=n.length,Y=-1,it=e.length,ot=Xt(B-J,0),at=et(ot+it),ct=!c;++R<ot;)at[R]=t[R];for(var pt=R;++Y<it;)at[pt+Y]=e[Y];for(;++j<J;)(ct||R<B)&&(at[pt+n[j]]=t[R++]);return at}function fe(t,e){var n=-1,c=t.length;for(e||(e=et(c));++n<c;)e[n]=t[n];return e}function Be(t,e,n,c){var R=!n;n||(n={});for(var B=-1,j=e.length;++B<j;){var J=e[B],Y=c?c(n[J],t[J],J,n,t):v;Y===v&&(Y=t[J]),R?We(n,J,Y):Kn(n,J,Y)}return n}function cd(t,e){return Be(t,eo(t),e)}function fd(t,e){return Be(t,Ts(t),e)}function xr(t,e){return function(n,c){var R=Rt(n)?gc:Lf,B=e?e():{};return R(n,t,mt(c,2),B)}}function Pn(t){return Et(function(e,n){var c=-1,R=n.length,B=R>1?n[R-1]:v,j=R>2?n[2]:v;for(B=t.length>3&&typeof B=="function"?(R--,B):v,j&&ue(n[0],n[1],j)&&(B=R<3?v:B,R=1),e=Gt(e);++c<R;){var J=n[c];J&&t(e,J,c,B)}return e})}function ds(t,e){return function(n,c){if(n==null)return n;if(!de(n))return t(n,c);for(var R=n.length,B=e?R:-1,j=Gt(n);(e?B--:++B<R)&&c(j[B],B,j)!==!1;);return n}}function hs(t){return function(e,n,c){for(var R=-1,B=Gt(e),j=c(e),J=j.length;J--;){var Y=j[t?J:++R];if(n(B[Y],Y,B)===!1)break}return e}}function dd(t,e,n){var c=e&M,R=Yn(t);function B(){var j=this&&this!==te&&this instanceof B?R:t;return j.apply(c?n:this,arguments)}return B}function ps(t){return function(e){e=Dt(e);var n=Rn(e)?we(e):v,c=n?n[0]:e.charAt(0),R=n?rn(n,1).join(""):e.slice(1);return c[t]()+R}}function _n(t){return function(e){return Ci(du(fu(e).replace(ec,"")),t,"")}}function Yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=En(t.prototype),c=t.apply(n,e);return jt(c)?c:n}}function hd(t,e,n){var c=Yn(t);function R(){for(var B=arguments.length,j=et(B),J=B,Y=wn(R);J--;)j[J]=arguments[J];var it=B<3&&j[0]!==Y&&j[B-1]!==Y?[]:Ye(j,Y);if(B-=it.length,B<n)return Cs(t,e,Lr,R.placeholder,v,j,it,v,v,n-B);var ot=this&&this!==te&&this instanceof R?c:t;return ge(ot,this,j)}return R}function gs(t){return function(e,n,c){var R=Gt(e);if(!de(e)){var B=mt(n,3);e=ee(e),n=function(J){return B(R[J],J,R)}}var j=t(e,n,c);return j>-1?R[B?e[j]:j]:v}}function vs(t){return ke(function(e){var n=e.length,c=n,R=Se.prototype.thru;for(t&&e.reverse();c--;){var B=e[c];if(typeof B!="function")throw new Te(a);if(R&&!j&&Br(B)=="wrapper")var j=new Se([],!0)}for(c=j?c:n;++c<n;){B=e[c];var J=Br(B),Y=J=="wrapper"?Zi(B):v;Y&&ro(Y[0])&&Y[1]==(s|p|o|l)&&!Y[4].length&&Y[9]==1?j=j[Br(Y[0])].apply(j,Y[3]):j=B.length==1&&ro(B)?j[J]():j.thru(B)}return function(){var it=arguments,ot=it[0];if(j&&it.length==1&&Rt(ot))return j.plant(ot).value();for(var at=0,ct=n?e[at].apply(this,it):ot;++at<n;)ct=e[at].call(this,ct);return ct}})}function Lr(t,e,n,c,R,B,j,J,Y,it){var ot=e&s,at=e&M,ct=e&E,pt=e&(p|y),yt=e&i,It=ct?v:Yn(t);function Ct(){for(var Pt=arguments.length,wt=et(Pt),Ce=Pt;Ce--;)wt[Ce]=arguments[Ce];if(pt)var le=wn(Ct),Ae=Tc(wt,le);if(c&&(wt=cs(wt,c,R,pt)),B&&(wt=fs(wt,B,j,pt)),Pt-=Ae,pt&&Pt<it){var Qt=Ye(wt,le);return Cs(t,e,Lr,Ct.placeholder,n,wt,Qt,J,Y,it-Pt)}var Le=at?n:this,Je=ct?Le[t]:t;return Pt=wt.length,J?wt=Ld(wt,J):yt&&Pt>1&&wt.reverse(),ot&&Y<Pt&&(wt.length=Y),this&&this!==te&&this instanceof Ct&&(Je=It||Yn(Je)),Je.apply(Le,wt)}return Ct}function ms(t,e){return function(n,c){return Wf(n,t,e(c),{})}}function Dr(t,e){return function(n,c){var R;if(n===v&&c===v)return e;if(n!==v&&(R=n),c!==v){if(R===v)return c;typeof n=="string"||typeof c=="string"?(n=me(n),c=me(c)):(n=ns(n),c=ns(c)),R=t(n,c)}return R}}function $i(t){return ke(function(e){return e=kt(e,ve(mt())),Et(function(n){var c=this;return t(e,function(R){return ge(R,c,n)})})})}function Ur(t,e){e=e===v?" ":me(e);var n=e.length;if(n<2)return n?zi(e,t):e;var c=zi(e,Or(t/bn(e)));return Rn(e)?rn(we(c),0,t).join(""):c.slice(0,t)}function pd(t,e,n,c){var R=e&M,B=Yn(t);function j(){for(var J=-1,Y=arguments.length,it=-1,ot=c.length,at=et(ot+Y),ct=this&&this!==te&&this instanceof j?B:t;++it<ot;)at[it]=c[it];for(;Y--;)at[it++]=arguments[++J];return ge(ct,R?n:this,at)}return j}function ys(t){return function(e,n,c){return c&&typeof c!="number"&&ue(e,n,c)&&(n=c=v),e=Ke(e),n===v?(n=e,e=0):n=Ke(n),c=c===v?e<n?1:-1:Ke(c),Zf(e,n,c,t)}}function Nr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=_e(e),n=_e(n)),t(e,n)}}function Cs(t,e,n,c,R,B,j,J,Y,it){var ot=e&p,at=ot?j:v,ct=ot?v:j,pt=ot?B:v,yt=ot?v:B;e|=ot?o:h,e&=~(ot?h:o),e&m||(e&=~(M|E));var It=[t,e,R,pt,at,yt,ct,J,Y,it],Ct=n.apply(v,It);return ro(t)&&Ms(Ct,It),Ct.placeholder=c,xs(Ct,t,e)}function qi(t){var e=Yt[t];return function(n,c){if(n=_e(n),c=c==null?0:ie(Tt(c),292),c&&xa(n)){var R=(Dt(n)+"e").split("e"),B=e(R[0]+"e"+(+R[1]+c));return R=(Dt(B)+"e").split("e"),+(R[0]+"e"+(+R[1]-c))}return e(n)}}var gd=Sn&&1/fr(new Sn([,-0]))[1]==w?function(t){return new Sn(t)}:Co;function As(t){return function(e){var n=oe(e);return n==ft?Ii(e):n==rt?Mc(e):bc(e,t(e))}}function ze(t,e,n,c,R,B,j,J){var Y=e&E;if(!Y&&typeof t!="function")throw new Te(a);var it=c?c.length:0;if(it||(e&=~(o|h),c=R=v),j=j===v?j:Xt(Tt(j),0),J=J===v?J:Tt(J),it-=R?R.length:0,e&h){var ot=c,at=R;c=R=v}var ct=Y?v:Zi(t),pt=[t,e,n,c,R,ot,at,B,j,J];if(ct&&wd(pt,ct),t=pt[0],e=pt[1],n=pt[2],c=pt[3],R=pt[4],J=pt[9]=pt[9]===v?Y?0:t.length:Xt(pt[9]-it,0),!J&&e&(p|y)&&(e&=~(p|y)),!e||e==M)var yt=dd(t,e,n);else e==p||e==y?yt=hd(t,e,J):(e==o||e==(M|o))&&!R.length?yt=pd(t,e,n,c):yt=Lr.apply(v,pt);var It=ct?ts:Ms;return xs(It(yt,pt),t,e)}function Os(t,e,n,c){return t===v||xe(t,Tn[n])&&!Ut.call(c,n)?e:t}function Rs(t,e,n,c,R,B){return jt(t)&&jt(e)&&(B.set(e,t),_r(t,e,v,Rs,B),B.delete(e)),t}function vd(t){return tr(t)?v:t}function bs(t,e,n,c,R,B){var j=n&u,J=t.length,Y=e.length;if(J!=Y&&!(j&&Y>J))return!1;var it=B.get(t),ot=B.get(e);if(it&&ot)return it==e&&ot==t;var at=-1,ct=!0,pt=n&A?new cn:v;for(B.set(t,e),B.set(e,t);++at<J;){var yt=t[at],It=e[at];if(c)var Ct=j?c(It,yt,at,e,t,B):c(yt,It,at,t,e,B);if(Ct!==v){if(Ct)continue;ct=!1;break}if(pt){if(!Ai(e,function(Pt,wt){if(!Hn(pt,wt)&&(yt===Pt||R(yt,Pt,n,c,B)))return pt.push(wt)})){ct=!1;break}}else if(!(yt===It||R(yt,It,n,c,B))){ct=!1;break}}return B.delete(t),B.delete(e),ct}function md(t,e,n,c,R,B,j){switch(n){case Cn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Fn:return!(t.byteLength!=e.byteLength||!B(new mr(t),new mr(e)));case tt:case lt:case Mt:return xe(+t,+e);case gt:return t.name==e.name&&t.message==e.message;case X:case ut:return t==e+"";case ft:var J=Ii;case rt:var Y=c&u;if(J||(J=fr),t.size!=e.size&&!Y)return!1;var it=j.get(t);if(it)return it==e;c|=A,j.set(t,e);var ot=bs(J(t),J(e),c,R,B,j);return j.delete(t),ot;case ht:if(Vn)return Vn.call(t)==Vn.call(e)}return!1}function yd(t,e,n,c,R,B){var j=n&u,J=Yi(t),Y=J.length,it=Yi(e),ot=it.length;if(Y!=ot&&!j)return!1;for(var at=Y;at--;){var ct=J[at];if(!(j?ct in e:Ut.call(e,ct)))return!1}var pt=B.get(t),yt=B.get(e);if(pt&&yt)return pt==e&&yt==t;var It=!0;B.set(t,e),B.set(e,t);for(var Ct=j;++at<Y;){ct=J[at];var Pt=t[ct],wt=e[ct];if(c)var Ce=j?c(wt,Pt,ct,e,t,B):c(Pt,wt,ct,t,e,B);if(!(Ce===v?Pt===wt||R(Pt,wt,n,c,B):Ce)){It=!1;break}Ct||(Ct=ct=="constructor")}if(It&&!Ct){var le=t.constructor,Ae=e.constructor;le!=Ae&&"constructor"in t&&"constructor"in e&&!(typeof le=="function"&&le instanceof le&&typeof Ae=="function"&&Ae instanceof Ae)&&(It=!1)}return B.delete(t),B.delete(e),It}function ke(t){return oo(_s(t,v,Gs),t+"")}function Yi(t){return ka(t,ee,eo)}function Xi(t){return ka(t,he,Ts)}var Zi=br?function(t){return br.get(t)}:Co;function Br(t){for(var e=t.name+"",n=In[e],c=Ut.call(In,e)?n.length:0;c--;){var R=n[c],B=R.func;if(B==null||B==t)return R.name}return e}function wn(t){var e=Ut.call(x,"placeholder")?x:t;return e.placeholder}function mt(){var t=x.iteratee||mo;return t=t===mo?Ka:t,arguments.length?t(arguments[0],arguments[1]):t}function Gr(t,e){var n=t.__data__;return Id(e)?n[typeof e=="string"?"string":"hash"]:n.map}function to(t){for(var e=ee(t),n=e.length;n--;){var c=e[n],R=t[c];e[n]=[c,R,Es(R)]}return e}function hn(t,e){var n=Pc(t,e);return Va(n)?n:v}function Cd(t){var e=Ut.call(t,un),n=t[un];try{t[un]=v;var c=!0}catch(B){}var R=gr.call(t);return c&&(e?t[un]=n:delete t[un]),R}var eo=Pi?function(t){return t==null?[]:(t=Gt(t),$e(Pi(t),function(e){return wa.call(t,e)}))}:Ao,Ts=Pi?function(t){for(var e=[];t;)qe(e,eo(t)),t=yr(t);return e}:Ao,oe=se;(_i&&oe(new _i(new ArrayBuffer(1)))!=Cn||zn&&oe(new zn)!=ft||wi&&oe(wi.resolve())!=zt||Sn&&oe(new Sn)!=rt||kn&&oe(new kn)!=$t)&&(oe=function(t){var e=se(t),n=e==Bt?t.constructor:v,c=n?pn(n):"";if(c)switch(c){case tf:return Cn;case ef:return ft;case nf:return zt;case rf:return rt;case of:return $t}return e});function Ad(t,e,n){for(var c=-1,R=n.length;++c<R;){var B=n[c],j=B.size;switch(B.type){case"drop":t+=j;break;case"dropRight":e-=j;break;case"take":e=ie(e,t+j);break;case"takeRight":t=Xt(t,e-j);break}}return{start:t,end:e}}function Od(t){var e=t.match(Il);return e?e[1].split(El):[]}function Ss(t,e,n){e=nn(e,t);for(var c=-1,R=e.length,B=!1;++c<R;){var j=Ge(e[c]);if(!(B=t!=null&&n(t,j)))break;t=t[j]}return B||++c!=R?B:(R=t==null?0:t.length,!!R&&Vr(R)&&je(j,R)&&(Rt(t)||gn(t)))}function Rd(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Ut.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Is(t){return typeof t.constructor=="function"&&!Xn(t)?En(yr(t)):{}}function bd(t,e,n){var c=t.constructor;switch(e){case Fn:return Qi(t);case tt:case lt:return new c(+t);case Cn:return ad(t,n);case ti:case ei:case ni:case ri:case ii:case oi:case ai:case si:case ui:return us(t,n);case ft:return new c;case Mt:case ut:return new c(t);case X:return sd(t);case rt:return new c;case ht:return ud(t)}}function Td(t,e){var n=e.length;if(!n)return t;var c=n-1;return e[c]=(n>1?"& ":"")+e[c],e=e.join(n>2?", ":" "),t.replace(Sl,`{
/* [wrapped with `+e+`] */
`)}function Sd(t){return Rt(t)||gn(t)||!!(Ma&&t&&t[Ma])}function je(t,e){var n=typeof t;return e=e==null?k:e,!!e&&(n=="number"||n!="symbol"&&Nl.test(t))&&t>-1&&t%1==0&&t<e}function ue(t,e,n){if(!jt(n))return!1;var c=typeof e;return(c=="number"?de(n)&&je(e,n.length):c=="string"&&e in n)?xe(n[e],t):!1}function no(t,e){if(Rt(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ye(t)?!0:Ol.test(t)||!Al.test(t)||e!=null&&t in Gt(e)}function Id(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ro(t){var e=Br(t),n=x[e];if(typeof n!="function"||!(e in _t.prototype))return!1;if(t===n)return!0;var c=Zi(n);return!!c&&t===c[0]}function Ed(t){return!!Ea&&Ea in t}var Pd=hr?Ve:Oo;function Xn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Tn;return t===n}function Es(t){return t===t&&!jt(t)}function Ps(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==v||t in Gt(n))}}function _d(t){var e=kr(t,function(c){return n.size===I&&n.clear(),c}),n=e.cache;return e}function wd(t,e){var n=t[1],c=e[1],R=n|c,B=R<(M|E|s),j=c==s&&n==p||c==s&&n==l&&t[7].length<=e[8]||c==(s|l)&&e[7].length<=e[8]&&n==p;if(!(B||j))return t;c&M&&(t[2]=e[2],R|=n&M?0:m);var J=e[3];if(J){var Y=t[3];t[3]=Y?cs(Y,J,e[4]):J,t[4]=Y?Ye(t[3],P):e[4]}return J=e[5],J&&(Y=t[5],t[5]=Y?fs(Y,J,e[6]):J,t[6]=Y?Ye(t[5],P):e[6]),J=e[7],J&&(t[7]=J),c&s&&(t[8]=t[8]==null?e[8]:ie(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=R,t}function Md(t){var e=[];if(t!=null)for(var n in Gt(t))e.push(n);return e}function xd(t){return gr.call(t)}function _s(t,e,n){return e=Xt(e===v?t.length-1:e,0),function(){for(var c=arguments,R=-1,B=Xt(c.length-e,0),j=et(B);++R<B;)j[R]=c[e+R];R=-1;for(var J=et(e+1);++R<e;)J[R]=c[R];return J[e]=n(j),ge(t,this,J)}}function ws(t,e){return e.length<2?t:dn(t,Ee(e,0,-1))}function Ld(t,e){for(var n=t.length,c=ie(e.length,n),R=fe(t);c--;){var B=e[c];t[c]=je(B,n)?R[B]:v}return t}function io(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Ms=Ls(ts),Zn=Jc||function(t,e){return te.setTimeout(t,e)},oo=Ls(nd);function xs(t,e,n){var c=e+"";return oo(t,Td(c,Dd(Od(c),n)))}function Ls(t){var e=0,n=0;return function(){var c=Yc(),R=z-(c-n);if(n=c,R>0){if(++e>=D)return arguments[0]}else e=0;return t.apply(v,arguments)}}function Fr(t,e){var n=-1,c=t.length,R=c-1;for(e=e===v?c:e;++n<e;){var B=Wi(n,R),j=t[B];t[B]=t[n],t[n]=j}return t.length=e,t}var Ds=_d(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Rl,function(n,c,R,B){e.push(R?B.replace(wl,"$1"):c||n)}),e});function Ge(t){if(typeof t=="string"||ye(t))return t;var e=t+"";return e=="0"&&1/t==-w?"-0":e}function pn(t){if(t!=null){try{return pr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Dd(t,e){return be(L,function(n){var c="_."+n[0];e&n[1]&&!lr(t,c)&&t.push(c)}),t.sort()}function Us(t){if(t instanceof _t)return t.clone();var e=new Se(t.__wrapped__,t.__chain__);return e.__actions__=fe(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Ud(t,e,n){(n?ue(t,e,n):e===v)?e=1:e=Xt(Tt(e),0);var c=t==null?0:t.length;if(!c||e<1)return[];for(var R=0,B=0,j=et(Or(c/e));R<c;)j[B++]=Ee(t,R,R+=e);return j}function Nd(t){for(var e=-1,n=t==null?0:t.length,c=0,R=[];++e<n;){var B=t[e];B&&(R[c++]=B)}return R}function Bd(){var t=arguments.length;if(!t)return[];for(var e=et(t-1),n=arguments[0],c=t;c--;)e[c-1]=arguments[c];return qe(Rt(n)?fe(n):[n],ne(e,1))}var Gd=Et(function(t,e){return Jt(t)?Jn(t,ne(e,1,Jt,!0)):[]}),Fd=Et(function(t,e){var n=Pe(e);return Jt(n)&&(n=v),Jt(t)?Jn(t,ne(e,1,Jt,!0),mt(n,2)):[]}),Hd=Et(function(t,e){var n=Pe(e);return Jt(n)&&(n=v),Jt(t)?Jn(t,ne(e,1,Jt,!0),v,n):[]});function Wd(t,e,n){var c=t==null?0:t.length;return c?(e=n||e===v?1:Tt(e),Ee(t,e<0?0:e,c)):[]}function zd(t,e,n){var c=t==null?0:t.length;return c?(e=n||e===v?1:Tt(e),e=c-e,Ee(t,0,e<0?0:e)):[]}function kd(t,e){return t&&t.length?Mr(t,mt(e,3),!0,!0):[]}function jd(t,e){return t&&t.length?Mr(t,mt(e,3),!0):[]}function Vd(t,e,n,c){var R=t==null?0:t.length;return R?(n&&typeof n!="number"&&ue(t,e,n)&&(n=0,c=R),Bf(t,e,n,c)):[]}function Ns(t,e,n){var c=t==null?0:t.length;if(!c)return-1;var R=n==null?0:Tt(n);return R<0&&(R=Xt(c+R,0)),cr(t,mt(e,3),R)}function Bs(t,e,n){var c=t==null?0:t.length;if(!c)return-1;var R=c-1;return n!==v&&(R=Tt(n),R=n<0?Xt(c+R,0):ie(R,c-1)),cr(t,mt(e,3),R,!0)}function Gs(t){var e=t==null?0:t.length;return e?ne(t,1):[]}function Kd(t){var e=t==null?0:t.length;return e?ne(t,w):[]}function Jd(t,e){var n=t==null?0:t.length;return n?(e=e===v?1:Tt(e),ne(t,e)):[]}function Qd(t){for(var e=-1,n=t==null?0:t.length,c={};++e<n;){var R=t[e];c[R[0]]=R[1]}return c}function Fs(t){return t&&t.length?t[0]:v}function $d(t,e,n){var c=t==null?0:t.length;if(!c)return-1;var R=n==null?0:Tt(n);return R<0&&(R=Xt(c+R,0)),On(t,e,R)}function qd(t){var e=t==null?0:t.length;return e?Ee(t,0,-1):[]}var Yd=Et(function(t){var e=kt(t,Ki);return e.length&&e[0]===t[0]?Ni(e):[]}),Xd=Et(function(t){var e=Pe(t),n=kt(t,Ki);return e===Pe(n)?e=v:n.pop(),n.length&&n[0]===t[0]?Ni(n,mt(e,2)):[]}),Zd=Et(function(t){var e=Pe(t),n=kt(t,Ki);return e=typeof e=="function"?e:v,e&&n.pop(),n.length&&n[0]===t[0]?Ni(n,v,e):[]});function th(t,e){return t==null?"":$c.call(t,e)}function Pe(t){var e=t==null?0:t.length;return e?t[e-1]:v}function eh(t,e,n){var c=t==null?0:t.length;if(!c)return-1;var R=c;return n!==v&&(R=Tt(n),R=R<0?Xt(c+R,0):ie(R,c-1)),e===e?Lc(t,e,R):cr(t,Ca,R,!0)}function nh(t,e){return t&&t.length?qa(t,Tt(e)):v}var rh=Et(Hs);function Hs(t,e){return t&&t.length&&e&&e.length?Hi(t,e):t}function ih(t,e,n){return t&&t.length&&e&&e.length?Hi(t,e,mt(n,2)):t}function oh(t,e,n){return t&&t.length&&e&&e.length?Hi(t,e,v,n):t}var ah=ke(function(t,e){var n=t==null?0:t.length,c=xi(t,e);return Za(t,kt(e,function(R){return je(R,n)?+R:R}).sort(ls)),c});function sh(t,e){var n=[];if(!(t&&t.length))return n;var c=-1,R=[],B=t.length;for(e=mt(e,3);++c<B;){var j=t[c];e(j,c,t)&&(n.push(j),R.push(c))}return Za(t,R),n}function ao(t){return t==null?t:Zc.call(t)}function uh(t,e,n){var c=t==null?0:t.length;return c?(n&&typeof n!="number"&&ue(t,e,n)?(e=0,n=c):(e=e==null?0:Tt(e),n=n===v?c:Tt(n)),Ee(t,e,n)):[]}function lh(t,e){return wr(t,e)}function ch(t,e,n){return ki(t,e,mt(n,2))}function fh(t,e){var n=t==null?0:t.length;if(n){var c=wr(t,e);if(c<n&&xe(t[c],e))return c}return-1}function dh(t,e){return wr(t,e,!0)}function hh(t,e,n){return ki(t,e,mt(n,2),!0)}function ph(t,e){var n=t==null?0:t.length;if(n){var c=wr(t,e,!0)-1;if(xe(t[c],e))return c}return-1}function gh(t){return t&&t.length?es(t):[]}function vh(t,e){return t&&t.length?es(t,mt(e,2)):[]}function mh(t){var e=t==null?0:t.length;return e?Ee(t,1,e):[]}function yh(t,e,n){return t&&t.length?(e=n||e===v?1:Tt(e),Ee(t,0,e<0?0:e)):[]}function Ch(t,e,n){var c=t==null?0:t.length;return c?(e=n||e===v?1:Tt(e),e=c-e,Ee(t,e<0?0:e,c)):[]}function Ah(t,e){return t&&t.length?Mr(t,mt(e,3),!1,!0):[]}function Oh(t,e){return t&&t.length?Mr(t,mt(e,3)):[]}var Rh=Et(function(t){return en(ne(t,1,Jt,!0))}),bh=Et(function(t){var e=Pe(t);return Jt(e)&&(e=v),en(ne(t,1,Jt,!0),mt(e,2))}),Th=Et(function(t){var e=Pe(t);return e=typeof e=="function"?e:v,en(ne(t,1,Jt,!0),v,e)});function Sh(t){return t&&t.length?en(t):[]}function Ih(t,e){return t&&t.length?en(t,mt(e,2)):[]}function Eh(t,e){return e=typeof e=="function"?e:v,t&&t.length?en(t,v,e):[]}function so(t){if(!(t&&t.length))return[];var e=0;return t=$e(t,function(n){if(Jt(n))return e=Xt(n.length,e),!0}),Ti(e,function(n){return kt(t,Oi(n))})}function Ws(t,e){if(!(t&&t.length))return[];var n=so(t);return e==null?n:kt(n,function(c){return ge(e,v,c)})}var Ph=Et(function(t,e){return Jt(t)?Jn(t,e):[]}),_h=Et(function(t){return Vi($e(t,Jt))}),wh=Et(function(t){var e=Pe(t);return Jt(e)&&(e=v),Vi($e(t,Jt),mt(e,2))}),Mh=Et(function(t){var e=Pe(t);return e=typeof e=="function"?e:v,Vi($e(t,Jt),v,e)}),xh=Et(so);function Lh(t,e){return os(t||[],e||[],Kn)}function Dh(t,e){return os(t||[],e||[],qn)}var Uh=Et(function(t){var e=t.length,n=e>1?t[e-1]:v;return n=typeof n=="function"?(t.pop(),n):v,Ws(t,n)});function zs(t){var e=x(t);return e.__chain__=!0,e}function Nh(t,e){return e(t),t}function Hr(t,e){return e(t)}var Bh=ke(function(t){var e=t.length,n=e?t[0]:0,c=this.__wrapped__,R=function(B){return xi(B,t)};return e>1||this.__actions__.length||!(c instanceof _t)||!je(n)?this.thru(R):(c=c.slice(n,+n+(e?1:0)),c.__actions__.push({func:Hr,args:[R],thisArg:v}),new Se(c,this.__chain__).thru(function(B){return e&&!B.length&&B.push(v),B}))});function Gh(){return zs(this)}function Fh(){return new Se(this.value(),this.__chain__)}function Hh(){this.__values__===v&&(this.__values__=nu(this.value()));var t=this.__index__>=this.__values__.length,e=t?v:this.__values__[this.__index__++];return{done:t,value:e}}function Wh(){return this}function zh(t){for(var e,n=this;n instanceof Sr;){var c=Us(n);c.__index__=0,c.__values__=v,e?R.__wrapped__=c:e=c;var R=c;n=n.__wrapped__}return R.__wrapped__=t,e}function kh(){var t=this.__wrapped__;if(t instanceof _t){var e=t;return this.__actions__.length&&(e=new _t(this)),e=e.reverse(),e.__actions__.push({func:Hr,args:[ao],thisArg:v}),new Se(e,this.__chain__)}return this.thru(ao)}function jh(){return is(this.__wrapped__,this.__actions__)}var Vh=xr(function(t,e,n){Ut.call(t,n)?++t[n]:We(t,n,1)});function Kh(t,e,n){var c=Rt(t)?ma:Nf;return n&&ue(t,e,n)&&(e=v),c(t,mt(e,3))}function Jh(t,e){var n=Rt(t)?$e:Wa;return n(t,mt(e,3))}var Qh=gs(Ns),$h=gs(Bs);function qh(t,e){return ne(Wr(t,e),1)}function Yh(t,e){return ne(Wr(t,e),w)}function Xh(t,e,n){return n=n===v?1:Tt(n),ne(Wr(t,e),n)}function ks(t,e){var n=Rt(t)?be:tn;return n(t,mt(e,3))}function js(t,e){var n=Rt(t)?vc:Ha;return n(t,mt(e,3))}var Zh=xr(function(t,e,n){Ut.call(t,n)?t[n].push(e):We(t,n,[e])});function tp(t,e,n,c){t=de(t)?t:xn(t),n=n&&!c?Tt(n):0;var R=t.length;return n<0&&(n=Xt(R+n,0)),Kr(t)?n<=R&&t.indexOf(e,n)>-1:!!R&&On(t,e,n)>-1}var ep=Et(function(t,e,n){var c=-1,R=typeof e=="function",B=de(t)?et(t.length):[];return tn(t,function(j){B[++c]=R?ge(e,j,n):Qn(j,e,n)}),B}),np=xr(function(t,e,n){We(t,n,e)});function Wr(t,e){var n=Rt(t)?kt:Ja;return n(t,mt(e,3))}function rp(t,e,n,c){return t==null?[]:(Rt(e)||(e=e==null?[]:[e]),n=c?v:n,Rt(n)||(n=n==null?[]:[n]),Ya(t,e,n))}var ip=xr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function op(t,e,n){var c=Rt(t)?Ci:Oa,R=arguments.length<3;return c(t,mt(e,4),n,R,tn)}function ap(t,e,n){var c=Rt(t)?mc:Oa,R=arguments.length<3;return c(t,mt(e,4),n,R,Ha)}function sp(t,e){var n=Rt(t)?$e:Wa;return n(t,jr(mt(e,3)))}function up(t){var e=Rt(t)?Na:td;return e(t)}function lp(t,e,n){(n?ue(t,e,n):e===v)?e=1:e=Tt(e);var c=Rt(t)?Mf:ed;return c(t,e)}function cp(t){var e=Rt(t)?xf:rd;return e(t)}function fp(t){if(t==null)return 0;if(de(t))return Kr(t)?bn(t):t.length;var e=oe(t);return e==ft||e==rt?t.size:Gi(t).length}function dp(t,e,n){var c=Rt(t)?Ai:id;return n&&ue(t,e,n)&&(e=v),c(t,mt(e,3))}var hp=Et(function(t,e){if(t==null)return[];var n=e.length;return n>1&&ue(t,e[0],e[1])?e=[]:n>2&&ue(e[0],e[1],e[2])&&(e=[e[0]]),Ya(t,ne(e,1),[])}),zr=Kc||function(){return te.Date.now()};function pp(t,e){if(typeof e!="function")throw new Te(a);return t=Tt(t),function(){if(--t<1)return e.apply(this,arguments)}}function Vs(t,e,n){return e=n?v:e,e=t&&e==null?t.length:e,ze(t,s,v,v,v,v,e)}function Ks(t,e){var n;if(typeof e!="function")throw new Te(a);return t=Tt(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=v),n}}var uo=Et(function(t,e,n){var c=M;if(n.length){var R=Ye(n,wn(uo));c|=o}return ze(t,c,e,n,R)}),Js=Et(function(t,e,n){var c=M|E;if(n.length){var R=Ye(n,wn(Js));c|=o}return ze(e,c,t,n,R)});function Qs(t,e,n){e=n?v:e;var c=ze(t,p,v,v,v,v,v,e);return c.placeholder=Qs.placeholder,c}function $s(t,e,n){e=n?v:e;var c=ze(t,y,v,v,v,v,v,e);return c.placeholder=$s.placeholder,c}function qs(t,e,n){var c,R,B,j,J,Y,it=0,ot=!1,at=!1,ct=!0;if(typeof t!="function")throw new Te(a);e=_e(e)||0,jt(n)&&(ot=!!n.leading,at="maxWait"in n,B=at?Xt(_e(n.maxWait)||0,e):B,ct="trailing"in n?!!n.trailing:ct);function pt(Qt){var Le=c,Je=R;return c=R=v,it=Qt,j=t.apply(Je,Le),j}function yt(Qt){return it=Qt,J=Zn(Pt,e),ot?pt(Qt):j}function It(Qt){var Le=Qt-Y,Je=Qt-it,gu=e-Le;return at?ie(gu,B-Je):gu}function Ct(Qt){var Le=Qt-Y,Je=Qt-it;return Y===v||Le>=e||Le<0||at&&Je>=B}function Pt(){var Qt=zr();if(Ct(Qt))return wt(Qt);J=Zn(Pt,It(Qt))}function wt(Qt){return J=v,ct&&c?pt(Qt):(c=R=v,j)}function Ce(){J!==v&&as(J),it=0,c=Y=R=J=v}function le(){return J===v?j:wt(zr())}function Ae(){var Qt=zr(),Le=Ct(Qt);if(c=arguments,R=this,Y=Qt,Le){if(J===v)return yt(Y);if(at)return as(J),J=Zn(Pt,e),pt(Y)}return J===v&&(J=Zn(Pt,e)),j}return Ae.cancel=Ce,Ae.flush=le,Ae}var gp=Et(function(t,e){return Fa(t,1,e)}),vp=Et(function(t,e,n){return Fa(t,_e(e)||0,n)});function mp(t){return ze(t,i)}function kr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Te(a);var n=function(){var c=arguments,R=e?e.apply(this,c):c[0],B=n.cache;if(B.has(R))return B.get(R);var j=t.apply(this,c);return n.cache=B.set(R,j)||B,j};return n.cache=new(kr.Cache||He),n}kr.Cache=He;function jr(t){if(typeof t!="function")throw new Te(a);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function yp(t){return Ks(2,t)}var Cp=od(function(t,e){e=e.length==1&&Rt(e[0])?kt(e[0],ve(mt())):kt(ne(e,1),ve(mt()));var n=e.length;return Et(function(c){for(var R=-1,B=ie(c.length,n);++R<B;)c[R]=e[R].call(this,c[R]);return ge(t,this,c)})}),lo=Et(function(t,e){var n=Ye(e,wn(lo));return ze(t,o,v,e,n)}),Ys=Et(function(t,e){var n=Ye(e,wn(Ys));return ze(t,h,v,e,n)}),Ap=ke(function(t,e){return ze(t,l,v,v,v,e)});function Op(t,e){if(typeof t!="function")throw new Te(a);return e=e===v?e:Tt(e),Et(t,e)}function Rp(t,e){if(typeof t!="function")throw new Te(a);return e=e==null?0:Xt(Tt(e),0),Et(function(n){var c=n[e],R=rn(n,0,e);return c&&qe(R,c),ge(t,this,R)})}function bp(t,e,n){var c=!0,R=!0;if(typeof t!="function")throw new Te(a);return jt(n)&&(c="leading"in n?!!n.leading:c,R="trailing"in n?!!n.trailing:R),qs(t,e,{leading:c,maxWait:e,trailing:R})}function Tp(t){return Vs(t,1)}function Sp(t,e){return lo(Ji(e),t)}function Ip(){if(!arguments.length)return[];var t=arguments[0];return Rt(t)?t:[t]}function Ep(t){return Ie(t,T)}function Pp(t,e){return e=typeof e=="function"?e:v,Ie(t,T,e)}function _p(t){return Ie(t,G|T)}function wp(t,e){return e=typeof e=="function"?e:v,Ie(t,G|T,e)}function Mp(t,e){return e==null||Ga(t,e,ee(e))}function xe(t,e){return t===e||t!==t&&e!==e}var xp=Nr(Ui),Lp=Nr(function(t,e){return t>=e}),gn=ja(function(){return arguments}())?ja:function(t){return Vt(t)&&Ut.call(t,"callee")&&!wa.call(t,"callee")},Rt=et.isArray,Dp=fa?ve(fa):zf;function de(t){return t!=null&&Vr(t.length)&&!Ve(t)}function Jt(t){return Vt(t)&&de(t)}function Up(t){return t===!0||t===!1||Vt(t)&&se(t)==tt}var on=Qc||Oo,Np=da?ve(da):kf;function Bp(t){return Vt(t)&&t.nodeType===1&&!tr(t)}function Gp(t){if(t==null)return!0;if(de(t)&&(Rt(t)||typeof t=="string"||typeof t.splice=="function"||on(t)||Mn(t)||gn(t)))return!t.length;var e=oe(t);if(e==ft||e==rt)return!t.size;if(Xn(t))return!Gi(t).length;for(var n in t)if(Ut.call(t,n))return!1;return!0}function Fp(t,e){return $n(t,e)}function Hp(t,e,n){n=typeof n=="function"?n:v;var c=n?n(t,e):v;return c===v?$n(t,e,v,n):!!c}function co(t){if(!Vt(t))return!1;var e=se(t);return e==gt||e==vt||typeof t.message=="string"&&typeof t.name=="string"&&!tr(t)}function Wp(t){return typeof t=="number"&&xa(t)}function Ve(t){if(!jt(t))return!1;var e=se(t);return e==bt||e==xt||e==V||e==ce}function Xs(t){return typeof t=="number"&&t==Tt(t)}function Vr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=k}function jt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Vt(t){return t!=null&&typeof t=="object"}var Zs=ha?ve(ha):Vf;function zp(t,e){return t===e||Bi(t,e,to(e))}function kp(t,e,n){return n=typeof n=="function"?n:v,Bi(t,e,to(e),n)}function jp(t){return tu(t)&&t!=+t}function Vp(t){if(Pd(t))throw new Ot(f);return Va(t)}function Kp(t){return t===null}function Jp(t){return t==null}function tu(t){return typeof t=="number"||Vt(t)&&se(t)==Mt}function tr(t){if(!Vt(t)||se(t)!=Bt)return!1;var e=yr(t);if(e===null)return!0;var n=Ut.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&pr.call(n)==zc}var fo=pa?ve(pa):Kf;function Qp(t){return Xs(t)&&t>=-k&&t<=k}var eu=ga?ve(ga):Jf;function Kr(t){return typeof t=="string"||!Rt(t)&&Vt(t)&&se(t)==ut}function ye(t){return typeof t=="symbol"||Vt(t)&&se(t)==ht}var Mn=va?ve(va):Qf;function $p(t){return t===v}function qp(t){return Vt(t)&&oe(t)==$t}function Yp(t){return Vt(t)&&se(t)==an}var Xp=Nr(Fi),Zp=Nr(function(t,e){return t<=e});function nu(t){if(!t)return[];if(de(t))return Kr(t)?we(t):fe(t);if(Wn&&t[Wn])return wc(t[Wn]());var e=oe(t),n=e==ft?Ii:e==rt?fr:xn;return n(t)}function Ke(t){if(!t)return t===0?t:0;if(t=_e(t),t===w||t===-w){var e=t<0?-1:1;return e*W}return t===t?t:0}function Tt(t){var e=Ke(t),n=e%1;return e===e?n?e-n:e:0}function ru(t){return t?fn(Tt(t),0,Z):0}function _e(t){if(typeof t=="number")return t;if(ye(t))return Q;if(jt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=jt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ra(t);var n=Ll.test(t);return n||Ul.test(t)?hc(t.slice(2),n?2:8):xl.test(t)?Q:+t}function iu(t){return Be(t,he(t))}function tg(t){return t?fn(Tt(t),-k,k):t===0?t:0}function Dt(t){return t==null?"":me(t)}var eg=Pn(function(t,e){if(Xn(e)||de(e)){Be(e,ee(e),t);return}for(var n in e)Ut.call(e,n)&&Kn(t,n,e[n])}),ou=Pn(function(t,e){Be(e,he(e),t)}),Jr=Pn(function(t,e,n,c){Be(e,he(e),t,c)}),ng=Pn(function(t,e,n,c){Be(e,ee(e),t,c)}),rg=ke(xi);function ig(t,e){var n=En(t);return e==null?n:Ba(n,e)}var og=Et(function(t,e){t=Gt(t);var n=-1,c=e.length,R=c>2?e[2]:v;for(R&&ue(e[0],e[1],R)&&(c=1);++n<c;)for(var B=e[n],j=he(B),J=-1,Y=j.length;++J<Y;){var it=j[J],ot=t[it];(ot===v||xe(ot,Tn[it])&&!Ut.call(t,it))&&(t[it]=B[it])}return t}),ag=Et(function(t){return t.push(v,Rs),ge(au,v,t)});function sg(t,e){return ya(t,mt(e,3),Ne)}function ug(t,e){return ya(t,mt(e,3),Di)}function lg(t,e){return t==null?t:Li(t,mt(e,3),he)}function cg(t,e){return t==null?t:za(t,mt(e,3),he)}function fg(t,e){return t&&Ne(t,mt(e,3))}function dg(t,e){return t&&Di(t,mt(e,3))}function hg(t){return t==null?[]:Pr(t,ee(t))}function pg(t){return t==null?[]:Pr(t,he(t))}function ho(t,e,n){var c=t==null?v:dn(t,e);return c===v?n:c}function gg(t,e){return t!=null&&Ss(t,e,Gf)}function po(t,e){return t!=null&&Ss(t,e,Ff)}var vg=ms(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=gr.call(e)),t[e]=n},vo(pe)),mg=ms(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=gr.call(e)),Ut.call(t,e)?t[e].push(n):t[e]=[n]},mt),yg=Et(Qn);function ee(t){return de(t)?Ua(t):Gi(t)}function he(t){return de(t)?Ua(t,!0):$f(t)}function Cg(t,e){var n={};return e=mt(e,3),Ne(t,function(c,R,B){We(n,e(c,R,B),c)}),n}function Ag(t,e){var n={};return e=mt(e,3),Ne(t,function(c,R,B){We(n,R,e(c,R,B))}),n}var Og=Pn(function(t,e,n){_r(t,e,n)}),au=Pn(function(t,e,n,c){_r(t,e,n,c)}),Rg=ke(function(t,e){var n={};if(t==null)return n;var c=!1;e=kt(e,function(B){return B=nn(B,t),c||(c=B.length>1),B}),Be(t,Xi(t),n),c&&(n=Ie(n,G|b|T,vd));for(var R=e.length;R--;)ji(n,e[R]);return n});function bg(t,e){return su(t,jr(mt(e)))}var Tg=ke(function(t,e){return t==null?{}:Yf(t,e)});function su(t,e){if(t==null)return{};var n=kt(Xi(t),function(c){return[c]});return e=mt(e),Xa(t,n,function(c,R){return e(c,R[0])})}function Sg(t,e,n){e=nn(e,t);var c=-1,R=e.length;for(R||(R=1,t=v);++c<R;){var B=t==null?v:t[Ge(e[c])];B===v&&(c=R,B=n),t=Ve(B)?B.call(t):B}return t}function Ig(t,e,n){return t==null?t:qn(t,e,n)}function Eg(t,e,n,c){return c=typeof c=="function"?c:v,t==null?t:qn(t,e,n,c)}var uu=As(ee),lu=As(he);function Pg(t,e,n){var c=Rt(t),R=c||on(t)||Mn(t);if(e=mt(e,4),n==null){var B=t&&t.constructor;R?n=c?new B:[]:jt(t)?n=Ve(B)?En(yr(t)):{}:n={}}return(R?be:Ne)(t,function(j,J,Y){return e(n,j,J,Y)}),n}function _g(t,e){return t==null?!0:ji(t,e)}function wg(t,e,n){return t==null?t:rs(t,e,Ji(n))}function Mg(t,e,n,c){return c=typeof c=="function"?c:v,t==null?t:rs(t,e,Ji(n),c)}function xn(t){return t==null?[]:Si(t,ee(t))}function xg(t){return t==null?[]:Si(t,he(t))}function Lg(t,e,n){return n===v&&(n=e,e=v),n!==v&&(n=_e(n),n=n===n?n:0),e!==v&&(e=_e(e),e=e===e?e:0),fn(_e(t),e,n)}function Dg(t,e,n){return e=Ke(e),n===v?(n=e,e=0):n=Ke(n),t=_e(t),Hf(t,e,n)}function Ug(t,e,n){if(n&&typeof n!="boolean"&&ue(t,e,n)&&(e=n=v),n===v&&(typeof e=="boolean"?(n=e,e=v):typeof t=="boolean"&&(n=t,t=v)),t===v&&e===v?(t=0,e=1):(t=Ke(t),e===v?(e=t,t=0):e=Ke(e)),t>e){var c=t;t=e,e=c}if(n||t%1||e%1){var R=La();return ie(t+R*(e-t+dc("1e-"+((R+"").length-1))),e)}return Wi(t,e)}var Ng=_n(function(t,e,n){return e=e.toLowerCase(),t+(n?cu(e):e)});function cu(t){return go(Dt(t).toLowerCase())}function fu(t){return t=Dt(t),t&&t.replace(Bl,Sc).replace(nc,"")}function Bg(t,e,n){t=Dt(t),e=me(e);var c=t.length;n=n===v?c:fn(Tt(n),0,c);var R=n;return n-=e.length,n>=0&&t.slice(n,R)==e}function Gg(t){return t=Dt(t),t&&ml.test(t)?t.replace(zo,Ic):t}function Fg(t){return t=Dt(t),t&&bl.test(t)?t.replace(li,"\\$&"):t}var Hg=_n(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Wg=_n(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),zg=ps("toLowerCase");function kg(t,e,n){t=Dt(t),e=Tt(e);var c=e?bn(t):0;if(!e||c>=e)return t;var R=(e-c)/2;return Ur(Rr(R),n)+t+Ur(Or(R),n)}function jg(t,e,n){t=Dt(t),e=Tt(e);var c=e?bn(t):0;return e&&c<e?t+Ur(e-c,n):t}function Vg(t,e,n){t=Dt(t),e=Tt(e);var c=e?bn(t):0;return e&&c<e?Ur(e-c,n)+t:t}function Kg(t,e,n){return n||e==null?e=0:e&&(e=+e),Xc(Dt(t).replace(ci,""),e||0)}function Jg(t,e,n){return(n?ue(t,e,n):e===v)?e=1:e=Tt(e),zi(Dt(t),e)}function Qg(){var t=arguments,e=Dt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var $g=_n(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function qg(t,e,n){return n&&typeof n!="number"&&ue(t,e,n)&&(e=n=v),n=n===v?Z:n>>>0,n?(t=Dt(t),t&&(typeof e=="string"||e!=null&&!fo(e))&&(e=me(e),!e&&Rn(t))?rn(we(t),0,n):t.split(e,n)):[]}var Yg=_n(function(t,e,n){return t+(n?" ":"")+go(e)});function Xg(t,e,n){return t=Dt(t),n=n==null?0:fn(Tt(n),0,t.length),e=me(e),t.slice(n,n+e.length)==e}function Zg(t,e,n){var c=x.templateSettings;n&&ue(t,e,n)&&(e=v),t=Dt(t),e=Jr({},e,c,Os);var R=Jr({},e.imports,c.imports,Os),B=ee(R),j=Si(R,B),J,Y,it=0,ot=e.interpolate||ar,at="__p += '",ct=Ei((e.escape||ar).source+"|"+ot.source+"|"+(ot===ko?Ml:ar).source+"|"+(e.evaluate||ar).source+"|$","g"),pt="//# sourceURL="+(Ut.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++sc+"]")+`
`;t.replace(ct,function(Ct,Pt,wt,Ce,le,Ae){return wt||(wt=Ce),at+=t.slice(it,Ae).replace(Gl,Ec),Pt&&(J=!0,at+=`' +
__e(`+Pt+`) +
'`),le&&(Y=!0,at+=`';
`+le+`;
__p += '`),wt&&(at+=`' +
((__t = (`+wt+`)) == null ? '' : __t) +
'`),it=Ae+Ct.length,Ct}),at+=`';
`;var yt=Ut.call(e,"variable")&&e.variable;if(!yt)at=`with (obj) {
`+at+`
}
`;else if(_l.test(yt))throw new Ot(_);at=(Y?at.replace(hl,""):at).replace(pl,"$1").replace(gl,"$1;"),at="function("+(yt||"obj")+`) {
`+(yt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(Y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+at+`return __p
}`;var It=hu(function(){return Lt(B,pt+"return "+at).apply(v,j)});if(It.source=at,co(It))throw It;return It}function tv(t){return Dt(t).toLowerCase()}function ev(t){return Dt(t).toUpperCase()}function nv(t,e,n){if(t=Dt(t),t&&(n||e===v))return Ra(t);if(!t||!(e=me(e)))return t;var c=we(t),R=we(e),B=ba(c,R),j=Ta(c,R)+1;return rn(c,B,j).join("")}function rv(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.slice(0,Ia(t)+1);if(!t||!(e=me(e)))return t;var c=we(t),R=Ta(c,we(e))+1;return rn(c,0,R).join("")}function iv(t,e,n){if(t=Dt(t),t&&(n||e===v))return t.replace(ci,"");if(!t||!(e=me(e)))return t;var c=we(t),R=ba(c,we(e));return rn(c,R).join("")}function ov(t,e){var n=g,c=O;if(jt(e)){var R="separator"in e?e.separator:R;n="length"in e?Tt(e.length):n,c="omission"in e?me(e.omission):c}t=Dt(t);var B=t.length;if(Rn(t)){var j=we(t);B=j.length}if(n>=B)return t;var J=n-bn(c);if(J<1)return c;var Y=j?rn(j,0,J).join(""):t.slice(0,J);if(R===v)return Y+c;if(j&&(J+=Y.length-J),fo(R)){if(t.slice(J).search(R)){var it,ot=Y;for(R.global||(R=Ei(R.source,Dt(jo.exec(R))+"g")),R.lastIndex=0;it=R.exec(ot);)var at=it.index;Y=Y.slice(0,at===v?J:at)}}else if(t.indexOf(me(R),J)!=J){var ct=Y.lastIndexOf(R);ct>-1&&(Y=Y.slice(0,ct))}return Y+c}function av(t){return t=Dt(t),t&&vl.test(t)?t.replace(Wo,Dc):t}var sv=_n(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),go=ps("toUpperCase");function du(t,e,n){return t=Dt(t),e=n?v:e,e===v?_c(t)?Bc(t):Ac(t):t.match(e)||[]}var hu=Et(function(t,e){try{return ge(t,v,e)}catch(n){return co(n)?n:new Ot(n)}}),uv=ke(function(t,e){return be(e,function(n){n=Ge(n),We(t,n,uo(t[n],t))}),t});function lv(t){var e=t==null?0:t.length,n=mt();return t=e?kt(t,function(c){if(typeof c[1]!="function")throw new Te(a);return[n(c[0]),c[1]]}):[],Et(function(c){for(var R=-1;++R<e;){var B=t[R];if(ge(B[0],this,c))return ge(B[1],this,c)}})}function cv(t){return Uf(Ie(t,G))}function vo(t){return function(){return t}}function fv(t,e){return t==null||t!==t?e:t}var dv=vs(),hv=vs(!0);function pe(t){return t}function mo(t){return Ka(typeof t=="function"?t:Ie(t,G))}function pv(t){return Qa(Ie(t,G))}function gv(t,e){return $a(t,Ie(e,G))}var vv=Et(function(t,e){return function(n){return Qn(n,t,e)}}),mv=Et(function(t,e){return function(n){return Qn(t,n,e)}});function yo(t,e,n){var c=ee(e),R=Pr(e,c);n==null&&!(jt(e)&&(R.length||!c.length))&&(n=e,e=t,t=this,R=Pr(e,ee(e)));var B=!(jt(n)&&"chain"in n)||!!n.chain,j=Ve(t);return be(R,function(J){var Y=e[J];t[J]=Y,j&&(t.prototype[J]=function(){var it=this.__chain__;if(B||it){var ot=t(this.__wrapped__),at=ot.__actions__=fe(this.__actions__);return at.push({func:Y,args:arguments,thisArg:t}),ot.__chain__=it,ot}return Y.apply(t,qe([this.value()],arguments))})}),t}function yv(){return te._===this&&(te._=kc),this}function Co(){}function Cv(t){return t=Tt(t),Et(function(e){return qa(e,t)})}var Av=$i(kt),Ov=$i(ma),Rv=$i(Ai);function pu(t){return no(t)?Oi(Ge(t)):Xf(t)}function bv(t){return function(e){return t==null?v:dn(t,e)}}var Tv=ys(),Sv=ys(!0);function Ao(){return[]}function Oo(){return!1}function Iv(){return{}}function Ev(){return""}function Pv(){return!0}function _v(t,e){if(t=Tt(t),t<1||t>k)return[];var n=Z,c=ie(t,Z);e=mt(e),t-=Z;for(var R=Ti(c,e);++n<t;)e(n);return R}function wv(t){return Rt(t)?kt(t,Ge):ye(t)?[t]:fe(Ds(Dt(t)))}function Mv(t){var e=++Wc;return Dt(t)+e}var xv=Dr(function(t,e){return t+e},0),Lv=qi("ceil"),Dv=Dr(function(t,e){return t/e},1),Uv=qi("floor");function Nv(t){return t&&t.length?Er(t,pe,Ui):v}function Bv(t,e){return t&&t.length?Er(t,mt(e,2),Ui):v}function Gv(t){return Aa(t,pe)}function Fv(t,e){return Aa(t,mt(e,2))}function Hv(t){return t&&t.length?Er(t,pe,Fi):v}function Wv(t,e){return t&&t.length?Er(t,mt(e,2),Fi):v}var zv=Dr(function(t,e){return t*e},1),kv=qi("round"),jv=Dr(function(t,e){return t-e},0);function Vv(t){return t&&t.length?bi(t,pe):0}function Kv(t,e){return t&&t.length?bi(t,mt(e,2)):0}return x.after=pp,x.ary=Vs,x.assign=eg,x.assignIn=ou,x.assignInWith=Jr,x.assignWith=ng,x.at=rg,x.before=Ks,x.bind=uo,x.bindAll=uv,x.bindKey=Js,x.castArray=Ip,x.chain=zs,x.chunk=Ud,x.compact=Nd,x.concat=Bd,x.cond=lv,x.conforms=cv,x.constant=vo,x.countBy=Vh,x.create=ig,x.curry=Qs,x.curryRight=$s,x.debounce=qs,x.defaults=og,x.defaultsDeep=ag,x.defer=gp,x.delay=vp,x.difference=Gd,x.differenceBy=Fd,x.differenceWith=Hd,x.drop=Wd,x.dropRight=zd,x.dropRightWhile=kd,x.dropWhile=jd,x.fill=Vd,x.filter=Jh,x.flatMap=qh,x.flatMapDeep=Yh,x.flatMapDepth=Xh,x.flatten=Gs,x.flattenDeep=Kd,x.flattenDepth=Jd,x.flip=mp,x.flow=dv,x.flowRight=hv,x.fromPairs=Qd,x.functions=hg,x.functionsIn=pg,x.groupBy=Zh,x.initial=qd,x.intersection=Yd,x.intersectionBy=Xd,x.intersectionWith=Zd,x.invert=vg,x.invertBy=mg,x.invokeMap=ep,x.iteratee=mo,x.keyBy=np,x.keys=ee,x.keysIn=he,x.map=Wr,x.mapKeys=Cg,x.mapValues=Ag,x.matches=pv,x.matchesProperty=gv,x.memoize=kr,x.merge=Og,x.mergeWith=au,x.method=vv,x.methodOf=mv,x.mixin=yo,x.negate=jr,x.nthArg=Cv,x.omit=Rg,x.omitBy=bg,x.once=yp,x.orderBy=rp,x.over=Av,x.overArgs=Cp,x.overEvery=Ov,x.overSome=Rv,x.partial=lo,x.partialRight=Ys,x.partition=ip,x.pick=Tg,x.pickBy=su,x.property=pu,x.propertyOf=bv,x.pull=rh,x.pullAll=Hs,x.pullAllBy=ih,x.pullAllWith=oh,x.pullAt=ah,x.range=Tv,x.rangeRight=Sv,x.rearg=Ap,x.reject=sp,x.remove=sh,x.rest=Op,x.reverse=ao,x.sampleSize=lp,x.set=Ig,x.setWith=Eg,x.shuffle=cp,x.slice=uh,x.sortBy=hp,x.sortedUniq=gh,x.sortedUniqBy=vh,x.split=qg,x.spread=Rp,x.tail=mh,x.take=yh,x.takeRight=Ch,x.takeRightWhile=Ah,x.takeWhile=Oh,x.tap=Nh,x.throttle=bp,x.thru=Hr,x.toArray=nu,x.toPairs=uu,x.toPairsIn=lu,x.toPath=wv,x.toPlainObject=iu,x.transform=Pg,x.unary=Tp,x.union=Rh,x.unionBy=bh,x.unionWith=Th,x.uniq=Sh,x.uniqBy=Ih,x.uniqWith=Eh,x.unset=_g,x.unzip=so,x.unzipWith=Ws,x.update=wg,x.updateWith=Mg,x.values=xn,x.valuesIn=xg,x.without=Ph,x.words=du,x.wrap=Sp,x.xor=_h,x.xorBy=wh,x.xorWith=Mh,x.zip=xh,x.zipObject=Lh,x.zipObjectDeep=Dh,x.zipWith=Uh,x.entries=uu,x.entriesIn=lu,x.extend=ou,x.extendWith=Jr,yo(x,x),x.add=xv,x.attempt=hu,x.camelCase=Ng,x.capitalize=cu,x.ceil=Lv,x.clamp=Lg,x.clone=Ep,x.cloneDeep=_p,x.cloneDeepWith=wp,x.cloneWith=Pp,x.conformsTo=Mp,x.deburr=fu,x.defaultTo=fv,x.divide=Dv,x.endsWith=Bg,x.eq=xe,x.escape=Gg,x.escapeRegExp=Fg,x.every=Kh,x.find=Qh,x.findIndex=Ns,x.findKey=sg,x.findLast=$h,x.findLastIndex=Bs,x.findLastKey=ug,x.floor=Uv,x.forEach=ks,x.forEachRight=js,x.forIn=lg,x.forInRight=cg,x.forOwn=fg,x.forOwnRight=dg,x.get=ho,x.gt=xp,x.gte=Lp,x.has=gg,x.hasIn=po,x.head=Fs,x.identity=pe,x.includes=tp,x.indexOf=$d,x.inRange=Dg,x.invoke=yg,x.isArguments=gn,x.isArray=Rt,x.isArrayBuffer=Dp,x.isArrayLike=de,x.isArrayLikeObject=Jt,x.isBoolean=Up,x.isBuffer=on,x.isDate=Np,x.isElement=Bp,x.isEmpty=Gp,x.isEqual=Fp,x.isEqualWith=Hp,x.isError=co,x.isFinite=Wp,x.isFunction=Ve,x.isInteger=Xs,x.isLength=Vr,x.isMap=Zs,x.isMatch=zp,x.isMatchWith=kp,x.isNaN=jp,x.isNative=Vp,x.isNil=Jp,x.isNull=Kp,x.isNumber=tu,x.isObject=jt,x.isObjectLike=Vt,x.isPlainObject=tr,x.isRegExp=fo,x.isSafeInteger=Qp,x.isSet=eu,x.isString=Kr,x.isSymbol=ye,x.isTypedArray=Mn,x.isUndefined=$p,x.isWeakMap=qp,x.isWeakSet=Yp,x.join=th,x.kebabCase=Hg,x.last=Pe,x.lastIndexOf=eh,x.lowerCase=Wg,x.lowerFirst=zg,x.lt=Xp,x.lte=Zp,x.max=Nv,x.maxBy=Bv,x.mean=Gv,x.meanBy=Fv,x.min=Hv,x.minBy=Wv,x.stubArray=Ao,x.stubFalse=Oo,x.stubObject=Iv,x.stubString=Ev,x.stubTrue=Pv,x.multiply=zv,x.nth=nh,x.noConflict=yv,x.noop=Co,x.now=zr,x.pad=kg,x.padEnd=jg,x.padStart=Vg,x.parseInt=Kg,x.random=Ug,x.reduce=op,x.reduceRight=ap,x.repeat=Jg,x.replace=Qg,x.result=Sg,x.round=kv,x.runInContext=$,x.sample=up,x.size=fp,x.snakeCase=$g,x.some=dp,x.sortedIndex=lh,x.sortedIndexBy=ch,x.sortedIndexOf=fh,x.sortedLastIndex=dh,x.sortedLastIndexBy=hh,x.sortedLastIndexOf=ph,x.startCase=Yg,x.startsWith=Xg,x.subtract=jv,x.sum=Vv,x.sumBy=Kv,x.template=Zg,x.times=_v,x.toFinite=Ke,x.toInteger=Tt,x.toLength=ru,x.toLower=tv,x.toNumber=_e,x.toSafeInteger=tg,x.toString=Dt,x.toUpper=ev,x.trim=nv,x.trimEnd=rv,x.trimStart=iv,x.truncate=ov,x.unescape=av,x.uniqueId=Mv,x.upperCase=sv,x.upperFirst=go,x.each=ks,x.eachRight=js,x.first=Fs,yo(x,function(){var t={};return Ne(x,function(e,n){Ut.call(x.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),x.VERSION=d,be(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){x[t].placeholder=x}),be(["drop","take"],function(t,e){_t.prototype[t]=function(n){n=n===v?1:Xt(Tt(n),0);var c=this.__filtered__&&!e?new _t(this):this.clone();return c.__filtered__?c.__takeCount__=ie(n,c.__takeCount__):c.__views__.push({size:ie(n,Z),type:t+(c.__dir__<0?"Right":"")}),c},_t.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),be(["filter","map","takeWhile"],function(t,e){var n=e+1,c=n==H||n==C;_t.prototype[t]=function(R){var B=this.clone();return B.__iteratees__.push({iteratee:mt(R,3),type:n}),B.__filtered__=B.__filtered__||c,B}}),be(["head","last"],function(t,e){var n="take"+(e?"Right":"");_t.prototype[t]=function(){return this[n](1).value()[0]}}),be(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");_t.prototype[t]=function(){return this.__filtered__?new _t(this):this[n](1)}}),_t.prototype.compact=function(){return this.filter(pe)},_t.prototype.find=function(t){return this.filter(t).head()},_t.prototype.findLast=function(t){return this.reverse().find(t)},_t.prototype.invokeMap=Et(function(t,e){return typeof t=="function"?new _t(this):this.map(function(n){return Qn(n,t,e)})}),_t.prototype.reject=function(t){return this.filter(jr(mt(t)))},_t.prototype.slice=function(t,e){t=Tt(t);var n=this;return n.__filtered__&&(t>0||e<0)?new _t(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==v&&(e=Tt(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},_t.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},_t.prototype.toArray=function(){return this.take(Z)},Ne(_t.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),c=/^(?:head|last)$/.test(e),R=x[c?"take"+(e=="last"?"Right":""):e],B=c||/^find/.test(e);!R||(x.prototype[e]=function(){var j=this.__wrapped__,J=c?[1]:arguments,Y=j instanceof _t,it=J[0],ot=Y||Rt(j),at=function(Pt){var wt=R.apply(x,qe([Pt],J));return c&&ct?wt[0]:wt};ot&&n&&typeof it=="function"&&it.length!=1&&(Y=ot=!1);var ct=this.__chain__,pt=!!this.__actions__.length,yt=B&&!ct,It=Y&&!pt;if(!B&&ot){j=It?j:new _t(this);var Ct=t.apply(j,J);return Ct.__actions__.push({func:Hr,args:[at],thisArg:v}),new Se(Ct,ct)}return yt&&It?t.apply(this,J):(Ct=this.thru(at),yt?c?Ct.value()[0]:Ct.value():Ct)})}),be(["pop","push","shift","sort","splice","unshift"],function(t){var e=dr[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",c=/^(?:pop|shift)$/.test(t);x.prototype[t]=function(){var R=arguments;if(c&&!this.__chain__){var B=this.value();return e.apply(Rt(B)?B:[],R)}return this[n](function(j){return e.apply(Rt(j)?j:[],R)})}}),Ne(_t.prototype,function(t,e){var n=x[e];if(n){var c=n.name+"";Ut.call(In,c)||(In[c]=[]),In[c].push({name:e,func:n})}}),In[Lr(v,E).name]=[{name:"wrapper",func:v}],_t.prototype.clone=af,_t.prototype.reverse=sf,_t.prototype.value=uf,x.prototype.at=Bh,x.prototype.chain=Gh,x.prototype.commit=Fh,x.prototype.next=Hh,x.prototype.plant=zh,x.prototype.reverse=kh,x.prototype.toJSON=x.prototype.valueOf=x.prototype.value=jh,x.prototype.first=x.prototype.head,Wn&&(x.prototype[Wn]=Wh),x},Xe=Gc();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(te._=Xe,define(function(){return Xe})):sn?((sn.exports=Xe)._=Xe,vi._=Xe):te._=Xe}).call(Nn)});var sl={};Cu(sl,{version:()=>s0});var s0,ul=Ro(()=>{st();s0="lab"});var ll={};Cu(ll,{remoteConfig:()=>u0});var u0,cl=Ro(()=>{st();u0={apiUrl:"dev-url",conferenceLayerUrl:"frame-url"}});var fl=qt((Xr,Mo)=>{st();(function(d,r){typeof Xr=="object"&&typeof Mo=="object"?Mo.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Xr=="object"?Xr.Ably=r():d.Ably=r()})(window,function(){return function(v){var d={};function r(f){if(d[f])return d[f].exports;var a=d[f]={i:f,l:!1,exports:{}};return v[f].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=v,r.c=d,r.d=function(f,a,_){r.o(f,a)||Object.defineProperty(f,a,{enumerable:!0,get:_})},r.r=function(f){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},r.t=function(f,a){if(a&1&&(f=r(f)),a&8||a&4&&typeof f=="object"&&f&&f.__esModule)return f;var _=Object.create(null);if(r.r(_),Object.defineProperty(_,"default",{enumerable:!0,value:f}),a&2&&typeof f!="string")for(var S in f)r.d(_,S,function(I){return f[I]}.bind(null,S));return _},r.n=function(f){var a=f&&f.__esModule?function(){return f.default}:function(){return f};return r.d(a,"a",a),a},r.o=function(f,a){return Object.prototype.hasOwnProperty.call(f,a)},r.p="",r(r.s=41)}([function(v,d,r){"use strict";d.__esModule=!0;var f=function(){function a(){}return a}();d.default=f},function(v,d,r){"use strict";r.r(d),r.d(d,"__extends",function(){return a}),r.d(d,"__assign",function(){return _}),r.d(d,"__rest",function(){return S}),r.d(d,"__decorate",function(){return I}),r.d(d,"__param",function(){return P}),r.d(d,"__metadata",function(){return G}),r.d(d,"__awaiter",function(){return b}),r.d(d,"__generator",function(){return T}),r.d(d,"__createBinding",function(){return u}),r.d(d,"__exportStar",function(){return A}),r.d(d,"__values",function(){return M}),r.d(d,"__read",function(){return E}),r.d(d,"__spread",function(){return m}),r.d(d,"__spreadArrays",function(){return p}),r.d(d,"__spreadArray",function(){return y}),r.d(d,"__await",function(){return o}),r.d(d,"__asyncGenerator",function(){return h}),r.d(d,"__asyncDelegator",function(){return s}),r.d(d,"__asyncValues",function(){return l}),r.d(d,"__makeTemplateObject",function(){return i}),r.d(d,"__importStar",function(){return O}),r.d(d,"__importDefault",function(){return D}),r.d(d,"__classPrivateFieldGet",function(){return z}),r.d(d,"__classPrivateFieldSet",function(){return H});var f=function(U,C){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,k){w.__proto__=k}||function(w,k){for(var W in k)Object.prototype.hasOwnProperty.call(k,W)&&(w[W]=k[W])},f(U,C)};function a(U,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");f(U,C);function w(){this.constructor=U}U.prototype=C===null?Object.create(C):(w.prototype=C.prototype,new w)}var _=function(){return _=Object.assign||function(C){for(var w,k=1,W=arguments.length;k<W;k++){w=arguments[k];for(var Q in w)Object.prototype.hasOwnProperty.call(w,Q)&&(C[Q]=w[Q])}return C},_.apply(this,arguments)};function S(U,C){var w={};for(var k in U)Object.prototype.hasOwnProperty.call(U,k)&&C.indexOf(k)<0&&(w[k]=U[k]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,k=Object.getOwnPropertySymbols(U);W<k.length;W++)C.indexOf(k[W])<0&&Object.prototype.propertyIsEnumerable.call(U,k[W])&&(w[k[W]]=U[k[W]]);return w}function I(U,C,w,k){var W=arguments.length,Q=W<3?C:k===null?k=Object.getOwnPropertyDescriptor(C,w):k,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(U,C,w,k);else for(var q=U.length-1;q>=0;q--)(Z=U[q])&&(Q=(W<3?Z(Q):W>3?Z(C,w,Q):Z(C,w))||Q);return W>3&&Q&&Object.defineProperty(C,w,Q),Q}function P(U,C){return function(w,k){C(w,k,U)}}function G(U,C){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(U,C)}function b(U,C,w,k){function W(Q){return Q instanceof w?Q:new w(function(Z){Z(Q)})}return new(w||(w=Promise))(function(Q,Z){function q(N){try{L(k.next(N))}catch(K){Z(K)}}function F(N){try{L(k.throw(N))}catch(K){Z(K)}}function L(N){N.done?Q(N.value):W(N.value).then(q,F)}L((k=k.apply(U,C||[])).next())})}function T(U,C){var w={label:0,sent:function(){if(Q[0]&1)throw Q[1];return Q[1]},trys:[],ops:[]},k,W,Q,Z;return Z={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function q(L){return function(N){return F([L,N])}}function F(L){if(k)throw new TypeError("Generator is already executing.");for(;w;)try{if(k=1,W&&(Q=L[0]&2?W.return:L[0]?W.throw||((Q=W.return)&&Q.call(W),0):W.next)&&!(Q=Q.call(W,L[1])).done)return Q;switch(W=0,Q&&(L=[L[0]&2,Q.value]),L[0]){case 0:case 1:Q=L;break;case 4:return w.label++,{value:L[1],done:!1};case 5:w.label++,W=L[1],L=[0];continue;case 7:L=w.ops.pop(),w.trys.pop();continue;default:if(Q=w.trys,!(Q=Q.length>0&&Q[Q.length-1])&&(L[0]===6||L[0]===2)){w=0;continue}if(L[0]===3&&(!Q||L[1]>Q[0]&&L[1]<Q[3])){w.label=L[1];break}if(L[0]===6&&w.label<Q[1]){w.label=Q[1],Q=L;break}if(Q&&w.label<Q[2]){w.label=Q[2],w.ops.push(L);break}Q[2]&&w.ops.pop(),w.trys.pop();continue}L=C.call(U,w)}catch(N){L=[6,N],W=0}finally{k=Q=0}if(L[0]&5)throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}}var u=Object.create?function(U,C,w,k){k===void 0&&(k=w),Object.defineProperty(U,k,{enumerable:!0,get:function(){return C[w]}})}:function(U,C,w,k){k===void 0&&(k=w),U[k]=C[w]};function A(U,C){for(var w in U)w!=="default"&&!Object.prototype.hasOwnProperty.call(C,w)&&u(C,U,w)}function M(U){var C=typeof Symbol=="function"&&Symbol.iterator,w=C&&U[C],k=0;if(w)return w.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&k>=U.length&&(U=void 0),{value:U&&U[k++],done:!U}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")}function E(U,C){var w=typeof Symbol=="function"&&U[Symbol.iterator];if(!w)return U;var k=w.call(U),W,Q=[],Z;try{for(;(C===void 0||C-- >0)&&!(W=k.next()).done;)Q.push(W.value)}catch(q){Z={error:q}}finally{try{W&&!W.done&&(w=k.return)&&w.call(k)}finally{if(Z)throw Z.error}}return Q}function m(){for(var U=[],C=0;C<arguments.length;C++)U=U.concat(E(arguments[C]));return U}function p(){for(var U=0,C=0,w=arguments.length;C<w;C++)U+=arguments[C].length;for(var k=Array(U),W=0,C=0;C<w;C++)for(var Q=arguments[C],Z=0,q=Q.length;Z<q;Z++,W++)k[W]=Q[Z];return k}function y(U,C,w){if(w||arguments.length===2)for(var k=0,W=C.length,Q;k<W;k++)(Q||!(k in C))&&(Q||(Q=Array.prototype.slice.call(C,0,k)),Q[k]=C[k]);return U.concat(Q||Array.prototype.slice.call(C))}function o(U){return this instanceof o?(this.v=U,this):new o(U)}function h(U,C,w){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=w.apply(U,C||[]),W,Q=[];return W={},Z("next"),Z("throw"),Z("return"),W[Symbol.asyncIterator]=function(){return this},W;function Z(V){k[V]&&(W[V]=function(tt){return new Promise(function(lt,vt){Q.push([V,tt,lt,vt])>1||q(V,tt)})})}function q(V,tt){try{F(k[V](tt))}catch(lt){K(Q[0][3],lt)}}function F(V){V.value instanceof o?Promise.resolve(V.value.v).then(L,N):K(Q[0][2],V)}function L(V){q("next",V)}function N(V){q("throw",V)}function K(V,tt){V(tt),Q.shift(),Q.length&&q(Q[0][0],Q[0][1])}}function s(U){var C,w;return C={},k("next"),k("throw",function(W){throw W}),k("return"),C[Symbol.iterator]=function(){return this},C;function k(W,Q){C[W]=U[W]?function(Z){return(w=!w)?{value:o(U[W](Z)),done:W==="return"}:Q?Q(Z):Z}:Q}}function l(U){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=U[Symbol.asyncIterator],w;return C?C.call(U):(U=typeof M=="function"?M(U):U[Symbol.iterator](),w={},k("next"),k("throw"),k("return"),w[Symbol.asyncIterator]=function(){return this},w);function k(Q){w[Q]=U[Q]&&function(Z){return new Promise(function(q,F){Z=U[Q](Z),W(q,F,Z.done,Z.value)})}}function W(Q,Z,q,F){Promise.resolve(F).then(function(L){Q({value:L,done:q})},Z)}}function i(U,C){return Object.defineProperty?Object.defineProperty(U,"raw",{value:C}):U.raw=C,U}var g=Object.create?function(U,C){Object.defineProperty(U,"default",{enumerable:!0,value:C})}:function(U,C){U.default=C};function O(U){if(U&&U.__esModule)return U;var C={};if(U!=null)for(var w in U)w!=="default"&&Object.prototype.hasOwnProperty.call(U,w)&&u(C,U,w);return g(C,U),C}function D(U){return U&&U.__esModule?U:{default:U}}function z(U,C,w,k){if(w==="a"&&!k)throw new TypeError("Private accessor was defined without a getter");if(typeof C=="function"?U!==C||!k:!C.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return w==="m"?k:w==="a"?k.call(U):k?k.value:C.get(U)}function H(U,C,w,k,W){if(k==="m")throw new TypeError("Private method is not writable");if(k==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof C=="function"?U!==C||!W:!C.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return k==="a"?W.call(U,w):W?W.value=w:C.set(U,w),w}},function(v,d,r){"use strict";(function(f){d.__esModule=!0,d.allToUpperCase=d.allToLowerCase=d.encodeBody=d.decodeBody=d.Format=d.promisify=d.trim=d.arrChooseN=d.randomHexString=d.randomString=d.cheapRandStr=d.dataSizeBytes=d.inspectBody=d.inspectError=d.isErrorInfo=d.now=d.parseQueryString=d.toQueryString=d.arrPopRandomElement=d.defaultPostHeaders=d.defaultGetHeaders=d.allSame=d.arrEvery=d.arrFilter=d.arrMap=d.safeArrForEach=d.arrForEach=d.forInOwnNonNullProperties=d.valuesArray=d.keysArray=d.arrWithoutValue=d.arrDeleteValue=d.arrIn=d.arrIndexOf=d.arrSubtract=d.arrIntersectOb=d.arrIntersect=d.intersect=d.containsValue=d.inherits=d.prototypicalClone=d.shallowClone=d.isEmptyArg=d.isOnlyPropIn=d.isEmpty=d.isObject=d.ensureArray=d.isArray=d.copy=d.mixin=void 0,d.getGlobalObject=d.getJitterCoefficient=d.getBackoffCoefficient=void 0;var a=r(1),_=a.__importDefault(r(0)),S=a.__importDefault(r(8));function I(X){return Math.floor(Math.random()*X.length)}function P(X){for(var rt=[],ut=1;ut<arguments.length;ut++)rt[ut-1]=arguments[ut];for(var ht=0;ht<rt.length;ht++){var St=rt[ht];if(!St)break;var $t=Object.prototype.hasOwnProperty;for(var an in St)(!$t||$t.call(St,an))&&(X[an]=St[an])}return X}d.mixin=P;function G(X){return P({},X)}d.copy=G,d.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function b(X){return M(X)?[]:d.isArray(X)?X:[X]}d.ensureArray=b;function T(X){return Object.prototype.toString.call(X)=="[object Object]"}d.isObject=T;function u(X){for(var rt in X)return!1;return!0}d.isEmpty=u;function A(X,rt){for(var ut in X)if(ut!==rt)return!1;return!0}d.isOnlyPropIn=A;function M(X){return X==null}d.isEmptyArg=M;function E(X){var rt=new Object;for(var ut in X)rt[ut]=X[ut];return rt}d.shallowClone=E;function m(X,rt){var ut=function(){function St(){}return St}();ut.prototype=X;var ht=new ut;return rt&&P(ht,rt),ht}d.prototypicalClone=m;var p=function(X,rt){if(_.default.Config.inherits){_.default.Config.inherits(X,rt);return}X.super_=rt,X.prototype=m(rt.prototype,{constructor:X})};d.inherits=p;function y(X,rt){for(var ut in X)if(X[ut]==rt)return!0;return!1}d.containsValue=y;function o(X,rt){return d.isArray(rt)?h(X,rt):s(X,rt)}d.intersect=o;function h(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var St=X[ht];d.arrIndexOf(rt,St)!=-1&&ut.push(St)}return ut}d.arrIntersect=h;function s(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var St=X[ht];St in rt&&ut.push(St)}return ut}d.arrIntersectOb=s;function l(X,rt){for(var ut=[],ht=0;ht<X.length;ht++){var St=X[ht];d.arrIndexOf(rt,St)==-1&&ut.push(St)}return ut}d.arrSubtract=l,d.arrIndexOf=Array.prototype.indexOf?function(X,rt,ut){return X.indexOf(rt,ut)}:function(X,rt,ut){ut=ut||0;for(var ht=X.length;ut<ht;ut++)if(X[ut]===rt)return ut;return-1};function i(X,rt){return d.arrIndexOf(X,rt)!==-1}d.arrIn=i;function g(X,rt){var ut=d.arrIndexOf(X,rt),ht=ut!=-1;return ht&&X.splice(ut,1),ht}d.arrDeleteValue=g;function O(X,rt){var ut=X.slice();return g(ut,rt),ut}d.arrWithoutValue=O;function D(X,rt){var ut=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||ut.push(ht);return ut}d.keysArray=D;function z(X,rt){var ut=[];for(var ht in X)rt&&!Object.prototype.hasOwnProperty.call(X,ht)||ut.push(X[ht]);return ut}d.valuesArray=z;function H(X,rt){for(var ut in X)Object.prototype.hasOwnProperty.call(X,ut)&&X[ut]&&rt(ut)}d.forInOwnNonNullProperties=H,d.arrForEach=Array.prototype.forEach?function(X,rt){X.forEach(rt)}:function(X,rt){for(var ut=X.length,ht=0;ht<ut;ht++)rt(X[ht],ht,X)};function U(X,rt){return d.arrForEach(X.slice(),rt)}d.safeArrForEach=U,d.arrMap=Array.prototype.map?function(X,rt){return X.map(rt)}:function(X,rt){for(var ut=[],ht=X.length,St=0;St<ht;St++)ut.push(rt(X[St],St,X));return ut},d.arrFilter=Array.prototype.filter?function(X,rt){return X.filter(rt)}:function(X,rt){for(var ut=[],ht=X.length,St=0;St<ht;St++)rt(X[St])&&ut.push(X[St]);return ut},d.arrEvery=Array.prototype.every?function(X,rt){return X.every(rt)}:function(X,rt){for(var ut=X.length,ht=0;ht<ut;ht++)if(!rt(X[ht],ht,X))return!1;return!0};function C(X,rt){if(X.length===0)return!0;var ut=X[0][rt];return d.arrEvery(X,function(ht){return ht[rt]===ut})}d.allSame=C;var w={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function k(X){var rt=w[X||bt.json];return{accept:rt,"X-Ably-Version":S.default.apiVersion,"Ably-Agent":S.default.agent}}d.defaultGetHeaders=k;function W(X){var rt,ut=rt=w[X||bt.json];return{accept:ut,"content-type":rt,"X-Ably-Version":S.default.apiVersion,"Ably-Agent":S.default.agent}}d.defaultPostHeaders=W;function Q(X){return X.splice(I(X),1)[0]}d.arrPopRandomElement=Q;function Z(X){var rt=[];if(X)for(var ut in X)rt.push(encodeURIComponent(ut)+"="+encodeURIComponent(X[ut]));return rt.length?"?"+rt.join("&"):""}d.toQueryString=Z;function q(X){for(var rt,ut=/([^?&=]+)=?([^&]*)/g,ht={};rt=ut.exec(X);)ht[decodeURIComponent(rt[1])]=decodeURIComponent(rt[2]);return ht}d.parseQueryString=q,d.now=Date.now||function(){return new Date().getTime()};function F(X){return X.constructor.name=="ErrorInfo"}d.isErrorInfo=F;function L(X){var rt,ut;return X instanceof Error||((ut=(rt=X)===null||rt===void 0?void 0:rt.constructor)===null||ut===void 0?void 0:ut.name)==="ErrorInfo"?_.default.Config.inspect(X):X.toString()}d.inspectError=L;function N(X){return _.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:_.default.Config.inspect(X)}d.inspectBody=N;function K(X){if(_.default.BufferUtils.isBuffer(X))return _.default.BufferUtils.byteLength(X);if(typeof X=="string")return _.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}d.dataSizeBytes=K;function V(){return String(Math.random()).substr(2)}d.cheapRandStr=V;var tt=function(X){if(_.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return _.default.Config.getRandomValues(rt),_.default.BufferUtils.base64Encode(rt)}for(var ut=_.default.BufferUtils.base64CharSet,ht=Math.round(X*4/3),St="",$t=0;$t<ht;$t++)St+=ut[I(ut)];return St};d.randomString=tt;var lt=function(X){if(_.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var rt=new Uint8Array(X);return _.default.Config.getRandomValues(rt),_.default.BufferUtils.hexEncode(rt)}for(var ut=_.default.BufferUtils.hexCharSet,ht=X*2,St="",$t=0;$t<ht;$t++)St+=ut[I(ut)];return St};d.randomHexString=lt;function vt(X,rt){for(var ut=Math.min(rt,X.length),ht=X.slice(),St=[],$t=0;$t<ut;$t++)St.push(Q(ht));return St}d.arrChooseN=vt,d.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function gt(X,rt,ut){return new Promise(function(ht,St){X[rt].apply(X,a.__spreadArray(a.__spreadArray([],ut),[function($t,an){$t?St($t):ht(an)}]))})}d.promisify=gt;var bt;(function(X){X.msgpack="msgpack",X.json="json"})(bt=d.Format||(d.Format={}));function xt(X,rt){return rt=="msgpack"?_.default.Config.msgpack.decode(X):JSON.parse(String(X))}d.decodeBody=xt;function ft(X,rt){return rt=="msgpack"?_.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}d.encodeBody=ft;function Mt(X){return X.map(function(rt){return rt&&rt.toLowerCase()})}d.allToLowerCase=Mt;function Zt(X){return X.map(function(rt){return rt&&rt.toUpperCase()})}d.allToUpperCase=Zt;function Bt(X){return Math.min((X+2)/3,2)}d.getBackoffCoefficient=Bt;function zt(){return 1-Math.random()*.2}d.getJitterCoefficient=zt;function ce(){return f||(typeof window!="undefined"?window:self)}d.getGlobalObject=ce}).call(this,r(12))},function(v,d,r){"use strict";(function(f){d.__esModule=!0;var a=r(1),_=a.__importDefault(r(0)),S=f||(typeof window!="undefined"?window:self),I;(function(u){u[u.None=0]="None",u[u.Error=1]="Error",u[u.Major=2]="Major",u[u.Minor=3]="Minor",u[u.Micro=4]="Micro"})(I||(I={}));function P(u,A){return(""+u).padStart(A?3:2,"0")}function G(u){return _.default.Config.logTimestamps?function(A){var M=new Date;u(P(M.getHours())+":"+P(M.getMinutes())+":"+P(M.getSeconds())+"."+P(M.getMilliseconds(),1)+" "+A)}:u}var b=function(){var u,A,M,E;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((A=(u=S==null?void 0:S.console)===null||u===void 0?void 0:u.log)===null||A===void 0?void 0:A.apply)=="function"?(M=function(){for(var m=[],p=0;p<arguments.length;p++)m[p]=arguments[p]},E=console.warn?function(){for(var m=[],p=0;p<arguments.length;p++)m[p]=arguments[p]}:M):S!=null&&S.console.log?M=E=function(){Function.prototype.apply.call(console.log,console,arguments)}:M=E=function(){},[M,E].map(G)},T=function(){function u(){u.logLevel=u.LOG_DEFAULT}return u.initLogHandlers=function(){var A=b(),M=A[0],E=A[1];this.logHandler=M,this.logErrorHandler=E},u.logLevel=I.Error,u.LOG_NONE=I.None,u.LOG_ERROR=I.Error,u.LOG_MAJOR=I.Major,u.LOG_MINOR=I.Minor,u.LOG_MICRO=I.Micro,u.LOG_DEFAULT=I.Error,u.LOG_DEBUG=I.Micro,u.logAction=function(A,M,E){u.shouldLog(A)&&(A===I.Error?u.logErrorHandler:u.logHandler)("Ably: "+M+": "+E)},u.deprecated=function(A,M){u.deprecatedWithMsg(A,"Please use '"+M+"' instead.")},u.deprecatedWithMsg=function(A,M){u.shouldLog(I.Error)&&u.logErrorHandler("Ably: Deprecation warning - '"+A+"' is deprecated and will be removed from a future version. "+M)},u.shouldLog=function(A){return A<=u.logLevel},u.setLog=function(A,M){A!==void 0&&(u.logLevel=A),M!==void 0&&(u.logHandler=u.logErrorHandler=M)},u}();d.default=T}).call(this,r(12))},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(){if(typeof ArrayBuffer=="function"){var a=f,_=a.lib,S=_.WordArray,I=S.init,P=S.init=function(G){if(G instanceof ArrayBuffer&&(G=new Uint8Array(G)),(G instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&G instanceof Uint8ClampedArray||G instanceof Int16Array||G instanceof Uint16Array||G instanceof Int32Array||G instanceof Uint32Array||G instanceof Float32Array||G instanceof Float64Array)&&(G=new Uint8Array(G.buffer,G.byteOffset,G.byteLength)),G instanceof Uint8Array){for(var b=G.byteLength,T=[],u=0;u<b;u++)T[u>>>2]|=G[u]<<24-u%4*8;I.call(this,T,b)}else I.apply(this,arguments)};P.prototype=S}}(),f.lib.WordArray})},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(0)),_=f.__importStar(r(2)),S=function(){function I(P,G,b,T){this.message=P,this.code=G,this.statusCode=b,this.cause=T}return I.prototype.toString=function(){var P="["+this.constructor.name;return this.message&&(P+=": "+this.message),this.statusCode&&(P+="; statusCode="+this.statusCode),this.code&&(P+="; code="+this.code),this.cause&&(P+="; cause="+_.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(P+="; see "+this.href+" "),P+="]",P},I.fromValues=function(P){var G=P,b=G.message,T=G.code,u=G.statusCode;if(typeof b!="string"||typeof T!="number"||typeof u!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+a.default.Config.inspect(P));var A=Object.assign(new I(b,T,u),P);return A.code&&!A.href&&(A.href="https://help.ably.io/error/"+A.code),A},I}();d.default=S},function(v,d,r){(function(f){(function(a,_){v.exports=d=_()})(this,function(){var a=a||function(_,S){var I;if(typeof window!="undefined"&&window.crypto&&(I=window.crypto),!I&&typeof window!="undefined"&&window.msCrypto&&(I=window.msCrypto),!I&&typeof f!="undefined"&&f.crypto&&(I=f.crypto),!I)try{I=r(44)}catch(s){}var P=function(){if(I){if(typeof I.getRandomValues=="function")try{return I.getRandomValues(new Uint32Array(1))[0]}catch(s){}if(typeof I.randomBytes=="function")try{return I.randomBytes(4).readInt32LE()}catch(s){}}throw new Error("Native crypto module could not be used to get secure random number.")},G=Object.create||function(){function s(){}return function(l){var i;return s.prototype=l,i=new s,s.prototype=null,i}}(),b={},T=b.lib={},u=T.Base=function(){return{extend:function(s){var l=G(this);return s&&l.mixIn(s),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var l in s)s.hasOwnProperty(l)&&(this[l]=s[l]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=T.WordArray=u.extend({init:function(s,l){s=this.words=s||[],l!=S?this.sigBytes=l:this.sigBytes=s.length*4},toString:function(s){return(s||E).stringify(this)},concat:function(s){var l=this.words,i=s.words,g=this.sigBytes,O=s.sigBytes;if(this.clamp(),g%4)for(var D=0;D<O;D++){var z=i[D>>>2]>>>24-D%4*8&255;l[g+D>>>2]|=z<<24-(g+D)%4*8}else for(var D=0;D<O;D+=4)l[g+D>>>2]=i[D>>>2];return this.sigBytes+=O,this},clamp:function(){var s=this.words,l=this.sigBytes;s[l>>>2]&=4294967295<<32-l%4*8,s.length=_.ceil(l/4)},clone:function(){var s=u.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var l=[],i=0;i<s;i+=4)l.push(P());return new A.init(l,s)}}),M=b.enc={},E=M.Hex={stringify:function(s){for(var l=s.words,i=s.sigBytes,g=[],O=0;O<i;O++){var D=l[O>>>2]>>>24-O%4*8&255;g.push((D>>>4).toString(16)),g.push((D&15).toString(16))}return g.join("")},parse:function(s){for(var l=s.length,i=[],g=0;g<l;g+=2)i[g>>>3]|=parseInt(s.substr(g,2),16)<<24-g%8*4;return new A.init(i,l/2)}},m=M.Latin1={stringify:function(s){for(var l=s.words,i=s.sigBytes,g=[],O=0;O<i;O++){var D=l[O>>>2]>>>24-O%4*8&255;g.push(String.fromCharCode(D))}return g.join("")},parse:function(s){for(var l=s.length,i=[],g=0;g<l;g++)i[g>>>2]|=(s.charCodeAt(g)&255)<<24-g%4*8;return new A.init(i,l)}},p=M.Utf8={stringify:function(s){try{return decodeURIComponent(escape(m.stringify(s)))}catch(l){throw new Error("Malformed UTF-8 data")}},parse:function(s){return m.parse(unescape(encodeURIComponent(s)))}},y=T.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=p.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var l,i=this._data,g=i.words,O=i.sigBytes,D=this.blockSize,z=D*4,H=O/z;s?H=_.ceil(H):H=_.max((H|0)-this._minBufferSize,0);var U=H*D,C=_.min(U*4,O);if(U){for(var w=0;w<U;w+=D)this._doProcessBlock(g,w);l=g.splice(0,U),i.sigBytes-=C}return new A.init(l,C)},clone:function(){var s=u.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0}),o=T.Hasher=y.extend({cfg:u.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var l=this._doFinalize();return l},blockSize:512/32,_createHelper:function(s){return function(l,i){return new s.init(i).finalize(l)}},_createHmacHelper:function(s){return function(l,i){return new h.HMAC.init(s,i).finalize(l)}}}),h=b.algo={};return b}(Math);return a})}).call(this,r(12))},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(3)),S=f.__importDefault(r(0));function I(b,T,u){try{T.apply(b,u)}catch(A){_.default.logAction(_.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+A+"; stack = "+(A&&A.stack))}}function P(b,T,u){for(var A,M,E,m=0;m<b.length;m++)if(A=b[m],u&&(A=A[u]),a.isArray(A)){for(;(M=a.arrIndexOf(A,T))!==-1;)A.splice(M,1);u&&A.length===0&&delete b[m][u]}else if(a.isObject(A))for(E in A)Object.prototype.hasOwnProperty.call(A,E)&&a.isArray(A[E])&&P([A],T,E)}var G=function(){function b(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return b.prototype.on=function(){for(var T=this,u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];if(u.length===1){var M=u[0];if(typeof M=="function")this.any.push(M);else throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(u))}if(u.length===2){var E=u[0],m=u[1];if(typeof m!="function")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(u));if(a.isEmptyArg(E))this.any.push(m);else if(a.isArray(E))E.forEach(function(y){T.on(y,m)});else{if(typeof E!="string")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(u));var p=this.events[E]||(this.events[E]=[]);p.push(m)}}},b.prototype.off=function(){for(var T,u=this,A=[],M=0;M<arguments.length;M++)A[M]=arguments[M];if(A.length==0||a.isEmptyArg(A[0])&&a.isEmptyArg(A[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var E=A[0],m=A[1],p=null,y=null;if(A.length===1||!m)typeof E=="function"?p=E:y=E;else{if(typeof m!="function")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(A));T=[E,m],y=T[0],p=T[1]}if(p&&a.isEmptyArg(y)){P([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(a.isArray(y)){y.forEach(function(o){u.off(o,p)});return}if(typeof y!="string")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(A));p?P([this.events,this.eventsOnce],p,y):(delete this.events[y],delete this.eventsOnce[y])},b.prototype.listeners=function(T){if(T){var u=this.events[T]||[];return this.eventsOnce[T]&&Array.prototype.push.apply(u,this.eventsOnce[T]),u.length?u:null}return this.any.length?this.any:null},b.prototype.emit=function(T){for(var u=[],A=1;A<arguments.length;A++)u[A-1]=arguments[A];var M={event:T},E=[];this.anyOnce.length&&(Array.prototype.push.apply(E,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(E,this.any);var m=this.eventsOnce[T];m&&(Array.prototype.push.apply(E,m),delete this.eventsOnce[T]);var p=this.events[T];p&&Array.prototype.push.apply(E,p),a.arrForEach(E,function(y){I(M,y,u)})},b.prototype.once=function(){for(var T=this,u=[],A=0;A<arguments.length;A++)u[A]=arguments[A];var M=u.length;if((M===0||M===1&&typeof u[0]!="function")&&S.default.Config.Promise){var E=u[0];if(typeof E!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(u));return new S.default.Config.Promise(function(s){T.once(E,s)})}var m=u[0],p=u[1];if(u.length===1&&typeof m=="function")this.anyOnce.push(m);else if(a.isEmptyArg(m)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(u));this.anyOnce.push(p)}else if(a.isArray(m)){var y=this,o=function(){var s=Array.prototype.slice.call(arguments);if(a.arrForEach(m,function(l){y.off(l,o)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(u));p.apply(this,s)};a.arrForEach(m,function(s){y.on(s,o)})}else{if(typeof m!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(u));var h=this.eventsOnce[m]||(this.eventsOnce[m]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(u));h.push(p)}}},b.prototype.whenState=function(T,u,A){for(var M=this,E=[],m=3;m<arguments.length;m++)E[m-3]=arguments[m];var p={event:T};if(typeof T!="string"||typeof u!="string")throw"whenState requires a valid event String argument";if(typeof A!="function"&&S.default.Config.Promise)return new S.default.Config.Promise(function(y){b.prototype.whenState.apply(M,[T,u,y].concat(E))});T===u?I(p,A,E):this.once(T,A)},b}();d.default=G},function(v,d,r){"use strict";d.__esModule=!0,d.getDefaults=d.normaliseOptions=d.objectifyOptions=d.getHosts=d.getFallbackHosts=d.environmentFallbackHosts=d.getHttpScheme=d.getPort=d.getHost=void 0;var f=r(1),a=f.__importDefault(r(0)),_=f.__importStar(r(2)),S=f.__importDefault(r(3)),I=f.__importDefault(r(5)),P=r(42),G="ably-js/"+P.version,b={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:P.version,apiVersion:"1.2",agent:G,getHost:T,getPort:u,getHttpScheme:A,environmentFallbackHosts:M,getFallbackHosts:E,getHosts:m,checkHost:p,objectifyOptions:h,normaliseOptions:s};function T(i,g,O){return O?g=g==i.restHost&&i.realtimeHost||g||i.realtimeHost:g=g||i.restHost,g}d.getHost=T;function u(i,g){return g||i.tls?i.tlsPort:i.port}d.getPort=u;function A(i){return i.tls?"https://":"http://"}d.getHttpScheme=A;function M(i){return[i+"-a-fallback.ably-realtime.com",i+"-b-fallback.ably-realtime.com",i+"-c-fallback.ably-realtime.com",i+"-d-fallback.ably-realtime.com",i+"-e-fallback.ably-realtime.com"]}d.environmentFallbackHosts=M;function E(i){var g=i.fallbackHosts,O=typeof i.httpMaxRetryCount!="undefined"?i.httpMaxRetryCount:b.httpMaxRetryCount;return g?_.arrChooseN(g,O):[]}d.getFallbackHosts=E;function m(i){return[i.restHost].concat(E(i))}d.getHosts=m;function p(i){if(typeof i!="string")throw new I.default("host must be a string; was a "+typeof i,4e4,400);if(!i.length)throw new I.default("host must not be zero-length",4e4,400)}function y(i,g,O){return i.realtimeHost?i.realtimeHost:i.restHost?(S.default.logAction(S.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+i.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+i.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),i.restHost):g?b.REALTIME_HOST:O+"-"+b.REALTIME_HOST}function o(i){var g={};for(var O in b.TIMEOUTS)g[O]=i[O]||b.TIMEOUTS[O];return g}function h(i){return typeof i=="string"?i.indexOf(":")==-1?{token:i}:{key:i}:i}d.objectifyOptions=h;function s(i){if(i.host&&(S.default.deprecated("host","restHost"),i.restHost=i.host),i.wsHost&&(S.default.deprecated("wsHost","realtimeHost"),i.realtimeHost=i.wsHost),i.queueEvents&&(S.default.deprecated("queueEvents","queueMessages"),i.queueMessages=i.queueEvents),i.fallbackHostsUseDefault){if(i.fallbackHosts){var g="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",g),new I.default(g,4e4,400)}if(i.port||i.tlsPort){var g="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",g),new I.default(g,4e4,400)}i.environment?S.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):S.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),i.fallbackHosts=b.FALLBACK_HOSTS}i.recover===!0&&(S.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),i.recover=function(k,W){W(!0)}),typeof i.recover=="function"&&i.closeOnUnload===!0&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),i.recover=void 0),"closeOnUnload"in i||(i.closeOnUnload=!i.recover),i.transports&&_.arrIn(i.transports,"xhr")&&(S.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),_.arrDeleteValue(i.transports,"xhr"),i.transports.push("xhr_streaming")),"queueMessages"in i||(i.queueMessages=!0);var O=i.environment&&String(i.environment).toLowerCase()||b.ENVIRONMENT,D=!O||O==="production";!i.fallbackHosts&&!i.restHost&&!i.realtimeHost&&!i.port&&!i.tlsPort&&(i.fallbackHosts=D?b.FALLBACK_HOSTS:M(O));var z=i.restHost||(D?b.REST_HOST:O+"-"+b.REST_HOST),H=y(i,D,O);_.arrForEach((i.fallbackHosts||[]).concat(z,H),p),i.port=i.port||b.PORT,i.tlsPort=i.tlsPort||b.TLS_PORT,"tls"in i||(i.tls=!0);var U=o(i);if("useBinaryProtocol"in i?i.useBinaryProtocol=a.default.Config.supportsBinary&&i.useBinaryProtocol:i.useBinaryProtocol=a.default.Config.preferBinary,i.clientId){var C=i.headers=i.headers||{};C["X-Ably-ClientId"]=a.default.BufferUtils.base64Encode(a.default.BufferUtils.utf8Encode(i.clientId))}if("idempotentRestPublishing"in i||(i.idempotentRestPublishing=!0),i.promises&&!a.default.Config.Promise&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),i.promises=!1),i.agents)for(var w in i.agents)b.agent+=" "+w+"/"+i.agents[w];return f.__assign(f.__assign({},i),{useBinaryProtocol:"useBinaryProtocol"in i?a.default.Config.supportsBinary&&i.useBinaryProtocol:a.default.Config.preferBinary,realtimeHost:H,restHost:z,maxMessageSize:i.maxMessageSize||b.maxMessageSize,timeouts:U})}d.normaliseOptions=s,d.default=b;function l(i){return Object.assign(b,i)}d.getDefaults=l},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(0)),_=f.__importDefault(r(3)),S=f.__importDefault(r(5)),I=f.__importStar(r(2));function P(u){return!u||!u.channelOptions?{channelOptions:u,plugins:{},baseEncodedPreviousPayload:void 0}:u}function G(u){if(u&&u.cipher&&!u.cipher.channelCipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=a.default.Crypto.getCipher(u.cipher);return{cipher:A.cipherParams,channelCipher:A.cipher}}return u}function b(u){var A=0;return u.name&&(A+=u.name.length),u.clientId&&(A+=u.clientId.length),u.extras&&(A+=JSON.stringify(u.extras).length),u.data&&(A+=I.dataSizeBytes(u.data)),A}var T=function(){function u(){}return u.prototype.toJSON=function(){var A=this.encoding,M=this.data;return M&&a.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(A=A?A+"/base64":"base64",M=a.default.BufferUtils.base64Encode(M)):M=a.default.BufferUtils.toBuffer(M)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:A,data:M}},u.prototype.toString=function(){var A="[Message";return this.name&&(A+="; name="+this.name),this.id&&(A+="; id="+this.id),this.timestamp&&(A+="; timestamp="+this.timestamp),this.clientId&&(A+="; clientId="+this.clientId),this.connectionId&&(A+="; connectionId="+this.connectionId),this.encoding&&(A+="; encoding="+this.encoding),this.extras&&(A+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?A+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?A+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):A+="; data (json)="+JSON.stringify(this.data)),this.extras&&(A+="; extras="+JSON.stringify(this.extras)),A+="]",A},u.encrypt=function(A,M,E){var m=A.data,p=A.encoding,y=M.channelCipher;p=p?p+"/":"",a.default.BufferUtils.isBuffer(m)||(m=a.default.BufferUtils.utf8Encode(String(m)),p=p+"utf-8/"),y.encrypt(m,function(o,h){if(o){E(o);return}A.data=h,A.encoding=p+"cipher+"+y.algorithm,E(null,A)})},u.encode=function(A,M,E){var m=A.data,p=typeof m=="string"||a.default.BufferUtils.isBuffer(m)||m===null||m===void 0;if(!p)if(I.isObject(m)||I.isArray(m))A.data=JSON.stringify(m),A.encoding=A.encoding?A.encoding+"/json":"json";else throw new S.default("Data type is unsupported",40013,400);M!=null&&M.cipher?u.encrypt(A,M,E):E(null,A)},u.encodeArray=function(A,M,E){for(var m=0,p=0;p<A.length;p++)u.encode(A[p],M,function(y){if(y){E(y);return}m++,m==A.length&&E(null,A)})},u.decode=function(A,M){var E=P(M),m=A.data,p=A.encoding;if(p){var y=p.split("/"),o=void 0,h=y.length,s=A.data,l="";try{for(;(o=h)>0;){var i=y[--h].match(/([-\w]+)(\+([\w-]+))?/);if(!i)break;switch(l=i[1],l){case"base64":s=a.default.BufferUtils.base64Decode(String(s)),o==y.length&&(m=s);continue;case"utf-8":s=a.default.BufferUtils.utf8Decode(s);continue;case"json":s=JSON.parse(s);continue;case"cipher":if(E.channelOptions!=null&&E.channelOptions.cipher&&E.channelOptions.channelCipher){var g=i[3],O=E.channelOptions.channelCipher;if(g!=O.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");s=O.decrypt(s);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!E.plugins||!E.plugins.vcdiff)throw new S.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new S.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var D=E.baseEncodedPreviousPayload;typeof D=="string"&&(D=a.default.BufferUtils.utf8Encode(D)),D=a.default.BufferUtils.toBuffer(D),s=a.default.BufferUtils.toBuffer(s),s=a.default.BufferUtils.typedArrayToBuffer(E.plugins.vcdiff.decode(s,D)),m=s}catch(H){throw new S.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var z=H;throw new S.default("Error processing the "+l+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{A.encoding=o<=0?null:y.slice(0,o).join("/"),A.data=s}}E.baseEncodedPreviousPayload=m},u.fromResponseBody=function(A,M,E){E&&(A=I.decodeBody(A,E));for(var m=0;m<A.length;m++){var p=A[m]=u.fromValues(A[m]);try{u.decode(p,M)}catch(y){_.default.logAction(_.default.LOG_ERROR,"Message.fromResponseBody()",y.toString())}}return A},u.fromValues=function(A){return Object.assign(new u,A)},u.fromValuesArray=function(A){for(var M=A.length,E=new Array(M),m=0;m<M;m++)E[m]=u.fromValues(A[m]);return E},u.fromEncoded=function(A,M){var E=u.fromValues(A),m=G(M);try{u.decode(E,m)}catch(p){_.default.logAction(_.default.LOG_ERROR,"Message.fromEncoded()",p.toString())}return E},u.fromEncodedArray=function(A,M){return G(M),A.map(function(E){return u.fromEncoded(E,M)})},u.getMessagesSize=function(A){for(var M,E=0,m=0;m<A.length;m++)M=A[m],E+=M.size||(M.size=b(M));return E},u.serialize=I.encodeBody,u}();d.default=T},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(5)),S=f.__importDefault(r(9)),I=f.__importDefault(r(14)),P={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},G=[];Object.keys(P).forEach(function(E){G[P[E]]=E});var b={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},T=Object.keys(b);b.MODE_ALL=b.PRESENCE|b.PUBLISH|b.SUBSCRIBE|b.PRESENCE_SUBSCRIBE;function u(E){var m=[];if(E)for(var p=0;p<E.length;p++)m.push(E[p].toString());return"[ "+m.join(", ")+" ]"}var A="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),M=function(){function E(){var m=this;this.hasFlag=function(p){return(m.flags&b[p])>0}}return E.prototype.setFlag=function(m){return this.flags=this.flags|b[m]},E.prototype.getMode=function(){return this.flags&&this.flags&b.MODE_ALL},E.prototype.encodeModesToFlags=function(m){var p=this;m.forEach(function(y){return p.setFlag(y)})},E.prototype.decodeModesFromFlags=function(){var m=this,p=[];return E.channelModes.forEach(function(y){m.hasFlag(y)&&p.push(y)}),p.length>0?p:void 0},E.fromValues=function(m){return Object.assign(new E,m)},E.Action=P,E.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],E.ActionName=G,E.serialize=a.encodeBody,E.deserialize=function(m,p){var y=a.decodeBody(m,p);return E.fromDeserialized(y)},E.fromDeserialized=function(m){var p=m.error;p&&(m.error=_.default.fromValues(p));var y=m.messages;if(y)for(var o=0;o<y.length;o++)y[o]=S.default.fromValues(y[o]);var h=m.presence;if(h)for(var o=0;o<h.length;o++)h[o]=I.default.fromValues(h[o],!0);return Object.assign(new E,m)},E.stringify=function(m){var p="[ProtocolMessage";m.action!==void 0&&(p+="; action="+E.ActionName[m.action]||!1);for(var y,o=0;o<A.length;o++)y=A[o],m[y]!==void 0&&(p+="; "+y+"="+m[y]);if(m.messages&&(p+="; messages="+u(S.default.fromValuesArray(m.messages))),m.presence&&(p+="; presence="+u(I.default.fromValuesArray(m.presence))),m.error&&(p+="; error="+_.default.fromValues(m.error).toString()),m.auth&&m.auth.accessToken&&(p+="; token="+m.auth.accessToken),m.flags&&(p+="; flags="+T.filter(m.hasFlag).join(",")),m.params){var h="";a.forInOwnNonNullProperties(m.params,function(s){h.length>0&&(h+="; "),h+=s+"="+m.params[s]}),h.length>0&&(p+="; params=["+h+"]")}return p+="]",p},E.isDuplicate=function(m,p){if(m&&p&&(m.action===P.MESSAGE||m.action===P.PRESENCE)&&m.action===p.action&&m.channel===p.channel&&m.id===p.id){if(m.action===P.PRESENCE)return!0;if(m.messages.length===p.messages.length){for(var y=0;y<m.messages.length;y++){var o=m.messages[y],h=p.messages[y];if((o.extras&&o.extras.delta&&o.extras.delta.format)!==(h.extras&&h.extras.delta&&h.extras.delta.format))return!1}return!0}}return!1},E}();d.default=M},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(10)),S=f.__importDefault(r(26)),I=f.__importDefault(r(3)),P=f.__importDefault(r(8)),G=f.__importDefault(r(19)),b=f.__importDefault(r(16)),T=f.__importDefault(r(5)),u=f.__importDefault(r(20)),A=f.__importDefault(r(0));function M(p){var y=[80015,80017,80030];return p.code?b.default.isTokenErr(p)?!1:a.arrIn(y,p.code)?!0:p.code>=4e4&&p.code<5e4:!1}function E(p){return M(p)?[_.default.fromValues({action:_.default.Action.ERROR,error:p})]:[_.default.fromValues({action:_.default.Action.DISCONNECTED,error:p})]}var m=function(p){f.__extends(y,p);function y(o,h,s){var l=p.call(this,o,h,s,!0)||this;return l.onAuthUpdated=function(i){l.authParams={access_token:i.token}},l.stream="stream"in s?s.stream:!0,l.sendRequest=null,l.recvRequest=null,l.pendingCallback=null,l.pendingItems=null,l}return y.prototype.connect=function(){var o=this;I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","starting"),S.default.prototype.connect.call(this);var h=this.params,s=h.options,l=P.default.getHost(s,h.host),i=P.default.getPort(s),g=s.tls?"https://":"http://";this.baseUri=g+l+":"+i+"/comet/";var O=this.baseUri+"connect";I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","uri: "+O),this.auth.getAuthParams(function(D,z){if(D){o.disconnect(D);return}if(!o.isDisposed){o.authParams=z;var H=o.params.getConnectParams(z);"stream"in H&&(o.stream=H.stream),I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+a.toQueryString(H));var U=!1,C=o.recvRequest=o.createRequest(O,null,H,null,o.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV);C.on("data",function(w){!o.recvRequest||(U||(U=!0,o.emit("preconnect")),o.onData(w))}),C.on("complete",function(w){if(o.recvRequest||(w=w||new T.default("Request cancelled",80003,400)),o.recvRequest=null,!U&&!w&&(U=!0,o.emit("preconnect")),o.onActivity(),w){w.code?o.onData(E(w)):o.disconnect(w);return}A.default.Config.nextTick(function(){o.recv()})}),C.exec()}})},y.prototype.requestClose=function(){I.default.logAction(I.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},y.prototype.requestDisconnect=function(){I.default.logAction(I.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},y.prototype._requestCloseOrDisconnect=function(o){var h=this,s=o?this.closeUri:this.disconnectUri;if(s){var l=this.createRequest(s,null,this.authParams,null,u.default.REQ_SEND);l.on("complete",function(i){i&&(I.default.logAction(I.default.LOG_ERROR,"CometTransport.request"+(o?"Close()":"Disconnect()"),"request returned err = "+a.inspectError(i)),h.finish("disconnected",i))}),l.exec()}},y.prototype.dispose=function(){var o=this;I.default.logAction(I.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(I.default.logAction(I.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",G.default.disconnected),A.default.Config.nextTick(function(){o.emit("disposed")}))},y.prototype.onConnect=function(o){if(!this.isDisposed){var h=o.connectionKey;S.default.prototype.onConnect.call(this,o);var s=this.baseUri+h;I.default.logAction(I.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+s+"; connectionKey = "+o.connectionKey),this.sendUri=s+"/send",this.recvUri=s+"/recv",this.closeUri=s+"/close",this.disconnectUri=s+"/disconnect"}},y.prototype.send=function(o){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(o);return}var h=this.pendingItems||[];h.push(o),this.pendingItems=null,this.sendItems(h)},y.prototype.sendAnyPending=function(){var o=this.pendingItems;!o||(this.pendingItems=null,this.sendItems(o))},y.prototype.sendItems=function(o){var h=this,s=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(o),u.default.REQ_SEND);s.on("complete",function(l,i){if(l&&I.default.logAction(I.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+a.inspectError(l)),h.sendRequest=null,l){l.code?h.onData(E(l)):h.disconnect(l);return}i&&h.onData(i),h.pendingItems&&A.default.Config.nextTick(function(){h.sendRequest||h.sendAnyPending()})}),s.exec()},y.prototype.recv=function(){var o=this;if(!this.recvRequest&&!!this.isConnected){var h=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV_POLL);h.on("data",function(s){o.onData(s)}),h.on("complete",function(s){if(o.recvRequest=null,o.onActivity(),s){s.code?o.onData(E(s)):o.disconnect(s);return}A.default.Config.nextTick(function(){o.recv()})}),h.exec()}},y.prototype.onData=function(o){try{var h=this.decodeResponse(o);if(h&&h.length)for(var s=0;s<h.length;s++)this.onProtocolMessage(_.default.fromDeserialized(h[s]))}catch(l){I.default.logAction(I.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+l.stack)}},y.prototype.encodeRequest=function(o){return JSON.stringify(o)},y.prototype.decodeResponse=function(o){return typeof o=="string"?JSON.parse(o):o},y}(S.default);d.default=m},function(v,d){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(f){typeof window=="object"&&(r=window)}v.exports=r},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(){var a=f,_=a.lib,S=_.WordArray,I=a.enc,P=I.Base64={stringify:function(b){var T=b.words,u=b.sigBytes,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.clamp();for(var M=[],E=0;E<u;E+=3)for(var m=T[E>>>2]>>>24-E%4*8&255,p=T[E+1>>>2]>>>24-(E+1)%4*8&255,y=T[E+2>>>2]>>>24-(E+2)%4*8&255,o=m<<16|p<<8|y,h=0;h<4&&E+h*.75<u;h++)M.push(A.charAt(o>>>6*(3-h)&63));var s=A.charAt(64);if(s)for(;M.length%4;)M.push(s);return M.join("")},parse:function(b){var T=b.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A=this._reverseMap;if(!A){A=this._reverseMap=[];for(var M=0;M<u.length;M++)A[u.charCodeAt(M)]=M}var E=u.charAt(64);if(E){var m=b.indexOf(E);m!==-1&&(T=m)}return G(b,T,A)}};function G(b,T,u){for(var A=[],M=0,E=0;E<T;E++)if(E%4){var m=u[b.charCodeAt(E-1)]<<E%4*2,p=u[b.charCodeAt(E)]>>>6-E%4*2,y=m|p;A[M>>>2]|=y<<24-M%4*8,M++}return S.create(A,M)}}(),f.enc.Base64})},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(3)),_=f.__importDefault(r(0)),S=f.__importDefault(r(9)),I=f.__importStar(r(2));function P(b){return G.Actions.indexOf(b)}var G=function(){function b(){}return b.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},b.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var T=this.id.split(":");return{connectionId:T[0],msgSerial:parseInt(T[1],10),index:parseInt(T[2],10)}},b.prototype.toJSON=function(){var T=this.data,u=this.encoding;return T&&_.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(u=u?u+"/base64":"base64",T=_.default.BufferUtils.base64Encode(T)):T=_.default.BufferUtils.toBuffer(T)),{clientId:this.clientId,action:P(this.action),data:T,encoding:u}},b.prototype.toString=function(){var T="[PresenceMessage";return T+="; action="+this.action,this.id&&(T+="; id="+this.id),this.timestamp&&(T+="; timestamp="+this.timestamp),this.clientId&&(T+="; clientId="+this.clientId),this.connectionId&&(T+="; connectionId="+this.connectionId),this.encoding&&(T+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?T+="; data="+this.data:_.default.BufferUtils.isBuffer(this.data)?T+="; data (buffer)="+_.default.BufferUtils.base64Encode(this.data):T+="; data (json)="+JSON.stringify(this.data)),T+="]",T},b.fromResponseBody=function(T,u,A){var M=[];A&&(T=I.decodeBody(T,A));for(var E=0;E<T.length;E++){var m=M[E]=b.fromValues(T[E],!0);try{b.decode(m,u)}catch(p){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",p.toString())}}return M},b.fromValues=function(T,u){return u&&(T.action=b.Actions[T.action]),Object.assign(new b,T)},b.fromValuesArray=function(T){for(var u=T.length,A=new Array(u),M=0;M<u;M++)A[M]=b.fromValues(T[M]);return A},b.fromEncoded=function(T,u){var A=b.fromValues(T,!0);try{b.decode(A,u)}catch(M){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromEncoded()",M.toString())}return A},b.fromEncodedArray=function(T,u){return T.map(function(A){return b.fromEncoded(A,u)})},b.Actions=["absent","present","enter","leave","update"],b.encode=S.default.encode,b.decode=S.default.decode,b.getMessagesSize=S.default.getMessagesSize,b}();d.default=G},function(v,d,r){"use strict";(function(f){d.__esModule=!0;var a=r(1),_=a.__importStar(r(2)),S=a.__importDefault(r(7)),I=a.__importDefault(r(5)),P=a.__importDefault(r(3)),G=a.__importDefault(r(8)),b=a.__importDefault(r(20)),T=a.__importDefault(r(0));function u(g,O){return _.arrIn(_.allToLowerCase(_.keysArray(O)),"x-ably-errorcode")}function A(g,O){if(u(g,O))return g.error&&I.default.fromValues(g.error)}var M=function(){},E=0,m={},p=typeof f!="undefined"&&f.XDomainRequest;function y(){var g=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return g&&Number(g[1])}function o(){var g;return p&&(g=y())&&g===10}function h(g,O){return g.getResponseHeader&&g.getResponseHeader(O)}function s(g){return g.getResponseHeader&&(g.getResponseHeader("transfer-encoding")||!g.getResponseHeader("content-length"))}function l(g){for(var O=_.trim(g.getAllResponseHeaders()).split(`\r
`),D={},z=0;z<O.length;z++){var H=O[z].split(":").map(_.trim);D[H[0].toLowerCase()]=H[1]}return D}var i=function(g){a.__extends(O,g);function O(D,z,H,U,C,w,k){var W=g.call(this)||this;return H=H||{},H.rnd=_.cheapRandStr(),o()&&!H.envelope&&(H.envelope="json"),W.uri=D+_.toQueryString(H),W.headers=z||{},W.body=U,W.method=k?k.toUpperCase():_.isEmptyArg(U)?"GET":"POST",W.requestMode=C,W.timeouts=w,W.timedOut=!1,W.requestComplete=!1,W.id=String(++E),m[W.id]=W,W}return O.createRequest=function(D,z,H,U,C,w,k){var W=w||G.default.TIMEOUTS;return new O(D,z,_.copy(H),U,C,W,k)},O.prototype.complete=function(D,z,H,U,C){this.requestComplete||(this.requestComplete=!0,!D&&z&&this.emit("data",z),this.emit("complete",D,z,H,U,C),this.dispose())},O.prototype.abort=function(){this.dispose()},O.prototype.exec=function(){var D=this,z=this.headers,H=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,U=this.timer=setTimeout(function(){D.timedOut=!0,w.abort()},H),C=this.method,w=this.xhr=new XMLHttpRequest,k=z.accept,W=this.body,Q="text";if(k?k.indexOf("application/x-msgpack")===0&&(Q="arraybuffer"):z.accept="application/json",W){var Z=z["content-type"]||(z["content-type"]="application/json");Z.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}w.open(C,this.uri,!0),w.responseType=Q,"authorization"in z&&(w.withCredentials=!0);for(var q in z)w.setRequestHeader(q,z[q]);var F=function(ft,Mt,Zt,Bt){var zt,ce=Mt+" (event type: "+ft.type+")";!((zt=D==null?void 0:D.xhr)===null||zt===void 0)&&zt.statusText&&(ce+=", current statusText is "+D.xhr.statusText),P.default.logAction(P.default.LOG_ERROR,"Request.on"+ft.type+"()",ce),D.complete(new I.default(ce,Zt,Bt))};w.onerror=function(ft){F(ft,"XHR error occurred",null,400)},w.onabort=function(ft){D.timedOut?F(ft,"Request aborted due to request timeout expiring",null,408):F(ft,"Request cancelled",null,400)},w.ontimeout=function(ft){F(ft,"Request timed out",null,408)};var L,N,K,V=0,tt=!1,lt=function(){if(clearTimeout(U),K=N<400,N==204){D.complete(null,null,null,null,N);return}L=D.requestMode==b.default.REQ_RECV_STREAM&&K&&s(w)},vt=function(){var ft;try{var Mt=h(w,"content-type"),Zt=Mt?Mt.indexOf("application/json")>=0:w.responseType=="text";if(Zt){var Bt=w.responseType==="arraybuffer"?T.default.BufferUtils.utf8Decode(w.response):String(w.responseText);Bt.length?ft=JSON.parse(Bt):ft=Bt,tt=!0}else ft=w.response;ft.response!==void 0?(N=ft.statusCode,K=N<400,z=ft.headers,ft=ft.response):z=l(w)}catch(ce){D.complete(new I.default("Malformed response body from server: "+ce.message,null,400));return}if(K||_.isArray(ft)){D.complete(null,ft,z,tt,N);return}var zt=A(ft,z);zt||(zt=new I.default("Error response received from server: "+N+" body was: "+T.default.Config.inspect(ft),null,N)),D.complete(zt,ft,z,tt,N)};function gt(){for(var ft=w.responseText,Mt=ft.length-1,Zt,Bt;V<Mt&&(Zt=ft.indexOf(`
`,V))>-1;)Bt=ft.slice(V,Zt),V=Zt+1,bt(Bt)}var bt=function(ft){try{ft=JSON.parse(ft)}catch(Mt){D.complete(new I.default("Malformed response body from server: "+Mt.message,null,400));return}D.emit("data",ft)},xt=function(){gt(),D.streamComplete=!0,T.default.Config.nextTick(function(){D.complete()})};w.onreadystatechange=function(){var ft=w.readyState;ft<3||w.status!==0&&(N===void 0&&(N=w.status,N===1223&&(N=204),lt()),ft==3&&L?gt():ft==4&&(L?xt():vt()))},w.send(W)},O.prototype.dispose=function(){var D=this.xhr;if(D){D.onreadystatechange=D.onerror=D.onabort=D.ontimeout=M,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||D.abort()}delete m[this.id]},O}(S.default);d.default=i}).call(this,r(12))},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(3)),_=f.__importStar(r(2)),S=f.__importDefault(r(22)),I=f.__importDefault(r(5)),P=f.__importDefault(r(43)),G=r(13),b=r(32),T=f.__importDefault(r(17)),u=f.__importDefault(r(0)),A=Math.pow(2,17);function M(){}function E(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function m(H){return!!H.connection}function p(H){return _.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new I.default(_.inspectError(H),H.code||40170,H.statusCode||401)}var y=function(H){return u.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):G.stringify(b.parse(H))},o=function(H,U){if(u.default.Config.createHmac){var C=u.default.Config.createHmac("SHA256",U);return C.update(H),C.digest("base64")}return G.stringify(P.default(H,U))};function h(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var U={},C=_.keysArray(H,!0);if(!C)return"";C.sort();for(var w=0;w<C.length;w++)U[C[w]]=H[C[w]].sort();return JSON.stringify(U)}function s(H){if(H.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var U="authOptions must include valid authentication parameters";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",U),new Error(U)}}function l(H){return"useTokenAuth"in H&&!H.useTokenAuth}function i(H){return H.useTokenAuth||!l(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function g(H){return!H.key&&!H.authCallback&&!H.authUrl}var O=0;function D(){return O++}var z=function(){function H(U,C){if(this.authOptions={},this.client=U,this.tokenParams=C.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,i(C)){if(C.key&&!o){var w="client-side token request signing not supported";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",w),new Error(w)}g(C)&&a.default.logAction(a.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(C.defaultTokenParams,C),s(this.authOptions)}else{if(!C.key){var w="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",w),new I.default(w,40160,401)}a.default.logAction(a.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(C)}}return H.prototype.authorize=function(U,C,w){var k=this,W;if(typeof U=="function"&&!w?(w=U,W=U=null):typeof C=="function"&&!w?(w=C,W=null):W=C,!w&&this.client.options.promises)return _.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new I.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(a.default.logAction(a.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),_.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(U,W,function(Q,Z){if(Q){k.client.connection&&k.client.connection.connectionManager.actOnErrorFromAuthorize(Q),w==null||w(Q);return}m(k.client)?k.client.connection.connectionManager.onAuthUpdated(Z,w||M):w==null||w(null,Z)})},H.prototype.authorise=function(U,C,w){a.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(U,C,w)},H.prototype._forceNewToken=function(U,C,w){var k=this;this.tokenDetails=null,this._saveTokenOptions(U,C),s(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,Q){delete k.tokenParams.timestamp,delete k.authOptions.queryTime,w(W,Q)})},H.prototype.requestToken=function(U,C,w){var k=this;if(typeof U=="function"&&!w?(w=U,C=U=null):typeof C=="function"&&!w&&(w=C,C=null),!w&&this.client.options.promises)return _.promisify(this,"requestToken",arguments);C=C||this.authOptions,U=U||_.copy(this.tokenParams);var W=w||M,Q,Z=this.client;if(C.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),Q=C.authCallback;else if(C.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),Q=function(V,tt){var lt=_.mixin({accept:"application/json, text/plain"},C.authHeaders),vt=C.authMethod&&C.authMethod.toLowerCase()==="post",gt,bt=C.authUrl.indexOf("?");bt>-1&&(gt=_.parseQueryString(C.authUrl.slice(bt)),C.authUrl=C.authUrl.slice(0,bt),vt||(C.authParams=_.mixin(gt,C.authParams)));var xt=_.mixin({},C.authParams||{},V),ft=function(Bt,zt,ce,X){var rt;if(Bt?a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+_.inspectError(Bt)):(rt=ce["content-type"],a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+rt+"; body: "+_.inspectBody(zt))),Bt||X)return tt(Bt,zt);if(u.default.BufferUtils.isBuffer(zt)&&(zt=zt.toString()),!rt){tt(new I.default("authUrl response is missing a content-type header",40170,401));return}var ut=rt.indexOf("application/json")>-1,ht=rt.indexOf("text/plain")>-1||rt.indexOf("application/jwt")>-1;if(!ut&&!ht){tt(new I.default("authUrl responded with unacceptable content-type "+rt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ut){if(zt.length>A){tt(new I.default("authUrl response exceeded max permitted length",40170,401));return}try{zt=JSON.parse(zt)}catch(St){tt(new I.default("Unexpected error processing authURL response; err = "+St.message,40170,401));return}}tt(null,zt,rt)};if(a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+C.authUrl+"; Params: "+JSON.stringify(xt)+"; method: "+(vt?"POST":"GET")),vt){var Mt=lt||{};Mt["content-type"]="application/x-www-form-urlencoded";var Zt=_.toQueryString(xt).slice(1);k.client.http.doUri(T.default.Post,Z,C.authUrl,Mt,Zt,gt,ft)}else k.client.http.doUri(T.default.Get,Z,C.authUrl,lt||{},null,xt,ft)};else if(C.key)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),Q=function(V,tt){k.createTokenRequest(V,C,tt)};else{var q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";a.default.logAction(a.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new I.default(q,40171,403));return}"capability"in U&&(U.capability=h(U.capability));var F=function(V,tt){var lt=V.keyName,vt="/keys/"+lt+"/requestToken",gt=function(xt){return Z.baseUri(xt)+vt},bt=_.defaultPostHeaders();C.requestHeaders&&_.mixin(bt,C.requestHeaders),a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+vt+"; Token params: "+JSON.stringify(V)),k.client.http.do(T.default.Post,Z,gt,bt,JSON.stringify(V),null,tt)},L=!1,N=this.client.options.timeouts.realtimeRequestTimeout,K=setTimeout(function(){L=!0;var V="Token request callback timed out after "+N/1e3+" seconds";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",V),W(new I.default(V,40170,401))},N);Q(U,function(V,tt,lt){if(!L){if(clearTimeout(K),V){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+_.inspectError(V)),W(p(V));return}if(typeof tt=="string"){tt.length===0?W(new I.default("Token string is empty",40170,401)):tt.length>A?W(new I.default("Token string exceeded max permitted length (was "+tt.length+" bytes)",40170,401)):tt==="undefined"||tt==="null"?W(new I.default("Token string was literal null/undefined",40170,401)):tt[0]==="{"&&!(lt&&lt.indexOf("application/jwt")>-1)?W(new I.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:tt});return}if(typeof tt!="object"){var vt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof tt;a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",vt),W(new I.default(vt,40170,401));return}var gt=JSON.stringify(tt).length;if(gt>A&&!C.suppressMaxLengthCheck){W(new I.default("Token request/details object exceeded max permitted stringified size (was "+gt+" bytes)",40170,401));return}if("issued"in tt){W(null,tt);return}if(!("keyName"in tt)){var vt="Expected token request callback to call back with a token string, token request object, or token details object";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",vt),W(new I.default(vt,40170,401));return}F(tt,function(bt,xt,ft,Mt){if(bt){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+_.inspectError(bt)),W(p(bt));return}Mt||(xt=JSON.parse(xt)),a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,xt)})}})},H.prototype.createTokenRequest=function(U,C,w){var k=this;if(typeof U=="function"&&!w?(w=U,C=U=null):typeof C=="function"&&!w&&(w=C,C=null),!w&&this.client.options.promises)return _.promisify(this,"createTokenRequest",arguments);C=C||this.authOptions,U=U||_.copy(this.tokenParams);var W=C.key;if(!W){w(new I.default("No key specified",40101,403));return}var Q=W.split(":"),Z=Q[0],q=Q[1];if(!q){w(new I.default("Invalid key specified",40101,403));return}if(U.clientId===""){w(new I.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in U&&(U.capability=h(U.capability));var F=_.mixin({keyName:Z},U),L=U.clientId||"",N=U.ttl||"",K=U.capability||"";(function(V){if(F.timestamp){V();return}k.getTimestamp(C&&C.queryTime,function(tt,lt){if(tt){w(tt);return}F.timestamp=lt,V()})})(function(){var V=F.nonce||(F.nonce=E()),tt=F.timestamp,lt=F.keyName+`
`+N+`
`+K+`
`+L+`
`+tt+`
`+V+`
`;F.mac=F.mac||o(lt,q),a.default.logAction(a.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),w(null,F)})},H.prototype.getAuthParams=function(U){this.method=="basic"?U(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(C,w){if(C){U(C);return}if(!w)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{access_token:w.token})})},H.prototype.getAuthHeaders=function(U){this.method=="basic"?U(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(C,w){if(C){U(C);return}if(!w)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");U(null,{authorization:"Bearer "+y(w.token)})})},H.prototype.getTimestamp=function(U,C){!this.isTimeOffsetSet()&&(U||this.authOptions.queryTime)?this.client.time(C):C(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return _.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(U){this.method="basic",this.key=U.key,this.basicKey=y(U.key),this.authOptions=U||{},"clientId"in U&&this._userSetClientId(U.clientId)},H.prototype._saveTokenOptions=function(U,C){this.method="token",U&&(this.tokenParams=U),C&&(C.token&&(C.tokenDetails=typeof C.token=="string"?{token:C.token}:C.token),C.tokenDetails&&(this.tokenDetails=C.tokenDetails),"clientId"in C&&this._userSetClientId(C.clientId),this.authOptions=C)},H.prototype._ensureValidAuthCredentials=function(U,C){var w=this,k=this.tokenDetails;if(k){if(this._tokenClientIdMismatch(k.clientId)){C(new I.default("Mismatch between clientId in token ("+k.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!k.expires||k.expires>=this.getTimestampUsingOffset()){a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+k.expires),C(null,k);return}a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=S.default.create())).push(C),!(this.currentTokenRequestId!==null&&!U)){var W=this.currentTokenRequestId=D();this.requestToken(this.tokenParams,this.authOptions,function(Q,Z){if(w.currentTokenRequestId>W){a.default.logAction(a.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}w.currentTokenRequestId=null;var q=w.waitingForTokenRequest||M;if(w.waitingForTokenRequest=null,Q){q(Q);return}q(null,w.tokenDetails=Z)})}},H.prototype._userSetClientId=function(U){if(typeof U=="string"||U===null){if(U==="*")throw new I.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var C=this._uncheckedSetClientId(U);if(C)throw C}else throw new I.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(U){if(this._tokenClientIdMismatch(U)){var C="Unexpected clientId mismatch: client has "+this.clientId+", requested "+U,w=new I.default(C,40102,401);return a.default.logAction(a.default.LOG_ERROR,"Auth._uncheckedSetClientId()",C),w}else return this.clientId=this.tokenParams.clientId=U,null},H.prototype._tokenClientIdMismatch=function(U){return!!(this.clientId&&this.clientId!=="*"&&U&&U!=="*"&&this.clientId!==U)},H.isTokenErr=function(U){return U.code&&U.code>=40140&&U.code<40150},H}();d.default=z},function(v,d,r){"use strict";d.__esModule=!0;var f;(function(a){a.Get="get",a.Delete="delete",a.Post="post",a.Put="put",a.Patch="patch"})(f||(f={})),d.default=f},function(v,d,r){"use strict";d.__esModule=!0,d.HttpPaginatedResponse=d.PaginatedResult=void 0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(3)),S=f.__importDefault(r(24));function I(A){var M=A.match(/^\.\/(\w+)\?(.*)$/);return M&&M[2]&&a.parseQueryString(M[2])}function P(A){typeof A=="string"&&(A=A.split(","));for(var M={},E=0;E<A.length;E++){var m=A[E].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(m){var p=I(m[1]);p&&(M[m[2]]=p)}}return M}function G(A,M,E){return!(E&&(M||typeof A.code=="number"))}var b=function(){function A(M,E,m,p,y,o){this.rest=M,this.path=E,this.headers=m,this.envelope=p!=null?p:null,this.bodyHandler=y,this.useHttpPaginatedResponse=o||!1}return A.prototype.get=function(M,E){var m=this;S.default.get(this.rest,this.path,this.headers,M,this.envelope,function(p,y,o,h,s){m.handlePage(p,y,o,h,s,E)})},A.prototype.delete=function(M,E){var m=this;S.default.delete(this.rest,this.path,this.headers,M,this.envelope,function(p,y,o,h,s){m.handlePage(p,y,o,h,s,E)})},A.prototype.post=function(M,E,m){var p=this;S.default.post(this.rest,this.path,E,this.headers,M,this.envelope,function(y,o,h,s,l){m&&p.handlePage(y,o,h,s,l,m)})},A.prototype.put=function(M,E,m){var p=this;S.default.put(this.rest,this.path,E,this.headers,M,this.envelope,function(y,o,h,s,l){m&&p.handlePage(y,o,h,s,l,m)})},A.prototype.patch=function(M,E,m){var p=this;S.default.patch(this.rest,this.path,E,this.headers,M,this.envelope,function(y,o,h,s,l){m&&p.handlePage(y,o,h,s,l,m)})},A.prototype.handlePage=function(M,E,m,p,y,o){if(M&&G(M,E,this.useHttpPaginatedResponse)){_.default.logAction(_.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+a.inspectError(M)),o==null||o(M);return}var h,s,l;try{h=this.bodyHandler(E,m||{},p)}catch(i){o==null||o(M||i);return}m&&(s=m.Link||m.link)&&(l=P(s)),this.useHttpPaginatedResponse?o(null,new u(this,h,m||{},y,l,M)):o(null,new T(this,h,l))},A}(),T=function(){function A(M,E,m){var p=this;this.resource=M,this.items=E;var y=this;m&&("first"in m&&(this.first=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"first",[]);y.get(m.first,o)}),"current"in m&&(this.current=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"current",[]);y.get(m.current,o)}),this.next=function(o){if(!o&&y.resource.rest.options.promises)return a.promisify(y,"next",[]);"next"in m?y.get(m.next,o):o(null)},this.hasNext=function(){return"next"in m},this.isLast=function(){var o;return!(!((o=p.hasNext)===null||o===void 0)&&o.call(p))})}return A.prototype.get=function(M,E){var m=this.resource;S.default.get(m.rest,m.path,m.headers,M,m.envelope,function(p,y,o,h,s){m.handlePage(p,y,o,h,s,E)})},A}();d.PaginatedResult=T;var u=function(A){f.__extends(M,A);function M(E,m,p,y,o,h){var s=A.call(this,E,m,o)||this;return s.statusCode=y,s.success=y<300&&y>=200,s.headers=p,s.errorCode=h&&h.code,s.errorMessage=h&&h.message,s}return M.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},M}(T);d.HttpPaginatedResponse=u,d.default=b},function(v,d,r){"use strict";d.__esModule=!0,d.isRetriable=void 0;var f=r(1),a=f.__importDefault(r(5)),_={disconnected:a.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:a.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:a.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:a.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:a.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:a.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:a.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function S(I){if(!I.statusCode||!I.code||I.statusCode>=500)return!0;var P=!1;return Object.values(_).forEach(function(G){G.code&&G.code==I.code&&(P=!0)}),P}d.isRetriable=S,d.default=_},function(v,d,r){"use strict";d.__esModule=!0;var f;(function(a){a[a.REQ_SEND=0]="REQ_SEND",a[a.REQ_RECV=1]="REQ_RECV",a[a.REQ_RECV_POLL=2]="REQ_RECV_POLL",a[a.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(f||(f={})),d.default=f},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(4),r(58),r(13),r(39),r(31),r(23),r(27),r(28),r(59),r(60))})(this,function(f){return f})},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(3)),_=function(){function S(I){this.members=I||[]}return S.prototype.call=function(){for(var I=[],P=0;P<arguments.length;P++)I[P]=arguments[P];for(var G=0,b=this.members;G<b.length;G++){var T=b[G];if(T)try{T.apply(void 0,I)}catch(u){a.default.logAction(a.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+u+"; stack = "+u.stack)}}},S.prototype.push=function(){for(var I,P=[],G=0;G<arguments.length;G++)P[G]=arguments[G];(I=this.members).push.apply(I,P)},S.create=function(I){var P=new S(I);return Object.assign(function(){for(var G=[],b=0;b<arguments.length;b++)G[b]=arguments[b];return P.call.apply(P,G)},{push:function(G){return P.push(G)}})},S}();d.default=_},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){(function(){var a=f,_=a.lib,S=_.Base,I=a.enc,P=I.Utf8,G=a.algo,b=G.HMAC=S.extend({init:function(T,u){T=this._hasher=new T.init,typeof u=="string"&&(u=P.parse(u));var A=T.blockSize,M=A*4;u.sigBytes>M&&(u=T.finalize(u)),u.clamp();for(var E=this._oKey=u.clone(),m=this._iKey=u.clone(),p=E.words,y=m.words,o=0;o<A;o++)p[o]^=1549556828,y[o]^=909522486;E.sigBytes=m.sigBytes=M,this.reset()},reset:function(){var T=this._hasher;T.reset(),T.update(this._iKey)},update:function(T){return this._hasher.update(T),this},finalize:function(T){var u=this._hasher,A=u.finalize(T);u.reset();var M=u.finalize(this._oKey.clone().concat(A));return M}})})()})},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(0)),_=f.__importStar(r(2)),S=f.__importDefault(r(3)),I=f.__importDefault(r(16)),P=f.__importDefault(r(17)),G=f.__importDefault(r(5));function b(m,p,y,o,h){m.http.supportsAuthHeaders?m.auth.getAuthHeaders(function(s,l){s?o(s):h(_.mixin(l,p),y)}):m.auth.getAuthParams(function(s,l){s?o(s):h(p,_.mixin(l,y))})}function T(m,p){return function(y,o,h,s,l){if(y&&!o){m(y);return}if(!s)try{o=_.decodeBody(o,p)}catch(H){m(H);return}if(!o){m(new G.default("unenvelope(): Response body is missing",null));return}var i=o,g=i.statusCode,O=i.response,D=i.headers;if(g===void 0){m(y,o,h,!0,l);return}if(g<200||g>=300){var z=O&&O.error||y;z||(z=new Error("Error in unenveloping "+o),z.statusCode=g),m(z,O,D,!0,g);return}m(y,O,D,!0,g)}}function u(m){var p=[];if(m)for(var y in m)p.push(y+"="+m[y]);return p.join("&")}function A(m,p){return m+(p?"?":"")+u(p)}function M(m,p,y,o){return function(h,s,l,i,g){h?S.default.logAction(S.default.LOG_MICRO,"Resource."+p+"()","Received Error; "+A(y,o)+"; Error: "+_.inspectError(h)):S.default.logAction(S.default.LOG_MICRO,"Resource."+p+"()","Received; "+A(y,o)+"; Headers: "+u(l)+"; StatusCode: "+g+"; Body: "+(a.default.BufferUtils.isBuffer(s)?s.toString():s)),m&&m(h,s,l,i,g)}}var E=function(){function m(){}return m.get=function(p,y,o,h,s,l){m.do(P.default.Get,p,y,null,o,h,s,l)},m.delete=function(p,y,o,h,s,l){m.do(P.default.Delete,p,y,null,o,h,s,l)},m.post=function(p,y,o,h,s,l,i){m.do(P.default.Post,p,y,o,h,s,l,i)},m.patch=function(p,y,o,h,s,l,i){m.do(P.default.Patch,p,y,o,h,s,l,i)},m.put=function(p,y,o,h,s,l,i){m.do(P.default.Put,p,y,o,h,s,l,i)},m.do=function(p,y,o,h,s,l,i,g){S.default.shouldLog(S.default.LOG_MICRO)&&(g=M(g,p,o,l)),i&&(g=g&&T(g,i),(l=l||{}).envelope=i);function O(D,z){var H;if(S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Resource."+p+"()","Sending; "+A(o,z)),S.default.shouldLog(S.default.LOG_MICRO)){var U=h;if(((H=D["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{U=a.default.Config.msgpack.decode(h)}catch(C){S.default.logAction(S.default.LOG_MICRO,"Resource."+p+"()","Sending MsgPack Decoding Error: "+_.inspectError(C))}S.default.logAction(S.default.LOG_MICRO,"Resource."+p+"()","Sending; "+A(o,z)+"; Body: "+U)}y.http.do(p,y,o,D,h,z,function(C,w,k,W,Q){if(C&&I.default.isTokenErr(C)){y.auth.authorize(null,null,function(Z){if(Z){g(Z);return}b(y,k,z,g,O)});return}g(C,w,k,W,Q)})}b(y,s,l,g,O)},m}();d.default=E},function(v,d,r){"use strict";(function(f){d.__esModule=!0,d.TransportParams=void 0;var a=r(1),_=a.__importDefault(r(10)),S=a.__importStar(r(2)),I=a.__importStar(r(51)),P=a.__importDefault(r(8)),G=a.__importDefault(r(0)),b=a.__importDefault(r(7)),T=a.__importDefault(r(35)),u=a.__importDefault(r(3)),A=a.__importDefault(r(36)),M=a.__importStar(r(19)),E=a.__importDefault(r(5)),m=a.__importDefault(r(16)),p=a.__importDefault(r(9)),y=a.__importDefault(r(22)),o=a.__importDefault(r(52)),h=a.__importDefault(r(26)),s=a.__importDefault(r(53)),l=function(){var Z;return typeof G.default.WebStorage!="undefined"&&((Z=G.default.WebStorage)===null||Z===void 0?void 0:Z.localSupported)},i=function(){var Z;return typeof G.default.WebStorage!="undefined"&&((Z=G.default.WebStorage)===null||Z===void 0?void 0:Z.sessionSupported)},g=_.default.Action,O=function(){},D="ably-transport-preference",z="ably-connection-recovery";function H(){var Z,q;return i()&&((q=(Z=G.default.WebStorage)===null||Z===void 0?void 0:Z.getSession)===null||q===void 0?void 0:q.call(Z,z))}function U(Z){var q,F;return i()&&((F=(q=G.default.WebStorage)===null||q===void 0?void 0:q.setSession)===null||F===void 0?void 0:F.call(q,z,Z))}function C(){var Z,q;return i()&&((q=(Z=G.default.WebStorage)===null||Z===void 0?void 0:Z.removeSession)===null||q===void 0?void 0:q.call(Z,z))}function w(Z,q){return S.arrIndexOf(G.default.Defaults.transportPreferenceOrder,Z.shortName)>S.arrIndexOf(G.default.Defaults.transportPreferenceOrder,q.shortName)}function k(Z,q,F){var L;if(Z.channel!==q.channel||(L=Z.action)!==g.PRESENCE&&L!==g.MESSAGE||L!==q.action)return!1;var N=L===g.PRESENCE?"presence":"messages",K=Z[N].concat(q[N]),V=p.default.getMessagesSize(K);return V>F||!S.allSame(K,"clientId")||!S.arrEvery(K,function(tt){return!tt.id})?!1:(Z[N]=K,!0)}var W=function(){function Z(q,F,L,N){this.options=q,this.host=F,this.mode=L,this.connectionKey=N,this.format=q.useBinaryProtocol?S.Format.msgpack:S.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return Z.prototype.getConnectParams=function(q){var F=q?S.copy(q):{},L=this.options;switch(this.mode){case"upgrade":F.upgrade=this.connectionKey;break;case"resume":F.resume=this.connectionKey,this.timeSerial!==void 0?F.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(F.connectionSerial=this.connectionSerial);break;case"recover":{var N=L.recover.split(":");if(N){F.recover=N[0];var K=N[1];isNaN(Number(K))?F.timeSerial=K:F.connectionSerial=K}break}default:}return L.clientId!==void 0&&(F.clientId=L.clientId),L.echoMessages===!1&&(F.echo="false"),this.format!==void 0&&(F.format=this.format),this.stream!==void 0&&(F.stream=this.stream),this.heartbeats!==void 0&&(F.heartbeats=this.heartbeats),F.v=P.default.apiVersion,F.agent=encodeURIComponent(P.default.agent),L.transportParams!==void 0&&S.mixin(F,L.transportParams),F},Z.prototype.toString=function(){var q="[mode="+this.mode;return this.host&&(q+=",host="+this.host),this.connectionKey&&(q+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(q+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(q+=",timeSerial="+this.timeSerial),this.format&&(q+=",format="+this.format),q+="]",q},Z}();d.TransportParams=W;var Q=function(Z){a.__extends(q,Z);function q(F,L){var N=Z.call(this)||this;N.disconnectedRetryCount=0,q.initTransports(),N.realtime=F,N.options=L;var K=L.timeouts,V=K.preferenceConnectTimeout+K.realtimeRequestTimeout;if(N.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:K.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:K.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},N.state=N.states.initialized,N.errorReason=null,N.queuedMessages=new T.default,N.msgSerial=0,N.connectionDetails=void 0,N.connectionId=void 0,N.connectionKey=void 0,N.timeSerial=void 0,N.connectionSerial=void 0,N.connectionStateTtl=K.connectionStateTtl,N.maxIdleInterval=null,N.transports=S.intersect(L.transports||P.default.defaultTransports,q.supportedTransports),N.baseTransport=S.intersect(P.default.baseTransportOrder,N.transports)[0],N.upgradeTransports=S.intersect(N.transports,P.default.upgradeTransports),N.transportPreference=null,N.httpHosts=P.default.getHosts(L),N.activeProtocol=null,N.proposedTransports=[],N.pendingTransports=[],N.host=null,N.lastAutoReconnectAttempt=null,N.lastActivity=null,N.mostRecentMsg=null,N.forceFallbackHost=!1,N.connectCounter=0,u.default.logAction(u.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(L.transports||P.default.defaultTransports)+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+N.transports+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+N.httpHosts+"]"),!N.transports.length){var tt="no requested transports available";throw u.default.logAction(u.default.LOG_ERROR,"realtime.ConnectionManager()",tt),new Error(tt)}var lt=G.default.Config.addEventListener;return lt&&(i()&&typeof L.recover=="function"&&lt("beforeunload",N.persistConnection.bind(N)),L.closeOnUnload===!0&&lt("beforeunload",function(){u.default.logAction(u.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),N.requestState({state:"closing"})}),lt("online",function(){(N.state==N.states.disconnected||N.state==N.states.suspended)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),N.requestState({state:"connecting"}))}),lt("offline",function(){N.state==N.states.connected&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),N.disconnectAllTransports())})),N}return q.initTransports=function(){o.default(q),S.arrForEach(G.default.Transports,function(F){F(q)})},q.prototype.createTransportParams=function(F,L){var N=new W(this.options,F,L,this.connectionKey);return this.timeSerial?N.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(N.connectionSerial=this.connectionSerial),N},q.prototype.getTransportParams=function(F){var L=this,N=function(K){if(L.connectionKey){K("resume");return}if(typeof L.options.recover=="string"){K("recover");return}var V=L.options.recover,tt=H();if(tt&&typeof V=="function"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(tt,function(lt){lt?(L.options.recover=tt.recoveryKey,K("recover")):K("clean")});return}K("clean")};N(function(K){var V=L.createTransportParams(null,K);if(K==="recover"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+L.options.recover);var tt=L.options.recover.split(":");tt&&tt[2]&&(L.msgSerial=Number(tt[2]))}else u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());F(V)})},q.prototype.tryATransport=function(F,L,N){var K=this;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+L),h.default.tryConnect(q.supportedTransports[L],this,this.realtime.auth,F,function(V,tt){var lt=K.state;if(lt==K.states.closing||lt==K.states.closed||lt==K.states.failed){tt&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+lt.state+" while we were attempting the transport; closing "+tt),tt.close()),N(!0);return}if(V){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+L+" "+V.event+", err: "+V.error.toString()),m.default.isTokenErr(V.error)&&!(K.errorReason&&m.default.isTokenErr(K.errorReason))?(K.errorReason=V.error,K.realtime.auth._forceNewToken(null,null,function(vt){if(vt){K.actOnErrorFromAuthorize(vt);return}K.tryATransport(F,L,N)})):V.event==="failed"?(K.notifyState({state:"failed",error:V.error}),N(!0)):V.event==="disconnected"&&(M.isRetriable(V.error)?N(!1):(K.notifyState({state:K.states.connecting.failState,error:V.error}),N(!0)));return}u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+L+"; setting pending"),K.setTransportPending(tt,F),N(null,tt)})},q.prototype.setTransportPending=function(F,L){var N=this,K=L.mode;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+F+"; mode = "+K),S.arrDeleteValue(this.proposedTransports,F),this.pendingTransports.push(F);var V=G.default.Defaults.transportPreferenceOrder[G.default.Defaults.transportPreferenceOrder.length-1];F.once("connected",function(lt,vt,gt,bt){K=="upgrade"?F.shortName!==V&&S.arrIn(N.getUpgradePossibilities(),V)&&N.activeProtocol?setTimeout(function(){N.scheduleTransportActivation(lt,F,vt,gt,bt)},N.options.timeouts.parallelUpgradeDelay):N.scheduleTransportActivation(lt,F,vt,gt,bt):(N.activateTransport(lt,F,vt,gt,bt),G.default.Config.nextTick(function(){N.connectImpl(L)})),K==="recover"&&N.options.recover&&(N.options.recover=null,N.unpersistConnection())});var tt=this;F.on(["disconnected","closed","failed"],function(lt){tt.deactivateTransport(F,this.event,lt)}),this.emit("transport.pending",F)},q.prototype.scheduleTransportActivation=function(F,L,N,K,V){var tt=this,lt=this.activeProtocol&&this.activeProtocol.getTransport(),vt=function(){L.disconnect(),S.arrDeleteValue(tt.pendingTransports,L)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+L.shortName),vt();return}if(lt&&!w(L,lt)){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+L.shortName+" is no better than current active transport "+lt.shortName+" - abandoning upgrade"),vt();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+L);var gt=function(bt){var xt;if(bt){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+L+"; err = "+bt);return}if(!L.isConnected){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+L.shortName+"is no longer connected; abandoning upgrade"),vt();return}if(tt.state===tt.states.connected)u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),tt.state=tt.states.synchronizing,xt=tt.activeProtocol;else if(tt.state!==tt.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+tt.state.state+(tt.state===tt.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+L.shortName),vt();return}var ft=N!==tt.connectionId,Mt=ft?V:tt;ft&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(tt.timeSerial||tt.connectionSerial)+" to "+(Mt.timeSerial||Mt.connectionSerial)+"; upgrade error was "+F),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+L),tt.sync(L,Mt,function(Zt,Bt,zt){if(Zt){tt.state===tt.states.synchronizing&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+L+"; err = "+Zt),tt.disconnectAllTransports());return}var ce=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+L),tt.activateTransport(F,L,Bt,K,zt),tt.state===tt.states.synchronizing?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+L),tt.state=tt.states.connected):u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+tt.state.state+", so leaving unchanged"),tt.state.sendEvents&&tt.sendQueuedMessages()};xt?xt.onceIdle(ce):ce()})};lt?this.realtime.channels.onceNopending(gt):gt()},q.prototype.activateTransport=function(F,L,N,K,V){var tt=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+L),F&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+F),N&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+N),K&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(K)),V&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(V.timeSerial||V.connectionSerial)),this.persistTransportPreference(L);var lt=this.state,vt=this.states.connected.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+lt.state),lt.state==this.states.closing.state||lt.state==this.states.closed.state||lt.state==this.states.failed.state)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),L.disconnect(),!1;if(S.arrDeleteValue(this.pendingTransports,L),!L.isConnected)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+L+" since it appears to no longer be connected"),!1;var gt=this.activeProtocol;this.activeProtocol=new I.default(L),this.host=L.params.host;var bt=K.connectionKey;if(bt&&this.connectionKey!=bt&&this.setConnection(N,K,V,!!F),this.onConnectionDetailsUpdate(K,L),G.default.Config.nextTick(function(){L.on("connected",function(ft,Mt,Zt){tt.onConnectionDetailsUpdate(Zt,L),tt.emit("update",new A.default(vt,vt,null,ft))})}),lt.state===this.states.connected.state?F&&(this.errorReason=this.realtime.connection.errorReason=F,this.emit("update",new A.default(vt,vt,null,F))):(this.notifyState({state:"connected",error:F}),this.errorReason=this.realtime.connection.errorReason=F||null),this.emit("transport.active",L),gt)if(gt.messageQueue.count()>0&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+gt.transport.shortName+", new one is "+L.shortName+") finishing with "+gt.messageQueue.count()+" messages still pending"),gt.transport===L){var xt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+L.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",xt)}else gt.finish();return S.safeArrForEach(this.pendingTransports,function(ft){if(ft===L){var Mt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+L.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",Mt),S.arrDeleteValue(tt.pendingTransports,L)}else ft.disconnect()}),S.safeArrForEach(this.proposedTransports,function(ft){ft===L?(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+L.shortName+"; stack = "+new Error().stack),S.arrDeleteValue(tt.proposedTransports,L)):ft.dispose()}),!0},q.prototype.deactivateTransport=function(F,L,N){var K=this.activeProtocol,V=K&&K.getTransport()===F,tt=S.arrDeleteValue(this.pendingTransports,F),lt=S.arrDeleteValue(this.proposedTransports,F),vt=this.noTransportsScheduledForActivation();if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+F),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+L+(V?"; was active":tt?"; was pending":lt?"; was proposed":"")+(vt?"":"; another transport is scheduled for activation")),N&&N.message&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+N.message),V&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(K.getPendingMessages()),G.default.Config.nextTick(function(){K.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",F),V&&vt||V&&L==="failed"||L==="closed"||K===null&&tt&&this.pendingTransports.length===0){if(L==="disconnected"&&N&&N.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:L,error:N,retryImmediately:!0});return}var gt=L==="failed"&&m.default.isTokenErr(N)?"disconnected":L;this.notifyState({state:gt,error:N});return}V&&L==="disconnected"&&this.state!==this.states.synchronizing&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:N}))},q.prototype.noTransportsScheduledForActivation=function(){return S.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(F){return!F.isConnected})},q.prototype.sync=function(F,L,N){var K=setTimeout(function(){F.off("sync"),N(new E.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),V=_.default.fromValues({action:g.SYNC,connectionKey:this.connectionKey});L.timeSerial?V.timeSerial=L.timeSerial:L.connectionSerial!==void 0&&(V.connectionSerial=L.connectionSerial),F.send(V),F.once("sync",function(tt,lt){clearTimeout(K),N(null,tt,lt)})},q.prototype.setConnection=function(F,L,N,K){var V=this,tt=this.connectionId,lt=tt&&tt!==F,vt=!tt&&K;(lt||vt)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==F?(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),G.default.Config.nextTick(function(){V.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){V.realtime.channels.checkAttachedMsgIndicators(F)},3e4)),this.realtime.connection.id=this.connectionId=F,this.realtime.connection.key=this.connectionKey=L.connectionKey;var gt=lt||!tt;this.setConnectionSerial(N,gt,!1)},q.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},q.prototype.setConnectionSerial=function(F,L,N){var K=F.timeSerial,V=F.connectionSerial;if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+V+"; timeSerial = "+K+"; force = "+L+"; previous = "+this.connectionSerial),K!==void 0){if(K<=this.timeSerial&&!L)return N&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+K+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=K,this.setRecoveryKey();return}if(V!==void 0){if(V<=this.connectionSerial&&!L)return N&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+V+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=V,this.setRecoveryKey()}},q.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},q.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},q.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},q.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var F=S.now()-this.lastActivity;F>this.connectionStateTtl+this.maxIdleInterval&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+F+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},q.prototype.persistConnection=function(){if(i()){var F=this.realtime.connection.recoveryKey;F&&U({recoveryKey:F,disconnectedAt:S.now(),location:f.location,clientId:this.realtime.auth.clientId})}},q.prototype.unpersistConnection=function(){C()},q.prototype.getError=function(){return this.errorReason||this.getStateError()},q.prototype.getStateError=function(){return M.default[this.state.state]},q.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},q.prototype.enactStateChange=function(F){var L=F.current==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(L,"Connection state",F.current+(F.reason?"; reason: "+F.reason:"")),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+F.current+"; reason = "+(F.reason&&F.reason.message));var N=this.state=this.states[F.current];F.reason&&(this.errorReason=F.reason,this.realtime.connection.errorReason=F.reason),(N.terminal||N.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",F)},q.prototype.startTransitionTimer=function(F){var L=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+F.state),this.transitionTimer&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){L.transitionTimer&&(L.transitionTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager "+F.state+" timer expired","requesting new state: "+F.failState),L.notifyState({state:F.failState}))},F.retryDelay)},q.prototype.cancelTransitionTimer=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},q.prototype.startSuspendTimer=function(){var F=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){F.suspendTimer&&(F.suspendTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),F.states.connecting.failState="suspended",F.notifyState({state:"suspended"}))},this.connectionStateTtl))},q.prototype.checkSuspendTimer=function(F){F!=="disconnected"&&F!=="suspended"&&F!=="connecting"&&this.cancelSuspendTimer()},q.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},q.prototype.startRetryTimer=function(F){var L=this;this.retryTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),L.retryTimer=null,L.requestState({state:"connecting"})},F)},q.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},q.prototype.notifyState=function(F){var L=this,N=F.state,K=N==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||F.retryImmediately||this.state===this.states.connecting&&F.error&&m.default.isTokenErr(F.error)&&!(this.errorReason&&m.default.isTokenErr(this.errorReason)));if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+N+(K?"; will retry connection immediately":"")),N!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(F.state),(N==="suspended"||N==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var V=this.states[F.state],tt=V.retryDelay;V.state==="disconnected"&&(this.disconnectedRetryCount++,tt=V.retryDelay*S.getBackoffCoefficient(this.disconnectedRetryCount)*S.getJitterCoefficient());var lt=new A.default(this.state.state,V.state,tt,F.error||M.default[V.state]);if(K){var vt=function(){L.state===L.states.disconnected&&(L.lastAutoReconnectAttempt=S.now(),L.requestState({state:"connecting"}))},gt=this.lastAutoReconnectAttempt&&S.now()-this.lastAutoReconnectAttempt+1;gt&&gt<1e3?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+gt+"ms ago, waiting another "+(1e3-gt)+"ms before trying again"),setTimeout(vt,1e3-gt)):G.default.Config.nextTick(vt)}else(N==="disconnected"||N==="suspended")&&this.startRetryTimer(tt);(N==="disconnected"&&!K||N==="suspended"||V.terminal)&&G.default.Config.nextTick(function(){L.disconnectAllTransports()}),N=="connected"&&!this.activeProtocol&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(lt),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(N,lt.reason),this.failQueuedMessages(lt.reason))}},q.prototype.requestState=function(F){var L=this,N=F.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+N+"; current state: "+this.state.state),N!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(N),!(N=="connecting"&&this.state.state=="connected")&&!(N=="closing"&&this.state.state=="closed"))){var K=this.states[N],V=new A.default(this.state.state,K.state,null,F.error||M.default[K.state]);this.enactStateChange(V),N=="connecting"&&G.default.Config.nextTick(function(){L.startConnect()}),N=="closing"&&this.closeImpl()}},q.prototype.startConnect=function(){var F=this;if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var L=this.realtime.auth,N=++this.connectCounter,K=function(){F.checkConnectionStateFreshness(),F.getTransportParams(function(tt){N===F.connectCounter&&F.connectImpl(tt,N)})};if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),L.method==="basic")K();else{var V=function(tt){N===F.connectCounter&&(tt?F.actOnErrorFromAuthorize(tt):K())};this.errorReason&&m.default.isTokenErr(this.errorReason)?L._forceNewToken(null,null,V):L._ensureValidAuthCredentials(!1,V)}},q.prototype.connectImpl=function(F,L){var N=this.state.state;N!==this.states.connecting.state&&N!==this.states.connected.state?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+N):this.pendingTransports.length?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):N==this.states.connected.state?this.upgradeIfNeeded(F):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(F):this.connectBase(F,L)},q.prototype.connectPreference=function(F){var L=this,N=this.getTransportPreference(),K=!1;S.arrIn(this.transports,N)||(this.unpersistTransportPreference(),this.connectImpl(F)),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+N);var V=setTimeout(function(){K=!0,L.state.state!==L.states.connected.state&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+N+" failed; clearing preference and trying from scratch"),L.disconnectAllTransports(),L.unpersistTransportPreference()),L.connectImpl(F)},this.options.timeouts.preferenceConnectTimeout);F.host=this.httpHosts[0],this.tryATransport(F,N,function(tt,lt){clearTimeout(V),K&&lt?(lt.off(),lt.disconnect(),S.arrDeleteValue(L.pendingTransports,lt)):!lt&&!tt&&(L.unpersistTransportPreference(),L.connectImpl(F))})},q.prototype.connectBase=function(F,L){var N=this,K=function(gt){N.notifyState({state:N.states.connecting.failState,error:gt})},V=this.httpHosts.slice(),tt=function(gt,bt){L===N.connectCounter&&!bt&&!gt&&vt()};u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var lt=V.shift();if(!lt){K(new E.default("Unable to connect (no available host)",80003,404));return}F.host=lt;var vt=function(){if(!V.length){K(new E.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!N.realtime.http.checkConnectivity){K(new E.default("Internal error: Http.checkConnectivity not set",null,500));return}N.realtime.http.checkConnectivity(function(gt,bt){if(L===N.connectCounter){if(gt){K(gt);return}if(!bt){K(new E.default("Unable to connect (network unreachable)",80003,404));return}F.host=S.arrPopRandomElement(V),N.tryATransport(F,N.baseTransport,tt)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,vt();return}this.tryATransport(F,this.baseTransport,tt)},q.prototype.getUpgradePossibilities=function(){var F=this.activeProtocol.getTransport().shortName,L=S.arrIndexOf(this.upgradeTransports,F);return this.upgradeTransports.slice(L+1)},q.prototype.upgradeIfNeeded=function(F){var L=this,N=this.getUpgradePossibilities();u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+G.default.Config.inspect(N)),N.length&&S.arrForEach(N,function(K){var V=L.createTransportParams(F.host,"upgrade");L.tryATransport(V,K,O)})},q.prototype.closeImpl=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),S.safeArrForEach(this.pendingTransports,function(F){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+F),F&&F.close()}),S.safeArrForEach(this.proposedTransports,function(F){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+F),F&&F.dispose()}),this.activeProtocol&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},q.prototype.onAuthUpdated=function(F,L){var N=this,K;switch(this.state.state){case"connected":{if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;G.default.Config.nextTick(function(){N.state.state==="connected"&&N.upgradeIfNeeded(V)})}var tt=(K=this.activeProtocol)===null||K===void 0?void 0:K.getTransport();tt&&tt.onAuthUpdated&&tt.onAuthUpdated(F);var lt=_.default.fromValues({action:g.AUTH,auth:{accessToken:F.token}});this.send(lt);var vt=function(){N.off(gt),L(null,F)},gt=function(xt){xt.current==="failed"&&(N.off(vt),N.off(gt),L(xt.reason||N.getStateError()))};this.once("connectiondetails",vt),this.on("connectionstate",gt);break}case"connecting":u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var bt=function(xt){switch(xt.current){case"connected":N.off(bt),L(null,F);break;case"failed":case"closed":case"suspended":N.off(bt),L(xt.reason||N.getStateError());break;default:break}};this.on("connectionstate",bt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},q.prototype.disconnectAllTransports=function(F){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(F?" except the active transport":"")),this.connectCounter++,S.safeArrForEach(this.pendingTransports,function(L){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+L),L&&L.disconnect()}),this.pendingTransports=[],S.safeArrForEach(this.proposedTransports,function(L){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+L),L&&L.dispose()}),this.proposedTransports=[],this.activeProtocol&&!F&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},q.prototype.send=function(F,L,N){N=N||O;var K=this.state;if(K.sendEvents){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new I.PendingMessage(F,N));return}var V=L&&K.queueEvents||K.forceQueueEvents;if(!V){var tt="rejecting event, queueEvent was "+L+", state was "+K.state;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()",tt),N(this.errorReason||new E.default(tt,9e4,400));return}u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+_.default.stringify(F)),this.queue(F,N)},q.prototype.sendImpl=function(F){var L=F.message;F.ackRequired&&!F.sendAttempted&&(L.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(F)}catch(N){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+N.stack)}},q.prototype.queue=function(F,L){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var N=this.queuedMessages.last(),K=this.options.maxMessageSize;N&&!N.sendAttempted&&k(N.message,F,K)?(N.merged||(N.callback=y.default.create([N.callback]),N.merged=!0),N.callback.push(L)):this.queuedMessages.push(new I.PendingMessage(F,L))},q.prototype.sendQueuedMessages=function(){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var F;F=this.queuedMessages.shift();)this.sendImpl(F)},q.prototype.queuePendingMessages=function(F){F&&F.length&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+F.length+" pending messages"),this.queuedMessages.prepend(F))},q.prototype.failQueuedMessages=function(F){var L=this.queuedMessages.count();L>0&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+L+" queued messages, err = "+S.inspectError(F)),this.queuedMessages.completeAllMessages(F))},q.prototype.onChannelMessage=function(F,L){var N=this.activeProtocol&&L===this.activeProtocol.getTransport(),K=S.arrIn(this.pendingTransports,L)&&this.state==this.states.synchronizing,V=F.action===g.MESSAGE||F.action===g.PRESENCE;if(N||K){if(V){var tt=this.setConnectionSerial(F,!1,!0);if(tt)return;if(_.default.isDuplicate(F,this.mostRecentMsg)){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+F.id);return}this.mostRecentMsg=F}this.realtime.channels.onChannelMessage(F)}else S.arrIndexOf([g.ACK,g.NACK,g.ERROR],F.action)>-1?this.realtime.channels.onChannelMessage(F):u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(F)+"on defunct transport; discarding")},q.prototype.ping=function(F,L){var N=this;if(F){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+F);var K=function(){F.off("heartbeat",lt),L(new E.default("Timeout waiting for heartbeat response",5e4,500))},V=S.now(),tt=S.cheapRandStr(),lt=function(ft){if(ft===tt){F.off("heartbeat",lt),clearTimeout(vt);var Mt=S.now()-V;L(null,Mt)}},vt=setTimeout(K,this.options.timeouts.realtimeRequestTimeout);F.on("heartbeat",lt),F.ping(tt);return}if(this.state.state!=="connected"){L(new E.default("Unable to ping service; not connected",4e4,400));return}var gt=!1,bt=function(ft,Mt){N.off("transport.active",xt),gt||(gt=!0,L(ft,Mt))},xt=function(){gt||(gt=!0,G.default.Config.nextTick(function(){N.ping(null,L)}))};this.on("transport.active",xt),this.ping(this.activeProtocol.getTransport(),bt)},q.prototype.abort=function(F){this.activeProtocol.getTransport().fail(F)},q.prototype.registerProposedTransport=function(F){this.proposedTransports.push(F)},q.prototype.getTransportPreference=function(){var F,L;return this.transportPreference||l()&&((L=(F=G.default.WebStorage)===null||F===void 0?void 0:F.get)===null||L===void 0?void 0:L.call(F,D))},q.prototype.persistTransportPreference=function(F){var L,N;S.arrIn(P.default.upgradeTransports,F.shortName)&&(this.transportPreference=F.shortName,l()&&((N=(L=G.default.WebStorage)===null||L===void 0?void 0:L.set)===null||N===void 0||N.call(L,D,F.shortName)))},q.prototype.unpersistTransportPreference=function(){var F,L;this.transportPreference=null,l()&&((L=(F=G.default.WebStorage)===null||F===void 0?void 0:F.remove)===null||L===void 0||L.call(F,D))},q.prototype.actOnErrorFromAuthorize=function(F){if(F.code===40171)this.notifyState({state:"failed",error:F});else if(F.statusCode===s.default.Forbidden){var L="Client configured authentication provider returned 403; failing the connection";u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",L),this.notifyState({state:"failed",error:new E.default(L,80019,403,F)})}else{var L="Client configured authentication provider request failed";u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",L),this.notifyState({state:this.state.failState,error:new E.default(L,80019,401,F)})}},q.prototype.onConnectionDetailsUpdate=function(F,L){if(!!F){this.connectionDetails=F,F.maxMessageSize&&(this.options.maxMessageSize=F.maxMessageSize);var N=F.clientId;if(N){var K=this.realtime.auth._uncheckedSetClientId(N);if(K){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",K.message),L.fail(K);return}}var V=F.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=F.maxIdleInterval,this.emit("connectiondetails",F)}},q.supportedTransports={},q}(b.default);d.default=Q}).call(this,r(12))},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(10)),_=f.__importStar(r(2)),S=f.__importDefault(r(7)),I=f.__importDefault(r(3)),P=f.__importDefault(r(19)),G=f.__importDefault(r(5)),b=f.__importDefault(r(0)),T=a.default.Action,u=a.default.fromValues({action:T.CLOSE}),A=a.default.fromValues({action:T.DISCONNECT}),M=function(E){f.__extends(m,E);function m(p,y,o,h){var s=E.call(this)||this;return h&&(o.format=void 0,o.heartbeats=!0),s.connectionManager=p,p.registerProposedTransport(s),s.auth=y,s.params=o,s.timeouts=o.options.timeouts,s.format=o.format,s.isConnected=!1,s.isFinished=!1,s.isDisposed=!1,s.maxIdleInterval=null,s.idleTimer=null,s.lastActivity=null,s}return m.prototype.connect=function(){},m.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",P.default.closed)},m.prototype.disconnect=function(p){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",p||P.default.disconnected)},m.prototype.fail=function(p){this.isConnected&&this.requestDisconnect(),this.finish("failed",p||P.default.failed)},m.prototype.finish=function(p,y){var o;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((o=this.idleTimer)!==null&&o!==void 0?o:void 0),this.idleTimer=null,this.emit(p,y),this.dispose())},m.prototype.onProtocolMessage=function(p){switch(I.default.shouldLog(I.default.LOG_MICRO)&&I.default.logAction(I.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+a.default.stringify(p)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),p.action){case T.HEARTBEAT:I.default.logAction(I.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",p.id);break;case T.CONNECTED:this.onConnect(p),this.emit("connected",p.error,p.connectionId,p.connectionDetails,p);break;case T.CLOSED:this.onClose(p);break;case T.DISCONNECTED:this.onDisconnect(p);break;case T.ACK:this.emit("ack",p.msgSerial,p.count);break;case T.NACK:this.emit("nack",p.msgSerial,p.count,p.error);break;case T.SYNC:if(p.connectionId!==void 0){this.emit("sync",p.connectionId,p);break}this.connectionManager.onChannelMessage(p,this);break;case T.AUTH:this.auth.authorize(function(y){y&&I.default.logAction(I.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+_.inspectError(y))});break;case T.ERROR:if(I.default.logAction(I.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+b.default.Config.inspect(p.error)+(p.channel?", channel: "+p.channel:"")),p.channel===void 0){this.onFatalError(p);break}this.connectionManager.onChannelMessage(p,this);break;default:this.connectionManager.onChannelMessage(p,this)}},m.prototype.onConnect=function(p){if(this.isConnected=!0,!p.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var y=p.connectionDetails.maxIdleInterval;y&&(this.maxIdleInterval=y+this.timeouts.realtimeRequestTimeout,this.onActivity())},m.prototype.onDisconnect=function(p){var y=p&&p.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onDisconnect()","err = "+_.inspectError(y)),this.finish("disconnected",y)},m.prototype.onFatalError=function(p){var y=p&&p.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onFatalError()","err = "+_.inspectError(y)),this.finish("failed",y)},m.prototype.onClose=function(p){var y=p&&p.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onClose()","err = "+_.inspectError(y)),this.finish("closed",y)},m.prototype.requestClose=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.requestClose()",""),this.send(u)},m.prototype.requestDisconnect=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(A)},m.prototype.ping=function(p){var y={action:a.default.Action.HEARTBEAT};p&&(y.id=p),this.send(a.default.fromValues(y))},m.prototype.dispose=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},m.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=_.now(),this.setIdleTimer(this.maxIdleInterval+100))},m.prototype.setIdleTimer=function(p){var y=this;this.idleTimer||(this.idleTimer=setTimeout(function(){y.onIdleTimerExpire()},p))},m.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var p=_.now()-this.lastActivity,y=this.maxIdleInterval-p;if(y<=0){var o="No activity seen from realtime in "+p+"ms; assuming connection has dropped";I.default.logAction(I.default.LOG_ERROR,"Transport.onIdleTimerExpire()",o),this.disconnect(new G.default(o,80003,408))}else this.setIdleTimer(y+100)},m.tryConnect=function(p,y,o,h,s){var l=new p(y,o,h),i,g=function(D){clearTimeout(i),s({event:this.event,error:D})},O=y.options.timeouts.realtimeRequestTimeout;i=setTimeout(function(){l.off(["preconnect","disconnected","failed"]),l.dispose(),g.call({event:"disconnected"},new G.default("Timeout waiting for transport to indicate itself viable",5e4,500))},O),l.on(["failed","disconnected"],g),l.on("preconnect",function(){I.default.logAction(I.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+l),clearTimeout(i),l.off(["failed","disconnected"],g),s(null,l)}),l.connect()},m}(S.default);d.default=M},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(39),r(23))})(this,function(f){return function(){var a=f,_=a.lib,S=_.Base,I=_.WordArray,P=a.algo,G=P.MD5,b=P.EvpKDF=S.extend({cfg:S.extend({keySize:128/32,hasher:G,iterations:1}),init:function(T){this.cfg=this.cfg.extend(T)},compute:function(T,u){for(var A,M=this.cfg,E=M.hasher.create(),m=I.create(),p=m.words,y=M.keySize,o=M.iterations;p.length<y;){A&&E.update(A),A=E.update(T).finalize(u),E.reset();for(var h=1;h<o;h++)A=E.finalize(A),E.reset();m.concat(A)}return m.sigBytes=y*4,m}});a.EvpKDF=function(T,u,A){return b.create(A).compute(T,u)}}(),f.EvpKDF})},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(27))})(this,function(f){f.lib.Cipher||function(a){var _=f,S=_.lib,I=S.Base,P=S.WordArray,G=S.BufferedBlockAlgorithm,b=_.enc,T=b.Utf8,u=b.Base64,A=_.algo,M=A.EvpKDF,E=S.Cipher=G.extend({cfg:I.extend(),createEncryptor:function(C,w){return this.create(this._ENC_XFORM_MODE,C,w)},createDecryptor:function(C,w){return this.create(this._DEC_XFORM_MODE,C,w)},init:function(C,w,k){this.cfg=this.cfg.extend(k),this._xformMode=C,this._key=w,this.reset()},reset:function(){G.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){C&&this._append(C);var w=this._doFinalize();return w},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function C(w){return typeof w=="string"?U:D}return function(w){return{encrypt:function(k,W,Q){return C(W).encrypt(w,k,W,Q)},decrypt:function(k,W,Q){return C(W).decrypt(w,k,W,Q)}}}}()}),m=S.StreamCipher=E.extend({_doFinalize:function(){var C=this._process(!0);return C},blockSize:1}),p=_.mode={},y=S.BlockCipherMode=I.extend({createEncryptor:function(C,w){return this.Encryptor.create(C,w)},createDecryptor:function(C,w){return this.Decryptor.create(C,w)},init:function(C,w){this._cipher=C,this._iv=w}}),o=p.CBC=function(){var C=y.extend();C.Encryptor=C.extend({processBlock:function(k,W){var Q=this._cipher,Z=Q.blockSize;w.call(this,k,W,Z),Q.encryptBlock(k,W),this._prevBlock=k.slice(W,W+Z)}}),C.Decryptor=C.extend({processBlock:function(k,W){var Q=this._cipher,Z=Q.blockSize,q=k.slice(W,W+Z);Q.decryptBlock(k,W),w.call(this,k,W,Z),this._prevBlock=q}});function w(k,W,Q){var Z,q=this._iv;q?(Z=q,this._iv=a):Z=this._prevBlock;for(var F=0;F<Q;F++)k[W+F]^=Z[F]}return C}(),h=_.pad={},s=h.Pkcs7={pad:function(C,w){for(var k=w*4,W=k-C.sigBytes%k,Q=W<<24|W<<16|W<<8|W,Z=[],q=0;q<W;q+=4)Z.push(Q);var F=P.create(Z,W);C.concat(F)},unpad:function(C){var w=C.words[C.sigBytes-1>>>2]&255;C.sigBytes-=w}},l=S.BlockCipher=E.extend({cfg:E.cfg.extend({mode:o,padding:s}),reset:function(){var C;E.reset.call(this);var w=this.cfg,k=w.iv,W=w.mode;this._xformMode==this._ENC_XFORM_MODE?C=W.createEncryptor:(C=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==C?this._mode.init(this,k&&k.words):(this._mode=C.call(W,this,k&&k.words),this._mode.__creator=C)},_doProcessBlock:function(C,w){this._mode.processBlock(C,w)},_doFinalize:function(){var C,w=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(w.pad(this._data,this.blockSize),C=this._process(!0)):(C=this._process(!0),w.unpad(C)),C},blockSize:128/32}),i=S.CipherParams=I.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),g=_.format={},O=g.OpenSSL={stringify:function(C){var w,k=C.ciphertext,W=C.salt;return W?w=P.create([1398893684,1701076831]).concat(W).concat(k):w=k,w.toString(u)},parse:function(C){var w,k=u.parse(C),W=k.words;return W[0]==1398893684&&W[1]==1701076831&&(w=P.create(W.slice(2,4)),W.splice(0,4),k.sigBytes-=16),i.create({ciphertext:k,salt:w})}},D=S.SerializableCipher=I.extend({cfg:I.extend({format:O}),encrypt:function(C,w,k,W){W=this.cfg.extend(W);var Q=C.createEncryptor(k,W),Z=Q.finalize(w),q=Q.cfg;return i.create({ciphertext:Z,key:k,iv:q.iv,algorithm:C,mode:q.mode,padding:q.padding,blockSize:C.blockSize,formatter:W.format})},decrypt:function(C,w,k,W){W=this.cfg.extend(W),w=this._parse(w,W.format);var Q=C.createDecryptor(k,W).finalize(w.ciphertext);return Q},_parse:function(C,w){return typeof C=="string"?w.parse(C,this):C}}),z=_.kdf={},H=z.OpenSSL={execute:function(C,w,k,W){W||(W=P.random(64/8));var Q=M.create({keySize:w+k}).compute(C,W),Z=P.create(Q.words.slice(w),k*4);return Q.sigBytes=w*4,i.create({key:Q,iv:Z,salt:W})}},U=S.PasswordBasedCipher=D.extend({cfg:D.cfg.extend({kdf:H}),encrypt:function(C,w,k,W){W=this.cfg.extend(W);var Q=W.kdf.execute(k,C.keySize,C.ivSize);W.iv=Q.iv;var Z=D.encrypt.call(this,C,w,Q.key,W);return Z.mixIn(Q),Z},decrypt:function(C,w,k,W){W=this.cfg.extend(W),w=this._parse(w,W.format);var Q=W.kdf.execute(k,C.keySize,C.ivSize,w.salt);W.iv=Q.iv;var Z=D.decrypt.call(this,C,w,Q.key,W);return Z}})}()})},function(v,d,r){"use strict";d.__esModule=!0,d.Request=d.createRequest=void 0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(11)),S=f.__importDefault(r(0)),I=f.__importDefault(r(7)),P=f.__importDefault(r(5)),G=f.__importDefault(r(8)),b=f.__importDefault(r(3)),T=f.__importDefault(r(20)),u=a.getGlobalObject(),A=function(){},M=u._ablyjs_jsonp={};M._=function(s){return M["_"+s]||A};var E=1,m="jsonp";function p(s,l,i,g,O,D,z){return D=D||G.default.TIMEOUTS,new o(void 0,s,l,a.copy(i),g,O,D,z)}d.createRequest=p;var y=function(s){f.__extends(l,s);function l(i,g,O){var D=s.call(this,i,g,O)||this;return D.shortName=m,O.stream=!1,D}return l.isAvailable=function(){return S.default.Config.jsonpSupported&&S.default.Config.allowComet},l.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},l.prototype.createRequest=function(i,g,O,D,z,H,U){return H=(this===null||this===void 0?void 0:this.timeouts)||H||G.default.TIMEOUTS,p(i,g,O,D,z,H,U)},l}(_.default),o=function(s){f.__extends(l,s);function l(i,g,O,D,z,H,U,C){var w=s.call(this)||this;return i===void 0&&(i=E++),w.id=i,w.uri=g,w.params=D||{},w.params.rnd=a.cheapRandStr(),O&&(O["X-Ably-Version"]&&(w.params.v=O["X-Ably-Version"]),O["X-Ably-Lib"]&&(w.params.lib=O["X-Ably-Lib"])),w.body=z,w.method=C,w.requestMode=H,w.timeouts=U,w.requestComplete=!1,w}return l.prototype.exec=function(){var i=this,g=this.id,O=this.body,D=this.method,z=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+g+")",H.envelope="jsonp",O&&(H.body=O),D&&D!=="get"&&(H.method=D);var U=this.script=document.createElement("script"),C=z+a.toQueryString(H);U.src=C,U.src.split("/").slice(-1)[0]!==C.split("/").slice(-1)[0]&&b.default.logAction(b.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),U.async=!0,U.type="text/javascript",U.charset="UTF-8",U.onerror=function(W){i.complete(new P.default("JSONP script error (event: "+S.default.Config.inspect(W)+")",null,400))},M["_"+g]=function(W){if(W.statusCode){var Q=W.response;if(W.statusCode==204)i.complete(null,null,null,W.statusCode);else if(!Q)i.complete(new P.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||a.isArray(Q))i.complete(null,Q,W.headers,W.statusCode);else{var Z=Q.error||new P.default("Error response received from server",null,W.statusCode);i.complete(Z)}}else i.complete(null,W)};var w=this.requestMode==T.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),w);var k=document.getElementsByTagName("head")[0];k.insertBefore(U,k.firstChild)},l.prototype.complete=function(i,g,O,D){if(O=O||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;g&&(z=typeof g=="string"?"text/plain":"application/json",O["content-type"]=z,this.emit("data",g)),this.emit("complete",i,g,O,!0,D),this.dispose()}},l.prototype.abort=function(){this.dispose()},l.prototype.dispose=function(){var i=this.timer;i&&(clearTimeout(i),this.timer=null);var g=this.script;g.parentNode&&g.parentNode.removeChild(g),delete M[this.id],this.emit("disposed")},l}(I.default);d.Request=o;function h(s){return u.JSONPTransport=y,y.isAvailable()&&(s.supportedTransports[m]=y),y}d.default=h},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(3)),S=f.__importDefault(r(8)),I=f.__importDefault(r(16)),P=f.__importDefault(r(45)),G=f.__importDefault(r(18)),b=f.__importDefault(r(33)),T=f.__importDefault(r(5)),u=f.__importDefault(r(48)),A=f.__importDefault(r(17)),M=f.__importDefault(r(0)),E=function(){},m=function(){function y(o){if(!o){var h="no options provided";throw _.default.logAction(_.default.LOG_ERROR,"Rest()",h),new Error(h)}var s=S.default.objectifyOptions(o);s.log&&_.default.setLog(s.log.level,s.log.handler),_.default.logAction(_.default.LOG_MICRO,"Rest()","initialized with clientOptions "+M.default.Config.inspect(o));var l=this.options=S.default.normaliseOptions(s);if(l.key){var i=l.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!i){var h="invalid key parameter";throw _.default.logAction(_.default.LOG_ERROR,"Rest()",h),new T.default(h,40400,404)}l.keyName=i[1],l.keySecret=i[2]}if("clientId"in l)if(typeof l.clientId=="string"||l.clientId===null){if(l.clientId==="*")throw new T.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new T.default("clientId must be either a string or null",40012,400);_.default.logAction(_.default.LOG_MINOR,"Rest()","started; version = "+S.default.version),this.baseUri=this.authority=function(g){return S.default.getHttpScheme(l)+g+":"+S.default.getPort(l,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new M.default.Http,this.auth=new I.default(this,l),this.channels=new p(this),this.push=new P.default(this)}return y.prototype.stats=function(o,h){if(h===void 0)if(typeof o=="function")h=o,o=null;else{if(this.options.promises)return a.promisify(this,"stats",arguments);h=E}var s=a.defaultGetHeaders(),l=this.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,i=this.http.supportsLinkHeaders?void 0:l;this.options.headers&&a.mixin(s,this.options.headers),new G.default(this,"/stats",s,i,function(g,O,D){for(var z=D?g:JSON.parse(g),H=0;H<z.length;H++)z[H]=u.default.fromValues(z[H]);return z}).get(o,h)},y.prototype.time=function(o,h){var s=this;if(h===void 0){if(typeof o=="function")h=o,o=null;else if(this.options.promises)return a.promisify(this,"time",arguments)}var l=h||E,i=a.defaultGetHeaders();this.options.headers&&a.mixin(i,this.options.headers);var g=function(O){return s.authority(O)+"/time"};this.http.do(A.default.Get,this,g,i,null,o,function(O,D,z,H){if(O){l(O);return}H||(D=JSON.parse(D));var U=D[0];if(!U){l(new T.default("Internal error (unexpected result type from GET /time)",5e4,500));return}s.serverTimeOffset=U-a.now(),l(null,U)})},y.prototype.request=function(o,h,s,l,i,g){var O=this.options.useBinaryProtocol,D=O?M.default.Config.msgpack.encode:JSON.stringify,z=O?M.default.Config.msgpack.decode:JSON.parse,H=O?a.Format.msgpack:a.Format.json,U=this.http.supportsLinkHeaders?void 0:H;s=s||{};var C=o.toLowerCase(),w=C=="get"?a.defaultGetHeaders(H):a.defaultPostHeaders(H);if(g===void 0){if(this.options.promises)return a.promisify(this,"request",arguments);g=E}typeof l!="string"&&(l=D(l)),this.options.headers&&a.mixin(w,this.options.headers),i&&a.mixin(w,i);var k=new G.default(this,h,w,U,function(W,Q,Z){return a.ensureArray(Z?W:z(W))},!0);if(!a.arrIn(M.default.Http.methods,C))throw new T.default("Unsupported method "+C,40500,405);a.arrIn(M.default.Http.methodsWithBody,C)?k[C](s,l,g):k[C](s,g)},y.prototype.setLog=function(o){_.default.setLog(o.level,o.handler)},y.Promise=function(o){return o=S.default.objectifyOptions(o),o.promises=!0,new y(o)},y.Callbacks=y,y.Platform=M.default,y}(),p=function(){function y(o){this.rest=o,this.all={}}return y.prototype.get=function(o,h){o=String(o);var s=this.all[o];return s?h&&s.setOptions(h):this.all[o]=s=new b.default(this.rest,o,h),s},y.prototype.release=function(o){delete this.all[String(o)]},y}();d.default=m},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(a){var _=f,S=_.lib,I=S.WordArray,P=S.Hasher,G=_.algo,b=[],T=[];(function(){function M(y){for(var o=a.sqrt(y),h=2;h<=o;h++)if(!(y%h))return!1;return!0}function E(y){return(y-(y|0))*4294967296|0}for(var m=2,p=0;p<64;)M(m)&&(p<8&&(b[p]=E(a.pow(m,1/2))),T[p]=E(a.pow(m,1/3)),p++),m++})();var u=[],A=G.SHA256=P.extend({_doReset:function(){this._hash=new I.init(b.slice(0))},_doProcessBlock:function(M,E){for(var m=this._hash.words,p=m[0],y=m[1],o=m[2],h=m[3],s=m[4],l=m[5],i=m[6],g=m[7],O=0;O<64;O++){if(O<16)u[O]=M[E+O]|0;else{var D=u[O-15],z=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,H=u[O-2],U=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;u[O]=z+u[O-7]+U+u[O-16]}var C=s&l^~s&i,w=p&y^p&o^y&o,k=(p<<30|p>>>2)^(p<<19|p>>>13)^(p<<10|p>>>22),W=(s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25),Q=g+W+C+T[O]+u[O],Z=k+w;g=i,i=l,l=s,s=h+Q|0,h=o,o=y,y=p,p=Q+Z|0}m[0]=m[0]+p|0,m[1]=m[1]+y|0,m[2]=m[2]+o|0,m[3]=m[3]+h|0,m[4]=m[4]+s|0,m[5]=m[5]+l|0,m[6]=m[6]+i|0,m[7]=m[7]+g|0},_doFinalize:function(){var M=this._data,E=M.words,m=this._nDataBytes*8,p=M.sigBytes*8;return E[p>>>5]|=128<<24-p%32,E[(p+64>>>9<<4)+14]=a.floor(m/4294967296),E[(p+64>>>9<<4)+15]=m,M.sigBytes=E.length*4,this._process(),this._hash},clone:function(){var M=P.clone.call(this);return M._hash=this._hash.clone(),M}});_.SHA256=P._createHelper(A),_.HmacSHA256=P._createHmacHelper(A)}(Math),f.SHA256})},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return f.enc.Utf8})},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(7)),S=f.__importDefault(r(3)),I=f.__importDefault(r(34)),P=f.__importDefault(r(9)),G=f.__importDefault(r(5)),b=f.__importDefault(r(18)),T=f.__importDefault(r(24)),u=f.__importDefault(r(0));function A(){}var M=9;function E(y){return a.arrEvery(y,function(o){return!o.id})}function m(y){var o=y||{};if(o.cipher){if(!u.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var h=u.default.Crypto.getCipher(o.cipher);o.cipher=h.cipherParams,o.channelCipher=h.cipher}else"cipher"in o&&(o.cipher=void 0,o.channelCipher=null);return o}var p=function(y){f.__extends(o,y);function o(h,s,l){var i=y.call(this)||this;return S.default.logAction(S.default.LOG_MINOR,"Channel()","started; name = "+s),i.rest=h,i.name=s,i.basePath="/channels/"+encodeURIComponent(s),i.presence=new I.default(i),i.channelOptions=m(l),i}return o.prototype.setOptions=function(h){this.channelOptions=m(h)},o.prototype.history=function(h,s){if(S.default.logAction(S.default.LOG_MICRO,"Channel.history()","channel = "+this.name),s===void 0)if(typeof h=="function")s=h,h=null;else{if(this.rest.options.promises)return a.promisify(this,"history",arguments);s=A}this._history(h,s)},o.prototype._history=function(h,s){var l=this.rest,i=l.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:i,O=a.defaultGetHeaders(i);l.options.headers&&a.mixin(O,l.options.headers);var D=this.channelOptions;new b.default(l,this.basePath+"/messages",O,g,function(z,H,U){return P.default.fromResponseBody(z,D,U?void 0:i)}).get(h,s)},o.prototype.publish=function(){var h=this,s=arguments.length,l=arguments[0],i=arguments[1],g=arguments[s-1],O,D;if(typeof g!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);g=A}if(typeof l=="string"||l===null)O=[P.default.fromValues({name:l,data:i})],D=arguments[2];else if(a.isObject(l))O=[P.default.fromValues(l)],D=arguments[1];else if(a.isArray(l))O=P.default.fromValuesArray(l),D=arguments[1];else throw new G.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof D!="object"||!D)&&(D={});var z=this.rest,H=z.options,U=H.useBinaryProtocol?a.Format.msgpack:a.Format.json,C=z.options.idempotentRestPublishing,w=a.defaultPostHeaders(U);if(H.headers&&a.mixin(w,H.headers),C&&E(O)){var k=a.randomString(M);a.arrForEach(O,function(W,Q){W.id=k+":"+Q.toString()})}P.default.encodeArray(O,this.channelOptions,function(W){if(W){g(W);return}var Q=P.default.getMessagesSize(O),Z=H.maxMessageSize;if(Q>Z){g(new G.default("Maximum size of messages that can be published at once exceeded ( was "+Q+" bytes; limit is "+Z+" bytes)",40009,400));return}h._publish(P.default.serialize(O,U),w,D,g)})},o.prototype._publish=function(h,s,l,i){T.default.post(this.rest,this.basePath+"/messages",h,s,l,null,i)},o.prototype.status=function(h){if(typeof h!="function"&&this.rest.options.promises)return a.promisify(this,"status",[]);var s=this.rest.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,l=a.defaultPostHeaders(s);T.default.get(this.rest,this.basePath,l,{},s,h||A)},o}(_.default);d.default=p},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(7)),S=f.__importDefault(r(3)),I=f.__importDefault(r(18)),P=f.__importDefault(r(14));function G(){}var b=function(T){f.__extends(u,T);function u(A){var M=T.call(this)||this;return M.channel=A,M.basePath=A.basePath+"/presence",M}return u.prototype.get=function(A,M){if(S.default.logAction(S.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),M===void 0)if(typeof A=="function")M=A,A=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"get",arguments);M=G}var E=this.channel.rest,m=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:m,y=a.defaultGetHeaders(m);E.options.headers&&a.mixin(y,E.options.headers);var o=this.channel.channelOptions;new I.default(E,this.basePath,y,p,function(h,s,l){return P.default.fromResponseBody(h,o,l?void 0:m)}).get(A,M)},u.prototype.history=function(A,M){S.default.logAction(S.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(A,M)},u.prototype._history=function(A,M){if(M===void 0)if(typeof A=="function")M=A,A=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"_history",arguments);M=G}var E=this.channel.rest,m=E.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:m,y=a.defaultGetHeaders(m);E.options.headers&&a.mixin(y,E.options.headers);var o=this.channel.channelOptions;new I.default(E,this.basePath+"/history",y,p,function(h,s,l){return P.default.fromResponseBody(h,o,l?void 0:m)}).get(A,M)},u}(_.default);d.default=b},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(7)),_=f.__importDefault(r(3)),S=function(I){f.__extends(P,I);function P(){var G=I.call(this)||this;return G.messages=[],G}return P.prototype.count=function(){return this.messages.length},P.prototype.push=function(G){this.messages.push(G)},P.prototype.shift=function(){return this.messages.shift()},P.prototype.last=function(){return this.messages[this.messages.length-1]},P.prototype.copyAll=function(){return this.messages.slice()},P.prototype.append=function(G){this.messages.push.apply(this.messages,G)},P.prototype.prepend=function(G){this.messages.unshift.apply(this.messages,G)},P.prototype.completeMessages=function(G,b,T){_.default.logAction(_.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+G+"; count = "+b),T=T||null;var u=this.messages;if(u.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var A=u[0];if(A){var M=A.message.msgSerial,E=G+b;if(E>M)for(var m=u.splice(0,E-M),p=0,y=m;p<y.length;p++){var o=y[p];o.callback(T)}u.length==0&&this.emit("idle")}},P.prototype.completeAllMessages=function(G){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,G)},P.prototype.clear=function(){_.default.logAction(_.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},P}(a.default);d.default=S},function(v,d,r){"use strict";d.__esModule=!0;var f=function(){function a(_,S,I,P){this.previous=_,this.current=S,I&&(this.retryIn=I),P&&(this.reason=P)}return a}();d.default=f},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(10)),_=f.__importDefault(r(7)),S=f.__importStar(r(2)),I=f.__importDefault(r(33)),P=f.__importDefault(r(3)),G=f.__importDefault(r(54)),b=f.__importDefault(r(9)),T=f.__importDefault(r(38)),u=f.__importDefault(r(5)),A=f.__importDefault(r(14)),M=f.__importDefault(r(19)),E=a.default.Action,m=function(){},p="statechange",y="sync";function o(s){if(s&&"params"in s&&!S.isObject(s.params))return new u.default("options.params must be an object",4e4,400);if(s&&"modes"in s){if(!S.isArray(s.modes))return new u.default("options.modes must be an array",4e4,400);for(var l=0;l<s.modes.length;l++){var i=s.modes[l];if(!i||typeof i!="string"||!S.arrIn(a.default.channelModes,String.prototype.toUpperCase.call(i)))return new u.default("Invalid channel mode: "+i,4e4,400)}}}var h=function(s){f.__extends(l,s);function l(i,g,O){var D=s.call(this,i,g,O)||this;return D.retryCount=0,D.history=function(z,H){if(P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof z=="function")H=z,z=null;else{if(this.rest.options.promises)return S.promisify(this,"history",arguments);H=m}if(z&&z.untilAttach){if(this.state!=="attached"){H(new u.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new u.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete z.untilAttach,z.from_serial=this.properties.attachSerial}I.default.prototype._history.call(this,z,H)},D.whenState=function(z,H){return _.default.prototype.whenState.call(D,z,D.state,H)},P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel()","started; name = "+g),D.realtime=i,D.presence=new G.default(D),D.connectionManager=i.connection.connectionManager,D.state="initialized",D.subscriptions=new _.default,D.syncChannelSerial=void 0,D.properties={attachSerial:void 0},D.setOptions(O),D.errorReason=null,D._requestedFlags=null,D._mode=null,D._attachedMsgIndicator=!1,D._attachResume=!1,D._decodingContext={channelOptions:D.channelOptions,plugins:i.options.plugins||{},baseEncodedPreviousPayload:void 0},D._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},D._allChannelChanges=new _.default,D}return l.invalidStateError=function(i){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+i}},l.processListenerArgs=function(i){return i=Array.prototype.slice.call(i),typeof i[0]=="function"&&i.unshift(null),i[i.length-1]==null&&i.pop(),i},l.prototype.setOptions=function(i,g){if(!g&&this.rest.options.promises)return S.promisify(this,"setOptions",arguments);var O=g||function(z){z&&P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+z.toString())},D=o(i);if(D){O(D);return}I.default.prototype.setOptions.call(this,i),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(i)?(this.attachImpl(),this._allChannelChanges.once(function(z){switch(this.event){case"update":case"attached":O==null||O(null);return;default:O==null||O(z.reason);return}})):O()},l.prototype._shouldReattachToSetOptions=function(i){return(this.state==="attached"||this.state==="attaching")&&(i.params||i.modes)},l.prototype.publish=function(){for(var i=this,g=[],O=0;O<arguments.length;O++)g[O]=arguments[O];var D=g[0],z=g.length,H=g[z-1];if(typeof H!="function"){if(this.realtime.options.promises)return S.promisify(this,"publish",arguments);H=m,++z}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(z==2)if(S.isObject(D))D=[b.default.fromValues(D)];else if(S.isArray(D))D=b.default.fromValuesArray(D);else throw new u.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else D=[b.default.fromValues({name:g[0],data:g[1]})];var U=this.realtime.options.maxMessageSize;b.default.encodeArray(D,this.channelOptions,function(C){if(C){H(C);return}var w=b.default.getMessagesSize(D);if(w>U){H(new u.default("Maximum size of messages that can be published at once exceeded ( was "+w+" bytes; limit is "+U+" bytes)",40009,400));return}i.__publish(D,H)})},l.prototype.__publish=function(i,g){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+i.length);var O=this.state;switch(O){case"failed":case"suspended":g(u.default.fromValues(l.invalidStateError(O)));break;default:{P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+O);var D=new a.default;D.action=E.MESSAGE,D.channel=this.name,D.messages=i,this.sendMessage(D,g);break}}},l.prototype.onEvent=function(i){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var g=this.subscriptions,O=0;O<i.length;O++){var D=i[O];g.emit(D.name,D)}},l.prototype.attach=function(i,g){var O;if(typeof i=="function"?(g=i,O=null):O=i,!g){if(this.realtime.options.promises)return S.promisify(this,"attach",arguments);g=function(D){D&&P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+D.toString())}}if(O)P.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=O;else if(this.state==="attached"){g();return}this._attach(!1,null,g)},l.prototype._attach=function(i,g,O){O||(O=function(z){z&&P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+z.toString())});var D=this.connectionManager;if(!D.activeState()){O(D.getError());return}(this.state!=="attaching"||i)&&this.requestState("attaching",g),this.once(function(z){switch(this.event){case"attached":O==null||O();break;case"detached":case"suspended":case"failed":O==null||O(z.reason||D.getError()||new u.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":O==null||O(new u.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},l.prototype.attachImpl=function(){P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(p,!0);var i=a.default.fromValues({action:E.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?i.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&i.encodeModesToFlags(S.allToUpperCase(this.channelOptions.modes)),this._attachResume&&i.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(i.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(i,m)},l.prototype.detach=function(i){if(!i){if(this.realtime.options.promises)return S.promisify(this,"detach",arguments);i=m}var g=this.connectionManager;if(!g.activeState()){i(g.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),i();break;case"detached":i();break;case"failed":i(new u.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(O){switch(this.event){case"detached":i();break;case"attached":case"suspended":case"failed":i(O.reason||g.getError()||new u.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":i(new u.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},l.prototype.detachImpl=function(i){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(p,!0);var g=a.default.fromValues({action:E.DETACH,channel:this.name});this.sendMessage(g,i||m)},l.prototype.subscribe=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];var O=l.processListenerArgs(i),D=O[0],z=O[1],H=O[2];if(!H&&this.realtime.options.promises)return S.promisify(this,"subscribe",[D,z]);if(this.state==="failed"){H==null||H(u.default.fromValues(l.invalidStateError("failed")));return}return D&&typeof D=="object"&&!Array.isArray(D)?this._subscribeFilter(D,z):this.subscriptions.on(D,z),this.attach(H||m)},l.prototype._subscribeFilter=function(i,g){var O=function(D){var z,H,U,C,w,k,W={name:D.name,refTimeserial:(H=(z=D.extras)===null||z===void 0?void 0:z.ref)===null||H===void 0?void 0:H.timeserial,refType:(C=(U=D.extras)===null||U===void 0?void 0:U.ref)===null||C===void 0?void 0:C.type,isRef:!!(!((k=(w=D.extras)===null||w===void 0?void 0:w.ref)===null||k===void 0)&&k.timeserial),clientId:D.clientId};Object.entries(i).find(function(Q){var Z=Q[0],q=Q[1];return q!==void 0?W[Z]!==q:!1})||g(D)};this._addFilteredSubscription(i,g,O),this.subscriptions.on(O)},l.prototype._addFilteredSubscription=function(i,g,O){var D;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(g)){var z=this.filteredSubscriptions.get(g);z.set(i,((D=z==null?void 0:z.get(i))===null||D===void 0?void 0:D.concat(O))||[O])}else this.filteredSubscriptions.set(g,new Map([[i,[O]]]))},l.prototype._getAndDeleteFilteredSubscriptions=function(i,g){var O=this;if(!this.filteredSubscriptions)return[];if(!g&&i)return Array.from(this.filteredSubscriptions.entries()).map(function(U){var C,w=U[0],k=U[1],W=k.get(i);return k.delete(i),k.size===0&&((C=O.filteredSubscriptions)===null||C===void 0||C.delete(w)),W}).reduce(function(U,C){var w;return C?(w=U).concat.apply(w,C):U},[]);if(!g||!this.filteredSubscriptions.has(g))return[];var D=this.filteredSubscriptions.get(g);if(!i){var z=Array.from(D.values()).reduce(function(U,C){return U.concat.apply(U,C)},[]);return this.filteredSubscriptions.delete(g),z}var H=D.get(i);return D.delete(i),H||[]},l.prototype.unsubscribe=function(){for(var i=this,g,O=[],D=0;D<arguments.length;D++)O[D]=arguments[D];var z=l.processListenerArgs(O),H=z[0],U=z[1];if(typeof H=="object"&&!U||((g=this.filteredSubscriptions)===null||g===void 0?void 0:g.has(U))){this._getAndDeleteFilteredSubscriptions(H,U).forEach(function(C){return i.subscriptions.off(C)});return}this.subscriptions.off(H,U)},l.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new u.default("Unable to sync to channel; not attached",4e4);default:}var i=this.connectionManager;if(!i.activeState())throw i.getError();var g=a.default.fromValues({action:E.SYNC,channel:this.name});this.syncChannelSerial&&(g.channelSerial=this.syncChannelSerial),i.send(g)},l.prototype.sendMessage=function(i,g){this.connectionManager.send(i,this.realtime.options.queueMessages,g)},l.prototype.sendPresence=function(i,g){var O=a.default.fromValues({action:E.PRESENCE,channel:this.name,presence:S.isArray(i)?A.default.fromValuesArray(i):[A.default.fromValues(i)]});this.sendMessage(O,g)},l.prototype.onMessage=function(i){var g,O=!1;switch(i.action){case E.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=i.channelSerial,this._mode=i.getMode(),this.params=i.params||{};var D=i.decodeModesFromFlags();this.modes=D&&S.allToLowerCase(D)||void 0;var z=i.hasFlag("RESUMED"),H=i.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(p,!1),z||this.presence.onAttached(H);var U=new T.default(this.state,this.state,z,i.error);this._allChannelChanges.emit("update",U),(!z||this.channelOptions.updateOnAttached)&&this.emit("update",U)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",i.error,z,H);break}case E.DETACHED:{var C=i.error?u.default.fromValues(i.error):new u.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",C):this.state==="attaching"?this.notifyState("suspended",C):this.requestState("attaching",C);break}case E.SYNC:if(O=!0,g=this.syncChannelSerial=i.channelSerial,!i.presence)break;case E.PRESENCE:{for(var w=i.presence,k=i.id,W=i.connectionId,Q=i.timestamp,Z=this.channelOptions,q=void 0,F=0;F<w.length;F++)try{q=w[F],A.default.decode(q,Z),q.connectionId||(q.connectionId=W),q.timestamp||(q.timestamp=Q),q.id||(q.id=k+":"+F)}catch(lt){P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",lt.toString())}this.presence.setPresence(w,O,g);break}case E.MESSAGE:{if(this.state!=="attached"){P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+i.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var L=i.messages,N=L[0],K=L[L.length-1],k=i.id,W=i.connectionId,Q=i.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var V='Delta message decode failure - previous message not available for message "'+i.id+'" on this channel "'+this.name+'".';P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",V),this._startDecodeFailureRecovery(new u.default(V,40018,400));break}for(var F=0;F<L.length;F++){var V=L[F];try{b.default.decode(V,this._decodingContext)}catch(ft){switch(P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()",ft.toString()),ft.code){case 40018:this._startDecodeFailureRecovery(ft);return;case 40019:case 40021:this.notifyState("failed",ft);return}}V.connectionId||(V.connectionId=W),V.timestamp||(V.timestamp=Q),V.id||(V.id=k+":"+F)}this._lastPayload.messageId=K.id,this._lastPayload.protocolMessageChannelSerial=i.channelSerial,this.onEvent(L);break}case E.ERROR:{var tt=i.error;tt&&tt.code==80016?this.checkPendingState():this.notifyState("failed",u.default.fromValues(tt));break}default:P.default.logAction(P.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+i.action+")"),this.connectionManager.abort(M.default.unknownChannelErr)}},l.prototype._startDecodeFailureRecovery=function(i){var g=this;this._lastPayload.decodeFailureRecoveryInProgress||(P.default.logAction(P.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,i,function(){g._lastPayload.decodeFailureRecoveryInProgress=!1}))},l.prototype.onAttached=function(){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},l.prototype.notifyState=function(i,g,O,D){if(P.default.logAction(P.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+i),this.clearStateTimer(),i!==this.state){this.presence.actOnChannelState(i,D,g),i==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),g&&(this.errorReason=g);var z=new T.default(this.state,i,O,g),H=i==="failed"?P.default.LOG_ERROR:P.default.LOG_MAJOR;P.default.logAction(H,'Channel state for channel "'+this.name+'"',i+(g?"; reason: "+g:"")),i!=="attaching"&&i!=="suspended"&&(this.retryCount=0),i==="attached"?(this.onAttached(),this.setInProgress(y,D),this.setInProgress(p,!1)):(i==="detached"||i==="failed"||i==="suspended")&&(this.setInProgress(p,!1),this.setInProgress(y,!1)),i==="attached"?this._attachResume=!0:(i==="detaching"||i==="failed")&&(this._attachResume=!1),this.state=i,this._allChannelChanges.emit(i,z),this.emit(i,z)}},l.prototype.requestState=function(i,g){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+i),this.notifyState(i,g),this.checkPendingState()},l.prototype.checkPendingState=function(){var i=this.connectionManager.state;if(!(i.sendEvents||i.forceQueueEvents)){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},l.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var i=new u.default("Channel attach timed out",90007,408);this.notifyState("suspended",i);break}case"detaching":{var i=new u.default("Channel detach timed out",90007,408);this.notifyState("attached",i);break}default:this.checkPendingState();break}},l.prototype.startStateTimerIfNotRunning=function(){var i=this;this.stateTimer||(this.stateTimer=setTimeout(function(){P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),i.stateTimer=null,i.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},l.prototype.clearStateTimer=function(){var i=this.stateTimer;i&&(clearTimeout(i),this.stateTimer=null)},l.prototype.startRetryTimer=function(){var i=this;if(!this.retryTimer){this.retryCount++;var g=this.realtime.options.timeouts.channelRetryTimeout*S.getJitterCoefficient()*S.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){i.state==="suspended"&&i.connectionManager.state.sendEvents&&(i.retryTimer=null,P.default.logAction(P.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),i.requestState("attaching"))},g)}},l.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},l.prototype.setInProgress=function(i,g){this.rest.channels.setInProgress(this,i,g)},l.prototype.getReleaseErr=function(){var i=this.state;return i==="initialized"||i==="detached"||i==="failed"?null:new u.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+i,90001,400)},l.progressOps={statechange:p,sync:y},l}(I.default);d.default=h},function(v,d,r){"use strict";d.__esModule=!0;var f=function(){function a(_,S,I,P){this.previous=_,this.current=S,S==="attached"&&(this.resumed=I),P&&(this.reason=P)}return a}();d.default=f},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(){var a=f,_=a.lib,S=_.WordArray,I=_.Hasher,P=a.algo,G=[],b=P.SHA1=I.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(T,u){for(var A=this._hash.words,M=A[0],E=A[1],m=A[2],p=A[3],y=A[4],o=0;o<80;o++){if(o<16)G[o]=T[u+o]|0;else{var h=G[o-3]^G[o-8]^G[o-14]^G[o-16];G[o]=h<<1|h>>>31}var s=(M<<5|M>>>27)+y+G[o];o<20?s+=(E&m|~E&p)+1518500249:o<40?s+=(E^m^p)+1859775393:o<60?s+=(E&m|E&p|m&p)-1894007588:s+=(E^m^p)-899497514,y=p,p=m,m=E<<30|E>>>2,E=M,M=s}A[0]=A[0]+M|0,A[1]=A[1]+E|0,A[2]=A[2]+m|0,A[3]=A[3]+p|0,A[4]=A[4]+y|0},_doFinalize:function(){var T=this._data,u=T.words,A=this._nDataBytes*8,M=T.sigBytes*8;return u[M>>>5]|=128<<24-M%32,u[(M+64>>>9<<4)+14]=Math.floor(A/4294967296),u[(M+64>>>9<<4)+15]=A,T.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var T=I.clone.call(this);return T._hash=this._hash.clone(),T}});a.SHA1=I._createHelper(b),a.HmacSHA1=I._createHmacHelper(b)}(),f.SHA1})},function(v,d,r){"use strict";d.__esModule=!0;function f(o){if(o===void 0)return"undefined";var h,s;if(o instanceof ArrayBuffer?(s="ArrayBuffer",h=new DataView(o)):o instanceof DataView&&(s="DataView",h=o),!h)return JSON.stringify(o);for(var l=[],i=0;i<o.byteLength;i++){if(i>20){l.push("...");break}var g=h.getUint8(i).toString(16);g.length===1&&(g="0"+g),l.push(g)}return"<"+s+" "+l.join(" ")+">"}function a(o,h,s){for(var l=0,i=s.length;l<i;l++){var g=s.charCodeAt(l);if(g<128){o.setUint8(h++,g>>>0&127|0);continue}if(g<2048){o.setUint8(h++,g>>>6&31|192),o.setUint8(h++,g>>>0&63|128);continue}if(g<65536){o.setUint8(h++,g>>>12&15|224),o.setUint8(h++,g>>>6&63|128),o.setUint8(h++,g>>>0&63|128);continue}if(g<1114112){o.setUint8(h++,g>>>18&7|240),o.setUint8(h++,g>>>12&63|128),o.setUint8(h++,g>>>6&63|128),o.setUint8(h++,g>>>0&63|128);continue}throw new Error("bad codepoint "+g)}}function _(o,h,s){for(var l="",i=h,g=h+s;i<g;i++){var O=o.getUint8(i);if((O&128)===0){l+=String.fromCharCode(O);continue}if((O&224)===192){l+=String.fromCharCode((O&15)<<6|o.getUint8(++i)&63);continue}if((O&240)===224){l+=String.fromCharCode((O&15)<<12|(o.getUint8(++i)&63)<<6|(o.getUint8(++i)&63)<<0);continue}if((O&248)===240){l+=String.fromCharCode((O&7)<<18|(o.getUint8(++i)&63)<<12|(o.getUint8(++i)&63)<<6|(o.getUint8(++i)&63)<<0);continue}throw new Error("Invalid byte "+O.toString(16))}return l}function S(o){for(var h=0,s=0,l=o.length;s<l;s++){var i=o.charCodeAt(s);if(i<128){h+=1;continue}if(i<2048){h+=2;continue}if(i<65536){h+=3;continue}if(i<1114112){h+=4;continue}throw new Error("bad codepoint "+i)}return h}function I(o,h){var s=y(o,h);if(s!==0){var l=new ArrayBuffer(s),i=new DataView(l);return p(o,i,0,h),l}}var P=(1<<16)*(1<<16),G=1/P;function b(o,h){return h=h||0,o.getInt32(h)*P+o.getUint32(h+4)}function T(o,h){return h=h||0,o.getUint32(h)*P+o.getUint32(h+4)}function u(o,h,s){s<9223372036854776e3?(o.setInt32(h,Math.floor(s*G)),o.setInt32(h+4,s&-1)):(o.setUint32(h,2147483647),o.setUint32(h+4,2147483647))}function A(o,h,s){s<18446744073709552e3?(o.setUint32(h,Math.floor(s*G)),o.setInt32(h+4,s&-1)):(o.setUint32(h,4294967295),o.setUint32(h+4,4294967295))}var M=function(){function o(h,s){var l=this;this.map=function(i){for(var g={},O=0;O<i;O++){var D=l.parse();g[D]=l.parse()}return g},this.bin=function(i){var g=new ArrayBuffer(i);return new Uint8Array(g).set(new Uint8Array(l.view.buffer,l.offset,i),0),l.offset+=i,g},this.buf=this.bin,this.str=function(i){var g=_(l.view,l.offset,i);return l.offset+=i,g},this.array=function(i){for(var g=new Array(i),O=0;O<i;O++)g[O]=l.parse();return g},this.ext=function(i){return l.offset+=i,{type:l.view.getInt8(l.offset),data:l.buf(i)}},this.parse=function(){var i=l.view.getUint8(l.offset),g,O;if((i&128)===0)return l.offset++,i;if((i&240)===128)return O=i&15,l.offset++,l.map(O);if((i&240)===144)return O=i&15,l.offset++,l.array(O);if((i&224)===160)return O=i&31,l.offset++,l.str(O);if((i&224)===224)return g=l.view.getInt8(l.offset),l.offset++,g;switch(i){case 192:return l.offset++,null;case 193:l.offset++;return;case 194:return l.offset++,!1;case 195:return l.offset++,!0;case 196:return O=l.view.getUint8(l.offset+1),l.offset+=2,l.bin(O);case 197:return O=l.view.getUint16(l.offset+1),l.offset+=3,l.bin(O);case 198:return O=l.view.getUint32(l.offset+1),l.offset+=5,l.bin(O);case 199:return O=l.view.getUint8(l.offset+1),l.offset+=2,l.ext(O);case 200:return O=l.view.getUint16(l.offset+1),l.offset+=3,l.ext(O);case 201:return O=l.view.getUint32(l.offset+1),l.offset+=5,l.ext(O);case 202:return g=l.view.getFloat32(l.offset+1),l.offset+=5,g;case 203:return g=l.view.getFloat64(l.offset+1),l.offset+=9,g;case 204:return g=l.view.getUint8(l.offset+1),l.offset+=2,g;case 205:return g=l.view.getUint16(l.offset+1),l.offset+=3,g;case 206:return g=l.view.getUint32(l.offset+1),l.offset+=5,g;case 207:return g=T(l.view,l.offset+1),l.offset+=9,g;case 208:return g=l.view.getInt8(l.offset+1),l.offset+=2,g;case 209:return g=l.view.getInt16(l.offset+1),l.offset+=3,g;case 210:return g=l.view.getInt32(l.offset+1),l.offset+=5,g;case 211:return g=b(l.view,l.offset+1),l.offset+=9,g;case 212:return O=1,l.offset++,l.ext(O);case 213:return O=2,l.offset++,l.ext(O);case 214:return O=4,l.offset++,l.ext(O);case 215:return O=8,l.offset++,l.ext(O);case 216:return O=16,l.offset++,l.ext(O);case 217:return O=l.view.getUint8(l.offset+1),l.offset+=2,l.str(O);case 218:return O=l.view.getUint16(l.offset+1),l.offset+=3,l.str(O);case 219:return O=l.view.getUint32(l.offset+1),l.offset+=5,l.str(O);case 220:return O=l.view.getUint16(l.offset+1),l.offset+=3,l.array(O);case 221:return O=l.view.getUint32(l.offset+1),l.offset+=5,l.array(O);case 222:return O=l.view.getUint16(l.offset+1),l.offset+=3,l.map(O);case 223:return O=l.view.getUint32(l.offset+1),l.offset+=5,l.map(O)}throw new Error("Unknown type 0x"+i.toString(16))},this.offset=s||0,this.view=h}return o}();function E(o){var h=new DataView(o),s=new M(h),l=s.parse();if(s.offset!==o.byteLength)throw new Error(o.byteLength-s.offset+" trailing bytes");return l}function m(o,h){return Object.keys(o).filter(function(s){var l=o[s],i=typeof l;return(!h||l!=null)&&(i!=="function"||!!l.toJSON)})}function p(o,h,s,l){var i=typeof o;if(typeof o=="string"){var g=S(o);if(g<32)return h.setUint8(s,g|160),a(h,s+1,o),1+g;if(g<256)return h.setUint8(s,217),h.setUint8(s+1,g),a(h,s+2,o),2+g;if(g<65536)return h.setUint8(s,218),h.setUint16(s+1,g),a(h,s+3,o),3+g;if(g<4294967296)return h.setUint8(s,219),h.setUint32(s+1,g),a(h,s+5,o),5+g}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var O=o.byteLength;if(O<256)return h.setUint8(s,196),h.setUint8(s+1,O),new Uint8Array(h.buffer).set(new Uint8Array(o),s+2),2+O;if(O<65536)return h.setUint8(s,197),h.setUint16(s+1,O),new Uint8Array(h.buffer).set(new Uint8Array(o),s+3),3+O;if(O<4294967296)return h.setUint8(s,198),h.setUint32(s+1,O),new Uint8Array(h.buffer).set(new Uint8Array(o),s+5),5+O}if(typeof o=="number"){if(Math.floor(o)!==o)return h.setUint8(s,203),h.setFloat64(s+1,o),9;if(o>=0){if(o<128)return h.setUint8(s,o),1;if(o<256)return h.setUint8(s,204),h.setUint8(s+1,o),2;if(o<65536)return h.setUint8(s,205),h.setUint16(s+1,o),3;if(o<4294967296)return h.setUint8(s,206),h.setUint32(s+1,o),5;if(o<18446744073709552e3)return h.setUint8(s,207),A(h,s+1,o),9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return h.setInt8(s,o),1;if(o>=-128)return h.setUint8(s,208),h.setInt8(s+1,o),2;if(o>=-32768)return h.setUint8(s,209),h.setInt16(s+1,o),3;if(o>=-2147483648)return h.setUint8(s,210),h.setInt32(s+1,o),5;if(o>=-9223372036854776e3)return h.setUint8(s,211),u(h,s+1,o),9;throw new Error("Number too small -0x"+(-o).toString(16).substr(1))}if(i==="undefined")return l?0:(h.setUint8(s,212),h.setUint8(s+1,0),h.setUint8(s+2,0),3);if(o===null)return l?0:(h.setUint8(s,192),1);if(i==="boolean")return h.setUint8(s,o?195:194),1;if(typeof o.toJSON=="function")return p(o.toJSON(),h,s,l);if(i==="object"){var D,z=0,H=void 0,U=Array.isArray(o);if(U?D=o.length:(H=m(o,l),D=H.length),D<16?(h.setUint8(s,D|(U?144:128)),z=1):D<65536?(h.setUint8(s,U?220:222),h.setUint16(s+1,D),z=3):D<4294967296&&(h.setUint8(s,U?221:223),h.setUint32(s+1,D),z=5),U)for(var C=0;C<D;C++)z+=p(o[C],h,s+z,l);else if(H)for(var C=0;C<D;C++){var w=H[C];z+=p(w,h,s+z),z+=p(o[w],h,s+z,l)}return z}if(i==="function")return 0;throw new Error("Unknown type "+i)}function y(o,h){var s=typeof o;if(s==="string"){var l=S(o);if(l<32)return 1+l;if(l<256)return 2+l;if(l<65536)return 3+l;if(l<4294967296)return 5+l}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var i=o.byteLength;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(typeof o=="number"){if(Math.floor(o)!==o)return 9;if(o>=0){if(o<128)return 1;if(o<256)return 2;if(o<65536)return 3;if(o<4294967296)return 5;if(o<18446744073709552e3)return 9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return 1;if(o>=-128)return 2;if(o>=-32768)return 3;if(o>=-2147483648)return 5;if(o>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+o.toString(16).substr(1))}if(s==="boolean")return 1;if(o===null)return h?0:1;if(o===void 0)return h?0:3;if(typeof o.toJSON=="function")return y(o.toJSON(),h);if(s==="object"){var g,O=0;if(Array.isArray(o)){g=o.length;for(var D=0;D<g;D++)O+=y(o[D],h)}else{var z=m(o,h);g=z.length;for(var D=0;D<g;D++){var H=z[D];O+=y(H)+y(o[H],h)}}if(g<16)return 1+O;if(g<65536)return 3+O;if(g<4294967296)return 5+O;throw new Error("Array or object too long 0x"+g.toString(16))}if(s==="function")return 0;throw new Error("Unknown type "+s)}d.default={encode:I,decode:E,inspect:f,utf8Write:a,utf8Read:_,utf8ByteCount:S}},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(30)),_=f.__importDefault(r(49)),S=f.__importDefault(r(0)),I=f.__importDefault(r(55)),P=f.__importDefault(r(57)),G=f.__importDefault(r(62)),b=f.__importDefault(r(63)),T=f.__importDefault(r(67)),u=f.__importDefault(r(3)),A=r(8),M=f.__importDefault(r(25)),E=f.__importDefault(r(64)),m=f.__importDefault(r(65)),p=f.__importDefault(r(40)),y=f.__importDefault(r(9)),o=f.__importDefault(r(14));S.default.Crypto=P.default,S.default.BufferUtils=I.default,S.default.Http=G.default,S.default.Config=b.default,S.default.Transports=T.default,S.default.WebStorage=E.default,a.default.Crypto=P.default,_.default.Crypto=P.default,a.default.Message=y.default,_.default.Message=y.default,a.default.PresenceMessage=o.default,_.default.PresenceMessage=o.default,_.default.ConnectionManager=M.default,u.default.initLogHandlers(),S.default.Defaults=A.getDefaults(m.default),S.default.Config.agent&&(S.default.Defaults.agent+=" "+S.default.Config.agent),S.default.Config.noUpgrade&&(S.default.Defaults.upgradeTransports=[]),d.default={Rest:a.default,Realtime:_.default,msgpack:p.default}},function(v){v.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(31),r(23))})(this,function(f){return f.HmacSHA256})},function(v,d){},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(46)),S=f.__importDefault(r(24)),I=f.__importDefault(r(18)),P=f.__importDefault(r(5)),G=f.__importDefault(r(47)),b=function(){},T=function(){function E(m){this.rest=m,this.admin=new u(m)}return E}(),u=function(){function E(m){this.rest=m,this.deviceRegistrations=new A(m),this.channelSubscriptions=new M(m)}return E.prototype.publish=function(m,p,y){var o=this.rest,h=o.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(h),l={},i=a.mixin({recipient:m},p);if(typeof y!="function"){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);y=b}o.options.headers&&a.mixin(s,o.options.headers),o.options.pushFullWait&&a.mixin(l,{fullWait:"true"});var g=a.encodeBody(i,h);S.default.post(o,"/push/publish",g,s,l,null,function(O){return y(O)})},E}(),A=function(){function E(m){this.rest=m}return E.prototype.save=function(m,p){var y=this.rest,o=_.default.fromValues(m),h=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(h),l={};if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);p=b}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(l,{fullWait:"true"});var i=a.encodeBody(o,h);S.default.put(y,"/push/deviceRegistrations/"+encodeURIComponent(m.id),i,s,l,null,function(g,O,D,z){p(g,g?void 0:_.default.fromResponseBody(O,z?void 0:h))})},E.prototype.get=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=a.defaultGetHeaders(o),s=m.id||m;if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"get",arguments);p=b}if(typeof s!="string"||!s.length){p(new P.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}y.options.headers&&a.mixin(h,y.options.headers),S.default.get(y,"/push/deviceRegistrations/"+encodeURIComponent(s),h,{},null,function(l,i,g,O){p(l,l?void 0:_.default.fromResponseBody(i,O?void 0:o))})},E.prototype.list=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);p=b}y.options.headers&&a.mixin(s,y.options.headers),new I.default(y,"/push/deviceRegistrations",s,h,function(l,i,g){return _.default.fromResponseBody(l,g?void 0:o)}).get(m,p)},E.prototype.remove=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=a.defaultGetHeaders(o),s={},l=m.id||m;if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"remove",arguments);p=b}if(typeof l!="string"||!l.length){p(new P.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}y.options.headers&&a.mixin(h,y.options.headers),y.options.pushFullWait&&a.mixin(s,{fullWait:"true"}),S.default.delete(y,"/push/deviceRegistrations/"+encodeURIComponent(l),h,s,null,function(i){return p(i)})},E.prototype.removeWhere=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=a.defaultGetHeaders(o);if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);p=b}y.options.headers&&a.mixin(h,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),S.default.delete(y,"/push/deviceRegistrations",h,m,null,function(s){return p(s)})},E}(),M=function(){function E(m){this.remove=E.prototype.removeWhere,this.rest=m}return E.prototype.save=function(m,p){var y=this.rest,o=G.default.fromValues(m),h=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultPostHeaders(h),l={};if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"save",arguments);p=b}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(l,{fullWait:"true"});var i=a.encodeBody(o,h);S.default.post(y,"/push/channelSubscriptions",i,s,l,null,function(g,O,D,z){p(g,!g&&G.default.fromResponseBody(O,z?void 0:h))})},E.prototype.list=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"list",arguments);p=b}y.options.headers&&a.mixin(s,y.options.headers),new I.default(y,"/push/channelSubscriptions",s,h,function(l,i,g){return G.default.fromResponseBody(l,g?void 0:o)}).get(m,p)},E.prototype.removeWhere=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=a.defaultGetHeaders(o);if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);p=b}y.options.headers&&a.mixin(h,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),S.default.delete(y,"/push/channelSubscriptions",h,m,null,function(s){return p(s)})},E.prototype.listChannels=function(m,p){var y=this.rest,o=y.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:o,s=a.defaultGetHeaders(o);if(typeof p!="function"){if(this.rest.options.promises)return a.promisify(this,"listChannels",arguments);p=b}y.options.headers&&a.mixin(s,y.options.headers),y.options.pushFullWait&&a.mixin(m,{fullWait:"true"}),new I.default(y,"/push/channels",s,h,function(l,i,g){for(var O=!g&&o?a.decodeBody(l,o):l,D=0;D<O.length;D++)O[D]=String(O[D]);return O}).get(m,p)},E}();d.default=T},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(5)),S;(function(G){G.Phone="phone",G.Tablet="tablet",G.Desktop="desktop",G.TV="tv",G.Watch="watch",G.Car="car",G.Embedded="embedded",G.Other="other"})(S||(S={}));var I;(function(G){G.Android="android",G.IOS="ios",G.Browser="browser"})(I||(I={}));var P=function(){function G(){}return G.prototype.toJSON=function(){var b,T,u;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(b=this.push)===null||b===void 0?void 0:b.recipient,state:(T=this.push)===null||T===void 0?void 0:T.state,error:(u=this.push)===null||u===void 0?void 0:u.error}}},G.prototype.toString=function(){var b,T,u,A,M="[DeviceDetails";return this.id&&(M+="; id="+this.id),this.platform&&(M+="; platform="+this.platform),this.formFactor&&(M+="; formFactor="+this.formFactor),this.clientId&&(M+="; clientId="+this.clientId),this.metadata&&(M+="; metadata="+this.metadata),this.deviceIdentityToken&&(M+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((b=this.push)===null||b===void 0)&&b.recipient&&(M+="; push.recipient="+JSON.stringify(this.push.recipient)),!((T=this.push)===null||T===void 0)&&T.state&&(M+="; push.state="+this.push.state),!((u=this.push)===null||u===void 0)&&u.error&&(M+="; push.error="+JSON.stringify(this.push.error)),!((A=this.push)===null||A===void 0)&&A.metadata&&(M+="; push.metadata="+this.push.metadata),M+="]",M},G.fromResponseBody=function(b,T){return T&&(b=a.decodeBody(b,T)),a.isArray(b)?G.fromValuesArray(b):G.fromValues(b)},G.fromValues=function(b){return b.error=b.error&&_.default.fromValues(b.error),Object.assign(new G,b)},G.fromValuesArray=function(b){for(var T=b.length,u=new Array(T),A=0;A<T;A++)u[A]=G.fromValues(b[A]);return u},G.toRequestBody=a.encodeBody,G}();d.default=P},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=function(){function S(){}return S.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},S.prototype.toString=function(){var I="[PushChannelSubscription";return this.channel&&(I+="; channel="+this.channel),this.deviceId&&(I+="; deviceId="+this.deviceId),this.clientId&&(I+="; clientId="+this.clientId),I+="]",I},S.fromResponseBody=function(I,P){return P&&(I=a.decodeBody(I,P)),a.isArray(I)?S.fromValuesArray(I):S.fromValues(I)},S.fromValues=function(I){return Object.assign(new S,I)},S.fromValuesArray=function(I){for(var P=I.length,G=new Array(P),b=0;b<P;b++)G[b]=S.fromValues(I[b]);return G},S.toRequestBody=a.encodeBody,S}();d.default=_},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=function(){function y(o){this.count=o&&o.count||0,this.data=o&&o.data||0,this.uncompressedData=o&&o.uncompressedData||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return y}(),S=function(y){f.__extends(o,y);function o(h){var s=y.call(this,h)||this;return h&&h.category&&(s.category={},a.forInOwnNonNullProperties(h.category,function(l){s.category[l]=new _(h.category[l])})),s}return o}(_),I=function(){function y(o){this.peak=o&&o.peak||0,this.min=o&&o.min||0,this.mean=o&&o.mean||0,this.opened=o&&o.opened||0,this.refused=o&&o.refused||0}return y}(),P=function(){function y(o){this.succeeded=o&&o.succeeded||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return y}(),G=function(){function y(o){this.plain=new I(o&&o.plain),this.tls=new I(o&&o.tls),this.all=new I(o&&o.all)}return y}(),b=function(){function y(o){this.messages=new S(o&&o.messages),this.presence=new S(o&&o.presence),this.all=new S(o&&o.all)}return y}(),T=function(){function y(o){this.realtime=new b(o&&o.realtime),this.rest=new b(o&&o.rest),this.webhook=new b(o&&o.webhook),this.sharedQueue=new b(o&&o.sharedQueue),this.externalQueue=new b(o&&o.externalQueue),this.httpEvent=new b(o&&o.httpEvent),this.push=new b(o&&o.push),this.all=new b(o&&o.all)}return y}(),u=function(){function y(o){this.all=new b(o&&o.all),this.inbound=new T(o&&o.inbound),this.outbound=new T(o&&o.outbound)}return y}(),A=function(){function y(o){this.all=new b(o&&o.all),this.producerPaid=new u(o&&o.producerPaid),this.consumerPaid=new u(o&&o.consumerPaid)}return y}(),M=function(){function y(o){this.messages=o&&o.messages||0;var h=o&&o.notifications;this.notifications={invalid:h&&h.invalid||0,attempted:h&&h.attempted||0,successful:h&&h.successful||0,failed:h&&h.failed||0},this.directPublishes=o&&o.directPublishes||0}return y}(),E=function(){function y(o){this.succeeded=o&&o.succeeded||0,this.skipped=o&&o.skipped||0,this.failed=o&&o.failed||0}return y}(),m=function(){function y(o){var h=this;this.delta=void 0,o&&o.delta&&(this.delta={},a.forInOwnNonNullProperties(o.delta,function(s){h.delta[s]=new E(o.delta[s])}))}return y}(),p=function(y){f.__extends(o,y);function o(h){var s=y.call(this,h)||this;return s.persisted=new b(h&&h.persisted),s.connections=new G(h&&h.connections),s.channels=new I(h&&h.channels),s.apiRequests=new P(h&&h.apiRequests),s.tokenRequests=new P(h&&h.tokenRequests),s.xchgProducer=new A(h&&h.xchgProducer),s.xchgConsumer=new A(h&&h.xchgConsumer),s.push=new M(h&&h.pushStats),s.processed=new m(h&&h.processed),s.inProgress=h&&h.inProgress||void 0,s.unit=h&&h.unit||void 0,s.intervalId=h&&h.intervalId||void 0,s}return o.fromValues=function(h){return new o(h)},o}(u);d.default=p},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(30)),S=f.__importDefault(r(7)),I=f.__importDefault(r(3)),P=f.__importDefault(r(50)),G=f.__importDefault(r(37)),b=f.__importDefault(r(8)),T=f.__importDefault(r(5)),u=f.__importDefault(r(10)),A=f.__importDefault(r(25)),M=f.__importDefault(r(0)),E=f.__importDefault(r(9)),m=function(y){f.__extends(o,y);function o(h){var s=y.call(this,h)||this;return I.default.logAction(I.default.LOG_MINOR,"Realtime()",""),s.connection=new P.default(s,s.options),s.channels=new p(s),h.autoConnect!==!1&&s.connect(),s}return o.prototype.connect=function(){I.default.logAction(I.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},o.prototype.close=function(){I.default.logAction(I.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},o.Promise=function(h){return h=b.default.objectifyOptions(h),h.promises=!0,new o(h)},o.Callbacks=o,o.Utils=a,o.ConnectionManager=A.default,o.Platform=M.default,o.ProtocolMessage=u.default,o.Message=E.default,o}(_.default),p=function(y){f.__extends(o,y);function o(h){var s=y.call(this)||this;return s.realtime=h,s.all={},s.inProgress={},h.connection.connectionManager.on("transport.active",function(){s.onTransportActive()}),s}return o.prototype.onChannelMessage=function(h){var s=h.channel;if(s===void 0){I.default.logAction(I.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+h.action);return}var l=this.all[s];if(!l){I.default.logAction(I.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+s);return}l.onMessage(h)},o.prototype.onTransportActive=function(){for(var h in this.all){var s=this.all[h];s.state==="attaching"||s.state==="detaching"?s.checkPendingState():s.state==="suspended"&&s.attach()}},o.prototype.reattach=function(h){for(var s in this.all){var l=this.all[s];l.state==="attached"&&l.requestState("attaching",h)}},o.prototype.resetAttachedMsgIndicators=function(){for(var h in this.all){var s=this.all[h];s.state==="attached"&&(s._attachedMsgIndicator=!1)}},o.prototype.checkAttachedMsgIndicators=function(h){for(var s in this.all){var l=this.all[s];if(l.state==="attached"&&l._attachedMsgIndicator===!1){var i="30s after a resume, found channel which has not received an attached; channelId = "+s+"; connectionId = "+h;I.default.logAction(I.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",i),l.requestState("attaching")}}},o.prototype.propogateConnectionInterruption=function(h,s){var l={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},i=["attaching","attached","detaching","suspended"],g=l[h];for(var O in this.all){var D=this.all[O];a.arrIn(i,D.state)&&D.notifyState(g,s)}},o.prototype.get=function(h,s){h=String(h);var l=this.all[h];if(!l)l=this.all[h]=new G.default(this.realtime,h,s);else if(s){if(l._shouldReattachToSetOptions(s))throw new T.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);l.setOptions(s)}return l},o.prototype.release=function(h){h=String(h);var s=this.all[h];if(!!s){var l=s.getReleaseErr();if(l)throw l;delete this.all[h],delete this.inProgress[h]}},o.prototype.setInProgress=function(h,s,l){this.inProgress[h.name]=this.inProgress[h.name]||{},this.inProgress[h.name][s]=l,!l&&this.hasNopending()&&this.emit("nopending")},o.prototype.onceNopending=function(h){if(this.hasNopending()){h();return}this.once("nopending",h)},o.prototype.hasNopending=function(){return a.arrEvery(a.valuesArray(this.inProgress,!0),function(h){return!a.containsValue(h,!0)})},o}(S.default);d.default=m},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(7)),S=f.__importDefault(r(25)),I=f.__importDefault(r(3)),P=f.__importDefault(r(36)),G=f.__importDefault(r(0));function b(){}var T=function(u){f.__extends(A,u);function A(M,E){var m=u.call(this)||this;return m.whenState=function(p,y){return _.default.prototype.whenState.call(m,p,m.state,y,new P.default(void 0,p))},m.ably=M,m.connectionManager=new S.default(M,E),m.state=m.connectionManager.state.state,m.key=void 0,m.id=void 0,m.serial=void 0,m.timeSerial=void 0,m.recoveryKey=void 0,m.errorReason=null,m.connectionManager.on("connectionstate",function(p){var y=m.state=p.current;G.default.Config.nextTick(function(){m.emit(y,p)})}),m.connectionManager.on("update",function(p){G.default.Config.nextTick(function(){m.emit("update",p)})}),m}return A.prototype.connect=function(){I.default.logAction(I.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},A.prototype.ping=function(M){if(I.default.logAction(I.default.LOG_MINOR,"Connection.ping()",""),!M){if(this.ably.options.promises)return a.promisify(this,"ping",arguments);M=b}this.connectionManager.ping(null,M)},A.prototype.close=function(){I.default.logAction(I.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},A}(_.default);d.default=T},function(v,d,r){"use strict";d.__esModule=!0,d.PendingMessage=void 0;var f=r(1),a=f.__importDefault(r(10)),_=f.__importStar(r(2)),S=f.__importDefault(r(7)),I=f.__importDefault(r(3)),P=f.__importDefault(r(35)),G=f.__importDefault(r(5)),b=a.default.Action,T=function(){function A(M,E){this.message=M,this.callback=E,this.merged=!1;var m=M.action;this.sendAttempted=!1,this.ackRequired=m==b.MESSAGE||m==b.PRESENCE}return A}();d.PendingMessage=T;var u=function(A){f.__extends(M,A);function M(E){var m=A.call(this)||this;return m.transport=E,m.messageQueue=new P.default,E.on("ack",function(p,y){m.onAck(p,y)}),E.on("nack",function(p,y,o){m.onNack(p,y,o)}),m}return M.prototype.onAck=function(E,m){I.default.logAction(I.default.LOG_MICRO,"Protocol.onAck()","serial = "+E+"; count = "+m),this.messageQueue.completeMessages(E,m)},M.prototype.onNack=function(E,m,p){I.default.logAction(I.default.LOG_ERROR,"Protocol.onNack()","serial = "+E+"; count = "+m+"; err = "+_.inspectError(p)),p||(p=new G.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(E,m,p)},M.prototype.onceIdle=function(E){var m=this.messageQueue;if(m.count()===0){E();return}m.once("idle",E)},M.prototype.send=function(E){E.ackRequired&&this.messageQueue.push(E),I.default.shouldLog(I.default.LOG_MICRO)&&I.default.logAction(I.default.LOG_MICRO,"Protocol.send()","sending msg; "+a.default.stringify(E.message)),E.sendAttempted=!0,this.transport.send(E.message)},M.prototype.getTransport=function(){return this.transport},M.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},M.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},M.prototype.finish=function(){var E=this.transport;this.onceIdle(function(){E.disconnect()})},M}(S.default);d.default=u},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(0)),_=f.__importStar(r(2)),S=f.__importDefault(r(26)),I=f.__importDefault(r(8)),P=f.__importDefault(r(3)),G=f.__importDefault(r(10)),b=f.__importDefault(r(5)),T="web_socket";function u(E){return!!E.on}var A=function(E){f.__extends(m,E);function m(p,y,o){var h=E.call(this,p,y,o)||this;return h.shortName=T,o.heartbeats=a.default.Config.useProtocolHeartbeats,h.wsHost=I.default.getHost(o.options,o.host,!0),h}return m.isAvailable=function(){return!!a.default.Config.WebSocket},m.prototype.createWebSocket=function(p,y){var o=0;if(y)for(var h in y)p+=(o++?"&":"?")+h+"="+y[h];return this.uri=p,new a.default.Config.WebSocket(p)},m.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},m.prototype.connect=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),S.default.prototype.connect.call(this);var p=this,y=this.params,o=y.options,h=o.tls?"wss://":"ws://",s=h+this.wsHost+":"+I.default.getPort(o)+"/";P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+s),this.auth.getAuthParams(function(l,i){if(!p.isDisposed){var g="";for(var O in i)g+=" "+O+": "+i[O]+";";if(P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+g+" err: "+l),l){p.disconnect(l);return}var D=y.getConnectParams(i);try{var z=p.wsConnection=p.createWebSocket(s,D);z.binaryType=a.default.Config.binaryType,z.onopen=function(){p.onWsOpen()},z.onclose=function(H){p.onWsClose(H)},z.onmessage=function(H){p.onWsData(H.data)},z.onerror=function(H){p.onWsError(H)},u(z)&&z.on("ping",function(){p.onActivity()})}catch(H){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),p.disconnect(H)}}})},m.prototype.send=function(p){var y=this.wsConnection;if(!y){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{y.send(G.default.serialize(p,this.params.format))}catch(h){var o="Exception from ws connection when trying to send: "+_.inspectError(h);P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.send()",o),this.finish("disconnected",new b.default(o,5e4,500))}},m.prototype.onWsData=function(p){P.default.logAction(P.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+p.length+"; type = "+typeof p);try{this.onProtocolMessage(G.default.deserialize(p,this.format))}catch(y){P.default.logAction(P.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+y.stack)}},m.prototype.onWsOpen=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},m.prototype.onWsClose=function(p){var y,o;if(typeof p=="object"?(o=p.code,y=p.wasClean||o===1e3):(o=p,y=o==1e3),delete this.wsConnection,y){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var h=new b.default("Websocket closed",80003,400);this.finish("disconnected",h)}else{var s="Unclean disconnection of WebSocket ; code = "+o,h=new b.default(s,80003,400);P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onWsClose()",s),this.finish("disconnected",h)}this.emit("disposed")},m.prototype.onWsError=function(p){var y=this;P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+p.message),a.default.Config.nextTick(function(){y.disconnect(Error(p.message))})},m.prototype.dispose=function(){P.default.logAction(P.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var p=this.wsConnection;p&&(p.onmessage=function(){},delete this.wsConnection,a.default.Config.nextTick(function(){if(P.default.logAction(P.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!p)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");p.close()}))},m}(S.default);function M(E){return A.isAvailable()&&(E.supportedTransports[T]=A),A}d.default=M},function(v,d,r){"use strict";d.__esModule=!0,d.isSuccessCode=void 0;var f;(function(_){_[_.Success=200]="Success",_[_.NoContent=204]="NoContent",_[_.BadRequest=400]="BadRequest",_[_.Unauthorized=401]="Unauthorized",_[_.Forbidden=403]="Forbidden",_[_.RequestTimeout=408]="RequestTimeout",_[_.InternalServerError=500]="InternalServerError"})(f||(f={}));function a(_){return _>=f.Success&&_<f.BadRequest}d.isSuccessCode=a,d.default=f},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importStar(r(2)),_=f.__importDefault(r(34)),S=f.__importDefault(r(7)),I=f.__importDefault(r(3)),P=f.__importDefault(r(14)),G=f.__importDefault(r(5)),b=f.__importDefault(r(37)),T=f.__importDefault(r(22)),u=f.__importDefault(r(38)),A=function(){};function M(s){return s.clientId+":"+s.connectionId}function E(s){return s.channel.realtime.auth.clientId}function m(s){var l=s.channel.realtime,i=l.auth.clientId;return(!i||i==="*")&&l.connection.state==="connected"}function p(s,l,i){switch(s.state){case"attached":case"suspended":i();break;case"initialized":case"detached":case"detaching":case"attaching":s.attach(function(g){g?l(g):i()});break;default:l(G.default.fromValues(b.default.invalidStateError(s.state)))}}function y(s,l){if(s.isSynthesized()||l.isSynthesized())return s.timestamp>l.timestamp;var i=s.parseId(),g=l.parseId();return i.msgSerial===g.msgSerial?i.index>g.index:i.msgSerial>g.msgSerial}var o=function(s){f.__extends(l,s);function l(i){var g=s.call(this,i)||this;return g.channel=i,g.syncComplete=!1,g.members=new h(g),g._myMembers=new h(g),g.subscriptions=new S.default,g.pendingPresence=[],g}return l.prototype.enter=function(i,g){if(m(this))throw new G.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,i,"enter",g)},l.prototype.update=function(i,g){if(m(this))throw new G.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,i,"update",g)},l.prototype.enterClient=function(i,g,O){return this._enterOrUpdateClient(i,g,"enter",O)},l.prototype.updateClient=function(i,g,O){return this._enterOrUpdateClient(i,g,"update",O)},l.prototype._enterOrUpdateClient=function(i,g,O,D){var z=this;if(!D)if(typeof g=="function")D=g,g=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"_enterOrUpdateClient",[i,g,O]);D=A}var H=this.channel;if(!H.connectionManager.activeState()){D(H.connectionManager.getError());return}I.default.logAction(I.default.LOG_MICRO,"RealtimePresence."+O+"Client()","channel = "+H.name+", client = "+(i||"(implicit) "+E(this)));var U=P.default.fromValues({action:O,data:g});i&&(U.clientId=i),P.default.encode(U,H.channelOptions,function(C){if(C){D(C);return}switch(H.state){case"attached":H.sendPresence(U,D);break;case"initialized":case"detached":H.attach();case"attaching":z.pendingPresence.push({presence:U,callback:D});break;default:C=new G.default("Unable to "+O+" presence channel while in "+H.state+" state",90001),C.code=90001,D(C)}})},l.prototype.leave=function(i,g){if(m(this))throw new G.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,i,g)},l.prototype.leaveClient=function(i,g,O){if(!O)if(typeof g=="function")O=g,g=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"leaveClient",[i,g]);O=A}var D=this.channel;if(!D.connectionManager.activeState()){O==null||O(D.connectionManager.getError());return}I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+i);var z=P.default.fromValues({action:"leave",data:g});switch(i&&(z.clientId=i),D.state){case"attached":D.sendPresence(z,O);break;case"attaching":this.pendingPresence.push({presence:z,callback:O});break;case"initialized":case"failed":{var H=new G.default("Unable to leave presence channel (incompatible state)",90001);O==null||O(H);break}default:O==null||O(b.default.invalidStateError(D.state))}},l.prototype.get=function(i,g){var O=this,D=Array.prototype.slice.call(arguments);D.length==1&&typeof D[0]=="function"&&D.unshift(null),i=D[0],g=D[1];var z=!i||("waitForSync"in i?i.waitForSync:!0);if(!g){if(this.channel.realtime.options.promises)return a.promisify(this,"get",D);g=A}function H(U){g(null,i?U.list(i):U.values())}if(this.channel.state==="suspended"){z?g(G.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}p(this.channel,g,function(){var U=O.members;z?U.waitSync(function(){H(U)}):H(U)})},l.prototype.history=function(i,g){if(I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),g===void 0)if(typeof i=="function")g=i,i=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"history",arguments);g=A}i&&i.untilAttach&&(this.channel.state==="attached"?(delete i.untilAttach,i.from_serial=this.channel.properties.attachSerial):g(new G.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),_.default.prototype._history.call(this,i,g)},l.prototype.setPresence=function(i,g,O){I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+i.length+" participants; syncChannelSerial = "+O);var D,z,H=this.members,U=this._myMembers,C=[],w=this.channel.connectionManager.connectionId;g&&(this.members.startSync(),O&&(z=O.match(/^[\w-]+:(.*)$/))&&(D=z[1]));for(var k=0;k<i.length;k++){var W=P.default.fromValues(i[k]);switch(W.action){case"leave":H.remove(W)&&C.push(W),W.connectionId===w&&!W.isSynthesized()&&U.remove(W);break;case"enter":case"present":case"update":H.put(W)&&C.push(W),W.connectionId===w&&U.put(W);break}}g&&!D&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(b.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var k=0;k<C.length;k++){var W=C[k];this.subscriptions.emit(W.action,W)}},l.prototype.onAttached=function(i){I.default.logAction(I.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+i),i?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var g=this.pendingPresence,O=g.length;if(O){this.pendingPresence=[];var D=[],z=T.default.create();I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+O+" queued presence messages");for(var H=0;H<O;H++){var U=g[H];D.push(U.presence),z.push(U.callback)}this.channel.sendPresence(D,z)}},l.prototype.actOnChannelState=function(i,g,O){switch(i){case"attached":this.onAttached(g);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(O);break}},l.prototype.failPendingPresence=function(i){if(this.pendingPresence.length){I.default.logAction(I.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+a.inspectError(i));for(var g=0;g<this.pendingPresence.length;g++)try{this.pendingPresence[g].callback(i)}catch(O){}this.pendingPresence=[]}},l.prototype._clearMyMembers=function(){this._myMembers.clear()},l.prototype._ensureMyMembersPresent=function(){var i=this,g=this.members,O=this._myMembers,D=function(U){if(U){var C="Presence auto-re-enter failed: "+U.toString(),w=new G.default(C,91004,400);I.default.logAction(I.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",C);var k=new u.default(i.channel.state,i.channel.state,!0,w);i.channel.emit("update",k)}};for(var z in O.map)if(!(z in g.map)){var H=O.map[z];I.default.logAction(I.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",D),delete O.map[z]}},l.prototype._synthesizeLeaves=function(i){var g=this.subscriptions;a.arrForEach(i,function(O){var D=P.default.fromValues({action:"leave",connectionId:O.connectionId,clientId:O.clientId,data:O.data,encoding:O.encoding,timestamp:a.now()});g.emit("leave",D)})},l.prototype.on=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];I.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,i)},l.prototype.off=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];I.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,i)},l.prototype.subscribe=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];var O=b.default.processListenerArgs(i),D=O[0],z=O[1],H=O[2],U=this.channel;if(!H){if(this.channel.realtime.options.promises)return a.promisify(this,"subscribe",[D,z]);H=A}if(U.state==="failed"){H(G.default.fromValues(b.default.invalidStateError("failed")));return}this.subscriptions.on(D,z),U.attach(H)},l.prototype.unsubscribe=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];var O=b.default.processListenerArgs(i),D=O[0],z=O[1];this.subscriptions.off(D,z)},l}(_.default),h=function(s){f.__extends(l,s);function l(i){var g=s.call(this)||this;return g.presence=i,g.map={},g.syncInProgress=!1,g.residualMembers=null,g}return l.prototype.get=function(i){return this.map[i]},l.prototype.getClient=function(i){var g=this.map,O=[];for(var D in g){var z=g[D];z.clientId==i&&z.action!="absent"&&O.push(z)}return O},l.prototype.list=function(i){var g=this.map,O=i&&i.clientId,D=i&&i.connectionId,z=[];for(var H in g){var U=g[H];U.action!=="absent"&&(O&&O!=U.clientId||D&&D!=U.connectionId||z.push(U))}return z},l.prototype.put=function(i){(i.action==="enter"||i.action==="update")&&(i=P.default.fromValues(i),i.action="present");var g=this.map,O=M(i);this.residualMembers&&delete this.residualMembers[O];var D=g[O];return D&&!y(i,D)?!1:(g[O]=i,!0)},l.prototype.values=function(){var i=this.map,g=[];for(var O in i){var D=i[O];D.action!="absent"&&g.push(D)}return g},l.prototype.remove=function(i){var g=this.map,O=M(i),D=g[O];return D&&!y(i,D)?!1:(this.syncInProgress?(i=P.default.fromValues(i),i.action="absent",g[O]=i):delete g[O],!0)},l.prototype.startSync=function(){var i=this.map,g=this.syncInProgress;I.default.logAction(I.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),this.syncInProgress||(this.residualMembers=a.copy(i),this.setInProgress(!0))},l.prototype.endSync=function(){var i=this.map,g=this.syncInProgress;if(I.default.logAction(I.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),g){for(var O in i){var D=i[O];D.action==="absent"&&delete i[O]}this.presence._synthesizeLeaves(a.valuesArray(this.residualMembers));for(var z in this.residualMembers)delete i[z];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},l.prototype.waitSync=function(i){var g=this.syncInProgress;if(I.default.logAction(I.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),!g){i();return}this.once("sync",i)},l.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},l.prototype.setInProgress=function(i){I.default.logAction(I.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+i),this.syncInProgress=i,this.presence.syncComplete=!i},l}(S.default);d.default=o},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=r(56),_=r(32),S=r(13),I=f.__importDefault(r(4)),P=f.__importDefault(r(0)),G=function(){function b(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return b.prototype.isWordArray=function(T){return T!=null&&T.sigBytes!==void 0},b.prototype.isArrayBuffer=function(T){return T!=null&&T.constructor===ArrayBuffer},b.prototype.isTypedArray=function(T){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(T)},b.prototype.uint8ViewToBase64=function(T){for(var u="",A=this.base64CharSet,M=T.byteLength,E=M%3,m=M-E,p,y,o,h,s,l=0;l<m;l=l+3)s=T[l]<<16|T[l+1]<<8|T[l+2],p=(s&16515072)>>18,y=(s&258048)>>12,o=(s&4032)>>6,h=s&63,u+=A[p]+A[y]+A[o]+A[h];return E==1?(s=T[m],p=(s&252)>>2,y=(s&3)<<4,u+=A[p]+A[y]+"=="):E==2&&(s=T[m]<<8|T[m+1],p=(s&64512)>>10,y=(s&1008)>>4,o=(s&15)<<2,u+=A[p]+A[y]+A[o]+"="),u},b.prototype.base64ToArrayBuffer=function(T){for(var u=atob==null?void 0:atob(T),A=u.length,M=new Uint8Array(A),E=0;E<A;E++){var m=u.charCodeAt(E);M[E]=m}return M.buffer},b.prototype.isBuffer=function(T){return this.isArrayBuffer(T)||this.isWordArray(T)||this.isTypedArray(T)},b.prototype.toBuffer=function(T){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(T))return new Uint8Array(T);if(this.isTypedArray(T))return new Uint8Array(T.buffer);if(this.isWordArray(T)){for(var u=new ArrayBuffer(T.sigBytes),A=new Uint8Array(u),M=0;M<T.sigBytes;M++)A[M]=T.words[M>>>2]>>>24-M%4*8&255;return A}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},b.prototype.toArrayBuffer=function(T){return this.isArrayBuffer(T)?T:this.toBuffer(T).buffer},b.prototype.toWordArray=function(T){return this.isTypedArray(T)&&(T=T.buffer),this.isWordArray(T)?T:I.default.create(T)},b.prototype.base64Encode=function(T){return this.isWordArray(T)?S.stringify(T):this.uint8ViewToBase64(this.toBuffer(T))},b.prototype.base64Decode=function(T){return ArrayBuffer&&P.default.Config.atob?this.base64ToArrayBuffer(T):S.parse(T)},b.prototype.hexEncode=function(T){return a.stringify(this.toWordArray(T))},b.prototype.hexDecode=function(T){var u=a.parse(T);return ArrayBuffer?this.toArrayBuffer(u):u},b.prototype.utf8Encode=function(T){return TextEncoder?new TextEncoder().encode(T).buffer:_.parse(T)},b.prototype.utf8Decode=function(T){if(!this.isBuffer(T))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(T)?new TextDecoder().decode(T):(T=this.toWordArray(T),_.stringify(T))},b.prototype.bufferCompare=function(T,u){if(!T)return-1;if(!u)return 1;var A=this.toWordArray(T),M=this.toWordArray(u);A.clamp(),M.clamp();var E=A.sigBytes-M.sigBytes;if(E!=0)return E;for(var m=A.words,p=M.words,y=0;y<m.length;y++)if(E=m[y]-p[y],E!=0)return E;return 0},b.prototype.byteLength=function(T){return this.isArrayBuffer(T)||this.isTypedArray(T)?T.byteLength:this.isWordArray(T)?T.sigBytes:-1},b.prototype.typedArrayToBuffer=function(T){return T.buffer},b}();d.default=new G},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return f.enc.Hex})},function(v,d,r){"use strict";r.r(d);var f=r(4),a=r.n(f),_=r(13),S=r.n(_),I=r(21),P=r.n(I),G=r(0),b=r.n(G),T=r(3),u=r.n(T),A=function(){var M="aes",E=256,m="cbc",p=16,y=4,o=4294967296,h=2147483648,s;if(b.a.getRandomWordArray)s=b.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&b.a.getRandomValues){var l=new Uint32Array(y);s=function(C,w){var k=C/4,W=k==y?l:new Uint32Array(k);b.a.getRandomValues(W,function(Q){w(Q,b.a.BufferUtils.toWordArray(W))})}}else s=function(C,w){u.a.logAction(u.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var k=C/4,W=new Array(k),Q=0;Q<k;Q++)W[Q]=Math.floor(Math.random()*o)-h;w(null,a.a.create(W))};function i(C){return C+p&-p}function g(C){if(C.algorithm==="aes"&&C.mode==="cbc"){if(C.keyLength===128||C.keyLength===256)return;throw new Error("Unsupported key length "+C.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function O(C){return C.replace("_","/").replace("-","+")}var D=[a.a.create([269488144,269488144,269488144,269488144],16),a.a.create([16777216],1),a.a.create([33685504],2),a.a.create([50529024],3),a.a.create([67372036],4),a.a.create([84215045,83886080],5),a.a.create([101058054,101056512],6),a.a.create([117901063,117901056],7),a.a.create([134744072,134744072],8),a.a.create([151587081,151587081,150994944],9),a.a.create([168430090,168430090,168427520],10),a.a.create([185273099,185273099,185273088],11),a.a.create([202116108,202116108,202116108],12),a.a.create([218959117,218959117,218959117,218103808],13),a.a.create([235802126,235802126,235802126,235798528],14),a.a.create([252645135,252645135,252645135,252645135],15),a.a.create([269488144,269488144,269488144,269488144],16)];function z(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}z.CipherParams=H,z.getDefaultParams=function(C){var w;if(typeof C=="function"||typeof C=="string"){if(u.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof C=="function")z.generateRandomKey(function(W){C(null,z.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,z.getDefaultParams({key:C}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!C.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof C.key=="string"?w=Object(_.parse)(O(C.key)):w=b.a.BufferUtils.toWordArray(C.key);var k=new H;if(k.key=w,k.algorithm=C.algorithm||M,k.keyLength=w.words.length*(4*8),k.mode=C.mode||m,C.keyLength&&C.keyLength!==k.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+C.keyLength+" was specified, but the key actually has length "+k.keyLength);return g(k),k},z.generateRandomKey=function(C,w){arguments.length==1&&typeof C=="function"&&(w=C,C=void 0),s((C||E)/8,w)},z.getCipher=function(C){var w=C instanceof H?C:z.getDefaultParams(C);return{cipherParams:w,cipher:new U(w,y,C.iv)}};function U(C,w,k){this.algorithm=C.algorithm+"-"+String(C.keyLength)+"-"+C.mode,this.cjsAlgorithm=C.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=b.a.BufferUtils.toWordArray(C.key),k&&(this.iv=b.a.BufferUtils.toWordArray(k).clone()),this.blockLengthWords=w}return U.prototype.encrypt=function(C,w){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.encrypt()",""),C=b.a.BufferUtils.toWordArray(C);var k=C.sigBytes,W=i(k),Q=this,Z=function(){Q.getIv(function(q,F){if(q){w(q);return}var L=Q.encryptCipher.process(C.concat(D[W-k])),N=F.concat(L);w(null,N)})};this.encryptCipher?Z():this.iv?(this.encryptCipher=P.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),Z()):s(p,function(q,F){if(q){w(q);return}Q.encryptCipher=P.a.algo[Q.cjsAlgorithm].createEncryptor(Q.key,{iv:F}),Q.iv=F,Z()})},U.prototype.decrypt=function(C){u.a.logAction(u.a.LOG_MICRO,"CBCCipher.decrypt()",""),C=b.a.BufferUtils.toWordArray(C);var w=this.blockLengthWords,k=C.words,W=a.a.create(k.slice(0,w)),Q=a.a.create(k.slice(w)),Z=P.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),q=Z.process(Q),F=Z.finalize();return Z.reset(),F&&F.sigBytes&&q.concat(F),q},U.prototype.getIv=function(C){if(this.iv){var w=this.iv;this.iv=null,C(null,w);return}var k=this;s(p,function(W,Q){if(W){C(W);return}C(null,k.encryptCipher.process(Q))})},z}();d.default=A},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(){var a=f,_=a.lib,S=_.WordArray,I=a.enc,P=I.Utf16=I.Utf16BE={stringify:function(b){for(var T=b.words,u=b.sigBytes,A=[],M=0;M<u;M+=2){var E=T[M>>>2]>>>16-M%4*8&65535;A.push(String.fromCharCode(E))}return A.join("")},parse:function(b){for(var T=b.length,u=[],A=0;A<T;A++)u[A>>>1]|=b.charCodeAt(A)<<16-A%2*16;return S.create(u,T*2)}};I.Utf16LE={stringify:function(b){for(var T=b.words,u=b.sigBytes,A=[],M=0;M<u;M+=2){var E=G(T[M>>>2]>>>16-M%4*8&65535);A.push(String.fromCharCode(E))}return A.join("")},parse:function(b){for(var T=b.length,u=[],A=0;A<T;A++)u[A>>>1]|=G(b.charCodeAt(A)<<16-A%2*16);return S.create(u,T*2)}};function G(b){return b<<8&4278255360|b>>>8&16711935}}(),f.enc.Utf16})},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(28))})(this,function(f){return function(a){var _=f,S=_.lib,I=S.CipherParams,P=_.enc,G=P.Hex,b=_.format,T=b.Hex={stringify:function(u){return u.ciphertext.toString(G)},parse:function(u){var A=G.parse(u);return I.create({ciphertext:A})}}}(),f.format.Hex})},function(v,d,r){(function(f,a){v.exports=d=a(r(6),r(13),r(61),r(27),r(28))})(this,function(f){return function(){var a=f,_=a.lib,S=_.BlockCipher,I=a.algo,P=[],G=[],b=[],T=[],u=[],A=[],M=[],E=[],m=[],p=[];(function(){for(var h=[],s=0;s<256;s++)s<128?h[s]=s<<1:h[s]=s<<1^283;for(var l=0,i=0,s=0;s<256;s++){var g=i^i<<1^i<<2^i<<3^i<<4;g=g>>>8^g&255^99,P[l]=g,G[g]=l;var O=h[l],D=h[O],z=h[D],H=h[g]*257^g*16843008;b[l]=H<<24|H>>>8,T[l]=H<<16|H>>>16,u[l]=H<<8|H>>>24,A[l]=H;var H=z*16843009^D*65537^O*257^l*16843008;M[g]=H<<24|H>>>8,E[g]=H<<16|H>>>16,m[g]=H<<8|H>>>24,p[g]=H,l?(l=O^h[h[h[z^O]]],i^=h[h[i]]):l=i=1}})();var y=[0,1,2,4,8,16,32,64,128,27,54],o=I.AES=S.extend({_doReset:function(){var h;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var s=this._keyPriorReset=this._key,l=s.words,i=s.sigBytes/4,g=this._nRounds=i+6,O=(g+1)*4,D=this._keySchedule=[],z=0;z<O;z++)z<i?D[z]=l[z]:(h=D[z-1],z%i?i>6&&z%i==4&&(h=P[h>>>24]<<24|P[h>>>16&255]<<16|P[h>>>8&255]<<8|P[h&255]):(h=h<<8|h>>>24,h=P[h>>>24]<<24|P[h>>>16&255]<<16|P[h>>>8&255]<<8|P[h&255],h^=y[z/i|0]<<24),D[z]=D[z-i]^h);for(var H=this._invKeySchedule=[],U=0;U<O;U++){var z=O-U;if(U%4)var h=D[z];else var h=D[z-4];U<4||z<=4?H[U]=h:H[U]=M[P[h>>>24]]^E[P[h>>>16&255]]^m[P[h>>>8&255]]^p[P[h&255]]}}},encryptBlock:function(h,s){this._doCryptBlock(h,s,this._keySchedule,b,T,u,A,P)},decryptBlock:function(h,s){var l=h[s+1];h[s+1]=h[s+3],h[s+3]=l,this._doCryptBlock(h,s,this._invKeySchedule,M,E,m,p,G);var l=h[s+1];h[s+1]=h[s+3],h[s+3]=l},_doCryptBlock:function(h,s,l,i,g,O,D,z){for(var H=this._nRounds,U=h[s]^l[0],C=h[s+1]^l[1],w=h[s+2]^l[2],k=h[s+3]^l[3],W=4,Q=1;Q<H;Q++){var Z=i[U>>>24]^g[C>>>16&255]^O[w>>>8&255]^D[k&255]^l[W++],q=i[C>>>24]^g[w>>>16&255]^O[k>>>8&255]^D[U&255]^l[W++],F=i[w>>>24]^g[k>>>16&255]^O[U>>>8&255]^D[C&255]^l[W++],L=i[k>>>24]^g[U>>>16&255]^O[C>>>8&255]^D[w&255]^l[W++];U=Z,C=q,w=F,k=L}var Z=(z[U>>>24]<<24|z[C>>>16&255]<<16|z[w>>>8&255]<<8|z[k&255])^l[W++],q=(z[C>>>24]<<24|z[w>>>16&255]<<16|z[k>>>8&255]<<8|z[U&255])^l[W++],F=(z[w>>>24]<<24|z[k>>>16&255]<<16|z[U>>>8&255]<<8|z[C&255])^l[W++],L=(z[k>>>24]<<24|z[U>>>16&255]<<16|z[C>>>8&255]<<8|z[w&255])^l[W++];h[s]=Z,h[s+1]=q,h[s+2]=F,h[s+3]=L},keySize:256/32});a.AES=S._createHelper(o)}(),f.AES})},function(v,d,r){(function(f,a){v.exports=d=a(r(6))})(this,function(f){return function(a){var _=f,S=_.lib,I=S.WordArray,P=S.Hasher,G=_.algo,b=[];(function(){for(var m=0;m<64;m++)b[m]=a.abs(a.sin(m+1))*4294967296|0})();var T=G.MD5=P.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,p){for(var y=0;y<16;y++){var o=p+y,h=m[o];m[o]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var s=this._hash.words,l=m[p+0],i=m[p+1],g=m[p+2],O=m[p+3],D=m[p+4],z=m[p+5],H=m[p+6],U=m[p+7],C=m[p+8],w=m[p+9],k=m[p+10],W=m[p+11],Q=m[p+12],Z=m[p+13],q=m[p+14],F=m[p+15],L=s[0],N=s[1],K=s[2],V=s[3];L=u(L,N,K,V,l,7,b[0]),V=u(V,L,N,K,i,12,b[1]),K=u(K,V,L,N,g,17,b[2]),N=u(N,K,V,L,O,22,b[3]),L=u(L,N,K,V,D,7,b[4]),V=u(V,L,N,K,z,12,b[5]),K=u(K,V,L,N,H,17,b[6]),N=u(N,K,V,L,U,22,b[7]),L=u(L,N,K,V,C,7,b[8]),V=u(V,L,N,K,w,12,b[9]),K=u(K,V,L,N,k,17,b[10]),N=u(N,K,V,L,W,22,b[11]),L=u(L,N,K,V,Q,7,b[12]),V=u(V,L,N,K,Z,12,b[13]),K=u(K,V,L,N,q,17,b[14]),N=u(N,K,V,L,F,22,b[15]),L=A(L,N,K,V,i,5,b[16]),V=A(V,L,N,K,H,9,b[17]),K=A(K,V,L,N,W,14,b[18]),N=A(N,K,V,L,l,20,b[19]),L=A(L,N,K,V,z,5,b[20]),V=A(V,L,N,K,k,9,b[21]),K=A(K,V,L,N,F,14,b[22]),N=A(N,K,V,L,D,20,b[23]),L=A(L,N,K,V,w,5,b[24]),V=A(V,L,N,K,q,9,b[25]),K=A(K,V,L,N,O,14,b[26]),N=A(N,K,V,L,C,20,b[27]),L=A(L,N,K,V,Z,5,b[28]),V=A(V,L,N,K,g,9,b[29]),K=A(K,V,L,N,U,14,b[30]),N=A(N,K,V,L,Q,20,b[31]),L=M(L,N,K,V,z,4,b[32]),V=M(V,L,N,K,C,11,b[33]),K=M(K,V,L,N,W,16,b[34]),N=M(N,K,V,L,q,23,b[35]),L=M(L,N,K,V,i,4,b[36]),V=M(V,L,N,K,D,11,b[37]),K=M(K,V,L,N,U,16,b[38]),N=M(N,K,V,L,k,23,b[39]),L=M(L,N,K,V,Z,4,b[40]),V=M(V,L,N,K,l,11,b[41]),K=M(K,V,L,N,O,16,b[42]),N=M(N,K,V,L,H,23,b[43]),L=M(L,N,K,V,w,4,b[44]),V=M(V,L,N,K,Q,11,b[45]),K=M(K,V,L,N,F,16,b[46]),N=M(N,K,V,L,g,23,b[47]),L=E(L,N,K,V,l,6,b[48]),V=E(V,L,N,K,U,10,b[49]),K=E(K,V,L,N,q,15,b[50]),N=E(N,K,V,L,z,21,b[51]),L=E(L,N,K,V,Q,6,b[52]),V=E(V,L,N,K,O,10,b[53]),K=E(K,V,L,N,k,15,b[54]),N=E(N,K,V,L,i,21,b[55]),L=E(L,N,K,V,C,6,b[56]),V=E(V,L,N,K,F,10,b[57]),K=E(K,V,L,N,H,15,b[58]),N=E(N,K,V,L,Z,21,b[59]),L=E(L,N,K,V,D,6,b[60]),V=E(V,L,N,K,W,10,b[61]),K=E(K,V,L,N,g,15,b[62]),N=E(N,K,V,L,w,21,b[63]),s[0]=s[0]+L|0,s[1]=s[1]+N|0,s[2]=s[2]+K|0,s[3]=s[3]+V|0},_doFinalize:function(){var m=this._data,p=m.words,y=this._nDataBytes*8,o=m.sigBytes*8;p[o>>>5]|=128<<24-o%32;var h=a.floor(y/4294967296),s=y;p[(o+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,p[(o+64>>>9<<4)+14]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,m.sigBytes=(p.length+1)*4,this._process();for(var l=this._hash,i=l.words,g=0;g<4;g++){var O=i[g];i[g]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}return l},clone:function(){var m=P.clone.call(this);return m._hash=this._hash.clone(),m}});function u(m,p,y,o,h,s,l){var i=m+(p&y|~p&o)+h+l;return(i<<s|i>>>32-s)+p}function A(m,p,y,o,h,s,l){var i=m+(p&o|y&~o)+h+l;return(i<<s|i>>>32-s)+p}function M(m,p,y,o,h,s,l){var i=m+(p^y^o)+h+l;return(i<<s|i>>>32-s)+p}function E(m,p,y,o,h,s,l){var i=m+(y^(p|~o))+h+l;return(i<<s|i>>>32-s)+p}_.MD5=P._createHelper(T),_.HmacMD5=P._createHmacHelper(T)}(Math),f.MD5})},function(v,d,r){"use strict";var f;d.__esModule=!0;var a=r(1),_=a.__importDefault(r(0)),S=a.__importStar(r(2)),I=a.__importDefault(r(8)),P=a.__importDefault(r(5)),G=a.__importDefault(r(17)),b=a.__importDefault(r(15)),T=a.__importDefault(r(20)),u=a.__importDefault(r(3)),A=r(29);function M(p){var y=p.statusCode;return y===408&&!p.code||y===400&&!p.code||y>=500&&y<=504}function E(p){var y=p.connection,o=y&&y.connectionManager.host;return o?[o].concat(I.default.getFallbackHosts(p.options)):I.default.getHosts(p.options)}var m=(f=function(){function p(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=E,_.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(y,o,h,s,l,i,g){var O=b.default.createRequest(h,s,l,i,T.default.REQ_SEND,o&&o.options.timeouts,y);return O.once("complete",g),O.exec(),O},this.checkConnectivity=function(y){var o=I.default.internetUpUrl;u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+o),this.doUri(G.default.Get,null,o,null,null,null,function(h,s){var l,i=!h&&((l=s)===null||l===void 0?void 0:l.replace(/\n/,""))=="yes";u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+i),y(null,i)})}):_.default.Config.jsonpSupported&&(this.Request=function(y,o,h,s,l,i,g){var O=A.createRequest(h,s,l,i,T.default.REQ_SEND,o&&o.options.timeouts,y);return O.once("complete",g),_.default.Config.nextTick(function(){O.exec()}),O},this.checkConnectivity=function(y){var o=this,h=I.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(y);return}this.checksInProgress=[y],u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+h);var s=new A.Request("isTheInternetUp",h,null,null,null,T.default.REQ_SEND,I.default.TIMEOUTS);s.once("complete",function(l,i){var g=!l&&i;u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+g);for(var O=0;O<o.checksInProgress.length;O++)o.checksInProgress[O](null,g);o.checksInProgress=null}),_.default.Config.nextTick(function(){s.exec()})})}return p.prototype.do=function(y,o,h,s,l,i,g){var O=this,D=typeof h=="function"?h:function(C){return o.baseUri(C)+h},z=o._currentFallback;if(z)if(z.validUntil>S.now()){if(!this.Request){g==null||g(new P.default("Request invoked before assigned to",null,500));return}this.Request(y,o,D(z.host),s,i,l,function(C){for(var w=[],k=1;k<arguments.length;k++)w[k-1]=arguments[k];if(C&&M(C)){o._currentFallback=null,O.do(y,o,h,s,l,i,g);return}g==null||g.apply(void 0,a.__spreadArray([C],w))});return}else o._currentFallback=null;var H=E(o);if(H.length===1){this.doUri(y,o,D(H[0]),s,l,i,g);return}var U=function(C,w){var k=C.shift();O.doUri(y,o,D(k),s,l,i,function(W){for(var Q=[],Z=1;Z<arguments.length;Z++)Q[Z-1]=arguments[Z];if(W&&M(W)&&C.length){U(C,!0);return}w&&(o._currentFallback={host:k,validUntil:S.now()+o.options.timeouts.fallbackRetryTimeout}),g==null||g.apply(void 0,a.__spreadArray([W],Q))})};U(H)},p.prototype.doUri=function(y,o,h,s,l,i,g){if(!this.Request){g(new P.default("Request invoked before assigned to",null,500));return}this.Request(y,o,h,s,i,l,g)},p}(),f.methods=[G.default.Get,G.default.Delete,G.default.Post,G.default.Put,G.default.Patch],f.methodsWithoutBody=[G.default.Get,G.default.Delete],f.methodsWithBody=[G.default.Post,G.default.Put,G.default.Patch],f);d.default=m},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(40)),_=f.__importStar(r(2)),S=_.getGlobalObject();function I(){var T=S.location;return!S.WebSocket||!T||!T.origin||T.origin.indexOf("http")>-1}var P=S.navigator&&S.navigator.userAgent.toString(),G=S.location&&S.location.href,b={agent:"browser",logTimestamps:!0,userAgent:P,currentUrl:G,noUpgrade:P&&!!P.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:S.WebSocket,xhrSupported:S.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:I(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:a.default,supportsBinary:!!S.TextDecoder,preferBinary:!1,ArrayBuffer:S.ArrayBuffer,atob:S.atob,nextTick:typeof S.setImmediate!="undefined"?S.setImmediate.bind(S):function(T){setTimeout(T,0)},addEventListener:S.addEventListener,inspect:JSON.stringify,stringByteSize:function(T){return S.TextDecoder&&new S.TextEncoder().encode(T).length||T.length},TextEncoder:S.TextEncoder,TextDecoder:S.TextDecoder,Promise:S.Promise,getRandomValues:function(T){if(T!==void 0)return function(u,A){T.getRandomValues(u),A&&A(null)}}(S.crypto||msCrypto)};d.default=b},function(v,d,r){"use strict";(function(f){d.__esModule=!0;var a=r(1),_=a.__importStar(r(2)),S="ablyjs-storage-test",I=function(){function P(){try{f.sessionStorage.setItem(S,S),f.sessionStorage.removeItem(S),this.sessionSupported=!0}catch(G){this.sessionSupported=!1}try{f.localStorage.setItem(S,S),f.localStorage.removeItem(S),this.localSupported=!0}catch(G){this.localSupported=!1}}return P.prototype.get=function(G){return this._get(G,!1)},P.prototype.getSession=function(G){return this._get(G,!0)},P.prototype.remove=function(G){return this._remove(G,!1)},P.prototype.removeSession=function(G){return this._remove(G,!0)},P.prototype.set=function(G,b,T){return this._set(G,b,T,!1)},P.prototype.setSession=function(G,b,T){return this._set(G,b,T,!0)},P.prototype._set=function(G,b,T,u){var A={value:b};return T&&(A.expires=_.now()+T),this.storageInterface(u).setItem(G,JSON.stringify(A))},P.prototype._get=function(G,b){if(b&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!b&&!this.localSupported)throw new Error("Local Storage not supported");var T=this.storageInterface(b).getItem(G);if(!T)return null;var u=JSON.parse(T);return u.expires&&u.expires<_.now()?(this.storageInterface(b).removeItem(G),null):u.value},P.prototype._remove=function(G,b){return this.storageInterface(b).removeItem(G)},P.prototype.storageInterface=function(G){return G?f.sessionStorage:f.localStorage},P}();d.default=new I}).call(this,r(12))},function(v,d,r){"use strict";d.__esModule=!0;var f=r(1),a=f.__importDefault(r(66)),_={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],baseTransportOrder:[a.default.XhrPolling,a.default.XhrStreaming,a.default.JsonP,a.default.WebSocket],transportPreferenceOrder:[a.default.JsonP,a.default.XhrPolling,a.default.XhrStreaming,a.default.WebSocket],upgradeTransports:[a.default.XhrStreaming,a.default.WebSocket]};d.default=_},function(v,d,r){"use strict";d.__esModule=!0;var f;(function(a){a.WebSocket="web_socket",a.Comet="comet",a.XhrStreaming="xhr_streaming",a.XhrPolling="xhr_polling",a.JsonP="jsonp"})(f||(f={})),d.default=f},function(v,d,r){"use strict";r.r(d);var f=r(29),a=r.n(f),_=r(2),S=r(0),I=r.n(S),P=r(11),G=r.n(P),b=r(15),T=r.n(b),u=function(p){var y="xhr_polling";function o(h,s,l){l.stream=!1,G.a.call(this,h,s,l),this.shortName=y}return _.inherits(o,G.a),o.isAvailable=function(){return I.a.Config.xhrSupported&&I.a.Config.allowComet},o.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(h,s,l,i,g){return T.a.createRequest(h,s,l,i,g,this.timeouts)},typeof p!="undefined"&&o.isAvailable()&&(p.supportedTransports[y]=o),o},A=u,M=function(p){var y="xhr_streaming";function o(h,s,l){G.a.call(this,h,s,l),this.shortName=y}return _.inherits(o,G.a),o.isAvailable=function(){return I.a.Config.xhrSupported&&I.a.Config.streamingSupported&&I.a.Config.allowComet},o.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},o.prototype.createRequest=function(h,s,l,i,g){return T.a.createRequest(h,s,l,i,g,this.timeouts)},typeof p!="undefined"&&o.isAvailable()&&(p.supportedTransports[y]=o),o},E=M,m=d.default=[a.a,A,E]}]).default})});st();var Ho=vn(bo());st();st();st();st();var re=(a,_,S,...I)=>Ft(void 0,[a,_,S,...I],function*(v,d,r,f={}){let P=yield fetch(v,{method:d,headers:Kt({"Content-Type":"application/json"},f),body:r?JSON.stringify(r):null});if(!P.ok)throw P;try{return yield P.json()}catch(G){return P.ok}});st();var Tu=vn(bo()),De=class{constructor(d){this.debug=(0,Tu.default)(d)}log(d,...r){this.debug(d,...r)}};st();st();var il=vn(Eo());var Nt=class{constructor(d={}){this.subscribe=d=>{this.callbacks.push(d)};this.unsubscribe=d=>{this.callbacks=this.callbacks.filter(r=>r!==d)};this.publish=(...d)=>{!this.callbacks||this.callbacks.forEach(r=>{this.callListener(r,d).catch(f=>{this.logger.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(d)}
            Error: ${f}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(d,r)=>new Promise((f,a)=>{try{let _=d(...r);f(_)}catch(_){a(_)}});let{logger:r,throttleTime:f}=d;this.logger=r!=null?r:new De("@superviz/sdk/observer-helper"),this.throttle=f,this.callbacks=[],this.throttle&&(this.publish=(0,il.default)(this.publish,this.throttle))}};var nr=class{constructor(){this.observers={};this.subscribe=(d,r)=>{this.logger.log(`subscribed to ${d} event`),this.observers[d]||(this.observers[d]=new Nt({logger:this.logger})),this.observers[d].subscribe(r)};this.unsubscribe=(d,r)=>{this.logger.log(`unsubscribed from ${d} event`),this.observers[d]&&(this.observers[d].reset(),delete this.observers[d])};this.publish=(d,r)=>{d in this.observers&&this.observers[d].publish(r)}}};st();st();var ol=vn(Po()),_o=class{setConfig(d){this.configuration=d}get(d,r){if(!this.configuration)throw new Error("configs is not available");return(0,ol.get)(this.configuration,d,r)}},ae=new _o;var Ue=class{static createUrl(d,r,f={}){let a=new URL(r,d);return Object.keys(f).forEach(_=>a.searchParams.append(_,f[_])),a.toString()}static validateApiKey(d,r){let f="/user/checkapikey",a=this.createUrl(d,f);return re(a,"POST",{apiKey:r})}static fetchConfig(d,r){let f="/immersive-config",a=this.createUrl(d,f);return re(a,"POST",{apiKey:r})}static fetchLimits(d,r){return Ft(this,null,function*(){let f="/user/check_limits",a=this.createUrl(d,f);return(yield re(a,"GET","",{apikey:r})).usage})}static fetchWaterMark(d,r){return Ft(this,null,function*(){let f="/user/watermark",a=this.createUrl(d,f),{message:_}=yield re(a,"POST",{apiKey:r});return _})}static createAnnotations(d,r,f){return Ft(this,null,function*(){let a="/annotations",_=this.createUrl(d,a);return re(_,"POST",Kt({},f),{apikey:r})})}static updateComment(d,r,f,a){return Ft(this,null,function*(){let _=`/comments/${f}`,S=this.createUrl(d,_);return re(S,"PUT",{text:a},{apikey:r})})}static createComment(d,r,f){return Ft(this,null,function*(){let a="/comments",_=this.createUrl(d,a);return re(_,"POST",Kt({},f),{apikey:r})})}static fetchAnnotation(d,r,f){return Ft(this,null,function*(){let a="/annotations",_=this.createUrl(d,a,{roomId:f.roomId,url:f.url});return re(_,"GET",void 0,{apikey:r})})}static resolveAnnotation(d,r,f){return Ft(this,null,function*(){let a=`/annotations/resolve/${f}`,_=this.createUrl(d,a);return re(_,"POST",{},{apikey:r})})}static deleteComment(d,r,f){return Ft(this,null,function*(){let a=`/comments/${f}`,_=this.createUrl(d,a);return re(_,"DELETE",{},{apikey:r})})}static deleteAnnotation(d,r,f){return Ft(this,null,function*(){let a=`/annotations/${f}`,_=this.createUrl(d,a);return re(_,"DELETE",{},{apikey:r})})}static createOrUpdateParticipant(d,r){return Ft(this,null,function*(){let f=ae.get("apiUrl"),a="/participants",_=this.createUrl(f,a);return re(_,"POST",Kt({},r),{apikey:d})})}static sendActivity(d,r,f,a){return Ft(this,null,function*(){let _="/activity",S=ae.get("apiUrl"),I=ae.get("roomId"),P=ae.get("apiKey"),G=this.createUrl(S,_);return re(G,"POST",{groupId:r,groupName:f,meetingId:I,product:a,userId:d},{apikey:P})})}};st();function a0(v,d){return Ft(this,null,function*(){try{return(yield Ue.validateApiKey(v,d))===!0}catch(r){if(r.status===404)return!1;throw new Error("Unable to validate API key")}})}var al=a0;st();st();var Bn=class{static getRemoteConfig(){return Ft(this,arguments,function*(d="prod"){let{version:r}=yield Promise.resolve().then(()=>(ul(),sl));if(d==="local"){let{remoteConfig:_}=yield Promise.resolve().then(()=>(cl(),ll));return _}let f={version:r,environment:d},a=this.createUrl(f);return re(a,"GET",null)})}static createUrl({version:d,environment:r}){return`${this.REMOTE_CONFIG_BASE_URL}/${d}?env=${r}`}};Bn.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";st();var Go=vn(Po());st();st();var ir=class{constructor(){this.observers=new Map;this.subscribe=(d,r)=>{this.logger.log("event bus service @ subscribe",{event:d,callback:r}),this.observers.has(d)||this.observers.set(d,new Nt),this.observers.get(d).subscribe(r)};this.unsubscribe=(d,r)=>{this.logger.log("event bus service @ unsubscribe",{event:d,callback:r}),this.observers.has(d)&&(this.observers.get(d).reset(),this.observers.delete(d))};this.publish=(d,r)=>{this.logger.log("event bus service @ publish",{event:d,data:r}),this.observers.has(d)&&this.observers.get(d).publish(r)};this.logger=new De("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};st();st();var wo=(f=>(f.presence3dMatterport="presence3d",f.presence3dAutodesk="presence3d",f.presence3dThreejs="presence3d",f))(wo||{});var or=class{static checkComponentLimit(d){var a;let r=(a=wo[d])!=null?a:d,f=ae.get("limits");return!0}};st();st();var Bo=vn(fl()),yn=vn(Eo());st();var xo=(P=>(P[P.DISCONNECTED=0]="DISCONNECTED",P[P.INITIALIZING=1]="INITIALIZING",P[P.READY_TO_JOIN=2]="READY_TO_JOIN",P[P.CONNECTING=3]="CONNECTING",P[P.CONNECTED=4]="CONNECTED",P[P.JOINED=5]="JOINED",P[P.FAILED=-1]="FAILED",P[P.RETRYING=-2]="RETRYING",P))(xo||{});st();st();var Lo=(p=>(p[p.yellow=0]="yellow",p[p.turquoise=1]="turquoise",p[p.orange=2]="orange",p[p.blue=3]="blue",p[p.pink=4]="pink",p[p.purple=5]="purple",p[p.green=6]="green",p[p.red=7]="red",p[p.bluedark=8]="bluedark",p[p.pinklight=9]="pinklight",p[p.purplelight=10]="purplelight",p[p.greenlight=11]="greenlight",p[p.orangelight=12]="orangelight",p[p.bluelight=13]="bluelight",p[p.redlight=14]="redlight",p[p.brown=15]="brown",p[p.gray=16]="gray",p))(Lo||{}),Do=(v=>(v[v["#FFEF33"]=0]="#FFEF33",v[v["#31E0B0"]=1]="#31E0B0",v[v["#FF5E10"]=2]="#FF5E10",v[v["#00ABF7"]=3]="#00ABF7",v[v["#FF00BB"]=4]="#FF00BB",v[v["#9C29FF"]=5]="#9C29FF",v[v["#6FDD00"]=6]="#6FDD00",v[v["#E30000"]=7]="#E30000",v[v["#304AFF"]=8]="#304AFF",v[v["#FF89C4"]=9]="#FF89C4",v[v["#D597FF"]=10]="#D597FF",v[v["#C6EC5C"]=11]="#C6EC5C",v[v["#FFA115"]=12]="#FFA115",v[v["#75DEFE"]=13]="#75DEFE",v[v["#FAA291"]=14]="#FAA291",v[v["#BB813F"]=15]="#BB813F",v[v["#878291"]=16]="#878291",v))(Do||{});var Zr=class{constructor(){this.participantObservers=[],this.logger=new De("@superviz/sdk/realtime-service"),this.participantsObserver=new Nt({logger:this.logger}),this.participantJoinedObserver=new Nt({logger:this.logger}),this.participantLeaveObserver=new Nt({logger:this.logger}),this.syncPropertiesObserver=new Nt({logger:this.logger}),this.reconnectObserver=new Nt({logger:this.logger}),this.roomInfoUpdatedObserver=new Nt({logger:this.logger}),this.roomListUpdatedObserver=new Nt({logger:this.logger}),this.hostObserver=new Nt({logger:this.logger}),this.hostAvailabilityObserver=new Nt({logger:this.logger}),this.realtimeStateObserver=new Nt({logger:this.logger}),this.kickAllParticipantsObserver=new Nt({logger:this.logger}),this.kickParticipantObserver=new Nt({logger:this.logger}),this.authenticationObserver=new Nt({logger:this.logger}),this.commentsObserver=new Nt({logger:this.logger}),this.presenceMouseObserver=new Nt({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new Nt({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new Nt({logger:this.logger}),this.presence3dObserver=new Nt({logger:this.logger}),this.presence3dLeaveObserver=new Nt({logger:this.logger}),this.presence3dJoinedObserver=new Nt({logger:this.logger})}subscribeToParticipantUpdate(d,r){this.participantObservers[d]||(this.participantObservers[d]=new Nt({logger:this.logger})),this.participantObservers[d].subscribe(r)}unsubscribeFromParticipantUpdate(d,r){this.participantObservers[d]&&this.participantObservers[d].unsubscribe(r)}getSlotColor(d){let r=d!=null?d:16;return{color:Do[r],name:Lo[r]}}};var f0=1e3*60,d0=6e4,h0=1e4,Uo=1e3,No=null,Gn=class extends Zr{constructor(r,f){super();this.participants={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.clientSyncPropertiesTimeOut=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.shouldKickParticipantsOnHostLeave=!1;this.left=!1;this.state=0;this.setHost=r=>{if(!r)return;let f=this.participants[r];this.updateRoomProperties({hostClientId:f.clientId})};this.setKickParticipant=r=>{if(!r)return;let f=this.participants[r];this.updateRoomProperties({kickParticipant:f})};this.freezeSync=r=>{var f,a;if(this.isSyncFrozen=r,r){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(f=this.broadcastChannel)==null||f.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(a=this.broadcastChannel)==null||a.unsubscribe();return}this.join()};this.setParticipantData=r=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,r),this.presence3DChannel&&this.updatePresence3D(r)};this.setKickParticipantsOnHostLeave=r=>{this.shouldKickParticipantsOnHostLeave=r};this.publishClientSyncProperties=()=>{this.state===4&&(Object.keys(this.clientSyncPropertiesQueue).forEach(r=>{let f=this.clientSyncPropertiesQueue[r];this.clientSyncPropertiesQueue[r]=[],f.length&&this.clientSyncChannel.publish(r,f)}),clearTimeout(this.clientSyncPropertiesTimeOut),this.clientSyncPropertiesTimeOut=null)};this.saveClientRoomState=(r,f)=>Ft(this,null,function*(){let a=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},a,{[r]:f[f.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=r=>Ft(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,r),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),r.hostClientId?(r==null?void 0:r.hostClientId)!==this.hostParticipantId&&this.updateHostInfo(r.hostClientId):(this.hostParticipantId=null,this.hostPassingHandle()),this.updateParticipants(),r.kickParticipant&&r.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(0,yn.default)((r={})=>{let f=r;this.isMessageTooBig(f)||this.left||!this.enableSync||this.isSyncFrozen||(f.avatar===void 0&&delete f.avatar,this.myParticipant.data=Kt(Kt({},this.myParticipant.data),f),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))},Uo);this.updateRoomProperties=r=>{if(this.isMessageTooBig(r)||this.isSyncFrozen||this.left)return;let f=Kt(Kt({},this.localRoomProperties),r);this.supervizChannel.publish("update",f)};this.updateParticipants=()=>{let r={};this.supervizChannel.presence.get((f,a)=>{a.forEach(_=>{r[_.clientId]=Kt({},_)}),this.participants=r,this.participantsObserver.publish(this.participants)})};this.updateHostInfo=r=>{let f=[];if(this.supervizChannel.presence.get((_,S)=>{S.forEach(I=>{_||f.push(I.clientId)})}),!r||!f.includes(r)){this.hostPassingHandle();return}No&&(clearTimeout(No),this.hostAvailabilityObserver.publish(!0));let a=this.hostParticipantId;this.hostParticipantId=r,this.hostObserver.publish({oldHostParticipantId:a,newHostParticipantId:this.hostParticipantId}),this.logger.log("REALTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)};this.initializeRoomProperties=()=>{var f;let r={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};((f=this.myParticipant)==null?void 0:f.data.type)==="host"&&(r.hostClientId=this.myParticipant.data.participantId),this.updateParticipants(),this.updateRoomProperties(r)};this.hostPassingHandle=(0,yn.default)(()=>Ft(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.supervizChannel.presence.get((r,f)=>{let a=f.filter(S=>S.data.type==="host").map(S=>S.clientId);if(this.shouldKickParticipantsOnHostLeave&&!a.length){this.hostAvailabilityObserver.publish(!1),No=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},f0);return}let _=a[0];_===this.localParticipantId&&this.setHost(_)})}),1e3);this.findSlotIndex=r=>{let f=r,a=Array.apply(null,{length:15}).map(Number.call,Number);if(this.supervizChannel.presence.get((I,P)=>{if(I){a=[];return}P.forEach(G=>{G.connectionId===f.connectionId&&(f=G),G.connectionId!==f.connectionId&&G.data.hasOwnProperty("slotIndex")&&a.splice(a.indexOf(G.data.slotIndex),1)})}),a.length===0)return;let _=a[0];this.myParticipant.data.slotIndex=_,this.updateMyProperties({slotIndex:_});let S=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(f)},S)};this.confirmSlot=(0,yn.default)(r=>Ft(this,null,function*(){let f=[],a=r;if(this.supervizChannel.presence.get((_,S)=>{S.forEach(I=>{I.connectionId===a.connectionId&&(a=I),I.connectionId!==a.connectionId&&I.data.slotIndex!==void 0&&f.push(I.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||f.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(a);else{let _=yield this.fetchRoomProperties();this.updateRoomProperties(_)}}),1e3);this.onParticipantJoin=r=>{this.updateParticipants(),this.participantJoinedObserver.publish(r),this.updateMyProperties()};this.syncBroadcast=(0,yn.default)(()=>{let r=btoa(this.ablyKey),f=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(f,{headers:{Authorization:`Basic ${r}`}}).then(a=>a.json()).then(a=>{this.broadcastChannel.publish("update",a)})},1e3);this.isMessageTooBig=(r,f=d0)=>{let a=JSON.stringify(r);return new TextEncoder().encode(a).length>f?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=r=>{this.logger.log("REALTIME","Comments channel update",r),this.commentsObserver.publish(r.data)};this.updateComments=r=>{this.commentsChannel.publish("update",r)};this.enterPresenceMouseChannel=r=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(r)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel=null,this.presenceMouseChannel.presence.leave())};this.updatePresenceMouse=(0,yn.default)(r=>{let f=Object.assign({},this.participantsMouse[r.id]||{},r);this.presenceMouseChannel.presence.update(f)},Uo);this.onPresenceMouseChannelEnter=r=>{this.presenceMouseParticipantJoinedObserver.publish(r.data)};this.onPresenceMouseChannelLeave=r=>{this.presenceMouseParticipantLeaveObserver.publish(r.data)};this.publishPresenceMouseUpdate=r=>{let f=this.getParticipantSlot(r.clientId);this.participantsMouse[r.clientId]=Qe(Kt({},r.data),{slotIndex:f,color:this.getSlotColor(f).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.enterPresence3DChannel=r=>{this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(r)};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel=null,this.presence3DChannel.presence.leave())};this.updatePresence3D=(0,yn.default)(r=>{let f=Object.assign({},this.participantsOn3d[r.id]||{},r);this.presence3DChannel.presence.update(f)},Uo);this.onPresence3DChannelEnter=r=>{r.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let f=this.getParticipantSlot(r.clientId);this.presence3dJoinedObserver.publish(Qe(Kt({},r),{data:Qe(Kt(Kt({},r.data),this.participants[r.clientId].data),{slotIndex:f,color:this.getSlotColor(f).color})}))};this.onPresence3DChannelLeave=r=>{delete this.participantsOn3d[r.clientId],this.presence3dLeaveObserver.publish(r)};this.publish3DUpdate=r=>{let f=this.getParticipantSlot(r.clientId);this.participantsOn3d[r.clientId]=Qe(Kt({},r),{data:Qe(Kt(Kt({},r.data),this.participants[r.clientId].data),{slotIndex:f,color:this.getSlotColor(f).color})}),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=f,this.apiUrl=r,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var r;return(r=this.roomProperties)==null?void 0:r.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var r,f;return(f=(r=this.myParticipant.data)==null?void 0:r.participantId)!=null?f:null}get isBroadcast(){return Object.values(this.participants).some(r=>r.data.type==="audience")}start({participant:r,roomId:f,apiKey:a}){this.myParticipant={data:Qe(Kt({},r),{participantId:r.id}),timestamp:null,action:null,clientId:r.id,connectionId:null,encoding:null,id:null},this.enableSync=r.type!=="audience",this.roomId=`superviz:${f.toLowerCase()}-${a}`,this.apiKey=a,this.client||this.buildClient()}auth(r,f){let a=new Bo.default.Rest({key:this.ablyKey}),{origin:_}=window.location;a.auth.requestToken(r,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:_,apiKey:this.apiKey}},(S,I)=>{S&&this.authenticationObserver.publish("realtime.authentication-failed"),f(S,I)})}join(r){let f=r?Object.assign({},r,{participantId:r.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(f),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(r){let f=this.localRoomProperties;this.updateRoomProperties(Object.assign({},f,{isGridModeEnable:r}))}setDrawing(r){let f=this.localRoomProperties;this.updateRoomProperties(Object.assign({},f,{drawing:r}))}setTranscript(r){let f=this.localRoomProperties;this.updateRoomProperties(Object.assign({},f,{transcript:r}))}setSyncProperty(r,f){var S;let a=(S=this.clientSyncPropertiesQueue[r])!=null?S:[],_=(I,P)=>({name:I,data:P,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(_(r,f),h0)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.isMessageTooBig(a)&&(this.logger.log("REALTIME","Message queue too big, publishing"),this.publishClientSyncProperties()),this.logger.log("adding to queue",r,f),this.clientSyncPropertiesQueue[r]||(this.clientSyncPropertiesQueue[r]=[]),this.clientSyncPropertiesQueue[r].push(_(r,f)),this.clientSyncPropertiesTimeOut||(this.clientSyncPropertiesTimeOut=setTimeout(()=>{this.publishClientSyncProperties()},1e3))}setFollowParticipant(r){this.updateRoomProperties({followParticipantId:r})}setGather(r){this.updateRoomProperties({gather:r})}getParticipantSlot(r){var f,a;if(r){let _=r.toString();if(this.participants&&this.participants[_])return(a=(f=this.participants[r])==null?void 0:f.data)==null?void 0:a.slotIndex}return 16}onAblyPresenceEnter(r){r.clientId===this.myParticipant.data.participantId?this.onJoinRoom(r):this.onParticipantJoin(r)}onAblyPresenceUpdate(r){if(!this.isJoinedRoom)return;let{clientId:f}=r,a=Object.assign({},r,{participantId:r.clientId});this.publishParticipantUpdate(a),this.participants&&this.participants[f]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(r){this.onParticipantLeave(r)}onClientSyncChannelUpdate(r){let{name:f,data:a}=r,_={};_[f]=a,this.syncPropertiesObserver.publish(_),this.isLocalParticipantHost&&this.saveClientRoomState(f,a)}onReceiveBroadcastSync(r){r.data.forEach(a=>{var S;let _=a.clientId;this.participants[_]=a,(S=a.data)!=null&&S.isAudience||(this.participants[_].data=JSON.parse(this.participants[_].data),this.publishParticipantUpdate(this.participants[_]))})}onAblyRoomUpdate(r){this.updateLocalRoomState(r.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let r={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Bo.default.Realtime(r),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(r){this.participants[r.clientId]=r,this.participantsObserver.publish(this.participants),this.participantObservers[r.clientId]&&this.participantObservers[r.clientId].publish(r)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(r){throw this.logger.log(r),new Error(r)}publishStateUpdate(r){this.state!==r&&(this.state=r,this.logger.log("REALTIME",`Realtime state did change. New state: ${xo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((r,f)=>{this.supervizChannel.history((a,_)=>{var I;a&&f(a);let S=(I=_.items[0])==null?void 0:I.data;r(S||null)})})}fetchSyncClientProperty(r){return Ft(this,null,function*(){try{let f=yield new Promise((a,_)=>{this.clientRoomStateChannel.history((S,I)=>{var G;S&&_(S);let P=(G=I==null?void 0:I.items[0])==null?void 0:G.data;a(P||null)})});if(r&&!f[r])throw new Error(`Event ${r} not found in the history`);return r?f[r]:f}catch(f){this.logger.log("REALTIME","Error in fetch client realtime data",f.message),this.throw(f.message)}})}onStateChange(){var b,T,u;let r=(b=this.supervizChannelState)==null?void 0:b.current,f=(T=this.connectionState)==null?void 0:T.current,a=f==="connected",_=["initialized","connecting"].includes(f),S=["closed","closing"].includes(f)||["detaching","detached"].includes(r),I={[0]:S,[1]:_,[2]:!r&&a,[3]:r==="attaching",[4]:r==="attached"&&a,[-1]:r==="failed"||f==="failed",[-2]:f==="suspended"||r==="suspended"},P=Object.entries(I).find(([A,M])=>M&&A)[0],G=Number(P);if(G===2&&(this.currentReconnectAttempt=0),a&&this.isReconnecting&&this.onJoinRoom(this.participant),(G===-2||G===-1)&&this.forceReconnect(),(u=this.connectionState)!=null&&u.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(G)}onAblyConnectionStateChange(r){this.connectionState=r,this.onStateChange()}onAblyChannelStateChange(r){this.supervizChannelState=r,this.onStateChange()}onJoinRoom(r){return Ft(this,null,function*(){var f;if(this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&this.findSlotIndex(r),!this.localRoomProperties)this.initializeRoomProperties();else{this.updateParticipants();let a=this.myParticipant.data.type==="host";(f=this.localRoomProperties)!=null&&f.hostClientId?yield this.updateHostInfo(this.localRoomProperties.hostClientId):a&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)}this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(r),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(r){if(this.state===2)return;let f=r.data.participantId===this.hostParticipantId;r.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(r),f&&this.onHostLeft(),this.updateParticipants()}onHostLeft(){this.updateRoomProperties({hostClientId:null})}};st();var Fo=class extends nr{constructor({participant:r,group:f}){super();this.activeComponents=[];this.eventBus=new ir;this.participants=[];this.addComponent=r=>{var _,S;let f=or.checkComponentLimit(r.name);if(this.activeComponents.includes(r.name)){let I=`Component ${r.name} is already active. Please remove it first`;this.logger.log(I);return}if(!f){let I=`You reached the limit usage of ${r.name}`;this.logger.log(I);return}r.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:ae.configuration,eventBus:this.eventBus}),this.activeComponents.push(r.name),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),Ue.sendActivity(this.participant.id,this.group.id,this.group.name,r.name),Ue.createOrUpdateParticipant(ae.get("apiKey"),{name:(_=this.participant)==null?void 0:_.name,participantId:(S=this.participant)==null?void 0:S.id})};this.removeComponent=r=>{if(!this.activeComponents.includes(r.name)){let f=`Component ${r.name} is not initialized yet.`;this.logger.log(f);return}r.detach(),this.activeComponents.splice(this.activeComponents.indexOf(r.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:ae.get("apiKey"),roomId:ae.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.hostObserver.subscribe(this.onHostParticipantDidChange),this.realtime.hostAvailabilityObserver.subscribe(this.onHostAvailabilityChange)};this.onParticipantListUpdate=r=>{this.logger.log("launcher service @ onParticipantListUpdate",r);let f=Object.values(r).map(_=>{var S,I,P,G,b,T;return{id:_.data.id,name:(S=_.data)==null?void 0:S.name,type:(I=_.data)==null?void 0:I.type,avatar:(P=_.data)==null?void 0:P.avatar,avatarConfig:(G=_.data)==null?void 0:G.avatarConfig,isHost:this.realtime.hostClientId===_.clientId,color:this.realtime.getSlotColor((b=_.data)==null?void 0:b.slotIndex).color,activeComponents:(T=_.data)==null?void 0:T.activeComponents}}),a=f.find(_=>{var S;return(_==null?void 0:_.id)===((S=this.participant)==null?void 0:S.id)});(0,Go.isEqual)(this.participants,f)||(this.participants=f,this.publish("participant.list-updated",f),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",f)),a&&!(0,Go.isEqual)(this.participant,a)&&(this.activeComponents=a.activeComponents,this.participant=a,this.publish("participant.updated",a),this.logger.log("Publishing ParticipantEvent.UPDATED",a))};this.onParticipantJoined=r=>{this.logger.log("launcher service @ onParticipantJoined");let f=this.participants.find(a=>a.id===r.data.id);!f||(f.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",f)),this.logger.log("launcher service @ onParticipantJoined - participant joined",f),this.publish("participant.joined",f))};this.onParticipantLeave=r=>{this.logger.log("launcher service @ onParticipantLeave");let f=this.participants.find(a=>a.id===r.data.id);!f||(f.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",f)),this.logger.log("launcher service @ onParticipantLeave - participant left",f),this.publish("participant.left",f))};this.onHostParticipantDidChange=r=>{let f=this.participants.find(a=>a.id===(r==null?void 0:r.newHostParticipantId));this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("realtime.host-change",f),this.publish("realtime.host-change",f))};this.onHostAvailabilityChange=r=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),r){this.publish("realtime.host-available");return}this.publish("realtime.no-host-available")};this.participant=r,this.group=f,this.logger=new De("@superviz/sdk/launcher"),this.realtime=new Gn(ae.get("apiUrl"),ae.get("ablyKey")),this.eventBus=new ir,this.logger.log("launcher created"),this.startRealtime()}},dl=v=>{let d=new Fo(v);return{subscribe:d.subscribe,unsubscribe:d.unsubscribe,addComponent:d.addComponent,removeComponent:d.removeComponent}};var p0=({group:v,participant:d,roomId:r})=>{if(!v||!v.name||!v.id)throw new Error("Group fields is required");if(!d||!d.id||!d.name)throw new Error("Participant name and id is required");if(!r)throw new Error("Room id is required")},g0=(v,d)=>Ft(void 0,null,function*(){if(!(v&&v.trim()))throw new Error("API key is required");if(!d)throw new Error("Options is required");p0(d),d.debug?Ho.debug.enable("*"):Ho.debug.disable();let{apiUrl:f,conferenceLayerUrl:a}=yield Bn.getRemoteConfig(d.environment);if(!(yield al(f,v)))throw new Error("Failed to validate API key");let S=yield Ue.fetchConfig(f,v),I=yield Ue.fetchLimits(f,v);if(!S||!S.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:P}=S;return ae.setConfig({apiUrl:f,ablyKey:P,apiKey:v,conferenceLayerUrl:a,environment:S,roomId:d.roomId,debug:d.debug,limits:I}),dl(Object.assign({},d,{participant:Qe(Kt({},d.participant),{type:d.participant.type||"guest"})}))}),Qy=g0;export{Qy as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
